# è¯­è¨€ç®¡ç†æœ€ä½³å®è·µ

## ğŸ“‹ æ¨¡å—æ¦‚è¿°

**æ¨¡å—åç§°**ï¼šè¯­è¨€ç®¡ç†ï¼ˆLanguage Managementï¼‰  
**ä¼˜å…ˆçº§**ï¼šâ­â­â­â­ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰  
**é¢„è®¡æ—¶é—´**ï¼š1-2 å‘¨  
**ä¾èµ–**ï¼šæ— ï¼ˆç‹¬ç«‹åŠŸèƒ½ï¼‰

**åŠŸèƒ½èŒƒå›´**ï¼š
- è¯­è¨€ç®¡ç†ï¼ˆCRUDï¼‰
- ç¿»è¯‘ç®¡ç†ï¼ˆç¿»è¯‘å†…å®¹ CRUDï¼‰
- å¤šè¯­è¨€æœåŠ¡ï¼ˆæ ¹æ®è¯­è¨€ä»£ç è¿”å›ç¿»è¯‘ï¼‰
- å‰ç«¯é›†æˆï¼ˆreact-i18nextï¼‰

---

## ğŸ” åº“é€‰æ‹©è¯„ä¼°

### å¤šè¯­è¨€å®ç°æ–¹æ¡ˆ

**ç»“è®º**ï¼šâœ… **å‰ç«¯ä½¿ç”¨ react-i18nextï¼ˆå·²é€‰å®šï¼‰ï¼Œåç«¯ä½¿ç”¨è‡ªå®šä¹‰å®ç°ï¼ˆæ¨èï¼‰**

ç»è¿‡è°ƒç ”ï¼Œå¤šè¯­è¨€åŠŸèƒ½éœ€è¦å‰åç«¯é…åˆï¼š

#### å‰ç«¯ï¼šreact-i18next â­â­â­â­â­ï¼ˆå·²é€‰å®šï¼‰

**ä¼˜åŠ¿**ï¼š
- âœ… React ç”Ÿæ€æœ€æˆç†Ÿçš„å¤šè¯­è¨€åº“
- âœ… ä¸ Ant Design å®Œç¾é›†æˆ
- âœ… æ”¯æŒå‘½åç©ºé—´ã€æ’å€¼ã€å¤æ•°ç­‰é«˜çº§åŠŸèƒ½
- âœ… å®Œå–„çš„æ–‡æ¡£å’Œç¤¾åŒºæ”¯æŒ
- âœ… å·²åœ¨é¡¹ç›®ä¸­ä½¿ç”¨

**GitHub**ï¼šhttps://github.com/i18next/react-i18next  
**æ–‡æ¡£**ï¼šhttps://react.i18next.com/

---

#### åç«¯ï¼šè‡ªå®šä¹‰å®ç° â­â­â­â­â­ï¼ˆæ¨èï¼‰

**ä¼˜åŠ¿**ï¼š
- âœ… åŠŸèƒ½ç®€å•ï¼Œå®ç°æˆæœ¬ä½ï¼ˆ1-2 å‘¨å¯å®Œæˆï¼‰
- âœ… ä¸ Tortoise ORM å®Œç¾é›†æˆï¼ˆåŸç”Ÿæ”¯æŒï¼‰
- âœ… å¤šç§Ÿæˆ·éš”ç¦»å¤©ç„¶æ”¯æŒï¼ˆtenant_id å­—æ®µï¼‰
- âœ… å®Œå…¨ç¬¦åˆæ¡†æ¶è§„èŒƒï¼ˆå‘½åã€æ³¨é‡Šã€ä»£ç é£æ ¼ï¼‰
- âœ… å®Œå…¨æ§åˆ¶ï¼Œæ˜“äºå®šåˆ¶å’Œæ‰©å±•
- âœ… æ”¯æŒ JSON å­—æ®µå­˜å‚¨ç¿»è¯‘å†…å®¹ï¼ˆçµæ´»æ‰©å±•ï¼‰
- âœ… æ— éœ€å¼•å…¥é¢å¤–ä¾èµ–

**åŠ£åŠ¿**ï¼š
- âš ï¸ éœ€è¦è‡ªå·±å®ç°ç¿»è¯‘æœåŠ¡

**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… æ ‡å‡†çš„ç¿»è¯‘ç®¡ç†éœ€æ±‚
- âœ… éœ€è¦ä¸ç°æœ‰æ¡†æ¶æ·±åº¦é›†æˆ
- âœ… éœ€è¦å®Œå…¨ç¬¦åˆé¡¹ç›®è§„èŒƒ
- âœ… å¤šç§Ÿæˆ·æ˜¯æ ¸å¿ƒéœ€æ±‚

**å®ç°å¤æ‚åº¦**ï¼šâ­â­ï¼ˆä¸­ç­‰ï¼Œ1-2 å‘¨å¯å®Œæˆï¼‰

---

#### æ–¹æ¡ˆäºŒï¼šä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ â­â­ï¼ˆä¸æ¨èï¼‰

**è°ƒç ”ç»“æœ**ï¼š
- âŒ Python ç”Ÿæ€ä¸­æœ‰ `babel`ã€`gettext` ç­‰åº“ï¼Œä½†ä¸»è¦ç”¨äºæœ¬åœ°åŒ–æ–‡ä»¶å¤„ç†
- âŒ `django-i18n` ç­‰åº“ä¸é€‚ç”¨äº FastAPI + Tortoise ORM
- âŒ å…¶ä»–é€šç”¨åº“åŠŸèƒ½è¿‡äºå¤æ‚ï¼Œä¸ç¬¦åˆç®€å•éœ€æ±‚

**ç»“è®º**ï¼šç¿»è¯‘ç®¡ç†åŠŸèƒ½ç®€å•ï¼Œä½¿ç”¨ç¬¬ä¸‰æ–¹åº“åè€Œå¢åŠ å¤æ‚åº¦ï¼Œä¸æ¨èã€‚

---

### æœ€ç»ˆæ¨èæ–¹æ¡ˆ

**æ¨è**ï¼š
- âœ… **å‰ç«¯**ï¼šä½¿ç”¨ **react-i18next**ï¼ˆå·²é€‰å®šï¼‰
- âœ… **åç«¯**ï¼šä½¿ç”¨ **è‡ªå®šä¹‰å®ç°**

**ç†ç”±**ï¼š
1. âœ… **å‰ç«¯å·²æœ‰ react-i18next**ï¼Œæ— éœ€æ›´æ¢
2. âœ… **åç«¯åŠŸèƒ½ç®€å•**ï¼Œè‡ªå®šä¹‰å®ç°æˆæœ¬ä½ï¼ˆ1-2 å‘¨ï¼‰
3. âœ… **æ— éœ€é¢å¤–ä¾èµ–**ï¼Œå‡å°‘é¡¹ç›®å¤æ‚åº¦
4. âœ… **å¤šç§Ÿæˆ·æ˜¯æ ¸å¿ƒéœ€æ±‚**ï¼Œè‡ªå®šä¹‰å®ç°å¤©ç„¶æ”¯æŒ
5. âœ… **å®Œå…¨ç¬¦åˆæ¡†æ¶è§„èŒƒ**ï¼Œä»£ç é£æ ¼ç»Ÿä¸€
6. âœ… **ç»´æŠ¤æˆæœ¬ä½**ï¼Œå›¢é˜Ÿå®Œå…¨æŒæ§ä»£ç 

---

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### è¯­è¨€è¡¨ï¼ˆroot_languagesï¼‰

```sql
CREATE TABLE root_languages (
    id SERIAL PRIMARY KEY,
    uuid VARCHAR(36) NOT NULL UNIQUE,        -- ä¸šåŠ¡IDï¼ˆUUIDï¼Œå¯¹å¤–æš´éœ²ï¼Œå®‰å…¨ä¸”å”¯ä¸€ï¼‰
    tenant_id INTEGER NOT NULL,
    
    -- è¯­è¨€åŸºæœ¬ä¿¡æ¯
    code VARCHAR(10) NOT NULL,               -- è¯­è¨€ä»£ç ï¼ˆISO 639-1ï¼Œå¦‚ zhã€enï¼‰
    name VARCHAR(50) NOT NULL,                -- è¯­è¨€åç§°ï¼ˆå¦‚ ä¸­æ–‡ã€Englishï¼‰
    native_name VARCHAR(50),                  -- æœ¬åœ°åç§°ï¼ˆå¦‚ ä¸­æ–‡ã€Englishï¼‰
    
    -- ç¿»è¯‘å†…å®¹ï¼ˆJSONï¼‰
    translations JSONB DEFAULT '{}',          -- ç¿»è¯‘å†…å®¹ï¼ˆJSON å­—æ®µï¼Œkey-value æ˜ å°„ï¼‰
    
    -- çŠ¶æ€
    is_default BOOLEAN DEFAULT FALSE,        -- æ˜¯å¦é»˜è®¤è¯­è¨€
    is_active BOOLEAN DEFAULT TRUE,           -- æ˜¯å¦å¯ç”¨
    
    -- æ ‡å‡†å­—æ®µ
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,
    
    -- ç´¢å¼•
    CONSTRAINT uk_root_languages_tenant_code UNIQUE (tenant_id, code),
    INDEX idx_root_languages_tenant_id (tenant_id),
    INDEX idx_root_languages_uuid (uuid),
    INDEX idx_root_languages_code (code),
    INDEX idx_root_languages_created_at (created_at)
);
```

**è®¾è®¡è¦ç‚¹**ï¼š
- âœ… `code` ä½¿ç”¨ ISO 639-1 æ ‡å‡†ï¼ˆå¦‚ zhã€enã€jaï¼‰
- âœ… `translations` JSONB å­—æ®µå­˜å‚¨æ‰€æœ‰ç¿»è¯‘å†…å®¹ï¼ˆkey-value æ˜ å°„ï¼‰
- âœ… `is_default` æ ‡è®°é»˜è®¤è¯­è¨€
- âœ… `tenant_id + code` å”¯ä¸€çº¦æŸ

---

## ğŸ åç«¯æ¨¡å‹è®¾è®¡

### è¯­è¨€æ¨¡å‹ï¼ˆLanguageï¼‰

```python
# riveredge-backend/src/tree-root/models/language.py
from tortoise.models import Model
from tortoise import fields
from tortoise.fields import JSONField
from typing import Dict, Any, Optional
from .base import BaseModel


class Language(BaseModel):
    """
    è¯­è¨€æ¨¡å‹
    
    ç”¨äºç®¡ç†å¤šè¯­è¨€ç¿»è¯‘å†…å®¹ï¼Œæ”¯æŒå¤šç»„ç»‡éš”ç¦»ã€‚
    æ¯ä¸ªç»„ç»‡å¯ä»¥å®šä¹‰è‡ªå·±çš„è¯­è¨€å’Œç¿»è¯‘ã€‚
    
    æ³¨æ„ï¼šç»§æ‰¿è‡ª BaseModelï¼Œè‡ªåŠ¨åŒ…å« uuidã€tenant_idã€created_atã€updated_at å­—æ®µã€‚
    """
    id = fields.IntField(pk=True, description="è¯­è¨€IDï¼ˆä¸»é”®ï¼Œè‡ªå¢IDï¼Œå†…éƒ¨ä½¿ç”¨ï¼‰")
    
    code = fields.CharField(max_length=10, description="è¯­è¨€ä»£ç ï¼ˆISO 639-1ï¼‰")
    name = fields.CharField(max_length=50, description="è¯­è¨€åç§°")
    native_name = fields.CharField(max_length=50, null=True, description="æœ¬åœ°åç§°")
    
    translations = JSONField(default={}, description="ç¿»è¯‘å†…å®¹ï¼ˆJSONï¼‰")
    
    is_default = fields.BooleanField(default=False, description="æ˜¯å¦é»˜è®¤è¯­è¨€")
    is_active = fields.BooleanField(default=True, description="æ˜¯å¦å¯ç”¨")
    
    class Meta:
        table = "root_languages"
        unique_together = [("tenant_id", "code")]
    
    def get_translation(self, key: str, default: Optional[str] = None) -> Optional[str]:
        """è·å–ç¿»è¯‘"""
        return self.translations.get(key, default)
    
    def set_translation(self, key: str, value: str) -> None:
        """è®¾ç½®ç¿»è¯‘"""
        if not self.translations:
            self.translations = {}
        self.translations[key] = value
    
    def update_translations(self, translations: Dict[str, str]) -> None:
        """æ‰¹é‡æ›´æ–°ç¿»è¯‘"""
        if not self.translations:
            self.translations = {}
        self.translations.update(translations)
    
    def remove_translation(self, key: str) -> None:
        """åˆ é™¤ç¿»è¯‘"""
        if self.translations and key in self.translations:
            del self.translations[key]
```

---

## ğŸ”§ Service å±‚è®¾è®¡

### è¯­è¨€æœåŠ¡ï¼ˆLanguageServiceï¼‰

```python
# riveredge-backend/src/tree-root/services/language_service.py
from typing import Optional, List, Dict, Any
from uuid import UUID
from tortoise.exceptions import IntegrityError
from fastapi import HTTPException, status

from ..models.language import Language
from ..schemas.language import LanguageCreate, LanguageUpdate


class LanguageService:
    """è¯­è¨€æœåŠ¡"""
    
    @staticmethod
    async def create_language(
        tenant_id: int,
        data: LanguageCreate
    ) -> Language:
        """åˆ›å»ºè¯­è¨€"""
        try:
            language = await Language.create(
                tenant_id=tenant_id,
                **data.model_dump()
            )
            
            # å¦‚æœè®¾ç½®ä¸ºé»˜è®¤è¯­è¨€ï¼Œå–æ¶ˆå…¶ä»–è¯­è¨€çš„é»˜è®¤æ ‡è®°
            if data.is_default:
                await Language.filter(
                    tenant_id=tenant_id,
                    is_default=True
                ).update(is_default=False)
            
            return language
        except IntegrityError:
            raise HTTPException(
                status_code=status.HTTP_400_BAD_REQUEST,
                detail=f"è¯­è¨€ä»£ç  {data.code} å·²å­˜åœ¨"
            )
    
    @staticmethod
    async def get_language_by_code(
        tenant_id: int,
        code: str
    ) -> Optional[Language]:
        """æ ¹æ®ä»£ç è·å–è¯­è¨€"""
        return await Language.get_or_none(
            tenant_id=tenant_id,
            code=code,
            deleted_at__isnull=True,
            is_active=True
        )
    
    @staticmethod
    async def get_default_language(tenant_id: int) -> Optional[Language]:
        """è·å–é»˜è®¤è¯­è¨€"""
        return await Language.get_or_none(
            tenant_id=tenant_id,
            is_default=True,
            deleted_at__isnull=True,
            is_active=True
        )
    
    @staticmethod
    async def get_translations(
        tenant_id: int,
        code: str
    ) -> Dict[str, str]:
        """è·å–ç¿»è¯‘å†…å®¹"""
        language = await LanguageService.get_language_by_code(tenant_id, code)
        if not language:
            # å¦‚æœè¯­è¨€ä¸å­˜åœ¨ï¼Œè¿”å›é»˜è®¤è¯­è¨€çš„ç¿»è¯‘
            default_language = await LanguageService.get_default_language(tenant_id)
            if default_language:
                return default_language.translations or {}
            return {}
        
        return language.translations or {}
    
    @staticmethod
    async def update_translations(
        tenant_id: int,
        code: str,
        translations: Dict[str, str]
    ) -> Language:
        """æ›´æ–°ç¿»è¯‘å†…å®¹"""
        language = await LanguageService.get_language_by_code(tenant_id, code)
        if not language:
            raise HTTPException(
                status_code=status.HTTP_404_NOT_FOUND,
                detail="è¯­è¨€ä¸å­˜åœ¨"
            )
        
        language.update_translations(translations)
        await language.save()
        
        return language
```

---

## ğŸŒ API è®¾è®¡

### è¯­è¨€ç®¡ç† API

```python
# riveredge-backend/src/tree-root/api/languages/languages.py
from fastapi import APIRouter, Depends, Query, Body
from typing import Optional, List, Dict, Any
from uuid import UUID

from ....soil.api.deps import get_current_tenant
from ...schemas.language import (
    LanguageCreate,
    LanguageUpdate,
    LanguageResponse
)
from ...services.language_service import LanguageService

router = APIRouter(prefix="/languages", tags=["è¯­è¨€ç®¡ç†"])


@router.post("", response_model=LanguageResponse, status_code=201)
async def create_language(
    data: LanguageCreate,
    tenant_id: int = Depends(get_current_tenant)
):
    """åˆ›å»ºè¯­è¨€"""
    language = await LanguageService.create_language(tenant_id, data)
    return language


@router.get("", response_model=List[LanguageResponse])
async def list_languages(
    skip: int = Query(0, ge=0),
    limit: int = Query(100, ge=1, le=1000),
    is_active: Optional[bool] = Query(None),
    tenant_id: int = Depends(get_current_tenant)
):
    """è·å–è¯­è¨€åˆ—è¡¨"""
    # å®ç°åˆ—è¡¨æŸ¥è¯¢é€»è¾‘
    pass


@router.get("/{code}/translations", response_model=Dict[str, str])
async def get_translations(
    code: str,
    tenant_id: int = Depends(get_current_tenant)
):
    """è·å–ç¿»è¯‘å†…å®¹"""
    translations = await LanguageService.get_translations(tenant_id, code)
    return translations


@router.put("/{code}/translations", response_model=Dict[str, str])
async def update_translations(
    code: str,
    translations: Dict[str, str] = Body(...),
    tenant_id: int = Depends(get_current_tenant)
):
    """æ›´æ–°ç¿»è¯‘å†…å®¹"""
    language = await LanguageService.update_translations(
        tenant_id, code, translations
    )
    return language.translations
```

---

## ğŸ¨ å‰ç«¯é¡µé¢è®¾è®¡

**å‚è€ƒ**ï¼šå¤ç”¨ç¬¬ä¸€é˜¶æ®µçš„é¡µé¢å¸ƒå±€è§„èŒƒ

**åŠŸèƒ½**ï¼š
- è¯­è¨€åˆ—è¡¨ï¼ˆè¡¨æ ¼å±•ç¤ºï¼‰
- åˆ›å»ºè¯­è¨€ï¼ˆModalï¼‰
- ç¼–è¾‘è¯­è¨€ï¼ˆModalï¼‰
- ç¿»è¯‘ç¼–è¾‘å™¨ï¼ˆç¿»è¯‘å†…å®¹ç®¡ç†ï¼Œæ”¯æŒæ‰¹é‡å¯¼å…¥å¯¼å‡ºï¼‰
- è¯­è¨€åˆ‡æ¢ï¼ˆå‰ç«¯è¯­è¨€åˆ‡æ¢åŠŸèƒ½ï¼‰

**é¡µé¢è·¯å¾„**ï¼š
- `riveredge-frontend/src/tree-stem/pages/system/languages/list/index.tsx`
- `riveredge-frontend/src/tree-stem/pages/system/languages/translations/index.tsx`

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ç³»ç»Ÿçº§åŠŸèƒ½å»ºè®¾è®¡åˆ’.md](../ç³»ç»Ÿçº§åŠŸèƒ½å»ºè®¾è®¡åˆ’.md)
- [å‰ç«¯é¡µé¢å¸ƒå±€è§„èŒƒ.md](../sysç¬¬ä¸€é˜¶æ®µ/å‰ç«¯é¡µé¢å¸ƒå±€è§„èŒƒ.md)

---

**æœ€åæ›´æ–°**ï¼š2025-01-XX


# 前端页面布局规范

## 📋 概述

本文档定义了系统级功能前端页面的标准布局规范，确保所有页面保持一致的开发风格和交互方式。

**参考标准**：平台级组织管理页面（`pages/platform/tenants/list/index.tsx`）

---

## 🎯 核心原则

### 1. 默认参考组织管理布局

**⚠️ 重要原则**：
- ✅ **默认遵循标准布局**：所有新开发的页面必须参考组织管理页面的布局结构
- ✅ **特殊情况单独处理**：如有特殊需求，在标准布局基础上进行扩展，并在代码中明确标注
- ✅ **保持一致性**：相同功能的页面应保持相同的实现方式

### 2. 树形结构灵活设计

**⚠️ 重要原则**：
- ✅ **树形结构可灵活设计**：对于树形结构（如部门管理、菜单管理），不必完全拘泥固定的界面结构
- ✅ **按最佳实践构建**：可根据最佳实践文档中的设计，选择最适合的展示方式（树形列表、表格视图等）
- ✅ **用户体验优先**：优先考虑用户体验，选择最直观的展示方式

---

## 📐 标准页面布局结构

### 标准列表页面结构

**参考**：`pages/platform/tenants/list/index.tsx`

```typescript
import React, { useRef, useState } from 'react';
import { ActionType, ProColumns, ProForm, ProFormInstance } from '@ant-design/pro-components';
import { App, Modal, Drawer } from 'antd';
import { UniTable } from '../../../../components/uni_table';

const StandardListPage: React.FC = () => {
  const { message } = App.useApp();
  const actionRef = useRef<ActionType>(null);
  const formRef = useRef<ProFormInstance>();
  
  // Modal 相关状态（创建/编辑）
  const [modalVisible, setModalVisible] = useState(false);
  const [isEdit, setIsEdit] = useState(false);
  const [formLoading, setFormLoading] = useState(false);
  
  // Drawer 相关状态（详情查看）
  const [drawerVisible, setDrawerVisible] = useState(false);
  const [currentId, setCurrentId] = useState<number | null>(null);
  const [detailData, setDetailData] = useState<any>(null);
  
  return (
    <>
      <UniTable
        actionRef={actionRef}
        columns={columns}
        request={async (params) => {
          // 数据请求逻辑
        }}
        // ... 其他配置
      />
      
      {/* 创建/编辑 Modal */}
      <Modal
        title={isEdit ? '编辑' : '新建'}
        open={modalVisible}
        onCancel={() => setModalVisible(false)}
        onOk={handleSubmit}
        confirmLoading={formLoading}
        width={800}
      >
        <ProForm
          formRef={formRef}
          // ... 表单配置
        />
      </Modal>
      
      {/* 详情 Drawer */}
      <Drawer
        title="详情"
        open={drawerVisible}
        onClose={() => setDrawerVisible(false)}
        width={600}
      >
        {/* 详情内容 */}
      </Drawer>
    </>
  );
};
```

### 标准功能组件

#### 1. 数据列表展示

**使用 `UniTable` 组件**：
- ✅ 默认导入/导出按钮
- ✅ 默认视图切换（表格、卡片、看板、统计）
- ✅ 自动生成导入配置
- ✅ 默认密度：紧凑（`size="small"`）
- ✅ 默认每页条数：20条

```typescript
<UniTable
  actionRef={actionRef}
  columns={columns}
  request={async (params) => {
    const response = await getList(params);
    return {
      data: response.items,
      success: true,
      total: response.total,
    };
  }}
  rowKey="id"
  search={{
    labelWidth: 'auto',
  }}
  pagination={{
    defaultPageSize: 20,
  }}
  toolBarRender={() => [
    <Button key="create" type="primary" onClick={handleCreate}>
      新建
    </Button>,
  ]}
/>
```

#### 2. 创建/编辑功能

**使用 Modal + ProForm**：
- ✅ 新建和编辑使用同一个 Modal
- ✅ 使用 `isEdit` 状态区分新建/编辑
- ✅ Modal 宽度：800px
- ✅ 表单使用 ProForm 组件

```typescript
const [modalVisible, setModalVisible] = useState(false);
const [isEdit, setIsEdit] = useState(false);

// 新建
const handleCreate = () => {
  setIsEdit(false);
  setModalVisible(true);
  formRef.current?.resetFields();
};

// 编辑
const handleEdit = (record: any) => {
  setIsEdit(true);
  setModalVisible(true);
  formRef.current?.setFieldsValue(record);
};

// 提交
const handleSubmit = async () => {
  try {
    setFormLoading(true);
    const values = await formRef.current?.validateFields();
    if (isEdit) {
      await updateItem(currentId, values);
    } else {
      await createItem(values);
    }
    message.success(isEdit ? '更新成功' : '创建成功');
    setModalVisible(false);
    actionRef.current?.reload();
  } catch (error) {
    message.error('操作失败');
  } finally {
    setFormLoading(false);
  }
};
```

#### 3. 详情查看功能

**使用 Drawer 侧边抽屉**：
- ✅ Drawer 宽度：600px
- ✅ 使用 ProDescriptions 展示详情
- ✅ 支持编辑按钮（可选）

```typescript
const [drawerVisible, setDrawerVisible] = useState(false);
const [detailData, setDetailData] = useState<any>(null);

const handleView = async (id: number) => {
  const data = await getDetail(id);
  setDetailData(data);
  setDrawerVisible(true);
};

<Drawer
  title="详情"
  open={drawerVisible}
  onClose={() => setDrawerVisible(false)}
  width={600}
>
  <ProDescriptions
    column={2}
    dataSource={detailData}
    columns={detailColumns}
  />
</Drawer>
```

#### 4. 删除功能

**使用 Popconfirm 确认**：
- ✅ 单个删除：使用 Popconfirm
- ✅ 批量删除：使用 Modal 确认
- ✅ 显示删除进度（批量删除时）

```typescript
// 单个删除
<Popconfirm
  title="确定要删除吗？"
  onConfirm={async () => {
    await deleteItem(record.id);
    message.success('删除成功');
    actionRef.current?.reload();
  }}
>
  <Button danger size="small">删除</Button>
</Popconfirm>

// 批量删除
const handleBatchDelete = async () => {
  Modal.confirm({
    title: '确定要删除选中的项吗？',
    content: `共 ${selectedRowKeys.length} 项`,
    onOk: async () => {
      // 显示进度 Modal
      const progressModal = Modal.info({
        title: '正在删除',
        content: <Progress percent={0} />,
        okButtonProps: { style: { display: 'none' } },
      });
      
      // 批量删除逻辑
      // ...
      
      progressModal.destroy();
      message.success('删除成功');
      actionRef.current?.reload();
    },
  });
};
```

#### 5. 导入/导出功能

**使用 UniTable 内置功能**：
- ✅ 导入按钮：Excel 绿色（`#217346`），outlined 样式
- ✅ 导出按钮：默认样式
- ✅ 导入使用 UniImport 组件
- ✅ 导出使用 UniTable 内置导出功能

```typescript
<UniTable
  showImportButton={true}
  showExportButton={true}
  onImport={async (data) => {
    // 处理导入数据
    await batchImport(data);
    message.success('导入成功');
    actionRef.current?.reload();
  }}
  onExport={async (params) => {
    // 处理导出数据
    const data = await getList(params);
    return data.items;
  }}
/>
```

---

## 🌳 树形结构页面布局

### 灵活设计原则

**⚠️ 重要**：树形结构页面（如部门管理、菜单管理）可以灵活设计，不必完全拘泥固定的界面结构。

### 可选布局方案

#### 方案一：树形列表 + 详情面板

**适用场景**：部门管理、菜单管理

```typescript
<div style={{ display: 'flex', height: '100%' }}>
  {/* 左侧：树形列表 */}
  <div style={{ width: '300px', borderRight: '1px solid #f0f0f0' }}>
    <Tree
      treeData={treeData}
      onSelect={handleSelect}
      draggable
      onDrop={handleDrop}
    />
  </div>
  
  {/* 右侧：详情面板 */}
  <div style={{ flex: 1, padding: '16px' }}>
    {selectedNode ? (
      <ProDescriptions
        title="部门详情"
        dataSource={selectedNode}
        columns={detailColumns}
      />
    ) : (
      <Empty description="请选择部门" />
    )}
  </div>
</div>
```

#### 方案二：树形表格（可展开）

**适用场景**：需要表格功能的树形数据

```typescript
<UniTable
  columns={columns}
  request={async (params) => {
    const response = await getDepartmentTree(params);
    return {
      data: response.items,
      success: true,
      total: response.total,
    };
  }}
  // 使用 ProTable 的树形展开功能
  expandable={{
    defaultExpandAllRows: false,
  }}
/>
```

#### 方案三：混合布局（树形 + 表格）

**适用场景**：需要同时展示树形结构和详细列表

```typescript
<div style={{ display: 'flex' }}>
  {/* 左侧：树形导航 */}
  <div style={{ width: '250px' }}>
    <Tree
      treeData={treeData}
      onSelect={handleSelect}
    />
  </div>
  
  {/* 右侧：表格列表 */}
  <div style={{ flex: 1 }}>
    <UniTable
      columns={columns}
      request={async (params) => {
        // 根据选中的树节点筛选数据
        const response = await getList({
          ...params,
          department_id: selectedDepartmentId,
        });
        return {
          data: response.items,
          success: true,
          total: response.total,
        };
      }}
    />
  </div>
</div>
```

---

## 📝 特殊情况处理

### 1. 特殊布局需求

**处理方式**：
- ✅ 在标准布局基础上扩展
- ✅ 在代码中明确标注特殊原因
- ✅ 保持核心交互方式一致

```typescript
/**
 * 特殊布局说明：
 * 由于需要展示复杂的关联关系，采用左右分栏布局
 * 左侧：主数据列表
 * 右侧：关联数据详情
 */
const SpecialLayoutPage: React.FC = () => {
  // 特殊布局实现
};
```

### 2. 特殊交互需求

**处理方式**：
- ✅ 优先使用 Ant Design 组件
- ✅ 保持与标准交互方式的一致性
- ✅ 在代码中说明特殊交互的原因

---

## ✅ 页面开发检查清单

### 标准功能检查

- [ ] 使用 `UniTable` 组件展示列表
- [ ] 创建/编辑使用 Modal + ProForm
- [ ] 详情查看使用 Drawer + ProDescriptions
- [ ] 删除使用 Popconfirm 确认
- [ ] 批量删除显示进度
- [ ] 导入/导出功能（如需要）
- [ ] 搜索和筛选功能
- [ ] 分页和排序功能

### 布局一致性检查

- [ ] 参考组织管理页面布局
- [ ] Modal 宽度：800px
- [ ] Drawer 宽度：600px
- [ ] 按钮样式统一
- [ ] 间距和边距统一
- [ ] 颜色和字体统一

### 树形结构检查（如适用）

- [ ] 选择最适合的布局方案
- [ ] 树形数据展示清晰
- [ ] 支持拖拽排序（如需要）
- [ ] 支持展开/折叠
- [ ] 支持搜索和筛选

---

## 📚 相关文档

- [1.角色权限管理最佳实践.md](./1.角色权限管理最佳实践.md)
- [2.部门管理最佳实践.md](./2.部门管理最佳实践.md)
- [3.职位管理最佳实践.md](./3.职位管理最佳实践.md)
- [4.账户管理最佳实践.md](./4.账户管理最佳实践.md)
- [页面开发标准模板规范.md](../../2.rules/11.页面开发标准模板规范.md)

---

## 🎯 总结

### 核心原则

1. **默认参考组织管理布局**：所有新页面默认参考组织管理页面的布局结构
2. **特殊情况单独处理**：如有特殊需求，在标准布局基础上扩展，并明确标注
3. **树形结构灵活设计**：树形结构页面可按最佳实践灵活设计，不必拘泥固定布局

### 标准组件

- ✅ **UniTable**：数据列表展示
- ✅ **Modal + ProForm**：创建/编辑
- ✅ **Drawer + ProDescriptions**：详情查看
- ✅ **Popconfirm**：删除确认
- ✅ **UniImport**：数据导入

### 布局规范

- ✅ Modal 宽度：800px
- ✅ Drawer 宽度：600px
- ✅ 默认密度：紧凑
- ✅ 默认每页条数：20条
- ✅ 导入按钮：Excel 绿色（`#217346`）

---

**最后更新**：2025-01-XX


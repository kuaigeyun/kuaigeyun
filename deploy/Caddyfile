# RiverEdge 生产环境 Caddy 配置
# 使用环境变量 DOMAIN：设为真实域名时自动 HTTPS，未设或 localhost 时仅 HTTP

# www 重定向到主域名
www.kuaigeyun.com {
    redir https://kuaigeyun.com{uri} permanent
}

{$DOMAIN:localhost} {
    # API 反向代理到后端 uvicorn
    handle /api/* {
        reverse_proxy 127.0.0.1:8200
    }

    # 静态文件（前端构建产物）
    handle {
        root * /opt/riveredge/frontend-dist
        file_server
    }

    # 传递真实客户端信息
    header {
        X-Forwarded-Proto {scheme}
        X-Forwarded-For {remote_host}
    }

    # 日志
    log {
        output stdout
        format console
    }
}

# ä¸»æ•°æ®ç®¡ç†æ¶æ„é€‰æ‹©åˆ†æ

## ğŸ“‹ æ¦‚è¿°

åˆ†æä¸»æ•°æ®ç®¡ç† APP æ˜¯å¦éœ€è¦ä½¿ç”¨ DDD æ¶æ„ï¼Œè¿˜æ˜¯å¯ä»¥ä½¿ç”¨æ›´ç®€å•çš„ä¼ ç»Ÿåˆ†å±‚æ¶æ„ã€‚

---

## ğŸ¯ DDD æ¶æ„é€‚ç”¨åœºæ™¯

### DDD æ¶æ„çš„æ ¸å¿ƒç‰¹å¾

1. **å¤æ‚ä¸šåŠ¡é€»è¾‘**ï¼šéœ€è¦é¢†åŸŸæ¨¡å‹æ¥è¡¨è¾¾ä¸šåŠ¡æ¦‚å¿µ
2. **ä¸šåŠ¡è§„åˆ™å¤æ‚**ï¼šéœ€è¦é¢†åŸŸæœåŠ¡æ¥å¤„ç†å¤æ‚çš„ä¸šåŠ¡è§„åˆ™
3. **æœ‰ç•Œä¸Šä¸‹æ–‡**ï¼šç‹¬ç«‹çš„ä¸šåŠ¡é¢†åŸŸï¼Œæœ‰æ˜ç¡®çš„è¾¹ç•Œ
4. **é¢†åŸŸé©±åŠ¨**ï¼šä¸šåŠ¡é€»è¾‘é©±åŠ¨æŠ€æœ¯å®ç°

### ä½•æ—¶ä½¿ç”¨ DDD æ¶æ„

**é€‚åˆä½¿ç”¨ DDD çš„åœºæ™¯**ï¼š
- âœ… **å¤æ‚ä¸šåŠ¡æµç¨‹**ï¼šå¦‚è®¢å•å¤„ç†ã€å®¡æ‰¹æµç¨‹ã€ç”Ÿäº§è®¡åˆ’ç­‰
- âœ… **å¤æ‚ä¸šåŠ¡è§„åˆ™**ï¼šå¦‚ä»·æ ¼è®¡ç®—ã€åº“å­˜ç®¡ç†ã€è´¨é‡æ£€éªŒç­‰
- âœ… **é¢†åŸŸæ¨¡å‹å¤æ‚**ï¼šéœ€è¦èšåˆã€å®ä½“ã€å€¼å¯¹è±¡ç­‰æ¦‚å¿µ
- âœ… **ä¸šåŠ¡é€»è¾‘å˜åŒ–é¢‘ç¹**ï¼šéœ€è¦çµæ´»çš„é¢†åŸŸæ¨¡å‹æ”¯æŒ

**ä¸é€‚åˆä½¿ç”¨ DDD çš„åœºæ™¯**ï¼š
- âŒ **ç®€å• CRUD**ï¼šä¸»è¦æ˜¯æ•°æ®çš„å¢åˆ æ”¹æŸ¥
- âŒ **ä¸šåŠ¡é€»è¾‘ç®€å•**ï¼šä¸»è¦æ˜¯æ•°æ®éªŒè¯å’Œæ ‡å‡†åŒ–
- âŒ **æ— å¤æ‚è§„åˆ™**ï¼šæ²¡æœ‰å¤æ‚çš„ä¸šåŠ¡è§„åˆ™éœ€è¦å¤„ç†
- âŒ **æ•°æ®ç®¡ç†ä¸ºä¸»**ï¼šä¸»è¦æ˜¯æ•°æ®ç®¡ç†ï¼Œä¸æ˜¯ä¸šåŠ¡æµç¨‹

---

## ğŸ” ä¸»æ•°æ®ç®¡ç†çš„ç‰¹ç‚¹åˆ†æ

### ä¸»æ•°æ®ç®¡ç†çš„æ ¸å¿ƒç‰¹å¾

1. **æ•°æ®ç®¡ç†ä¸ºä¸»**ï¼š
   - ä¸»è¦æ˜¯ CRUD æ“ä½œï¼ˆåˆ›å»ºã€è¯»å–ã€æ›´æ–°ã€åˆ é™¤ï¼‰
   - æ•°æ®éªŒè¯å’Œæ ‡å‡†åŒ–
   - æ•°æ®å¯¼å…¥å¯¼å‡º

2. **ä¸šåŠ¡é€»è¾‘ç›¸å¯¹ç®€å•**ï¼š
   - æ•°æ®å”¯ä¸€æ€§éªŒè¯ï¼ˆç‰©æ–™ç¼–ç å”¯ä¸€ï¼‰
   - æ•°æ®æ ‡å‡†åŒ–ï¼ˆç‰©æ–™åç§°è§„èŒƒï¼‰
   - æ•°æ®å…³è”éªŒè¯ï¼ˆBOM å…³è”éªŒè¯ï¼‰

3. **ç‹¬ç«‹çš„æœ‰ç•Œä¸Šä¸‹æ–‡**ï¼š
   - ç‰©æ–™ã€å®¢æˆ·ã€ä¾›åº”å•†ç­‰æ˜¯ç‹¬ç«‹çš„ä¸šåŠ¡é¢†åŸŸ
   - éœ€è¦è¢«å¤šä¸ªä¸šåŠ¡åº”ç”¨å¼•ç”¨
   - æœ‰æ˜ç¡®çš„æ•°æ®è¾¹ç•Œ

4. **æ•°æ®å…±äº«éœ€æ±‚**ï¼š
   - éœ€è¦æä¾›ç»Ÿä¸€çš„ API æ¥å£
   - éœ€è¦æ”¯æŒæ‰¹é‡æŸ¥è¯¢
   - éœ€è¦æ”¯æŒç¼“å­˜æœºåˆ¶

### ä¸»æ•°æ®ç®¡ç†çš„ä¸šåŠ¡å¤æ‚åº¦

**ç®€å•éƒ¨åˆ†**ï¼š
- âœ… ç‰©æ–™ç®¡ç†ï¼šä¸»è¦æ˜¯ CRUD + æ•°æ®éªŒè¯
- âœ… å®¢æˆ·ç®¡ç†ï¼šä¸»è¦æ˜¯ CRUD + æ•°æ®éªŒè¯
- âœ… ä¾›åº”å•†ç®¡ç†ï¼šä¸»è¦æ˜¯ CRUD + æ•°æ®éªŒè¯

**ä¸­ç­‰å¤æ‚åº¦éƒ¨åˆ†**ï¼š
- âš ï¸ äº§å“ç®¡ç†ï¼šéœ€è¦ BOM ç®¡ç†ï¼ˆæ ‘å½¢ç»“æ„ï¼‰
- âš ï¸ æ•°æ®æ ‡å‡†åŒ–ï¼šéœ€è¦è§„åˆ™å¼•æ“ï¼ˆå¯é…ç½®çš„éªŒè¯è§„åˆ™ï¼‰
- âš ï¸ ç‰ˆæœ¬ç®¡ç†ï¼šéœ€è¦æ•°æ®ç‰ˆæœ¬æ§åˆ¶

**å¤æ‚éƒ¨åˆ†**ï¼š
- âŒ æ²¡æœ‰å¤æ‚çš„ä¸šåŠ¡æµç¨‹
- âŒ æ²¡æœ‰å¤æ‚çš„çŠ¶æ€æœº
- âŒ æ²¡æœ‰å¤æ‚çš„ä¸šåŠ¡è§„åˆ™è®¡ç®—

---

## ğŸ“Š æ¶æ„é€‰æ‹©å¯¹æ¯”

### æ–¹æ¡ˆä¸€ï¼šä¼ ç»Ÿåˆ†å±‚æ¶æ„ï¼ˆæ¨èï¼‰

**æ¶æ„è®¾è®¡**ï¼š

```
apps/master-data/
â”œâ”€â”€ api/                      # API å±‚ï¼ˆControllerï¼‰
â”‚   â”œâ”€â”€ materials.py          # ç‰©æ–™ API
â”‚   â”œâ”€â”€ customers.py          # å®¢æˆ· API
â”‚   â””â”€â”€ suppliers.py         # ä¾›åº”å•† API
â”‚
â”œâ”€â”€ services/                  # æœåŠ¡å±‚ï¼ˆServiceï¼‰
â”‚   â”œâ”€â”€ material_service.py  # ç‰©æ–™æœåŠ¡
â”‚   â”œâ”€â”€ customer_service.py   # å®¢æˆ·æœåŠ¡
â”‚   â””â”€â”€ supplier_service.py   # ä¾›åº”å•†æœåŠ¡
â”‚
â”œâ”€â”€ models/                    # æ¨¡å‹å±‚ï¼ˆModelï¼‰
â”‚   â”œâ”€â”€ material.py          # ç‰©æ–™æ¨¡å‹
â”‚   â”œâ”€â”€ customer.py          # å®¢æˆ·æ¨¡å‹
â”‚   â””â”€â”€ supplier.py          # ä¾›åº”å•†æ¨¡å‹
â”‚
â”œâ”€â”€ schemas/                   # æ•°æ®éªŒè¯å±‚ï¼ˆSchemaï¼‰
â”‚   â”œâ”€â”€ material_schemas.py  # ç‰©æ–™ Schema
â”‚   â”œâ”€â”€ customer_schemas.py   # å®¢æˆ· Schema
â”‚   â””â”€â”€ supplier_schemas.py   # ä¾›åº”å•† Schema
â”‚
â””â”€â”€ utils/                     # å·¥å…·å±‚ï¼ˆUtilsï¼‰
    â”œâ”€â”€ data_validator.py     # æ•°æ®éªŒè¯å·¥å…·
    â””â”€â”€ data_standardizer.py  # æ•°æ®æ ‡å‡†åŒ–å·¥å…·
```

**ä¼˜ç‚¹**ï¼š
- âœ… **ç®€å•ç›´æ¥**ï¼šæ¶æ„æ¸…æ™°ï¼Œæ˜“äºç†è§£å’Œç»´æŠ¤
- âœ… **å¼€å‘æ•ˆç‡é«˜**ï¼šä¸éœ€è¦å¤æ‚çš„é¢†åŸŸå»ºæ¨¡
- âœ… **æ€§èƒ½å¥½**ï¼šç›´æ¥æ“ä½œæ•°æ®åº“ï¼Œæ— é¢å¤–æŠ½è±¡å±‚
- âœ… **é€‚åˆ CRUD**ï¼šå®Œç¾åŒ¹é…ä¸»æ•°æ®ç®¡ç†çš„éœ€æ±‚

**ç¼ºç‚¹**ï¼š
- âš ï¸ **ä¸šåŠ¡é€»è¾‘åˆ†æ•£**ï¼šä¸šåŠ¡é€»è¾‘å¯èƒ½åœ¨ Service å±‚å’Œ Model å±‚
- âš ï¸ **æ‰©å±•æ€§ä¸€èˆ¬**ï¼šå¦‚æœæœªæ¥ä¸šåŠ¡é€»è¾‘å˜å¤æ‚ï¼Œéœ€è¦é‡æ„

### æ–¹æ¡ˆäºŒï¼šDDD æ¶æ„ï¼ˆå¤‡é€‰ï¼‰

**æ¶æ„è®¾è®¡**ï¼š

```
apps/master-data/
â”œâ”€â”€ domain/                    # é¢†åŸŸå±‚
â”‚   â”œâ”€â”€ entities/            # å®ä½“
â”‚   â”‚   â”œâ”€â”€ material.py      # ç‰©æ–™å®ä½“
â”‚   â”‚   â”œâ”€â”€ customer.py      # å®¢æˆ·å®ä½“
â”‚   â”‚   â””â”€â”€ supplier.py      # ä¾›åº”å•†å®ä½“
â”‚   â”œâ”€â”€ value_objects/        # å€¼å¯¹è±¡
â”‚   â”‚   â”œâ”€â”€ material_code.py # ç‰©æ–™ç¼–ç å€¼å¯¹è±¡
â”‚   â”‚   â””â”€â”€ address.py       # åœ°å€å€¼å¯¹è±¡
â”‚   â”œâ”€â”€ domain_services/      # é¢†åŸŸæœåŠ¡
â”‚   â”‚   â”œâ”€â”€ material_domain_service.py  # ç‰©æ–™é¢†åŸŸæœåŠ¡
â”‚   â”‚   â””â”€â”€ data_standardizer.py        # æ•°æ®æ ‡å‡†åŒ–é¢†åŸŸæœåŠ¡
â”‚   â””â”€â”€ repositories/         # ä»“å‚¨æ¥å£
â”‚       â”œâ”€â”€ material_repository.py
â”‚       â””â”€â”€ customer_repository.py
â”‚
â”œâ”€â”€ application/              # åº”ç”¨å±‚
â”‚   â”œâ”€â”€ services/            # åº”ç”¨æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ material_service.py
â”‚   â”‚   â””â”€â”€ customer_service.py
â”‚   â””â”€â”€ dto/                  # DTO
â”‚       â”œâ”€â”€ material_dto.py
â”‚       â””â”€â”€ customer_dto.py
â”‚
â””â”€â”€ infrastructure/           # åŸºç¡€è®¾æ–½å±‚
    â”œâ”€â”€ api/                  # API å±‚
    â”‚   â”œâ”€â”€ materials.py
    â”‚   â””â”€â”€ customers.py
    â”œâ”€â”€ repositories/         # ä»“å‚¨å®ç°
    â”‚   â”œâ”€â”€ material_repository_impl.py
    â”‚   â””â”€â”€ customer_repository_impl.py
    â””â”€â”€ models/               # ORM æ¨¡å‹
        â”œâ”€â”€ material_model.py
        â””â”€â”€ customer_model.py
```

**ä¼˜ç‚¹**ï¼š
- âœ… **ä¸šåŠ¡é€»è¾‘é›†ä¸­**ï¼šä¸šåŠ¡é€»è¾‘åœ¨é¢†åŸŸå±‚ï¼Œæ¸…æ™°æ˜ç¡®
- âœ… **æ˜“äºæ‰©å±•**ï¼šå¦‚æœæœªæ¥ä¸šåŠ¡é€»è¾‘å˜å¤æ‚ï¼Œæ˜“äºæ‰©å±•
- âœ… **ç¬¦åˆ DDD åŸåˆ™**ï¼šç¬¦åˆé¢†åŸŸé©±åŠ¨è®¾è®¡çš„æœ€ä½³å®è·µ
- âœ… **æµ‹è¯•å‹å¥½**ï¼šé¢†åŸŸå±‚å¯ä»¥ç‹¬ç«‹æµ‹è¯•

**ç¼ºç‚¹**ï¼š
- âš ï¸ **å¤æ‚åº¦é«˜**ï¼šéœ€è¦é¢†åŸŸå»ºæ¨¡ï¼Œå¼€å‘æˆæœ¬é«˜
- âš ï¸ **è¿‡åº¦è®¾è®¡**ï¼šå¯¹äºç®€å•çš„ CRUD æ“ä½œï¼Œå¯èƒ½æ˜¯è¿‡åº¦è®¾è®¡
- âš ï¸ **æ€§èƒ½å¼€é”€**ï¼šå¤šå±‚æŠ½è±¡å¯èƒ½å¸¦æ¥æ€§èƒ½å¼€é”€

---

## ğŸ¯ æ¨èæ–¹æ¡ˆ

### æ¨èï¼šä¼ ç»Ÿåˆ†å±‚æ¶æ„ï¼ˆç®€åŒ–ç‰ˆï¼‰

**ç†ç”±**ï¼š

1. **ä¸šåŠ¡å¤æ‚åº¦åŒ¹é…**ï¼š
   - ä¸»æ•°æ®ç®¡ç†ä¸»è¦æ˜¯ CRUD æ“ä½œ
   - ä¸šåŠ¡é€»è¾‘ç›¸å¯¹ç®€å•ï¼ˆæ•°æ®éªŒè¯ã€æ ‡å‡†åŒ–ï¼‰
   - ä¸éœ€è¦å¤æ‚çš„é¢†åŸŸæ¨¡å‹

2. **å¼€å‘æ•ˆç‡**ï¼š
   - ä¼ ç»Ÿåˆ†å±‚æ¶æ„å¼€å‘æ•ˆç‡é«˜
   - ä¸éœ€è¦å¤æ‚çš„é¢†åŸŸå»ºæ¨¡
   - ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤

3. **æ€§èƒ½è€ƒè™‘**ï¼š
   - ä¸»æ•°æ®ç®¡ç†éœ€è¦é«˜æ€§èƒ½ï¼ˆè¢«å¤šä¸ªåº”ç”¨é¢‘ç¹è°ƒç”¨ï¼‰
   - ä¼ ç»Ÿåˆ†å±‚æ¶æ„æ€§èƒ½æ›´å¥½ï¼ˆæ— é¢å¤–æŠ½è±¡å±‚ï¼‰

4. **å®é™…éœ€æ±‚**ï¼š
   - ä¸»æ•°æ®ç®¡ç†çš„æ ¸å¿ƒéœ€æ±‚æ˜¯æ•°æ®ç®¡ç†ï¼Œä¸æ˜¯ä¸šåŠ¡æµç¨‹
   - ä¼ ç»Ÿåˆ†å±‚æ¶æ„å®Œç¾åŒ¹é…è¿™ä¸ªéœ€æ±‚

### æ¶æ„è®¾è®¡ï¼ˆæ¨èï¼‰

```
apps/master-data/
â”œâ”€â”€ manifest.json            # APP é…ç½®
â”‚
â”œâ”€â”€ api/                      # API å±‚ï¼ˆFastAPI Routesï¼‰
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ materials.py         # ç‰©æ–™ API
â”‚   â”œâ”€â”€ customers.py         # å®¢æˆ· API
â”‚   â”œâ”€â”€ suppliers.py         # ä¾›åº”å•† API
â”‚   â””â”€â”€ products.py          # äº§å“ API
â”‚
â”œâ”€â”€ services/                 # æœåŠ¡å±‚ï¼ˆBusiness Logicï¼‰
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ material_service.py  # ç‰©æ–™æœåŠ¡
â”‚   â”œâ”€â”€ customer_service.py  # å®¢æˆ·æœåŠ¡
â”‚   â”œâ”€â”€ supplier_service.py  # ä¾›åº”å•†æœåŠ¡
â”‚   â””â”€â”€ product_service.py   # äº§å“æœåŠ¡
â”‚
â”œâ”€â”€ models/                   # æ¨¡å‹å±‚ï¼ˆORM Modelsï¼‰
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ material.py         # ç‰©æ–™æ¨¡å‹
â”‚   â”œâ”€â”€ customer.py         # å®¢æˆ·æ¨¡å‹
â”‚   â”œâ”€â”€ supplier.py         # ä¾›åº”å•†æ¨¡å‹
â”‚   â””â”€â”€ product.py          # äº§å“æ¨¡å‹
â”‚
â”œâ”€â”€ schemas/                  # æ•°æ®éªŒè¯å±‚ï¼ˆPydantic Schemasï¼‰
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ material_schemas.py # ç‰©æ–™ Schema
â”‚   â”œâ”€â”€ customer_schemas.py # å®¢æˆ· Schema
â”‚   â”œâ”€â”€ supplier_schemas.py # ä¾›åº”å•† Schema
â”‚   â””â”€â”€ product_schemas.py  # äº§å“ Schema
â”‚
â””â”€â”€ utils/                     # å·¥å…·å±‚ï¼ˆUtilitiesï¼‰
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ data_validator.py    # æ•°æ®éªŒè¯å·¥å…·
    â”œâ”€â”€ data_standardizer.py # æ•°æ®æ ‡å‡†åŒ–å·¥å…·
    â””â”€â”€ cache_helper.py      # ç¼“å­˜è¾…åŠ©å·¥å…·
```

### ä»£ç ç¤ºä¾‹

#### 1. æ¨¡å‹å±‚ï¼ˆModelï¼‰

```python
# apps/master-data/models/material.py
from tortoise import fields
from core.models.base import BaseModel

class Material(BaseModel):
    """ç‰©æ–™æ¨¡å‹"""
    
    code = fields.CharField(max_length=50, description="ç‰©æ–™ç¼–ç ")
    name = fields.CharField(max_length=200, description="ç‰©æ–™åç§°")
    specification = fields.CharField(max_length=500, null=True, description="è§„æ ¼")
    unit = fields.CharField(max_length=20, description="å•ä½")
    category = fields.CharField(max_length=50, null=True, description="åˆ†ç±»")
    
    class Meta:
        table = "seed_master_data_materials"
        unique_together = [("tenant_id", "code")]
```

#### 2. æœåŠ¡å±‚ï¼ˆServiceï¼‰

```python
# apps/master-data/services/material_service.py
from typing import List, Optional
from apps.master_data.models.material import Material
from apps.master_data.schemas.material_schemas import MaterialCreate, MaterialUpdate
from infra.exceptions.exceptions import NotFoundError, ValidationError
from apps.master_data.utils.data_validator import validate_material_code
from apps.master_data.utils.data_standardizer import standardize_material_name

class MaterialService:
    """ç‰©æ–™æœåŠ¡"""
    
    @staticmethod
    async def create_material(
        tenant_id: int,
        data: MaterialCreate
    ) -> Material:
        """
        åˆ›å»ºç‰©æ–™
        
        Args:
            tenant_id: ç»„ç»‡ID
            data: ç‰©æ–™åˆ›å»ºæ•°æ®
            
        Returns:
            Material: åˆ›å»ºçš„ç‰©æ–™å¯¹è±¡
        """
        # 1. æ•°æ®éªŒè¯
        await validate_material_code(tenant_id, data.code)
        
        # 2. æ•°æ®æ ‡å‡†åŒ–
        standardized_name = standardize_material_name(data.name)
        
        # 3. åˆ›å»ºç‰©æ–™
        material = Material(
            tenant_id=tenant_id,
            code=data.code,
            name=standardized_name,
            specification=data.specification,
            unit=data.unit,
            category=data.category,
        )
        await material.save()
        return material
    
    @staticmethod
    async def get_material_by_code(
        tenant_id: int,
        code: str
    ) -> Optional[Material]:
        """æ ¹æ®ç¼–ç è·å–ç‰©æ–™"""
        return await Material.filter(
            tenant_id=tenant_id,
            code=code,
            deleted_at__isnull=True
        ).first()
    
    @staticmethod
    async def get_materials_by_ids(
        tenant_id: int,
        material_ids: List[str]
    ) -> List[Material]:
        """æ‰¹é‡è·å–ç‰©æ–™ï¼ˆç”¨äºå‡å°‘ç½‘ç»œè°ƒç”¨ï¼‰"""
        return await Material.filter(
            tenant_id=tenant_id,
            uuid__in=material_ids,
            deleted_at__isnull=True
        ).all()
```

#### 3. API å±‚ï¼ˆControllerï¼‰

```python
# apps/master-data/api/materials.py
from fastapi import APIRouter, Depends, HTTPException
from typing import List
from core.api.deps.deps import get_current_tenant, get_current_user
from apps.master_data.services.material_service import MaterialService
from apps.master_data.schemas.material_schemas import (
    MaterialCreate,
    MaterialUpdate,
    MaterialResponse
)

router = APIRouter(prefix="/materials", tags=["ç‰©æ–™ç®¡ç†"])

@router.post("", response_model=MaterialResponse)
async def create_material(
    data: MaterialCreate,
    tenant_id: int = Depends(get_current_tenant),
    current_user = Depends(get_current_user),
):
    """åˆ›å»ºç‰©æ–™"""
    try:
        material = await MaterialService.create_material(tenant_id, data)
        return MaterialResponse.from_orm(material)
    except ValidationError as e:
        raise HTTPException(status_code=400, detail=str(e))

@router.get("/{material_id}", response_model=MaterialResponse)
async def get_material(
    material_id: str,
    tenant_id: int = Depends(get_current_tenant),
):
    """è·å–ç‰©æ–™"""
    material = await MaterialService.get_material_by_uuid(tenant_id, material_id)
    if not material:
        raise HTTPException(status_code=404, detail="ç‰©æ–™ä¸å­˜åœ¨")
    return MaterialResponse.from_orm(material)

@router.post("/batch", response_model=List[MaterialResponse])
async def get_materials_batch(
    material_ids: List[str],
    tenant_id: int = Depends(get_current_tenant),
):
    """æ‰¹é‡è·å–ç‰©æ–™ï¼ˆç”¨äºå‡å°‘ç½‘ç»œè°ƒç”¨ï¼‰"""
    materials = await MaterialService.get_materials_by_ids(tenant_id, material_ids)
    return [MaterialResponse.from_orm(m) for m in materials]
```

---

## ğŸ”„ æœªæ¥æ‰©å±•æ€§è€ƒè™‘

### å¦‚æœæœªæ¥ä¸šåŠ¡é€»è¾‘å˜å¤æ‚

**ç­–ç•¥**ï¼šæ¸è¿›å¼æ¼”è¿›

1. **ç¬¬ä¸€é˜¶æ®µ**ï¼šä½¿ç”¨ä¼ ç»Ÿåˆ†å±‚æ¶æ„
   - å¿«é€Ÿå¼€å‘ï¼Œæ»¡è¶³å½“å‰éœ€æ±‚
   - ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤

2. **ç¬¬äºŒé˜¶æ®µ**ï¼šå¦‚æœä¸šåŠ¡é€»è¾‘å˜å¤æ‚
   - å¼•å…¥é¢†åŸŸæœåŠ¡ï¼ˆDomain Serviceï¼‰
   - å°†å¤æ‚ä¸šåŠ¡é€»è¾‘ä» Service å±‚æå–åˆ° Domain Service

3. **ç¬¬ä¸‰é˜¶æ®µ**ï¼šå¦‚æœä¸šåŠ¡é€»è¾‘éå¸¸å¤æ‚
   - é€æ­¥è¿ç§»åˆ° DDD æ¶æ„
   - å¼•å…¥å®ä½“ï¼ˆEntityï¼‰ã€å€¼å¯¹è±¡ï¼ˆValue Objectï¼‰ç­‰æ¦‚å¿µ

**ç¤ºä¾‹ï¼šæ¸è¿›å¼æ¼”è¿›**

```python
# ç¬¬ä¸€é˜¶æ®µï¼šä¼ ç»Ÿåˆ†å±‚æ¶æ„
class MaterialService:
    async def create_material(self, data):
        # ç®€å•éªŒè¯
        if not data.code:
            raise ValidationError("ç‰©æ–™ç¼–ç ä¸èƒ½ä¸ºç©º")
        # åˆ›å»ºç‰©æ–™
        material = Material(**data.dict())
        await material.save()
        return material

# ç¬¬äºŒé˜¶æ®µï¼šå¼•å…¥é¢†åŸŸæœåŠ¡
class MaterialService:
    def __init__(self, material_domain_service: MaterialDomainService):
        self._domain_service = material_domain_service
    
    async def create_material(self, data):
        # å§”æ‰˜ç»™é¢†åŸŸæœåŠ¡å¤„ç†å¤æ‚ä¸šåŠ¡é€»è¾‘
        await self._domain_service.validate_material_creation(data)
        material = Material(**data.dict())
        await material.save()
        return material

# ç¬¬ä¸‰é˜¶æ®µï¼šå®Œæ•´ DDD æ¶æ„
class MaterialService:
    def __init__(self, material_repository: IMaterialRepository):
        self._repository = material_repository
    
    async def create_material(self, command: CreateMaterialCommand):
        # åˆ›å»ºé¢†åŸŸå®ä½“
        material = Material.create(
            code=command.code,
            name=command.name,
            # ...
        )
        # ä¿å­˜å®ä½“
        saved_material = await self._repository.save(material)
        return MaterialDTO.from_entity(saved_material)
```

---

## ğŸ“Š æ¶æ„é€‰æ‹©å†³ç­–è¡¨

| ç‰¹æ€§ | ä¼ ç»Ÿåˆ†å±‚æ¶æ„ | DDD æ¶æ„ |
|------|------------|---------|
| **ä¸šåŠ¡å¤æ‚åº¦** | âœ… ç®€å•ï¼ˆCRUDï¼‰ | âš ï¸ å¤æ‚ï¼ˆä¸šåŠ¡æµç¨‹ï¼‰ |
| **å¼€å‘æ•ˆç‡** | âœ… é«˜ | âš ï¸ ä¸­ï¼ˆéœ€è¦é¢†åŸŸå»ºæ¨¡ï¼‰ |
| **ä»£ç å¤æ‚åº¦** | âœ… ä½ | âš ï¸ é«˜ |
| **æ€§èƒ½** | âœ… å¥½ï¼ˆæ— é¢å¤–æŠ½è±¡ï¼‰ | âš ï¸ ä¸€èˆ¬ï¼ˆå¤šå±‚æŠ½è±¡ï¼‰ |
| **æ‰©å±•æ€§** | âš ï¸ ä¸€èˆ¬ | âœ… å¥½ï¼ˆæ˜“äºæ‰©å±•ï¼‰ |
| **æµ‹è¯•å‹å¥½** | âœ… æ˜¯ | âœ… æ˜¯ï¼ˆé¢†åŸŸå±‚å¯ç‹¬ç«‹æµ‹è¯•ï¼‰ |
| **ç»´æŠ¤æˆæœ¬** | âœ… ä½ | âš ï¸ ä¸­ï¼ˆéœ€è¦ç†è§£ DDDï¼‰ |
| **é€‚åˆåœºæ™¯** | âœ… æ•°æ®ç®¡ç† | âœ… ä¸šåŠ¡æµç¨‹ |

---

## âœ… æ€»ç»“

### æ¨èæ–¹æ¡ˆï¼šä¼ ç»Ÿåˆ†å±‚æ¶æ„

**ç†ç”±**ï¼š

1. **ä¸šåŠ¡å¤æ‚åº¦åŒ¹é…**ï¼š
   - ä¸»æ•°æ®ç®¡ç†ä¸»è¦æ˜¯ CRUD æ“ä½œ
   - ä¸šåŠ¡é€»è¾‘ç›¸å¯¹ç®€å•
   - ä¸éœ€è¦å¤æ‚çš„é¢†åŸŸæ¨¡å‹

2. **å¼€å‘æ•ˆç‡**ï¼š
   - ä¼ ç»Ÿåˆ†å±‚æ¶æ„å¼€å‘æ•ˆç‡é«˜
   - ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤
   - ä¸éœ€è¦å¤æ‚çš„é¢†åŸŸå»ºæ¨¡

3. **æ€§èƒ½è€ƒè™‘**ï¼š
   - ä¸»æ•°æ®ç®¡ç†éœ€è¦é«˜æ€§èƒ½ï¼ˆè¢«å¤šä¸ªåº”ç”¨é¢‘ç¹è°ƒç”¨ï¼‰
   - ä¼ ç»Ÿåˆ†å±‚æ¶æ„æ€§èƒ½æ›´å¥½

4. **æœªæ¥æ‰©å±•**ï¼š
   - å¦‚æœæœªæ¥ä¸šåŠ¡é€»è¾‘å˜å¤æ‚ï¼Œå¯ä»¥æ¸è¿›å¼æ¼”è¿›
   - å…ˆå¼•å…¥é¢†åŸŸæœåŠ¡ï¼Œå†é€æ­¥è¿ç§»åˆ° DDD

### å…³é”®ç‚¹

- âœ… **ä¸»æ•°æ®ç®¡ç†ä¸éœ€è¦ DDD æ¶æ„**
- âœ… **ä½¿ç”¨ä¼ ç»Ÿåˆ†å±‚æ¶æ„å³å¯**
- âœ… **å¦‚æœæœªæ¥ä¸šåŠ¡é€»è¾‘å˜å¤æ‚ï¼Œå¯ä»¥æ¸è¿›å¼æ¼”è¿›**

---

**æœ€åæ›´æ–°**ï¼š2025-01-11


# 制造业默认数据初始化方案

## 📋 概述

本文档定义制造业系统初始化时所需的基础数据，包括默认部门、职位和角色，确保系统能够正常运行。

**适用场景**：
- 新组织注册后自动初始化
- 系统首次部署时初始化
- 手动执行初始化脚本

---

## 🏭 制造业部门结构

### 部门层级设计

```
公司（根部门）
├── 生产部
│   ├── 生产计划组
│   ├── 生产车间
│   └── 设备维护组
├── 质量部
│   ├── 质量检验组
│   └── 质量保证组
├── 采购部
├── 销售部
│   ├── 国内销售组
│   └── 国际销售组
├── 仓储部
│   ├── 原材料仓库
│   └── 成品仓库
├── 财务部
├── 人事部
├── 研发部
│   ├── 产品研发组
│   └── 工艺研发组
└── 行政部
```

### 默认部门列表

| 部门名称 | 部门代码 | 父部门 | 排序 | 说明 |
|---------|---------|--------|------|------|
| 生产部 | PROD | 根部门 | 10 | 生产制造部门 |
| 生产计划组 | PROD_PLAN | 生产部 | 11 | 生产计划与调度 |
| 生产车间 | PROD_WORKSHOP | 生产部 | 12 | 生产车间 |
| 设备维护组 | PROD_MAINT | 生产部 | 13 | 设备维护保养 |
| 质量部 | QUALITY | 根部门 | 20 | 质量管理部门 |
| 质量检验组 | QUALITY_INSP | 质量部 | 21 | 质量检验 |
| 质量保证组 | QUALITY_ASSUR | 质量部 | 22 | 质量保证 |
| 采购部 | PURCHASE | 根部门 | 30 | 采购部门 |
| 销售部 | SALES | 根部门 | 40 | 销售部门 |
| 国内销售组 | SALES_DOMESTIC | 销售部 | 41 | 国内销售 |
| 国际销售组 | SALES_INTER | 销售部 | 42 | 国际销售 |
| 仓储部 | WAREHOUSE | 根部门 | 50 | 仓储部门 |
| 原材料仓库 | WAREHOUSE_RAW | 仓储部 | 51 | 原材料仓库 |
| 成品仓库 | WAREHOUSE_FIN | 仓储部 | 52 | 成品仓库 |
| 财务部 | FINANCE | 根部门 | 60 | 财务部门 |
| 人事部 | HR | 根部门 | 70 | 人事部门 |
| 研发部 | R&D | 根部门 | 80 | 研发部门 |
| 产品研发组 | R&D_PRODUCT | 研发部 | 81 | 产品研发 |
| 工艺研发组 | R&D_PROCESS | 研发部 | 82 | 工艺研发 |
| 行政部 | ADMIN | 根部门 | 90 | 行政部门 |

---

## 👔 默认职位列表

### 按部门分类的职位

| 职位名称 | 职位代码 | 所属部门 | 排序 | 说明 |
|---------|---------|---------|------|------|
| **生产部** | | | | |
| 生产经理 | PROD_MGR | 生产部 | 10 | 生产部门负责人 |
| 生产计划员 | PROD_PLANNER | 生产计划组 | 11 | 生产计划制定 |
| 车间主任 | WORKSHOP_DIR | 生产车间 | 12 | 车间管理 |
| 生产班长 | PROD_LEADER | 生产车间 | 13 | 班组管理 |
| 操作工 | OPERATOR | 生产车间 | 14 | 生产操作 |
| 设备工程师 | EQUIP_ENG | 设备维护组 | 15 | 设备维护 |
| 设备维修工 | EQUIP_REPAIR | 设备维护组 | 16 | 设备维修 |
| **质量部** | | | | |
| 质量经理 | QUALITY_MGR | 质量部 | 20 | 质量部门负责人 |
| 质量工程师 | QUALITY_ENG | 质量检验组 | 21 | 质量工程 |
| 质检员 | QC_INSPECTOR | 质量检验组 | 22 | 质量检验 |
| 质量体系专员 | QMS_SPEC | 质量保证组 | 23 | 质量体系管理 |
| **采购部** | | | | |
| 采购经理 | PURCHASE_MGR | 采购部 | 30 | 采购部门负责人 |
| 采购专员 | PURCHASE_SPEC | 采购部 | 31 | 采购执行 |
| **销售部** | | | | |
| 销售经理 | SALES_MGR | 销售部 | 40 | 销售部门负责人 |
| 销售代表 | SALES_REP | 国内销售组 | 41 | 销售代表 |
| 外贸专员 | EXPORT_SPEC | 国际销售组 | 42 | 外贸业务 |
| **仓储部** | | | | |
| 仓储经理 | WAREHOUSE_MGR | 仓储部 | 50 | 仓储部门负责人 |
| 仓库管理员 | WAREHOUSE_KEEPER | 原材料仓库 | 51 | 仓库管理 |
| 仓管员 | STOCK_KEEPER | 成品仓库 | 52 | 库存管理 |
| **财务部** | | | | |
| 财务经理 | FINANCE_MGR | 财务部 | 60 | 财务部门负责人 |
| 会计 | ACCOUNTANT | 财务部 | 61 | 会计核算 |
| 出纳 | CASHIER | 财务部 | 62 | 出纳管理 |
| **人事部** | | | | |
| 人事经理 | HR_MGR | 人事部 | 70 | 人事部门负责人 |
| 人事专员 | HR_SPEC | 人事部 | 71 | 人事管理 |
| **研发部** | | | | |
| 研发经理 | R&D_MGR | 研发部 | 80 | 研发部门负责人 |
| 产品工程师 | PRODUCT_ENG | 产品研发组 | 81 | 产品设计 |
| 工艺工程师 | PROCESS_ENG | 工艺研发组 | 82 | 工艺设计 |
| **行政部** | | | | |
| 行政经理 | ADMIN_MGR | 行政部 | 90 | 行政部门负责人 |
| 行政专员 | ADMIN_SPEC | 行政部 | 91 | 行政管理 |
| **通用职位** | | | | |
| 总经理 | GM | 根部门 | 1 | 公司总经理 |
| 副总经理 | DGM | 根部门 | 2 | 公司副总经理 |
| 部门经理 | DEPT_MGR | 根部门 | 3 | 通用部门经理 |
| 部门副经理 | DEPT_DMGR | 根部门 | 4 | 通用部门副经理 |

---

## 👤 默认角色列表

### 系统级角色（is_system=true）

| 角色名称 | 角色代码 | 是否系统角色 | 说明 |
|---------|---------|-------------|------|
| 系统管理员 | SYSTEM_ADMIN | ✅ | 系统最高权限，可管理所有功能 |
| 组织管理员 | TENANT_ADMIN | ✅ | 组织管理员，可管理组织内所有数据 |
| 部门管理员 | DEPT_ADMIN | ✅ | 部门管理员，可管理本部门数据 |

### 业务角色（is_system=false）

| 角色名称 | 角色代码 | 说明 |
|---------|---------|------|
| 总经理 | GM | 公司总经理角色 |
| 副总经理 | DGM | 公司副总经理角色 |
| 部门经理 | DEPT_MGR | 部门经理角色 |
| 部门副经理 | DEPT_DMGR | 部门副经理角色 |
| 生产经理 | PROD_MGR | 生产部门经理 |
| 质量经理 | QUALITY_MGR | 质量部门经理 |
| 采购经理 | PURCHASE_MGR | 采购部门经理 |
| 销售经理 | SALES_MGR | 销售部门经理 |
| 仓储经理 | WAREHOUSE_MGR | 仓储部门经理 |
| 财务经理 | FINANCE_MGR | 财务部门经理 |
| 人事经理 | HR_MGR | 人事部门经理 |
| 研发经理 | R&D_MGR | 研发部门经理 |
| 行政经理 | ADMIN_MGR | 行政部门经理 |
| 普通员工 | EMPLOYEE | 普通员工角色 |

---

## 🔐 默认权限列表（基础权限）

### 系统管理权限

| 权限代码 | 资源 | 操作 | 说明 |
|---------|------|------|------|
| `system:admin` | system | admin | 系统管理权限 |
| `user:create` | user | create | 创建用户 |
| `user:read` | user | read | 查看用户 |
| `user:update` | user | update | 更新用户 |
| `user:delete` | user | delete | 删除用户 |
| `user:list` | user | list | 用户列表 |
| `user:export` | user | export | 导出用户 |
| `role:create` | role | create | 创建角色 |
| `role:read` | role | read | 查看角色 |
| `role:update` | role | update | 更新角色 |
| `role:delete` | role | delete | 删除角色 |
| `role:list` | role | list | 角色列表 |
| `department:create` | department | create | 创建部门 |
| `department:read` | department | read | 查看部门 |
| `department:update` | department | update | 更新部门 |
| `department:delete` | department | delete | 删除部门 |
| `department:list` | department | list | 部门列表 |
| `position:create` | position | create | 创建职位 |
| `position:read` | position | read | 查看职位 |
| `position:update` | position | update | 更新职位 |
| `position:delete` | position | delete | 删除职位 |
| `position:list` | position | list | 职位列表 |

### 角色权限分配建议

**系统管理员（SYSTEM_ADMIN）**：
- 所有权限（`*:*`）

**组织管理员（TENANT_ADMIN）**：
- 用户管理：`user:*`
- 角色管理：`role:*`
- 部门管理：`department:*`
- 职位管理：`position:*`

**部门管理员（DEPT_ADMIN）**：
- 用户管理（本部门）：`user:read`, `user:list`
- 部门管理（本部门）：`department:read`, `department:list`

**普通员工（EMPLOYEE）**：
- 基础查看权限：`user:read`（自己）, `department:read`, `position:read`

---

## 📝 初始化脚本设计

### 脚本功能

1. **检查是否已初始化**
   - 如果已存在默认数据，跳过初始化
   - 支持强制重新初始化（可选）

2. **创建默认部门**
   - 按层级顺序创建部门
   - 自动生成 UUID
   - 设置排序顺序

3. **创建默认职位**
   - 关联到对应部门
   - 自动生成 UUID
   - 设置排序顺序

4. **创建默认角色**
   - 创建系统角色和业务角色
   - 自动生成 UUID
   - 标记系统角色

5. **创建默认权限**
   - 创建基础权限
   - 自动生成 UUID

6. **分配角色权限**
   - 为系统管理员分配所有权限
   - 为其他角色分配相应权限

### 脚本位置

```
riveredge-backend/scripts/init_manufacturing_default_data.py
```

---

## ⚠️ 注意事项

### 1. 多租户隔离
- ✅ 所有数据必须关联 `tenant_id`
- ✅ 每个组织独立初始化
- ✅ 不同组织的默认数据相互隔离

### 2. 数据唯一性
- ✅ 部门代码：`tenant_id + code` 唯一
- ✅ 职位代码：`tenant_id + code` 唯一
- ✅ 角色代码：`tenant_id + code` 唯一
- ✅ 权限代码：`tenant_id + code` 唯一

### 3. 系统角色保护
- ✅ 系统角色（`is_system=true`）不可删除
- ✅ 系统角色不可修改代码和名称
- ✅ 系统角色权限分配需要特殊权限

### 4. 初始化时机
- ✅ 新组织注册后自动初始化
- ✅ 系统首次部署时初始化
- ✅ 支持手动执行初始化脚本

### 5. 数据更新
- ✅ 默认数据可以修改（除系统角色外）
- ✅ 支持添加新的部门、职位、角色
- ✅ 删除默认数据需要谨慎（检查关联）

---

## 📚 相关文档

- [1.角色权限管理最佳实践.md](./1.角色权限管理最佳实践.md)
- [2.部门管理最佳实践.md](./2.部门管理最佳实践.md)
- [3.职位管理最佳实践.md](./3.职位管理最佳实践.md)
- [4.账户管理最佳实践.md](./4.账户管理最佳实践.md)

---

**最后更新**：2025-01-XX


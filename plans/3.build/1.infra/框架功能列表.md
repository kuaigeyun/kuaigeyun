# RiverEdge SaaS 多组织框架 - 功能列表

## 📋 概述

本文档基于 [2.架构设计文档.md](./2.架构设计文档.md) 的架构设计，列出 **RiverEdge SaaS 多组织框架 (RiverEdge SaaS Multi-tenant Framework)** 的完整功能列表。

**功能分类**：
- 🔧 **核心代码**：框架必须内置的基础功能，所有业务模块都依赖
- 🔌 **可热插拔功能**：通过插件机制实现，支持动态加载/卸载

## 🔧 核心代码功能（riveredge-core + riveredge-shell）

### 1. 多组织系统 ⭐⭐⭐⭐⭐

**功能说明**：SaaS 多组织数据隔离和管理

**核心组件**：
- 组织模型（Tenant）
- 组织上下文管理（TenantContext）
- 数据隔离机制（应用层 + PostgreSQL RLS）
- 组织注册和管理 API
- 组织配置管理

**实现位置**：
- 后端：`riveredge-core/core/tenant/`
- 前端：`riveredge-shell/src/pages/tenant/`

**技术实现**：
- Tortoise ORM 模型（包含 tenant_id）
- PostgreSQL RLS 行级安全策略
- ContextVar 组织上下文管理
- FastAPI 依赖注入

**MES 应用场景**：
- 不同客户（组织）的生产数据完全隔离
- 每个组织独立管理自己的工厂、产线、设备
- 组织级别的数据统计和报表

---

### 2. 用户认证与授权 ⭐⭐⭐⭐⭐

**功能说明**：用户登录、JWT 认证、权限管理

**核心组件**：
- 用户模型（User，包含 tenant_id）
- 角色模型（Role，包含 tenant_id）
- 权限模型（Permission，包含 tenant_id）
- JWT Token 生成和验证（包含 tenant_id）
- 权限验证中间件（自动组织过滤）
- 用户注册/登录 API
- 角色权限管理 API

**实现位置**：
- 后端：`riveredge-core/core/auth/`、`riveredge-core/api/v1/auth.py`
- 前端：`riveredge-shell/src/pages/user/`、`riveredge-shell/src/pages/role/`

**技术实现**：
- JWT (python-jose)
- passlib[bcrypt] 密码加密
- FastAPI 依赖注入
- Zustand 状态管理

**MES 应用场景**：
- 操作员登录系统
- 不同角色权限（生产管理员、质量检验员、设备维护员等）
- 操作日志记录（谁在什么时间做了什么操作）

---

### 3. 查询增强组件 ⭐⭐⭐⭐⭐

**功能说明**：统一的查询构建器，支持复杂查询场景

**核心组件**：
- QueryBuilder（查询构建器）
- 查询参数装饰器
- 分页、排序、筛选、模糊查询
- 日期范围查询
- 多条件组合查询
- 自动组织过滤

**实现位置**：
- 后端：`riveredge-core/core/query/`

**技术实现**：
- Tortoise ORM 查询构建
- FastAPI Query 参数
- Pydantic 参数验证

**MES 应用场景**：
- 工单列表查询（按状态、日期范围、产品等筛选）
- 生产数据查询（按产线、班次、时间范围等）
- 质量数据查询（按检验项目、合格率等）
- 设备数据查询（按设备类型、状态等）

**参考其他框架**：PlusQuery 聚合查询优化

---

### 4. 统一响应封装 ⭐⭐⭐⭐⭐

**功能说明**：所有 API 返回统一的响应格式

**核心组件**：
- ResponseModel（统一响应模型，泛型支持）
- SuccessResponse（成功响应）
- ErrorResponse（错误响应）
- 响应装饰器
- 异常处理中间件
- 分页响应封装

**实现位置**：
- 后端：`riveredge-core/core/response/`

**技术实现**：
- Pydantic BaseModel（泛型）
- FastAPI 异常处理
- 统一错误码定义

**MES 应用场景**：
- 所有 API 返回格式统一，前端处理简单
- 错误信息统一格式，便于错误处理
- 支持分页响应、列表响应等标准格式

**参考其他框架**：统一响应封装

---

### 5. 代码生成器 ⭐⭐⭐⭐⭐

**功能说明**：根据数据库表自动生成前后端代码

**核心组件**：
- 数据库表导入（PostgreSQL）
- 字段配置管理
- 代码模板（Jinja2）
  - Model 生成器
  - Schema 生成器
  - API 生成器
  - Service 生成器
  - 前端 List 页面生成器
  - 前端 Form 页面生成器
- 单表 CRUD 生成
- 主子表生成
- 树形表生成

**实现位置**：
- 后端：`riveredge-core/tools/generator/`

**技术实现**：
- Jinja2 模板引擎
- PostgreSQL 元数据查询
- 代码文件生成

**MES 应用场景**：
- 快速生成工单管理模块（工单主表 + 工单明细表）
- 快速生成生产计划模块
- 快速生成质量检验模块
- 大幅提升开发效率

**参考其他框架**：前后端代码生成器

---

### 6. 主子表模型支持 ⭐⭐⭐⭐

**功能说明**：支持一对多关系的主子表模型

**核心组件**：
- 主子表关系定义（Tortoise ORM ForeignKey）
- 主子表嵌套 Schema（Pydantic）
- 主子表 API 支持（事务处理）
- 主子表前端组件支持（ProTable expandable、ProFormList）

**实现位置**：
- 后端：`riveredge-core/core/master_detail/`
- 前端：ProTable、ProForm（已内置）

**技术实现**：
- Tortoise ORM ForeignKey 关系
- Pydantic 嵌套模型
- FastAPI 事务处理
- ProTable expandable
- ProFormList

**MES 应用场景**：
- 生产工单（主表）+ 工单明细（子表）
- 生产计划（主表）+ 计划任务（子表）
- 质量检验单（主表）+ 检验项目（子表）
- 设备维护单（主表）+ 维护项目（子表）

**参考其他框架**：主子表代码生成

**详细分析**：请参考 [主子表模型支持分析.md](../4.branch/主子表模型支持分析.md)

---

### 7. 操作日志 ⭐⭐⭐⭐

**功能说明**：记录所有用户操作，支持审计和追溯

**核心组件**：
- 操作日志模型（OperationLog，包含 tenant_id）
- 日志记录中间件（自动记录）
- 日志查询 API（自动组织过滤）
- 日志导出功能
- 日志统计功能

**实现位置**：
- 后端：`riveredge-core/core/log/`
- 前端：`riveredge-shell/src/pages/system/logs/`

**技术实现**：
- FastAPI 中间件
- Tortoise ORM 模型
- ProTable 列表展示

**MES 应用场景**：
- 记录生产数据修改（谁修改了什么数据）
- 记录质量检验操作（谁检验了什么产品）
- 记录设备操作（谁操作了什么设备）
- 支持质量追溯和问题排查

**参考其他框架**：操作日志

---

### 8. 文件上传与管理 ⭐⭐⭐⭐

**功能说明**：统一的文件上传、存储、管理功能

**核心组件**：
- 文件上传 API
- 文件存储接口（抽象接口，核心定义）
- 本地存储实现（默认实现）
- 文件管理 API（列表、删除、下载）
- 文件类型验证
- 文件大小限制

**实现位置**：
- 后端：`riveredge-core/core/file/`
- 前端：`riveredge-shell/src/components/FileUpload/`

**技术实现**：
- FastAPI File 上传
- 文件存储接口（抽象）
- 本地文件系统存储（默认）

**MES 应用场景**：
- 工艺文件上传（工艺图纸、作业指导书）
- 质量报告上传（检验报告、不合格品报告）
- 设备文档上传（设备说明书、维护手册）
- 图片上传（产品图片、设备照片）

**注意**：对象存储实现（OSS、COS、S3 等）通过热插拔插件实现

---

### 9. 数据字典 ⭐⭐⭐⭐

**功能说明**：系统级数据字典，统一管理枚举值

**核心组件**：
- 数据字典模型（Dict、DictItem，包含 tenant_id）
- 数据字典管理 API（自动组织过滤）
- 数据字典缓存（Redis）
- 前端字典组件（Select、Radio 等）
- 字典数据同步

**实现位置**：
- 后端：`riveredge-core/core/dict/`
- 前端：`riveredge-shell/src/components/DictSelect/`

**技术实现**：
- Tortoise ORM 模型
- Redis 缓存
- 前端组件封装

**MES 应用场景**：
- 工单状态字典（待生产、生产中、已完成、已取消）
- 设备状态字典（运行中、停机、故障、维护中）
- 质量等级字典（合格、不合格、待判定）
- 产品类型字典、工艺类型字典等

**参考其他框架**：数据字典

---

### 10. 系统配置管理 ⭐⭐⭐

**功能说明**：系统级配置管理，支持动态配置

**核心组件**：
- 系统配置模型（SystemConfig，包含 tenant_id）
- 配置管理 API（自动组织过滤）
- 配置缓存（Redis）
- 配置热更新
- 配置分组管理

**实现位置**：
- 后端：`riveredge-core/core/config/`
- 前端：`riveredge-shell/src/pages/system/config/`

**技术实现**：
- PostgreSQL JSONB 存储
- Redis 缓存
- Pydantic 配置验证

**MES 应用场景**：
- 系统参数配置（默认班次、默认产线等）
- 业务规则配置（质量判定规则、生产规则等）
- 界面配置（看板配置、报表配置等）

---

### 11. 消息通知 ⭐⭐⭐

**功能说明**：系统内消息通知功能

**核心组件**：
- 消息模型（Message，包含 tenant_id）
- 消息发送 API
- 消息查询 API（自动组织过滤）
- 消息已读/未读状态
- 消息分类管理

**实现位置**：
- 后端：`riveredge-core/core/message/`
- 前端：`riveredge-shell/src/pages/message/`

**技术实现**：
- Tortoise ORM 模型
- WebSocket 实时推送（可选）
- 消息通知组件

**MES 应用场景**：
- 工单完成通知
- 质量异常通知
- 设备故障通知
- 生产计划变更通知

**注意**：外部消息推送（短信、邮件、微信等）通过热插拔插件实现

---

### 12. 表单自定义字段 ⭐⭐⭐

**功能说明**：支持动态配置表单字段

**核心组件**：
- 表单模板模型（FormTemplate，包含 tenant_id）
- 表单数据模型（FormData，包含 tenant_id）
- 表单设计器 API
- React Hook Form 集成（前端）
- 表单验证规则

**实现位置**：
- 后端：`riveredge-core/core/form/`
- 前端：`riveredge-shell/src/components/FormDesigner/`

**技术实现**：
- PostgreSQL JSONB 存储
- React Hook Form + 自定义组件
- Pydantic 动态模型验证

**MES 应用场景**：
- 不同产品类型需要不同的检验字段
- 不同设备类型需要不同的维护字段
- 不同工艺路线需要不同的参数字段
- 支持客户自定义字段需求

**详细方案**：请参考 [表单自定义字段方案.md](../4.branch/表单自定义字段方案.md)

---

### 13. 打印模板设计 ⭐⭐⭐

**功能说明**：打印模板管理和设计

**核心组件**：
- 打印模板模型（PrintTemplate，包含 tenant_id）
- 模板管理 API（自动组织过滤）
- react-to-print 集成（前端）
- PDF 生成支持（jspdf + html2canvas）
- 模板预览功能

**实现位置**：
- 后端：`riveredge-core/core/print/`
- 前端：`riveredge-shell/src/components/PrintTemplate/`

**技术实现**：
- PostgreSQL JSONB 存储
- react-to-print（主要方案）
- jspdf + html2canvas（PDF 生成补充方案）

**MES 应用场景**：
- 生产工单打印
- 质量检验报告打印
- 设备标签打印
- 入库单/出库单打印

**详细方案**：请参考 [打印模板设计方案.md](../4.branch/打印模板设计方案.md)

---

### 14. 国际化支持 ⭐⭐

**功能说明**：多语言支持

**核心组件**：
- 国际化配置（React i18next 14.1.3）
- 语言包管理（中文、英文等）
- 语言切换功能
- 日期时间本地化
- 数字格式化本地化

**实现位置**：
- 前端：`riveredge-shell/src/locales/`

**技术实现**：
- React i18next 14.1.3
- dayjs 本地化
- 语言包 JSON 文件

**MES 应用场景**：
- 支持多国语言（中文、英文等）
- 国际化客户需求

**参考其他框架**：国际化增强支持

---

### 15. 主题定制 ⭐⭐

**功能说明**：系统主题和样式定制

**核心组件**：
- 主题配置
- 暗色模式支持
- 主题切换功能
- 主题持久化

**实现位置**：
- 前端：`riveredge-shell/src/themes/`

**技术实现**：
- Ant Design 主题配置
- CSS Variables
- LocalStorage 持久化

**MES 应用场景**：
- 客户品牌定制
- 不同使用场景的主题切换

---

### 16. 插件系统 ⭐⭐⭐⭐⭐

**功能说明**：插件加载、注册、管理

**核心组件**：
- 插件模型（Plugin，包含 tenant_id）
- 插件加载器（后端 + 前端）
- 插件注册机制
- 插件管理 API
- 插件管理界面
- 插件依赖管理
- 插件版本管理

**实现位置**：
- 后端：`riveredge-core/core/plugin/`、`riveredge-core/utils/plugin_loader.py`
- 前端：`riveredge-shell/src/utils/plugin_loader.ts`、`riveredge-shell/src/pages/plugin/`

**技术实现**：
- Python importlib 动态导入
- ES Modules 动态 import
- manifest.json 插件清单
- FastAPI Router 动态注册
- React Router 动态路由注册

**详细规范**：请参考 [插件开发规范.md](../4.branch/插件开发规范.md)

---

### 17. 超管管理面板 ⭐⭐⭐⭐⭐

**功能说明**：超级管理员管理面板，用于监控组织运营情况、审核组织注册、管理系统配置

**核心组件**：
- 超管用户模型（SuperAdmin，独立于组织系统）
- 组织注册审核流程（待审核、已通过、已拒绝）
- 组织运营监控（组织数量、活跃度、资源使用情况）
- 组织数据统计（用户数、订单数、数据量等）
- 组织管理 API（审核、启用/禁用、删除）
- 系统级配置管理（全局配置、系统参数）
- 超管管理界面（组织列表、审核、监控看板）

**实现位置**：
- 后端：`riveredge-core/core/superadmin/`、`riveredge-core/api/v1/superadmin/`
- 前端：`riveredge-shell/src/pages/superadmin/`

**技术实现**：
- 独立的超管认证系统（JWT，不包含 tenant_id）
- 组织注册审核状态管理
- 组织数据聚合查询（PostgreSQL 聚合函数）
- 实时监控数据（Redis 缓存 + 定时任务）
- ProTable 组织列表展示
- 数据可视化看板（@ant-design/charts）

**核心功能**：
- **组织注册管理**：
  - 组织注册申请（允许公开注册或邀请注册）
  - 超管审核组织注册（通过/拒绝）
  - 组织注册审核历史记录
- **组织运营监控**：
  - 组织数量统计（总数、活跃数、停用数）
  - 组织活跃度监控（日活、月活、访问量）
  - 组织资源使用监控（存储空间、API 调用次数、数据量）
  - 组织数据统计（用户数、订单数、业务数据量）
- **组织管理**：
  - 组织列表查询（支持筛选、排序、分页）
  - 组织详情查看
  - 组织启用/禁用
  - 组织删除（软删除，保留历史数据）
  - 组织配置管理（配额、权限、功能开关）
- **系统监控**：
  - 系统整体运行状态
  - 系统资源使用情况
  - 系统性能指标
  - 异常告警

**MES 应用场景**：
- SaaS 平台运营管理
- 组织注册审核（新客户入驻审核）
- 组织运营数据监控（了解各组织使用情况）
- 系统资源分配（根据组织规模分配资源）
- 异常组织处理（停用违规组织）

**与多组织系统的关系**：
- 超管系统独立于组织系统，不包含 tenant_id
- 超管可以跨组织查看和管理数据
- 组织注册后，自动创建组织管理员账户
- 组织管理员只能管理自己组织内的数据

**参考其他框架**：SaaS 平台管理后台

---

## 🔌 可热插拔功能（插件实现）

### 1. 支付功能 🔌

**功能说明**：支付接口和实现

**接口定义**：`riveredge-core/core/interfaces/payment.py`

**插件实现**：
- `seed-payment-alipay` - 支付宝支付
- `seed-payment-wechat` - 微信支付
- `seed-payment-unionpay` - 银联支付

**MES 应用场景**：
- SaaS 订阅付费
- 增值服务付费
- 订单支付（如果 MES 系统包含订单功能）

**详细方案**：请参考 [功能热插拔实现方案.md](../4.branch/功能热插拔实现方案.md)

---

### 2. 短信服务 🔌

**功能说明**：短信发送服务

**接口定义**：`riveredge-core/core/interfaces/sms.py`

**插件实现**：
- `seed-sms-aliyun` - 阿里云短信
- `seed-sms-tencent` - 腾讯云短信
- `seed-sms-huawei` - 华为云短信

**MES 应用场景**：
- 设备故障告警短信
- 质量异常通知短信
- 生产计划变更通知短信
- 系统登录验证码

**详细方案**：请参考 [功能热插拔实现方案.md](../4.branch/功能热插拔实现方案.md)

---

### 3. 邮件服务 🔌

**功能说明**：邮件发送服务

**接口定义**：`riveredge-core/core/interfaces/email.py`

**插件实现**：
- `seed-email-smtp` - SMTP 邮件
- `seed-email-sendgrid` - SendGrid 邮件
- `seed-email-aliyun` - 阿里云邮件

**MES 应用场景**：
- 日报/周报/月报邮件发送
- 质量异常报告邮件
- 生产数据统计邮件
- 系统通知邮件

**详细方案**：请参考 [功能热插拔实现方案.md](../4.branch/功能热插拔实现方案.md)

---

### 4. 对象存储服务 🔌

**功能说明**：文件对象存储服务

**接口定义**：`riveredge-core/core/interfaces/storage.py`

**插件实现**：
- `seed-storage-oss` - 阿里云 OSS
- `seed-storage-cos` - 腾讯云 COS
- `seed-storage-s3` - AWS S3
- `seed-storage-local` - 本地存储（默认，核心代码已实现）

**MES 应用场景**：
- 工艺文件存储
- 质量报告存储
- 设备文档存储
- 产品图片存储

**注意**：本地存储已在核心代码中实现，其他存储通过插件实现

---

### 5. 消息推送服务 🔌

**功能说明**：移动端消息推送

**接口定义**：`riveredge-core/core/interfaces/push.py`

**插件实现**：
- `seed-push-jiguang` - 极光推送
- `seed-push-getui` - 个推
- `seed-push-firebase` - Firebase 推送

**MES 应用场景**：
- 移动端设备故障推送
- 移动端质量异常推送
- 移动端生产任务推送

---

### 6. 微信集成 🔌

**功能说明**：微信公众号/小程序集成

**接口定义**：`riveredge-core/core/interfaces/wechat.py`

**插件实现**：
- `seed-wechat-official` - 微信公众号
- `seed-wechat-miniprogram` - 微信小程序

**MES 应用场景**：
- 微信公众号消息推送
- 微信小程序移动端应用
- 微信扫码登录

---

### 7. 数据可视化增强 🔌

**功能说明**：高级数据可视化功能

**接口定义**：`riveredge-core/core/interfaces/visualization.py`

**插件实现**：
- `seed-chart-g6` - G6 图关系可视化
- `seed-chart-x6` - X6 图编辑引擎
- `seed-chart-gantt` - 甘特图（生产排程）

**MES 应用场景**：
- 工艺流程图可视化（G6）
- 生产流程图编辑器（X6）
- 生产排程甘特图
- 设备关系图

**注意**：基础图表（@ant-design/charts）已内置在核心代码中

---

### 8. 报表引擎 🔌

**功能说明**：高级报表生成功能

**接口定义**：`riveredge-core/core/interfaces/report.py`

**插件实现**：
- `seed-report-jasper` - JasperReports
- `seed-report-fine` - 帆软报表
- `seed-report-custom` - 自定义报表引擎

**MES 应用场景**：
- 生产报表生成
- 质量报表生成
- 设备报表生成
- 自定义报表设计

---

### 9. 工作流引擎 🔌

**功能说明**：工作流引擎集成

**接口定义**：`riveredge-core/core/interfaces/workflow.py`

**插件实现**：
- `seed-workflow-activiti` - Activiti 工作流
- `seed-workflow-flowable` - Flowable 工作流
- `seed-workflow-custom` - 自定义工作流

**MES 应用场景**：
- 工单审批流程
- 质量异常处理流程
- 设备维护审批流程
- 生产计划审批流程

---

### 10. 条码/二维码生成 🔌

**功能说明**：条码和二维码生成

**接口定义**：`riveredge-core/core/interfaces/barcode.py`

**插件实现**：
- `seed-barcode-zxing` - ZXing 条码库
- `seed-barcode-qrcode` - 二维码生成

**MES 应用场景**：
- 产品条码生成
- 工单二维码生成
- 设备二维码标签
- 物料二维码管理

---

### 11. 数据导入导出 🔌

**功能说明**：Excel 数据导入导出增强

**接口定义**：`riveredge-core/core/interfaces/excel.py`

**插件实现**：
- `seed-excel-openpyxl` - OpenPyXL（Python）
- `seed-excel-pandas` - Pandas Excel 支持
- `seed-excel-custom` - 自定义导入导出

**MES 应用场景**：
- 生产数据批量导入
- 质量数据批量导入
- 生产报表导出
- 质量报表导出

**注意**：基础导入导出功能建议内置在核心代码中

---

### 12. 定时任务 🔌

**功能说明**：定时任务调度

**接口定义**：`riveredge-core/core/interfaces/scheduler.py`

**插件实现**：
- `seed-scheduler-cron` - Cron 表达式调度
- `seed-scheduler-apscheduler` - APScheduler 调度器
- `seed-scheduler-celery` - Celery 异步任务

**MES 应用场景**：
- 每日生产数据统计
- 每周质量报表生成
- 每月设备维护提醒
- 定时数据同步

---

### 13. 数据同步 🔌

**功能说明**：与外部系统数据同步

**接口定义**：`riveredge-core/core/interfaces/sync.py`

**插件实现**：
- `seed-sync-erp` - ERP 系统同步
- `seed-sync-plm` - PLM 系统同步
- `seed-sync-wms` - WMS 系统同步
- `seed-sync-custom` - 自定义系统同步

**MES 应用场景**：
- 与 ERP 系统同步订单数据
- 与 PLM 系统同步产品数据
- 与 WMS 系统同步库存数据

---

### 14. 设备数据采集 🔌

**功能说明**：设备数据采集和监控

**接口定义**：`riveredge-core/core/interfaces/equipment.py`

**插件实现**：
- `seed-equipment-opcua` - OPC UA 协议
- `seed-equipment-modbus` - Modbus 协议
- `seed-equipment-mqtt` - MQTT 协议
- `seed-equipment-custom` - 自定义协议

**MES 应用场景**：
- 设备实时数据采集
- 设备状态监控
- 设备告警处理
- 设备数据分析

**MES 重要性**：极高（MES 核心功能）

---

### 15. 数据分析 🔌

**功能说明**：高级数据分析功能

**接口定义**：`riveredge-core/core/interfaces/analytics.py`

**插件实现**：
- `seed-analytics-pandas` - Pandas 数据分析
- `seed-analytics-numpy` - NumPy 数值计算
- `seed-analytics-ml` - 机器学习分析

**MES 应用场景**：
- 生产数据分析
- 质量数据分析
- 设备数据分析
- 预测性维护

---

## 📊 功能分类总结表

### 核心代码功能（17 项）

| 序号 | 功能 | 优先级 | MES 重要性 | 实现位置 | 状态 |
|------|------|--------|-----------|----------|------|
| 1 | 多组织系统 | ⭐⭐⭐⭐⭐ | 极高 | `core/tenant/` | 规划中 |
| 2 | 用户认证与授权 | ⭐⭐⭐⭐⭐ | 极高 | `core/auth/` | 规划中 |
| 3 | 查询增强组件 | ⭐⭐⭐⭐⭐ | 极高 | `core/query/` | 规划中 |
| 4 | 统一响应封装 | ⭐⭐⭐⭐⭐ | 极高 | `core/response/` | 规划中 |
| 5 | 代码生成器 | ⭐⭐⭐⭐⭐ | 极高 | `tools/generator/` | 规划中 |
| 6 | 主子表模型支持 | ⭐⭐⭐⭐ | 高 | `core/master_detail/` | 规划中 |
| 7 | 操作日志 | ⭐⭐⭐⭐ | 高 | `core/log/` | 规划中 |
| 8 | 文件上传与管理 | ⭐⭐⭐⭐ | 高 | `core/file/` | 规划中 |
| 9 | 数据字典 | ⭐⭐⭐⭐ | 高 | `core/dict/` | 规划中 |
| 10 | 系统配置管理 | ⭐⭐⭐ | 中 | `core/config/` | 规划中 |
| 11 | 消息通知 | ⭐⭐⭐ | 中 | `core/message/` | 规划中 |
| 12 | 表单自定义字段 | ⭐⭐⭐ | 中 | `core/form/` | 规划中 |
| 13 | 打印模板设计 | ⭐⭐⭐ | 中 | `core/print/` | 规划中 |
| 14 | 国际化支持 | ⭐⭐ | 低 | `shell/locales/` | 规划中 |
| 15 | 主题定制 | ⭐⭐ | 低 | `shell/themes/` | 规划中 |
| 16 | 插件系统 | ⭐⭐⭐⭐⭐ | 极高 | `core/plugin/` | 规划中 |
| 17 | 超管管理面板 | ⭐⭐⭐⭐⭐ | 极高 | `core/superadmin/` | 规划中 |

### 可热插拔功能（15 项）

| 序号 | 功能 | MES 重要性 | 接口定义 | 插件示例 | 状态 |
|------|------|-----------|----------|----------|------|
| 1 | 支付功能 | 低 | `interfaces/payment.py` | `seed-payment-*` | 规划中 |
| 2 | 短信服务 | 中 | `interfaces/sms.py` | `seed-sms-*` | 规划中 |
| 3 | 邮件服务 | 中 | `interfaces/email.py` | `seed-email-*` | 规划中 |
| 4 | 对象存储服务 | 高 | `interfaces/storage.py` | `seed-storage-*` | 规划中 |
| 5 | 消息推送服务 | 中 | `interfaces/push.py` | `seed-push-*` | 规划中 |
| 6 | 微信集成 | 低 | `interfaces/wechat.py` | `seed-wechat-*` | 规划中 |
| 7 | 数据可视化增强 | 高 | `interfaces/visualization.py` | `seed-chart-*` | 规划中 |
| 8 | 报表引擎 | 高 | `interfaces/report.py` | `seed-report-*` | 规划中 |
| 9 | 工作流引擎 | 中 | `interfaces/workflow.py` | `seed-workflow-*` | 规划中 |
| 10 | 条码/二维码生成 | 高 | `interfaces/barcode.py` | `seed-barcode-*` | 规划中 |
| 11 | 数据导入导出 | 高 | `interfaces/excel.py` | `seed-excel-*` | 规划中 |
| 12 | 定时任务 | 中 | `interfaces/scheduler.py` | `seed-scheduler-*` | 规划中 |
| 13 | 数据同步 | 高 | `interfaces/sync.py` | `seed-sync-*` | 规划中 |
| 14 | 设备数据采集 | 极高 | `interfaces/equipment.py` | `seed-equipment-*` | 规划中 |
| 15 | 数据分析 | 中 | `interfaces/analytics.py` | `seed-analytics-*` | 规划中 |

## 🎯 功能实施优先级

### 第一阶段：核心基础功能（Week 1-6）

**必须实现**：
1. ✅ 多组织系统
2. ✅ 用户认证与授权
3. ✅ 查询增强组件
4. ✅ 统一响应封装
5. ✅ 操作日志
6. ✅ 文件上传与管理（本地存储）
7. ✅ 插件系统（基础版）
8. ✅ 超管管理面板（组织注册审核、运营监控）

### 第二阶段：开发效率提升（Week 7-9）

**必须实现**：
1. ✅ 代码生成器
2. ✅ 主子表模型支持
3. ✅ 数据字典
4. ✅ 系统配置管理

### 第三阶段：业务功能完善（Week 10-11）

**必须实现**：
1. ✅ 表单自定义字段
2. ✅ 打印模板设计
3. ✅ 消息通知
4. ✅ 国际化支持
5. ✅ 主题定制

### 第四阶段：热插拔功能（按需实现）

**建议优先实现**：
1. 🔌 设备数据采集插件（MES 核心，优先级最高）
2. 🔌 对象存储服务插件（OSS、COS 等）
3. 🔌 数据可视化增强插件（G6、X6、甘特图）
4. 🔌 报表引擎插件
5. 🔌 条码/二维码生成插件
6. 🔌 数据导入导出插件
7. 🔌 数据同步插件（ERP、PLM、WMS）

**其他插件按需实现**：
- 支付功能、短信服务、邮件服务、消息推送、微信集成、工作流引擎、定时任务、数据分析

## 📐 功能模块架构图

```
riveredge-core/
├── core/
│   ├── tenant/              # 多组织系统 ⭐⭐⭐⭐⭐
│   ├── auth/                # 用户认证与授权 ⭐⭐⭐⭐⭐
│   ├── query/               # 查询增强组件 ⭐⭐⭐⭐⭐
│   ├── response/            # 统一响应封装 ⭐⭐⭐⭐⭐
│   ├── master_detail/       # 主子表模型支持 ⭐⭐⭐⭐
│   ├── log/                 # 操作日志 ⭐⭐⭐⭐
│   ├── file/                # 文件上传与管理 ⭐⭐⭐⭐
│   ├── dict/                # 数据字典 ⭐⭐⭐⭐
│   ├── config/              # 系统配置管理 ⭐⭐⭐
│   ├── message/             # 消息通知 ⭐⭐⭐
│   ├── form/                # 表单自定义字段 ⭐⭐⭐
│   ├── print/               # 打印模板设计 ⭐⭐⭐
│   ├── plugin/              # 插件系统 ⭐⭐⭐⭐⭐
│   ├── superadmin/          # 超管管理面板 ⭐⭐⭐⭐⭐
│   └── interfaces/         # 功能接口定义（热插拔）
│       ├── payment.py       # 支付接口
│       ├── sms.py          # 短信接口
│       ├── email.py        # 邮件接口
│       ├── storage.py      # 存储接口
│       ├── push.py         # 推送接口
│       ├── wechat.py       # 微信接口
│       ├── visualization.py # 可视化接口
│       ├── report.py       # 报表接口
│       ├── workflow.py     # 工作流接口
│       ├── barcode.py      # 条码接口
│       ├── excel.py        # Excel 接口
│       ├── scheduler.py   # 定时任务接口
│       ├── sync.py         # 数据同步接口
│       ├── equipment.py    # 设备接口
│       └── analytics.py    # 数据分析接口
├── tools/
│   └── generator/            # 代码生成器 ⭐⭐⭐⭐⭐
└── api/
    └── v1/
        ├── auth.py          # 认证授权 API
        ├── users.py         # 用户管理 API
        ├── roles.py         # 角色权限 API
        ├── tenants.py       # 组织管理 API
        ├── plugins.py       # 插件管理 API
        ├── superadmin.py    # 超管管理 API ⭐⭐⭐⭐⭐
        └── ...

riveredge-shell/
├── src/
│   ├── pages/
│   │   ├── user/            # 用户管理页面
│   │   ├── role/            # 角色管理页面
│   │   ├── tenant/          # 组织管理页面
│   │   ├── plugin/          # 插件管理页面
│   │   ├── superadmin/      # 超管管理面板 ⭐⭐⭐⭐⭐
│   │   │   ├── tenants/     # 组织管理（审核、列表、详情）
│   │   │   ├── dashboard/   # 运营监控看板
│   │   │   └── system/       # 系统监控
│   │   ├── system/          # 系统设置页面
│   │   │   ├── config/      # 系统配置
│   │   │   ├── logs/        # 操作日志
│   │   │   └── dict/        # 数据字典
│   │   └── message/         # 消息通知页面
│   ├── components/
│   │   ├── FileUpload/      # 文件上传组件
│   │   ├── DictSelect/      # 字典选择组件
│   │   ├── FormDesigner/    # 表单设计器
│   │   └── PrintTemplate/   # 打印模板组件
│   ├── locales/             # 国际化支持 ⭐⭐
│   └── themes/              # 主题定制 ⭐⭐
```

## 🔄 功能依赖关系

```
核心基础层
├── 多组织系统（所有功能的基础）
├── 用户认证与授权（所有 API 的基础）
├── 查询增强组件（所有查询的基础）
├── 统一响应封装（所有 API 的基础）
├── 超管管理面板（组织注册审核、运营监控，独立于组织系统）
└── 插件系统（所有热插拔功能的基础）

开发效率层
├── 代码生成器（依赖：多组织、认证授权）
├── 主子表模型支持（依赖：多组织、查询增强）
└── 数据字典（依赖：多组织）

业务功能层
├── 操作日志（依赖：多组织、认证授权）
├── 文件上传与管理（依赖：多组织、存储接口）
├── 系统配置管理（依赖：多组织）
├── 消息通知（依赖：多组织、认证授权）
├── 表单自定义字段（依赖：多组织）
└── 打印模板设计（依赖：多组织）

用户体验层
├── 国际化支持（独立）
└── 主题定制（独立）

热插拔功能层（所有功能依赖插件系统）
├── 支付功能（依赖：payment 接口）
├── 短信服务（依赖：sms 接口）
├── 邮件服务（依赖：email 接口）
├── 对象存储服务（依赖：storage 接口）
├── 消息推送服务（依赖：push 接口）
├── 微信集成（依赖：wechat 接口）
├── 数据可视化增强（依赖：visualization 接口）
├── 报表引擎（依赖：report 接口）
├── 工作流引擎（依赖：workflow 接口）
├── 条码/二维码生成（依赖：barcode 接口）
├── 数据导入导出（依赖：excel 接口）
├── 定时任务（依赖：scheduler 接口）
├── 数据同步（依赖：sync 接口）
├── 设备数据采集（依赖：equipment 接口）
└── 数据分析（依赖：analytics 接口）
```

## 📝 功能实现检查清单

### 核心代码功能检查

- [ ] 多组织系统
  - [ ] 组织模型（Tenant）
  - [ ] 组织上下文管理（TenantContext）
  - [ ] 数据隔离机制（应用层 + RLS）
  - [ ] 组织注册和管理 API
  - [ ] 组织配置管理

- [ ] 用户认证与授权
  - [ ] 用户模型（User，包含 tenant_id）
  - [ ] 角色模型（Role，包含 tenant_id）
  - [ ] 权限模型（Permission，包含 tenant_id）
  - [ ] JWT Token 生成和验证（包含 tenant_id）
  - [ ] 权限验证中间件（自动组织过滤）
  - [ ] 用户注册/登录 API
  - [ ] 角色权限管理 API

- [ ] 查询增强组件
  - [ ] QueryBuilder（查询构建器）
  - [ ] 查询参数装饰器
  - [ ] 分页、排序、筛选、模糊查询
  - [ ] 日期范围查询
  - [ ] 多条件组合查询
  - [ ] 自动组织过滤

- [ ] 统一响应封装
  - [ ] ResponseModel（统一响应模型）
  - [ ] SuccessResponse（成功响应）
  - [ ] ErrorResponse（错误响应）
  - [ ] 响应装饰器
  - [ ] 异常处理中间件

- [ ] 代码生成器
  - [ ] 数据库表导入
  - [ ] 字段配置管理
  - [ ] 代码模板（Model、Schema、API、Service、前端页面）
  - [ ] 单表 CRUD 生成
  - [ ] 主子表生成
  - [ ] 树形表生成

- [ ] 主子表模型支持
  - [ ] 主子表关系定义（Tortoise ORM）
  - [ ] 主子表嵌套 Schema（Pydantic）
  - [ ] 主子表 API 支持（事务处理）
  - [ ] 主子表前端组件支持（ProTable、ProForm）

- [ ] 操作日志
  - [ ] 操作日志模型（OperationLog）
  - [ ] 日志记录中间件
  - [ ] 日志查询 API
  - [ ] 日志导出功能

- [ ] 文件上传与管理
  - [ ] 文件上传 API
  - [ ] 文件存储接口（抽象接口）
  - [ ] 本地存储实现（默认）
  - [ ] 文件管理 API

- [ ] 数据字典
  - [ ] 数据字典模型（Dict、DictItem）
  - [ ] 数据字典管理 API
  - [ ] 数据字典缓存（Redis）
  - [ ] 前端字典组件

- [ ] 系统配置管理
  - [ ] 系统配置模型（SystemConfig）
  - [ ] 配置管理 API
  - [ ] 配置缓存（Redis）
  - [ ] 配置热更新

- [ ] 消息通知
  - [ ] 消息模型（Message）
  - [ ] 消息发送 API
  - [ ] 消息查询 API
  - [ ] 消息已读/未读状态

- [ ] 表单自定义字段
  - [ ] 表单模板模型（FormTemplate）
  - [ ] 表单数据模型（FormData）
  - [ ] 表单设计器 API
  - [ ] React Hook Form 集成

- [ ] 打印模板设计
  - [ ] 打印模板模型（PrintTemplate）
  - [ ] 模板管理 API
  - [ ] react-to-print 集成
  - [ ] PDF 生成支持

- [ ] 国际化支持
  - [ ] 国际化配置（React i18next）
  - [ ] 语言包管理
  - [ ] 语言切换功能

- [ ] 主题定制
  - [ ] 主题配置
  - [ ] 暗色模式支持
  - [ ] 主题切换功能

- [ ] 插件系统
  - [ ] 插件模型（Plugin）
  - [ ] 插件加载器（后端 + 前端）
  - [ ] 插件注册机制
  - [ ] 插件管理 API
  - [ ] 插件管理界面

- [ ] 超管管理面板
  - [ ] 超管用户模型（SuperAdmin，独立于组织系统）
  - [ ] 超管认证系统（JWT，不包含 tenant_id）
  - [ ] 组织注册审核流程（待审核、已通过、已拒绝）
  - [ ] 组织注册管理 API（审核、启用/禁用、删除）
  - [ ] 组织运营监控 API（统计、活跃度、资源使用）
  - [ ] 组织数据统计 API（用户数、订单数、数据量）
  - [ ] 系统监控 API（运行状态、资源使用、性能指标）
  - [ ] 超管管理界面（组织列表、审核、监控看板）
  - [ ] 组织注册审核历史记录
  - [ ] 实时监控数据（Redis 缓存 + 定时任务）

### 可热插拔功能检查

- [ ] 功能接口定义（core/interfaces/）
  - [ ] payment.py - 支付接口
  - [ ] sms.py - 短信接口
  - [ ] email.py - 邮件接口
  - [ ] storage.py - 存储接口
  - [ ] push.py - 推送接口
  - [ ] wechat.py - 微信接口
  - [ ] visualization.py - 可视化接口
  - [ ] report.py - 报表接口
  - [ ] workflow.py - 工作流接口
  - [ ] barcode.py - 条码接口
  - [ ] excel.py - Excel 接口
  - [ ] scheduler.py - 定时任务接口
  - [ ] sync.py - 数据同步接口
  - [ ] equipment.py - 设备接口
  - [ ] analytics.py - 数据分析接口

- [ ] 服务注册表
  - [ ] ServiceRegistry（服务注册表）
  - [ ] 服务注册和注销机制
  - [ ] 服务获取和调用机制

## 📚 相关文档

- [2.架构设计文档.md](./2.架构设计文档.md) - 系统架构设计
- [功能热插拔实现方案.md](../4.branch/功能热插拔实现方案.md) - 热插拔功能实现方案
- [4.框架开发计划.md](./4.框架开发计划.md) - 详细开发计划
- [AGENTS.md](../2.rules/AGENTS.md) - AI 助手开发规范

## ✅ 总结

本文档列出了 **RiverEdge SaaS 多组织框架 (RiverEdge SaaS Multi-tenant Framework)** 的完整功能列表：

1. ✅ **17 项核心代码功能**：必须内置在框架中，所有业务模块都依赖
2. ✅ **15 项可热插拔功能**：通过插件机制实现，支持动态加载/卸载
3. ✅ **功能优先级明确**：按 MES 系统重要性标注优先级
4. ✅ **实施建议清晰**：分阶段实施，明确各阶段重点
5. ✅ **功能依赖关系**：明确功能之间的依赖关系

**核心原则**：
- **核心代码**：提供基础能力，所有业务模块都依赖
- **热插拔功能**：提供扩展能力，按需加载，不污染核心代码
- **MES 适配**：优先考虑 MES 系统的常见需求

**实施建议**：严格按照优先级实施，先完成核心基础功能，再逐步完善业务功能和热插拔功能。

---

**最后更新**：2025-11-19（采用React生态最佳实践重构）


# å·¥å‚æ•°æ®æœ€ä½³å®è·µ

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å·¥å‚æ•°æ®æ¨¡å—ï¼ˆè½¦é—´ã€äº§çº¿ã€å·¥ä½ï¼‰çš„å¼€å‘æœ€ä½³å®è·µï¼Œç»“åˆ RiverEdge SaaS æ¡†æ¶è§„èŒƒå’Œ DDD åº”ç”¨å±‚è®¾è®¡è§„èŒƒã€‚

## ğŸ¯ æ¨¡å—è¯´æ˜

å·¥å‚æ•°æ®æ¨¡å—ç”¨äºç®¡ç†å·¥å‚çš„ç»„ç»‡ç»“æ„ï¼Œé‡‡ç”¨ä¸‰çº§å±‚çº§ç»“æ„ï¼š
- **è½¦é—´ï¼ˆWorkshopï¼‰**ï¼šå·¥å‚çš„æœ€é«˜å±‚çº§ç»„ç»‡å•ä½
- **äº§çº¿ï¼ˆProduction Lineï¼‰**ï¼šè½¦é—´çš„å­å•ä½ï¼Œå±äºæŸä¸ªè½¦é—´
- **å·¥ä½ï¼ˆWorkstationï¼‰**ï¼šäº§çº¿çš„å­å•ä½ï¼Œå±äºæŸæ¡äº§çº¿

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### åç«¯æ¶æ„ï¼ˆä¼ ç»Ÿåˆ†å±‚ï¼‰

```
riveredge-backend/src/apps/master_data/
â”œâ”€â”€ api/
â”‚   â””â”€â”€ factory.py                    # å·¥å‚æ•°æ® APIï¼ˆè½¦é—´ã€äº§çº¿ã€å·¥ä½ï¼‰
â”œâ”€â”€ services/
â”‚   â””â”€â”€ factory_service.py           # å·¥å‚æ•°æ®æœåŠ¡
â”œâ”€â”€ models/
â”‚   â””â”€â”€ factory.py                   # å·¥å‚æ•°æ®æ¨¡å‹ï¼ˆè½¦é—´ã€äº§çº¿ã€å·¥ä½ï¼‰
â””â”€â”€ schemas/
    â””â”€â”€ factory_schemas.py           # å·¥å‚æ•°æ® Schema
```

### å‰ç«¯æ¶æ„

```
riveredge-frontend/src/apps/master_data/
â”œâ”€â”€ pages/
â”‚   â””â”€â”€ factory/
â”‚       â”œâ”€â”€ workshops/               # è½¦é—´ç®¡ç†é¡µé¢
â”‚       â”œâ”€â”€ production-lines/       # äº§çº¿ç®¡ç†é¡µé¢
â”‚       â””â”€â”€ workstations/           # å·¥ä½ç®¡ç†é¡µé¢
â”œâ”€â”€ services/
â”‚   â””â”€â”€ factory.ts                  # å·¥å‚æ•°æ® API æœåŠ¡
â””â”€â”€ types/
    â””â”€â”€ factory.ts                  # å·¥å‚æ•°æ®ç±»å‹å®šä¹‰
```

## ğŸ“ æ•°æ®åº“è®¾è®¡è§„èŒƒ

### è¡¨å‘½åè§„èŒƒ

- âœ… **è¡¨å**ï¼š`seed_master_data_workshops`ã€`seed_master_data_production_lines`ã€`seed_master_data_workstations`
- âœ… **å­—æ®µå**ï¼š`snake_case`ï¼ˆå¦‚ `workshop_id`ã€`production_line_id`ï¼‰
- âœ… **ç´¢å¼•å**ï¼š`idx_è¡¨å_å­—æ®µå`ï¼ˆå¦‚ `idx_seed_master_data_workshops_tenant_id`ï¼‰

### å¿…é¡»å­—æ®µ

æ‰€æœ‰è¡¨å¿…é¡»åŒ…å«ä»¥ä¸‹å­—æ®µï¼š

1. **ç»„ç»‡éš”ç¦»å­—æ®µ**
   - `tenant_id INTEGER NOT NULL` - ç§Ÿæˆ·IDï¼ˆå¿…é¡»ï¼‰

2. **å”¯ä¸€æ ‡è¯†å­—æ®µ**
   - `uuid VARCHAR(36) NOT NULL UNIQUE` - UUIDï¼ˆå¿…é¡»ï¼‰
   - `id SERIAL PRIMARY KEY` - è‡ªå¢ä¸»é”®ï¼ˆå¿…é¡»ï¼‰

3. **ç¼–ç å­—æ®µ**
   - `code VARCHAR(50) NOT NULL` - ç¼–ç ï¼ˆå¿…é¡»ï¼Œç»„ç»‡å†…å”¯ä¸€ï¼‰
   - `UNIQUE(tenant_id, code)` - ç»„ç»‡å†…ç¼–ç å”¯ä¸€çº¦æŸï¼ˆå¿…é¡»ï¼‰

4. **æ ‡å‡†æ—¶é—´å­—æ®µ**
   - `created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP` - åˆ›å»ºæ—¶é—´ï¼ˆå¿…é¡»ï¼‰
   - `updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP` - æ›´æ–°æ—¶é—´ï¼ˆå¿…é¡»ï¼‰
   - `deleted_at TIMESTAMP NULL` - åˆ é™¤æ—¶é—´ï¼ˆè½¯åˆ é™¤ï¼Œå¯é€‰ï¼‰

5. **çŠ¶æ€å­—æ®µ**
   - `is_active BOOLEAN DEFAULT TRUE` - æ˜¯å¦å¯ç”¨ï¼ˆå¿…é¡»ï¼‰

### å¤–é”®å…³ç³»

- **äº§çº¿ â†’ è½¦é—´**ï¼š`production_line.workshop_id â†’ workshop.id`
- **å·¥ä½ â†’ äº§çº¿**ï¼š`workstation.production_line_id â†’ production_line.id`

### ç´¢å¼•è®¾è®¡

å¿…é¡»åˆ›å»ºçš„ç´¢å¼•ï¼š

1. **ç»„ç»‡éš”ç¦»ç´¢å¼•**
   - `INDEX idx_tenant_id (tenant_id)` - æ‰€æœ‰è¡¨å¿…é¡»

2. **å”¯ä¸€æ€§ç´¢å¼•**
   - `INDEX idx_uuid (uuid)` - æ‰€æœ‰è¡¨å¿…é¡»
   - `INDEX idx_code (code)` - æ‰€æœ‰è¡¨å¿…é¡»ï¼ˆé…åˆå”¯ä¸€çº¦æŸï¼‰

3. **å¤–é”®ç´¢å¼•**
   - `INDEX idx_workshop_id (workshop_id)` - äº§çº¿è¡¨å¿…é¡»
   - `INDEX idx_production_line_id (production_line_id)` - å·¥ä½è¡¨å¿…é¡»

## ğŸ’» åç«¯å¼€å‘è§„èŒƒ

### 1. Model å±‚ï¼ˆTortoise ORMï¼‰

#### å‘½åè§„èŒƒ

- âœ… **ç±»å**ï¼š`PascalCase`ï¼ˆå¦‚ `Workshop`ã€`ProductionLine`ã€`Workstation`ï¼‰
- âœ… **å­—æ®µå**ï¼š`snake_case`ï¼ˆå¦‚ `workshop_id`ã€`tenant_id`ï¼‰
- âœ… **è¡¨å**ï¼š`snake_case`ï¼ŒåŒ…å«æ¨¡å—å‰ç¼€ï¼ˆå¦‚ `seed_master_data_workshops`ï¼‰

#### ä»£ç ç¤ºä¾‹

```python
# models/factory.py
from tortoise.models import Model
from tortoise import fields
from typing import Optional
from datetime import datetime
import uuid as uuid_lib


class Workshop(Model):
    """
    è½¦é—´æ¨¡å‹
    
    å·¥å‚çš„æœ€é«˜å±‚çº§ç»„ç»‡å•ä½
    """
    
    class Meta:
        table = "seed_master_data_workshops"
        indexes = [
            ("tenant_id",),
            ("code",),
            ("uuid",),
        ]
    
    # ä¸»é”®
    id = fields.IntField(pk=True, description="ä¸»é”®ID")
    uuid = fields.CharField(max_length=36, unique=True, default=lambda: str(uuid_lib.uuid4()), description="UUID")
    
    # ç»„ç»‡éš”ç¦»
    tenant_id = fields.IntField(description="ç§Ÿæˆ·ID")
    
    # åŸºæœ¬ä¿¡æ¯
    code = fields.CharField(max_length=50, description="è½¦é—´ç¼–ç ")
    name = fields.CharField(max_length=200, description="è½¦é—´åç§°")
    description = fields.TextField(null=True, description="æè¿°")
    
    # çŠ¶æ€ä¿¡æ¯
    is_active = fields.BooleanField(default=True, description="æ˜¯å¦å¯ç”¨")
    
    # æ ‡å‡†æ—¶é—´å­—æ®µ
    created_at = fields.DatetimeField(auto_now_add=True, description="åˆ›å»ºæ—¶é—´")
    updated_at = fields.DatetimeField(auto_now=True, description="æ›´æ–°æ—¶é—´")
    deleted_at = fields.DatetimeField(null=True, description="åˆ é™¤æ—¶é—´")
    
    def __str__(self):
        return f"{self.code} - {self.name}"


class ProductionLine(Model):
    """
    äº§çº¿æ¨¡å‹
    
    è½¦é—´çš„å­å•ä½ï¼Œå±äºæŸä¸ªè½¦é—´
    """
    
    class Meta:
        table = "seed_master_data_production_lines"
        indexes = [
            ("tenant_id",),
            ("code",),
            ("uuid",),
            ("workshop_id",),
        ]
    
    # ä¸»é”®
    id = fields.IntField(pk=True, description="ä¸»é”®ID")
    uuid = fields.CharField(max_length=36, unique=True, default=lambda: str(uuid_lib.uuid4()), description="UUID")
    
    # ç»„ç»‡éš”ç¦»
    tenant_id = fields.IntField(description="ç§Ÿæˆ·ID")
    
    # åŸºæœ¬ä¿¡æ¯
    code = fields.CharField(max_length=50, description="äº§çº¿ç¼–ç ")
    name = fields.CharField(max_length=200, description="äº§çº¿åç§°")
    workshop_id = fields.IntField(description="æ‰€å±è½¦é—´ID")
    description = fields.TextField(null=True, description="æè¿°")
    
    # å…³è”å…³ç³»
    workshop = fields.ForeignKeyField(
        "models.Workshop",
        related_name="production_lines",
        description="æ‰€å±è½¦é—´"
    )
    
    # çŠ¶æ€ä¿¡æ¯
    is_active = fields.BooleanField(default=True, description="æ˜¯å¦å¯ç”¨")
    
    # æ ‡å‡†æ—¶é—´å­—æ®µ
    created_at = fields.DatetimeField(auto_now_add=True, description="åˆ›å»ºæ—¶é—´")
    updated_at = fields.DatetimeField(auto_now=True, description="æ›´æ–°æ—¶é—´")
    deleted_at = fields.DatetimeField(null=True, description="åˆ é™¤æ—¶é—´")
    
    def __str__(self):
        return f"{self.code} - {self.name}"


class Workstation(Model):
    """
    å·¥ä½æ¨¡å‹
    
    äº§çº¿çš„å­å•ä½ï¼Œå±äºæŸæ¡äº§çº¿
    """
    
    class Meta:
        table = "seed_master_data_workstations"
        indexes = [
            ("tenant_id",),
            ("code",),
            ("uuid",),
            ("production_line_id",),
        ]
    
    # ä¸»é”®
    id = fields.IntField(pk=True, description="ä¸»é”®ID")
    uuid = fields.CharField(max_length=36, unique=True, default=lambda: str(uuid_lib.uuid4()), description="UUID")
    
    # ç»„ç»‡éš”ç¦»
    tenant_id = fields.IntField(description="ç§Ÿæˆ·ID")
    
    # åŸºæœ¬ä¿¡æ¯
    code = fields.CharField(max_length=50, description="å·¥ä½ç¼–ç ")
    name = fields.CharField(max_length=200, description="å·¥ä½åç§°")
    production_line_id = fields.IntField(description="æ‰€å±äº§çº¿ID")
    description = fields.TextField(null=True, description="æè¿°")
    
    # å…³è”å…³ç³»
    production_line = fields.ForeignKeyField(
        "models.ProductionLine",
        related_name="workstations",
        description="æ‰€å±äº§çº¿"
    )
    
    # çŠ¶æ€ä¿¡æ¯
    is_active = fields.BooleanField(default=True, description="æ˜¯å¦å¯ç”¨")
    
    # æ ‡å‡†æ—¶é—´å­—æ®µ
    created_at = fields.DatetimeField(auto_now_add=True, description="åˆ›å»ºæ—¶é—´")
    updated_at = fields.DatetimeField(auto_now=True, description="æ›´æ–°æ—¶é—´")
    deleted_at = fields.DatetimeField(null=True, description="åˆ é™¤æ—¶é—´")
    
    def __str__(self):
        return f"{self.code} - {self.name}"
```

### 2. Schema å±‚ï¼ˆPydanticï¼‰

#### å‘½åè§„èŒƒ

- âœ… **ç±»å**ï¼š`PascalCase`ï¼ˆå¦‚ `WorkshopCreate`ã€`WorkshopUpdate`ã€`WorkshopResponse`ï¼‰
- âœ… **å­—æ®µå**ï¼š`snake_case`ï¼ˆå¦‚ `workshop_id`ã€`tenant_id`ï¼‰

#### ä»£ç ç¤ºä¾‹

```python
# schemas/factory_schemas.py
from pydantic import BaseModel, Field, validator
from typing import Optional
from datetime import datetime
from uuid import UUID


class WorkshopBase(BaseModel):
    """è½¦é—´åŸºç¡€ Schema"""
    
    code: str = Field(..., max_length=50, description="è½¦é—´ç¼–ç ")
    name: str = Field(..., max_length=200, description="è½¦é—´åç§°")
    description: Optional[str] = Field(None, description="æè¿°")
    is_active: bool = Field(True, description="æ˜¯å¦å¯ç”¨")
    
    @validator("code")
    def validate_code(cls, v):
        """éªŒè¯ç¼–ç æ ¼å¼"""
        if not v or not v.strip():
            raise ValueError("è½¦é—´ç¼–ç ä¸èƒ½ä¸ºç©º")
        return v.strip().upper()
    
    @validator("name")
    def validate_name(cls, v):
        """éªŒè¯åç§°æ ¼å¼"""
        if not v or not v.strip():
            raise ValueError("è½¦é—´åç§°ä¸èƒ½ä¸ºç©º")
        return v.strip()


class WorkshopCreate(WorkshopBase):
    """åˆ›å»ºè½¦é—´ Schema"""
    pass


class WorkshopUpdate(BaseModel):
    """æ›´æ–°è½¦é—´ Schema"""
    
    code: Optional[str] = Field(None, max_length=50, description="è½¦é—´ç¼–ç ")
    name: Optional[str] = Field(None, max_length=200, description="è½¦é—´åç§°")
    description: Optional[str] = Field(None, description="æè¿°")
    is_active: Optional[bool] = Field(None, description="æ˜¯å¦å¯ç”¨")


class WorkshopResponse(WorkshopBase):
    """è½¦é—´å“åº” Schema"""
    
    id: int = Field(..., description="ä¸»é”®ID")
    uuid: str = Field(..., description="UUID")
    tenant_id: int = Field(..., description="ç§Ÿæˆ·ID")
    created_at: datetime = Field(..., description="åˆ›å»ºæ—¶é—´")
    updated_at: datetime = Field(..., description="æ›´æ–°æ—¶é—´")
    deleted_at: Optional[datetime] = Field(None, description="åˆ é™¤æ—¶é—´")
    
    class Config:
        from_attributes = True


# äº§çº¿å’Œå·¥ä½çš„ Schema ç±»ä¼¼ï¼Œæ­¤å¤„çœç•¥...
```

### 3. Service å±‚

#### å‘½åè§„èŒƒ

- âœ… **ç±»å**ï¼š`PascalCase`ï¼ˆå¦‚ `FactoryService`ï¼‰
- âœ… **æ–¹æ³•å**ï¼š`snake_case`ï¼ŒåŠ¨è¯å¼€å¤´ï¼ˆå¦‚ `create_workshop`ã€`get_workshop_by_id`ï¼‰

#### ä»£ç ç¤ºä¾‹

```python
# services/factory_service.py
from typing import List, Optional
from uuid import UUID
from tortoise.exceptions import IntegrityError

from core.models.menu import Menu
from apps.master_data.models.factory import Workshop, ProductionLine, Workstation
from apps.master_data.schemas.factory_schemas import (
    WorkshopCreate, WorkshopUpdate, WorkshopResponse,
    ProductionLineCreate, ProductionLineUpdate, ProductionLineResponse,
    WorkstationCreate, WorkstationUpdate, WorkstationResponse
)
from infra.exceptions.exceptions import NotFoundError, ValidationError


class FactoryService:
    """å·¥å‚æ•°æ®æœåŠ¡"""
    
    @staticmethod
    async def create_workshop(
        tenant_id: int,
        data: WorkshopCreate
    ) -> WorkshopResponse:
        """
        åˆ›å»ºè½¦é—´
        
        Args:
            tenant_id: ç§Ÿæˆ·ID
            data: è½¦é—´åˆ›å»ºæ•°æ®
            
        Returns:
            WorkshopResponse: åˆ›å»ºçš„è½¦é—´å¯¹è±¡
            
        Raises:
            ValidationError: å½“ç¼–ç å·²å­˜åœ¨æ—¶æŠ›å‡º
        """
        # æ£€æŸ¥ç¼–ç æ˜¯å¦å·²å­˜åœ¨
        existing = await Workshop.filter(
            tenant_id=tenant_id,
            code=data.code,
            deleted_at__isnull=True
        ).first()
        
        if existing:
            raise ValidationError(f"è½¦é—´ç¼–ç  {data.code} å·²å­˜åœ¨")
        
        # åˆ›å»ºè½¦é—´
        workshop = await Workshop.create(
            tenant_id=tenant_id,
            **data.dict()
        )
        
        return WorkshopResponse.from_orm(workshop)
    
    @staticmethod
    async def get_workshop_by_uuid(
        tenant_id: int,
        workshop_uuid: str
    ) -> WorkshopResponse:
        """
        æ ¹æ®UUIDè·å–è½¦é—´
        
        Args:
            tenant_id: ç§Ÿæˆ·ID
            workshop_uuid: è½¦é—´UUID
            
        Returns:
            WorkshopResponse: è½¦é—´å¯¹è±¡
            
        Raises:
            NotFoundError: å½“è½¦é—´ä¸å­˜åœ¨æ—¶æŠ›å‡º
        """
        workshop = await Workshop.filter(
            tenant_id=tenant_id,
            uuid=workshop_uuid,
            deleted_at__isnull=True
        ).first()
        
        if not workshop:
            raise NotFoundError(f"è½¦é—´ {workshop_uuid} ä¸å­˜åœ¨")
        
        return WorkshopResponse.from_orm(workshop)
    
    @staticmethod
    async def list_workshops(
        tenant_id: int,
        skip: int = 0,
        limit: int = 100,
        is_active: Optional[bool] = None
    ) -> List[WorkshopResponse]:
        """
        è·å–è½¦é—´åˆ—è¡¨
        
        Args:
            tenant_id: ç§Ÿæˆ·ID
            skip: è·³è¿‡æ•°é‡
            limit: é™åˆ¶æ•°é‡
            is_active: æ˜¯å¦å¯ç”¨ï¼ˆå¯é€‰ï¼‰
            
        Returns:
            List[WorkshopResponse]: è½¦é—´åˆ—è¡¨
        """
        query = Workshop.filter(
            tenant_id=tenant_id,
            deleted_at__isnull=True
        )
        
        if is_active is not None:
            query = query.filter(is_active=is_active)
        
        workshops = await query.offset(skip).limit(limit).all()
        
        return [WorkshopResponse.from_orm(w) for w in workshops]
    
    # äº§çº¿å’Œå·¥ä½çš„æ–¹æ³•ç±»ä¼¼ï¼Œæ­¤å¤„çœç•¥...
```

### 4. API å±‚ï¼ˆFastAPIï¼‰

#### å‘½åè§„èŒƒ

- âœ… **è·¯ç”±è·¯å¾„**ï¼š`/api/v1/apps/master-data/factory/workshops`
- âœ… **å‡½æ•°å**ï¼š`snake_case`ï¼ˆå¦‚ `create_workshop`ã€`get_workshop`ï¼‰

#### ä»£ç ç¤ºä¾‹

```python
# api/factory.py
from fastapi import APIRouter, Depends, HTTPException, Query
from typing import List, Optional
from uuid import UUID

from core.api.dependencies import get_current_tenant_id, get_current_user
from apps.master_data.services.factory_service import FactoryService
from apps.master_data.schemas.factory_schemas import (
    WorkshopCreate, WorkshopUpdate, WorkshopResponse,
    ProductionLineCreate, ProductionLineUpdate, ProductionLineResponse,
    WorkstationCreate, WorkstationUpdate, WorkstationResponse
)
from infra.exceptions.exceptions import NotFoundError, ValidationError

router = APIRouter(prefix="/factory", tags=["Factory"])


@router.post("/workshops", response_model=WorkshopResponse, summary="åˆ›å»ºè½¦é—´")
async def create_workshop(
    data: WorkshopCreate,
    tenant_id: int = Depends(get_current_tenant_id),
    user_id: UUID = Depends(get_current_user)
):
    """
    åˆ›å»ºè½¦é—´
    
    - **code**: è½¦é—´ç¼–ç ï¼ˆå¿…å¡«ï¼Œç»„ç»‡å†…å”¯ä¸€ï¼‰
    - **name**: è½¦é—´åç§°ï¼ˆå¿…å¡«ï¼‰
    - **description**: æè¿°ï¼ˆå¯é€‰ï¼‰
    - **is_active**: æ˜¯å¦å¯ç”¨ï¼ˆé»˜è®¤ï¼štrueï¼‰
    """
    try:
        return await FactoryService.create_workshop(tenant_id, data)
    except ValidationError as e:
        raise HTTPException(status_code=400, detail=str(e))


@router.get("/workshops", response_model=List[WorkshopResponse], summary="è·å–è½¦é—´åˆ—è¡¨")
async def list_workshops(
    skip: int = Query(0, ge=0, description="è·³è¿‡æ•°é‡"),
    limit: int = Query(100, ge=1, le=1000, description="é™åˆ¶æ•°é‡"),
    is_active: Optional[bool] = Query(None, description="æ˜¯å¦å¯ç”¨"),
    tenant_id: int = Depends(get_current_tenant_id)
):
    """
    è·å–è½¦é—´åˆ—è¡¨
    
    - **skip**: è·³è¿‡æ•°é‡ï¼ˆé»˜è®¤ï¼š0ï¼‰
    - **limit**: é™åˆ¶æ•°é‡ï¼ˆé»˜è®¤ï¼š100ï¼Œæœ€å¤§ï¼š1000ï¼‰
    - **is_active**: æ˜¯å¦å¯ç”¨ï¼ˆå¯é€‰ï¼‰
    """
    return await FactoryService.list_workshops(tenant_id, skip, limit, is_active)


@router.get("/workshops/{workshop_uuid}", response_model=WorkshopResponse, summary="è·å–è½¦é—´è¯¦æƒ…")
async def get_workshop(
    workshop_uuid: str,
    tenant_id: int = Depends(get_current_tenant_id)
):
    """
    æ ¹æ®UUIDè·å–è½¦é—´è¯¦æƒ…
    
    - **workshop_uuid**: è½¦é—´UUID
    """
    try:
        return await FactoryService.get_workshop_by_uuid(tenant_id, workshop_uuid)
    except NotFoundError as e:
        raise HTTPException(status_code=404, detail=str(e))


@router.put("/workshops/{workshop_uuid}", response_model=WorkshopResponse, summary="æ›´æ–°è½¦é—´")
async def update_workshop(
    workshop_uuid: str,
    data: WorkshopUpdate,
    tenant_id: int = Depends(get_current_tenant_id),
    user_id: UUID = Depends(get_current_user)
):
    """
    æ›´æ–°è½¦é—´
    
    - **workshop_uuid**: è½¦é—´UUID
    - **code**: è½¦é—´ç¼–ç ï¼ˆå¯é€‰ï¼‰
    - **name**: è½¦é—´åç§°ï¼ˆå¯é€‰ï¼‰
    - **description**: æè¿°ï¼ˆå¯é€‰ï¼‰
    - **is_active**: æ˜¯å¦å¯ç”¨ï¼ˆå¯é€‰ï¼‰
    """
    try:
        return await FactoryService.update_workshop(tenant_id, workshop_uuid, data)
    except NotFoundError as e:
        raise HTTPException(status_code=404, detail=str(e))
    except ValidationError as e:
        raise HTTPException(status_code=400, detail=str(e))


@router.delete("/workshops/{workshop_uuid}", summary="åˆ é™¤è½¦é—´")
async def delete_workshop(
    workshop_uuid: str,
    tenant_id: int = Depends(get_current_tenant_id),
    user_id: UUID = Depends(get_current_user)
):
    """
    åˆ é™¤è½¦é—´ï¼ˆè½¯åˆ é™¤ï¼‰
    
    - **workshop_uuid**: è½¦é—´UUID
    
    æ³¨æ„ï¼šåˆ é™¤è½¦é—´å‰éœ€è¦æ£€æŸ¥æ˜¯å¦æœ‰å…³è”çš„äº§çº¿
    """
    try:
        await FactoryService.delete_workshop(tenant_id, workshop_uuid)
        return {"message": "è½¦é—´åˆ é™¤æˆåŠŸ"}
    except NotFoundError as e:
        raise HTTPException(status_code=404, detail=str(e))
    except ValidationError as e:
        raise HTTPException(status_code=400, detail=str(e))


# äº§çº¿å’Œå·¥ä½çš„è·¯ç”±ç±»ä¼¼ï¼Œæ­¤å¤„çœç•¥...
```

## ğŸ¨ å‰ç«¯å¼€å‘è§„èŒƒ

### 1. ç±»å‹å®šä¹‰

```typescript
// types/factory.ts
export interface Workshop {
  id: number;
  uuid: string;
  tenantId: number;
  code: string;
  name: string;
  description?: string;
  isActive: boolean;
  createdAt: string;
  updatedAt: string;
  deletedAt?: string;
}

export interface WorkshopCreate {
  code: string;
  name: string;
  description?: string;
  isActive?: boolean;
}

export interface WorkshopUpdate {
  code?: string;
  name?: string;
  description?: string;
  isActive?: boolean;
}

export interface WorkshopListParams {
  skip?: number;
  limit?: number;
  isActive?: boolean;
}

// äº§çº¿å’Œå·¥ä½çš„ç±»å‹ç±»ä¼¼ï¼Œæ­¤å¤„çœç•¥...
```

### 2. API æœåŠ¡

```typescript
// services/factory.ts
import { api } from '@/services/api';
import type {
  Workshop,
  WorkshopCreate,
  WorkshopUpdate,
  WorkshopListParams,
  ProductionLine,
  ProductionLineCreate,
  ProductionLineUpdate,
  ProductionLineListParams,
  Workstation,
  WorkstationCreate,
  WorkstationUpdate,
  WorkstationListParams,
} from '../types/factory';

/**
 * è½¦é—´ API æœåŠ¡
 */
export const workshopApi = {
  /**
   * åˆ›å»ºè½¦é—´
   */
  create: async (data: WorkshopCreate): Promise<Workshop> => {
    return api.post('/apps/master-data/factory/workshops', data);
  },

  /**
   * è·å–è½¦é—´åˆ—è¡¨
   */
  list: async (params?: WorkshopListParams): Promise<Workshop[]> => {
    return api.get('/apps/master-data/factory/workshops', { params });
  },

  /**
   * è·å–è½¦é—´è¯¦æƒ…
   */
  get: async (uuid: string): Promise<Workshop> => {
    return api.get(`/apps/master-data/factory/workshops/${uuid}`);
  },

  /**
   * æ›´æ–°è½¦é—´
   */
  update: async (uuid: string, data: WorkshopUpdate): Promise<Workshop> => {
    return api.put(`/apps/master-data/factory/factory/workshops/${uuid}`, data);
  },

  /**
   * åˆ é™¤è½¦é—´
   */
  delete: async (uuid: string): Promise<void> => {
    return api.delete(`/apps/master-data/factory/workshops/${uuid}`);
  },
};

// äº§çº¿å’Œå·¥ä½çš„ API æœåŠ¡ç±»ä¼¼ï¼Œæ­¤å¤„çœç•¥...
```

### 3. é¡µé¢ç»„ä»¶

```typescript
// pages/factory/workshops/index.tsx
import React from 'react';
import { ProTable } from '@ant-design/pro-components';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { Button, Space, message } from 'antd';
import { PlusOutlined, EditOutlined, DeleteOutlined } from '@ant-design/icons';
import { workshopApi } from '@/apps/master_data/services/factory';
import type { Workshop, WorkshopListParams } from '@/apps/master_data/types/factory';
import WorkshopFormModal from './components/WorkshopFormModal';

/**
 * è½¦é—´ç®¡ç†é¡µé¢
 */
const WorkshopListPage: React.FC = () => {
  const queryClient = useQueryClient();
  const [formModalVisible, setFormModalVisible] = React.useState(false);
  const [editingWorkshop, setEditingWorkshop] = React.useState<Workshop | null>(null);

  // æŸ¥è¯¢è½¦é—´åˆ—è¡¨
  const { data: workshops, isLoading } = useQuery({
    queryKey: ['workshops'],
    queryFn: () => workshopApi.list(),
  });

  // åˆ é™¤è½¦é—´
  const deleteMutation = useMutation({
    mutationFn: (uuid: string) => workshopApi.delete(uuid),
    onSuccess: () => {
      message.success('åˆ é™¤æˆåŠŸ');
      queryClient.invalidateQueries({ queryKey: ['workshops'] });
    },
    onError: (error: any) => {
      message.error(error.message || 'åˆ é™¤å¤±è´¥');
    },
  });

  const columns = [
    {
      title: 'ç¼–ç ',
      dataIndex: 'code',
      key: 'code',
      width: 120,
    },
    {
      title: 'åç§°',
      dataIndex: 'name',
      key: 'name',
      width: 200,
    },
    {
      title: 'æè¿°',
      dataIndex: 'description',
      key: 'description',
      ellipsis: true,
    },
    {
      title: 'çŠ¶æ€',
      dataIndex: 'isActive',
      key: 'isActive',
      width: 100,
      render: (isActive: boolean) => (isActive ? 'å¯ç”¨' : 'ç¦ç”¨'),
    },
    {
      title: 'æ“ä½œ',
      key: 'action',
      width: 150,
      fixed: 'right' as const,
      render: (_: any, record: Workshop) => (
        <Space>
          <Button
            type="link"
            icon={<EditOutlined />}
            onClick={() => {
              setEditingWorkshop(record);
              setFormModalVisible(true);
            }}
          >
            ç¼–è¾‘
          </Button>
          <Button
            type="link"
            danger
            icon={<DeleteOutlined />}
            onClick={() => {
              if (window.confirm('ç¡®å®šè¦åˆ é™¤å—ï¼Ÿ')) {
                deleteMutation.mutate(record.uuid);
              }
            }}
          >
            åˆ é™¤
          </Button>
        </Space>
      ),
    },
  ];

  return (
    <div style={{ padding: '16px', margin: 0, boxSizing: 'border-box' }}>
      <ProTable<Workshop>
        headerTitle="è½¦é—´ç®¡ç†"
        rowKey="uuid"
        columns={columns}
        dataSource={workshops}
        loading={isLoading}
        search={false}
        toolBarRender={() => [
          <Button
            key="create"
            type="primary"
            icon={<PlusOutlined />}
            onClick={() => {
              setEditingWorkshop(null);
              setFormModalVisible(true);
            }}
          >
            æ–°å»ºè½¦é—´
          </Button>,
        ]}
      />
      
      <WorkshopFormModal
        visible={formModalVisible}
        workshop={editingWorkshop}
        onCancel={() => {
          setFormModalVisible(false);
          setEditingWorkshop(null);
        }}
        onSuccess={() => {
          setFormModalVisible(false);
          setEditingWorkshop(null);
          queryClient.invalidateQueries({ queryKey: ['workshops'] });
        }}
      />
    </div>
  );
};

export default WorkshopListPage;
```

## âœ… æ£€æŸ¥æ¸…å•

### å¼€å‘å‰å‡†å¤‡

- [ ] ç¡®è®¤æ•°æ®åº“è¡¨ç»“æ„è®¾è®¡
- [ ] ç¡®è®¤ API æ¥å£è®¾è®¡
- [ ] ç¡®è®¤å‰ç«¯é¡µé¢è®¾è®¡
- [ ] ç¡®è®¤æƒé™è®¾è®¡

### å¼€å‘ä¸­

- [ ] éµå¾ªå‘½åè§„èŒƒï¼ˆè¡¨åã€å­—æ®µåã€ç±»åã€å‡½æ•°åï¼‰
- [ ] æ‰€æœ‰æŸ¥è¯¢å¿…é¡»åŒ…å« `tenant_id` è¿‡æ»¤
- [ ] æ‰€æœ‰è¡¨å¿…é¡»åŒ…å«æ ‡å‡†å­—æ®µï¼ˆuuidã€tenant_idã€created_atã€updated_atã€deleted_atï¼‰
- [ ] æ‰€æœ‰ç¼–ç å­—æ®µå¿…é¡»ç»„ç»‡å†…å”¯ä¸€
- [ ] ç¼–å†™å®Œæ•´çš„æ³¨é‡Šï¼ˆä¸­æ–‡ï¼‰
- [ ] ç¼–å†™å•å…ƒæµ‹è¯•ï¼ˆè¦†ç›–ç‡ > 80%ï¼‰

### å¼€å‘å

- [ ] å®Œæ•´åŠŸèƒ½æµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•
- [ ] æ–‡æ¡£å®Œå–„
- [ ] ä»£ç å®¡æŸ¥

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ä¸»æ•°æ®ç®¡ç†APPå¼€å‘è®¡åˆ’](./ä¸»æ•°æ®ç®¡ç†APPå¼€å‘è®¡åˆ’.md)
- [DDDåº”ç”¨å±‚è®¾è®¡è§„èŒƒ](./DDDåº”ç”¨å±‚è®¾è®¡è§„èŒƒ.md)
- [Appså…±äº«éƒ¨åˆ†è®¾è®¡è§„èŒƒ](./Appså…±äº«éƒ¨åˆ†è®¾è®¡è§„èŒƒ.md)
- [AIåŠ©æ‰‹å¼€å‘è§„èŒƒ](../../2.rules/AGENTS.md)

---

**æœ€åæ›´æ–°**ï¼š2025-01-11


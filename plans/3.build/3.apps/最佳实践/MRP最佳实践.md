# MRP - 物料需求最佳实践

## 📋 模块概述

**快格轻MRP (kuaimrp)** - 物料需求模块，支持MRP和LRP双模式，实现精准的物料需求计算。

## 🎯 设计原则：小快轻准

- ✅ **MRP/LRP双模式**：支持MTS和MTO两种生产模式
- ✅ **需求计算准确性**：准确的需求计算，考虑库存、在途、安全库存等
- ✅ **需求追溯完整**：完整的需求来源追溯，支持需求变更影响分析
- ✅ **计划优化智能化**：基于历史数据和业务规则的智能计划优化

## 🏆 核心实践

### 1. MRP需求计算（MTS模式）

#### 1.1 需求汇总
- **需求源**：销售订单、销售预测、安全库存、独立需求等
- **需求汇总**：按物料汇总所有需求源
- **需求时间**：需求时间分布、需求时间窗口

#### 1.2 分层计算
- **BOM层级**：按BOM层级逐级计算物料需求
- **需求分解**：父件需求分解为子件需求
- **需求合并**：同一物料的需求合并

#### 1.3 供需平衡
- **现有库存**：考虑现有库存、可用库存
- **在途库存**：考虑在途库存、预计到货时间
- **安全库存**：考虑安全库存、安全库存策略
- **供需计算**：净需求 = 毛需求 - 现有库存 - 在途库存 + 安全库存

#### 1.4 计划生成
- **生产计划**：生成生产计划，考虑产能约束
- **采购计划**：生成采购计划，考虑供应商交期
- **计划优化**：计划优化建议、计划调整

### 2. LRP需求计算（MTO模式）

#### 2.1 订单分解
- **订单分解**：按订单进行物料需求分解
- **需求跟踪**：清晰跟踪每个需求来源（订单号）
- **需求明细**：需求明细记录、需求层级关系

#### 2.2 批次合并
- **订单合并**：支持订单合并成计划批次
- **合并规则**：合并规则配置（按产品、按交期等）
- **批次管理**：批次管理、批次跟踪

#### 2.3 需求跟踪
- **需求来源**：每个需求可追溯到具体订单
- **需求层级**：需求层级关系、需求依赖关系
- **需求状态**：需求状态跟踪、需求执行状态

#### 2.4 计划分步
- **生产计划优先**：可以先计算生产计划
- **采购计划后置**：生产计划确定后再计算采购计划
- **计划联动**：生产计划和采购计划联动调整

### 3. 需求追溯

#### 3.1 需求来源
- **需求追溯**：每个需求可追溯到具体订单或预测
- **需求路径**：需求路径展示、需求层级关系
- **需求明细**：需求明细查询、需求明细分析

#### 3.2 需求变更
- **变更影响分析**：需求变更自动影响分析
- **变更通知**：变更通知相关计划（生产计划、采购计划）
- **变更处理**：变更处理流程、变更执行跟踪

#### 3.3 全阶供需
- **全阶供需关系**：支持查看全阶供需关系
- **供需可视化**：供需关系可视化展示
- **供需分析**：供需平衡分析、供需缺口分析

### 4. 计划优化

#### 4.1 批量优化
- **经济批量**：考虑经济批量、最小采购量
- **批量合并**：批量合并建议、批量合并执行
- **批量分析**：批量成本分析、批量效率分析

#### 4.2 交期优化
- **供应商交期**：考虑供应商交期、供应商产能
- **生产周期**：考虑生产周期、生产产能
- **交期平衡**：交期平衡优化、交期调整建议

#### 4.3 成本优化
- **采购成本**：考虑采购成本、采购价格
- **库存成本**：考虑库存成本、库存持有成本
- **总成本优化**：总成本优化、成本平衡分析

### 5. 缺料分析

#### 5.1 缺料预警
- **缺料识别**：自动识别缺料，提前预警
- **缺料时间**：缺料时间预测、缺料影响时间
- **缺料等级**：缺料等级分类（紧急、重要、一般）

#### 5.2 缺料分析
- **缺料原因**：缺料原因分析（需求增加、库存不足、交期延迟等）
- **缺料影响**：缺料影响分析（影响订单、影响生产等）
- **缺料趋势**：缺料趋势分析、缺料预测

#### 5.3 缺料处理
- **处理建议**：缺料处理建议（紧急采购、替代料、调整计划等）
- **紧急采购**：紧急采购建议、紧急采购执行
- **缺料跟踪**：缺料处理跟踪、缺料解决确认

## 🔗 数据来源

- ← **CRM**：销售订单
- ← **MES**：生产计划、工单需求
- ← **master-data**：BOM、物料信息、工艺路线

## 🔌 集成接口

- ← **CRM**：销售订单
- ← **MES**：生产计划、工单需求
- → **SRM**：采购需求推送、委外需求、委外计划
- → **SCM**：需求计划、物料需求
- → **WMS**：库存查询、库存预留
- ← **master-data**：BOM、物料信息、工艺路线

## 📱 移动端支持

- 移动端需求查看
- 移动端缺料预警
- 移动端需求追溯
- 移动端计划查看

## 💡 技术建议

### 1. MRP计算引擎
- 使用递归算法实现BOM层级计算
- 支持并行计算，提升计算效率
- 计算结果缓存，减少重复计算

### 2. 需求追溯算法
- 使用树形结构存储需求层级关系
- 支持快速追溯查询
- 支持需求变更影响分析

### 3. 计划优化算法
- 使用启发式算法进行计划优化
- 考虑多约束条件（交期、成本、产能等）
- 支持多目标优化

### 4. 缺料预警模型
- 基于历史数据的缺料预测模型
- 考虑需求波动、供应商交期等因素
- 支持缺料风险等级评估

## 📊 关键指标

- 需求计算准确性：需求计算准确率
- 计划执行率：计划执行率
- 缺料率：缺料订单占比
- 需求追溯完整性：需求追溯完整率
- 计划优化效果：计划优化带来的成本节约

## 📝 说明

- **MRP（Material Requirements Planning）**：物料需求计划，全局性计划方法，针对所有物料的供需进行整体平衡
  - **适用模式**：MTS（Make to Stock，按库存生产）
  - **特点**：基于预测和销售订单，全局平衡物料需求，适用于库存驱动生产

- **LRP（Lot Requirements Planning）**：批次需求计划，局部计划方法，按订单进行物料需求分解，便于跟踪和插单管理
  - **适用模式**：MTO（Make to Order，按订单生产）
  - **特点**：按订单分解需求，清晰跟踪需求来源，适用于订单驱动生产

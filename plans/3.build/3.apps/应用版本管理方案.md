# åº”ç”¨ç‰ˆæœ¬ç®¡ç†æ–¹æ¡ˆï¼ˆè½»é‡ç‰ˆ vs PRO ç‰ˆï¼‰

## ğŸ“‹ æ¦‚è¿°

åº”ç”¨å±‚ APP æœ‰è½»é‡ç‰ˆï¼ˆLiteï¼‰å’Œ PRO ç‰ˆï¼Œéœ€è¦è®¾è®¡åˆç†çš„æ¶æ„æ¥å¤„ç†ç‰ˆæœ¬å·®å¼‚ï¼Œå®ç°ä»£ç å¤ç”¨ã€åŠŸèƒ½æ§åˆ¶å’Œæƒé™ç®¡ç†ã€‚

## ğŸ¯ è®¾è®¡ç›®æ ‡

1. **ä»£ç å¤ç”¨**ï¼šæœ€å¤§åŒ–å…±äº«ä»£ç ï¼Œå‡å°‘é‡å¤å¼€å‘
2. **åŠŸèƒ½æ§åˆ¶**ï¼šåŸºäºå¥—é¤å’Œæƒé™æ§åˆ¶åŠŸèƒ½è®¿é—®
3. **æ¸…æ™°è¾¹ç•Œ**ï¼šæ˜ç¡®åŒºåˆ†è½»é‡ç‰ˆå’Œ PRO ç‰ˆçš„åŠŸèƒ½
4. **æ˜“äºç»´æŠ¤**ï¼šç‰ˆæœ¬å·®å¼‚çš„ä¿®æ”¹ä¸å½±å“å…¶ä»–ç‰ˆæœ¬
5. **çµæ´»æ‰©å±•**ï¼šæ”¯æŒæœªæ¥æ–°å¢ç‰ˆæœ¬ï¼ˆå¦‚ Enterprise ç‰ˆï¼‰

## ğŸ—ï¸ æ¶æ„è®¾è®¡æ–¹æ¡ˆ

### æ–¹æ¡ˆä¸€ï¼šåŠŸèƒ½ç‰¹æ€§æ¨¡å¼ï¼ˆFeature Flags Patternï¼‰- æ¨è â­

**æ ¸å¿ƒæ€æƒ³**ï¼šåŒä¸€ä¸ªåº”ç”¨ä»£ç åº“ï¼Œé€šè¿‡åŠŸèƒ½ç‰¹æ€§å¼€å…³æ§åˆ¶ä¸åŒç‰ˆæœ¬çš„åŠŸèƒ½ã€‚

#### ç›®å½•ç»“æ„

```
riveredge-backend/src/apps/
â”œâ”€â”€ shared/                      # å…±äº«éƒ¨åˆ†
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ mes/                        # MES åº”ç”¨
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ domain/                  # é¢†åŸŸå±‚
â”‚   â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â”‚   â”œâ”€â”€ production_order.py      # ç”Ÿäº§è®¢å•ï¼ˆå…±äº«ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ production_plan.py       # ç”Ÿäº§è®¡åˆ’ï¼ˆPRO ç‰ˆï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ quality_inspection.py    # è´¨é‡æ£€éªŒï¼ˆPRO ç‰ˆï¼‰
â”‚   â”‚   â””â”€â”€ features/            # åŠŸèƒ½ç‰¹æ€§å®šä¹‰
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ feature_flags.py # åŠŸèƒ½ç‰¹æ€§å¼€å…³
â”‚   â”‚       â””â”€â”€ feature_registry.py # åŠŸèƒ½ç‰¹æ€§æ³¨å†Œè¡¨
â”‚   â”œâ”€â”€ application/             # åº”ç”¨å±‚
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ production_order_service.py  # ç”Ÿäº§è®¢å•æœåŠ¡ï¼ˆå…±äº«ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ production_plan_service.py   # ç”Ÿäº§è®¡åˆ’æœåŠ¡ï¼ˆPRO ç‰ˆï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ quality_inspection_service.py # è´¨é‡æ£€éªŒæœåŠ¡ï¼ˆPRO ç‰ˆï¼‰
â”‚   â”‚   â””â”€â”€ decorators/          # åŠŸèƒ½ç‰¹æ€§è£…é¥°å™¨
â”‚   â”‚       â””â”€â”€ feature_required.py
â”‚   â””â”€â”€ infrastructure/
â”‚       â””â”€â”€ ...
â”‚
riveredge-frontend/src/apps/
â”œâ”€â”€ shared/                      # å…±äº«éƒ¨åˆ†
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ mes/                        # MES åº”ç”¨
â”‚   â”œâ”€â”€ index.tsx
â”‚   â”œâ”€â”€ features/                # åŠŸèƒ½ç‰¹æ€§
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ featureFlags.ts      # åŠŸèƒ½ç‰¹æ€§å¼€å…³
â”‚   â”‚   â””â”€â”€ featureRegistry.ts  # åŠŸèƒ½ç‰¹æ€§æ³¨å†Œè¡¨
â”‚   â”œâ”€â”€ pages/                   # é¡µé¢
â”‚   â”‚   â”œâ”€â”€ production/          # ç”Ÿäº§ç®¡ç†ï¼ˆå…±äº«ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ orders/          # ç”Ÿäº§è®¢å•ï¼ˆå…±äº«ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ plans/           # ç”Ÿäº§è®¡åˆ’ï¼ˆPRO ç‰ˆï¼‰
â”‚   â”‚   â””â”€â”€ quality/             # è´¨é‡ç®¡ç†ï¼ˆPRO ç‰ˆï¼‰
â”‚   â”‚       â””â”€â”€ inspection/      # è´¨é‡æ£€éªŒ
â”‚   â””â”€â”€ components/             # ç»„ä»¶
â”‚       â”œâ”€â”€ ProductionOrderList.tsx  # ç”Ÿäº§è®¢å•åˆ—è¡¨ï¼ˆå…±äº«ï¼‰
â”‚       â””â”€â”€ ProductionPlanEditor.tsx # ç”Ÿäº§è®¡åˆ’ç¼–è¾‘å™¨ï¼ˆPRO ç‰ˆï¼‰
```

#### å®ç°æ–¹å¼

**1. åŠŸèƒ½ç‰¹æ€§å®šä¹‰**

```python
# apps/mes/domain/features/feature_flags.py
from enum import Enum
from typing import Dict, Set

class AppEdition(Enum):
    """åº”ç”¨ç‰ˆæœ¬æšä¸¾"""
    LITE = "lite"      # è½»é‡ç‰ˆ
    PRO = "pro"        # PRO ç‰ˆ
    ENTERPRISE = "enterprise"  # ä¼ä¸šç‰ˆï¼ˆæœªæ¥æ‰©å±•ï¼‰

class FeatureFlag:
    """åŠŸèƒ½ç‰¹æ€§æ ‡å¿—"""
    
    # ç”Ÿäº§ç®¡ç†åŠŸèƒ½
    PRODUCTION_ORDER = "production_order"           # ç”Ÿäº§è®¢å•ï¼ˆå…±äº«ï¼‰
    PRODUCTION_PLAN = "production_plan"             # ç”Ÿäº§è®¡åˆ’ï¼ˆPRO ç‰ˆï¼‰
    PRODUCTION_SCHEDULING = "production_scheduling" # ç”Ÿäº§æ’ç¨‹ï¼ˆPRO ç‰ˆï¼‰
    
    # è´¨é‡ç®¡ç†åŠŸèƒ½
    QUALITY_INSPECTION = "quality_inspection"       # è´¨é‡æ£€éªŒï¼ˆPRO ç‰ˆï¼‰
    QUALITY_ANALYSIS = "quality_analysis"           # è´¨é‡åˆ†æï¼ˆPRO ç‰ˆï¼‰
    
    # è®¾å¤‡ç®¡ç†åŠŸèƒ½
    EQUIPMENT_MONITORING = "equipment_monitoring"   # è®¾å¤‡ç›‘æ§ï¼ˆPRO ç‰ˆï¼‰
    EQUIPMENT_MAINTENANCE = "equipment_maintenance" # è®¾å¤‡ç»´æŠ¤ï¼ˆPRO ç‰ˆï¼‰

# åŠŸèƒ½ç‰¹æ€§ä¸ç‰ˆæœ¬çš„æ˜ å°„å…³ç³»
FEATURE_EDITION_MAP: Dict[str, Set[AppEdition]] = {
    FeatureFlag.PRODUCTION_ORDER: {AppEdition.LITE, AppEdition.PRO, AppEdition.ENTERPRISE},
    FeatureFlag.PRODUCTION_PLAN: {AppEdition.PRO, AppEdition.ENTERPRISE},
    FeatureFlag.PRODUCTION_SCHEDULING: {AppEdition.PRO, AppEdition.ENTERPRISE},
    FeatureFlag.QUALITY_INSPECTION: {AppEdition.PRO, AppEdition.ENTERPRISE},
    FeatureFlag.QUALITY_ANALYSIS: {AppEdition.ENTERPRISE},
    FeatureFlag.EQUIPMENT_MONITORING: {AppEdition.PRO, AppEdition.ENTERPRISE},
    FeatureFlag.EQUIPMENT_MAINTENANCE: {AppEdition.ENTERPRISE},
}
```

**2. åŠŸèƒ½ç‰¹æ€§æ£€æŸ¥æœåŠ¡**

```python
# apps/mes/domain/features/feature_registry.py
from typing import Set
from apps.mes.domain.features.feature_flags import AppEdition, FeatureFlag, FEATURE_EDITION_MAP
from infra.domain.package_config import get_package_config, TenantPlan

class FeatureRegistry:
    """åŠŸèƒ½ç‰¹æ€§æ³¨å†Œè¡¨"""
    
    @staticmethod
    def get_edition_from_plan(plan: TenantPlan) -> AppEdition:
        """
        æ ¹æ®å¥—é¤è·å–åº”ç”¨ç‰ˆæœ¬
        
        Args:
            plan: ç§Ÿæˆ·å¥—é¤
            
        Returns:
            AppEdition: åº”ç”¨ç‰ˆæœ¬
        """
        config = get_package_config(plan)
        if config.get("allow_pro_apps", False):
            # æ ¹æ®å¥—é¤ç±»å‹åˆ¤æ–­ç‰ˆæœ¬
            if plan == TenantPlan.ENTERPRISE:
                return AppEdition.ENTERPRISE
            elif plan in [TenantPlan.PROFESSIONAL]:
                return AppEdition.PRO
            else:
                return AppEdition.LITE
        else:
            return AppEdition.LITE
    
    @staticmethod
    def is_feature_enabled(tenant_id: int, feature: str) -> bool:
        """
        æ£€æŸ¥åŠŸèƒ½ç‰¹æ€§æ˜¯å¦å¯ç”¨
        
        Args:
            tenant_id: ç§Ÿæˆ·ID
            feature: åŠŸèƒ½ç‰¹æ€§æ ‡å¿—
            
        Returns:
            bool: æ˜¯å¦å¯ç”¨
        """
        # 1. è·å–ç§Ÿæˆ·å¥—é¤
        from infra.services.tenant_service import TenantService
        tenant = await TenantService.get_tenant_by_id(tenant_id)
        
        # 2. æ ¹æ®å¥—é¤è·å–åº”ç”¨ç‰ˆæœ¬
        edition = FeatureRegistry.get_edition_from_plan(tenant.plan)
        
        # 3. æ£€æŸ¥åŠŸèƒ½ç‰¹æ€§æ˜¯å¦æ”¯æŒè¯¥ç‰ˆæœ¬
        supported_editions = FEATURE_EDITION_MAP.get(feature, set())
        return edition in supported_editions
    
    @staticmethod
    def get_enabled_features(tenant_id: int) -> Set[str]:
        """
        è·å–ç§Ÿæˆ·å¯ç”¨çš„æ‰€æœ‰åŠŸèƒ½ç‰¹æ€§
        
        Args:
            tenant_id: ç§Ÿæˆ·ID
            
        Returns:
            Set[str]: å¯ç”¨çš„åŠŸèƒ½ç‰¹æ€§é›†åˆ
        """
        # 1. è·å–ç§Ÿæˆ·å¥—é¤
        from infra.services.tenant_service import TenantService
        tenant = await TenantService.get_tenant_by_id(tenant_id)
        
        # 2. æ ¹æ®å¥—é¤è·å–åº”ç”¨ç‰ˆæœ¬
        edition = FeatureRegistry.get_edition_from_plan(tenant.plan)
        
        # 3. è¿”å›è¯¥ç‰ˆæœ¬æ”¯æŒçš„æ‰€æœ‰åŠŸèƒ½ç‰¹æ€§
        enabled_features = set()
        for feature, supported_editions in FEATURE_EDITION_MAP.items():
            if edition in supported_editions:
                enabled_features.add(feature)
        
        return enabled_features
```

**3. åŠŸèƒ½ç‰¹æ€§è£…é¥°å™¨**

```python
# apps/mes/application/decorators/feature_required.py
from functools import wraps
from typing import Callable, Any
from fastapi import HTTPException, status
from apps.mes.domain.features.feature_registry import FeatureRegistry
from infra.api.deps.deps import get_current_tenant

def feature_required(feature: str):
    """
    åŠŸèƒ½ç‰¹æ€§è£…é¥°å™¨
    
    ç”¨äºæ ‡è®°éœ€è¦ç‰¹å®šåŠŸèƒ½ç‰¹æ€§çš„æ–¹æ³•ï¼Œå¦‚æœç§Ÿæˆ·æ²¡æœ‰è¯¥åŠŸèƒ½ç‰¹æ€§ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚
    
    Args:
        feature: åŠŸèƒ½ç‰¹æ€§æ ‡å¿—
        
    Example:
        @feature_required(FeatureFlag.PRODUCTION_PLAN)
        async def create_production_plan(...):
            ...
    """
    def decorator(func: Callable) -> Callable:
        @wraps(func)
        async def wrapper(*args, **kwargs):
            # ä» kwargs æˆ– args ä¸­è·å– tenant_id
            tenant_id = None
            if 'tenant_id' in kwargs:
                tenant_id = kwargs['tenant_id']
            elif 'current_tenant' in kwargs:
                tenant_id = kwargs['current_tenant']
            elif len(args) > 0 and hasattr(args[0], 'tenant_id'):
                tenant_id = args[0].tenant_id
            
            if not tenant_id:
                raise HTTPException(
                    status_code=status.HTTP_400_BAD_REQUEST,
                    detail="æ— æ³•è·å–ç§Ÿæˆ·ID"
                )
            
            # æ£€æŸ¥åŠŸèƒ½ç‰¹æ€§æ˜¯å¦å¯ç”¨
            if not await FeatureRegistry.is_feature_enabled(tenant_id, feature):
                raise HTTPException(
                    status_code=status.HTTP_403_FORBIDDEN,
                    detail=f"å½“å‰å¥—é¤ä¸æ”¯æŒ {feature} åŠŸèƒ½ï¼Œè¯·å‡çº§åˆ° PRO ç‰ˆ"
                )
            
            return await func(*args, **kwargs)
        return wrapper
    return decorator
```

**4. åº”ç”¨æœåŠ¡ä¸­ä½¿ç”¨åŠŸèƒ½ç‰¹æ€§**

```python
# apps/mes/application/services/production_order_service.py
from apps.mes.domain.features.feature_flags import FeatureFlag
from apps.mes.application.decorators.feature_required import feature_required

class ProductionOrderService:
    """ç”Ÿäº§è®¢å•æœåŠ¡ï¼ˆå…±äº«åŠŸèƒ½ï¼‰"""
    
    async def create_order(self, ...):
        """åˆ›å»ºç”Ÿäº§è®¢å•ï¼ˆè½»é‡ç‰ˆå’Œ PRO ç‰ˆéƒ½æ”¯æŒï¼‰"""
        # å…±äº«é€»è¾‘ï¼Œä¸éœ€è¦åŠŸèƒ½ç‰¹æ€§æ£€æŸ¥
        pass

# apps/mes/application/services/production_plan_service.py
from apps.mes.domain.features.feature_flags import FeatureFlag
from apps.mes.application.decorators.feature_required import feature_required

class ProductionPlanService:
    """ç”Ÿäº§è®¡åˆ’æœåŠ¡ï¼ˆPRO ç‰ˆåŠŸèƒ½ï¼‰"""
    
    @feature_required(FeatureFlag.PRODUCTION_PLAN)
    async def create_plan(self, tenant_id: int, ...):
        """åˆ›å»ºç”Ÿäº§è®¡åˆ’ï¼ˆä»… PRO ç‰ˆæ”¯æŒï¼‰"""
        # PRO ç‰ˆç‰¹æœ‰é€»è¾‘
        pass
    
    @feature_required(FeatureFlag.PRODUCTION_PLAN)
    async def update_plan(self, tenant_id: int, ...):
        """æ›´æ–°ç”Ÿäº§è®¡åˆ’ï¼ˆä»… PRO ç‰ˆæ”¯æŒï¼‰"""
        # PRO ç‰ˆç‰¹æœ‰é€»è¾‘
        pass
```

**5. API è·¯ç”±ä¸­ä½¿ç”¨åŠŸèƒ½ç‰¹æ€§**

```python
# apps/mes/api/routes.py
from fastapi import APIRouter, Depends, HTTPException, status
from apps.mes.domain.features.feature_flags import FeatureFlag
from apps.mes.domain.features.feature_registry import FeatureRegistry
from apps.mes.application.services.production_order_service import ProductionOrderService
from apps.mes.application.services.production_plan_service import ProductionPlanService
from infra.api.deps.deps import get_current_tenant, get_current_user

router = APIRouter(prefix="/api/v1/apps/mes", tags=["MES"])

@router.post("/production-orders")
async def create_production_order(
    data: CreateProductionOrderDTO,
    current_tenant: int = Depends(get_current_tenant),
    current_user = Depends(get_current_user),
):
    """åˆ›å»ºç”Ÿäº§è®¢å•ï¼ˆè½»é‡ç‰ˆå’Œ PRO ç‰ˆéƒ½æ”¯æŒï¼‰"""
    service = ProductionOrderService()
    return await service.create_order(
        tenant_id=current_tenant,
        data=data,
        user_id=current_user.uuid,
    )

@router.post("/production-plans")
async def create_production_plan(
    data: CreateProductionPlanDTO,
    current_tenant: int = Depends(get_current_tenant),
    current_user = Depends(get_current_user),
):
    """åˆ›å»ºç”Ÿäº§è®¡åˆ’ï¼ˆä»… PRO ç‰ˆæ”¯æŒï¼‰"""
    # æ£€æŸ¥åŠŸèƒ½ç‰¹æ€§
    if not await FeatureRegistry.is_feature_enabled(current_tenant, FeatureFlag.PRODUCTION_PLAN):
        raise HTTPException(
            status_code=status.HTTP_403_FORBIDDEN,
            detail="å½“å‰å¥—é¤ä¸æ”¯æŒç”Ÿäº§è®¡åˆ’åŠŸèƒ½ï¼Œè¯·å‡çº§åˆ° PRO ç‰ˆ"
        )
    
    service = ProductionPlanService()
    return await service.create_plan(
        tenant_id=current_tenant,
        data=data,
        user_id=current_user.uuid,
    )
```

**6. å‰ç«¯åŠŸèƒ½ç‰¹æ€§æ§åˆ¶**

```typescript
// apps/mes/features/featureFlags.ts
import { useGlobalStore } from '../../../stores';
import { getTenantPlan } from '../../../services/tenant';

export enum AppEdition {
  LITE = 'lite',
  PRO = 'pro',
  ENTERPRISE = 'enterprise',
}

export enum FeatureFlag {
  // ç”Ÿäº§ç®¡ç†åŠŸèƒ½
  PRODUCTION_ORDER = 'production_order',
  PRODUCTION_PLAN = 'production_plan',
  PRODUCTION_SCHEDULING = 'production_scheduling',
  
  // è´¨é‡ç®¡ç†åŠŸèƒ½
  QUALITY_INSPECTION = 'quality_inspection',
  QUALITY_ANALYSIS = 'quality_analysis',
  
  // è®¾å¤‡ç®¡ç†åŠŸèƒ½
  EQUIPMENT_MONITORING = 'equipment_monitoring',
  EQUIPMENT_MAINTENANCE = 'equipment_maintenance',
}

// åŠŸèƒ½ç‰¹æ€§ä¸ç‰ˆæœ¬çš„æ˜ å°„å…³ç³»
const FEATURE_EDITION_MAP: Record<string, AppEdition[]> = {
  [FeatureFlag.PRODUCTION_ORDER]: [AppEdition.LITE, AppEdition.PRO, AppEdition.ENTERPRISE],
  [FeatureFlag.PRODUCTION_PLAN]: [AppEdition.PRO, AppEdition.ENTERPRISE],
  [FeatureFlag.PRODUCTION_SCHEDULING]: [AppEdition.PRO, AppEdition.ENTERPRISE],
  [FeatureFlag.QUALITY_INSPECTION]: [AppEdition.PRO, AppEdition.ENTERPRISE],
  [FeatureFlag.QUALITY_ANALYSIS]: [AppEdition.ENTERPRISE],
  [FeatureFlag.EQUIPMENT_MONITORING]: [AppEdition.PRO, AppEdition.ENTERPRISE],
  [FeatureFlag.EQUIPMENT_MAINTENANCE]: [AppEdition.ENTERPRISE],
};

/**
 * æ ¹æ®å¥—é¤è·å–åº”ç”¨ç‰ˆæœ¬
 */
export function getEditionFromPlan(plan: string): AppEdition {
  const planConfig = {
    trial: AppEdition.LITE,
    basic: AppEdition.LITE,
    professional: AppEdition.PRO,
    enterprise: AppEdition.ENTERPRISE,
  };
  return planConfig[plan as keyof typeof planConfig] || AppEdition.LITE;
}

/**
 * æ£€æŸ¥åŠŸèƒ½ç‰¹æ€§æ˜¯å¦å¯ç”¨
 */
export function isFeatureEnabled(feature: FeatureFlag): boolean {
  const { currentTenant } = useGlobalStore.getState();
  if (!currentTenant) return false;
  
  const edition = getEditionFromPlan(currentTenant.plan);
  const supportedEditions = FEATURE_EDITION_MAP[feature] || [];
  return supportedEditions.includes(edition);
}

/**
 * è·å–å¯ç”¨çš„æ‰€æœ‰åŠŸèƒ½ç‰¹æ€§
 */
export function getEnabledFeatures(): FeatureFlag[] {
  const { currentTenant } = useGlobalStore.getState();
  if (!currentTenant) return [];
  
  const edition = getEditionFromPlan(currentTenant.plan);
  const enabledFeatures: FeatureFlag[] = [];
  
  for (const [feature, supportedEditions] of Object.entries(FEATURE_EDITION_MAP)) {
    if (supportedEditions.includes(edition)) {
      enabledFeatures.push(feature as FeatureFlag);
    }
  }
  
  return enabledFeatures;
}
```

**7. å‰ç«¯ç»„ä»¶ä¸­ä½¿ç”¨åŠŸèƒ½ç‰¹æ€§**

```typescript
// apps/mes/pages/production/index.tsx
import React from 'react';
import { Card, Button, Space } from 'antd';
import { isFeatureEnabled, FeatureFlag } from '../../features/featureFlags';
import { ProductionOrderList } from '../../components/ProductionOrderList';
import { ProductionPlanList } from '../../components/ProductionPlanList';

export const ProductionPage: React.FC = () => {
  const canUseProductionPlan = isFeatureEnabled(FeatureFlag.PRODUCTION_PLAN);
  
  return (
    <div>
      <Space direction="vertical" size="large" style={{ width: '100%' }}>
        {/* ç”Ÿäº§è®¢å•ï¼ˆè½»é‡ç‰ˆå’Œ PRO ç‰ˆéƒ½æ”¯æŒï¼‰ */}
        <Card title="ç”Ÿäº§è®¢å•">
          <ProductionOrderList />
        </Card>
        
        {/* ç”Ÿäº§è®¡åˆ’ï¼ˆä»… PRO ç‰ˆæ”¯æŒï¼‰ */}
        {canUseProductionPlan && (
          <Card title="ç”Ÿäº§è®¡åˆ’">
            <ProductionPlanList />
          </Card>
        )}
        
        {/* å¦‚æœæ²¡æœ‰ PRO ç‰ˆåŠŸèƒ½ï¼Œæ˜¾ç¤ºå‡çº§æç¤º */}
        {!canUseProductionPlan && (
          <Card>
            <div style={{ textAlign: 'center', padding: '20px' }}>
              <p>ç”Ÿäº§è®¡åˆ’åŠŸèƒ½éœ€è¦ PRO ç‰ˆå¥—é¤</p>
              <Button type="primary" onClick={() => {/* è·³è½¬åˆ°å‡çº§é¡µé¢ */}}>
                å‡çº§åˆ° PRO ç‰ˆ
              </Button>
            </div>
          </Card>
        )}
      </Space>
    </div>
  );
};
```

**8. å‰ç«¯è·¯ç”±ä¸­ä½¿ç”¨åŠŸèƒ½ç‰¹æ€§**

```typescript
// apps/mes/routes.tsx
import React from 'react';
import { Route, Routes } from 'react-router-dom';
import { isFeatureEnabled, FeatureFlag } from './features/featureFlags';
import { ProductionOrderListPage } from './pages/production/orders';
import { ProductionPlanListPage } from './pages/production/plans';

export const MESRoutes: React.FC = () => {
  const canUseProductionPlan = isFeatureEnabled(FeatureFlag.PRODUCTION_PLAN);
  
  return (
    <Routes>
      {/* ç”Ÿäº§è®¢å•ï¼ˆè½»é‡ç‰ˆå’Œ PRO ç‰ˆéƒ½æ”¯æŒï¼‰ */}
      <Route path="/production/orders" element={<ProductionOrderListPage />} />
      
      {/* ç”Ÿäº§è®¡åˆ’ï¼ˆä»… PRO ç‰ˆæ”¯æŒï¼‰ */}
      {canUseProductionPlan && (
        <Route path="/production/plans" element={<ProductionPlanListPage />} />
      )}
    </Routes>
  );
};
```

### æ–¹æ¡ˆäºŒï¼šä»£ç åˆ†ç¦»æ¨¡å¼ï¼ˆCode Separation Patternï¼‰

**æ ¸å¿ƒæ€æƒ³**ï¼šè½»é‡ç‰ˆå’Œ PRO ç‰ˆä½¿ç”¨ä¸åŒçš„ä»£ç åº“ï¼Œé€šè¿‡å…±äº«åº“å¤ç”¨ä»£ç ã€‚

#### ç›®å½•ç»“æ„

```
riveredge-backend/src/apps/
â”œâ”€â”€ shared/                      # å…±äº«éƒ¨åˆ†
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ mes-lite/                    # MES è½»é‡ç‰ˆ
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ domain/                  # è½»é‡ç‰ˆé¢†åŸŸå±‚
â”‚   â”œâ”€â”€ application/             # è½»é‡ç‰ˆåº”ç”¨å±‚
â”‚   â””â”€â”€ infrastructure/          # è½»é‡ç‰ˆåŸºç¡€è®¾æ–½å±‚
â”‚
â””â”€â”€ mes-pro/                     # MES PRO ç‰ˆ
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ domain/                  # PRO ç‰ˆé¢†åŸŸå±‚ï¼ˆç»§æ‰¿è½»é‡ç‰ˆï¼‰
    â”œâ”€â”€ application/             # PRO ç‰ˆåº”ç”¨å±‚ï¼ˆç»§æ‰¿è½»é‡ç‰ˆï¼‰
    â””â”€â”€ infrastructure/          # PRO ç‰ˆåŸºç¡€è®¾æ–½å±‚
```

**ä¼˜ç‚¹**ï¼š
- ä»£ç å®Œå…¨åˆ†ç¦»ï¼Œç‰ˆæœ¬é—´äº’ä¸å½±å“
- å¯ä»¥ç‹¬ç«‹éƒ¨ç½²å’Œå‡çº§

**ç¼ºç‚¹**ï¼š
- ä»£ç é‡å¤ï¼Œç»´æŠ¤æˆæœ¬é«˜
- å…±äº«ä»£ç ä¿®æ”¹éœ€è¦åŒæ­¥åˆ°å¤šä¸ªç‰ˆæœ¬

**é€‚ç”¨åœºæ™¯**ï¼š
- è½»é‡ç‰ˆå’Œ PRO ç‰ˆåŠŸèƒ½å·®å¼‚å¾ˆå¤§
- éœ€è¦ç‹¬ç«‹éƒ¨ç½²å’Œå‡çº§
- å›¢é˜Ÿè§„æ¨¡è¾ƒå¤§ï¼Œå¯ä»¥åˆ†åˆ«ç»´æŠ¤

### æ–¹æ¡ˆä¸‰ï¼šæ¨¡å—åŒ–ç»„åˆæ¨¡å¼ï¼ˆModular Composition Patternï¼‰

**æ ¸å¿ƒæ€æƒ³**ï¼šå°†åŠŸèƒ½æ‹†åˆ†ä¸ºç‹¬ç«‹æ¨¡å—ï¼Œé€šè¿‡æ¨¡å—ç»„åˆå®ç°ä¸åŒç‰ˆæœ¬ã€‚

#### ç›®å½•ç»“æ„

```
riveredge-backend/src/apps/
â”œâ”€â”€ shared/                      # å…±äº«éƒ¨åˆ†
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ mes/                        # MES åº”ç”¨
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ core/                   # æ ¸å¿ƒæ¨¡å—ï¼ˆè½»é‡ç‰ˆï¼‰
â”‚   â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”œâ”€â”€ application/
â”‚   â”‚   â””â”€â”€ infrastructure/
â”‚   â”œâ”€â”€ modules/                 # åŠŸèƒ½æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ production_plan/    # ç”Ÿäº§è®¡åˆ’æ¨¡å—ï¼ˆPRO ç‰ˆï¼‰
â”‚   â”‚   â”œâ”€â”€ quality_inspection/ # è´¨é‡æ£€éªŒæ¨¡å—ï¼ˆPRO ç‰ˆï¼‰
â”‚   â”‚   â””â”€â”€ equipment_monitoring/ # è®¾å¤‡ç›‘æ§æ¨¡å—ï¼ˆPRO ç‰ˆï¼‰
â”‚   â””â”€â”€ config/                  # æ¨¡å—é…ç½®
â”‚       â””â”€â”€ module_registry.py  # æ¨¡å—æ³¨å†Œè¡¨
```

**ä¼˜ç‚¹**ï¼š
- æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±•
- å¯ä»¥çµæ´»ç»„åˆåŠŸèƒ½æ¨¡å—

**ç¼ºç‚¹**ï¼š
- æ¶æ„å¤æ‚åº¦è¾ƒé«˜
- æ¨¡å—é—´ä¾èµ–ç®¡ç†å¤æ‚

**é€‚ç”¨åœºæ™¯**ï¼š
- åŠŸèƒ½æ¨¡å—åŒ–ç¨‹åº¦é«˜
- éœ€è¦çµæ´»ç»„åˆåŠŸèƒ½
- æœªæ¥å¯èƒ½æ–°å¢æ›´å¤šç‰ˆæœ¬

## ğŸ“ æ¨èæ–¹æ¡ˆ

**æ¨èä½¿ç”¨æ–¹æ¡ˆä¸€ï¼šåŠŸèƒ½ç‰¹æ€§æ¨¡å¼ï¼ˆFeature Flags Patternï¼‰**

**ç†ç”±**ï¼š
1. âœ… **ä»£ç å¤ç”¨æœ€å¤§åŒ–**ï¼šæ‰€æœ‰ç‰ˆæœ¬å…±äº«åŒä¸€å¥—ä»£ç ï¼Œå‡å°‘é‡å¤å¼€å‘
2. âœ… **ç»´æŠ¤æˆæœ¬ä½**ï¼šåŠŸèƒ½ä¿®æ”¹åªéœ€ä¿®æ”¹ä¸€å¤„ï¼Œæ‰€æœ‰ç‰ˆæœ¬è‡ªåŠ¨å—ç›Š
3. âœ… **çµæ´»æ§åˆ¶**ï¼šé€šè¿‡åŠŸèƒ½ç‰¹æ€§å¼€å…³çµæ´»æ§åˆ¶åŠŸèƒ½è®¿é—®
4. âœ… **æ˜“äºæ‰©å±•**ï¼šæ–°å¢ç‰ˆæœ¬åªéœ€æ›´æ–°åŠŸèƒ½ç‰¹æ€§æ˜ å°„å…³ç³»
5. âœ… **æ¸…æ™°è¾¹ç•Œ**ï¼šé€šè¿‡åŠŸèƒ½ç‰¹æ€§æ˜ç¡®åŒºåˆ†ä¸åŒç‰ˆæœ¬çš„åŠŸèƒ½

## ğŸ¯ å®æ–½å»ºè®®

### 1. åŠŸèƒ½ç‰¹æ€§è®¾è®¡

**âœ… å¥½çš„å®è·µ**ï¼š
- åŠŸèƒ½ç‰¹æ€§ç²’åº¦é€‚ä¸­ï¼Œä¸è¦è¿‡ç»†ä¹Ÿä¸è¦è¿‡ç²—
- åŠŸèƒ½ç‰¹æ€§å‘½åæ¸…æ™°ï¼Œè¡¨è¾¾ä¸šåŠ¡æ„å›¾
- å»ºç«‹åŠŸèƒ½ç‰¹æ€§æ–‡æ¡£ï¼Œè¯´æ˜æ¯ä¸ªç‰¹æ€§çš„ç”¨é€”å’Œç‰ˆæœ¬è¦æ±‚

**âŒ ä¸å¥½çš„å®è·µ**ï¼š
- åŠŸèƒ½ç‰¹æ€§ç²’åº¦è¿‡ç»†ï¼Œå¯¼è‡´ç®¡ç†å¤æ‚
- åŠŸèƒ½ç‰¹æ€§å‘½åä¸æ¸…æ™°ï¼Œéš¾ä»¥ç†è§£
- ç¼ºå°‘åŠŸèƒ½ç‰¹æ€§æ–‡æ¡£

### 2. æƒé™æ§åˆ¶

**âœ… å¥½çš„å®è·µ**ï¼š
- åœ¨ API å±‚å’Œå‰ç«¯éƒ½è¿›è¡ŒåŠŸèƒ½ç‰¹æ€§æ£€æŸ¥
- æä¾›å‹å¥½çš„é”™è¯¯æç¤ºï¼Œå¼•å¯¼ç”¨æˆ·å‡çº§
- åœ¨ UI ä¸­éšè—ä¸æ”¯æŒçš„åŠŸèƒ½ï¼Œè€Œä¸æ˜¯æ˜¾ç¤ºç¦ç”¨çŠ¶æ€

**âŒ ä¸å¥½çš„å®è·µ**ï¼š
- åªåœ¨ API å±‚æ£€æŸ¥ï¼Œå‰ç«¯ä¸æ£€æŸ¥
- é”™è¯¯æç¤ºä¸å‹å¥½ï¼Œç”¨æˆ·ä¸çŸ¥é“å¦‚ä½•å‡çº§
- åœ¨ UI ä¸­æ˜¾ç¤ºç¦ç”¨åŠŸèƒ½ï¼Œå½±å“ç”¨æˆ·ä½“éªŒ

### 3. æ•°æ®æ¨¡å‹è®¾è®¡

**âœ… å¥½çš„å®è·µ**ï¼š
- å…±äº«æ•°æ®æ¨¡å‹æ”¾åœ¨ `shared` ç›®å½•
- PRO ç‰ˆæ‰©å±•æ•°æ®é€šè¿‡å¤–é”®å…³è”å…±äº«æ•°æ®
- ä½¿ç”¨æ•°æ®åº“è§†å›¾æˆ–æŸ¥è¯¢ä¼˜åŒ–è·¨ç‰ˆæœ¬æ•°æ®è®¿é—®

**âŒ ä¸å¥½çš„å®è·µ**ï¼š
- åœ¨å…±äº«æ•°æ®æ¨¡å‹ä¸­åŒ…å«ç‰ˆæœ¬ç‰¹å®šå­—æ®µ
- PRO ç‰ˆæ•°æ®ä¸å…±äº«æ•°æ®è€¦åˆ
- ç¼ºå°‘æ•°æ®è®¿é—®ä¼˜åŒ–

## ğŸ¯ æ€»ç»“

é€šè¿‡åŠŸèƒ½ç‰¹æ€§æ¨¡å¼ï¼ˆFeature Flags Patternï¼‰å¤„ç†è½»é‡ç‰ˆå’Œ PRO ç‰ˆï¼š

1. **ä»£ç å¤ç”¨**ï¼šæ‰€æœ‰ç‰ˆæœ¬å…±äº«åŒä¸€å¥—ä»£ç 
2. **åŠŸèƒ½æ§åˆ¶**ï¼šé€šè¿‡åŠŸèƒ½ç‰¹æ€§å¼€å…³æ§åˆ¶åŠŸèƒ½è®¿é—®
3. **æƒé™ç®¡ç†**ï¼šåŸºäºå¥—é¤å’Œæƒé™æ§åˆ¶åŠŸèƒ½è®¿é—®
4. **æ˜“äºç»´æŠ¤**ï¼šåŠŸèƒ½ä¿®æ”¹åªéœ€ä¿®æ”¹ä¸€å¤„
5. **çµæ´»æ‰©å±•**ï¼šæ”¯æŒæœªæ¥æ–°å¢ç‰ˆæœ¬

**å…³é”®åŸåˆ™**ï¼š
- âœ… åŠŸèƒ½ç‰¹æ€§ç²’åº¦é€‚ä¸­
- âœ… åœ¨ API å±‚å’Œå‰ç«¯éƒ½è¿›è¡ŒåŠŸèƒ½ç‰¹æ€§æ£€æŸ¥
- âœ… æä¾›å‹å¥½çš„é”™è¯¯æç¤ºå’Œå‡çº§å¼•å¯¼
- âœ… å…±äº«æ•°æ®æ¨¡å‹ï¼ŒPRO ç‰ˆé€šè¿‡æ‰©å±•è¡¨å…³è”


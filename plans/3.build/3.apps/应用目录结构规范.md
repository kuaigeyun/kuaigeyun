# 应用目录结构规范

## 📋 概述

本文档定义业务模块应用的标准目录结构，确保所有模块遵循统一的组织规范。

## 🏗️ 目录结构

### 后端目录结构（riveredge-backend/src/apps/{app_code}/）

```
{app_code}/
├── __init__.py                    # Python包初始化文件
├── manifest.json                  # 应用清单文件（应用注册信息）
│
├── api/                           # API路由层
│   ├── __init__.py
│   ├── router.py                  # 主路由文件（统一导出所有路由）
│   └── {module}/                  # 功能模块路由（如orders、workorders等）
│       ├── __init__.py
│       └── {module}.py            # 具体路由实现
│
├── models/                        # 数据模型层
│   ├── __init__.py
│   └── {model}.py                 # 数据模型定义（Tortoise ORM）
│
├── schemas/                       # 数据验证层
│   ├── __init__.py
│   └── {schema}.py                # Pydantic Schema定义
│
├── services/                      # 业务逻辑层
│   ├── __init__.py
│   └── {service}.py               # 业务服务实现
│
├── utils/                         # 工具函数（可选）
│   ├── __init__.py
│   └── {util}.py                  # 工具函数
│
└── inngest/                       # Inngest异步任务（可选）
    ├── __init__.py
    └── functions/                 # 异步任务函数
        └── {function}.py          # 具体任务实现
```

### 前端目录结构（riveredge-frontend/src/apps/{app_code}/）

```
{app_code}/
├── index.tsx                      # 应用入口文件
├── routes.tsx                     # 路由配置（可选，也可在全局routes中配置）
│
├── pages/                         # 页面组件
│   ├── {module}/                  # 功能模块页面
│   │   ├── index.tsx              # 列表页
│   │   ├── create.tsx             # 创建页
│   │   ├── edit.tsx               # 编辑页
│   │   └── detail.tsx             # 详情页
│   └── ...
│
├── components/                    # 页面组件（可选）
│   └── {component}.tsx            # 组件实现
│
├── services/                      # API服务层
│   ├── index.ts                   # 服务统一导出
│   └── {service}.ts               # 具体API服务
│
├── types/                         # TypeScript类型定义
│   ├── index.ts                   # 类型统一导出
│   └── {type}.ts                  # 具体类型定义
│
└── hooks/                         # React Hooks（可选）
    └── {hook}.ts                  # 自定义Hook
```

## 📝 文件命名规范

### 后端文件命名
- **Python文件**：使用小写字母和下划线（snake_case）
  - 例如：`order_service.py`, `work_order.py`
- **类名**：使用大驼峰（PascalCase）
  - 例如：`OrderService`, `WorkOrder`
- **函数/变量名**：使用小写字母和下划线（snake_case）
  - 例如：`get_order_list()`, `order_status`

### 前端文件命名
- **TypeScript/TSX文件**：使用小驼峰（camelCase）
  - 例如：`orderList.tsx`, `workOrderService.ts`
- **组件名**：使用大驼峰（PascalCase）
  - 例如：`OrderList`, `WorkOrderForm`
- **函数/变量名**：使用小驼峰（camelCase）
  - 例如：`getOrderList()`, `orderStatus`

## 🔧 代码组织规范

### 1. API路由层（api/）
- **职责**：处理HTTP请求、参数验证、响应格式化
- **规范**：
  - 使用FastAPI路由装饰器
  - 统一错误处理
  - 统一响应格式
  - 权限验证

### 2. 数据模型层（models/）
- **职责**：定义数据库模型、数据关系
- **规范**：
  - 使用Tortoise ORM
  - 继承BaseModel（包含tenant_id）
  - 定义模型关系
  - 数据验证规则

### 3. 数据验证层（schemas/）
- **职责**：定义API输入输出数据结构
- **规范**：
  - 使用Pydantic Schema
  - 输入验证（CreateSchema）
  - 输出验证（ResponseSchema）
  - 更新验证（UpdateSchema）

### 4. 业务逻辑层（services/）
- **职责**：实现业务逻辑、业务规则
- **规范**：
  - 业务逻辑封装
  - 数据访问封装
  - 异常处理
  - 事务管理

### 5. 前端页面层（pages/）
- **职责**：用户界面、用户交互
- **规范**：
  - 使用Ant Design ProComponents
  - 统一页面布局
  - 统一表单验证
  - 统一错误处理

### 6. API服务层（services/）
- **职责**：封装后端API调用
- **规范**：
  - 使用统一的API请求函数
  - 统一错误处理
  - 类型安全
  - 请求/响应拦截

## 📦 依赖管理

### 后端依赖
- 在 `riveredge-backend/requirements.txt` 中统一管理
- 应用特定依赖在 `manifest.json` 的 `dependencies` 中声明

### 前端依赖
- 在 `riveredge-frontend/package.json` 中统一管理
- 应用特定依赖在 `manifest.json` 的 `dependencies` 中声明

## 🔗 集成规范

### 1. 主数据集成
- 所有基础数据从 `master-data` 模块获取
- 使用统一的主数据查询API
- 不维护数据档案，只使用数据

### 2. 模块间集成
- 使用统一的API接口规范
- 使用事件通知机制
- 使用数据查询接口

### 3. 权限集成
- 使用系统统一的权限管理
- 权限代码格式：`{app_code}:{module}:{action}`
- 例如：`kuaicrm:order:view`

## 📋 开发检查清单

### 后端开发
- [ ] 创建应用目录结构
- [ ] 创建 `manifest.json` 文件
- [ ] 定义数据模型（Models）
- [ ] 定义数据验证（Schemas）
- [ ] 实现业务服务（Services）
- [ ] 实现API路由（API）
- [ ] 配置路由注册
- [ ] 编写单元测试
- [ ] 编写API文档

### 前端开发
- [ ] 创建应用目录结构
- [ ] 创建应用入口文件（index.tsx）
- [ ] 定义TypeScript类型（types/）
- [ ] 实现API服务（services/）
- [ ] 实现页面组件（pages/）
- [ ] 配置路由
- [ ] 实现权限控制
- [ ] 编写组件测试

## 🎯 最佳实践

1. **模块化设计**：每个功能模块独立，便于维护
2. **代码复用**：公共逻辑提取到utils或shared目录
3. **类型安全**：前后端都使用类型定义，确保类型安全
4. **错误处理**：统一的错误处理和错误提示
5. **日志记录**：关键操作记录日志，便于排查问题
6. **性能优化**：数据库查询优化、API响应优化
7. **安全控制**：权限验证、数据验证、SQL注入防护

---

**注意**：所有模块必须遵循此目录结构规范，确保代码组织清晰、易于维护。

# è¿ç§»çŠ¶æ€æ£€æŸ¥æŠ¥å‘Š

## ğŸ“‹ æ¦‚è¿°

æ£€æŸ¥ `riveredge-root` å’Œ `riveredge-stem` åˆ°æ–°æ¶æ„çš„è¿ç§»å®Œæˆæƒ…å†µã€‚

**æ£€æŸ¥æ—¶é—´**: 2025-01-XX

---

## ğŸ”§ åç«¯è¿ç§»çŠ¶æ€ (riveredge-root â†’ riveredge-backend)

### âœ… å·²è¿ç§»çš„åŠŸèƒ½ï¼ˆå¹³å°çº§ - soil/ï¼‰

#### åŸºç¡€è®¾æ–½
- âœ… æ•°æ®åº“é…ç½® (`database_config.py`)
- âœ… å¹³å°é…ç½® (`platform_config.py`)
- âœ… è¶…ç®¡é…ç½® (`superadmin_config.py`)
- âœ… æ•°æ®åº“è¿æ¥ (`infrastructure/database/database.py`)
- âœ… ç¼“å­˜ç®¡ç† (`infrastructure/cache/cache.py`)
- âœ… æ—¥å¿—ç³»ç»Ÿ (`infrastructure/logging/logger.py`)

#### æ ¸å¿ƒåŠŸèƒ½
- âœ… ç§Ÿæˆ·ä¸Šä¸‹æ–‡ (`core/tenant_context.py`)
- âœ… æŸ¥è¯¢è¿‡æ»¤ (`core/query_filter.py`)
- âœ… æ—¶åŒºå·¥å…· (`core/timezone_utils.py`)
- âœ… å®‰å…¨è®¤è¯ (`core/security/security.py`, `superadmin_security.py`)
- âœ… å¼‚å¸¸å¤„ç† (`exceptions/exceptions.py`)

#### æ•°æ®æ¨¡å‹
- âœ… åŸºç¡€æ¨¡å‹ (`models/base.py`)
- âœ… ç§Ÿæˆ·æ¨¡å‹ (`models/tenant.py`)
- âœ… ç§Ÿæˆ·é…ç½® (`models/tenant_config.py`)
- âœ… ç§Ÿæˆ·æ´»åŠ¨æ—¥å¿— (`models/tenant_activity_log.py`)
- âœ… ç”¨æˆ·æ¨¡å‹ (`models/user.py`)
- âœ… å¥—é¤æ¨¡å‹ (`models/package.py`) - æ–°å¢

#### Schema
- âœ… ç§Ÿæˆ· Schema (`schemas/tenant.py`)
- âœ… ç”¨æˆ· Schema (`schemas/user.py`)
- âœ… è®¤è¯ Schema (`schemas/auth.py`)
- âœ… è¶…ç®¡ Schema (`schemas/superadmin.py`)
- âœ… å¥—é¤ Schema (`schemas/package.py`) - æ–°å¢

#### æœåŠ¡å±‚
- âœ… ç§Ÿæˆ·æœåŠ¡ (`services/tenant_service.py`)
- âœ… ç”¨æˆ·æœåŠ¡ (`services/user_service.py`)
- âœ… è®¤è¯æœåŠ¡ (`services/auth_service.py`)
- âœ… è¶…ç®¡è®¤è¯æœåŠ¡ (`services/superadmin_auth_service.py`)
- âœ… è¶…ç®¡æœåŠ¡ (`services/superadmin_service.py`)
- âœ… å¥—é¤æœåŠ¡ (`services/package_service.py`) - æ–°å¢

#### API å±‚
- âœ… è¶…ç®¡è®¤è¯ API (`api/auth/auth.py`)
- âœ… ç§Ÿæˆ·ç®¡ç† API (`api/tenants/tenants.py`)
- âœ… å¥—é¤ç®¡ç† API (`api/packages/packages.py`) - æ–°å¢
- âœ… ä¾èµ–æ³¨å…¥ (`api/deps/deps.py`)

### âš ï¸ æœªè¿ç§»çš„åŠŸèƒ½ï¼ˆæŒ‰è®¡åˆ’åº”å»æ‰ï¼‰

#### ç³»ç»Ÿçº§åŠŸèƒ½ï¼ˆtree-root/ å¾…è¿ç§»ï¼‰
- â³ ç”¨æˆ·ç®¡ç† API (`api/v1/users.py`) - ç³»ç»Ÿçº§ï¼Œå¾…è¿ç§»
- â³ è§’è‰²ç®¡ç† API (`api/v1/roles.py`) - ç³»ç»Ÿçº§ï¼Œå¾…è¿ç§»
- â³ æƒé™ç®¡ç† API (`api/v1/permissions.py`) - ç³»ç»Ÿçº§ï¼Œå¾…è¿ç§»
- â³ æ³¨å†Œ API (`api/v1/register.py`) - ç³»ç»Ÿçº§ï¼Œå¾…è¿ç§»
- â³ ä¿å­˜æœç´¢ API (`api/v1/saved_searches.py`) - ç³»ç»Ÿçº§ï¼Œå¾…è¿ç§»

#### ç›‘æ§åŠŸèƒ½ï¼ˆæŒ‰è®¡åˆ’å»æ‰ï¼‰
- âŒ ç›‘æ§æœåŠ¡ (`services/monitoring_service.py`) - æŒ‰è®¡åˆ’å»æ‰
- âŒ ç›‘æ§ API (`api/v1/superadmin/monitoring.py`) - æŒ‰è®¡åˆ’å»æ‰

#### æ’ä»¶åŠŸèƒ½ï¼ˆæŒ‰è®¡åˆ’å»æ‰ï¼‰
- âŒ æ’ä»¶ API (`api/v1/superadmin/plugins.py`) - æŒ‰è®¡åˆ’å»æ‰

#### æ•°æ®æ¨¡å‹ï¼ˆå¾…è¿ç§»æˆ–å»æ‰ï¼‰
- â³ æƒé™æ¨¡å‹ (`models/permission.py`) - ç³»ç»Ÿçº§ï¼Œå¾…è¿ç§»
- â³ è§’è‰²æ¨¡å‹ (`models/role.py`) - ç³»ç»Ÿçº§ï¼Œå¾…è¿ç§»
- â³ ä¿å­˜æœç´¢æ¨¡å‹ (`models/saved_search.py`) - ç³»ç»Ÿçº§ï¼Œå¾…è¿ç§»

#### æœåŠ¡å±‚ï¼ˆå¾…è¿ç§»æˆ–å»æ‰ï¼‰
- â³ æƒé™æœåŠ¡ (`services/permission_service.py`) - ç³»ç»Ÿçº§ï¼Œå¾…è¿ç§»
- â³ è§’è‰²æœåŠ¡ (`services/role_service.py`) - ç³»ç»Ÿçº§ï¼Œå¾…è¿ç§»
- â³ ä¿å­˜æœç´¢æœåŠ¡ (`services/saved_search_service.py`) - ç³»ç»Ÿçº§ï¼Œå¾…è¿ç§»

### âŒ ç¼ºå¤±çš„å…³é”®åŠŸèƒ½

#### åº”ç”¨å…¥å£
- âŒ **ä¸»åº”ç”¨å…¥å£ (`app/main.py`)** - éœ€è¦åˆ›å»º
- âŒ **åº”ç”¨é…ç½® (`app/config.py`)** - å·²è¿ç§»åˆ° `config/`ï¼Œä½†éœ€è¦æ•´åˆ
- âŒ **ä¸­é—´ä»¶ (`app/middleware.py`)** - éœ€è¦è¿ç§»æˆ–åˆ›å»º
- âŒ **ä¾èµ–æ³¨å…¥ (`app/dependencies.py`)** - å·²è¿ç§»åˆ° `api/deps/`ï¼Œä½†éœ€è¦æ•´åˆ

#### æ•°æ®åº“è¿ç§»
- âš ï¸ **è¿ç§»æ–‡ä»¶ (`migrations/`)** - éœ€è¦è¿ç§»æˆ–é‡æ–°ç”Ÿæˆ
- âš ï¸ **Aerich é…ç½®** - éœ€è¦æ›´æ–°è·¯å¾„

---

## ğŸ¨ å‰ç«¯è¿ç§»çŠ¶æ€ (riveredge-stem â†’ riveredge-frontend)

### âœ… å·²è¿ç§»çš„åŠŸèƒ½

#### å¹³å°çº§ (air/)
- âœ… ç»„ç»‡ç®¡ç†é¡µé¢ (`pages/tenants/list/`, `pages/tenants/detail/`)
- âœ… å¥—é¤ç®¡ç†é¡µé¢ (`pages/packages/`)
- âœ… ç»Ÿä¸€è¡¨æ ¼ç»„ä»¶ (`components/uni_table/`)
- âœ… ç»„ç»‡ç®¡ç†æœåŠ¡ (`services/tenant.ts`)
- âœ… è¶…ç®¡æœåŠ¡ (`services/superadmin.ts`)
- âœ… API åŸºç¡€é…ç½® (`services/api.ts`)

#### ç³»ç»Ÿçº§ (tree-stem/)
- âœ… å ä½ä»ªè¡¨æ¿ (`pages/dashboard/`)
- âœ… ç™»å½•é¡µé¢ (`pages/login/`)
- âœ… æ³¨å†Œé¡µé¢ (`pages/register/`)
- âœ… ç§Ÿæˆ·é€‰æ‹©æ¨¡æ€æ¡† (`components/tenant_selection_modal/`)
- âœ… æ¡æ¬¾æ¨¡æ€æ¡† (`components/terms_modal/`)
- âœ… è®¤è¯æœåŠ¡ (`services/auth.ts`)
- âœ… æ³¨å†ŒæœåŠ¡ (`services/register.ts`)
- âœ… å…¨å±€çŠ¶æ€ç®¡ç† (`stores/globalStore.ts`)
- âœ… è®¤è¯å·¥å…· (`utils/auth.ts`)
- âœ… API ç±»å‹å®šä¹‰ (`types/api.ts`)
- âœ… å…¨å±€æ ·å¼ (`global.less`)

### âš ï¸ æœªè¿ç§»çš„åŠŸèƒ½ï¼ˆæŒ‰è®¡åˆ’åº”å»æ‰ï¼‰

#### ç³»ç»Ÿçº§ç®¡ç†åŠŸèƒ½ï¼ˆå¾…è¿ç§»ï¼‰
- â³ ç”¨æˆ·ç®¡ç†é¡µé¢ (`pages/system/user/`) - ç³»ç»Ÿçº§ï¼Œå¾…è¿ç§»
- â³ è§’è‰²ç®¡ç†é¡µé¢ (`pages/system/role/`) - ç³»ç»Ÿçº§ï¼Œå¾…è¿ç§»

#### ç›‘æ§åŠŸèƒ½ï¼ˆæŒ‰è®¡åˆ’å»æ‰ï¼‰
- âŒ è¿è¥çœ‹æ¿ (`pages/operations/dashboard/`) - æŒ‰è®¡åˆ’å»æ‰
- âŒ ç³»ç»Ÿç›‘æ§ (`pages/operations/monitoring/`) - æŒ‰è®¡åˆ’å»æ‰

#### ç»„ä»¶ï¼ˆéƒ¨åˆ†è¿ç§»ï¼‰
- â³ ä¿å­˜æœç´¢ç»„ä»¶ (`components/riveredge_query/`) - ç³»ç»Ÿçº§ï¼Œå¾…è¿ç§»
- â³ ç§Ÿæˆ·é€‰æ‹©å™¨ (`components/tenant_selector/`) - ç³»ç»Ÿçº§ï¼Œå¾…è¿ç§»
- â³ é¡µé¢æ ‡ç­¾ (`components/page_tabs/`) - ç³»ç»Ÿçº§ï¼Œå¾…è¿ç§»
- â³ å¯¼å…¥ç»„ä»¶ (`components/lucky_import/`) - ç³»ç»Ÿçº§ï¼Œå¾…è¿ç§»

#### æœåŠ¡ï¼ˆå¾…è¿ç§»ï¼‰
- â³ ç”¨æˆ·æœåŠ¡ (`services/user.ts`) - ç³»ç»Ÿçº§ï¼Œå¾…è¿ç§»
- â³ è§’è‰²æœåŠ¡ (`services/role.ts`) - ç³»ç»Ÿçº§ï¼Œå¾…è¿ç§»
- â³ ä¿å­˜æœç´¢æœåŠ¡ (`services/savedSearch.ts`) - ç³»ç»Ÿçº§ï¼Œå¾…è¿ç§»

#### å·¥å…·å‡½æ•°ï¼ˆå¾…è¿ç§»ï¼‰
- â³ æ ¼å¼åŒ–å·¥å…· (`utils/format.ts`) - å¾…è¿ç§»
- â³ æ‹¼éŸ³å·¥å…· (`utils/pinyin.ts`) - å¾…è¿ç§»
- â³ å­˜å‚¨å·¥å…· (`utils/storage.ts`) - å¾…è¿ç§»

#### å…¶ä»–ï¼ˆå¾…è¿ç§»ï¼‰
- â³ æƒé™æ§åˆ¶ (`access.ts`) - ç³»ç»Ÿçº§ï¼Œå¾…è¿ç§»
- â³ å›½é™…åŒ– (`locales/`) - å¾…è¿ç§»
- â³ å¸ƒå±€ç»„ä»¶ (`layouts/BasicLayout.tsx`) - å¾…è¿ç§»
- â³ Hooks (`hooks/useProTableSearch.ts`) - å¾…è¿ç§»

---

## ğŸ“Š è¿ç§»å®Œæˆåº¦ç»Ÿè®¡

### åç«¯è¿ç§»å®Œæˆåº¦

| ç±»åˆ« | å·²è¿ç§» | å¾…è¿ç§» | æŒ‰è®¡åˆ’å»æ‰ | å®Œæˆåº¦ |
|------|--------|--------|------------|--------|
| åŸºç¡€è®¾æ–½ | 6/6 | 0 | 0 | âœ… 100% |
| æ ¸å¿ƒåŠŸèƒ½ | 5/5 | 0 | 0 | âœ… 100% |
| æ•°æ®æ¨¡å‹ | 6/9 | 3 | 0 | âš ï¸ 67% |
| Schema | 5/8 | 3 | 0 | âš ï¸ 63% |
| æœåŠ¡å±‚ | 6/9 | 3 | 0 | âš ï¸ 67% |
| API å±‚ | 4/9 | 3 | 2 | âš ï¸ 44% |
| **æ€»è®¡** | **32/46** | **12** | **2** | **âš ï¸ 70%** |

### å‰ç«¯è¿ç§»å®Œæˆåº¦

| ç±»åˆ« | å·²è¿ç§» | å¾…è¿ç§» | æŒ‰è®¡åˆ’å»æ‰ | å®Œæˆåº¦ |
|------|--------|--------|------------|--------|
| å¹³å°çº§é¡µé¢ | 2/2 | 0 | 0 | âœ… 100% |
| ç³»ç»Ÿçº§é¡µé¢ | 3/8 | 2 | 3 | âš ï¸ 38% |
| ç»„ä»¶ | 3/8 | 4 | 1 | âš ï¸ 38% |
| æœåŠ¡ | 5/8 | 3 | 0 | âš ï¸ 63% |
| å·¥å…·å‡½æ•° | 1/4 | 3 | 0 | âš ï¸ 25% |
| **æ€»è®¡** | **14/30** | **12** | **4** | **âš ï¸ 47%** |

---

## ğŸ¯ è¿ç§»çŠ¶æ€æ€»ç»“

### âœ… å·²å®Œæˆï¼ˆç¬¦åˆé‡æ„è®¡åˆ’ï¼‰

1. **å¹³å°çº§æ ¸å¿ƒåŠŸèƒ½** - âœ… 100% å®Œæˆ
   - ç»„ç»‡ç®¡ç†ï¼ˆå‰åç«¯ï¼‰
   - å¥—é¤ç®¡ç†ï¼ˆå‰åç«¯ï¼‰
   - è¶…ç®¡è®¤è¯ï¼ˆåç«¯ï¼‰

2. **ç³»ç»Ÿçº§åŸºç¡€åŠŸèƒ½** - âœ… 100% å®Œæˆ
   - ç™»å½•ï¼ˆå‰ç«¯ï¼‰
   - æ³¨å†Œï¼ˆå‰ç«¯ï¼‰
   - å ä½ä»ªè¡¨æ¿ï¼ˆå‰ç«¯ï¼‰

3. **åŸºç¡€è®¾æ–½** - âœ… 100% å®Œæˆ
   - æ•°æ®åº“ã€ç¼“å­˜ã€æ—¥å¿—é…ç½®
   - å®‰å…¨è®¤è¯ã€å¼‚å¸¸å¤„ç†

### âš ï¸ å¾…å®Œæˆï¼ˆæŒ‰é‡æ„è®¡åˆ’ï¼‰

1. **ç³»ç»Ÿçº§ç®¡ç†åŠŸèƒ½** - â³ å¾…è¿ç§»
   - ç”¨æˆ·ç®¡ç†ï¼ˆå‰åç«¯ï¼‰
   - è§’è‰²ç®¡ç†ï¼ˆå‰åç«¯ï¼‰
   - æƒé™ç®¡ç†ï¼ˆåç«¯ï¼‰
   - ä¿å­˜æœç´¢ï¼ˆå‰åç«¯ï¼‰

2. **åº”ç”¨å…¥å£å’Œé…ç½®** - âŒ ç¼ºå¤±
   - FastAPI ä¸»åº”ç”¨ (`app/main.py`)
   - ä¸­é—´ä»¶é…ç½®
   - è·¯ç”±æ•´åˆ

3. **æ•°æ®åº“è¿ç§»** - âš ï¸ å¾…å¤„ç†
   - è¿ç§»æ–‡ä»¶è·¯å¾„æ›´æ–°
   - Aerich é…ç½®æ›´æ–°

### âŒ æŒ‰è®¡åˆ’å»æ‰ï¼ˆä¸éœ€è¦è¿ç§»ï¼‰

1. **ç›‘æ§åŠŸèƒ½** - âŒ å·²å»æ‰
   - è¿è¥çœ‹æ¿
   - ç³»ç»Ÿç›‘æ§

2. **æ’ä»¶åŠŸèƒ½** - âŒ å·²å»æ‰
   - æ’ä»¶ç®¡ç† API

---

## ğŸš¨ å…³é”®é—®é¢˜

### 1. åº”ç”¨å…¥å£ç¼ºå¤±

**é—®é¢˜**: `riveredge-backend/soil/` å’Œ `riveredge-backend/tree-root/` éƒ½æ²¡æœ‰ä¸»åº”ç”¨å…¥å£æ–‡ä»¶ (`main.py`)

**å½±å“**: æ— æ³•å¯åŠ¨åç«¯æœåŠ¡

**è§£å†³æ–¹æ¡ˆ**: 
- éœ€è¦åˆ›å»º `soil/src/main.py` å’Œ `tree-root/src/main.py`
- æ•´åˆæ‰€æœ‰è·¯ç”±å’Œä¸­é—´ä»¶
- é…ç½®åº”ç”¨å¯åŠ¨é€»è¾‘

### 2. æ•°æ®åº“è¿ç§»è·¯å¾„

**é—®é¢˜**: è¿ç§»æ–‡ä»¶è¿˜åœ¨ `riveredge-root/migrations/`ï¼Œæ–°é¡¹ç›®éœ€è¦é‡æ–°é…ç½®

**å½±å“**: æ•°æ®åº“è¿ç§»æ— æ³•æ­£å¸¸å·¥ä½œ

**è§£å†³æ–¹æ¡ˆ**:
- è¿ç§»è¿ç§»æ–‡ä»¶åˆ°æ–°ä½ç½®
- æ›´æ–° Aerich é…ç½®è·¯å¾„
- æ›´æ–° Tortoise ORM é…ç½®

### 3. ç³»ç»Ÿçº§åŠŸèƒ½æœªè¿ç§»

**é—®é¢˜**: ç”¨æˆ·ç®¡ç†ã€è§’è‰²ç®¡ç†ã€æƒé™ç®¡ç†ç­‰ç³»ç»Ÿçº§åŠŸèƒ½è¿˜åœ¨æ—§é¡¹ç›®ä¸­

**å½±å“**: ç³»ç»Ÿçº§åŠŸèƒ½æ— æ³•ä½¿ç”¨

**è§£å†³æ–¹æ¡ˆ**:
- æŒ‰é‡æ„è®¡åˆ’ï¼Œè¿™äº›åŠŸèƒ½åº”è¯¥åœ¨ç¬¬äºŒé˜¶æ®µè¿ç§»
- å½“å‰é˜¶æ®µåªä¿è¯å¹³å°çº§è¿è¡Œ

---

## ğŸ“ å»ºè®®

### ç«‹å³å¤„ç†ï¼ˆé˜»å¡é—®é¢˜ï¼‰

1. **åˆ›å»ºåº”ç”¨å…¥å£**
   - åˆ›å»º `riveredge-backend/soil/src/main.py`
   - åˆ›å»º `riveredge-backend/tree-root/src/main.py`
   - æ•´åˆè·¯ç”±å’Œä¸­é—´ä»¶

2. **å¤„ç†æ•°æ®åº“è¿ç§»**
   - è¿ç§»è¿ç§»æ–‡ä»¶æˆ–é‡æ–°ç”Ÿæˆ
   - æ›´æ–° Aerich é…ç½®

### åç»­å¤„ç†ï¼ˆæŒ‰è®¡åˆ’ï¼‰

1. **ç³»ç»Ÿçº§åŠŸèƒ½è¿ç§»**ï¼ˆç¬¬äºŒé˜¶æ®µï¼‰
   - ç”¨æˆ·ç®¡ç†
   - è§’è‰²ç®¡ç†
   - æƒé™ç®¡ç†
   - ä¿å­˜æœç´¢

2. **å‰ç«¯ç»„ä»¶å®Œå–„**ï¼ˆç¬¬äºŒé˜¶æ®µï¼‰
   - å¸ƒå±€ç»„ä»¶
   - å·¥å…·å‡½æ•°
   - Hooks
   - å›½é™…åŒ–

---

## âœ… ç»“è®º

**è¿ç§»çŠ¶æ€**: âš ï¸ **éƒ¨åˆ†å®Œæˆ**ï¼ˆç¬¦åˆé‡æ„è®¡åˆ’ç¬¬ä¸€é˜¶æ®µç›®æ ‡ï¼‰

**å·²å®Œæˆ**:
- âœ… å¹³å°çº§æ ¸å¿ƒåŠŸèƒ½ï¼ˆç»„ç»‡ç®¡ç†ã€å¥—é¤ç®¡ç†ï¼‰
- âœ… ç³»ç»Ÿçº§åŸºç¡€åŠŸèƒ½ï¼ˆç™»å½•ã€æ³¨å†Œã€å ä½ä»ªè¡¨æ¿ï¼‰
- âœ… åŸºç¡€è®¾æ–½ï¼ˆæ•°æ®åº“ã€ç¼“å­˜ã€æ—¥å¿—ï¼‰

**å¾…å®Œæˆ**:
- â³ åº”ç”¨å…¥å£å’Œè·¯ç”±æ•´åˆï¼ˆé˜»å¡é—®é¢˜ï¼‰
- â³ æ•°æ®åº“è¿ç§»é…ç½®ï¼ˆé˜»å¡é—®é¢˜ï¼‰
- â³ ç³»ç»Ÿçº§ç®¡ç†åŠŸèƒ½ï¼ˆç¬¬äºŒé˜¶æ®µï¼‰

**ç¬¦åˆè®¡åˆ’**: âœ… å½“å‰è¿ç§»çŠ¶æ€ç¬¦åˆ"å¹³å°çº§ä¼˜å…ˆ"çš„é‡æ„è®¡åˆ’ï¼Œå¹³å°çº§åŠŸèƒ½å·²åŸºæœ¬å®Œæˆï¼Œç³»ç»Ÿçº§åŠŸèƒ½æŒ‰è®¡åˆ’åœ¨ç¬¬äºŒé˜¶æ®µè¿ç§»ã€‚

---

**æœ€åæ›´æ–°**: 2025-01-XX


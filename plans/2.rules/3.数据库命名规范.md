# RiverEdge SaaS å¤šç»„ç»‡æ¡†æ¶ - æ•°æ®åº“å‘½åè§„èŒƒ

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£å®šä¹‰ **RiverEdge SaaS å¤šç»„ç»‡æ¡†æ¶ (RiverEdge SaaS Multi-tenant Framework)** çš„**æ•°æ®åº“å‘½åè§„èŒƒ**ï¼Œç¡®ä¿æ•°æ®åº“è®¾è®¡è§„èŒƒç»Ÿä¸€ï¼Œæå‡æ•°æ®ä¸€è‡´æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

**å‘½åå“²å­¦**ï¼šè¡¨åå‰ç¼€éµå¾ªä¸»æµ B ç«¯é¡¹ç›®å‘½åè§„èŒƒï¼ˆå‚è€ƒ [1.æ¡†æ¶å‘½åå“²å­¦.md](./1.æ¡†æ¶å‘½åå“²å­¦.md)ï¼‰ï¼š
- `platform_` å‰ç¼€å¯¹åº”å¹³å°çº§åç«¯ï¼ˆå¹³å°ï¼‰- å¹³å°çº§åŠŸèƒ½ï¼ŒåŒ…æ‹¬ç§Ÿæˆ·ç®¡ç†ã€å¥—é¤ç®¡ç†ç­‰
- `core_` å‰ç¼€å¯¹åº”ç³»ç»Ÿçº§åç«¯ï¼ˆæ ¸å¿ƒï¼‰- ç³»ç»Ÿçº§åŠŸèƒ½ï¼ŒåŒ…æ‹¬ç”¨æˆ·ã€è§’è‰²ã€æƒé™ç­‰
- `seed_æ’ä»¶å_` å‰ç¼€å¯¹åº” `riveredge-seed`ï¼ˆåº”ç”¨æ’ä»¶ï¼Œå•æ•°å½¢å¼ï¼‰- åº”ç”¨çº§åŠŸèƒ½ï¼ŒåŒ…æ‹¬ MESã€ERPã€WMS ç­‰ä¸šåŠ¡æ’ä»¶

## ğŸ¯ å‘½ååŸåˆ™

1. **æ¡†æ¶å“²å­¦ä¸€è‡´æ€§**ï¼šè¡¨åå‰ç¼€å¿…é¡»ç¬¦åˆä¸»æµ B ç«¯é¡¹ç›®å‘½åè§„èŒƒï¼ˆplatform = å¹³å°çº§åç«¯ï¼Œcore = ç³»ç»Ÿçº§åç«¯ï¼Œseed = åº”ç”¨æ’ä»¶ï¼‰â­ **é‡è¦**
2. **æ¨¡å—åŒ–**ï¼šæ‰€æœ‰è¡¨åå¿…é¡»åŒ…å«æ¨¡å—å‰ç¼€ï¼Œé¿å…ä¸åŒæ¨¡å—é—´çš„è¡¨åå†²çª â­ **é‡è¦**
3. **ä¸€è‡´æ€§**ï¼šåŒç±»äº‹ç‰©ä½¿ç”¨ç›¸åŒçš„å‘½åé£æ ¼
4. **å¯è¯»æ€§**ï¼šå‘½åæ¸…æ™°è¡¨è¾¾å«ä¹‰ï¼Œè§åçŸ¥æ„
5. **è§„èŒƒæ€§**ï¼šéµå¾ª PostgreSQL å’Œ Tortoise ORM çš„å‘½åçº¦å®š
6. **å¤šç»„ç»‡**ï¼šæ‰€æœ‰è¡¨å¿…é¡»åŒ…å«ç»„ç»‡éš”ç¦»å­—æ®µ
7. **ç»å¯¹ç¦æ­¢ PowerShell**ï¼šå…¨ç¨‹ä¸¥ç¦ä½¿ç”¨ PowerShell è¿›è¡Œä»»ä½•æ“ä½œ â­ **é‡è¦**

## ğŸ“Š è¡¨å‘½åè§„èŒƒ

### åŸºæœ¬è§„åˆ™

**è§„åˆ™**ï¼šä½¿ç”¨ `snake_case`ï¼ˆå°å†™å­—æ¯ + ä¸‹åˆ’çº¿ï¼‰ï¼Œ**å¤æ•°å½¢å¼**ï¼Œ**å¿…é¡»åŒ…å«æ¨¡å—å‰ç¼€**

### æ¨¡å—å‰ç¼€è§„åˆ™ â­ é‡è¦

**è§„åˆ™**ï¼šæ‰€æœ‰è¡¨åå¿…é¡»åŒ…å«æ¨¡å—å‰ç¼€ï¼Œæ ¼å¼ä¸º `æ¨¡å—å‰ç¼€_è¡¨å`

#### æ¨¡å—å‰ç¼€å®šä¹‰ï¼ˆç»“åˆæ¡†æ¶å‘½åå“²å­¦ï¼‰

**ä¸»æµ B ç«¯å‘½åè§„èŒƒæ˜ å°„**ï¼š
- `platform` (å¹³å°) â†’ å¹³å°çº§åç«¯è¡¨å‰ç¼€
- `core` (æ ¸å¿ƒ) â†’ ç³»ç»Ÿçº§åç«¯è¡¨å‰ç¼€
- `seed` (æ’ä»¶) â†’ åº”ç”¨æ’ä»¶è¡¨å‰ç¼€

1. **å¹³å°çº§åç«¯æ¨¡å—ï¼ˆplatform/å¹³å°ï¼‰**ï¼š`platform_` å‰ç¼€ â­ **ç¬¦åˆä¸»æµ B ç«¯å‘½å**
   - å¹³å°çº§åŠŸèƒ½è¡¨ï¼ˆç§Ÿæˆ·ç®¡ç†ã€å¥—é¤ç®¡ç†ã€ç›‘æ§ç»Ÿè®¡ç­‰ï¼‰
   - å±äºå¹³å°çº§åç«¯
   - **å‘½åè§„èŒƒ**ï¼šå¹³å°çº§åŠŸèƒ½ï¼ŒåŒ…æ‹¬ç§Ÿæˆ·ç®¡ç†ã€å¥—é¤ç®¡ç†ç­‰

2. **ç³»ç»Ÿçº§åç«¯æ¨¡å—ï¼ˆcore/æ ¸å¿ƒï¼‰**ï¼š`core_` å‰ç¼€ â­ **ç¬¦åˆä¸»æµ B ç«¯å‘½å**
   - ç³»ç»Ÿçº§åŠŸèƒ½è¡¨ï¼ˆç”¨æˆ·ã€è§’è‰²ã€æƒé™ã€éƒ¨é—¨ã€å²—ä½ç­‰ï¼‰
   - å±äºç³»ç»Ÿçº§åç«¯
   - **å‘½åè§„èŒƒ**ï¼šç³»ç»Ÿçº§åŠŸèƒ½ï¼Œæä¾›åŸºç¡€æ”¯æ’‘

3. **åº”ç”¨æ’ä»¶æ¨¡å—ï¼ˆseed/æ’ä»¶ï¼‰**ï¼š`seed_æ’ä»¶å_` å‰ç¼€ â­ **ç¬¦åˆä¸»æµ B ç«¯å‘½å**
   - æ‰€æœ‰ä¸šåŠ¡æ¨¡å—ï¼ˆMESã€ERPã€WMSã€CRM ç­‰ï¼‰éƒ½å±äº `riveredge-seed`ï¼ˆåº”ç”¨æ’ä»¶é›†åˆï¼Œå•æ•°å½¢å¼ï¼‰
   - MES ç³»ç»Ÿï¼š`seed_mes_` å‰ç¼€ï¼ˆå¦‚ `seed_mes_orders`ï¼‰
   - ERP ç³»ç»Ÿï¼š`seed_erp_` å‰ç¼€ï¼ˆå¦‚ `seed_erp_invoices`ï¼‰
   - WMS ç³»ç»Ÿï¼š`seed_wms_` å‰ç¼€ï¼ˆå¦‚ `seed_wms_inventory`ï¼‰
   - CRM ç³»ç»Ÿï¼š`seed_crm_` å‰ç¼€ï¼ˆå¦‚ `seed_crm_customers`ï¼‰
   - æ”¯ä»˜æ’ä»¶ï¼š`seed_payment_` å‰ç¼€ï¼ˆå¦‚ `seed_payment_records`ï¼‰
   - çŸ­ä¿¡æ’ä»¶ï¼š`seed_sms_` å‰ç¼€ï¼ˆå¦‚ `seed_sms_templates`ï¼‰
   - é‚®ä»¶æ’ä»¶ï¼š`seed_email_` å‰ç¼€ï¼ˆå¦‚ `seed_email_logs`ï¼‰
   - æ‰€æœ‰æ’ä»¶è¡¨ç»Ÿä¸€ä½¿ç”¨ `seed_æ’ä»¶å_è¡¨å` æ ¼å¼
   - **å‘½åè§„èŒƒ**ï¼šåº”ç”¨çº§åŠŸèƒ½ï¼Œä¸šåŠ¡æ’ä»¶

**å…¼å®¹æ€§è¯´æ˜**ï¼š
- `sys_` å‰ç¼€ä½œä¸º `core_` çš„å…¼å®¹åˆ«åï¼Œä¸¤è€…ç­‰ä»·
- æ¨èä½¿ç”¨ `core_` å‰ç¼€ï¼Œæ›´ç¬¦åˆæ–°çš„å‘½åè§„èŒƒ
- ç°æœ‰ä½¿ç”¨ `sys_` çš„ä»£ç å¯ä»¥ç»§ç»­ä½¿ç”¨ï¼Œæ–°ä»£ç å»ºè®®ä½¿ç”¨ `core_`

#### å•è¡¨å‘½å

**å¹³å°çº§è¡¨**ï¼ˆä½¿ç”¨ `platform_` å‰ç¼€ï¼Œå¹³å°çº§åç«¯ï¼‰ï¼š
- âœ… `platform_tenants` - ç§Ÿæˆ·è¡¨ï¼ˆå¹³å°çº§åç«¯ï¼‰
- âœ… `platform_tenant_configs` - ç§Ÿæˆ·é…ç½®è¡¨ï¼ˆå¹³å°çº§åç«¯ï¼‰
- âœ… `platform_tenant_activity_logs` - ç§Ÿæˆ·æ´»åŠ¨æ—¥å¿—è¡¨ï¼ˆå¹³å°çº§åç«¯ï¼‰
- âœ… `platform_packages` - å¥—é¤è¡¨ï¼ˆå¹³å°çº§åç«¯ï¼‰
- âœ… `platform_monitoring_statistics` - ç›‘æ§ç»Ÿè®¡è¡¨ï¼ˆå¹³å°çº§åç«¯ï¼‰

**ç³»ç»Ÿçº§è¡¨**ï¼ˆä½¿ç”¨ `core_` å‰ç¼€ï¼Œç³»ç»Ÿçº§åç«¯ï¼‰ï¼š
- âœ… `core_users` - ç”¨æˆ·è¡¨ï¼ˆç³»ç»Ÿçº§åç«¯ï¼‰
- âœ… `core_roles` - è§’è‰²è¡¨ï¼ˆç³»ç»Ÿçº§åç«¯ï¼‰
- âœ… `core_permissions` - æƒé™è¡¨ï¼ˆç³»ç»Ÿçº§åç«¯ï¼‰
- âœ… `core_departments` - éƒ¨é—¨è¡¨ï¼ˆç³»ç»Ÿçº§åç«¯ï¼‰
- âœ… `core_positions` - å²—ä½è¡¨ï¼ˆç³»ç»Ÿçº§åç«¯ï¼‰

**å…¼å®¹æ€§è¯´æ˜**ï¼š
- `sys_` å‰ç¼€ä½œä¸º `core_` çš„å…¼å®¹åˆ«åï¼Œä¸¤è€…ç­‰ä»·
- æ¨èä½¿ç”¨ `core_` å‰ç¼€ï¼Œæ›´ç¬¦åˆæ–°çš„å‘½åè§„èŒƒ
- ç°æœ‰ä½¿ç”¨ `sys_` çš„ä»£ç å¯ä»¥ç»§ç»­ä½¿ç”¨ï¼Œæ–°ä»£ç å»ºè®®ä½¿ç”¨ `core_`
- âŒ `users` - é”™è¯¯ï¼šç¼ºå°‘æ¨¡å—å‰ç¼€
- âŒ `user` - é”™è¯¯ï¼šåº”ä½¿ç”¨å¤æ•°å½¢å¼ä¸”åŒ…å«å‰ç¼€
- âŒ `User` - é”™è¯¯ï¼šåº”ä½¿ç”¨å°å†™ä¸”åŒ…å«å‰ç¼€

**åº”ç”¨æ’ä»¶è¡¨**ï¼ˆä½¿ç”¨ `seed_æ’ä»¶å_` å‰ç¼€ï¼‰ï¼š
- âœ… `seed_mes_orders` - MES æ’ä»¶è®¢å•è¡¨
- âœ… `seed_mes_products` - MES æ’ä»¶äº§å“è¡¨
- âœ… `seed_mes_production_lines` - MES æ’ä»¶ç”Ÿäº§çº¿è¡¨
- âœ… `seed_erp_invoices` - ERP æ’ä»¶å‘ç¥¨è¡¨
- âœ… `seed_crm_customers` - CRM æ’ä»¶å®¢æˆ·è¡¨
- âœ… `seed_payment_records` - æ”¯ä»˜æ’ä»¶è®°å½•è¡¨
- âœ… `seed_sms_templates` - çŸ­ä¿¡æ’ä»¶æ¨¡æ¿è¡¨
- âœ… `seed_email_logs` - é‚®ä»¶æ’ä»¶æ—¥å¿—è¡¨
- âŒ `mes_orders` - é”™è¯¯ï¼šç¼ºå°‘ `seed_` å‰ç¼€
- âŒ `orders` - é”™è¯¯ï¼šç¼ºå°‘æ¨¡å—å‰ç¼€
- âŒ `seed_mes_order` - é”™è¯¯ï¼šåº”ä½¿ç”¨å¤æ•°å½¢å¼

#### å…³è”è¡¨å‘½å

**è§„åˆ™**ï¼šå…³è”è¡¨åŒæ ·éœ€è¦æ¨¡å—å‰ç¼€ï¼Œæ ¼å¼ä¸º `æ¨¡å—å‰ç¼€_è¡¨1_è¡¨2`

**ç³»ç»Ÿçº§å…³è”è¡¨**ï¼ˆä½¿ç”¨ `core_` å‰ç¼€ï¼‰ï¼š
- âœ… `core_user_roles` - ç”¨æˆ·è§’è‰²å…³è”è¡¨ï¼ˆç³»ç»Ÿçº§åç«¯ï¼‰
- âœ… `core_role_permissions` - è§’è‰²æƒé™å…³è”è¡¨ï¼ˆç³»ç»Ÿçº§åç«¯ï¼‰
- âœ… `sys_user_roles` - ç”¨æˆ·è§’è‰²å…³è”è¡¨ï¼ˆå…¼å®¹åˆ«åï¼Œæ¨èä½¿ç”¨ `core_user_roles`ï¼‰
- âŒ `user_roles` - é”™è¯¯ï¼šç¼ºå°‘æ¨¡å—å‰ç¼€
- âŒ `user_role` - é”™è¯¯ï¼šåº”ä½¿ç”¨å¤æ•°å½¢å¼ä¸”åŒ…å«å‰ç¼€

**åº”ç”¨æ’ä»¶å…³è”è¡¨**ï¼š
- âœ… `seed_mes_order_items` - MES æ’ä»¶è®¢å•æ˜ç»†è¡¨ï¼ˆä¸»è¡¨_å­è¡¨ï¼‰
- âœ… `seed_mes_product_categories` - MES æ’ä»¶äº§å“åˆ†ç±»å…³è”è¡¨
- âœ… `seed_payment_order_items` - æ”¯ä»˜æ’ä»¶è®¢å•æ˜ç»†è¡¨
- âŒ `mes_order_items` - é”™è¯¯ï¼šç¼ºå°‘ `seed_` å‰ç¼€
- âŒ `order_items` - é”™è¯¯ï¼šç¼ºå°‘æ¨¡å—å‰ç¼€
- âŒ `seed_mes_order_item` - é”™è¯¯ï¼šåº”ä½¿ç”¨å¤æ•°å½¢å¼

### è¡¨å‘½åç¤ºä¾‹

```sql
-- å¹³å°çº§è¡¨ï¼ˆplatform_ å‰ç¼€ï¼Œå¹³å°çº§åç«¯ï¼‰
platform_tenants            -- ç§Ÿæˆ·è¡¨ï¼ˆå¹³å°çº§åç«¯ï¼‰
platform_tenant_configs     -- ç§Ÿæˆ·é…ç½®è¡¨ï¼ˆå¹³å°çº§åç«¯ï¼‰
platform_tenant_activity_logs -- ç§Ÿæˆ·æ´»åŠ¨æ—¥å¿—è¡¨ï¼ˆå¹³å°çº§åç«¯ï¼‰
platform_packages           -- å¥—é¤è¡¨ï¼ˆå¹³å°çº§åç«¯ï¼‰
platform_monitoring_statistics -- ç›‘æ§ç»Ÿè®¡è¡¨ï¼ˆå¹³å°çº§åç«¯ï¼‰

-- ç³»ç»Ÿçº§è¡¨ï¼ˆcore_ å‰ç¼€ï¼Œç³»ç»Ÿçº§åç«¯ï¼‰
core_users              -- ç”¨æˆ·è¡¨ï¼ˆç³»ç»Ÿçº§åç«¯ï¼‰
core_roles              -- è§’è‰²è¡¨ï¼ˆç³»ç»Ÿçº§åç«¯ï¼‰
core_permissions        -- æƒé™è¡¨ï¼ˆç³»ç»Ÿçº§åç«¯ï¼‰
core_departments        -- éƒ¨é—¨è¡¨ï¼ˆç³»ç»Ÿçº§åç«¯ï¼‰
core_positions          -- å²—ä½è¡¨ï¼ˆç³»ç»Ÿçº§åç«¯ï¼‰

-- ç³»ç»Ÿçº§å…³è”è¡¨
core_user_roles         -- ç”¨æˆ·è§’è‰²å…³è”è¡¨ï¼ˆç³»ç»Ÿçº§åç«¯ï¼‰
core_role_permissions   -- è§’è‰²æƒé™å…³è”è¡¨ï¼ˆç³»ç»Ÿçº§åç«¯ï¼‰

-- å…¼å®¹åˆ«åï¼ˆsys_ å‰ç¼€ï¼Œæ¨èä½¿ç”¨ core_ï¼‰
sys_users               -- ç”¨æˆ·è¡¨ï¼ˆå…¼å®¹åˆ«åï¼Œæ¨èä½¿ç”¨ core_usersï¼‰
sys_roles               -- è§’è‰²è¡¨ï¼ˆå…¼å®¹åˆ«åï¼Œæ¨èä½¿ç”¨ core_rolesï¼‰

-- MES åº”ç”¨æ’ä»¶è¡¨ï¼ˆseed_mes_ å‰ç¼€ï¼‰
seed_mes_orders             -- MES æ’ä»¶è®¢å•è¡¨ï¼ˆä¸»è¡¨ï¼‰
seed_mes_order_items        -- MES æ’ä»¶è®¢å•æ˜ç»†è¡¨ï¼ˆå­è¡¨ï¼‰
seed_mes_products           -- MES æ’ä»¶äº§å“è¡¨
seed_mes_categories         -- MES æ’ä»¶åˆ†ç±»è¡¨
seed_mes_production_lines   -- MES æ’ä»¶ç”Ÿäº§çº¿è¡¨
seed_mes_work_orders        -- MES æ’ä»¶å·¥å•è¡¨

-- ERP åº”ç”¨æ’ä»¶è¡¨ï¼ˆseed_erp_ å‰ç¼€ï¼‰
seed_erp_invoices           -- ERP æ’ä»¶å‘ç¥¨è¡¨
seed_erp_invoice_items      -- ERP æ’ä»¶å‘ç¥¨æ˜ç»†è¡¨

-- CRM åº”ç”¨æ’ä»¶è¡¨ï¼ˆseed_crm_ å‰ç¼€ï¼‰
seed_crm_customers          -- CRM æ’ä»¶å®¢æˆ·è¡¨
seed_crm_contacts           -- CRM æ’ä»¶è”ç³»äººè¡¨

-- å…¶ä»–åº”ç”¨æ’ä»¶è¡¨ï¼ˆseed_æ’ä»¶å_ å‰ç¼€ï¼‰
seed_payment_records        -- æ”¯ä»˜æ’ä»¶è®°å½•è¡¨
seed_sms_templates          -- çŸ­ä¿¡æ’ä»¶æ¨¡æ¿è¡¨
seed_email_logs             -- é‚®ä»¶æ’ä»¶æ—¥å¿—è¡¨
```

## ğŸ”‘ å­—æ®µå‘½åè§„èŒƒ

### åŸºæœ¬è§„åˆ™

**è§„åˆ™**ï¼šä½¿ç”¨ `snake_case`ï¼ˆå°å†™å­—æ¯ + ä¸‹åˆ’çº¿ï¼‰

### ä¸»é”®å­—æ®µ

**è§„åˆ™**ï¼šç»Ÿä¸€ä½¿ç”¨ `id`

- âœ… `id` - ä¸»é”®ï¼ˆINTEGER PRIMARY KEY æˆ– BIGSERIALï¼‰
- âŒ `user_id` - é”™è¯¯ï¼šä¸»é”®åº”ä½¿ç”¨ `id`
- âŒ `userId` - é”™è¯¯ï¼šåº”ä½¿ç”¨ä¸‹åˆ’çº¿
- âŒ `pk` - é”™è¯¯ï¼šåº”ä½¿ç”¨ `id`

```sql
CREATE TABLE core_users (
    id SERIAL PRIMARY KEY,  -- âœ… ä¸»é”®ä½¿ç”¨ id
    -- ...
);
```

### ç»„ç»‡å­—æ®µ

**è§„åˆ™**ï¼šæ‰€æœ‰è¡¨å¿…é¡»åŒ…å« `tenant_id`ï¼ˆå¤šç»„ç»‡éš”ç¦»ï¼‰

- âœ… `tenant_id` - ç»„ç»‡ IDï¼ˆæ‰€æœ‰è¡¨å¿…é¡»åŒ…å«ï¼‰
- âŒ `tenantId` - é”™è¯¯ï¼šåº”ä½¿ç”¨ä¸‹åˆ’çº¿
- âŒ `company_id` - é”™è¯¯ï¼šåº”ç»Ÿä¸€ä½¿ç”¨ `tenant_id`

```sql
CREATE TABLE core_users (
    id SERIAL PRIMARY KEY,
    tenant_id INTEGER NOT NULL,  -- âœ… ç»„ç»‡ IDï¼ˆå¿…é¡»ï¼‰
    -- ...
    INDEX idx_core_users_tenant_id (tenant_id)  -- âœ… å¿…é¡»åˆ›å»ºç´¢å¼•
);
```

### å¤–é”®å­—æ®µ

**è§„åˆ™**ï¼šä½¿ç”¨ `è¡¨å_id` æ ¼å¼

- âœ… `user_id` - ç”¨æˆ· ID å¤–é”®
- âœ… `order_id` - è®¢å• ID å¤–é”®
- âœ… `role_id` - è§’è‰² ID å¤–é”®
- âœ… `tenant_id` - ç»„ç»‡ ID å¤–é”®
- âŒ `userId` - é”™è¯¯ï¼šåº”ä½¿ç”¨ä¸‹åˆ’çº¿
- âŒ `orderId` - é”™è¯¯ï¼šåº”ä½¿ç”¨ä¸‹åˆ’çº¿
- âŒ `user` - é”™è¯¯ï¼šå¤–é”®åº”ä½¿ç”¨ `_id` åç¼€

```sql
CREATE TABLE seed_mes_order_items (
    id SERIAL PRIMARY KEY,
    tenant_id INTEGER NOT NULL,
    order_id INTEGER NOT NULL,  -- âœ… å¤–é”®ï¼šè®¢å• ID
    product_id INTEGER NOT NULL,  -- âœ… å¤–é”®ï¼šäº§å“ ID
    -- ...
    FOREIGN KEY (order_id) REFERENCES seed_mes_orders(id),
    FOREIGN KEY (product_id) REFERENCES seed_mes_products(id)
);
```

### æ—¶é—´å­—æ®µ

**è§„åˆ™**ï¼šä½¿ç”¨ `_at` åç¼€

- âœ… `created_at` - åˆ›å»ºæ—¶é—´ï¼ˆTIMESTAMPï¼‰
- âœ… `updated_at` - æ›´æ–°æ—¶é—´ï¼ˆTIMESTAMPï¼‰
- âœ… `deleted_at` - åˆ é™¤æ—¶é—´ï¼ˆTIMESTAMPï¼Œè½¯åˆ é™¤ï¼‰
- âœ… `published_at` - å‘å¸ƒæ—¶é—´ï¼ˆTIMESTAMPï¼‰
- âŒ `createTime` - é”™è¯¯ï¼šåº”ä½¿ç”¨ä¸‹åˆ’çº¿å’Œ `_at` åç¼€
- âŒ `create_time` - é”™è¯¯ï¼šåº”ä½¿ç”¨ `created_at`

```sql
CREATE TABLE core_users (
    id SERIAL PRIMARY KEY,
    tenant_id INTEGER NOT NULL,
    -- ...
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,  -- âœ… åˆ›å»ºæ—¶é—´
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,  -- âœ… æ›´æ–°æ—¶é—´
    deleted_at TIMESTAMP NULL  -- âœ… åˆ é™¤æ—¶é—´ï¼ˆè½¯åˆ é™¤ï¼‰
);
```

### å¸ƒå°”å­—æ®µ

**è§„åˆ™**ï¼šä½¿ç”¨ `is_` å‰ç¼€

- âœ… `is_active` - æ˜¯å¦æ¿€æ´»
- âœ… `is_deleted` - æ˜¯å¦åˆ é™¤ï¼ˆè½¯åˆ é™¤æ ‡å¿—ï¼‰
- âœ… `is_superuser` - æ˜¯å¦è¶…çº§ç®¡ç†å‘˜
- âœ… `is_verified` - æ˜¯å¦å·²éªŒè¯
- âŒ `active` - é”™è¯¯ï¼šå¸ƒå°”å­—æ®µåº”ä½¿ç”¨ `is_` å‰ç¼€
- âŒ `isActive` - é”™è¯¯ï¼šåº”ä½¿ç”¨ä¸‹åˆ’çº¿

```sql
CREATE TABLE core_users (
    id SERIAL PRIMARY KEY,
    tenant_id INTEGER NOT NULL,
    -- ...
    is_active BOOLEAN DEFAULT TRUE,  -- âœ… æ˜¯å¦æ¿€æ´»
    is_deleted BOOLEAN DEFAULT FALSE,  -- âœ… æ˜¯å¦åˆ é™¤
    is_superuser BOOLEAN DEFAULT FALSE  -- âœ… æ˜¯å¦è¶…çº§ç®¡ç†å‘˜
);
```

### çŠ¶æ€å­—æ®µ

**è§„åˆ™**ï¼šä½¿ç”¨ `status`ï¼Œé…åˆæšä¸¾ç±»å‹

- âœ… `status` - çŠ¶æ€å­—æ®µï¼ˆVARCHAR æˆ– ENUMï¼‰
- âŒ `state` - é”™è¯¯ï¼šåº”ç»Ÿä¸€ä½¿ç”¨ `status`
- âŒ `orderStatus` - é”™è¯¯ï¼šåº”ä½¿ç”¨ `status`

```sql
CREATE TABLE seed_mes_orders (
    id SERIAL PRIMARY KEY,
    tenant_id INTEGER NOT NULL,
    -- ...
    status VARCHAR(20) DEFAULT 'pending',  -- âœ… çŠ¶æ€å­—æ®µ
    -- çŠ¶æ€å€¼ï¼špending, processing, completed, cancelled
    CHECK (status IN ('pending', 'processing', 'completed', 'cancelled'))
);
```

### æ•°é‡å­—æ®µ

**è§„åˆ™**ï¼šä½¿ç”¨æ˜ç¡®çš„å•ä½åç¼€

- âœ… `quantity` - æ•°é‡
- âœ… `total_amount` - æ€»é‡‘é¢
- âœ… `unit_price` - å•ä»·
- âœ… `discount_rate` - æŠ˜æ‰£ç‡
- âŒ `amount` - ä¸æ¨èï¼šåº”æ˜ç¡®æ˜¯æ€»é‡‘é¢è¿˜æ˜¯å•ä»·
- âŒ `price` - ä¸æ¨èï¼šåº”æ˜ç¡®æ˜¯å•ä»·è¿˜æ˜¯æ€»ä»·

```sql
CREATE TABLE seed_mes_order_items (
    id SERIAL PRIMARY KEY,
    tenant_id INTEGER NOT NULL,
    order_id INTEGER NOT NULL,
    product_id INTEGER NOT NULL,
    quantity INTEGER NOT NULL,  -- âœ… æ•°é‡
    unit_price DECIMAL(10, 2) NOT NULL,  -- âœ… å•ä»·
    total_amount DECIMAL(10, 2) NOT NULL,  -- âœ… æ€»é‡‘é¢
    -- ...
);
```

### æ–‡æœ¬å­—æ®µ

**è§„åˆ™**ï¼šä½¿ç”¨æè¿°æ€§åç§°

- âœ… `username` - ç”¨æˆ·å
- âœ… `email` - é‚®ç®±
- âœ… `full_name` - å…¨å
- âœ… `description` - æè¿°
- âœ… `remarks` - å¤‡æ³¨
- âŒ `name` - ä¸æ¨èï¼šåº”æ˜ç¡®æ˜¯ç”¨æˆ·åã€äº§å“åè¿˜æ˜¯å…¶ä»–
- âŒ `desc` - é”™è¯¯ï¼šåº”ä½¿ç”¨å®Œæ•´å•è¯ `description`

```sql
CREATE TABLE core_users (
    id SERIAL PRIMARY KEY,
    tenant_id INTEGER NOT NULL,
    username VARCHAR(50) NOT NULL,  -- âœ… ç”¨æˆ·å
    email VARCHAR(100) NOT NULL,  -- âœ… é‚®ç®±
    full_name VARCHAR(100),  -- âœ… å…¨å
    description TEXT,  -- âœ… æè¿°
    -- ...
);
```

### JSON å­—æ®µ

**è§„åˆ™**ï¼šä½¿ç”¨ `_config`ã€`_data`ã€`_settings` ç­‰åç¼€

- âœ… `config` - é…ç½®ï¼ˆJSONBï¼‰
- âœ… `settings` - è®¾ç½®ï¼ˆJSONBï¼‰
- âœ… `metadata` - å…ƒæ•°æ®ï¼ˆJSONBï¼‰
- âœ… `extra_data` - é¢å¤–æ•°æ®ï¼ˆJSONBï¼‰
- âŒ `json` - é”™è¯¯ï¼šåº”ä½¿ç”¨æè¿°æ€§åç§°

```sql
CREATE TABLE platform_tenants (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    -- ...
    settings JSONB DEFAULT '{}',  -- âœ… ç»„ç»‡è®¾ç½®ï¼ˆJSONBï¼‰
    config JSONB DEFAULT '{}'  -- âœ… ç»„ç»‡é…ç½®ï¼ˆJSONBï¼‰
);
```

## ğŸ“ ç´¢å¼•å‘½åè§„èŒƒ

### åŸºæœ¬è§„åˆ™

**è§„åˆ™**ï¼šä½¿ç”¨ `idx_è¡¨å_å­—æ®µå` æˆ– `uk_è¡¨å_å­—æ®µå`ï¼ˆå”¯ä¸€ç´¢å¼•ï¼‰

### æ™®é€šç´¢å¼•

**è§„åˆ™**ï¼šç´¢å¼•å‘½åæ ¼å¼ä¸º `idx_è¡¨å_å­—æ®µå`ï¼ˆè¡¨ååŒ…å«æ¨¡å—å‰ç¼€ï¼‰

- âœ… `idx_core_users_tenant_id` - ç”¨æˆ·è¡¨ç»„ç»‡ ID ç´¢å¼•ï¼ˆæ ¹ç³»ç»Ÿï¼‰
- âœ… `idx_core_users_email` - ç”¨æˆ·è¡¨é‚®ç®±ç´¢å¼•ï¼ˆæ ¹ç³»ç»Ÿï¼‰
- âœ… `idx_seed_mes_orders_status` - MES æ’ä»¶è®¢å•è¡¨çŠ¶æ€ç´¢å¼•
- âœ… `idx_seed_mes_orders_created_at` - MES æ’ä»¶è®¢å•è¡¨åˆ›å»ºæ—¶é—´ç´¢å¼•
- âŒ `idx_users_tenant_id` - é”™è¯¯ï¼šè¡¨ååº”åŒ…å«æ¨¡å—å‰ç¼€
- âŒ `idx_mes_orders_status` - é”™è¯¯ï¼šç¼ºå°‘ `seed_` å‰ç¼€
- âœ… `idx_sys_users_tenant_id` - å…¼å®¹åˆ«åï¼ˆæ¨èä½¿ç”¨ `idx_core_users_tenant_id`ï¼‰
- âŒ `users_tenant_id_idx` - é”™è¯¯ï¼šåº”ä½¿ç”¨ `idx_` å‰ç¼€
- âŒ `index_users_tenant_id` - é”™è¯¯ï¼šåº”ä½¿ç”¨ `idx_` å‰ç¼€

```sql
-- ç³»ç»Ÿçº§è¡¨ç´¢å¼•ï¼ˆcore_ å‰ç¼€ï¼Œç¬¦åˆä¸»æµ B ç«¯å‘½åï¼‰
CREATE INDEX idx_core_users_tenant_id ON core_users(tenant_id);
CREATE INDEX idx_core_users_email ON core_users(email);
CREATE INDEX idx_core_roles_tenant_id ON core_roles(tenant_id);

-- åº”ç”¨æ’ä»¶è¡¨ç´¢å¼•
CREATE INDEX idx_seed_mes_orders_status ON seed_mes_orders(status);
CREATE INDEX idx_seed_mes_orders_created_at ON seed_mes_orders(created_at);
CREATE INDEX idx_seed_mes_order_items_order_id ON seed_mes_order_items(order_id);

-- å¤åˆç´¢å¼•
CREATE INDEX idx_seed_mes_orders_tenant_status ON seed_mes_orders(tenant_id, status);
CREATE INDEX idx_seed_mes_order_items_order_product ON seed_mes_order_items(order_id, product_id);
```

### å”¯ä¸€ç´¢å¼•

**è§„åˆ™**ï¼šä½¿ç”¨ `uk_` å‰ç¼€ï¼ˆunique keyï¼‰ï¼Œæ ¼å¼ä¸º `uk_è¡¨å_å­—æ®µå`ï¼ˆè¡¨ååŒ…å«æ¨¡å—å‰ç¼€ï¼‰

- âœ… `uk_core_users_email` - ç”¨æˆ·è¡¨é‚®ç®±å”¯ä¸€ç´¢å¼•ï¼ˆæ ¹ç³»ç»Ÿï¼‰
- âœ… `uk_core_users_tenant_username` - ç”¨æˆ·è¡¨ç»„ç»‡+ç”¨æˆ·åå”¯ä¸€ç´¢å¼•ï¼ˆæ ¹ç³»ç»Ÿï¼‰
- âœ… `uk_sys_users_email` - å…¼å®¹åˆ«åï¼ˆæ¨èä½¿ç”¨ `uk_core_users_email`ï¼‰
- âœ… `uk_seed_mes_orders_order_no` - MES æ’ä»¶è®¢å•è¡¨è®¢å•å·å”¯ä¸€ç´¢å¼•
- âŒ `uk_users_email` - é”™è¯¯ï¼šè¡¨ååº”åŒ…å«æ¨¡å—å‰ç¼€
- âŒ `uk_mes_orders_order_no` - é”™è¯¯ï¼šç¼ºå°‘ `seed_` å‰ç¼€
- âŒ `unique_users_email` - é”™è¯¯ï¼šåº”ä½¿ç”¨ `uk_` å‰ç¼€

```sql
-- ç³»ç»Ÿçº§è¡¨å”¯ä¸€ç´¢å¼•ï¼ˆcore_ å‰ç¼€ï¼Œç¬¦åˆä¸»æµ B ç«¯å‘½åï¼‰
CREATE UNIQUE INDEX uk_core_users_email ON core_users(email);

-- å¤åˆå”¯ä¸€ç´¢å¼•ï¼ˆç»„ç»‡å†…å”¯ä¸€ï¼‰
CREATE UNIQUE INDEX uk_core_users_tenant_username ON core_users(tenant_id, username);
CREATE UNIQUE INDEX uk_seed_mes_orders_tenant_order_no ON seed_mes_orders(tenant_id, order_no);
```

### ä¸»é”®ç´¢å¼•

**è§„åˆ™**ï¼šä¸»é”®ç´¢å¼•è‡ªåŠ¨åˆ›å»ºï¼Œæ— éœ€æ‰‹åŠ¨å‘½å

```sql
-- ä¸»é”®ç´¢å¼•è‡ªåŠ¨åˆ›å»ºï¼Œæ— éœ€æ‰‹åŠ¨åˆ›å»º
CREATE TABLE core_users (
    id SERIAL PRIMARY KEY,  -- âœ… ä¸»é”®ç´¢å¼•è‡ªåŠ¨åˆ›å»º
    -- ...
);
```

### å¤–é”®ç´¢å¼•

**è§„åˆ™**ï¼šå¤–é”®ç´¢å¼•è‡ªåŠ¨åˆ›å»ºï¼Œä½†å»ºè®®æ˜¾å¼åˆ›å»ºä»¥æé«˜æ€§èƒ½

```sql
-- å¤–é”®ç´¢å¼•ï¼ˆå»ºè®®æ˜¾å¼åˆ›å»ºï¼‰
CREATE INDEX idx_seed_mes_order_items_order_id ON seed_mes_order_items(order_id);
CREATE INDEX idx_seed_mes_order_items_product_id ON seed_mes_order_items(product_id);
```

## ğŸ”— çº¦æŸå‘½åè§„èŒƒ

### åŸºæœ¬è§„åˆ™

**è§„åˆ™**ï¼šä½¿ç”¨ `ck_è¡¨å_å­—æ®µå`ï¼ˆæ£€æŸ¥çº¦æŸï¼‰ã€`fk_è¡¨å_å­—æ®µå`ï¼ˆå¤–é”®çº¦æŸï¼‰

### æ£€æŸ¥çº¦æŸ

**è§„åˆ™**ï¼šçº¦æŸå‘½åæ ¼å¼ä¸º `ck_è¡¨å_å­—æ®µå`ï¼ˆè¡¨ååŒ…å«æ¨¡å—å‰ç¼€ï¼‰

- âœ… `ck_core_users_email_format` - ç”¨æˆ·è¡¨é‚®ç®±æ ¼å¼æ£€æŸ¥ï¼ˆæ ¹ç³»ç»Ÿï¼‰
- âœ… `ck_seed_mes_orders_status_valid` - MES æ’ä»¶è®¢å•è¡¨çŠ¶æ€æœ‰æ•ˆæ€§æ£€æŸ¥
- âœ… `ck_seed_mes_order_items_quantity_positive` - MES æ’ä»¶è®¢å•æ˜ç»†è¡¨æ•°é‡æ­£æ•°æ£€æŸ¥
- âŒ `ck_users_email_format` - é”™è¯¯ï¼šè¡¨ååº”åŒ…å«æ¨¡å—å‰ç¼€
- âŒ `ck_mes_orders_status_valid` - é”™è¯¯ï¼šç¼ºå°‘ `seed_` å‰ç¼€
- âœ… `ck_sys_users_email_format` - å…¼å®¹åˆ«åï¼ˆæ¨èä½¿ç”¨ `ck_core_users_email_format`ï¼‰

```sql
-- ç³»ç»Ÿçº§è¡¨æ£€æŸ¥çº¦æŸï¼ˆcore_ å‰ç¼€ï¼Œç¬¦åˆä¸»æµ B ç«¯å‘½åï¼‰
ALTER TABLE core_users ADD CONSTRAINT ck_core_users_email_format
    CHECK (email ~* '^[\w\.-]+@[\w\.-]+\.\w+$');

-- åº”ç”¨æ’ä»¶è¡¨æ£€æŸ¥çº¦æŸ
ALTER TABLE seed_mes_orders ADD CONSTRAINT ck_seed_mes_orders_status_valid
    CHECK (status IN ('pending', 'processing', 'completed', 'cancelled'));

ALTER TABLE seed_mes_order_items ADD CONSTRAINT ck_seed_mes_order_items_quantity_positive
    CHECK (quantity > 0);
```

### å¤–é”®çº¦æŸ

**è§„åˆ™**ï¼šçº¦æŸå‘½åæ ¼å¼ä¸º `fk_è¡¨å_å­—æ®µå`ï¼ˆè¡¨ååŒ…å«æ¨¡å—å‰ç¼€ï¼‰

- âœ… `fk_seed_mes_order_items_order_id` - MES æ’ä»¶è®¢å•æ˜ç»†è¡¨è®¢å• ID å¤–é”®
- âœ… `fk_seed_mes_order_items_product_id` - MES æ’ä»¶è®¢å•æ˜ç»†è¡¨äº§å“ ID å¤–é”®
- âŒ `fk_order_items_order_id` - é”™è¯¯ï¼šè¡¨ååº”åŒ…å«æ¨¡å—å‰ç¼€
- âŒ `fk_mes_order_items_order_id` - é”™è¯¯ï¼šç¼ºå°‘ `seed_` å‰ç¼€

```sql
-- åº”ç”¨æ’ä»¶è¡¨å¤–é”®çº¦æŸ
ALTER TABLE seed_mes_order_items ADD CONSTRAINT fk_seed_mes_order_items_order_id
    FOREIGN KEY (order_id) REFERENCES seed_mes_orders(id) ON DELETE CASCADE;

ALTER TABLE seed_mes_order_items ADD CONSTRAINT fk_seed_mes_order_items_product_id
    FOREIGN KEY (product_id) REFERENCES seed_mes_products(id) ON DELETE RESTRICT;

-- ç³»ç»Ÿçº§è¡¨å¤–é”®çº¦æŸï¼ˆcore_ å‰ç¼€ï¼Œç¬¦åˆä¸»æµ B ç«¯å‘½åï¼‰
ALTER TABLE core_users ADD CONSTRAINT fk_core_users_tenant_id
    FOREIGN KEY (tenant_id) REFERENCES platform_tenants(id) ON DELETE RESTRICT;
```

## ğŸ“‹ å­—æ®µç±»å‹è§„èŒƒ

### å­—ç¬¦ä¸²ç±»å‹

**è§„åˆ™**ï¼šæ ¹æ®é•¿åº¦é€‰æ‹© VARCHAR æˆ– TEXT

- âœ… `VARCHAR(50)` - çŸ­å­—ç¬¦ä¸²ï¼ˆç”¨æˆ·åã€çŠ¶æ€ç­‰ï¼Œâ‰¤ 100 å­—ç¬¦ï¼‰
- âœ… `VARCHAR(100)` - ä¸­ç­‰å­—ç¬¦ä¸²ï¼ˆé‚®ç®±ã€åç§°ç­‰ï¼Œâ‰¤ 255 å­—ç¬¦ï¼‰
- âœ… `VARCHAR(255)` - é•¿å­—ç¬¦ä¸²ï¼ˆæ ‡é¢˜ã€æè¿°ç­‰ï¼Œâ‰¤ 500 å­—ç¬¦ï¼‰
- âœ… `TEXT` - è¶…é•¿æ–‡æœ¬ï¼ˆå†…å®¹ã€å¤‡æ³¨ç­‰ï¼Œ> 500 å­—ç¬¦ï¼‰
- âŒ `CHAR(n)` - ä¸æ¨èï¼šé™¤éé•¿åº¦å›ºå®šï¼Œå¦åˆ™ä½¿ç”¨ VARCHAR

```sql
CREATE TABLE core_users (
    username VARCHAR(50) NOT NULL,   -- âœ… ç”¨æˆ·åï¼ˆçŸ­å­—ç¬¦ä¸²ï¼‰
    email VARCHAR(100) NOT NULL,    -- âœ… é‚®ç®±ï¼ˆä¸­ç­‰å­—ç¬¦ä¸²ï¼‰
    full_name VARCHAR(100),          -- âœ… å…¨åï¼ˆä¸­ç­‰å­—ç¬¦ä¸²ï¼‰
    description TEXT                 -- âœ… æè¿°ï¼ˆè¶…é•¿æ–‡æœ¬ï¼‰
);
```

### æ•°å€¼ç±»å‹

**è§„åˆ™**ï¼šæ ¹æ®èŒƒå›´é€‰æ‹© INTEGER æˆ– BIGINT

- âœ… `INTEGER` - æ•´æ•°ï¼ˆ-2,147,483,648 åˆ° 2,147,483,647ï¼‰
- âœ… `BIGINT` - å¤§æ•´æ•°ï¼ˆ-9,223,372,036,854,775,808 åˆ° 9,223,372,036,854,775,807ï¼‰
- âœ… `DECIMAL(10, 2)` - é‡‘é¢ï¼ˆ10 ä½æ•°å­—ï¼Œ2 ä½å°æ•°ï¼‰
- âœ… `DECIMAL(18, 4)` - é«˜ç²¾åº¦é‡‘é¢ï¼ˆ18 ä½æ•°å­—ï¼Œ4 ä½å°æ•°ï¼‰
- âŒ `FLOAT` - ä¸æ¨èï¼šé‡‘é¢åº”ä½¿ç”¨ DECIMAL
- âŒ `DOUBLE` - ä¸æ¨èï¼šé‡‘é¢åº”ä½¿ç”¨ DECIMAL

```sql
CREATE TABLE seed_mes_orders (
    id SERIAL PRIMARY KEY,                    -- âœ… ä¸»é”®ï¼ˆè‡ªåŠ¨é€’å¢ï¼‰
    tenant_id INTEGER NOT NULL,               -- âœ… ç»„ç»‡ IDï¼ˆæ•´æ•°ï¼‰
    quantity INTEGER NOT NULL,                -- âœ… æ•°é‡ï¼ˆæ•´æ•°ï¼‰
    unit_price DECIMAL(10, 2) NOT NULL,       -- âœ… å•ä»·ï¼ˆé‡‘é¢ï¼‰
    total_amount DECIMAL(10, 2) NOT NULL,     -- âœ… æ€»é‡‘é¢ï¼ˆé‡‘é¢ï¼‰
    discount_rate DECIMAL(5, 2) DEFAULT 0     -- âœ… æŠ˜æ‰£ç‡ï¼ˆç™¾åˆ†æ¯”ï¼‰
);
```

### æ—¥æœŸæ—¶é—´ç±»å‹

**è§„åˆ™**ï¼šç»Ÿä¸€ä½¿ç”¨ TIMESTAMP

- âœ… `TIMESTAMP` - æ—¥æœŸæ—¶é—´ï¼ˆå¸¦æ—¶åŒºï¼‰
- âœ… `TIMESTAMP DEFAULT CURRENT_TIMESTAMP` - é»˜è®¤å½“å‰æ—¶é—´
- âŒ `DATETIME` - é”™è¯¯ï¼šPostgreSQL ä½¿ç”¨ TIMESTAMP
- âŒ `DATE` - ä¸æ¨èï¼šé™¤éåªéœ€è¦æ—¥æœŸä¸éœ€è¦æ—¶é—´

```sql
CREATE TABLE core_users (
    id SERIAL PRIMARY KEY,
    -- ...
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,  -- âœ… åˆ›å»ºæ—¶é—´
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,  -- âœ… æ›´æ–°æ—¶é—´
    deleted_at TIMESTAMP NULL                        -- âœ… åˆ é™¤æ—¶é—´ï¼ˆè½¯åˆ é™¤ï¼‰
);
```

### å¸ƒå°”ç±»å‹

**è§„åˆ™**ï¼šä½¿ç”¨ BOOLEAN

- âœ… `BOOLEAN` - å¸ƒå°”å€¼
- âœ… `BOOLEAN DEFAULT TRUE` - é»˜è®¤å€¼
- âœ… `BOOLEAN DEFAULT FALSE` - é»˜è®¤å€¼
- âŒ `TINYINT(1)` - é”™è¯¯ï¼šPostgreSQL ä½¿ç”¨ BOOLEAN
- âŒ `INTEGER` - é”™è¯¯ï¼šåº”ä½¿ç”¨ BOOLEAN

```sql
CREATE TABLE core_users (
    id SERIAL PRIMARY KEY,
    -- ...
    is_active BOOLEAN DEFAULT TRUE,      -- âœ… æ˜¯å¦æ¿€æ´»
    is_deleted BOOLEAN DEFAULT FALSE,    -- âœ… æ˜¯å¦åˆ é™¤
    is_superuser BOOLEAN DEFAULT FALSE   -- âœ… æ˜¯å¦è¶…çº§ç®¡ç†å‘˜
);
```

### JSON ç±»å‹

**è§„åˆ™**ï¼šä½¿ç”¨ JSONBï¼ˆäºŒè¿›åˆ¶ JSONï¼Œæ€§èƒ½æ›´å¥½ï¼‰

- âœ… `JSONB` - JSON æ•°æ®ï¼ˆæ¨èï¼Œæ”¯æŒç´¢å¼•å’ŒæŸ¥è¯¢ï¼‰
- âœ… `JSONB DEFAULT '{}'` - é»˜è®¤ç©ºå¯¹è±¡
- âœ… `JSONB DEFAULT '[]'` - é»˜è®¤ç©ºæ•°ç»„
- âŒ `JSON` - ä¸æ¨èï¼šJSONB æ€§èƒ½æ›´å¥½

```sql
CREATE TABLE platform_tenants (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    settings JSONB DEFAULT '{}',  -- âœ… ç»„ç»‡è®¾ç½®ï¼ˆJSONBï¼‰
    config JSONB DEFAULT '{}'     -- âœ… ç»„ç»‡é…ç½®ï¼ˆJSONBï¼‰
);

-- JSONB æ”¯æŒç´¢å¼•
CREATE INDEX idx_platform_tenants_settings_plan ON platform_tenants USING GIN (settings);
```

### æšä¸¾ç±»å‹

**è§„åˆ™**ï¼šä½¿ç”¨ VARCHAR + CHECK çº¦æŸæˆ– PostgreSQL ENUM

```sql
-- æ–¹å¼ä¸€ï¼šä½¿ç”¨ VARCHAR + CHECKï¼ˆæ¨èï¼Œçµæ´»æ€§é«˜ï¼‰
CREATE TABLE seed_mes_orders (
    id SERIAL PRIMARY KEY,
    status VARCHAR(20) DEFAULT 'pending',
    CHECK (status IN ('pending', 'processing', 'completed', 'cancelled'))
);

-- æ–¹å¼äºŒï¼šä½¿ç”¨ PostgreSQL ENUMï¼ˆç±»å‹å®‰å…¨ï¼‰
CREATE TYPE seed_mes_order_status AS ENUM ('pending', 'processing', 'completed', 'cancelled');
CREATE TABLE seed_mes_orders (
    id SERIAL PRIMARY KEY,
    status seed_mes_order_status DEFAULT 'pending'
);
```

## ğŸ—ï¸ è¡¨ç»“æ„è§„èŒƒ

### æ ‡å‡†è¡¨ç»“æ„

**è§„åˆ™**ï¼šæ‰€æœ‰è¡¨åº”åŒ…å«ä»¥ä¸‹æ ‡å‡†å­—æ®µ

```sql
CREATE TABLE æ¨¡å—å‰ç¼€_è¡¨å (
    -- ä¸»é”®
    id SERIAL PRIMARY KEY,

    -- ç»„ç»‡éš”ç¦»ï¼ˆæ‰€æœ‰è¡¨å¿…é¡»åŒ…å«ï¼‰
    tenant_id INTEGER NOT NULL,

    -- ä¸šåŠ¡å­—æ®µ
    -- ...

    -- æ ‡å‡†æ—¶é—´å­—æ®µ
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,  -- è½¯åˆ é™¤ï¼ˆå¯é€‰ï¼‰

    -- æ ‡å‡†ç´¢å¼•
    INDEX idx_æ¨¡å—å‰ç¼€_è¡¨å_tenant_id (tenant_id),
    INDEX idx_æ¨¡å—å‰ç¼€_è¡¨å_created_at (created_at)
);

-- ç¤ºä¾‹ï¼šç³»ç»Ÿçº§è¡¨ï¼ˆcore_ å‰ç¼€ï¼Œç¬¦åˆä¸»æµ B ç«¯å‘½åï¼‰
CREATE TABLE core_users (
    id SERIAL PRIMARY KEY,
    tenant_id INTEGER NOT NULL,
    -- ...
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_core_users_tenant_id (tenant_id),
    INDEX idx_core_users_created_at (created_at)
);

-- ç¤ºä¾‹ï¼šåº”ç”¨æ’ä»¶è¡¨
CREATE TABLE seed_mes_orders (
    id SERIAL PRIMARY KEY,
    tenant_id INTEGER NOT NULL,
    -- ...
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_seed_mes_orders_tenant_id (tenant_id),
    INDEX idx_seed_mes_orders_created_at (created_at)
);
```

### å®Œæ•´ç¤ºä¾‹

```sql
-- ç³»ç»Ÿçº§è¡¨ï¼šç”¨æˆ·è¡¨ï¼ˆcore_ å‰ç¼€ï¼Œç¬¦åˆä¸»æµ B ç«¯å‘½åï¼‰
CREATE TABLE core_users (
    -- ä¸»é”®
    id SERIAL PRIMARY KEY,

    -- ç»„ç»‡éš”ç¦»ï¼ˆå¿…é¡»ï¼‰
    tenant_id INTEGER NOT NULL,

    -- ä¸šåŠ¡å­—æ®µ
    username VARCHAR(50) NOT NULL,
    email VARCHAR(100) NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    full_name VARCHAR(100),
    phone VARCHAR(20),
    avatar_url VARCHAR(255),

    -- çŠ¶æ€å­—æ®µ
    is_active BOOLEAN DEFAULT TRUE,
    is_superuser BOOLEAN DEFAULT FALSE,
    status VARCHAR(20) DEFAULT 'active',

    -- æ—¶é—´å­—æ®µ
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,

    -- ç´¢å¼•ï¼ˆcore_ å‰ç¼€ï¼Œç¬¦åˆä¸»æµ B ç«¯å‘½åï¼‰
    INDEX idx_core_users_tenant_id (tenant_id),
    INDEX idx_core_users_email (email),
    INDEX idx_core_users_username (username),
    INDEX idx_core_users_status (status),
    INDEX idx_core_users_created_at (created_at),

    -- å”¯ä¸€çº¦æŸï¼ˆç»„ç»‡å†…ç”¨æˆ·åå”¯ä¸€ï¼‰
    UNIQUE KEY uk_core_users_tenant_username (tenant_id, username),

    -- å”¯ä¸€çº¦æŸï¼ˆé‚®ç®±å…¨å±€å”¯ä¸€ï¼‰
    UNIQUE KEY uk_core_users_email (email),

    -- å¤–é”®çº¦æŸ
    FOREIGN KEY (tenant_id) REFERENCES platform_tenants(id) ON DELETE RESTRICT
);

-- MES åº”ç”¨æ’ä»¶è¡¨ï¼šè®¢å•è¡¨ï¼ˆä¸»è¡¨ï¼‰
CREATE TABLE seed_mes_orders (
    id SERIAL PRIMARY KEY,
    tenant_id INTEGER NOT NULL,
    order_no VARCHAR(50) NOT NULL,
    customer_name VARCHAR(100) NOT NULL,
    total_amount DECIMAL(10, 2) NOT NULL,
    status VARCHAR(20) DEFAULT 'pending',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    INDEX idx_seed_mes_orders_tenant_id (tenant_id),
    INDEX idx_seed_mes_orders_order_no (order_no),
    INDEX idx_seed_mes_orders_status (status),
    INDEX idx_seed_mes_orders_created_at (created_at),

    UNIQUE KEY uk_seed_mes_orders_tenant_order_no (tenant_id, order_no),

    FOREIGN KEY (tenant_id) REFERENCES platform_tenants(id) ON DELETE RESTRICT
);

-- MES åº”ç”¨æ’ä»¶è¡¨ï¼šè®¢å•æ˜ç»†è¡¨ï¼ˆå­è¡¨ï¼‰
CREATE TABLE seed_mes_order_items (
    id SERIAL PRIMARY KEY,
    tenant_id INTEGER NOT NULL,
    order_id INTEGER NOT NULL,
    product_id INTEGER NOT NULL,
    product_name VARCHAR(100) NOT NULL,
    quantity INTEGER NOT NULL,
    unit_price DECIMAL(10, 2) NOT NULL,
    total_amount DECIMAL(10, 2) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    INDEX idx_seed_mes_order_items_tenant_id (tenant_id),
    INDEX idx_seed_mes_order_items_order_id (order_id),
    INDEX idx_seed_mes_order_items_product_id (product_id),

    FOREIGN KEY (tenant_id) REFERENCES tree_tenants(id) ON DELETE RESTRICT,
    FOREIGN KEY (order_id) REFERENCES seed_mes_orders(id) ON DELETE CASCADE,
    FOREIGN KEY (product_id) REFERENCES seed_mes_products(id) ON DELETE RESTRICT,

    -- æ£€æŸ¥çº¦æŸ
    CONSTRAINT ck_seed_mes_order_items_quantity_positive CHECK (quantity > 0),
    CONSTRAINT ck_seed_mes_order_items_price_positive CHECK (unit_price > 0)
);
```

## ğŸ” æŸ¥è¯¢ä¼˜åŒ–è§„èŒƒ

### ç´¢å¼•ä½¿ç”¨è§„èŒƒ

**è§„åˆ™**ï¼šä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µåˆ›å»ºç´¢å¼•

#### å¿…é¡»åˆ›å»ºç´¢å¼•çš„å­—æ®µ

1. **ç»„ç»‡å­—æ®µ**ï¼šæ‰€æœ‰è¡¨çš„ `tenant_id`ï¼ˆå¤šç»„ç»‡æŸ¥è¯¢å¿…éœ€ï¼‰
2. **å¤–é”®å­—æ®µ**ï¼šæ‰€æœ‰å¤–é”®å­—æ®µï¼ˆå…³è”æŸ¥è¯¢å¿…éœ€ï¼‰
3. **çŠ¶æ€å­—æ®µ**ï¼š`status`ï¼ˆçŠ¶æ€ç­›é€‰å¸¸ç”¨ï¼‰
4. **æ—¶é—´å­—æ®µ**ï¼š`created_at`ã€`updated_at`ï¼ˆæ—¶é—´èŒƒå›´æŸ¥è¯¢å¸¸ç”¨ï¼‰
5. **å”¯ä¸€å­—æ®µ**ï¼šé‚®ç®±ã€ç”¨æˆ·åç­‰ï¼ˆå”¯ä¸€æ€§æ£€æŸ¥å¿…éœ€ï¼‰

#### å¤åˆç´¢å¼•

**è§„åˆ™**ï¼šä¸ºå¸¸ç”¨ç»„åˆæŸ¥è¯¢åˆ›å»ºå¤åˆç´¢å¼•

```sql
-- ç³»ç»Ÿçº§è¡¨å¤åˆç´¢å¼•ï¼ˆcore_ å‰ç¼€ï¼Œç¬¦åˆä¸»æµ B ç«¯å‘½åï¼‰
CREATE INDEX idx_core_users_tenant_status ON core_users(tenant_id, status);

-- åº”ç”¨æ’ä»¶è¡¨å¤åˆç´¢å¼•
-- ç»„ç»‡ + çŠ¶æ€æŸ¥è¯¢ï¼ˆå¸¸ç”¨ï¼‰
CREATE INDEX idx_seed_mes_orders_tenant_status ON seed_mes_orders(tenant_id, status);

-- ç»„ç»‡ + åˆ›å»ºæ—¶é—´æŸ¥è¯¢ï¼ˆå¸¸ç”¨ï¼‰
CREATE INDEX idx_seed_mes_orders_tenant_created ON seed_mes_orders(tenant_id, created_at);

-- è®¢å• + äº§å“æŸ¥è¯¢ï¼ˆä¸»å­è¡¨å…³è”ï¼‰
CREATE INDEX idx_seed_mes_order_items_order_product ON seed_mes_order_items(order_id, product_id);
```

### æŸ¥è¯¢æ€§èƒ½è§„èŒƒ

**è§„åˆ™**ï¼šé¿å…å…¨è¡¨æ‰«æï¼Œä½¿ç”¨ç´¢å¼•å­—æ®µæŸ¥è¯¢

```sql
-- âœ… æ¨èï¼šä½¿ç”¨ç´¢å¼•å­—æ®µæŸ¥è¯¢ï¼ˆç³»ç»Ÿçº§è¡¨ï¼Œcore_ å‰ç¼€ï¼‰
SELECT * FROM core_users WHERE tenant_id = 1 AND status = 'active';

-- âœ… æ¨èï¼šä½¿ç”¨ç´¢å¼•å­—æ®µæŸ¥è¯¢ï¼ˆåº”ç”¨æ’ä»¶è¡¨ï¼‰
SELECT * FROM seed_mes_orders WHERE tenant_id = 1 AND status = 'pending';

-- âŒ ä¸æ¨èï¼šå…¨è¡¨æ‰«æ
SELECT * FROM core_users WHERE full_name LIKE '%å¼ %';

-- âœ… æ¨èï¼šä½¿ç”¨ç´¢å¼•å­—æ®µ + é™åˆ¶æ¡ä»¶
SELECT * FROM core_users
WHERE tenant_id = 1
  AND created_at >= '2024-01-01'
LIMIT 100;
```

## ğŸ“ å‘½åç¤ºä¾‹æ€»ç»“

### å®Œæ•´è¡¨ç»“æ„ç¤ºä¾‹

```sql
-- ç³»ç»Ÿçº§è¡¨ï¼šç”¨æˆ·è¡¨ï¼ˆcore_ å‰ç¼€ï¼Œç¬¦åˆä¸»æµ B ç«¯å‘½åï¼‰
CREATE TABLE core_users (
    id SERIAL PRIMARY KEY,
    tenant_id INTEGER NOT NULL,
    username VARCHAR(50) NOT NULL,
    email VARCHAR(100) NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    full_name VARCHAR(100),
    phone VARCHAR(20),
    is_active BOOLEAN DEFAULT TRUE,
    is_superuser BOOLEAN DEFAULT FALSE,
    status VARCHAR(20) DEFAULT 'active',
    settings JSONB DEFAULT '{}',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,

    INDEX idx_core_users_tenant_id (tenant_id),
    INDEX idx_core_users_email (email),
    INDEX idx_core_users_username (username),
    INDEX idx_core_users_status (status),
    INDEX idx_core_users_created_at (created_at),

    UNIQUE KEY uk_core_users_tenant_username (tenant_id, username),
    UNIQUE KEY uk_core_users_email (email),

    FOREIGN KEY (tenant_id) REFERENCES platform_tenants(id) ON DELETE RESTRICT,

    CONSTRAINT ck_core_users_email_format CHECK (email ~* '^[\w\.-]+@[\w\.-]+\.\w+$'),
    CONSTRAINT ck_core_users_status_valid CHECK (status IN ('active', 'inactive', 'suspended', 'deleted'))
);
```

## âœ… æ£€æŸ¥æ¸…å•

### è¡¨è®¾è®¡æ£€æŸ¥

- [ ] **è¡¨åæ˜¯å¦åŒ…å«æ¨¡å—å‰ç¼€ï¼Ÿ**ï¼ˆå¹³å°çº§ï¼š`platform_`ï¼Œç³»ç»Ÿçº§ï¼š`core_`ï¼Œåº”ç”¨æ’ä»¶ï¼š`seed_æ’ä»¶å_`ï¼‰
- [ ] è¡¨åæ˜¯å¦ä½¿ç”¨å¤æ•°å½¢å¼ï¼Ÿ
- [ ] è¡¨åæ˜¯å¦ä½¿ç”¨å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿ï¼Ÿ
- [ ] æ˜¯å¦åŒ…å« `tenant_id` å­—æ®µï¼Ÿ
- [ ] æ˜¯å¦åŒ…å« `id` ä¸»é”®ï¼Ÿ
- [ ] æ˜¯å¦åŒ…å« `created_at` å’Œ `updated_at`ï¼Ÿ
- [ ] æ˜¯å¦åˆ›å»ºäº† `tenant_id` ç´¢å¼•ï¼Ÿï¼ˆç´¢å¼•ååº”åŒ…å«æ¨¡å—å‰ç¼€ï¼‰
- [ ] æ˜¯å¦åˆ›å»ºäº†å¿…è¦çš„å”¯ä¸€ç´¢å¼•ï¼Ÿï¼ˆç´¢å¼•ååº”åŒ…å«æ¨¡å—å‰ç¼€ï¼‰

### å­—æ®µè®¾è®¡æ£€æŸ¥

- [ ] å­—æ®µåæ˜¯å¦ä½¿ç”¨å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿ï¼Ÿ
- [ ] ä¸»é”®æ˜¯å¦ä½¿ç”¨ `id`ï¼Ÿ
- [ ] å¤–é”®æ˜¯å¦ä½¿ç”¨ `è¡¨å_id` æ ¼å¼ï¼Ÿ
- [ ] å¸ƒå°”å­—æ®µæ˜¯å¦ä½¿ç”¨ `is_` å‰ç¼€ï¼Ÿ
- [ ] æ—¶é—´å­—æ®µæ˜¯å¦ä½¿ç”¨ `_at` åç¼€ï¼Ÿ
- [ ] é‡‘é¢å­—æ®µæ˜¯å¦ä½¿ç”¨ `DECIMAL` ç±»å‹ï¼Ÿ
- [ ] JSON å­—æ®µæ˜¯å¦ä½¿ç”¨ `JSONB` ç±»å‹ï¼Ÿ

### ç´¢å¼•è®¾è®¡æ£€æŸ¥

- [ ] æ˜¯å¦ä¸º `tenant_id` åˆ›å»ºäº†ç´¢å¼•ï¼Ÿï¼ˆç´¢å¼•ååº”åŒ…å«æ¨¡å—å‰ç¼€ï¼‰
- [ ] æ˜¯å¦ä¸ºå¤–é”®åˆ›å»ºäº†ç´¢å¼•ï¼Ÿï¼ˆç´¢å¼•ååº”åŒ…å«æ¨¡å—å‰ç¼€ï¼‰
- [ ] æ˜¯å¦ä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µåˆ›å»ºäº†ç´¢å¼•ï¼Ÿï¼ˆç´¢å¼•ååº”åŒ…å«æ¨¡å—å‰ç¼€ï¼‰
- [ ] æ˜¯å¦ä¸ºå¸¸ç”¨ç»„åˆæŸ¥è¯¢åˆ›å»ºäº†å¤åˆç´¢å¼•ï¼Ÿï¼ˆç´¢å¼•ååº”åŒ…å«æ¨¡å—å‰ç¼€ï¼‰
- [ ] å”¯ä¸€ç´¢å¼•æ˜¯å¦ä½¿ç”¨ `uk_` å‰ç¼€ï¼Ÿ
- [ ] æ™®é€šç´¢å¼•æ˜¯å¦ä½¿ç”¨ `idx_` å‰ç¼€ï¼Ÿ
- [ ] ç´¢å¼•åä¸­çš„è¡¨åæ˜¯å¦åŒ…å«æ¨¡å—å‰ç¼€ï¼Ÿ

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [2.å­—æ®µå‘½åè§„èŒƒ.md](./2.å­—æ®µå‘½åè§„èŒƒ.md) - ä»£ç å‘½åè§„èŒƒ
- [4.æ³¨é‡Šè§„èŒƒ.md](./4.æ³¨é‡Šè§„èŒƒ.md) - ä»£ç æ³¨é‡Šè§„èŒƒ

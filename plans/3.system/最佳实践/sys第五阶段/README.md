# 第五阶段：个人中心建设

## 📋 概述

第五阶段是系统级功能建设的个人中心阶段，建立个人中心功能，提升用户体验。

**建设时间**：4 周  
**状态**：⏳ **待开始**

**核心原则**：
- ✅ **用户体验优先**：所有功能以提升用户体验为目标
- ✅ **数据隔离**：个人数据按组织隔离，支持多租户
- ✅ **统一设计规范**：复用前几个阶段的设计规范

---

## 📁 本文件夹内容

本文件夹包含第五阶段建设所需的所有规划文档：

1. **最佳实践文档**：
   - [1.个人资料最佳实践.md](./1.个人资料最佳实践.md)
   - [2.偏好设置最佳实践.md](./2.偏好设置最佳实践.md)
   - [3.我的消息最佳实践.md](./3.我的消息最佳实践.md)
   - [4.我的任务最佳实践.md](./4.我的任务最佳实践.md)

2. **规范文档**：
   - [前端页面布局规范.md](./前端页面布局规范.md)（复用第四阶段规范）
   - [系统级功能文件结构规划.md](./系统级功能文件结构规划.md)（复用第四阶段规范）

3. **开发计划**：
   - [建设进度.md](./建设进度.md)（开发进度跟踪）

---

## 🚀 建设顺序

### 1. 个人资料（第1优先级）

**预计时间**：1 周  
**状态**：⏳ 待开始

**依赖**：用户管理（已有用户模型）

**核心特点**：
- ✅ **扩展用户模型**：在现有用户模型基础上扩展个人资料字段
- ✅ **头像上传**：关联文件管理，支持头像上传
- ✅ **联系方式管理**：使用 JSON 字段存储灵活的联系方式

**文件位置**：
- 后端：扩展 `soil/models/user.py`（添加个人资料字段）
- 前端：`riveredge-frontend/src/tree-stem/pages/personal/profile/`

**建设步骤**：
1. ⏳ 扩展用户模型（添加 avatar、bio、contact_info 字段）
2. ⏳ 创建 Schema（数据验证）
3. ⏳ 创建 Service（业务逻辑）
4. ⏳ 创建 API（路由）
5. ⏳ 创建数据库迁移
6. ⏳ 创建前端页面和服务

---

### 2. 偏好设置（第2优先级）

**预计时间**：1 周  
**状态**：⏳ 待开始

**依赖**：无（独立功能）

**核心特点**：
- ✅ **用户偏好模型**：独立的用户偏好表，一对一关联用户
- ✅ **JSON 配置**：使用 JSON 字段存储灵活的偏好设置
- ✅ **Redis 缓存**：偏好设置缓存到 Redis，提升性能

**文件位置**：
- 后端：`riveredge-backend/src/tree_root/api/user_preferences/`
- 前端：`riveredge-frontend/src/tree-stem/pages/personal/preferences/`

**建设步骤**：
1. ⏳ 创建数据库模型（UserPreference）
2. ⏳ 创建 Schema（数据验证）
3. ⏳ 创建 Service（业务逻辑，包含 Redis 缓存）
4. ⏳ 创建 API（路由）
5. ⏳ 创建数据库迁移
6. ⏳ 创建前端页面和服务

---

### 3. 我的消息（第3优先级）

**预计时间**：1 周  
**状态**：⏳ 待开始

**依赖**：消息管理（需要消息系统）

**核心特点**：
- ✅ **用户消息模型**：独立的用户消息表，存储用户接收的消息
- ✅ **消息状态管理**：支持已读/未读状态
- ✅ **消息分类**：支持多种消息类型和级别

**文件位置**：
- 后端：`riveredge-backend/src/tree_root/api/user_messages/`
- 前端：`riveredge-frontend/src/tree-stem/pages/personal/messages/`

**建设步骤**：
1. ⏳ 创建数据库模型（UserMessage）
2. ⏳ 创建 Schema（数据验证）
3. ⏳ 创建 Service（业务逻辑）
4. ⏳ 创建 API（路由）
5. ⏳ 创建数据库迁移
6. ⏳ 创建前端页面和服务

---

### 4. 我的任务（第4优先级）

**预计时间**：1 周  
**状态**：⏳ 待开始

**依赖**：审批流程（任务来自审批）

**核心特点**：
- ✅ **复用审批实例模型**：不需要新建模型，复用 ApprovalInstance
- ✅ **任务分类查询**：我发起的、我的待办、我的已办、我的抄送
- ✅ **任务统计**：提供待办任务数量等统计信息

**文件位置**：
- 后端：`riveredge-backend/src/tree_root/api/my_tasks/`
- 前端：`riveredge-frontend/src/tree-stem/pages/personal/tasks/`

**建设步骤**：
1. ⏳ 创建 Service（业务逻辑，查询审批实例）
2. ⏳ 创建 API（路由）
3. ⏳ 创建前端页面和服务

---

## 📚 相关文档

- [系统级功能建设计划.md](../系统级功能建设计划.md)
- [第四阶段建设规范](../sys第四阶段/)
- [第三阶段建设规范](../sys第三阶段/)
- [第二阶段建设规范](../sys第二阶段/)
- [第一阶段建设规范](../sys第一阶段/)

---

## 🎯 第五阶段核心目标

### 1. 提升用户体验

- ✅ **个人资料管理**：用户可以完善个人资料，上传头像
- ✅ **偏好设置**：用户可以自定义界面主题、语言、通知设置
- ✅ **消息中心**：用户可以查看和管理收到的消息
- ✅ **任务中心**：用户可以查看和处理自己的任务

### 2. 统一的设计规范

- ✅ 复用第一、第二、第三、第四阶段的设计规范（混合ID方案、API设计规范、数据库设计规范）
- ✅ 保持代码规范（命名、注释、错误处理）
- ✅ 多租户隔离（所有数据自动过滤 tenant_id）
- ✅ 前端页面布局规范（UniTable、Modal、Drawer 标准用法）

### 3. 经验教训应用

- ✅ **禁止假设和猜测**：必须直接查看实际代码，使用完全相同的值
- ✅ **禁止擅作主张**：只做用户明确要求的事，不做额外"优化"
- ✅ **数据库迁移规范**：必须使用 Aerich 迁移系统，禁止直接使用 SQL
- ✅ **前端搜索规范**：必须使用高级搜索（`showAdvancedSearch={true}`），使用 `searchFormValues` 获取搜索条件

---

## ⚠️ 重要注意事项

### 1. 个人数据隔离

**必须遵守的原则**：
1. ✅ **所有个人数据按组织隔离**：使用 tenant_id 过滤
2. ✅ **用户只能访问自己的数据**：API 自动过滤当前用户
3. ✅ **管理员可以查看组织内所有用户数据**：需要权限控制

### 2. 用户体验优化

**设计要点**：
1. ✅ **界面友好**：使用 Ant Design 组件，保持界面一致性
2. ✅ **操作便捷**：常用操作放在显眼位置
3. ✅ **反馈及时**：操作后及时反馈结果
4. ✅ **数据实时**：未读消息、待办任务数量实时更新

### 3. 开发顺序

**严格按照依赖关系开发**：
1. **个人资料**（第1优先级）- 依赖用户管理，可立即开始
2. **偏好设置**（第2优先级）- 无依赖，可并行开发
3. **我的消息**（第3优先级）- 依赖消息管理，需等待消息管理完成后开始
4. **我的任务**（第4优先级）- 依赖审批流程，需等待审批流程完成后开始

---

**最后更新**：2025-01-XX


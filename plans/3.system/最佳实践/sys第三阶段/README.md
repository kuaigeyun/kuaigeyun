# 第三阶段：数据中心建设

## 📋 概述

第三阶段是系统级功能建设的数据中心阶段，建立数据管理和接口管理功能，为业务功能提供数据支持。

**建设时间**：6-10 周  
**状态**：⏳ **待开始**

---

## 📁 本文件夹内容

本文件夹包含第三阶段建设所需的所有规划文档：

1. **最佳实践文档**：
   - [1.文件管理最佳实践.md](./1.文件管理最佳实践.md)
   - [2.接口管理最佳实践.md](./2.接口管理最佳实践.md)
   - [3.数据源管理最佳实践.md](./3.数据源管理最佳实践.md)
   - [4.数据集管理最佳实践.md](./4.数据集管理最佳实践.md)

2. **规范文档**：
   - [前端页面布局规范.md](./前端页面布局规范.md)（复用第二阶段规范）
   - [系统级功能文件结构规划.md](./系统级功能文件结构规划.md)（复用第二阶段规范）

3. **技术选型文档**：
   - [库选择评估总结.md](./库选择评估总结.md)（各模块库选择评估汇总）

4. **开发计划**：
   - [建设进度.md](./建设进度.md)（开发进度跟踪）

5. **建设总结**：
   - [第三阶段建设总结.md](./第三阶段建设总结.md)（待建设完成后填写）

---

## 🚀 建设顺序

### 1. 文件管理（第1优先级）

**预计时间**：1-2 周  
**状态**：⏳ 待开始

**依赖**：无（独立功能）

**文件位置**：
- 后端：`riveredge-backend/src/tree_root/api/files/`
- 前端：`riveredge-frontend/src/tree-stem/pages/system/files/`

**建设步骤**：
1. ⏳ 创建数据库模型（File）
2. ⏳ 创建 Schema（数据验证）
3. ⏳ 创建 Service（业务逻辑，包含文件存储服务、kkFileView 集成）
4. ⏳ 创建 API（路由，包含上传、下载、删除、列表、预览）
5. ⏳ 创建前端页面（文件列表、上传、下载、删除、预览）
6. ⏳ 创建前端服务

**关键技术**：
- kkFileView（文件预览服务，需要独立部署）
- aiofiles（异步文件操作）

---

### 2. 接口管理（第2优先级）

**预计时间**：2-3 周  
**状态**：⏳ 待开始

**依赖**：无（独立功能）

**文件位置**：
- 后端：`riveredge-backend/src/tree_root/api/apis/`
- 前端：`riveredge-frontend/src/tree-stem/pages/system/apis/`

**建设步骤**：
1. ⏳ 创建数据库模型（API）
2. ⏳ 创建 Schema（数据验证）
3. ⏳ 创建 Service（业务逻辑，包含接口测试功能）
4. ⏳ 创建 API（路由，包含 CRUD、测试调用）
5. ⏳ 创建前端页面（接口列表、创建、编辑、删除、测试调用、文档生成）
6. ⏳ 创建前端服务

**关键技术**：
- httpx（已使用，用于接口测试）
- OpenAPI（接口文档生成）

---

### 3. 数据源管理（第3优先级）

**预计时间**：2-3 周  
**状态**：⏳ 待开始

**依赖**：无（独立功能）

**文件位置**：
- 后端：`riveredge-backend/src/tree_root/api/data_sources/`
- 前端：`riveredge-frontend/src/tree-stem/pages/system/data-sources/`

**建设步骤**：
1. ⏳ 创建数据库模型（DataSource）
2. ⏳ 创建 Schema（数据验证）
3. ⏳ 创建 Service（业务逻辑，包含连接测试功能）
4. ⏳ 创建 API（路由，包含 CRUD、测试连接）
5. ⏳ 创建前端页面（数据源列表、创建、编辑、删除、测试连接）
6. ⏳ 创建前端服务

**关键技术**：
- SQLAlchemy（可选，如果需要支持多种数据库）
- pymongo（可选，如果需要支持 MongoDB）
- Tortoise ORM（已使用，PostgreSQL 连接测试）

---

### 4. 数据集管理（第4优先级）

**预计时间**：2-3 周  
**状态**：⏳ 待开始

**依赖**：数据源管理（数据集需要数据源）

**文件位置**：
- 后端：`riveredge-backend/src/tree_root/api/datasets/`
- 前端：`riveredge-frontend/src/tree-stem/pages/system/datasets/`

**建设步骤**：
1. ⏳ 创建数据库模型（Dataset）
2. ⏳ 创建 Schema（数据验证）
3. ⏳ 创建 Service（业务逻辑，包含查询执行功能）
4. ⏳ 创建 API（路由，包含 CRUD、执行查询、预览数据）
5. ⏳ 创建前端页面（数据集列表、创建、编辑、删除、执行查询、预览数据）
6. ⏳ 创建前端服务

**关键技术**：
- pandas（可选，如果数据量大，需要数据分析）
- SQLAlchemy（可选，如果需要支持多种数据库）

---

## 📚 相关文档

- [系统级功能建设计划.md](../系统级功能建设计划.md)
- [第二阶段建设规范](../sys第二阶段/)
- [第一阶段建设规范](../sys第一阶段/)

---

## 🎯 第三阶段核心目标

### 1. 数据管理能力
- ✅ 文件管理（文件上传、下载、预览、kkFileView 集成）
- ✅ 接口管理（接口定义、测试调用、文档生成）
- ✅ 数据源管理（多数据源连接、连接测试）
- ✅ 数据集管理（数据集定义、查询执行、数据预览）

### 2. 统一的设计规范
- ✅ 复用第一、第二阶段的设计规范（混合ID方案、API设计规范、数据库设计规范）
- ✅ 保持代码规范（命名、注释、错误处理）
- ✅ 多租户隔离（所有数据自动过滤 tenant_id）
- ✅ 前端页面布局规范（UniTable、Modal、Drawer 标准用法）

### 3. 经验教训应用
- ✅ **禁止假设和猜测**：必须直接查看实际代码，使用完全相同的值
- ✅ **禁止擅作主张**：只做用户明确要求的事，不做额外"优化"
- ✅ **数据库迁移规范**：必须使用 Aerich 迁移系统，禁止直接使用 SQL
- ✅ **前端搜索规范**：必须使用高级搜索（`showAdvancedSearch={true}`），使用 `searchFormValues` 获取搜索条件

---

## ⚠️ 重要注意事项

### 1. 吸取第一、第二阶段经验教训

**必须遵守的规范**：
1. ✅ **禁止假设和猜测**：必须直接查看实际代码，使用完全相同的值
2. ✅ **禁止擅作主张**：只做用户明确要求的事，不做额外"优化"
3. ✅ **数据库迁移规范**：必须使用 Aerich 迁移系统，禁止直接使用 SQL
4. ✅ **前端搜索规范**：必须使用高级搜索（`showAdvancedSearch={true}`），使用 `searchFormValues` 获取搜索条件
5. ✅ **UniTable 规范**：`request` 函数必须接收四个参数：`(params, sort, _filter, searchFormValues)`

### 2. 技术选型注意事项

**文件管理**：
- kkFileView 需要独立部署（Java 服务），需要提前规划部署方案
- 文件存储可以使用本地存储或对象存储（OSS），需要根据实际需求选择

**接口管理**：
- 接口测试使用 httpx（已使用），无需额外依赖
- 接口文档生成可以使用 FastAPI 的 OpenAPI 功能

**数据源管理**：
- 优先支持 PostgreSQL（已有 Tortoise ORM）
- 其他数据库（MySQL、MongoDB）可选，根据实际需求决定是否支持

**数据集管理**：
- 优先支持 SQL 查询（PostgreSQL）
- 数据分析功能（pandas）可选，根据实际需求决定是否支持

### 3. 开发顺序

**严格按照依赖关系开发**：
1. **文件管理**（第1优先级）- 无依赖，可立即开始
2. **接口管理**（第2优先级）- 无依赖，可并行开发
3. **数据源管理**（第3优先级）- 无依赖，可并行开发
4. **数据集管理**（第4优先级）- 依赖数据源管理，需等待数据源管理完成后开始

---

**最后更新**：2025-01-XX


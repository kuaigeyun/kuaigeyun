# æ•°æ®å­—å…¸æœ€ä½³å®è·µ

## ğŸ“‹ æ¨¡å—æ¦‚è¿°

**æ¨¡å—åç§°**ï¼šæ•°æ®å­—å…¸ï¼ˆData Dictionary Managementï¼‰  
**ä¼˜å…ˆçº§**ï¼šâ­â­â­â­ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰  
**é¢„è®¡æ—¶é—´**ï¼š1 å‘¨  
**ä¾èµ–**ï¼šæ— ï¼ˆç‹¬ç«‹åŠŸèƒ½ï¼‰

**åŠŸèƒ½èŒƒå›´**ï¼š
- æ•°æ®å­—å…¸ç®¡ç†ï¼ˆå­—å…¸ç±»å‹ CRUDï¼‰
- å­—å…¸é¡¹ç®¡ç†ï¼ˆå­—å…¸é¡¹ CRUDï¼‰
- å­—å…¸æŸ¥è¯¢ APIï¼ˆæŒ‰ç±»å‹æŸ¥è¯¢ï¼‰
- å­—å…¸ç¼“å­˜ï¼ˆå¯é€‰ï¼Œæå‡æ€§èƒ½ï¼‰

---

## ğŸ” åº“é€‰æ‹©è¯„ä¼°

### æ•°æ®å­—å…¸å®ç°æ–¹æ¡ˆ

**ç»“è®º**ï¼šâœ… **ä½¿ç”¨è‡ªå®šä¹‰å®ç°ï¼ˆæ¨èï¼‰**

ç»è¿‡è°ƒç ”ï¼Œæ•°æ®å­—å…¸åŠŸèƒ½ç›¸å¯¹ç®€å•ï¼Œä¸»è¦æ˜¯æ ‡å‡†çš„ CRUD æ“ä½œï¼š

#### æ–¹æ¡ˆä¸€ï¼šè‡ªå®šä¹‰å®ç° â­â­â­â­â­ï¼ˆå¼ºçƒˆæ¨èï¼‰

**ä¼˜åŠ¿**ï¼š
- âœ… åŠŸèƒ½ç®€å•ï¼Œå®ç°æˆæœ¬ä½ï¼ˆ1 å‘¨å¯å®Œæˆï¼‰
- âœ… ä¸ Tortoise ORM å®Œç¾é›†æˆï¼ˆåŸç”Ÿæ”¯æŒï¼‰
- âœ… å¤šç§Ÿæˆ·éš”ç¦»å¤©ç„¶æ”¯æŒï¼ˆtenant_id å­—æ®µï¼‰
- âœ… å®Œå…¨ç¬¦åˆæ¡†æ¶è§„èŒƒï¼ˆå‘½åã€æ³¨é‡Šã€ä»£ç é£æ ¼ï¼‰
- âœ… å®Œå…¨æ§åˆ¶ï¼Œæ˜“äºå®šåˆ¶å’Œæ‰©å±•
- âœ… æ— éœ€å¼•å…¥é¢å¤–ä¾èµ–

**åŠ£åŠ¿**ï¼š
- âš ï¸ éœ€è¦è‡ªå·±å®ç°æ‰€æœ‰åŠŸèƒ½ï¼ˆä½†åŠŸèƒ½ç›¸å¯¹ç®€å•ï¼‰

**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… æ ‡å‡†çš„å­—å…¸ç®¡ç†éœ€æ±‚
- âœ… éœ€è¦ä¸ç°æœ‰æ¡†æ¶æ·±åº¦é›†æˆ
- âœ… éœ€è¦å®Œå…¨ç¬¦åˆé¡¹ç›®è§„èŒƒ
- âœ… å¤šç§Ÿæˆ·æ˜¯æ ¸å¿ƒéœ€æ±‚

**å®ç°å¤æ‚åº¦**ï¼šâ­ï¼ˆç®€å•ï¼Œ1 å‘¨å¯å®Œæˆï¼‰

---

#### æ–¹æ¡ˆäºŒï¼šä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ â­â­ï¼ˆä¸æ¨èï¼‰

**è°ƒç ”ç»“æœ**ï¼š
- âŒ Tortoise ORM ç”Ÿæ€ä¸­æ²¡æœ‰ä¸“é—¨çš„æ•°æ®å­—å…¸åº“
- âŒ Django ç”Ÿæ€æœ‰ `django-dictionary`ï¼Œä½†ä¸é€‚ç”¨äº FastAPI + Tortoise ORM
- âŒ å…¶ä»–é€šç”¨åº“åŠŸèƒ½è¿‡äºå¤æ‚ï¼Œä¸ç¬¦åˆç®€å•éœ€æ±‚

**ç»“è®º**ï¼šæ•°æ®å­—å…¸åŠŸèƒ½ç®€å•ï¼Œä½¿ç”¨ç¬¬ä¸‰æ–¹åº“åè€Œå¢åŠ å¤æ‚åº¦ï¼Œä¸æ¨èã€‚

---

### æœ€ç»ˆæ¨èæ–¹æ¡ˆ

**æ¨è**ï¼šâœ… **ä½¿ç”¨è‡ªå®šä¹‰å®ç°**

**ç†ç”±**ï¼š
1. âœ… **åŠŸèƒ½ç®€å•**ï¼Œè‡ªå®šä¹‰å®ç°æˆæœ¬ä½ï¼ˆ1 å‘¨ï¼‰
2. âœ… **æ— éœ€é¢å¤–ä¾èµ–**ï¼Œå‡å°‘é¡¹ç›®å¤æ‚åº¦
3. âœ… **å¤šç§Ÿæˆ·æ˜¯æ ¸å¿ƒéœ€æ±‚**ï¼Œè‡ªå®šä¹‰å®ç°å¤©ç„¶æ”¯æŒ
4. âœ… **å®Œå…¨ç¬¦åˆæ¡†æ¶è§„èŒƒ**ï¼Œä»£ç é£æ ¼ç»Ÿä¸€
5. âœ… **ç»´æŠ¤æˆæœ¬ä½**ï¼Œå›¢é˜Ÿå®Œå…¨æŒæ§ä»£ç 

---

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### 1. æ•°æ®å­—å…¸è¡¨ï¼ˆroot_data_dictionariesï¼‰

```sql
CREATE TABLE root_data_dictionaries (
    id SERIAL PRIMARY KEY,
    uuid VARCHAR(36) NOT NULL UNIQUE,        -- ä¸šåŠ¡IDï¼ˆUUIDï¼Œå¯¹å¤–æš´éœ²ï¼Œå®‰å…¨ä¸”å”¯ä¸€ï¼‰
    tenant_id INTEGER NOT NULL,
    
    -- å­—å…¸åŸºæœ¬ä¿¡æ¯
    name VARCHAR(100) NOT NULL,              -- å­—å…¸åç§°
    code VARCHAR(50) NOT NULL,               -- å­—å…¸ä»£ç ï¼ˆå”¯ä¸€ï¼Œç”¨äºç¨‹åºè¯†åˆ«ï¼‰
    description TEXT,                        -- å­—å…¸æè¿°
    is_system BOOLEAN DEFAULT FALSE,         -- æ˜¯å¦ç³»ç»Ÿå­—å…¸ï¼ˆç³»ç»Ÿå­—å…¸ä¸å¯åˆ é™¤ï¼‰
    is_active BOOLEAN DEFAULT TRUE,          -- æ˜¯å¦å¯ç”¨
    
    -- æ ‡å‡†å­—æ®µ
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,
    
    -- ç´¢å¼•
    CONSTRAINT uk_root_data_dictionaries_tenant_code UNIQUE (tenant_id, code),
    INDEX idx_root_data_dictionaries_tenant_id (tenant_id),
    INDEX idx_root_data_dictionaries_uuid (uuid),
    INDEX idx_root_data_dictionaries_code (code),
    INDEX idx_root_data_dictionaries_created_at (created_at)
);
```

**è®¾è®¡è¦ç‚¹**ï¼š
- âœ… **æ··åˆIDæ–¹æ¡ˆ**ï¼š`id`ï¼ˆè‡ªå¢IDï¼Œå†…éƒ¨ä½¿ç”¨ï¼‰+ `uuid`ï¼ˆUUIDï¼Œå¯¹å¤–æš´éœ²ï¼‰
- âœ… `code` å­—æ®µç”¨äºç¨‹åºè¯†åˆ«ï¼Œä¸ `name` åˆ†ç¦»ï¼ˆæ”¯æŒå¤šè¯­è¨€ï¼‰
- âœ… `is_system` æ ‡è®°ç³»ç»Ÿå­—å…¸ï¼Œé˜²æ­¢è¯¯åˆ 
- âœ… `tenant_id + code` å”¯ä¸€çº¦æŸï¼Œç¡®ä¿ç»„ç»‡å†…å­—å…¸ä»£ç å”¯ä¸€
- âœ… è½¯åˆ é™¤æ”¯æŒï¼ˆ`deleted_at`ï¼‰

### 2. å­—å…¸é¡¹è¡¨ï¼ˆroot_dictionary_itemsï¼‰

```sql
CREATE TABLE root_dictionary_items (
    id SERIAL PRIMARY KEY,
    uuid VARCHAR(36) NOT NULL UNIQUE,        -- ä¸šåŠ¡IDï¼ˆUUIDï¼Œå¯¹å¤–æš´éœ²ï¼Œå®‰å…¨ä¸”å”¯ä¸€ï¼‰
    tenant_id INTEGER NOT NULL,
    dictionary_id INTEGER NOT NULL,          -- å…³è”å­—å…¸IDï¼ˆå†…éƒ¨ä½¿ç”¨è‡ªå¢IDï¼‰
    
    -- å­—å…¸é¡¹åŸºæœ¬ä¿¡æ¯
    label VARCHAR(100) NOT NULL,            -- å­—å…¸é¡¹æ ‡ç­¾ï¼ˆæ˜¾ç¤ºåç§°ï¼‰
    value VARCHAR(100) NOT NULL,            -- å­—å…¸é¡¹å€¼ï¼ˆç”¨äºç¨‹åºè¯†åˆ«ï¼‰
    description TEXT,                        -- å­—å…¸é¡¹æè¿°
    color VARCHAR(20),                       -- æ ‡ç­¾é¢œè‰²ï¼ˆå¯é€‰ï¼Œç”¨äºå‰ç«¯æ˜¾ç¤ºï¼‰
    icon VARCHAR(50),                        -- å›¾æ ‡ï¼ˆå¯é€‰ï¼‰
    
    -- æ’åºå’ŒçŠ¶æ€
    sort_order INTEGER DEFAULT 0,           -- æ’åºé¡ºåº
    is_active BOOLEAN DEFAULT TRUE,          -- æ˜¯å¦å¯ç”¨
    
    -- æ ‡å‡†å­—æ®µ
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,
    
    -- ç´¢å¼•
    CONSTRAINT uk_root_dictionary_items_tenant_dict_value UNIQUE (tenant_id, dictionary_id, value),
    INDEX idx_root_dictionary_items_tenant_id (tenant_id),
    INDEX idx_root_dictionary_items_uuid (uuid),
    INDEX idx_root_dictionary_items_dictionary_id (dictionary_id),
    INDEX idx_root_dictionary_items_sort_order (sort_order),
    INDEX idx_root_dictionary_items_created_at (created_at),
    
    -- å¤–é”®
    FOREIGN KEY (dictionary_id) REFERENCES root_data_dictionaries(id) ON DELETE CASCADE
);
```

**è®¾è®¡è¦ç‚¹**ï¼š
- âœ… `dictionary_id` å…³è”å­—å…¸ï¼ˆå†…éƒ¨ä½¿ç”¨è‡ªå¢IDï¼‰
- âœ… `label` ç”¨äºæ˜¾ç¤ºï¼Œ`value` ç”¨äºç¨‹åºè¯†åˆ«
- âœ… `tenant_id + dictionary_id + value` å”¯ä¸€çº¦æŸï¼Œç¡®ä¿åŒä¸€å­—å…¸å†…å€¼å”¯ä¸€
- âœ… `sort_order` ç”¨äºå­—å…¸é¡¹æ’åº
- âœ… CASCADE åˆ é™¤ï¼Œå­—å…¸åˆ é™¤æ—¶è‡ªåŠ¨æ¸…ç†å­—å…¸é¡¹

---

## ğŸ åç«¯æ¨¡å‹è®¾è®¡

### 1. æ•°æ®å­—å…¸æ¨¡å‹ï¼ˆDataDictionaryï¼‰

```python
# riveredge-backend/src/tree-root/models/data_dictionary.py
from tortoise.models import Model
from tortoise import fields
from typing import Optional, List
from .base import BaseModel


class DataDictionary(BaseModel):
    """
    æ•°æ®å­—å…¸æ¨¡å‹
    
    ç”¨äºå®šä¹‰ç³»ç»Ÿä¸­çš„æ•°æ®å­—å…¸ç±»å‹ï¼Œæ¯ä¸ªå­—å…¸å¯ä»¥åŒ…å«å¤šä¸ªå­—å…¸é¡¹ã€‚
    æ”¯æŒå¤šç»„ç»‡éš”ç¦»ï¼Œæ¯ä¸ªç»„ç»‡å¯ä»¥å®šä¹‰è‡ªå·±çš„å­—å…¸ã€‚
    
    æ³¨æ„ï¼šç»§æ‰¿è‡ª BaseModelï¼Œè‡ªåŠ¨åŒ…å« uuidã€tenant_idã€created_atã€updated_at å­—æ®µã€‚
    """
    id = fields.IntField(pk=True, description="å­—å…¸IDï¼ˆä¸»é”®ï¼Œè‡ªå¢IDï¼Œå†…éƒ¨ä½¿ç”¨ï¼‰")
    # uuid å­—æ®µç”± BaseModel æä¾›
    # tenant_id å­—æ®µç”± BaseModel æä¾›
    
    name = fields.CharField(max_length=100, description="å­—å…¸åç§°")
    code = fields.CharField(max_length=50, description="å­—å…¸ä»£ç ï¼ˆå”¯ä¸€ï¼Œç”¨äºç¨‹åºè¯†åˆ«ï¼‰")
    description = fields.TextField(null=True, description="å­—å…¸æè¿°")
    is_system = fields.BooleanField(default=False, description="æ˜¯å¦ç³»ç»Ÿå­—å…¸ï¼ˆç³»ç»Ÿå­—å…¸ä¸å¯åˆ é™¤ï¼‰")
    is_active = fields.BooleanField(default=True, description="æ˜¯å¦å¯ç”¨")
    
    # å…³è”å­—å…¸é¡¹ï¼ˆä¸€å¯¹å¤šï¼‰
    items: fields.ReverseRelation["DictionaryItem"]
    
    class Meta:
        table = "root_data_dictionaries"
        indexes = [
            ("tenant_id", "code"),  # å”¯ä¸€ç´¢å¼•
        ]
        unique_together = [("tenant_id", "code")]
    
    def __str__(self):
        return f"{self.name} ({self.code})"
```

### 2. å­—å…¸é¡¹æ¨¡å‹ï¼ˆDictionaryItemï¼‰

```python
# riveredge-backend/src/tree-root/models/dictionary_item.py
from tortoise.models import Model
from tortoise import fields
from typing import Optional
from .base import BaseModel
from .data_dictionary import DataDictionary


class DictionaryItem(BaseModel):
    """
    å­—å…¸é¡¹æ¨¡å‹
    
    ç”¨äºå®šä¹‰æ•°æ®å­—å…¸çš„å…·ä½“é¡¹ï¼Œæ¯ä¸ªå­—å…¸é¡¹å±äºä¸€ä¸ªå­—å…¸ã€‚
    æ”¯æŒå¤šç»„ç»‡éš”ç¦»ã€‚
    
    æ³¨æ„ï¼šç»§æ‰¿è‡ª BaseModelï¼Œè‡ªåŠ¨åŒ…å« uuidã€tenant_idã€created_atã€updated_at å­—æ®µã€‚
    """
    id = fields.IntField(pk=True, description="å­—å…¸é¡¹IDï¼ˆä¸»é”®ï¼Œè‡ªå¢IDï¼Œå†…éƒ¨ä½¿ç”¨ï¼‰")
    # uuid å­—æ®µç”± BaseModel æä¾›
    # tenant_id å­—æ®µç”± BaseModel æä¾›
    
    dictionary: fields.ForeignKeyRelation[DataDictionary] = fields.ForeignKeyField(
        "models.DataDictionary",
        related_name="items",
        description="å…³è”å­—å…¸ï¼ˆå†…éƒ¨ä½¿ç”¨è‡ªå¢IDï¼‰"
    )
    dictionary_id = fields.IntField(description="å­—å…¸IDï¼ˆå†…éƒ¨ä½¿ç”¨è‡ªå¢IDï¼‰")
    
    label = fields.CharField(max_length=100, description="å­—å…¸é¡¹æ ‡ç­¾ï¼ˆæ˜¾ç¤ºåç§°ï¼‰")
    value = fields.CharField(max_length=100, description="å­—å…¸é¡¹å€¼ï¼ˆç”¨äºç¨‹åºè¯†åˆ«ï¼‰")
    description = fields.TextField(null=True, description="å­—å…¸é¡¹æè¿°")
    color = fields.CharField(max_length=20, null=True, description="æ ‡ç­¾é¢œè‰²ï¼ˆå¯é€‰ï¼‰")
    icon = fields.CharField(max_length=50, null=True, description="å›¾æ ‡ï¼ˆå¯é€‰ï¼‰")
    
    sort_order = fields.IntField(default=0, description="æ’åºé¡ºåº")
    is_active = fields.BooleanField(default=True, description="æ˜¯å¦å¯ç”¨")
    
    class Meta:
        table = "root_dictionary_items"
        indexes = [
            ("tenant_id", "dictionary_id", "value"),  # å”¯ä¸€ç´¢å¼•
        ]
        unique_together = [("tenant_id", "dictionary_id", "value")]
    
    def __str__(self):
        return f"{self.label} ({self.value})"
```

---

## ğŸ“ Schema è®¾è®¡

### 1. æ•°æ®å­—å…¸ Schema

```python
# riveredge-backend/src/tree-root/schemas/data_dictionary.py
from pydantic import BaseModel, Field, ConfigDict
from typing import Optional, List
from datetime import datetime
from uuid import UUID


class DataDictionaryBase(BaseModel):
    """æ•°æ®å­—å…¸åŸºç¡€ Schema"""
    name: str = Field(..., max_length=100, description="å­—å…¸åç§°")
    code: str = Field(..., max_length=50, description="å­—å…¸ä»£ç ")
    description: Optional[str] = Field(None, description="å­—å…¸æè¿°")
    is_system: bool = Field(False, description="æ˜¯å¦ç³»ç»Ÿå­—å…¸")
    is_active: bool = Field(True, description="æ˜¯å¦å¯ç”¨")


class DataDictionaryCreate(DataDictionaryBase):
    """åˆ›å»ºæ•°æ®å­—å…¸ Schema"""
    pass


class DataDictionaryUpdate(BaseModel):
    """æ›´æ–°æ•°æ®å­—å…¸ Schema"""
    name: Optional[str] = Field(None, max_length=100, description="å­—å…¸åç§°")
    code: Optional[str] = Field(None, max_length=50, description="å­—å…¸ä»£ç ")
    description: Optional[str] = Field(None, description="å­—å…¸æè¿°")
    is_active: Optional[bool] = Field(None, description="æ˜¯å¦å¯ç”¨")


class DataDictionaryResponse(DataDictionaryBase):
    """æ•°æ®å­—å…¸å“åº” Schema"""
    uuid: UUID = Field(..., description="å­—å…¸UUID")
    tenant_id: int = Field(..., description="ç»„ç»‡ID")
    created_at: datetime = Field(..., description="åˆ›å»ºæ—¶é—´")
    updated_at: datetime = Field(..., description="æ›´æ–°æ—¶é—´")
    
    model_config = ConfigDict(from_attributes=True)
```

### 2. å­—å…¸é¡¹ Schema

```python
# riveredge-backend/src/tree-root/schemas/dictionary_item.py
from pydantic import BaseModel, Field, ConfigDict
from typing import Optional
from datetime import datetime
from uuid import UUID


class DictionaryItemBase(BaseModel):
    """å­—å…¸é¡¹åŸºç¡€ Schema"""
    label: str = Field(..., max_length=100, description="å­—å…¸é¡¹æ ‡ç­¾")
    value: str = Field(..., max_length=100, description="å­—å…¸é¡¹å€¼")
    description: Optional[str] = Field(None, description="å­—å…¸é¡¹æè¿°")
    color: Optional[str] = Field(None, max_length=20, description="æ ‡ç­¾é¢œè‰²")
    icon: Optional[str] = Field(None, max_length=50, description="å›¾æ ‡")
    sort_order: int = Field(0, description="æ’åºé¡ºåº")
    is_active: bool = Field(True, description="æ˜¯å¦å¯ç”¨")


class DictionaryItemCreate(DictionaryItemBase):
    """åˆ›å»ºå­—å…¸é¡¹ Schema"""
    dictionary_uuid: UUID = Field(..., description="å­—å…¸UUID")


class DictionaryItemUpdate(BaseModel):
    """æ›´æ–°å­—å…¸é¡¹ Schema"""
    label: Optional[str] = Field(None, max_length=100, description="å­—å…¸é¡¹æ ‡ç­¾")
    value: Optional[str] = Field(None, max_length=100, description="å­—å…¸é¡¹å€¼")
    description: Optional[str] = Field(None, description="å­—å…¸é¡¹æè¿°")
    color: Optional[str] = Field(None, max_length=20, description="æ ‡ç­¾é¢œè‰²")
    icon: Optional[str] = Field(None, max_length=50, description="å›¾æ ‡")
    sort_order: Optional[int] = Field(None, description="æ’åºé¡ºåº")
    is_active: Optional[bool] = Field(None, description="æ˜¯å¦å¯ç”¨")


class DictionaryItemResponse(DictionaryItemBase):
    """å­—å…¸é¡¹å“åº” Schema"""
    uuid: UUID = Field(..., description="å­—å…¸é¡¹UUID")
    tenant_id: int = Field(..., description="ç»„ç»‡ID")
    dictionary_uuid: UUID = Field(..., description="å­—å…¸UUID")
    created_at: datetime = Field(..., description="åˆ›å»ºæ—¶é—´")
    updated_at: datetime = Field(..., description="æ›´æ–°æ—¶é—´")
    
    model_config = ConfigDict(from_attributes=True)
```

---

## ğŸ”§ Service å±‚è®¾è®¡

### æ•°æ®å­—å…¸æœåŠ¡ï¼ˆDataDictionaryServiceï¼‰

```python
# riveredge-backend/src/tree-root/services/data_dictionary_service.py
from typing import Optional, List
from uuid import UUID
from tortoise.exceptions import DoesNotExist, IntegrityError
from fastapi import HTTPException, status

from ..models.data_dictionary import DataDictionary
from ..models.dictionary_item import DictionaryItem
from ..schemas.data_dictionary import DataDictionaryCreate, DataDictionaryUpdate
from ..schemas.dictionary_item import DictionaryItemCreate, DictionaryItemUpdate


class DataDictionaryService:
    """æ•°æ®å­—å…¸æœåŠ¡"""
    
    @staticmethod
    async def create_dictionary(
        tenant_id: int,
        data: DataDictionaryCreate
    ) -> DataDictionary:
        """
        åˆ›å»ºæ•°æ®å­—å…¸
        
        Args:
            tenant_id: ç»„ç»‡ID
            data: å­—å…¸æ•°æ®
            
        Returns:
            åˆ›å»ºçš„å­—å…¸å¯¹è±¡
            
        Raises:
            HTTPException: å¦‚æœå­—å…¸ä»£ç å·²å­˜åœ¨
        """
        try:
            dictionary = await DataDictionary.create(
                tenant_id=tenant_id,
                **data.model_dump()
            )
            return dictionary
        except IntegrityError:
            raise HTTPException(
                status_code=status.HTTP_400_BAD_REQUEST,
                detail=f"å­—å…¸ä»£ç  {data.code} å·²å­˜åœ¨"
            )
    
    @staticmethod
    async def get_dictionary_by_uuid(
        tenant_id: int,
        uuid: UUID
    ) -> DataDictionary:
        """
        æ ¹æ®UUIDè·å–å­—å…¸
        
        Args:
            tenant_id: ç»„ç»‡ID
            uuid: å­—å…¸UUID
            
        Returns:
            å­—å…¸å¯¹è±¡
            
        Raises:
            HTTPException: å¦‚æœå­—å…¸ä¸å­˜åœ¨
        """
        dictionary = await DataDictionary.get_or_none(
            tenant_id=tenant_id,
            uuid=uuid,
            deleted_at__isnull=True
        )
        if not dictionary:
            raise HTTPException(
                status_code=status.HTTP_404_NOT_FOUND,
                detail="å­—å…¸ä¸å­˜åœ¨"
            )
        return dictionary
    
    @staticmethod
    async def get_dictionary_by_code(
        tenant_id: int,
        code: str
    ) -> Optional[DataDictionary]:
        """
        æ ¹æ®ä»£ç è·å–å­—å…¸
        
        Args:
            tenant_id: ç»„ç»‡ID
            code: å­—å…¸ä»£ç 
            
        Returns:
            å­—å…¸å¯¹è±¡ï¼Œå¦‚æœä¸å­˜åœ¨è¿”å› None
        """
        return await DataDictionary.get_or_none(
            tenant_id=tenant_id,
            code=code,
            deleted_at__isnull=True,
            is_active=True
        )
    
    @staticmethod
    async def list_dictionaries(
        tenant_id: int,
        skip: int = 0,
        limit: int = 100,
        is_active: Optional[bool] = None
    ) -> List[DataDictionary]:
        """
        è·å–å­—å…¸åˆ—è¡¨
        
        Args:
            tenant_id: ç»„ç»‡ID
            skip: è·³è¿‡æ•°é‡
            limit: é™åˆ¶æ•°é‡
            is_active: æ˜¯å¦å¯ç”¨ï¼ˆå¯é€‰ï¼‰
            
        Returns:
            å­—å…¸åˆ—è¡¨
        """
        query = DataDictionary.filter(
            tenant_id=tenant_id,
            deleted_at__isnull=True
        )
        if is_active is not None:
            query = query.filter(is_active=is_active)
        
        return await query.order_by("-created_at").offset(skip).limit(limit)
    
    @staticmethod
    async def update_dictionary(
        tenant_id: int,
        uuid: UUID,
        data: DataDictionaryUpdate
    ) -> DataDictionary:
        """
        æ›´æ–°å­—å…¸
        
        Args:
            tenant_id: ç»„ç»‡ID
            uuid: å­—å…¸UUID
            data: æ›´æ–°æ•°æ®
            
        Returns:
            æ›´æ–°åçš„å­—å…¸å¯¹è±¡
            
        Raises:
            HTTPException: å¦‚æœå­—å…¸ä¸å­˜åœ¨æˆ–ä»£ç å†²çª
        """
        dictionary = await DataDictionaryService.get_dictionary_by_uuid(
            tenant_id, uuid
        )
        
        # æ£€æŸ¥æ˜¯å¦ä¸ºç³»ç»Ÿå­—å…¸
        if dictionary.is_system and data.code and data.code != dictionary.code:
            raise HTTPException(
                status_code=status.HTTP_400_BAD_REQUEST,
                detail="ç³»ç»Ÿå­—å…¸çš„ä»£ç ä¸å¯ä¿®æ”¹"
            )
        
        update_data = data.model_dump(exclude_unset=True)
        if update_data:
            try:
                await dictionary.update_from_dict(update_data)
                await dictionary.save()
            except IntegrityError:
                raise HTTPException(
                    status_code=status.HTTP_400_BAD_REQUEST,
                    detail="å­—å…¸ä»£ç å·²å­˜åœ¨"
                )
        
        return dictionary
    
    @staticmethod
    async def delete_dictionary(
        tenant_id: int,
        uuid: UUID
    ) -> None:
        """
        åˆ é™¤å­—å…¸ï¼ˆè½¯åˆ é™¤ï¼‰
        
        Args:
            tenant_id: ç»„ç»‡ID
            uuid: å­—å…¸UUID
            
        Raises:
            HTTPException: å¦‚æœå­—å…¸ä¸å­˜åœ¨æˆ–æ˜¯ç³»ç»Ÿå­—å…¸
        """
        dictionary = await DataDictionaryService.get_dictionary_by_uuid(
            tenant_id, uuid
        )
        
        if dictionary.is_system:
            raise HTTPException(
                status_code=status.HTTP_400_BAD_REQUEST,
                detail="ç³»ç»Ÿå­—å…¸ä¸å¯åˆ é™¤"
            )
        
        await dictionary.soft_delete()
    
    # å­—å…¸é¡¹ç›¸å…³æ–¹æ³•
    @staticmethod
    async def create_item(
        tenant_id: int,
        data: DictionaryItemCreate
    ) -> DictionaryItem:
        """åˆ›å»ºå­—å…¸é¡¹"""
        dictionary = await DataDictionaryService.get_dictionary_by_uuid(
            tenant_id, data.dictionary_uuid
        )
        
        try:
            item = await DictionaryItem.create(
                tenant_id=tenant_id,
                dictionary_id=dictionary.id,
                **{k: v for k, v in data.model_dump().items() if k != "dictionary_uuid"}
            )
            return item
        except IntegrityError:
            raise HTTPException(
                status_code=status.HTTP_400_BAD_REQUEST,
                detail=f"å­—å…¸é¡¹å€¼ {data.value} å·²å­˜åœ¨"
            )
    
    @staticmethod
    async def get_items_by_dictionary(
        tenant_id: int,
        dictionary_uuid: UUID,
        is_active: Optional[bool] = None
    ) -> List[DictionaryItem]:
        """è·å–å­—å…¸çš„æ‰€æœ‰å­—å…¸é¡¹"""
        dictionary = await DataDictionaryService.get_dictionary_by_uuid(
            tenant_id, dictionary_uuid
        )
        
        query = DictionaryItem.filter(
            tenant_id=tenant_id,
            dictionary_id=dictionary.id,
            deleted_at__isnull=True
        )
        if is_active is not None:
            query = query.filter(is_active=is_active)
        
        return await query.order_by("sort_order", "id")
```

---

## ğŸŒ API è®¾è®¡

### æ•°æ®å­—å…¸ API

```python
# riveredge-backend/src/tree-root/api/data_dictionaries/data_dictionaries.py
from fastapi import APIRouter, Depends, Query
from typing import Optional, List
from uuid import UUID

from ....soil.api.deps import get_current_tenant
from ...schemas.data_dictionary import (
    DataDictionaryCreate,
    DataDictionaryUpdate,
    DataDictionaryResponse
)
from ...schemas.dictionary_item import (
    DictionaryItemCreate,
    DictionaryItemUpdate,
    DictionaryItemResponse
)
from ...services.data_dictionary_service import DataDictionaryService

router = APIRouter(prefix="/data-dictionaries", tags=["æ•°æ®å­—å…¸"])


@router.post("", response_model=DataDictionaryResponse, status_code=201)
async def create_dictionary(
    data: DataDictionaryCreate,
    tenant_id: int = Depends(get_current_tenant)
):
    """åˆ›å»ºæ•°æ®å­—å…¸"""
    dictionary = await DataDictionaryService.create_dictionary(tenant_id, data)
    return dictionary


@router.get("", response_model=List[DataDictionaryResponse])
async def list_dictionaries(
    skip: int = Query(0, ge=0),
    limit: int = Query(100, ge=1, le=1000),
    is_active: Optional[bool] = Query(None),
    tenant_id: int = Depends(get_current_tenant)
):
    """è·å–å­—å…¸åˆ—è¡¨"""
    dictionaries = await DataDictionaryService.list_dictionaries(
        tenant_id, skip, limit, is_active
    )
    return dictionaries


@router.get("/{uuid}", response_model=DataDictionaryResponse)
async def get_dictionary(
    uuid: UUID,
    tenant_id: int = Depends(get_current_tenant)
):
    """è·å–å­—å…¸è¯¦æƒ…"""
    dictionary = await DataDictionaryService.get_dictionary_by_uuid(tenant_id, uuid)
    return dictionary


@router.get("/code/{code}", response_model=DataDictionaryResponse)
async def get_dictionary_by_code(
    code: str,
    tenant_id: int = Depends(get_current_tenant)
):
    """æ ¹æ®ä»£ç è·å–å­—å…¸"""
    dictionary = await DataDictionaryService.get_dictionary_by_code(tenant_id, code)
    if not dictionary:
        raise HTTPException(status_code=404, detail="å­—å…¸ä¸å­˜åœ¨")
    return dictionary


@router.put("/{uuid}", response_model=DataDictionaryResponse)
async def update_dictionary(
    uuid: UUID,
    data: DataDictionaryUpdate,
    tenant_id: int = Depends(get_current_tenant)
):
    """æ›´æ–°å­—å…¸"""
    dictionary = await DataDictionaryService.update_dictionary(tenant_id, uuid, data)
    return dictionary


@router.delete("/{uuid}", status_code=204)
async def delete_dictionary(
    uuid: UUID,
    tenant_id: int = Depends(get_current_tenant)
):
    """åˆ é™¤å­—å…¸"""
    await DataDictionaryService.delete_dictionary(tenant_id, uuid)
    return None


# å­—å…¸é¡¹ API
@router.post("/{dictionary_uuid}/items", response_model=DictionaryItemResponse, status_code=201)
async def create_item(
    dictionary_uuid: UUID,
    data: DictionaryItemCreate,
    tenant_id: int = Depends(get_current_tenant)
):
    """åˆ›å»ºå­—å…¸é¡¹"""
    data.dictionary_uuid = dictionary_uuid
    item = await DataDictionaryService.create_item(tenant_id, data)
    return item


@router.get("/{dictionary_uuid}/items", response_model=List[DictionaryItemResponse])
async def list_items(
    dictionary_uuid: UUID,
    is_active: Optional[bool] = Query(None),
    tenant_id: int = Depends(get_current_tenant)
):
    """è·å–å­—å…¸é¡¹åˆ—è¡¨"""
    items = await DataDictionaryService.get_items_by_dictionary(
        tenant_id, dictionary_uuid, is_active
    )
    return items
```

---

## ğŸ¨ å‰ç«¯é¡µé¢è®¾è®¡

### æ•°æ®å­—å…¸ç®¡ç†é¡µé¢

**å‚è€ƒ**ï¼šå¤ç”¨ç¬¬ä¸€é˜¶æ®µçš„é¡µé¢å¸ƒå±€è§„èŒƒ

**åŠŸèƒ½**ï¼š
- å­—å…¸åˆ—è¡¨ï¼ˆè¡¨æ ¼å±•ç¤ºï¼‰
- åˆ›å»ºå­—å…¸ï¼ˆModalï¼‰
- ç¼–è¾‘å­—å…¸ï¼ˆModalï¼‰
- åˆ é™¤å­—å…¸ï¼ˆç¡®è®¤å¯¹è¯æ¡†ï¼‰
- å­—å…¸é¡¹ç®¡ç†ï¼ˆå­é¡µé¢æˆ– Drawerï¼‰

**é¡µé¢è·¯å¾„**ï¼š`riveredge-frontend/src/tree-stem/pages/system/data-dictionaries/list/index.tsx`

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ç³»ç»Ÿçº§åŠŸèƒ½å»ºè®¾è®¡åˆ’.md](../ç³»ç»Ÿçº§åŠŸèƒ½å»ºè®¾è®¡åˆ’.md)
- [å‰ç«¯é¡µé¢å¸ƒå±€è§„èŒƒ.md](../sysç¬¬ä¸€é˜¶æ®µ/å‰ç«¯é¡µé¢å¸ƒå±€è§„èŒƒ.md)
- [ç³»ç»Ÿçº§åŠŸèƒ½æ–‡ä»¶ç»“æ„è§„åˆ’.md](../sysç¬¬ä¸€é˜¶æ®µ/ç³»ç»Ÿçº§åŠŸèƒ½æ–‡ä»¶ç»“æ„è§„åˆ’.md)

---

**æœ€åæ›´æ–°**ï¼š2025-01-XX


# åº”ç”¨ä¸­å¿ƒæœ€ä½³å®è·µ

## ğŸ“‹ æ¨¡å—æ¦‚è¿°

**æ¨¡å—åç§°**ï¼šåº”ç”¨ä¸­å¿ƒï¼ˆApplication Center Managementï¼‰  
**ä¼˜å…ˆçº§**ï¼šâ­â­â­â­ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰  
**é¢„è®¡æ—¶é—´**ï¼š2-3 å‘¨  
**ä¾èµ–**ï¼šèœå•ç®¡ç†ï¼ˆåº”ç”¨éœ€è¦èœå•ï¼‰

**åŠŸèƒ½èŒƒå›´**ï¼š
- åº”ç”¨ç®¡ç†ï¼ˆCRUDï¼‰
- åº”ç”¨å¯ç”¨/ç¦ç”¨
- æ’ä»¶å¼åº”ç”¨åŠ è½½æœåŠ¡
- åº”ç”¨æƒé™ç®¡ç†

---

## ğŸ” åº“é€‰æ‹©è¯„ä¼°

### åº”ç”¨ä¸­å¿ƒå®ç°æ–¹æ¡ˆ

**ç»“è®º**ï¼šâœ… **ä½¿ç”¨è‡ªå®šä¹‰å®ç°ï¼ˆæ¨èï¼‰**

ç»è¿‡è°ƒç ”ï¼Œåº”ç”¨ä¸­å¿ƒåŠŸèƒ½ä¸»è¦æ˜¯åŠ¨æ€è·¯ç”±åŠ è½½å’Œæ’ä»¶ç®¡ç†ï¼š

#### æ–¹æ¡ˆä¸€ï¼šè‡ªå®šä¹‰å®ç° â­â­â­â­â­ï¼ˆå¼ºçƒˆæ¨èï¼‰

**ä¼˜åŠ¿**ï¼š
- âœ… åŠŸèƒ½ç›¸å¯¹ç®€å•ï¼Œå®ç°æˆæœ¬ä½ï¼ˆ2-3 å‘¨å¯å®Œæˆï¼‰
- âœ… ä¸ React Router å®Œç¾é›†æˆï¼ˆåŸç”Ÿæ”¯æŒï¼‰
- âœ… ä¸ Tortoise ORM å®Œç¾é›†æˆï¼ˆåŸç”Ÿæ”¯æŒï¼‰
- âœ… å¤šç§Ÿæˆ·éš”ç¦»å¤©ç„¶æ”¯æŒï¼ˆtenant_id å­—æ®µï¼‰
- âœ… å®Œå…¨ç¬¦åˆæ¡†æ¶è§„èŒƒï¼ˆå‘½åã€æ³¨é‡Šã€ä»£ç é£æ ¼ï¼‰
- âœ… å®Œå…¨æ§åˆ¶ï¼Œæ˜“äºå®šåˆ¶å’Œæ‰©å±•
- âœ… React Router æ”¯æŒåŠ¨æ€è·¯ç”±ï¼Œæ— éœ€é¢å¤–åº“
- âœ… æ— éœ€å¼•å…¥é¢å¤–ä¾èµ–

**åŠ£åŠ¿**ï¼š
- âš ï¸ éœ€è¦è‡ªå·±å®ç°åŠ¨æ€è·¯ç”±åŠ è½½é€»è¾‘ï¼ˆä½†é€»è¾‘ç›¸å¯¹ç®€å•ï¼‰

**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… æ ‡å‡†çš„æ’ä»¶å¼åº”ç”¨éœ€æ±‚
- âœ… éœ€è¦ä¸ç°æœ‰æ¡†æ¶æ·±åº¦é›†æˆ
- âœ… éœ€è¦å®Œå…¨ç¬¦åˆé¡¹ç›®è§„èŒƒ
- âœ… å¤šç§Ÿæˆ·æ˜¯æ ¸å¿ƒéœ€æ±‚

**å®ç°å¤æ‚åº¦**ï¼šâ­â­â­ï¼ˆä¸­ç­‰ï¼Œ2-3 å‘¨å¯å®Œæˆï¼‰

---

#### æ–¹æ¡ˆäºŒï¼šä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ â­â­ï¼ˆä¸æ¨èï¼‰

**è°ƒç ”ç»“æœ**ï¼š
- âŒ React ç”Ÿæ€ä¸­æ²¡æœ‰ä¸“é—¨çš„æ’ä»¶ç®¡ç†åº“
- âŒ æœ‰ `react-plugin-system` ç­‰åº“ï¼Œä½†åŠŸèƒ½è¿‡äºå¤æ‚ï¼Œä¸ç¬¦åˆç®€å•éœ€æ±‚
- âŒ React Router å·²æ”¯æŒåŠ¨æ€è·¯ç”±ï¼Œæ— éœ€é¢å¤–åº“

**ç»“è®º**ï¼šåº”ç”¨ä¸­å¿ƒåŠŸèƒ½ç›¸å¯¹ç®€å•ï¼ŒReact Router å·²æ”¯æŒåŠ¨æ€è·¯ç”±ï¼Œä½¿ç”¨ç¬¬ä¸‰æ–¹åº“åè€Œå¢åŠ å¤æ‚åº¦ï¼Œä¸æ¨èã€‚

---

### æœ€ç»ˆæ¨èæ–¹æ¡ˆ

**æ¨è**ï¼šâœ… **ä½¿ç”¨è‡ªå®šä¹‰å®ç°**

**ç†ç”±**ï¼š
1. âœ… **åŠŸèƒ½ç›¸å¯¹ç®€å•**ï¼Œè‡ªå®šä¹‰å®ç°æˆæœ¬ä½ï¼ˆ2-3 å‘¨ï¼‰
2. âœ… **React Router å·²æ”¯æŒåŠ¨æ€è·¯ç”±**ï¼Œæ— éœ€é¢å¤–åº“
3. âœ… **å¤šç§Ÿæˆ·æ˜¯æ ¸å¿ƒéœ€æ±‚**ï¼Œè‡ªå®šä¹‰å®ç°å¤©ç„¶æ”¯æŒ
4. âœ… **å®Œå…¨ç¬¦åˆæ¡†æ¶è§„èŒƒ**ï¼Œä»£ç é£æ ¼ç»Ÿä¸€
5. âœ… **ç»´æŠ¤æˆæœ¬ä½**ï¼Œå›¢é˜Ÿå®Œå…¨æŒæ§ä»£ç 

**æ‰€éœ€åº“**ï¼š
- **æ— éœ€é¢å¤–åº“**ï¼ˆä½¿ç”¨ React Router çš„åŠ¨æ€è·¯ç”±åŠŸèƒ½ï¼‰

---

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### åº”ç”¨è¡¨ï¼ˆroot_applicationsï¼‰

```sql
CREATE TABLE root_applications (
    id SERIAL PRIMARY KEY,
    uuid VARCHAR(36) NOT NULL UNIQUE,        -- ä¸šåŠ¡IDï¼ˆUUIDï¼Œå¯¹å¤–æš´éœ²ï¼Œå®‰å…¨ä¸”å”¯ä¸€ï¼‰
    tenant_id INTEGER NOT NULL,
    
    -- åº”ç”¨åŸºæœ¬ä¿¡æ¯
    name VARCHAR(100) NOT NULL,              -- åº”ç”¨åç§°
    code VARCHAR(50) NOT NULL,                -- åº”ç”¨ä»£ç ï¼ˆå”¯ä¸€ï¼Œç”¨äºç¨‹åºè¯†åˆ«ï¼‰
    description TEXT,                         -- åº”ç”¨æè¿°
    icon VARCHAR(200),                        -- åº”ç”¨å›¾æ ‡ï¼ˆURL æˆ–è·¯å¾„ï¼‰
    version VARCHAR(20),                      -- åº”ç”¨ç‰ˆæœ¬
    
    -- åº”ç”¨é…ç½®
    route_path VARCHAR(200),                   -- åº”ç”¨è·¯ç”±è·¯å¾„
    entry_point VARCHAR(500),                 -- åº”ç”¨å…¥å£ç‚¹ï¼ˆå‰ç«¯ç»„ä»¶è·¯å¾„æˆ– URLï¼‰
    menu_config JSONB,                        -- èœå•é…ç½®ï¼ˆJSONï¼‰
    
    -- æƒé™é…ç½®
    permission_code VARCHAR(100),             -- æƒé™ä»£ç ï¼ˆå…³è”æƒé™ï¼‰
    
    -- çŠ¶æ€
    is_system BOOLEAN DEFAULT FALSE,          -- æ˜¯å¦ç³»ç»Ÿåº”ç”¨
    is_active BOOLEAN DEFAULT TRUE,           -- æ˜¯å¦å¯ç”¨
    is_installed BOOLEAN DEFAULT FALSE,      -- æ˜¯å¦å·²å®‰è£…
    
    -- æ’åº
    sort_order INTEGER DEFAULT 0,             -- æ’åºé¡ºåº
    
    -- æ ‡å‡†å­—æ®µ
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,
    
    -- ç´¢å¼•
    CONSTRAINT uk_root_applications_tenant_code UNIQUE (tenant_id, code),
    INDEX idx_root_applications_tenant_id (tenant_id),
    INDEX idx_root_applications_uuid (uuid),
    INDEX idx_root_applications_code (code),
    INDEX idx_root_applications_created_at (created_at)
);
```

**è®¾è®¡è¦ç‚¹**ï¼š
- âœ… `code` ç”¨äºç¨‹åºè¯†åˆ«ï¼Œ`tenant_id + code` å”¯ä¸€çº¦æŸ
- âœ… `route_path` åº”ç”¨è·¯ç”±è·¯å¾„ï¼ˆå¦‚ `/apps/crm`ï¼‰
- âœ… `entry_point` åº”ç”¨å…¥å£ç‚¹ï¼ˆå‰ç«¯ç»„ä»¶è·¯å¾„æˆ–è¿œç¨‹ URLï¼‰
- âœ… `menu_config` JSONB å­—æ®µå­˜å‚¨èœå•é…ç½®ï¼ˆçµæ´»æ‰©å±•ï¼‰
- âœ… `is_installed` æ ‡è®°åº”ç”¨æ˜¯å¦å·²å®‰è£…

---

## ğŸ åç«¯æ¨¡å‹è®¾è®¡

### åº”ç”¨æ¨¡å‹ï¼ˆApplicationï¼‰

```python
# riveredge-backend/src/tree-root/models/application.py
from tortoise.models import Model
from tortoise import fields
from tortoise.fields import JSONField
from typing import Optional, Dict, Any
from .base import BaseModel


class Application(BaseModel):
    """
    åº”ç”¨æ¨¡å‹
    
    ç”¨äºç®¡ç†æ’ä»¶å¼åº”ç”¨ï¼Œæ”¯æŒåŠ¨æ€åŠ è½½å’Œå¸è½½ã€‚
    æ”¯æŒå¤šç»„ç»‡éš”ç¦»ï¼Œæ¯ä¸ªç»„ç»‡å¯ä»¥å®‰è£…è‡ªå·±çš„åº”ç”¨ã€‚
    
    æ³¨æ„ï¼šç»§æ‰¿è‡ª BaseModelï¼Œè‡ªåŠ¨åŒ…å« uuidã€tenant_idã€created_atã€updated_at å­—æ®µã€‚
    """
    id = fields.IntField(pk=True, description="åº”ç”¨IDï¼ˆä¸»é”®ï¼Œè‡ªå¢IDï¼Œå†…éƒ¨ä½¿ç”¨ï¼‰")
    
    name = fields.CharField(max_length=100, description="åº”ç”¨åç§°")
    code = fields.CharField(max_length=50, description="åº”ç”¨ä»£ç ï¼ˆå”¯ä¸€ï¼Œç”¨äºç¨‹åºè¯†åˆ«ï¼‰")
    description = fields.TextField(null=True, description="åº”ç”¨æè¿°")
    icon = fields.CharField(max_length=200, null=True, description="åº”ç”¨å›¾æ ‡")
    version = fields.CharField(max_length=20, null=True, description="åº”ç”¨ç‰ˆæœ¬")
    
    route_path = fields.CharField(max_length=200, null=True, description="åº”ç”¨è·¯ç”±è·¯å¾„")
    entry_point = fields.CharField(max_length=500, null=True, description="åº”ç”¨å…¥å£ç‚¹")
    menu_config = JSONField(null=True, description="èœå•é…ç½®ï¼ˆJSONï¼‰")
    
    permission_code = fields.CharField(max_length=100, null=True, description="æƒé™ä»£ç ")
    
    is_system = fields.BooleanField(default=False, description="æ˜¯å¦ç³»ç»Ÿåº”ç”¨")
    is_active = fields.BooleanField(default=True, description="æ˜¯å¦å¯ç”¨")
    is_installed = fields.BooleanField(default=False, description="æ˜¯å¦å·²å®‰è£…")
    
    sort_order = fields.IntField(default=0, description="æ’åºé¡ºåº")
    
    class Meta:
        table = "root_applications"
        unique_together = [("tenant_id", "code")]
    
    def get_menu_config(self) -> Dict[str, Any]:
        """è·å–èœå•é…ç½®"""
        return self.menu_config or {}
    
    def set_menu_config(self, config: Dict[str, Any]) -> None:
        """è®¾ç½®èœå•é…ç½®"""
        self.menu_config = config
```

---

## ğŸ”§ Service å±‚è®¾è®¡

### åº”ç”¨æœåŠ¡ï¼ˆApplicationServiceï¼‰

```python
# riveredge-backend/src/tree-root/services/application_service.py
from typing import Optional, List
from uuid import UUID
from tortoise.exceptions import IntegrityError
from fastapi import HTTPException, status

from ..models.application import Application
from ..schemas.application import ApplicationCreate, ApplicationUpdate


class ApplicationService:
    """åº”ç”¨æœåŠ¡"""
    
    @staticmethod
    async def create_application(
        tenant_id: int,
        data: ApplicationCreate
    ) -> Application:
        """åˆ›å»ºåº”ç”¨"""
        try:
            application = await Application.create(
                tenant_id=tenant_id,
                **data.model_dump()
            )
            return application
        except IntegrityError:
            raise HTTPException(
                status_code=status.HTTP_400_BAD_REQUEST,
                detail=f"åº”ç”¨ä»£ç  {data.code} å·²å­˜åœ¨"
            )
    
    @staticmethod
    async def install_application(
        tenant_id: int,
        uuid: UUID
    ) -> Application:
        """å®‰è£…åº”ç”¨"""
        application = await Application.get_or_none(
            tenant_id=tenant_id,
            uuid=uuid,
            deleted_at__isnull=True
        )
        if not application:
            raise HTTPException(
                status_code=status.HTTP_404_NOT_FOUND,
                detail="åº”ç”¨ä¸å­˜åœ¨"
            )
        
        if application.is_installed:
            raise HTTPException(
                status_code=status.HTTP_400_BAD_REQUEST,
                detail="åº”ç”¨å·²å®‰è£…"
            )
        
        application.is_installed = True
        await application.save()
        
        # è¿™é‡Œå¯ä»¥æ·»åŠ åº”ç”¨å®‰è£…åçš„åˆå§‹åŒ–é€»è¾‘
        # ä¾‹å¦‚ï¼šåˆ›å»ºèœå•ã€åˆå§‹åŒ–æ•°æ®ç­‰
        
        return application
    
    @staticmethod
    async def uninstall_application(
        tenant_id: int,
        uuid: UUID
    ) -> Application:
        """å¸è½½åº”ç”¨"""
        application = await Application.get_or_none(
            tenant_id=tenant_id,
            uuid=uuid,
            deleted_at__isnull=True
        )
        if not application:
            raise HTTPException(
                status_code=status.HTTP_404_NOT_FOUND,
                detail="åº”ç”¨ä¸å­˜åœ¨"
            )
        
        if application.is_system:
            raise HTTPException(
                status_code=status.HTTP_400_BAD_REQUEST,
                detail="ç³»ç»Ÿåº”ç”¨ä¸å¯å¸è½½"
            )
        
        application.is_installed = False
        await application.save()
        
        # è¿™é‡Œå¯ä»¥æ·»åŠ åº”ç”¨å¸è½½åçš„æ¸…ç†é€»è¾‘
        # ä¾‹å¦‚ï¼šåˆ é™¤èœå•ã€æ¸…ç†æ•°æ®ç­‰
        
        return application
    
    @staticmethod
    async def get_installed_applications(
        tenant_id: int,
        is_active: Optional[bool] = None
    ) -> List[Application]:
        """è·å–å·²å®‰è£…çš„åº”ç”¨åˆ—è¡¨"""
        query = Application.filter(
            tenant_id=tenant_id,
            is_installed=True,
            deleted_at__isnull=True
        )
        if is_active is not None:
            query = query.filter(is_active=is_active)
        
        return await query.order_by("sort_order", "id")
```

---

## ğŸŒ API è®¾è®¡

### åº”ç”¨ç®¡ç† API

```python
# riveredge-backend/src/tree-root/api/applications/applications.py
from fastapi import APIRouter, Depends, Query
from typing import Optional, List
from uuid import UUID

from ....soil.api.deps import get_current_tenant
from ...schemas.application import (
    ApplicationCreate,
    ApplicationUpdate,
    ApplicationResponse
)
from ...services.application_service import ApplicationService

router = APIRouter(prefix="/applications", tags=["åº”ç”¨ä¸­å¿ƒ"])


@router.post("", response_model=ApplicationResponse, status_code=201)
async def create_application(
    data: ApplicationCreate,
    tenant_id: int = Depends(get_current_tenant)
):
    """åˆ›å»ºåº”ç”¨"""
    application = await ApplicationService.create_application(tenant_id, data)
    return application


@router.get("", response_model=List[ApplicationResponse])
async def list_applications(
    skip: int = Query(0, ge=0),
    limit: int = Query(100, ge=1, le=1000),
    is_installed: Optional[bool] = Query(None),
    is_active: Optional[bool] = Query(None),
    tenant_id: int = Depends(get_current_tenant)
):
    """è·å–åº”ç”¨åˆ—è¡¨"""
    # å®ç°åˆ—è¡¨æŸ¥è¯¢é€»è¾‘
    pass


@router.post("/{uuid}/install", response_model=ApplicationResponse)
async def install_application(
    uuid: UUID,
    tenant_id: int = Depends(get_current_tenant)
):
    """å®‰è£…åº”ç”¨"""
    application = await ApplicationService.install_application(tenant_id, uuid)
    return application


@router.post("/{uuid}/uninstall", response_model=ApplicationResponse)
async def uninstall_application(
    uuid: UUID,
    tenant_id: int = Depends(get_current_tenant)
):
    """å¸è½½åº”ç”¨"""
    application = await ApplicationService.uninstall_application(tenant_id, uuid)
    return application


@router.put("/{uuid}/enable", response_model=ApplicationResponse)
async def enable_application(
    uuid: UUID,
    tenant_id: int = Depends(get_current_tenant)
):
    """å¯ç”¨åº”ç”¨"""
    # å®ç°å¯ç”¨é€»è¾‘
    pass


@router.put("/{uuid}/disable", response_model=ApplicationResponse)
async def disable_application(
    uuid: UUID,
    tenant_id: int = Depends(get_current_tenant)
):
    """ç¦ç”¨åº”ç”¨"""
    # å®ç°ç¦ç”¨é€»è¾‘
    pass
```

---

## ğŸ¨ å‰ç«¯é¡µé¢è®¾è®¡

**å‚è€ƒ**ï¼šå¤ç”¨ç¬¬ä¸€é˜¶æ®µçš„é¡µé¢å¸ƒå±€è§„èŒƒ

**åŠŸèƒ½**ï¼š
- åº”ç”¨åˆ—è¡¨ï¼ˆå¡ç‰‡æˆ–è¡¨æ ¼å±•ç¤ºï¼‰
- åˆ›å»ºåº”ç”¨ï¼ˆModalï¼‰
- ç¼–è¾‘åº”ç”¨ï¼ˆModalï¼‰
- å®‰è£…/å¸è½½åº”ç”¨ï¼ˆæ“ä½œæŒ‰é’®ï¼‰
- å¯ç”¨/ç¦ç”¨åº”ç”¨ï¼ˆå¼€å…³ï¼‰
- åº”ç”¨è¯¦æƒ…ï¼ˆæŸ¥çœ‹åº”ç”¨é…ç½®ï¼‰

**é¡µé¢è·¯å¾„**ï¼š`riveredge-frontend/src/tree-stem/pages/system/applications/list/index.tsx`

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ç³»ç»Ÿçº§åŠŸèƒ½å»ºè®¾è®¡åˆ’.md](../ç³»ç»Ÿçº§åŠŸèƒ½å»ºè®¾è®¡åˆ’.md)
- [å‰ç«¯é¡µé¢å¸ƒå±€è§„èŒƒ.md](../sysç¬¬ä¸€é˜¶æ®µ/å‰ç«¯é¡µé¢å¸ƒå±€è§„èŒƒ.md)

---

**æœ€åæ›´æ–°**ï¼š2025-01-XX


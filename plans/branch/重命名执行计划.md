# 重命名执行计划 - 基于新命名哲学

## 📋 执行概述

根据系统架构图，使用新的命名哲学重新组织文件夹和数据库结构。

**执行日期**：2025-01-XX  
**备份状态**：✅ 已创建备份分支 `backup/before-rename-20251127_081835`

---

## 🎯 新命名哲学映射

### 架构层级与模块对应

根据架构图，新的命名体系：

```
平台级 (Platform Level)
└── soil (土壤) - 平台级基础设施

系统级 (System Level)
├── root (根) - 后端 API
├── stem (茎) - 前端功能支干
└── tree (树) - 每个租户单独管理

应用级 (Application Level)
├── core (核心) - 应用后端
├── shell (壳) - 应用前端
└── seed (种子) - 插件式应用

扩展层级
├── cell (细胞) - 功能原子化
├── leaf (叶子) - 移动端应用
├── land (土地) - 着陆页/官网
├── forest (森林) - 租户间链接
└── vascular (维管) - AI 神经中枢
```

---

## 📦 文件夹重命名方案

### 当前 → 新命名映射

| 当前命名 | 新命名 | 架构层级 | 说明 |
|---------|--------|---------|------|
| `riveredge-core` | `riveredge-root` + `riveredge-core` | 系统级 + 应用级 | 需要拆分 |
| `riveredge-shell` | `riveredge-stem` + `riveredge-shell` | 系统级 + 应用级 | 需要拆分 |
| `riveredge-seeds` | `riveredge-seed` | 应用级 | 单数形式 |
| `riveredge-land` | `riveredge-land` | 扩展层级 | 保持不变 |
| `riveredge-leaf` | `riveredge-leaf` | 扩展层级 | 保持不变 |

### 拆分方案

#### 方案 A：完全拆分（推荐）✅

**riveredge-core 拆分**：
- `riveredge-root/` - 系统级后端 API
  - 后端 API 服务
  - 数据持久化
  - 认证授权
  - 核心基础设施
- `riveredge-core/` - 应用级后端核心
  - 业务逻辑处理
  - 数据模型定义
  - 服务层

**riveredge-shell 拆分**：
- `riveredge-stem/` - 系统级前端框架
  - 前端基础框架
  - 插件加载器
  - 路由管理
  - 状态管理
- `riveredge-shell/` - 应用级前端界面
  - UI 组件库
  - 用户交互界面
  - 页面布局

**优势**：
- ✅ 完全对齐架构图
- ✅ 层级清晰
- ✅ 职责明确

**劣势**：
- ❌ 工作量较大
- ❌ 需要大量代码迁移

---

#### 方案 B：保持结构，重命名文件夹（简化）

**重命名映射**：
- `riveredge-core` → `riveredge-root`（系统级后端）
- `riveredge-shell` → `riveredge-stem`（系统级前端）
- `riveredge-seeds` → `riveredge-seed`（应用级插件）

**优势**：
- ✅ 工作量较小
- ✅ 无需拆分代码

**劣势**：
- ⚠️ 不完全对齐架构图（但可以通过文档说明层级）

---

## 🗄️ 数据库重命名方案

### 当前 → 新命名映射

| 当前前缀 | 新前缀 | 架构层级 | 说明 |
|---------|--------|---------|------|
| `core_` | `root_` + `core_` | 系统级 + 应用级 | 需要区分 |
| `seed_插件名_` | `seed_插件名_` | 应用级 | 保持不变 |
| `sys_` | `root_` | 系统级 | 统一为 root_ |

### 数据库表重命名映射

**系统级表（root_ 前缀）**：
- `core_users` → `root_users`
- `core_roles` → `root_roles`
- `core_permissions` → `root_permissions`
- `core_tenants` → `tree_tenants`（租户管理属于 tree）
- `core_tenant_configs` → `tree_tenant_configs`
- `core_tenant_activity_logs` → `tree_tenant_activity_logs`

**应用级表（core_ 前缀）**：
- 未来新表使用 `core_` 前缀（应用级后端）

**租户管理表（tree_ 前缀）**：
- 所有租户相关表使用 `tree_` 前缀

---

## 📋 执行步骤

### 阶段一：准备工作（1-2 天）

#### 1.1 创建详细的重命名清单

**任务清单**：
- [ ] 列出所有需要重命名的文件夹
- [ ] 列出所有需要重命名的数据库表
- [ ] 列出所有需要更新的引用位置
- [ ] 创建重命名映射表

#### 1.2 创建数据迁移脚本

**任务清单**：
- [ ] 创建数据库表重命名脚本
- [ ] 创建索引重命名脚本
- [ ] 创建数据验证脚本
- [ ] 创建回滚脚本

#### 1.3 创建代码迁移脚本

**任务清单**：
- [ ] 创建文件夹重命名脚本
- [ ] 创建代码引用更新脚本
- [ ] 创建配置文件更新脚本

---

### 阶段二：数据库重命名（2-3 天）

#### 2.1 创建数据库迁移脚本

```sql
-- 重命名表
ALTER TABLE core_users RENAME TO root_users;
ALTER TABLE core_roles RENAME TO root_roles;
ALTER TABLE core_permissions RENAME TO root_permissions;
ALTER TABLE core_tenants RENAME TO tree_tenants;
ALTER TABLE core_tenant_configs RENAME TO tree_tenant_configs;
ALTER TABLE core_tenant_activity_logs RENAME TO tree_tenant_activity_logs;

-- 重命名索引
ALTER INDEX idx_core_users_tenant_id RENAME TO idx_root_users_tenant_id;
ALTER INDEX idx_core_roles_tenant_id RENAME TO idx_root_roles_tenant_id;
-- ... 其他索引
```

#### 2.2 更新模型定义

**需要修改的文件**：
- `riveredge-core/src/models/user.py`
- `riveredge-core/src/models/role.py`
- `riveredge-core/src/models/permission.py`
- `riveredge-core/src/models/tenant.py`
- `riveredge-core/src/models/tenant_config.py`
- `riveredge-core/src/models/tenant_activity_log.py`

#### 2.3 更新迁移文件

**需要修改的文件**：
- 所有迁移文件中的表名和索引名

#### 2.4 更新 SQL 查询

**需要修改的位置**：
- 所有模型查询
- 原始 SQL 查询
- 迁移脚本

---

### 阶段三：文件夹重命名（3-5 天）

#### 3.1 创建新文件夹结构

**如果选择方案 A（完全拆分）**：
```bash
# 创建新文件夹
mkdir -p riveredge-root
mkdir -p riveredge-core
mkdir -p riveredge-stem
mkdir -p riveredge-shell
mkdir -p riveredge-seed
```

#### 3.2 迁移代码

**riveredge-core 拆分**：
- 系统级代码 → `riveredge-root/`
- 应用级代码 → `riveredge-core/`

**riveredge-shell 拆分**：
- 系统级代码 → `riveredge-stem/`
- 应用级代码 → `riveredge-shell/`

#### 3.3 更新引用

**需要更新的位置**：
- 所有导入路径
- 配置文件
- 脚本文件
- 文档引用

---

### 阶段四：测试验证（2-3 天）

#### 4.1 功能测试

**测试内容**：
- 后端 API 测试
- 前端功能测试
- 数据库查询测试
- 多租户隔离测试

#### 4.2 集成测试

**测试内容**：
- 前后端集成测试
- 插件系统测试
- 部署测试

---

## ⚠️ 风险评估

### 高风险项

1. **数据库重命名**：
   - ⚠️ 需要数据迁移脚本
   - ⚠️ 可能影响生产环境
   - ⚠️ 需要停机维护

2. **文件夹拆分**：
   - ⚠️ 需要大量代码迁移
   - ⚠️ 可能影响 CI/CD
   - ⚠️ 需要更新所有开发者环境

3. **引用更新**：
   - ⚠️ 可能遗漏某些引用
   - ⚠️ 需要全面测试

---

## 📊 工作量估算

### 总体工作量

| 阶段 | 工作量 | 时间估算 | 风险 |
|------|--------|---------|------|
| **阶段一：准备工作** | ⭐⭐ | 1-2 天 | 低 |
| **阶段二：数据库重命名** | ⭐⭐⭐⭐ | 2-3 天 | 高 |
| **阶段三：文件夹重命名** | ⭐⭐⭐⭐⭐ | 3-5 天 | 高 |
| **阶段四：测试验证** | ⭐⭐⭐ | 2-3 天 | 中 |
| **总计** | **⭐⭐⭐⭐⭐** | **8-13 天** | **高** |

---

## 🎯 推荐执行方案

### 方案一：分阶段执行（推荐）✅

**阶段 1**：先重命名数据库（2-3 天）
- 创建数据迁移脚本
- 执行数据库重命名
- 更新模型和查询
- 测试验证

**阶段 2**：再重命名文件夹（3-5 天）
- 创建新文件夹结构
- 迁移代码
- 更新引用
- 测试验证

**优势**：
- ✅ 分阶段执行，风险可控
- ✅ 每个阶段可以独立测试
- ✅ 可以随时回滚

---

### 方案二：一次性执行

**执行所有重命名**：
- 数据库重命名 + 文件夹重命名
- 一次性完成所有更改

**优势**：
- ✅ 一次性完成，无需多次测试

**劣势**：
- ❌ 风险较高
- ❌ 难以回滚
- ❌ 测试工作量大

---

## 📝 执行检查清单

### 数据库重命名检查清单

- [ ] 创建数据迁移脚本
- [ ] 创建回滚脚本
- [ ] 更新所有模型定义
- [ ] 更新所有迁移文件
- [ ] 更新所有 SQL 查询
- [ ] 更新所有索引名称
- [ ] 测试数据库查询
- [ ] 测试数据迁移
- [ ] 测试回滚脚本

### 文件夹重命名检查清单

- [ ] 创建新文件夹结构
- [ ] 迁移所有代码文件
- [ ] 更新所有导入路径
- [ ] 更新所有配置文件
- [ ] 更新所有脚本文件
- [ ] 更新所有文档引用
- [ ] 更新 CI/CD 配置
- [ ] 测试所有功能
- [ ] 更新开发者文档

---

## 🚀 开始执行

**准备就绪后，可以开始执行重命名工作。**

**建议**：
1. 先完成阶段一（准备工作）
2. 创建详细的重命名清单
3. 创建所有必要的脚本
4. 在测试环境验证
5. 再在生产环境执行

---

**最后更新**：2025-01-XX


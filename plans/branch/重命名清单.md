# é‡å‘½åæ¸…å• - è¯¦ç»†æ‰§è¡Œæ¸…å•

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›è¯¦ç»†çš„é‡å‘½åæ¸…å•ï¼Œç”¨äºæ‰§è¡ŒåŸºäºæ–°å‘½åå“²å­¦çš„é¡¹ç›®é‡æ„ã€‚

**æ‰§è¡Œæ—¥æœŸ**ï¼š2025-01-XX  
**å¤‡ä»½çŠ¶æ€**ï¼šâœ… å·²åˆ›å»ºå¤‡ä»½åˆ†æ”¯ `backup/before-rename-20251127_081835`

---

## ğŸ“¦ æ–‡ä»¶å¤¹é‡å‘½åæ¸…å•

### 1. æ ¸å¿ƒæ¨¡å—æ‹†åˆ†

#### 1.1 riveredge-core â†’ riveredge-root + riveredge-core

**å½“å‰ç»“æ„**ï¼š
```
riveredge-core/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/          # ç³»ç»Ÿçº§ API
â”‚   â”œâ”€â”€ core/         # ç³»ç»Ÿçº§æ ¸å¿ƒåŠŸèƒ½
â”‚   â”œâ”€â”€ models/       # åº”ç”¨çº§æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ services/     # åº”ç”¨çº§ä¸šåŠ¡é€»è¾‘
â”‚   â””â”€â”€ schemas/      # åº”ç”¨çº§ Schema
```

**æ–°ç»“æ„**ï¼š
```
riveredge-root/       # ç³»ç»Ÿçº§åç«¯
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/          # ç³»ç»Ÿçº§ API
â”‚   â”œâ”€â”€ core/         # ç³»ç»Ÿçº§æ ¸å¿ƒåŠŸèƒ½
â”‚   â””â”€â”€ infrastructure/  # åŸºç¡€è®¾æ–½

riveredge-core/       # åº”ç”¨çº§åç«¯
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ models/       # åº”ç”¨çº§æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ services/     # åº”ç”¨çº§ä¸šåŠ¡é€»è¾‘
â”‚   â””â”€â”€ schemas/      # åº”ç”¨çº§ Schema
```

**éœ€è¦è¿ç§»çš„æ–‡ä»¶**ï¼š

**â†’ riveredge-root/**ï¼š
- `src/api/` (å…¨éƒ¨)
- `src/core/` (å…¨éƒ¨)
- `src/app/main.py` (åº”ç”¨å…¥å£)
- `src/app/config.py` (é…ç½®)
- `src/app/middleware.py` (ä¸­é—´ä»¶)
- `src/utils/logger.py` (æ—¥å¿—å·¥å…·)
- `scripts/` (éƒ¨ç½²è„šæœ¬)
- `requirements.txt`
- `pyproject.toml`

**â†’ riveredge-core/**ï¼š
- `src/models/` (å…¨éƒ¨)
- `src/services/` (å…¨éƒ¨)
- `src/schemas/` (å…¨éƒ¨)
- `migrations/` (æ•°æ®åº“è¿ç§»)

---

#### 1.2 riveredge-shell â†’ riveredge-stem + riveredge-shell

**å½“å‰ç»“æ„**ï¼š
```
riveredge-shell/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app.tsx       # ç³»ç»Ÿçº§åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ layouts/      # ç³»ç»Ÿçº§å¸ƒå±€
â”‚   â”œâ”€â”€ components/   # åº”ç”¨çº§ç»„ä»¶
â”‚   â”œâ”€â”€ pages/        # åº”ç”¨çº§é¡µé¢
â”‚   â””â”€â”€ services/     # åº”ç”¨çº§æœåŠ¡
```

**æ–°ç»“æ„**ï¼š
```
riveredge-stem/       # ç³»ç»Ÿçº§å‰ç«¯
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app.tsx       # ç³»ç»Ÿçº§åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ layouts/      # ç³»ç»Ÿçº§å¸ƒå±€
â”‚   â”œâ”€â”€ router/       # è·¯ç”±ç®¡ç†
â”‚   â””â”€â”€ plugin-loader/  # æ’ä»¶åŠ è½½å™¨

riveredge-shell/      # åº”ç”¨çº§å‰ç«¯
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/   # åº”ç”¨çº§ç»„ä»¶
â”‚   â”œâ”€â”€ pages/        # åº”ç”¨çº§é¡µé¢
â”‚   â””â”€â”€ services/     # åº”ç”¨çº§æœåŠ¡
```

**éœ€è¦è¿ç§»çš„æ–‡ä»¶**ï¼š

**â†’ riveredge-stem/**ï¼š
- `src/app.tsx`
- `src/main.tsx`
- `src/layouts/`
- `src/models/` (çŠ¶æ€ç®¡ç†)
- `src/access.ts` (æƒé™æ§åˆ¶)
- `vite.config.ts`
- `tsconfig.json`
- `package.json` (éœ€è¦æ‹†åˆ†ä¾èµ–)

**â†’ riveredge-shell/**ï¼š
- `src/components/` (ä¸šåŠ¡ç»„ä»¶)
- `src/pages/` (ä¸šåŠ¡é¡µé¢)
- `src/services/` (ä¸šåŠ¡æœåŠ¡)
- `src/types/` (ä¸šåŠ¡ç±»å‹)

---

#### 1.3 riveredge-seeds â†’ riveredge-seed

**é‡å‘½å**ï¼š
- `riveredge-seeds/` â†’ `riveredge-seed/` (å•æ•°å½¢å¼)

**ä¿æŒä¸å˜**ï¼š
- å†…éƒ¨ç»“æ„ä¿æŒä¸å˜
- æ’ä»¶å‘½åè§„åˆ™ä¿æŒä¸å˜

---

### 2. ä¿æŒä¸å˜

- `riveredge-land/` - ä¿æŒä¸å˜
- `riveredge-leaf/` - ä¿æŒä¸å˜

---

## ğŸ—„ï¸ æ•°æ®åº“é‡å‘½åæ¸…å•

### 1. ç³»ç»Ÿçº§è¡¨ï¼ˆroot_ å‰ç¼€ï¼‰

| å½“å‰è¡¨å | æ–°è¡¨å | è¯´æ˜ |
|---------|--------|------|
| `core_users` | `root_users` | ç³»ç»Ÿçº§ç”¨æˆ·è¡¨ |
| `core_roles` | `root_roles` | ç³»ç»Ÿçº§è§’è‰²è¡¨ |
| `core_permissions` | `root_permissions` | ç³»ç»Ÿçº§æƒé™è¡¨ |

### 2. ç§Ÿæˆ·ç®¡ç†è¡¨ï¼ˆtree_ å‰ç¼€ï¼‰

| å½“å‰è¡¨å | æ–°è¡¨å | è¯´æ˜ |
|---------|--------|------|
| `core_tenants` | `tree_tenants` | ç§Ÿæˆ·è¡¨ |
| `core_tenant_configs` | `tree_tenant_configs` | ç§Ÿæˆ·é…ç½®è¡¨ |
| `core_tenant_activity_logs` | `tree_tenant_activity_logs` | ç§Ÿæˆ·æ´»åŠ¨æ—¥å¿—è¡¨ |

### 3. åº”ç”¨çº§è¡¨ï¼ˆcore_ å‰ç¼€ï¼‰

**æœªæ¥æ–°è¡¨**ï¼š
- åº”ç”¨çº§ä¸šåŠ¡è¡¨ä½¿ç”¨ `core_` å‰ç¼€
- å½“å‰æ— éœ€ä¿®æ”¹

### 4. æ’ä»¶è¡¨ï¼ˆseed_ å‰ç¼€ï¼‰

**ä¿æŒä¸å˜**ï¼š
- `seed_æ’ä»¶å_è¡¨å` æ ¼å¼ä¿æŒä¸å˜

---

## ğŸ“ ç´¢å¼•é‡å‘½åæ¸…å•

### ç³»ç»Ÿçº§è¡¨ç´¢å¼•ï¼ˆroot_ å‰ç¼€ï¼‰

| å½“å‰ç´¢å¼•å | æ–°ç´¢å¼•å |
|-----------|---------|
| `idx_core_users_tenant_id` | `idx_root_users_tenant_id` |
| `idx_core_users_username` | `idx_root_users_username` |
| `idx_core_roles_tenant_id` | `idx_root_roles_tenant_id` |
| `idx_core_permissions_tenant_id` | `idx_root_permissions_tenant_id` |

### ç§Ÿæˆ·ç®¡ç†è¡¨ç´¢å¼•ï¼ˆtree_ å‰ç¼€ï¼‰

| å½“å‰ç´¢å¼•å | æ–°ç´¢å¼•å |
|-----------|---------|
| `idx_core_tenant_tenant__e55d73` | `idx_tree_tenants_tenant_id` |
| `idx_core_tenant_domain_22c064` | `idx_tree_tenants_domain` |
| `idx_core_tenant_status_195cc5` | `idx_tree_tenants_status` |
| `idx_core_tenant_config_tenant__993185` | `idx_tree_tenant_configs_tenant_id` |

---

## ğŸ” éœ€è¦æ›´æ–°çš„å¼•ç”¨ä½ç½®

### 1. æ¨¡å‹å®šä¹‰æ–‡ä»¶ï¼ˆ6 ä¸ªæ–‡ä»¶ï¼‰

- [ ] `riveredge-core/src/models/user.py` - `table = "root_users"`
- [ ] `riveredge-core/src/models/role.py` - `table = "root_roles"`
- [ ] `riveredge-core/src/models/permission.py` - `table = "root_permissions"`
- [ ] `riveredge-core/src/models/tenant.py` - `table = "tree_tenants"`
- [ ] `riveredge-core/src/models/tenant_config.py` - `table = "tree_tenant_configs"`
- [ ] `riveredge-core/src/models/tenant_activity_log.py` - `table = "tree_tenant_activity_logs"`

### 2. è¿ç§»æ–‡ä»¶ï¼ˆ7 ä¸ªæ–‡ä»¶ï¼‰

- [ ] `migrations/models/1_20251118071544_add_tenant_models.py`
- [ ] `migrations/models/2_20251118082149_add_user_role_permission_models.py`
- [ ] `migrations/models/3_20251118085423_make_email_optional.py`
- [ ] `migrations/models/4_20251118120000_add_superadmin_model.py`
- [ ] `migrations/models/5_20251119000000_unify_superadmin_to_user.py`
- [ ] `migrations/models/6_20251120000000_add_user_source_field.py`
- [ ] `migrations/models/7_20251120000000_rename_is_superuser_to_is_platform_admin.py`

### 3. SQL æŸ¥è¯¢ï¼ˆ136 å¤„å¼•ç”¨ï¼‰

**éœ€è¦æŸ¥æ‰¾çš„ä½ç½®**ï¼š
- æ‰€æœ‰æ¨¡å‹æŸ¥è¯¢ä¸­çš„è¡¨å
- åŸå§‹ SQL æŸ¥è¯¢
- è¿ç§»è„šæœ¬ä¸­çš„ SQL
- æµ‹è¯•æ–‡ä»¶ä¸­çš„ SQL

### 4. é…ç½®æ–‡ä»¶

- [ ] `riveredge-core/pyproject.toml` - é¡¹ç›®åç§°
- [ ] `riveredge-core/README.md` - é¡¹ç›®å¼•ç”¨
- [ ] `riveredge-shell/package.json` - é¡¹ç›®åç§°
- [ ] `riveredge-shell/README.md` - é¡¹ç›®å¼•ç”¨
- [ ] `README.md` - é¡¹ç›®å¼•ç”¨
- [ ] `start-all.sh` - è·¯å¾„å¼•ç”¨
- [ ] `riveredge-core/scripts/deploy.sh` - è·¯å¾„å¼•ç”¨

### 5. æ–‡æ¡£å¼•ç”¨ï¼ˆ11 ä¸ªæ–‡ä»¶ï¼‰

- [ ] `README.md`
- [ ] `Farming Plan/1.plan/2.æ¶æ„è®¾è®¡æ–‡æ¡£.md`
- [ ] `Farming Plan/1.plan/3.æ¡†æ¶åŠŸèƒ½åˆ—è¡¨.md`
- [ ] `Farming Plan/1.plan/4.æ¡†æ¶å¼€å‘è®¡åˆ’.md`
- [ ] `Farming Plan/2.rules/AGENTS.md`
- [ ] `Farming Plan/2.rules/5.é¡¹ç›®ç»“æ„è§„èŒƒ.md`
- [ ] å…¶ä»–æ–‡æ¡£ä¸­çš„å¼•ç”¨

---

## ğŸ› ï¸ æ‰§è¡Œè„šæœ¬

### æ•°æ®åº“é‡å‘½åè„šæœ¬

```sql
-- ============================================
-- æ•°æ®åº“é‡å‘½åè„šæœ¬
-- æ‰§è¡Œå‰è¯·å…ˆå¤‡ä»½æ•°æ®åº“ï¼
-- ============================================

BEGIN;

-- é‡å‘½åç³»ç»Ÿçº§è¡¨
ALTER TABLE core_users RENAME TO root_users;
ALTER TABLE core_roles RENAME TO root_roles;
ALTER TABLE core_permissions RENAME TO root_permissions;

-- é‡å‘½åç§Ÿæˆ·ç®¡ç†è¡¨
ALTER TABLE core_tenants RENAME TO tree_tenants;
ALTER TABLE core_tenant_configs RENAME TO tree_tenant_configs;
ALTER TABLE core_tenant_activity_logs RENAME TO tree_tenant_activity_logs;

-- é‡å‘½åç´¢å¼•ï¼ˆç¤ºä¾‹ï¼Œéœ€è¦æ ¹æ®å®é™…ç´¢å¼•åè°ƒæ•´ï¼‰
ALTER INDEX idx_core_users_tenant_id RENAME TO idx_root_users_tenant_id;
ALTER INDEX idx_core_users_username RENAME TO idx_root_users_username;
ALTER INDEX idx_core_roles_tenant_id RENAME TO idx_root_roles_tenant_id;
ALTER INDEX idx_core_permissions_tenant_id RENAME TO idx_root_permissions_tenant_id;
ALTER INDEX idx_core_tenant_tenant__e55d73 RENAME TO idx_tree_tenants_tenant_id;
ALTER INDEX idx_core_tenant_domain_22c064 RENAME TO idx_tree_tenants_domain;
ALTER INDEX idx_core_tenant_status_195cc5 RENAME TO idx_tree_tenants_status;
ALTER INDEX idx_core_tenant_config_tenant__993185 RENAME TO idx_tree_tenant_configs_tenant_id;

COMMIT;
```

### å›æ»šè„šæœ¬

```sql
-- ============================================
-- æ•°æ®åº“é‡å‘½åå›æ»šè„šæœ¬
-- ============================================

BEGIN;

-- å›æ»šç³»ç»Ÿçº§è¡¨
ALTER TABLE root_users RENAME TO core_users;
ALTER TABLE root_roles RENAME TO core_roles;
ALTER TABLE root_permissions RENAME TO core_permissions;

-- å›æ»šç§Ÿæˆ·ç®¡ç†è¡¨
ALTER TABLE tree_tenants RENAME TO core_tenants;
ALTER TABLE tree_tenant_configs RENAME TO core_tenant_configs;
ALTER TABLE tree_tenant_activity_logs RENAME TO core_tenant_activity_logs;

-- å›æ»šç´¢å¼•
ALTER INDEX idx_root_users_tenant_id RENAME TO idx_core_users_tenant_id;
ALTER INDEX idx_root_users_username RENAME TO idx_core_users_username;
ALTER INDEX idx_root_roles_tenant_id RENAME TO idx_core_roles_tenant_id;
ALTER INDEX idx_root_permissions_tenant_id RENAME TO idx_core_permissions_tenant_id;
ALTER INDEX idx_tree_tenants_tenant_id RENAME TO idx_core_tenant_tenant__e55d73;
ALTER INDEX idx_tree_tenants_domain RENAME TO idx_core_tenant_domain_22c064;
ALTER INDEX idx_tree_tenants_status RENAME TO idx_core_tenant_status_195cc5;
ALTER INDEX idx_tree_tenant_configs_tenant_id RENAME TO idx_core_tenant_config_tenant__993185;

COMMIT;
```

---

## âœ… æ‰§è¡Œæ£€æŸ¥æ¸…å•

### æ•°æ®åº“é‡å‘½åæ£€æŸ¥

- [ ] å¤‡ä»½æ•°æ®åº“
- [ ] åˆ›å»ºæ•°æ®è¿ç§»è„šæœ¬
- [ ] åˆ›å»ºå›æ»šè„šæœ¬
- [ ] åœ¨æµ‹è¯•ç¯å¢ƒæ‰§è¡Œè¿ç§»
- [ ] éªŒè¯æ•°æ®å®Œæ•´æ€§
- [ ] æ›´æ–°æ‰€æœ‰æ¨¡å‹å®šä¹‰
- [ ] æ›´æ–°æ‰€æœ‰è¿ç§»æ–‡ä»¶
- [ ] æ›´æ–°æ‰€æœ‰ SQL æŸ¥è¯¢
- [ ] æ›´æ–°æ‰€æœ‰ç´¢å¼•åç§°
- [ ] æµ‹è¯•æ‰€æœ‰æ•°æ®åº“æ“ä½œ
- [ ] æµ‹è¯•å›æ»šè„šæœ¬

### æ–‡ä»¶å¤¹é‡å‘½åæ£€æŸ¥

- [ ] åˆ›å»ºæ–°æ–‡ä»¶å¤¹ç»“æ„
- [ ] è¿ç§»æ‰€æœ‰ä»£ç æ–‡ä»¶
- [ ] æ›´æ–°æ‰€æœ‰å¯¼å…¥è·¯å¾„
- [ ] æ›´æ–°æ‰€æœ‰é…ç½®æ–‡ä»¶
- [ ] æ›´æ–°æ‰€æœ‰è„šæœ¬æ–‡ä»¶
- [ ] æ›´æ–°æ‰€æœ‰æ–‡æ¡£å¼•ç”¨
- [ ] æ›´æ–° CI/CD é…ç½®
- [ ] æµ‹è¯•æ‰€æœ‰åŠŸèƒ½
- [ ] æ›´æ–°å¼€å‘è€…æ–‡æ¡£

---

## ğŸ“Š å·¥ä½œé‡ä¼°ç®—

### æ•°æ®åº“é‡å‘½å

| ä»»åŠ¡ | æ–‡ä»¶æ•° | å·¥ä½œé‡ | æ—¶é—´ |
|------|--------|--------|------|
| æ¨¡å‹å®šä¹‰ä¿®æ”¹ | 6 | â­â­ | 3 å°æ—¶ |
| è¿ç§»æ–‡ä»¶ä¿®æ”¹ | 7 | â­â­â­ | 7 å°æ—¶ |
| SQL æŸ¥è¯¢ä¿®æ”¹ | 136 å¤„ | â­â­â­â­ | 10-12 å°æ—¶ |
| æ•°æ®è¿ç§»è„šæœ¬ | 1 | â­â­ | 4 å°æ—¶ |
| æµ‹è¯•éªŒè¯ | - | â­â­â­ | 1-2 å¤© |
| **æ€»è®¡** | - | **â­â­â­â­** | **2-3 å¤©** |

### æ–‡ä»¶å¤¹é‡å‘½å

| ä»»åŠ¡ | å·¥ä½œé‡ | æ—¶é—´ |
|------|--------|------|
| åˆ›å»ºæ–°ç»“æ„ | â­â­ | 1 å¤© |
| ä»£ç è¿ç§» | â­â­â­â­ | 2-3 å¤© |
| å¼•ç”¨æ›´æ–° | â­â­â­ | 1 å¤© |
| æµ‹è¯•éªŒè¯ | â­â­â­ | 1-2 å¤© |
| **æ€»è®¡** | **â­â­â­â­â­** | **5-7 å¤©** |

---

## ğŸ¯ æ¨èæ‰§è¡Œé¡ºåº

### ç¬¬ä¸€æ­¥ï¼šæ•°æ®åº“é‡å‘½åï¼ˆ2-3 å¤©ï¼‰

1. åˆ›å»ºæ•°æ®è¿ç§»è„šæœ¬
2. åœ¨æµ‹è¯•ç¯å¢ƒæ‰§è¡Œ
3. æ›´æ–°æ‰€æœ‰ä»£ç å¼•ç”¨
4. å…¨é¢æµ‹è¯•éªŒè¯

### ç¬¬äºŒæ­¥ï¼šæ–‡ä»¶å¤¹é‡å‘½åï¼ˆ5-7 å¤©ï¼‰

1. åˆ›å»ºæ–°æ–‡ä»¶å¤¹ç»“æ„
2. è¿ç§»ä»£ç æ–‡ä»¶
3. æ›´æ–°æ‰€æœ‰å¼•ç”¨
4. å…¨é¢æµ‹è¯•éªŒè¯

---

**æœ€åæ›´æ–°**ï¼š2025-01-XX


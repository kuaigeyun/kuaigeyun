# 重命名工作量评估 - RiverEdge SaaS 多组织框架

## 📋 评估概述

评估在不改变功能的前提下，更新文件夹命名和数据库命名的工作量。

**评估日期**：2025-01-XX

---

## 🔍 当前命名使用情况

### 文件夹命名使用情况

**当前文件夹**：
- `riveredge-core/` - 后端核心系统
- `riveredge-shell/` - 前端框架
- `riveredge-seeds/` - 应用插件集合
- `riveredge-land/` - 着陆页/官网
- `riveredge-leaf/` - 移动端应用

**引用位置统计**：
- 文档引用：11 个文件
- 配置文件：3 个文件（pyproject.toml, package.json, README.md）
- 脚本文件：2 个文件（deploy.sh, start-all.sh）
- 代码引用：少量（主要在插件系统）

### 数据库命名使用情况

**当前数据库表前缀**：
- `core_` - 核心系统表（136 处引用）
- `seed_插件名_` - 应用插件表
- `sys_` - 兼容别名（少量使用）

**使用位置统计**：
- 模型定义：6 个模型文件
- 迁移文件：7 个迁移文件
- SQL 查询：136 处引用
- 索引定义：多个索引

---

## 📊 重命名方案对比

### 方案一：保持当前命名（推荐）✅

**工作量**：⭐ (1/5)

**需要修改**：
- ✅ 仅需更新文档，说明架构层级对应关系
- ✅ 无需修改代码
- ✅ 无需修改数据库

**优势**：
- ✅ 工作量最小
- ✅ 风险为零
- ✅ 保持代码一致性
- ✅ 无需测试验证

**劣势**：
- ⚠️ 命名不完全对齐架构图（但可以通过文档说明）

---

### 方案二：完全对齐架构图重命名

#### 2.1 文件夹重命名

**重命名映射**：
- `riveredge-core` → `riveredge-root` + `riveredge-core`（拆分）
- `riveredge-shell` → `riveredge-stem` + `riveredge-shell`（拆分）
- `riveredge-seeds` → `riveredge-seed`（单数形式）

**工作量评估**：

| 任务 | 文件数量 | 工作量 | 风险 |
|------|---------|--------|------|
| **Git 仓库重命名** | 5 个仓库 | ⭐⭐⭐ | 中 |
| **文档更新** | 11 个文件 | ⭐⭐ | 低 |
| **配置文件更新** | 3 个文件 | ⭐ | 低 |
| **脚本文件更新** | 2 个文件 | ⭐ | 低 |
| **代码引用更新** | 少量 | ⭐ | 低 |
| **依赖关系更新** | 多个 | ⭐⭐ | 中 |
| **测试验证** | 全部 | ⭐⭐⭐ | 中 |

**总工作量**：⭐⭐⭐⭐ (4/5)

**风险**：
- ❌ 需要修改 Git 历史（或创建新仓库）
- ❌ 可能影响 CI/CD 配置
- ❌ 需要更新所有文档和引用
- ❌ 需要大量测试验证

---

#### 2.2 数据库重命名

**重命名映射**：
- `core_` → `root_`（系统级表）
- 新增 `stem_`（系统级前端配置表）
- 新增 `tree_`（租户管理表）
- 保持 `seed_插件名_`（应用插件表）

**工作量评估**：

| 任务 | 影响范围 | 工作量 | 风险 |
|------|---------|--------|------|
| **模型定义修改** | 6 个模型文件 | ⭐⭐ | 中 |
| **迁移文件修改** | 7 个迁移文件 | ⭐⭐⭐ | 高 |
| **SQL 查询修改** | 136 处引用 | ⭐⭐⭐⭐ | 高 |
| **索引重命名** | 多个索引 | ⭐⭐ | 中 |
| **数据迁移脚本** | 需要创建 | ⭐⭐⭐ | 高 |
| **数据库结构变更** | 所有表 | ⭐⭐⭐⭐ | 极高 |
| **测试验证** | 全部功能 | ⭐⭐⭐⭐⭐ | 极高 |

**总工作量**：⭐⭐⭐⭐⭐ (5/5)

**风险**：
- ❌ 需要数据迁移脚本（高风险）
- ❌ 可能影响生产环境数据
- ❌ 需要停机维护
- ❌ 需要回滚方案
- ❌ 可能破坏现有功能

---

### 方案三：混合方案 - 保持核心命名，新增层级说明

**工作量**：⭐⭐ (2/5)

**需要修改**：
- ✅ 更新文档，说明架构层级
- ✅ 更新代码注释，说明层级对应关系
- ⚠️ 可选：在数据库注释中添加层级说明

**优势**：
- ✅ 工作量适中
- ✅ 风险低
- ✅ 保持代码一致性
- ✅ 清晰说明架构层级

**劣势**：
- ⚠️ 命名不完全对齐架构图（但可以通过文档说明）

---

## 📈 详细工作量分析

### 文件夹重命名详细分析

#### 1. Git 仓库重命名

**需要重命名的仓库**：
- `riveredge-core` → `riveredge-root` + `riveredge-core`（需要拆分）
- `riveredge-shell` → `riveredge-stem` + `riveredge-shell`（需要拆分）
- `riveredge-seeds` → `riveredge-seed`（单数形式）

**工作量**：
- 拆分仓库：需要创建新仓库，迁移代码，更新历史（如需要）
- 重命名仓库：需要更新远程仓库名称
- 更新本地配置：需要更新所有开发者的本地配置

**时间估算**：
- 拆分 `riveredge-core`：2-3 天
- 拆分 `riveredge-shell`：2-3 天
- 重命名 `riveredge-seeds`：1 天
- 测试验证：2-3 天
- **总计**：7-10 天

---

#### 2. 文档更新

**需要更新的文档**：
- README.md（3 个文件）
- 技术选型文档
- 架构设计文档
- 开发计划文档
- 所有规范文档

**工作量**：
- 查找替换：1-2 小时
- 内容审核：2-3 小时
- 格式调整：1 小时
- **总计**：4-6 小时

---

#### 3. 配置文件更新

**需要更新的配置**：
- `pyproject.toml`（项目名称）
- `package.json`（项目名称和依赖）
- `deploy.sh`（路径引用）
- `start-all.sh`（路径引用）
- CI/CD 配置（如存在）

**工作量**：
- 配置文件修改：1 小时
- 测试验证：2 小时
- **总计**：3 小时

---

#### 4. 代码引用更新

**需要更新的代码**：
- 插件系统引用
- 导入路径
- 相对路径引用

**工作量**：
- 代码查找：1 小时
- 代码修改：1-2 小时
- 测试验证：2 小时
- **总计**：4-5 小时

---

### 数据库重命名详细分析

#### 1. 模型定义修改

**需要修改的模型**：
- `User` → `table = "root_users"`（或保持 `core_users`）
- `Role` → `table = "root_roles"`（或保持 `core_roles`）
- `Permission` → `table = "root_permissions"`（或保持 `core_permissions`）
- `Tenant` → `table = "tree_tenants"`（或保持 `core_tenants`）
- `TenantConfig` → `table = "tree_tenant_configs"`（或保持 `core_tenant_configs`）
- `TenantActivityLog` → `table = "tree_tenant_activity_logs"`（或保持 `core_tenant_activity_logs`）

**工作量**：
- 模型文件修改：6 个文件 × 30 分钟 = 3 小时
- 索引名称修改：多个索引 × 10 分钟 = 1 小时
- 测试验证：2 小时
- **总计**：6 小时

---

#### 2. 迁移文件修改

**需要修改的迁移文件**：
- 7 个迁移文件
- 每个文件包含 CREATE TABLE 语句
- 需要修改表名、索引名、约束名

**工作量**：
- 迁移文件修改：7 个文件 × 1 小时 = 7 小时
- 迁移测试：3 小时
- 回滚测试：2 小时
- **总计**：12 小时

---

#### 3. SQL 查询修改

**需要修改的 SQL 查询**：
- 136 处 `core_` 前缀引用
- 包括模型查询、原始 SQL、迁移脚本

**工作量**：
- 查找所有引用：1 小时
- 批量替换：1 小时
- 逐个验证：4-6 小时
- 测试验证：4 小时
- **总计**：10-12 小时

---

#### 4. 数据迁移脚本

**需要创建的数据迁移脚本**：
- 重命名表：`ALTER TABLE core_users RENAME TO root_users;`
- 重命名索引：`ALTER INDEX idx_core_users_tenant_id RENAME TO idx_root_users_tenant_id;`
- 数据验证：确保数据完整性

**工作量**：
- 脚本编写：4 小时
- 脚本测试：4 小时
- 生产环境测试：2 小时
- 回滚脚本：2 小时
- **总计**：12 小时

---

#### 5. 数据库结构变更

**需要执行的操作**：
- 重命名所有表（6 个表）
- 重命名所有索引（20+ 个索引）
- 重命名所有约束（多个约束）
- 更新所有外键引用

**工作量**：
- 结构变更脚本：2 小时
- 执行变更：1 小时（需要停机）
- 验证变更：2 小时
- 回滚准备：2 小时
- **总计**：7 小时

---

## 📊 工作量总结表

### 文件夹重命名工作量

| 任务 | 工作量 | 时间估算 | 风险 |
|------|--------|---------|------|
| Git 仓库重命名/拆分 | ⭐⭐⭐⭐ | 7-10 天 | 中 |
| 文档更新 | ⭐ | 4-6 小时 | 低 |
| 配置文件更新 | ⭐ | 3 小时 | 低 |
| 代码引用更新 | ⭐ | 4-5 小时 | 低 |
| 测试验证 | ⭐⭐⭐ | 2-3 天 | 中 |
| **总计** | **⭐⭐⭐⭐** | **10-15 天** | **中** |

### 数据库重命名工作量

| 任务 | 工作量 | 时间估算 | 风险 |
|------|--------|---------|------|
| 模型定义修改 | ⭐⭐ | 6 小时 | 中 |
| 迁移文件修改 | ⭐⭐⭐ | 12 小时 | 高 |
| SQL 查询修改 | ⭐⭐⭐⭐ | 10-12 小时 | 高 |
| 数据迁移脚本 | ⭐⭐⭐ | 12 小时 | 高 |
| 数据库结构变更 | ⭐⭐⭐⭐ | 7 小时 | 极高 |
| 测试验证 | ⭐⭐⭐⭐⭐ | 3-5 天 | 极高 |
| **总计** | **⭐⭐⭐⭐⭐** | **7-10 天** | **极高** |

### 总体工作量

| 方案 | 文件夹重命名 | 数据库重命名 | 总工作量 | 总时间 | 风险 |
|------|------------|------------|---------|--------|------|
| **方案一：保持命名** | ⭐ | ⭐ | ⭐ | 4-6 小时 | 无 |
| **方案二：完全重命名** | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | 17-25 天 | 极高 |
| **方案三：混合方案** | ⭐ | ⭐ | ⭐⭐ | 1-2 天 | 低 |

---

## 🎯 推荐方案

### 推荐：方案一 - 保持当前命名，通过文档说明架构层级 ✅

**理由**：
1. **工作量最小**：仅需 4-6 小时更新文档
2. **风险为零**：不修改代码和数据库
3. **保持一致性**：现有代码和数据库命名保持一致
4. **清晰说明**：通过文档可以清晰说明架构层级对应关系

**实施步骤**：
1. ✅ 更新命名哲学文档（已完成）
2. ✅ 在文档中说明层级对应关系（已完成）
3. ✅ 保持现有文件夹和数据库命名
4. ✅ 未来新功能可以使用新的层级概念

---

## ⚠️ 风险提示

### 如果选择完全重命名

**高风险项**：
1. **数据库重命名**：
   - ❌ 需要数据迁移脚本
   - ❌ 可能影响生产环境
   - ❌ 需要停机维护
   - ❌ 需要回滚方案

2. **文件夹拆分**：
   - ❌ 需要创建新仓库
   - ❌ 需要迁移代码
   - ❌ 可能影响 CI/CD
   - ❌ 需要更新所有开发者环境

3. **测试验证**：
   - ❌ 需要全面测试所有功能
   - ❌ 可能发现隐藏问题
   - ❌ 需要大量时间验证

**建议**：
- ⚠️ **强烈不推荐**完全重命名
- ✅ **强烈推荐**保持当前命名，通过文档说明

---

## 📝 结论

**最终推荐**：保持当前命名，通过文档整合架构概念

**工作量**：⭐ (1/5) - 仅需 4-6 小时更新文档

**风险**：无 - 不修改代码和数据库

**收益**：
- ✅ 保持代码和数据库的一致性
- ✅ 通过文档清晰说明架构层级
- ✅ 未来可以灵活扩展新的层级概念
- ✅ 无需大量测试验证

---

**最后更新**：2025-01-XX


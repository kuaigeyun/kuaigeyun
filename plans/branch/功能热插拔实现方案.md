# RiverEdge SaaS å¤šç»„ç»‡æ¡†æ¶ - åŠŸèƒ½çƒ­æ’æ‹”å®ç°æ–¹æ¡ˆ

## ğŸ“‹ æ¦‚è¿°

åœ¨ **RiverEdge SaaS å¤šç»„ç»‡æ¡†æ¶ (RiverEdge SaaS Multi-tenant Framework)** ä¸­ï¼ŒåŠŸèƒ½çƒ­æ’æ‹”æ˜¯æŒ‡åœ¨ä¸ä¿®æ”¹æ ¸å¿ƒä»£ç çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡æ’ä»¶æœºåˆ¶åŠ¨æ€åŠ è½½å’Œå¸è½½åŠŸèƒ½æ¨¡å—ï¼ˆå¦‚æ”¯ä»˜ã€çŸ­ä¿¡ã€é‚®ä»¶ç­‰ï¼‰ï¼Œå®ç°åŠŸèƒ½çš„çµæ´»æ‰©å±•å’Œæ›¿æ¢ã€‚

## ğŸ¯ è®¾è®¡ç›®æ ‡

1. **æ ¸å¿ƒä»£ç é›¶æ±¡æŸ“**ï¼šæ ¸å¿ƒç³»ç»Ÿä¸åŒ…å«ä»»ä½•ä¸šåŠ¡åŠŸèƒ½çš„å…·ä½“å®ç°
2. **è¿è¡Œæ—¶çƒ­æ’æ‹”**ï¼šæ”¯æŒåœ¨ä¸é‡å¯æœåŠ¡çš„æƒ…å†µä¸‹å¯ç”¨/ç¦ç”¨åŠŸèƒ½
3. **æ¥å£æ ‡å‡†åŒ–**ï¼šé€šè¿‡æŠ½è±¡æ¥å£å®šä¹‰åŠŸèƒ½å¥‘çº¦ï¼Œæ’ä»¶å®ç°å…·ä½“åŠŸèƒ½
4. **å¤šå®ç°æ”¯æŒ**ï¼šåŒä¸€åŠŸèƒ½å¯ä»¥æœ‰å¤šä¸ªå®ç°ï¼ˆå¦‚å¤šç§æ”¯ä»˜æ–¹å¼ï¼‰
5. **é…ç½®é©±åŠ¨**ï¼šé€šè¿‡é…ç½®é€‰æ‹©ä½¿ç”¨å“ªä¸ªå®ç°

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ ¸å¿ƒæ¶æ„

```
riveredge-core/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ interfaces/          # åŠŸèƒ½æ¥å£å®šä¹‰ï¼ˆæ ¸å¿ƒï¼‰
â”‚   â”‚   â”œâ”€â”€ payment.py       # æ”¯ä»˜æ¥å£
â”‚   â”‚   â”œâ”€â”€ sms.py          # çŸ­ä¿¡æ¥å£
â”‚   â”‚   â”œâ”€â”€ email.py        # é‚®ä»¶æ¥å£
â”‚   â”‚   â””â”€â”€ storage.py      # å­˜å‚¨æ¥å£
â”‚   â”œâ”€â”€ service_registry.py # æœåŠ¡æ³¨å†Œè¡¨ï¼ˆæ ¸å¿ƒï¼‰
â”‚   â””â”€â”€ plugin_base.py      # æ’ä»¶åŸºç±»
â”‚
riveredge-seed/
â”œâ”€â”€ seed-payment-alipay/     # æ”¯ä»˜å®æ”¯ä»˜æ’ä»¶
â”œâ”€â”€ seed-payment-wechat/     # å¾®ä¿¡æ”¯ä»˜æ’ä»¶
â”œâ”€â”€ seed-sms-aliyun/         # é˜¿é‡Œäº‘çŸ­ä¿¡æ’ä»¶
â”œâ”€â”€ seed-sms-tencent/        # è…¾è®¯äº‘çŸ­ä¿¡æ’ä»¶
â””â”€â”€ seed-email-smtp/         # SMTP é‚®ä»¶æ’ä»¶
```

### è®¾è®¡åŸåˆ™

1. **æ¥å£éš”ç¦»åŸåˆ™**ï¼šæ ¸å¿ƒç³»ç»Ÿåªå®šä¹‰æ¥å£ï¼Œä¸åŒ…å«å®ç°
2. **ä¾èµ–å€’ç½®åŸåˆ™**ï¼šæ ¸å¿ƒç³»ç»Ÿä¾èµ–æŠ½è±¡æ¥å£ï¼Œæ’ä»¶å®ç°å…·ä½“åŠŸèƒ½
3. **å¼€é—­åŸåˆ™**ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­
4. **å•ä¸€èŒè´£åŸåˆ™**ï¼šæ¯ä¸ªæ’ä»¶åªå®ç°ä¸€ä¸ªåŠŸèƒ½

## ğŸ”Œ å®ç°æ–¹æ¡ˆ

### 1. æ¥å£å®šä¹‰ï¼ˆæ ¸å¿ƒç³»ç»Ÿï¼‰

#### æ”¯ä»˜æ¥å£ç¤ºä¾‹

```python
# core/interfaces/payment.py
from abc import ABC, abstractmethod
from typing import Dict, Optional
from pydantic import BaseModel

class PaymentRequest(BaseModel):
    """æ”¯ä»˜è¯·æ±‚"""
    amount: float
    currency: str = "CNY"
    order_id: str
    subject: str
    return_url: Optional[str] = None
    notify_url: Optional[str] = None
    extra: Dict[str, str] = {}

class PaymentResponse(BaseModel):
    """æ”¯ä»˜å“åº”"""
    success: bool
    payment_id: str
    payment_url: Optional[str] = None
    qr_code: Optional[str] = None
    message: Optional[str] = None

class PaymentResult(BaseModel):
    """æ”¯ä»˜ç»“æœ"""
    success: bool
    order_id: str
    payment_id: str
    amount: float
    paid_at: Optional[str] = None
    extra: Dict[str, str] = {}

class IPaymentProvider(ABC):
    """æ”¯ä»˜æ¥å£ï¼ˆæ ¸å¿ƒç³»ç»Ÿå®šä¹‰ï¼‰"""
    
    @abstractmethod
    def get_provider_name(self) -> str:
        """è·å–æ”¯ä»˜æä¾›å•†åç§°"""
        pass
    
    @abstractmethod
    async def create_payment(self, request: PaymentRequest) -> PaymentResponse:
        """åˆ›å»ºæ”¯ä»˜è®¢å•"""
        pass
    
    @abstractmethod
    async def query_payment(self, payment_id: str) -> PaymentResult:
        """æŸ¥è¯¢æ”¯ä»˜çŠ¶æ€"""
        pass
    
    @abstractmethod
    async def verify_notify(self, data: Dict) -> PaymentResult:
        """éªŒè¯æ”¯ä»˜é€šçŸ¥"""
        pass
    
    @abstractmethod
    async def refund(self, payment_id: str, amount: float, reason: str) -> bool:
        """é€€æ¬¾"""
        pass
```

#### çŸ­ä¿¡æ¥å£ç¤ºä¾‹

```python
# core/interfaces/sms.py
from abc import ABC, abstractmethod
from typing import List, Dict, Optional
from pydantic import BaseModel

class SMSMessage(BaseModel):
    """çŸ­ä¿¡æ¶ˆæ¯"""
    phone: str
    template_code: str
    params: Dict[str, str] = {}
    sign_name: Optional[str] = None

class SMSResponse(BaseModel):
    """çŸ­ä¿¡å“åº”"""
    success: bool
    message_id: Optional[str] = None
    message: Optional[str] = None

class ISMSProvider(ABC):
    """çŸ­ä¿¡æ¥å£ï¼ˆæ ¸å¿ƒç³»ç»Ÿå®šä¹‰ï¼‰"""
    
    @abstractmethod
    def get_provider_name(self) -> str:
        """è·å–çŸ­ä¿¡æä¾›å•†åç§°"""
        pass
    
    @abstractmethod
    async def send_sms(self, message: SMSMessage) -> SMSResponse:
        """å‘é€å•æ¡çŸ­ä¿¡"""
        pass
    
    @abstractmethod
    async def send_batch_sms(self, messages: List[SMSMessage]) -> List[SMSResponse]:
        """æ‰¹é‡å‘é€çŸ­ä¿¡"""
        pass
    
    @abstractmethod
    async def query_sms_status(self, message_id: str) -> Dict:
        """æŸ¥è¯¢çŸ­ä¿¡å‘é€çŠ¶æ€"""
        pass
```

### 2. æœåŠ¡æ³¨å†Œè¡¨ï¼ˆæ ¸å¿ƒç³»ç»Ÿï¼‰

```python
# core/service_registry.py
from typing import Dict, Type, Optional, List
from core.interfaces.payment import IPaymentProvider
from core.interfaces.sms import ISMSProvider

class ServiceRegistry:
    """æœåŠ¡æ³¨å†Œè¡¨ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰"""
    
    _instance = None
    _payment_providers: Dict[str, IPaymentProvider] = {}
    _sms_providers: Dict[str, ISMSProvider] = {}
    _default_payment_provider: Optional[str] = None
    _default_sms_provider: Optional[str] = None
    
    def __new__(cls):
        if cls._instance is None:
            cls._instance = super().__new__(cls)
        return cls._instance
    
    # ========== æ”¯ä»˜æœåŠ¡ ==========
    
    def register_payment_provider(self, provider: IPaymentProvider, is_default: bool = False):
        """æ³¨å†Œæ”¯ä»˜æä¾›å•†"""
        name = provider.get_provider_name()
        self._payment_providers[name] = provider
        if is_default or self._default_payment_provider is None:
            self._default_payment_provider = name
    
    def get_payment_provider(self, name: Optional[str] = None) -> Optional[IPaymentProvider]:
        """è·å–æ”¯ä»˜æä¾›å•†"""
        if name is None:
            name = self._default_payment_provider
        return self._payment_providers.get(name)
    
    def list_payment_providers(self) -> List[str]:
        """åˆ—å‡ºæ‰€æœ‰æ”¯ä»˜æä¾›å•†"""
        return list(self._payment_providers.keys())
    
    def unregister_payment_provider(self, name: str):
        """æ³¨é”€æ”¯ä»˜æä¾›å•†"""
        if name in self._payment_providers:
            del self._payment_providers[name]
            if self._default_payment_provider == name:
                self._default_payment_provider = None
    
    # ========== çŸ­ä¿¡æœåŠ¡ ==========
    
    def register_sms_provider(self, provider: ISMSProvider, is_default: bool = False):
        """æ³¨å†ŒçŸ­ä¿¡æä¾›å•†"""
        name = provider.get_provider_name()
        self._sms_providers[name] = provider
        if is_default or self._default_sms_provider is None:
            self._default_sms_provider = name
    
    def get_sms_provider(self, name: Optional[str] = None) -> Optional[ISMSProvider]:
        """è·å–çŸ­ä¿¡æä¾›å•†"""
        if name is None:
            name = self._default_sms_provider
        return self._sms_providers.get(name)
    
    def list_sms_providers(self) -> List[str]:
        """åˆ—å‡ºæ‰€æœ‰çŸ­ä¿¡æä¾›å•†"""
        return list(self._sms_providers.keys())
    
    def unregister_sms_provider(self, name: str):
        """æ³¨é”€çŸ­ä¿¡æä¾›å•†"""
        if name in self._sms_providers:
            del self._sms_providers[name]
            if self._default_sms_provider == name:
                self._default_sms_provider = None

# å…¨å±€æœåŠ¡æ³¨å†Œè¡¨å®ä¾‹
service_registry = ServiceRegistry()
```

### 3. æ’ä»¶åŸºç±»æ‰©å±•

```python
# core/plugin_base.py
from abc import ABC, abstractmethod
from fastapi import APIRouter
from typing import List, Optional

class BasePlugin(ABC):
    """æ’ä»¶åŸºç±»"""
    
    @abstractmethod
    def get_router(self) -> APIRouter:
        """è¿”å›æ’ä»¶çš„ API è·¯ç”±"""
        pass
    
    @abstractmethod
    def get_models(self) -> List:
        """è¿”å›æ’ä»¶çš„ Tortoise ORM æ¨¡å‹åˆ—è¡¨"""
        pass
    
    def on_load(self):
        """æ’ä»¶åŠ è½½æ—¶çš„é’©å­ï¼ˆå¯é€‰ï¼‰"""
        pass
    
    def on_unload(self):
        """æ’ä»¶å¸è½½æ—¶çš„é’©å­ï¼ˆå¯é€‰ï¼‰"""
        pass
    
    def get_service_providers(self) -> dict:
        """è¿”å›æ’ä»¶æä¾›çš„æœåŠ¡æä¾›å•†ï¼ˆå¯é€‰ï¼‰"""
        return {}
```

### 4. æ’ä»¶å®ç°ç¤ºä¾‹

#### æ”¯ä»˜å®æ”¯ä»˜æ’ä»¶

```python
# riveredge-seed/seed-payment-alipay/backend/src/plugin.py
from core.plugin_base import BasePlugin
from core.interfaces.payment import IPaymentProvider, PaymentRequest, PaymentResponse, PaymentResult
from core.service_registry import service_registry
from fastapi import APIRouter
from typing import List
import httpx

class AlipayPaymentProvider(IPaymentProvider):
    """æ”¯ä»˜å®æ”¯ä»˜å®ç°"""
    
    def __init__(self, app_id: str, private_key: str, public_key: str):
        self.app_id = app_id
        self.private_key = private_key
        self.public_key = public_key
    
    def get_provider_name(self) -> str:
        return "alipay"
    
    async def create_payment(self, request: PaymentRequest) -> PaymentResponse:
        """åˆ›å»ºæ”¯ä»˜å®æ”¯ä»˜è®¢å•"""
        # å®ç°æ”¯ä»˜å®æ”¯ä»˜é€»è¾‘
        # ...
        return PaymentResponse(
            success=True,
            payment_id="alipay_123456",
            payment_url="https://openapi.alipay.com/...",
            qr_code="data:image/png;base64,..."
        )
    
    async def query_payment(self, payment_id: str) -> PaymentResult:
        """æŸ¥è¯¢æ”¯ä»˜çŠ¶æ€"""
        # å®ç°æŸ¥è¯¢é€»è¾‘
        # ...
        pass
    
    async def verify_notify(self, data: dict) -> PaymentResult:
        """éªŒè¯æ”¯ä»˜é€šçŸ¥"""
        # å®ç°éªŒè¯é€»è¾‘
        # ...
        pass
    
    async def refund(self, payment_id: str, amount: float, reason: str) -> bool:
        """é€€æ¬¾"""
        # å®ç°é€€æ¬¾é€»è¾‘
        # ...
        pass

class AlipayPaymentPlugin(BasePlugin):
    """æ”¯ä»˜å®æ”¯ä»˜æ’ä»¶"""
    
    def __init__(self, config: dict):
        self.config = config
        self.provider = AlipayPaymentProvider(
            app_id=config.get("app_id"),
            private_key=config.get("private_key"),
            public_key=config.get("public_key")
        )
    
    def get_router(self) -> APIRouter:
        router = APIRouter(prefix="/api/payment/alipay", tags=["æ”¯ä»˜-æ”¯ä»˜å®"])
        # æ³¨å†Œæ’ä»¶ç‰¹å®šçš„ API è·¯ç”±ï¼ˆå¯é€‰ï¼‰
        return router
    
    def get_models(self) -> List:
        return []  # æ”¯ä»˜æ’ä»¶å¯èƒ½ä¸éœ€è¦æ•°æ®åº“æ¨¡å‹
    
    def on_load(self):
        """æ’ä»¶åŠ è½½æ—¶æ³¨å†Œæ”¯ä»˜æä¾›å•†"""
        is_default = self.config.get("is_default", False)
        service_registry.register_payment_provider(self.provider, is_default=is_default)
    
    def on_unload(self):
        """æ’ä»¶å¸è½½æ—¶æ³¨é”€æ”¯ä»˜æä¾›å•†"""
        service_registry.unregister_payment_provider(self.provider.get_provider_name())
    
    def get_service_providers(self) -> dict:
        return {
            "payment": self.provider
        }
```

#### é˜¿é‡Œäº‘çŸ­ä¿¡æ’ä»¶

```python
# riveredge-seed/seed-sms-aliyun/backend/src/plugin.py
from core.plugin_base import BasePlugin
from core.interfaces.sms import ISMSProvider, SMSMessage, SMSResponse
from core.service_registry import service_registry
from fastapi import APIRouter
from typing import List
import httpx

class AliyunSMSProvider(ISMSProvider):
    """é˜¿é‡Œäº‘çŸ­ä¿¡å®ç°"""
    
    def __init__(self, access_key_id: str, access_key_secret: str, region: str = "cn-hangzhou"):
        self.access_key_id = access_key_id
        self.access_key_secret = access_key_secret
        self.region = region
    
    def get_provider_name(self) -> str:
        return "aliyun"
    
    async def send_sms(self, message: SMSMessage) -> SMSResponse:
        """å‘é€çŸ­ä¿¡"""
        # å®ç°é˜¿é‡Œäº‘çŸ­ä¿¡å‘é€é€»è¾‘
        # ...
        return SMSResponse(
            success=True,
            message_id="aliyun_123456"
        )
    
    async def send_batch_sms(self, messages: List[SMSMessage]) -> List[SMSResponse]:
        """æ‰¹é‡å‘é€çŸ­ä¿¡"""
        # å®ç°æ‰¹é‡å‘é€é€»è¾‘
        # ...
        pass
    
    async def query_sms_status(self, message_id: str) -> dict:
        """æŸ¥è¯¢çŸ­ä¿¡çŠ¶æ€"""
        # å®ç°æŸ¥è¯¢é€»è¾‘
        # ...
        pass

class AliyunSMSPlugin(BasePlugin):
    """é˜¿é‡Œäº‘çŸ­ä¿¡æ’ä»¶"""
    
    def __init__(self, config: dict):
        self.config = config
        self.provider = AliyunSMSProvider(
            access_key_id=config.get("access_key_id"),
            access_key_secret=config.get("access_key_secret"),
            region=config.get("region", "cn-hangzhou")
        )
    
    def get_router(self) -> APIRouter:
        router = APIRouter(prefix="/api/sms/aliyun", tags=["çŸ­ä¿¡-é˜¿é‡Œäº‘"])
        return router
    
    def get_models(self) -> List:
        return []
    
    def on_load(self):
        """æ’ä»¶åŠ è½½æ—¶æ³¨å†ŒçŸ­ä¿¡æä¾›å•†"""
        is_default = self.config.get("is_default", False)
        service_registry.register_sms_provider(self.provider, is_default=is_default)
    
    def on_unload(self):
        """æ’ä»¶å¸è½½æ—¶æ³¨é”€çŸ­ä¿¡æä¾›å•†"""
        service_registry.unregister_sms_provider(self.provider.get_provider_name())
```

### 5. æ ¸å¿ƒç³»ç»Ÿä½¿ç”¨æœåŠ¡

```python
# services/payment_service.py
from core.service_registry import service_registry
from core.interfaces.payment import PaymentRequest, PaymentResponse, PaymentResult
from typing import Optional

class PaymentService:
    """æ”¯ä»˜æœåŠ¡ï¼ˆæ ¸å¿ƒç³»ç»Ÿï¼‰"""
    
    @staticmethod
    async def create_payment(
        request: PaymentRequest,
        provider_name: Optional[str] = None
    ) -> PaymentResponse:
        """åˆ›å»ºæ”¯ä»˜è®¢å•"""
        provider = service_registry.get_payment_provider(provider_name)
        if provider is None:
            raise ValueError(f"æ”¯ä»˜æä¾›å•†ä¸å­˜åœ¨: {provider_name}")
        return await provider.create_payment(request)
    
    @staticmethod
    async def query_payment(
        payment_id: str,
        provider_name: Optional[str] = None
    ) -> PaymentResult:
        """æŸ¥è¯¢æ”¯ä»˜çŠ¶æ€"""
        provider = service_registry.get_payment_provider(provider_name)
        if provider is None:
            raise ValueError(f"æ”¯ä»˜æä¾›å•†ä¸å­˜åœ¨: {provider_name}")
        return await provider.query_payment(payment_id)
    
    @staticmethod
    def list_providers() -> list:
        """åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„æ”¯ä»˜æä¾›å•†"""
        return service_registry.list_payment_providers()
```

```python
# services/sms_service.py
from core.service_registry import service_registry
from core.interfaces.sms import SMSMessage, SMSResponse
from typing import Optional, List

class SMSService:
    """çŸ­ä¿¡æœåŠ¡ï¼ˆæ ¸å¿ƒç³»ç»Ÿï¼‰"""
    
    @staticmethod
    async def send_sms(
        message: SMSMessage,
        provider_name: Optional[str] = None
    ) -> SMSResponse:
        """å‘é€çŸ­ä¿¡"""
        provider = service_registry.get_sms_provider(provider_name)
        if provider is None:
            raise ValueError(f"çŸ­ä¿¡æä¾›å•†ä¸å­˜åœ¨: {provider_name}")
        return await provider.send_sms(message)
    
    @staticmethod
    def list_providers() -> list:
        """åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„çŸ­ä¿¡æä¾›å•†"""
        return service_registry.list_sms_providers()
```

### 6. API è·¯ç”±ç¤ºä¾‹

```python
# api/v1/payment.py
from fastapi import APIRouter, Depends
from services.payment_service import PaymentService
from core.interfaces.payment import PaymentRequest, PaymentResponse
from api.deps import get_current_user

router = APIRouter(prefix="/api/v1/payment", tags=["æ”¯ä»˜"])

@router.post("/create", response_model=PaymentResponse)
async def create_payment(
    request: PaymentRequest,
    provider: str = None,
    current_user = Depends(get_current_user)
):
    """åˆ›å»ºæ”¯ä»˜è®¢å•"""
    return await PaymentService.create_payment(request, provider)

@router.get("/providers")
async def list_payment_providers():
    """åˆ—å‡ºæ‰€æœ‰æ”¯ä»˜æä¾›å•†"""
    return {"providers": PaymentService.list_providers()}
```

## ğŸ”„ çƒ­æ’æ‹”æµç¨‹

### 1. æ’ä»¶åŠ è½½æµç¨‹

```
1. ç³»ç»Ÿå¯åŠ¨æ—¶æ‰«æ riveredge-seeds ç›®å½•
2. è¯»å–æ’ä»¶çš„ manifest.json
3. æ£€æŸ¥æ’ä»¶æ˜¯å¦å¯ç”¨ï¼ˆenabled: trueï¼‰
4. åŠ¨æ€å¯¼å…¥æ’ä»¶æ¨¡å—
5. å®ä¾‹åŒ–æ’ä»¶ç±»
6. è°ƒç”¨æ’ä»¶çš„ on_load() é’©å­
7. æ’ä»¶åœ¨ on_load() ä¸­æ³¨å†ŒæœåŠ¡æä¾›å•†
8. æ³¨å†Œæ’ä»¶è·¯ç”±åˆ° FastAPI
9. æ³¨å†Œæ’ä»¶æ¨¡å‹åˆ° Tortoise ORM
```

### 2. æ’ä»¶å¸è½½æµç¨‹

```
1. è°ƒç”¨æ’ä»¶çš„ on_unload() é’©å­
2. æ’ä»¶åœ¨ on_unload() ä¸­æ³¨é”€æœåŠ¡æä¾›å•†
3. ä» FastAPI ä¸­ç§»é™¤æ’ä»¶è·¯ç”±
4. ä» Tortoise ORM ä¸­ç§»é™¤æ’ä»¶æ¨¡å‹
5. æ¸…ç†æ’ä»¶èµ„æº
```

### 3. è¿è¡Œæ—¶çƒ­æ’æ‹”

```python
# services/plugin_service.py
from utils.plugin_loader import PluginLoader
from core.service_registry import service_registry

class PluginService:
    """æ’ä»¶æœåŠ¡"""
    
    @staticmethod
    async def enable_plugin(plugin_id: str):
        """å¯ç”¨æ’ä»¶ï¼ˆçƒ­æ’æ‹”ï¼‰"""
        plugin = PluginLoader.load_plugin(plugin_id)
        plugin.on_load()
        # æ›´æ–°æ’ä»¶çŠ¶æ€
        # ...
    
    @staticmethod
    async def disable_plugin(plugin_id: str):
        """ç¦ç”¨æ’ä»¶ï¼ˆçƒ­æ’æ‹”ï¼‰"""
        plugin = PluginLoader.get_plugin(plugin_id)
        plugin.on_unload()
        # æ›´æ–°æ’ä»¶çŠ¶æ€
        # ...
```

## ğŸ“ æ’ä»¶é…ç½®

### manifest.json æ‰©å±•

```json
{
  "id": "seed-payment-alipay",
  "name": "æ”¯ä»˜å®æ”¯ä»˜",
  "version": "1.0.0",
  "description": "æ”¯ä»˜å®æ”¯ä»˜æ’ä»¶",
  "backend": {
    "enabled": true,
    "basePath": "/api/payment/alipay",
    "pluginClass": "AlipayPaymentPlugin",
    "config": {
      "app_id": "${ALIPAY_APP_ID}",
      "private_key": "${ALIPAY_PRIVATE_KEY}",
      "public_key": "${ALIPAY_PUBLIC_KEY}",
      "is_default": true
    },
    "services": {
      "payment": {
        "provider_name": "alipay",
        "is_default": true
      }
    }
  }
}
```

## âœ… ä¼˜åŠ¿

1. **æ ¸å¿ƒä»£ç é›¶æ±¡æŸ“**ï¼šæ ¸å¿ƒç³»ç»Ÿåªå®šä¹‰æ¥å£ï¼Œä¸åŒ…å«ä»»ä½•å…·ä½“å®ç°
2. **çµæ´»æ‰©å±•**ï¼šå¯ä»¥è½»æ¾æ·»åŠ æ–°çš„æ”¯ä»˜æ–¹å¼ã€çŸ­ä¿¡æœåŠ¡ç­‰
3. **è¿è¡Œæ—¶åˆ‡æ¢**ï¼šæ”¯æŒåœ¨ä¸é‡å¯çš„æƒ…å†µä¸‹åˆ‡æ¢ä¸åŒçš„å®ç°
4. **å¤šå®ç°æ”¯æŒ**ï¼šåŒä¸€åŠŸèƒ½å¯ä»¥æœ‰å¤šä¸ªå®ç°ï¼Œé€šè¿‡é…ç½®é€‰æ‹©
5. **æ˜“äºæµ‹è¯•**ï¼šå¯ä»¥è½»æ¾æ¨¡æ‹ŸæœåŠ¡æä¾›å•†è¿›è¡Œå•å…ƒæµ‹è¯•
6. **ç‰ˆæœ¬ç®¡ç†**ï¼šæ¯ä¸ªæ’ä»¶ç‹¬ç«‹ç‰ˆæœ¬ç®¡ç†ï¼Œäº’ä¸å½±å“

## ğŸ¯ æœ€ä½³å®è·µ

### 1. æ¥å£è®¾è®¡åŸåˆ™

- **æ¥å£è¦ç¨³å®š**ï¼šæ¥å£å®šä¹‰åå°½é‡ä¸ä¿®æ”¹ï¼Œé¿å…å½±å“ç°æœ‰æ’ä»¶
- **å‘åå…¼å®¹**ï¼šæ¥å£å˜æ›´æ—¶ä¿æŒå‘åå…¼å®¹
- **ç‰ˆæœ¬ç®¡ç†**ï¼šæ¥å£ç‰ˆæœ¬åŒ–ï¼Œæ”¯æŒå¤šç‰ˆæœ¬å…±å­˜

### 2. æ’ä»¶å¼€å‘åŸåˆ™

- **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªæ’ä»¶åªå®ç°ä¸€ä¸ªåŠŸèƒ½
- **é…ç½®é©±åŠ¨**ï¼šé€šè¿‡é…ç½®æ–‡ä»¶ç®¡ç†æ’ä»¶è¡Œä¸º
- **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- **èµ„æºæ¸…ç†**ï¼šåœ¨ on_unload() ä¸­æ¸…ç†æ‰€æœ‰èµ„æº

### 3. æœåŠ¡æ³¨å†ŒåŸåˆ™

- **å‘½åè§„èŒƒ**ï¼šæœåŠ¡æä¾›å•†åç§°è¦å”¯ä¸€ä¸”æœ‰æ„ä¹‰
- **é»˜è®¤æä¾›**ï¼šæ¯ä¸ªåŠŸèƒ½è‡³å°‘æœ‰ä¸€ä¸ªé»˜è®¤æä¾›å•†
- **çŠ¶æ€ç®¡ç†**ï¼šè®°å½•æœåŠ¡æä¾›å•†çš„çŠ¶æ€ï¼ˆå¯ç”¨/ç¦ç”¨ï¼‰

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ’ä»¶å¼€å‘è§„èŒƒ.md](./æ’ä»¶å¼€å‘è§„èŒƒ.md) - æ’ä»¶å¼€å‘è¯¦ç»†è§„èŒƒ
- [æ’ä»¶ç›®å½•ç»“æ„è¯´æ˜.md](./æ’ä»¶ç›®å½•ç»“æ„è¯´æ˜.md) - æ’ä»¶ç›®å½•ç»“æ„è¯´æ˜
- [2.æ¶æ„è®¾è®¡æ–‡æ¡£.md](../1.plan/2.æ¶æ„è®¾è®¡æ–‡æ¡£.md) - ç³»ç»Ÿæ¶æ„è®¾è®¡


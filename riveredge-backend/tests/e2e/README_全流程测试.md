# å…¨æµç¨‹è‡ªåŠ¨åŒ–æµ‹è¯•ä½¿ç”¨æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

å…¨æµç¨‹è‡ªåŠ¨åŒ–æµ‹è¯•ç”¨äºéªŒè¯å®Œæ•´çš„ä¸šåŠ¡æµç¨‹ï¼Œç¡®ä¿ä»åˆ›å»ºå•æ®åˆ°å®Œæˆæ‰€æœ‰åç»­æ“ä½œçš„æ•´ä¸ªæµç¨‹éƒ½èƒ½æ­£å¸¸è¿è¡Œã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. è¿è¡Œå•ä¸ªæµç¨‹æµ‹è¯•

```bash
# é”€å”®è®¢å•å®Œæ•´æµç¨‹
cd riveredge-backend
uv run pytest tests/e2e/test_complete_sales_order_workflow.py -v

# é‡‡è´­è®¢å•å®Œæ•´æµç¨‹
uv run pytest tests/e2e/test_purchase_workflow.py -v

# å·¥å•å®Œæ•´æµç¨‹
uv run pytest tests/e2e/test_mto_workflow.py -v
```

### 2. è¿è¡Œæ‰€æœ‰E2Eæµ‹è¯•

```bash
# æ–¹æ³•1: ä½¿ç”¨pytestç›´æ¥è¿è¡Œ
cd riveredge-backend
uv run pytest tests/e2e/ -v --tb=short

# æ–¹æ³•2: ä½¿ç”¨è¿è¡Œè„šæœ¬
cd riveredge-backend
python tests/e2e/run_all_tests.py

# æ–¹æ³•3: ä½¿ç”¨shellè„šæœ¬ï¼ˆLinux/Macï¼‰
cd riveredge-backend
bash scripts/run_complete_workflow_tests.sh
```

### 3. ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š

```bash
# ç”ŸæˆHTMLæŠ¥å‘Š
cd riveredge-backend
uv run pytest tests/e2e/ \
    --html=test_report.html \
    --self-contained-html \
    -v

# ç”ŸæˆJUnit XMLæŠ¥å‘Šï¼ˆç”¨äºCI/CDï¼‰
uv run pytest tests/e2e/ \
    --junit-xml=test_results.xml \
    -v
```

## ğŸ“ æµ‹è¯•æµç¨‹è¯´æ˜

### é”€å”®è®¢å•å®Œæ•´æµç¨‹

æµ‹è¯•æ–‡ä»¶ï¼š`test_complete_sales_order_workflow.py`

æµ‹è¯•æ­¥éª¤ï¼š
1. âœ… åˆ›å»ºé”€å”®è®¢å•ï¼ˆè‰ç¨¿çŠ¶æ€ï¼‰
2. âœ… æäº¤è®¢å•ï¼ˆå¾…å®¡æ ¸çŠ¶æ€ï¼‰
3. âœ… å®¡æ ¸è®¢å•ï¼ˆå·²å®¡æ ¸çŠ¶æ€ï¼‰
4. âœ… ç¡®è®¤è®¢å•ï¼ˆå·²ç¡®è®¤çŠ¶æ€ï¼Œå¦‚æœéœ€è¦ï¼‰
5. âœ… ä¸‹æ¨åˆ°é”€å”®å‡ºåº“
6. âœ… éªŒè¯å‡ºåº“å•åˆ›å»º
7. âœ… éªŒè¯è®¢å•çŠ¶æ€æ›´æ–°

### é‡‡è´­è®¢å•å®Œæ•´æµç¨‹

æµ‹è¯•æ–‡ä»¶ï¼š`test_purchase_workflow.py`

æµ‹è¯•æ­¥éª¤ï¼š
1. âœ… åˆ›å»ºé‡‡è´­è®¢å•
2. âœ… æäº¤è®¢å•
3. âœ… å®¡æ ¸è®¢å•
4. âœ… ç¡®è®¤è®¢å•
5. âœ… ä¸‹æ¨åˆ°é‡‡è´­å…¥åº“

### MTOæ¨¡å¼å®Œæ•´æµç¨‹

æµ‹è¯•æ–‡ä»¶ï¼š`test_mto_workflow.py`

æµ‹è¯•æ­¥éª¤ï¼š
1. âœ… åˆ›å»ºé”€å”®è®¢å•
2. âœ… å®¡æ ¸è®¢å•
3. âœ… ä¸‹æ¨åˆ°LRPè¿ç®—
4. âœ… ç”Ÿæˆå·¥å•
5. âœ… å·¥å•ä¸‹è¾¾
6. âœ… æŠ¥å·¥
7. âœ… å®Œå·¥å…¥åº“
8. âœ… é”€å”®å‡ºåº“

## ğŸ”§ æµ‹è¯•é…ç½®

### ç¯å¢ƒè¦æ±‚

- Python 3.11+
- PostgreSQLæ•°æ®åº“ï¼ˆæµ‹è¯•ç¯å¢ƒï¼‰
- Redisï¼ˆå¯é€‰ï¼Œç”¨äºç¼“å­˜ï¼‰

### æ•°æ®åº“é…ç½®

æµ‹è¯•ä½¿ç”¨ç‹¬ç«‹çš„æµ‹è¯•æ•°æ®åº“ï¼Œé…ç½®åœ¨ `.env.test` æ–‡ä»¶ä¸­ï¼š

```env
DB_HOST=localhost
DB_PORT=5432
DB_NAME=riveredge_test
DB_USER=postgres
DB_PASSWORD=your_password
```

### æµ‹è¯•æ•°æ®

æµ‹è¯•ä¼šè‡ªåŠ¨åˆ›å»ºä»¥ä¸‹æµ‹è¯•æ•°æ®ï¼š
- æµ‹è¯•ç§Ÿæˆ·
- æµ‹è¯•ç”¨æˆ·
- æµ‹è¯•å®¢æˆ·
- æµ‹è¯•ç‰©æ–™
- ç¼–ç è§„åˆ™

æµ‹è¯•ç»“æŸåä¼šè‡ªåŠ¨æ¸…ç†ï¼ˆè½¯åˆ é™¤ï¼‰ã€‚

## ğŸ“Š æµ‹è¯•ç»“æœè§£è¯»

### æˆåŠŸç¤ºä¾‹

```
[æ­¥éª¤1] åˆ›å»ºé”€å”®è®¢å•...
âœ… è®¢å•åˆ›å»ºæˆåŠŸ: SO202601060001 (ID: 56)
[æ­¥éª¤2] æäº¤è®¢å•...
âœ… è®¢å•æäº¤æˆåŠŸï¼ŒçŠ¶æ€: å¾…å®¡æ ¸
[æ­¥éª¤3] å®¡æ ¸è®¢å•...
âœ… è®¢å•å®¡æ ¸æˆåŠŸï¼ŒçŠ¶æ€: å·²å®¡æ ¸
[æ­¥éª¤5] ä¸‹æ¨åˆ°é”€å”®å‡ºåº“...
âœ… ä¸‹æ¨æˆåŠŸï¼Œå‡ºåº“å•ç¼–ç : SD202601060001
âœ… é”€å”®è®¢å•å®Œæ•´æµç¨‹æµ‹è¯•é€šè¿‡ï¼
```

### å¤±è´¥ç¤ºä¾‹

å¦‚æœæµ‹è¯•å¤±è´¥ï¼Œä¼šæ˜¾ç¤ºè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼š

```
âŒ ä¸‹æ¨é”€å”®å‡ºåº“å¤±è´¥: 500, {"detail": "é”€å”®è®¢å•å·²å…¨éƒ¨å‡ºåº“ï¼Œæ— æ³•å†æ¬¡ç”Ÿæˆå‡ºåº“å•"}
```

## ğŸ› æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

1. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   ```
   é”™è¯¯: æ— æ³•è¿æ¥åˆ°æ•°æ®åº“
   è§£å†³: æ£€æŸ¥æ•°æ®åº“é…ç½®å’Œè¿æ¥ä¿¡æ¯
   ```

2. **è®¤è¯å¤±è´¥**
   ```
   é”™è¯¯: 401 Unauthorized
   è§£å†³: æ£€æŸ¥JWT tokenç”Ÿæˆå’Œç”¨æˆ·æƒé™
   ```

3. **æµ‹è¯•æ•°æ®å†²çª**
   ```
   é”™è¯¯: å”¯ä¸€çº¦æŸå†²çª
   è§£å†³: ç¡®ä¿æµ‹è¯•æ•°æ®ä½¿ç”¨å”¯ä¸€æ ‡è¯†ï¼ˆUUIDã€æ—¶é—´æˆ³ï¼‰
   ```

### è°ƒè¯•æŠ€å·§

```bash
# ä½¿ç”¨è¯¦ç»†è¾“å‡º
uv run pytest tests/e2e/test_*.py -v -s

# è¿›å…¥è°ƒè¯•å™¨
uv run pytest tests/e2e/test_*.py --pdb

# åªè¿è¡Œå¤±è´¥çš„æµ‹è¯•
uv run pytest tests/e2e/test_*.py --lf

# è¿è¡Œç‰¹å®šæ ‡è®°çš„æµ‹è¯•
uv run pytest tests/e2e/test_*.py -m "sales_order"
```

## ğŸ“ˆ æµ‹è¯•è¦†ç›–ç‡

æŸ¥çœ‹æµ‹è¯•è¦†ç›–ç‡ï¼š

```bash
cd riveredge-backend
uv run pytest tests/e2e/ --cov=src --cov-report=html
```

è¦†ç›–ç‡æŠ¥å‘Šä¼šç”Ÿæˆåœ¨ `htmlcov/index.html`ã€‚

## ğŸ”„ CI/CDé›†æˆ

### GitHub Actions

åœ¨ `.github/workflows/e2e-tests.yml` ä¸­é…ç½®ï¼š

```yaml
name: E2E Tests

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  e2e-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      - name: Install dependencies
        run: |
          cd riveredge-backend
          uv sync
      - name: Run E2E tests
        run: |
          cd riveredge-backend
          uv run pytest tests/e2e/ -v --junit-xml=test_results.xml
      - name: Upload test results
        uses: actions/upload-artifact@v3
        if: always()
        with:
          name: test-results
          path: riveredge-backend/test_results.xml
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å…¨æµç¨‹è‡ªåŠ¨åŒ–æµ‹è¯•æ–¹æ¡ˆ](../../../docs/testing/å…¨æµç¨‹è‡ªåŠ¨åŒ–æµ‹è¯•æ–¹æ¡ˆ.md)
- [æµ‹è¯•æœ€ä½³å®è·µ](../../../docs/testing/æµ‹è¯•æœ€ä½³å®è·µ.md)
- [Pytestæ–‡æ¡£](https://docs.pytest.org/)

## ğŸ’¡ æœ€ä½³å®è·µ

1. **æµ‹è¯•ç‹¬ç«‹æ€§**ï¼šæ¯ä¸ªæµ‹è¯•åº”è¯¥ç‹¬ç«‹è¿è¡Œï¼Œä¸ä¾èµ–å…¶ä»–æµ‹è¯•
2. **æ•°æ®æ¸…ç†**ï¼šæµ‹è¯•ç»“æŸåè‡ªåŠ¨æ¸…ç†æµ‹è¯•æ•°æ®
3. **é”™è¯¯å¤„ç†**ï¼šéªŒè¯æ¯ä¸ªæ­¥éª¤çš„è¿”å›çŠ¶æ€ç å’Œé”™è¯¯æ¶ˆæ¯
4. **æ€§èƒ½è€ƒè™‘**ï¼šä½¿ç”¨å¼‚æ­¥æµ‹è¯•æé«˜æ‰§è¡Œé€Ÿåº¦
5. **å¯è¯»æ€§**ï¼šä½¿ç”¨æ¸…æ™°çš„æµ‹è¯•æ­¥éª¤å’ŒéªŒè¯ç‚¹

## ğŸ†˜ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š
1. æŸ¥çœ‹æµ‹è¯•æ—¥å¿—å’Œé”™è¯¯ä¿¡æ¯
2. æ£€æŸ¥æµ‹è¯•æ•°æ®å’Œé…ç½®
3. å‚è€ƒç›¸å…³æ–‡æ¡£
4. æäº¤Issueæˆ–è”ç³»å¼€å‘å›¢é˜Ÿ


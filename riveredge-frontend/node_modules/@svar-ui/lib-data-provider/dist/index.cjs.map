{"version":3,"sources":["../src/ActionQueue.ts","../src/RestDataProvider.ts","../src/DataProvider.ts","../src/RestURL.ts"],"names":["isTempID","EventBus"],"mappings":"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","file":"index.cjs","sourcesContent":["import { DataObj, TID, HandlerConfig, ServerResponse } from \"./types\";\nimport { isTempID } from \"@svar-ui/lib-state\";\n\nconst cantSendYet = Symbol();\n\nexport const SYNC = 0;\nexport const NOTSENT = 1;\nexport const SENDING = 2;\n\ntype TQueueItem = {\n\taction: string;\n\tdata: DataObj;\n\tproc: HandlerConfig;\n\tsent?: boolean;\n};\n\nexport default class ActionQueue {\n\tprivate _awaitAddingQueue: TQueueItem[];\n\tprivate _queue: Record<string, HandlerConfig>;\n\tprivate _idPool: Record<TID, TID>;\n\tprivate _backId: Record<TID, TID>[];\n\tprivate _status: (() => void)[];\n\tprivate _waitPull: Record<TID, ((v: TID) => void)[]>;\n\n\tconstructor() {\n\t\tthis.reset(true);\n\t}\n\n\tpublic reset(ids: boolean = false): void {\n\t\tthis._awaitAddingQueue = [];\n\t\tthis._queue = {};\n\t\tthis._waitPull = {};\n\t\tthis._status = [];\n\t\tif (ids) {\n\t\t\tthis._idPool = {};\n\t\t\tthis._backId = [];\n\t\t}\n\t}\n\n\tpublic resolve(id: TID, type: number): TID {\n\t\tconst col = this._backId[type];\n\t\tif (typeof col === \"undefined\") return id;\n\t\tconst tID = col[id];\n\t\treturn typeof tID === \"undefined\" ? id : tID;\n\t}\n\n\tpublic getSync(): number {\n\t\tconst t = this._awaitAddingQueue;\n\t\tif (!t.length) return SYNC;\n\t\tfor (let i = 0; i < t.length; i++) {\n\t\t\tif (!t[i].sent) return NOTSENT;\n\t\t}\n\t\treturn SENDING;\n\t}\n\n\tpublic waitSync(): Promise<void> {\n\t\treturn new Promise(resolve => {\n\t\t\tif (this.getSync() === SYNC) resolve();\n\t\t\telse this._status.push(resolve);\n\t\t});\n\t}\n\n\tpublic getId(id: TID): TID | null {\n\t\treturn this._idPool[id] || (isTempID(id) ? null : id);\n\t}\n\n\tpublic waitId(id: TID): Promise<TID> {\n\t\treturn new Promise(resolve => {\n\t\t\tconst sid = this.getId(id);\n\t\t\tif (sid !== null) resolve(sid);\n\n\t\t\tconst warr = this._waitPull[id] || [];\n\t\t\twarr.push(resolve);\n\t\t\tthis._waitPull[id] = warr;\n\t\t});\n\t}\n\n\tpublic add(\n\t\taction: string,\n\t\tdata: DataObj,\n\t\tproc: HandlerConfig\n\t): Promise<boolean> {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tproc = { ...proc, resolve, reject };\n\n\t\t\tif (proc.debounce) {\n\t\t\t\tconst qid = `${action}\"/\"${data.id}`;\n\t\t\t\tconst item = this._queue[qid];\n\n\t\t\t\tif (item) {\n\t\t\t\t\tproc.resolve = (v: boolean) => {\n\t\t\t\t\t\titem.resolve(v);\n\t\t\t\t\t\tresolve(v);\n\t\t\t\t\t};\n\t\t\t\t\tproc.reject = e => {\n\t\t\t\t\t\titem.reject(e);\n\t\t\t\t\t\treject();\n\t\t\t\t\t};\n\t\t\t\t\tclearTimeout(item.timer);\n\t\t\t\t}\n\n\t\t\t\tthis._queue[qid] = proc;\n\t\t\t\tproc.timer = setTimeout(() => {\n\t\t\t\t\tthis.tryExec(action, data, proc);\n\t\t\t\t}, proc.debounce);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.tryExec(action, data, proc);\n\t\t});\n\t}\n\n\tpublic tryExec(\n\t\taction: string,\n\t\tdata: DataObj,\n\t\tproc: HandlerConfig,\n\t\tfinish?: () => void\n\t): boolean {\n\t\tconst ready = this.exec(action, data, proc, finish);\n\t\tif (ready === null) {\n\t\t\tif (!finish) this._awaitAddingQueue.push({ action, data, proc });\n\t\t\treturn false;\n\t\t}\n\n\t\tready.then(\n\t\t\t(res: ServerResponse) => {\n\t\t\t\t// response contains new ID\n\t\t\t\tconst check = res && res.id && res.id != data.id && isTempID(data.id);\n\t\t\t\tif (check) {\n\t\t\t\t\t// store id mapping for future use\n\t\t\t\t\tthis._idPool[data.id] = res.id;\n\n\t\t\t\t\t// resolve all new ID waiting promises\n\t\t\t\t\tif (this._waitPull[data.id]) {\n\t\t\t\t\t\tthis._waitPull[data.id].forEach(v => v(res.id));\n\t\t\t\t\t\tdelete this._waitPull[data.id];\n\t\t\t\t\t}\n\n\t\t\t\t\t// store backward reference\n\t\t\t\t\t// unline direct one, we can't use a single object\n\t\t\t\t\t// because while temp ID is unique, real IDs can have the same value fo different types of objects\n\t\t\t\t\tif (proc.kind) {\n\t\t\t\t\t\tlet t = this._backId[proc.kind];\n\t\t\t\t\t\tif (!t) t = this._backId[proc.kind] = {};\n\t\t\t\t\t\tt[res.id] = data.id;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// set response data on event object\n\t\t\t\tdata.response = res;\n\t\t\t\t// resolve the master promise\n\t\t\t\tproc.resolve(true);\n\n\t\t\t\t// check is queue finalized\n\t\t\t\tif (finish) finish();\n\n\t\t\t\t// check, maybe we can run some other queries\n\t\t\t\tif (check) this.execQueue();\n\t\t\t},\n\t\t\te => {\n\t\t\t\t// FIXME - remove from queue\n\t\t\t\tif (finish) finish();\n\t\t\t\tproc.reject(e);\n\t\t\t}\n\t\t);\n\n\t\treturn true;\n\t}\n\tpublic exec(\n\t\taction: string,\n\t\tdata: DataObj,\n\t\tproc: HandlerConfig,\n\t\tfinish?: () => void\n\t): Promise<ServerResponse> | null {\n\t\tconst correctData = this.correctID(data, proc.ignoreID ? data.id : null);\n\t\tif (correctData === cantSendYet) {\n\t\t\treturn null;\n\t\t}\n\n\t\tlet res;\n\t\ttry {\n\t\t\tres = proc.handler(correctData as DataObj, action, data);\n\t\t} catch (e) {\n\t\t\t// FIXME - remove from queue\n\t\t\tfinish();\n\t\t\tproc.reject(e);\n\t\t}\n\n\t\treturn res;\n\t}\n\n\tpublic correctID(obj: DataObj, ignore: TID): DataObj | symbol {\n\t\tlet copy: DataObj = null;\n\t\tfor (const key in obj) {\n\t\t\tconst test = obj[key];\n\t\t\tif (typeof test === \"object\") {\n\t\t\t\tconst after = this.correctID(test, ignore);\n\t\t\t\tif (after !== test) {\n\t\t\t\t\tif (after === cantSendYet) {\n\t\t\t\t\t\treturn cantSendYet;\n\t\t\t\t\t}\n\t\t\t\t\tif (copy === null) {\n\t\t\t\t\t\tcopy = { ...obj };\n\t\t\t\t\t}\n\t\t\t\t\tcopy[key] = after;\n\t\t\t\t}\n\t\t\t} else if (isTempID(test)) {\n\t\t\t\tconst hasRealID = this._idPool[test];\n\t\t\t\tif (hasRealID) {\n\t\t\t\t\tif (copy === null) {\n\t\t\t\t\t\tcopy = { ...obj };\n\t\t\t\t\t}\n\t\t\t\t\tcopy[key] = hasRealID;\n\t\t\t\t} else if (!ignore) {\n\t\t\t\t\treturn cantSendYet;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn copy || obj;\n\t}\n\n\tpublic execQueue(): void {\n\t\t// try to execute all queries from the queue\n\t\tthis._awaitAddingQueue.forEach(a => {\n\t\t\tif (!a.sent) {\n\t\t\t\tconst finish = () => this._finishQueue(a);\n\t\t\t\tif (this.tryExec(a.action, a.data, a.proc, finish)) a.sent = true;\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate _finishQueue(a: TQueueItem): void {\n\t\tthis._awaitAddingQueue = this._awaitAddingQueue.filter(v => v !== a);\n\n\t\t// if queue is empty, resolve all sync waiting promises\n\t\tif (!this._awaitAddingQueue.length && this._status.length) {\n\t\t\tconst temp = [...this._status];\n\t\t\tthis._status = [];\n\t\t\ttemp.forEach(resolve => resolve());\n\t\t}\n\t}\n}\n","import { EventBus } from \"@svar-ui/lib-state\";\nimport ActionQueue from \"./ActionQueue\";\nimport type {\n\tActionMap,\n\tRestDataProviderConfig,\n\tSkipProviderEvent,\n} from \"./types\";\n\nexport default class Rest<T> extends EventBus<T, keyof T> {\n\tprivate _queue: ActionQueue;\n\tprivate _customHeaders: Record<string, string> = {};\n\tprotected _url: string;\n\tprotected _batchUrl?: string;\n\tprivate _batchQueue: Array<{\n\t\turl: string;\n\t\tmethod: string;\n\t\tdata: object;\n\t\tresolve: (value: T) => void;\n\t}> = [];\n\tprivate _batchTimeout: number | null = null;\n\n\tconstructor(url?: string, config?: Partial<RestDataProviderConfig>) {\n\t\tsuper();\n\t\tthis._url = url as string;\n\t\tthis._batchUrl = config?.batchURL;\n\n\t\tthis._queue = new ActionQueue();\n\t\tconst handlers = this.getHandlers();\n\n\t\tfor (const x in handlers) {\n\t\t\tthis.on(x as keyof T, (ev: T[keyof T]) => {\n\t\t\t\tif (!(ev as SkipProviderEvent).skipProvider)\n\t\t\t\t\treturn this._queue.add(x, ev, handlers[x]);\n\t\t\t});\n\t\t}\n\t}\n\n\tgetHandlers(): ActionMap<T> {\n\t\treturn {};\n\t}\n\tsetHeaders(headers: Record<string, string>): void {\n\t\tthis._customHeaders = headers;\n\t}\n\tgetQueue(): ActionQueue {\n\t\treturn this._queue;\n\t}\n\tasync send(\n\t\turl: string,\n\t\tmethod: string,\n\t\tdata?: object,\n\t\tcustomHeaders: Record<string, string> = {}\n\t): Promise<T> {\n\t\tif (this._batchUrl && method !== \"GET\") {\n\t\t\treturn this.sendBatchRequest(url, method, data, customHeaders);\n\t\t} else {\n\t\t\treturn this.sendRequest(url, method, data, customHeaders);\n\t\t}\n\t}\n\n\tprivate async sendBatchRequest(\n\t\turl: string,\n\t\tmethod: string,\n\t\tdata?: object,\n\t\tcustomHeaders?: Record<string, string>\n\t): Promise<T> {\n\t\treturn new Promise<T>(resolve => {\n\t\t\tthis._batchQueue.push({\n\t\t\t\turl,\n\t\t\t\tmethod,\n\t\t\t\tdata,\n\t\t\t\tresolve,\n\t\t\t});\n\n\t\t\tif (this._batchTimeout) {\n\t\t\t\tclearTimeout(this._batchTimeout);\n\t\t\t}\n\n\t\t\tthis._batchTimeout = setTimeout(async () => {\n\t\t\t\tconst currentQueue = [...this._batchQueue];\n\t\t\t\tthis._batchQueue = [];\n\n\t\t\t\tif (currentQueue.length > 1) {\n\t\t\t\t\tconst batchData = currentQueue.map(req => ({\n\t\t\t\t\t\turl: req.url,\n\t\t\t\t\t\tmethod: req.method,\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t...req.data,\n\t\t\t\t\t\t},\n\t\t\t\t\t}));\n\n\t\t\t\t\tconst results = await this.sendRequest<T[]>(\n\t\t\t\t\t\tthis._batchUrl!,\n\t\t\t\t\t\t\"POST\",\n\t\t\t\t\t\tbatchData\n\t\t\t\t\t);\n\n\t\t\t\t\tcurrentQueue.forEach((q, i) => q.resolve(results[i]));\n\t\t\t\t} else {\n\t\t\t\t\tconst result = await this.sendRequest<T>(\n\t\t\t\t\t\turl,\n\t\t\t\t\t\tmethod,\n\t\t\t\t\t\tdata,\n\t\t\t\t\t\tcustomHeaders\n\t\t\t\t\t);\n\t\t\t\t\tresolve(result);\n\t\t\t\t}\n\t\t\t}, 10);\n\t\t});\n\t}\n\n\tprotected toPayload(obj: object): string {\n\t\treturn JSON.stringify(obj);\n\t}\n\n\tprotected async sendRequest<T>(\n\t\turl: string,\n\t\tmethod: string,\n\t\tdata?: string | object,\n\t\tcustomHeaders: Record<string, string> = {}\n\t): Promise<T> {\n\t\tconst headers = {\n\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t...customHeaders,\n\t\t\t...this._customHeaders,\n\t\t};\n\t\tconst req: RequestInit = {\n\t\t\tmethod,\n\t\t\theaders,\n\t\t};\n\n\t\tif (data) {\n\t\t\treq.body = typeof data === \"object\" ? this.toPayload(data) : data;\n\t\t}\n\n\t\tconst slash = this._url.charAt(-1) === \"/\" || url[0] === \"/\" ? \"\" : \"/\";\n\n\t\treturn fetch(`${this._url}${slash}${url || \"\"}`, req).then(res =>\n\t\t\tres.json()\n\t\t);\n\t}\n}\n","import { EventBus } from \"@svar-ui/lib-state\";\nimport ActionQueue from \"./ActionQueue\";\nimport type { DataProviderConfig, SkipProviderEvent } from \"./types\";\n\nexport default class DataProvider<T> extends EventBus<T, keyof T> {\n\tprivate _queue: ActionQueue;\n\n\tconstructor(handlers: DataProviderConfig) {\n\t\tsuper();\n\n\t\tthis._queue = new ActionQueue();\n\t\tfor (const x in handlers) {\n\t\t\tthis.on(x as keyof T, (ev: T[keyof T]) => {\n\t\t\t\tconst handler = handlers[x];\n\t\t\t\tconst pack = typeof handler === \"function\" ? { handler } : handler;\n\t\t\t\tif (!(ev as SkipProviderEvent).skipProvider)\n\t\t\t\t\treturn this._queue.add(x, ev, pack);\n\t\t\t});\n\t\t}\n\t}\n\n\tgetQueue(): ActionQueue {\n\t\treturn this._queue;\n\t}\n}\n","import type { TID } from \"@svar-ui/lib-state\";\nimport { isTempID } from \"@svar-ui/lib-state\";\n\nfunction _addToUrl(url: string, ...parts: TID[]) {\n\tif (!parts.length) return url;\n\n\tparts.forEach(part => {\n\t\tif (typeof part === \"undefined\" || part === null || part === \"\") return;\n\t\tconst pstr = part.toString();\n\t\turl +=\n\t\t\t(url.endsWith(\"/\") ? \"\" : \"/\") +\n\t\t\t(pstr.startsWith(\"/\") ? pstr.slice(1) : encodeURIComponent(pstr));\n\t});\n\n\treturn url;\n}\n\nexport class RestURL<T, R> {\n\tprivate _url: string;\n\tprivate _headers: Record<string, string>;\n\n\tconstructor(url: string, headers?: Record<string, string>) {\n\t\tthis._url = url;\n\t\tthis._headers = headers || {};\n\t}\n\n\tprotected async fetch<X>(\n\t\turl: string,\n\t\tmethod: string,\n\t\theaders: Record<string, string>,\n\t\tdata: T\n\t): Promise<X> {\n\t\tconst response = await fetch(\n\t\t\turl,\n\t\t\tmethod === \"GET\"\n\t\t\t\t? { headers }\n\t\t\t\t: {\n\t\t\t\t\t\tmethod,\n\t\t\t\t\t\theaders,\n\t\t\t\t\t\tbody: data ? JSON.stringify(data) : \"\",\n\t\t\t\t\t}\n\t\t);\n\t\tconst result = await response.json();\n\t\treturn result;\n\t}\n\n\tpath(...parts: TID[]): RestURL<T, R> {\n\t\treturn new RestURL(_addToUrl(this._url, ...parts), this._headers);\n\t}\n\n\theaders(headers: Record<string, string>): RestURL<T, R> {\n\t\treturn new RestURL(this._url, { ...this._headers, ...headers });\n\t}\n\n\tasync get(url?: TID): Promise<T> {\n\t\treturn this.fetch<T>(_addToUrl(this._url, url), \"GET\", this._headers, null);\n\t}\n\n\tasync add(data: T): Promise<R> {\n\t\treturn this.fetch<R>(\n\t\t\tthis._url,\n\t\t\t\"POST\",\n\t\t\t{\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t...this._headers,\n\t\t\t},\n\t\t\tdata\n\t\t);\n\t}\n\n\tasync update(data: T, url?: TID): Promise<R> {\n\t\tif (url && isTempID(url)) return;\n\n\t\treturn this.fetch<R>(\n\t\t\t_addToUrl(this._url, url),\n\t\t\t\"PUT\",\n\t\t\t{\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t...this._headers,\n\t\t\t},\n\t\t\tdata\n\t\t);\n\t}\n\n\tasync delete(url?: TID): Promise<R> {\n\t\tif (url && isTempID(url)) return;\n\n\t\treturn this.fetch<R>(\n\t\t\t_addToUrl(this._url, url),\n\t\t\t\"DELETE\",\n\t\t\tthis._headers,\n\t\t\tnull\n\t\t);\n\t}\n\n\tasync save(action: string, data: T, url?: TID): Promise<R> {\n\t\tswitch (action) {\n\t\t\tcase \"add\": {\n\t\t\t\treturn this.add(data);\n\t\t\t}\n\t\t\tcase \"update\": {\n\t\t\t\treturn this.update(data, url);\n\t\t\t}\n\t\t\tcase \"delete\": {\n\t\t\t\treturn this.delete(url);\n\t\t\t}\n\t\t}\n\t}\n}\n"]}
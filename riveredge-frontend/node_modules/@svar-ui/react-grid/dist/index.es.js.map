{"version":3,"file":"index.es.js","sources":["../src/context.js","../src/helpers/actions/onresize.js","../src/helpers/actions/reorder.js","../src/helpers/actions/dragscroll.js","../src/helpers/columnWidth.js","../src/components/Cell.jsx","../src/helpers/actions/resize.js","../src/components/inlineFilters/Text.jsx","../src/components/inlineFilters/Richselect.jsx","../src/components/inlineFilters/filters.js","../src/components/inlineFilters/Filter.jsx","../src/components/HeaderCell.jsx","../src/components/FooterCell.jsx","../src/components/HeaderFooter.jsx","../src/components/Overlay.jsx","../src/components/inlineEditors/Text.jsx","../src/components/inlineEditors/Combo.jsx","../src/components/inlineEditors/Datepicker.jsx","../src/components/inlineEditors/Richselect.jsx","../src/components/inlineEditors/editors.js","../src/components/inlineEditors/Editor.jsx","../src/components/print/HeaderFooter.jsx","../src/components/print/Grid.jsx","../src/components/print/Print.jsx","../src/components/Layout.jsx","../src/components/Grid.jsx","../src/components/menus/HeaderMenuItem.jsx","../src/components/menus/HeaderMenu.jsx","../src/components/Tooltip.jsx","../src/components/menus/ContextMenu.jsx","../src/components/Toolbar.jsx","../src/themes/Material.jsx","../src/themes/Willow.jsx","../src/themes/WillowDark.jsx","../src/index.js"],"sourcesContent":["import { createContext } from 'react';\n\nconst store = createContext(null);\nexport default store;\n","export function onresize(node, handler) {\n  const ro = new ResizeObserver((data) => {\n    requestAnimationFrame(() => handler(data[0].contentRect));\n  });\n\n  ro.observe(node.parentNode);\n\n  return {\n    destroy() {\n      ro.disconnect();\n    },\n  };\n}\n","import { locate, id } from '@svar-ui/lib-dom';\n\nconst SHIFT = 5;\nconst LONG_TOUCH_DELAY = 700;\n\nfunction getID(node) {\n  return id(node.getAttribute('data-id'));\n}\n\nexport function getOffset(node) {\n  const box = node.getBoundingClientRect();\n  const body = document.body;\n  const top = box.top + body.scrollTop - body.clientTop || 0;\n  const left = box.left + body.scrollLeft - body.clientLeft || 0;\n  return {\n    y: Math.round(top),\n    x: Math.round(left),\n    width: node.offsetWidth,\n    height: node.offsetHeight,\n  };\n}\n\nexport function getPos(ev, node) {\n  const offset = getOffset(node);\n  return { x: ev.clientX - offset.x, y: ev.clientY - offset.y };\n}\n\nexport function reorder(node, config) {\n  const cfg = config.current;\n  let context = null;\n  let touchTimer, startPos;\n  let started = false,\n    touched = false;\n  const container = document.createElement('DIV');\n  container.className = 'wx-drag-zone';\n  container.setAttribute('tabindex', -1);\n\n  function resetTimer() {\n    clearTimeout(touchTimer);\n    touchTimer = null;\n  }\n\n  function down(ev) {\n    const source = locate(ev);\n    if (!source) return;\n\n    context = {\n      container,\n      sourceNode: ev.target,\n      from: getID(source),\n      pos: getPos(ev, node),\n    };\n    startPos = context.pos;\n    move(ev);\n  }\n\n  function move(ev) {\n    if (!context) return;\n    const p = (context.pos = getPos(ev, node));\n\n    if (!started) {\n      if (\n        !touched &&\n        !ev?.target?.getAttribute('draggable-data') &&\n        Math.abs(startPos.x - p.x) < SHIFT &&\n        Math.abs(startPos.y - p.y) < SHIFT\n      )\n        return;\n      else {\n        if (start(ev) === false) return end();\n      }\n    }\n\n    if (touched) {\n      const scrollLeft =\n        window.scrollX ||\n        document.documentElement.scrollLeft ||\n        document.body.scrollLeft;\n      const scrollTop =\n        window.scrollY ||\n        document.documentElement.scrollTop ||\n        document.body.scrollTop;\n\n      context.targetNode = document.elementFromPoint(\n        ev.pageX - scrollLeft,\n        ev.pageY - scrollTop,\n      );\n    } else context.targetNode = ev.target;\n\n    if (cfg.move) cfg.move(ev, context);\n\n    container.style.left = -(context.offset ? context.offset.x : 0) + 'px';\n    container.style.top =\n      context.pos.y + (context.offset ? context.offset.y : 0) + 'px';\n  }\n\n  function up(ev) {\n    if (container.parentNode) container.parentNode.removeChild(container);\n    container.innerHTML = '';\n\n    if (started && cfg.end) cfg.end(ev, context);\n    context = startPos = null;\n\n    end();\n  }\n\n  function handleMouseDown(ev) {\n    if (cfg.getReorder && !cfg.getReorder()) return;\n    if (ev.button !== 0) return;\n\n    // native dragscroll prevention\n    preventUserSelect(ev);\n\n    window.addEventListener('mousemove', handleMouseMove);\n    window.addEventListener('mouseup', handleMouseUp);\n\n    down(ev);\n  }\n\n  function handleMouseMove(ev) {\n    move(ev);\n  }\n\n  function handleMouseUp(ev) {\n    up(ev);\n  }\n\n  function handleTouchStart(ev) {\n    if (cfg.getReorder && !cfg.getReorder()) return;\n\n    touchTimer = setTimeout(() => {\n      touched = true;\n      down(ev.touches[0]);\n    }, LONG_TOUCH_DELAY);\n\n    // prevent user selection on touch (pre-drag)\n    preventUserSelect(ev);\n\n    function handleTouchEnd() {\n      if (touchTimer) resetTimer();\n\n      // removed elements will still have touch events pointed at them, and these events won't necessarily bubble up\n      // this creates an issue where the touchmove/touchend events are no longer called if we attach them directly to the parent node, and the event target is removed from DOM\n      // best practice suggests attaching event handlers directly to the touch event target\n      // in this case, touch events will continue to fire normally\n      // https://developer.mozilla.org/en-US/docs/Web/API/Touch/target\n\n      ev.target.removeEventListener('touchmove', handleTouchMove);\n      ev.target.removeEventListener('touchend', handleTouchEnd);\n\n      up(ev);\n    }\n\n    ev.target.addEventListener('touchmove', handleTouchMove);\n    ev.target.addEventListener('touchend', handleTouchEnd);\n    node.addEventListener('contextmenu', handleContext);\n  }\n\n  function handleTouchMove(ev) {\n    if (started) {\n      ev.preventDefault();\n      move(ev.touches[0]);\n    } else if (touchTimer) resetTimer();\n  }\n\n  function handleContext(ev) {\n    if (started || touchTimer) {\n      ev.preventDefault();\n      return false;\n    }\n  }\n\n  function preventDefault(ev) {\n    ev.preventDefault();\n  }\n\n  function preventUserSelect(ev) {\n    if (!cfg.getDraggableInfo) return;\n    const { hasDraggable } = cfg.getDraggableInfo();\n\n    if (!hasDraggable || ev.target.getAttribute('draggable-data')) {\n      document.body.style.userSelect = 'none';\n      document.body.style.webkitUserSelect = 'none';\n    }\n  }\n\n  function start(ev) {\n    started = true;\n\n    if (cfg.start) {\n      if (cfg.start(ev, context) === false) return false;\n      else {\n        node.appendChild(container);\n        document.body.style.cursor = 'move';\n      }\n    }\n  }\n\n  function end(full) {\n    started = touched = false;\n    document.body.style.cursor = '';\n    document.body.style.userSelect = '';\n    document.body.style.webkitUserSelect = '';\n\n    window.removeEventListener('mousemove', handleMouseMove);\n    window.removeEventListener('mouseup', handleMouseUp);\n\n    if (full) {\n      node.removeEventListener('mousedown', handleMouseDown);\n      node.removeEventListener('touchstart', handleTouchStart);\n      node.removeEventListener('dragstart', preventDefault);\n    }\n  }\n\n  node.addEventListener('mousedown', handleMouseDown);\n  node.addEventListener('touchstart', handleTouchStart);\n  node.addEventListener('dragstart', preventDefault);\n\n  return {\n    destroy() {\n      end(true);\n    },\n  };\n}\n","import { getPos } from './reorder';\n\nconst SCROLL_SPEED_DELTA = 0.004;\n\nfunction initScrollState() {\n  return {\n    dirX: 0,\n    dirY: 0,\n    scrollSpeedFactor: 1,\n  };\n}\n\nexport function tryAutoScroll(ev, box, context, dragScrollConfig) {\n  const { node, left, top, bottom, sense, xScroll, yScroll } = dragScrollConfig;\n  const rPos = getPos(ev, node);\n\n  if (!context.scrollState) context.scrollState = initScrollState();\n\n  let newDirX = 0;\n  let newDirY = 0;\n\n  if (rPos.x < left + sense) {\n    newDirX = -1;\n  } else if (rPos.x > box.width - sense) {\n    newDirX = 1;\n  }\n\n  if (rPos.y < top + Math.round(sense / 2)) {\n    newDirY = -1;\n  } else if (rPos.y > box.height - bottom - Math.round(sense / 2)) {\n    newDirY = 1;\n  }\n\n  if (\n    context.scrollState.dirX !== newDirX ||\n    context.scrollState.dirY !== newDirY\n  ) {\n    resetAutoScroll(context);\n    context.scrollState.dirX = newDirX;\n    context.scrollState.dirY = newDirY;\n  }\n\n  if (\n    (xScroll && context.scrollState.dirX !== 0) ||\n    (yScroll && context.scrollState.dirY !== 0)\n  ) {\n    startAutoScroll(context, dragScrollConfig, {\n      x: context.scrollState.dirX,\n      y: context.scrollState.dirY,\n    });\n  }\n}\n\nexport function startAutoScroll(context, config, dir) {\n  if (context.autoScrollTimer) return;\n\n  context.autoScrollTimer = setTimeout(() => {\n    context.activeAutoScroll = setInterval(\n      autoScroll,\n      15,\n      context,\n      config,\n      dir,\n    );\n  }, 250);\n}\n\nexport function resetAutoScroll(context) {\n  context.scrollSpeedFactor = 1;\n  if (context.autoScrollTimer) {\n    context.autoScrollTimer = clearTimeout(context.autoScrollTimer);\n    context.activeAutoScroll = clearInterval(context.activeAutoScroll);\n  }\n}\n\nfunction autoScroll(context, config, dir) {\n  const { x, y } = dir;\n\n  context.scrollSpeedFactor += SCROLL_SPEED_DELTA;\n\n  if (x !== 0) autoXScroll(context, config, x);\n  if (y !== 0) autoYScroll(context, config, y);\n}\n\nfunction autoYScroll(context, config, dir) {\n  const scroll = config.node.scrollTop;\n\n  autoScrollTo(\n    scroll + Math.round(config.sense / 3) * context.scrollSpeedFactor * dir,\n    'scrollTop',\n    config,\n  );\n}\n\nfunction autoXScroll(context, config, dir) {\n  const scroll = config.node.scrollLeft;\n\n  autoScrollTo(\n    scroll + Math.round(config.sense / 3) * context.scrollSpeedFactor * dir,\n    'scrollLeft',\n    config,\n  );\n}\n\nfunction autoScrollTo(value, mode, config) {\n  config.node[mode] = value;\n}\n","export function getStyle(width, flexgrow, fixed, left, right, height) {\n  const style = {};\n\n  if (width) {\n    style.width = `${width}px`;\n    style.minWidth = `${width}px`;\n  }\n\n  if (flexgrow) {\n    style.flexGrow = flexgrow;\n  }\n\n  if (height) {\n    style.height = `${height}px`;\n  }\n\n  if (fixed) {\n    style.position = 'sticky';\n    if (fixed.left) {\n      style.left = `${left}px`;\n    }\n    if (fixed.right) {\n      style.right = `${right}px`;\n    }\n  }\n\n  return style;\n}\n\nexport function getCssName(column, cell, columnStyle) {\n  let css = '';\n\n  if (column.fixed) {\n    for (const pos in column.fixed) {\n      css += column.fixed[pos] === -1 ? 'wx-shadow ' : 'wx-fixed ';\n    }\n  }\n  css += cell.rowspan > 1 ? 'wx-rowspan ' : '';\n  css += cell.colspan > 1 ? 'wx-colspan ' : '';\n  css += cell.vertical ? 'wx-vertical ' : '';\n  css += columnStyle ? columnStyle(column) + ' ' : '';\n  return css;\n}\n","import { useEffect, useMemo, useRef, useContext, useCallback } from 'react';\nimport storeContext from '../context';\nimport { useStore } from '@svar-ui/lib-react';\nimport { useWritableProp } from '@svar-ui/lib-react';\nimport { getStyle } from '../helpers/columnWidth';\nimport { getRenderValue } from '@svar-ui/grid-store';\nimport './Cell.css';\n\nexport default function Cell(props) {\n  const {\n    row,\n    column,\n    cellStyle = null,\n    columnStyle = null,\n    children,\n  } = props;\n\n  const [focusable, setFocusable] = useWritableProp(props.focusable);\n\n  const api = useContext(storeContext);\n  const focusCell = useStore(api, 'focusCell');\n  const search = useStore(api, 'search');\n  const reorder = useStore(api, 'reorder');\n\n  const shouldHighlight = useMemo(\n    () => search?.rows[row.id] && search.rows[row.id][column.id],\n    [search, row.id, column.id],\n  );\n\n  const style = useMemo(\n    () =>\n      getStyle(\n        column.width,\n        column.flexgrow,\n        column.fixed,\n        column.left,\n        column.right,\n      ),\n    [column.width, column.flexgrow, column.fixed, column.left, column.right],\n  );\n\n  function buildCellCss(columnStyleFn, cellStyleFn) {\n    let css = 'wx-cell';\n    css += column.fixed\n      ? ' ' + (column.fixed === -1 ? 'wx-shadow' : 'wx-fixed')\n      : '';\n    css += columnStyleFn ? ' ' + columnStyleFn(column) : '';\n    css += cellStyleFn ? ' ' + cellStyleFn(row, column) : '';\n    css += column.treetoggle ? ' wx-tree-cell' : '';\n    return css;\n  }\n\n  const css = useMemo(\n    () => buildCellCss(columnStyle, cellStyle),\n    [columnStyle, cellStyle, column, row],\n  );\n\n  const isDraggable = useMemo(() => {\n    return typeof column.draggable === 'function'\n      ? column.draggable(row, column) !== false\n      : column.draggable;\n  }, [column, row]);\n\n  const cellElRef = useRef(null);\n\n  useEffect(() => {\n    if (cellElRef.current && focusable) {\n      const needFocus =\n        focusCell?.row === row.id && focusCell?.column === column.id;\n      if (needFocus) cellElRef.current.focus();\n    }\n  }, [focusCell, focusable, row.id, column.id]);\n\n  const toggleFocusAction = useCallback(() => {\n    if (focusable && !focusCell) {\n      api.exec('focus-cell', {\n        row: row.id,\n        column: column.id,\n        eventSource: 'focus',\n      });\n    }\n  }, [api, focusable, focusCell, row.id, column.id]);\n\n  useEffect(() => {\n    return () => {\n      if (focusable && focusCell) {\n        api.exec('focus-cell', { eventSource: 'destroy' });\n        setFocusable(false);\n      }\n    };\n  }, [api, setFocusable]);\n\n  function highlightText(text) {\n    const regex = new RegExp(`(${search.value.trim()})`, 'gi');\n    const parts = String(text).split(regex);\n\n    return parts.map((text) => ({ text, highlight: regex.test(text) }));\n  }\n\n  const className = useMemo(() => {\n    const shadowToggle =\n      (column.fixed && column.fixed.left === -1) || column.fixed.right === -1;\n    const fixedRightToggle = column.fixed && column.fixed.right;\n    return [\n      css,\n      shadowToggle ? 'wx-shadow' : '',\n      fixedRightToggle ? 'wx-fixed-right' : '',\n    ]\n      .filter(Boolean)\n      .join(' ');\n  }, [css, column]);\n\n  const CellComponent = column.cell;\n\n  return (\n    <div\n      className={'wx-TSCaXsGV ' + className}\n      ref={cellElRef}\n      onFocus={toggleFocusAction}\n      style={style}\n      data-row-id={row.id}\n      data-col-id={column.id}\n      tabIndex={focusable ? '0' : '-1'}\n      role={'gridcell'}\n      aria-colindex={column._colindex}\n      aria-readonly={!column.editor ? true : undefined}\n    >\n      {reorder && column.draggable ? (\n        isDraggable ? (\n          <i\n            // eslint-disable-next-line react/no-unknown-property\n            draggable-data=\"true\"\n            className=\"wx-TSCaXsGV wx-draggable wxi-drag\"\n          ></i>\n        ) : (\n          <i className=\"wx-TSCaXsGV wx-draggable-stub\"></i>\n        )\n      ) : null}\n\n      {column.treetoggle ? (\n        <>\n          <span style={{ marginLeft: `${row.$level * 28}px` }}></span>\n          {row.$count ? (\n            <i\n              data-action=\"toggle-row\"\n              className={`wx-TSCaXsGV wx-table-tree-toggle wxi-menu-${\n                row.open !== false ? 'down' : 'right'\n              }`}\n            ></i>\n          ) : null}\n        </>\n      ) : null}\n\n      {CellComponent ? (\n        <CellComponent\n          api={api}\n          row={row}\n          column={column}\n          onAction={({ action, data }) => api.exec(action, data)}\n        />\n      ) : children ? (\n        children()\n      ) : shouldHighlight ? (\n        <span>\n          {highlightText(getRenderValue(row, column)).map(\n            ({ highlight, text }, index) =>\n              highlight ? (\n                <mark key={index} className=\"wx-TSCaXsGV wx-search\">\n                  {text}\n                </mark>\n              ) : (\n                <span key={index}>{text}</span>\n              ),\n          )}\n        </span>\n      ) : (\n        getRenderValue(row, column)\n      )}\n    </div>\n  );\n}\n","export function resize(node, config) {\n  let x, dx;\n\n  function down(ev) {\n    x = ev.clientX;\n\n    node.style.opacity = 1;\n\n    document.body.style.cursor = 'ew-resize';\n    document.body.style.userSelect = 'none';\n\n    window.addEventListener('mousemove', move);\n    window.addEventListener('mouseup', up);\n\n    if (config && config.down) config.down(node);\n  }\n\n  function move(ev) {\n    dx = ev.clientX - x;\n\n    if (config && config.move) config.move(dx);\n  }\n\n  function up() {\n    node.style.opacity = '';\n\n    document.body.style.cursor = '';\n    document.body.style.userSelect = '';\n\n    if (config && config.up) config.up(dx);\n\n    window.removeEventListener('mousemove', move);\n    window.removeEventListener('mouseup', up);\n  }\n\n  node.addEventListener('mousedown', down);\n\n  return {\n    destroy() {\n      node.removeEventListener('mousedown', down);\n    },\n  };\n}\n","import { Text } from '@svar-ui/react-core';\nimport './Text.css';\n\nexport default function Component({ filter, column, action, filterValue }) {\n  function filterRows({ value }) {\n    action({ value, key: column.id });\n  }\n\n  return (\n    <Text\n      {...(filter.config ?? {})}\n      value={filterValue}\n      onChange={filterRows}\n    />\n  );\n}\n","import { useMemo, useContext } from 'react';\nimport { RichSelect } from '@svar-ui/react-core';\nimport { getValue } from '@svar-ui/grid-store';\nimport storeContext from '../../context';\nimport { useStore } from '@svar-ui/lib-react';\nimport './Richselect.css';\n\nexport default function Richselect({ filter, column, action, filterValue }) {\n  const api = useContext(storeContext);\n  const data = useStore(api, 'flatData');\n\n  const options = useMemo(\n    () => filter?.config?.options || column?.options || getOptions(data),\n    [filter, column, data],\n  );\n\n  const template = useMemo(() => filter?.config?.template, [filter]);\n\n  function getOptions() {\n    const options = [];\n    data.forEach((d) => {\n      const value = getValue(d, column);\n      if (!options.includes(value)) options.push(value);\n    });\n    return options.map((opt) => ({ id: opt, label: opt }));\n  }\n\n  function filterRows({ value }) {\n    action({ value, key: column.id });\n  }\n\n  function handleKeyDown(ev) {\n    if (ev.key !== 'Tab') ev.preventDefault();\n  }\n\n  return (\n    <div style={{ width: '100%' }} onKeyDown={handleKeyDown}>\n      <RichSelect\n        placeholder={''}\n        clear={true}\n        {...(filter?.config ?? {})}\n        options={options}\n        value={filterValue}\n        onChange={filterRows}\n      >\n        {(option) => (template ? template(option) : option.label)}\n      </RichSelect>\n    </div>\n  );\n}\n","import Text from './Text.jsx';\nimport Richselect from './Richselect.jsx';\n\nexport const filters = {\n  text: Text,\n  richselect: Richselect,\n};\n","import { useContext, useMemo } from 'react';\nimport storeContext from '../../context';\nimport { filters } from './filters';\nimport { useStore } from '@svar-ui/lib-react';\n\nexport default function Filter({ filter, column }) {\n  const api = useContext(storeContext);\n  const filterValues = useStore(api, 'filterValues');\n\n  function filterRows(data) {\n    api.exec('filter-rows', data);\n  }\n\n  const Component = useMemo(() => filters[filter.type], [filter.type]);\n\n  return (\n    <Component\n      filter={filter}\n      column={column}\n      action={filterRows}\n      filterValue={filterValues[column.id]}\n    />\n  );\n}\n","import { useEffect, useMemo, useCallback, useRef, useContext } from 'react';\nimport storeContext from '../context';\nimport { useStore } from '@svar-ui/lib-react';\nimport { resize } from '../helpers/actions/resize';\nimport { getCssName, getStyle } from '../helpers/columnWidth';\nimport Filter from './inlineFilters/Filter.jsx';\nimport './HeaderCell.css';\n\nexport default function HeaderCell(props) {\n  const {\n    cell,\n    column,\n    row,\n    lastRow,\n    sortRow,\n    columnStyle,\n    bodyHeight,\n    hasSplit,\n  } = props;\n\n  const api = useContext(storeContext);\n  const sortMarksValue = useStore(api, 'sortMarks');\n\n  const sortMark = useMemo(() => {\n    return sortMarksValue ? sortMarksValue[column.id] : undefined;\n  }, [sortMarksValue, column.id]);\n\n  const startRef = useRef();\n\n  const down = useCallback(\n    (node) => {\n      startRef.current = cell.flexgrow\n        ? node.parentNode.clientWidth\n        : cell.width;\n    },\n    [cell.flexgrow, cell.width],\n  );\n\n  const resizeColumn = useCallback(\n    (dx, inProgress) => {\n      api.exec('resize-column', {\n        id: cell.id,\n        width: Math.max(1, (startRef.current || 0) + dx),\n        inProgress,\n      });\n    },\n    [api, cell.id],\n  );\n\n  const move = useCallback((dx) => resizeColumn(dx, true), [resizeColumn]);\n  const up = useCallback((dx) => resizeColumn(dx, false), [resizeColumn]);\n\n  const sort = useCallback(\n    (ev) => {\n      if (!column.sort || cell.filter) return;\n      let order = sortMark?.order;\n      if (order) {\n        order = order === 'asc' ? 'desc' : 'asc';\n      }\n      api.exec('sort-rows', { key: cell.id, add: ev.ctrlKey, order });\n    },\n    [api, cell.id, cell.filter, column.sort, sortMark?.order],\n  );\n\n  const collapse = useCallback(\n    (ev) => {\n      if (ev) ev.stopPropagation();\n      api.exec('collapse-column', { id: cell.id, row });\n    },\n    [api, cell.id, row],\n  );\n\n  const toggleCollapseColumn = useCallback(\n    (ev) => {\n      if (ev.key === 'Enter') collapse();\n    },\n    [collapse],\n  );\n\n  const toggleSortColumn = useCallback(\n    (ev) => {\n      if (ev.key === 'Enter' && !cell.filter) sort(ev);\n    },\n    [sort, cell.filter],\n  );\n\n  const isCollapsed = useMemo(\n    () => cell.collapsed && column.collapsed,\n    [cell.collapsed, column.collapsed],\n  );\n  const overlay = useMemo(\n    () => isCollapsed && !hasSplit && cell.collapsible !== 'header',\n    [isCollapsed, hasSplit, cell.collapsible],\n  );\n  const collapsedTextStyle = useMemo(\n    () => (overlay ? { top: -bodyHeight / 2, position: 'absolute' } : {}),\n    [overlay, bodyHeight],\n  );\n\n  const cellStyle = useMemo(\n    () =>\n      getStyle(\n        cell.width,\n        cell.flexgrow,\n        column.fixed,\n        column.left,\n        cell.right ?? column.right,\n        cell.height + (isCollapsed && overlay ? bodyHeight : 0),\n      ),\n    [\n      cell.width,\n      cell.flexgrow,\n      column.fixed,\n      column.left,\n      cell.right,\n      column.right,\n      cell.height,\n      isCollapsed,\n      overlay,\n      bodyHeight,\n    ],\n  );\n\n  const css = useMemo(\n    () => getCssName(column, cell, columnStyle),\n    [column, cell, columnStyle],\n  );\n\n  const getCell = useCallback(() => {\n    return Object.fromEntries(\n      Object.entries(cell).filter(([key]) => key !== 'cell'),\n    );\n  }, [cell]);\n\n  const collapsedClassName = `wx-cell ${css} ${cell.css || ''} wx-collapsed`;\n  const normalClassName = [\n    'wx-cell',\n    css,\n    cell.css || '',\n    cell.filter ? 'wx-filter' : '',\n    column.fixed && column.fixed.right ? 'wx-fixed-right' : '',\n  ]\n    .filter(Boolean)\n    .join(' ');\n\n  const gripRef = useRef(null);\n  useEffect(() => {\n    const node = gripRef.current;\n    if (!node) return;\n    const cleanup = resize(node, { down, move, up });\n    return () => {\n      if (typeof cleanup === 'function') cleanup();\n    };\n  }, [down, move, up, resize]);\n\n  if (isCollapsed) {\n    return (\n      <div\n        className={'wx-RsQD74qC ' + collapsedClassName}\n        style={cellStyle}\n        role=\"button\"\n        aria-label={`Expand column ${cell.text || ''}`}\n        aria-expanded={!cell.collapsed}\n        tabIndex={0}\n        onKeyDown={toggleCollapseColumn}\n        onClick={collapse}\n        data-header-id={column.id}\n      >\n        <div className=\"wx-RsQD74qC wx-text\" style={collapsedTextStyle}>\n          {cell.text || ''}\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div\n      className={'wx-RsQD74qC ' + normalClassName}\n      style={cellStyle}\n      onClick={sort}\n      data-header-id={column.id}\n      tabIndex={!cell._hidden && column.sort && !cell.filter ? 0 : undefined}\n      role=\"columnheader\"\n      aria-colindex={cell._colindex}\n      aria-colspan={cell.colspan > 1 ? cell.colspan : undefined}\n      aria-rowspan={cell.rowspan > 1 ? cell.rowspan : undefined}\n      aria-sort={\n        !sortMark?.order || cell.filter\n          ? 'none'\n          : sortMark?.order === 'asc'\n            ? 'ascending'\n            : 'descending'\n      }\n      onKeyDown={toggleSortColumn}\n    >\n      {cell.collapsible ? (\n        <div\n          className=\"wx-RsQD74qC wx-collapse\"\n          role=\"button\"\n          aria-label={cell.collapsed ? 'Expand column' : 'Collapse column'}\n          aria-expanded={!cell.collapsed}\n          tabIndex={0}\n          onKeyDown={toggleCollapseColumn}\n          onClick={collapse}\n        >\n          <i\n            className={`wx-RsQD74qC wxi-angle-${cell.collapsed ? 'down' : 'right'}`}\n          ></i>\n        </div>\n      ) : null}\n\n      {cell.cell ? (\n        (() => {\n          const CellComponent = cell.cell;\n          return (\n            <CellComponent\n              api={api}\n              cell={getCell()}\n              column={column}\n              row={row}\n              onAction={({ action, data }) => api.exec(action, data)}\n            />\n          );\n        })()\n      ) : cell.filter ? (\n        <Filter filter={cell.filter} column={column} />\n      ) : (\n        <div className=\"wx-RsQD74qC wx-text\">{cell.text || ''}</div>\n      )}\n\n      {column.resize && lastRow && !cell._hidden ? (\n        <div\n          className=\"wx-RsQD74qC wx-grip\"\n          role=\"presentation\"\n          aria-label=\"Resize column\"\n          ref={gripRef}\n          onClick={(ev) => ev.stopPropagation()}\n        >\n          <div></div>\n        </div>\n      ) : null}\n\n      {sortRow ? (\n        <div className=\"wx-RsQD74qC wx-sort\">\n          {sortMark ? (\n            <>\n              {typeof sortMark.index !== 'undefined' ? (\n                <div className=\"wx-RsQD74qC wx-order\">{sortMark.index + 1}</div>\n              ) : null}\n              <i\n                className={`wx-RsQD74qC wxi-arrow-${sortMark.order === 'asc' ? 'up' : 'down'}`}\n              ></i>\n            </>\n          ) : null}\n        </div>\n      ) : null}\n    </div>\n  );\n}\n","import React, { useMemo, useContext, useCallback } from 'react';\nimport storeContext from '../context';\nimport { getStyle, getCssName } from '../helpers/columnWidth';\nimport './FooterCell.css';\n\nfunction FooterCell({ cell, column, row, columnStyle }) {\n  const api = useContext(storeContext);\n\n  const style = useMemo(\n    () =>\n      getStyle(\n        cell?.width,\n        cell?.flexgrow,\n        column?.fixed,\n        column?.left,\n        cell?.right ?? column?.right,\n        cell?.height,\n      ),\n    [\n      cell?.width,\n      cell?.flexgrow,\n      column?.fixed,\n      column?.left,\n      cell?.right,\n      column?.right,\n      cell?.height,\n    ],\n  );\n\n  const css = useMemo(\n    () => getCssName(column, cell, columnStyle),\n    [column, cell, columnStyle],\n  );\n\n  const getCell = useCallback(() => {\n    return Object.fromEntries(\n      Object.entries(cell || {}).filter(([key]) => key !== 'cell'),\n    );\n  }, [cell]);\n\n  const className =\n    `wx-6Sdi3Dfd wx-cell ${css || ''} ${cell?.css || ''}` +\n    (column?.fixed && column?.fixed.right ? ' wx-fixed-right' : '');\n\n  return (\n    <div className={className} style={style}>\n      {!column?.collapsed && !cell?.collapsed ? (\n        cell?.cell ? (\n          React.createElement(cell.cell, {\n            api,\n            cell: getCell(),\n            column,\n            row,\n            onAction: ({ action, data }) => api.exec(action, data),\n          })\n        ) : (\n          <div className=\"wx-6Sdi3Dfd wx-text\">{cell?.text || ''}</div>\n        )\n      ) : null}\n    </div>\n  );\n}\n\nexport default FooterCell;\n","import { useMemo, useContext } from 'react';\nimport HeaderCell from './HeaderCell.jsx';\nimport FooterCell from './FooterCell.jsx';\nimport { isCommunity } from '@svar-ui/grid-store';\nimport storeContext from '../context';\nimport './HeaderFooter.css';\nimport { useStore } from '@svar-ui/lib-react';\n\nfunction HeaderFooter({\n  deltaLeft,\n  contentWidth,\n  columns,\n  type = 'header',\n  columnStyle,\n  bodyHeight,\n}) {\n  const api = useContext(storeContext);\n  const sizes = useStore(api, '_sizes');\n  const split = useStore(api, 'split');\n\n  const rowHeights = useMemo(() => {\n    return sizes?.[`${type}RowHeights`];\n  }, [sizes, type]);\n\n  const renderedHeader = useMemo(() => {\n    let res = [];\n    if (columns && columns.length) {\n      const rowsCount = columns[0][type].length;\n      for (let ri = 0; ri < rowsCount; ri++) {\n        let inSpan = 0;\n        res.push([]);\n        columns.forEach((col, ci) => {\n          const cell = { ...col[type][ri] };\n          if (!inSpan) {\n            res[ri].push(cell);\n          }\n\n          if (cell.colspan > 1) {\n            inSpan = cell.colspan - 1;\n\n            if (!isCommunity()) {\n              if (col.right) {\n                // if column is fixed on the right and have colspan we need to recalculate right position\n                let right = col.right;\n                for (let i = 1; i < cell.colspan; i++) {\n                  right -= columns[ci + i].width;\n                }\n                cell.right = right;\n              }\n            }\n          } else if (inSpan) {\n            inSpan--;\n          }\n        });\n      }\n    }\n    return res;\n  }, [columns, type]);\n\n  const hasSplit = useMemo(() => {\n    return split?.left || split?.right;\n  }, [split]);\n\n  function getColumn(id) {\n    return columns.find((c) => c.id === id);\n  }\n\n  function isLast(cell, ind) {\n    let idx = ind;\n    if (cell.rowspan) idx += cell.rowspan - 1;\n    return idx === renderedHeader.length - 1;\n  }\n\n  function isSort(cell, ind, column) {\n    if (!column.sort) return false;\n    for (let i = renderedHeader.length - 1; i >= 0; i--) {\n      const cell = column.header[i];\n      if (!cell.filter && !cell._hidden) return ind === i;\n    }\n    return isLast(cell, ind);\n  }\n\n  return (\n    <div\n      className={`wx-sAsPVaUK wx-${type}`}\n      style={{ paddingLeft: `${deltaLeft}px`, width: `${contentWidth}px` }}\n      role=\"rowgroup\"\n    >\n      {renderedHeader.map((row, i) => (\n        <div\n          key={i}\n          className={\n            type === 'header' ? 'wx-sAsPVaUK wx-h-row' : 'wx-sAsPVaUK wx-f-row'\n          }\n          style={{ height: `${rowHeights?.[i]}px`, display: 'flex' }}\n          role=\"row\"\n        >\n          {row.map((cell) => {\n            const column = getColumn(cell.id);\n            return type === 'header' ? (\n              <HeaderCell\n                key={cell.id}\n                cell={cell}\n                columnStyle={columnStyle}\n                column={column}\n                row={i}\n                lastRow={isLast(cell, i)}\n                bodyHeight={bodyHeight}\n                sortRow={isSort(cell, i, column)}\n                hasSplit={hasSplit}\n              />\n            ) : (\n              <FooterCell\n                key={cell.id}\n                cell={cell}\n                columnStyle={columnStyle}\n                column={getColumn(cell.id)}\n                row={i}\n              />\n            );\n          })}\n        </div>\n      ))}\n    </div>\n  );\n}\n\nexport default HeaderFooter;\n","import { useContext } from 'react';\nimport storeContext from '../context';\nimport './Overlay.css';\n\nexport default function Overlay({ overlay }) {\n  const api = useContext(storeContext);\n\n  function isComponent(prop) {\n    return typeof prop === 'function';\n  }\n\n  const Component = overlay;\n\n  return (\n    <div className=\"wx-1ty666CQ wx-overlay\">\n      {isComponent(overlay) ? (\n        <Component onAction={({ action, data }) => api.exec(action, data)} />\n      ) : (\n        overlay\n      )}\n    </div>\n  );\n}\n","import { useEffect, useRef, useState } from 'react';\nimport './Text.css';\n\nfunction Text(props) {\n  const { actions, editor } = props;\n\n  const [value, setValue] = useState(editor?.value || '');\n\n  const node = useRef(null);\n  useEffect(() => {\n    if (node.current) node.current.focus();\n  }, []);\n\n  function updateValue() {\n    if (!node.current) return;\n    setValue(node.current.value);\n    actions.updateValue(node.current.value);\n  }\n\n  function closeAndSave({ key }) {\n    if (key === 'Enter') actions.save();\n  }\n\n  return (\n    <input\n      className=\"wx-e7Ao5ejY wx-text\"\n      onInput={updateValue}\n      onKeyDown={closeAndSave}\n      ref={node}\n      type=\"text\"\n      value={value}\n    />\n  );\n}\n\nexport default Text;\n","import { useState, useEffect, useMemo, useRef, useCallback } from 'react';\nimport { SuggestDropdown } from '@svar-ui/react-core';\nimport './Combo.css';\n\nfunction Combo({ actions, editor, onAction }) {\n  const [value, setValue] = useState(editor?.value);\n  const [text, setText] = useState(editor?.renderedValue);\n  const [filterOptions, setFilterOptions] = useState(editor?.options || []);\n  const template = useMemo(() => editor?.config?.template, [editor]);\n  const cell = useMemo(() => editor?.config?.cell, [editor]);\n\n  const index = useMemo(() => {\n    return (filterOptions || []).findIndex((a) => a.id === value);\n  }, [filterOptions, value]);\n\n  const navigate = useRef(null);\n  const keydown = useRef(null);\n\n  const ready = useCallback(\n    (ev) => {\n      navigate.current = ev.navigate;\n      keydown.current = ev.keydown;\n      navigate.current(index);\n    },\n    [index, navigate],\n  );\n\n  const handleChange = useCallback(\n    (e) => {\n      const nextText = e?.target?.value ?? '';\n      setText(nextText);\n\n      const options = nextText\n        ? (editor?.options || []).filter((i) =>\n            (i.label || '').toLowerCase().includes(nextText.toLowerCase()),\n          )\n        : editor?.options || [];\n      setFilterOptions(options);\n\n      if (options.length) navigate.current(-Infinity);\n      else navigate.current(null);\n    },\n    [editor],\n  );\n\n  const inputRef = useRef(null);\n  useEffect(() => {\n    if (inputRef.current) {\n      inputRef.current.focus();\n    }\n  }, []);\n\n  useEffect(() => {\n    setValue(editor?.value);\n    setText(editor?.renderedValue);\n    setFilterOptions(editor?.options || []);\n  }, [editor]);\n\n  const updateValue = useCallback(\n    ({ id }) => {\n      actions.updateValue(id);\n      actions.save();\n    },\n    [actions],\n  );\n\n  return (\n    <>\n      <input\n        className=\"wx-0UYfSd1x wx-input\"\n        ref={inputRef}\n        value={text ?? ''}\n        onChange={handleChange}\n        onKeyDown={(e) =>\n          keydown.current ? keydown.current(e, index) : undefined\n        }\n      />\n      <SuggestDropdown\n        items={filterOptions}\n        onReady={ready}\n        onSelect={updateValue}\n      >\n        {({ option }) => {\n          if (template) {\n            return template(option);\n          } else if (cell) {\n            const Component = cell;\n            return <Component data={option} onAction={onAction} />;\n          } else {\n            return option.label;\n          }\n        }}\n      </SuggestDropdown>\n    </>\n  );\n}\n\nexport default Combo;\n","import { useEffect, useRef, useState } from 'react';\nimport { Calendar, Dropdown } from '@svar-ui/react-core';\nimport './Datepicker.css';\n\nexport default function Datepicker({ actions, editor, onAction }) {\n  const [value] = useState(() => editor.value || new Date());\n  const [template] = useState(() => editor.config?.template);\n  const [cell] = useState(() => editor.config?.cell);\n\n  function updateValue({ value }) {\n    actions.updateValue(value);\n    actions.save();\n  }\n\n  const nodeRef = useRef(null);\n\n  useEffect(() => {\n    if (nodeRef.current) {\n      nodeRef.current.focus();\n    }\n    if (typeof window !== 'undefined' && window.getSelection) {\n      window.getSelection().removeAllRanges();\n    }\n  }, []);\n\n  return (\n    <>\n      <div\n        className=\"wx-lNWNYUb6 wx-value\"\n        ref={nodeRef}\n        tabIndex={0}\n        onClick={() => actions.cancel()}\n        onKeyDown={(ev) => ev.preventDefault()}\n      >\n        {template ? (\n          template(value)\n        ) : cell ? (\n          (() => {\n            const Component = cell;\n            return <Component data={editor.value} onAction={onAction} />;\n          })()\n        ) : (\n          <span className=\"wx-lNWNYUb6 wx-text\">{editor.renderedValue}</span>\n        )}\n      </div>\n      <Dropdown width={'auto'}>\n        <Calendar\n          value={value}\n          onChange={updateValue}\n          buttons={editor.config?.buttons}\n        />\n      </Dropdown>\n    </>\n  );\n}\n","import { useEffect, useMemo, useRef, useState } from 'react';\nimport { SuggestDropdown } from '@svar-ui/react-core';\nimport './Richselect.css';\n\nexport default function Richselect(props) {\n  const { actions, editor } = props;\n  const onAction = props.onAction ?? props.onaction;\n\n  const config = editor.config || {};\n\n  const [data] = useState(\n    editor.options.find((opt) => opt.id === editor.value),\n  );\n  const [value] = useState(editor.value);\n  const [options] = useState(editor.options);\n\n  const index = useMemo(\n    () => options.findIndex((a) => a.id === value),\n    [options, value],\n  );\n\n  function updateValue({ id }) {\n    actions.updateValue(id);\n    actions.save();\n  }\n\n  let navigate;\n  const [keydown, setKeydown] = useState();\n\n  function ready(ev) {\n    navigate = ev.navigate;\n    setKeydown(() => ev.keydown);\n    navigate(index);\n  }\n\n  const node = useRef(null);\n  useEffect(() => {\n    if (node.current) {\n      node.current.focus();\n    }\n    if (typeof window !== 'undefined' && window.getSelection) {\n      window.getSelection().removeAllRanges();\n    }\n  }, []);\n\n  return (\n    <>\n      <div\n        ref={node}\n        className=\"wx-ywGRk611 wx-value\"\n        tabIndex={0}\n        onClick={() => actions.cancel()}\n        onKeyDown={(ev) => {\n          keydown(ev, index);\n          ev.preventDefault();\n        }}\n      >\n        {config.template ? (\n          config.template(data)\n        ) : config.cell ? (\n          (() => {\n            const Component = config.cell;\n            return <Component data={data} onAction={onAction} />;\n          })()\n        ) : (\n          <span className=\"wx-ywGRk611 wx-text\">{editor.renderedValue}</span>\n        )}\n      </div>\n      <SuggestDropdown items={options} onReady={ready} onSelect={updateValue}>\n        {({ option }) =>\n          config.template\n            ? config.template(option)\n            : config.cell\n              ? (() => {\n                  const Component = config.cell;\n                  return <Component data={option} onAction={onAction} />;\n                })()\n              : option.label\n        }\n      </SuggestDropdown>\n    </>\n  );\n}\n","import Text from './Text.jsx';\nimport Combo from './Combo.jsx';\nimport Datepicker from './Datepicker.jsx';\nimport Richselect from './Richselect.jsx';\n\nexport const editors = {\n  text: Text,\n  combo: Combo,\n  datepicker: Datepicker,\n  richselect: Richselect,\n};\n","import { useCallback, useContext, useEffect, useMemo, useRef } from 'react';\nimport storeContext from '../../context';\nimport { useStore } from '@svar-ui/lib-react';\nimport { getStyle } from '../../helpers/columnWidth';\nimport { clickOutside } from '@svar-ui/lib-dom';\nimport { editors } from './editors';\nimport './Editor.css';\n\nexport default function Editor({ column, row }) {\n  const api = useContext(storeContext);\n  const editor = useStore(api, 'editor');\n\n  const closeEditor = useCallback(\n    (ignore, cell) => {\n      api.exec('close-editor', { ignore });\n      if (cell) {\n        api.exec('focus-cell', {\n          ...cell,\n          eventSource: 'click',\n        });\n      }\n    },\n    [api],\n  );\n\n  const save = useCallback(\n    (ignoreFocus) => {\n      const cell = ignoreFocus\n        ? null\n        : { row: editor?.id, column: editor?.column };\n      closeEditor(false, cell);\n    },\n    [editor, closeEditor],\n  );\n\n  const cancel = useCallback(() => {\n    closeEditor(true, { row: editor?.id, column: editor?.column });\n  }, [editor, closeEditor]);\n\n  const updateValue = useCallback(\n    (value) => {\n      api.exec('editor', { value });\n    },\n    [api],\n  );\n\n  const keyHandler = useCallback(\n    (ev) => {\n      if (ev.key === 'Enter' && editor) cancel();\n    },\n    [editor, cancel],\n  );\n\n  const computedStyle = useMemo(\n    () =>\n      getStyle(\n        column.width,\n        column.flexgrow,\n        column.fixed,\n        column.left,\n        column.right,\n      ),\n    [column.width, column.flexgrow, column.fixed, column.left, column.right],\n  );\n\n  const Component = useMemo(() => {\n    let ed = column.editor;\n    if (typeof ed === 'function') ed = ed(row, column);\n    let type = typeof ed === 'string' ? ed : ed.type;\n    return editors[type];\n  }, [column, row]);\n\n  const rootRef = useRef(null);\n\n  useEffect(() => {\n    if (!rootRef.current) return;\n    const destroy = clickOutside(rootRef.current, () => save(true));\n    return () => {\n      if (typeof destroy === 'function') destroy();\n    };\n  }, [save]);\n\n  useEffect(() => {\n    if (!rootRef.current) return;\n    if (typeof computedStyle === 'string') {\n      rootRef.current.setAttribute('style', computedStyle);\n    }\n  }, [computedStyle]);\n\n  const role = typeof row.$parent !== 'undefined' ? 'gridcell' : 'cell';\n  const ariaReadonly =\n    typeof row.$parent !== 'undefined'\n      ? column.editor\n        ? false\n        : true\n      : undefined;\n\n  return (\n    <div\n      className=\"wx-8l724t2g wx-cell wx-editor\"\n      ref={rootRef}\n      style={\n        typeof computedStyle === 'object' && computedStyle !== null\n          ? computedStyle\n          : undefined\n      }\n      role={role}\n      aria-readonly={ariaReadonly}\n      tabIndex={-1}\n      onClick={(ev) => ev.stopPropagation()}\n      onDoubleClick={(ev) => ev.stopPropagation()}\n      onKeyDown={keyHandler}\n    >\n      {Component ? (\n        <Component\n          editor={editor}\n          actions={{ save, cancel, updateValue }}\n          onAction={({ action, data }) => api.exec(action, data)}\n        />\n      ) : null}\n    </div>\n  );\n}\n","import { useContext } from 'react';\nimport { getPrintCellStyle, getPrintFilterValue } from '@svar-ui/grid-store';\nimport storeContext from '../../context';\nimport { styleObject } from '@svar-ui/lib-react';\nimport './HeaderFooter.css';\n\nexport default function HeaderFooter(props) {\n  const { columns, type, columnStyle } = props;\n\n  const api = useContext(storeContext);\n  const { filterValues, _columns, _sizes: sizes } = api.getState();\n\n  function getColumnCss(column) {\n    return columnStyle ? ' ' + columnStyle(column) : '';\n  }\n\n  return (\n    <>\n      {columns.map((row, i) => (\n        <tr key={i}>\n          {row.map((cell) => {\n            const column = _columns.find((c) => c.id == cell.id);\n            const className =\n              `wx-print-cell-${type}` +\n              `${getColumnCss(column)}` +\n              `${cell.filter ? ' wx-print-cell-filter' : ''}` +\n              `${cell.vertical ? ' wx-vertical' : ''}`;\n\n            const CellComp = cell.cell;\n\n            return (\n              <th\n                key={cell.id}\n                style={styleObject(getPrintCellStyle(cell, sizes.columnWidth))}\n                className={'wx-Gy81xq2u ' + className}\n                rowSpan={cell.rowspan}\n                colSpan={cell.colspan}\n              >\n                {CellComp ? (\n                  <CellComp\n                    api={api}\n                    cell={Object.fromEntries(\n                      Object.entries(cell).filter(([key]) => key !== 'cell'),\n                    )}\n                    column={column}\n                    row={i}\n                  />\n                ) : cell.filter ? (\n                  <div className=\"wx-Gy81xq2u wx-print-filter\">\n                    {getPrintFilterValue(filterValues, _columns, cell)}\n                  </div>\n                ) : (\n                  <div className=\"wx-Gy81xq2u wx-text\">{cell.text ?? ''}</div>\n                )}\n              </th>\n            );\n          })}\n        </tr>\n      ))}\n    </>\n  );\n}\n","import { useContext } from 'react';\nimport storeContext from '../../context';\nimport {\n  getRenderValue,\n  getHeaderFooterPrintColumns,\n  getPrintCellStyle,\n} from '@svar-ui/grid-store';\nimport HeaderFooter from './HeaderFooter.jsx';\nimport './Grid.css';\nimport { styleObject } from '@svar-ui/lib-react';\n\nexport default function Grid(props) {\n  const { columns, rowStyle, columnStyle, cellStyle, header, footer, reorder } =\n    props;\n\n  const api = useContext(storeContext);\n  const { flatData: data, _sizes: sizes } = api.getState();\n\n  const headerColumns =\n    header &&\n    getHeaderFooterPrintColumns(columns, 'header', sizes.headerRowHeights);\n  const footerColumns =\n    footer &&\n    getHeaderFooterPrintColumns(columns, 'footer', sizes.footerRowHeights);\n\n  function buildCellCss(row, column) {\n    let css = '';\n    css += columnStyle ? ' ' + columnStyle(column) : '';\n    css += cellStyle ? ' ' + cellStyle(row, column) : '';\n    return css;\n  }\n\n  function isDraggableIcon(row, column) {\n    return typeof column.draggable === 'function'\n      ? column.draggable(row, column) !== false\n      : column.draggable;\n  }\n\n  return (\n    <table\n      className={`wx-8NTMLH0z wx-print-grid ${columns.some((c) => c.flexgrow) ? 'wx-flex-columns' : ''}`}\n    >\n      {header ? (\n        <thead>\n          <HeaderFooter\n            columns={headerColumns}\n            type={'header'}\n            columnStyle={columnStyle}\n          />\n        </thead>\n      ) : null}\n\n      <tbody>\n        {data.map((row, rowIndex) => (\n          <tr\n            key={rowIndex}\n            className={\n              'wx-8NTMLH0z wx-row' + (rowStyle ? ' ' + rowStyle(row) : '')\n            }\n            style={{ height: `${row.rowHeight || sizes.rowHeight}px` }}\n          >\n            {columns.map((column) =>\n              !column.collapsed ? (\n                <td\n                  key={column.id}\n                  className={`wx-8NTMLH0z wx-print-cell wx-cell ${buildCellCss(row, column)}`}\n                  style={styleObject(\n                    getPrintCellStyle(column, sizes.columnWidth),\n                  )}\n                >\n                  {reorder && column.draggable ? (\n                    <span className=\"wx-8NTMLH0z wx-print-draggable\">\n                      {isDraggableIcon(row, column) ? (\n                        <i className=\"wx-8NTMLH0z wxi-drag\"></i>\n                      ) : null}\n                    </span>\n                  ) : null}\n                  {column.treetoggle ? (\n                    <>\n                      <span\n                        style={{ marginLeft: row.$level * 28 + 'px' }}\n                      ></span>\n                      {row.$count ? (\n                        <i\n                          className={\n                            'wx-8NTMLH0z wx-print-grid-tree-toggle ' +\n                            `wxi-menu-${row.open !== false ? 'down' : 'right'}`\n                          }\n                        ></i>\n                      ) : null}\n                    </>\n                  ) : null}\n                  {column.cell ? (\n                    (() => {\n                      const CellComp = column.cell;\n                      return <CellComp api={api} row={row} column={column} />;\n                    })()\n                  ) : (\n                    <span>{getRenderValue(row, column)}</span>\n                  )}\n                </td>\n              ) : null,\n            )}\n          </tr>\n        ))}\n      </tbody>\n\n      {footer ? (\n        <tfoot>\n          <HeaderFooter\n            columns={footerColumns}\n            type={'footer'}\n            columnStyle={columnStyle}\n          />\n        </tfoot>\n      ) : null}\n    </table>\n  );\n}\n","import { useContext, useEffect, useMemo, useRef } from 'react';\nimport Grid from './Grid.jsx';\nimport { getPrintColumns } from '@svar-ui/grid-store';\nimport storeContext from '../../context';\nimport './Print.css';\n\nexport default function Print(props) {\n  const { config, ...restProps } = props;\n\n  const api = useContext(storeContext);\n  const { _skin: skin, _columns: columns } = api.getState();\n\n  const grids = useMemo(() => getPrintColumns(columns, config), []);\n  const nodeRef = useRef(null);\n\n  useEffect(() => {\n    const target = document.body;\n    target.classList.add('wx-print');\n\n    const node = nodeRef.current;\n    if (!node) return;\n\n    const cloned = node.cloneNode(true);\n    target.appendChild(cloned);\n\n    const rule = `@media print { @page { size: ${config.paper} ${config.mode}; }`;\n    const style = document.createElement('style');\n    style.setAttribute('type', 'text/css');\n    style.setAttribute('media', 'print');\n    document.getElementsByTagName('head')[0].appendChild(style);\n    style.appendChild(document.createTextNode(rule));\n\n    window.print();\n\n    style.remove();\n    target.classList.remove('wx-print');\n\n    cloned.remove();\n  }, []);\n\n  return (\n    <div\n      className={`wx-4zwCKA7C wx-${skin}-theme wx-print-container`}\n      ref={nodeRef}\n    >\n      {grids.map((cols, i) => (\n        <div className=\"wx-4zwCKA7C wx-print-grid-wrapper\" key={i}>\n          <Grid columns={cols} {...restProps} />\n        </div>\n      ))}\n    </div>\n  );\n}\n","import {\n  useState,\n  useEffect,\n  useMemo,\n  useRef,\n  useContext,\n  useCallback,\n} from 'react';\nimport storeContext from '../context';\nimport { onresize } from '../helpers/actions/onresize';\nimport { reorder as drag, getOffset } from '../helpers/actions/reorder';\nimport { resetAutoScroll, tryAutoScroll } from '../helpers/actions/dragscroll';\nimport { clickOutside, locateAttr, locate, id as toId } from '@svar-ui/lib-dom';\nimport { hotkeys, defaultHotkeys } from '@svar-ui/grid-store';\nimport { scrollTo } from '@svar-ui/grid-store';\nimport { useStore, delegateClick, useStoreWithCounter } from '@svar-ui/lib-react';\n\nimport Cell from './Cell.jsx';\nimport HeaderFooter from './HeaderFooter.jsx';\nimport Overlay from './Overlay.jsx';\nimport Editor from './inlineEditors/Editor.jsx';\nimport Print from './print/Print.jsx';\nimport './Layout.css';\n\nfunction Layout(props) {\n  const {\n    header,\n    footer,\n    overlay,\n    multiselect,\n    onreorder: onReorder,\n    rowStyle,\n    columnStyle,\n    cellStyle,\n    autoRowHeight,\n    resize,\n    clientWidth,\n    clientHeight,\n    responsiveLevel,\n    hotkeys: hotkeysConfig,\n  } = props;\n\n  const api = useContext(storeContext);\n\n  // subscribe to reactive state from api\n  const dynamic = useStore(api, 'dynamic');\n  const columns = useStore(api, '_columns');\n  const data = useStore(api, 'flatData');\n  const split = useStore(api, 'split');\n  const sizes = useStore(api, '_sizes');\n  const [selectedRows, selectionChanged] = useStoreWithCounter(api, 'selectedRows');\n  const selectState = useStore(api, 'select');\n  const editorState = useStore(api, 'editor');\n  const tree = useStore(api, 'tree');\n  const focusCell = useStore(api, 'focusCell');\n  const printConfig = useStore(api, '_print');\n  const undoState = useStore(api, 'undo');\n  const reorder = useStore(api, 'reorder');\n  const rowHeightFromData = useStore(api, '_rowHeightFromData');\n\n  // will be calculated once, after rendering\n  const [SCROLLSIZE, setSCROLLSIZE] = useState(0);\n  useEffect(() => {\n    setSCROLLSIZE(getScrollSize());\n  }, []);\n\n  const [scrollLeft, setScrollLeft] = useState(0);\n  const [scrollTop, setScrollTop] = useState(0);\n\n  const hasAny = useMemo(() => {\n    return (columns || []).some((col) => !col.hidden && col.flexgrow);\n  }, [columns]);\n\n  const defaultRowHeight = useMemo(() => sizes?.rowHeight || 0, [sizes]);\n\n  const tableNodeRef = useRef(null);\n\n  // reorder\n  const [dragItem, setDragItem] = useState(null);\n  const [dragNode, setDragNode] = useState(null);\n\n  const leftColumns = useMemo(() => {\n    let cols = [];\n    let width = 0;\n\n    if (split && split.left) {\n      cols = (columns || [])\n        .slice(0, split.left)\n        .filter((c) => !c.hidden)\n        .map((a) => ({ ...a }));\n      cols.forEach((a) => {\n        a.fixed = { left: 1 };\n        a.left = width;\n        width += a.width;\n      });\n      if (cols.length) cols[cols.length - 1].fixed = { left: -1 };\n    }\n\n    return { columns: cols, width };\n  }, [split, columns]);\n\n  const rightColumns = useMemo(() => {\n    let cols = [];\n    let width = 0;\n\n    if (split && split.right) {\n      cols = (columns || [])\n        .slice(split.right * -1)\n        .filter((c) => !c.hidden)\n        .map((a) => ({ ...a }));\n      for (let i = cols.length - 1; i >= 0; i--) {\n        const col = cols[i];\n        col.fixed = { right: 1 };\n        col.right = width;\n        width += col.width;\n      }\n      if (cols.length) cols[0].fixed = { right: -1 };\n    }\n\n    return { columns: cols, width };\n  }, [split, columns]);\n\n  const centerColumns = useMemo(() => {\n    const center = (columns || [])\n      .slice(split?.left || 0, (columns || []).length - (split?.right ?? 0))\n      .filter((c) => !c.hidden);\n    center.forEach((a) => {\n      a.fixed = 0;\n    });\n    return center;\n  }, [columns, split]);\n\n  const fullWidth = useMemo(() => {\n    return (columns || []).reduce((acc, col) => {\n      if (!col.hidden) {\n        acc += col.width;\n      }\n      return acc;\n    }, 0);\n  }, [columns]);\n\n  const EXTRACOLUMNS = 1;\n\n  function getHeaderPosition(start, deltaLeft, type) {\n    let delta = deltaLeft;\n    let index = start;\n\n    if (centerColumns.length) {\n      let spanStartInd = centerColumns.length; // max value to compare with\n      for (let i = start; i >= 0; i--) {\n        const colHeader = centerColumns[i][type];\n        colHeader.forEach((h) => {\n          if (h.colspan > 1 && i > start - h.colspan && i < spanStartInd) {\n            spanStartInd = i;\n          }\n        });\n      }\n\n      if (spanStartInd !== centerColumns.length && spanStartInd < start) {\n        for (let i = spanStartInd; i < start; i++) {\n          delta -= centerColumns[i].width;\n        }\n        index = spanStartInd;\n      }\n    }\n\n    return { index, delta };\n  }\n\n  const renderColumns = useMemo(() => {\n    let dataCols, headerCols, footerCols;\n\n    const left = scrollLeft;\n    const right = scrollLeft + (clientWidth || 0);\n\n    let start = 0;\n    let end = 0;\n    let sum = 0;\n\n    let d = 0;\n    centerColumns.forEach((col, index) => {\n      if (left > sum) {\n        start = index;\n        d = sum;\n      }\n      sum = sum + col.width;\n\n      if (right > sum) end = index + EXTRACOLUMNS;\n    });\n\n    const rightSpanDelta = { header: 0, footer: 0 };\n    for (let i = end; i >= start; i--) {\n      ['header', 'footer'].forEach((key) => {\n        if (centerColumns[i])\n          centerColumns[i][key].forEach((hCell) => {\n            const colspan = hCell.colspan;\n            if (colspan && colspan > 1) {\n              const diff = colspan - (end - i + 1);\n              if (diff > 0) {\n                rightSpanDelta[key] = Math.max(rightSpanDelta[key], diff);\n              }\n            }\n          });\n      });\n    }\n\n    const headerPos = getHeaderPosition(start, d, 'header');\n    const footerPos = getHeaderPosition(start, d, 'footer');\n\n    const dh = headerPos.delta;\n    const csH = headerPos.index;\n\n    const df = footerPos.delta;\n    const csF = footerPos.index;\n\n    if (hasAny && fullWidth > (clientWidth || 0)) {\n      dataCols =\n        headerCols =\n        footerCols =\n          [...leftColumns.columns, ...centerColumns, ...rightColumns.columns];\n    } else {\n      dataCols = [\n        ...leftColumns.columns,\n        ...centerColumns.slice(start, end + 1),\n        ...rightColumns.columns,\n      ];\n      headerCols = [\n        ...leftColumns.columns,\n        ...centerColumns.slice(csH, end + rightSpanDelta.header + 1),\n        ...rightColumns.columns,\n      ];\n      footerCols = [\n        ...leftColumns.columns,\n        ...centerColumns.slice(csF, end + rightSpanDelta.footer + 1),\n        ...rightColumns.columns,\n      ];\n    }\n\n    return {\n      data: dataCols || [],\n      header: headerCols || [],\n      footer: footerCols || [],\n      d,\n      df,\n      dh,\n    };\n  }, [\n    centerColumns,\n    leftColumns,\n    rightColumns,\n    scrollLeft,\n    clientWidth,\n    hasAny,\n    fullWidth,\n  ]);\n\n  const headerHeight = useMemo(\n    () => (header ? sizes?.headerHeight || 0 : 0),\n    [header, sizes],\n  );\n  const footerHeight = useMemo(\n    () => (footer ? sizes?.footerHeight || 0 : 0),\n    [footer, sizes],\n  );\n\n  const hasHScroll = useMemo(() => {\n    return clientWidth && clientHeight ? fullWidth >= clientWidth : false;\n  }, [clientWidth, clientHeight, fullWidth]);\n\n  const visibleRowsHeight = useMemo(() => {\n    return (\n      (clientHeight || 0) -\n      headerHeight -\n      footerHeight -\n      (hasHScroll ? SCROLLSIZE : 0)\n    );\n  }, [clientHeight, headerHeight, footerHeight, hasHScroll, SCROLLSIZE]);\n\n  const visibleRows = useMemo(() => {\n    return Math.ceil((visibleRowsHeight || 0) / (defaultRowHeight || 1)) + 1;\n  }, [visibleRowsHeight, defaultRowHeight]);\n\n  const rowHeightsRef = useRef([]);\n  const [renderedHeight, setRenderedHeight] = useState(0);\n  const [renderEnd, setRenderEnd] = useState(undefined);\n\n  const renderRows = useMemo(() => {\n    let start = 0;\n    let deltaTop = 0;\n    const EXTRAROWS = 2;\n\n    if (autoRowHeight) {\n      let st = scrollTop;\n      while (st > 0) {\n        st -= rowHeightsRef.current[start] || defaultRowHeight;\n        start++;\n      }\n\n      deltaTop = scrollTop - st;\n      for (let i = Math.max(0, start - EXTRAROWS - 1); i < start; i++)\n        deltaTop -= rowHeightsRef.current[start - i] || defaultRowHeight;\n\n      start = Math.max(0, start - EXTRAROWS);\n    } else {\n      if (rowHeightFromData) {\n        let startInd = 0;\n        let topHeight = 0;\n        for (let i = 0; i < (data || []).length; i++) {\n          const height = data[i].rowHeight || defaultRowHeight;\n          if (topHeight + height > scrollTop) {\n            startInd = i;\n            break;\n          }\n          topHeight += height;\n        }\n        start = Math.max(0, startInd - EXTRAROWS);\n\n        for (let i = 0; i < start; i++) {\n          deltaTop += data[i].rowHeight || defaultRowHeight;\n        }\n\n        let visibleRowsCount = 0;\n        let currentHeight = 0;\n        for (let i = startInd + 1; i < (data || []).length; i++) {\n          const height = data[i].rowHeight || defaultRowHeight;\n          visibleRowsCount++;\n          if (currentHeight + height > visibleRowsHeight) {\n            break;\n          }\n          currentHeight += height;\n        }\n\n        const end = Math.min(\n          dynamic ? dynamic.rowCount : (data || []).length,\n          startInd + visibleRowsCount + EXTRAROWS,\n        );\n\n        return { d: deltaTop, start, end };\n      }\n\n      start = Math.floor(scrollTop / (defaultRowHeight || 1));\n      start = Math.max(0, start - EXTRAROWS);\n      deltaTop = start * (defaultRowHeight || 0);\n    }\n\n    const totalCount = dynamic ? dynamic.rowCount : (data || []).length;\n    const end = Math.min(totalCount, start + (visibleRows || 0) + EXTRAROWS);\n\n    return { d: deltaTop, start, end };\n  }, [autoRowHeight, rowHeightFromData, scrollTop, defaultRowHeight, dynamic, data, visibleRows, visibleRowsHeight]);\n\n  const fullHeight = useMemo(() => {\n    const count = dynamic ? dynamic.rowCount : (data || []).length;\n\n    if (autoRowHeight) {\n      return (\n        renderedHeight +\n        renderRows.d +\n        (count - (renderEnd || 0)) * (defaultRowHeight || 0)\n      );\n    }\n    if (!rowHeightFromData) {\n      return count * (defaultRowHeight || 0);\n    }\n\n    let totalHeight = 0;\n    for (let i = 0; i < count; i++)\n      totalHeight += (data[i]?.rowHeight || defaultRowHeight);\n\n    return totalHeight;\n  }, [\n    dynamic,\n    data,\n    defaultRowHeight,\n    autoRowHeight,\n    rowHeightFromData,\n    renderedHeight,\n    renderRows.d,\n    renderEnd,\n  ]);\n\n  const hasVScroll = useMemo(() => {\n    return clientWidth && clientHeight\n      ? fullHeight + headerHeight + footerHeight >=\n          clientHeight - (fullWidth >= (clientWidth || 0) ? SCROLLSIZE : 0)\n      : false;\n  }, [\n    clientWidth,\n    clientHeight,\n    fullHeight,\n    headerHeight,\n    footerHeight,\n    fullWidth,\n    SCROLLSIZE,\n  ]);\n\n  const contentWidth = useMemo(() => {\n    return hasAny && fullWidth <= (clientWidth || 0)\n      ? (clientWidth || 0) -\n          (hasHScroll ? 0 : 0) -\n          (hasVScroll ? SCROLLSIZE : 0) // hasHScroll doesn't affect width here; keep logic as in Svelte\n      : fullWidth;\n  }, [hasAny, fullWidth, clientWidth, hasVScroll, SCROLLSIZE, hasHScroll]);\n\n  const globalWidth = useMemo(() => {\n    return hasAny && fullWidth <= (clientWidth || 0)\n      ? clientWidth || 0\n      : contentWidth < (clientWidth || 0)\n        ? fullWidth + (hasVScroll ? SCROLLSIZE : 0)\n        : -1;\n  }, [hasAny, fullWidth, clientWidth, contentWidth, hasVScroll, SCROLLSIZE]);\n\n  const lastCallRef = useRef({});\n  useEffect(() => {\n    if (\n      dynamic &&\n      (lastCallRef.current.start !== renderRows.start ||\n        lastCallRef.current.end !== renderRows.end)\n    ) {\n      const { start, end } = renderRows;\n      lastCallRef.current = { start, end };\n      api && api.exec && api.exec('request-data', { row: { start, end } });\n    }\n  }, [dynamic, renderRows, api]);\n\n  const dataRows = useMemo(() => {\n    if (dynamic) return data || [];\n    return (data || []).slice(renderRows.start, renderRows.end);\n  }, [dynamic, data, renderRows]);\n\n  const visibleSelection = useMemo(() => {\n    return (selectedRows || []).filter((s) =>\n      (dataRows || []).some((r) => r.id === s),\n    );\n  }, [selectionChanged, dataRows]);\n\n  const renderStart = useMemo(() => renderRows.start, [renderRows.start]);\n\n  const onScroll = useCallback((ev) => {\n    setScrollTop(ev.target.scrollTop);\n    setScrollLeft(ev.target.scrollLeft);\n  }, []);\n\n  const lockSelection = useCallback((ev) => {\n    if (ev.shiftKey) ev.preventDefault();\n    tableNodeRef.current &&\n      tableNodeRef.current.focus &&\n      tableNodeRef.current.focus();\n  }, []);\n\n  const checkDraggable = useCallback(() => {\n    return !!(columns || []).find((c) => !!c.draggable);\n  }, [columns]);\n\n  const postDragRef = useRef(null);\n  const movementYRef = useRef(null);\n\n  const bodyClickHandlers = useRef({\n    dblclick: (rowId, ev) => {\n      const data = { id: rowId, column: locateAttr(ev, 'data-col-id') };\n      api.exec('open-editor', data);\n    },\n    click: (rowId, ev) => {\n      if (postDragRef.current) return;\n      const column = locateAttr(ev, 'data-col-id');\n      if (focusCell?.id !== rowId)\n        api.exec('focus-cell', {\n          row: rowId,\n          column,\n          eventSource: 'click',\n        });\n\n      if (selectState === false) return;\n\n      const toggle = multiselect && ev.ctrlKey;\n      const range = multiselect && ev.shiftKey;\n\n      if (\n        toggle ||\n        selectedRows.length > 1 ||\n        !selectedRows.includes(rowId)\n      ) {\n        api.exec('select-row', { id: rowId, toggle, range });\n      }\n    },\n    'toggle-row': (rowId) => {\n      const row = api.getRow(rowId);\n      api.exec(row.open !== false ? 'close-row' : 'open-row', { id: rowId });\n    },\n    'ignore-click': () => {\n      return false;\n    },\n  });\n\n  const dragScrollConfig = useMemo(() => {\n    return {\n      top: headerHeight,\n      bottom: footerHeight,\n      left: leftColumns.width,\n      xScroll: hasHScroll,\n      yScroll: hasVScroll,\n      sense:\n        autoRowHeight && dragNode\n          ? dragNode.offsetHeight\n          : Math.max(sizes?.rowHeight || 0, 40),\n      node: tableNodeRef.current && tableNodeRef.current.firstElementChild,\n    };\n  }, [\n    headerHeight,\n    footerHeight,\n    leftColumns.width,\n    hasHScroll,\n    hasVScroll,\n    autoRowHeight,\n    dragNode,\n    sizes,\n  ]);\n\n  function startDrag(ev, context) {\n    const { container, sourceNode, from } = context;\n    const hasDraggable = checkDraggable();\n\n    if (hasDraggable && !sourceNode.getAttribute('draggable-data'))\n      return false;\n\n    setDragItem(from);\n\n    if (api.getRow(from).open)\n      api.exec('close-row', { id: from, nested: true });\n\n    const itemNode = locate(sourceNode, 'data-id');\n    const cloned = itemNode.cloneNode(true);\n    cloned.classList.remove('wx-selected');\n    cloned\n      .querySelectorAll('[tabindex]')\n      .forEach((element) => element.setAttribute('tabindex', '-1'));\n    container.appendChild(cloned);\n    setDragNode(cloned);\n\n    const offsetX = scrollLeft - renderColumns.d;\n    const vScrollSize = hasVScroll ? SCROLLSIZE : 0;\n\n    container.style.width =\n      Math.min(\n        (clientWidth || 0) - vScrollSize,\n        hasAny && fullWidth <= (clientWidth || 0)\n          ? contentWidth\n          : contentWidth - vScrollSize,\n      ) +\n      offsetX +\n      'px';\n\n    const itemPos = getOffset(itemNode);\n    context.offset = {\n      x: offsetX,\n      y: -Math.round(itemPos.height / 2),\n    };\n\n    if (!movementYRef.current) movementYRef.current = ev.clientY;\n  }\n\n  function moveDrag(ev, context) {\n    const { from } = context;\n    const pos = context.pos;\n    const box = getOffset(tableNodeRef.current);\n\n    pos.x = box.x;\n\n    const min = dragScrollConfig.top;\n    if (pos.y < min) pos.y = min;\n    else {\n      const max =\n        box.height -\n        (hasHScroll && SCROLLSIZE > 0\n          ? SCROLLSIZE\n          : Math.round(dragScrollConfig.sense / 2)) -\n        dragScrollConfig.bottom;\n      if (pos.y > max) pos.y = max;\n    }\n\n    if (tableNodeRef.current.contains(context.targetNode)) {\n      const targetRow = locate(context.targetNode, 'data-id');\n      const to = toId(targetRow?.getAttribute('data-id'));\n\n      if (to && to !== from) {\n        context.to = to;\n\n        const rowHeight = autoRowHeight\n          ? dragNode?.offsetHeight\n          : sizes?.rowHeight;\n\n        if (dragNode && (scrollTop === 0 || pos.y > min + rowHeight - 1)) {\n          const targetRect = targetRow.getBoundingClientRect();\n          const dragNodeOffset = getOffset(dragNode);\n\n          const dragNodePos = dragNodeOffset.y;\n          const targetNodePos = targetRect.y;\n\n          const dir = dragNodePos > targetNodePos ? -1 : 1;\n          const initialMode = dir === 1 ? 'after' : 'before';\n          const diff = Math.abs(api.getRowIndex(from) - api.getRowIndex(to));\n\n          const mode =\n            diff !== 1\n              ? initialMode === 'before'\n                ? 'after'\n                : 'before'\n              : initialMode;\n\n          if (diff === 1) {\n            if (dir === -1 && ev.clientY > movementYRef.current) return;\n            if (dir === 1 && ev.clientY < movementYRef.current) return;\n          }\n\n          movementYRef.current = ev.clientY;\n\n          api.exec('move-item', {\n            id: from,\n            target: to,\n            mode,\n            inProgress: true,\n          });\n        }\n      }\n\n      onReorder && onReorder({ event: ev, context });\n    }\n\n    tryAutoScroll(ev, box, context, dragScrollConfig);\n  }\n\n  function endDrag(ev, context) {\n    const { from, to } = context;\n\n    api.exec('move-item', {\n      id: from,\n      target: to,\n      inProgress: false,\n    });\n\n    postDragRef.current = setTimeout(() => {\n      postDragRef.current = 0;\n    }, 1);\n\n    setDragItem(null);\n    setDragNode(null);\n    movementYRef.current = null;\n    resetAutoScroll(context);\n  }\n\n  function getScrollSize() {\n    const div = document.createElement('div');\n    div.style.cssText =\n      'position:absolute;left:-1000px;width:100px;padding:0px;margin:0px;min-height:100px;overflow-y:scroll;';\n    document.body.appendChild(div);\n    const width = div.offsetWidth - div.clientWidth;\n    document.body.removeChild(div);\n    return width;\n  }\n\n  const styleWidth = useMemo(() => {\n    return globalWidth > 0 ? { width: `${globalWidth}px` } : undefined;\n  }, [globalWidth]);\n\n  const dataElRef = useRef(null);\n  function adjustHeight() {\n    Promise.resolve().then(() => {\n      let rh = 0;\n      let re = renderStart;\n      const container = dataElRef.current;\n      if (!container) return;\n      Array.from(container.children).forEach((row, i) => {\n        rowHeightsRef.current[renderStart + i] = row.offsetHeight;\n        rh += row.offsetHeight;\n        re++;\n      });\n\n      setRenderedHeight(rh);\n      setRenderEnd(re);\n    });\n  }\n\n  useEffect(() => {\n    if (dataRows && autoRowHeight) adjustHeight();\n  }, [dataRows, autoRowHeight, renderStart]);\n\n  let [focus, setFocus] = useState();\n\n  useEffect(() => {\n    if (\n      focusCell &&\n      (!selectState ||\n        !visibleSelection.length ||\n        visibleSelection.includes(focusCell.row))\n    ) {\n      setFocus({ ...focusCell });\n    } else if (dataRows.length && renderColumns.data.length) {\n      if (\n        !focus ||\n        (visibleSelection.length && !visibleSelection.includes(focus.row)) ||\n        dataRows.findIndex((r) => r.id == focus.row) === -1 ||\n        renderColumns.data.findIndex(\n          (c) => c.id == focus.column && !c.collapsed,\n        ) === -1\n      ) {\n        const row = visibleSelection[0] || dataRows[0].id;\n        const cind = renderColumns.data.findIndex((c) => !c.collapsed);\n        if (cind !== -1) setFocus({ row, column: renderColumns.data[cind].id });\n        else setFocus(null);\n      }\n    } else setFocus(null);\n  }, [focusCell]);\n\n  // actions effects\n  const scrollRef = useRef(null);\n  useEffect(() => {\n    const node = tableNodeRef.current;\n    if (!node) return;\n    const cleanup = onresize(node, resize);\n    return () => {\n      if (typeof cleanup === 'function') cleanup();\n    };\n  }, [resize]);\n\n  const dragState = useRef({});\n  Object.assign(dragState.current, {\n    start: startDrag,\n    move: moveDrag,\n    end: endDrag,\n    getReorder: () => reorder,\n    getDraggableInfo: () => ({ hasDraggable: checkDraggable() }),\n  });\n\n  useEffect(() => {\n    const node = tableNodeRef.current;\n    if (!node) return;\n    const cleanup = drag(node, dragState);\n    return cleanup.destroy;\n  }, [reorder, tableNodeRef.current]);\n\n  useEffect(() => {\n    const node = tableNodeRef.current;\n    if (!node) return;\n    const cleanup = hotkeys(node, {\n      keys: hotkeysConfig !== false && {\n        ...defaultHotkeys,\n        'ctrl+z': undoState,\n        'ctrl+y': undoState,\n        ...hotkeysConfig,\n      },\n      exec: (v) => api.exec('hotkey', v),\n    });\n    return cleanup.destroy;\n  }, [api, undoState, hotkeysConfig]);\n\n  const scrollConfig = useRef({\n    scroll: api.getReactiveState().scroll,\n  });\n  scrollConfig.current.getWidth = () =>\n    (clientWidth || 0) - (hasVScroll ? SCROLLSIZE : 0);\n  scrollConfig.current.getHeight = () => visibleRowsHeight;\n  scrollConfig.current.getScrollMargin = () =>\n    leftColumns.width + rightColumns.width;\n\n  useEffect(() => {\n    scrollTo(scrollRef.current, scrollConfig.current);\n  }, []);\n\n  const bodyRef = useRef(null);\n  useEffect(() => {\n    const node = bodyRef.current;\n    if (!node) return;\n\n    const result = [];\n    result.push(\n      clickOutside(node, () => api.exec('focus-cell', { eventSource: 'click' }))\n        .destroy,\n    );\n    result.push(delegateClick(node, bodyClickHandlers.current));\n\n    return () => result.forEach((r) => r());\n  }, []);\n\n  const gridClassName = `wx-grid ${responsiveLevel ? `wx-responsive-${responsiveLevel}` : ''}`;\n\n  return (\n    <>\n      <div\n        className={'wx-4VuBwK2D ' + gridClassName}\n        style={{\n          ['--header-height']: `${headerHeight}px`,\n          ['--footer-height']: `${footerHeight}px`,\n          ['--split-left-width']: `${leftColumns.width}px`,\n          ['--split-right-width']: `${rightColumns.width}px`,\n        }}\n      >\n        <div\n          ref={tableNodeRef}\n          className=\"wx-4VuBwK2D wx-table-box\"\n          style={styleWidth}\n          role={tree ? 'treegrid' : 'grid'}\n          aria-colcount={renderColumns.data.length}\n          aria-rowcount={dataRows.length}\n          aria-multiselectable={tree && multiselect ? true : undefined}\n          tabIndex={-1}\n        >\n          <div\n            ref={scrollRef}\n            className=\"wx-4VuBwK2D wx-scroll\"\n            style={{\n              overflowX: hasHScroll ? 'scroll' : 'hidden',\n              overflowY: hasVScroll ? 'scroll' : 'hidden',\n            }}\n            onScroll={onScroll}\n          >\n            {header ? (\n              <div className=\"wx-4VuBwK2D wx-header-wrapper\">\n                <HeaderFooter\n                  contentWidth={contentWidth}\n                  deltaLeft={renderColumns.dh}\n                  columns={renderColumns.header}\n                  columnStyle={columnStyle}\n                  bodyHeight={visibleRowsHeight - +footer}\n                />\n              </div>\n            ) : null}\n            <div\n              ref={bodyRef}\n              className=\"wx-4VuBwK2D wx-body\"\n              style={{ width: `${contentWidth}px`, height: `${fullHeight}px` }}\n              onMouseDown={(ev) => lockSelection(ev)}\n            >\n              {overlay ? <Overlay overlay={overlay} /> : null}\n              <div\n                ref={dataElRef}\n                className=\"wx-4VuBwK2D wx-data\"\n                style={{\n                  paddingTop: `${renderRows.d}px`,\n                  paddingLeft: `${renderColumns.d}px`,\n                }}\n              >\n                {dataRows.map((row, rIndex) => {\n                  const isSelected = selectedRows.indexOf(row.id) !== -1;\n                  const isInactive = dragItem === row.id;\n                  const rowClass =\n                    'wx-row' +\n                    (autoRowHeight ? ' wx-autoheight' : '') +\n                    (rowStyle ? ' ' + rowStyle(row) : '') +\n                    (isSelected ? ' wx-selected' : '') +\n                    (isInactive ? ' wx-inactive' : '');\n                  const rowStyleProp = autoRowHeight\n                    ? { minHeight: `${row.rowHeight || defaultRowHeight}px` }\n                    : { height: `${row.rowHeight || defaultRowHeight}px` };\n                  return (\n                    <div\n                      key={row.id}\n                      className={'wx-4VuBwK2D ' + rowClass}\n                      data-id={row.id}\n                      data-context-id={row.id}\n                      style={rowStyleProp}\n                      role=\"row\"\n                      aria-rowindex={rIndex}\n                      aria-expanded={row.open}\n                      aria-level={tree ? row.$level + 1 : undefined}\n                      aria-selected={tree ? isSelected : undefined}\n                      tabIndex={-1}\n                    >\n                      {renderColumns.data.map((column) => {\n                        if (column.collapsed) {\n                          return (\n                            <div\n                              key={column.id}\n                              className=\"wx-4VuBwK2D wx-cell wx-collapsed\"\n                            ></div>\n                          );\n                        } else if (\n                          editorState?.id === row.id &&\n                          editorState.column == column.id\n                        ) {\n                          return (\n                            <Editor key={column.id} row={row} column={column} />\n                          );\n                        } else {\n                          return (\n                            <Cell\n                              key={column.id}\n                              row={row}\n                              column={column}\n                              columnStyle={columnStyle}\n                              cellStyle={cellStyle}\n                              reorder={reorder}\n                              focusable={\n                                focus?.row === row.id &&\n                                focus?.column == column.id\n                              }\n                            />\n                          );\n                        }\n                      })}\n                    </div>\n                  );\n                })}\n              </div>\n            </div>\n            {footer && (data || []).length ? (\n              <HeaderFooter\n                type={'footer'}\n                contentWidth={contentWidth}\n                deltaLeft={renderColumns.df}\n                columns={renderColumns.footer}\n                columnStyle={columnStyle}\n              />\n            ) : null}\n          </div>\n        </div>\n      </div>\n      {printConfig ? (\n        <Print\n          config={printConfig}\n          rowStyle={rowStyle}\n          columnStyle={columnStyle}\n          cellStyle={cellStyle}\n          header={header}\n          footer={footer}\n          reorder={reorder}\n        />\n      ) : null}\n    </>\n  );\n}\n\nexport default Layout;\n","import {\n  useState,\n  useMemo,\n  useEffect,\n  useRef,\n  useCallback,\n  useContext,\n  forwardRef,\n  useImperativeHandle,\n} from 'react';\n\n// core widgets lib\nimport { Locale } from '@svar-ui/react-core';\nimport { en } from '@svar-ui/grid-locales';\n\n// stores\nimport { EventBusRouter } from '@svar-ui/lib-state';\nimport { DataStore } from '@svar-ui/grid-store';\n\n// context\nimport { context } from '@svar-ui/react-core';\nimport StoreContext from '../context';\n\n// svelte store factory (used by DataStore)\nimport { writable } from '@svar-ui/lib-react';\n\n// ui\nimport Layout from './Layout.jsx';\n\nconst camelize = (s) =>\n  s\n    .split('-')\n    .map((part) => (part ? part.charAt(0).toUpperCase() + part.slice(1) : ''))\n    .join('');\n\nconst Grid = forwardRef(function Grid(\n  {\n    data = [],\n    columns = [],\n    rowStyle = null,\n    columnStyle = null,\n    cellStyle = null,\n    selectedRows,\n    select = true,\n    multiselect = false,\n    header = true,\n    footer = false,\n    dynamic = null,\n    overlay = null,\n    reorder = false,\n    onReorder = null,\n    autoRowHeight = false,\n    sizes,\n    split,\n    tree = false,\n    autoConfig = false,\n    init = null,\n    responsive = null,\n    sortMarks,\n    undo = false,\n    hotkeys = null,\n    ...restProps\n  },\n  ref,\n) {\n  // keep latest rest props for event routing\n  const restPropsRef = useRef();\n  restPropsRef.current = restProps;\n\n  // init stores\n  const dataStore = useMemo(() => new DataStore(writable), []);\n  const firstInRoute = useMemo(() => dataStore.in, [dataStore]);\n\n  const lastInRouteRef = useRef(null);\n  if (lastInRouteRef.current === null) {\n    lastInRouteRef.current = new EventBusRouter((a, b) => {\n      const name = 'on' + camelize(a);\n      if (restPropsRef.current && restPropsRef.current[name]) {\n        restPropsRef.current[name](b);\n      }\n    });\n    firstInRoute.setNext(lastInRouteRef.current);\n  }\n\n  // public API\n  const api = useMemo(\n    () => ({\n      getState: dataStore.getState.bind(dataStore),\n      getReactiveState: dataStore.getReactive.bind(dataStore),\n      getStores: () => ({ data: dataStore }),\n      exec: firstInRoute.exec,\n      setNext: (ev) => {\n        lastInRouteRef.current = lastInRouteRef.current.setNext(ev);\n        return lastInRouteRef.current;\n      },\n      intercept: firstInRoute.intercept.bind(firstInRoute),\n      on: firstInRoute.on.bind(firstInRoute),\n      detach: firstInRoute.detach.bind(firstInRoute),\n      getRow: dataStore.getRow.bind(dataStore),\n      getRowIndex: dataStore.getRowIndex.bind(dataStore),\n      getColumn: dataStore.getColumn.bind(dataStore),\n    }),\n    [dataStore, firstInRoute],\n  );\n\n  const [clientWidth, setClientWidth] = useState(0);\n  const [clientHeight, setClientHeight] = useState(0);\n  const [responsiveLevel, setResponsiveLevel] = useState(null);\n  const [responsiveConfig, setResponsiveConfig] = useState(null);\n\n  // auto config columns\n  const finalColumns = useMemo(() => {\n    if (autoConfig && !columns.length && data.length) {\n      const test = data[0];\n      const autoCols = [];\n\n      for (let key in test) {\n        if (key !== 'id' && key[0] !== '$') {\n          let col = {\n            id: key,\n            header: key[0].toUpperCase() + key.slice(1),\n          };\n\n          if (typeof autoConfig === 'object') {\n            col = { ...col, ...autoConfig };\n          }\n          autoCols.push(col);\n        }\n      }\n\n      return autoCols;\n    }\n\n    return (responsiveConfig && responsiveConfig.columns) ?? columns;\n  }, [autoConfig, columns, data, responsiveConfig]);\n\n  const finalSizes = useMemo(\n    () => (responsiveConfig && responsiveConfig.sizes) ?? sizes,\n    [responsiveConfig, sizes],\n  );\n\n  const resize = useCallback(\n    (rect) => {\n      setClientWidth(rect.width);\n      setClientHeight(rect.height);\n\n      if (responsive) {\n        const levels = Object.keys(responsive)\n          .map(Number)\n          .sort((a, b) => a - b);\n\n        const newLevel = levels.find((level) => rect.width <= level) ?? null;\n\n        if (newLevel !== responsiveLevel) {\n          setResponsiveConfig(responsive[newLevel]);\n          setResponsiveLevel(newLevel);\n        }\n      }\n    },\n    [responsive, responsiveLevel],\n  );\n\n\n  const _skin = useContext(context.theme);\n\n  const initOnceRef = useRef(0);\n  useEffect(() => {\n    if (!initOnceRef.current) {\n      if (init) init(api);\n    } else {\n      const prev = dataStore.getState();\n      dataStore.init({\n        data,\n        columns: finalColumns,\n        split: split || prev.split,\n        sizes: finalSizes || prev.sizes,\n        selectedRows: selectedRows || prev.selectedRows,\n        dynamic,\n        tree,\n        sortMarks: sortMarks || prev.sortMarks,\n        undo,\n        reorder,\n        _skin,\n        _select: select,\n      });\n    }\n    initOnceRef.current++;\n  }, [\n    dataStore,\n    data,\n    finalColumns,\n    split,\n    finalSizes,\n    selectedRows,\n    dynamic,\n    tree,\n    sortMarks,\n    undo,\n    reorder,\n    _skin,\n    select,\n    init,\n    api,\n  ]);\n\n  if (initOnceRef.current === 0) {\n    dataStore.init({\n      data,\n      columns: finalColumns,\n      split: split || { left: 0 },\n      sizes: finalSizes || {},\n      selectedRows: selectedRows || [],\n      dynamic,\n      tree,\n      sortMarks: sortMarks || {},\n      undo,\n      reorder,\n      _skin,\n      select,\n    });\n  }\n\n  // expose API via ref\n  useImperativeHandle(\n    ref,\n    () => ({\n      ...api,\n    }),\n    [api],\n  );\n\n  return (\n    <StoreContext.Provider value={api}>\n      <Locale words={en} optional={true}>\n        <Layout\n          header={header}\n          footer={footer}\n          overlay={overlay}\n          rowStyle={rowStyle}\n          columnStyle={columnStyle}\n          cellStyle={cellStyle}\n          onReorder={onReorder}\n          multiselect={multiselect}\n          autoRowHeight={autoRowHeight}\n          clientWidth={clientWidth}\n          clientHeight={clientHeight}\n          responsiveLevel={responsiveLevel}\n          resize={resize}\n          hotkeys={hotkeys}\n        />\n      </Locale>\n    </StoreContext.Provider>\n  );\n});\n\nexport default Grid;\n","import './HeaderMenuItem.css';\n\nfunction HeaderMenuItem({ item }) {\n  return (\n    <div\n      tabIndex={-1}\n      role=\"menuitem\"\n      aria-label={\n        item.hidden ? `Show ${item.text} column` : `Hide ${item.text} column`\n      }\n    >\n      <div\n        className={'wx-v13lZxja wx-icon' + (item.hidden ? ' wx-hidden' : '')}\n      >\n        <i className=\"wx-v13lZxja wxi-eye\"></i>\n      </div>\n      <span>{item.text}</span>\n    </div>\n  );\n}\n\nexport default HeaderMenuItem;\n","import { useEffect, useMemo } from 'react';\nimport { ContextMenu, registerMenuItem } from '@svar-ui/react-menu';\nimport HeaderMenuItem from './HeaderMenuItem.jsx';\nimport { useStoreLater } from '@svar-ui/lib-react';\n\nexport default function HeaderMenu({ columns = null, api, children }) {\n  useEffect(() => {\n    registerMenuItem('table-header', HeaderMenuItem);\n  }, []);\n\n  function getLabel(col) {\n    for (let i = col.header.length - 1; i >= 0; i--) {\n      const text = col.header[i].text;\n      if (text) return text;\n    }\n    return col.id;\n  }\n\n  function headerMenuClick(e) {\n    const col = e.action;\n    if (col) {\n      api.exec('hide-column', { id: col.id, mode: !col.hidden });\n    }\n  }\n\n  function open(id) {\n    return id;\n  }\n\n  const rColumns = useStoreLater(api, '_columns');\n\n  const headerMenuOptions = useMemo(() => {\n    if (api) {\n      const source = Array.isArray(rColumns) ? rColumns : [];\n      const included = columns ? source.filter((c) => columns[c.id]) : source;\n\n      return included.map((c) => {\n        const text = getLabel(c);\n        return {\n          id: c.id,\n          text,\n          type: 'table-header',\n          hidden: c.hidden,\n        };\n      });\n    } else {\n      return [];\n    }\n  }, [api, columns, rColumns]);\n\n  return (\n    <ContextMenu\n      dataKey=\"headerId\"\n      options={headerMenuOptions}\n      onClick={headerMenuClick}\n      at=\"point\"\n      resolver={open}\n    >\n      {typeof children === 'function' ? children() : children}\n    </ContextMenu>\n  );\n}\n","import { useEffect, useRef, useState } from 'react';\nimport { getRenderValue } from '@svar-ui/grid-store';\nimport './Tooltip.css';\n\nfunction Tooltip(props) {\n  const { content: Content = null, api, children } = props;\n\n  const areaRef = useRef(null);\n  const tooltipRef = useRef(null);\n\n  const [areaCoords, setAreaCoords] = useState();\n  const [tooltipData, setTooltipData] = useState();\n  const [pos, setPos] = useState();\n\n  function findAttribute(node) {\n    while (node) {\n      if (node.getAttribute) {\n        const id = node.getAttribute('data-row-id');\n        const colId = node.getAttribute('data-col-id');\n        if (id && api && colId) {\n          const col = api.getColumn(colId);\n          return { id, col, target: node };\n        }\n      }\n      node = node.parentNode;\n    }\n    return { id: null, col: null, target: null };\n  }\n\n  useEffect(() => {\n    const node = tooltipRef.current;\n    if (node && areaCoords && pos) {\n      let tooltipCoords = node.getBoundingClientRect();\n      let newLeft = pos.left;\n      let newTop = pos.top;\n      if (tooltipCoords.right >= areaCoords.right) {\n        newLeft = areaCoords.width - tooltipCoords.width - 5;\n      }\n      if (tooltipCoords.bottom >= areaCoords.bottom) {\n        newTop = pos.top - (tooltipCoords.bottom - areaCoords.bottom + 2);\n      }\n      if (newLeft !== pos.left || newTop !== pos.top) {\n        setPos({ ...pos, left: newLeft, top: newTop });\n      }\n    }\n  }, [areaCoords, pos]);\n\n  const timerRef = useRef();\n  const TIMEOUT = 300;\n\n  const debounce = (code) => {\n    clearTimeout(timerRef.current);\n    timerRef.current = setTimeout(() => {\n      code();\n    }, TIMEOUT);\n  };\n\n  function move(e) {\n    const { id, target, col } = findAttribute(e.target);\n    setPos(null);\n    if (!id) {\n      clearTimeout(timerRef.current);\n      return;\n    }\n    const clientX = e.clientX;\n\n    debounce(() => {\n      let text = '';\n      if (id) {\n        const data = getTooltipData(id);\n        setTooltipData(data);\n        text = getTooltipText(col, data);\n      }\n      const targetCoords = target.getBoundingClientRect();\n      const areaEl = areaRef.current;\n      if (!areaEl) return;\n      const areaRect = areaEl.getBoundingClientRect();\n      setAreaCoords(areaRect);\n      const top = targetCoords.top + targetCoords.height - areaRect.top;\n      const left = clientX - areaRect.left;\n      setPos({ top, left, col, text });\n    });\n  }\n\n  function getTooltipData(id) {\n    return api.getRow(id);\n  }\n\n  function getTooltipText(col, data) {\n    data = data || tooltipData;\n    if (typeof col.tooltip === 'function') return col.tooltip(data);\n    return getRenderValue(data, col) || '';\n  }\n\n  return (\n    <div className=\"wx-RYccULtD wx-area\" ref={areaRef} onMouseMove={move}>\n      {pos && pos.col.tooltip !== false && (Content || pos.text) ? (\n        <div\n          className=\"wx-RYccULtD tooltip\"\n          role=\"alert\"\n          tabIndex={0}\n          ref={tooltipRef}\n          style={{ top: pos.top + 'px', left: pos.left + 'px' }}\n        >\n          {Content ? <Content data={tooltipData} /> : pos.text}\n        </div>\n      ) : null}\n      {children}\n    </div>\n  );\n}\n\nexport default Tooltip;\n","import { useContext, useMemo } from 'react';\nimport { ContextMenu as WxContextMenu } from '@svar-ui/react-menu';\nimport { context } from '@svar-ui/react-core';\nimport { useStoreLater } from '@svar-ui/lib-react';\n\nimport {\n  defaultMenuOptions,\n  assignChecks,\n  handleAction,\n} from '@svar-ui/grid-store';\nimport { locale } from \"@svar-ui/lib-dom\";\nimport { en } from \"@svar-ui/grid-locales\";\nimport './ContextMenu.css';\n\nfunction ContextMenu({\n  api,\n  options = [...defaultMenuOptions],\n  at = 'point',\n  resolver,\n  dataKey,\n  filter,\n  css,\n  children,\n  handler,\n  onClick,\n}) {\n  const i18n = useContext(context.i18n);\n  const _ = useMemo(() => i18n ? i18n.getGroup('grid') : locale(en).getGroup('grid'), [i18n]);\n\n  const selectedRows = useStoreLater(api, 'selectedRows');\n  const data = useStoreLater(api, 'data');\n  const reorder = useStoreLater(api, 'reorder');\n\n  const normalizedOptions = useMemo(() => {\n    const filtered = filterItems(options);\n    const normalized = assignChecks(filtered);\n    applyLocale(normalized);\n    return normalized;\n  }, [options, reorder, data]);\n\n  function applyLocale(options) {\n    options.forEach(op => {\n      if (op.text) op.text = _(op.text);\n      if (op.subtext) op.subtext = _(op.subtext);\n      if (op.data) op.data = applyLocale(op.data);\n    });\n  }\n\n  const finalOptions = useMemo(() => {\n    const opts = [];\n    normalizedOptions.forEach(item => {\n      switch (item.id) {\n        case 'move-item:up':\n        case 'move-item:down':\n        case 'paste-row': {\n          if (!item.isDisabled || !api) {\n            opts.push(item);\n            return;\n          }\n          \n          const disabled = item.isDisabled(\n            item.id === 'paste-row' ? api : selectedRows,\n            data\n          );\n\n          opts.push({\n            ...item,\n            disabled,\n          });\n          break;\n        }\n        default: {\n          opts.push(item);\n          break;\n        }\n      }\n    });\n    return opts;\n  }, [normalizedOptions, selectedRows, data, api]);\n\n  function getItem(id) {\n    if (!selectedRows.includes(id)) {\n      api.exec('select-row', { id });\n    }\n    return id;\n  }\n\n  const handleClicks = (ev) => {\n    const option = ev.action;\n    if (option) handleAction(api, option.id);\n    onClick && onClick(ev);\n  };\n\n  function filterItems(items) {\n    if (reorder) return items;\n    return items.filter(({ id }) => {\n      return !(id === 'move-item:up' || id === 'move-item:down');\n    });\n  }\n\n  const resolverProp = resolver !== undefined ? resolver : getItem;\n\n  return (\n    <WxContextMenu\n      css={`wx-KKGLK8TH wx-table-menu ${css}`}\n      at={at}\n      dataKey={dataKey}\n      handler={handler}\n      options={finalOptions}\n      resolver={resolverProp}\n      filter={filter}\n      onClick={handleClicks}\n    >\n      {children}\n    </WxContextMenu>\n  );\n}\n\nexport default ContextMenu;\n","import { useMemo, useContext } from 'react';\nimport { Toolbar } from '@svar-ui/react-toolbar';\nimport {\n\tdefaultToolbarButtons,\n\tassignChecks,\n\thandleAction,\n} from '@svar-ui/grid-store';\nimport { locale } from '@svar-ui/lib-dom';\nimport { en } from '@svar-ui/grid-locales';\nimport { context } from '@svar-ui/react-core';\nimport { useStoreLater } from '@svar-ui/lib-react';\n\nexport default function ToolbarComponent({\n\tapi,\n\titems = [...defaultToolbarButtons],\n\tonClick,\n\t...restProps\n}) {\n\tconst i18nContext = useContext(context.i18n);\n\tconst _ =\n\t\ti18nContext?.getGroup('grid') || locale(en).getGroup('grid');\n\n\tconst selectedRows = useStoreLater(api, 'selectedRows');\n\tconst data = useStoreLater(api, 'data');\n\tconst history = useStoreLater(api, 'history');\n\tconst reorder = useStoreLater(api, 'reorder');\n\tconst undo = useStoreLater(api, 'undo');\n\n\tconst rowActions = [\n\t\t'open-editor',\n\t\t'delete-row',\n\t\t'copy-row',\n\t\t'cut-row',\n\t\t'paste-row',\n\t\t'move-item:up',\n\t\t'move-item:down',\n\t];\n\tconst historyActions = ['undo', 'redo'];\n\n\tconst normalizedItems = useMemo(() => {\n\t\tconst filtered = filterItems(items);\n\t\tconst normalized = assignChecks(filtered);\n\t\tapplyLocale(normalized);\n\t\treturn normalized;\n\n\t\tfunction filterItems(items) {\n\t\t\tif (undo && reorder) return items;\n\t\t\treturn items.filter(({ id }) => {\n\t\t\t\treturn !(\n\t\t\t\t\t(!undo && (id === 'undo' || id === 'redo')) ||\n\t\t\t\t\t(!reorder &&\n\t\t\t\t\t\t(id === 'move-item:up' || id === 'move-item:down'))\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\n\t\tfunction applyLocale(options) {\n\t\t\toptions.forEach(op => {\n\t\t\t\tif (op.text) op.text = _(op.text);\n\t\t\t\tif (op.menuText) op.menuText = _(op.menuText);\n\t\t\t\tif (op.items) op.items = applyLocale(op.items);\n\t\t\t});\n\t\t}\n\t}, [items, undo, reorder, _]);\n\n\tconst buttons = useMemo(() => {\n\t\tconst finalButtons = [];\n\t\tconst selected = selectedRows?.length;\n\t\tnormalizedItems.forEach(item => {\n\t\t\tconst action = item.id;\n\t\t\tif (action === 'add-row') {\n\t\t\t\tfinalButtons.push(item);\n\t\t\t} else if (rowActions.includes(action)) {\n\t\t\t\tif (!selected) return;\n\t\t\t\tfinalButtons.push({\n\t\t\t\t\t...item,\n\t\t\t\t\tdisabled:\n\t\t\t\t\t\titem.isDisabled &&\n\t\t\t\t\t\titem.isDisabled(\n\t\t\t\t\t\t\taction === 'paste-row' ? api : selectedRows,\n\t\t\t\t\t\t\tdata\n\t\t\t\t\t\t),\n\t\t\t\t});\n\t\t\t} else if (historyActions.includes(action)) {\n\t\t\t\tfinalButtons.push({\n\t\t\t\t\t...item,\n\t\t\t\t\tdisabled: item.isDisabled(history),\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tfinalButtons.push(item);\n\t\t\t}\n\t\t});\n\t\treturn finalButtons;\n\t}, [normalizedItems, selectedRows, data, history, api, rowActions, historyActions]);\n\n\tconst handleClicks = ev => {\n\t\tconst option = ev.item;\n\t\tif (option) handleAction(api, option.id);\n\t\tonClick && onClick(ev);\n\t};\n\n\treturn <Toolbar items={buttons} onClick={handleClicks} {...restProps} />;\n}\n","import { Material as CoreMaterial } from '@svar-ui/react-core';\nimport './Material.css';\n\nfunction Material({ fonts = true, children }) {\n  if (children) {\n    return <CoreMaterial fonts={fonts}>{children}</CoreMaterial>;\n  } else {\n    return <CoreMaterial fonts={fonts} />;\n  }\n}\n\nexport default Material;\n","import { Willow as WillowCore } from '@svar-ui/react-core';\nimport './Willow.css';\n\nfunction Willow({ fonts = true, children }) {\n  if (children) {\n    return <WillowCore fonts={fonts}>{children}</WillowCore>;\n  } else {\n    return <WillowCore fonts={fonts} />;\n  }\n}\n\nexport default Willow;\n","import { WillowDark as WillowDarkCore } from '@svar-ui/react-core';\nimport './WillowDark.css';\n\nfunction WillowDark({ fonts = true, children }) {\n  if (children) {\n    return <WillowDarkCore fonts={fonts}>{children}</WillowDarkCore>;\n  } else {\n    return <WillowDarkCore fonts={fonts} />;\n  }\n}\n\nexport default WillowDark;\n","import Grid from './components/Grid.jsx';\nimport HeaderMenu from './components/menus/HeaderMenu.jsx';\nimport Tooltip from './components/Tooltip.jsx';\nimport ContextMenu from './components/menus/ContextMenu.jsx';\nimport Toolbar from './components/Toolbar.jsx';\n\nimport Material from './themes/Material.jsx';\nimport Willow from './themes/Willow.jsx';\nimport WillowDark from './themes/WillowDark.jsx';\n\nexport {\n  getEditorConfig,\n  defaultMenuOptions,\n  defaultToolbarButtons,\n} from '@svar-ui/grid-store';\n\nimport { setEnv, env } from '@svar-ui/lib-dom';\nsetEnv(env);\n\nexport {\n  Grid,\n  HeaderMenu,\n  Tooltip,\n  ContextMenu,\n  Material,\n  Willow,\n  WillowDark,\n  Toolbar,\n};\n"],"names":["store","createContext","onresize","node","handler","ro","data","SHIFT","LONG_TOUCH_DELAY","getID","id","getOffset","box","body","top","left","getPos","ev","offset","reorder","config","cfg","context","touchTimer","startPos","started","touched","container","resetTimer","down","source","locate","move","p","start","end","scrollLeft","scrollTop","up","handleMouseDown","preventUserSelect","handleMouseMove","handleMouseUp","handleTouchStart","handleTouchEnd","handleTouchMove","handleContext","preventDefault","hasDraggable","full","SCROLL_SPEED_DELTA","initScrollState","tryAutoScroll","dragScrollConfig","bottom","sense","xScroll","yScroll","rPos","newDirX","newDirY","resetAutoScroll","startAutoScroll","dir","autoScroll","x","y","autoXScroll","autoYScroll","scroll","autoScrollTo","value","mode","getStyle","width","flexgrow","fixed","right","height","style","getCssName","column","cell","columnStyle","css","pos","Cell","props","row","cellStyle","children","focusable","setFocusable","useWritableProp","api","useContext","storeContext","focusCell","useStore","search","shouldHighlight","useMemo","buildCellCss","columnStyleFn","cellStyleFn","isDraggable","cellElRef","useRef","useEffect","toggleFocusAction","useCallback","highlightText","text","regex","className","shadowToggle","fixedRightToggle","CellComponent","jsxs","jsx","Fragment","action","getRenderValue","highlight","index","resize","dx","Component","filter","filterValue","filterRows","Text","Richselect","options","getOptions","template","d","getValue","opt","handleKeyDown","RichSelect","option","filters","Filter","filterValues","HeaderCell","lastRow","sortRow","bodyHeight","hasSplit","sortMarksValue","sortMark","startRef","resizeColumn","inProgress","sort","order","collapse","toggleCollapseColumn","toggleSortColumn","isCollapsed","overlay","collapsedTextStyle","getCell","key","collapsedClassName","normalClassName","gripRef","cleanup","FooterCell","React","HeaderFooter","deltaLeft","contentWidth","columns","type","sizes","split","rowHeights","renderedHeader","res","rowsCount","ri","inSpan","col","ci","isCommunity","getColumn","c","isLast","ind","idx","isSort","i","Overlay","isComponent","prop","actions","editor","setValue","useState","updateValue","closeAndSave","Combo","onAction","setText","filterOptions","setFilterOptions","a","navigate","keydown","ready","handleChange","e","nextText","inputRef","SuggestDropdown","Datepicker","nodeRef","Dropdown","Calendar","setKeydown","editors","Editor","closeEditor","ignore","save","ignoreFocus","cancel","keyHandler","computedStyle","ed","rootRef","destroy","clickOutside","role","ariaReadonly","_columns","getColumnCss","CellComp","styleObject","getPrintCellStyle","getPrintFilterValue","Grid","rowStyle","header","footer","headerColumns","getHeaderFooterPrintColumns","footerColumns","isDraggableIcon","rowIndex","Print","restProps","skin","grids","getPrintColumns","target","cloned","rule","cols","Layout","multiselect","onReorder","autoRowHeight","clientWidth","clientHeight","responsiveLevel","hotkeysConfig","dynamic","selectedRows","selectionChanged","useStoreWithCounter","selectState","editorState","tree","printConfig","undoState","rowHeightFromData","SCROLLSIZE","setSCROLLSIZE","getScrollSize","setScrollLeft","setScrollTop","hasAny","defaultRowHeight","tableNodeRef","dragItem","setDragItem","dragNode","setDragNode","leftColumns","rightColumns","centerColumns","center","fullWidth","acc","EXTRACOLUMNS","getHeaderPosition","delta","spanStartInd","h","renderColumns","dataCols","headerCols","footerCols","sum","rightSpanDelta","hCell","colspan","diff","headerPos","footerPos","dh","csH","df","csF","headerHeight","footerHeight","hasHScroll","visibleRowsHeight","visibleRows","rowHeightsRef","renderedHeight","setRenderedHeight","renderEnd","setRenderEnd","renderRows","deltaTop","EXTRAROWS","st","startInd","topHeight","visibleRowsCount","currentHeight","totalCount","fullHeight","count","totalHeight","hasVScroll","globalWidth","lastCallRef","dataRows","visibleSelection","s","r","renderStart","onScroll","lockSelection","checkDraggable","postDragRef","movementYRef","bodyClickHandlers","rowId","locateAttr","toggle","range","startDrag","sourceNode","from","itemNode","element","offsetX","vScrollSize","itemPos","moveDrag","min","max","targetRow","to","toId","rowHeight","targetRect","dragNodePos","targetNodePos","initialMode","endDrag","div","styleWidth","dataElRef","adjustHeight","rh","re","focus","setFocus","cind","scrollRef","dragState","drag","hotkeys","defaultHotkeys","v","scrollConfig","scrollTo","bodyRef","result","delegateClick","gridClassName","rIndex","isSelected","isInactive","rowClass","rowStyleProp","camelize","part","forwardRef","select","autoConfig","init","responsive","sortMarks","undo","ref","restPropsRef","dataStore","DataStore","writable","firstInRoute","lastInRouteRef","EventBusRouter","b","name","setClientWidth","setClientHeight","setResponsiveLevel","responsiveConfig","setResponsiveConfig","finalColumns","test","autoCols","finalSizes","rect","newLevel","level","_skin","initOnceRef","prev","useImperativeHandle","StoreContext","Locale","en","HeaderMenuItem","item","HeaderMenu","registerMenuItem","getLabel","headerMenuClick","open","rColumns","useStoreLater","headerMenuOptions","ContextMenu","Tooltip","Content","areaRef","tooltipRef","areaCoords","setAreaCoords","tooltipData","setTooltipData","setPos","findAttribute","colId","tooltipCoords","newLeft","newTop","timerRef","TIMEOUT","debounce","code","clientX","getTooltipData","getTooltipText","targetCoords","areaEl","areaRect","defaultMenuOptions","at","resolver","dataKey","onClick","i18n","_","locale","normalizedOptions","filtered","filterItems","normalized","assignChecks","applyLocale","op","finalOptions","opts","disabled","getItem","handleClicks","handleAction","items","resolverProp","WxContextMenu","ToolbarComponent","defaultToolbarButtons","history","rowActions","historyActions","normalizedItems","buttons","finalButtons","selected","Toolbar","Material","fonts","CoreMaterial","Willow","WillowCore","WillowDark","WillowDarkCore","setEnv","env"],"mappings":"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"}
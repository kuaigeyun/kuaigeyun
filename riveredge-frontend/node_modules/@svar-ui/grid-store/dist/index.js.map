{"version":3,"file":"index.js","sources":["../../node_modules/@wx/lib-state/dist/index.js","../src/editors.ts","../src/export/index.ts","../src/export/csv.ts","../src/export/excel.pro.ts","../src/print.ts","../src/HistoryManager.ts","../src/package.ts","../src/sort.ts","../src/sizes.ts","../src/filters.ts","../src/DataStore.ts","../../node_modules/@wx/lib-dom/dist/index.js","../src/hotkeys.ts","../src/scroll.ts","../src/helpers/assignChecks.ts","../src/helpers/toolbarButtons.ts","../src/helpers/menuOptions.ts","../src/helpers/actionHandlers.ts"],"sourcesContent":["// src/helpers.ts\nvar iid = (/* @__PURE__ */ new Date()).valueOf();\nvar uid = () => iid++;\nfunction tempID() {\n  return \"temp://\" + iid++;\n}\nfunction isTempID(v) {\n  return typeof v === \"string\" && v.length === 20 && parseInt(v.substr(7)) > 1e12;\n}\nfunction isSameObject(left, right) {\n  if (Object.keys(left).length !== Object.keys(right).length) return false;\n  for (const key in right) {\n    const v = left[key];\n    const nv = right[key];\n    if (!isSame(v, nv)) return false;\n  }\n  return true;\n}\nfunction isSame(v, nv) {\n  const primitiveValue = typeof v === \"number\" || typeof v === \"string\" || typeof v === \"boolean\" || v === null;\n  if (primitiveValue) return v === nv;\n  if (typeof v !== typeof nv) return false;\n  if ((v === null || nv === null) && v !== nv) return false;\n  if (v instanceof Date && nv instanceof Date && v.getTime() !== nv.getTime())\n    return false;\n  if (typeof v === \"object\") {\n    if (Array.isArray(v) && Array.isArray(nv)) {\n      if (v.length !== nv.length) return false;\n      for (let i = v.length - 1; i >= 0; i--) {\n        if (!isSame(v[i], nv[i])) return false;\n      }\n      return true;\n    } else {\n      return isSameObject(v, nv);\n    }\n  }\n  return v === nv;\n}\nfunction deepCopy(obj) {\n  if (typeof obj !== \"object\") return obj;\n  if (obj === null) return obj;\n  if (obj instanceof Date) return new Date(obj);\n  if (obj instanceof Array) return obj.map(deepCopy);\n  const out = {};\n  for (const key in obj) {\n    out[key] = deepCopy(obj[key]);\n  }\n  return out;\n}\n\n// src/DataArray.ts\nvar _DataArray = class {\n  constructor(raw) {\n    this._data = raw;\n    this._pool = /* @__PURE__ */ new Map();\n    for (let i = 0; i < raw.length; i++) {\n      const obj = raw[i];\n      this._pool.set(obj.id, obj);\n    }\n  }\n  add(raw) {\n    raw = { id: uid(), ...raw };\n    this._data.push(raw);\n    this._pool.set(raw.id, raw);\n  }\n  update(id, raw) {\n    const index = this._data.findIndex((link) => link.id == id);\n    const old = this._data[index];\n    const updated = { ...old, ...raw };\n    this._data[index] = updated;\n    this._pool.set(updated.id, updated);\n  }\n  remove(id) {\n    this._data = this._data.filter((a) => a.id != id);\n    this._pool.delete(id);\n  }\n  filter(cb) {\n    this._data = this._data.filter((x) => {\n      const check = cb(x);\n      if (!check) this._pool.delete(x.id);\n      return check;\n    });\n  }\n  byId(id) {\n    return this._pool.get(id);\n  }\n  map(cb) {\n    return this._data.map(cb);\n  }\n  forEach(cb) {\n    this._data.forEach(cb);\n  }\n};\n\n// src/DataTree.ts\nvar DataTree = class {\n  constructor(raw) {\n    const top = {\n      id: 0,\n      $level: 0,\n      data: [],\n      parent: null\n    };\n    const items = /* @__PURE__ */ new Map();\n    items.set(0, top);\n    this._pool = items;\n    if (raw && raw.length) this.parse(raw, 0);\n  }\n  parse(raw, parent) {\n    const items = this._pool;\n    for (let i = 0; i < raw.length; i++) {\n      const obj = raw[i];\n      obj.parent = obj.parent || parent;\n      obj.data = null;\n      items.set(obj.id, obj);\n    }\n    for (let i = 0; i < raw.length; i++) {\n      const obj = raw[i];\n      const temp = items.get(obj.parent);\n      if (temp) {\n        if (!temp.data) temp.data = [];\n        temp.data.push(obj);\n      }\n    }\n    const top = items.get(parent);\n    this.setLevel(top, top.$level + 1, false);\n  }\n  add(raw, index) {\n    const parent = this._pool.get(raw.parent || 0);\n    raw.$level = parent.$level + 1;\n    this._pool.set(raw.id, raw);\n    if (parent.data) {\n      if (index === -1) parent.data = [...parent.data, raw];\n      else insertElement(parent, index, raw);\n    } else parent.data = [raw];\n  }\n  addAfter(raw, after) {\n    if (!after) {\n      return this.add(raw, -1);\n    }\n    const node = this.byId(after);\n    const parent = this.byId(node.parent);\n    const index = indexById(parent, node.id) + 1;\n    raw.parent = parent.id;\n    raw.$level = parent.$level + 1;\n    this.add(raw, index);\n  }\n  remove(id) {\n    const obj = this._pool.get(id);\n    this._remove(obj);\n    const parent = this._pool.get(obj.parent);\n    parent.data = parent.data.filter((a) => a.id != id);\n    this._clearBranch(parent);\n  }\n  _remove(obj) {\n    if (obj.data) {\n      obj.data.forEach((i) => this._remove(i));\n    }\n    this._pool.delete(obj.id);\n  }\n  update(id, values) {\n    let obj = this._pool.get(id);\n    const branch = this._pool.get(obj.parent);\n    const index = indexById(branch, obj.id);\n    obj = { ...obj, ...values };\n    if (branch && index >= 0) {\n      branch.data[index] = obj;\n      branch.data = [...branch.data];\n    }\n    this._pool.set(obj.id, obj);\n  }\n  move(id, mode, target) {\n    const now = this._pool.get(id);\n    const dropChild = mode === \"child\";\n    const tobj = this._pool.get(target);\n    const tLevel = tobj.$level + (dropChild ? 1 : 0);\n    if (!now || !tobj) return;\n    const parent = this._pool.get(now.parent);\n    const newParent = dropChild ? tobj : this._pool.get(tobj.parent);\n    if (!newParent.data) newParent.data = [];\n    const index = indexById(parent, now.id);\n    deleteElement(parent, index);\n    const newIndex = dropChild ? newParent.data.length : indexById(newParent, tobj.id) + (mode === \"after\" ? 1 : 0);\n    insertElement(newParent, newIndex, now);\n    if (parent.id === newParent.id && index === newIndex) return null;\n    now.parent = newParent.id;\n    if (now.$level !== tLevel) {\n      now.$level = tLevel;\n      this.setLevel(now, tLevel + 1, true);\n    }\n    this.update(now.id, now);\n    this._clearBranch(parent);\n  }\n  _clearBranch(obj) {\n    if (obj.data && !obj.data.length) {\n      if (obj.open) delete obj.open;\n      this.update(obj.id, { data: null });\n    }\n  }\n  toArray() {\n    const out = [];\n    const kids = this._pool.get(0).data;\n    if (kids) toArray(kids, out);\n    return out;\n  }\n  byId(id) {\n    return this._pool.get(id);\n  }\n  getBranch(id) {\n    return this._pool.get(id).data;\n  }\n  forEach(cb) {\n    this._pool.forEach((value, key) => {\n      if (key !== 0) cb(value);\n    });\n  }\n  eachChild(cb, parent) {\n    const p = this.byId(parent);\n    if (!p || !p.data) return;\n    p.data.forEach((child, index) => {\n      cb(this.byId(child.id), index);\n      this.eachChild(cb, child.id);\n    });\n  }\n  setLevel(root, level, copy) {\n    if (!root.data) return;\n    root.data = root.data.map((child) => {\n      if (copy) {\n        child = { ...child };\n        this._pool.set(child.id, child);\n      }\n      child.$level = level;\n      if (child.data) this.setLevel(child, level + 1, copy);\n      return child;\n    });\n  }\n};\nfunction toArray(line, out) {\n  line.forEach((a) => {\n    out.push(a);\n    if (a.open === true) {\n      toArray(a.data, out);\n    }\n  });\n}\nfunction deleteElement(obj, index) {\n  const newData = [...obj.data];\n  newData.splice(index, 1);\n  obj.data = newData;\n}\nfunction insertElement(obj, index, item) {\n  const newData = [...obj.data];\n  newData.splice(index, 0, item);\n  obj.data = newData;\n}\nfunction indexById(parentNode, id) {\n  return parentNode?.data.findIndex(\n    (child) => child.id === id\n  );\n}\n\n// src/Store.ts\nvar STORE_SET_SILENT = 2;\nvar Store = class {\n  constructor(config) {\n    if (config) {\n      this._writable = config.writable;\n      this._async = config.async;\n    }\n    this._values = {};\n    this._state = {};\n  }\n  setState(data, mode = 0) {\n    const signals = {};\n    this._wrapProperties(\n      data,\n      this._state,\n      this._values,\n      \"\",\n      signals,\n      mode\n    );\n    return signals;\n  }\n  getState() {\n    return this._values;\n  }\n  getReactive() {\n    return this._state;\n  }\n  _wrapProperties(data, state, values, parent, signals, mode) {\n    for (const key in data) {\n      const os = state[key];\n      const ov = values[key];\n      const nv = data[key];\n      if (os) {\n        if (ov === nv && typeof nv !== \"object\") continue;\n        if (nv instanceof Date) {\n          if (ov instanceof Date && ov.getTime() === nv.getTime()) continue;\n        }\n      }\n      const fullKey = parent + (parent ? \".\" : \"\") + key;\n      if (os) {\n        if (os.__parse(nv, fullKey, signals, mode)) values[key] = nv;\n        if (mode & STORE_SET_SILENT) signals[fullKey] = os.__trigger;\n        else os.__trigger();\n      } else {\n        if (nv && nv.__reactive) {\n          state[key] = this._wrapNested(nv, nv, fullKey, signals);\n        } else {\n          state[key] = this._wrapWritable(nv);\n        }\n        values[key] = nv;\n      }\n      signals[fullKey] = signals[fullKey] || null;\n    }\n  }\n  _wrapNested(data, values, fullKey, signals) {\n    const state = this._wrapWritable(data);\n    this._wrapProperties(data, state, values, fullKey, signals, 0);\n    state.__parse = (v, fullKey2, signals2, mode) => {\n      this._wrapProperties(v, state, values, fullKey2, signals2, mode);\n      return false;\n    };\n    return state;\n  }\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  _wrapWritable(val) {\n    const ss = [];\n    const __triggerSync = function() {\n      for (let i = 0; i < ss.length; i++) {\n        ss[i](val);\n      }\n    };\n    const __trigger = () => {\n      if (ss.length) {\n        if (this._async) setTimeout(__triggerSync, 1);\n        else __triggerSync();\n      }\n    };\n    const subscribe = (fn) => {\n      ss.push(fn);\n      if (this._async) setTimeout(fn, 1, val);\n      else fn(val);\n      return () => {\n        const i = ss.indexOf(fn);\n        if (i >= 0) ss.splice(i, 1);\n      };\n    };\n    const __parse = function(v) {\n      val = v;\n      return true;\n    };\n    return {\n      subscribe,\n      __trigger,\n      __parse\n    };\n  }\n};\nfunction markReactive(t, nested) {\n  Object.defineProperty(t, \"__reactive\", {\n    value: true,\n    enumerable: false,\n    writable: false\n  });\n  if (nested === true) {\n    for (const key in t) {\n      const sub = t[key];\n      if (typeof sub === \"object\" && sub !== null) {\n        markReactive(sub, true);\n      }\n    }\n  }\n  return t;\n}\n\n// src/DataRouter.ts\nvar DataRouter = class {\n  constructor(s, r, p, b) {\n    if (typeof s === \"function\") this._setter = s;\n    else this._setter = s.setState.bind(s);\n    this._routes = r;\n    this._parsers = p;\n    this._prev = {};\n    this._triggers = /* @__PURE__ */ new Map();\n    this._sources = /* @__PURE__ */ new Map();\n    this._routes.forEach((a) => {\n      a.in.forEach((k) => {\n        const arr = this._triggers.get(k) || [];\n        arr.push(a);\n        this._triggers.set(k, arr);\n      });\n      a.out.forEach((k) => {\n        const h = this._sources.get(k) || {};\n        a.in.forEach((i) => h[i] = true);\n        this._sources.set(k, h);\n      });\n    });\n    this._routes.forEach((a) => {\n      a.length = Math.max(\n        ...a.in.map((key) => _calckSize(key, this._sources, 1))\n      );\n    });\n    this._bus = b;\n  }\n  init(cfg) {\n    const next = {};\n    for (const key in cfg) {\n      if (this._prev[key] !== cfg[key]) {\n        const parser = this._parsers[key];\n        next[key] = parser ? parser(cfg[key]) : cfg[key];\n      }\n    }\n    this._prev = this._prev ? { ...this._prev, ...cfg } : { ...cfg };\n    this.setState(next);\n    if (this._bus) this._bus.exec(\"init-state\", next);\n  }\n  setStateAsync(updates) {\n    const signals = this._setter(updates, STORE_SET_SILENT);\n    if (this._async) {\n      Object.assign(this._async.signals, signals);\n    } else {\n      this._async = {\n        signals,\n        timer: setTimeout(this._applyState.bind(this), 1)\n      };\n    }\n    return signals;\n  }\n  _applyState() {\n    const obj = this._async;\n    if (!obj) return;\n    this._async = null;\n    this._triggerUpdates(obj.signals, []);\n    for (const key in obj.signals) {\n      const h = obj.signals[key];\n      if (h) h();\n    }\n  }\n  setState(updates, ctx = []) {\n    const signals = this._setter(updates);\n    this._triggerUpdates(signals, ctx);\n    return signals;\n  }\n  _triggerUpdates(signals, ctx) {\n    const keys = Object.keys(signals);\n    const needExec = !ctx.length;\n    ctx = ctx || [];\n    for (let i = 0; i < keys.length; i++) {\n      const key = keys[i];\n      const trgs = this._triggers.get(key);\n      if (trgs) {\n        trgs.forEach((a) => {\n          if (ctx.indexOf(a) == -1) {\n            ctx.push(a);\n          }\n        });\n      }\n    }\n    if (needExec) {\n      this._execNext(ctx);\n    }\n  }\n  _execNext(ctx) {\n    while (ctx.length) {\n      ctx.sort((a, b) => a.length < b.length ? 1 : -1);\n      const next = ctx[ctx.length - 1];\n      ctx.splice(ctx.length - 1);\n      next.exec(ctx);\n    }\n  }\n};\nfunction _calckSize(key, sources, prev) {\n  const next = sources.get(key);\n  if (!next) return prev;\n  const sizes = Object.keys(next).map((a) => _calckSize(a, sources, prev + 1));\n  return Math.max(...sizes);\n}\n\n// src/EventBus.ts\nvar EventBus = class {\n  constructor() {\n    this._nextHandler = null;\n    this._handlers = {};\n    this._tag = /* @__PURE__ */ new WeakMap();\n    this.exec = this.exec.bind(this);\n  }\n  on(name, handler, config) {\n    let prev = this._handlers[name];\n    if (!prev) {\n      prev = this._handlers[name] = [handler];\n    } else {\n      if (config && config.intercept) prev.unshift(handler);\n      else prev.push(handler);\n    }\n    if (config && config.tag) this._tag.set(handler, config.tag);\n  }\n  intercept(name, handler, config) {\n    this.on(name, handler, { ...config, intercept: true });\n  }\n  detach(tag) {\n    for (const key in this._handlers) {\n      const stack = this._handlers[key];\n      for (let i = stack.length - 1; i >= 0; i--) {\n        if (this._tag.get(stack[i]) === tag) {\n          stack.splice(i, 1);\n        }\n      }\n    }\n  }\n  async exec(name, ev) {\n    const stack = this._handlers[name];\n    if (stack) {\n      for (let i = 0; i < stack.length; i++) {\n        const res = stack[i](ev);\n        if (res === false) return;\n        if (res && res.then) {\n          const res2 = await res;\n          if (res2 === false) return;\n        }\n      }\n    }\n    if (this._nextHandler) await this._nextHandler.exec(name, ev);\n    return ev;\n  }\n  setNext(next) {\n    return this._nextHandler = next;\n  }\n};\n\n// src/EventResolver.ts\nvar EventResolver = class {\n  constructor(key) {\n    this._key = key;\n    this._nextHandler = null;\n    this.exec = this.exec.bind(this);\n  }\n  async exec(name, ev) {\n    if (ev && ev[this._key]) await ev[this._key](ev);\n    if (this._nextHandler) {\n      await this._nextHandler.exec(name, ev);\n    }\n    return ev;\n  }\n  setNext(next) {\n    return this._nextHandler = next;\n  }\n};\n\n// src/EventBusRouter.ts\nvar EventBusRouter = class {\n  constructor(dispatch) {\n    this._nextHandler = null;\n    this._dispatch = dispatch;\n    this.exec = this.exec.bind(this);\n  }\n  async exec(name, ev) {\n    this._dispatch(name, ev);\n    if (this._nextHandler) await this._nextHandler.exec(name, ev);\n    return ev;\n  }\n  setNext(next) {\n    return this._nextHandler = next;\n  }\n};\n\nexport { _DataArray as DataArray, DataRouter, DataTree, EventBus, EventBusRouter, EventResolver, Store, deepCopy, isSame, isTempID, markReactive, tempID, uid };\n//# sourceMappingURL=index.js.map\n//# sourceMappingURL=index.js.map","import type { IColumn, IRow, Value, ValueGetter, ValueSetter } from \"./types\";\n\nimport { uid } from \"@wx/lib-state\";\n\nfunction rawGetter(key: string): ValueGetter {\n\treturn obj => obj[key];\n}\nfunction rawSetter(key: string): ValueSetter {\n\treturn (obj, v) => (obj[key] = v);\n}\n\nexport function getValue(row: IRow, col: IColumn): any {\n\treturn (col.getter || rawGetter(col.id))(row);\n}\n\nexport function setValue(row: IRow, col: IColumn, v: Value): any {\n\treturn (col.setter || rawSetter(col.id))(row, v);\n}\n\nexport function getEditorConfig(columns: IColumn[]) {\n\treturn columns\n\t\t.filter(a => !!a.editor)\n\t\t.map(col => {\n\t\t\tlet obj: any = {\n\t\t\t\tkey: col.id || uid(),\n\t\t\t\tlabel: col.header,\n\t\t\t};\n\t\t\tif (col.options) obj.options = col.options;\n\t\t\tlet editor = col.editor;\n\t\t\tif (typeof editor === \"function\") editor = editor();\n\t\t\tif (typeof editor === \"object\") {\n\t\t\t\tobj = { ...obj, ...editor };\n\t\t\t\tobj.comp = editor.type;\n\t\t\t} else obj.comp = editor;\n\n\t\t\treturn obj;\n\t\t});\n}\n","import type { IColumn, IRow } from \"../types\";\nimport { getValue } from \"../editors\";\nexport function download(blob: any, filename: string) {\n\tconst a = document.createElement(\"a\");\n\ta.href = URL.createObjectURL(blob);\n\ta.download = filename;\n\tdocument.body.appendChild(a);\n\ta.click();\n\tdocument.body.removeChild(a);\n}\n\nexport function getRenderValue(row: IRow, col: IColumn): string {\n\tlet v = getValue(row, col) ?? \"\";\n\tif (col.template) v = col.template(v, row, col);\n\tif (col.optionsMap) {\n\t\tif (Array.isArray(v)) v = v.map(x => col.optionsMap.get(x));\n\t\telse v = col.optionsMap.get(v);\n\t}\n\treturn typeof v === \"undefined\" ? \"\" : v + \"\";\n}\n","import type { IColumn, IExportCell, ICSVOptions, IData } from \"../types\";\nimport { getRenderValue } from \"./index\";\n\nexport function getCsvData(state: Partial<IData>, options: ICSVOptions) {\n\tconst reg = /\\n|\"|;|,/;\n\tlet csv = \"\";\n\n\tconst rowSep = options.rows || \"\\n\";\n\tconst colSep = options.cols || \"\\t\";\n\n\tconst cols = state._columns;\n\tconst data = state.flatData;\n\n\tif (options.header !== false && cols[0].header)\n\t\tcsv = addCsvHeader(\"header\", cols, csv, colSep, rowSep);\n\n\tfor (let r = 0; r < data.length; r++) {\n\t\tconst row: IExportCell[] = [];\n\t\tfor (let c = 0; c < cols.length; c++) {\n\t\t\tlet value = getRenderValue(data[r], cols[c]);\n\n\t\t\tif (reg.test(value)) value = '\"' + value.replace(/\"/g, '\"\"') + '\"';\n\n\t\t\trow.push(value);\n\t\t}\n\t\tcsv += (csv ? rowSep : \"\") + row.join(colSep);\n\t}\n\n\tif (options.footer !== false && cols[0].footer)\n\t\tcsv = addCsvHeader(\"footer\", cols, csv, colSep, rowSep);\n\n\treturn csv;\n}\n\nfunction addCsvHeader(\n\ttype: \"header\" | \"footer\",\n\tcols: IColumn[],\n\tcsv: string,\n\tcolSep: string,\n\trowSep: string\n) {\n\tconst reg = /\\n|\"|;|,/;\n\tfor (let r = 0; r < cols[0][type as keyof IColumn].length; r++) {\n\t\tconst row: IExportCell[] = [];\n\t\tfor (let c = 0; c < cols.length; c++) {\n\t\t\tconst header = cols[c][type as keyof IColumn][r];\n\t\t\tlet value = (header.text || \"\") + \"\";\n\t\t\tif (reg.test(value)) value = '\"' + value.replace(/\"/g, '\"\"') + '\"';\n\t\t\trow.push(value);\n\t\t}\n\t\tcsv += (csv ? rowSep : \"\") + row.join(colSep);\n\t}\n\treturn csv;\n}\n","import type {\n\tIColumn,\n\tIExportCell,\n\tIExportMerged,\n\tIExcelOptions,\n\tIExportColSize,\n\tIExportRowSize,\n\tIData,\n\tTExportStyles,\n\tTSkinName,\n\tIDataHash,\n\tValue,\n} from \"../types\";\nimport { getRenderValue } from \"./index\";\nimport { getValue } from \"../editors\";\nimport { isSame } from \"@wx/lib-state\";\n\nexport function getExcelData(\n\tstate: Partial<IData>,\n\toptions: IExcelOptions,\n\tstyles: IDataHash<any>[]\n) {\n\tconst cells: IExportCell[][] = [];\n\tconst merged: IExportMerged[] = [];\n\tconst colSizes: IExportColSize[] = [];\n\tlet rowSizes: IExportRowSize[] = [];\n\tconst cols = state._columns;\n\tconst data = state.flatData;\n\tconst sizes = state._sizes;\n\n\tfor (const c of cols)\n\t\tcolSizes.push({\n\t\t\twidth: c.flexgrow ? sizes.columnWidth : c.width,\n\t\t});\n\n\tlet rIndex = 0;\n\n\tif (options.header !== false && cols[0].header) {\n\t\taddExcelHeader(\"header\", cols, cells, merged, rIndex, options, styles);\n\n\t\trowSizes = rowSizes.concat(\n\t\t\tsizes.headerRowHeights.map(height => ({ height }))\n\t\t);\n\t\trIndex += (<any>cols[0].header).length;\n\t}\n\n\tfor (let r = 0; r < data.length; r++) {\n\t\tconst dataRow: IExportCell[] = [];\n\t\tfor (let c = 0; c < cols.length; c++) {\n\t\t\tconst row = data[r];\n\t\t\tconst col = cols[c];\n\t\t\tconst value = getValue(row, col) ?? \"\";\n\t\t\tlet text = getRenderValue(row, col);\n\t\t\tlet newStyle;\n\t\t\tif (options.cellStyle)\n\t\t\t\tnewStyle = options.cellStyle(value, row, col);\n\n\t\t\tif (options.cellTemplate) {\n\t\t\t\ttext = options.cellTemplate(value, row, col) ?? text;\n\t\t\t}\n\n\t\t\tconst result = prepareCellValues(text, 2, newStyle, styles);\n\n\t\t\tdataRow.push(result);\n\t\t}\n\n\t\tcells.push(dataRow);\n\t\trowSizes.push({ height: sizes.rowHeight });\n\t}\n\trIndex += data.length;\n\n\tif (options.footer !== false && cols[0].footer) {\n\t\taddExcelHeader(\"footer\", cols, cells, merged, rIndex, options, styles);\n\t\trowSizes = rowSizes.concat(\n\t\t\tsizes.footerRowHeights.map(height => ({ height }))\n\t\t);\n\t}\n\treturn { cells, merged, rowSizes, colSizes, styles };\n}\n\nfunction addExcelHeader(\n\ttype: \"header\" | \"footer\",\n\tcols: IColumn[],\n\tcells: IExportCell[][],\n\tmerged: IExportMerged[],\n\trIndex: number,\n\toptions: IExcelOptions,\n\tstyles: IDataHash<any>[]\n) {\n\tfor (let r = 0; r < cols[0][type as keyof IColumn].length; r++) {\n\t\tconst row: IExportCell[] = [];\n\t\tfor (let c = 0; c < cols.length; c++) {\n\t\t\tconst header = cols[c][type as keyof IColumn][r];\n\t\t\tconst colspan = header.colspan ? header.colspan - 1 : 0;\n\t\t\tconst rowspan = header.rowspan ? header.rowspan - 1 : 0;\n\t\t\tif (colspan || rowspan) {\n\t\t\t\tmerged.push({\n\t\t\t\t\tfrom: { row: r + rIndex, column: c },\n\t\t\t\t\tto: { row: r + rIndex + rowspan, column: c + colspan },\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tlet v = header.text ?? \"\";\n\t\t\tlet newStyle;\n\n\t\t\tif (options.headerCellStyle)\n\t\t\t\tnewStyle = options.headerCellStyle(v, header, cols[c], type);\n\n\t\t\tif (options.headerCellTemplate)\n\t\t\t\tv = options.headerCellTemplate(v, header, cols[c], type) ?? v;\n\n\t\t\tlet s;\n\t\t\tif (type == \"header\") {\n\t\t\t\tif (r == cols[0][type as keyof IColumn].length - 1) s = 1;\n\t\t\t\telse s = 0;\n\t\t\t} else if (r) s = 4;\n\t\t\telse s = 3;\n\n\t\t\tconst result = prepareCellValues(v, s, newStyle, styles);\n\t\t\trow.push(result);\n\t\t}\n\t\tcells.push(row);\n\t}\n}\n\nfunction prepareCellValues(\n\tv: Value,\n\tbaseIndex: number,\n\tnewStyle: IDataHash<any>,\n\tstyles: IDataHash<any>[]\n) {\n\tlet s = baseIndex;\n\tif (v && v instanceof Date) {\n\t\tv = getExcelDate(v);\n\t\tnewStyle = newStyle || {};\n\t\tnewStyle.format = newStyle.format || \"dd/mm/yyyy\";\n\t}\n\tif (newStyle) {\n\t\tnewStyle = { ...styles[baseIndex], ...newStyle };\n\t\tconst i = styles.findIndex(style => isSame(style, newStyle));\n\t\tif (i < 0) {\n\t\t\tstyles.push(newStyle);\n\t\t\ts = styles.length - 1;\n\t\t} else s = i;\n\t}\n\treturn { v: v + \"\", s };\n}\n\nexport function getExportStyles(skin: TSkinName): TExportStyles {\n\tconst fontColor = {\n\t\tmaterial: \"#000000\",\n\t\twillow: \"#000000\",\n\t\t\"willow-dark\": \"#ffffff\",\n\t};\n\n\tconst bg = {\n\t\tmaterial: \"none\",\n\t\twillow: \"none\",\n\t\t\"willow-dark\": \"#2a2b2d\",\n\t};\n\tconst headerBg = {\n\t\tmaterial: \"#fafafb\",\n\t\twillow: \"#f2f3f7\",\n\t\t\"willow-dark\": \"#20262b\",\n\t};\n\n\tconst border = {\n\t\tmaterial: \"0.5px solid #dfdfdf\",\n\t\twillow: \"0.5px solid #e6e6e6\",\n\t\t\"willow-dark\": \"0.5px solid #384047\",\n\t};\n\n\tconst headerBorderColor = {\n\t\tmaterial: \"#dfdfdf\",\n\t\twillow: \"#e6e6e6\",\n\t\t\"willow-dark\": \"#384047\",\n\t};\n\n\tconst color = fontColor[skin];\n\tconst hBorder = \"0.5px solid \" + headerBorderColor[skin];\n\tconst align = {\n\t\tverticalAlign: \"center\",\n\t\talign: \"left\",\n\t};\n\tconst headerStyles = {\n\t\tfontWeight: \"bold\",\n\t\tcolor,\n\t\tbackground: headerBg[skin],\n\t\t...align,\n\t\tborderBottom: hBorder,\n\t\tborderRight: hBorder,\n\t};\n\n\tconst styles = {\n\t\tcell: {\n\t\t\tcolor,\n\t\t\tbackground: bg[skin],\n\t\t\tborderBottom: border[skin],\n\t\t\tborderRight: border[skin],\n\t\t\t...align,\n\t\t},\n\t\theader: { ...headerStyles },\n\t\tfooter: { ...headerStyles },\n\t};\n\treturn styles;\n}\n\nfunction getExcelDate(date: Date): number {\n\tif (!date) return null;\n\tconst returnDateTime =\n\t\t25569 +\n\t\t(date.getTime() - date.getTimezoneOffset() * 60000) / (86400 * 1000);\n\treturn returnDateTime;\n}\n","import type {\n\tIFilterValues,\n\tIPrintConfig,\n\tIRenderColumn,\n\tIRenderHeaderCell,\n\tTColumnType,\n} from \"./types\";\n\n// default config and sizes\nconst MODE = \"portrait\";\nconst PPI = 100;\nconst PAPER = \"a4\";\nconst PAPERS = {\n\ta3: { width: 11.7, height: 16.5 },\n\ta4: { width: 8.27, height: 11.7 },\n\tletter: { width: 8.5, height: 11 },\n};\n\nexport function getPrintColumns(\n\tcolumns: IRenderColumn[],\n\tconfig: IPrintConfig\n) {\n\tconst tables: IRenderColumn[][] = [];\n\n\tlet cols: IRenderColumn[] = [];\n\tlet width: number = 0;\n\n\tconst visibleColumns = columns.filter(col => !col.hidden);\n\n\tconst maxWidth = getPaperWidth(config);\n\n\tvisibleColumns.forEach((v, index) => {\n\t\tif (width + v.width <= maxWidth) {\n\t\t\twidth += v.width;\n\t\t\tcols.push(v);\n\t\t} else {\n\t\t\tif (cols.length) tables.push(cols);\n\n\t\t\tcols = [v];\n\t\t\twidth = v.width;\n\t\t}\n\n\t\tif (index === visibleColumns.length - 1 && cols.length) {\n\t\t\ttables.push(cols);\n\t\t}\n\t});\n\n\treturn tables;\n}\n\nexport function getHeaderFooterPrintColumns(\n\tcolumns: IRenderColumn[],\n\ttype: TColumnType,\n\trowsHeights: number[]\n): IRenderHeaderCell[][] {\n\tconst result: IRenderHeaderCell[][] = [];\n\n\tcolumns.forEach((col, c) => {\n\t\tconst header = col[type];\n\n\t\tfor (let r = 0; r < rowsHeights.length; r++) {\n\t\t\tif (!result[r]) result[r] = [];\n\t\t\tconst hcell = { ...header[r] };\n\n\t\t\tif (result[r][c] !== null) {\n\t\t\t\t// for the case when the сolspan was divided into parts in order to fit on the sheet, need to create new cell\n\t\t\t\tif (!c && !hcell.rowspan && !hcell.colspan) {\n\t\t\t\t\tlet colspan = 1;\n\t\t\t\t\tlet nextCell = columns[c + colspan][type][r];\n\t\t\t\t\tlet width = hcell.width;\n\t\t\t\t\twhile (!nextCell.rowspan && !nextCell.colspan) {\n\t\t\t\t\t\tcolspan++;\n\t\t\t\t\t\tnextCell = columns[c + colspan][type][r];\n\t\t\t\t\t\twidth += nextCell.width;\n\t\t\t\t\t}\n\t\t\t\t\thcell.colspan = colspan;\n\t\t\t\t\thcell.width = width;\n\t\t\t\t\thcell.height = rowsHeights[r];\n\t\t\t\t}\n\t\t\t\tresult[r].push(hcell);\n\n\t\t\t\tif (!hcell.collapsed && hcell.colspan > 1) {\n\t\t\t\t\tlet colstubs = hcell.colspan - 1;\n\t\t\t\t\t// for the case when the сolspan goes beyond the sheet width\n\t\t\t\t\tif (hcell.colspan + c > columns.length) {\n\t\t\t\t\t\tconst colspan =\n\t\t\t\t\t\t\thcell.colspan -\n\t\t\t\t\t\t\t(hcell.colspan + c - columns.length);\n\n\t\t\t\t\t\thcell.colspan = colspan;\n\t\t\t\t\t\thcell.width = columns\n\t\t\t\t\t\t\t.slice(c, c + colstubs + 1)\n\t\t\t\t\t\t\t.reduce((a, b) => a + b.width, 0);\n\n\t\t\t\t\t\tif (colspan > 1) colstubs = colspan - 1;\n\t\t\t\t\t}\n\t\t\t\t\tfor (let y = 0; y < colstubs; y++) result[r].push(null);\n\t\t\t\t}\n\t\t\t\tif (hcell.rowspan > 1) {\n\t\t\t\t\tconst rowstubs = hcell.rowspan;\n\t\t\t\t\tfor (let y = 1; y < rowstubs; y++) {\n\t\t\t\t\t\tif (!result[r + y]) result[r + y] = [];\n\t\t\t\t\t\tresult[r + y].push(null);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (col.collapsed) {\n\t\t\tfor (let i = 0; i < result.length; i++) {\n\t\t\t\tconst rRow = result[i];\n\t\t\t\tconst currentCell = rRow[c];\n\n\t\t\t\tif (currentCell && currentCell.collapsed) {\n\t\t\t\t\trRow[c] = null;\n\t\t\t\t\tif (!i) break;\n\t\t\t\t} else {\n\t\t\t\t\tconst lastCell =\n\t\t\t\t\t\tcurrentCell ||\n\t\t\t\t\t\trRow.findLast(cell => cell?.colspan >= 1);\n\t\t\t\t\tif (lastCell) {\n\t\t\t\t\t\tlastCell.colspan = lastCell.colspan - 1;\n\t\t\t\t\t\tlastCell.width = lastCell.width - col.width;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\n\treturn result.map(row => row.filter(c => c && c.colspan !== 0));\n}\n\nfunction getPaperWidth(config: IPrintConfig) {\n\tconst { mode, ppi, paper } = config;\n\tconst { width, height } = PAPERS[paper];\n\n\treturn getPixels(mode === \"portrait\" ? width : height, ppi);\n}\n\nfunction getPixels(inches: number, ppi: number) {\n\treturn inches * ppi;\n}\n\nexport function normalizePrintConfig(config: IPrintConfig = {}) {\n\tconst { mode, ppi, paper } = config;\n\n\treturn {\n\t\tmode: mode || MODE,\n\t\tppi: ppi || PPI,\n\t\tpaper: paper || PAPER,\n\t};\n}\n\nexport function getPrintCellStyle(\n\tcell: IRenderHeaderCell,\n\tcolumnWidth: number\n) {\n\tif (cell.flexgrow) return `min-width:${columnWidth}px;width:auto`;\n\treturn `width:${cell.width}px; max-width:${cell.width}px; height:${cell.height}px`;\n}\n\nexport function getPrintFilterValue(\n\tfilterValues: IFilterValues,\n\tcolumns: IRenderColumn[],\n\tcell: IRenderHeaderCell\n) {\n\tlet value = filterValues[cell.id];\n\tif (cell.filter.type === \"richselect\" && value) {\n\t\tconst options =\n\t\t\tcell.filter.config?.options ||\n\t\t\tcolumns.find(({ id }) => id == cell.id).options;\n\t\tif (options) {\n\t\t\tvalue = options.find(({ id }) => id == value).label;\n\t\t}\n\t}\n\treturn value ?? \"\";\n}\n","import { deepCopy, EventBus, TID, isSame } from \"@wx/lib-state\";\nimport type { IDataMethodsConfig } from \"./DataStore\";\nimport { getValue } from \"./editors\";\nimport { IColumn, IData, IRow, TMethodsConfig } from \"./types\";\n\ntype ActionType = keyof IDataMethodsConfig;\ninterface ActionData<T extends ActionType> {\n\taction: T;\n\tdata: IDataMethodsConfig[T];\n}\n\ninterface HistoryEntry extends ActionData<ActionType> {\n\tsource: ActionData<ActionType>;\n}\n\nconst COLUMNS_ACTIONS = [\"resize-column\", \"hide-column\", \"update-cell\"];\nconst DATA_ACTIONS = [\"delete-row\", \"update-row\", \"update-cell\"];\nconst FLATDATA_ACTIONS = [\"move-item\"];\nconst PROGRESS_ACTIONS = [\"resize-column\", \"move-item\"];\n\nexport class HistoryManager {\n\tprivate undo: HistoryEntry[] = [];\n\tprivate redo: HistoryEntry[] = [];\n\tprivate progress: Partial<Record<ActionType, boolean>> = {};\n\tprivate in: EventBus<TMethodsConfig, keyof TMethodsConfig>;\n\tprivate getState: () => Partial<IData>;\n\tprivate setState: (state: Partial<IData>) => void;\n\tprivate _previousValues: Partial<IData> = {};\n\n\tconstructor(\n\t\teventBus: EventBus<TMethodsConfig, keyof TMethodsConfig>,\n\t\tstateGetter: () => Partial<IData>,\n\t\tstateSetter: (state: Partial<IData>) => void\n\t) {\n\t\tthis.in = eventBus;\n\t\tthis.getState = stateGetter;\n\t\tthis.setState = stateSetter;\n\t\tthis.setHandlers();\n\n\t\tthis.resetStateHistory();\n\t}\n\n\tgetHandlers(): { [key: string]: { handler: (ev: any) => HistoryEntry } } {\n\t\treturn {\n\t\t\t\"add-row\": {\n\t\t\t\thandler: (ev: IDataMethodsConfig[\"add-row\"]) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\taction: \"delete-row\",\n\t\t\t\t\t\tdata: { id: ev.id },\n\t\t\t\t\t\tsource: { action: \"add-row\", data: ev },\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t},\n\t\t\t\"delete-row\": {\n\t\t\t\thandler: (ev: IDataMethodsConfig[\"delete-row\"]) => {\n\t\t\t\t\tconst { id } = ev;\n\n\t\t\t\t\tconst { data } = this.getPrev();\n\t\t\t\t\tconst rowIndex = data.findIndex(a => a.id == id);\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\taction: \"add-row\",\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\trow: data[rowIndex],\n\t\t\t\t\t\t\tbefore:\n\t\t\t\t\t\t\t\trowIndex < data.length - 1\n\t\t\t\t\t\t\t\t\t? data[rowIndex + 1].id\n\t\t\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsource: { action: \"delete-row\", data: ev },\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t},\n\t\t\t\"update-cell\": {\n\t\t\t\thandler: (ev: IDataMethodsConfig[\"update-cell\"]) => {\n\t\t\t\t\tconst { id, column } = ev;\n\n\t\t\t\t\tconst row = this.getRow(id);\n\t\t\t\t\tconst col = this.getColumn(column);\n\n\t\t\t\t\tconst prevValue = getValue(row, col);\n\t\t\t\t\t// isSame is for dates\n\t\t\t\t\treturn !isSame(prevValue, ev.value)\n\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\taction: \"update-cell\",\n\t\t\t\t\t\t\t\tdata: { id, column, value: prevValue },\n\t\t\t\t\t\t\t\tsource: { action: \"update-cell\", data: ev },\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t: null;\n\t\t\t\t},\n\t\t\t},\n\t\t\t\"update-row\": {\n\t\t\t\thandler: (ev: IDataMethodsConfig[\"update-row\"]) => {\n\t\t\t\t\tconst { id, row } = ev;\n\n\t\t\t\t\tconst rowData = this.getRow(id);\n\t\t\t\t\tfor (const key in row) {\n\t\t\t\t\t\tif (!Object.keys(rowData).includes(key)) {\n\t\t\t\t\t\t\trowData[key] = undefined;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\taction: \"update-row\",\n\t\t\t\t\t\tdata: { id, row: rowData },\n\t\t\t\t\t\tsource: { action: \"update-row\", data: ev },\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t},\n\t\t\t\"copy-row\": {\n\t\t\t\thandler: (ev: IDataMethodsConfig[\"copy-row\"]) => {\n\t\t\t\t\tconst { id } = ev;\n\n\t\t\t\t\tconst { data } = this.getState();\n\t\t\t\t\tconst rowIndex = data.findIndex(a => a.id == id);\n\t\t\t\t\tconst rowData = data[rowIndex];\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\taction: \"delete-row\",\n\t\t\t\t\t\tdata: { id },\n\t\t\t\t\t\tsource: {\n\t\t\t\t\t\t\taction: \"add-row\",\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\t\trow: rowData,\n\t\t\t\t\t\t\t\tbefore:\n\t\t\t\t\t\t\t\t\trowIndex < data.length - 1\n\t\t\t\t\t\t\t\t\t\t? data[rowIndex + 1].id\n\t\t\t\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t},\n\t\t\t\"resize-column\": {\n\t\t\t\thandler: (ev: IDataMethodsConfig[\"resize-column\"]) => {\n\t\t\t\t\tconst { id, width } = ev;\n\t\t\t\t\tconst column = this.getColumn(id);\n\t\t\t\t\tconst { _sizes: sizes } = this.getState();\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\taction: \"resize-column\",\n\t\t\t\t\t\tdata: { id, width: column.width ?? sizes.columnWidth },\n\t\t\t\t\t\tsource: {\n\t\t\t\t\t\t\taction: \"resize-column\",\n\t\t\t\t\t\t\tdata: { id, width },\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t},\n\t\t\t\"hide-column\": {\n\t\t\t\thandler: (ev: IDataMethodsConfig[\"hide-column\"]) => {\n\t\t\t\t\tconst { id } = ev;\n\t\t\t\t\tconst column = this.getColumn(id);\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\taction: \"hide-column\",\n\t\t\t\t\t\tdata: { id, mode: column.hidden },\n\t\t\t\t\t\tsource: {\n\t\t\t\t\t\t\taction: \"hide-column\",\n\t\t\t\t\t\t\tdata: ev,\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t},\n\t\t\t\"collapse-column\": {\n\t\t\t\thandler: (ev: IDataMethodsConfig[\"collapse-column\"]) => {\n\t\t\t\t\tconst { id, row, mode } = ev;\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\taction: \"collapse-column\",\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\trow,\n\t\t\t\t\t\t\tmode: typeof mode === \"boolean\" ? !mode : mode,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsource: { action: \"collapse-column\", data: ev },\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t},\n\t\t\t\"move-item\": {\n\t\t\t\thandler: (ev: IDataMethodsConfig[\"move-item\"]) => {\n\t\t\t\t\tconst { id, target, mode } = ev;\n\t\t\t\t\tconst { flatData } = this.getPrev();\n\n\t\t\t\t\tconst sourceIndex = flatData.findIndex(a => a.id == id);\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\taction: \"move-item\",\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\ttarget: flatData[\n\t\t\t\t\t\t\t\tsourceIndex + (sourceIndex ? -1 : 1)\n\t\t\t\t\t\t\t].id,\n\t\t\t\t\t\t\tmode: sourceIndex ? \"after\" : \"before\",\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsource: {\n\t\t\t\t\t\t\taction: \"move-item\",\n\t\t\t\t\t\t\tdata: { id, target, mode },\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t},\n\t\t\t\"open-row\": {\n\t\t\t\thandler: (ev: IDataMethodsConfig[\"open-row\"]) => {\n\t\t\t\t\tconst { id, nested } = ev;\n\t\t\t\t\treturn {\n\t\t\t\t\t\taction: \"close-row\",\n\t\t\t\t\t\tdata: { id, nested },\n\t\t\t\t\t\tsource: { action: \"open-row\", data: ev },\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t},\n\t\t\t\"close-row\": {\n\t\t\t\thandler: (ev: IDataMethodsConfig[\"close-row\"]) => {\n\t\t\t\t\tconst { id, nested } = ev;\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\taction: \"open-row\",\n\t\t\t\t\t\tdata: { id, nested },\n\t\t\t\t\t\tsource: { action: \"close-row\", data: ev },\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\n\tresetHistory() {\n\t\tthis.undo = [];\n\t\tthis.redo = [];\n\t\tthis.progress = {};\n\n\t\tthis.resetStateHistory();\n\t}\n\n\tprivate getPrev() {\n\t\treturn this._previousValues;\n\t}\n\n\tprivate setHandlers() {\n\t\tconst handlers = this.getHandlers();\n\n\t\tfor (const action in handlers) {\n\t\t\tthis.in.intercept(action as ActionType, (ev: any) => {\n\t\t\t\tif (\n\t\t\t\t\tev.eventSource === \"undo\" ||\n\t\t\t\t\tev.eventSource === \"redo\" ||\n\t\t\t\t\tev.skipUndo\n\t\t\t\t)\n\t\t\t\t\treturn;\n\n\t\t\t\tif (PROGRESS_ACTIONS.includes(action)) {\n\t\t\t\t\tif (\n\t\t\t\t\t\t(ev.inProgress &&\n\t\t\t\t\t\t\t!this.progress[action as ActionType]) ||\n\t\t\t\t\t\ttypeof ev.inProgress !== \"boolean\"\n\t\t\t\t\t) {\n\t\t\t\t\t\tif (FLATDATA_ACTIONS.includes(action))\n\t\t\t\t\t\t\tthis.setPrev(\"flatData\");\n\t\t\t\t\t\tif (COLUMNS_ACTIONS.includes(action))\n\t\t\t\t\t\t\tthis.setPrev(\"columns\");\n\t\t\t\t\t}\n\t\t\t\t\tthis.progress[action as ActionType] = ev.inProgress;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (DATA_ACTIONS.includes(action)) this.setPrev(\"data\");\n\t\t\t\tif (COLUMNS_ACTIONS.includes(action)) this.setPrev(\"columns\");\n\t\t\t});\n\n\t\t\tthis.in.on(action as ActionType, (ev: any) => {\n\t\t\t\tif (\n\t\t\t\t\tev.eventSource === \"undo\" ||\n\t\t\t\t\tev.eventSource === \"redo\" ||\n\t\t\t\t\tev.skipUndo ||\n\t\t\t\t\tev.inProgress\n\t\t\t\t)\n\t\t\t\t\treturn;\n\n\t\t\t\tconst historyEntry = handlers[action].handler(ev);\n\t\t\t\tif (historyEntry) this.addToHistory(historyEntry);\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate setPrev(prop: keyof IData) {\n\t\t(this._previousValues as any)[prop] = deepCopy(this.getState()[prop]);\n\t}\n\n\tprivate addToHistory(entry: HistoryEntry) {\n\t\tthis.undo.push(entry);\n\t\tthis.redo = [];\n\n\t\tthis.setStateHistory();\n\t}\n\n\thandleUndo() {\n\t\tif (!this.undo.length) return;\n\n\t\tconst action = this.undo.pop();\n\t\tthis.redo.push({ ...action.source, source: action });\n\n\t\tthis.in.exec(action.action, {\n\t\t\t...action.data,\n\t\t\teventSource: \"undo\",\n\t\t} as any);\n\n\t\tthis.setStateHistory();\n\t}\n\n\thandleRedo() {\n\t\tif (!this.redo.length) return;\n\n\t\tconst action = this.redo.pop();\n\t\tthis.undo.push({ ...action.source, source: action });\n\n\t\tthis.in.exec(action.action, {\n\t\t\t...action.data,\n\t\t\teventSource: \"redo\",\n\t\t} as any);\n\n\t\tthis.setStateHistory();\n\t}\n\n\tprivate resetStateHistory() {\n\t\tthis.setState({ history: { undo: 0, redo: 0 } });\n\t}\n\n\tprivate setStateHistory() {\n\t\tthis.setState({\n\t\t\thistory: {\n\t\t\t\tundo: this.undo.length,\n\t\t\t\tredo: this.redo.length,\n\t\t\t},\n\t\t});\n\t}\n\n\tprivate getRow(id: TID): IRow {\n\t\tconst { data } = this.getPrev();\n\n\t\tif (this.getState().tree) return this.getTreeRow(data, id);\n\n\t\treturn data.find(a => a.id == id);\n\t}\n\n\tprivate getTreeRow(data: IRow[], id: TID): IRow {\n\t\tfor (let i = 0; i < data.length; i++) {\n\t\t\tif (data[i].id == id) return data[i];\n\t\t\tif (data[i].data) {\n\t\t\t\tconst res = this.getTreeRow(data[i].data, id);\n\t\t\t\tif (res) return res;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tprivate getColumn(id: TID): IColumn {\n\t\tconst { columns } = this.getPrev();\n\t\treturn columns.find(a => a.id == id);\n\t}\n}\n","// #if [WX_PACKAGE_TYPE=trial]\nfunction checkStrings() {\n\tif (typeof window === \"undefined\") return true;\n\tconst l = location.hostname;\n\tconst t = [\n\t\t// svar.dev\n\t\t\"c3Zhci5kZXY=\",\n\t\t// dhtmlx.com\n\t\t\"ZGh0bWx4LmNvbQ==\",\n\t\t// dhtmlxcode.com\n\t\t\"ZGh0bWx4Y29kZS5jb20=\",\n\t\t// webixcode.com\n\t\t\"d2ViaXhjb2RlLmNvbQ==\",\n\t\t// webix.io\n\t\t\"d2ViaXguaW8=\",\n\t\t// repl.co\n\t\t\"cmVwbC5jbw==\",\n\t\t// csb.app\n\t\t\"Y3NiLmFwcA==\",\n\t\t// replit.dev\n\t\t\"cmVwbGl0LmRldg==\",\n\t];\n\n\tfor (let i = 0; i < t.length; i++) {\n\t\tconst x = window.atob(t[i]);\n\t\tif (x === l || l.endsWith(\".\" + x)) return true;\n\t}\n\n\treturn false;\n}\n\nconst amode = checkStrings();\n\nexport function isValid() {\n\treturn amode;\n}\n\nexport function isExpired() {\n\treturn new Date().valueOf() > 0x00ffffff * 256000;\n}\n\nexport function isBadLuck() {\n\treturn Math.random() < 0.05;\n}\n// #endif\n\nexport function getStamp() {\n\treturn { gen: 1 };\n}\n\nexport function isCommunity() {\n\tlet community = true;\n\t// #if [!(WX_PACKAGE_TYPE=open)]\n\tcommunity = false;\n\t// #endif\n\treturn community;\n}\n","import { getValue } from \"./editors\";\nimport type {\n\tTSortObject,\n\tTSortValue,\n\tTSortConfig,\n\tIColumn,\n\tTSortFunction,\n} from \"./types\";\n\nfunction sortAsc(a: TSortValue, b: TSortValue): number {\n\tif (typeof a === \"undefined\" || a === null) return -1;\n\tif (typeof b === \"undefined\" || b === null) return 1;\n\treturn a === b ? 0 : a > b ? 1 : -1;\n}\n\nfunction sortDesc(a: TSortValue, b: TSortValue): number {\n\treturn -sortAsc(a, b);\n}\n\nfunction sortBy(order: string, column: IColumn) {\n\tif (typeof column.sort === \"function\") {\n\t\treturn function (a: TSortObject, b: TSortObject) {\n\t\t\tconst comparisonResult = (column.sort as TSortFunction)(a, b);\n\t\t\treturn order === \"asc\" ? comparisonResult : -comparisonResult;\n\t\t};\n\t}\n\tconst sortMethod = order === \"asc\" ? sortAsc : sortDesc;\n\treturn function (a: TSortObject, b: TSortObject) {\n\t\treturn sortMethod(getValue(a, column), getValue(b, column));\n\t};\n}\n\nexport function sortByMany(sortArray: TSortConfig[], columns: IColumn[]) {\n\tif (!sortArray || !sortArray.length) return;\n\n\tconst sorts = sortArray.map(item => {\n\t\tconst column = columns.find(c => c.id == item.key);\n\t\treturn sortBy(item.order, column);\n\t});\n\tif (sortArray.length === 1) return sorts[0];\n\n\treturn function (a: TSortObject, b: TSortObject) {\n\t\tfor (let i = 0; i < sorts.length; i++) {\n\t\t\tconst res = sorts[i](a, b);\n\t\t\tif (res !== 0) return res;\n\t\t}\n\t\treturn 0;\n\t};\n}\n","import type {\n\tIRenderColumn,\n\tTColumnType,\n\tIColumn,\n\tIRow,\n\tTSkinName,\n} from \"./types\";\n\nimport { getRenderValue } from \"./export\";\n\nconst BASE_CELL_OFFSET = 28; // base offset for grid cells\nconst SORT_EL_OFFSET = 20; // offset for sort arrows\n\nexport function suggestSkin() {\n\t// FIXME :: Svelte-kit\n\tif (typeof document === \"undefined\") return \"willow\";\n\n\tconst skin = document.querySelector('[class^=\"wx\"][class$=\"theme\"]');\n\tif (!skin) return \"willow\";\n\n\treturn skin.className.substring(3, skin.className.length - 6) as TSkinName;\n}\n\nfunction getTextSize(\n\ttext: string | number | (string | number)[],\n\tcss: string,\n\tskin: string,\n\toffsets?: number[],\n\tbasewidth?: string | number\n): { width: number; height: number } {\n\tconst container = document.createElement(\"div\");\n\tconst content = document.createElement(\"div\");\n\n\tconst target = document.body;\n\tbasewidth = basewidth ? `${basewidth}px` : \"auto\";\n\tlet width;\n\tlet height;\n\n\tcontent.className = css;\n\tcontainer.classList.add(`wx-${skin}-theme`);\n\tcontainer.style.cssText = `height:auto;position:absolute;top:0px;left:100px;overflow:hidden;width=${basewidth};white-space:nowrap;`;\n\n\tcontainer.appendChild(content);\n\ttarget.appendChild(container);\n\n\tif (typeof text != \"object\") text = [text];\n\n\tfor (let i = 0; i < text.length; i++) {\n\t\tcontent.innerText = text[i] + \"\";\n\n\t\tconst rect = container.getBoundingClientRect();\n\t\tconst rectWidth =\n\t\t\tMath.ceil(rect.width) +\n\t\t\t(offsets && offsets.length ? offsets[i] : 0);\n\t\tconst rectHeight = Math.ceil(rect.height);\n\n\t\twidth = Math.max(width || 0, rectWidth);\n\t\theight = Math.max(height || 0, rectHeight);\n\t}\n\n\tcontainer.remove();\n\n\treturn { width, height };\n}\n\nexport function getHeaderFooterHeights(\n\tcolumns: IRenderColumn[],\n\tcondition: TColumnType,\n\trowsCount: number,\n\tdefaultHeight: number,\n\tskin: string\n) {\n\tconst headerRowHeights: number[] = [];\n\n\tfor (let c = 0; c < columns.length; c++) {\n\t\tconst column = columns[c][condition];\n\t\tconst length = column.length;\n\n\t\tfor (let r = 0; r < length; r++) {\n\t\t\tconst { text, vertical, collapsed, rowspan, css } = column[r];\n\n\t\t\tif (!text) {\n\t\t\t\theaderRowHeights[r] = Math.max(\n\t\t\t\t\theaderRowHeights[r] || 0,\n\t\t\t\t\tdefaultHeight\n\t\t\t\t);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet height = 0;\n\n\t\t\tif (vertical && !collapsed) {\n\t\t\t\tlet cellCss = `wx-measure-cell-${condition}`;\n\t\t\t\tcellCss += css ? ` ${css}` : \"\";\n\n\t\t\t\theight = getTextSize(text, cellCss, skin).width;\n\n\t\t\t\t// need to find out if current vertical cell is a rowspan\n\t\t\t\tif ((rowspan > 1 || !column[r + 1]) && rowsCount > r + 1) {\n\t\t\t\t\t// need to calculate previous sum of same rows heights.\n\t\t\t\t\t// if sum is less then current height than need to add diff btw sum and height to each cell\n\t\t\t\t\tconst count = rowspan || rowsCount - r;\n\t\t\t\t\tconst prevHeight = headerRowHeights\n\t\t\t\t\t\t.slice(r, r + count)\n\t\t\t\t\t\t.reduce((sum, value) => sum + value, 0);\n\n\t\t\t\t\tif (prevHeight < height) {\n\t\t\t\t\t\tconst diff = Math.ceil((height - prevHeight) / count);\n\t\t\t\t\t\tfor (let i = r; i < r + count; i++)\n\t\t\t\t\t\t\theaderRowHeights[i] =\n\t\t\t\t\t\t\t\t(headerRowHeights[i] || defaultHeight) + diff;\n\t\t\t\t\t}\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\theaderRowHeights[r] = Math.max(\n\t\t\t\theaderRowHeights[r] || defaultHeight,\n\t\t\t\theight\n\t\t\t);\n\t\t}\n\t}\n\n\treturn headerRowHeights;\n}\n\nexport function getColumnWidth(col: IColumn, data: IRow[], skin: string) {\n\tconst text = [];\n\tconst offsets = [];\n\n\tlet css = \"wx-measure-cell-body\";\n\n\tcss += col.css ? ` ${col.css}` : \"\";\n\n\tfor (let i = 0; i < data.length; i++) {\n\t\tconst row = data[i];\n\t\tconst colText = getRenderValue(row, col);\n\n\t\tif (colText) {\n\t\t\ttext.push(colText);\n\n\t\t\tif (col.treetoggle) {\n\t\t\t\toffsets.push(\n\t\t\t\t\tdata[i].$level * BASE_CELL_OFFSET +\n\t\t\t\t\t\t(data[i].$count ? BASE_CELL_OFFSET : 0) +\n\t\t\t\t\t\t(col.draggable ? BASE_CELL_OFFSET : 0)\n\t\t\t\t);\n\t\t\t} else if (col.draggable) {\n\t\t\t\toffsets.push(BASE_CELL_OFFSET);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn getTextSize(text, css, skin, offsets).width;\n}\n\nexport function getHeaderColWidth(column: IColumn, skin: string): number {\n\tconst css = \"wx-measure-cell-header\";\n\tconst sortElOffset = column.sort ? SORT_EL_OFFSET : 0;\n\tlet header = column.header;\n\tif (typeof header === \"string\")\n\t\treturn getTextSize(header, css, skin).width + sortElOffset;\n\n\tlet width: number;\n\n\tif (!Array.isArray(header)) header = [header];\n\n\tfor (let i = 0; i < header.length; i++) {\n\t\tconst cell = header[i];\n\t\tconst text = typeof cell === \"string\" ? cell : cell.text;\n\t\tconst style = css + (typeof cell === \"string\" ? \"\" : ` ${cell.css}`);\n\t\tlet currWidth = getTextSize(text, style, skin).width;\n\t\tif (i === header.length - 1) currWidth += sortElOffset;\n\n\t\twidth = Math.max(width || 0, currWidth);\n\t}\n\n\treturn width;\n}\n","import { TFilterHandler, TFilterType } from \"./types\";\n\nexport const filtersHandlers: { [key: string]: TFilterHandler } = {\n\ttext: (a: string, b: string) => {\n\t\tif (a)\n\t\t\treturn a.toString().toLowerCase().indexOf(b.toLowerCase()) !== -1;\n\t\treturn !b;\n\t},\n\trichselect: (a: string | number, b: string | number) => {\n\t\tif (typeof b !== \"number\" && !b) return true;\n\t\treturn a == b;\n\t},\n};\n\nexport function getFilterHandler(type: TFilterType): TFilterHandler {\n\treturn filtersHandlers[type];\n}\n","import { Store, EventBus, DataRouter, isSame } from \"@wx/lib-state\";\nimport type { TDataConfig, TWritableCreator, TID } from \"@wx/lib-state\";\nimport { getValue, setValue } from \"./editors\";\nimport { download, getRenderValue } from \"./export\";\nimport { getCsvData } from \"./export/csv\";\n// #if [!(WX_PACKAGE_TYPE=open)]\nimport { getExcelData, getExportStyles } from \"./export/excel.pro\";\n// #endif\nimport { normalizePrintConfig } from \"./print\";\nimport { HistoryManager } from \"./HistoryManager\";\n// #if [WX_PACKAGE_TYPE=trial]\nimport { isValid, isExpired, isBadLuck } from \"./package\";\n// #endif\nimport { isCommunity } from \"./package\";\n\nimport type {\n\tIColumn,\n\tIRenderColumn,\n\tIData,\n\tIDataConfig,\n\tIRenderHeaderCell,\n\tIRow,\n\tTMethodsConfig,\n\tISizeConfig,\n\tIRenderSizes,\n\tIExportOptions,\n\tTColumnType,\n\tTSortValue,\n\tIDataHash,\n\tIFilterValues,\n\tIPrintConfig,\n\tISearchValue,\n} from \"./types\";\nimport { sortByMany } from \"./sort\";\nimport {\n\tgetHeaderFooterHeights,\n\tgetColumnWidth,\n\tgetHeaderColWidth,\n\tsuggestSkin,\n} from \"./sizes\";\nimport { getFilterHandler } from \"./filters\";\n\nexport default class DataStore extends Store<IData> {\n\tpublic in: EventBus<TMethodsConfig, keyof TMethodsConfig>;\n\tprivate _router: DataRouter<IData, IDataConfig, TMethodsConfig>;\n\tprivate _branches: { [key: TID]: IRow };\n\tprivate _xlsxWorker: any;\n\tprivate _historyManager: HistoryManager;\n\n\tconstructor(w: TWritableCreator) {\n\t\tsuper({ writable: w, async: false });\n\n\t\tconst defaultSizes = {\n\t\t\trowHeight: 37,\n\t\t\tcolumnWidth: 160,\n\t\t\theaderHeight: 36,\n\t\t\tfooterHeight: 36,\n\t\t};\n\n\t\tthis._router = new DataRouter(\n\t\t\tsuper.setState.bind(this),\n\t\t\t// data recalculation dependencies\n\t\t\t[\n\t\t\t\t// normalize columns, headers and footers\n\t\t\t\t{\n\t\t\t\t\tin: [\"columns\", \"sizes\", \"_skin\"],\n\t\t\t\t\tout: [\"_columns\", \"_sizes\"],\n\t\t\t\t\texec: (ctx: TDataConfig) => {\n\t\t\t\t\t\tconst { columns, sizes, _skin } = this.getState();\n\t\t\t\t\t\tconst _columns: IRenderColumn[] =\n\t\t\t\t\t\t\tthis.copyColumns(columns);\n\n\t\t\t\t\t\tconst headerRowCount = _columns.reduce(\n\t\t\t\t\t\t\t(a, b) => Math.max(b.header.length, a),\n\t\t\t\t\t\t\t0\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst footerRowCount = _columns.reduce(\n\t\t\t\t\t\t\t(a, b) => Math.max(b.footer.length, a),\n\t\t\t\t\t\t\t0\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\t_columns.forEach(this.setCollapsibleColumns);\n\n\t\t\t\t\t\tconst _sizes: IRenderSizes = this.normalizeSizes(\n\t\t\t\t\t\t\t_columns,\n\t\t\t\t\t\t\tsizes,\n\t\t\t\t\t\t\theaderRowCount,\n\t\t\t\t\t\t\tfooterRowCount,\n\t\t\t\t\t\t\t_skin\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tfor (let i = 0; i < _columns.length; i++) {\n\t\t\t\t\t\t\tthis.normalizeColumns(\n\t\t\t\t\t\t\t\t_columns,\n\t\t\t\t\t\t\t\ti,\n\t\t\t\t\t\t\t\t\"header\",\n\t\t\t\t\t\t\t\theaderRowCount,\n\t\t\t\t\t\t\t\t_sizes\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tthis.normalizeColumns(\n\t\t\t\t\t\t\t\t_columns,\n\t\t\t\t\t\t\t\ti,\n\t\t\t\t\t\t\t\t\"footer\",\n\t\t\t\t\t\t\t\tfooterRowCount,\n\t\t\t\t\t\t\t\t_sizes\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.setState({ _columns, _sizes }, ctx);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tin: [\"data\", \"tree\", \"_filterIds\"],\n\t\t\t\t\tout: [\"flatData\", \"_rowHeightFromData\"],\n\t\t\t\t\texec: (ctx: TDataConfig) => {\n\t\t\t\t\t\tconst {\n\t\t\t\t\t\t\tdata,\n\t\t\t\t\t\t\ttree,\n\t\t\t\t\t\t\tdynamic,\n\t\t\t\t\t\t\t_filterIds: filterIds,\n\t\t\t\t\t\t} = this.getState();\n\n\t\t\t\t\t\tconst filterSet: Set<TID> | null =\n\t\t\t\t\t\t\tfilterIds && new Set(filterIds);\n\n\t\t\t\t\t\tconst flatData = tree\n\t\t\t\t\t\t\t? this.flattenRows(data, [], filterIds)\n\t\t\t\t\t\t\t: filterSet\n\t\t\t\t\t\t\t\t? data.filter(d => filterSet.has(d.id))\n\t\t\t\t\t\t\t\t: data;\n\t\t\t\t\t\tconst hasHeight =\n\t\t\t\t\t\t\t!dynamic && flatData.some(d => d.rowHeight);\n\t\t\t\t\t\tthis.setState(\n\t\t\t\t\t\t\t{ flatData, _rowHeightFromData: hasHeight },\n\t\t\t\t\t\t\tctx\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t\t{\n\t\t\t\t// data initializers\n\t\t\t\tsizes: (v: ISizeConfig) => ({ ...defaultSizes, ...v }),\n\t\t\t}\n\t\t);\n\n\t\tconst inBus = (this.in = new EventBus());\n\n\t\tinBus.on(\n\t\t\t\"close-editor\",\n\t\t\t({ ignore }: IDataMethodsConfig[\"close-editor\"]) => {\n\t\t\t\tconst { editor } = this.getState();\n\t\t\t\tif (editor) {\n\t\t\t\t\tif (!ignore) {\n\t\t\t\t\t\tinBus.exec(\"update-cell\", editor);\n\t\t\t\t\t}\n\t\t\t\t\tthis.setState({ editor: null });\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t\tinBus.on(\n\t\t\t\"open-editor\",\n\t\t\t({ id, column }: IDataMethodsConfig[\"open-editor\"]) => {\n\t\t\t\tlet editor = this.getState().editor;\n\t\t\t\tif (editor) inBus.exec(\"close-editor\", {});\n\n\t\t\t\tconst row = this.getRow(id);\n\t\t\t\tconst col = column\n\t\t\t\t\t? this.getColumn(column)\n\t\t\t\t\t: this.getNextEditor(row);\n\n\t\t\t\tif (col?.editor) {\n\t\t\t\t\tlet columnEditor = col.editor;\n\t\t\t\t\tif (typeof columnEditor === \"function\")\n\t\t\t\t\t\tcolumnEditor = columnEditor(row, col);\n\t\t\t\t\tif (!columnEditor) return;\n\n\t\t\t\t\teditor = {\n\t\t\t\t\t\tcolumn: col.id,\n\t\t\t\t\t\tid,\n\t\t\t\t\t\tvalue: getValue(row, col) ?? \"\",\n\t\t\t\t\t\trenderedValue: getRenderValue(row, col),\n\t\t\t\t\t};\n\n\t\t\t\t\tif (\n\t\t\t\t\t\ttypeof columnEditor === \"object\" &&\n\t\t\t\t\t\tcolumnEditor.config\n\t\t\t\t\t) {\n\t\t\t\t\t\teditor.config = columnEditor.config;\n\t\t\t\t\t\tif (columnEditor.config.options)\n\t\t\t\t\t\t\teditor.options = columnEditor.config.options;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (col.options && !editor.options)\n\t\t\t\t\t\teditor.options = col.options;\n\n\t\t\t\t\tthis.setState({ editor });\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t\tinBus.on(\"editor\", ({ value }: IDataMethodsConfig[\"editor\"]) => {\n\t\t\tconst editor = this.getState().editor;\n\t\t\tif (editor) {\n\t\t\t\teditor.value = value;\n\t\t\t\tthis.setState({ editor });\n\t\t\t}\n\t\t});\n\t\tinBus.on(\"add-row\", (ev: IDataMethodsConfig[\"add-row\"]) => {\n\t\t\tconst state = this.getState();\n\t\t\tlet { data } = state;\n\t\t\tconst { select, _filterIds: filterIds } = state;\n\t\t\tconst { row, before, after, select: selectForce } = ev;\n\t\t\tev.id = row.id = ev.id || row.id || uid();\n\n\t\t\tif (before || after) {\n\t\t\t\tconst id = before || after;\n\t\t\t\tconst index = data.findIndex(a => a.id === id);\n\t\t\t\tdata = [...data];\n\t\t\t\tdata.splice(index + (after ? 1 : 0), 0, ev.row);\n\t\t\t} else {\n\t\t\t\tdata = [...data, ev.row];\n\t\t\t}\n\n\t\t\tconst update: Partial<IData> = { data };\n\n\t\t\tif (filterIds) update._filterIds = [...filterIds, ev.id];\n\n\t\t\tthis.setState(update);\n\n\t\t\tif (typeof selectForce === \"boolean\" && !selectForce) return;\n\t\t\tif (selectForce || select)\n\t\t\t\tinBus.exec(\"select-row\", { id: row.id, show: true });\n\t\t});\n\t\tinBus.on(\"delete-row\", (ev: IDataMethodsConfig[\"delete-row\"]) => {\n\t\t\tconst { data, selectedRows, focusCell, editor } = this.getState();\n\t\t\tconst { id } = ev;\n\n\t\t\tconst update: Partial<IData> = {\n\t\t\t\tdata: data.filter(a => a.id !== id),\n\t\t\t};\n\n\t\t\tif (this.isSelected(id)) {\n\t\t\t\tupdate.selectedRows = selectedRows.filter(a => a !== id);\n\t\t\t}\n\t\t\tif (editor?.id == id) {\n\t\t\t\tupdate.editor = null;\n\t\t\t}\n\n\t\t\tthis.setState(update);\n\n\t\t\tif (focusCell?.row === id) {\n\t\t\t\tthis.in.exec(\"focus-cell\", { eventSource: \"delete-row\" });\n\t\t\t}\n\t\t});\n\t\tinBus.on(\"update-cell\", (ev: IDataMethodsConfig[\"update-cell\"]) => {\n\t\t\tconst state = this.getState();\n\t\t\tlet { data } = state;\n\t\t\tdata = [...data];\n\n\t\t\tconst { tree } = state;\n\t\t\tconst { id, column, value } = ev;\n\n\t\t\tconst col = this.getColumn(column);\n\n\t\t\tif (tree) {\n\t\t\t\tconst obj = { ...this._branches[id] };\n\t\t\t\tsetValue(obj, col, value);\n\n\t\t\t\tconst update = this.updateTreeRow(obj);\n\t\t\t\tif (obj.$parent === 0) {\n\t\t\t\t\tdata = update;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst index = data.findIndex(a => a.id == id);\n\t\t\t\tconst obj = { ...data[index] };\n\t\t\t\tsetValue(obj, col, value);\n\n\t\t\t\tdata[index] = obj;\n\t\t\t}\n\n\t\t\tthis.setState({ data });\n\t\t});\n\t\tinBus.on(\"update-row\", (ev: IDataMethodsConfig[\"update-row\"]) => {\n\t\t\tlet { data } = this.getState();\n\t\t\tconst { id, row } = ev;\n\n\t\t\tconst index = data.findIndex(a => a.id == id);\n\t\t\tdata = [...data];\n\t\t\tdata[index] = { ...data[index], ...row };\n\t\t\tthis.setState({ data });\n\t\t});\n\t\tinBus.on(\n\t\t\t\"select-row\",\n\t\t\t({\n\t\t\t\tid,\n\t\t\t\ttoggle,\n\t\t\t\trange,\n\t\t\t\tmode,\n\t\t\t\tshow,\n\t\t\t\tcolumn,\n\t\t\t}: IDataMethodsConfig[\"select-row\"]) => {\n\t\t\t\tconst state = this.getState();\n\t\t\t\tconst { focusCell } = state;\n\t\t\t\tlet { selectedRows } = state;\n\n\t\t\t\tif (!selectedRows.length) range = toggle = false;\n\n\t\t\t\tif (range) {\n\t\t\t\t\tconst { data } = this.getState();\n\n\t\t\t\t\tlet sindex = data.findIndex(\n\t\t\t\t\t\ta => a.id == selectedRows[selectedRows.length - 1]\n\t\t\t\t\t);\n\t\t\t\t\tlet eindex = data.findIndex(a => a.id == id);\n\t\t\t\t\tif (sindex > eindex) [sindex, eindex] = [eindex, sindex];\n\n\t\t\t\t\tdata.slice(sindex, eindex + 1).forEach(a => {\n\t\t\t\t\t\tif (selectedRows.indexOf(a.id) === -1)\n\t\t\t\t\t\t\tselectedRows.push(a.id);\n\t\t\t\t\t});\n\t\t\t\t} else if (toggle && this.isSelected(id)) {\n\t\t\t\t\tif (mode === true) return;\n\t\t\t\t\tselectedRows = selectedRows.filter(a => a !== id);\n\t\t\t\t} else {\n\t\t\t\t\tif (toggle) {\n\t\t\t\t\t\tif (mode === false) return;\n\t\t\t\t\t\tselectedRows.push(id);\n\t\t\t\t\t} else selectedRows = [id];\n\t\t\t\t}\n\n\t\t\t\tthis.setState({ selectedRows: [...selectedRows] });\n\n\t\t\t\tif (focusCell?.row !== id) {\n\t\t\t\t\tthis.in.exec(\"focus-cell\", { eventSource: \"select-row\" });\n\t\t\t\t}\n\t\t\t\tif (show) this.in.exec(\"scroll\", { row: id, column });\n\t\t\t}\n\t\t);\n\t\tthis.in.on(\"focus-cell\", (ev: IDataMethodsConfig[\"focus-cell\"]) => {\n\t\t\tconst { row, column, eventSource } = ev;\n\t\t\tconst { _columns, split } = this.getState();\n\n\t\t\tif (row && column) {\n\t\t\t\tthis.setState({ focusCell: { row, column } });\n\t\t\t\tif (eventSource !== \"click\") {\n\t\t\t\t\tif (\n\t\t\t\t\t\t(!split.left ||\n\t\t\t\t\t\t\t_columns.findIndex(a => a.id == ev.column) >=\n\t\t\t\t\t\t\t\tsplit.left) &&\n\t\t\t\t\t\t(!split.right ||\n\t\t\t\t\t\t\t_columns.findIndex(a => a.id == ev.column) <\n\t\t\t\t\t\t\t\t_columns.length - split.right)\n\t\t\t\t\t) {\n\t\t\t\t\t\tthis.in.exec(\"scroll\", { row, column });\n\t\t\t\t\t} else this.in.exec(\"scroll\", { row });\n\t\t\t\t}\n\t\t\t} else this.setState({ focusCell: null });\n\t\t});\n\t\tinBus.on(\"resize-column\", (ev: IDataMethodsConfig[\"resize-column\"]) => {\n\t\t\tconst { id, auto, maxRows, inProgress } = ev;\n\t\t\tif (inProgress === false) {\n\t\t\t\t// event called with inProgress=false is purely informational (indicates that the resize is over)\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet width = ev.width || 0;\n\t\t\tconst columns = [...this.getState().columns];\n\t\t\tconst column = columns.find(a => a.id == id);\n\n\t\t\tif (auto) {\n\t\t\t\tif (auto == \"data\" || auto === true) {\n\t\t\t\t\tconst { flatData, _skin } = this.getState();\n\t\t\t\t\tlet max = flatData.length;\n\n\t\t\t\t\tif (maxRows) max = Math.min(maxRows, max);\n\n\t\t\t\t\tconst curData = flatData.slice(0, max);\n\t\t\t\t\twidth = getColumnWidth(column, curData, _skin);\n\t\t\t\t}\n\n\t\t\t\tif (auto == \"header\" || auto === true) {\n\t\t\t\t\tconst { _skin } = this.getState();\n\n\t\t\t\t\twidth = Math.max(getHeaderColWidth(column, _skin), width);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcolumn.width = Math.max(17, width);\n\t\t\tdelete column.flexgrow;\n\t\t\tthis.setState({ columns });\n\t\t});\n\t\tinBus.on(\"hide-column\", (ev: IDataMethodsConfig[\"hide-column\"]) => {\n\t\t\tconst { id, mode } = ev;\n\t\t\tconst columns = [...this.getState().columns];\n\t\t\tconst column = columns.find(a => a.id == id);\n\t\t\tconst visibleColumns = columns.reduce(\n\t\t\t\t(p, v) => p + (v.hidden ? 0 : 1),\n\t\t\t\t0\n\t\t\t);\n\t\t\tif (!mode || visibleColumns > 1) {\n\t\t\t\tcolumn.hidden = !column.hidden;\n\t\t\t\tthis.setState({ columns });\n\t\t\t} else ev.skipUndo = true;\n\t\t});\n\t\tinBus.on(\"sort-rows\", (ev: IDataMethodsConfig[\"sort-rows\"]) => {\n\t\t\tconst { key, add, sort } = ev;\n\t\t\tconst state = this.getState();\n\t\t\tconst { columns, data, tree } = state;\n\n\t\t\tif (sort) {\n\t\t\t\tconst nextData = [...data];\n\t\t\t\tnextData.sort(sort);\n\t\t\t\tthis.setState({ data: nextData });\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { order = \"asc\" } = ev;\n\t\t\tlet sortMarks = state.sortMarks;\n\t\t\tconst fields = Object.keys(sortMarks);\n\t\t\tconst fLength = fields.length;\n\n\t\t\tif (!add || !fLength || (fLength === 1 && sortMarks[key])) {\n\t\t\t\tsortMarks = { [key]: { order } };\n\t\t\t} else {\n\t\t\t\tif (fLength === 1) {\n\t\t\t\t\t// ensure the first sort field has an index for proper ordering\n\t\t\t\t\tsortMarks[fields[0]] = {\n\t\t\t\t\t\t...sortMarks[fields[0]],\n\t\t\t\t\t\tindex: 0,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tsortMarks = {\n\t\t\t\t\t...sortMarks,\n\t\t\t\t\t[key]: {\n\t\t\t\t\t\torder,\n\t\t\t\t\t\tindex:\n\t\t\t\t\t\t\ttypeof add === \"number\"\n\t\t\t\t\t\t\t\t? add\n\t\t\t\t\t\t\t\t: (sortMarks[key]?.index ?? fLength),\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t}\n\t\t\tconst sortArr = Object.keys(sortMarks)\n\t\t\t\t.sort((a, b) => sortMarks[a].index - sortMarks[b].index)\n\t\t\t\t.map(k => ({ key: k, order: sortMarks[k].order }));\n\n\t\t\tthis.setState({ sortMarks });\n\n\t\t\tconst sorter = sortByMany(sortArr, columns);\n\t\t\tif (sorter) {\n\t\t\t\tconst nextData = [...data];\n\n\t\t\t\tif (tree) {\n\t\t\t\t\tthis.sortTree(nextData, sorter);\n\t\t\t\t} else {\n\t\t\t\t\tnextData.sort(sorter);\n\t\t\t\t}\n\t\t\t\tthis.setState({ data: nextData });\n\t\t\t}\n\t\t});\n\n\t\tinBus.on(\"filter-rows\", (ev: IDataMethodsConfig[\"filter-rows\"]) => {\n\t\t\tconst { value, key, filter } = ev;\n\n\t\t\t// clear all filters\n\t\t\tif (!Object.keys(ev).length) {\n\t\t\t\tthis.setState({ filterValues: {}, _filterIds: null });\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst state = this.getState();\n\t\t\tconst { data, tree } = state;\n\t\t\tlet filterValues = state.filterValues;\n\n\t\t\tconst update: Partial<IData> = {};\n\t\t\tif (key) {\n\t\t\t\tfilterValues = {\n\t\t\t\t\t...filterValues,\n\t\t\t\t\t[key]: value,\n\t\t\t\t};\n\t\t\t\tupdate.filterValues = filterValues;\n\t\t\t}\n\n\t\t\tconst filterFn = filter ?? this.createFilter(filterValues);\n\n\t\t\tlet filterIds: TID[] = [];\n\t\t\tif (tree) {\n\t\t\t\tfilterIds = this.filterTree(data, filterFn, filterIds);\n\t\t\t} else\n\t\t\t\tdata.forEach(d => {\n\t\t\t\t\tif (filterFn(d)) filterIds.push(d.id);\n\t\t\t\t});\n\t\t\tupdate._filterIds = filterIds;\n\n\t\t\tthis.setState(update);\n\t\t});\n\n\t\tinBus.on(\n\t\t\t\"collapse-column\",\n\t\t\t(ev: IDataMethodsConfig[\"collapse-column\"]) => {\n\t\t\t\tconst { id, row, mode } = ev;\n\t\t\t\tconst columns = [...this.getState().columns];\n\t\t\t\tconst header = this.getColumn(id).header;\n\t\t\t\tconst cell = Array.isArray(header) ? header[row] : header;\n\n\t\t\t\tif (typeof cell === \"object\") {\n\t\t\t\t\tcell.collapsed = mode ?? !cell.collapsed;\n\t\t\t\t\tthis.setState({ columns });\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\tinBus.on(\"move-item\", (ev: IDataMethodsConfig[\"move-item\"]) => {\n\t\t\tconst { id, inProgress } = ev;\n\t\t\tlet { target, mode = \"after\" } = ev;\n\t\t\tconst { data, flatData, tree } = this.getState();\n\n\t\t\tconst sourceIndex = flatData.findIndex(a => a.id == id);\n\t\t\tlet targetIndex;\n\n\t\t\tif (mode === \"up\" || mode === \"down\") {\n\t\t\t\tif (mode === \"up\") {\n\t\t\t\t\tif (sourceIndex === 0) return;\n\n\t\t\t\t\ttargetIndex = sourceIndex - 1;\n\t\t\t\t\tmode = \"before\";\n\t\t\t\t} else if (mode === \"down\") {\n\t\t\t\t\tif (sourceIndex === flatData.length - 1) return;\n\n\t\t\t\t\ttargetIndex = sourceIndex + 1;\n\t\t\t\t\tmode = \"after\";\n\t\t\t\t}\n\n\t\t\t\ttarget = flatData[targetIndex] && flatData[targetIndex].id;\n\t\t\t} else {\n\t\t\t\ttargetIndex = flatData.findIndex(a => a.id == target);\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tsourceIndex === -1 ||\n\t\t\t\ttargetIndex === -1 ||\n\t\t\t\tinProgress === false\n\t\t\t) {\n\t\t\t\t// event called with inProgress=false is purely informational (indicates that the drag is over)\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet updatedData;\n\t\t\tif (tree) {\n\t\t\t\t// #if [!(WX_PACKAGE_TYPE=open)]\n\t\t\t\tupdatedData = this.moveItem(id, target, data, mode);\n\t\t\t\t// #endif\n\t\t\t} else {\n\t\t\t\tupdatedData = this.moveItem(id, target, data, mode);\n\t\t\t}\n\n\t\t\tthis.setState({\n\t\t\t\tdata: tree ? this.normalizeTreeRows(updatedData) : updatedData,\n\t\t\t});\n\t\t});\n\n\t\tinBus.on(\"copy-row\", (ev: IDataMethodsConfig[\"copy-row\"]) => {\n\t\t\tconst { id, target, mode = \"after\" } = ev;\n\t\t\tconst state = this.getState();\n\n\t\t\tconst { flatData, _filterIds: filterIds } = state;\n\t\t\tlet { data } = state;\n\n\t\t\tconst sourceRow = this.getRow(id);\n\t\t\tif (!sourceRow) return;\n\n\t\t\tconst copiedRow: IRow = { ...sourceRow, id: uid() };\n\t\t\tev.id = copiedRow.id;\n\n\t\t\tconst targetIndex = flatData.findIndex(a => a.id == target);\n\t\t\tif (targetIndex === -1) return;\n\n\t\t\tdata.splice(targetIndex + (mode === \"after\" ? 1 : 0), 0, copiedRow);\n\t\t\tdata = [...data];\n\n\t\t\tconst update: Partial<IData> = { data };\n\n\t\t\tif (filterIds) update._filterIds = [...filterIds, copiedRow.id];\n\n\t\t\tthis.setState(update);\n\t\t});\n\n\t\tinBus.on(\"open-row\", (ev: IDataMethodsConfig[\"open-row\"]) => {\n\t\t\tconst { id, nested } = ev;\n\t\t\tthis.toggleBranch(id, true, nested);\n\t\t});\n\n\t\tinBus.on(\"close-row\", (ev: IDataMethodsConfig[\"close-row\"]) => {\n\t\t\tconst { id, nested } = ev;\n\t\t\tthis.toggleBranch(id, false, nested);\n\t\t});\n\t\tinBus.on(\"export-data\", (ev: IDataMethodsConfig[\"export-data\"]) => {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tconst format = ev.format || \"csv\";\n\n\t\t\t\tconst filename = `${ev.fileName || \"data\"}.${format}`;\n\n\t\t\t\tif (format == \"csv\") {\n\t\t\t\t\tconst csv = getCsvData(this.getState(), ev.csv || {});\n\t\t\t\t\tif (ev.download !== false)\n\t\t\t\t\t\tdownload(\n\t\t\t\t\t\t\tnew Blob([\"\\uFEFF\" + csv], { type: \"text/csv\" }),\n\t\t\t\t\t\t\tfilename\n\t\t\t\t\t\t);\n\t\t\t\t\telse ev.result = csv;\n\t\t\t\t\tresolve(true);\n\t\t\t\t}\n\t\t\t\t// #if [!(WX_PACKAGE_TYPE=open)]\n\t\t\t\telse if (format == \"xlsx\") {\n\t\t\t\t\t// common styles\n\t\t\t\t\tlet styleOps = ev.excel?.styles;\n\t\t\t\t\tif (!styleOps && styleOps !== false) {\n\t\t\t\t\t\tstyleOps = getExportStyles(this.getState()._skin);\n\t\t\t\t\t}\n\t\t\t\t\tconst styles = styleOps as IDataHash<any>;\n\t\t\t\t\tconst stylesArr = styles\n\t\t\t\t\t\t? [\n\t\t\t\t\t\t\t\t{ ...styles.header },\n\t\t\t\t\t\t\t\t{ ...(styles.lastHeaderCell || styles.header) },\n\t\t\t\t\t\t\t\t{ ...styles.cell },\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t...(styles.firstFooterCell ||\n\t\t\t\t\t\t\t\t\t\tstyles.footer),\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{ ...styles.footer },\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t: Array(5).fill({});\n\n\t\t\t\t\t// data and cell styles\n\t\t\t\t\tconst {\n\t\t\t\t\t\tcells,\n\t\t\t\t\t\tmerged,\n\t\t\t\t\t\trowSizes,\n\t\t\t\t\t\tcolSizes,\n\t\t\t\t\t\tstyles: cellStyles,\n\t\t\t\t\t} = getExcelData(\n\t\t\t\t\t\tthis.getState(),\n\t\t\t\t\t\tev.excel || {},\n\t\t\t\t\t\tstylesArr\n\t\t\t\t\t);\n\n\t\t\t\t\tconst path =\n\t\t\t\t\t\tev.cdn ||\n\t\t\t\t\t\t\"https://cdn.dhtmlx.com/libs/json2excel/1.3.2/worker.js\";\n\t\t\t\t\tconst xlsxWorker = this.getXlsxWorker(path);\n\n\t\t\t\t\txlsxWorker.then(x => {\n\t\t\t\t\t\tx.onmessage = (e: any) => {\n\t\t\t\t\t\t\tif (e.data.type == \"ready\") {\n\t\t\t\t\t\t\t\tconst blob = e.data.blob;\n\t\t\t\t\t\t\t\tif (ev.download !== false)\n\t\t\t\t\t\t\t\t\tdownload(blob, filename);\n\t\t\t\t\t\t\t\telse ev.result = blob;\n\t\t\t\t\t\t\t\tresolve(true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tx.postMessage({\n\t\t\t\t\t\t\ttype: \"convert\",\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tdata: [\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tname: ev.sheetName || \"data\",\n\t\t\t\t\t\t\t\t\t\tcells,\n\t\t\t\t\t\t\t\t\t\tcols: colSizes,\n\t\t\t\t\t\t\t\t\t\trows: rowSizes,\n\t\t\t\t\t\t\t\t\t\tmerged,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\tstyles: cellStyles,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t// #endif\n\t\t\t\telse reject();\n\t\t\t});\n\t\t});\n\t\t// #if [!(WX_PACKAGE_TYPE=open)]\n\t\tinBus.on(\"search-rows\", (ev: IDataMethodsConfig[\"search-rows\"]) => {\n\t\t\tconst { search, columns } = ev;\n\n\t\t\tconst rows = this.searchRows(search, columns);\n\n\t\t\tthis.setState({\n\t\t\t\tsearch: {\n\t\t\t\t\tvalue: search,\n\t\t\t\t\trows,\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t\t// #endif\n\t\tinBus.on(\n\t\t\t\"hotkey\",\n\t\t\t({ key, event, isInput }: IDataMethodsConfig[\"hotkey\"]) => {\n\t\t\t\tswitch (key) {\n\t\t\t\t\tcase \"arrowup\": {\n\t\t\t\t\t\tconst {\n\t\t\t\t\t\t\tflatData: data,\n\t\t\t\t\t\t\tfocusCell,\n\t\t\t\t\t\t\tselect,\n\t\t\t\t\t\t} = this.getState();\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tif (isInput) return;\n\n\t\t\t\t\t\tconst colId = focusCell\n\t\t\t\t\t\t\t? focusCell.column\n\t\t\t\t\t\t\t: this._getFirstVisibleColumn()?.id;\n\t\t\t\t\t\tconst rowId = focusCell\n\t\t\t\t\t\t\t? this.getPrevRow(focusCell.row)?.id\n\t\t\t\t\t\t\t: data[data.length - 1]?.id;\n\t\t\t\t\t\tif (colId && rowId) {\n\t\t\t\t\t\t\tthis.in.exec(\"focus-cell\", {\n\t\t\t\t\t\t\t\trow: rowId,\n\t\t\t\t\t\t\t\tcolumn: colId,\n\t\t\t\t\t\t\t\teventSource: \"key\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (select)\n\t\t\t\t\t\t\t\tthis.in.exec(\"select-row\", { id: rowId });\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"arrowdown\": {\n\t\t\t\t\t\tconst {\n\t\t\t\t\t\t\tflatData: data,\n\t\t\t\t\t\t\tfocusCell,\n\t\t\t\t\t\t\tselect,\n\t\t\t\t\t\t} = this.getState();\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tif (isInput) return;\n\n\t\t\t\t\t\tconst colId = focusCell\n\t\t\t\t\t\t\t? focusCell.column\n\t\t\t\t\t\t\t: this._getFirstVisibleColumn()?.id;\n\t\t\t\t\t\tconst rowId = focusCell\n\t\t\t\t\t\t\t? this.getNextRow(focusCell.row)?.id\n\t\t\t\t\t\t\t: data[0]?.id;\n\t\t\t\t\t\tif (colId && rowId) {\n\t\t\t\t\t\t\tthis.in.exec(\"focus-cell\", {\n\t\t\t\t\t\t\t\trow: rowId,\n\t\t\t\t\t\t\t\tcolumn: colId,\n\t\t\t\t\t\t\t\teventSource: \"key\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (select)\n\t\t\t\t\t\t\t\tthis.in.exec(\"select-row\", { id: rowId });\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"arrowright\": {\n\t\t\t\t\t\tconst { focusCell } = this.getState();\n\t\t\t\t\t\tif (isInput) return;\n\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tif (focusCell) {\n\t\t\t\t\t\t\tconst colId = this.getNextColumn(\n\t\t\t\t\t\t\t\tfocusCell.column,\n\t\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t\t)?.id;\n\t\t\t\t\t\t\tif (colId) {\n\t\t\t\t\t\t\t\tthis.in.exec(\"focus-cell\", {\n\t\t\t\t\t\t\t\t\trow: focusCell.row,\n\t\t\t\t\t\t\t\t\tcolumn: colId,\n\t\t\t\t\t\t\t\t\teventSource: \"key\",\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"arrowleft\": {\n\t\t\t\t\t\tconst { focusCell } = this.getState();\n\t\t\t\t\t\tif (isInput) return;\n\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tif (focusCell) {\n\t\t\t\t\t\t\tconst colId = this.getPrevColumn(\n\t\t\t\t\t\t\t\tfocusCell.column,\n\t\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t\t)?.id;\n\t\t\t\t\t\t\tif (colId) {\n\t\t\t\t\t\t\t\tthis.in.exec(\"focus-cell\", {\n\t\t\t\t\t\t\t\t\trow: focusCell.row,\n\t\t\t\t\t\t\t\t\tcolumn: colId,\n\t\t\t\t\t\t\t\t\teventSource: \"key\",\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"tab\": {\n\t\t\t\t\t\tconst { editor, focusCell, select } = this.getState();\n\t\t\t\t\t\tif (editor) {\n\t\t\t\t\t\t\tevent.preventDefault();\n\n\t\t\t\t\t\t\tconst column = editor.column;\n\t\t\t\t\t\t\tlet id = editor.id;\n\t\t\t\t\t\t\tlet col = this.getNextEditor(\n\t\t\t\t\t\t\t\tthis.getRow(id),\n\t\t\t\t\t\t\t\tthis.getColumn(column)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tif (!col) {\n\t\t\t\t\t\t\t\tconst row = this.getNextRow(id);\n\t\t\t\t\t\t\t\tif (row) {\n\t\t\t\t\t\t\t\t\tid = row.id;\n\t\t\t\t\t\t\t\t\tcol = this.getNextEditor(row);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (col) {\n\t\t\t\t\t\t\t\tthis.in.exec(\"open-editor\", {\n\t\t\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\t\t\tcolumn: col.id,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tthis.in.exec(\"focus-cell\", {\n\t\t\t\t\t\t\t\t\trow: id,\n\t\t\t\t\t\t\t\t\tcolumn: col.id,\n\t\t\t\t\t\t\t\t\teventSource: \"key\",\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tif (select && !this.isSelected(id))\n\t\t\t\t\t\t\t\t\tthis.in.exec(\"select-row\", { id });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (focusCell) {\n\t\t\t\t\t\t\tthis.in.exec(\"focus-cell\", { eventSource: \"key\" });\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"shift+tab\": {\n\t\t\t\t\t\tconst { editor, focusCell, select } = this.getState();\n\t\t\t\t\t\tif (editor) {\n\t\t\t\t\t\t\tevent.preventDefault();\n\n\t\t\t\t\t\t\tconst column = editor.column;\n\t\t\t\t\t\t\tlet id = editor.id;\n\t\t\t\t\t\t\tlet col = this.getPrevEditor(\n\t\t\t\t\t\t\t\tthis.getRow(id),\n\t\t\t\t\t\t\t\tthis.getColumn(column)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tif (!col) {\n\t\t\t\t\t\t\t\tconst row = this.getPrevRow(id);\n\t\t\t\t\t\t\t\tif (row) {\n\t\t\t\t\t\t\t\t\tid = row.id;\n\t\t\t\t\t\t\t\t\tcol = this.getPrevEditor(row);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (col) {\n\t\t\t\t\t\t\t\tthis.in.exec(\"open-editor\", {\n\t\t\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\t\t\tcolumn: col.id,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tthis.in.exec(\"focus-cell\", {\n\t\t\t\t\t\t\t\t\trow: id,\n\t\t\t\t\t\t\t\t\tcolumn: col.id,\n\t\t\t\t\t\t\t\t\teventSource: \"key\",\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tif (select && !this.isSelected(id))\n\t\t\t\t\t\t\t\t\tthis.in.exec(\"select-row\", { id });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (focusCell) {\n\t\t\t\t\t\t\tthis.in.exec(\"focus-cell\", { eventSource: \"key\" });\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"escape\": {\n\t\t\t\t\t\tconst { editor } = this.getState();\n\t\t\t\t\t\tif (editor) {\n\t\t\t\t\t\t\tthis.in.exec(\"close-editor\", { ignore: true });\n\t\t\t\t\t\t\tthis.in.exec(\"focus-cell\", {\n\t\t\t\t\t\t\t\trow: editor.id,\n\t\t\t\t\t\t\t\tcolumn: editor.column,\n\t\t\t\t\t\t\t\teventSource: \"key\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"f2\": {\n\t\t\t\t\t\tconst { editor, focusCell } = this.getState();\n\t\t\t\t\t\tif (!editor && focusCell) {\n\t\t\t\t\t\t\tthis.in.exec(\"open-editor\", {\n\t\t\t\t\t\t\t\tid: focusCell.row,\n\t\t\t\t\t\t\t\tcolumn: focusCell.column,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"enter\": {\n\t\t\t\t\t\tconst { focusCell, tree } = this.getState();\n\t\t\t\t\t\tif (!isInput && tree && focusCell) {\n\t\t\t\t\t\t\tconst column = this.getColumn(focusCell.column);\n\t\t\t\t\t\t\tif (column.treetoggle) {\n\t\t\t\t\t\t\t\tconst row = this.getRow(focusCell.row);\n\t\t\t\t\t\t\t\tif (!row.data) return;\n\t\t\t\t\t\t\t\tthis.in.exec(\n\t\t\t\t\t\t\t\t\trow.open ? \"close-row\" : \"open-row\",\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tid: focusCell.row,\n\t\t\t\t\t\t\t\t\t\tnested: true,\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"home\": {\n\t\t\t\t\t\tconst { editor, focusCell } = this.getState();\n\t\t\t\t\t\tif (!editor && focusCell) {\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\tconst colId = this._getFirstVisibleColumn()?.id;\n\t\t\t\t\t\t\tthis.in.exec(\"focus-cell\", {\n\t\t\t\t\t\t\t\trow: focusCell.row,\n\t\t\t\t\t\t\t\tcolumn: colId,\n\t\t\t\t\t\t\t\teventSource: \"key\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"ctrl+home\": {\n\t\t\t\t\t\tconst {\n\t\t\t\t\t\t\teditor,\n\t\t\t\t\t\t\tfocusCell,\n\t\t\t\t\t\t\tflatData: data,\n\t\t\t\t\t\t\tselect,\n\t\t\t\t\t\t} = this.getState();\n\t\t\t\t\t\tif (!editor && focusCell) {\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\tconst rowId = data[0]?.id;\n\t\t\t\t\t\t\tconst colId = this._getFirstVisibleColumn()?.id;\n\t\t\t\t\t\t\tif (rowId && colId) {\n\t\t\t\t\t\t\t\tthis.in.exec(\"focus-cell\", {\n\t\t\t\t\t\t\t\t\trow: rowId,\n\t\t\t\t\t\t\t\t\tcolumn: colId,\n\t\t\t\t\t\t\t\t\teventSource: \"key\",\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tif (select && !this.isSelected(rowId))\n\t\t\t\t\t\t\t\t\tthis.in.exec(\"select-row\", { id: rowId });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"end\": {\n\t\t\t\t\t\tconst { editor, focusCell } = this.getState();\n\t\t\t\t\t\tif (!editor && focusCell) {\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\tconst colId = this._getLastVisibleColumn()?.id;\n\t\t\t\t\t\t\tconst rowId = focusCell.row;\n\t\t\t\t\t\t\tthis.in.exec(\"focus-cell\", {\n\t\t\t\t\t\t\t\trow: rowId,\n\t\t\t\t\t\t\t\tcolumn: colId,\n\t\t\t\t\t\t\t\teventSource: \"key\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"ctrl+end\": {\n\t\t\t\t\t\tconst {\n\t\t\t\t\t\t\teditor,\n\t\t\t\t\t\t\tfocusCell,\n\t\t\t\t\t\t\tflatData: data,\n\t\t\t\t\t\t\tselect,\n\t\t\t\t\t\t} = this.getState();\n\t\t\t\t\t\tif (!editor && focusCell) {\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\tconst rowId = data.at(-1).id;\n\t\t\t\t\t\t\tconst colId = this._getLastVisibleColumn()?.id;\n\t\t\t\t\t\t\tif (rowId && colId) {\n\t\t\t\t\t\t\t\tthis.in.exec(\"focus-cell\", {\n\t\t\t\t\t\t\t\t\trow: rowId,\n\t\t\t\t\t\t\t\t\tcolumn: colId,\n\t\t\t\t\t\t\t\t\teventSource: \"key\",\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tif (select && !this.isSelected(rowId))\n\t\t\t\t\t\t\t\t\tthis.in.exec(\"select-row\", { id: rowId });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"ctrl+z\": {\n\t\t\t\t\t\tthis.in.exec(\"undo\", {});\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"ctrl+y\": {\n\t\t\t\t\t\tthis.in.exec(\"redo\", {});\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\tinBus.on(\"scroll\", (ev: IDataMethodsConfig[\"scroll\"]) => {\n\t\t\tconst {\n\t\t\t\t_columns,\n\t\t\t\tsplit,\n\t\t\t\t_sizes,\n\t\t\t\tflatData: data,\n\t\t\t\tdynamic,\n\t\t\t\t_rowHeightFromData,\n\t\t\t} = this.getState();\n\n\t\t\tlet left = -1,\n\t\t\t\ttop = -1,\n\t\t\t\twidth = 0,\n\t\t\t\theight = 0;\n\t\t\tif (ev.column) {\n\t\t\t\tleft = 0;\n\t\t\t\tconst ind = _columns.findIndex(a => a.id == ev.column);\n\t\t\t\twidth = _columns[ind].width;\n\t\t\t\tfor (let i = split.left ?? 0; i < ind; i++) {\n\t\t\t\t\tconst col = _columns[i];\n\t\t\t\t\tif (col.hidden) continue;\n\t\t\t\t\tleft += col.width;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (ev.row && !dynamic) {\n\t\t\t\tconst index = data.findIndex(a => a.id == ev.row);\n\t\t\t\tif (index >= 0) {\n\t\t\t\t\tif (_rowHeightFromData) {\n\t\t\t\t\t\ttop = data\n\t\t\t\t\t\t\t.slice(0, index)\n\t\t\t\t\t\t\t.reduce(\n\t\t\t\t\t\t\t\t(total, row) =>\n\t\t\t\t\t\t\t\t\ttotal + (row.rowHeight || _sizes.rowHeight),\n\t\t\t\t\t\t\t\t0\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\theight = data[index].rowHeight;\n\t\t\t\t\t} else top = _sizes.rowHeight * index;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.setState({\n\t\t\t\tscroll: {\n\t\t\t\t\ttop,\n\t\t\t\t\tleft,\n\t\t\t\t\twidth,\n\t\t\t\t\theight: height || _sizes.rowHeight,\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\n\t\tinBus.on(\"print\", (ev: IDataMethodsConfig[\"print\"]) => {\n\t\t\tconst config = normalizePrintConfig(ev);\n\t\t\tthis.setState({ _print: config });\n\t\t\tthis.setStateAsync({ _print: null });\n\t\t});\n\n\t\tinBus.on(\"undo\", () => {\n\t\t\tthis._historyManager?.handleUndo();\n\t\t});\n\n\t\tinBus.on(\"redo\", () => {\n\t\t\tthis._historyManager?.handleRedo();\n\t\t});\n\n\t\tthis.initOnce();\n\t}\n\n\tprivate getXlsxWorker(path: string): Promise<any> {\n\t\tif (!this._xlsxWorker) {\n\t\t\tconst url = window.URL.createObjectURL(\n\t\t\t\tnew Blob([`importScripts('${path}');`], {\n\t\t\t\t\ttype: \"text/javascript\",\n\t\t\t\t})\n\t\t\t);\n\n\t\t\tthis._xlsxWorker = new Promise(res => {\n\t\t\t\tconst xlsxWorker = new Worker(url);\n\t\t\t\txlsxWorker.addEventListener(\"message\", e => {\n\t\t\t\t\tif (e.data.type === \"init\") res(xlsxWorker);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\treturn this._xlsxWorker;\n\t}\n\n\tinitOnce() {\n\t\tconst state: Partial<IDataConfig> = {\n\t\t\tsortMarks: {},\n\t\t\t_filterIds: null,\n\t\t\tdata: [],\n\t\t\tfilterValues: {},\n\t\t\tscroll: null,\n\t\t\teditor: null,\n\t\t\tfocusCell: null,\n\t\t\t_print: null,\n\t\t\thistory: { undo: 0, redo: 0 },\n\t\t\tsearch: null,\n\t\t};\n\t\tthis._router.init(state);\n\t}\n\n\tinit(state: Partial<IDataConfig>) {\n\t\t// eslint-disable-next-line no-prototype-builtins\n\t\tif (state.hasOwnProperty(\"_skin\") && !(state as IData)._skin) {\n\t\t\t(state as IData)._skin = suggestSkin();\n\t\t}\n\t\tif (state.columns)\n\t\t\tstate.columns.forEach(a => {\n\t\t\t\tif (a.options) {\n\t\t\t\t\ta.optionsMap = new Map(a.options.map(x => [x.id, x.label]));\n\t\t\t\t}\n\t\t\t});\n\t\t// perform these changes only if data was reset\n\t\tif (!isSame(this.getState().data, state.data)) {\n\t\t\tif (state.tree) {\n\t\t\t\tthis._branches = { 0: { data: state.data } };\n\t\t\t\tstate.data = this.normalizeTreeRows(state.data);\n\t\t\t} else state.data = this.normalizeRows(state.data);\n\n\t\t\tthis.setState({\n\t\t\t\t_filterIds: null,\n\t\t\t\tfilterValues: {},\n\t\t\t\tsortMarks: {},\n\t\t\t\tsearch: null,\n\t\t\t});\n\t\t\tif (this._historyManager) this._historyManager.resetHistory();\n\t\t}\n\n\t\tif (isCommunity()) {\n\t\t\tif (state.tree) {\n\t\t\t\tstate.undo = false;\n\t\t\t\tstate.reorder = false;\n\t\t\t}\n\t\t\tif (state.split?.right) state.split.right = 0;\n\t\t}\n\n\t\tif (state.undo && !this._historyManager) {\n\t\t\tthis._historyManager = new HistoryManager(\n\t\t\t\tthis.in,\n\t\t\t\tthis.getState.bind(this),\n\t\t\t\tthis.setState.bind(this)\n\t\t\t);\n\t\t}\n\n\t\tthis._router.init({\n\t\t\t...state,\n\t\t});\n\t}\n\n\tsetState(state: Partial<IData>, ctx?: TDataConfig) {\n\t\treturn this._router.setState(state, ctx);\n\t}\n\n\tsetStateAsync(state: Partial<IData>) {\n\t\tthis._router.setStateAsync(state);\n\t}\n\n\tgetRow(id: TID): IRow {\n\t\tconst { tree } = this.getState();\n\t\tif (tree) return this._branches[id];\n\t\treturn this.getState().data.find(a => a.id == id);\n\t}\n\n\tgetRowIndex(id: TID, data?: any[]): number {\n\t\tif (!data) data = this.getState().flatData;\n\t\treturn data.findIndex(a => a.id == id);\n\t}\n\n\tgetNextRow(id: TID): IRow {\n\t\tconst data = this.getState().flatData;\n\t\tconst index = this.getRowIndex(id, data);\n\t\treturn data[index + 1];\n\t}\n\n\tgetPrevRow(id: TID): IRow {\n\t\tconst data = this.getState().flatData;\n\t\tconst index = this.getRowIndex(id, data);\n\t\treturn data[index - 1];\n\t}\n\n\tgetColumn(id: TID): IColumn {\n\t\treturn this.getState().columns.find(a => a.id == id);\n\t}\n\n\tgetNextColumn(id: TID, visible?: boolean): IRenderColumn {\n\t\tconst columns = this.getState()._columns;\n\t\tconst index = columns.findIndex((c: IRenderColumn) => c.id == id);\n\n\t\tif (visible) {\n\t\t\treturn this._getFirstVisibleColumn(index + 1);\n\t\t}\n\n\t\treturn columns[index + 1];\n\t}\n\n\tgetPrevColumn(id: TID, visible?: boolean): IRenderColumn {\n\t\tconst columns = this.getState()._columns;\n\t\tconst index = columns.findIndex((c: IRenderColumn) => c.id == id);\n\n\t\tif (visible) {\n\t\t\treturn this._getLastVisibleColumn(index - 1);\n\t\t}\n\n\t\treturn columns[index - 1];\n\t}\n\n\t_getFirstVisibleColumn(index?: number): IRenderColumn {\n\t\tconst columns = this.getState()._columns;\n\t\tlet start = index ?? 0;\n\n\t\twhile (\n\t\t\tstart < columns.length &&\n\t\t\t(columns[start]?.hidden || columns[start]?.collapsed)\n\t\t) {\n\t\t\tstart++;\n\t\t}\n\n\t\treturn columns[start];\n\t}\n\n\t_getLastVisibleColumn(index?: number): IRenderColumn {\n\t\tconst columns = this.getState()._columns;\n\n\t\tlet start = index ?? columns.length - 1;\n\n\t\twhile (\n\t\t\tstart < columns.length &&\n\t\t\t(columns[start]?.hidden || columns[start]?.collapsed)\n\t\t) {\n\t\t\tstart--;\n\t\t}\n\n\t\treturn columns[start];\n\t}\n\n\tisCellEditable(row: IRow, column: IColumn) {\n\t\tconst { editor, hidden } = column;\n\t\tif (!editor || hidden) return false;\n\t\tif (typeof editor === \"function\") return editor(row, column);\n\t\treturn true;\n\t}\n\n\tgetNextEditor(row: IRow, column?: IColumn): IColumn {\n\t\tlet columns = this.getState().columns;\n\t\tif (column) {\n\t\t\tconst index = columns.findIndex(c => c.id == column.id);\n\t\t\tcolumns = columns.slice(index + 1);\n\t\t}\n\t\treturn columns.find(c => this.isCellEditable(row, c));\n\t}\n\n\tgetPrevEditor(row: IRow, column?: IColumn): IColumn {\n\t\tlet columns = this.getState().columns;\n\t\tif (column) {\n\t\t\tconst index = columns.findLastIndex(c => c.id == column.id);\n\t\t\tcolumns = columns.slice(0, index);\n\t\t}\n\t\treturn columns.findLast(c => this.isCellEditable(row, c));\n\t}\n\n\ttoggleBranch(id: TID, open: boolean, nested?: boolean) {\n\t\tlet item = this._branches[id];\n\n\t\tlet { data } = this.getState();\n\t\tdata = [...data];\n\n\t\tif (id !== 0) {\n\t\t\titem = { ...item, open };\n\t\t\tconst update = this.updateTreeRow(item);\n\t\t\tif (item.$parent === 0) data = update;\n\t\t}\n\n\t\tif (nested && item.data?.length) {\n\t\t\titem.data.forEach((row: IRow) => {\n\t\t\t\tconst update = this.toggleKids(row, open, nested);\n\t\t\t\tif (id === 0) data = update;\n\t\t\t});\n\t\t}\n\t\tthis.setState({ data });\n\t}\n\n\ttoggleKids(item: IRow, open: boolean, nested?: boolean) {\n\t\titem = { ...item, open };\n\n\t\tconst data = this.updateTreeRow(item);\n\n\t\tif (nested && item.data?.length) {\n\t\t\titem.data.forEach((row: IRow) => {\n\t\t\t\tthis.toggleKids(row, open, nested);\n\t\t\t});\n\t\t}\n\t\treturn data;\n\t}\n\n\tprivate updateTreeRow(item: IRow) {\n\t\tconst id = item.id;\n\n\t\tthis._branches[id] = item;\n\n\t\tconst parentRow = this._branches[item.$parent];\n\t\tconst parentIndex = parentRow.data.findIndex((a: IRow) => a.id == id);\n\n\t\tparentRow.data = [...parentRow.data];\n\t\tparentRow.data[parentIndex] = item;\n\n\t\treturn parentRow.data;\n\t}\n\n\tprivate isSelected(id: TID): boolean {\n\t\treturn this.getState().selectedRows.indexOf(id) !== -1;\n\t}\n\n\tprivate findAndRemove(items: any[], id: TID): any {\n\t\tfor (let i = 0; i < items.length; i++) {\n\t\t\tif (items[i].id == id) {\n\t\t\t\treturn items.splice(i, 1)[0];\n\t\t\t}\n\t\t\tif (items[i].data) {\n\t\t\t\tconst copy = [...items[i].data];\n\t\t\t\tconst found = this.findAndRemove(copy, id);\n\t\t\t\tif (found) {\n\t\t\t\t\titems[i] = {\n\t\t\t\t\t\t...items[i],\n\t\t\t\t\t\tdata: copy,\n\t\t\t\t\t};\n\t\t\t\t\treturn found;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tprivate insertItem(\n\t\titems: any[],\n\t\ttargetId: TID,\n\t\titem: any,\n\t\tmode: IDataMethodsConfig[\"move-item\"][\"mode\"]\n\t): boolean {\n\t\tfor (let i = 0; i < items.length; i++) {\n\t\t\tif (items[i].id == targetId) {\n\t\t\t\tconst targetItem = items[i];\n\t\t\t\tconst insertIndex = mode === \"before\" ? i : i + 1;\n\n\t\t\t\t// is a branch\n\t\t\t\tif (targetItem.data) {\n\t\t\t\t\tif (mode === \"before\") {\n\t\t\t\t\t\tconst prevItem = i > 0 ? items[i - 1] : null;\n\n\t\t\t\t\t\t// open branch - insert as last child of prev. branch (before)\n\t\t\t\t\t\tif (prevItem?.data && prevItem.open) {\n\t\t\t\t\t\t\titems[i - 1] = {\n\t\t\t\t\t\t\t\t...prevItem,\n\t\t\t\t\t\t\t\tdata: [...prevItem.data, item],\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\titems.splice(insertIndex, 0, item);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// open branch - insert as first child of target branch (after)\n\t\t\t\t\t\tif (targetItem.open) {\n\t\t\t\t\t\t\titems[i] = {\n\t\t\t\t\t\t\t\t...targetItem,\n\t\t\t\t\t\t\t\tdata: [item, ...targetItem.data],\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\titems.splice(insertIndex, 0, item);\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (items[i].data) {\n\t\t\t\titems[i] = {\n\t\t\t\t\t...items[i],\n\t\t\t\t\tdata: [...items[i].data],\n\t\t\t\t};\n\t\t\t\tif (this.insertItem(items[i].data, targetId, item, mode)) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tprivate moveItem(\n\t\tid: TID,\n\t\ttarget: TID,\n\t\tdata: any[],\n\t\tmode: IDataMethodsConfig[\"move-item\"][\"mode\"]\n\t) {\n\t\tconst items = [...data];\n\t\tconst movedItem = this.findAndRemove(items, id);\n\t\tthis.insertItem(items, target, movedItem, mode);\n\t\treturn items;\n\t}\n\n\tprivate copyColumns(columns: IColumn[]) {\n\t\tconst _columns: IRenderColumn[] = [];\n\t\tfor (let i = 0; i < columns.length; i++) {\n\t\t\tconst copy = { ...columns[i] } as IRenderColumn;\n\t\t\tthis.copyHeaderFooter(copy, \"header\");\n\t\t\tthis.copyHeaderFooter(copy, \"footer\");\n\t\t\t_columns[i] = copy;\n\t\t}\n\t\treturn _columns;\n\t}\n\n\tprivate copyHeaderFooter(col: IColumn, type: TColumnType) {\n\t\tlet config: any = col[type];\n\n\t\tconfig = Array.isArray(config) ? [...config] : [config];\n\t\tconfig.forEach((text: any, i: number) => {\n\t\t\tconfig[i] = typeof text === \"string\" ? { text } : { ...text };\n\t\t});\n\n\t\tcol[type] = config;\n\t}\n\n\tprivate setCollapsibleColumns(\n\t\tcol: IRenderColumn,\n\t\tindex: number,\n\t\tcolumns: IRenderColumn[]\n\t) {\n\t\tlet header = col.header;\n\t\tfor (let r = 0; r < header.length; r++) {\n\t\t\tconst cell = header[r];\n\n\t\t\tif (cell.collapsible && cell.collapsed) {\n\t\t\t\tif (cell.collapsible !== \"first\") {\n\t\t\t\t\tcol.collapsed = true;\n\t\t\t\t\tcol.width = 36;\n\t\t\t\t\tcell.vertical = true;\n\n\t\t\t\t\tconst diff = header.length - r;\n\t\t\t\t\theader = header.slice(0, r + 1);\n\t\t\t\t\theader[r].rowspan = diff;\n\t\t\t\t}\n\n\t\t\t\tconst colspan = cell.colspan;\n\t\t\t\tif (colspan) {\n\t\t\t\t\tconst nextCell = header[r + 1];\n\t\t\t\t\tlet spanStart = 1;\n\n\t\t\t\t\tif (nextCell && nextCell.colspan && !nextCell.collapsed) {\n\t\t\t\t\t\tspanStart = nextCell.colspan;\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (let span = spanStart; span < colspan; span++) {\n\t\t\t\t\t\tconst curCol = columns[index + span];\n\t\t\t\t\t\tif (curCol) {\n\t\t\t\t\t\t\tcurCol.hidden = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate normalizeColumns(\n\t\tcolumns: IRenderColumn[],\n\t\tindex: number,\n\t\ttype: TColumnType,\n\t\trowsCount: number,\n\t\tsizes: IRenderSizes\n\t) {\n\t\tconst col = columns[index];\n\t\tif (!col.width) col.width = col.flexgrow ? 17 : sizes.columnWidth;\n\n\t\tcol._colindex = index + 1;\n\n\t\t// normalize header and footer config\n\t\tconst config: IRenderHeaderCell[] = col[type];\n\t\tconst rowHeights = sizes[`${type}RowHeights`];\n\n\t\tfor (let i = 0; i < rowsCount; i++) {\n\t\t\tconst row: IRenderHeaderCell = config[i];\n\n\t\t\trow.id = col.id;\n\n\t\t\t// stretch cells with no rowspan to fit available space or cut rowspan if it was set incorrectly\n\t\t\tif (i === config.length - 1) {\n\t\t\t\trow.rowspan = row.rowspan\n\t\t\t\t\t? Math.min(row.rowspan, rowsCount - i)\n\t\t\t\t\t: rowsCount - i;\n\t\t\t}\n\n\t\t\t// fill space covered by rowspans with empties so that rows are rendered column by column regardless of upper row overlap\n\t\t\tfor (let r = 1; r < row.rowspan; r++) {\n\t\t\t\t(config as any).splice(i + r, 0, { _hidden: true });\n\t\t\t\t// fill neighboring columns as well for headers with colspans and rowspans\n\t\t\t\tfor (let c = 1; c < row.colspan; c++) {\n\t\t\t\t\tconst nextColRows = columns[index + c][type];\n\t\t\t\t\t(nextColRows as any[]).splice(i + r, 0, {});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (row.rowspan) {\n\t\t\t\tconst rHeights =\n\t\t\t\t\trow.rowspan === rowsCount\n\t\t\t\t\t\t? rowHeights\n\t\t\t\t\t\t: rowHeights.slice(i, row.rowspan + i);\n\t\t\t\tconst height = rHeights.reduce((a, b) => a + b, 0);\n\t\t\t\trow.height = height;\n\t\t\t\tif (i + row.rowspan != rowsCount) row.height--; // -1px because of row border-bottom\n\t\t\t}\n\n\t\t\t// set widths for header cells\n\t\t\tif (row.colspan) {\n\t\t\t\tlet width = col.width;\n\t\t\t\tlet flexgrow = col.flexgrow || 0;\n\t\t\t\tconst colspan = row.colspan;\n\t\t\t\tfor (let span = 1; span < colspan; span++) {\n\t\t\t\t\tconst curCell = columns[index + span];\n\t\t\t\t\tif (curCell) {\n\t\t\t\t\t\tif (curCell.hidden) {\n\t\t\t\t\t\t\trow.colspan -= 1;\n\t\t\t\t\t\t} else if (curCell.flexgrow) {\n\t\t\t\t\t\t\tflexgrow += curCell.flexgrow;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\twidth += curCell.width || sizes.columnWidth;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (flexgrow) {\n\t\t\t\t\t\trow.flexgrow = flexgrow;\n\t\t\t\t\t} else {\n\t\t\t\t\t\trow.width = width;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\trow.width = col.width;\n\t\t\t\trow.flexgrow = col.flexgrow;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\ttype === \"header\" &&\n\t\t\t\trow.filter &&\n\t\t\t\ttypeof row.filter === \"string\"\n\t\t\t) {\n\t\t\t\trow.filter = { type: row.filter };\n\t\t\t}\n\t\t}\n\n\t\tif (config.length > rowsCount) config.length = rowsCount;\n\t\tcol[type] = config;\n\n\t\t// #if [WX_PACKAGE_TYPE=trial]\n\t\tif (!isValid()) {\n\t\t\tif (\n\t\t\t\t(isExpired() || isBadLuck()) &&\n\t\t\t\tconfig.length &&\n\t\t\t\ttypeof config[0] === \"object\" &&\n\t\t\t\tconfig[0].text\n\t\t\t) {\n\t\t\t\tconfig[0].text = `[trial] ${config[0].text}`;\n\t\t\t}\n\t\t}\n\t\t// #endif\n\t}\n\n\tnormalizeRows(data: IRow[]): IRow[] {\n\t\tfor (let i = 0; i < data.length; i++) {\n\t\t\tif (!data[i].id) data[i].id = uid();\n\t\t}\n\n\t\treturn data;\n\t}\n\n\tnormalizeTreeRows(data: IRow[], level?: number, parent?: TID): IRow[] {\n\t\tdata.forEach(row => {\n\t\t\tif (!row.id) row.id = uid();\n\n\t\t\trow.$level = level || 0;\n\t\t\trow.$parent = parent || 0;\n\n\t\t\tthis._branches[row.id] = row;\n\n\t\t\tif (row.data) {\n\t\t\t\tif (row.data.length) {\n\t\t\t\t\trow.$count = row.data.length;\n\t\t\t\t\tthis.normalizeTreeRows(row.data, row.$level + 1, row.id);\n\t\t\t\t} else {\n\t\t\t\t\tdelete row.data;\n\t\t\t\t\tdelete row.$count;\n\t\t\t\t\tdelete row.open;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn data;\n\t}\n\n\tsortTree(data: any[], sorter: (a: TSortValue, b: TSortValue) => number) {\n\t\tdata.sort(sorter);\n\t\tdata.forEach(item => {\n\t\t\tif (item.data) {\n\t\t\t\tthis.sortTree(item.data, sorter);\n\t\t\t}\n\t\t});\n\t}\n\n\tfilterTree(\n\t\tdata: IRow[],\n\t\tfilter: (row: IRow) => boolean,\n\t\tfilterIds: TID[]\n\t): TID[] {\n\t\tdata.forEach(row => {\n\t\t\tif (filter(row)) filterIds.push(row.id);\n\t\t\tif (row.data) this.filterTree(row.data, filter, filterIds);\n\t\t});\n\t\treturn filterIds;\n\t}\n\n\tflattenRows(data: IRow[], flatData: IRow[], filterIds: TID[]): IRow[] {\n\t\tconst res: IRow[] = flatData;\n\t\tdata.forEach(row => {\n\t\t\tif (!filterIds || filterIds.includes(row.id)) res.push(row);\n\t\t\tif (row.data?.length && row.open !== false) {\n\t\t\t\tthis.flattenRows(row.data, res, filterIds);\n\t\t\t}\n\t\t});\n\t\treturn res;\n\t}\n\n\tcreateFilter(filterValues: IFilterValues) {\n\t\tconst { _columns: columns } = this.getState();\n\t\tconst filters: ((obj: any) => boolean)[] = [];\n\n\t\tfor (const field in filterValues) {\n\t\t\tconst { config, type } = columns\n\t\t\t\t.find(c => c.id == field)\n\t\t\t\t.header.find(h => h.filter).filter;\n\t\t\tconst value = filterValues[field];\n\n\t\t\tfilters.push((obj: any) => {\n\t\t\t\tif (config?.handler) {\n\t\t\t\t\treturn config.handler(obj[field], value);\n\t\t\t\t}\n\n\t\t\t\treturn getFilterHandler(type)(obj[field], value);\n\t\t\t});\n\t\t}\n\n\t\treturn (obj: any) => {\n\t\t\tfor (let i = 0; i < filters.length; i++) {\n\t\t\t\tif (!filters[i](obj)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t};\n\t}\n\n\tsearchRows(search: string, columns?: { [key: TID]: boolean }) {\n\t\tsearch = search.trim().toLowerCase();\n\t\tconst rows: ISearchValue[\"rows\"] = {};\n\n\t\tif (!search) return rows;\n\n\t\tconst { flatData, columns: allColumns } = this.getState();\n\n\t\tconst columnsToSearch = columns\n\t\t\t? allColumns.filter(col => columns[col.id])\n\t\t\t: allColumns;\n\n\t\tflatData.forEach(row => {\n\t\t\tconst columnsMatches: { [key: TID]: boolean } = {};\n\n\t\t\tcolumnsToSearch.forEach(column => {\n\t\t\t\tconst cellValue = getRenderValue(row, column);\n\t\t\t\tif (String(cellValue).toLowerCase().includes(search)) {\n\t\t\t\t\tcolumnsMatches[column.id] = true;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (Object.keys(columnsMatches).length) {\n\t\t\t\trows[row.id] = columnsMatches;\n\t\t\t}\n\t\t});\n\n\t\treturn rows;\n\t}\n\n\tprivate normalizeSizes(\n\t\tcolumns: IRenderColumn[],\n\t\tsizes: ISizeConfig,\n\t\theaderRowCount: number,\n\t\tfooterRowCount: number,\n\t\tskin: string\n\t): IRenderSizes {\n\t\tconst headerRowHeights = getHeaderFooterHeights(\n\t\t\tcolumns,\n\t\t\t\"header\",\n\t\t\theaderRowCount,\n\t\t\tsizes.headerHeight,\n\t\t\tskin\n\t\t);\n\t\tconst footerRowHeights = getHeaderFooterHeights(\n\t\t\tcolumns,\n\t\t\t\"footer\",\n\t\t\tfooterRowCount,\n\t\t\tsizes.footerHeight,\n\t\t\tskin\n\t\t);\n\n\t\t// need to recalculate header/footer height if header has rows or vertical text\n\t\tconst headerHeight = headerRowHeights.reduce((a, b) => a + b, 0);\n\t\tconst footerHeight = footerRowHeights.reduce((a, b) => a + b, 0);\n\n\t\treturn {\n\t\t\t...sizes,\n\t\t\theaderRowHeights,\n\t\t\tfooterRowHeights,\n\t\t\theaderHeight,\n\t\t\tfooterHeight,\n\t\t};\n\t}\n}\n\nlet base = new Date().valueOf();\nfunction uid() {\n\treturn \"temp://\" + base++;\n}\n\ninterface ISkipUndoAction {\n\tskipUndo?: boolean;\n}\n\ntype CombineTypes<T, N> = {\n\t[P in keyof T]: T[P] & N;\n};\n\nexport type IDataMethodsConfig = CombineTypes<\n\t{\n\t\t[\"update-cell\"]: {\n\t\t\tid: TID;\n\t\t\tcolumn: TID;\n\t\t\tvalue: string | number | Date;\n\t\t\teventSource?: string;\n\t\t};\n\t\t[\"add-row\"]: {\n\t\t\tid?: TID;\n\t\t\tbefore?: TID;\n\t\t\tafter?: TID;\n\t\t\trow: IRow;\n\t\t\tselect?: boolean;\n\t\t\teventSource?: string;\n\t\t};\n\t\t[\"delete-row\"]: { id: TID; eventSource?: string };\n\t\t[\"update-row\"]: {\n\t\t\tid: TID;\n\t\t\trow: Record<string, any>;\n\t\t\teventSource?: string;\n\t\t};\n\t\t[\"select-row\"]: {\n\t\t\tid: TID;\n\t\t\ttoggle?: boolean;\n\t\t\trange?: boolean;\n\t\t\tmode?: boolean;\n\t\t\tshow?: boolean;\n\t\t\tcolumn?: TID;\n\t\t};\n\t\t[\"resize-column\"]: {\n\t\t\tid: TID;\n\t\t\twidth?: number;\n\t\t\tauto?: boolean | \"data\" | \"header\";\n\t\t\tmaxRows?: number;\n\t\t\tinProgress?: boolean;\n\t\t\teventSource?: string;\n\t\t};\n\t\t[\"hide-column\"]: {\n\t\t\tid: TID;\n\t\t\tmode?: boolean;\n\t\t\teventSource?: string;\n\t\t} & ISkipUndoAction;\n\t\t[\"sort-rows\"]: {\n\t\t\tkey: string;\n\t\t\torder?: \"asc\" | \"desc\";\n\t\t\tadd?: boolean | number;\n\t\t\tsort?: (a: IRow, b: IRow) => 1 | -1 | 0;\n\t\t};\n\t\t[\"search-rows\"]: {\n\t\t\tsearch: string;\n\t\t\tcolumns?: {\n\t\t\t\t[key: TID]: boolean;\n\t\t\t};\n\t\t};\n\t\t[\"open-editor\"]: {\n\t\t\tid: TID;\n\t\t\tcolumn?: TID;\n\t\t};\n\t\t[\"close-editor\"]: {\n\t\t\tignore?: boolean;\n\t\t};\n\t\t[\"editor\"]: {\n\t\t\tvalue: any;\n\t\t};\n\t\t[\"filter-rows\"]: {\n\t\t\tfilter?: any;\n\t\t\tkey?: string;\n\t\t\tvalue?: any;\n\t\t};\n\t\t[\"collapse-column\"]: {\n\t\t\tid: TID;\n\t\t\trow?: number;\n\t\t\tmode?: boolean;\n\t\t\teventSource?: string;\n\t\t};\n\t\t[\"move-item\"]: {\n\t\t\tid: TID;\n\t\t\ttarget?: TID;\n\t\t\tmode?: \"before\" | \"after\" | \"up\" | \"down\";\n\t\t\tinProgress?: boolean;\n\t\t\teventSource?: string;\n\t\t};\n\t\t[\"copy-row\"]: {\n\t\t\tid: TID;\n\t\t\ttarget?: TID;\n\t\t\tmode?: \"before\" | \"after\";\n\t\t\teventSource?: string;\n\t\t};\n\t\t[\"open-row\"]: {\n\t\t\tid: TID;\n\t\t\tnested?: boolean;\n\t\t\teventSource?: string;\n\t\t};\n\t\t[\"close-row\"]: {\n\t\t\tid: TID;\n\t\t\tnested?: boolean;\n\t\t\teventSource?: string;\n\t\t};\n\t\t[\"export-data\"]: IExportOptions;\n\t\t[\"scroll\"]: {\n\t\t\trow?: TID;\n\t\t\tcolumn?: TID;\n\t\t};\n\t\t[\"hotkey\"]: {\n\t\t\tkey: string;\n\t\t\tevent: any;\n\t\t\tisInput?: boolean;\n\t\t};\n\t\t[\"focus-cell\"]: {\n\t\t\trow?: TID;\n\t\t\tcolumn?: TID;\n\t\t\teventSource?: string;\n\t\t};\n\t\t[\"print\"]: IPrintConfig;\n\t\t[\"undo\"]: void;\n\t\t[\"redo\"]: void;\n\t\t[\"request-data\"]: {\n\t\t\trow: {\n\t\t\t\tstart: number;\n\t\t\t\tend: number;\n\t\t\t};\n\t\t};\n\t},\n\t{\n\t\t[key: string]: any;\n\t}\n>;\n","// src/locate.ts\nfunction locate(el, attr = \"data-id\") {\n  let node = el;\n  if (!node.tagName && el.target)\n    node = el.target;\n  while (node) {\n    if (node.getAttribute) {\n      const id3 = node.getAttribute(attr);\n      if (id3) return node;\n    }\n    node = node.parentNode;\n  }\n  return null;\n}\nfunction locateAttr(el, attr = \"data-id\") {\n  const node = locate(el, attr);\n  if (node) return node.getAttribute(attr);\n  return null;\n}\nfunction locateID(el, attr = \"data-id\") {\n  const node = locate(el, attr);\n  if (node) {\n    return id(node.getAttribute(attr));\n  }\n  return null;\n}\nfunction locateNode(el, node) {\n  let n = el;\n  while (n) {\n    if (n === node) {\n      return true;\n    }\n    n = n?.parentNode;\n  }\n  return null;\n}\nfunction id(value) {\n  if (typeof value === \"string\") {\n    const t = value * 1;\n    if (!isNaN(t)) return t;\n  }\n  return value;\n}\n\n// src/env.ts\nfunction getEnv() {\n  return {\n    detect: () => true,\n    addEvent: function(node, event, handler) {\n      node.addEventListener(event, handler);\n      return () => node.removeEventListener(event, handler);\n    },\n    addGlobalEvent: function(event, handler) {\n      document.addEventListener(event, handler);\n      return () => document.removeEventListener(event, handler);\n    },\n    getTopNode: function() {\n      return window.document.body;\n    }\n  };\n}\nvar env = getEnv();\nfunction setEnv(update) {\n  Object.assign(env, update);\n}\n\n// src/delegateClick.ts\nfunction delegateEvent(node, handlers, event) {\n  function handleEvent(ev) {\n    const node2 = locate(ev);\n    if (!node2) return;\n    const id3 = id(node2.dataset.id);\n    if (typeof handlers === \"function\") return handlers(id3, ev);\n    let action;\n    let test = ev.target;\n    while (test != node2) {\n      action = test.dataset ? test.dataset.action : null;\n      if (action) {\n        if (handlers[action]) {\n          handlers[action](id3, ev);\n          return;\n        }\n      }\n      test = test.parentNode;\n    }\n    if (handlers[event]) handlers[event](id3, ev);\n  }\n  env.addEvent(node, event, handleEvent);\n}\nfunction delegateClick(node, handlers) {\n  delegateEvent(node, handlers, \"click\");\n  if (handlers.dblclick) delegateEvent(node, handlers.dblclick, \"dblclick\");\n}\n\n// src/array.ts\nfunction remove(items, node) {\n  for (let i = items.length - 1; i >= 0; i--) {\n    if (items[i] === node) {\n      items.splice(i, 1);\n      break;\n    }\n  }\n}\n\n// src/clickOutside.ts\nvar activationDate = /* @__PURE__ */ new Date();\nvar skipNext = false;\nvar outsideHandlers = [];\nvar outsideListners = [];\nvar handleOutsideClick = (event) => {\n  if (skipNext) {\n    skipNext = false;\n    return;\n  }\n  for (let i = outsideListners.length - 1; i >= 0; i--) {\n    const { node, date, props } = outsideListners[i];\n    if (date > activationDate) continue;\n    if (!node.contains(event.target) && node !== event.target) {\n      if (props.callback) props.callback(event);\n      if (props.modal || event.defaultPrevented) break;\n    }\n  }\n};\nvar handleMouseDown = (event) => {\n  activationDate = /* @__PURE__ */ new Date();\n  skipNext = true;\n  for (let i = outsideListners.length - 1; i >= 0; i--) {\n    const { node } = outsideListners[i];\n    if (!node.contains(event.target) && node !== event.target) {\n      skipNext = false;\n      break;\n    }\n  }\n};\nfunction clickOutside(node, props) {\n  if (!outsideHandlers.length) {\n    outsideHandlers = [\n      env.addGlobalEvent(\"click\", handleOutsideClick, node),\n      env.addGlobalEvent(\"contextmenu\", handleOutsideClick, node),\n      env.addGlobalEvent(\"mousedown\", handleMouseDown, node)\n    ];\n  }\n  if (typeof props !== \"object\") {\n    props = { callback: props };\n  }\n  const pack = { node, date: /* @__PURE__ */ new Date(), props };\n  outsideListners.push(pack);\n  return {\n    destroy() {\n      remove(outsideListners, pack);\n      if (!outsideListners.length) {\n        outsideHandlers.forEach((e) => e());\n        outsideHandlers = [];\n      }\n    }\n  };\n}\n\n// src/positioning.ts\nvar isBottom = (mode) => mode.indexOf(\"bottom\") !== -1;\nvar isLeft = (mode) => mode.indexOf(\"left\") !== -1;\nvar isRight = (mode) => mode.indexOf(\"right\") !== -1;\nvar isTop = (mode) => mode.indexOf(\"top\") !== -1;\nvar isFit = (mode) => mode.indexOf(\"fit\") !== -1;\nvar isOverlap = (mode) => mode.indexOf(\"overlap\") !== -1;\nvar isCenter = (mode) => {\n  return mode.split(\"-\").every((v) => [\"center\", \"fit\"].indexOf(v) > -1);\n};\nvar getAlign = (mode) => {\n  const match = mode.match(/(start|center|end)/);\n  return match ? match[0] : null;\n};\nfunction getMaxIndex(p, ap) {\n  let zi = 0;\n  const top = env.getTopNode(p);\n  while (p) {\n    if (p === top) break;\n    const pos2 = getComputedStyle(p)[\"position\"];\n    if (pos2 === \"absolute\" || pos2 === \"relative\" || pos2 === \"fixed\") {\n      zi = parseInt(getComputedStyle(p)[\"zIndex\"]) || 0;\n    }\n    p = p.parentNode;\n    if (p === ap) break;\n  }\n  return zi;\n}\nvar x;\nvar y;\nvar width;\nvar pos;\nfunction calculatePosition(self, parent, at = \"bottom\", left = 0, top = 0) {\n  if (!self) return null;\n  x = left;\n  y = top;\n  width = \"auto\";\n  let z = 0;\n  let fixLeft = 0;\n  const body = getAbsParent(self);\n  const cont = isOverlap(at) ? env.getTopNode(self) : body;\n  if (!body) return null;\n  const bodyRect = body.getBoundingClientRect();\n  const selfRect = self.getBoundingClientRect();\n  const contRect = cont.getBoundingClientRect();\n  const contStyle = window.getComputedStyle(cont);\n  const border = {\n    left: 0,\n    top: 0,\n    bottom: 0,\n    right: 0\n  };\n  for (const key in border) {\n    const style = `border-${key}-width`;\n    border[key] = parseFloat(contStyle.getPropertyValue(style));\n  }\n  if (parent) {\n    const zi = getMaxIndex(parent, body);\n    z = Math.max(zi + 1, 20);\n  }\n  if (parent) {\n    pos = parent.getBoundingClientRect();\n    if (isFit(at)) width = pos.width + \"px\";\n    if (at !== \"point\") {\n      if (isCenter(at)) {\n        if (isFit(at)) {\n          x = 0;\n        } else {\n          x = contRect.width / 2;\n          fixLeft = 1;\n        }\n        y = (contRect.height - selfRect.height) / 2;\n      } else {\n        const fix = isOverlap(at) ? 0 : 1;\n        x = isRight(at) ? pos.right + fix : pos.left - fix;\n        y = isBottom(at) ? pos.bottom + 1 : pos.top;\n        const align = getAlign(at);\n        if (align) {\n          if (isRight(at) || isLeft(at)) {\n            if (align === \"center\") y -= (selfRect.height - pos.height) / 2;\n            else if (align === \"end\") y -= selfRect.height - pos.height;\n          } else if (isBottom(at) || isTop(at)) {\n            if (align === \"center\") x -= (selfRect.width - pos.width) / 2;\n            else if (align === \"end\") x -= selfRect.width - pos.width;\n            if (!isOverlap(at)) x += 1;\n          }\n        }\n      }\n    }\n  } else pos = { left, right: left, top, bottom: top };\n  const isCorner = (isLeft(at) || isRight(at)) && (isBottom(at) || isTop(at));\n  if (isLeft(at)) {\n    fixLeft = 2;\n  }\n  const dxL = x - selfRect.width - contRect.left;\n  if (parent && isLeft(at) && !isCorner && dxL < 0) {\n    x = pos.right;\n    fixLeft = 0;\n  }\n  const dxR = x + selfRect.width * (1 - fixLeft / 2) - contRect.right;\n  if (dxR > 0) {\n    if (!isRight(at)) {\n      x = contRect.right - border.right - selfRect.width;\n    } else {\n      const dx = pos.left - contRect.x - selfRect.width;\n      if (parent && !isOverlap(at) && !isCorner && dx >= 0) {\n        x = pos.left - selfRect.width;\n      } else {\n        x -= dxR + border.right;\n      }\n    }\n  }\n  if (fixLeft) {\n    x = Math.round(x - selfRect.width * fixLeft / 2);\n  }\n  const needSwap = dxL < 0 || dxR > 0 || !isCorner;\n  if (isTop(at)) {\n    y = pos.top - selfRect.height;\n    if (parent && y < contRect.y && needSwap) {\n      y = pos.bottom;\n    }\n  }\n  const dy = y + selfRect.height - contRect.bottom;\n  if (dy > 0) {\n    if (parent && isBottom(at) && needSwap) {\n      y -= selfRect.height + pos.height + 1;\n    } else {\n      y -= dy + border.bottom;\n    }\n  }\n  x -= bodyRect.left + border.left;\n  y -= bodyRect.top + border.top;\n  x = Math.max(x, 0) + cont.scrollLeft;\n  y = Math.max(y, 0) + cont.scrollTop;\n  width = width || \"auto\";\n  return { x, y, z, width };\n}\nfunction getAbsParent(el) {\n  const top = env.getTopNode(el);\n  if (el) el = el.parentElement;\n  while (el) {\n    const pos2 = getComputedStyle(el)[\"position\"];\n    if (el === top || pos2 === \"relative\" || pos2 === \"absolute\" || pos2 === \"fixed\")\n      return el;\n    el = el.parentNode;\n  }\n  return null;\n}\n\n// src/common.ts\nvar id2 = (/* @__PURE__ */ new Date()).valueOf();\nfunction uid() {\n  id2 += 1;\n  return id2;\n}\n\n// src/hotkeys.ts\nvar ScreenKeys = class {\n  constructor() {\n    this.store = /* @__PURE__ */ new Map();\n  }\n  configure(hotkeys2, node) {\n    this.node = node;\n    for (const hotkey in hotkeys2) {\n      if (hotkeys2[hotkey]) {\n        const hotkeyFormatted = hotkey.toLowerCase().replace(/[ ]/g, \"\");\n        const handler = hotkeys2[hotkey];\n        this.store.set(hotkeyFormatted, handler);\n      }\n    }\n  }\n};\nvar chain = [];\nvar hotkeys = {\n  subscribe: (v) => {\n    init_once();\n    const t = new ScreenKeys();\n    chain.push(t);\n    v(t);\n    return () => {\n      const ind = chain.findIndex((a) => a === t);\n      if (ind >= 0) chain.splice(ind, 1);\n    };\n  }\n};\nvar ready = false;\nfunction init_once() {\n  if (ready) return;\n  ready = true;\n  document.addEventListener(\"keydown\", (ev) => {\n    if (chain.length && (ev.ctrlKey || ev.altKey || ev.metaKey || ev.shiftKey || ev.key.length > 1 || ev.key === \" \")) {\n      const code = [];\n      if (ev.ctrlKey) code.push(\"ctrl\");\n      if (ev.altKey) code.push(\"alt\");\n      if (ev.metaKey) code.push(\"meta\");\n      if (ev.shiftKey) code.push(\"shift\");\n      let evKey = ev.code.replace(\"Key\", \"\").toLocaleLowerCase();\n      if (ev.key === \" \") {\n        evKey = \"space\";\n      }\n      code.push(evKey);\n      const key = code.join(\"+\");\n      for (let i = chain.length - 1; i >= 0; i--) {\n        const target = chain[i];\n        const handler = target.store.get(key) || target.store.get(evKey);\n        if (handler && target.node.contains(ev.target)) {\n          handler(ev, { key, evKey });\n        }\n      }\n    }\n  });\n}\n\n// src/dates.ts\nfunction toFixed(num) {\n  if (num < 10) return \"0\" + num;\n  return num.toString();\n}\nfunction toFixedMs(num) {\n  const temp = toFixed(num);\n  return temp.length == 2 ? \"0\" + temp : temp;\n}\nfunction getDuodecade(year) {\n  const start = Math.floor(year / 11) * 11;\n  return {\n    start,\n    end: start + 11\n  };\n}\nfunction getWeekNumber(ndate, weekStart = 1) {\n  let nday = ndate.getDay();\n  if (nday === 0) {\n    nday = 7;\n  }\n  nday = (nday - weekStart + 7) % 7;\n  const first_thursday = new Date(ndate.valueOf());\n  first_thursday.setDate(ndate.getDate() + (3 - nday));\n  const year_number = first_thursday.getFullYear();\n  const ordinal_date = Math.floor(\n    (first_thursday.getTime() - new Date(year_number, 0, 1).getTime()) / 864e5\n  );\n  return 1 + Math.floor(ordinal_date / 7);\n}\nvar emptyAmPm = [\"\", \"\"];\nfunction date2str(mask, date, locale2) {\n  switch (mask) {\n    case \"%d\":\n      return toFixed(date.getDate());\n    case \"%m\":\n      return toFixed(date.getMonth() + 1);\n    case \"%j\":\n      return date.getDate();\n    case \"%n\":\n      return date.getMonth() + 1;\n    case \"%y\":\n      return toFixed(date.getFullYear() % 100);\n    case \"%Y\":\n      return date.getFullYear();\n    case \"%D\":\n      return locale2.dayShort[date.getDay()];\n    case \"%l\":\n      return locale2.dayFull[date.getDay()];\n    case \"%M\":\n      return locale2.monthShort[date.getMonth()];\n    case \"%F\":\n      return locale2.monthFull[date.getMonth()];\n    case \"%h\":\n      return toFixed((date.getHours() + 11) % 12 + 1);\n    case \"%g\":\n      return (date.getHours() + 11) % 12 + 1;\n    case \"%G\":\n      return date.getHours();\n    case \"%H\":\n      return toFixed(date.getHours());\n    case \"%i\":\n      return toFixed(date.getMinutes());\n    case \"%a\":\n      return ((date.getHours() > 11 ? locale2.pm : locale2.am) || emptyAmPm)[0];\n    case \"%A\":\n      return ((date.getHours() > 11 ? locale2.pm : locale2.am) || emptyAmPm)[1];\n    case \"%s\":\n      return toFixed(date.getSeconds());\n    case \"%S\":\n      return toFixedMs(date.getMilliseconds());\n    case \"%W\":\n      return toFixed(getWeekNumber(date));\n    case \"%w\":\n      return toFixed(getWeekNumber(date, locale2.weekStart ?? 1));\n    case \"%c\": {\n      let str = date.getFullYear() + \"\";\n      str += \"-\" + toFixed(date.getMonth() + 1);\n      str += \"-\" + toFixed(date.getDate());\n      str += \"T\";\n      str += toFixed(date.getHours());\n      str += \":\" + toFixed(date.getMinutes());\n      str += \":\" + toFixed(date.getSeconds());\n      return str;\n    }\n    case \"%Q\":\n      return Math.floor(date.getMonth() / 3) + 1;\n    default:\n      return mask;\n  }\n}\nvar formatFlags = /%[a-zA-Z]/g;\nfunction dateToString(format, locale2) {\n  if (typeof format == \"function\") return format;\n  return function(date) {\n    if (!date) return \"\";\n    if (!date.getMonth) date = new Date(date);\n    return format.replace(\n      formatFlags,\n      (s) => date2str(s, date, locale2)\n    );\n  };\n}\n\n// src/locale.ts\nfunction isObject(a) {\n  return a && typeof a === \"object\" && !Array.isArray(a);\n}\nfunction extend(a, b) {\n  for (const key in b) {\n    const from = b[key];\n    if (isObject(a[key]) && isObject(from)) {\n      a[key] = extend(\n        { ...a[key] },\n        b[key]\n      );\n    } else {\n      a[key] = b[key];\n    }\n  }\n  return a;\n}\nfunction locale(words) {\n  return {\n    getGroup(group) {\n      const block = words[group];\n      return (key) => {\n        return block ? block[key] || key : key;\n      };\n    },\n    getRaw() {\n      return words;\n    },\n    extend(values, optional) {\n      if (!values) return this;\n      let data;\n      if (optional) {\n        data = extend({ ...values }, words);\n      } else {\n        data = extend({ ...words }, values);\n      }\n      return locale(data);\n    }\n  };\n}\n\n// src/salesforce.ts\nvar salesForceEnv = {\n  detect() {\n    if (typeof window === \"undefined\") return false;\n    return (\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      !!window[\"Sfdc\"] || // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      !!window[\"$A\"] || // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      !!window[\"Aura\"] || \"$shadowResolver$\" in document.body\n    );\n  },\n  addGlobalEvent: function(event, handler, rel) {\n    const d = salesForceEnv.getTopNode(rel);\n    d.addEventListener(event, handler);\n    return () => d.removeEventListener(event, handler);\n  },\n  getTopNode: function(rel) {\n    return rel.closest('[data-wx-root=\"true\"]');\n  }\n};\n\nexport { calculatePosition, clickOutside, dateToString, delegateClick, delegateEvent, env, getAbsParent, getDuodecade, hotkeys, id, locale, locate, locateAttr, locateID, locateNode, salesForceEnv, setEnv, uid };\n//# sourceMappingURL=index.js.map\n//# sourceMappingURL=index.js.map","export type hotkeysConfig = {\n\t[key: string]: ((event: KeyboardEvent) => void) | boolean;\n};\nexport type HotkeyHandler = (params: {\n\tkey: string;\n\tevent: KeyboardEvent;\n\tisInput: boolean;\n}) => void;\n\nimport { locate, hotkeys as libHotkeys } from \"@wx/lib-dom\";\n\nexport const defaultHotkeys: hotkeysConfig = {\n\ttab: true,\n\t\"shift+tab\": true,\n\tarrowup: true,\n\tarrowdown: true,\n\tarrowright: true,\n\tarrowleft: true,\n\tenter: true,\n\tescape: true,\n\tf2: true,\n\thome: true,\n\tend: true,\n\t\"ctrl+home\": true,\n\t\"ctrl+end\": true,\n\t\"ctrl+z\": true,\n\t\"ctrl+y\": true,\n};\n\nexport function hotkeys(\n\tnode: HTMLElement,\n\t{ keys, exec }: { keys: hotkeysConfig | false; exec: HotkeyHandler }\n) {\n\tif (!keys) return;\n\tfunction isTargetInput(event: KeyboardEvent) {\n\t\tconst target = event.target as Element;\n\n\t\treturn (\n\t\t\ttarget.tagName === \"INPUT\" ||\n\t\t\ttarget.tagName === \"TEXTAREA\" ||\n\t\t\tlocate(target, \"data-header-id\")?.classList.contains(\"wx-filter\") ||\n\t\t\t!!target.closest(\".wx-cell.wx-editor\")\n\t\t);\n\t}\n\n\tconst config: { [key: string]: (event: KeyboardEvent) => void } = {};\n\n\tfor (const key in keys) {\n\t\tconst handler = keys[key];\n\n\t\tif (typeof handler !== \"undefined\") {\n\t\t\tif (typeof handler === \"function\") {\n\t\t\t\tconfig[key] = handler;\n\t\t\t} else if (handler) {\n\t\t\t\tconfig[key] = (event: KeyboardEvent) => {\n\t\t\t\t\tconst isInput = isTargetInput(event);\n\t\t\t\t\texec({ key, event, isInput });\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n\n\tconst unsubscribe = libHotkeys.subscribe(t => {\n\t\tt.configure(config, node);\n\t});\n\n\treturn {\n\t\tdestroy: () => {\n\t\t\tunsubscribe();\n\t\t},\n\t};\n}\n","import type { TScrollConfig } from \"./types\";\n\nexport function scrollTo(\n\tnode: HTMLElement,\n\tconfig: { scroll: any; getHeight: any; getWidth: any; getScrollMargin: any }\n) {\n\tlet prev: TScrollConfig = null;\n\tconfig.scroll.subscribe((v: TScrollConfig) => {\n\t\tif (!v || v === prev) return;\n\t\tprev = v;\n\n\t\tconst { left, top, height, width } = v;\n\t\tconst bHeight = config.getHeight();\n\t\tconst bWidth = config.getWidth();\n\t\tconst margin = config.getScrollMargin();\n\n\t\tif (top >= 0) {\n\t\t\tconst now = node.scrollTop;\n\t\t\tif (top < now) {\n\t\t\t\tnode.scrollTop = top;\n\t\t\t} else if (top + height > now + bHeight) {\n\t\t\t\tnode.scrollTop = top - bHeight + height;\n\t\t\t}\n\t\t}\n\t\tif (left >= 0) {\n\t\t\tconst now = node.scrollLeft;\n\t\t\tif (left < now) {\n\t\t\t\tnode.scrollLeft = left;\n\t\t\t} else if (left + width > now + bWidth - margin) {\n\t\t\t\tnode.scrollLeft = left - bWidth + width + margin;\n\t\t\t}\n\t\t}\n\t});\n}\n","import type { TID } from \"@wx/lib-state\";\nimport type { IApi, IHistory } from \"../types\";\n\nexport interface ICheckableItem {\n\tid?: TID;\n\tisDisabled?:\n\t\t| ((ids: TID[], data: any[]) => boolean)\n\t\t| ((history: IHistory) => boolean)\n\t\t| ((api: IApi & { _temp: { id: TID; cut: boolean }[] }) => boolean);\n\t[key: string]: any;\n}\n\nexport function assignChecks<T extends ICheckableItem>(items: T[]): T[] {\n\treturn items.map(item => {\n\t\titem = { ...item };\n\n\t\t// handle nested items\n\t\tif (item.data)\n\t\t\t(item.data as ICheckableItem[]) = assignChecks(item.data);\n\t\tif (item.items)\n\t\t\t(item.data as ICheckableItem[]) = assignChecks(item.items);\n\n\t\tswitch (item.id) {\n\t\t\tcase \"move-item:up\":\n\t\t\t\titem.isDisabled = (ids, data) => isFirstRow(ids, data);\n\t\t\t\tbreak;\n\t\t\tcase \"move-item:down\":\n\t\t\t\titem.isDisabled = (ids, data) => isLastRow(ids, data);\n\t\t\t\tbreak;\n\t\t\tcase \"undo\":\n\t\t\t\titem.isDisabled = (history: IHistory) => !history.undo;\n\t\t\t\tbreak;\n\t\t\tcase \"redo\":\n\t\t\t\titem.isDisabled = (history: IHistory) => !history.redo;\n\t\t\t\tbreak;\n\t\t\tcase \"paste-row\":\n\t\t\t\titem.isDisabled = (api: any) => !api._temp?.length;\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn item;\n\t});\n}\n\nfunction isFirstRow(ids: TID[], data: any[]) {\n\treturn ids.some(id => data[0]?.id == id);\n}\n\nfunction isLastRow(ids: TID[], data: any[]) {\n\treturn ids.some(id => data[data.length - 1]?.id == id);\n}\n","import type { TID } from \"@wx/lib-state\";\n\nexport interface IButtonConfig {\n\tid?: TID;\n\tcomp: string;\n\ttext?: string;\n\ticon?: string;\n\ttype?: string;\n\tmenuText?: string;\n}\n\nexport const defaultToolbarButtons: IButtonConfig[] = [\n\t{\n\t\tid: \"add-row\",\n\t\tcomp: \"button\",\n\t\ticon: \"wxi-plus\",\n\t\ttext: \"New row\",\n\t\ttype: \"primary\",\n\t},\n\t{\n\t\tid: \"open-editor\",\n\t\tcomp: \"icon\",\n\t\ticon: \"wxi-edit\",\n\t\tmenuText: \"Edit\",\n\t\ttext: \"Edit\",\n\t},\n\t{\n\t\tid: \"delete-row\",\n\t\tcomp: \"icon\",\n\t\ticon: \"wxi-delete\",\n\t\tmenuText: \"Delete\",\n\t\ttext: \"Delete\",\n\t},\n\t{\n\t\tid: \"copy-row\",\n\t\tcomp: \"icon\",\n\t\ticon: \"wxi-content-copy\",\n\t\tmenuText: \"Copy\",\n\t\ttext: \"Copy\",\n\t},\n\t{\n\t\tid: \"cut-row\",\n\t\tcomp: \"icon\",\n\t\ticon: \"wxi-content-cut\",\n\t\tmenuText: \"Cut\",\n\t\ttext: \"Cut\",\n\t},\n\t{\n\t\tid: \"paste-row\",\n\t\tcomp: \"icon\",\n\t\ticon: \"wxi-content-paste\",\n\t\tmenuText: \"Paste\",\n\t\ttext: \"Paste\",\n\t},\n\t{\n\t\tid: \"move-item:up\",\n\t\tcomp: \"icon\",\n\t\ticon: \"wxi-angle-up\",\n\t\tmenuText: \"Move up\",\n\t\ttext: \"Move up\",\n\t},\n\t{\n\t\tid: \"move-item:down\",\n\t\tcomp: \"icon\",\n\t\ticon: \"wxi-angle-down\",\n\t\tmenuText: \"Move down\",\n\t\ttext: \"Move down\",\n\t},\n\t{ comp: \"separator\" },\n\t{\n\t\tid: \"undo\",\n\t\tcomp: \"icon\",\n\t\ticon: \"wxi-undo\",\n\t\tmenuText: \"Undo\",\n\t\ttext: \"Ctrl+Z\",\n\t},\n\t{\n\t\tid: \"redo\",\n\t\tcomp: \"icon\",\n\t\ticon: \"wxi-redo\",\n\t\tmenuText: \"Redo\",\n\t\ttext: \"Ctrl+Y\",\n\t},\n];\n","import type { TID } from \"@wx/lib-state\";\n\nexport interface IOptionConfig {\n\tid?: TID;\n\ttext?: string;\n\ticon?: string;\n\tcomp?: \"separator\";\n}\n\nexport const defaultMenuOptions: IOptionConfig[] = [\n\t{\n\t\tid: \"add-row:before\",\n\t\ttext: \"Add before\",\n\t\ticon: \"wxi-table-row-plus-before\",\n\t},\n\t{\n\t\tid: \"add-row:after\",\n\t\ttext: \"Add after\",\n\t\ticon: \"wxi-table-row-plus-after\",\n\t},\n\t{\n\t\tid: \"copy-row\",\n\t\ttext: \"Copy\",\n\t\ticon: \"wxi-content-copy\",\n\t},\n\t{\n\t\tid: \"cut-row\",\n\t\ttext: \"Cut\",\n\t\ticon: \"wxi-content-cut\",\n\t},\n\t{\n\t\tid: \"paste-row\",\n\t\ttext: \"Paste\",\n\t\ticon: \"wxi-content-paste\",\n\t},\n\t{\n\t\tid: \"move-item:up\",\n\t\ttext: \"Move up\",\n\t\ticon: \"wxi-angle-up\",\n\t},\n\t{\n\t\tid: \"move-item:down\",\n\t\ttext: \"Move down\",\n\t\ticon: \"wxi-angle-down\",\n\t},\n\t{ comp: \"separator\" },\n\t{ id: \"delete-row\", text: \"Delete\", icon: \"wxi-delete-outline\" },\n];\n","import { TID } from \"@wx/lib-state\";\nimport type { IApi } from \"../types\";\n\nexport function handleAction(\n\tapi: IApi & { _temp: { id: TID; cut: boolean }[] },\n\taction: string\n) {\n\tconst { selectedRows, data, focusCell } = api.getState();\n\n\tif (action !== \"paste-row\") api._temp = null;\n\n\tswitch (action) {\n\t\tcase \"add-row\": {\n\t\t\tif (selectedRows.length) {\n\t\t\t\tselectedRows.forEach(id =>\n\t\t\t\t\tapi.exec(\"add-row\", { row: {}, after: id })\n\t\t\t\t);\n\t\t\t} else api.exec(\"add-row\", { row: {} });\n\t\t\tbreak;\n\t\t}\n\t\tcase \"add-row:before\": {\n\t\t\tselectedRows.forEach(id =>\n\t\t\t\tapi.exec(\"add-row\", { row: {}, before: id })\n\t\t\t);\n\t\t\tbreak;\n\t\t}\n\t\tcase \"add-row:after\": {\n\t\t\tselectedRows.forEach(id =>\n\t\t\t\tapi.exec(\"add-row\", { row: {}, after: id })\n\t\t\t);\n\t\t\tbreak;\n\t\t}\n\t\tcase \"open-editor\": {\n\t\t\tif (focusCell && selectedRows.includes(focusCell.row)) {\n\t\t\t\tconst column = api.getColumn(focusCell.column);\n\t\t\t\tapi.exec(\"open-editor\", {\n\t\t\t\t\tid: focusCell.row,\n\t\t\t\t\tcolumn: column.editor ? focusCell.column : undefined,\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tapi.exec(\"open-editor\", {\n\t\t\t\t\tid: selectedRows[0],\n\t\t\t\t});\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t\tcase \"copy-row\": {\n\t\t\tselectedRows.forEach(id => {\n\t\t\t\tif (!api._temp) api._temp = [];\n\t\t\t\tapi._temp.push({ id, cut: false });\n\t\t\t});\n\t\t\tbreak;\n\t\t}\n\t\tcase \"cut-row\": {\n\t\t\tselectedRows.forEach(id => {\n\t\t\t\tif (!api._temp) api._temp = [];\n\t\t\t\tapi._temp.push({ id, cut: true });\n\t\t\t});\n\t\t\tbreak;\n\t\t}\n\t\tcase \"paste-row\": {\n\t\t\tif (api._temp?.length) {\n\t\t\t\tconst sortedTemp = [...api._temp].sort(\n\t\t\t\t\t(a, b) =>\n\t\t\t\t\t\tdata.findIndex(d => d.id == b.id) -\n\t\t\t\t\t\tdata.findIndex(d => d.id == a.id)\n\t\t\t\t);\n\t\t\t\tsortedTemp.forEach((temp: any, ti) => {\n\t\t\t\t\tselectedRows.forEach((id, ri) => {\n\t\t\t\t\t\tconst ev = {\n\t\t\t\t\t\t\tid: temp.id,\n\t\t\t\t\t\t\ttarget: id,\n\t\t\t\t\t\t\tmode: \"after\" as const,\n\t\t\t\t\t\t};\n\t\t\t\t\t\tapi.exec(temp.cut ? \"move-item\" : \"copy-row\", ev);\n\n\t\t\t\t\t\tif (!temp.cut) {\n\t\t\t\t\t\t\tapi.exec(\"select-row\", {\n\t\t\t\t\t\t\t\tid: ev.id,\n\t\t\t\t\t\t\t\ttoggle: !!ti || !!ri,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t\tcase \"delete-row\":\n\t\t\tselectedRows.forEach(r => api.exec(\"delete-row\", { id: r }));\n\t\t\tbreak;\n\t\tcase \"move-item:up\": {\n\t\t\t// sort rows according to their position in data\n\t\t\tconst sortedRows = [...selectedRows].sort(\n\t\t\t\t(a, b) =>\n\t\t\t\t\tdata.findIndex(d => d.id == a) -\n\t\t\t\t\tdata.findIndex(d => d.id == b)\n\t\t\t);\n\n\t\t\tsortedRows.forEach(id => {\n\t\t\t\tapi.exec(\"move-item\", { id, mode: \"up\" });\n\t\t\t});\n\t\t\tbreak;\n\t\t}\n\t\tcase \"move-item:down\": {\n\t\t\t// sort rows in reverse order according to their position in data\n\t\t\tconst sortedRows = [...selectedRows].sort(\n\t\t\t\t(a, b) =>\n\t\t\t\t\tdata.findIndex(d => d.id == b) -\n\t\t\t\t\tdata.findIndex(d => d.id == a)\n\t\t\t);\n\n\t\t\tsortedRows.forEach(id => {\n\t\t\t\tapi.exec(\"move-item\", { id, mode: \"down\" });\n\t\t\t});\n\t\t\tbreak;\n\t\t}\n\t\tcase \"undo\":\n\t\t\tapi.exec(\"undo\");\n\t\t\tbreak;\n\t\tcase \"redo\":\n\t\t\tapi.exec(\"redo\");\n\t\t\tbreak;\n\t}\n}\n"],"names":["iid","uid","isSameObject","left","right","key","v","nv","isSame","i","deepCopy","obj","out","STORE_SET_SILENT","Store","config","data","mode","signals","state","values","parent","os","ov","fullKey","fullKey2","signals2","val","ss","__triggerSync","fn","DataRouter","s","r","p","b","a","k","arr","h","_calckSize","cfg","next","parser","updates","ctx","keys","needExec","trgs","sources","prev","sizes","EventBus","name","handler","tag","stack","ev","res","rawGetter","rawSetter","getValue","row","col","getter","id","setValue","setter","getEditorConfig","columns","filter","editor","map","label","header","options","comp","type","download","blob","filename","document","createElement","href","URL","createObjectURL","body","appendChild","click","removeChild","getRenderValue","template","optionsMap","Array","isArray","x","get","getCsvData","reg","csv","rowSep","rows","colSep","cols","_columns","flatData","addCsvHeader","length","c","value","test","replace","push","join","footer","text","getExcelData","styles","cells","merged","colSizes","rowSizes","_sizes","width","flexgrow","columnWidth","rIndex","addExcelHeader","concat","headerRowHeights","height","dataRow","newStyle","cellStyle","cellTemplate","result","prepareCellValues","rowHeight","footerRowHeights","colspan","rowspan","from","column","to","headerCellStyle","headerCellTemplate","baseIndex","Date","getExcelDate","format","findIndex","style","getExportStyles","skin","fontColor","material","willow","bg","headerBg","border","headerBorderColor","color","hBorder","align","verticalAlign","headerStyles","fontWeight","background","borderBottom","borderRight","cell","date","getTime","getTimezoneOffset","MODE","PPI","PAPER","PAPERS","a3","a4","letter","getPrintColumns","tables","visibleColumns","hidden","maxWidth","getPaperWidth","forEach","index","getHeaderFooterPrintColumns","rowsHeights","hcell","nextCell","collapsed","colstubs","slice","reduce","y","rowstubs","rRow","currentCell","lastCell","findLast","ppi","paper","getPixels","inches","normalizePrintConfig","getPrintCellStyle","getPrintFilterValue","filterValues","find","COLUMNS_ACTIONS","DATA_ACTIONS","FLATDATA_ACTIONS","PROGRESS_ACTIONS","HistoryManager","undo","redo","progress","in","getState","setState","_previousValues","constructor","eventBus","stateGetter","stateSetter","setHandlers","resetStateHistory","getHandlers","action","source","getPrev","rowIndex","before","undefined","getRow","getColumn","prevValue","rowData","Object","includes","target","sourceIndex","nested","resetHistory","handlers","intercept","eventSource","skipUndo","inProgress","setPrev","on","historyEntry","addToHistory","prop","entry","setStateHistory","handleUndo","pop","exec","handleRedo","history","tree","getTreeRow","getStamp","gen","isCommunity","community","sortAsc","sortDesc","sortBy","order","sort","comparisonResult","sortMethod","sortByMany","sortArray","sorts","item","BASE_CELL_OFFSET","SORT_EL_OFFSET","suggestSkin","querySelector","className","substring","getTextSize","css","offsets","basewidth","container","content","classList","add","cssText","innerText","rect","getBoundingClientRect","rectWidth","Math","ceil","rectHeight","max","remove","getHeaderFooterHeights","condition","rowsCount","defaultHeight","vertical","cellCss","count","prevHeight","sum","diff","getColumnWidth","colText","treetoggle","$level","$count","draggable","getHeaderColWidth","sortElOffset","currWidth","filtersHandlers","toString","toLowerCase","indexOf","richselect","getFilterHandler","DataStore","_router","_branches","_xlsxWorker","_historyManager","w","writable","async","defaultSizes","headerHeight","footerHeight","bind","_skin","copyColumns","headerRowCount","footerRowCount","setCollapsibleColumns","normalizeSizes","normalizeColumns","dynamic","_filterIds","filterIds","filterSet","Set","flattenRows","d","has","hasHeight","some","_rowHeightFromData","inBus","ignore","getNextEditor","columnEditor","renderedValue","select","after","selectForce","splice","update","show","selectedRows","focusCell","isSelected","updateTreeRow","$parent","toggle","range","sindex","eindex","split","auto","maxRows","min","curData","nextData","sortMarks","fields","fLength","sortArr","sorter","sortTree","filterFn","createFilter","filterTree","targetIndex","updatedData","moveItem","normalizeTreeRows","sourceRow","copiedRow","toggleBranch","Promise","resolve","reject","fileName","Blob","styleOps","excel","stylesArr","lastHeaderCell","firstFooterCell","fill","cellStyles","path","cdn","xlsxWorker","getXlsxWorker","then","onmessage","e","postMessage","sheetName","search","searchRows","event","isInput","preventDefault","colId","_getFirstVisibleColumn","rowId","getPrevRow","getNextRow","getNextColumn","getPrevColumn","getPrevEditor","open","_getLastVisibleColumn","at","top","ind","total","scroll","_print","setStateAsync","initOnce","url","window","Worker","addEventListener","init","hasOwnProperty","Map","normalizeRows","reorder","getRowIndex","visible","start","isCellEditable","findLastIndex","toggleKids","parentRow","parentIndex","findAndRemove","items","copy","found","insertItem","targetId","targetItem","insertIndex","prevItem","movedItem","copyHeaderFooter","collapsible","spanStart","span","curCol","_colindex","rowHeights","_hidden","nextColRows","curCell","level","filters","field","trim","allColumns","columnsToSearch","columnsMatches","cellValue","String","base","valueOf","locate","el","attr","node","ScreenKeys","hotkeys2","hotkey","hotkeyFormatted","chain","hotkeys","init_once","ready","code","evKey","defaultHotkeys","tab","arrowup","arrowdown","arrowright","arrowleft","enter","escape","f2","home","end","isTargetInput","tagName","contains","closest","unsubscribe","libHotkeys","subscribe","t","configure","destroy","scrollTo","bHeight","getHeight","bWidth","getWidth","margin","getScrollMargin","now","scrollTop","scrollLeft","assignChecks","isDisabled","ids","isFirstRow","isLastRow","api","_temp","defaultToolbarButtons","icon","menuText","defaultMenuOptions","handleAction","cut","temp","ti","ri","sortedRows"],"mappings":"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","x_google_ignoreList":[0,12]}
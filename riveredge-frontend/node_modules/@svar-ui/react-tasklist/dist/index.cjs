"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const s=require("react/jsx-runtime"),a=require("react"),p=require("@svar-ui/react-core"),W=require("@svar-ui/lib-dom"),Q=require("@svar-ui/lib-state"),q=require("@svar-ui/lib-react"),S=require("@svar-ui/tasklist-locales");function O(h){const{task:e,edit:c,readonly:i,onUpdate:r,onRemove:f}=h,x=a.useContext(p.context.i18n).getGroup("tasklist"),w=a.useRef(null),d=a.useRef(""),k=a.useCallback(()=>{const n=w.current;n&&(n.style.height=n.scrollHeight+2+"px")},[]),D=a.useCallback(()=>{const n=w.current;n&&(d.current=n.value,k())},[k]),C=a.useCallback(({value:n})=>{r({task:e,status:n?1:0,content:d.current||e.content})},[r,e]),m=a.useCallback(n=>{r({task:e,content:d.current,status:e.status,next:n})},[r,e]),b=a.useCallback(n=>{n.key==="Escape"?r({task:e,status:e.status,content:""}):n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),m(!0))},[r,e,m]);return a.useEffect(()=>{const n=w.current;n&&(d.current=n.value=e.content,n.focus(),k())},[e,c,k]),a.useEffect(()=>{const n=w.current;if(n)return W.clickOutside(n,m).destroy},[c,m]),s.jsxs("div",{className:`wx-OQDwWK17 wx-task${e.status?" wx-done":""}`,children:[s.jsx("div",{className:"wx-OQDwWK17 wx-checkbox-wrapper",children:c===e.id&&e.id===-1?s.jsx("div",{className:"wx-OQDwWK17 wx-icon-add",children:s.jsx("i",{className:"wx-OQDwWK17 wxi-plus"})}):s.jsx(p.Checkbox,{onChange:C,value:e.status})}),s.jsx("div",{className:"wx-OQDwWK17 wx-wrapper",children:c===e.id?s.jsx("textarea",{ref:w,className:"wx-OQDwWK17 wx-texarea",placeholder:x("Enter the task..."),onKeyDown:b,onInput:D}):s.jsx("div",{className:"wx-OQDwWK17 wx-text-wrapper","data-id":e.id,children:s.jsx("span",{className:"wx-OQDwWK17 wx-text",children:e.content})})}),s.jsx("div",{className:"wx-OQDwWK17 wx-icon-close",children:!i&&c!==e.id?s.jsx("i",{className:"wx-OQDwWK17 wxi-close",onClick:()=>f(e.id)}):null})]})}function R(h){const{readonly:e=!1,onChange:c}=h,[i,r]=q.useWritableProp(h.data||[]),[f,x]=a.useState(null),[w,d]=a.useState(null),k=a.useContext(p.context.i18n),D=a.useMemo(()=>k.getGroup("tasklist"),[k]);function C(){x(-1),d({id:-1,content:"",status:0})}function m(t){const l={id:Q.tempID(),content:t,status:0},u=[...i,l];if(r(u),c){const o=c({value:u,task:l,action:"add"});o&&typeof o=="object"&&(o.then?o.then(j=>{b(l.id,j)}):b(l.id,o))}}function b(t,l){r(u=>{const o=u.findIndex(v=>v.id===t);if(o===-1)return u;const j=[...u];return j[o]={...u[o],...l},j})}function n(t){f===t&&x(null);const l=i.filter(u=>u.id!==t);r(l),t!==-1&&c&&c({value:l,id:t,action:"delete"})}function E(t,l,u){let o;const j=i.map(v=>v.id===t?(o={...v,content:l,status:u},o):v);r(j),x(null),c&&c({value:j,id:t,action:"update",task:o})}function y(t){n(t)}function N({task:t,content:l,status:u,next:o}){t.id===-1?(x(null),l?(m(l),o&&C()):n(t.id)):(l?(l!==t.content||u!==t.status)&&E(t.id,l,u):n(t.id),x(null))}const g=a.useRef({});g.current.dblclick=t=>{h.readonly||x(t)};const K=a.useRef(null);return a.useEffect(()=>{W.delegateClick(K.current,{dblclick:t=>g.current.dblclick(t)})},[]),s.jsx(p.context.fieldId.Provider,{value:null,children:s.jsxs("div",{className:"wx-kro6Nsfl wx-tasks-list",children:[s.jsxs("div",{className:"wx-kro6Nsfl wx-list",ref:K,children:[i.map(t=>s.jsx(O,{task:t,edit:f,onUpdate:N,onRemove:y,readonly:e},t.id)),f===-1?s.jsx(O,{task:w,edit:f,onUpdate:N,onRemove:y},f):null]}),!e&&f!==-1?s.jsx("div",{className:"wx-kro6Nsfl wx-button",children:s.jsx(p.Button,{onClick:C,children:D("Add task")})}):null]})})}function T(h){const{onData:e,onChange:c,value:i,...r}=h;let[f,x]=a.useState(null);a.useEffect(()=>{e&&i?Promise.resolve(e(i)).then(d=>x(d)):i&&i.then?i.then(d=>x(d)):x(i||[])},[e,i]);const w=a.useCallback(d=>(d.originalValue=i,c&&c(d)),[c,i]);return s.jsx(p.Locale,{words:S.en,optional:!0,children:f===null?s.jsx(R,{data:[],readonly:!0,...r,onChange:w}):s.jsx(R,{data:f,...r,onChange:w})})}exports.Tasklist=T;
//# sourceMappingURL=index.cjs.map

{"version":3,"file":"index.es.js","sources":["../src/components/Task.jsx","../src/components/Layout.jsx","../src/components/Tasklist.jsx"],"sourcesContent":["import { useCallback, useContext, useEffect, useRef } from 'react';\nimport { Checkbox } from '@svar-ui/react-core';\nimport { clickOutside } from '@svar-ui/lib-dom';\nimport { context } from '@svar-ui/react-core';\nimport './Task.css';\n\nexport default function Task(props) {\n  const { task, edit, readonly, onUpdate, onRemove } = props;\n\n  const _ = useContext(context.i18n).getGroup('tasklist');\n\n  const textareaRef = useRef(null);\n  const contentRef = useRef('');\n\n  const adjustHeight = useCallback(() => {\n    const textarea = textareaRef.current;\n    if (textarea) {\n      textarea.style.height = textarea.scrollHeight + 2 + 'px';\n    }\n  }, []);\n\n  const handleContent = useCallback(() => {\n    const textarea = textareaRef.current;\n    if (textarea) {\n      contentRef.current = textarea.value;\n      adjustHeight();\n    }\n  }, [adjustHeight]);\n\n  const handleStatus = useCallback(\n    ({ value }) => {\n      onUpdate({\n        task,\n        status: value ? 1 : 0,\n        content: contentRef.current || task.content,\n      });\n    },\n    [onUpdate, task],\n  );\n\n  const saveTask = useCallback(\n    (next) => {\n      onUpdate({\n        task,\n        content: contentRef.current,\n        status: task.status,\n        next,\n      });\n    },\n    [onUpdate, task],\n  );\n\n  const handleKeydown = useCallback(\n    (e) => {\n      if (e.key === 'Escape') {\n        onUpdate({ task, status: task.status, content: '' });\n      } else if (e.key === 'Enter' && !e.shiftKey) {\n        e.preventDefault();\n        saveTask(true);\n      }\n    },\n    [onUpdate, task, saveTask],\n  );\n\n  useEffect(() => {\n    const textarea = textareaRef.current;\n    if (textarea) {\n      contentRef.current = textarea.value = task.content;\n      textarea.focus();\n      adjustHeight();\n    }\n  }, [task, edit, adjustHeight]);\n\n  useEffect(() => {\n    const textarea = textareaRef.current;\n    if (!textarea) return;\n    return clickOutside(textarea, saveTask).destroy;\n  }, [edit, saveTask]);\n\n  return (\n    <div className={`wx-OQDwWK17 wx-task${task.status ? ' wx-done' : ''}`}>\n      <div className=\"wx-OQDwWK17 wx-checkbox-wrapper\">\n        {edit === task.id && task.id === -1 ? (\n          <div className=\"wx-OQDwWK17 wx-icon-add\">\n            <i className=\"wx-OQDwWK17 wxi-plus\"></i>\n          </div>\n        ) : (\n          <Checkbox onChange={handleStatus} value={task.status} />\n        )}\n      </div>\n\n      <div className=\"wx-OQDwWK17 wx-wrapper\">\n        {edit === task.id ? (\n          <textarea\n            ref={textareaRef}\n            className=\"wx-OQDwWK17 wx-texarea\"\n            placeholder={_('Enter the task...')}\n            onKeyDown={handleKeydown}\n            onInput={handleContent}\n          />\n        ) : (\n          <div className=\"wx-OQDwWK17 wx-text-wrapper\" data-id={task.id}>\n            <span className=\"wx-OQDwWK17 wx-text\">{task.content}</span>\n          </div>\n        )}\n      </div>\n\n      <div className=\"wx-OQDwWK17 wx-icon-close\">\n        {!readonly && edit !== task.id ? (\n          <i\n            className=\"wx-OQDwWK17 wxi-close\"\n            onClick={() => onRemove(task.id)}\n          ></i>\n        ) : null}\n      </div>\n    </div>\n  );\n}\n","import { useState, useMemo, useContext, useEffect, useRef } from 'react';\nimport { Button } from '@svar-ui/react-core';\nimport { delegateClick } from '@svar-ui/lib-dom';\nimport { tempID } from '@svar-ui/lib-state';\nimport { context } from '@svar-ui/react-core';\nimport { useWritableProp } from '@svar-ui/lib-react';\nimport Task from './Task.jsx';\nimport './Layout.css';\n\nexport default function Layout(props) {\n  const { readonly = false, onChange } = props;\n\n  const [data, setData] = useWritableProp(props.data || []);\n\n  const [edit, setEdit] = useState(null);\n  const [editTask, setEditTask] = useState(null);\n\n  const i18n = useContext(context.i18n);\n  const _ = useMemo(() => i18n.getGroup('tasklist'), [i18n]);\n\n  function openEditor() {\n    setEdit(-1);\n    setEditTask({ id: -1, content: '', status: 0 });\n  }\n\n  function add(content) {\n    const task = {\n      id: tempID(),\n      content,\n      status: 0,\n    };\n\n    const next = [...data, task];\n    setData(next);\n    if (onChange) {\n      const res = onChange({ value: next, task, action: 'add' });\n      if (res && typeof res === 'object') {\n        if (res.then) {\n          res.then((data) => {\n            updateAfter(task.id, data);\n          });\n        } else {\n          updateAfter(task.id, res);\n        }\n      }\n    }\n  }\n\n  function updateAfter(id, data) {\n    setData((prev) => {\n      const index = prev.findIndex((d) => d.id === id);\n      if (index === -1) return prev;\n      const copy = [...prev];\n      copy[index] = { ...prev[index], ...data };\n      return copy;\n    });\n  }\n\n  function remove(id) {\n    if (edit === id) setEdit(null);\n\n    const next = data.filter((d) => d.id !== id);\n    setData(next);\n    if (id !== -1) {\n      onChange && onChange({ value: next, id, action: 'delete' });\n    }\n  }\n\n  function update(id, content, status) {\n    let task;\n    const next = data.map((d) => {\n      if (d.id === id) {\n        task = { ...d, content, status };\n        return task;\n      } else return d;\n    });\n    setData(next);\n    setEdit(null);\n\n    onChange && onChange({ value: next, id, action: 'update', task });\n  }\n\n  function onRemove(id) {\n    remove(id);\n  }\n\n  function onUpdate({ task, content, status, next }) {\n    if (task.id === -1) {\n      setEdit(null);\n      if (content) {\n        add(content);\n        if (next) {\n          openEditor();\n        }\n      } else {\n        remove(task.id);\n      }\n    } else {\n      if (content) {\n        if (content !== task.content || status !== task.status) update(task.id, content, status);\n      } else {\n        remove(task.id);\n      }\n      setEdit(null);\n    }\n  }\n\n  const handlers = useRef({});\n  handlers.current.dblclick = (id) => {\n    if (!props.readonly) setEdit(id);\n  };\n\n  const listRef = useRef(null);\n  useEffect(() => {\n    delegateClick(listRef.current, {\n      dblclick: (id) => handlers.current.dblclick(id),\n    });\n  }, []);\n\n  return (\n    <context.fieldId.Provider value={null}>\n      <div className=\"wx-kro6Nsfl wx-tasks-list\">\n        <div className=\"wx-kro6Nsfl wx-list\" ref={listRef}>\n          {data.map((task) => (\n            <Task\n              key={task.id}\n              task={task}\n              edit={edit}\n              onUpdate={onUpdate}\n              onRemove={onRemove}\n              readonly={readonly}\n            />\n          ))}\n          {edit === -1 ? (\n            <Task\n              key={edit}\n              task={editTask}\n              edit={edit}\n              onUpdate={onUpdate}\n              onRemove={onRemove}\n            />\n          ) : null}\n        </div>\n        {!readonly && edit !== -1 ? (\n          <div className=\"wx-kro6Nsfl wx-button\">\n            <Button onClick={openEditor}>{_('Add task')}</Button>\n          </div>\n        ) : null}\n      </div>\n    </context.fieldId.Provider>\n  );\n}\n","import { useEffect, useState, useCallback } from 'react';\nimport Layout from './Layout.jsx';\nimport { Locale } from '@svar-ui/react-core';\nimport { en } from '@svar-ui/tasklist-locales';\n\nfunction Tasklist(allProps) {\n  const { onData, onChange, value, ...props } = allProps;\n  let [finalData, setFinalData] = useState(null);\n\n  useEffect(() => {\n    if (onData && value) {\n      Promise.resolve(onData(value)).then((x) => setFinalData(x));\n    } else if (value && value.then) {\n      value.then((x) => setFinalData(x));\n    } else {\n      setFinalData(value || []);\n    }\n  }, [onData, value]);\n\n  const handleOnChange = useCallback(\n    (e) => {\n      e.originalValue = value;\n      return onChange && onChange(e);\n    },\n    [onChange, value],\n  );\n\n  return (\n    <Locale words={en} optional={true}>\n      {finalData === null ? (\n        <Layout\n          data={[]}\n          readonly={true}\n          {...props}\n          onChange={handleOnChange}\n        />\n      ) : (\n        <Layout data={finalData} {...props} onChange={handleOnChange} />\n      )}\n    </Locale>\n  );\n}\n\nexport default Tasklist;\n"],"names":["Task","props","task","edit","readonly","onUpdate","onRemove","_","useContext","context","textareaRef","useRef","contentRef","adjustHeight","useCallback","textarea","handleContent","handleStatus","value","saveTask","next","handleKeydown","e","useEffect","clickOutside","jsxs","jsx","Checkbox","Layout","onChange","data","setData","useWritableProp","setEdit","useState","editTask","setEditTask","i18n","useMemo","openEditor","add","content","tempID","res","updateAfter","id","prev","index","d","copy","remove","update","status","handlers","listRef","delegateClick","Button","Tasklist","allProps","onData","finalData","setFinalData","x","handleOnChange","Locale","en"],"mappings":"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"}
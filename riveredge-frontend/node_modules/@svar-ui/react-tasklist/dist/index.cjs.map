{"version":3,"file":"index.cjs","sources":["../src/components/Task.jsx","../src/components/Layout.jsx","../src/components/Tasklist.jsx"],"sourcesContent":["import { useCallback, useContext, useEffect, useRef } from 'react';\nimport { Checkbox } from '@svar-ui/react-core';\nimport { clickOutside } from '@svar-ui/lib-dom';\nimport { context } from '@svar-ui/react-core';\nimport './Task.css';\n\nexport default function Task(props) {\n  const { task, edit, readonly, onUpdate, onRemove } = props;\n\n  const _ = useContext(context.i18n).getGroup('tasklist');\n\n  const textareaRef = useRef(null);\n  const contentRef = useRef('');\n\n  const adjustHeight = useCallback(() => {\n    const textarea = textareaRef.current;\n    if (textarea) {\n      textarea.style.height = textarea.scrollHeight + 2 + 'px';\n    }\n  }, []);\n\n  const handleContent = useCallback(() => {\n    const textarea = textareaRef.current;\n    if (textarea) {\n      contentRef.current = textarea.value;\n      adjustHeight();\n    }\n  }, [adjustHeight]);\n\n  const handleStatus = useCallback(\n    ({ value }) => {\n      onUpdate({\n        task,\n        status: value ? 1 : 0,\n        content: contentRef.current || task.content,\n      });\n    },\n    [onUpdate, task],\n  );\n\n  const saveTask = useCallback(\n    (next) => {\n      onUpdate({\n        task,\n        content: contentRef.current,\n        status: task.status,\n        next,\n      });\n    },\n    [onUpdate, task],\n  );\n\n  const handleKeydown = useCallback(\n    (e) => {\n      if (e.key === 'Escape') {\n        onUpdate({ task, status: task.status, content: '' });\n      } else if (e.key === 'Enter' && !e.shiftKey) {\n        e.preventDefault();\n        saveTask(true);\n      }\n    },\n    [onUpdate, task, saveTask],\n  );\n\n  useEffect(() => {\n    const textarea = textareaRef.current;\n    if (textarea) {\n      contentRef.current = textarea.value = task.content;\n      textarea.focus();\n      adjustHeight();\n    }\n  }, [task, edit, adjustHeight]);\n\n  useEffect(() => {\n    const textarea = textareaRef.current;\n    if (!textarea) return;\n    return clickOutside(textarea, saveTask).destroy;\n  }, [edit, saveTask]);\n\n  return (\n    <div className={`wx-OQDwWK17 wx-task${task.status ? ' wx-done' : ''}`}>\n      <div className=\"wx-OQDwWK17 wx-checkbox-wrapper\">\n        {edit === task.id && task.id === -1 ? (\n          <div className=\"wx-OQDwWK17 wx-icon-add\">\n            <i className=\"wx-OQDwWK17 wxi-plus\"></i>\n          </div>\n        ) : (\n          <Checkbox onChange={handleStatus} value={task.status} />\n        )}\n      </div>\n\n      <div className=\"wx-OQDwWK17 wx-wrapper\">\n        {edit === task.id ? (\n          <textarea\n            ref={textareaRef}\n            className=\"wx-OQDwWK17 wx-texarea\"\n            placeholder={_('Enter the task...')}\n            onKeyDown={handleKeydown}\n            onInput={handleContent}\n          />\n        ) : (\n          <div className=\"wx-OQDwWK17 wx-text-wrapper\" data-id={task.id}>\n            <span className=\"wx-OQDwWK17 wx-text\">{task.content}</span>\n          </div>\n        )}\n      </div>\n\n      <div className=\"wx-OQDwWK17 wx-icon-close\">\n        {!readonly && edit !== task.id ? (\n          <i\n            className=\"wx-OQDwWK17 wxi-close\"\n            onClick={() => onRemove(task.id)}\n          ></i>\n        ) : null}\n      </div>\n    </div>\n  );\n}\n","import { useState, useMemo, useContext, useEffect, useRef } from 'react';\nimport { Button } from '@svar-ui/react-core';\nimport { delegateClick } from '@svar-ui/lib-dom';\nimport { tempID } from '@svar-ui/lib-state';\nimport { context } from '@svar-ui/react-core';\nimport { useWritableProp } from '@svar-ui/lib-react';\nimport Task from './Task.jsx';\nimport './Layout.css';\n\nexport default function Layout(props) {\n  const { readonly = false, onChange } = props;\n\n  const [data, setData] = useWritableProp(props.data || []);\n\n  const [edit, setEdit] = useState(null);\n  const [editTask, setEditTask] = useState(null);\n\n  const i18n = useContext(context.i18n);\n  const _ = useMemo(() => i18n.getGroup('tasklist'), [i18n]);\n\n  function openEditor() {\n    setEdit(-1);\n    setEditTask({ id: -1, content: '', status: 0 });\n  }\n\n  function add(content) {\n    const task = {\n      id: tempID(),\n      content,\n      status: 0,\n    };\n\n    const next = [...data, task];\n    setData(next);\n    if (onChange) {\n      const res = onChange({ value: next, task, action: 'add' });\n      if (res && typeof res === 'object') {\n        if (res.then) {\n          res.then((data) => {\n            updateAfter(task.id, data);\n          });\n        } else {\n          updateAfter(task.id, res);\n        }\n      }\n    }\n  }\n\n  function updateAfter(id, data) {\n    setData((prev) => {\n      const index = prev.findIndex((d) => d.id === id);\n      if (index === -1) return prev;\n      const copy = [...prev];\n      copy[index] = { ...prev[index], ...data };\n      return copy;\n    });\n  }\n\n  function remove(id) {\n    if (edit === id) setEdit(null);\n\n    const next = data.filter((d) => d.id !== id);\n    setData(next);\n    if (id !== -1) {\n      onChange && onChange({ value: next, id, action: 'delete' });\n    }\n  }\n\n  function update(id, content, status) {\n    let task;\n    const next = data.map((d) => {\n      if (d.id === id) {\n        task = { ...d, content, status };\n        return task;\n      } else return d;\n    });\n    setData(next);\n    setEdit(null);\n\n    onChange && onChange({ value: next, id, action: 'update', task });\n  }\n\n  function onRemove(id) {\n    remove(id);\n  }\n\n  function onUpdate({ task, content, status, next }) {\n    if (task.id === -1) {\n      setEdit(null);\n      if (content) {\n        add(content);\n        if (next) {\n          openEditor();\n        }\n      } else {\n        remove(task.id);\n      }\n    } else {\n      if (content) {\n        if (content !== task.content || status !== task.status) update(task.id, content, status);\n      } else {\n        remove(task.id);\n      }\n      setEdit(null);\n    }\n  }\n\n  const handlers = useRef({});\n  handlers.current.dblclick = (id) => {\n    if (!props.readonly) setEdit(id);\n  };\n\n  const listRef = useRef(null);\n  useEffect(() => {\n    delegateClick(listRef.current, {\n      dblclick: (id) => handlers.current.dblclick(id),\n    });\n  }, []);\n\n  return (\n    <context.fieldId.Provider value={null}>\n      <div className=\"wx-kro6Nsfl wx-tasks-list\">\n        <div className=\"wx-kro6Nsfl wx-list\" ref={listRef}>\n          {data.map((task) => (\n            <Task\n              key={task.id}\n              task={task}\n              edit={edit}\n              onUpdate={onUpdate}\n              onRemove={onRemove}\n              readonly={readonly}\n            />\n          ))}\n          {edit === -1 ? (\n            <Task\n              key={edit}\n              task={editTask}\n              edit={edit}\n              onUpdate={onUpdate}\n              onRemove={onRemove}\n            />\n          ) : null}\n        </div>\n        {!readonly && edit !== -1 ? (\n          <div className=\"wx-kro6Nsfl wx-button\">\n            <Button onClick={openEditor}>{_('Add task')}</Button>\n          </div>\n        ) : null}\n      </div>\n    </context.fieldId.Provider>\n  );\n}\n","import { useEffect, useState, useCallback } from 'react';\nimport Layout from './Layout.jsx';\nimport { Locale } from '@svar-ui/react-core';\nimport { en } from '@svar-ui/tasklist-locales';\n\nfunction Tasklist(allProps) {\n  const { onData, onChange, value, ...props } = allProps;\n  let [finalData, setFinalData] = useState(null);\n\n  useEffect(() => {\n    if (onData && value) {\n      Promise.resolve(onData(value)).then((x) => setFinalData(x));\n    } else if (value && value.then) {\n      value.then((x) => setFinalData(x));\n    } else {\n      setFinalData(value || []);\n    }\n  }, [onData, value]);\n\n  const handleOnChange = useCallback(\n    (e) => {\n      e.originalValue = value;\n      return onChange && onChange(e);\n    },\n    [onChange, value],\n  );\n\n  return (\n    <Locale words={en} optional={true}>\n      {finalData === null ? (\n        <Layout\n          data={[]}\n          readonly={true}\n          {...props}\n          onChange={handleOnChange}\n        />\n      ) : (\n        <Layout data={finalData} {...props} onChange={handleOnChange} />\n      )}\n    </Locale>\n  );\n}\n\nexport default Tasklist;\n"],"names":["Task","props","task","edit","readonly","onUpdate","onRemove","_","useContext","context","textareaRef","useRef","contentRef","adjustHeight","useCallback","textarea","handleContent","handleStatus","value","saveTask","next","handleKeydown","e","useEffect","clickOutside","jsxs","jsx","Checkbox","Layout","onChange","data","setData","useWritableProp","setEdit","useState","editTask","setEditTask","i18n","useMemo","openEditor","add","content","tempID","res","updateAfter","id","prev","index","d","copy","remove","update","status","handlers","listRef","delegateClick","Button","Tasklist","allProps","onData","finalData","setFinalData","x","handleOnChange","Locale","en"],"mappings":"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"}
{"version":3,"file":"index.cjs","sources":["../src/helpers/colors.js","../src/components/messages/UserIcon.jsx","../src/components/TextArea.jsx","../src/context.js","../src/components/messages/Bubbles.jsx","../src/components/messages/Flow.jsx","../src/libs/lima.es.js","../src/components/messages/MarkdownPlain.jsx","../src/components/messages/TextPlain.jsx","../src/components/messages/index.js","../src/components/messages/Common.jsx","../src/components/Messages.jsx","../src/components/Layout.jsx","../src/components/Comments.jsx","../src/themes/Willow.jsx","../src/themes/WillowDark.jsx"],"sourcesContent":["export function getContrastingColor(color) {\n  if (color.startsWith('hsl')) {\n    const n = toHSLArray(color);\n    return n[2] > 55 ? 'dark' : 'light';\n  }\n\n  if (color.startsWith('#') || color.startsWith('rgb')) {\n    const rgb = hexToRgb(color, true);\n    const brightness = Math.round(\n      (rgb[0] * 299 + rgb[1] * 587 + rgb[2] * 114) / 1000,\n    );\n    return brightness > 180 ? 'dark' : 'light';\n  }\n\n  // consider it's an html color, most of them are vivid, so\n  return 'light';\n}\n\nexport function toHSLArray(hslStr) {\n  return hslStr.match(/\\d+/g).map(Number);\n}\n\nexport function hexToRgb(hex, asObject = false) {\n  if (hex.startsWith('rgb')) {\n    return asObject ? rgbStringToObj(hex) : hex;\n  }\n  let r = 0,\n    g = 0,\n    b = 0;\n\n  // 3 digits\n  if (hex.length == 4) {\n    r = '0x' + hex[1] + hex[1];\n    g = '0x' + hex[2] + hex[2];\n    b = '0x' + hex[3] + hex[3];\n\n    // 6 digits\n  } else if (hex.length == 7) {\n    r = '0x' + hex[1] + hex[2];\n    g = '0x' + hex[3] + hex[4];\n    b = '0x' + hex[5] + hex[6];\n  }\n  r = +r;\n  g = +g;\n  b = +b;\n  return asObject ? { r, g, b } : 'rgb(' + r + ',' + g + ',' + b + ')';\n}\n\nexport function rgbStringToObj(rgb) {\n  const sep = rgb.indexOf(',') > -1 ? ',' : ' ';\n  // Turn \"rgb(r,g,b)\" into [r,g,b]\n  const arr = rgb.substring(4).split(')')[0].split(sep);\n\n  const r = (+arr[0]).toString(16),\n    g = (+arr[1]).toString(16),\n    b = (+arr[2]).toString(16);\n  return { r: +r, g: +g, b: +b };\n}\n","import { useMemo } from 'react';\nimport { getContrastingColor } from '../../helpers/colors';\nimport './UserIcon.css';\n\nfunction UserIcon({\n  data = {\n    name: '',\n    avatar: '',\n    color: '',\n  },\n  noTransform = false,\n  size = 'small',\n  border = true,\n}) {\n  const firstLetters = useMemo(\n    () =>\n      data.name\n        .split(' ')\n        .map((name) => name[0])\n        .join(''),\n    [data.name],\n  );\n\n  const style = useMemo(\n    () => (data.color ? { background: data.color } : undefined),\n    [data.color],\n  );\n\n  const css = useMemo(\n    () =>\n      data.color\n        ? `wx-comments-avatar-color-${getContrastingColor(data.color)}`\n        : '',\n    [data.color],\n  );\n\n  return (\n    <div\n      className={`wx-cyzBpibr wx-user wx-${size} ${css} ${border ? 'wx-border' : ''}`}\n      style={style}\n    >\n      {data.avatar ? (\n        <img src={data.avatar} alt={data.name} />\n      ) : noTransform ? (\n        data.name\n      ) : (\n        firstLetters\n      )}\n    </div>\n  );\n}\n\nexport default UserIcon;\n","import { useEffect, useRef, useContext, useMemo, useCallback } from 'react';\nimport { TextArea as CoreTextArea, Button } from '@svar-ui/react-core';\nimport UserIcon from './messages/UserIcon.jsx';\nimport { context } from '@svar-ui/react-core';\nimport { useWritableProp } from '@svar-ui/lib-react';\nimport './TextArea.css';\n\nfunction TextArea(props) {\n  const {\n    focus = false,\n    buttonLabel = 'Send',\n    flow = false,\n    value: valueProp,\n    author,\n    onPost,\n  } = props;\n\n  const [value, setValue] = useWritableProp(valueProp || '');\n\n  const textareaRef = useRef(null);\n  const areaRef = useRef(null);\n  const onClickRef = useRef(null);\n\n  const i18n = useContext(context.i18n);\n  const _ = useMemo(() => i18n.getGroup('comments'), [i18n]);\n\n  onClickRef.current = useCallback(\n    (value) => {\n      if (!value) return;\n      onPost && onPost({ value });\n      setValue('');\n      if (areaRef.current) areaRef.current.focus();\n    },\n    [onPost, value],\n  );\n\n  useEffect(() => {\n    if (!textareaRef.current) return;\n    areaRef.current = textareaRef.current.querySelector('textarea');\n    if (focus && areaRef.current) areaRef.current.focus();\n\n    areaRef.current.onkeydown = (ev) => {\n      if (ev.key === 'Enter' && (ev.ctrlKey || ev.metaKey)) {\n        ev.preventDefault();\n        onClickRef.current(value);\n      }\n    };\n  }, []); // onMount equivalent\n\n  return (\n    <div\n      className={`wx-v2rD0VHO wx-comments-textarea${flow ? ' wx-flow' : ''}`}\n      data-focus=\"yes\"\n      ref={textareaRef}\n    >\n      <div className=\"wx-v2rD0VHO wx-textarea-wrapper\">\n        {author ? (\n          <div className=\"wx-v2rD0VHO wx-textarea-avatar\">\n            <UserIcon data={author} />\n          </div>\n        ) : null}\n        <CoreTextArea\n          placeholder={_('Add a comment...')}\n          value={value}\n          onChange={({ value }) => setValue(value)}\n        />\n      </div>\n      <div className=\"wx-v2rD0VHO wx-textarea-bottombar\">\n        <Button type=\"primary\" onClick={() => onClickRef.current(value)}>\n          {_(buttonLabel)}\n        </Button>\n      </div>\n    </div>\n  );\n}\n\nexport default TextArea;\n","import { createContext } from 'react';\n\nexport const formatContext = createContext({\n  dateStr: (v) => v.toString(),\n});\n","import { useContext } from 'react';\nimport { formatContext } from '../../context.js';\nimport UserIcon from './UserIcon.jsx';\nimport './Bubbles.css';\n\nfunction Bubbles({ owned, author, date, edit, children }) {\n  const wxCommentsFormat = useContext(formatContext);\n  const dateFormatter = wxCommentsFormat.dateStr;\n\n  return (\n    <div className={`wx-aluyyvxH wx-bubble ${owned ? 'wx-owned' : ''}`}>\n      <div className=\"wx-aluyyvxH wx-bubble-wrapper\">\n        <div className=\"wx-aluyyvxH wx-avatar\">\n          <UserIcon data={author} />\n        </div>\n        <div className=\"wx-aluyyvxH wx-main-bubble\">\n          <span className=\"wx-aluyyvxH wx-author-name\">{author.name}</span>\n          {owned ? (\n            <div className=\"wx-aluyyvxH wx-agent-message\">\n              <div className=\"wx-aluyyvxH wx-message\">\n                {children}\n                {edit !== owned ? (\n                  <div className=\"wx-aluyyvxH wx-comment-date\">\n                    {dateFormatter(date)}\n                  </div>\n                ) : null}\n              </div>\n              <div\n                className=\"wx-aluyyvxH wx-menu-icon\"\n                data-comment-menu-id={owned}\n              >\n                <i className=\"wx-aluyyvxH wx-icon wxi-dots-v\"></i>\n              </div>\n            </div>\n          ) : (\n            <div className=\"wx-aluyyvxH wx-message\">\n              {children}\n              <div className=\"wx-aluyyvxH wx-comment-date\">\n                {dateFormatter(date)}\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default Bubbles;\n","import { useContext } from 'react';\nimport { formatContext } from '../../context.js';\nimport UserIcon from './UserIcon.jsx';\nimport './Flow.css';\n\nexport default function Flow(props) {\n  const { owned, author, date, edit, children } = props;\n\n  const dateFormatter = useContext(formatContext).dateStr;\n\n  return (\n    <div className={`wx-N2LqQbZL wx-flow${owned ? ' wx-owned' : ''}`}>\n      <div className=\"wx-N2LqQbZL wx-flow-toolbar\">\n        <UserIcon data={author} />\n        <span className=\"wx-N2LqQbZL wx-author-name\">{author.name}</span>\n        {owned && owned !== edit && (\n          <div\n            className=\"wx-N2LqQbZL wx-menu-icon\"\n            data-comment-menu-id={owned}\n          >\n            <i className=\"wx-N2LqQbZL wx-icon wxi-dots-v\"></i>\n          </div>\n        )}\n      </div>\n      <div className=\"wx-N2LqQbZL wx-comment-date\">{dateFormatter(date)}</div>\n      <div className=\"wx-N2LqQbZL wx-message\">{children}</div>\n    </div>\n  );\n}\n","function parse(str, ast, notFinal) {\n  let content;\n  let ctype;\n  let headerlevel, newLineCounter;\n  let checkbehind, unsurepoint;\n  let linestart;\n  let i;\n  if (!ast) {\n    ast = {\n      nodes: [{ d: [], t: 'p', f: false, i: 0 }],\n      length: 0,\n      state: {},\n    };\n    linestart = 0;\n    headerlevel = 0;\n    checkbehind = -1;\n    unsurepoint = -1;\n    content = '';\n    ctype = '';\n    newLineCounter = 0;\n    i = 0;\n  } else {\n    ({\n      linestart,\n      headerlevel,\n      checkbehind,\n      unsurepoint,\n      content,\n      ctype,\n      newLineCounter,\n      i,\n    } = ast.state);\n  }\n  if (unsurepoint) {\n    const b = ast.nodes[ast.nodes.length - 1];\n    if (b.d.length) {\n      ast.length -= b.d[b.d.length - 1].c.length;\n      b.d.pop();\n    }\n  }\n  const finishBlock = (notFinal2) => {\n    if (content !== '') {\n      finishText('', notFinal2);\n    }\n    const lastBlock = ast.nodes[ast.nodes.length - 1];\n    lastBlock.f = notFinal2 !== 1;\n    lastBlock.i = i;\n    if (headerlevel > 0) {\n      lastBlock.t = `h${headerlevel}`;\n      headerlevel = -1;\n    }\n    if (notFinal2 === 0) ast.nodes.push({ d: [], t: 'p', f: false, i: 0 });\n  };\n  const finishText = (t, notFinal2 = 2) => {\n    const block = ast.nodes[ast.nodes.length - 1];\n    const last = block.d[block.d.length - 1];\n    const utype = notFinal2 === 2 ? ctype : '';\n    if (last && last.t === utype && unsurepoint < 0) {\n      const text = last;\n      ast.length += content.length;\n      text.c = text.c + content;\n      text.i = i;\n    } else {\n      const c =\n        utype === '' && unsurepoint >= 0 ? str.substring(unsurepoint) : content;\n      ast.length += c.length;\n      block.d.push({ c, t: utype, f: notFinal2 !== 1, i });\n    }\n    if (notFinal2 === 2) {\n      if (t) {\n        unsurepoint = checkbehind;\n      } else {\n        unsurepoint = -1;\n      }\n    }\n    if (notFinal2 !== 1) {\n      content = '';\n      ctype = t;\n      checkbehind = -1;\n    }\n  };\n  for (; i < str.length; i++) {\n    const char = str[i];\n    if (char === '\\n') {\n      newLineCounter++;\n      linestart = i + 1;\n      continue;\n    }\n    if (char === ' ' || char === '\t') {\n      if (newLineCounter > 0) {\n        continue;\n      }\n    }\n    if (newLineCounter > 0) {\n      if (newLineCounter > 1) {\n        finishBlock(0);\n      } else {\n        content += '\\n';\n      }\n      newLineCounter = 0;\n    }\n    if (char == '*' || char == '`' || char == '#') {\n      if (str[i - 1] == '\\\\') {\n        content += char;\n      } else if (checkbehind === -1) {\n        checkbehind = i;\n      }\n    } else {\n      if (checkbehind >= 0) {\n        const l = i - checkbehind;\n        if (str[i - 1] == '*') {\n          if (l === 2) {\n            if (ctype === 'strong') {\n              finishText('');\n            } else {\n              finishText('strong');\n            }\n          } else if (l === 1) {\n            if (ctype === 'em') {\n              finishText('');\n            } else {\n              finishText('em');\n            }\n          }\n          checkbehind = -1;\n        } else if (str[i - 1] == '`' && l == 1) {\n          if (ctype === 'code') {\n            finishText('');\n          } else {\n            finishText('code');\n          }\n          checkbehind = -1;\n        } else if (\n          str[i - 1] == '#' &&\n          str[i] === ' ' &&\n          checkbehind === linestart &&\n          i - checkbehind <= 6\n        ) {\n          headerlevel = i - checkbehind;\n          checkbehind = -1;\n          continue;\n        }\n      }\n      if (checkbehind !== -1) {\n        content += str.substring(checkbehind, i);\n        checkbehind = -1;\n      }\n      content += char;\n    }\n  }\n  finishBlock(notFinal ? 1 : -1);\n  if (notFinal) {\n    ast.state = {\n      linestart,\n      headerlevel,\n      checkbehind,\n      unsurepoint,\n      content,\n      ctype,\n      newLineCounter,\n      i,\n    };\n  } else {\n    ast.state = {};\n  }\n  return ast;\n}\nfunction render(target, ast) {\n  _renderNodes(target, ast.nodes);\n}\nfunction _renderNodes(target, nodes) {\n  if (!target) return;\n  for (const node of nodes) {\n    if (typeof node.d !== 'undefined') {\n      const block = node;\n      const el = document.createElement(block.t);\n      target.appendChild(el);\n      _renderNodes(el, block.d);\n    } else {\n      const text = node;\n      if (text.t) {\n        const el = document.createElement(node.t);\n        el.textContent = text.c;\n        target.appendChild(el);\n      } else {\n        const el = document.createTextNode(text.c);\n        target.appendChild(el);\n      }\n    }\n  }\n}\nfunction renderNext(target, ast, prevState, distance, cursor) {\n  if (!target) return;\n  return (\n    _renderNodesNext(target, ast.nodes, prevState, distance, 0, cursor) === 0\n  );\n}\nfunction _renderNodesNext(target, nodes, prevState, distance, level, cursor) {\n  let start = 0,\n    textIndex = 0,\n    el = null,\n    temp = null;\n  const prev = prevState[level];\n  if (prev) {\n    start = prev.nodeIndex;\n    textIndex = prev.textIndex;\n    el = prev.target;\n    temp = prev.temp;\n  }\n  for (let i = start; i < nodes.length; i++) {\n    const node = nodes[i];\n    if (typeof node.d !== 'undefined') {\n      const block = nodes[i];\n      if (!el) {\n        el = document.createElement(block.t);\n        target.appendChild(el);\n      }\n      distance = _renderNodesNext(\n        el,\n        block.d,\n        prevState,\n        distance,\n        level + 1,\n        cursor,\n      );\n      if (!distance) {\n        prevState[level] = { nodeIndex: i, textIndex: 0, target: el };\n        return 0;\n      }\n      el = null;\n    } else {\n      let textContent;\n      const text = node;\n      if (text.c.length - textIndex > distance) {\n        textContent = text.c.substring(textIndex, textIndex + distance);\n        textIndex += distance;\n        distance = 0;\n      } else {\n        textContent = text.c.substring(textIndex);\n        distance -= text.c.length - textIndex;\n        textIndex = 0;\n      }\n      if (text.t) {\n        if (!el) {\n          el = document.createElement(text.t);\n          target.insertBefore(el, temp);\n          el.textContent = textContent;\n        } else {\n          el.textContent += textContent;\n        }\n      } else {\n        if (!el) {\n          const el2 = document.createTextNode(textContent);\n          target.insertBefore(el2, temp);\n        } else {\n          el.textContent += textContent;\n        }\n      }\n      if (distance === 0) {\n        if (!temp) temp = addCursor(target, cursor);\n        prevState[level] = textIndex\n          ? { temp, nodeIndex: i, textIndex, target: el }\n          : { temp, nodeIndex: i + 1, textIndex: 0, target: null };\n        return distance;\n      }\n      el = null;\n    }\n  }\n  prevState[level] = null;\n  if (temp) temp.parentNode.removeChild(temp);\n  return distance;\n}\nfunction addCursor(parent, name) {\n  const el = document.createElement('div');\n  el.className = name;\n  el.textContent = 'â€‚';\n  parent.appendChild(el);\n  return el;\n}\nfunction asHTML(a) {\n  let out = '';\n  for (const node of a) {\n    if (typeof node.d !== 'undefined') {\n      out += '<' + node.t + '>';\n      out += asHTML(node.d);\n      out += '</' + node.t + '>';\n    } else {\n      if (node.t) out += '<' + node.t + '>';\n      out += node.c;\n      if (node.t) out += '</' + node.t + '>';\n    }\n  }\n  return out;\n}\nfunction asMarkdown(a) {\n  let out = '';\n  let space = '';\n  for (const node of a) {\n    if (typeof node.d !== 'undefined') {\n      if (node.t === 'h1') {\n        out += space + '# ';\n      } else if (node.t === 'h2') {\n        out += space + '## ';\n      } else if (node.t === 'h3') {\n        out += space + '### ';\n      } else if (node.t === 'h4') {\n        out += space + '#### ';\n      } else if (node.t === 'h5') {\n        out += space + '##### ';\n      } else if (node.t === 'h6') {\n        out += space + '###### ';\n      } else {\n        out += space;\n      }\n      space = '\\n\\n';\n      out += asMarkdown(node.d);\n    } else {\n      let wrap = '';\n      if (node.t === 'strong') {\n        wrap = '**';\n      } else if (node.t === 'em') {\n        wrap = '*';\n      } else if (node.t === 'code') {\n        wrap = '`';\n      }\n      out += wrap + node.c + wrap;\n    }\n  }\n  return out;\n}\nfunction html(s) {\n  return asHTML(parse(s).nodes);\n}\nexport { asHTML, asMarkdown, html, parse, render, renderNext };\n","import { html } from '../../libs/lima.es.js';\n\nexport default function MarkdownPlain({ content }) {\n  return <div dangerouslySetInnerHTML={{ __html: html(content) }} />;\n}\n","function TextPlain({ content }) {\n  return <>{content}</>;\n}\n\nexport default TextPlain;\n","import Bubbles from './Bubbles.jsx';\nimport Flow from './Flow.jsx';\n\nimport MarkdownPlain from './MarkdownPlain.jsx';\nimport TextPlain from './TextPlain.jsx';\n\nexport const messages = {\n  bubbles: Bubbles,\n  flow: Flow,\n};\nexport const formats = {\n  markdown: MarkdownPlain,\n  text: TextPlain,\n};\n","import { useMemo } from 'react';\nimport TextArea from '../TextArea.jsx';\nimport { messages, formats } from './index.js';\n\nexport default function Common({\n  content,\n  date,\n  owned,\n  render,\n  format = 'text',\n  author,\n  edit,\n  onPost: onPost,\n  onCancel: onCancel,\n}) {\n  const BoxRender = useMemo(\n    () => (typeof render === 'string' ? messages[render] : render),\n    [render],\n  );\n\n  const TextRender = useMemo(\n    () => (typeof format === 'string' ? formats[format] : format),\n    [format],\n  );\n\n  return (\n    <BoxRender owned={owned} edit={edit} author={author} date={date}>\n      {edit && edit === owned ? (\n        <TextArea\n          focus={true}\n          onPost={onPost}\n          onCancel={onCancel}\n          value={content}\n        />\n      ) : (\n        <TextRender content={content} />\n      )}\n    </BoxRender>\n  );\n}\n","import { useMemo } from 'react';\nimport Message from './messages/Common.jsx';\nimport './Messages.css';\n\nfunction Messages({\n  data,\n  render = 'blocks',\n  format,\n  author,\n  edit,\n  onPost,\n  onCancel,\n}) {\n  const css = useMemo(\n    () => (typeof render === 'string' ? render : 'blocks'),\n    [render],\n  );\n\n  return (\n    <div className={`wx-6HAxmtjJ wx-messages wx-${css}`}>\n      {data.map((message) => (\n        <Message\n          key={message.id}\n          content={message.content}\n          date={message.date}\n          author={message.author}\n          owned={message.author.id === author.id ? message.id : null}\n          render={render}\n          edit={edit}\n          format={message.format || format}\n          onPost={onPost}\n          onCancel={onCancel}\n        />\n      ))}\n    </div>\n  );\n}\n\nexport default Messages;\n","import {\n  useState,\n  useEffect,\n  useMemo,\n  useCallback,\n  useRef,\n  useContext,\n} from 'react';\nimport Messages from './Messages.jsx';\nimport TextArea from './TextArea.jsx';\nimport { ActionMenu } from '@svar-ui/react-menu';\nimport { uid } from '@svar-ui/lib-state';\nimport { dateToString } from '@svar-ui/lib-dom';\nimport { context } from '@svar-ui/react-core';\nimport { useWritableProp } from '@svar-ui/lib-react';\nimport { formatContext as FormatContext } from '../context.js';\nimport './Layout.css';\n\nexport default function Layout(props) {\n  let {\n    onAction,\n    onChange,\n    readonly = false,\n    render = 'flow',\n    format = 'text',\n    users: rawUsers,\n    data: dataProp,\n    activeUser,\n    focus = false,\n  } = props;\n\n  const lang = useContext(context.i18n);\n  const { calendar, comments, formats } = lang.getRaw();\n  const _ = lang.getGroup('comments');\n\n  const dateFormatter = useMemo(\n    () => dateToString(comments.dateFormat || formats.dateFormat, calendar),\n    [calendar, comments, formats],\n  );\n\n  const [edit, setEdit] = useState(null);\n  const [value, setValue] = useState('');\n  const [rawData, setRawData] = useWritableProp(dataProp);\n\n  useEffect(() => {\n    setValue('');\n    setEdit(null);\n  }, [rawData]);\n\n  const unknownUser = { id: 0, name: _('Unknown'), color: 'hsl(0, 0%, 85%)' };\n\n  const users = useMemo(() => {\n    if (!rawUsers) return [];\n    return rawUsers.map((u) => {\n      if (!u.color)\n        return {\n          ...u,\n          color: 'hsl(' + getColor(u.id + u.name) + ', 100%, 85%)',\n        };\n      return u;\n    });\n  }, [rawUsers]);\n\n  const author = useMemo(() => {\n    if (typeof activeUser === 'object') return activeUser;\n    const a = users.find((u) => u.id === activeUser) || unknownUser;\n    if (a) return a;\n    return {\n      id: activeUser || -1,\n      name: _('Me'),\n      color: 'hsl(225, 76%, 67%)',\n    };\n  }, [activeUser, users, _]);\n\n  const data = useMemo(() => {\n    if (!rawData) return [];\n    return rawData.map((d) => {\n      if (typeof d.author === 'object') return d;\n      const user = users ? users.find((u) => u.id === d.user) : null;\n      return {\n        ...d,\n        author: user || unknownUser,\n      };\n    });\n  }, [rawData, users]);\n\n  function getColor(name) {\n    let hash = 0;\n    for (let i = 0; i < name.length; i++) {\n      hash = name.charCodeAt(i) + ((hash << 5) - hash);\n    }\n    return (hash % 60) * 6;\n  }\n\n  function add(content) {\n    const comment = {\n      id: uid(),\n      content,\n      author,\n      user: author.id,\n      date: new Date(),\n    };\n\n    const nextValue = [...data, comment];\n    setRawData(nextValue);\n    if (onChange) {\n      const res = onChange({ value: nextValue, comment, action: 'add' });\n      if (res && typeof res === 'object') {\n        if (res.then) {\n          res.then((data) => {\n            updateAfter(comment.id, data);\n          });\n        } else {\n          updateAfter(comment.id, res);\n        }\n      }\n    }\n  }\n\n  function updateAfter(id, data) {\n    const index = rawData ? rawData.findIndex((d) => d.id === id) : -1;\n    if (index === -1) return;\n    const copy = [...rawData];\n    copy[index] = { ...rawData[index], ...data };\n    setRawData(copy);\n  }\n\n  function remove(id) {\n    const nextValue = (rawData || []).filter((d) => d.id !== id);\n    setRawData(nextValue);\n    onChange && onChange({ value: nextValue, id, action: 'delete' });\n  }\n\n  function update(id, content) {\n    let comment;\n    const nextValue = (rawData || []).map((d) => {\n      if (d.id === id) {\n        comment = { ...d, content };\n        return comment;\n      } else return d;\n    });\n    setRawData(nextValue);\n    onChange && onChange({ value: nextValue, id, action: 'update', comment });\n  }\n\n  function cancelUpdate() {\n    setEdit(null);\n  }\n\n  function handleActionMenu(ev) {\n    const { context, action } = ev;\n\n    if (!action) return;\n\n    onAction && onAction({ action: 'menu-clicked' });\n\n    switch (action.id) {\n      case 'edit-comment':\n        setEdit(context);\n        break;\n      case 'delete-comment':\n        remove(context);\n        break;\n      default:\n        break;\n    }\n  }\n\n  const menuItems = [\n    {\n      id: 'edit-comment',\n      text: _('Edit'),\n      icon: 'wxi-edit-outline',\n    },\n    {\n      id: 'delete-comment',\n      text: _('Delete'),\n      icon: 'wxi-delete-outline',\n    },\n  ];\n\n  const menu = useRef(null);\n  const showMenu = useCallback(\n    (ev) => {\n      if (menu.current && typeof menu.current.show === 'function') {\n        menu.current.show(ev);\n      }\n    },\n    [menu],\n  );\n\n  return (\n    <context.fieldId.Provider value={null}>\n      <FormatContext.Provider\n        value={{\n          dateStr: (date) => dateFormatter(date),\n        }}\n      >\n        <div className=\"wx-8ZGHQX6e wx-comments-list\">\n          <ActionMenu\n            at={'bottom'}\n            ref={menu}\n            options={menuItems}\n            resolver={(item) => item}\n            dataKey=\"commentMenuId\"\n            onClick={handleActionMenu}\n          />\n          <div className=\"wx-8ZGHQX6e wx-list\" onClick={showMenu}>\n            <Messages\n              author={author}\n              render={render}\n              data={data}\n              format={format}\n              edit={edit}\n              onPost={(ev) => update(edit, ev.value)}\n              onCancel={cancelUpdate}\n            />\n          </div>\n          {!readonly && !edit && (\n            <TextArea\n              author={author}\n              flow={render === 'flow'}\n              focus={focus}\n              onPost={(ev) => add(ev.value)}\n              buttonLabel={'Add'}\n              value={value}\n              onChange={({ value }) => setValue(value)}\n            />\n          )}\n        </div>\n      </FormatContext.Provider>\n    </context.fieldId.Provider>\n  );\n}\n","import { useState, useEffect, useCallback } from 'react';\nimport Layout from './Layout.jsx';\nimport { Locale } from '@svar-ui/react-core';\nimport { en } from '@svar-ui/comments-locales';\nimport { en as coreEn } from '@svar-ui/core-locales';\n\nfunction Comments(allProps) {\n  const { onData, onChange, value, ...props } = allProps;\n  let [finalData, setFinalData] = useState([]);\n\n  useEffect(() => {\n    if (onData && value) {\n      Promise.resolve(onData(value)).then((x) => setFinalData(x));\n    } else {\n      setFinalData(value || []);\n    }\n  }, [onData, value]);\n\n  const handleOnChange = useCallback(\n    (e) => {\n      e.originalValue = value;\n      return onChange && onChange(e);\n    },\n    [onChange, value],\n  );\n\n  return (\n    <Locale words={{ ...coreEn, ...en }} optional={true}>\n      <Layout data={finalData} {...props} onChange={handleOnChange}></Layout>\n    </Locale>\n  );\n}\n\nexport default Comments;\n","import { Willow } from '@svar-ui/react-core';\nimport './Willow.css';\nconst WillowComponent = ({ children, fonts }) => {\n  return children ? (\n    <Willow fonts={fonts}>{children}</Willow>\n  ) : (\n    <Willow fonts={fonts}></Willow>\n  );\n};\nexport default WillowComponent;\n","import { WillowDark } from '@svar-ui/react-core';\nimport './WillowDark.css';\nconst WillowDarkComponent = ({ children, fonts }) => {\n  return children ? (\n    <WillowDark fonts={fonts}>{children}</WillowDark>\n  ) : (\n    <WillowDark fonts={fonts}></WillowDark>\n  );\n};\nexport default WillowDarkComponent;\n"],"names":["getContrastingColor","color","toHSLArray","rgb","hexToRgb","hslStr","hex","asObject","rgbStringToObj","r","g","b","sep","arr","UserIcon","data","noTransform","size","border","firstLetters","useMemo","name","style","css","jsx","TextArea","props","focus","buttonLabel","flow","valueProp","author","onPost","value","setValue","useWritableProp","textareaRef","useRef","areaRef","onClickRef","i18n","useContext","context","_","useCallback","useEffect","ev","jsxs","CoreTextArea","Button","formatContext","createContext","v","Bubbles","owned","date","edit","children","dateFormatter","Flow","parse","str","ast","notFinal","content","ctype","headerlevel","newLineCounter","checkbehind","unsurepoint","linestart","i","finishBlock","notFinal2","finishText","lastBlock","t","block","last","utype","text","c","char","l","asHTML","a","out","node","html","s","MarkdownPlain","TextPlain","messages","formats","Common","render","format","onCancel","BoxRender","TextRender","Messages","message","Message","Layout","onAction","onChange","readonly","rawUsers","dataProp","activeUser","lang","calendar","comments","dateToString","setEdit","useState","rawData","setRawData","unknownUser","users","u","getColor","d","user","hash","add","comment","uid","nextValue","res","updateAfter","id","index","copy","remove","update","cancelUpdate","handleActionMenu","action","menuItems","menu","showMenu","FormatContext","ActionMenu","item","Comments","allProps","onData","finalData","setFinalData","x","handleOnChange","e","Locale","coreEn","en","WillowComponent","fonts","Willow","WillowDarkComponent","WillowDark"],"mappings":"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"}
{"version":3,"file":"index.es.js","sources":["../src/helpers/colors.js","../src/components/messages/UserIcon.jsx","../src/components/TextArea.jsx","../src/context.js","../src/components/messages/Bubbles.jsx","../src/components/messages/Flow.jsx","../src/libs/lima.es.js","../src/components/messages/MarkdownPlain.jsx","../src/components/messages/TextPlain.jsx","../src/components/messages/index.js","../src/components/messages/Common.jsx","../src/components/Messages.jsx","../src/components/Layout.jsx","../src/components/Comments.jsx","../src/themes/Willow.jsx","../src/themes/WillowDark.jsx"],"sourcesContent":["export function getContrastingColor(color) {\n  if (color.startsWith('hsl')) {\n    const n = toHSLArray(color);\n    return n[2] > 55 ? 'dark' : 'light';\n  }\n\n  if (color.startsWith('#') || color.startsWith('rgb')) {\n    const rgb = hexToRgb(color, true);\n    const brightness = Math.round(\n      (rgb[0] * 299 + rgb[1] * 587 + rgb[2] * 114) / 1000,\n    );\n    return brightness > 180 ? 'dark' : 'light';\n  }\n\n  // consider it's an html color, most of them are vivid, so\n  return 'light';\n}\n\nexport function toHSLArray(hslStr) {\n  return hslStr.match(/\\d+/g).map(Number);\n}\n\nexport function hexToRgb(hex, asObject = false) {\n  if (hex.startsWith('rgb')) {\n    return asObject ? rgbStringToObj(hex) : hex;\n  }\n  let r = 0,\n    g = 0,\n    b = 0;\n\n  // 3 digits\n  if (hex.length == 4) {\n    r = '0x' + hex[1] + hex[1];\n    g = '0x' + hex[2] + hex[2];\n    b = '0x' + hex[3] + hex[3];\n\n    // 6 digits\n  } else if (hex.length == 7) {\n    r = '0x' + hex[1] + hex[2];\n    g = '0x' + hex[3] + hex[4];\n    b = '0x' + hex[5] + hex[6];\n  }\n  r = +r;\n  g = +g;\n  b = +b;\n  return asObject ? { r, g, b } : 'rgb(' + r + ',' + g + ',' + b + ')';\n}\n\nexport function rgbStringToObj(rgb) {\n  const sep = rgb.indexOf(',') > -1 ? ',' : ' ';\n  // Turn \"rgb(r,g,b)\" into [r,g,b]\n  const arr = rgb.substring(4).split(')')[0].split(sep);\n\n  const r = (+arr[0]).toString(16),\n    g = (+arr[1]).toString(16),\n    b = (+arr[2]).toString(16);\n  return { r: +r, g: +g, b: +b };\n}\n","import { useMemo } from 'react';\nimport { getContrastingColor } from '../../helpers/colors';\nimport './UserIcon.css';\n\nfunction UserIcon({\n  data = {\n    name: '',\n    avatar: '',\n    color: '',\n  },\n  noTransform = false,\n  size = 'small',\n  border = true,\n}) {\n  const firstLetters = useMemo(\n    () =>\n      data.name\n        .split(' ')\n        .map((name) => name[0])\n        .join(''),\n    [data.name],\n  );\n\n  const style = useMemo(\n    () => (data.color ? { background: data.color } : undefined),\n    [data.color],\n  );\n\n  const css = useMemo(\n    () =>\n      data.color\n        ? `wx-comments-avatar-color-${getContrastingColor(data.color)}`\n        : '',\n    [data.color],\n  );\n\n  return (\n    <div\n      className={`wx-cyzBpibr wx-user wx-${size} ${css} ${border ? 'wx-border' : ''}`}\n      style={style}\n    >\n      {data.avatar ? (\n        <img src={data.avatar} alt={data.name} />\n      ) : noTransform ? (\n        data.name\n      ) : (\n        firstLetters\n      )}\n    </div>\n  );\n}\n\nexport default UserIcon;\n","import { useEffect, useRef, useContext, useMemo, useCallback } from 'react';\nimport { TextArea as CoreTextArea, Button } from '@svar-ui/react-core';\nimport UserIcon from './messages/UserIcon.jsx';\nimport { context } from '@svar-ui/react-core';\nimport { useWritableProp } from '@svar-ui/lib-react';\nimport './TextArea.css';\n\nfunction TextArea(props) {\n  const {\n    focus = false,\n    buttonLabel = 'Send',\n    flow = false,\n    value: valueProp,\n    author,\n    onPost,\n  } = props;\n\n  const [value, setValue] = useWritableProp(valueProp || '');\n\n  const textareaRef = useRef(null);\n  const areaRef = useRef(null);\n  const onClickRef = useRef(null);\n\n  const i18n = useContext(context.i18n);\n  const _ = useMemo(() => i18n.getGroup('comments'), [i18n]);\n\n  onClickRef.current = useCallback(\n    (value) => {\n      if (!value) return;\n      onPost && onPost({ value });\n      setValue('');\n      if (areaRef.current) areaRef.current.focus();\n    },\n    [onPost, value],\n  );\n\n  useEffect(() => {\n    if (!textareaRef.current) return;\n    areaRef.current = textareaRef.current.querySelector('textarea');\n    if (focus && areaRef.current) areaRef.current.focus();\n\n    areaRef.current.onkeydown = (ev) => {\n      if (ev.key === 'Enter' && (ev.ctrlKey || ev.metaKey)) {\n        ev.preventDefault();\n        onClickRef.current(value);\n      }\n    };\n  }, []); // onMount equivalent\n\n  return (\n    <div\n      className={`wx-v2rD0VHO wx-comments-textarea${flow ? ' wx-flow' : ''}`}\n      data-focus=\"yes\"\n      ref={textareaRef}\n    >\n      <div className=\"wx-v2rD0VHO wx-textarea-wrapper\">\n        {author ? (\n          <div className=\"wx-v2rD0VHO wx-textarea-avatar\">\n            <UserIcon data={author} />\n          </div>\n        ) : null}\n        <CoreTextArea\n          placeholder={_('Add a comment...')}\n          value={value}\n          onChange={({ value }) => setValue(value)}\n        />\n      </div>\n      <div className=\"wx-v2rD0VHO wx-textarea-bottombar\">\n        <Button type=\"primary\" onClick={() => onClickRef.current(value)}>\n          {_(buttonLabel)}\n        </Button>\n      </div>\n    </div>\n  );\n}\n\nexport default TextArea;\n","import { createContext } from 'react';\n\nexport const formatContext = createContext({\n  dateStr: (v) => v.toString(),\n});\n","import { useContext } from 'react';\nimport { formatContext } from '../../context.js';\nimport UserIcon from './UserIcon.jsx';\nimport './Bubbles.css';\n\nfunction Bubbles({ owned, author, date, edit, children }) {\n  const wxCommentsFormat = useContext(formatContext);\n  const dateFormatter = wxCommentsFormat.dateStr;\n\n  return (\n    <div className={`wx-aluyyvxH wx-bubble ${owned ? 'wx-owned' : ''}`}>\n      <div className=\"wx-aluyyvxH wx-bubble-wrapper\">\n        <div className=\"wx-aluyyvxH wx-avatar\">\n          <UserIcon data={author} />\n        </div>\n        <div className=\"wx-aluyyvxH wx-main-bubble\">\n          <span className=\"wx-aluyyvxH wx-author-name\">{author.name}</span>\n          {owned ? (\n            <div className=\"wx-aluyyvxH wx-agent-message\">\n              <div className=\"wx-aluyyvxH wx-message\">\n                {children}\n                {edit !== owned ? (\n                  <div className=\"wx-aluyyvxH wx-comment-date\">\n                    {dateFormatter(date)}\n                  </div>\n                ) : null}\n              </div>\n              <div\n                className=\"wx-aluyyvxH wx-menu-icon\"\n                data-comment-menu-id={owned}\n              >\n                <i className=\"wx-aluyyvxH wx-icon wxi-dots-v\"></i>\n              </div>\n            </div>\n          ) : (\n            <div className=\"wx-aluyyvxH wx-message\">\n              {children}\n              <div className=\"wx-aluyyvxH wx-comment-date\">\n                {dateFormatter(date)}\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default Bubbles;\n","import { useContext } from 'react';\nimport { formatContext } from '../../context.js';\nimport UserIcon from './UserIcon.jsx';\nimport './Flow.css';\n\nexport default function Flow(props) {\n  const { owned, author, date, edit, children } = props;\n\n  const dateFormatter = useContext(formatContext).dateStr;\n\n  return (\n    <div className={`wx-N2LqQbZL wx-flow${owned ? ' wx-owned' : ''}`}>\n      <div className=\"wx-N2LqQbZL wx-flow-toolbar\">\n        <UserIcon data={author} />\n        <span className=\"wx-N2LqQbZL wx-author-name\">{author.name}</span>\n        {owned && owned !== edit && (\n          <div\n            className=\"wx-N2LqQbZL wx-menu-icon\"\n            data-comment-menu-id={owned}\n          >\n            <i className=\"wx-N2LqQbZL wx-icon wxi-dots-v\"></i>\n          </div>\n        )}\n      </div>\n      <div className=\"wx-N2LqQbZL wx-comment-date\">{dateFormatter(date)}</div>\n      <div className=\"wx-N2LqQbZL wx-message\">{children}</div>\n    </div>\n  );\n}\n","function parse(str, ast, notFinal) {\n  let content;\n  let ctype;\n  let headerlevel, newLineCounter;\n  let checkbehind, unsurepoint;\n  let linestart;\n  let i;\n  if (!ast) {\n    ast = {\n      nodes: [{ d: [], t: 'p', f: false, i: 0 }],\n      length: 0,\n      state: {},\n    };\n    linestart = 0;\n    headerlevel = 0;\n    checkbehind = -1;\n    unsurepoint = -1;\n    content = '';\n    ctype = '';\n    newLineCounter = 0;\n    i = 0;\n  } else {\n    ({\n      linestart,\n      headerlevel,\n      checkbehind,\n      unsurepoint,\n      content,\n      ctype,\n      newLineCounter,\n      i,\n    } = ast.state);\n  }\n  if (unsurepoint) {\n    const b = ast.nodes[ast.nodes.length - 1];\n    if (b.d.length) {\n      ast.length -= b.d[b.d.length - 1].c.length;\n      b.d.pop();\n    }\n  }\n  const finishBlock = (notFinal2) => {\n    if (content !== '') {\n      finishText('', notFinal2);\n    }\n    const lastBlock = ast.nodes[ast.nodes.length - 1];\n    lastBlock.f = notFinal2 !== 1;\n    lastBlock.i = i;\n    if (headerlevel > 0) {\n      lastBlock.t = `h${headerlevel}`;\n      headerlevel = -1;\n    }\n    if (notFinal2 === 0) ast.nodes.push({ d: [], t: 'p', f: false, i: 0 });\n  };\n  const finishText = (t, notFinal2 = 2) => {\n    const block = ast.nodes[ast.nodes.length - 1];\n    const last = block.d[block.d.length - 1];\n    const utype = notFinal2 === 2 ? ctype : '';\n    if (last && last.t === utype && unsurepoint < 0) {\n      const text = last;\n      ast.length += content.length;\n      text.c = text.c + content;\n      text.i = i;\n    } else {\n      const c =\n        utype === '' && unsurepoint >= 0 ? str.substring(unsurepoint) : content;\n      ast.length += c.length;\n      block.d.push({ c, t: utype, f: notFinal2 !== 1, i });\n    }\n    if (notFinal2 === 2) {\n      if (t) {\n        unsurepoint = checkbehind;\n      } else {\n        unsurepoint = -1;\n      }\n    }\n    if (notFinal2 !== 1) {\n      content = '';\n      ctype = t;\n      checkbehind = -1;\n    }\n  };\n  for (; i < str.length; i++) {\n    const char = str[i];\n    if (char === '\\n') {\n      newLineCounter++;\n      linestart = i + 1;\n      continue;\n    }\n    if (char === ' ' || char === '\t') {\n      if (newLineCounter > 0) {\n        continue;\n      }\n    }\n    if (newLineCounter > 0) {\n      if (newLineCounter > 1) {\n        finishBlock(0);\n      } else {\n        content += '\\n';\n      }\n      newLineCounter = 0;\n    }\n    if (char == '*' || char == '`' || char == '#') {\n      if (str[i - 1] == '\\\\') {\n        content += char;\n      } else if (checkbehind === -1) {\n        checkbehind = i;\n      }\n    } else {\n      if (checkbehind >= 0) {\n        const l = i - checkbehind;\n        if (str[i - 1] == '*') {\n          if (l === 2) {\n            if (ctype === 'strong') {\n              finishText('');\n            } else {\n              finishText('strong');\n            }\n          } else if (l === 1) {\n            if (ctype === 'em') {\n              finishText('');\n            } else {\n              finishText('em');\n            }\n          }\n          checkbehind = -1;\n        } else if (str[i - 1] == '`' && l == 1) {\n          if (ctype === 'code') {\n            finishText('');\n          } else {\n            finishText('code');\n          }\n          checkbehind = -1;\n        } else if (\n          str[i - 1] == '#' &&\n          str[i] === ' ' &&\n          checkbehind === linestart &&\n          i - checkbehind <= 6\n        ) {\n          headerlevel = i - checkbehind;\n          checkbehind = -1;\n          continue;\n        }\n      }\n      if (checkbehind !== -1) {\n        content += str.substring(checkbehind, i);\n        checkbehind = -1;\n      }\n      content += char;\n    }\n  }\n  finishBlock(notFinal ? 1 : -1);\n  if (notFinal) {\n    ast.state = {\n      linestart,\n      headerlevel,\n      checkbehind,\n      unsurepoint,\n      content,\n      ctype,\n      newLineCounter,\n      i,\n    };\n  } else {\n    ast.state = {};\n  }\n  return ast;\n}\nfunction render(target, ast) {\n  _renderNodes(target, ast.nodes);\n}\nfunction _renderNodes(target, nodes) {\n  if (!target) return;\n  for (const node of nodes) {\n    if (typeof node.d !== 'undefined') {\n      const block = node;\n      const el = document.createElement(block.t);\n      target.appendChild(el);\n      _renderNodes(el, block.d);\n    } else {\n      const text = node;\n      if (text.t) {\n        const el = document.createElement(node.t);\n        el.textContent = text.c;\n        target.appendChild(el);\n      } else {\n        const el = document.createTextNode(text.c);\n        target.appendChild(el);\n      }\n    }\n  }\n}\nfunction renderNext(target, ast, prevState, distance, cursor) {\n  if (!target) return;\n  return (\n    _renderNodesNext(target, ast.nodes, prevState, distance, 0, cursor) === 0\n  );\n}\nfunction _renderNodesNext(target, nodes, prevState, distance, level, cursor) {\n  let start = 0,\n    textIndex = 0,\n    el = null,\n    temp = null;\n  const prev = prevState[level];\n  if (prev) {\n    start = prev.nodeIndex;\n    textIndex = prev.textIndex;\n    el = prev.target;\n    temp = prev.temp;\n  }\n  for (let i = start; i < nodes.length; i++) {\n    const node = nodes[i];\n    if (typeof node.d !== 'undefined') {\n      const block = nodes[i];\n      if (!el) {\n        el = document.createElement(block.t);\n        target.appendChild(el);\n      }\n      distance = _renderNodesNext(\n        el,\n        block.d,\n        prevState,\n        distance,\n        level + 1,\n        cursor,\n      );\n      if (!distance) {\n        prevState[level] = { nodeIndex: i, textIndex: 0, target: el };\n        return 0;\n      }\n      el = null;\n    } else {\n      let textContent;\n      const text = node;\n      if (text.c.length - textIndex > distance) {\n        textContent = text.c.substring(textIndex, textIndex + distance);\n        textIndex += distance;\n        distance = 0;\n      } else {\n        textContent = text.c.substring(textIndex);\n        distance -= text.c.length - textIndex;\n        textIndex = 0;\n      }\n      if (text.t) {\n        if (!el) {\n          el = document.createElement(text.t);\n          target.insertBefore(el, temp);\n          el.textContent = textContent;\n        } else {\n          el.textContent += textContent;\n        }\n      } else {\n        if (!el) {\n          const el2 = document.createTextNode(textContent);\n          target.insertBefore(el2, temp);\n        } else {\n          el.textContent += textContent;\n        }\n      }\n      if (distance === 0) {\n        if (!temp) temp = addCursor(target, cursor);\n        prevState[level] = textIndex\n          ? { temp, nodeIndex: i, textIndex, target: el }\n          : { temp, nodeIndex: i + 1, textIndex: 0, target: null };\n        return distance;\n      }\n      el = null;\n    }\n  }\n  prevState[level] = null;\n  if (temp) temp.parentNode.removeChild(temp);\n  return distance;\n}\nfunction addCursor(parent, name) {\n  const el = document.createElement('div');\n  el.className = name;\n  el.textContent = 'â€‚';\n  parent.appendChild(el);\n  return el;\n}\nfunction asHTML(a) {\n  let out = '';\n  for (const node of a) {\n    if (typeof node.d !== 'undefined') {\n      out += '<' + node.t + '>';\n      out += asHTML(node.d);\n      out += '</' + node.t + '>';\n    } else {\n      if (node.t) out += '<' + node.t + '>';\n      out += node.c;\n      if (node.t) out += '</' + node.t + '>';\n    }\n  }\n  return out;\n}\nfunction asMarkdown(a) {\n  let out = '';\n  let space = '';\n  for (const node of a) {\n    if (typeof node.d !== 'undefined') {\n      if (node.t === 'h1') {\n        out += space + '# ';\n      } else if (node.t === 'h2') {\n        out += space + '## ';\n      } else if (node.t === 'h3') {\n        out += space + '### ';\n      } else if (node.t === 'h4') {\n        out += space + '#### ';\n      } else if (node.t === 'h5') {\n        out += space + '##### ';\n      } else if (node.t === 'h6') {\n        out += space + '###### ';\n      } else {\n        out += space;\n      }\n      space = '\\n\\n';\n      out += asMarkdown(node.d);\n    } else {\n      let wrap = '';\n      if (node.t === 'strong') {\n        wrap = '**';\n      } else if (node.t === 'em') {\n        wrap = '*';\n      } else if (node.t === 'code') {\n        wrap = '`';\n      }\n      out += wrap + node.c + wrap;\n    }\n  }\n  return out;\n}\nfunction html(s) {\n  return asHTML(parse(s).nodes);\n}\nexport { asHTML, asMarkdown, html, parse, render, renderNext };\n","import { html } from '../../libs/lima.es.js';\n\nexport default function MarkdownPlain({ content }) {\n  return <div dangerouslySetInnerHTML={{ __html: html(content) }} />;\n}\n","function TextPlain({ content }) {\n  return <>{content}</>;\n}\n\nexport default TextPlain;\n","import Bubbles from './Bubbles.jsx';\nimport Flow from './Flow.jsx';\n\nimport MarkdownPlain from './MarkdownPlain.jsx';\nimport TextPlain from './TextPlain.jsx';\n\nexport const messages = {\n  bubbles: Bubbles,\n  flow: Flow,\n};\nexport const formats = {\n  markdown: MarkdownPlain,\n  text: TextPlain,\n};\n","import { useMemo } from 'react';\nimport TextArea from '../TextArea.jsx';\nimport { messages, formats } from './index.js';\n\nexport default function Common({\n  content,\n  date,\n  owned,\n  render,\n  format = 'text',\n  author,\n  edit,\n  onPost: onPost,\n  onCancel: onCancel,\n}) {\n  const BoxRender = useMemo(\n    () => (typeof render === 'string' ? messages[render] : render),\n    [render],\n  );\n\n  const TextRender = useMemo(\n    () => (typeof format === 'string' ? formats[format] : format),\n    [format],\n  );\n\n  return (\n    <BoxRender owned={owned} edit={edit} author={author} date={date}>\n      {edit && edit === owned ? (\n        <TextArea\n          focus={true}\n          onPost={onPost}\n          onCancel={onCancel}\n          value={content}\n        />\n      ) : (\n        <TextRender content={content} />\n      )}\n    </BoxRender>\n  );\n}\n","import { useMemo } from 'react';\nimport Message from './messages/Common.jsx';\nimport './Messages.css';\n\nfunction Messages({\n  data,\n  render = 'blocks',\n  format,\n  author,\n  edit,\n  onPost,\n  onCancel,\n}) {\n  const css = useMemo(\n    () => (typeof render === 'string' ? render : 'blocks'),\n    [render],\n  );\n\n  return (\n    <div className={`wx-6HAxmtjJ wx-messages wx-${css}`}>\n      {data.map((message) => (\n        <Message\n          key={message.id}\n          content={message.content}\n          date={message.date}\n          author={message.author}\n          owned={message.author.id === author.id ? message.id : null}\n          render={render}\n          edit={edit}\n          format={message.format || format}\n          onPost={onPost}\n          onCancel={onCancel}\n        />\n      ))}\n    </div>\n  );\n}\n\nexport default Messages;\n","import {\n  useState,\n  useEffect,\n  useMemo,\n  useCallback,\n  useRef,\n  useContext,\n} from 'react';\nimport Messages from './Messages.jsx';\nimport TextArea from './TextArea.jsx';\nimport { ActionMenu } from '@svar-ui/react-menu';\nimport { uid } from '@svar-ui/lib-state';\nimport { dateToString } from '@svar-ui/lib-dom';\nimport { context } from '@svar-ui/react-core';\nimport { useWritableProp } from '@svar-ui/lib-react';\nimport { formatContext as FormatContext } from '../context.js';\nimport './Layout.css';\n\nexport default function Layout(props) {\n  let {\n    onAction,\n    onChange,\n    readonly = false,\n    render = 'flow',\n    format = 'text',\n    users: rawUsers,\n    data: dataProp,\n    activeUser,\n    focus = false,\n  } = props;\n\n  const lang = useContext(context.i18n);\n  const { calendar, comments, formats } = lang.getRaw();\n  const _ = lang.getGroup('comments');\n\n  const dateFormatter = useMemo(\n    () => dateToString(comments.dateFormat || formats.dateFormat, calendar),\n    [calendar, comments, formats],\n  );\n\n  const [edit, setEdit] = useState(null);\n  const [value, setValue] = useState('');\n  const [rawData, setRawData] = useWritableProp(dataProp);\n\n  useEffect(() => {\n    setValue('');\n    setEdit(null);\n  }, [rawData]);\n\n  const unknownUser = { id: 0, name: _('Unknown'), color: 'hsl(0, 0%, 85%)' };\n\n  const users = useMemo(() => {\n    if (!rawUsers) return [];\n    return rawUsers.map((u) => {\n      if (!u.color)\n        return {\n          ...u,\n          color: 'hsl(' + getColor(u.id + u.name) + ', 100%, 85%)',\n        };\n      return u;\n    });\n  }, [rawUsers]);\n\n  const author = useMemo(() => {\n    if (typeof activeUser === 'object') return activeUser;\n    const a = users.find((u) => u.id === activeUser) || unknownUser;\n    if (a) return a;\n    return {\n      id: activeUser || -1,\n      name: _('Me'),\n      color: 'hsl(225, 76%, 67%)',\n    };\n  }, [activeUser, users, _]);\n\n  const data = useMemo(() => {\n    if (!rawData) return [];\n    return rawData.map((d) => {\n      if (typeof d.author === 'object') return d;\n      const user = users ? users.find((u) => u.id === d.user) : null;\n      return {\n        ...d,\n        author: user || unknownUser,\n      };\n    });\n  }, [rawData, users]);\n\n  function getColor(name) {\n    let hash = 0;\n    for (let i = 0; i < name.length; i++) {\n      hash = name.charCodeAt(i) + ((hash << 5) - hash);\n    }\n    return (hash % 60) * 6;\n  }\n\n  function add(content) {\n    const comment = {\n      id: uid(),\n      content,\n      author,\n      user: author.id,\n      date: new Date(),\n    };\n\n    const nextValue = [...data, comment];\n    setRawData(nextValue);\n    if (onChange) {\n      const res = onChange({ value: nextValue, comment, action: 'add' });\n      if (res && typeof res === 'object') {\n        if (res.then) {\n          res.then((data) => {\n            updateAfter(comment.id, data);\n          });\n        } else {\n          updateAfter(comment.id, res);\n        }\n      }\n    }\n  }\n\n  function updateAfter(id, data) {\n    const index = rawData ? rawData.findIndex((d) => d.id === id) : -1;\n    if (index === -1) return;\n    const copy = [...rawData];\n    copy[index] = { ...rawData[index], ...data };\n    setRawData(copy);\n  }\n\n  function remove(id) {\n    const nextValue = (rawData || []).filter((d) => d.id !== id);\n    setRawData(nextValue);\n    onChange && onChange({ value: nextValue, id, action: 'delete' });\n  }\n\n  function update(id, content) {\n    let comment;\n    const nextValue = (rawData || []).map((d) => {\n      if (d.id === id) {\n        comment = { ...d, content };\n        return comment;\n      } else return d;\n    });\n    setRawData(nextValue);\n    onChange && onChange({ value: nextValue, id, action: 'update', comment });\n  }\n\n  function cancelUpdate() {\n    setEdit(null);\n  }\n\n  function handleActionMenu(ev) {\n    const { context, action } = ev;\n\n    if (!action) return;\n\n    onAction && onAction({ action: 'menu-clicked' });\n\n    switch (action.id) {\n      case 'edit-comment':\n        setEdit(context);\n        break;\n      case 'delete-comment':\n        remove(context);\n        break;\n      default:\n        break;\n    }\n  }\n\n  const menuItems = [\n    {\n      id: 'edit-comment',\n      text: _('Edit'),\n      icon: 'wxi-edit-outline',\n    },\n    {\n      id: 'delete-comment',\n      text: _('Delete'),\n      icon: 'wxi-delete-outline',\n    },\n  ];\n\n  const menu = useRef(null);\n  const showMenu = useCallback(\n    (ev) => {\n      if (menu.current && typeof menu.current.show === 'function') {\n        menu.current.show(ev);\n      }\n    },\n    [menu],\n  );\n\n  return (\n    <context.fieldId.Provider value={null}>\n      <FormatContext.Provider\n        value={{\n          dateStr: (date) => dateFormatter(date),\n        }}\n      >\n        <div className=\"wx-8ZGHQX6e wx-comments-list\">\n          <ActionMenu\n            at={'bottom'}\n            ref={menu}\n            options={menuItems}\n            resolver={(item) => item}\n            dataKey=\"commentMenuId\"\n            onClick={handleActionMenu}\n          />\n          <div className=\"wx-8ZGHQX6e wx-list\" onClick={showMenu}>\n            <Messages\n              author={author}\n              render={render}\n              data={data}\n              format={format}\n              edit={edit}\n              onPost={(ev) => update(edit, ev.value)}\n              onCancel={cancelUpdate}\n            />\n          </div>\n          {!readonly && !edit && (\n            <TextArea\n              author={author}\n              flow={render === 'flow'}\n              focus={focus}\n              onPost={(ev) => add(ev.value)}\n              buttonLabel={'Add'}\n              value={value}\n              onChange={({ value }) => setValue(value)}\n            />\n          )}\n        </div>\n      </FormatContext.Provider>\n    </context.fieldId.Provider>\n  );\n}\n","import { useState, useEffect, useCallback } from 'react';\nimport Layout from './Layout.jsx';\nimport { Locale } from '@svar-ui/react-core';\nimport { en } from '@svar-ui/comments-locales';\nimport { en as coreEn } from '@svar-ui/core-locales';\n\nfunction Comments(allProps) {\n  const { onData, onChange, value, ...props } = allProps;\n  let [finalData, setFinalData] = useState([]);\n\n  useEffect(() => {\n    if (onData && value) {\n      Promise.resolve(onData(value)).then((x) => setFinalData(x));\n    } else {\n      setFinalData(value || []);\n    }\n  }, [onData, value]);\n\n  const handleOnChange = useCallback(\n    (e) => {\n      e.originalValue = value;\n      return onChange && onChange(e);\n    },\n    [onChange, value],\n  );\n\n  return (\n    <Locale words={{ ...coreEn, ...en }} optional={true}>\n      <Layout data={finalData} {...props} onChange={handleOnChange}></Layout>\n    </Locale>\n  );\n}\n\nexport default Comments;\n","import { Willow } from '@svar-ui/react-core';\nimport './Willow.css';\nconst WillowComponent = ({ children, fonts }) => {\n  return children ? (\n    <Willow fonts={fonts}>{children}</Willow>\n  ) : (\n    <Willow fonts={fonts}></Willow>\n  );\n};\nexport default WillowComponent;\n","import { WillowDark } from '@svar-ui/react-core';\nimport './WillowDark.css';\nconst WillowDarkComponent = ({ children, fonts }) => {\n  return children ? (\n    <WillowDark fonts={fonts}>{children}</WillowDark>\n  ) : (\n    <WillowDark fonts={fonts}></WillowDark>\n  );\n};\nexport default WillowDarkComponent;\n"],"names":["getContrastingColor","color","toHSLArray","rgb","hexToRgb","hslStr","hex","asObject","rgbStringToObj","r","g","b","sep","arr","UserIcon","data","noTransform","size","border","firstLetters","useMemo","name","style","css","jsx","TextArea","props","focus","buttonLabel","flow","valueProp","author","onPost","value","setValue","useWritableProp","textareaRef","useRef","areaRef","onClickRef","i18n","useContext","context","_","useCallback","useEffect","ev","jsxs","CoreTextArea","Button","formatContext","createContext","v","Bubbles","owned","date","edit","children","dateFormatter","Flow","parse","str","ast","notFinal","content","ctype","headerlevel","newLineCounter","checkbehind","unsurepoint","linestart","i","finishBlock","notFinal2","finishText","lastBlock","t","block","last","utype","text","c","char","l","asHTML","a","out","node","html","s","MarkdownPlain","TextPlain","messages","formats","Common","render","format","onCancel","BoxRender","TextRender","Messages","message","Message","Layout","onAction","onChange","readonly","rawUsers","dataProp","activeUser","lang","calendar","comments","dateToString","setEdit","useState","rawData","setRawData","unknownUser","users","u","getColor","d","user","hash","add","comment","uid","nextValue","res","updateAfter","id","index","copy","remove","update","cancelUpdate","handleActionMenu","action","menuItems","menu","showMenu","FormatContext","ActionMenu","item","Comments","allProps","onData","finalData","setFinalData","x","handleOnChange","e","Locale","coreEn","en","WillowComponent","fonts","Willow","WillowDarkComponent","WillowDark"],"mappings":"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"}
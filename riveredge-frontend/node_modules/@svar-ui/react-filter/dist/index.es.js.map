{"version":3,"file":"index.es.js","sources":["../src/context.js","../src/components/editor/Layout.jsx","../src/components/editor/FilterEditor.jsx","../src/components/editor/Panel.jsx","../src/components/editor/Rule.jsx","../src/components/editor/Glue.jsx","../src/components/editor/List.jsx","../src/components/Layout.jsx","../src/components/FilterBuilder.jsx","../src/components/bar/Layout.jsx","../src/components/bar/FilterBar.jsx","../src/themes/Material.jsx","../src/themes/Willow.jsx","../src/themes/WillowDark.jsx"],"sourcesContent":["import { createContext } from 'react';\n\nconst store = createContext(null);\nexport default store;\n","import { useState, useEffect, useRef, useContext } from 'react';\nimport {\n  RichSelect,\n  Text,\n  Button,\n  DatePicker,\n  Checkbox,\n  DateRangePicker,\n  Combo,\n  context\n} from '@svar-ui/react-core';\nimport { getFilters, getFilter } from '@svar-ui/filter-store';\nimport { dateToString } from '@svar-ui/lib-dom';\nimport './Layout.css';\n\nexport default function Layout(props) {\n  const {\n    fields = null,\n    fieldsSelector = true,\n    field: fieldProp = null,\n    buttons = true,\n    options: optionsProp = null,\n    includes: includesProp = null,\n    type: typeProp = 'text',\n    filter: filterProp = '',\n    value: valueProp = '',\n    format: formatProp = null,\n    predicate: predicateProp = null,\n  } = props;\n\n  const onApply = props.onApply || props.onapply;\n  const onCancel = props.onCancel || props.oncancel;\n  const onChange = props.onChange || props.onchange;\n\n  const locale = useContext(context.i18n);\n  const l = locale.getRaw();\n  const f = l.filter?.dateFormat || l.formats?.dateFormat;\n  const dateFormat = dateToString(f, l.calendar);\n  const _ = locale.getGroup('filter');\n\n  const ACTION_FIELD_CHANGE = 1;\n  const ACTION_FILTER_CHANGE = 2;\n  const ACTION_VALUE_CHANGE = 4;\n  const ACTION_INCLUDES_CHANGE = 8;\n  const ACTION_TYPE_CHANGE = 16;\n  const ACTION_CHANGE = 32;\n  const ACTION_OPTIONS_CHANGE = 64;\n\n  const [_filter, set_filter] = useState();\n  const _filterRef = useRef();\n  const [_field, set_field] = useState();\n  const _fieldRef = useRef();\n  const [_type, set_type] = useState();\n  const _typeRef = useRef();\n  const [_value, set_value] = useState();\n  const _valueRef = useRef();\n  const [_includes, set_includes] = useState([]);\n  const _includesRef = useRef([]);\n  const [_options, set_options] = useState();\n  const _optionsRef = useRef();\n  const [, set_format] = useState();\n  const _formatRef = useRef();\n  const [, set_predicate] = useState();\n  const _predicateRef = useRef();\n  const [ready, setReady] = useState(false);\n\n  const [providedOptions, setProvidedOptions] = useState(null);\n\n  async function loadOptions(field) {\n    if (!optionsProp || typeof optionsProp !== 'function') return;\n\n    const result = await optionsProp(field);\n    setProvidedOptions(result || []);\n  }\n\n  const sRef = useRef(0);\n  const timerRef = useRef(null);\n\n  function arr2str(v) {\n    return v ? v.toString() : '';\n  }\n\n  function updateState(setter, ref, value) {\n    setter(value);\n    ref.current = value;\n  }\n\n  function setState(signal, value) {\n    switch (signal) {\n      case ACTION_FIELD_CHANGE:\n        if (_fieldRef.current !== value) {\n          updateState(set_field, _fieldRef, value);\n          return signal;\n        }\n        break;\n      case ACTION_TYPE_CHANGE:\n        if (_typeRef.current !== value) {\n          updateState(set_type, _typeRef, value);\n          return signal;\n        }\n        break;\n      case ACTION_FILTER_CHANGE:\n        if (_filterRef.current !== value) {\n          updateState(set_filter, _filterRef, value);\n          return signal;\n        }\n        break;\n      case ACTION_VALUE_CHANGE:\n        if (_valueRef.current !== value) {\n          updateState(set_value, _valueRef, value);\n          return signal;\n        }\n        break;\n      case ACTION_INCLUDES_CHANGE:\n        if (arr2str(_includesRef.current) != arr2str(value)) {\n          updateState(set_includes, _includesRef, value || []);\n          return signal;\n        }\n        break;\n      case ACTION_OPTIONS_CHANGE:\n        if (_optionsRef.current !== value) {\n          updateState(set_options, _optionsRef, value || []);\n          return signal;\n        }\n        break;\n    }\n    return 0;\n  }\n\n  function execSignal(signal) {\n    sRef.current = sRef.current | signal;\n    if (!timerRef.current) {\n      timerRef.current = setTimeout(() => {\n        const v = sRef.current;\n        timerRef.current = null;\n        sRef.current = 0;\n        runSignal(v);\n      });\n    }\n  }\n\n  const [allSelected, setAllSelected] = useState();\n  const allSelectedRef = useRef();\n  const [visibleValues, setVisibleValues] = useState([]);\n  const visibleValuesRef = useRef([]);\n  const [, setRule] = useState();\n  const ruleRef = useRef();\n  const [rules, setRules] = useState();\n  const rulesRef = useRef();\n\n  function runSignal(s) {\n    if (s & ACTION_FIELD_CHANGE) {\n      if (fields) {\n        updateState(set_options, _optionsRef, null);\n        const nextField = fields.find((a) => a.id === _fieldRef.current);\n        const isDate =\n          _valueRef.current instanceof Date ||\n          (_valueRef.current && typeof _valueRef.current === 'object');\n        const isTuple =\n          nextField.type === 'tuple' || _typeRef.current == 'tuple';\n        if (\n          (isDate && nextField.type !== 'date') ||\n          (!isDate && nextField.type == 'date') ||\n          (isNaN(_valueRef.current) && nextField.type == 'number') ||\n          isTuple\n        ) {\n          updateState(set_value, _valueRef, null);\n        } else if (\n          nextField.type === 'text' &&\n          typeof _valueRef.current !== 'string'\n        ) {\n          const nv =\n            _valueRef.current || _valueRef.current === 0\n              ? _valueRef.current.toString()\n              : '';\n          updateState(set_value, _valueRef, nv);\n        }\n        updateState(set_format, _formatRef, nextField.format);\n        updateState(set_predicate, _predicateRef, nextField.predicate);\n\n        s = s | setState(ACTION_TYPE_CHANGE, nextField.type || 'text');\n\n        loadOptions(_fieldRef.current);\n      }\n    }\n\n    if (s & ACTION_TYPE_CHANGE) {\n      const nextRules = getFilters(_typeRef.current).map((a) => ({\n        id: a.id,\n        label: _(a.label || a.id),\n      }));\n      updateState(setRules, rulesRef, nextRules);\n\n      if (!nextRules.some((rule) => rule?.id === _filterRef.current)) {\n        updateState(set_filter, _filterRef, null);\n      }\n    }\n\n    if (s & ACTION_TYPE_CHANGE || s & ACTION_FILTER_CHANGE) {\n      let r = getFilter(_filterRef.current, _typeRef.current);\n      if (!r) {\n        r = getFilters(_typeRef.current).find((a) => a.default);\n        s = s | setState(ACTION_FILTER_CHANGE, r.id);\n      }\n      updateState(setRule, ruleRef, r);\n\n      if (\n        typeof _valueRef.current === 'object' &&\n        !(_valueRef.current instanceof Date) &&\n        !r.range\n      ) {\n        s =\n          s |\n          setState(\n            ACTION_VALUE_CHANGE,\n            _typeRef.current === 'date' ? null : '',\n          );\n      }\n    }\n\n    if (\n      s & ACTION_FILTER_CHANGE ||\n      s & ACTION_VALUE_CHANGE ||\n      s & ACTION_OPTIONS_CHANGE\n    ) {\n      if (_optionsRef.current) {\n        const handler =\n          _valueRef.current || _valueRef.current === 0\n            ? (v) => ruleRef.current.handler(v, _valueRef.current || '')\n            : null;\n\n        const vv =\n          _filterRef.current && handler\n            ? _optionsRef.current.filter(handler)\n            : _optionsRef.current;\n\n        updateState(setVisibleValues, visibleValuesRef, vv);\n\n        let nextIncs = _includesRef.current;\n        if (_includesRef.current.length) {\n          nextIncs = _includesRef.current.filter((x) => vv.includes(x));\n        }\n\n        if (nextIncs.length) {\n          if (nextIncs.length !== _includesRef.current.length) {\n            s = s | setState(ACTION_INCLUDES_CHANGE, nextIncs);\n          }\n        } else {\n          s = s | setState(ACTION_INCLUDES_CHANGE, [...vv]);\n        }\n      } else {\n        updateState(setVisibleValues, visibleValuesRef, []);\n      }\n    }\n\n    if (s & ACTION_INCLUDES_CHANGE) {\n      const as =\n        _includesRef.current.length === visibleValuesRef.current.length;\n      updateState(setAllSelected, allSelectedRef, as);\n    }\n\n    if (s & ACTION_CHANGE) {\n      const r = getRule();\n      onChange && onChange({ value: r });\n    }\n  }\n\n  function doApply() {\n    const r = getRule();\n    onApply && onApply({ value: r });\n  }\n\n  function doCancel() {\n    onCancel && onCancel();\n  }\n\n  function toggleAll() {\n    const nextAll = !allSelectedRef.current;\n    updateState(setAllSelected, allSelectedRef, nextAll);\n    execSignal(\n      setState(\n        ACTION_INCLUDES_CHANGE,\n        nextAll ? [...visibleValuesRef.current] : [],\n      ) | ACTION_CHANGE,\n    );\n  }\n\n  function handleChange(ev) {\n    const { inputValue, value } = ev;\n    const next = value\n      ? [..._includesRef.current, inputValue]\n      : _includesRef.current.filter((a) => a != inputValue);\n    execSignal(setState(ACTION_INCLUDES_CHANGE, next) | ACTION_CHANGE);\n  }\n\n  function changeValue({ value }) {\n    if (value === '$empty') value = '';\n    execSignal(setState(ACTION_VALUE_CHANGE, value) | ACTION_CHANGE);\n  }\n\n  function changeField({ value }) {\n    execSignal(setState(ACTION_FIELD_CHANGE, value) | ACTION_CHANGE);\n  }\n\n  function changeFilter({ value }) {\n    execSignal(setState(ACTION_FILTER_CHANGE, value) | ACTION_CHANGE);\n  }\n\n  function getRule() {\n    const out = {\n      filter: _filterRef.current,\n      value: _valueRef.current,\n      type: _typeRef.current,\n    };\n\n    if (_predicateRef.current) out.predicate = _predicateRef.current;\n    if (_fieldRef.current) out.field = _fieldRef.current;\n\n    if (\n      _includesRef.current &&\n      _includesRef.current.length &&\n      _includesRef.current.length !== visibleValuesRef.current.length\n    )\n      out.includes = [..._includesRef.current];\n    else out.includes = [];\n\n    return out;\n  }\n\n  function getLabel(v) {\n    if (_formatRef.current && typeof _formatRef.current == 'function')\n      return _formatRef.current(v);\n    if (v instanceof Date)\n      return _formatRef.current\n        ? dateToString(_formatRef.current, l.calendar)(v)\n        : dateFormat(v);\n    return typeof v === 'string' ? v : v.toString();\n  }\n\n  function getComboOptions(options) {\n    let arr = options\n      ? options.map((op) => ({ id: op, label: getLabel(op) }))\n      : [];\n    return [{ id: '$empty', label: '', emptyLabel: _('None') }].concat(arr);\n  }\n\n  const inputRef = useRef(null);\n  useEffect(() => {\n    if (_fieldRef.current && inputRef.current) {\n      setTimeout(() => {\n        const el = inputRef.current;\n        const inp = el && el.querySelector('input');\n        if (inp) inp.focus();\n      }, 1);\n    }\n  }, [_field]);\n\n  useEffect(() => {\n    if (ready) execSignal(setState(ACTION_FIELD_CHANGE, fieldProp));\n  }, [fieldProp, ready]);\n\n  useEffect(() => {\n    if (ready) execSignal(setState(ACTION_TYPE_CHANGE, typeProp));\n  }, [typeProp, ready]);\n\n  useEffect(() => {\n    if (ready) execSignal(setState(ACTION_FILTER_CHANGE, filterProp));\n  }, [filterProp, ready]);\n\n  useEffect(() => {\n    if (ready) execSignal(setState(ACTION_VALUE_CHANGE, valueProp));\n  }, [valueProp, ready]);\n\n  useEffect(() => {\n    if (ready) execSignal(setState(ACTION_INCLUDES_CHANGE, includesProp));\n  }, [includesProp, ready]);\n\n  useEffect(() => {\n    const currOptions = Array.isArray(optionsProp)\n      ? optionsProp\n      : providedOptions;\n    if (ready) execSignal(setState(ACTION_OPTIONS_CHANGE, currOptions));\n  }, [optionsProp, providedOptions, ready]);\n\n  useEffect(() => {\n    if (formatProp && !fields) updateState(set_format, _formatRef, formatProp);\n    if (predicateProp && !fields)\n      updateState(set_predicate, _predicateRef, predicateProp);\n  }, [formatProp, predicateProp, fields]);\n\n  useEffect(() => {\n    setReady(true);\n  }, []);\n\n  return (\n    <context.fieldId.Provider value={null}>\n      <div className=\"wx-3z8r9Oys wx-filter-editor\">\n        {fields && fieldsSelector ? (\n          <RichSelect onChange={changeField} options={fields} value={_field} />\n        ) : null}\n        <div className=\"wx-3z8r9Oys wx-wrapper\">\n          <div className=\"wx-3z8r9Oys wx-cell\">\n            <RichSelect\n              onChange={changeFilter}\n              options={rules}\n              value={_filter}\n              placeholder={_('Click to select')}\n            />\n          </div>\n          <div className=\"wx-3z8r9Oys wx-cell\" ref={inputRef}>\n            {_type === 'date' ? (\n              _filter == 'between' || _filter == 'notBetween' ? (\n                <DateRangePicker\n                  format={f}\n                  value={_value}\n                  buttons={['done', 'clear', 'today']}\n                  onChange={changeValue}\n                />\n              ) : (\n                <DatePicker format={f} value={_value} onChange={changeValue} />\n              )\n            ) : _type === 'number' ? (\n              <Text value={_value} onChange={changeValue} type=\"number\" />\n            ) : _type === 'tuple' ? (\n              <Combo\n                value={_value}\n                options={getComboOptions(_options)}\n                onChange={changeValue}\n              >\n                {({ option }) => option.emptyLabel || option.label}\n              </Combo>\n            ) : (\n              <Text value={_value} onChange={changeValue} />\n            )}\n          </div>\n        </div>\n\n        <Button onClick={toggleAll}>\n          {allSelected ? _('Unselect all') : _('Select all')}\n        </Button>\n        <div className=\"wx-3z8r9Oys wx-list\" role=\"listbox\">\n          {visibleValues.map((option, i) => (\n            <div\n              className=\"wx-3z8r9Oys wx-item\"\n              tabIndex={i ? -1 : 0}\n              role=\"option\"\n              key={i}\n            >\n              <Checkbox\n                label={getLabel(option)}\n                inputValue={option}\n                value={_includes && _includes.includes(option)}\n                onChange={handleChange}\n              />\n            </div>\n          ))}\n        </div>\n\n        {buttons ? (\n          <div className=\"wx-3z8r9Oys wx-wrapper\">\n            <Button type={'secondary'} onClick={doCancel}>\n              {_('Cancel')}\n            </Button>\n            <Button type={'primary'} onClick={doApply}>\n              {_('Apply')}\n            </Button>\n          </div>\n        ) : null}\n      </div>\n    </context.fieldId.Provider>\n  );\n}\n","import { Locale } from '@svar-ui/react-core';\nimport { en } from '@svar-ui/filter-locales';\nimport Layout from './Layout.jsx';\n\nfunction FilterEditor(props) {\n  return (\n    <Locale words={en} optional={true}>\n      <Layout {...props} />\n    </Locale>\n  );\n}\n\nexport default FilterEditor;\n","import { useContext, useMemo, useCallback } from 'react';\nimport storeContext from '../../context';\nimport { useStore } from '@svar-ui/lib-react';\nimport FilterEditor from './FilterEditor.jsx';\nimport './Panel.css';\n\nexport default function Panel(props) {\n  const { rule, type } = props;\n\n  const includes = useMemo(\n    () => (rule.includes && rule.includes.length ? rule.includes : null),\n    [rule],\n  );\n  const filter = useMemo(() => rule.filter || 'contains', [rule]);\n  const value = useMemo(() => rule.value || '', [rule]);\n  const field = useMemo(() => rule.field, [rule]);\n  const id = useMemo(() => rule.id, [rule]);\n\n  const api = useContext(storeContext);\n  const fields = useStore(api, 'fields');\n  const options = useStore(api, 'options');\n\n  const doCancel = useCallback(() => {\n    api.exec('edit-rule', {});\n  }, [api]);\n\n  const doApply = useCallback(\n    ({ value }) => {\n      api.exec('update-rule', { id, rule: value });\n      doCancel();\n    },\n    [api, id],\n  );\n\n  const doChange = useCallback(\n    ({ value }) => {\n      api.exec('change-rule', { id, rule: value });\n    },\n    [api, id],\n  );\n\n  return (\n    <div className=\"wx-uOIGm7Ce wx-panel\">\n      <FilterEditor\n        fieldsSelector={type !== 'simple'}\n        fields={fields}\n        field={field}\n        options={options}\n        includes={includes}\n        filter={filter}\n        value={value}\n        onApply={doApply}\n        onCancel={doCancel}\n        onChange={doChange}\n      />\n    </div>\n  );\n}\n","import React, { useState, useEffect, useMemo, useRef, useContext } from 'react';\nimport { getFilter } from '@svar-ui/filter-store';\nimport { dateToString } from '@svar-ui/lib-dom';\nimport { context } from '@svar-ui/react-core';\nimport './Rule.css';\n\nexport default function Rule({\n  filter,\n  field,\n  type = 'list',\n  action = 'menu',\n}) {\n  const noChange = (v) => v;\n\n  const locale = useContext(context.i18n);\n\n  const lRef = useRef();\n  if (lRef.current === undefined) {\n    lRef.current = locale.getRaw();\n  }\n  const l = lRef.current;\n\n  const fRef = useRef();\n  if (fRef.current === undefined) {\n    fRef.current =\n      field?.format || l.filter?.dateFormat || l.formats.dateFormat;\n  }\n  const f = fRef.current;\n\n  const _format = useMemo(\n    () =>\n      typeof f === 'function'\n        ? f\n        : field?.type === 'date'\n          ? dateToString(f, l.calendar)\n          : noChange,\n    [field],\n  );\n\n  const groupRef = useRef();\n  if (groupRef.current === undefined) {\n    groupRef.current = locale.getGroup('filter');\n  }\n  const _ = groupRef.current;\n\n  const [rule, setRule] = useState();\n  const [filterValue, setFilterValue] = useState();\n\n  useEffect(() => {\n    setFilterValue(filter.value);\n    setRule(filter.filter ? getFilter(filter.filter, filter.type) : null);\n  }, [filter]);\n\n  return (\n    <div className={`wx-5GeVl88l wx-rule wx-${type}`} data-id={filter.id}>\n      <span className=\"wx-5GeVl88l wx-filter\">\n        <span className=\"wx-5GeVl88l wx-field\">{field.label}</span>\n        {filter.includes && filter.includes.length ? (\n          <>\n            {' ' + _('in') + ' '}\n            {filter.includes.map((value, i) => (\n              <React.Fragment key={value}>\n                <span className=\"wx-5GeVl88l wx-value\">{_format(value)}</span>\n                {i < filter.includes.length - 1 ? ',\\u00A0' : null}\n              </React.Fragment>\n            ))}\n          </>\n        ) : filter.filter && (filterValue || filterValue === 0) ? (\n          <>\n            {' ' + (_(rule.short || rule.label) || rule.id) + ' '}\n            {field.type === 'date' ? (\n              filterValue.start ? (\n                <>\n                  <span className=\"wx-5GeVl88l wx-value\">\n                    {_format(filterValue.start)}\n                  </span>\n                  {' ' + _('and') + ' '}\n                  <span className=\"wx-5GeVl88l wx-value\">\n                    {_format(filterValue.end)}\n                  </span>\n                </>\n              ) : (\n                <span className=\"wx-5GeVl88l wx-value\">\n                  {_format(filterValue)}\n                </span>\n              )\n            ) : (\n              <span className=\"wx-5GeVl88l wx-value\">\n                {_format(filterValue)}\n              </span>\n            )}\n          </>\n        ) : null}\n      </span>\n      <i\n        className={`wx-5GeVl88l wxi-${action === 'menu' ? 'dots-v' : action} wx-menu-icon`}\n        role=\"button\"\n        data-action={action}\n      ></i>\n    </div>\n  );\n}\n","import { useContext } from 'react';\nimport { context } from '@svar-ui/react-core';\nimport './Glue.css';\nimport storeContext from '../../context';\n\nexport default function Glue({ mode = 'and', id }) {\n  const i18n = useContext(context.i18n);\n  const _ = i18n.getGroup('filter');\n  const api = useContext(storeContext);\n\n  function toggleGlue() {\n    api.exec('toggle-glue', { id });\n  }\n\n  return (\n    <div\n      className={`wx-XRdDajFX wx-glue wx-${mode}`}\n      role=\"button\"\n      onClick={toggleGlue}\n    >\n      {_(mode)}\n    </div>\n  );\n}\n","import {\n  Fragment,\n  useState,\n  useEffect,\n  useMemo,\n  useRef,\n  useCallback,\n  useContext,\n} from 'react';\nimport { delegateClick } from '@svar-ui/lib-dom';\nimport { Portal, Popup } from '@svar-ui/react-core';\nimport storeContext from '../../context';\nimport { useStore, useStoreWithCounter } from '@svar-ui/lib-react';\n\nimport Panel from './Panel.jsx';\nimport Rule from './Rule.jsx';\nimport Glue from './Glue.jsx';\n\nimport './List.css';\n\nfunction List(props) {\n  const { group, type, onShowMenu } = props;\n\n  const api = useContext(storeContext);\n  const [valueState, valueChanged] = useStoreWithCounter(api, 'value');\n  const fieldsState = useStore(api, 'fields');\n  const editorState = useStore(api, '_editor');\n\n  const filters = useMemo(() => {\n    return (valueState && valueState.getBranch(group.id)) || [];\n  }, [valueChanged, group.id]);\n\n  const cssType = useMemo(() => (type == 'simple' ? 'line' : type), [type]);\n  const groupCss = useMemo(\n    () => (group.$level == 1 ? 'top' : 'inner'),\n    [group.$level],\n  );\n\n  const handlers = useMemo(\n    () => ({\n      dblclick: (id) => api.exec('edit-rule', { id }),\n      menu: (id, ev) => onShowMenu && onShowMenu({ id, ev }),\n      delete: (id) => {\n        api.exec('edit-rule', {});\n        api.exec('delete-rule', { id });\n      },\n    }),\n    [api, onShowMenu],\n  );\n\n  const getField = useCallback(\n    (id) => fieldsState.find((a) => a.id == id),\n    [fieldsState],\n  );\n\n  const rootRef = useRef(null);\n  const [ruleBox, setRuleBox] = useState();\n  const [ruleEditor, setRuleEditor] = useState();\n\n  useEffect(() => {\n    const node = rootRef.current;\n    if (!node) return;\n    const cleanup = delegateClick(node, handlers);\n    return cleanup;\n  }, [handlers]);\n\n  useEffect(() => {\n    if (editorState && ruleEditor === editorState.id) return;\n\n    if (\n      editorState &&\n      type !== 'list' &&\n      filters.find((a) => a.id === editorState.id)\n    ) {\n      const rootNode =\n        rootRef.current &&\n        rootRef.current.querySelector(`[data-id='${editorState.id}']`);\n      if (rootNode) {\n        setRuleBox(rootNode.getBoundingClientRect());\n        setRuleEditor(editorState.id);\n        return;\n      }\n    }\n    setRuleBox(null);\n    setRuleEditor(null);\n  }, [editorState, type, filters, ruleEditor]);\n\n  function cancel() {\n    setRuleBox(null);\n    setRuleEditor(null);\n    api.exec('edit-rule', {});\n  }\n\n  return (\n    <>\n      <div\n        ref={rootRef}\n        className={`wx-3udP2tTA wx-group wx-${groupCss} wx-${cssType}`}\n      >\n        {filters.map((rule, i) => (\n          <Fragment key={rule.id}>\n            {type === 'list' && editorState && editorState.id == rule.id ? (\n              <Panel rule={rule} />\n            ) : rule.data ? (\n              <List type={type} group={rule} onShowMenu={onShowMenu} />\n            ) : (\n              <div className=\"wx-3udP2tTA wx-rule-wrapper\">\n                <Rule\n                  action={type == 'simple' ? 'delete' : 'menu'}\n                  type={cssType}\n                  filter={rule}\n                  field={getField(rule.field)}\n                />\n              </div>\n            )}\n\n            {type !== 'simple' && i < filters.length - 1 ? (\n              <div className=\"wx-3udP2tTA wx-glue-wrapper\">\n                <Glue mode={group.glue} id={group.id} />\n              </div>\n            ) : null}\n          </Fragment>\n        ))}\n      </div>\n\n      {editorState && ruleBox ? (\n        <Portal>\n          <Popup\n            top={ruleBox.top + ruleBox.height}\n            left={ruleBox.left + ruleBox.width / 2}\n            onCancel={cancel}\n          >\n            <div className=\"wx-3udP2tTA wx-editor-wrapper\">\n              <Panel type={type} rule={valueState.byId(editorState.id)} />\n            </div>\n          </Popup>\n        </Portal>\n      ) : null}\n    </>\n  );\n}\n\nexport default List;\n","import { useContext, useMemo, useRef, useCallback } from 'react';\n\nimport { Button } from '@svar-ui/react-core';\nimport { DropDownMenu, ContextMenu } from '@svar-ui/react-menu';\nimport List from './editor/List.jsx';\nimport { context } from '@svar-ui/react-core';\nimport './Layout.css';\nimport storeContext from '../context';\nimport { useStore, useStoreWithCounter } from '@svar-ui/lib-react';\n\nexport default function Layout({ type }) {\n  const api = useContext(storeContext);\n  const i18nCtx = useContext(context.i18n);\n  const _ = useMemo(() => i18nCtx.getGroup('filter'), [i18nCtx]);\n\n  const fields = useStore(api, 'fields');\n  const [value, valueChanged] = useStoreWithCounter(api, 'value');\n\n  const group = value.getBranch(0)[0];\n\n  function addFilter(data) {\n    api.exec('add-rule', { rule: { $temp: true, ...data }, edit: true });\n  }\n\n  const newFilterOptions = useMemo(() => {\n    const now = {};\n    value.forEach((x) => (now[x.field] = true));\n    return fields\n      .filter((c) => !now[c.id])\n      .map((o) => ({ id: o.id, text: o.label }));\n  }, [valueChanged, fields]);\n\n  const selectNewFilter = useCallback(\n    (ev) => {\n      const action = ev.action;\n      if (action) {\n        addFilter({ field: action.id });\n      }\n    },\n    [addFilter],\n  );\n\n  const menuOptions = useMemo(\n    () => [\n      {\n        id: 'edit-rule',\n        text: _('Edit'),\n        icon: 'wxi-edit-outline',\n      },\n      {\n        id: 'add-rule',\n        text: _('Add filter'),\n        icon: 'wxi-filter-plus-outline',\n        resolver: (item) => ({\n          after: item,\n          rule: { $temp: true },\n          edit: true,\n        }),\n      },\n      {\n        id: 'add-group',\n        text: _('Add group'),\n        icon: 'wxi-filter-multiple-outline',\n        resolver: (item) => ({\n          after: item,\n          rule: { $temp: true },\n          edit: true,\n        }),\n      },\n      { type: 'separator' },\n      {\n        id: 'delete-rule',\n        text: _('Delete'),\n        icon: 'wxi-delete-outline',\n      },\n    ],\n    [_],\n  );\n\n  const menuRef = useRef(null);\n\n  const menuAction = useCallback(\n    (ev) => {\n      const { context: item, action } = ev;\n      if (action) {\n        const data = action.resolver ? action.resolver(item) : { id: item };\n        api.exec(action.id, data);\n      }\n    },\n    [api],\n  );\n\n  const onShowMenu = useCallback(({ ev, id }) => {\n    if (menuRef.current && typeof menuRef.current.show === 'function') {\n      menuRef.current.show(ev, id);\n    }\n  }, []);\n\n  return (\n    <>\n      <div className={`wx-VDDi7d7g wx-filter-builder wx-${type}`}>\n        {type === 'list' ? (\n          <>\n            <div className={`wx-VDDi7d7g wx-toolbar wx-${type}`}>\n              <Button type={'primary'} onClick={addFilter}>\n                {_('Add filter')}\n              </Button>\n            </div>\n            <List type={type} group={group} onShowMenu={onShowMenu} />\n          </>\n        ) : type === 'line' ? (\n          <div className={`wx-VDDi7d7g wx-toolbar wx-${type}`}>\n            <div className=\"wx-VDDi7d7g wx-filters\">\n              <List type={type} group={group} onShowMenu={onShowMenu} />\n            </div>\n\n            <div className=\"wx-VDDi7d7g wx-button\">\n              <Button type={'primary'} onClick={addFilter}>\n                {_('Add filter')}\n              </Button>\n            </div>\n          </div>\n        ) : type === 'simple' ? (\n          <div className={`wx-VDDi7d7g wx-toolbar wx-${type}`}>\n            <div className=\"wx-VDDi7d7g wx-button\">\n              <DropDownMenu\n                options={newFilterOptions}\n                onClick={selectNewFilter}\n              >\n                <Button disabled={!newFilterOptions.length} type={'primary'}>\n                  {_('Add filter')}\n                </Button>\n              </DropDownMenu>\n            </div>\n\n            <div className=\"wx-VDDi7d7g wx-filters\">\n              <List type={type} group={group} onShowMenu={onShowMenu} />\n            </div>\n          </div>\n        ) : null}\n      </div>\n      {type !== 'simple' ? (\n        <ContextMenu options={menuOptions} onClick={menuAction} ref={menuRef} />\n      ) : null}\n    </>\n  );\n}\n","import {\n  forwardRef,\n  useEffect,\n  useImperativeHandle,\n  useMemo,\n  useRef,\n} from 'react';\nimport Layout from './Layout.jsx';\nimport { Locale } from '@svar-ui/react-core';\nimport { en } from '@svar-ui/filter-locales';\nimport { EventBusRouter } from '@svar-ui/lib-state';\nimport { DataStore } from '@svar-ui/filter-store';\nimport ContextStore from '../context';\nimport { writable } from '@svar-ui/lib-react';\n\nconst camelize = (s) =>\n  s\n    .split('-')\n    .map((part) => (part ? part.charAt(0).toUpperCase() + part.slice(1) : ''))\n    .join('');\n\nconst FilterBuilder = forwardRef(function FilterBuilder(\n  {\n    value = { glue: 'and', rules: [] },\n    fields = [],\n    options = null,\n    type = 'list',\n    init = null,\n    ...restProps\n  },\n  ref,\n) {\n  // keep latest rest props for event routing\n  const restPropsRef = useRef();\n  restPropsRef.current = restProps;\n\n  // init stores\n  const dataStore = useMemo(() => new DataStore(writable), []);\n  const firstInRoute = useMemo(() => dataStore.in, [dataStore]);\n\n  const lastInRouteRef = useRef(null);\n  if (lastInRouteRef.current === null) {\n    lastInRouteRef.current = new EventBusRouter((a, b) => {\n      const name = 'on' + camelize(a);\n      if (restPropsRef.current && restPropsRef.current[name]) {\n        restPropsRef.current[name](b);\n      }\n    });\n    firstInRoute.setNext(lastInRouteRef.current);\n  }\n\n  // public API\n  const api = useMemo(\n    () => ({\n      getState: dataStore.getState.bind(dataStore),\n      getReactiveState: dataStore.getReactive.bind(dataStore),\n      getStores: () => ({ data: dataStore }),\n      exec: firstInRoute.exec,\n      setNext: (ev) => {\n        lastInRouteRef.current = lastInRouteRef.current.setNext(ev);\n        return lastInRouteRef.current;\n      },\n      intercept: firstInRoute.intercept.bind(firstInRoute),\n      on: firstInRoute.on.bind(firstInRoute),\n      detach: firstInRoute.detach.bind(firstInRoute),\n      getValue: dataStore.getValue.bind(dataStore),\n    }),\n    [dataStore, firstInRoute],\n  );\n\n  // init logic\n  const initOnceRef = useRef(true);\n  useEffect(() => {\n    dataStore.init({\n      value,\n      fields,\n      options,\n    });\n\n    if (initOnceRef.current && init) {\n      init(api);\n      initOnceRef.current = false;\n    }\n  }, [dataStore, value, fields, options, init, api]);\n\n  if (initOnceRef.current) {\n    dataStore.init({\n      value,\n      fields,\n      options,\n    });\n\n    if (init) init(api);\n    initOnceRef.current = false;\n  }\n\n  // expose API via ref\n  useImperativeHandle(\n    ref,\n    () => ({\n      ...api,\n    }),\n    [api],\n  );\n\n  return (\n    <Locale words={en} optional={true}>\n      <ContextStore.Provider value={api}>\n        <Layout type={type} />\n      </ContextStore.Provider>\n    </Locale>\n  );\n});\n\nexport default FilterBuilder;\n","import {\n  Fragment,\n  useState,\n  useEffect,\n  useMemo,\n  useRef,\n  useContext,\n} from 'react';\nimport { RichSelect, Text, DatePicker, DateRangePicker } from '@svar-ui/react-core';\nimport { createFilterRule } from '@svar-ui/filter-store';\nimport { context } from '@svar-ui/react-core';\nimport './Layout.css';\n\nfunction Layout(props) {\n  const { fields = [], debounce = 300, onChange } = props;\n\n  const [lastField, setLastField] = useState();\n  const [lastValue, setLastValue] = useState({});\n\n  const locale = useContext(context.i18n);\n  const l = locale.getRaw();\n  const f =\n    (l.filter && l.filter.dateFormat) || (l.formats && l.formats.dateFormat);\n  const _ = locale.getGroup('filter');\n\n  function getFieldOptions(field) {\n    const options = field.options.map((a) => {\n      if (typeof a === 'string' || typeof a === 'number') {\n        return { id: a, label: a };\n      }\n      return a;\n    });\n\n    options.unshift({ id: '$empty', label: _('None') });\n\n    return options;\n  }\n\n  function normalizeField(field) {\n    if (typeof field === 'string')\n      return { id: field, type: 'text', filter: 'contains' };\n    return {\n      ...field,\n      filter: field.filter || (field.options ? 'equal' : 'contains'),\n      options: field.type !== 'date' && field.options && getFieldOptions(field),\n    };\n  }\n\n  function normalizeFieldsFn(fieldsArr) {\n    return fieldsArr.map((field) => {\n      if (field.type === 'all' || field.type === 'dynamic') {\n        return {\n          ...field,\n          by: field.by.map((b) => normalizeField(b)),\n        };\n      }\n      return normalizeField(field);\n    });\n  }\n\n  function getDynamicOptions(arr) {\n    return arr.map((a) => ({ id: a.id, label: a.id }));\n  }\n\n  const normalizedFields = useMemo(() => normalizeFieldsFn(fields), [fields]);\n\n  const originalValue = useRef(null);\n  useEffect(() => {\n    const values = {};\n    let newLastField = lastField;\n\n    normalizedFields.forEach((field) => {\n      if (field.type === 'dynamic') {\n        field.by.forEach((fItem) => {\n          if (typeof fItem.value !== 'undefined')\n            values[fItem.id] = fItem.value;\n        });\n        newLastField = field.by[0].id;\n      } else if (field.type === 'all') {\n        values[field.type] = field.value ?? '';\n      } else if (typeof field.value !== 'undefined') {\n        values[field.id] = field.value;\n      }\n    });\n\n    originalValue.current = values;\n    setLastValue(values);\n    setLastField(newLastField);\n  }, [normalizedFields]);\n\n  function computeFilters(nFields, lField, lValue) {\n    return nFields.map((field) => {\n      let base = {\n        field: field.type,\n        label: field.label,\n        placeholder: field.placeholder,\n      };\n\n      if (field.type === 'dynamic') {\n        base.dynamicField = true;\n        base.field = lField;\n\n        const currentField = field.by.find((fItem) => fItem.id === base.field);\n        if (currentField) {\n          base = {\n            ...currentField,\n            ...base,\n            placeholder: currentField.placeholder ?? base.placeholder,\n          };\n        }\n      } else if (field.type !== 'all') {\n        base = { ...base, ...field, field: field.id };\n      }\n\n      if (field.by) base.optionsBy = getDynamicOptions(field.by);\n      base.value = lValue[base.field];\n\n      return { type: 'text', filter: 'contains', ...base };\n    });\n  }\n\n  const filters = useMemo(\n    () => computeFilters(normalizedFields, lastField, lastValue),\n    [normalizedFields, lastField, lastValue],\n  );\n\n  function getRule(filter, valueObj) {\n    if (filter.field === 'all')\n      return createFilterRule(\n        filter.optionsBy,\n        'contains',\n        valueObj[filter.field],\n      );\n    const value = valueObj[filter.field];\n    if (!value) return null;\n\n    return {\n      field: filter.field,\n      filter: filter.filter,\n      type: filter.type,\n      value,\n    };\n  }\n\n  function getRules(valueObj) {\n    const rules = filters.map((f) => getRule(f, valueObj)).filter((a) => !!a);\n    if (rules.length === 1 && rules[0]?.glue === 'or') return rules[0];\n    return {\n      glue: 'and',\n      rules,\n    };\n  }\n\n  const timerRef = useRef(null);\n  function dispatchChange(delay, valueObj) {\n    if (timerRef.current) clearTimeout(timerRef.current);\n    timerRef.current = setTimeout(() => {\n      onChange && onChange({ value: getRules(valueObj) });\n    }, delay || debounce);\n  }\n\n  useEffect(() => {\n    if (originalValue.current && originalValue.current !== lastValue) {\n      dispatchChange(1, lastValue);\n    }\n  }, [lastValue]);\n\n  const updateValue = (value, field) => {\n    setLastValue((prev) => ({\n      ...prev,\n      [field]: value === '$empty' ? '' : value,\n    }));\n  };\n\n  const updateFiltersField = (value) => {\n    setLastValue((prev) => {\n      setLastField(value);\n      if (lastField) {\n        return { ...prev, [lastField]: '' };\n      }\n      return prev;\n    });\n  };\n\n  return (\n    <div className=\"wx-gWqAfosQ wx-filter-bar\">\n      {filters.map((filter, i) => (\n        <Fragment key={i}>\n          {filter.label ? (\n            <div className=\"wx-gWqAfosQ wx-label\">{filter.label}</div>\n          ) : null}\n\n          {filter.dynamicField ? (\n            <div className=\"wx-gWqAfosQ wx-select\">\n              <RichSelect\n                value={filter.field}\n                options={filter.optionsBy}\n                onChange={({ value }) => updateFiltersField(value, i)}\n              />\n            </div>\n          ) : null}\n\n          {filter.options ? (\n            <div className=\"wx-gWqAfosQ wx-select\">\n              <RichSelect\n                value={filter.value}\n                placeholder={\n                  filter.placeholder ?? `${_('filter by')} ${filter.field}`\n                }\n                options={filter.options}\n                onChange={({ value }) => updateValue(value, filter.field)}\n              />\n            </div>\n          ) : filter.type === 'text' || filter.type === 'number' ? (\n            <div className=\"wx-gWqAfosQ wx-text\">\n              <Text\n                value={filter.value}\n                placeholder={\n                  filter.placeholder ??\n                  `${_('filter by')} ${filter.field} (${_(filter.filter)})`\n                }\n                onChange={({ value, input }) => {\n                  if (input) updateValue(value, filter.field);\n                }}\n                type={filter.type}\n              />\n            </div>\n          ) : filter.type === 'date' ? (\n            <div className=\"wx-gWqAfosQ wx-date\">\n              {filter.filter === 'between' || filter.filter === 'notBetween' ? (\n                <DateRangePicker\n                  value={filter.value}\n                  format={f}\n                  buttons={['done', 'clear', 'today']}\n                  placeholder={\n                    filter.placeholder ??\n                    `${_('filter by')} ${filter.field} (${_(filter.filter)})`\n                  }\n                  onChange={({ value }) => updateValue(value, filter.field)}\n                />\n              ) : (\n                <DatePicker\n                  value={filter.value}\n                  format={f}\n                  placeholder={\n                    filter.placeholder ??\n                    `${_('filter by')} ${filter.field} (${_(filter.filter)})`\n                  }\n                  onChange={({ value }) => updateValue(value, filter.field)}\n                />\n              )}\n            </div>\n          ) : null}\n        </Fragment>\n      ))}\n    </div>\n  );\n}\n\nexport default Layout;\n","import { Locale } from '@svar-ui/react-core';\nimport { en } from '@svar-ui/filter-locales';\nimport Layout from './Layout.jsx';\n\nfunction FilterBar(props = {}) {\n  return (\n    <Locale words={en} optional={true}>\n      <Layout {...props} />\n    </Locale>\n  );\n}\n\nexport default FilterBar;\n","import { Material as CoreMaterial } from '@svar-ui/react-core';\nimport './Material.css';\n\nexport default function Material({ fonts = true, children }) {\n  if (children) {\n    return <CoreMaterial fonts={fonts}>{children}</CoreMaterial>;\n  } else {\n    return <CoreMaterial fonts={fonts} />;\n  }\n}\n","import { Willow as CoreWillow } from '@svar-ui/react-core';\nimport './Willow.css';\n\nfunction Willow({ fonts = true, children }) {\n  return children ? (\n    <CoreWillow fonts={fonts}>{children}</CoreWillow>\n  ) : (\n    <CoreWillow fonts={fonts} />\n  );\n}\n\nexport default Willow;\n","import { WillowDark as CoreWillowDark } from '@svar-ui/react-core';\nimport './WillowDark.css';\n\nexport default function WillowDark(props) {\n  const { fonts = true, children } = props;\n\n  if (children) {\n    return <CoreWillowDark fonts={fonts}>{children}</CoreWillowDark>;\n  } else {\n    return <CoreWillowDark fonts={fonts} />;\n  }\n}\n"],"names":["store","createContext","Layout","props","fields","fieldsSelector","fieldProp","buttons","optionsProp","includesProp","typeProp","filterProp","valueProp","formatProp","predicateProp","onApply","onCancel","onChange","locale","useContext","context","l","f","dateFormat","dateToString","_","ACTION_FIELD_CHANGE","ACTION_FILTER_CHANGE","ACTION_VALUE_CHANGE","ACTION_INCLUDES_CHANGE","ACTION_TYPE_CHANGE","ACTION_CHANGE","ACTION_OPTIONS_CHANGE","_filter","set_filter","useState","_filterRef","useRef","_field","set_field","_fieldRef","_type","set_type","_typeRef","_value","set_value","_valueRef","_includes","set_includes","_includesRef","_options","set_options","_optionsRef","set_format","_formatRef","set_predicate","_predicateRef","ready","setReady","providedOptions","setProvidedOptions","loadOptions","field","result","sRef","timerRef","arr2str","v","updateState","setter","ref","value","setState","signal","execSignal","runSignal","allSelected","setAllSelected","allSelectedRef","visibleValues","setVisibleValues","visibleValuesRef","setRule","ruleRef","rules","setRules","rulesRef","s","nextField","a","isDate","isTuple","nv","nextRules","getFilters","rule","r","getFilter","handler","vv","nextIncs","x","as","getRule","doApply","doCancel","toggleAll","nextAll","handleChange","ev","inputValue","next","changeValue","changeField","changeFilter","out","getLabel","getComboOptions","options","arr","op","inputRef","useEffect","el","inp","currOptions","jsx","jsxs","RichSelect","DateRangePicker","DatePicker","Text","Combo","option","Button","i","Checkbox","FilterEditor","Locale","en","Panel","type","includes","useMemo","filter","id","api","storeContext","useStore","useCallback","doChange","Rule","action","noChange","lRef","fRef","_format","groupRef","filterValue","setFilterValue","Fragment","React","Glue","mode","toggleGlue","List","group","onShowMenu","valueState","valueChanged","useStoreWithCounter","fieldsState","editorState","filters","cssType","groupCss","handlers","getField","rootRef","ruleBox","setRuleBox","ruleEditor","setRuleEditor","node","delegateClick","rootNode","cancel","Portal","Popup","i18nCtx","addFilter","data","newFilterOptions","now","c","o","selectNewFilter","menuOptions","item","menuRef","menuAction","DropDownMenu","ContextMenu","camelize","part","FilterBuilder","forwardRef","init","restProps","restPropsRef","dataStore","DataStore","writable","firstInRoute","lastInRouteRef","EventBusRouter","b","name","initOnceRef","useImperativeHandle","ContextStore","debounce","lastField","setLastField","lastValue","setLastValue","getFieldOptions","normalizeField","normalizeFieldsFn","fieldsArr","getDynamicOptions","normalizedFields","originalValue","values","newLastField","fItem","computeFilters","nFields","lField","lValue","base","currentField","valueObj","createFilterRule","getRules","dispatchChange","delay","updateValue","prev","updateFiltersField","input","FilterBar","Material","fonts","children","CoreMaterial","Willow","CoreWillow","WillowDark","CoreWillowDark"],"mappings":"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"}
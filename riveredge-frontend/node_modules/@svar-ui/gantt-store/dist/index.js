var Tt=new Date().valueOf(),ve=()=>Tt++;function nt(){return"temp://"+Tt++}var Wt=class{constructor(t){this._data=t,this._pool=new Map;for(let e=0;e<t.length;e++){const n=t[e];this._pool.set(n.id,n)}}add(t){t={id:ve(),...t},this._data.push(t),this._pool.set(t.id,t)}update(t,e){const n=this._data.findIndex(s=>s.id==t),a={...this._data[n],...e};this._data[n]=a,this._pool.set(a.id,a)}remove(t){this._data=this._data.filter(e=>e.id!=t),this._pool.delete(t)}filter(t){this._data=this._data.filter(e=>{const n=t(e);return n||this._pool.delete(e.id),n})}byId(t){return this._pool.get(t)}map(t){return this._data.map(t)}forEach(t){this._data.forEach(t)}},Se=class{constructor(t){const e={id:0,$level:0,data:[],parent:null},n=new Map;n.set(0,e),this._pool=n,t&&t.length&&this.parse(t,0)}parse(t,e){const n=this._pool;for(let s=0;s<t.length;s++){const r=t[s];r.parent=r.parent||e,r.data=null,n.set(r.id,r)}for(let s=0;s<t.length;s++){const r=t[s],i=n.get(r.parent);i&&(i.data||(i.data=[]),i.data.push(r))}const a=n.get(e);this.setLevel(a,a.$level+1,!1)}add(t,e){const n=this._pool.get(t.parent||0);t.$level=n.$level+1,this._pool.set(t.id,t),n.data?e===-1?n.data=[...n.data,t]:It(n,e,t):n.data=[t]}addAfter(t,e){if(!e)return this.add(t,-1);const n=this.byId(e),a=this.byId(n.parent),s=G(a,n.id)+1;t.parent=a.id,t.$level=a.$level+1,this.add(t,s)}remove(t){const e=this._pool.get(t);this._remove(e);const n=this._pool.get(e.parent);n.data=n.data.filter(a=>a.id!=t),this._clearBranch(n)}_remove(t){t.data&&t.data.forEach(e=>this._remove(e)),this._pool.delete(t.id)}update(t,e){let n=this._pool.get(t);const a=this._pool.get(n.parent),s=G(a,n.id);n={...n,...e},a&&s>=0&&(a.data[s]=n,a.data=[...a.data]),this._pool.set(n.id,n)}move(t,e,n){const a=this._pool.get(t),s=e==="child",r=this._pool.get(n),i=r.$level+(s?1:0);if(!a||!r)return;const o=this._pool.get(a.parent),c=s?r:this._pool.get(r.parent);c.data||(c.data=[]);const d=G(o,a.id);Me(o,d);const u=s?c.data.length:G(c,r.id)+(e==="after"?1:0);if(It(c,u,a),o.id===c.id&&d===u)return null;a.parent=c.id,a.$level!==i&&(a.$level=i,this.setLevel(a,i+1,!0)),this.update(a.id,a),this._clearBranch(o)}_clearBranch(t){t.data&&!t.data.length&&(t.open&&delete t.open,this.update(t.id,{data:null}))}toArray(){const t=[],e=this._pool.get(0).data;return e&&$t(e,t),t}byId(t){return this._pool.get(t)}getBranch(t){return this._pool.get(t).data}forEach(t){this._pool.forEach((e,n)=>{n!==0&&t(e)})}eachChild(t,e){const n=this.byId(e);!n||!n.data||n.data.forEach((a,s)=>{t(this.byId(a.id),s),this.eachChild(t,a.id)})}setLevel(t,e,n){t.data&&(t.data=t.data.map(a=>(n&&(a={...a},this._pool.set(a.id,a)),a.$level=e,a.data&&this.setLevel(a,e+1,n),a)))}};function $t(t,e){t.forEach(n=>{e.push(n),n.open===!0&&$t(n.data,e)})}function Me(t,e){const n=[...t.data];n.splice(e,1),t.data=n}function It(t,e,n){const a=[...t.data];a.splice(e,0,n),t.data=a}function G(t,e){return t?.data.findIndex(n=>n.id===e)}var Pt=2,De=class{constructor(t){t&&(this._writable=t.writable,this._async=t.async),this._values={},this._state={}}setState(t,e=0){const n={};return this._wrapProperties(t,this._state,this._values,"",n,e),n}getState(){return this._values}getReactive(){return this._state}_wrapProperties(t,e,n,a,s,r){for(const i in t){const o=e[i],c=n[i],d=t[i];if(o&&(c===d&&typeof d!="object"||d instanceof Date&&c instanceof Date&&c.getTime()===d.getTime()))continue;const u=a+(a?".":"")+i;o?(o.__parse(d,u,s,r)&&(n[i]=d),r&Pt?s[u]=o.__trigger:o.__trigger()):(d&&d.__reactive?e[i]=this._wrapNested(d,d,u,s):e[i]=this._wrapWritable(d),n[i]=d),s[u]=s[u]||null}}_wrapNested(t,e,n,a){const s=this._wrapWritable(t);return this._wrapProperties(t,s,e,n,a,0),s.__parse=(r,i,o,c)=>(this._wrapProperties(r,s,e,i,o,c),!1),s}_wrapWritable(t){const e=[],n=function(){for(let a=0;a<e.length;a++)e[a](t)};return{subscribe:a=>(e.push(a),this._async?setTimeout(a,1,t):a(t),()=>{const s=e.indexOf(a);s>=0&&e.splice(s,1)}),__trigger:()=>{e.length&&(this._async?setTimeout(n,1):n())},__parse:function(a){return t=a,!0}}}},Te=class{constructor(t,e,n,a){typeof t=="function"?this._setter=t:this._setter=t.setState.bind(t),this._routes=e,this._parsers=n,this._prev={},this._triggers=new Map,this._sources=new Map,this._routes.forEach(s=>{s.in.forEach(r=>{const i=this._triggers.get(r)||[];i.push(s),this._triggers.set(r,i)}),s.out.forEach(r=>{const i=this._sources.get(r)||{};s.in.forEach(o=>i[o]=!0),this._sources.set(r,i)})}),this._routes.forEach(s=>{s.length=Math.max(...s.in.map(r=>Ct(r,this._sources,1)))}),this._bus=a}init(t){const e={};for(const n in t)if(this._prev[n]!==t[n]){const a=this._parsers[n];e[n]=a?a(t[n]):t[n]}this._prev=this._prev?{...this._prev,...t}:{...t},this.setState(e),this._bus&&this._bus.exec("init-state",e)}setStateAsync(t){const e=this._setter(t,Pt);return this._async?Object.assign(this._async.signals,e):this._async={signals:e,timer:setTimeout(this._applyState.bind(this),1)},e}_applyState(){const t=this._async;if(t){this._async=null,this._triggerUpdates(t.signals,[]);for(const e in t.signals){const n=t.signals[e];n&&n()}}}setState(t,e=[]){const n=this._setter(t);return this._triggerUpdates(n,e),n}_triggerUpdates(t,e){const n=Object.keys(t),a=!e.length;e=e||[];for(let s=0;s<n.length;s++){const r=n[s],i=this._triggers.get(r);i&&i.forEach(o=>{e.indexOf(o)==-1&&e.push(o)})}a&&this._execNext(e)}_execNext(t){for(;t.length;){t.sort((n,a)=>n.length<a.length?1:-1);const e=t[t.length-1];t.splice(t.length-1),e.exec(t)}}};function Ct(t,e,n){const a=e.get(t);if(!a)return n;const s=Object.keys(a).map(r=>Ct(r,e,n+1));return Math.max(...s)}var We=class{constructor(){this._nextHandler=null,this._handlers={},this._tag=new WeakMap,this.exec=this.exec.bind(this)}on(t,e,n){let a=this._handlers[t];a?n&&n.intercept?a.unshift(e):a.push(e):a=this._handlers[t]=[e],n&&n.tag&&this._tag.set(e,n.tag)}intercept(t,e,n){this.on(t,e,{...n,intercept:!0})}detach(t){for(const e in this._handlers){const n=this._handlers[e];for(let a=n.length-1;a>=0;a--)this._tag.get(n[a])===t&&n.splice(a,1)}}async exec(t,e){const n=this._handlers[t];if(n)for(let a=0;a<n.length;a++){const s=n[a](e);if(s===!1||s&&s.then&&await s===!1)return}return this._nextHandler&&await this._nextHandler.exec(t,e),e}setNext(t){return this._nextHandler=t}};function $e(t,e){return typeof t=="string"?t.localeCompare(e,void 0,{numeric:!0}):typeof t=="object"?t.getTime()-e.getTime():(t??0)-(e??0)}function Ie(t,e){return typeof t=="string"?-t.localeCompare(e,void 0,{numeric:!0}):typeof e=="object"?e.getTime()-t.getTime():(e??0)-(t??0)}function Pe({key:t,order:e}){const n=e==="asc"?$e:Ie;return(a,s)=>n(a[t],s[t])}function Ce(t){if(!t||!t.length)return;const e=t.map(n=>Pe(n));return t.length===1?e[0]:function(n,a){for(let s=0;s<e.length;s++){const r=e[s](n,a);if(r!==0)return r}return 0}}function Ee(t,e){return t.sort(Ce(e))}class Oe extends Se{_sort;constructor(e){super(),this.parse(e,0)}parse(e,n){if(!e||!e.length)return;const a=e.map(s=>this.normalizeTask(s));super.parse(a,n),this._sort&&this.sortBranch(this._sort,n)}getBranch(e){const n=this._pool.get(e);return this._pool.get(n.parent||0).data}contains(e,n){const a=this._pool.get(e).data;let s=!1;if(a)for(let r=0;r<a.length;r++){if(a[r].id===n){s=!0;break}if(a[r].data&&(s=this.contains(a[r].id,n),s))break}return s}getIndexById(e){return this.getBranch(e).findIndex(n=>n.id===e)}add(e,n){const a=this.normalizeTask(e);return super.add(a,n),a}copy(e,n,a){const s=this.add({...e,id:null,data:null,parent:n},a);let r=[[e.id,s.id]];return e.data?.forEach((i,o)=>{const c=this.copy(i,s.id,o);r=r.concat(c)}),r}normalizeTask(e){const n=e.id||nt(),a=e.parent||0,s=e.text||"",r=e.type||"task",i=e.progress||0,o=e.details||"",c={...e,id:n,text:s,parent:a,progress:i,type:r,details:o};return e.segments&&(c.segments=e.segments.map(d=>({...d}))),e.segments&&(c.segments=e.segments.map(d=>({...d}))),c}getSummaryId(e,n=!1){const a=this._pool.get(e);if(!a.parent)return null;const s=this._pool.get(a.parent);if(n){let r=e,i=this.getSummaryId(r);const o=[];for(;i;)r=i,o.push(i),i=this.getSummaryId(r);return o}return s.type==="summary"?s.id:this.getSummaryId(s.id)}sort(e){this._sort=e,e&&this.sortBranch(e,0)}sortBranch(e,n){const a=this._pool.get(n||0).data;a&&(Ee(a,e),a.forEach(s=>{this.sortBranch(e,s.id)}))}serialize(){const e=[],n=this._pool.get(0).data;return n&&Et(n,e),e}clear(){this.forEach(e=>{this.remove(e.id)})}}function Et(t,e){t.forEach(n=>{e.push(n),n.data&&Et(n.data,e)})}function b(t){const e=Object.prototype.toString.call(t);return t instanceof Date||typeof t=="object"&&e==="[object Date]"?new t.constructor(+t):typeof t=="number"||e==="[object Number]"||typeof t=="string"||e==="[object String]"?new Date(t):new Date(NaN)}function D(t,e){return t instanceof Date?new t.constructor(e):new Date(e)}function R(t,e){const n=b(t);return isNaN(e)?D(t,NaN):(e&&n.setDate(n.getDate()+e),n)}function at(t,e){const n=b(t);if(isNaN(e))return D(t,NaN);if(!e)return n;const a=n.getDate(),s=D(t,n.getTime());s.setMonth(n.getMonth()+e+1,0);const r=s.getDate();return a>=r?s:(n.setFullYear(s.getFullYear(),s.getMonth(),a),n)}function Ot(t,e){const n=+b(t);return D(t,n+e)}const J=6048e5,He=864e5,Ht=6e4,Nt=36e5;function Ne(t,e){return Ot(t,e*Nt)}let Ye={};function F(){return Ye}function I(t,e){const n=F(),a=e?.weekStartsOn??e?.locale?.options?.weekStartsOn??n.weekStartsOn??n.locale?.options?.weekStartsOn??0,s=b(t),r=s.getDay(),i=(r<a?7:0)+r-a;return s.setDate(s.getDate()-i),s.setHours(0,0,0,0),s}function N(t){return I(t,{weekStartsOn:1})}function Yt(t){const e=b(t),n=e.getFullYear(),a=D(t,0);a.setFullYear(n+1,0,4),a.setHours(0,0,0,0);const s=N(a),r=D(t,0);r.setFullYear(n,0,4),r.setHours(0,0,0,0);const i=N(r);return e.getTime()>=s.getTime()?n+1:e.getTime()>=i.getTime()?n:n-1}function C(t){const e=b(t);return e.setHours(0,0,0,0),e}function V(t){const e=b(t),n=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return n.setUTCFullYear(e.getFullYear()),+t-+n}function st(t,e){const n=C(t),a=C(e),s=+n-V(n),r=+a-V(a);return Math.round((s-r)/He)}function rt(t){const e=Yt(t),n=D(t,0);return n.setFullYear(e,0,4),n.setHours(0,0,0,0),N(n)}function ze(t,e){return Ot(t,e*Ht)}function Ae(t,e){const n=e*3;return at(t,n)}function zt(t,e){const n=e*7;return R(t,n)}function Be(t,e){return at(t,e*12)}function q(t,e){const n=b(t),a=b(e),s=n.getTime()-a.getTime();return s<0?-1:s>0?1:s}function Fe(t,e){const n=C(t),a=C(e);return+n==+a}function qe(t){return t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]"}function Ue(t){if(!qe(t)&&typeof t!="number")return!1;const e=b(t);return!isNaN(Number(e))}function it(t,e){const n=N(t),a=N(e),s=+n-V(n),r=+a-V(a);return Math.round((s-r)/J)}function je(t,e){const n=b(t),a=b(e),s=n.getFullYear()-a.getFullYear(),r=n.getMonth()-a.getMonth();return s*12+r}function Le(t,e){const n=b(t),a=b(e);return n.getFullYear()-a.getFullYear()}function ot(t){return e=>{const n=(t?Math[t]:Math.trunc)(e);return n===0?0:n}}function At(t,e){return+b(t)-+b(e)}function Xe(t,e,n){const a=At(t,e)/Nt;return ot(n?.roundingMethod)(a)}function Qe(t,e,n){const a=At(t,e)/Ht;return ot(n?.roundingMethod)(a)}function Bt(t){const e=b(t);return e.setHours(23,59,59,999),e}function ct(t){const e=b(t),n=e.getMonth();return e.setFullYear(e.getFullYear(),n+1,0),e.setHours(23,59,59,999),e}function Ge(t){const e=b(t);return+Bt(e)==+ct(e)}function Ft(t,e){const n=b(t),a=b(e),s=q(n,a),r=Math.abs(je(n,a));let i;if(r<1)i=0;else{n.getMonth()===1&&n.getDate()>27&&n.setDate(30),n.setMonth(n.getMonth()-s*r);let o=q(n,a)===-s;Ge(b(t))&&r===1&&q(t,a)===1&&(o=!1),i=s*(r-Number(o))}return i===0?0:i}function Re(t,e,n){const a=Ft(t,e)/3;return ot(n?.roundingMethod)(a)}function Je(t,e){const n=b(t),a=b(e),s=q(n,a),r=Math.abs(Le(n,a));n.setFullYear(1584),a.setFullYear(1584);const i=q(n,a)===-s,o=s*(r-+i);return o===0?0:o}function U(t){const e=b(t),n=e.getMonth(),a=n-n%3;return e.setMonth(a,1),e.setHours(0,0,0,0),e}function qt(t){const e=b(t);return e.setDate(1),e.setHours(0,0,0,0),e}function Ve(t){const e=b(t),n=e.getFullYear();return e.setFullYear(n+1,0,0),e.setHours(23,59,59,999),e}function Ut(t){const e=b(t),n=D(t,0);return n.setFullYear(e.getFullYear(),0,1),n.setHours(0,0,0,0),n}function Ke(t){const e=b(t);return e.setMinutes(59,59,999),e}function Ze(t,e){const n=F(),a=e?.weekStartsOn??e?.locale?.options?.weekStartsOn??n.weekStartsOn??n.locale?.options?.weekStartsOn??0,s=b(t),r=s.getDay(),i=(r<a?-7:0)+6-(r-a);return s.setDate(s.getDate()+i),s.setHours(23,59,59,999),s}function dt(t){const e=b(t),n=e.getMonth(),a=n-n%3+3;return e.setMonth(a,0),e.setHours(23,59,59,999),e}const tn={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},en=(t,e,n)=>{let a;const s=tn[t];return typeof s=="string"?a=s:e===1?a=s.one:a=s.other.replace("{{count}}",e.toString()),n?.addSuffix?n.comparison&&n.comparison>0?"in "+a:a+" ago":a};function ut(t){return(e={})=>{const n=e.width?String(e.width):t.defaultWidth;return t.formats[n]||t.formats[t.defaultWidth]}}const nn={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},an={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},sn={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},rn={date:ut({formats:nn,defaultWidth:"full"}),time:ut({formats:an,defaultWidth:"full"}),dateTime:ut({formats:sn,defaultWidth:"full"})},on={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},cn=(t,e,n,a)=>on[t];function j(t){return(e,n)=>{const a=n?.context?String(n.context):"standalone";let s;if(a==="formatting"&&t.formattingValues){const i=t.defaultFormattingWidth||t.defaultWidth,o=n?.width?String(n.width):i;s=t.formattingValues[o]||t.formattingValues[i]}else{const i=t.defaultWidth,o=n?.width?String(n.width):t.defaultWidth;s=t.values[o]||t.values[i]}const r=t.argumentCallback?t.argumentCallback(e):e;return s[r]}}const dn={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},un={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},ln={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},hn={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},fn={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},mn={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},gn=(t,e)=>{const n=Number(t),a=n%100;if(a>20||a<10)switch(a%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},pn={ordinalNumber:gn,era:j({values:dn,defaultWidth:"wide"}),quarter:j({values:un,defaultWidth:"wide",argumentCallback:t=>t-1}),month:j({values:ln,defaultWidth:"wide"}),day:j({values:hn,defaultWidth:"wide"}),dayPeriod:j({values:fn,defaultWidth:"wide",formattingValues:mn,defaultFormattingWidth:"wide"})};function L(t){return(e,n={})=>{const a=n.width,s=a&&t.matchPatterns[a]||t.matchPatterns[t.defaultMatchWidth],r=e.match(s);if(!r)return null;const i=r[0],o=a&&t.parsePatterns[a]||t.parsePatterns[t.defaultParseWidth],c=Array.isArray(o)?kn(o,h=>h.test(i)):yn(o,h=>h.test(i));let d;d=t.valueCallback?t.valueCallback(c):c,d=n.valueCallback?n.valueCallback(d):d;const u=e.slice(i.length);return{value:d,rest:u}}}function yn(t,e){for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&e(t[n]))return n}function kn(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return n}function wn(t){return(e,n={})=>{const a=e.match(t.matchPattern);if(!a)return null;const s=a[0],r=e.match(t.parsePattern);if(!r)return null;let i=t.valueCallback?t.valueCallback(r[0]):r[0];i=n.valueCallback?n.valueCallback(i):i;const o=e.slice(s.length);return{value:i,rest:o}}}const bn=/^(\d+)(th|st|nd|rd)?/i,xn=/\d+/i,_n={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},vn={any:[/^b/i,/^(a|c)/i]},Sn={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Mn={any:[/1/i,/2/i,/3/i,/4/i]},Dn={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Tn={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Wn={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},$n={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},In={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Pn={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Cn={ordinalNumber:wn({matchPattern:bn,parsePattern:xn,valueCallback:t=>parseInt(t,10)}),era:L({matchPatterns:_n,defaultMatchWidth:"wide",parsePatterns:vn,defaultParseWidth:"any"}),quarter:L({matchPatterns:Sn,defaultMatchWidth:"wide",parsePatterns:Mn,defaultParseWidth:"any",valueCallback:t=>t+1}),month:L({matchPatterns:Dn,defaultMatchWidth:"wide",parsePatterns:Tn,defaultParseWidth:"any"}),day:L({matchPatterns:Wn,defaultMatchWidth:"wide",parsePatterns:$n,defaultParseWidth:"any"}),dayPeriod:L({matchPatterns:In,defaultMatchWidth:"any",parsePatterns:Pn,defaultParseWidth:"any"})},En={code:"en-US",formatDistance:en,formatLong:rn,formatRelative:cn,localize:pn,match:Cn,options:{weekStartsOn:0,firstWeekContainsDate:1}};function On(t){const e=b(t);return st(e,Ut(e))+1}function Hn(t){const e=b(t),n=+N(e)-+rt(e);return Math.round(n/J)+1}function jt(t,e){const n=b(t),a=n.getFullYear(),s=F(),r=e?.firstWeekContainsDate??e?.locale?.options?.firstWeekContainsDate??s.firstWeekContainsDate??s.locale?.options?.firstWeekContainsDate??1,i=D(t,0);i.setFullYear(a+1,0,r),i.setHours(0,0,0,0);const o=I(i,e),c=D(t,0);c.setFullYear(a,0,r),c.setHours(0,0,0,0);const d=I(c,e);return n.getTime()>=o.getTime()?a+1:n.getTime()>=d.getTime()?a:a-1}function Nn(t,e){const n=F(),a=e?.firstWeekContainsDate??e?.locale?.options?.firstWeekContainsDate??n.firstWeekContainsDate??n.locale?.options?.firstWeekContainsDate??1,s=jt(t,e),r=D(t,0);return r.setFullYear(s,0,a),r.setHours(0,0,0,0),I(r,e)}function Yn(t,e){const n=b(t),a=+I(n,e)-+Nn(n,e);return Math.round(a/J)+1}function x(t,e){const n=t<0?"-":"",a=Math.abs(t).toString().padStart(e,"0");return n+a}const P={y(t,e){const n=t.getFullYear(),a=n>0?n:1-n;return x(e==="yy"?a%100:a,e.length)},M(t,e){const n=t.getMonth();return e==="M"?String(n+1):x(n+1,2)},d(t,e){return x(t.getDate(),e.length)},a(t,e){const n=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];case"aaaa":default:return n==="am"?"a.m.":"p.m."}},h(t,e){return x(t.getHours()%12||12,e.length)},H(t,e){return x(t.getHours(),e.length)},m(t,e){return x(t.getMinutes(),e.length)},s(t,e){return x(t.getSeconds(),e.length)},S(t,e){const n=e.length,a=t.getMilliseconds(),s=Math.trunc(a*Math.pow(10,n-3));return x(s,e.length)}},Y={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Lt={G:function(t,e,n){const a=t.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return n.era(a,{width:"abbreviated"});case"GGGGG":return n.era(a,{width:"narrow"});case"GGGG":default:return n.era(a,{width:"wide"})}},y:function(t,e,n){if(e==="yo"){const a=t.getFullYear(),s=a>0?a:1-a;return n.ordinalNumber(s,{unit:"year"})}return P.y(t,e)},Y:function(t,e,n,a){const s=jt(t,a),r=s>0?s:1-s;if(e==="YY"){const i=r%100;return x(i,2)}return e==="Yo"?n.ordinalNumber(r,{unit:"year"}):x(r,e.length)},R:function(t,e){const n=Yt(t);return x(n,e.length)},u:function(t,e){const n=t.getFullYear();return x(n,e.length)},Q:function(t,e,n){const a=Math.ceil((t.getMonth()+1)/3);switch(e){case"Q":return String(a);case"QQ":return x(a,2);case"Qo":return n.ordinalNumber(a,{unit:"quarter"});case"QQQ":return n.quarter(a,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(a,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(a,{width:"wide",context:"formatting"})}},q:function(t,e,n){const a=Math.ceil((t.getMonth()+1)/3);switch(e){case"q":return String(a);case"qq":return x(a,2);case"qo":return n.ordinalNumber(a,{unit:"quarter"});case"qqq":return n.quarter(a,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(a,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(a,{width:"wide",context:"standalone"})}},M:function(t,e,n){const a=t.getMonth();switch(e){case"M":case"MM":return P.M(t,e);case"Mo":return n.ordinalNumber(a+1,{unit:"month"});case"MMM":return n.month(a,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(a,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(a,{width:"wide",context:"formatting"})}},L:function(t,e,n){const a=t.getMonth();switch(e){case"L":return String(a+1);case"LL":return x(a+1,2);case"Lo":return n.ordinalNumber(a+1,{unit:"month"});case"LLL":return n.month(a,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(a,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(a,{width:"wide",context:"standalone"})}},w:function(t,e,n,a){const s=Yn(t,a);return e==="wo"?n.ordinalNumber(s,{unit:"week"}):x(s,e.length)},I:function(t,e,n){const a=Hn(t);return e==="Io"?n.ordinalNumber(a,{unit:"week"}):x(a,e.length)},d:function(t,e,n){return e==="do"?n.ordinalNumber(t.getDate(),{unit:"date"}):P.d(t,e)},D:function(t,e,n){const a=On(t);return e==="Do"?n.ordinalNumber(a,{unit:"dayOfYear"}):x(a,e.length)},E:function(t,e,n){const a=t.getDay();switch(e){case"E":case"EE":case"EEE":return n.day(a,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(a,{width:"short",context:"formatting"});case"EEEE":default:return n.day(a,{width:"wide",context:"formatting"})}},e:function(t,e,n,a){const s=t.getDay(),r=(s-a.weekStartsOn+8)%7||7;switch(e){case"e":return String(r);case"ee":return x(r,2);case"eo":return n.ordinalNumber(r,{unit:"day"});case"eee":return n.day(s,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(s,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(s,{width:"short",context:"formatting"});case"eeee":default:return n.day(s,{width:"wide",context:"formatting"})}},c:function(t,e,n,a){const s=t.getDay(),r=(s-a.weekStartsOn+8)%7||7;switch(e){case"c":return String(r);case"cc":return x(r,e.length);case"co":return n.ordinalNumber(r,{unit:"day"});case"ccc":return n.day(s,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(s,{width:"narrow",context:"standalone"});case"cccccc":return n.day(s,{width:"short",context:"standalone"});case"cccc":default:return n.day(s,{width:"wide",context:"standalone"})}},i:function(t,e,n){const a=t.getDay(),s=a===0?7:a;switch(e){case"i":return String(s);case"ii":return x(s,e.length);case"io":return n.ordinalNumber(s,{unit:"day"});case"iii":return n.day(a,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(a,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(a,{width:"short",context:"formatting"});case"iiii":default:return n.day(a,{width:"wide",context:"formatting"})}},a:function(t,e,n){const a=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(a,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(a,{width:"wide",context:"formatting"})}},b:function(t,e,n){const a=t.getHours();let s;switch(a===12?s=Y.noon:a===0?s=Y.midnight:s=a/12>=1?"pm":"am",e){case"b":case"bb":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(s,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(s,{width:"wide",context:"formatting"})}},B:function(t,e,n){const a=t.getHours();let s;switch(a>=17?s=Y.evening:a>=12?s=Y.afternoon:a>=4?s=Y.morning:s=Y.night,e){case"B":case"BB":case"BBB":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(s,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(s,{width:"wide",context:"formatting"})}},h:function(t,e,n){if(e==="ho"){let a=t.getHours()%12;return a===0&&(a=12),n.ordinalNumber(a,{unit:"hour"})}return P.h(t,e)},H:function(t,e,n){return e==="Ho"?n.ordinalNumber(t.getHours(),{unit:"hour"}):P.H(t,e)},K:function(t,e,n){const a=t.getHours()%12;return e==="Ko"?n.ordinalNumber(a,{unit:"hour"}):x(a,e.length)},k:function(t,e,n){let a=t.getHours();return a===0&&(a=24),e==="ko"?n.ordinalNumber(a,{unit:"hour"}):x(a,e.length)},m:function(t,e,n){return e==="mo"?n.ordinalNumber(t.getMinutes(),{unit:"minute"}):P.m(t,e)},s:function(t,e,n){return e==="so"?n.ordinalNumber(t.getSeconds(),{unit:"second"}):P.s(t,e)},S:function(t,e){return P.S(t,e)},X:function(t,e,n){const a=t.getTimezoneOffset();if(a===0)return"Z";switch(e){case"X":return Qt(a);case"XXXX":case"XX":return E(a);case"XXXXX":case"XXX":default:return E(a,":")}},x:function(t,e,n){const a=t.getTimezoneOffset();switch(e){case"x":return Qt(a);case"xxxx":case"xx":return E(a);case"xxxxx":case"xxx":default:return E(a,":")}},O:function(t,e,n){const a=t.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+Xt(a,":");case"OOOO":default:return"GMT"+E(a,":")}},z:function(t,e,n){const a=t.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+Xt(a,":");case"zzzz":default:return"GMT"+E(a,":")}},t:function(t,e,n){const a=Math.trunc(t.getTime()/1e3);return x(a,e.length)},T:function(t,e,n){const a=t.getTime();return x(a,e.length)}};function Xt(t,e=""){const n=t>0?"-":"+",a=Math.abs(t),s=Math.trunc(a/60),r=a%60;return r===0?n+String(s):n+String(s)+e+x(r,2)}function Qt(t,e){return t%60===0?(t>0?"-":"+")+x(Math.abs(t)/60,2):E(t,e)}function E(t,e=""){const n=t>0?"-":"+",a=Math.abs(t),s=x(Math.trunc(a/60),2),r=x(a%60,2);return n+s+e+r}const Gt=(t,e)=>{switch(t){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},Rt=(t,e)=>{switch(t){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},zn=(t,e)=>{const n=t.match(/(P+)(p+)?/)||[],a=n[1],s=n[2];if(!s)return Gt(t,e);let r;switch(a){case"P":r=e.dateTime({width:"short"});break;case"PP":r=e.dateTime({width:"medium"});break;case"PPP":r=e.dateTime({width:"long"});break;case"PPPP":default:r=e.dateTime({width:"full"});break}return r.replace("{{date}}",Gt(a,e)).replace("{{time}}",Rt(s,e))},An={p:Rt,P:zn},Bn=/^D+$/,Fn=/^Y+$/,qn=["D","DD","YY","YYYY"];function Un(t){return Bn.test(t)}function jn(t){return Fn.test(t)}function Ln(t,e,n){const a=Xn(t,e,n);if(console.warn(a),qn.includes(t))throw new RangeError(a)}function Xn(t,e,n){const a=t[0]==="Y"?"years":"days of the month";return`Use \`${t.toLowerCase()}\` instead of \`${t}\` (in \`${e}\`) for formatting ${a} to the input \`${n}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const Qn=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Gn=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Rn=/^'([^]*?)'?$/,Jn=/''/g,Vn=/[a-zA-Z]/;function Kn(t,e,n){const a=F(),s=n?.locale??a.locale??En,r=n?.firstWeekContainsDate??n?.locale?.options?.firstWeekContainsDate??a.firstWeekContainsDate??a.locale?.options?.firstWeekContainsDate??1,i=n?.weekStartsOn??n?.locale?.options?.weekStartsOn??a.weekStartsOn??a.locale?.options?.weekStartsOn??0,o=b(t);if(!Ue(o))throw new RangeError("Invalid time value");let c=e.match(Gn).map(u=>{const h=u[0];if(h==="p"||h==="P"){const l=An[h];return l(u,s.formatLong)}return u}).join("").match(Qn).map(u=>{if(u==="''")return{isToken:!1,value:"'"};const h=u[0];if(h==="'")return{isToken:!1,value:Zn(u)};if(Lt[h])return{isToken:!0,value:u};if(h.match(Vn))throw new RangeError("Format string contains an unescaped latin alphabet character `"+h+"`");return{isToken:!1,value:u}});s.localize.preprocessor&&(c=s.localize.preprocessor(o,c));const d={firstWeekContainsDate:r,weekStartsOn:i,locale:s};return c.map(u=>{if(!u.isToken)return u.value;const h=u.value;(!n?.useAdditionalWeekYearTokens&&jn(h)||!n?.useAdditionalDayOfYearTokens&&Un(h))&&Ln(h,e,String(t));const l=Lt[h[0]];return l(o,h,s.localize,d)}).join("")}function Zn(t){const e=t.match(Rn);return e?e[1].replace(Jn,"'"):t}function Jt(t){const e=b(t),n=e.getFullYear(),a=e.getMonth(),s=D(t,0);return s.setFullYear(n,a+1,0),s.setHours(0,0,0,0),s.getDate()}function ta(t){const e=b(t).getFullYear();return e%400===0||e%4===0&&e%100!==0}function Vt(t){const e=b(t);return String(new Date(e))==="Invalid Date"?NaN:ta(e)?366:365}function ea(t){const e=rt(t),n=+rt(zt(e,60))-+e;return Math.round(n/J)}function z(t,e){const n=b(t),a=b(e);return+n==+a}function na(t){const e=b(t);return e.setMinutes(0,0,0),e}function aa(t,e,n){const a=I(t,n),s=I(e,n);return+a==+s}function sa(t,e){const n=b(t),a=b(e);return n.getFullYear()===a.getFullYear()&&n.getMonth()===a.getMonth()}function ra(t,e){const n=U(t),a=U(e);return+n==+a}function ia(t,e){const n=b(t),a=b(e);return n.getFullYear()===a.getFullYear()}const lt={year:Je,quarter:Re,month:Ft,week:it,day:st,hour:Xe,minute:Qe},O={year:{quarter:4,month:12,week:ea,day:oa,hour:ca},quarter:{month:3,week:da,day:Kt,hour:ua},month:{week:la,day:ha,hour:fa},week:{day:7,hour:24*7},day:{hour:24},hour:{minute:60}};function oa(t){return t?Vt(t):365}function ca(t){return Vt(t)*24}function da(t){const e=U(t),n=R(C(dt(t)),1);return it(n,e)}function Kt(t){if(t){const e=U(t),n=dt(t);return st(n,e)+1}return 91}function ua(t){return Kt(t)*24}function la(t){if(t){const e=qt(t),n=R(C(ct(t)),1);return it(n,e)}return 5}function ha(t){return t?Jt(t):30}function fa(t){return Jt(t)*24}function K(t,e,n){const a=O[t][e];return a?typeof a=="number"?a:a(n):1}function ma(t,e){return t===e||!!(O[t]&&O[t][e])}const Z={year:Be,quarter:Ae,month:at,week:zt,day:R,hour:Ne,minute:ze};function tt(t,e,n){if(e){if(t==="day")return(a,s)=>e.getWorkingDays(s,a,!0);if(t==="hour")return(a,s)=>e.getWorkingHours(s,a,!0)}return(a,s,r,i)=>{const o=O[t]?.[r];return!o||typeof o=="number"||ee(t,a,s,n)?X(t,a,s,r,i,n):ga(a,s,t,r,i,n)}}function X(t,e,n,a,s,r){const i=a||t;let o=n,c=e;if(s&&(o=$(i,n,r),c=$(i,e,r),c<e&&(c=T(i)(c,1))),t!==i){const d=lt[i](c,o),u=K(t,i,n);return d/u}else return lt[i](c,o)}function ga(t,e,n,a,s,r){let i=0;const o=$(n,e,r);if(e>o){const d=Z[n](o,1);i=X(n,d,e,a,void 0,r),e=d}let c=0;return ee(n,e,t,r)||(c=X(n,$(n,t,r),e,void 0,void 0,r),e=Z[n](e,c)),c+=i+X(n,t,e,a,void 0,r),!c&&s&&(c=X(n,t,e,a,s,r)),c}function T(t,e){if(e){if(t==="day")return(n,a)=>e.addWorkingDays(n,a,!0);if(t==="hour")return(n,a)=>e.addWorkingHours(n,a)}return Z[t]}const Zt={year:Ut,quarter:U,month:qt,week:(t,e)=>I(t,{weekStartsOn:e}),day:C,hour:na};function $(t,e,n){const a=Zt[t];return a?a(e,n):new Date(e)}const pa={year:Ve,quarter:dt,month:ct,week:(t,e)=>Ze(t,{weekStartsOn:e}),day:Bt,hour:Ke},te={year:ia,quarter:ra,month:sa,week:(t,e,n)=>aa(t,e,{weekStartsOn:n}),day:Fe};function ee(t,e,n,a){const s=te[t];return s?s(e,n,a):!1}const ya={start:Zt,end:pa,add:Z,isSame:te,diff:lt,smallerCount:O},ne=t=>typeof t=="function"?t(new Date):t;function ka(t,e){for(const n in e){if(n==="smallerCount"){const a=Object.keys(e[n]).sort((o,c)=>W.indexOf(o)-W.indexOf(c)).shift();let s=W.indexOf(a);const r=e[n][a],i=ne(r);for(let o=s-1;o>=0;o--){const c=W[o],d=ne(O[c][a]);if(i<=d)break;s=o}W.splice(s,0,t)}if(n==="biggerCount")for(const a in e[n])O[a][t]=e[n][a];else ya[n][t]=e[n]}}function ht(t,e=1,n){return n.isWorkingDay(t)||(t=e>0?n.getNextWorkingDay(t):n.getPreviousWorkingDay(t)),t}function wa(t){return(e,n)=>{if(n>0)for(let a=0;a<n;a++)e=t.getNextWorkingDay(e);if(n<0)for(let a=0;a>n;a--)e=t.getPreviousWorkingDay(e);return e}}function A(t){const e=new Date;return t.map(n=>({item:n,len:T(n.unit)(e,1)})).sort((n,a)=>n.len<a.len?-1:1)[0].item}const W=["year","quarter","month","week","day","hour"],ft=50,mt=300;function ba(t,e,n,a,s,r){const i=!t||n,o=!e||n;let c=t,d=e,u=!1,h=!1;(i||o)&&(s?.forEach(f=>{i&&(!c||f.start<=c)&&(c=f.start,u=!0);const g=f.type==="milestone"?f.start:f.end;o&&(!d||g>=d)&&(d=g,h=!0)}),r?.forEach(f=>{i&&(!c||f.start<=c)&&(c=f.start,u=!0),o&&(!d||f.start>=d)&&(d=f.start,h=!0)}));const l=T(a||"day");return c?u&&(c=l(c,-1)):d?c=l(d,-30):c=new Date,d?h&&(d=l(d,1)):d=l(c,30),{_start:c,_end:d}}function xa(t,e,n,a,s,r,i){const o=A(i).unit,c=tt(o,void 0,r),d=c(e,t,"",!0),u=$(o,e,r);t=$(o,t,r),e=u<e?T(o)(u,1):u;const h=d*a,l=s*i.length,f=i.map(m=>{const y=[],p=T(m.unit);let k=$(m.unit,t,r);for(;k<e;){const w=p(k,m.step),_=k<t?t:k,v=w>e?e:w,S=c(v,_,"",!0)*a,M=typeof m.format=="function"?m.format(k,w):m.format;let B="";m.css&&(B+=typeof m.css=="function"?m.css(k):m.css),y.push({width:S,value:M,date:_,css:B,unit:m.unit}),k=w}return{cells:y,add:p,height:s}});let g=a;return o!==n&&(g=g/K(o,n)),{rows:f,width:h,height:l,diff:c,start:t,end:e,lengthUnit:n,minUnit:o,lengthUnitWidth:g}}function _a(t,e,n,a){const s=typeof t=="boolean"?{}:t,r=W.indexOf(A(n).unit);if(typeof s.level>"u"&&(s.level=r),s.levels)s.levels.forEach(c=>{c.minCellWidth||(c.minCellWidth=et(s.minCellWidth,ft)),c.maxCellWidth||(c.maxCellWidth=et(s.maxCellWidth,mt))});else{const c=[],d=n.length||1,u=et(s.minCellWidth,ft),h=et(s.maxCellWidth,mt);n.forEach(l=>{l.format&&!e[l.unit]&&(e[l.unit]=l.format)}),W.forEach((l,f)=>{if(f===r)c.push({minCellWidth:u,maxCellWidth:h,scales:n});else{const g=[];if(f)for(let m=d-1;m>0;m--){const y=W[f-m];y&&g.push({unit:y,step:1,format:e[y]})}g.push({unit:l,step:1,format:e[l]}),c.push({minCellWidth:u,maxCellWidth:h,scales:g})}}),s.levels=c}s.levels[s.level]||(s.level=0);const i=s.levels[s.level],o=Math.min(Math.max(a,i.minCellWidth),i.maxCellWidth);return{zoom:s,scales:i.scales,cellWidth:o}}function va(t,e,n,a,s,r,i){t.level=n;let o;const c=a.scales||a,d=A(c).unit,u=Sa(d,s);if(e===-1){const f=K(d,s);o=i*f}else{const f=K(A(r).unit,d);o=Math.round(i/f)}const h=a.minCellWidth??ft,l=a.maxCellWidth??mt;return{scales:c,cellWidth:Math.min(l,Math.max(h,o)),lengthUnit:u,zoom:t}}function Sa(t,e){const n=W.indexOf(t),a=W.indexOf(e);return a>=n?t==="hour"?"hour":"day":W[a]}function et(t,e){return t??e}const gt=8,ae=4,Ma=3,se=7,Da=gt+ae;function re(t,e,n){(t.open||t.type!="summary")&&t.data?.forEach(a=>{typeof a.$x>"u"&&oe(a,n),a.$x+=e,re(a,e,n)})}function pt(t,e,n,a){const s=t.getSummaryId(e.id);if(s){const r=t.byId(s),i={xMin:1/0,xMax:0};a&&de(r,n),ie(r,i,n),r.$x=i.xMin,r.$w=i.xMax-i.xMin,pt(t,r,n)}}function ie(t,e,n){t.data?.forEach(a=>{if(!a.unscheduled){typeof a.$x>"u"&&oe(a,n);const s=a.type==="milestone"&&a.$h?a.$h/2:0;e.xMin>a.$x+s&&(e.xMin=a.$x+s);const r=a.$x+a.$w-s;e.xMax<r&&(e.xMax=r)}a.type!=="summary"&&ie(a,e,n)})}function oe(t,e){const{_scales:n,cellWidth:a}=e;t.$x=Math.round(n.diff(t.start,n.start,n.lengthUnit)*a),t.$w=Math.round(n.diff(t.end,t.start,n.lengthUnit,!0)*a)}function yt(t,e){let n;e&&(n=e.filter(s=>s.parent==t.id));const a={data:n,...t};if(a.data?.length)a.data.forEach(s=>{if(s.unscheduled&&!s.data)return;(e||s.type!="summary"&&s.data)&&(s.unscheduled&&(s={...s,start:void 0,end:void 0}),s=yt(s,e)),s.start&&(!a.start||a.start>s.start)&&(a.start=new Date(s.start));const r=s.end||s.start;r&&(!a.end||a.end<r)&&(a.end=new Date(r))});else if(t.type==="summary")throw Error("Summary tasks must have start and end dates if they have no subtasks");return a}function ce(t,e,n){return kt(t,e,n,!1),n.splitTasks&&t.segments?.forEach(a=>{ce(a,e,{...n,baselines:!1}),a.$x-=t.$x}),n.baselines&&kt(t,e,n,!0),t}function kt(t,e,n,a){const{cellWidth:s,cellHeight:r,_scales:i,baselines:o}=n,{start:c,end:d,lengthUnit:u,diff:h}=i,l=(a?"base_":"")+"start",f=(a?"base_":"")+"end",g="$x"+(a?"_base":""),m="$y"+(a?"_base":""),y="$w"+(a?"_base":""),p="$h"+(a?"_base":""),k="$skip"+(a?"_baseline":"");let w=t[l],_=t[f];if(a&&!w){t[k]=!0;return}t[l]<c&&(t[f]<c||z(t[f],c))?w=_=c:t[l]>d&&(w=_=d),t[g]=Math.round(h(w,c,u)*s),t[y]=Math.round(h(_,w,u,!0)*s),e!==null&&(t[m]=a?t.$y+t.$h+ae:r*e+Ma),t[p]=a?gt:o?r-se-Da:r-se,t.type==="milestone"&&(t[g]=t[g]-t.$h/2,t[y]=t.$h,a&&(t[m]=t.$y+gt,t[y]=t[p]=t.$h)),n.unscheduledTasks&&t.unscheduled&&!a?t.$skip=!0:t[k]=z(w,_)}function de(t,e,n){t.data&&!t.$skip&&(n=n||!t.open,t.data.forEach(a=>{n&&kt(a,null,e,!1),de(a,e,n)}))}function Ta(t,e){return!1}function Wa(t,e){}const wt=20,$a=function(t,e,n,a,s){const r=Math.round(a/2)-3;if(!e||!n||!e.$y||!n.$y||e.$skip||n.$skip)return t.$p="",t.$pl=0,t;let i=!1,o=!1;switch(t.type){case"e2s":o=!0;break;case"s2s":i=!0,o=!0;break;case"s2e":i=!0;break}const c=i?e.$x:e.$x+e.$w,d=s?e.$y-7:e.$y,u=o?n.$x:n.$x+n.$w,h=s?n.$y-7:n.$y;if(c!==u||d!==h){const l=Pa(c,d+r,u,h+r,i,o,a/2,s),f=Ca(u,h+r,o);t.$p=`${l},${f}`,t.$pl=Ia(t.$p)}return t};function Ia(t){const e=t.split(",").map(Number),n=[];for(let s=0;s<e.length;s+=2)s+1<e.length&&n.push([e[s],e[s+1]]);let a=0;for(let s=0;s<n.length-1;s++){const[r,i]=n[s],[o,c]=n[s+1];a+=Math.hypot(o-r,c-i)}return a}function Pa(t,e,n,a,s,r,i,o){const c=wt*(s?-1:1),d=wt*(r?-1:1),u=t+c,h=n+d,l=[t,e,u,e,0,0,0,0,h,a,n,a],f=h-u;let g=a-e;const m=r===s;return m||(h<=t+wt-2&&r||h>t&&!r)&&(g=o?g-i+6:g-i),m&&r&&u>h||m&&!r&&u<h?(l[4]=l[2]+f,l[5]=l[3],l[6]=l[4],l[7]=l[5]+g):(l[4]=l[2],l[5]=l[3]+g,l[6]=l[4]+f,l[7]=l[5]),l.join(",")}function Ca(t,e,n){return n?`${t-5},${e-3},${t-5},${e+3},${t},${e}`:`${t+5},${e+3},${t+5},${e-3},${t},${e}`}function Ea(t,e,n){if(e&&n){const a=n.x-e.x,s=n.y-e.y,r=(a>0?e.x:n.x)-t.left,i=(s>0?e.y:n.y)-t.top,o=`${a>0?0:-a},${s>0?0:-s},${a>0?a:0},${s>0?s:0}`;return{width:Math.abs(a),height:Math.abs(s),left:r,top:i,p:o}}else return null}function ue(t){return t.map(e=>{const n=e.id||nt();return{...e,id:n}})}const le=["start","end","duration"];function Oa(t,e){const{type:n,unscheduled:a}=t;return a||n==="summary"?!le.includes(e):n==="milestone"?!["end","duration"].includes(e):!0}function Ha(t,e){return typeof e=="function"?e:le.includes(t)?(typeof e=="string"&&(e={type:e,config:{}}),e.config||(e.config={}),e.type==="datepicker"&&(e.config.buttons=["today"]),(n,a)=>Oa(n,a.id)?e:null):e}function Na(t){return!t||!t.length?[]:t.map(e=>{const n=e.align||"left",a=e.id==="add-task",s=!a&&e.flexgrow?e.flexgrow:null,r=s?1:e.width||(a?50:120),i=e.editor&&Ha(e.id,e.editor);return{width:r,align:n,header:e.header,id:e.id,template:e.template,_template:e._template,...s&&{flexgrow:s},cell:e.cell,resize:e.resize??!0,sort:e.sort??!a,...i&&{editor:i},...e.options&&{options:e.options}}})}const Ya=[{id:"text",header:"Task name",flexgrow:1,sort:!0},{id:"start",header:"Start date",align:"center",sort:!0},{id:"duration",header:"Duration",width:100,align:"center",sort:!0},{id:"add-task",header:"Add task",width:50,align:"center",sort:!1,resize:!1}];function Q(t,e,n,a){const{selected:s,tasks:r}=t.getState(),i=s.length,o=["edit-task","paste-task","edit-task:task","edit-task:segment"],c=["copy-task","cut-task"],d=["copy-task","cut-task","delete-task","indent-task:remove","move-task:down"],u=["add-task","undo","redo"],h=["indent-task:add","move-task:down","move-task:up"],l={"indent-task:remove":2},f=!i&&u.includes(e),g={parent:h.includes(e),level:l[e]};if(n=n||(i?s[s.length-1]:null),!(!n&&!f)){if(e!=="paste-task"&&(t._temp=null),o.includes(e)||f||s.length===1)he(t,e,n,a);else if(i){const m=c.includes(e)?s:za(s,r,g);d.includes(e)&&m.reverse();const y=t.getHistory();y&&y.startBatch(),m.forEach((p,k)=>he(t,e,p,a,k)),y&&y.endBatch()}}}function za(t,e,n){let a=t.map(s=>{const r=e.byId(s);return{id:s,level:r.$level,parent:r.parent,index:e.getIndexById(s)}});return(n.parent||n.level)&&(a=a.filter(s=>n.level&&s.level<=n.level||!t.includes(s.parent))),a.sort((s,r)=>s.level-r.level||s.index-r.index),a.map(s=>s.id)}function he(t,e,n,a,s){const r=t.exec?t.exec:t.in.exec;let i=e.split(":")[0],o=e.split(":")[1];const c=n?.id||n;let d={id:c},u={},h=!1;if(i=="copy-task"||i=="cut-task"){t._temp||(t._temp=[]),t._temp.push({id:c,cut:i=="cut-task"});return}else if(i=="paste-task"){if(t._temp&&t._temp.length){const l=t.getHistory();l&&l.startBatch();const f=new Map;if(t._temp.forEach(g=>{const m={id:g.id,target:c,mode:"after"};r(g.cut?"move-task":"copy-task",m),f.set(g.id,m.id)}),!t._temp[0].cut){const{links:g}=t.getState(),m=t._temp.map(p=>p.id),y=[];g.forEach(p=>{m.includes(p.source)&&m.includes(p.target)&&y.push(p)}),y.forEach(p=>{r("add-link",{link:{source:f.get(p.source),target:f.get(p.target),type:p.type}})}),t._temp.forEach((p,k)=>{r("select-task",{id:f.get(p.id),toggle:!!k})})}l&&l.endBatch(),t._temp=null}return}else i==="add-task"?(u={task:{type:"task",text:a("New Task")},target:c,show:!0,select:!1},d={},h=!0):i==="edit-task"?(i="show-editor",o==="segment"&&typeof n=="object"&&(u=n)):i==="convert-task"?(i="update-task",u={task:{type:o}},o=void 0):i==="indent-task"&&(o=o==="add");if(i==="split-task"&&typeof n=="object")u=n;else if(i==="delete-task"&&o==="segment"&&typeof n=="object"){const l=t.getTask(c),{segmentIndex:f}=n,g=l.segments.filter((m,y)=>y!==f);r("update-task",{id:c,task:{segments:g}});return}typeof o<"u"&&(u={mode:o,...u}),d={...d,...u},r(i,d),h&&r("select-task",{id:d.id,toggle:!!s})}function fe(t,e){return t.some(n=>n.data?fe(n.data,e):n.id===e)}const me=(t,e)=>T(t,e),Aa=(t,e)=>tt(t,e);function ge(t,e){Array.isArray(t)&&(t.forEach(n=>H(n,e)),t.forEach(n=>{if(n.type==="summary"&&!(n.start&&n.end)){const{start:a,end:s}=yt(n,t);n.start=a,n.end=s,H(n,e)}}))}function H(t,e){t.unscheduled||pe(t,e,!1),t.base_start&&pe(t,e,!0)}function pe(t,e,n){const{calendar:a,durationUnit:s}=e,r=s||"day",[i,o,c]=ye(n);t.type==="milestone"?(t[c]=0,t[o]=void 0):t[i]&&(t[c]?t[o]=me(r,a)(t[i],t[c]):t[o]?t[c]=Aa(r,a)(t[o],t[i]):(t[o]=me(r,a)(t[i],1),t[c]=1))}function ye(t){return t?["base_start","base_end","base_duration"]:["start","end","duration"]}function ke(t,e,n){const[a,s,r]=ye(n);(e===r||e===a)&&(t[s]=null),e===s&&(t[r]=0,t[a]&&t[a]>=t[s]&&(t[s]=null,t[r]=1))}function Ba(t,e,n){ke(t,n,!1),t.base_start&&ke(t,n,!0),H(t,e)}class Fa extends De{in;_router;_modules=new Map;constructor(e){super({writable:e,async:!1}),this._router=new Te(super.setState.bind(this),[{in:["tasks","start","end","scales","autoScale","markers"],out:["_start","_end"],exec:s=>{const{_end:r,_start:i,start:o,end:c,tasks:d,scales:u,autoScale:h,markers:l}=this.getState();if(!o||!c||h){const f=A(u).unit,g=ba(o,c,h,f,d,l);(g._end!=r||g._start!=i)&&this.setState(g,s)}else this.setState({_start:o,_end:c},s)}},{in:["_start","_end","cellWidth","scaleHeight","scales","lengthUnit","_weekStart"],out:["_scales"],exec:s=>{const r=this.getState();let{lengthUnit:i}=r;const{_start:o,_end:c,cellWidth:d,scaleHeight:u,scales:h,_weekStart:l}=r,f=A(h).unit;ma(f,i)||(i=f);const g=xa(o,c,i,d,u,l,h);this.setState({_scales:g},s)}},{in:["_scales","tasks","cellHeight","baselines","unscheduledTasks"],out:["_tasks"],exec:s=>{const{cellWidth:r,cellHeight:i,tasks:o,_scales:c,baselines:d,splitTasks:u,unscheduledTasks:h}=this.getState(),l=o.toArray().map((f,g)=>ce(f,g,{cellWidth:r,cellHeight:i,_scales:c,baselines:d,splitTasks:u,unscheduledTasks:h}));this.setState({_tasks:l},s)}},{in:["_tasks","links","cellHeight"],out:["_links"],exec:s=>{const{tasks:r,links:i,cellHeight:o,baselines:c,criticalPath:d}=this.getState(),u=i.map(h=>{const l=r.byId(h.source),f=r.byId(h.target);return $a(h,l,f,o,c)}).toSorted((h,l)=>d?!!h.$critical==!!l.$critical?l.$pl-h.$pl:h.$critical?1:-1:l.$pl-h.$pl).filter(h=>h!==null);this.setState({_links:u},s)}},{in:["tasks","activeTask"],out:["_activeTask"],exec:s=>{const r=this.getState();let{activeTask:i}=r;i&&typeof i=="object"&&(i=i.id);const o=r.tasks.byId(i);this.setState({_activeTask:o||null},s)}},{in:["tasks","selected"],out:["_selected"],exec:s=>{const{tasks:r,selected:i}=this.getState(),o=i.map(c=>r.byId(c)).filter(c=>!!c);this.setState({_selected:o},s)}},{in:["start","end"],out:["cellWidth"],exec:s=>{const{_cellWidth:r,cellWidth:i}=this.getState();r!=i&&this.setState({cellWidth:r},s)}}],{tasks:s=>new Oe(s),links:s=>new Wt(s),columns:s=>Na(s)});const n=this.in=new We;n.on("show-editor",s=>{const{splitTasks:r}=this.getState();if(r){const{id:i,segmentIndex:o}=s;if(i&&(o||o===0)){this.setStateAsync({activeTask:{id:i,segmentIndex:o}});return}}this.setStateAsync({activeTask:s.id})}),n.on("select-task",({id:s,toggle:r,range:i,show:o,segmentIndex:c})=>{const{selected:d,_tasks:u,activeTask:h,splitTasks:l}=this.getState();let f=!1,g;if(d.length&&(r||i)){const y=[...d];if(i){const p=y[y.length-1],k=u.findIndex(M=>M.id==p),w=u.findIndex(M=>M.id==s),_=Math.min(k,w),v=Math.max(k,w)+1,S=u.slice(_,v).map(M=>M.id);k>w&&S.reverse(),S.forEach(M=>{y.includes(M)||y.push(M)})}else if(r){const p=y.findIndex(k=>k==s);p===-1?y.push(s):(f=!0,y.splice(p,1))}g=y}else g=[s];const m={selected:g};o&&g.length&&(m._scrollTask={id:g[0],mode:o}),this.setStateAsync(m),!f&&h&&(h!==s||l)&&n.exec("show-editor",{id:s,...l&&{segmentIndex:c}})}),n.on("delete-link",({id:s})=>{const{links:r}=this.getState();r.remove(s),this.setStateAsync({links:r})}),n.on("update-link",s=>{const{links:r}=this.getState(),i=s.id;let o=s.link;r.update(i,o),o=r.byId(i),!o.lag&&o.lag!==0&&delete o.lag,this.setStateAsync({links:r}),s.link=o}),n.on("add-link",s=>{const{link:r}=s,{links:i}=this.getState();!r.source||!r.target||(r.type||(r.type="e2s"),r.id=r.id||nt(),i.add(r),this.setStateAsync({links:i}),s.id=r.id,s.link=i.byId(r.id))});let a=null;n.on("move-task",s=>{const{tasks:r}=this.getState();let{mode:i,target:o}=s;const{id:c,inProgress:d}=s,u=r.byId(c);if(typeof d>"u"?s.source=u.parent:s.source=a=a??u.parent,d===!1){r.update(u.id,{$reorder:!1}),this.setState({tasks:r}),a=null;return}if(o===c||r.contains(c,o)){s.skipProvider=!0;return}if(i==="up"||i==="down"){const h=r.getBranch(c);let l=r.getIndexById(c);if(i==="up"){const f=u.parent===0;if(l===0&&f){s.skipProvider=!0;return}l-=1,i="before"}else if(i==="down"){const f=l===h.length-1,g=u.parent===0;if(f&&g){s.skipProvider=!0;return}l+=1,i="after"}if(o=h[l]&&h[l].id||u.parent,o){const f=r.getBranch(o);let g=r.getIndexById(o),m=f[g];if(m.data){if(i==="before"){if(m.parent===u.parent){for(;m.data;)m.open||n.exec("open-task",{id:m.id,mode:!0}),m=m.data[m.data.length-1];o=m.id}}else if(i==="after"){let k;m.parent===u.parent?(k=m,m=m.data[0],o=m.id,i="before"):f.length-1!==g&&(k=m,g+=1,m=f[g],u.$level>m.$level&&m.data?(k=m,m=m.data[0],o=m.id,i="before"):o=m.id),k&&!k.open&&n.exec("open-task",{id:k.id,mode:!0})}}const y=r.getSummaryId(u.id);r.move(c,i,o);const p=r.getSummaryId(c);y!=p&&(y&&this.resetSummaryDates(y,"move-task"),p&&this.resetSummaryDates(p,"move-task"))}}else{const h=r.byId(o);let l=h,f=!1;for(;l.$level>u.$level;)l=r.byId(l.parent),l.id===c&&(f=!0);if(f)return;const g=r.getSummaryId(u.id);if(r.move(c,i,o),i=="child"){let y=h;for(;y.id!==0&&!y.open;)n.exec("open-task",{id:y.id,mode:!0}),y=r.byId(y.parent)}const m=r.getSummaryId(c);g!=m&&(g&&this.resetSummaryDates(g,"move-task"),m&&this.resetSummaryDates(m,"move-task"))}d?this.setState({tasks:r}):this.setStateAsync({tasks:r}),s.target=o,s.mode=i}),n.on("drag-task",s=>{const r=this.getState(),{tasks:i,_tasks:o,_selected:c,_scales:d,cellWidth:u,cellHeight:h}=r,l=i.byId(s.id),{left:f,top:g,width:m,start:y,inProgress:p}=s,k={_tasks:o,_selected:c};if(typeof m<"u"&&(l.$w=m,pt(i,l,{_scales:d,cellWidth:u})),typeof f<"u"){if(l.type==="summary"){const w=f-l.$x;re(l,w,{_scales:d,cellWidth:u})}l.$x=f,pt(i,l,{_scales:d,cellWidth:u,cellHeight:h},!y)}typeof g<"u"&&(l.$y=g+4,l.$reorder=p),this.setState(k)}),n.on("update-task",s=>{const{id:r,segmentIndex:i,diff:o,eventSource:c}=s;let{task:d}=s;const{tasks:u,_scales:h,durationUnit:l,splitTasks:f,calendar:g}=this.getState(),m=u.byId(r),y={durationUnit:l,calendar:g};if(c==="add-task"||c==="copy-task"||c==="move-task"||c==="update-task"||c==="delete-task"||c==="provide-data"){H(d,y),u.update(r,d);return}const p=h.lengthUnit;let k=T(p);const w=tt(l,g);if(o&&(d.start&&(d.start=k(d.start,o)),!i&&i!==0&&(d.start&&d.end?d.duration=m.duration:(d.start?d.end=m.end:(d.end=k(d.end,o),d.start=m.start,d.duration=w(d.end,d.start)),w(d.end,d.start)||(d.duration=1)))),d.type=d.type??m.type,g&&d.start&&(d.start=ht(d.start,o,g)),d.start&&d.end&&(!z(d.start,m.start)||!z(d.end,m.end))&&d.type==="summary"&&m.data?.length){let v=o||w(d.start,m.start);g&&(v=d.start>m.start?w(d.start,m.start):-w(m.start,d.start),k=wa(g)),this.moveSummaryKids(m,S=>(S=k(S,v),g?ht(S,o,g):S),"update-task")}d.start||(d.start=m.start),!d.end&&!d.duration&&(d.duration=m.duration),H(d,y),u.update(r,d),(g&&d.type==="summary"||d.type==="summary"&&m.type!=="summary")&&this.resetSummaryDates(r,"update-task",!0);const _=u.getSummaryId(r);_&&this.resetSummaryDates(_,"update-task"),this.setStateAsync({tasks:u}),s.task=u.byId(r)}),n.on("add-task",s=>{const{tasks:r,_scales:i,unscheduledTasks:o,durationUnit:c,splitTasks:d,calendar:u}=this.getState(),{target:h,mode:l,task:f,show:g,select:m=!0}=s;!s.eventSource&&o&&(f.unscheduled=!0);let y=-1,p,k;if(h?(k=r.byId(h),l=="child"?(p=k,f.parent=p.id):(k.parent!==null&&(p=r.byId(k.parent),f.parent=p.id),y=r.getIndexById(h),l=="after"&&(y+=1))):f.parent&&(p=r.byId(f.parent)),!f.start){if(p?.start)f.start=new Date(p.start.valueOf());else if(k)f.start=new Date(k.start.valueOf());else{const S=r.getBranch(0);let M;if(S?.length){const B=S[S.length-1];if(!B.$skip){const Dt=new Date(B.start.valueOf());i.start<=Dt&&(M=Dt)}}f.start=M||T(c,u)(i.start,1)}f.duration=1}u&&(f.start=ht(f.start,1,u)),this.getState().baselines&&(f.base_start=f.start,f.base_duration=f.duration),H(f,{durationUnit:c,calendar:u});const w=r.add(f,y),_={tasks:r};if(p&&g){for(;p&&p.id;)n.exec("open-task",{id:p.id,mode:!0}),p=r.byId(p.parent);_._scrollTask={id:w.id,mode:g}}s.id=w.id;const v=r.getSummaryId(w.id);v&&this.resetSummaryDates(v,"add-task"),this.setStateAsync(_),s.id=w.id,s.task=w,m&&n.exec("select-task",{id:w.id})}),n.on("delete-task",s=>{const{id:r}=s,{tasks:i,links:o,selected:c}=this.getState();s.source=i.byId(r).parent;const d=i.getSummaryId(r),u=[r];i.eachChild(l=>u.push(l.id),r),o.filter(l=>!(u.includes(l.source)||u.includes(l.target)));const h={tasks:i,links:o};c.includes(r)&&(h.selected=c.filter(l=>l!==r)),i.remove(r),d&&this.resetSummaryDates(d,"delete-task"),this.setStateAsync(h)}),n.on("indent-task",({id:s,mode:r})=>{const{tasks:i}=this.getState();if(r){const o=i.getBranch(s)[i.getIndexById(s)-1];o&&n.exec("move-task",{id:s,mode:"child",target:o.id})}else{const o=i.byId(s),c=i.byId(o.parent);c&&c.parent!==null&&n.exec("move-task",{id:s,mode:"after",target:o.parent})}}),n.on("copy-task",s=>{const{id:r,target:i,mode:o,eventSource:c}=s;if(c==="copy-task")return;const{tasks:d,links:u}=this.getState();if(d.contains(r,i)){s.skipProvider=!0;return}const h=d.getSummaryId(r),l=d.getSummaryId(i);let f=d.getIndexById(i);o=="before"&&(f-=1);const g=d.byId(r),m=d.copy(g,d.byId(i).parent,f+1);s.source=s.id,s.id=m[0][1],g.lazy&&(s.lazy=!0),h!=l&&l&&this.resetSummaryDates(l,"copy-task");let y=[];for(let p=1;p<m.length;p++){const[k,w]=m[p];u.forEach(_=>{if(_.source===k){const v={..._};delete v.target,y.push({...v,source:w})}else if(_.target===k){const v={..._};delete v.source,y.push({...v,target:w})}})}y=y.reduce((p,k)=>{const w=p.findIndex(_=>_.id===k.id);return w>-1?p[w]={...p[w],...k}:p.push(k),p},[]);for(let p=1;p<m.length;p++){const[k,w]=m[p],_=d.byId(w);n.exec("copy-task",{source:k,id:w,lazy:!!_.lazy,eventSource:"copy-task",target:_.parent,mode:"child",skipUndo:!0})}y.forEach(p=>{n.exec("add-link",{link:{source:p.source,target:p.target,type:p.type},eventSource:"copy-task",skipUndo:!0})}),this.setStateAsync({tasks:d})}),n.on("open-task",({id:s,mode:r})=>{const{tasks:i}=this.getState(),o=i.byId(s);o.lazy?n.exec("request-data",{id:o.id}):(i.toArray().forEach(c=>c.$y=0),i.update(s,{open:r}),this.setState({tasks:i}))}),n.on("scroll-chart",({left:s,top:r})=>{if(!isNaN(s)){const i=this.calcScaleDate(s);this.setState({scrollLeft:s,_scaleDate:i})}isNaN(r)||this.setState({scrollTop:r})}),n.on("render-data",s=>{this.setState({area:s})}),n.on("provide-data",s=>{const{tasks:r,links:i,durationUnit:o,calendar:c,splitTasks:d}=this.getState(),u=r.byId(s.id);u.lazy?(u.lazy=!1,u.open=!0):u.data=[],ge(s.data.tasks,{durationUnit:o,calendar:c}),r.parse(s.data.tasks,s.id),u.type=="summary"&&this.resetSummaryDates(u.id,"provide-data"),this.setStateAsync({tasks:r,links:new Wt(i.map(h=>h).concat(ue(s.data.links)))})}),n.on("zoom-scale",({dir:s,offset:r})=>{const{zoom:i,cellWidth:o,_cellWidth:c,scrollLeft:d}=this.getState(),u=r+d,h=this.calcScaleDate(u);let l=o;s<0&&(l=c||o);const f=l+s*50,g=i.levels[i.level],m=s<0&&o>g.maxCellWidth;if(f<g.minCellWidth||f>g.maxCellWidth||m){if(!this.changeScale(i,s))return}else this.setState({cellWidth:f,_cellWidth:f});const{_scales:y,_start:p,cellWidth:k,_weekStart:w}=this.getState(),_=$(y.minUnit,p,w),v=y.diff(h,_,"hour");typeof r>"u"&&(r=k);let S=Math.round(v*k)-r;S<0&&(S=0),this.setState({scrollLeft:S,_scaleDate:h,_zoomOffset:r})}),n.on("expand-scale",({minWidth:s})=>{const{_start:r,_scales:i,start:o,end:c,_end:d,cellWidth:u,_scaleDate:h,_zoomOffset:l}=this.getState(),f=T(i.minUnit);let g=i.width;if(o&&c){if(g<s&&g){const w=s/g;this.setState({cellWidth:u*w})}return!0}let m=0;for(;g<s;)g+=u,m++;const y=m&&c?-m:0,p=o||f(r,y);let k=0;if(h){const w=i.diff(h,p,"hour");k=Math.max(0,Math.round(w*u)-(l||0))}this.setState({_start:p,_end:c||f(d,m),scrollLeft:k})}),n.on("sort-tasks",({key:s,order:r,add:i})=>{const o=this.getState(),{tasks:c}=o;let d=o._sort;const u={key:s,order:r};let h=d?.length||0;h&&i?(d.forEach((l,f)=>{l.key===s&&(h=f)}),d[h]=u):d=[u],c.sort(d),this.setState({_sort:d,tasks:c})}),n.on("hotkey",({key:s,event:r,eventSource:i})=>{switch(s){case"arrowup":case"arrowdown":{const{selected:o,_tasks:c}=this.getState();r.preventDefault();const d=o.length;let u;if(s==="arrowup"?u=d?this.getPrevRow(o[d-1])?.id:c[c.length-1]?.id:u=d?this.getNextRow(o[d-1])?.id:c[0]?.id,u){const h=i==="chart"?"xy":!0;this.in.exec("select-task",{id:u,show:h})}break}case"ctrl+c":{Q(this,"copy-task",null,null);break}case"ctrl+x":{Q(this,"cut-task",null,null);break}case"ctrl+v":{Q(this,"paste-task",null,null);break}case"ctrl+d":case"backspace":{r.preventDefault(),Q(this,"delete-task",null,null);break}case"ctrl+z":{this.in.exec("undo",{});break}case"ctrl+y":{this.in.exec("redo",{});break}}})}init(e){const n=this.getState().area?{}:{scrollLeft:0,scrollTop:0,area:{from:0,start:0,end:0}};e.cellWidth&&(e._cellWidth=e.cellWidth),e._sort=null,e.unscheduledTasks=!1,e.baselines=!1,e.markers=[],e._markers=[],e.undo=!1,e.schedule={},e.criticalPath=null,e.splitTasks=!1,e.summary={},Array.isArray(e.tasks)&&this.getHistory()?.resetHistory(),this._router.init({_scrollTask:null,selected:[],markers:[],autoScale:!0,durationUnit:"day",...n,...e})}setState(e,n){return this._router.setState(e,n)}setStateAsync(e){this._router.setStateAsync(e)}getTask(e){const{tasks:n}=this.getState();return n.byId(e)}getHistory(){return this.getState().undo?this._modules.get("historyManager"):null}serialize(){return this.getState().tasks.serialize()}changeScale(e,n){const a=e.level+n,s=e.levels[a];if(s){const{cellWidth:r,scales:i,_scales:o}=this.getState(),c=va(e,n,a,s,o.lengthUnit,i,r);return c._cellWidth=c.cellWidth,this.setState(c),!0}return!1}isScheduled(e){return this.getState().unscheduledTasks?e.some(n=>!n.unscheduled||n.data&&this.isScheduled(n.data)):!0}resetSummaryDates(e,n,a){const{tasks:s,durationUnit:r,splitTasks:i,calendar:o}=this.getState(),c=s.byId(e),d=c.data;if(d?.length&&this.isScheduled(d)){const u=yt({...c,start:void 0,end:void 0,duration:void 0});if(!z(c.start,u.start)||!z(c.end,u.end)){a?(H(u,{durationUnit:r,calendar:o}),s.update(e,u)):this.in.exec("update-task",{id:e,task:u,eventSource:n,skipUndo:!0});const h=s.getSummaryId(e);h&&this.resetSummaryDates(h,n)}}}moveSummaryKids(e,n,a){const{tasks:s}=this.getState();e.data.forEach(r=>{const i={...s.byId(r.id),start:n(r.start)};delete i.end,delete i.id,this.in.exec("update-task",{id:r.id,task:i,eventSource:a,skipUndo:!0}),r.data?.length&&this.moveSummaryKids(r,n,a)})}calcScaleDate(e){const{_scales:n,_start:a,_weekStart:s}=this.getState(),r=n.lengthUnit==="day"?n.lengthUnitWidth/24:n.lengthUnitWidth;return T("hour")($(n.minUnit,a,s),Math.floor(e/r))}getNextRow(e){const n=this.getState()._tasks,a=n.findIndex(s=>s.id==e);return n[a+1]}getPrevRow(e){const n=this.getState()._tasks,a=n.findIndex(s=>s.id==e);return n[a-1]}}function qa(t,e,n,a){if(typeof document>"u")return"";const s=document.createElement("canvas");{const r=Ua(s,t,e,1,n);ja(r,a,0,t,0,e)}return s.toDataURL()}function Ua(t,e,n,a,s){t.setAttribute("width",(e*a).toString()),t.setAttribute("height",(n*a).toString());const r=t.getContext("2d");return r.translate(-.5,-.5),r.strokeStyle=s,r}function ja(t,e,n,a,s,r){t.beginPath(),t.moveTo(a,s),t.lineTo(a,r),e==="full"&&t.lineTo(n,r),t.stroke()}const bt=[{id:"task",label:"Task"},{id:"summary",label:"Summary task"},{id:"milestone",label:"Milestone"}];function La(t){let e=[...be];const n=t?.taskTypes||bt,a=e.find(s=>s.id=="convert-task");return a.data=[],n.forEach(s=>{(!t?.summary?.autoConvert||s.id!=="summary")&&a.data.push(a.dataFactory(s))}),e}function xt(t){return t.map(e=>{switch(e.data&&xt(e.data),e.id){case"add-task:before":case"move-task:up":e.isDisabled=(n,a)=>Qa(n,a);break;case"move-task:down":e.isDisabled=(n,a)=>Ga(n,a);break;case"indent-task:add":e.isDisabled=(n,a)=>Ra(n,a)===n.parent;break;case"indent-task:remove":e.isDisabled=n=>Xa(n);break}return e})}function Xa(t){return t.parent===0}function Qa(t,e){const{_tasks:n}=e;return n[0]?.id===t.id}function Ga(t,e){const{_tasks:n}=e;return n[n.length-1]?.id===t.id}function Ra(t,e){const{_tasks:n}=e,a=n.findIndex(s=>s.id===t.id);return n[a-1]?.id??t.parent}function we(t){return t&&typeof t=="object"}function Ja(t){return!t.selected||t.selected.length<2}const Va=t=>e=>e.type===t,be=xt([{id:"add-task",text:"Add",icon:"wxi-plus",data:[{id:"add-task:child",text:"Child task"},{id:"add-task:before",text:"Task above"},{id:"add-task:after",text:"Task below"}]},{type:"separator"},{id:"convert-task",text:"Convert to",icon:"wxi-swap-horizontal",dataFactory:t=>({id:`convert-task:${t.id}`,text:`${t.label}`,isDisabled:Va(t.id)})},{id:"edit-task",text:"Edit",icon:"wxi-edit",isHidden:(t,e,n)=>we(n)},{type:"separator"},{id:"cut-task",text:"Cut",icon:"wxi-content-cut",subtext:"Ctrl+X"},{id:"copy-task",text:"Copy",icon:"wxi-content-copy",subtext:"Ctrl+C"},{id:"paste-task",text:"Paste",icon:"wxi-content-paste",subtext:"Ctrl+V"},{id:"move-task",text:"Move",icon:"wxi-swap-vertical",data:[{id:"move-task:up",text:"Up"},{id:"move-task:down",text:"Down"}]},{type:"separator"},{id:"indent-task:add",text:"Indent",icon:"wxi-indent"},{id:"indent-task:remove",text:"Outdent",icon:"wxi-unindent"},{type:"separator"},{id:"delete-task",icon:"wxi-delete",text:"Delete",subtext:"Ctrl+D / BS",isHidden:(t,e,n)=>Ja(e)&&we(n)}]);function Ka(t){return[...xe]}const xe=xt([{id:"add-task",comp:"button",icon:"wxi-plus",text:"New task",type:"primary"},{id:"edit-task",comp:"icon",icon:"wxi-edit",menuText:"Edit",text:"Ctrl+E"},{id:"delete-task",comp:"icon",icon:"wxi-delete",menuText:"Delete",text:"Ctrl+D, Backspace"},{comp:"separator"},{id:"move-task:up",comp:"icon",icon:"wxi-angle-up",menuText:"Move up"},{id:"move-task:down",comp:"icon",icon:"wxi-angle-down",menuText:"Move down"},{comp:"separator"},{id:"copy-task",comp:"icon",icon:"wxi-content-copy",menuText:"Copy",text:"Ctrl+V"},{id:"cut-task",comp:"icon",icon:"wxi-content-cut",menuText:"Cut",text:"Ctrl+X"},{id:"paste-task",comp:"icon",icon:"wxi-content-paste",menuText:"Paste",text:"Ctrl+V"},{comp:"separator"},{id:"indent-task:add",comp:"icon",icon:"wxi-indent",menuText:"Indent"},{id:"indent-task:remove",comp:"icon",icon:"wxi-unindent",menuText:"Outdent"}]);function _t(t){return t.type==="summary"}function vt(t){return t.type==="milestone"}function St(t){return typeof t.parent>"u"}function Mt(t,e){return e.unscheduledTasks&&t.unscheduled}function Za(t){const e=_e.map(a=>({...a})),n=e.find(a=>a.key=="type");return n.options=t?.taskTypes||bt,e}const _e=[{key:"text",comp:"text",label:"Name",config:{placeholder:"Add task name"}},{key:"details",comp:"textarea",label:"Description",config:{placeholder:"Add description"}},{key:"type",comp:"select",label:"Type",isHidden:t=>St(t)},{key:"start",comp:"date",label:"Start date",isHidden:t=>_t(t),isDisabled:Mt},{key:"end",comp:"date",label:"End date",isHidden:t=>_t(t)||vt(t),isDisabled:Mt},{key:"duration",comp:"counter",label:"Duration",config:{min:1},isHidden:t=>_t(t)||vt(t),isDisabled:Mt},{key:"progress",comp:"slider",label:"Progress",config:{min:1,max:100},isHidden:t=>vt(t)||St(t)},{key:"links",comp:"links",label:"",isHidden:t=>St(t)}];export{Fa as DataStore,Ya as defaultColumns,_e as defaultEditorItems,be as defaultMenuOptions,bt as defaultTaskTypes,xe as defaultToolbarButtons,Wa as extendDragOptions,Kn as format,T as getAdder,tt as getDiffer,Za as getEditorItems,La as getMenuOptions,Ka as getToolbarButtons,$ as getUnitStart,qa as grid,Q as handleAction,fe as isHandledAction,Ta as isSegmentMoveAllowed,ue as normalizeLinks,_a as normalizeZoom,ge as parseTaskDates,Ea as placeLink,Ba as prepareEditTask,ka as registerScaleUnit};

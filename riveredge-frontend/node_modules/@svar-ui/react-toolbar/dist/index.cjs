"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const t=require("react/jsx-runtime"),o=require("react"),R=require("@svar-ui/react-core"),D=require("@svar-ui/lib-dom"),P=require("@svar-ui/lib-react"),E={};function H(n){return E[n]||n}function g(n,e){E[n]=e}function O({menu:n=!1}){return t.jsx("div",{className:`wx-z1qpqrvg wx-separator${n?"-menu":""}`,children:"Â "})}function z(){return t.jsx("div",{className:"wx-1IhFzpJV wx-spacer"})}const K=({key:n,text:e,...s})=>s;function V(n){const{item:e={},menu:s=!1,values:l,onClick:u,onChange:i}=n,w=o.useMemo(()=>H(e.comp||"label"),[e]),f=o.useCallback(()=>{e&&e.handler&&e.handler(e),u&&u({item:e})},[e,u]),v=o.useMemo(()=>e&&e.key&&l?l[e.key]:void 0,[e,l]),j=o.useCallback(({value:d})=>{e&&e.handler&&e.handler(e,d),i&&i({value:d,item:e})},[e,i]),h=o.useMemo(()=>s?e?e.menuText||e.text:void 0:e?e.text:void 0,[s,e]);if(e&&e.comp=="spacer")return t.jsx(z,{});if(e&&e.comp=="separator")return t.jsx(O,{menu:s});{const d=w,x=["wx-tb-element",e&&e.css?e.css:"",e&&e.spacer?"wx-spacer":"",s?"wx-menu":""].filter(Boolean).join(" ");return t.jsx("div",{className:"wx-KVAsgMam "+x,"data-id":e?e.id:void 0,children:t.jsx(d,{value:v,onChange:j,onClick:f,text:h,menu:s,...K(e)})})}}function I({item:n,values:e=null,menu:s=!1,onChange:l,onClick:u}){const[i,w]=o.useState(!0),f=()=>w(!0),v=()=>w(!1),j=d=>{f(),u&&u(d)},h=["wx-wSVFAGym","wx-tb-group",n.css||"",n.layout=="column"?"wx-column":"",n.collapsed&&!s?"wx-group-collapsed":""].filter(Boolean).join(" ");return t.jsx("div",{className:h,children:n.collapsed&&!s?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"wx-wSVFAGym wx-collapsed",onClick:v,children:[n.icon?t.jsx("i",{className:`wx-wSVFAGym icon ${n.icon}`}):null,n.text?t.jsx("div",{className:"wx-wSVFAGym wx-label-text",children:n.text}):null,n.text&&!n.icon?t.jsx("i",{className:"wx-wSVFAGym wx-label-arrow wxi-angle-down"}):null]}),i?null:t.jsx(R.Dropdown,{width:"",oncancel:f,children:t.jsx("div",{className:"wx-wSVFAGym wx-drop-group",children:t.jsx(I,{item:{...n,text:"",collapsed:!1},values:e,menu:s,onChange:l,onClick:j})})})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"wx-wSVFAGym wx-tb-body",children:n.items.map((d,x)=>d.items?t.jsx(I,{item:d,values:e,onClick:j,onChange:l},d.id||x):t.jsx(V,{item:d,values:e,onClick:j,onChange:l},d.id||x))}),n.text?t.jsx("div",{className:"wx-wSVFAGym wx-label",children:n.text}):null]})})}function U({items:n=[],css:e,values:s,width:l,onClick:u,onChange:i}){const[w,f]=o.useState(void 0),v=o.useRef(null);function j(){f(null)}function h(){f(!0)}function d(x){j(),u&&u(x)}return t.jsxs("div",{className:`wx-Yo6BuX0p wx-menu ${e||""}`,ref:v,"data-id":"$menu",children:[t.jsx(R.Button,{icon:"wxi-dots-h",onClick:h}),w?t.jsx(R.Dropdown,{width:`${l}px`,onCancel:j,children:t.jsx("div",{className:"wx-Yo6BuX0p wx-drop-menu",children:n.map((x,b)=>x.items?t.jsx(I,{item:x,values:s,menu:!0,onClick:d,onChange:i},x.id||b):t.jsx(V,{item:x,values:s,menu:!0,onClick:d,onChange:i},x.id||b))})}):null]})}function Z(n){return n.forEach(e=>{e.id||(e.id=D.uid())}),n}function L(n){const{items:e,menuCss:s="",css:l="",values:u,overflow:i="menu",onClick:w,onChange:f}=n,[v,j]=P.useWritableProp(e||[]),[h,d]=P.useWritableProp(u||null),x=o.useMemo(()=>Z(v),[v]),b=o.useRef(null),W=o.useRef(-1),[N,B]=o.useState([]),k=o.useRef(x);o.useEffect(()=>{k.current=x},[v]);const F=o.useRef(i);o.useEffect(()=>{F.current=i},[i]);const T=o.useRef(N);o.useEffect(()=>{T.current=N},[N]);const G=o.useRef(!1);function M(r){h&&(h[r.item.key]=r.value,d({...h})),f&&f(r)}function J(){const r=b.current;if(!r)return 0;const a=r.children,c=k.current||[];let m=0;for(let y=0;y<c.length;y++)c[y].comp!=="spacer"&&(m+=a[y].clientWidth,c[y].comp==="separator"&&(m+=8));return m}function X(){const r=b.current,a=k.current||[];if(r){for(let c=a.length-1;c>=0;c--)if(a[c].items&&!a[c].collapsed){a[c].collapsed=!0,a[c].$width=r.children[c].offsetWidth,G.current=!0,j([...a]);return}}}function Y(r){const a=b.current,c=k.current||[];if(a){for(let m=0;m<c.length;m++)if(c[m].collapsed&&c[m].$width){c[m].$width-a.children[m].offsetWidth<r+10&&(c[m].collapsed=!1,G.current=!0),j([...c]);return}}}function q(){const r=b.current;if(!r)return;const a=k.current||[],c=F.current;if(c==="wrap")return;const m=r.clientWidth;if(r.scrollWidth>m){if(c==="collapse")return X();const C=r.children;let S=0;for(let p=0;p<a.length;p++){if(S+=C[p].clientWidth,a[p].comp==="separator"&&(S+=8),S>m-40){if(W.current===p)return;W.current=p;const A=[];for(let $=p;$<a.length;$++)A.push(a[$]),C[$].style.visibility="hidden";p>0&&a[p-1].comp==="separator"&&(C[p-1].style.visibility="hidden"),B(A);break}C[p].style.visibility=""}}else{const C=m-J();if(C<=0)return;if(c==="collapse")return Y(C);if((T.current||[]).length){W.current=null;const S=r.children;for(let p=0;p<a.length;p++)S[p].style.visibility="";B([])}}}return o.useEffect(()=>{G.current&&(G.current=!1,q())},[v]),o.useEffect(()=>{const r=new ResizeObserver(()=>q());return b.current&&r.observe(b.current),()=>{r.disconnect()}},[]),t.jsxs("div",{className:`wx-VdPSJj8y wx-toolbar ${l||""} ${i==="wrap"?"wx-wrap":""}`,ref:b,children:[x.map(r=>r.items?t.jsx(I,{item:r,values:h,onClick:w,onChange:M},r.id):t.jsx(V,{item:r,values:h,onClick:w,onChange:M},r.id)),!!N.length&&t.jsx(U,{items:N,css:s,values:h,onClick:w,onChange:M})]})}function Q(n){const{icon:e,text:s="",css:l,type:u,disabled:i,menu:w,onClick:f}=n;return w?t.jsxs("div",{className:"wx-HXpG4gnx wx-item",onClick:f,children:[t.jsx("i",{className:`wx-HXpG4gnx ${e||"wxi-empty"} ${l||""}`}),s]}):t.jsx(R.Button,{icon:e,type:u,css:l,text:s,disabled:i,onClick:f})}function _(n){const{text:e,value:s,children:l}=n;return l?t.jsx("div",{className:"wx-PTEZGYcj wx-label",children:l()}):t.jsx("div",{className:"wx-PTEZGYcj wx-label",children:s||e})}function ee(n){const{icon:e,text:s,css:l,type:u,disabled:i,menu:w,onClick:f}=n;return w?t.jsxs("div",{className:"wx-3cuSqONJ wx-item",onClick:f,children:[e?t.jsx("i",{className:`wx-3cuSqONJ ${e||""} ${l||""}`}):null,s]}):t.jsx(R.Button,{icon:e,type:u,css:l,title:s,disabled:i,onClick:f})}function te({id:n="",text:e="",css:s="",icon:l="",onClick:u}){function i(){u&&u({id:n})}return t.jsxs("div",{className:`wx-U0Bx7pIR wx-label ${s}`,onClick:i,children:[l?t.jsx("i",{className:"wx-U0Bx7pIR "+l}):null,e]})}g("button",Q);g("separator",O);g("spacer",z);g("label",_);g("item",te);g("icon",ee);exports.Toolbar=L;exports.registerToolbarItem=g;
//# sourceMappingURL=index.cjs.map

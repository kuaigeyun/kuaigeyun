"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const n=require("react/jsx-runtime"),t=require("react"),O=require("@svar-ui/lib-dom"),E=require("@svar-ui/react-core");function L(r,u){return r.map(e=>{const s=u(e);return e.data&&e.data.length&&(s.data=L(e.data,u)),s})}function $(r,u){const e=[];return r.forEach(s=>{if(s.data){const c=$(s.data,u);c.length&&e.push({...s,data:c})}else u(s)&&e.push(s)}),e}let Z=1;function q(r){return L(r,u=>{const e={...u,id:u.id||Z++};return e.type&&(e.comp=e.type),e})}const H={};function F(r){return H[r]||r}function Q(r,u){H[r]=u}function X({onClick:r,onShow:u,option:e}){const s=t.useRef(null),c=t.useCallback(()=>{u(e.data?e.id:!1,s.current)},[u,e]),x=t.useMemo(()=>e&&e.comp?F(e.comp):null,[e]);return n.jsxs("div",{ref:s,className:`wx-cDCz9rZQ wx-option ${e.css||""} ${e.disabled?"wx-disabled":""}`,"data-id":e.id,onMouseEnter:c,onClick:r,children:[e.icon?n.jsx("i",{className:`wx-cDCz9rZQ wx-icon ${e.icon}`}):null,e.comp?x?n.jsx(x,{item:e,option:e}):null:n.jsxs("span",{className:"wx-cDCz9rZQ wx-value",children:[" ",e.text," "]}),e.subtext?n.jsx("span",{className:"wx-cDCz9rZQ wx-subtext",children:e.subtext}):null,e.data?n.jsx("i",{className:"wx-cDCz9rZQ wx-sub-icon wxi-angle-right"}):null]})}function R({options:r,left:u=0,top:e=0,at:s="bottom",parent:c=null,mount:x=null,context:w=null,css:f="",onClick:i}){const[m,C]=t.useState(-1e4),[h,M]=t.useState(-1e4),[b,l]=t.useState(20),[a,g]=t.useState(),S=t.useRef(null),[y,I]=t.useState(!1),[N,P]=t.useState(null),p=t.useCallback(()=>{const d=O.calculatePosition(S.current,c,s,u,e);d&&(C(d.x),M(d.y),l(d.z),g(d.width))},[c,s,u,e]);t.useEffect(()=>{x&&x(p)},[]);const o=t.useCallback(()=>{I(!1)},[]),k=t.useCallback(()=>{i&&i({action:null,option:null})},[i]),j=t.useCallback((d,D)=>{I(d),P(D)},[]),v=t.useMemo(()=>q(r),[r]);return t.useEffect(()=>{p()},[c,p]),t.useEffect(()=>{if(S.current)return O.clickOutside(S.current,{callback:k,modal:!0}).destroy},[k]),n.jsx("div",{ref:S,"data-wx-menu":"true",className:`wx-XMmAGqVx wx-menu ${f}`,style:{position:"absolute",top:h+"px",left:m+"px",width:a,zIndex:b},onMouseLeave:o,children:v.map(d=>n.jsxs(t.Fragment,{children:[d.comp==="separator"?n.jsx("div",{className:"wx-XMmAGqVx wx-separator"}):n.jsx(X,{option:d,onShow:j,onClick:D=>{if(!d.data&&!D.defaultPrevented){const z={context:w,action:d,option:d,event:D};d.handler&&d.handler(z),i&&i(z),D.stopPropagation()}}}),d.data&&y===d.id?n.jsx(R,{css:f,options:d.data,at:"right-overlap",parent:N,context:w,onClick:i}):null]},d.id))})}const A=t.forwardRef(function(u,e){const{options:s,at:c="bottom",resolver:x=null,dataKey:w="contextId",filter:f=null,css:i="",children:m,onClick:C}=u,[h,M]=t.useState(null),[b,l]=t.useState(null),[a,g]=t.useState(0),[S,y]=t.useState(0),I=t.useMemo(()=>h!==null&&f?$(s,o=>f(o,h)):s,[h,f,s]),N=t.useCallback(o=>{l(null),C&&C(o)},[C]),P=t.useCallback((o,k)=>{let j=null;for(;o&&o.dataset&&!j;)j=o.dataset[k],o=o.parentNode;return j?O.id(j):null},[]),p=t.useCallback((o,k)=>{if(!o){l(null);return}if(o.defaultPrevented)return;const j=o.target;if(j&&j.dataset&&j.dataset.menuIgnore)return;g(o.clientX+1),y(o.clientY+1);let v=typeof k<"u"?k:P(j,w);x&&(v=x(v,o),!v)||(M(v),l(j),o.preventDefault())},[w,P,x]);return t.useImperativeHandle(e,()=>({show:p}),[p]),n.jsxs(n.Fragment,{children:[m?n.jsx("span",{onClick:p,"data-menu-ignore":"true",children:typeof m=="function"?m():m}):null,b?n.jsx(E.Portal,{children:n.jsx(R,{css:i,at:c,top:S,left:a,parent:b,context:h,onClick:N,options:I},b)}):null]})});function K(r){const{css:u="",menuCss:e="",options:s,onClick:c}=r,x=t.useMemo(()=>q(s),[s]),[w,f]=t.useState(!1),[i,m]=t.useState([]),C=t.useRef(null);function h(l){f(null),c&&c(l)}function M(l,a,g){a.data&&a.data.length?w&&g?f(null):(m(a.data),f(a.id),C.current.show(l,a)):(C.current.show(null),g?(c&&c({action:a,option:a}),f(null)):f(-1))}function b(l,a){w&&M(l,a)}return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:`wx-UfhPCLL4 wx-menubar ${u}`,children:x.map(l=>n.jsx("button",{className:`wx-UfhPCLL4 wx-option ${w===l.id?"wx-active":""} ${l.disabled?"wx-disabled":""}`,onMouseEnter:a=>b(a,l),onClick:a=>M(a,l,!0),children:l.text},l.id))}),n.jsx(A,{css:e,onClick:h,options:i,ref:C})]})}const B=t.forwardRef(function(u,e){const{options:s,at:c="bottom",css:x="",children:w,onClick:f}=u,[i,m]=t.useState(null);function C(a){m(null),f&&f(a)}const h=t.useCallback(a=>{m(a.target),a.preventDefault()},[]);t.useImperativeHandle(e,()=>({show:h}),[h]);function M(a){let g=a.target;for(;!g.dataset.menuIgnore;)m(g),g=g.parentNode}const b=t.useRef(0),l=t.useRef(i);return t.useEffect(()=>{l.current!==i&&(b.current+=1,l.current=i)},[i]),n.jsxs(n.Fragment,{children:[n.jsx("span",{onClick:M,"data-menu-ignore":"true",children:w}),i?n.jsx(E.Portal,{children:n.jsx(R,{css:x,at:c,parent:i,options:s,onClick:C},b.current)}):null]})}),G=t.forwardRef(function(u,e){const{options:s,at:c="bottom",resolver:x=null,dataKey:w="contextId",filter:f=null,css:i="",children:m,onClick:C}=u,h=t.useRef(null),M=t.useCallback((b,l)=>{h.current.show(b,l)},[]);return t.useImperativeHandle(e,()=>({show:M}),[M]),n.jsxs(n.Fragment,{children:[m?n.jsx("span",{onContextMenu:M,"data-menu-ignore":"true",children:m}):null,n.jsx(A,{css:i,at:c,options:s,resolver:x,dataKey:w,filter:f,ref:h,onClick:C})]})});exports.ActionMenu=A;exports.ContextMenu=G;exports.DropDownMenu=B;exports.Menu=R;exports.MenuBar=K;exports.registerMenuItem=Q;
//# sourceMappingURL=index.cjs.map

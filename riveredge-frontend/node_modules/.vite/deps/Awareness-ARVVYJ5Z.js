import {
  Avatar_default,
  Cursor_default,
  createContext,
  createWithEqualityFn,
  nanoid,
  shallow$1
} from "./chunk-WJGV63MB.js";
import "./chunk-LPELZQOY.js";
import "./chunk-KOH5FCVX.js";
import {
  require_fast_deep_equal
} from "./chunk-SHXR7C2R.js";
import "./chunk-THUVLC43.js";
import "./chunk-ZZG5QB7Y.js";
import "./chunk-ZO4UOJK4.js";
import {
  distinctUntilChanged,
  fromEvent,
  map,
  merge,
  startWith
} from "./chunk-AR6LG6UR.js";
import "./chunk-YZIFLJUH.js";
import "./chunk-OERZF2CA.js";
import "./chunk-WJK6EJH2.js";
import {
  require_jsx_runtime
} from "./chunk-5T6QEG5N.js";
import {
  avatar_default
} from "./chunk-Y3KLL7K3.js";
import "./chunk-EEAVZVMR.js";
import "./chunk-TVP4VAW4.js";
import "./chunk-CKSH3UQX.js";
import {
  _objectSpread2,
  _slicedToArray
} from "./chunk-ZY7H3YXG.js";
import "./chunk-4DDZX4I5.js";
import "./chunk-525MDXVU.js";
import "./chunk-FCSS27DJ.js";
import {
  require_react
} from "./chunk-KTKTKB6L.js";
import {
  __toESM
} from "./chunk-JMNN7AZU.js";

// node_modules/@ant-design/pro-editor/es/Awareness/Awareness.js
var import_react5 = __toESM(require_react());

// node_modules/@ant-design/pro-editor/es/Awareness/Avatars/index.js
var import_react3 = __toESM(require_react());

// node_modules/@ant-design/pro-editor/es/Awareness/store.js
var import_fast_deep_equal = __toESM(require_fast_deep_equal());
var import_react2 = __toESM(require_react());

// node_modules/@ant-design/pro-editor/es/Awareness/event.js
var import_react = __toESM(require_react());
var mouse$ = fromEvent(document, "mousemove").pipe(distinctUntilChanged(), map(function(e) {
  return {
    x: e.clientX,
    y: e.clientY
  };
}), startWith({
  x: -100,
  y: -100
}));
var visibility$ = merge(fromEvent(document, "visibilitychange").pipe(map(function() {
  return document.visibilityState;
})), fromEvent(window, "focus").pipe(map(function() {
  return document.visibilityState;
})), fromEvent(window, "blur").pipe(map(function() {
  return "hidden";
})));
var useAwarenessEvent = function useAwarenessEvent2(_ref) {
  var onMouseMove = _ref.onMouseMove, onBlur = _ref.onBlur;
  (0, import_react.useEffect)(function() {
    var x = mouse$.subscribe(onMouseMove);
    var y = visibility$.subscribe(onBlur);
    return function() {
      x.unsubscribe();
      y.unsubscribe();
    };
  }, []);
};

// node_modules/@ant-design/pro-editor/es/Awareness/store.js
var createStore = function createStore2(provider, user) {
  var useStore2 = createWithEqualityFn(function(set) {
    return {
      provider,
      awareness: provider.awareness,
      currentUser: _objectSpread2({
        id: nanoid()
      }, user),
      awarenessStates: [],
      setFollowUser: function setFollowUser(followUser) {
        set({
          followUser
        });
      }
    };
  }, import_fast_deep_equal.default);
  var _useStore$getState = useStore2.getState(), awareness = _useStore$getState.awareness;
  useAwarenessEvent({
    onMouseMove: function onMouseMove(p) {
      awareness.setLocalStateField("cursor", p);
    },
    onBlur: function onBlur(e) {
      awareness.setLocalStateField("active", e === "visible");
    }
  });
  (0, import_react2.useEffect)(function() {
    awareness.on("change", function() {
      var awarenessStates = Array.from(awareness.getStates().values());
      useStore2.setState(function(state) {
        return _objectSpread2(_objectSpread2({}, state), {}, {
          awarenessStates
        });
      });
    });
    awareness.setLocalStateField("user", useStore2.getState().currentUser);
    awareness.setLocalStateField("active", true);
  }, []);
  return useStore2;
};
var _createContext = createContext();
var useStore = _createContext.useStore;
var Provider = _createContext.Provider;
var useStoreApi = _createContext.useStoreApi;

// node_modules/@ant-design/pro-editor/es/Awareness/Avatars/index.js
var import_jsx_runtime = __toESM(require_jsx_runtime());
var AvatarWrapper = function AvatarWrapper2(_ref) {
  var id = _ref.id, name = _ref.name, color = _ref.color, active = _ref.active;
  var _useStore = useStore(function(s) {
    return [s.followUser, s.currentUser, s.setFollowUser];
  }, shallow$1), _useStore2 = _slicedToArray(_useStore, 3), followUser = _useStore2[0], currentUser = _useStore2[1], setFollowUser = _useStore2[2];
  var current = currentUser === id;
  var following = followUser && followUser === id;
  return (0, import_jsx_runtime.jsx)(Avatar_default, {
    name,
    current,
    following,
    color,
    active,
    onClick: function onClick() {
      if (current) return;
      if (following) {
        setFollowUser(void 0);
      } else {
        setFollowUser(id);
      }
    }
  });
};
var Avatars = (0, import_react3.memo)(function() {
  var awarenessStates = useStore(function(s) {
    return s.awarenessStates;
  });
  return (0, import_jsx_runtime.jsx)(avatar_default.Group, {
    children: awarenessStates === null || awarenessStates === void 0 ? void 0 : awarenessStates.filter(Boolean).map(function(_ref2, index) {
      var user = _ref2.user, active = _ref2.active;
      return (0, import_jsx_runtime.jsx)(AvatarWrapper, _objectSpread2({
        active
      }, user), "".concat(user === null || user === void 0 ? void 0 : user.id, "-").concat(index));
    })
  });
});
var Avatars_default = Avatars;

// node_modules/@ant-design/pro-editor/es/Awareness/Cursors/index.js
var import_fast_deep_equal2 = __toESM(require_fast_deep_equal());
var import_react4 = __toESM(require_react());
var import_jsx_runtime2 = __toESM(require_jsx_runtime());
var import_jsx_runtime3 = __toESM(require_jsx_runtime());
var Cursors = (0, import_react4.memo)(function() {
  var awarenessStates = useStore(function(s) {
    var _s$awarenessStates;
    return (_s$awarenessStates = s.awarenessStates) === null || _s$awarenessStates === void 0 ? void 0 : _s$awarenessStates.filter(function(a) {
      return a.active && a.user.id !== s.currentUser.id;
    });
  }, import_fast_deep_equal2.default);
  return (0, import_jsx_runtime2.jsx)(import_jsx_runtime3.Fragment, {
    children: awarenessStates === null || awarenessStates === void 0 ? void 0 : awarenessStates.map(function(a) {
      var cursor = a.cursor, user = a.user;
      return (0, import_jsx_runtime2.jsx)(Cursor_default, {
        position: cursor,
        color: user.color,
        name: user.name
      }, user.id);
    })
  });
});
var Cursors_default = Cursors;

// node_modules/@ant-design/pro-editor/es/Awareness/Awareness.js
var import_jsx_runtime4 = __toESM(require_jsx_runtime());
var import_jsx_runtime5 = __toESM(require_jsx_runtime());
var Awareness = (0, import_react5.memo)(function(_ref) {
  var provider = _ref.provider, _ref$avatars = _ref.avatars, avatars = _ref$avatars === void 0 ? true : _ref$avatars, _ref$cursors = _ref.cursors, cursors = _ref$cursors === void 0 ? true : _ref$cursors, user = _ref.user;
  return (0, import_jsx_runtime5.jsxs)(Provider, {
    createStore: function createStore3() {
      return createStore(provider, user);
    },
    children: [cursors && (0, import_jsx_runtime4.jsx)(Cursors_default, {}), avatars && (0, import_jsx_runtime4.jsx)(Avatars_default, {})]
  });
});
var Awareness_default = Awareness;
export {
  Awareness_default as default
};
//# sourceMappingURL=Awareness-ARVVYJ5Z.js.map

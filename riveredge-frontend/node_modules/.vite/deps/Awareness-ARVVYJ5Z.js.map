{
  "version": 3,
  "sources": ["../../@ant-design/pro-editor/es/Awareness/Awareness.js", "../../@ant-design/pro-editor/es/Awareness/Avatars/index.js", "../../@ant-design/pro-editor/es/Awareness/store.js", "../../@ant-design/pro-editor/es/Awareness/event.js", "../../@ant-design/pro-editor/es/Awareness/Cursors/index.js"],
  "sourcesContent": ["import { memo } from 'react';\nimport Avatars from \"./Avatars\";\nimport Cursors from \"./Cursors\";\nimport { createStore as _createStore, Provider } from \"./store\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nvar Awareness = /*#__PURE__*/memo(function (_ref) {\n  var provider = _ref.provider,\n    _ref$avatars = _ref.avatars,\n    avatars = _ref$avatars === void 0 ? true : _ref$avatars,\n    _ref$cursors = _ref.cursors,\n    cursors = _ref$cursors === void 0 ? true : _ref$cursors,\n    user = _ref.user;\n  return /*#__PURE__*/_jsxs(Provider, {\n    createStore: function createStore() {\n      return _createStore(provider, user);\n    },\n    children: [cursors && /*#__PURE__*/_jsx(Cursors, {}), avatars && /*#__PURE__*/_jsx(Avatars, {})]\n  });\n});\nexport default Awareness;", "import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport { Avatar as A } from 'antd';\nimport { memo } from 'react';\nimport { shallow } from 'zustand/shallow';\nimport { useStore } from \"../store\";\nimport Avatar from \"./Avatar\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nvar AvatarWrapper = function AvatarWrapper(_ref) {\n  var id = _ref.id,\n    name = _ref.name,\n    color = _ref.color,\n    active = _ref.active;\n  var _useStore = useStore(function (s) {\n      return [s.followUser, s.currentUser, s.setFollowUser];\n    }, shallow),\n    _useStore2 = _slicedToArray(_useStore, 3),\n    followUser = _useStore2[0],\n    currentUser = _useStore2[1],\n    setFollowUser = _useStore2[2];\n  var current = currentUser === id;\n  var following = followUser && followUser === id;\n  return /*#__PURE__*/_jsx(Avatar, {\n    name: name,\n    current: current,\n    following: following,\n    color: color,\n    active: active,\n    onClick: function onClick() {\n      if (current) return;\n      if (following) {\n        setFollowUser(undefined);\n      } else {\n        setFollowUser(id);\n      }\n    }\n  });\n};\nvar Avatars = /*#__PURE__*/memo(function () {\n  var awarenessStates = useStore(function (s) {\n    return s.awarenessStates;\n  });\n  return /*#__PURE__*/_jsx(A.Group, {\n    children: awarenessStates === null || awarenessStates === void 0 ? void 0 : awarenessStates.filter(Boolean).map(function (_ref2, index) {\n      var user = _ref2.user,\n        active = _ref2.active;\n      return /*#__PURE__*/_jsx(AvatarWrapper, _objectSpread({\n        active: active\n      }, user), \"\".concat(user === null || user === void 0 ? void 0 : user.id, \"-\").concat(index));\n    })\n  });\n});\nexport default Avatars;", "import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// FIXME：这里理论上不应该使用 faker 的，后续需要重构优化掉\nimport isEqual from 'fast-deep-equal';\nimport { nanoid } from 'nanoid';\nimport { useEffect } from 'react';\nimport { createContext } from 'zustand-utils';\nimport { createWithEqualityFn } from 'zustand/traditional';\nimport { useAwarenessEvent } from \"./event\";\nexport var createStore = function createStore(provider, user) {\n  var useStore = createWithEqualityFn(function (set) {\n    return {\n      provider: provider,\n      awareness: provider.awareness,\n      currentUser: _objectSpread({\n        id: nanoid()\n      }, user),\n      awarenessStates: [],\n      setFollowUser: function setFollowUser(followUser) {\n        set({\n          followUser: followUser\n        });\n      }\n    };\n  }, isEqual);\n  var _useStore$getState = useStore.getState(),\n    awareness = _useStore$getState.awareness;\n\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  useAwarenessEvent({\n    onMouseMove: function onMouseMove(p) {\n      awareness.setLocalStateField('cursor', p);\n    },\n    onBlur: function onBlur(e) {\n      awareness.setLocalStateField('active', e === 'visible');\n    }\n  });\n\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  useEffect(function () {\n    // 先创建一下监听事件\n    awareness.on('change', function () {\n      var awarenessStates = Array.from(awareness.getStates().values());\n      useStore.setState(function (state) {\n        return _objectSpread(_objectSpread({}, state), {}, {\n          awarenessStates: awarenessStates\n        });\n      });\n    });\n\n    // 再初始化一轮用户\n    awareness.setLocalStateField('user', useStore.getState().currentUser);\n    awareness.setLocalStateField('active', true);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  return useStore;\n};\nvar _createContext = createContext(),\n  useStore = _createContext.useStore,\n  Provider = _createContext.Provider,\n  useStoreApi = _createContext.useStoreApi;\nexport { useStore, Provider, useStoreApi };", "import { useEffect } from 'react';\nimport { distinctUntilChanged, fromEvent, merge, startWith } from 'rxjs';\nimport { map } from 'rxjs/operators';\n// 鼠标移动事件\nvar mouse$ = fromEvent(document, 'mousemove').pipe(distinctUntilChanged(), map(function (e) {\n  return {\n    x: e.clientX,\n    y: e.clientY\n  };\n}), startWith({\n  x: -100,\n  y: -100\n}));\nvar visibility$ = merge(fromEvent(document, 'visibilitychange').pipe(map(function () {\n  return document.visibilityState;\n})), fromEvent(window, 'focus').pipe(map(function () {\n  return document.visibilityState;\n})), fromEvent(window, 'blur').pipe(map(function () {\n  return 'hidden';\n})));\nexport var useAwarenessEvent = function useAwarenessEvent(_ref) {\n  var onMouseMove = _ref.onMouseMove,\n    onBlur = _ref.onBlur;\n  useEffect(function () {\n    var x = mouse$.subscribe(onMouseMove);\n    var y = visibility$.subscribe(onBlur);\n    return function () {\n      x.unsubscribe();\n      y.unsubscribe();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n};", "import isEqual from 'fast-deep-equal';\nimport { memo } from 'react';\nimport Cursor from \"./Cursor\";\nimport { useStore } from \"../store\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nvar Cursors = /*#__PURE__*/memo(function () {\n  var awarenessStates = useStore(function (s) {\n    var _s$awarenessStates;\n    return (_s$awarenessStates = s.awarenessStates) === null || _s$awarenessStates === void 0 ? void 0 : _s$awarenessStates.filter(function (a) {\n      return a.active && a.user.id !== s.currentUser.id;\n    });\n  }, isEqual);\n  return /*#__PURE__*/_jsx(_Fragment, {\n    children: awarenessStates === null || awarenessStates === void 0 ? void 0 : awarenessStates.map(function (a) {\n      var cursor = a.cursor,\n        user = a.user;\n      return /*#__PURE__*/_jsx(Cursor, {\n        position: cursor,\n        color: user.color,\n        name: user.name\n      }, user.id);\n    })\n  });\n});\nexport default Cursors;"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAAA,gBAAqB;;;ACGrB,IAAAC,gBAAqB;;;ACDrB,6BAAoB;AAEpB,IAAAC,gBAA0B;;;ACJ1B,mBAA0B;AAI1B,IAAI,SAAS,UAAU,UAAU,WAAW,EAAE,KAAK,qBAAqB,GAAG,IAAI,SAAU,GAAG;AAC1F,SAAO;AAAA,IACL,GAAG,EAAE;AAAA,IACL,GAAG,EAAE;AAAA,EACP;AACF,CAAC,GAAG,UAAU;AAAA,EACZ,GAAG;AAAA,EACH,GAAG;AACL,CAAC,CAAC;AACF,IAAI,cAAc,MAAM,UAAU,UAAU,kBAAkB,EAAE,KAAK,IAAI,WAAY;AACnF,SAAO,SAAS;AAClB,CAAC,CAAC,GAAG,UAAU,QAAQ,OAAO,EAAE,KAAK,IAAI,WAAY;AACnD,SAAO,SAAS;AAClB,CAAC,CAAC,GAAG,UAAU,QAAQ,MAAM,EAAE,KAAK,IAAI,WAAY;AAClD,SAAO;AACT,CAAC,CAAC,CAAC;AACI,IAAI,oBAAoB,SAASC,mBAAkB,MAAM;AAC9D,MAAI,cAAc,KAAK,aACrB,SAAS,KAAK;AAChB,8BAAU,WAAY;AACpB,QAAI,IAAI,OAAO,UAAU,WAAW;AACpC,QAAI,IAAI,YAAY,UAAU,MAAM;AACpC,WAAO,WAAY;AACjB,QAAE,YAAY;AACd,QAAE,YAAY;AAAA,IAChB;AAAA,EAEF,GAAG,CAAC,CAAC;AACP;;;ADxBO,IAAI,cAAc,SAASC,aAAY,UAAU,MAAM;AAC5D,MAAIC,YAAW,qBAAqB,SAAU,KAAK;AACjD,WAAO;AAAA,MACL;AAAA,MACA,WAAW,SAAS;AAAA,MACpB,aAAa,eAAc;AAAA,QACzB,IAAI,OAAO;AAAA,MACb,GAAG,IAAI;AAAA,MACP,iBAAiB,CAAC;AAAA,MAClB,eAAe,SAAS,cAAc,YAAY;AAChD,YAAI;AAAA,UACF;AAAA,QACF,CAAC;AAAA,MACH;AAAA,IACF;AAAA,EACF,GAAG,uBAAAC,OAAO;AACV,MAAI,qBAAqBD,UAAS,SAAS,GACzC,YAAY,mBAAmB;AAGjC,oBAAkB;AAAA,IAChB,aAAa,SAAS,YAAY,GAAG;AACnC,gBAAU,mBAAmB,UAAU,CAAC;AAAA,IAC1C;AAAA,IACA,QAAQ,SAAS,OAAO,GAAG;AACzB,gBAAU,mBAAmB,UAAU,MAAM,SAAS;AAAA,IACxD;AAAA,EACF,CAAC;AAGD,+BAAU,WAAY;AAEpB,cAAU,GAAG,UAAU,WAAY;AACjC,UAAI,kBAAkB,MAAM,KAAK,UAAU,UAAU,EAAE,OAAO,CAAC;AAC/D,MAAAA,UAAS,SAAS,SAAU,OAAO;AACjC,eAAO,eAAc,eAAc,CAAC,GAAG,KAAK,GAAG,CAAC,GAAG;AAAA,UACjD;AAAA,QACF,CAAC;AAAA,MACH,CAAC;AAAA,IACH,CAAC;AAGD,cAAU,mBAAmB,QAAQA,UAAS,SAAS,EAAE,WAAW;AACpE,cAAU,mBAAmB,UAAU,IAAI;AAAA,EAE7C,GAAG,CAAC,CAAC;AACL,SAAOA;AACT;AACA,IAAI,iBAAiB,cAAc;AAAnC,IACE,WAAW,eAAe;AAD5B,IAEE,WAAW,eAAe;AAF5B,IAGE,cAAc,eAAe;;;ADpD/B,yBAA4B;AAC5B,IAAI,gBAAgB,SAASE,eAAc,MAAM;AAC/C,MAAI,KAAK,KAAK,IACZ,OAAO,KAAK,MACZ,QAAQ,KAAK,OACb,SAAS,KAAK;AAChB,MAAI,YAAY,SAAS,SAAU,GAAG;AAClC,WAAO,CAAC,EAAE,YAAY,EAAE,aAAa,EAAE,aAAa;AAAA,EACtD,GAAG,SAAO,GACV,aAAa,eAAe,WAAW,CAAC,GACxC,aAAa,WAAW,CAAC,GACzB,cAAc,WAAW,CAAC,GAC1B,gBAAgB,WAAW,CAAC;AAC9B,MAAI,UAAU,gBAAgB;AAC9B,MAAI,YAAY,cAAc,eAAe;AAC7C,aAAoB,mBAAAC,KAAK,gBAAQ;AAAA,IAC/B;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,SAAS,SAAS,UAAU;AAC1B,UAAI,QAAS;AACb,UAAI,WAAW;AACb,sBAAc,MAAS;AAAA,MACzB,OAAO;AACL,sBAAc,EAAE;AAAA,MAClB;AAAA,IACF;AAAA,EACF,CAAC;AACH;AACA,IAAI,cAAuB,oBAAK,WAAY;AAC1C,MAAI,kBAAkB,SAAS,SAAU,GAAG;AAC1C,WAAO,EAAE;AAAA,EACX,CAAC;AACD,aAAoB,mBAAAA,KAAK,eAAE,OAAO;AAAA,IAChC,UAAU,oBAAoB,QAAQ,oBAAoB,SAAS,SAAS,gBAAgB,OAAO,OAAO,EAAE,IAAI,SAAU,OAAO,OAAO;AACtI,UAAI,OAAO,MAAM,MACf,SAAS,MAAM;AACjB,iBAAoB,mBAAAA,KAAK,eAAe,eAAc;AAAA,QACpD;AAAA,MACF,GAAG,IAAI,GAAG,GAAG,OAAO,SAAS,QAAQ,SAAS,SAAS,SAAS,KAAK,IAAI,GAAG,EAAE,OAAO,KAAK,CAAC;AAAA,IAC7F,CAAC;AAAA,EACH,CAAC;AACH,CAAC;AACD,IAAO,kBAAQ;;;AGpDf,IAAAC,0BAAoB;AACpB,IAAAC,gBAAqB;AAGrB,IAAAC,sBAA4B;AAC5B,IAAAA,sBAAsC;AACtC,IAAI,cAAuB,oBAAK,WAAY;AAC1C,MAAI,kBAAkB,SAAS,SAAU,GAAG;AAC1C,QAAI;AACJ,YAAQ,qBAAqB,EAAE,qBAAqB,QAAQ,uBAAuB,SAAS,SAAS,mBAAmB,OAAO,SAAU,GAAG;AAC1I,aAAO,EAAE,UAAU,EAAE,KAAK,OAAO,EAAE,YAAY;AAAA,IACjD,CAAC;AAAA,EACH,GAAG,wBAAAC,OAAO;AACV,aAAoB,oBAAAC,KAAK,oBAAAC,UAAW;AAAA,IAClC,UAAU,oBAAoB,QAAQ,oBAAoB,SAAS,SAAS,gBAAgB,IAAI,SAAU,GAAG;AAC3G,UAAI,SAAS,EAAE,QACb,OAAO,EAAE;AACX,iBAAoB,oBAAAD,KAAK,gBAAQ;AAAA,QAC/B,UAAU;AAAA,QACV,OAAO,KAAK;AAAA,QACZ,MAAM,KAAK;AAAA,MACb,GAAG,KAAK,EAAE;AAAA,IACZ,CAAC;AAAA,EACH,CAAC;AACH,CAAC;AACD,IAAO,kBAAQ;;;AJrBf,IAAAE,sBAA4B;AAC5B,IAAAA,sBAA8B;AAC9B,IAAI,gBAAyB,oBAAK,SAAU,MAAM;AAChD,MAAI,WAAW,KAAK,UAClB,eAAe,KAAK,SACpB,UAAU,iBAAiB,SAAS,OAAO,cAC3C,eAAe,KAAK,SACpB,UAAU,iBAAiB,SAAS,OAAO,cAC3C,OAAO,KAAK;AACd,aAAoB,oBAAAC,MAAM,UAAU;AAAA,IAClC,aAAa,SAASC,eAAc;AAClC,aAAO,YAAa,UAAU,IAAI;AAAA,IACpC;AAAA,IACA,UAAU,CAAC,eAAwB,oBAAAC,KAAK,iBAAS,CAAC,CAAC,GAAG,eAAwB,oBAAAA,KAAK,iBAAS,CAAC,CAAC,CAAC;AAAA,EACjG,CAAC;AACH,CAAC;AACD,IAAO,oBAAQ;",
  "names": ["import_react", "import_react", "import_react", "useAwarenessEvent", "createStore", "useStore", "isEqual", "AvatarWrapper", "_jsx", "import_fast_deep_equal", "import_react", "import_jsx_runtime", "isEqual", "_jsx", "_Fragment", "import_jsx_runtime", "_jsxs", "createStore", "_jsx"]
}

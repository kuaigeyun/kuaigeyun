import {
  $ as $2,
  $b,
  $l,
  $n,
  Aa,
  Ad as Ad2,
  Ae as Ae3,
  An as An2,
  At as At2,
  B,
  Bb,
  Bi,
  Bn as Bn3,
  Bs,
  Ca as Ca2,
  Cg,
  Cn as Cn2,
  Do as Do2,
  Ea,
  Ee as Ee3,
  Eh,
  F,
  Fb,
  Fl as Fl2,
  Fn as Fn3,
  Fr,
  Fs,
  Ft as Ft3,
  Gr as Gr2,
  Hb,
  He,
  Hi,
  Hs,
  I as I3,
  Ib,
  In,
  Ir,
  Is as Is3,
  J as J2,
  Jc,
  K,
  K2 as K3,
  Kc as Kc2,
  Kl,
  Ko,
  Ll,
  Lo as Lo3,
  Lr,
  M as M2,
  Mb,
  Mn,
  Mo as Mo2,
  Ms,
  Mt,
  N as N2,
  N2 as N3,
  Ni,
  Nl as Nl2,
  Nt as Nt2,
  Om,
  Oo,
  P as P2,
  Pr,
  Pt as Pt3,
  Q as Q3,
  Q0,
  Qb,
  Qt as Qt2,
  Ra,
  Rh,
  Rr,
  Rs as Rs2,
  SA,
  Sa as Sa2,
  Sb as Sb2,
  Sh,
  Sl,
  Sn,
  So as So2,
  T,
  Tb,
  Ti,
  Tn,
  Ts as Ts2,
  U as U2,
  Un as Un3,
  Ve as Ve3,
  Vm,
  Vo as Vo2,
  Vr,
  W,
  Wb,
  Wr,
  Wt,
  X as X4,
  Xc,
  Xe as Xe5,
  Xo,
  Xt,
  Y as Y2,
  Y2 as Y3,
  Yb,
  Yt,
  Z as Z6,
  ZC as ZC2,
  _a as _a2,
  _e as _e2,
  _g,
  _n,
  aa,
  ba as ba2,
  bh,
  bi as bi2,
  bo as bo2,
  br as br3,
  bs as bs2,
  ca as ca2,
  ce,
  cs,
  dg,
  ee,
  f,
  fb as fb2,
  fe as fe2,
  fr as fr3,
  g,
  g1,
  g2 as g4,
  gb as gb2,
  gg,
  gr as gr2,
  h,
  hC,
  ia,
  ie as ie4,
  ir as ir3,
  jA,
  ja as ja3,
  jh,
  ji,
  jo as jo2,
  jr,
  kb as kb2,
  kl,
  km,
  kn,
  kr,
  lb as lb2,
  m as m2,
  mb as mb2,
  nR as nR2,
  nu,
  oa,
  p0,
  pa as pa3,
  pr,
  q as q5,
  ra as ra2,
  re as re3,
  ru,
  sa,
  ta,
  ti,
  tt as tt3,
  ua,
  ue,
  uo as uo3,
  vb as vb2,
  vn,
  vs as vs2,
  we as we2,
  wg,
  wh,
  wl,
  wo,
  x as x2,
  xa,
  xl,
  xn as xn2,
  y,
  y2,
  yc,
  yh,
  yi,
  yl as yl2,
  yr
} from "./chunk-KKODWYZI.js";
import {
  $e as $e3,
  $r,
  $t,
  Ae as Ae2,
  Ao as Ao2,
  Bd,
  Bf,
  Bn as Bn2,
  Ca,
  Do,
  Es,
  Et,
  Fa,
  Fd,
  Fn as Fn2,
  Fo as Fo2,
  Ft as Ft2,
  Ge as Ge3,
  Gf,
  Gr,
  HA,
  Hn as Hn2,
  Ho,
  Ht,
  IA,
  Io,
  Is as Is2,
  It,
  Jd,
  Jn as Jn2,
  Jo,
  Jr as Jr2,
  Js,
  Jt,
  Kd,
  Ke as Ke3,
  Kf,
  Kr,
  Lo as Lo2,
  Lt,
  Md,
  Mo,
  Na,
  No,
  Oa,
  Oi as Oi2,
  On,
  Os,
  Pa,
  Po,
  Pt as Pt2,
  Qd,
  Qo,
  Qt,
  Rd,
  Re,
  Rs,
  Sa,
  Se as Se2,
  So,
  Sr,
  Ss as Ss2,
  St,
  Ta,
  Tf,
  Ud,
  Un as Un2,
  Uo as Uo2,
  Ut,
  Va,
  Vd,
  Wa,
  We as We2,
  Xe as Xe4,
  Xf,
  Xn as Xn2,
  Xr,
  Yf,
  Zd,
  Zf,
  Zr,
  Zt as Zt2,
  _a,
  _t,
  ad,
  ba,
  bn,
  br as br2,
  bs,
  bt,
  cd,
  ct as ct3,
  dA as dA2,
  fi,
  gr,
  id,
  is,
  ja as ja2,
  jf,
  ka as ka2,
  ko as ko2,
  kt as kt3,
  lt as lt2,
  ma as ma2,
  mr,
  mt,
  nd,
  nr as nr2,
  od,
  pa as pa2,
  pt,
  qd,
  qf,
  qn as qn2,
  qr,
  rd,
  ro as ro2,
  rs,
  sd,
  sf,
  so,
  tA as tA2,
  tt as tt2,
  ug,
  uo as uo2,
  va,
  vt,
  wa,
  wr,
  wt,
  xn,
  xs as xs2,
  yn,
  ys,
  yt,
  za,
  zf,
  zo
} from "./chunk-UOXNEQ4H.js";
import {
  $,
  $e,
  I as I2,
  O,
  P,
  j
} from "./chunk-PXSPDNRB.js";
import {
  $5,
  $e as $e2,
  A3 as A32,
  Ae,
  An,
  Ao,
  Bn,
  C7 as C72,
  Ee as Ee2,
  Ei,
  F3,
  F5,
  Fe as Fe2,
  Fo,
  G3 as G32,
  Ge as Ge2,
  Gi,
  H1 as H12,
  I1 as I12,
  Je as Je2,
  Ji as Ji2,
  Jn,
  Ke as Ke2,
  Ki,
  Kt,
  L5,
  Le,
  Lo,
  M1,
  M5,
  N1,
  O5,
  Oi,
  P3 as P32,
  Pe as Pe2,
  Qe,
  Qi,
  R3,
  R5,
  RediConsumer,
  RediContext,
  RediProvider,
  S1 as S13,
  S5,
  Se,
  Ue,
  Un,
  Uo,
  V5,
  Vi,
  Vo,
  W1,
  We,
  WithDependency,
  Wn,
  Xe as Xe3,
  Xi,
  Xn,
  Y1 as Y12,
  Y5,
  Ye as Ye2,
  Z1,
  Z3,
  _1,
  _5,
  a3 as a32,
  a7,
  ae,
  ar as ar2,
  at,
  b5,
  b7,
  be as be2,
  bo,
  c1 as c13,
  c7,
  co as co2,
  connectDependencies,
  connectInjector,
  cr,
  ct as ct2,
  d7,
  dr,
  dt,
  e7,
  e9,
  eo,
  er,
  et as et2,
  f7 as f72,
  fe,
  fr as fr2,
  g5,
  g7,
  go,
  h5,
  h7,
  hr,
  i3,
  i7,
  ie as ie3,
  ir as ir2,
  j1,
  je,
  jn as jn2,
  jo,
  ke,
  ko,
  l3,
  l7,
  lr,
  lt,
  m5,
  m7,
  n7,
  nr,
  nt,
  o7 as o72,
  oe,
  oo,
  or,
  ot,
  p5,
  p7,
  q1,
  qe,
  qi,
  qn,
  r7,
  re as re2,
  ro,
  rr,
  rt as rt2,
  s3,
  s7 as s72,
  se,
  sr,
  st,
  t7,
  to,
  tt,
  u1 as u12,
  u7,
  uo,
  ur,
  useDependency,
  useInjector,
  useObservable,
  useUpdateBinder,
  ut,
  v7,
  vo,
  w5,
  x1 as x12,
  y1 as y12,
  y5,
  ze as ze4,
  zn
} from "./chunk-HQ5557UZ.js";
import {
  Ad,
  DE,
  GC,
  GE as GE3,
  KE,
  NE,
  Np,
  TE,
  VE as VE2,
  XE,
  ZE,
  Za,
  bE,
  dE as dE2,
  eC,
  fE,
  fr,
  ie as ie2,
  kt as kt2,
  mE,
  mf,
  nm,
  qE,
  rp,
  sE,
  tm,
  vE,
  vr as vr2,
  wE
} from "./chunk-HIVG6OTH.js";
import {
  D,
  E,
  Fe,
  Ge,
  J,
  M,
  Xe,
  k,
  m,
  q,
  te,
  ze as ze2
} from "./chunk-GRZDFSJT.js";
import {
  $0,
  $7,
  $B,
  $x,
  A3,
  A7,
  AB,
  Ab,
  B1 as B12,
  B7,
  BB,
  Be as Be2,
  C3,
  C7,
  CB,
  Cb,
  D7,
  D8,
  DB,
  Db,
  Dy,
  E0,
  E7,
  EB,
  F6,
  FB,
  G3,
  G4,
  G6,
  GB,
  GE as GE2,
  Gv,
  H4,
  HB,
  HE,
  Hv,
  I1,
  I4,
  I7,
  IB,
  Iv,
  J1 as J12,
  J4,
  J5,
  JE,
  K2,
  Kx,
  L3,
  L7,
  LB,
  Lx,
  M3,
  M7,
  MB,
  N0,
  N7,
  NB,
  Nb,
  O2,
  O3,
  O7,
  OB,
  OE,
  Ob,
  P3,
  P4,
  P7,
  PB,
  Q1,
  Q2,
  QB,
  Qv,
  R6,
  R7,
  RB,
  Rx,
  S1 as S12,
  S6,
  S7,
  SB,
  Sb,
  Sx,
  T2,
  T3,
  T6,
  T7,
  T8,
  TB,
  U,
  U7,
  UB,
  V,
  V1,
  Vx,
  WB,
  Wv,
  X,
  X2,
  XB,
  Xx,
  YB,
  Yx,
  Z as Z2,
  Z4,
  Z5,
  Zv,
  Zx,
  _7,
  _8,
  _B,
  _b,
  _y,
  a0,
  a3,
  aA,
  ab,
  bB,
  bb,
  be,
  c1 as c12,
  c3,
  c4,
  cA,
  cB,
  ca,
  cb,
  d0,
  d3,
  dA,
  dB,
  dE,
  db,
  de,
  dz,
  e1 as e12,
  e2,
  e3,
  eA,
  eF,
  f7,
  fA,
  fB,
  fb,
  g2,
  g3,
  gA,
  gB,
  gE,
  ga,
  gb,
  ge as ge2,
  h2,
  h4,
  hA,
  hB,
  ha,
  hb,
  iA,
  iB,
  iE,
  j3,
  j6,
  j7,
  j8,
  jB,
  jb,
  k2,
  k4,
  kA,
  kB,
  ka,
  kb,
  l0,
  lB,
  lE,
  lb,
  le,
  m4,
  m6,
  mA,
  mB,
  ma,
  mb,
  nA,
  nB,
  o7,
  oA,
  oB,
  oE,
  ob,
  p2,
  pA,
  pB,
  pa,
  pb,
  q3,
  q4,
  qB,
  r0,
  rA,
  rB,
  rb,
  re,
  s0,
  s7,
  sA,
  sB,
  sF,
  sb,
  t0,
  tA,
  tb,
  uA,
  uB,
  uE,
  ub,
  v1,
  v2,
  v3,
  v4,
  vA,
  vB,
  vb,
  ve,
  w3,
  w7,
  w8,
  wB,
  wb,
  x0,
  x1,
  x3,
  xB,
  xz,
  y0,
  yB,
  yb,
  ye as ye2,
  z0,
  z3,
  z8,
  zB,
  zb,
  ze
} from "./chunk-42GB3BEU.js";
import {
  D as D2,
  Ee,
  I,
  Je,
  Ke,
  L,
  N,
  Q,
  V as V2,
  Ve as Ve2,
  X as X3,
  Xe as Xe2,
  Y,
  Ye,
  _e,
  q as q2,
  v,
  x,
  ze as ze3
} from "./chunk-JZBGZDS5.js";
import {
  $1,
  $E,
  $R,
  $a,
  $m,
  $s,
  At,
  B1,
  Be,
  Bm,
  Bu,
  CE,
  Ci,
  Cn,
  Ct,
  Dn,
  Dr,
  Ds,
  EE,
  ER,
  En,
  F1,
  FR,
  Fl,
  Fn,
  Ft,
  GE,
  Gp,
  H1,
  HR,
  Ha,
  Hl,
  Hn,
  IC,
  Im,
  Inject,
  Injector,
  Is,
  J1,
  Jg,
  Ji,
  Jm,
  Jr,
  KR,
  Kc,
  Ls,
  Mp,
  Ne,
  Nl,
  Nt,
  Og,
  Optional,
  PE,
  Pe,
  Pt,
  QC,
  QR,
  Qr,
  Quantity,
  RR,
  S1,
  SC,
  Ss,
  Tr,
  Ts,
  VE,
  Vc,
  Ve,
  Vg,
  Vt,
  WE,
  WR,
  Wg,
  XR,
  Xg,
  Y1,
  YE,
  YR,
  Yc,
  Yn,
  Z,
  ZC,
  ZR,
  Ze,
  Zm,
  Zt,
  _E,
  _m,
  _r,
  _s,
  a1,
  aC,
  aI,
  ar,
  bg,
  bi,
  br,
  c1,
  co,
  createIdentifier,
  ct,
  e1,
  eI,
  eR,
  et,
  fR,
  fl,
  fn,
  fu,
  ge,
  gn,
  h1,
  hI,
  hR,
  ho,
  ht,
  iI,
  ie,
  ig,
  ir,
  jR,
  ja,
  jn,
  js,
  k1,
  kE,
  kt,
  l1,
  lI,
  mR,
  mc,
  mn,
  nR,
  na,
  nn,
  pE,
  po,
  qc,
  rI,
  rR,
  ra,
  rt,
  s1,
  sI,
  sR,
  tR,
  u1,
  uC,
  uR,
  uc,
  vR,
  vi,
  vr,
  vs,
  w1,
  wC,
  wR,
  we,
  wm,
  xe,
  xp,
  xs,
  y1,
  yE,
  ye,
  yf,
  yl,
  zR,
  zc
} from "./chunk-Y4UF2FTU.js";
import {
  BehaviorSubject,
  EMPTY,
  Observable,
  Subject,
  Subscription,
  bufferWhen,
  combineLatest,
  combineLatestWith,
  debounceTime,
  distinctUntilChanged,
  filter,
  first,
  firstValueFrom,
  map,
  merge,
  of,
  race,
  shareReplay,
  skip,
  startWith,
  switchMap,
  takeUntil,
  tap,
  throttleTime,
  timer,
  withLatestFrom
} from "./chunk-AR6LG6UR.js";
import "./chunk-WJ7JTOYX.js";
import "./chunk-WJK6EJH2.js";
import {
  require_jsx_runtime
} from "./chunk-5T6QEG5N.js";
import "./chunk-EEAVZVMR.js";
import "./chunk-4DDZX4I5.js";
import {
  require_react
} from "./chunk-KTKTKB6L.js";
import {
  __async,
  __objRest,
  __pow,
  __spreadProps,
  __spreadValues,
  __toESM
} from "./chunk-JMNN7AZU.js";

// node_modules/@univerjs/sheets/lib/es/index.js
var Ii = Object.defineProperty;
var vi2 = (n3, e, t3) => e in n3 ? Ii(n3, e, { enumerable: true, configurable: true, writable: true, value: t3 }) : n3[e] = t3;
var R = (n3, e, t3) => vi2(n3, typeof e != "symbol" ? e + "" : e, t3);
function ga2(n3, e, t3) {
  var r, i, a4;
  if (e.t) return e.t;
  if (e.v === null) return null;
  const s2 = n3.getStyleByCell(e), o3 = n3.getStyleByCell(t3);
  if (t3.t === mn.FORCE_STRING) {
    if (!l1((r = o3 == null ? void 0 : o3.n) == null ? void 0 : r.pattern) && e.v !== void 0) {
      if (s1(e.v))
        return mn.NUMBER;
      if (ZC(`${e.v}`))
        return mn.BOOLEAN;
    }
    return mn.FORCE_STRING;
  }
  return ma3(s2) ? l1((i = s2 == null ? void 0 : s2.n) == null ? void 0 : i.pattern) ? mn.STRING : ao(e, t3) : l1((a4 = o3 == null ? void 0 : o3.n) == null ? void 0 : a4.pattern) ? mn.STRING : ao(e, t3);
}
function ao(n3, e) {
  return n3.v !== void 0 ? uo4(n3.v, n3.t) : uo4(e.v, e.t);
}
function ma3(n3) {
  var e;
  return !!((e = n3 == null ? void 0 : n3.n) != null && e.pattern);
}
function uo4(n3, e) {
  return n3 === null ? null : typeof n3 == "string" ? s1(n3) ? (+n3 == 0 || +n3 == 1) && e === mn.BOOLEAN ? mn.BOOLEAN : e !== mn.STRING && e !== mn.FORCE_STRING && mR(n3) ? mn.FORCE_STRING : mn.NUMBER : ZC(n3) ? mn.BOOLEAN : mn.STRING : typeof n3 == "number" ? (n3 === 0 || n3 === 1) && e === mn.BOOLEAN ? mn.BOOLEAN : mn.NUMBER : typeof n3 == "boolean" ? mn.BOOLEAN : mn.FORCE_STRING;
}
var We3 = (n3, e) => {
  if (n3.get(br).getUniverSheetInstance(e.unitId) == null)
    throw new Error("universheet is null error!");
  return {
    unitId: e.unitId,
    subUnitId: e.subUnitId,
    ranges: Z.deepClone(e.ranges)
  };
};
var ne = {
  id: "sheet.mutation.add-worksheet-merge",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const s2 = n3.get(br).getUniverSheetInstance(e.unitId);
    if (s2 == null)
      throw new Error("universheet is null error!");
    const o3 = s2.getSheetBySheetId(e.subUnitId);
    if (!o3) return false;
    const i = o3.getConfig().mergeData, a4 = e.ranges;
    for (let u2 = 0; u2 < a4.length; u2++)
      i.push(a4[u2]);
    return o3.getSpanModel().rebuild(i), true;
  }
};
var fa = rR("CELL_CONTENT");
var Ra2 = rR("ROW_FILTERED");
var ht2 = {
  CELL_CONTENT: fa,
  ROW_FILTERED: Ra2
};
var Ca3 = ((n3) => (n3[n3.DATA_VALIDATION = 9] = "DATA_VALIDATION", n3[n3.NUMFMT = 10] = "NUMFMT", n3[n3.CELL_IMAGE = 11] = "CELL_IMAGE", n3))(Ca3 || {});
var Jo2 = "sheet.interceptor.range-theme-id";
var lo = "sheet.interceptor.ignore-range-theme";
var pa4 = Object.getOwnPropertyDescriptor;
var Sa3 = (n3, e, t3, s2) => {
  for (var o3 = s2 > 1 ? void 0 : s2 ? pa4(e, t3) : e, r = n3.length - 1, i; r >= 0; r--)
    (i = n3[r]) && (o3 = i(o3) || o3);
  return o3;
};
var wa2 = (n3, e) => (t3, s2) => e(t3, s2, n3);
var co3 = rR("BEFORE_CELL_EDIT");
var Cs = rR("AFTER_CELL_EDIT");
var ps = rR("VALIDATE_CELL");
var G = class extends Ve {
  /** @ignore */
  constructor(e) {
    super();
    R(this, "_interceptorsByName", /* @__PURE__ */ new Map());
    R(this, "_commandInterceptors", []);
    R(this, "_rangeInterceptors", []);
    R(this, "_autoHeightInterceptors", []);
    R(this, "_beforeCommandInterceptor", []);
    R(this, "_afterCommandInterceptors", []);
    R(this, "_workbookDisposables", /* @__PURE__ */ new Map());
    R(this, "_worksheetDisposables", /* @__PURE__ */ new Map());
    R(this, "_interceptorsDirty", false);
    R(this, "_composedInterceptorByKey", /* @__PURE__ */ new Map());
    R(this, "writeCellInterceptor", new sR({
      BEFORE_CELL_EDIT: co3,
      AFTER_CELL_EDIT: Cs,
      VALIDATE_CELL: ps
    }));
    this._univerInstanceService = e, this.disposeWithMe(this._univerInstanceService.getTypeOfUnitAdded$(we.UNIVER_SHEET).subscribe((t3) => {
      this._interceptWorkbook(t3);
    })), this.disposeWithMe(this._univerInstanceService.getTypeOfUnitDisposed$(we.UNIVER_SHEET).subscribe(
      (t3) => this._disposeWorkbookInterceptor(t3)
    )), this.intercept(ht2.CELL_CONTENT, {
      priority: -1,
      effect: ir.Style | ir.Value,
      handler: (t3) => t3
    }), this.disposeWithMe(this.writeCellInterceptor.intercept(Cs, {
      priority: -1,
      handler: (t3) => t3
    })), this.disposeWithMe(this.writeCellInterceptor.intercept(co3, {
      priority: -1,
      handler: (t3) => t3
    })), this.disposeWithMe(this.writeCellInterceptor.intercept(ps, {
      priority: -1,
      handler: (t3) => t3
    }));
  }
  dispose() {
    super.dispose(), this._workbookDisposables.forEach((e) => e.dispose()), this._workbookDisposables.clear(), this._worksheetDisposables.forEach((e) => e.dispose()), this._worksheetDisposables.clear(), this._interceptorsByName.clear();
  }
  // #region intercept command execution
  /**
   * Add a listener function to a specific command to add affiliated mutations. It should be called in controllers.
   *
   * Pairs with {@link onCommandExecute}.
   *
   * @param interceptor
   * @returns
   */
  interceptCommand(e) {
    if (this._commandInterceptors.includes(e))
      throw new Error("[SheetInterceptorService]: Interceptor already exists!");
    return this._commandInterceptors.push(e), this._commandInterceptors.sort((t3, s2) => {
      var o3, r;
      return ((o3 = s2.priority) != null ? o3 : 0) - ((r = t3.priority) != null ? r : 0);
    }), this.disposeWithMe(Be(() => vs(this._commandInterceptors, e)));
  }
  /**
   * When command is executing, call this method to gether undo redo mutations from upper features.
   * @param command
   * @returns
   */
  onCommandExecute(e) {
    const t3 = this._commandInterceptors.map((s2) => s2.getMutations(e));
    return {
      preUndos: t3.map((s2) => {
        var o3;
        return (o3 = s2.preUndos) != null ? o3 : [];
      }).flat(),
      undos: t3.map((s2) => s2.undos).flat(),
      preRedos: t3.map((s2) => {
        var o3;
        return (o3 = s2.preRedos) != null ? o3 : [];
      }).flat(),
      redos: t3.map((s2) => s2.redos).flat()
    };
  }
  interceptAfterCommand(e) {
    if (this._afterCommandInterceptors.includes(e))
      throw new Error("[SheetInterceptorService]: Interceptor already exists!");
    return this._afterCommandInterceptors.push(e), this._afterCommandInterceptors.sort((t3, s2) => {
      var o3, r;
      return ((o3 = s2.priority) != null ? o3 : 0) - ((r = t3.priority) != null ? r : 0);
    }), this.disposeWithMe(Be(() => vs(this._afterCommandInterceptors, e)));
  }
  afterCommandExecute(e) {
    const t3 = this._afterCommandInterceptors.map((s2) => s2.getMutations(e));
    return {
      undos: t3.map((s2) => s2.undos).flat(),
      redos: t3.map((s2) => s2.redos).flat()
    };
  }
  interceptAutoHeight(e) {
    if (this._autoHeightInterceptors.includes(e))
      throw new Error("[SheetInterceptorService]: Interceptor already exists!");
    return this._autoHeightInterceptors.push(e), this._autoHeightInterceptors.sort((t3, s2) => {
      var o3, r;
      return ((o3 = s2.priority) != null ? o3 : 0) - ((r = t3.priority) != null ? r : 0);
    }), this.disposeWithMe(Be(() => vs(this._autoHeightInterceptors, e)));
  }
  generateMutationsOfAutoHeight(e) {
    const t3 = this._autoHeightInterceptors.map((s2) => s2.getMutations(e));
    return {
      preUndos: t3.map((s2) => {
        var o3;
        return (o3 = s2.preUndos) != null ? o3 : [];
      }).flat(),
      undos: t3.map((s2) => s2.undos).flat(),
      preRedos: t3.map((s2) => {
        var o3;
        return (o3 = s2.preRedos) != null ? o3 : [];
      }).flat(),
      redos: t3.map((s2) => s2.redos).flat()
    };
  }
  /**
   * Add a listener function to a specific command to determine if the command can execute mutations. It should be
   * called in controllers.
   *
   * Pairs with {@link beforeCommandExecute}.
   *
   * @param interceptor
   * @returns
   */
  interceptBeforeCommand(e) {
    if (this._beforeCommandInterceptor.includes(e))
      throw new Error("[SheetInterceptorService]: Interceptor already exists!");
    return this._beforeCommandInterceptor.push(e), this._beforeCommandInterceptor.sort((t3, s2) => {
      var o3, r;
      return ((o3 = s2.priority) != null ? o3 : 0) - ((r = t3.priority) != null ? r : 0);
    }), this.disposeWithMe(Be(() => vs(this._beforeCommandInterceptor, e)));
  }
  /**
   * before command execute, call this method to get the flag of whether it can be executed the commandï¼Œ
   * @param info ICommandInfo
   * @returns Promise<boolean>
   */
  beforeCommandExecute(e) {
    return __async(this, null, function* () {
      return (yield Promise.all(this._beforeCommandInterceptor.map((s2) => s2.performCheck(e)))).every((s2) => s2);
    });
  }
  // #endregion
  // #region intercept ranges - mainly for pivot table currently (2024/10/28).
  /**
   * By adding callbacks to some Ranges can get some additional mutations, such as clearing all plugin data in a certain area.
   * @param interceptor IRangeInterceptors
   * @returns IDisposable
   */
  interceptRanges(e) {
    if (this._rangeInterceptors.includes(e))
      throw new Error("[SheetInterceptorService]: Interceptor already exists!");
    return this._rangeInterceptors.push(e), this._rangeInterceptors.sort((t3, s2) => {
      var o3, r;
      return ((o3 = s2.priority) != null ? o3 : 0) - ((r = t3.priority) != null ? r : 0);
    }), this.disposeWithMe(Be(() => vs(this._rangeInterceptors, e)));
  }
  generateMutationsByRanges(e) {
    const t3 = this._rangeInterceptors.map((s2) => s2.getMutations(e));
    return {
      preUndos: t3.map((s2) => {
        var o3;
        return (o3 = s2.preUndos) != null ? o3 : [];
      }).flat(),
      undos: t3.map((s2) => s2.undos).flat(),
      preRedos: t3.map((s2) => {
        var o3;
        return (o3 = s2.preRedos) != null ? o3 : [];
      }).flat(),
      redos: t3.map((s2) => s2.redos).flat()
    };
  }
  // #endregion
  // #region intercept on writing cell
  onWriteCell(e, t3, s2, o3, r) {
    const i = {
      subUnitId: t3.getSheetId(),
      unitId: e.getUnitId(),
      workbook: e,
      worksheet: t3,
      row: s2,
      col: o3,
      origin: Z.deepClone(r)
    };
    return this.writeCellInterceptor.fetchThroughInterceptors(Cs)(r, i);
  }
  // #endregion
  onValidateCell(e, t3, s2, o3) {
    const r = {
      subUnitId: t3.getSheetId(),
      unitId: e.getUnitId(),
      workbook: e,
      worksheet: t3,
      row: s2,
      col: o3
    };
    return this.writeCellInterceptor.fetchThroughInterceptors(ps)(Promise.resolve(true), r);
  }
  intercept(e, t3) {
    const s2 = e;
    this._interceptorsByName.has(s2) || this._interceptorsByName.set(s2, []);
    const o3 = this._interceptorsByName.get(s2);
    o3.push(t3);
    const r = o3.sort((i, a4) => {
      var u2, l4;
      return ((u2 = a4.priority) != null ? u2 : 0) - ((l4 = i.priority) != null ? l4 : 0);
    });
    if (this._interceptorsDirty = true, s2 === ht2.CELL_CONTENT) {
      const i = ir.Style | ir.Value;
      this._interceptorsByName.set(`${s2}-${i}`, r);
      const a4 = ir.Style | ir.Value;
      return this._interceptorsByName.set(
        `${s2}-${ir.Style}`,
        r.filter((u2) => ((u2.effect || a4) & ir.Style) > 0)
      ), this._interceptorsByName.set(
        `${s2}-${ir.Value}`,
        r.filter((u2) => ((u2.effect || a4) & ir.Value) > 0)
      ), this.disposeWithMe(Be(() => {
        vs(this._interceptorsByName.get(s2), t3), vs(this._interceptorsByName.get(`${s2}-${i}`), t3), vs(this._interceptorsByName.get(`${s2}-${ir.Style}`), t3), vs(this._interceptorsByName.get(`${s2}-${ir.Value}`), t3);
      }));
    } else
      return this._interceptorsByName.set(s2, r), this.disposeWithMe(Be(() => vs(this._interceptorsByName.get(s2), t3)));
  }
  fetchThroughInterceptors(e, t3, s2, o3) {
    const r = t3 === void 0 ? e : `${e}-${t3}`, i = s2 != null ? s2 : r;
    let a4 = this._composedInterceptorByKey.get(i);
    if (!a4 || this._interceptorsDirty) {
      let u2 = this._interceptorsByName.get(r);
      u2 && o3 && (u2 = u2.filter(o3)), a4 = qc(u2 || []), this._composedInterceptorByKey.set(i, a4);
    }
    return a4;
  }
  _interceptWorkbook(e) {
    const t3 = new ho(), s2 = e.getUnitId(), o3 = this, r = (i) => {
      const a4 = i.getSheetId();
      i.__interceptViewModel((u2) => {
        const l4 = new ho();
        o3._worksheetDisposables.set(ho2(s2, i), l4), l4.add(u2.registerCellContentInterceptor({
          getCell(c2, d2, h9, g9, m9) {
            const f4 = i.getCellRaw(c2, d2);
            return o3.fetchThroughInterceptors(ht2.CELL_CONTENT, h9, g9, m9)(
              f4,
              {
                unitId: s2,
                subUnitId: a4,
                row: c2,
                col: d2,
                worksheet: i,
                workbook: e,
                rawData: f4
              }
            );
          }
        })), l4.add(u2.registerRowFilteredInterceptor({
          getRowFiltered(c2) {
            return !!o3.fetchThroughInterceptors(ht2.ROW_FILTERED)(
              false,
              {
                unitId: s2,
                subUnitId: a4,
                row: c2,
                workbook: e,
                worksheet: i
              }
            );
          }
        }));
      });
    };
    e.getSheets().forEach((i) => r(i)), t3.add(e.sheetCreated$.subscribe((i) => r(i))), t3.add(Be(() => e.getSheets().forEach((i) => this._disposeSheetInterceptor(s2, i)))), t3.add(e.sheetDisposed$.subscribe((i) => this._disposeSheetInterceptor(s2, i))), this._workbookDisposables.set(s2, t3);
  }
  _disposeWorkbookInterceptor(e) {
    const t3 = e.getUnitId(), s2 = this._workbookDisposables.get(t3);
    s2 && (s2.dispose(), this._workbookDisposables.delete(t3));
  }
  _disposeSheetInterceptor(e, t3) {
    const s2 = ho2(e, t3), o3 = this._worksheetDisposables.get(s2);
    o3 && (o3.dispose(), this._worksheetDisposables.delete(s2));
  }
};
G = Sa3([
  wa2(0, br)
], G);
function ho2(n3, e) {
  return `${n3}|${e.getSheetId()}`;
}
var ge3 = (n3) => {
  const e = {};
  return n3.bg && (e.bg = __spreadValues({}, n3.bg)), n3.ol && (e.ol = __spreadValues({}, n3.ol)), n3.bd && (e.bd = __spreadValues({}, n3.bd)), n3.cl && (e.cl = __spreadValues({}, n3.cl)), n3.ht && (e.ht = n3.ht), n3.vt && (e.vt = n3.vt), n3.bl !== void 0 && (e.bl = n3.bl), e;
};
function Ia(n3) {
  const e = {};
  if (n3.length === 1)
    return n3[0];
  for (const t3 of n3)
    t3.bg && (e.bg = t3.bg), t3.ol && (e.ol = t3.ol), t3.bd && (e.bd = __spreadValues(__spreadValues({}, e.bd), t3.bd)), t3.cl && (e.cl = t3.cl), t3.ht && (e.ht = t3.ht), t3.vt && (e.vt = t3.vt), t3.bl !== void 0 && (e.bl = t3.bl);
  return e;
}
var ce2 = {
  wholeStyle: 1,
  headerRowStyle: 2,
  headerColumnStyle: 4,
  firstRowStyle: 8,
  secondRowStyle: 16,
  lastRowStyle: 32,
  firstColumnStyle: 128,
  secondColumnStyle: 256,
  lastColumnStyle: 512
};
var Rt = class {
  /**
   * @constructor
   * @param {string} name The name of the range theme style, it used to identify the range theme style.
   * @param {IRangeThemeStyleJSON} [options] The options to initialize the range theme style.
   */
  constructor(e, t3) {
    R(this, "_name");
    R(this, "wholeStyle", null);
    R(this, "headerRowStyle", null);
    R(this, "headerColumnStyle", null);
    R(this, "firstRowStyle", null);
    R(this, "secondRowStyle", null);
    R(this, "lastRowStyle", null);
    R(this, "firstColumnStyle", null);
    R(this, "secondColumnStyle", null);
    R(this, "lastColumnStyle", null);
    R(this, "_mergeCacheMap", /* @__PURE__ */ new Map());
    t3 && this.fromJson(__spreadProps(__spreadValues({}, t3), { name: e })), this._name = e;
  }
  /**
   * Gets the name of the range theme style.The name is read only, and use to identifier the range theme style.
   * @returns {string} The name of the range theme style.
   */
  getName() {
    return this._name;
  }
  getWholeStyle() {
    return this.wholeStyle;
  }
  setWholeStyle(e) {
    this.wholeStyle = e, this._resetStyleCache();
  }
  getFirstRowStyle() {
    return this.firstRowStyle;
  }
  setFirstRowStyle(e) {
    this.firstRowStyle = e, this._resetStyleCache();
  }
  getSecondRowStyle() {
    return this.secondRowStyle;
  }
  setSecondRowStyle(e) {
    this.secondRowStyle = e, this._resetStyleCache();
  }
  getLastRowStyle() {
    return this.lastRowStyle;
  }
  setLastRowStyle(e) {
    this.lastRowStyle = e, this._resetStyleCache();
  }
  getFirstColumnStyle() {
    return this.firstColumnStyle;
  }
  setFirstColumnStyle(e) {
    this.firstColumnStyle = e, this._resetStyleCache();
  }
  getSecondColumnStyle() {
    return this.secondColumnStyle;
  }
  setSecondColumnStyle(e) {
    this.secondColumnStyle = e, this._resetStyleCache();
  }
  getLastColumnStyle() {
    return this.lastColumnStyle;
  }
  setLastColumnStyle(e) {
    this.lastColumnStyle = e, this._resetStyleCache();
  }
  getHeaderRowStyle() {
    return this.headerRowStyle;
  }
  setHeaderRowStyle(e) {
    this.headerRowStyle = e, this._resetStyleCache();
  }
  getHeaderColumnStyle() {
    return this.headerColumnStyle;
  }
  setHeaderColumnStyle(e) {
    this.headerColumnStyle = e, this._resetStyleCache();
  }
  getStyle(e, t3, s2, o3, r) {
    let i = 0;
    return s2 && (i = i | ce2.lastRowStyle), o3 && (i = i | ce2.lastColumnStyle), e >= 0 && t3 >= 0 && (i = i | ce2.wholeStyle), e % 2 === 1 && (i = i | (r ? ce2.secondRowStyle : ce2.firstRowStyle)), e % 2 === 0 && (i = i | (r ? ce2.firstRowStyle : ce2.secondRowStyle)), e === 0 && (i = i | ce2.headerRowStyle), t3 === 0 && (i = i | ce2.headerColumnStyle), t3 % 2 === 1 && (i = i | ce2.firstColumnStyle), t3 % 2 === 0 && (i = i | ce2.secondColumnStyle), i === 0 ? null : this._getMergeStyle(i);
  }
  _getMergeStyle(e) {
    let t3 = this._mergeCacheMap.get(e);
    return t3 || (t3 = this._mergeStyle(e), this._mergeCacheMap.set(e, t3)), t3;
  }
  _mergeStyle(e) {
    const t3 = [];
    return this.wholeStyle && e & ce2.wholeStyle && t3.push(this.wholeStyle), this.firstColumnStyle && e & ce2.firstColumnStyle && t3.push(this.firstColumnStyle), this.secondColumnStyle && e & ce2.secondColumnStyle && t3.push(this.secondColumnStyle), this.firstRowStyle && e & ce2.firstRowStyle && t3.push(this.firstRowStyle), this.secondRowStyle && e & ce2.secondRowStyle && t3.push(this.secondRowStyle), this.headerColumnStyle && e & ce2.headerColumnStyle && t3.push(this.headerColumnStyle), this.lastColumnStyle && e & ce2.lastColumnStyle && t3.push(this.lastColumnStyle), this.headerRowStyle && e & ce2.headerRowStyle && t3.push(this.headerRowStyle), this.lastRowStyle && e & ce2.lastRowStyle && t3.push(this.lastRowStyle), Ia(t3);
  }
  _resetStyleCache() {
    this._mergeCacheMap.clear();
  }
  toJson() {
    const e = {
      name: this._name
    };
    return this.wholeStyle && (e.wholeStyle = ge3(this.wholeStyle)), this.headerRowStyle && (e.headerRowStyle = ge3(this.headerRowStyle)), this.headerColumnStyle && (e.headerColumnStyle = ge3(this.headerColumnStyle)), this.firstRowStyle && (e.firstRowStyle = ge3(this.firstRowStyle)), this.secondRowStyle && (e.secondRowStyle = ge3(this.secondRowStyle)), this.lastRowStyle && (e.lastRowStyle = ge3(this.lastRowStyle)), this.firstColumnStyle && (e.firstColumnStyle = ge3(this.firstColumnStyle)), this.secondColumnStyle && (e.secondColumnStyle = ge3(this.secondColumnStyle)), this.lastColumnStyle && (e.lastColumnStyle = ge3(this.lastColumnStyle)), e;
  }
  fromJson(e) {
    this._name = e.name, e.wholeStyle && (this.wholeStyle = ge3(e.wholeStyle)), e.headerRowStyle && (this.headerRowStyle = ge3(e.headerRowStyle)), e.headerColumnStyle && (this.headerColumnStyle = ge3(e.headerColumnStyle)), e.firstRowStyle && (this.firstRowStyle = ge3(e.firstRowStyle)), e.secondRowStyle && (this.secondRowStyle = ge3(e.secondRowStyle)), e.lastRowStyle && (this.lastRowStyle = ge3(e.lastRowStyle)), e.firstColumnStyle && (this.firstColumnStyle = ge3(e.firstColumnStyle)), e.secondColumnStyle && (this.secondColumnStyle = ge3(e.secondColumnStyle)), e.lastColumnStyle && (this.lastColumnStyle = ge3(e.lastColumnStyle));
  }
  dispose() {
    this._mergeCacheMap.clear();
  }
};
var va2 = (n3, e, t3) => new Rt(`light-${n3}`, {
  headerRowStyle: {
    bg: {
      rgb: e
    }
  },
  firstColumnStyle: {
    bg: {
      rgb: "rgb(255, 255, 255)"
    }
  },
  secondColumnStyle: {
    bg: {
      rgb: t3
    }
  },
  lastRowStyle: {
    bg: {
      rgb: e
    }
  }
});
var Ma = (n3, e, t3) => new Rt(`middle-${n3}`, {
  headerRowStyle: {
    bg: {
      rgb: e
    }
  },
  headerColumnStyle: {
    bg: {
      rgb: t3
    }
  },
  secondRowStyle: {
    bg: {
      rgb: t3
    }
  },
  lastRowStyle: {
    bg: {
      rgb: e
    }
  },
  lastColumnStyle: {
    bg: {
      rgb: t3
    }
  }
});
var _a3 = (n3, e, t3, s2) => new Rt(`dark-${n3}`, {
  headerRowStyle: {
    bg: {
      rgb: e
    },
    cl: {
      rgb: "rgb(255, 255, 255)"
    },
    ht: Pt.CENTER,
    bl: ie.TRUE
  },
  firstRowStyle: {
    bg: {
      rgb: t3
    }
  },
  secondRowStyle: {
    bg: {
      rgb: s2
    }
  },
  lastRowStyle: {
    bg: {
      rgb: e
    }
  }
});
var ya = [
  {
    baseName: "blue",
    header: "rgb(164, 202, 254)",
    color: "rgb(225, 239, 254)"
  },
  {
    baseName: "grey",
    header: "rgb(205, 208, 216)",
    color: "rgb(238, 239, 241)"
  },
  {
    baseName: "red",
    header: "rgb(248, 180, 180)",
    color: "rgb(253, 232, 232)"
  },
  {
    baseName: "orange",
    header: "rgb(253, 186, 140)",
    color: "rgb(254, 236, 220)"
  },
  {
    baseName: "yellow",
    header: "rgb(250, 200, 21)",
    color: "rgb(255, 244, 185)"
  },
  {
    baseName: "green",
    header: "rgb(132, 225, 188)",
    color: "rgb(222, 247, 236)"
  },
  {
    baseName: "azure",
    header: "rgb(126, 220, 226)",
    color: "rgb(213, 245, 246)"
  },
  {
    baseName: "indigo",
    header: "rgb(186, 198, 248)",
    color: "rgb(233, 237, 255)"
  },
  {
    baseName: "purple",
    header: "rgb(202, 191, 253)",
    color: "rgb(237, 235, 254)"
  },
  {
    baseName: "magenta",
    header: "rgb(248, 180, 217)",
    color: "rgb(252, 232, 243)"
  }
];
var ba3 = [
  {
    baseName: "blue",
    rowHeader: "rgb(63, 131, 248)",
    colHeader: "rgb(195, 221, 253)"
  },
  {
    baseName: "grey",
    rowHeader: "rgb(95, 101, 116)",
    colHeader: "rgb(227, 229, 234)"
  },
  {
    baseName: "red",
    rowHeader: "rgb(240, 82, 82)",
    colHeader: "rgb(251, 213, 213)"
  },
  {
    baseName: "orange",
    rowHeader: "rgb(255, 90, 31)",
    colHeader: "rgb(252, 217, 189)"
  },
  {
    baseName: "yellow",
    rowHeader: "rgb(212, 157, 15)",
    colHeader: "rgb(252, 220, 106)"
  },
  {
    baseName: "green",
    rowHeader: "rgb(13, 164, 113)",
    colHeader: "rgb(188, 240, 218)"
  },
  {
    baseName: "azure",
    rowHeader: "rgb(6, 148, 162)",
    colHeader: "rgb(175, 236, 239)"
  },
  {
    baseName: "indigo",
    rowHeader: "rgb(70, 106, 247)",
    colHeader: "rgb(210, 218, 250)"
  },
  {
    baseName: "purple",
    rowHeader: "rgb(144, 97, 249)",
    colHeader: "rgb(220, 215, 254)"
  },
  {
    baseName: "magenta",
    rowHeader: "rgb(231, 70, 148)",
    colHeader: "rgb(250, 209, 232)"
  }
];
var Ea2 = [
  {
    baseName: "blue",
    rowHeader: "rgb(30, 66, 159)",
    firstRow: "rgb(195, 221, 253)",
    secondRow: "rgb(118, 169, 250)"
  },
  {
    baseName: "grey",
    rowHeader: "rgb(44, 48, 64)",
    firstRow: "rgb(227, 229, 234)",
    secondRow: "rgb(151, 157, 172)"
  },
  {
    baseName: "red",
    rowHeader: "rgb(155, 28, 28)",
    firstRow: "rgb(251, 213, 213)",
    secondRow: "rgb(249, 128, 128)"
  },
  {
    baseName: "orange",
    rowHeader: "rgb(180, 52, 3)",
    firstRow: "rgb(252, 217, 189)",
    secondRow: "rgb(255, 138, 76)"
  },
  {
    baseName: "yellow",
    rowHeader: "rgb(154, 109, 21)",
    firstRow: "rgb(252, 220, 106)",
    secondRow: "rgb(212, 157, 15)"
  },
  {
    baseName: "green",
    rowHeader: "rgb(4, 108, 78)",
    firstRow: "rgb(188, 240, 218)",
    secondRow: "rgb(49, 196, 141)"
  },
  {
    baseName: "azure",
    rowHeader: "rgb(3, 102, 114)",
    firstRow: "rgb(175, 236, 239)",
    secondRow: "rgb(22, 189, 202)"
  },
  {
    baseName: "indigo",
    rowHeader: "rgb(16, 51, 191)",
    firstRow: "rgb(210, 218, 250)",
    secondRow: "rgb(98, 128, 249)"
  },
  {
    baseName: "purple",
    rowHeader: "rgb(74, 29, 150)",
    firstRow: "rgb(220, 215, 254)",
    secondRow: "rgb(172, 148, 250)"
  },
  {
    baseName: "magenta",
    rowHeader: "rgb(153, 21, 75)",
    firstRow: "rgb(250, 209, 232)",
    secondRow: "rgb(241, 126, 184)"
  }
];
var ka3 = ya.map(({ baseName: n3, header: e, color: t3 }) => va2(n3, e, t3));
var Ua = ba3.map(({ baseName: n3, rowHeader: e, colHeader: t3 }) => Ma(n3, e, t3));
var Ta2 = Ea2.map(({ baseName: n3, rowHeader: e, firstRow: t3, secondRow: s2 }) => _a3(n3, e, t3, s2));
var Pa2 = [
  ...ka3,
  ...Ua,
  ...Ta2
];
var qo = {
  headerRowStyle: {
    bg: {
      rgb: "rgb(68,114,196)"
    },
    cl: {
      rgb: "rgb(255,255,255)"
    },
    ht: Pt.CENTER,
    bl: ie.TRUE
  },
  firstRowStyle: {
    bg: {
      rgb: "rgb(217,225,242)"
    }
  }
};
var Na2 = new Rt("default", qo);
var Oa2 = new Rt("default-last-row", __spreadProps(__spreadValues({}, qo), {
  lastRowStyle: {
    bd: {
      t: {
        s: xe.THIN,
        cl: {
          rgb: "rgb(68,114,196)"
        }
      }
    },
    ht: Pt.CENTER,
    bl: ie.TRUE
  }
}));
var Da = class {
  constructor() {
    R(this, "_toggleRanges", []);
  }
  /**
   * Refresh the cache based on the given range and visibility function.
   * This method calculates toggle ranges for rows that are visible within the specified range.
   * Hidden rows are excluded from the toggle calculation.
   * @param range The range of rows to refresh (startRow and endRow are required).
   * @param visibleFunc A function to determine if a row is visible.
   */
  refresh(e, t3) {
    const { startRow: s2, endRow: o3 } = e, r = [];
    let i = 0, a4 = false, u2 = -1;
    for (let l4 = s2; l4 <= o3; l4++) {
      if (!t3(l4)) {
        i++, i % 2 === 1 ? a4 = true : (a4 = false, u2 !== -1 && (r.push([u2, l4 - 1]), u2 = -1));
        continue;
      }
      i % 2 === 1 ? a4 ? u2 === -1 && (u2 = l4) : (a4 = true, u2 = l4) : a4 && (r.push([u2, l4 - 2]), a4 = false, u2 = -1), l4 === o3 && a4 && r.push([u2, l4]);
    }
    this._toggleRanges = r;
  }
  /**
   * This function returns the toggle ranges. Only for testing purposes. In production, you should use `getIsToggled` to check if a row is toggled.
   * @returns [IToggleRange[]] The toggle ranges calculated by the last refresh.
   */
  getToggleRanges() {
    return this._toggleRanges.concat();
  }
  /**
   * Check if the given row is toggled (odd/even state).
   * This method uses binary search to efficiently determine if the row is within a toggle range.
   * @param row The row to check.
   * @returns True if the row is toggled (odd), false otherwise (even or hidden).
   */
  getIsToggled(e) {
    let t3 = 0, s2 = this._toggleRanges.length - 1;
    for (; t3 <= s2; ) {
      const o3 = Math.floor((t3 + s2) / 2), [r, i] = this._toggleRanges[o3];
      if (e < r)
        s2 = o3 - 1;
      else if (e > i)
        t3 = o3 + 1;
      else
        return true;
    }
    return false;
  }
};
var Aa2 = Object.getOwnPropertyDescriptor;
var xa2 = (n3, e, t3, s2) => {
  for (var o3 = s2 > 1 ? void 0 : s2 ? Aa2(e, t3) : e, r = n3.length - 1, i; r >= 0; r--)
    (i = n3[r]) && (o3 = i(o3) || o3);
  return o3;
};
var Ss3 = (n3, e) => (t3, s2) => e(t3, s2, n3);
var $a2 = "SHEET_RANGE_THEME_MODEL_PLUGIN";
var ve2 = class extends Ve {
  constructor(e, t3, s2) {
    super();
    R(this, "_rangeThemeStyleMap", /* @__PURE__ */ new Map());
    R(this, "_rangeThemeStyleRuleMap", /* @__PURE__ */ new Map());
    R(this, "_rTreeCollection", /* @__PURE__ */ new Map());
    R(this, "_defaultRangeThemeMap", /* @__PURE__ */ new Map());
    R(this, "_zebraCrossingCacheMap", /* @__PURE__ */ new Map());
    R(this, "_rowVisibleFuncSet", /* @__PURE__ */ new Map());
    R(this, "_rangeThemeMapChanged$", new Subject());
    R(this, "rangeThemeMapChange$", this._rangeThemeMapChanged$.asObservable());
    this._sheetInterceptorService = e, this._resourceManagerService = t3, this._univerInstanceService = s2, this._registerIntercept(), this._initSnapshot(), this._initDefaultTheme();
  }
  _initDefaultTheme() {
    this.registerDefaultRangeTheme(Na2), this.registerDefaultRangeTheme(Oa2);
    for (const e of Pa2)
      this.registerDefaultRangeTheme(e);
  }
  _ensureRangeThemeStyleMap(e) {
    return this._rangeThemeStyleMap.has(e) || this._rangeThemeStyleMap.set(e, /* @__PURE__ */ new Map()), this._rangeThemeStyleMap.get(e);
  }
  _ensureRangeThemeStyleRuleMap(e) {
    return this._rangeThemeStyleRuleMap.has(e) || this._rangeThemeStyleRuleMap.set(e, /* @__PURE__ */ new Map()), this._rangeThemeStyleRuleMap.get(e);
  }
  _ensureRTreeCollection(e) {
    return this._rTreeCollection.has(e) || this._rTreeCollection.set(e, new aI()), this._rTreeCollection.get(e);
  }
  getDefaultRangeThemeStyle(e) {
    return this._defaultRangeThemeMap.get(e);
  }
  getCustomRangeThemeStyle(e, t3) {
    return this._ensureRangeThemeStyleMap(e).get(t3);
  }
  _getSheetRowVisibleFuncSet(e, t3) {
    this._rowVisibleFuncSet.has(e) || this._rowVisibleFuncSet.set(e, /* @__PURE__ */ new Map());
    const s2 = this._rowVisibleFuncSet.get(e);
    return s2.has(t3) || s2.set(t3, /* @__PURE__ */ new Set()), s2.get(t3);
  }
  _getSheetRowVisibleHasInit(e, t3) {
    var s2;
    return !!(this._rowVisibleFuncSet.has(e) && ((s2 = this._rowVisibleFuncSet.get(e)) != null && s2.has(t3)));
  }
  refreshSheetRowVisibleFuncSet(e, t3) {
    const s2 = this._getSheetRowVisibleFuncSet(e, t3);
    s2.clear();
    const o3 = this._univerInstanceService.getUnit(e);
    if (o3) {
      const r = o3.getSheetBySheetId(t3);
      if (r) {
        const i = r.getRowCount(), a4 = r.getRowManager();
        for (let u2 = 1; u2 <= i; u2++)
          r.getRowVisible(u2) ? a4.getRowHeight(u2) === 0 && s2.add(u2) : s2.add(u2);
      }
    }
  }
  _ensureZebraCrossingCache(e, t3, s2) {
    this._zebraCrossingCacheMap.has(e) || this._zebraCrossingCacheMap.set(e, /* @__PURE__ */ new Map());
    const o3 = this._zebraCrossingCacheMap.get(e);
    o3.has(t3) || o3.set(t3, /* @__PURE__ */ new Map());
    const r = o3.get(t3);
    return r.has(s2) || r.set(s2, new Da()), r.get(s2);
  }
  /**
   * Register range theme styles
   * @param {string} themeName
   * @param {IRangeThemeRangeInfo} rangeInfo
   */
  registerRangeThemeRule(e, t3) {
    const { unitId: s2, subUnitId: o3, range: r } = t3, i = et(), a4 = this._ensureRangeThemeStyleRuleMap(s2), u2 = this._ensureRTreeCollection(s2);
    a4.set(i, { rangeInfo: t3, themeName: e }), u2.insert({ unitId: s2, sheetId: o3, range: r, id: i }), this._getSheetRowVisibleHasInit(s2, o3) || this.refreshSheetRowVisibleFuncSet(s2, o3);
    const l4 = this._ensureZebraCrossingCache(s2, o3, i), c2 = this._getSheetRowVisibleFuncSet(s2, o3);
    l4.refresh(r, (d2) => !c2.has(d2));
  }
  getRegisteredRangeThemeStyle(e) {
    const { unitId: t3, subUnitId: s2, range: o3 } = e, r = this._ensureRTreeCollection(t3), i = Array.from(r.bulkSearch([{ unitId: t3, sheetId: s2, range: o3 }]));
    if (i[0]) {
      const u2 = this._ensureRangeThemeStyleRuleMap(t3).get(i[0]);
      if (u2)
        return u2.themeName;
    }
  }
  refreshZebraCrossingCacheBySheet(e, t3) {
    this._zebraCrossingCacheMap.has(e) || this._zebraCrossingCacheMap.set(e, /* @__PURE__ */ new Map());
    const s2 = this._zebraCrossingCacheMap.get(e);
    s2.has(t3) || s2.set(t3, /* @__PURE__ */ new Map());
    const o3 = s2.get(t3);
    o3 && o3.forEach((r, i) => {
      const u2 = this._ensureRangeThemeStyleRuleMap(e).get(i);
      u2 ? r.refresh(u2.rangeInfo.range, (l4) => !this._getSheetRowVisibleFuncSet(e, t3).has(l4)) : o3.delete(i);
    });
  }
  removeRangeThemeRule(e, t3) {
    const { unitId: s2, subUnitId: o3, range: r } = t3, i = this._ensureRTreeCollection(s2), a4 = Array.from(i.bulkSearch([{ unitId: s2, sheetId: o3, range: r }])), u2 = this._ensureRangeThemeStyleRuleMap(s2);
    for (let l4 = 0; l4 < a4.length; l4++) {
      const c2 = u2.get(a4[l4]);
      if (c2 && c2.themeName === e) {
        u2.delete(a4[l4]), i.remove({ unitId: s2, sheetId: o3, range: r, id: a4[l4] });
        const d2 = this._zebraCrossingCacheMap.get(s2);
        if (d2) {
          const h9 = d2.get(o3);
          h9 && h9.delete(a4[l4]);
        }
        break;
      }
    }
  }
  registerDefaultRangeTheme(e) {
    this._defaultRangeThemeMap.set(e.getName(), e), this._rangeThemeMapChanged$.next({ type: "add", styleName: e.getName() });
  }
  unRegisterDefaultRangeTheme(e) {
    this._defaultRangeThemeMap.delete(e), this._rangeThemeMapChanged$.next({ type: "remove", styleName: e });
  }
  getRegisteredRangeThemes() {
    return Array.from(this._defaultRangeThemeMap.keys());
  }
  /**
   * Register custom range theme style.
   * @param {string} unitId The unit id.
   * @param {RangeThemeStyle} rangeThemeStyle The range theme style.
   */
  registerRangeThemeStyle(e, t3) {
    this._ensureRangeThemeStyleMap(e).set(t3.getName(), t3), this._rangeThemeMapChanged$.next({ type: "add", styleName: t3.getName() });
  }
  /**
   *  Unregister custom range theme style.
   * @param {string} unitId The unit id.
   * @param {string} name The name of the range theme style.
   */
  unregisterRangeThemeStyle(e, t3) {
    this._ensureRangeThemeStyleMap(e).delete(t3), this._rangeThemeMapChanged$.next({ type: "remove", styleName: t3 });
  }
  /**
   * Gets all custom register themes
   * @param {string} unitId Which unit to register the range theme style.
   * @return {string[]} The array of all custom registered themes.
   */
  getALLRegisteredTheme(e) {
    return Array.from(this._ensureRangeThemeStyleMap(e).keys());
  }
  getRangeThemeStyle(e, t3) {
    return this._defaultRangeThemeMap.has(t3) ? this._defaultRangeThemeMap.get(t3) : this._ensureRangeThemeStyleMap(e).get(t3);
  }
  getCellStyle(e, t3, s2, o3) {
    const r = { startRow: s2, startColumn: o3, endRow: s2, endColumn: o3 }, i = this._ensureRTreeCollection(e), a4 = Array.from(i.bulkSearch([{ unitId: e, sheetId: t3, range: r }]));
    if (a4[0]) {
      const l4 = this._ensureRangeThemeStyleRuleMap(e).get(a4[0]);
      if (l4) {
        const { rangeInfo: c2, themeName: d2 } = l4, h9 = s2 - c2.range.startRow, g9 = o3 - c2.range.startColumn, m9 = this.getRangeThemeStyle(e, d2), C = this._ensureZebraCrossingCache(e, t3, a4[0]).getIsToggled(s2);
        if (m9)
          return m9.getStyle(h9, g9, s2 === c2.range.endRow, o3 === c2.range.endColumn, C);
      }
    }
  }
  _registerIntercept() {
    this.disposeWithMe(this._sheetInterceptorService.intercept(ht2.CELL_CONTENT, {
      id: Jo2,
      effect: ir.Style,
      handler: (e, t3, s2) => {
        const { row: o3, col: r, unitId: i, subUnitId: a4 } = t3, u2 = this.getCellStyle(i, a4, o3, r);
        if (u2) {
          const l4 = !e || e === t3.rawData ? __spreadValues({}, t3.rawData) : e;
          return l4.themeStyle = u2, s2(l4);
        }
        return s2(e);
      }
    }));
  }
  toJson(e) {
    const t3 = this._ensureRangeThemeStyleRuleMap(e), s2 = this._ensureRangeThemeStyleMap(e);
    if (s2.size === 0 && t3.size === 0)
      return "{}";
    const o3 = {};
    t3.forEach((i, a4) => {
      o3[a4] = i;
    });
    const r = {};
    return s2.forEach((i, a4) => {
      r[a4] = i.toJson();
    }), JSON.stringify({
      rangeThemeStyleRuleMap: o3,
      rangeThemeStyleMapJson: r
    });
  }
  fromJSON(e, t3) {
    const { rangeThemeStyleRuleMap: s2, rangeThemeStyleMapJson: o3 } = t3;
    s2 && Object.keys(s2).forEach((r) => {
      const i = s2[r], { themeName: a4, rangeInfo: u2 } = i;
      a4.startsWith("table") || (this.registerRangeThemeRule(a4, u2), this._ensureRTreeCollection(u2.unitId).insert({ unitId: r, sheetId: u2.subUnitId, range: u2.range, id: r }));
    }), o3 && Object.keys(o3).forEach((r) => {
      const i = o3[r], a4 = new Rt(i.name);
      a4.fromJson(i), this._ensureRangeThemeStyleMap(e).set(a4.getName(), a4);
    });
  }
  deleteUnitId(e) {
    this._rangeThemeStyleMap.delete(e), this._rangeThemeStyleRuleMap.delete(e), this._rTreeCollection.delete(e);
  }
  _initSnapshot() {
    this.disposeWithMe(this._resourceManagerService.registerPluginResource({
      toJson: (e) => this.toJson(e),
      parseJson: (e) => {
        if (!e)
          return {};
        try {
          return JSON.parse(e);
        } catch (e4) {
          return {};
        }
      },
      businesses: [we.UNIVER_SHEET],
      pluginName: $a2,
      onLoad: (e, t3) => {
        this.fromJSON(e, t3);
      },
      onUnLoad: (e) => {
        this.deleteUnitId(e);
      }
    }));
  }
  dispose() {
    super.dispose(), this._rangeThemeStyleMap.clear(), this._rangeThemeStyleRuleMap.clear(), this._defaultRangeThemeMap.clear(), this._rTreeCollection.clear(), this._zebraCrossingCacheMap.clear(), this._rowVisibleFuncSet.clear();
  }
};
ve2 = xa2([
  Ss3(0, Inject(G)),
  Ss3(1, Inject(na)),
  Ss3(2, Inject(br))
], ve2);
function Yo(n3, e) {
  const { unitId: t3 } = e, s2 = t3 ? n3.getUnit(t3, we.UNIVER_SHEET) : n3.getCurrentUnitOfType(we.UNIVER_SHEET);
  return s2 ? {
    workbook: s2,
    unitId: s2.getUnitId()
  } : null;
}
function P5(n3, e = {}) {
  const { unitId: t3, subUnitId: s2 } = e, o3 = t3 ? n3.getUnit(t3, we.UNIVER_SHEET) : n3.getCurrentUnitOfType(we.UNIVER_SHEET);
  if (!o3) return null;
  const r = s2 ? o3.getSheetBySheetId(s2) : o3.getActiveSheet(true);
  return r ? {
    worksheet: r,
    workbook: o3,
    unitId: o3.getUnitId(),
    subUnitId: r.getSheetId()
  } : null;
}
function Qe2(n3, e) {
  const { unitId: t3, subUnitId: s2 } = e, o3 = n3.getUnit(t3, we.UNIVER_SHEET);
  if (!o3) return null;
  const r = o3.getSheetBySheetId(s2);
  return r ? {
    worksheet: r,
    workbook: o3
  } : null;
}
var tn = {
  id: "sheet.mutation.set-worksheet-range-theme-style",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const { unitId: t3, subUnitId: s2, range: o3, themeName: r } = e, i = n3.get(br), a4 = P5(i), u2 = n3.get(ve2);
    return a4 ? (u2.registerRangeThemeRule(r, { range: o3, unitId: t3, subUnitId: s2 }), true) : false;
  }
};
var Wa2 = (n3, e) => {
  const t3 = Qe2(n3.get(br), e);
  if (!t3)
    throw new Error("[SetWorksheetRangeThemeStyleMutation]: worksheet is null error!");
  const { worksheet: s2 } = t3;
  return {
    unitId: e.unitId,
    subUnitId: s2.getSheetId(),
    range: e.range,
    themeName: e.themeName
  };
};
var nn2 = {
  id: "sheet.mutation.remove-worksheet-range-theme-style",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const { unitId: t3, subUnitId: s2, range: o3, themeName: r } = e, i = n3.get(br), a4 = P5(i), u2 = n3.get(ve2);
    return a4 ? (u2.removeRangeThemeRule(r, { range: o3, unitId: t3, subUnitId: s2 }), true) : false;
  }
};
var Va2 = (n3, e) => {
  const t3 = Qe2(n3.get(br), e);
  if (!t3)
    throw new Error("[DeleteWorksheetRangeThemeStyleMutationFactory]: worksheet is null error!");
  const { worksheet: s2 } = t3;
  return {
    unitId: e.unitId,
    subUnitId: s2.getSheetId(),
    range: e.range,
    themeName: e.themeName
  };
};
var Ws = (n3, e) => {
  if (n3.get(br).getUniverSheetInstance(e.unitId) == null)
    throw new Error("universheet is null error!");
  return {
    unitId: e.unitId,
    subUnitId: e.subUnitId,
    range: e.range
  };
};
var ke2 = {
  id: "sheet.mutation.insert-row",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    var m9;
    const { unitId: t3, subUnitId: s2, range: o3, rowInfo: r } = e, a4 = n3.get(br).getUniverSheetInstance(t3);
    if (a4 == null)
      throw new Error("universheet is null error!");
    const u2 = a4.getSheetBySheetId(s2);
    if (u2 == null)
      throw new Error("worksheet is null error!");
    const l4 = u2.getRowManager().getRowData(), c2 = {
      h: u2.getConfig().defaultRowHeight,
      hd: 0
    }, d2 = o3.startRow, h9 = o3.endRow - o3.startRow + 1;
    for (let f4 = d2; f4 < d2 + h9; f4++)
      r ? WR(f4, (m9 = r[f4 - o3.startRow]) != null ? m9 : c2, l4) : WR(f4, c2, l4);
    return u2.setRowCount(u2.getRowCount() + h9), u2.getCellMatrix().insertRows(o3.startRow, h9), true;
  }
};
var as = (n3, e) => {
  if (n3.get(br).getUniverSheetInstance(e.unitId) == null)
    throw new Error("universheet is null error!");
  return {
    unitId: e.unitId,
    subUnitId: e.subUnitId,
    range: e.range
  };
};
var Ue2 = {
  id: "sheet.mutation.insert-col",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    var m9;
    const s2 = n3.get(br).getUniverSheetInstance(e.unitId);
    if (s2 == null)
      throw new Error("universheet is null error!");
    const o3 = s2.getSheetBySheetId(e.subUnitId);
    if (!o3) return false;
    const r = o3.getColumnManager(), { range: i, colInfo: a4 } = e, l4 = r.getColumnData(), c2 = i.startColumn, d2 = i.endColumn - i.startColumn + 1, h9 = o3.getConfig().defaultColumnWidth;
    for (let f4 = c2; f4 < c2 + d2; f4++) {
      const C = {
        w: h9,
        hd: 0
      };
      a4 ? WR(f4, (m9 = a4[f4 - i.startColumn]) != null ? m9 : C, l4) : WR(f4, C, l4);
    }
    return o3.setColumnCount(o3.getColumnCount() + i.endColumn - i.startColumn + 1), o3.getCellMatrix().insertColumns(i.startColumn, d2), true;
  }
};
var wt2 = {
  id: "sheet.mutation.move-range",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const { from: t3, to: s2 } = e;
    if (!t3 || !s2)
      return false;
    const r = n3.get(br).getCurrentUnitForType(we.UNIVER_SHEET);
    if (!r)
      return false;
    const i = r.getSheetBySheetId(e.from.subUnitId), a4 = r.getSheetBySheetId(e.to.subUnitId);
    if (!i || !a4)
      return false;
    const u2 = i.getCellMatrix(), l4 = a4.getCellMatrix();
    return new ht(t3.value).forValue((c2, d2, h9) => {
      h9 == null ? u2.realDeleteValue(c2, d2) : u2.setValue(c2, d2, h9);
    }), new ht(s2.value).forValue((c2, d2, h9) => {
      h9 == null ? l4.realDeleteValue(c2, d2) : l4.setValue(c2, d2, h9);
    }), true;
  }
};
function La(n3, e) {
  const { unitId: t3, subUnitId: s2, sourceRange: o3, targetRange: r } = e, i = o3.startRow > r.startRow, a4 = o3.endRow - o3.startRow + 1;
  return i ? {
    unitId: t3,
    subUnitId: s2,
    sourceRange: Cn.clone(r),
    targetRange: __spreadProps(__spreadValues({}, o3), {
      endRow: o3.endRow + a4,
      startRow: o3.startRow + a4
    })
  } : {
    unitId: t3,
    subUnitId: s2,
    targetRange: Cn.clone(o3),
    sourceRange: __spreadProps(__spreadValues({}, r), {
      endRow: r.endRow - a4,
      startRow: r.startRow - a4
    })
  };
}
var Je3 = {
  id: "sheet.mutation.move-rows",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const { unitId: t3, subUnitId: s2, sourceRange: o3, targetRange: r } = e, a4 = n3.get(br).getUniverSheetInstance(t3);
    if (!a4)
      throw new Error("[MoveRowMutation] univerSheet is null!");
    const u2 = a4.getSheetBySheetId(s2);
    if (!u2)
      throw new Error("[MoveRowMutation] worksheet is null!");
    const l4 = o3.startRow, c2 = o3.endRow - o3.startRow + 1, d2 = r.startRow, h9 = u2.getRowManager().getRowData();
    return $a(l4, c2, d2, h9), u2.getCellMatrix().moveRows(l4, c2, d2), true;
  }
};
function Ha2(n3, e) {
  const { unitId: t3, subUnitId: s2, sourceRange: o3, targetRange: r } = e, i = o3.startColumn > r.startColumn, a4 = o3.endColumn - o3.startColumn + 1;
  return i ? {
    unitId: t3,
    subUnitId: s2,
    sourceRange: Cn.clone(r),
    targetRange: __spreadProps(__spreadValues({}, o3), {
      endColumn: o3.endColumn + a4,
      startColumn: o3.startColumn + a4
    })
  } : {
    unitId: t3,
    subUnitId: s2,
    targetRange: Cn.clone(o3),
    sourceRange: __spreadProps(__spreadValues({}, r), {
      startColumn: r.startColumn - a4,
      endColumn: r.endColumn - a4
    })
  };
}
var qe2 = {
  id: "sheet.mutation.move-columns",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const { unitId: t3, subUnitId: s2, sourceRange: o3, targetRange: r } = e, a4 = n3.get(br).getUniverSheetInstance(t3);
    if (!a4)
      throw new Error("[MoveColumnMutation] univerSheet is null!");
    const u2 = a4.getSheetBySheetId(s2);
    if (!u2)
      throw new Error("[MoveColumnMutation] worksheet is null!");
    const l4 = o3.startColumn, c2 = o3.endColumn - o3.startColumn + 1, d2 = r.startColumn, h9 = u2.getColumnManager().getColumnData();
    return $a(l4, c2, d2, h9), u2.getCellMatrix().moveColumns(l4, c2, d2), true;
  }
};
var Fa2 = (n3, e) => {
  const o3 = e.getRowManager().getRowData(), r = {}, i = n3.range, a4 = zR(i.startRow, i.endRow, o3), u2 = YR(r, a4);
  return {
    unitId: n3.unitId,
    subUnitId: n3.subUnitId,
    range: n3.range,
    rowInfo: u2
  };
};
var Te = {
  id: "sheet.mutation.remove-rows",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const s2 = n3.get(br).getUniverSheetInstance(e.unitId);
    if (s2 == null)
      throw new Error("universheet is null error!");
    const o3 = s2.getSheetBySheetId(e.subUnitId);
    if (!o3) return false;
    const r = e.range, a4 = o3.getRowManager().getRowData();
    for (let c2 = r.startRow; c2 <= r.endRow; c2++)
      o3.getRowFiltered(c2);
    const u2 = r.endRow - r.startRow + 1;
    return Ha(r.startRow, u2, a4), o3.getCellMatrix().removeRows(r.startRow, u2), o3.setRowCount(o3.getRowCount() - u2), true;
  }
};
var Ba = (n3, e) => {
  const s2 = n3.get(br).getUniverSheetInstance(e.unitId);
  if (s2 == null)
    throw new Error("universheet is null error!");
  const o3 = s2.getSheetBySheetId(e.subUnitId);
  if (o3 == null)
    throw new Error("worksheet is null error!");
  const a4 = o3.getColumnManager().getColumnData(), u2 = {}, l4 = e.range, c2 = zR(l4.startColumn, l4.endColumn, a4), d2 = YR(u2, c2);
  return {
    unitId: e.unitId,
    subUnitId: e.subUnitId,
    range: e.range,
    colInfo: d2
  };
};
var Me = {
  id: "sheet.mutation.remove-col",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const s2 = n3.get(br).getUniverSheetInstance(e.unitId);
    if (s2 == null)
      throw new Error("universheet is null error!");
    const o3 = s2.getSheetBySheetId(e.subUnitId);
    if (!o3) return false;
    const r = e.range, a4 = o3.getColumnManager().getColumnData(), u2 = r.endColumn - r.startColumn + 1;
    return Ha(r.startColumn, u2, a4), o3.setColumnCount(o3.getColumnCount() - u2), o3.getCellMatrix().removeColumns(r.startColumn, u2), true;
  }
};
var ye3 = (n3, e) => {
  const s2 = n3.get(br).getUniverSheetInstance(e.unitId);
  if (s2 == null)
    throw new Error("universheet is null error!");
  const o3 = s2.getSheetBySheetId(e.subUnitId);
  if (o3 == null)
    throw new Error("worksheet is null error!");
  const i = o3.getConfig().mergeData, a4 = e.ranges, u2 = [];
  for (let l4 = 0; l4 < a4.length; l4++)
    for (let c2 = i.length - 1; c2 >= 0; c2--) {
      const d2 = i[c2], h9 = a4[l4];
      Cn.intersects(d2, h9) && u2.push(i[c2]);
    }
  return {
    unitId: e.unitId,
    subUnitId: e.subUnitId,
    ranges: u2
  };
};
var se2 = {
  id: "sheet.mutation.remove-worksheet-merge",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const s2 = n3.get(br).getUniverSheetInstance(e.unitId);
    if (s2 == null)
      throw new Error("universheet is null error!");
    const o3 = s2.getSheetBySheetId(e.subUnitId);
    if (!o3) return false;
    const i = o3.getConfig().mergeData, a4 = e.ranges;
    for (let u2 = 0; u2 < a4.length; u2++)
      for (let l4 = i.length - 1; l4 >= 0; l4--) {
        const c2 = i[l4], d2 = a4[u2];
        Cn.intersects(c2, d2) && i.splice(l4, 1);
      }
    return o3.getSpanModel().rebuild(i), true;
  }
};
var ja4 = (n3) => {
  const { order: e } = n3, t3 = {};
  return Object.keys(e).forEach((s2) => {
    t3[e[Number(s2)]] = Number(s2);
  }), __spreadProps(__spreadValues({}, n3), {
    order: t3
  });
};
var On2 = {
  id: "sheet.mutation.reorder-range",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const { subUnitId: t3, unitId: s2, range: o3, order: r } = e, u2 = n3.get(br).getUnit(s2).getSheetBySheetId(t3);
    if (!u2)
      return false;
    const l4 = new ht();
    vr.foreach(o3, (d2, h9) => {
      if (r.hasOwnProperty(d2)) {
        const g9 = r[d2], m9 = Z.deepClone(u2.getCellRaw(g9, h9));
        l4.setValue(d2, h9, m9);
      }
    });
    const c2 = u2.getCellMatrix();
    return l4.forValue((d2, h9, g9) => {
      c2.setValue(d2, h9, g9);
    }), true;
  }
};
function za2(n3, e) {
  if (n3 == null)
    return n3;
  const t3 = Z.deepClone(n3);
  if (e == null)
    return t3;
  const s2 = {};
  return "h" in e && (s2.h = t3.h), "ia" in e && (s2.ia = t3.ia), "ah" in e && (s2.ah = t3.ah), "hd" in e && (s2.hd = t3.hd), "s" in e && (s2.s = t3.s), "custom" in e && (s2.custom = t3.custom), s2;
}
function Ga(n3, e) {
  if (n3 == null)
    return n3;
  const t3 = Z.deepClone(n3);
  if (e == null)
    return t3;
  const s2 = {};
  return "w" in e && (s2.w = t3.w), "hd" in e && (s2.hd = t3.hd), "s" in e && (s2.s = t3.s), "custom" in e && (s2.custom = t3.custom), s2;
}
var Ka = (n3, e) => {
  const { unitId: t3, subUnitId: s2, columnData: o3 } = n3, r = {}, i = e.getColumnManager();
  for (const a4 in o3) {
    const u2 = o3[a4], l4 = i.getColumn(Number(a4));
    r[a4] = Ga(l4, u2);
  }
  return {
    unitId: t3,
    subUnitId: s2,
    columnData: r
  };
};
var zt = {
  id: "sheet.mutation.set-col-data",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const { columnData: t3 } = e, s2 = n3.get(br), o3 = P5(s2, e);
    if (!o3) return false;
    const { worksheet: r } = o3, i = r.getColumnManager();
    for (const a4 in t3) {
      const u2 = t3[a4];
      if (u2 == null) {
        i.removeColumn(Number(a4));
        continue;
      }
      const l4 = i.getColumnOrCreate(Number(a4));
      Object.assign(l4, u2);
    }
    return true;
  }
};
var Ja = (n3, e) => {
  if (n3.get(br).getUniverSheetInstance(e.unitId) == null)
    throw new Error("universheet is null error!");
  return {
    unitId: e.unitId,
    subUnitId: e.subUnitId,
    ranges: e.ranges
  };
};
var sn = {
  id: "sheet.mutation.set-col-hidden",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const s2 = n3.get(br).getUniverSheetInstance(e.unitId);
    if (!s2)
      return false;
    const o3 = s2.getSheetBySheetId(e.subUnitId).getColumnManager();
    for (let r = 0; r < e.ranges.length; r++) {
      const i = e.ranges[r];
      for (let a4 = i.startColumn; a4 < i.endColumn + 1; a4++) {
        const u2 = o3.getColumnOrCreate(a4);
        u2 != null && (u2.hd = ie.TRUE);
      }
    }
    return true;
  }
};
var qa = (n3, e) => {
  if (n3.get(br).getUniverSheetInstance(e.unitId) == null)
    throw new Error("universheet is null error!");
  return {
    unitId: e.unitId,
    subUnitId: e.subUnitId,
    ranges: e.ranges
  };
};
var on = {
  id: "sheet.mutation.set-col-visible",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const s2 = n3.get(br).getUniverSheetInstance(e.unitId);
    if (!s2)
      return false;
    const o3 = s2.getSheetBySheetId(e.subUnitId).getColumnManager();
    for (let r = 0; r < e.ranges.length; r++) {
      const i = e.ranges[r];
      for (let a4 = i.startColumn; a4 < i.endColumn + 1; a4++) {
        const u2 = o3.getColumnOrCreate(a4);
        u2 != null && (u2.hd = ie.FALSE);
      }
    }
    return true;
  }
};
var Gt = {
  id: "sheet.mutation.set-gridlines-color",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const t3 = P5(n3.get(br), e);
    if (!t3) return false;
    const { worksheet: s2 } = t3, o3 = s2.getConfig();
    return o3.gridlinesColor = e.color, true;
  }
};
function Ya(n3, e, t3) {
  var i;
  const s2 = n3.getStyleByCell(e);
  s2 == null && delete e.s, typeof t3.s == "string" && (t3.s = n3.get(t3.s));
  const o3 = kn2(s2, t3.s ? t3.s : null);
  o3 && (Z.removeNull(o3), Object.entries(o3).forEach(([a4, u2]) => {
    typeof u2 == "object" && u2 !== null && Object.keys(u2).length === 0 && delete o3[a4];
  })), Z.isEmptyObject(o3) ? delete e.s : e.s = n3.setValue(o3);
  const r = t3.v ? `${t3.v}\r
` : "";
  !t3.p && e.p && (r && r !== ((i = e.p.body) == null ? void 0 : i.dataStream) ? delete e.p : Qa(e.p, t3.s ? t3.s : null));
}
function Xa(n3, e) {
  if (!e || !Object.keys(e).length)
    return n3;
  const t3 = Z.deepClone(n3 != null ? n3 : {});
  for (const s2 in e)
    s2 === "bd" ? t3[s2] = Za2(t3[s2] || {}, e[s2]) : s2 in t3 || (t3[s2] = null);
  return t3;
}
function Za2(n3, e) {
  if (!e || !Object.keys(e).length)
    return n3;
  for (const t3 in e)
    t3 in n3 || (n3[t3] = null);
  return n3;
}
function kn2(n3, e, t3 = false) {
  if (e === null) return e;
  if (e === void 0) return n3;
  const s2 = Z.deepClone(n3) || {};
  for (const o3 in e)
    t3 && ["bd", "tr", "td", "ht", "vt", "tb", "pd", "bg"].includes(o3) || (o3 in s2 && o3 === "bd" ? s2[o3] = Object.assign(s2[o3], e[o3]) : s2[o3] = e[o3]);
  return "cl" in s2 && ("ul" in s2 && s2.ul && (s2.ul.cl = s2.cl), "ol" in s2 && s2.ol && (s2.ol.cl = s2.cl), "st" in s2 && s2.st && (s2.st.cl = s2.cl)), s2;
}
function Xo2(n3, e) {
  return n3.some((t3) => t3.startIndex === e) ? Xo2(n3, e + 1) : e;
}
function Qa(n3, e) {
  var i;
  if (n3.body == null)
    return;
  Array.isArray(n3.body.textRuns) || (n3.body.textRuns = []);
  let t3 = 0;
  const s2 = [], o3 = ((i = n3.body) == null ? void 0 : i.paragraphs) || [];
  for (const a4 of n3.body.textRuns) {
    const { st: u2, ed: l4, ts: c2 = {} } = a4;
    if (t3 < u2) {
      const h9 = {
        st: t3,
        ed: u2
      }, g9 = kn2({}, e, true);
      g9 && Z.removeNull(g9), Z.isEmptyObject(g9) || (h9.ts = g9), s2.push(h9);
    }
    const d2 = kn2(c2, e, true);
    d2 && Z.removeNull(d2), Z.isEmptyObject(d2) ? delete a4.ts : a4.ts = d2, s2.push(a4), t3 = Xo2(o3, l4);
  }
  const r = n3.body.dataStream.endsWith(`\r
`) ? n3.body.dataStream.length - 2 : n3.body.dataStream.length;
  if (t3 < r) {
    const a4 = {
      st: t3,
      ed: r
    }, u2 = kn2({}, e, true);
    u2 && Z.removeNull(u2), Z.isEmptyObject(u2) || (a4.ts = u2), s2.push(a4);
  }
  n3.body.textRuns = $s(s2);
}
function go2(n3, e) {
  return e.v === void 0 || e.v === null ? e.v : n3 === mn.NUMBER ? Number(e.v) : n3 === mn.BOOLEAN ? eu(e.v) ? 1 : 0 : n3 === mn.STRING || n3 === mn.FORCE_STRING ? `${e.v}` : e.v;
}
function eu(n3) {
  if (typeof n3 == "string") {
    if (n3.toUpperCase() === "TRUE")
      return true;
    if (n3.toUpperCase() === "FALSE")
      return false;
    if (fR(n3)) {
      if (Number(n3) === 0)
        return false;
      if (Number(n3) === 1)
        return true;
    }
  }
  if (typeof n3 == "number") {
    if (n3 === 0)
      return false;
    if (n3 === 1)
      return true;
  }
  return typeof n3 == "boolean" ? n3 : null;
}
function tu(n3) {
  return n3 == null ? null : (n3.f === void 0 && (n3.f = null), n3.si === void 0 && (n3.si = null), n3.p === void 0 && (n3.p = null), n3.v === void 0 && (n3.v = null), n3.t === void 0 && (n3.t = null), n3.s === void 0 && (n3.s = null), n3.custom === void 0 && (n3.custom = null), n3);
}
var Ae4 = (n3, e) => {
  const { unitId: t3, subUnitId: s2, cellValue: o3 } = e, i = n3.get(br).getUniverSheetInstance(t3);
  if (i == null)
    throw new Error("workbook is null error!");
  const a4 = i.getSheetBySheetId(s2);
  if (a4 == null)
    throw new Error("worksheet is null error!");
  const u2 = a4.getCellMatrix(), l4 = i.getStyles(), c2 = new ht();
  return new ht(o3).forValue((h9, g9, m9) => {
    const f4 = Z.deepClone(u2 == null ? void 0 : u2.getValue(h9, g9)) || {}, C = l4.getStyleByCell(f4), p3 = l4.getStyleByCell(m9);
    f4.s = Xa(C, p3), c2.setValue(h9, g9, tu(f4));
  }), __spreadProps(__spreadValues({}, e), {
    options: {},
    cellValue: c2.getMatrix()
  });
};
var ee2 = {
  id: "sheet.mutation.set-range-values",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const { cellValue: t3, subUnitId: s2, unitId: o3 } = e, i = n3.get(br).getUnit(o3);
    if (!i)
      return false;
    const a4 = i.getSheetBySheetId(s2);
    if (!a4)
      return false;
    const u2 = a4.getCellMatrix(), l4 = i.getStyles();
    return new ht(t3).forValue((d2, h9, g9) => {
      if (!g9)
        u2.realDeleteValue(d2, h9);
      else {
        let m9 = u2.getValue(d2, h9) || {};
        m9 = su(g9, m9, l4), Z.isEmptyObject(m9) ? u2.realDeleteValue(d2, h9) : u2.setValue(d2, h9, m9);
      }
    }), true;
  }
};
var nu2 = /* @__PURE__ */ new Set(["f", "p", "si", "custom", "ref", "xf"]);
function su(n3, e, t3) {
  const s2 = ga2(t3, n3, e);
  return Object.keys(n3).forEach((o3) => {
    const r = o3;
    if (nu2.has(r)) {
      const i = n3[r];
      ou(e, r, i);
    } else r === "v" ? n3.v !== void 0 && (e.v = go2(s2, n3)) : r === "s" && Ya(t3, e, n3);
  }), e.v !== void 0 && (e.t = s2, e.v = go2(s2, e)), e.v === null && (delete e.t, delete e.v), e;
}
function ou(n3, e, t3) {
  t3 === void 0 || (t3 === null ? delete n3[e] : n3[e] = t3);
}
var ru2 = (n3, e) => {
  const { unitId: t3, subUnitId: s2, rowData: o3 } = n3, r = {}, i = e.getRowManager();
  for (const a4 in o3) {
    const u2 = o3[a4], l4 = i.getRow(Number(a4));
    r[a4] = za2(l4, u2);
  }
  return {
    unitId: t3,
    subUnitId: s2,
    rowData: r
  };
};
var Kt2 = {
  id: "sheet.mutation.set-row-data",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const { rowData: t3 } = e, s2 = n3.get(br), o3 = P5(s2, e);
    if (!o3) return false;
    const { worksheet: r } = o3, i = r.getRowManager();
    for (const a4 in t3) {
      const u2 = t3[a4];
      if (u2 == null) {
        i.removeRow(Number(a4));
        continue;
      }
      const l4 = i.getRowOrCreate(Number(a4));
      Object.assign(l4, u2);
    }
    return true;
  }
};
var iu = (n3, e) => {
  if (n3.get(br).getUniverSheetInstance(e.unitId) == null)
    throw new Error("universheet is null error!");
  return {
    unitId: e.unitId,
    subUnitId: e.subUnitId,
    ranges: e.ranges
  };
};
var Ut2 = {
  id: "sheet.mutation.set-row-visible",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const s2 = n3.get(br).getUniverSheetInstance(e.unitId);
    if (s2 == null)
      throw new Error("universheet is null error!");
    const o3 = s2.getSheetBySheetId(e.subUnitId).getRowManager();
    for (let r = 0; r < e.ranges.length; r++) {
      const i = e.ranges[r];
      for (let a4 = i.startRow; a4 < i.endRow + 1; a4++) {
        const u2 = o3.getRowOrCreate(a4);
        u2 != null && (u2.hd = 0);
      }
    }
    return true;
  }
};
var au = (n3, e) => {
  if (n3.get(br).getUniverSheetInstance(e.unitId) == null)
    throw new Error("universheet is null error!");
  return {
    unitId: e.unitId,
    subUnitId: e.subUnitId,
    ranges: e.ranges
  };
};
var Tt = {
  id: "sheet.mutation.set-row-hidden",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const s2 = n3.get(br).getUniverSheetInstance(e.unitId);
    if (s2 == null)
      throw new Error("universheet is null error!");
    const o3 = s2.getSheetBySheetId(e.subUnitId).getRowManager();
    for (let r = 0; r < e.ranges.length; r++) {
      const i = e.ranges[r];
      for (let a4 = i.startRow; a4 < i.endRow + 1; a4++) {
        const u2 = o3.getRowOrCreate(a4);
        u2 != null && (u2.hd = 1);
      }
    }
    return true;
  }
};
var Zo = (n3, e) => {
  const { unitId: t3, subUnitId: s2, ranges: o3 } = n3, r = {}, i = e.getColumnManager();
  for (let a4 = 0; a4 < o3.length; a4++) {
    const u2 = o3[a4];
    for (let l4 = u2.startColumn; l4 < u2.endColumn + 1; l4++)
      r[l4] = i.getColumnWidth(l4);
  }
  return {
    unitId: t3,
    subUnitId: s2,
    ranges: o3,
    colWidth: r
  };
};
var mt2 = {
  id: "sheet.mutation.set-worksheet-col-width",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const t3 = n3.get(br), s2 = P5(t3, e);
    if (!s2) return false;
    const { worksheet: o3 } = s2, r = o3.getColumnManager(), i = e.ranges;
    for (let a4 = 0; a4 < i.length; a4++) {
      const u2 = i[a4];
      for (let l4 = u2.startColumn; l4 < u2.endColumn + 1; l4++)
        o3.getColVisible(l4) && (typeof e.colWidth == "number" ? r.setColumnWidth(l4, e.colWidth) : Z.isDefine(e.colWidth[l4]) && r.setColumnWidth(l4, e.colWidth[l4]));
    }
    return true;
  }
};
var uu = (n3, e) => {
  const t3 = Qe2(n3.get(br), e);
  if (!t3)
    throw new Error("[SetWorksheetColumnCountUndoMutationFactory]: worksheet is null error!");
  return {
    unitId: e.unitId,
    subUnitId: e.subUnitId,
    columnCount: t3.worksheet.getColumnCount()
  };
};
var Jt2 = {
  id: "sheet.mutation.set-worksheet-column-count",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const t3 = n3.get(br), s2 = Qe2(t3, e);
    return s2 ? (s2.worksheet.setColumnCount(e.columnCount), true) : false;
  }
};
var qt = {
  id: "sheet.mutation.set-worksheet-default-style",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const { defaultStyle: t3 } = e, s2 = n3.get(br), o3 = P5(s2);
    if (!o3) return false;
    const { worksheet: r } = o3;
    return r ? (r.setDefaultCellStyle(t3), true) : false;
  }
};
var lu = (n3, e) => {
  const t3 = Qe2(n3.get(br), e);
  if (!t3)
    throw new Error("[SetWorksheetDefaultStyleMutationFactory]: worksheet is null error!");
  const { worksheet: s2 } = t3;
  return {
    unitId: e.unitId,
    subUnitId: s2.getSheetId(),
    defaultStyle: s2.getDefaultCellStyle()
  };
};
var cu = (n3, e) => {
  const t3 = Qe2(n3.get(br), e);
  if (!t3)
    throw new Error("[SetWorksheetRowCountUndoMutationFactory]: worksheet is null error!");
  return {
    unitId: e.unitId,
    subUnitId: e.subUnitId,
    rowCount: t3.worksheet.getRowCount()
  };
};
var Yt2 = {
  id: "sheet.mutation.set-worksheet-row-count",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const t3 = n3.get(br), s2 = Qe2(t3, e);
    return s2 ? (s2.worksheet.setRowCount(e.rowCount), true) : false;
  }
};
var Qo2 = (n3, e) => {
  var a4, u2;
  const { unitId: t3, subUnitId: s2, ranges: o3 } = n3, r = {}, i = e.getRowManager();
  for (const { startRow: l4, endRow: c2 } of o3)
    for (let d2 = l4; d2 < c2 + 1; d2++)
      r[d2] = (u2 = (a4 = i.getRow(d2)) == null ? void 0 : a4.h) != null ? u2 : e.getConfig().defaultRowHeight;
  return {
    unitId: t3,
    subUnitId: s2,
    ranges: o3,
    rowHeight: r
  };
};
var Vs = (n3, e) => {
  var a4;
  const { unitId: t3, subUnitId: s2, ranges: o3 } = n3, r = {}, i = e.getRowManager();
  for (const { startRow: u2, endRow: l4 } of o3)
    for (let c2 = u2; c2 <= l4; c2++)
      r[c2] = (a4 = i.getRow(c2)) == null ? void 0 : a4.ia;
  return {
    unitId: t3,
    subUnitId: s2,
    ranges: o3,
    autoHeightInfo: r
  };
};
var yh2 = (n3, e) => {
  var a4, u2;
  const { unitId: t3, subUnitId: s2, rowsAutoHeightInfo: o3 } = n3, r = [], i = e.getRowManager();
  for (const l4 of o3) {
    const { row: c2 } = l4;
    r.push({
      row: c2,
      autoHeight: (u2 = (a4 = i.getRow(c2)) == null ? void 0 : a4.ah) != null ? u2 : e.getConfig().defaultRowHeight
    });
  }
  return {
    unitId: t3,
    subUnitId: s2,
    rowsAutoHeightInfo: r
  };
};
var nt2 = {
  id: "sheet.mutation.set-worksheet-row-height",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const { ranges: t3, rowHeight: s2 } = e, o3 = n3.get(br), r = P5(o3, e);
    if (!r) return false;
    const { worksheet: i } = r, a4 = i.getRowManager();
    for (const { startRow: u2, endRow: l4 } of t3)
      for (let c2 = u2; c2 <= l4; c2++)
        typeof s2 == "number" ? a4.setRowHeight(c2, s2) : Z.isDefine(s2[c2]) && a4.setRowHeight(c2, s2[c2]);
    return true;
  }
};
var Fe3 = {
  id: "sheet.mutation.set-worksheet-row-is-auto-height",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    var a4;
    const { ranges: t3, autoHeightInfo: s2 } = e, o3 = n3.get(br), r = P5(o3, e);
    if (!r) return false;
    const i = r.worksheet.getRowManager();
    for (const { startRow: u2, endRow: l4 } of t3)
      for (let c2 = u2; c2 <= l4; c2++) {
        const d2 = i.getRowOrCreate(c2);
        typeof s2 == "number" ? d2.ia = s2 : d2.ia = (a4 = s2[c2]) != null ? a4 : void 0;
      }
    return true;
  }
};
var er2 = {
  id: "sheet.mutation.set-worksheet-row-auto-height",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const { rowsAutoHeightInfo: t3 } = e, s2 = n3.get(br), o3 = P5(s2, e);
    if (!o3) return false;
    const r = o3.worksheet.getRowManager();
    for (const { row: i, autoHeight: a4 } of t3) {
      const u2 = r.getRowOrCreate(i);
      u2.ah = a4;
    }
    return true;
  }
};
var Xt2 = {
  id: "sheet.mutation.toggle-gridlines",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const t3 = P5(n3.get(br), e);
    if (!t3) return false;
    const { worksheet: s2 } = t3, o3 = s2.getConfig();
    return o3.showGridlines = e.showGridlines, true;
  }
};
var pn = {
  id: "sheet.operation.set-worksheet-active",
  type: Ls.OPERATION,
  handler: (n3, e) => {
    const t3 = n3.get(br).getUniverSheetInstance(e.unitId);
    if (!t3) return false;
    const s2 = t3.getWorksheets();
    for (const [, o3] of s2)
      if (o3.getSheetId() === e.subUnitId)
        return t3.setActiveSheet(o3), true;
    return false;
  }
};
var du = ((n3) => (n3.SET_WORKSHEET_ROW_HEIGHT = "sheet.mutation.set-worksheet-row-height", n3.SET_WORKSHEET_ROW_IS_AUTO_HEIGHT = "sheet.mutation.set-worksheet-row-is-auto-height", n3.SET_WORKSHEET_ROW_AUTO_HEIGHT = "sheet.mutation.set-worksheet-row-auto-height", n3.SET_WORKSHEET_COL_WIDTH = "sheet.mutation.set-worksheet-col-width", n3.SET_WORKSHEET_ACTIVE = "sheet.operation.set-worksheet-active", n3.MOVE_ROWS = "sheet.mutation.move-rows", n3.MOVE_COLUMNS = "sheet.mutation.move-columns", n3.SET_COL_HIDDEN = "sheet.mutation.set-col-hidden", n3.SET_COL_VISIBLE = "sheet.mutation.set-col-visible", n3.SET_ROW_HIDDEN = "sheet.mutation.set-row-hidden", n3.SET_ROW_VISIBLE = "sheet.mutation.set-row-visible", n3.INSERT_COL = "sheet.mutation.insert-col", n3.INSERT_ROW = "sheet.mutation.insert-row", n3.REMOVE_COL = "sheet.mutation.remove-col", n3.REMOVE_ROW = "sheet.mutation.remove-rows", n3.TOGGLE_GRIDLINES = "sheet.mutation.toggle-gridlines", n3.SET_GRIDLINES_COLOR = "sheet.mutation.set-gridlines-color", n3))(du || {});
var hu = ((n3) => (n3.SET_RANGE_VALUES = "sheet.mutation.set-range-values", n3.MOVE_RANGE = "sheet.mutation.move-range", n3.REMOVE_WORKSHEET_MERGE = "sheet.mutation.remove-worksheet-merge", n3.ADD_WORKSHEET_MERGE = "sheet.mutation.add-worksheet-merge", n3.REORDER_RANGE = "sheet.mutation.reorder-range", n3.SET_WORKSHEET_DEFAULT_STYLE = "sheet.mutation.set-worksheet-default-style", n3.SET_ROW_DATA = "sheet.mutation.set-row-data", n3.SET_COL_DATA = "sheet.mutation.set-col-data", n3.SET_WORKSHEET_RANGE_THEME_STYLE = "sheet.mutation.set-worksheet-range-theme-style", n3.DELETE_WORKSHEET_RANGE_THEME_STYLE = "sheet.mutation.delete-worksheet-range-theme-style", n3))(hu || {});
var bh2 = [
  nt2.id,
  Fe3.id,
  er2.id,
  mt2.id,
  pn.id,
  Je3.id,
  qe2.id,
  sn.id,
  on.id,
  Tt.id,
  Ut2.id,
  Ue2.id,
  ke2.id,
  Me.id,
  Te.id,
  Xt2.id,
  Gt.id,
  Yt2.id,
  Jt2.id
];
var Eh2 = [
  ee2.id,
  wt2.id,
  se2.id,
  ne.id,
  On2.id,
  qt.id,
  Kt2.id,
  zt.id,
  tn.id,
  nn2.id
];
function kh(n3) {
  switch (n3.id) {
    case "sheet.mutation.set-range-values": {
      const e = n3.params, t3 = new ht(e.cellValue).getDataRange();
      return t3.endRow === -1 ? [] : e.cellValue ? [{
        unitId: e.unitId,
        subUnitId: e.subUnitId,
        range: t3
      }] : [];
    }
    case "sheet.mutation.move-range": {
      const e = n3.params;
      return [{
        unitId: e.unitId,
        subUnitId: e.from.subUnitId,
        range: new ht(e.from.value).getRange()
      }, {
        unitId: e.unitId,
        subUnitId: e.to.subUnitId,
        range: new ht(e.to.value).getRange()
      }];
    }
    case "sheet.mutation.remove-worksheet-merge": {
      const e = n3.params;
      return e.ranges.map((t3) => ({
        unitId: e.unitId,
        subUnitId: e.subUnitId,
        range: t3
      }));
    }
    case "sheet.mutation.add-worksheet-merge": {
      const e = n3.params;
      return e.ranges.map((t3) => ({
        unitId: e.unitId,
        subUnitId: e.subUnitId,
        range: t3
      }));
    }
    case "sheet.mutation.reorder-range": {
      const e = n3.params;
      return [{
        unitId: e.unitId,
        subUnitId: e.subUnitId,
        range: e.range
      }];
    }
    case "sheet.mutation.set-worksheet-default-style": {
      const e = n3.params;
      return [{
        unitId: e.unitId,
        subUnitId: e.subUnitId,
        range: { startRow: 0, endRow: Number.MAX_SAFE_INTEGER, startColumn: 0, endColumn: Number.MAX_SAFE_INTEGER }
      }];
    }
    case "sheet.mutation.set-row-data": {
      const e = n3.params, t3 = Object.keys(e.rowData).map(Number);
      return t3.length === 0 ? [] : [{
        unitId: e.unitId,
        subUnitId: e.subUnitId,
        range: {
          startRow: Math.min(...t3),
          endRow: Math.max(...t3),
          startColumn: 0,
          endColumn: Number.MAX_SAFE_INTEGER
        }
      }];
    }
    case "sheet.mutation.set-col-data": {
      const e = n3.params, t3 = Object.keys(e.columnData).map(Number);
      return t3.length === 0 ? [] : [{
        unitId: e.unitId,
        subUnitId: e.subUnitId,
        range: {
          startRow: 0,
          endRow: Number.MAX_SAFE_INTEGER,
          startColumn: Math.min(...t3),
          endColumn: Math.max(...t3)
        }
      }];
    }
    case "sheet.mutation.set-worksheet-range-theme-style":
    case "sheet.mutation.delete-worksheet-range-theme-style": {
      const e = n3.params;
      return [{
        unitId: e.unitId,
        subUnitId: e.subUnitId,
        range: e.range
      }];
    }
    default:
      return [];
  }
}
function Uh(n3, e) {
  switch (n3.id) {
    case "sheet.mutation.set-worksheet-row-height":
    case "sheet.mutation.set-worksheet-row-is-auto-height": {
      const t3 = n3.params;
      return t3.ranges.map((s2) => ({
        unitId: t3.unitId,
        subUnitId: t3.subUnitId,
        range: __spreadProps(__spreadValues({}, s2), {
          rangeType: ge.ROW
        })
      }));
    }
    case "sheet.mutation.set-worksheet-row-auto-height": {
      const t3 = n3.params;
      return t3.rowsAutoHeightInfo.map((s2) => ({
        unitId: t3.unitId,
        subUnitId: t3.subUnitId,
        range: {
          startRow: s2.row,
          endRow: s2.row,
          startColumn: 0,
          endColumn: e - 1,
          rangeType: ge.ROW
        }
      }));
    }
    case "sheet.mutation.set-worksheet-col-width": {
      const t3 = n3.params;
      return t3.ranges.map((s2) => ({
        unitId: t3.unitId,
        subUnitId: t3.subUnitId,
        range: __spreadProps(__spreadValues({}, s2), {
          rangeType: ge.COLUMN
        })
      }));
    }
    case "sheet.mutation.move-rows":
    case "sheet.mutation.move-columns": {
      const t3 = n3.params;
      return [{
        unitId: t3.unitId,
        subUnitId: t3.subUnitId,
        range: t3.targetRange
      }, {
        unitId: t3.unitId,
        subUnitId: t3.subUnitId,
        range: t3.sourceRange
      }];
    }
    case "sheet.mutation.set-col-hidden":
    case "sheet.mutation.set-col-visible": {
      const t3 = n3.params;
      return t3.ranges.map((s2) => ({
        unitId: t3.unitId,
        subUnitId: t3.subUnitId,
        range: __spreadProps(__spreadValues({}, s2), {
          rangeType: ge.COLUMN
        })
      }));
    }
    case "sheet.mutation.set-row-hidden":
    case "sheet.mutation.set-row-visible": {
      const t3 = n3.params;
      return t3.ranges.map((s2) => ({
        unitId: t3.unitId,
        subUnitId: t3.subUnitId,
        range: __spreadProps(__spreadValues({}, s2), {
          rangeType: ge.ROW
        })
      }));
    }
    case "sheet.mutation.insert-col": {
      const t3 = n3.params;
      return [{
        unitId: t3.unitId,
        subUnitId: t3.subUnitId,
        range: __spreadProps(__spreadValues({}, t3.range), {
          rangeType: ge.COLUMN
        })
      }];
    }
    case "sheet.mutation.insert-row": {
      const t3 = n3.params;
      return [{
        unitId: t3.unitId,
        subUnitId: t3.subUnitId,
        range: __spreadProps(__spreadValues({}, t3.range), {
          rangeType: ge.ROW
        })
      }];
    }
    case "sheet.mutation.remove-col": {
      const t3 = n3.params;
      return [{
        unitId: t3.unitId,
        subUnitId: t3.subUnitId,
        range: __spreadProps(__spreadValues({}, t3.range), {
          rangeType: ge.COLUMN
        })
      }];
    }
    case "sheet.mutation.remove-rows": {
      const t3 = n3.params;
      return [{
        unitId: t3.unitId,
        subUnitId: t3.subUnitId,
        range: __spreadProps(__spreadValues({}, t3.range), {
          rangeType: ge.ROW
        })
      }];
    }
    case "sheet.mutation.toggle-gridlines":
    case "sheet.mutation.set-gridlines-color":
      return [];
    default:
      return [];
  }
}
function mo(n3) {
  return n3 == null ? false : n3.v !== void 0 && n3.v !== null && n3.v !== "" || n3.p !== void 0;
}
function us(n3, e) {
  return n3 && n3.spanAnchor ? mo(e.getValue(n3.spanAnchor.startRow, n3.spanAnchor.startColumn)) : mo(n3);
}
function gu(n3, e, t3, s2, o3) {
  const r = n3.getCellMatrix(), i = n3.getSpanModel().getMergedCellRange(e, t3, s2, o3), a4 = new ht();
  return r.forValue((u2, l4) => {
    const c2 = r.getValue(u2, l4);
    c2 && a4.setValue(u2, l4, c2);
  }), i.forEach((u2) => {
    const { startColumn: l4, startRow: c2, endColumn: d2, endRow: h9 } = u2;
    fl(c2, h9, l4, d2).forEach((g9, m9) => {
      g9 === c2 && m9 === l4 && a4.setValue(g9, m9, __spreadProps(__spreadValues({}, r.getValue(g9, m9)), {
        spanAnchor: { startRow: c2, endRow: h9, startColumn: l4, endColumn: d2 }
      })), (g9 !== c2 || m9 !== l4) && (a4.realDeleteValue(g9, m9), a4.setValue(g9, m9, {
        spanAnchor: { startRow: c2, endRow: h9, startColumn: l4, endColumn: d2 }
      }));
    });
  }), a4;
}
function mu(n3, e, t3, s2) {
  const { startRow: o3, startColumn: r, endRow: i } = n3;
  let a4 = null, u2 = false;
  for (let l4 = o3; l4 <= i; l4++) {
    const c2 = e.getValue(l4, r - t3);
    if (u2 = u2 || us(c2, e), !s2 && u2)
      break;
    c2 && c2.spanAnchor && (a4 ? a4 = {
      startRow: Math.min(c2.spanAnchor.startRow, a4.startRow),
      startColumn: Math.min(c2.spanAnchor.startColumn, a4.startColumn),
      endRow: Math.max(c2.spanAnchor.endRow, a4.endRow),
      endColumn: Math.max(c2.spanAnchor.endColumn, a4.endColumn)
    } : a4 = {
      startRow: c2.spanAnchor.startRow,
      startColumn: c2.spanAnchor.startColumn,
      endRow: c2.spanAnchor.endRow,
      endColumn: c2.spanAnchor.endColumn
    });
  }
  return u2 ? (n3.startColumn = n3.startColumn - t3, {
    spanAnchor: a4,
    hasValue: true,
    range: n3
  }) : {
    spanAnchor: null,
    hasValue: false,
    range: n3
  };
}
function fu2(n3, e, t3, s2) {
  const { startRow: o3, endColumn: r, endRow: i } = n3;
  let a4 = null, u2 = false;
  for (let l4 = o3; l4 <= i; l4++) {
    const c2 = e.getValue(l4, r + t3);
    if (u2 = u2 || us(c2, e), !s2 && u2)
      break;
    c2 && c2.spanAnchor && (a4 ? a4 = {
      startRow: Math.min(c2.spanAnchor.startRow, a4.startRow),
      startColumn: Math.min(c2.spanAnchor.startColumn, a4.startColumn),
      endRow: Math.max(c2.spanAnchor.endRow, a4.endRow),
      endColumn: Math.max(c2.spanAnchor.endColumn, a4.endColumn)
    } : a4 = {
      startRow: c2.spanAnchor.startRow,
      startColumn: c2.spanAnchor.startColumn,
      endRow: c2.spanAnchor.endRow,
      endColumn: c2.spanAnchor.endColumn
    });
  }
  return u2 ? (n3.endColumn = n3.endColumn + t3, {
    spanAnchor: a4,
    hasValue: true,
    range: n3
  }) : {
    spanAnchor: null,
    hasValue: false,
    range: n3
  };
}
function Ru(n3, e, t3, s2) {
  const { startRow: o3, startColumn: r, endColumn: i } = n3;
  let a4 = null, u2 = false;
  for (let l4 = r; l4 <= i; l4++) {
    const c2 = e.getValue(o3 - t3, l4);
    if (u2 = u2 || us(c2, e), !s2 && u2)
      break;
    c2 && c2.spanAnchor && (a4 ? a4 = {
      startRow: Math.min(c2.spanAnchor.startRow, a4.startRow),
      startColumn: Math.min(c2.spanAnchor.startColumn, a4.startColumn),
      endRow: Math.max(c2.spanAnchor.endRow, a4.endRow),
      endColumn: Math.max(c2.spanAnchor.endColumn, a4.endColumn)
    } : a4 = {
      startRow: c2.spanAnchor.startRow,
      startColumn: c2.spanAnchor.startColumn,
      endRow: c2.spanAnchor.endRow,
      endColumn: c2.spanAnchor.endColumn
    });
  }
  return u2 ? (n3.startRow = n3.startRow - t3, {
    spanAnchor: a4,
    hasValue: true,
    range: n3
  }) : {
    spanAnchor: null,
    hasValue: false,
    range: n3
  };
}
function Cu(n3, e, t3, s2) {
  const { startColumn: o3, endColumn: r, endRow: i } = n3;
  let a4 = null, u2 = false;
  for (let l4 = o3; l4 <= r; l4++) {
    const c2 = e.getValue(i + t3, l4);
    if (u2 = u2 || us(c2, e), !s2 && u2)
      break;
    c2 && c2.spanAnchor && (a4 ? a4 = {
      startRow: Math.min(c2.spanAnchor.startRow, a4.startRow),
      startColumn: Math.min(c2.spanAnchor.startColumn, a4.startColumn),
      endRow: Math.max(c2.spanAnchor.endRow, a4.endRow),
      endColumn: Math.max(c2.spanAnchor.endColumn, a4.endColumn)
    } : a4 = {
      startRow: c2.spanAnchor.startRow,
      startColumn: c2.spanAnchor.startColumn,
      endRow: c2.spanAnchor.endRow,
      endColumn: c2.spanAnchor.endColumn
    });
  }
  return u2 ? (n3.endRow = n3.endRow + t3, {
    spanAnchor: a4,
    hasValue: true,
    range: n3
  }) : {
    spanAnchor: null,
    hasValue: false,
    range: n3
  };
}
function Th(n3, e, t3) {
  const s2 = t3.getMaxRows(), o3 = t3.getMaxColumns(), r = gu(t3, 0, 0, s2 - 1, o3 - 1), i = t3.getSnapshot().mergeData.length > 0, { left: a4, right: u2, up: l4, down: c2 } = e;
  let d2 = true, h9 = __spreadValues({}, n3);
  const g9 = [];
  for (; d2; ) {
    if (d2 = false, l4 && h9.startRow !== 0) {
      const { hasValue: m9, range: f4, spanAnchor: C } = Ru(h9, r, 1, i);
      if (C && g9.push(C), m9) {
        h9 = f4, d2 = true;
        continue;
      }
    }
    if (c2 && h9.endRow !== s2 - 1) {
      const { hasValue: m9, range: f4, spanAnchor: C } = Cu(h9, r, 1, i);
      if (C && g9.push(C), m9) {
        h9 = f4, d2 = true;
        continue;
      }
    }
    if (a4 && h9.startColumn !== 0) {
      const { hasValue: m9, range: f4, spanAnchor: C } = mu(h9, r, 1, i);
      if (C && g9.push(C), m9) {
        h9 = f4, d2 = true;
        continue;
      }
    }
    if (u2 && h9.endColumn !== o3 - 1) {
      const { hasValue: m9, range: f4, spanAnchor: C } = fu2(h9, r, 1, i);
      if (C && g9.push(C), m9) {
        h9 = f4, d2 = true;
        continue;
      }
    }
  }
  return g9.length > 0 && (h9 = Cn.union(h9, ...g9)), h9;
}
var pu = (n3) => {
  const e = new ht();
  return n3.forEach((t3) => {
    vr.foreach(t3, (s2, o3) => {
      e.setValue(s2, o3, 1);
    });
  }), e.forValue((t3, s2) => {
    const o3 = e.getValue(t3 - 1, s2);
    o3 && e.setValue(t3, s2, o3 + 1);
  }), e;
};
var Su = (n3) => {
  const e = n3;
  return e.forValue((t3, s2) => {
    const o3 = n3.getValue(t3 - 1, s2);
    o3 && e.setValue(t3, s2, o3 + 1);
  }), e;
};
var fo = (n3) => {
  const e = {
    area: 0
  }, t3 = (s2, o3) => e.area < s2 ? (e.area = s2, e.range = o3, true) : false;
  return n3.forValue((s2, o3, r) => {
    let i = 1, a4 = r;
    t3(i * a4, {
      startRow: s2 - a4 + 1,
      endRow: s2,
      startColumn: o3,
      endColumn: o3
    });
    const u2 = {
      startRow: s2 - a4 + 1,
      endRow: s2,
      startColumn: 0,
      endColumn: o3
    };
    for (let l4 = o3 - 1; l4 >= 0 && n3.getValue(s2, l4); l4--) {
      a4 = Math.min(n3.getValue(s2, l4) || 0, a4), i++;
      const c2 = a4 * i;
      u2.startColumn = l4, u2.startRow = s2 - a4 + 1, t3(c2, u2);
    }
  }), e;
};
var wu = (n3, e) => {
  vr.foreach(e, (t3, s2) => {
    n3.realDeleteValue(t3, s2);
  });
  for (let t3 = e.startColumn; t3 <= e.endColumn; t3++) {
    const s2 = e.endRow + 1;
    if (n3.getValue(s2, t3) > 0) {
      n3.setValue(s2, t3, 1);
      let r = s2 + 1;
      for (; n3.getValue(r, t3) > 0; )
        n3.setValue(r, t3, n3.getValue(r - 1, t3) + 1), r++;
    }
  }
  return n3;
};
var tr = (n3) => {
  const e = [];
  let t3 = fo(n3);
  for (; t3.area > 0; )
    t3.range && (e.push(t3.range), wu(n3, t3.range)), t3 = fo(n3);
  return e;
};
var nr3 = (n3) => {
  const e = pu(n3);
  return tr(e);
};
var Ph = class {
  constructor() {
    R(this, "_matrix", new ht());
  }
  add(...e) {
    return e.forEach((t3) => {
      vr.foreach(t3, (s2, o3) => {
        this._matrix.setValue(s2, o3, 1);
      });
    }), this;
  }
  subtract(...e) {
    return e.forEach((t3) => {
      vr.foreach(t3, (s2, o3) => {
        this._matrix.realDeleteValue(s2, o3);
      });
    }), this;
  }
  merge() {
    const e = Su(this._matrix);
    return tr(e);
  }
};
var Nh = 1.5;
var Oh = "rgba(255, 255, 255, 0.01)";
function Dh(n3) {
  const { rangeWithCoord: e, primaryWithCoord: t3, style: s2 } = n3, o3 = {
    range: {
      startRow: e.startRow,
      startColumn: e.startColumn,
      endRow: e.endRow,
      endColumn: e.endColumn,
      rangeType: e.rangeType,
      unitId: e.unitId,
      sheetId: e.sheetId
    },
    primary: null,
    style: s2
  };
  return t3 != null && (o3.primary = Iu(t3)), o3;
}
function Iu(n3) {
  const { actualRow: e, actualColumn: t3, isMerged: s2, isMergedMainCell: o3 } = n3, { startRow: r, startColumn: i, endRow: a4, endColumn: u2 } = n3.mergeInfo;
  return {
    actualRow: e,
    actualColumn: t3,
    isMerged: s2,
    isMergedMainCell: o3,
    startRow: r,
    startColumn: i,
    endRow: a4,
    endColumn: u2
  };
}
var vu = ((n3) => (n3[n3.Tab = 1] = "Tab", n3[n3.Comma = 2] = "Comma", n3[n3.Semicolon = 4] = "Semicolon", n3[n3.Space = 8] = "Space", n3[n3.Custom = 16] = "Custom", n3))(vu || {});
var Mu = class {
  constructor() {
    R(this, "_tabCount", 0);
    R(this, "_commaCount", 0);
    R(this, "_semicolonCount", 0);
    R(this, "_spaceCount", 0);
  }
  add(e) {
    switch (e) {
      case "	":
        this._tabCount++;
        break;
      case ",":
        this._commaCount++;
        break;
      case ";":
        this._semicolonCount++;
        break;
      case " ":
        this._spaceCount++;
        break;
    }
  }
  update(e) {
    e && typeof e == "string" && (e.includes("	") && this._tabCount++, e.includes(",") && this._commaCount++, e.includes(";") && this._semicolonCount++, e.trim().includes(" ") && this._spaceCount++);
  }
  getDelimiter() {
    const e = Math.max(this._tabCount, this._commaCount, this._semicolonCount, this._spaceCount);
    return e === 0 || e === this._tabCount ? 1 : e === this._commaCount ? 2 : e === this._semicolonCount ? 4 : e === this._spaceCount ? 8 : 1;
  }
};
function _u(n3, e, t3) {
  const s2 = [];
  t3 !== void 0 && (n3 & 16) > 0 && s2.push(t3), (n3 & 1) > 0 && s2.push("	"), (n3 & 2) > 0 && s2.push(","), (n3 & 4) > 0 && s2.push(";"), (n3 & 8) > 0 && s2.push(" ");
  let o3 = "";
  for (const i of s2)
    o3 += yu(i);
  let r = "[".concat(o3, "]");
  return e && (r += "+"), new RegExp(r);
}
function yu(n3) {
  return n3.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
}
var bu = (n3) => {
  var t3;
  return ((t3 = n3.body) == null ? void 0 : t3.dataStream.replace(/\r\n$/, "")) || "";
};
function Eu(n3) {
  if (n3 != null) {
    if (n3.p)
      return bu(n3.p);
    if (n3.v && typeof n3.v == "string")
      return n3.v;
    if (n3.t && (n3.t === mn.FORCE_STRING || n3.t === mn.STRING))
      return String(n3.v);
  }
}
function ku(n3, e, t3, s2, o3 = false) {
  const r = vr.transformRange(e, n3), { startColumn: i, startRow: a4, endColumn: u2, endRow: l4 } = r;
  if (i !== u2)
    throw new Error("The range must be in the same column.");
  if (t3 && (t3 & 16) > 0 && (s2 === void 0 || s2.length !== 1))
    throw new Error("The custom delimiter must a character.");
  const c2 = t3 === void 0, d2 = c2 ? new Mu() : null, h9 = [];
  for (let S = a4; S <= l4; S++) {
    const I6 = n3.getCell(S, i), y6 = Eu(I6);
    h9.push(y6), d2 && d2.update(y6);
  }
  const g9 = c2 ? d2.getDelimiter() : t3, m9 = _u(g9, o3, s2);
  let f4 = -1, C = 0, p3 = 0;
  const w6 = [];
  for (const S of h9) {
    if (S !== void 0) {
      const I6 = String(S).split(m9);
      f4 < 0 ? f4 = I6.length : f4 = Math.max(f4, I6.length), w6.push(I6), C = p3;
    } else
      w6.push(void 0);
    p3++;
  }
  return {
    rs: w6,
    maxLength: f4 === -1 ? 0 : f4,
    lastRow: C
  };
}
var Uu = (n3, e, t3 = "") => n3.reduce(
  (s2, o3) => {
    const r = o3 && o3[e];
    return typeof r != "string" ? (console.warn(o3, `${e} is not string`), s2) : (r ? (s2[r] || (s2[r] = []), s2[r].push(o3)) : s2[t3].push(o3), s2);
  },
  {}
);
var Tu = (n3 = 0) => {
  let e = n3;
  return function() {
    return e++;
  };
};
function Pu(n3) {
  return n3 == null ? false : n3.v !== void 0 && n3.v !== null && n3.v !== "" || n3.p !== void 0;
}
function Ah(n3, e) {
  for (let t3 = n3.startRow; t3 <= n3.endRow; t3++)
    for (let s2 = n3.startColumn; s2 <= n3.endColumn; s2++) {
      const o3 = e.getCell(t3, s2);
      if (Pu(o3))
        return { startRow: t3, startColumn: s2, endRow: t3, endColumn: s2 };
    }
  return null;
}
function sr2(n3) {
  const e = new ht();
  return n3.forEach((t3) => {
    const { startRow: s2, startColumn: o3, endRow: r, endColumn: i } = t3;
    for (let a4 = s2; a4 <= r; a4++)
      for (let u2 = o3; u2 <= i; u2++)
        e.setValue(a4, u2, null);
  }), e.clone();
}
function Nu(n3) {
  const e = new ht();
  return n3.forEach((t3) => {
    const { startRow: s2, startColumn: o3, endRow: r, endColumn: i } = t3;
    for (let a4 = s2; a4 <= r; a4++)
      for (let u2 = o3; u2 <= i; u2++)
        e.setValue(a4, u2, {
          v: null,
          p: null,
          f: null,
          si: null,
          custom: null
        });
  }), e.clone();
}
function Ou(n3) {
  const e = new ht();
  return n3.forEach((t3) => {
    const { startRow: s2, startColumn: o3, endRow: r, endColumn: i } = t3;
    for (let a4 = s2; a4 <= r; a4++)
      for (let u2 = o3; u2 <= i; u2++)
        e.setValue(a4, u2, {
          s: null
        });
  }), e.clone();
}
function Du(n3, e, t3, s2) {
  const o3 = e.get(br), r = t3 ? o3.getUnit(t3, we.UNIVER_SHEET) : o3.getCurrentUnitForType(we.UNIVER_SHEET), i = s2 ? r == null ? void 0 : r.getSheetBySheetId(s2) : r == null ? void 0 : r.getActiveSheet();
  if (!i)
    return null;
  const { startRow: a4, endRow: u2, startColumn: l4, endColumn: c2 } = n3, d2 = [], h9 = [];
  for (let g9 = a4; g9 <= u2; g9++)
    i.getRowFiltered(g9) || d2.push(g9);
  for (let g9 = l4; g9 <= c2; g9++)
    h9.push(g9);
  return {
    rows: d2,
    cols: h9
  };
}
function ls(n3, e, t3, s2) {
  const o3 = [], r = [];
  for (const h9 of n3) {
    const g9 = Du(h9, e, t3, s2);
    g9 && (o3.push(...g9.rows), r.push(...g9.cols));
  }
  const i = Array.from(new Set(o3)).sort((h9, g9) => h9 - g9), a4 = Array.from(new Set(r)).sort((h9, g9) => h9 - g9), u2 = [];
  function l4(h9) {
    const g9 = [];
    let m9 = h9[0];
    for (let f4 = 1; f4 < h9.length; f4++)
      h9[f4] !== h9[f4 - 1] + 1 && (g9.push([m9, h9[f4 - 1]]), m9 = h9[f4]);
    return g9.push([m9, h9[h9.length - 1]]), g9;
  }
  const c2 = l4(i), d2 = l4(a4);
  for (const [h9, g9] of c2)
    for (const [m9, f4] of d2)
      u2.push({
        startRow: h9,
        endRow: g9,
        startColumn: m9,
        endColumn: f4
      });
  return u2;
}
var Au = ((n3) => (n3.OthersCanView = "othersCanView", n3.NoOneElseCanView = "noOneElseCanView", n3))(Au || {});
var xu = ((n3) => (n3.DesignedUserCanEdit = "designedUserCanEdit", n3.OnlyMe = "onlyMe", n3))(xu || {});
var me = class {
  constructor() {
    R(this, "_model", /* @__PURE__ */ new Map());
    R(this, "_ruleChange$", new Subject());
    R(this, "ruleChange$", this._ruleChange$.asObservable());
    R(this, "_ruleRefresh$", new Subject());
    R(this, "ruleRefresh$", this._ruleRefresh$.asObservable());
    R(this, "_rangeRuleInitStateChange", new BehaviorSubject(false));
    R(this, "rangeRuleInitStateChange$", this._rangeRuleInitStateChange.asObservable());
  }
  dispose() {
    this._ruleChange$.complete(), this._ruleRefresh$.complete();
  }
  ruleRefresh(e) {
    this._ruleRefresh$.next(e);
  }
  getRangeRuleInitState() {
    return this._rangeRuleInitStateChange.value;
  }
  changeRuleInitState(e) {
    this._rangeRuleInitStateChange.next(e);
  }
  addRule(e, t3, s2) {
    this._ensureRuleMap(e, t3).set(s2.id, s2), this._ruleChange$.next({ unitId: e, subUnitId: t3, rule: s2, type: "add" });
  }
  deleteRule(e, t3, s2) {
    var r, i, a4, u2;
    const o3 = (i = (r = this._model.get(e)) == null ? void 0 : r.get(t3)) == null ? void 0 : i.get(s2);
    o3 && ((u2 = (a4 = this._model.get(e)) == null ? void 0 : a4.get(t3)) == null || u2.delete(s2), this._ruleChange$.next({ unitId: e, subUnitId: t3, rule: o3, type: "delete" }));
  }
  setRule(e, t3, s2, o3) {
    var i, a4;
    const r = this.getRule(e, t3, s2);
    r && ((a4 = (i = this._model.get(e)) == null ? void 0 : i.get(t3)) == null || a4.set(s2, o3), this._ruleChange$.next({ unitId: e, subUnitId: t3, oldRule: r, rule: o3, type: "set" }));
  }
  getRule(e, t3, s2) {
    var o3, r;
    return (r = (o3 = this._model.get(e)) == null ? void 0 : o3.get(t3)) == null ? void 0 : r.get(s2);
  }
  getSubunitRuleList(e, t3) {
    var o3;
    return [...(((o3 = this._model.get(e)) == null ? void 0 : o3.get(t3)) || /* @__PURE__ */ new Map()).values()];
  }
  getSubunitRuleListLength(e, t3) {
    var o3;
    const s2 = (o3 = this._model.get(e)) == null ? void 0 : o3.get(t3);
    return s2 ? s2.size : 0;
  }
  _ensureRuleMap(e, t3) {
    let s2 = this._model.get(e);
    s2 || (s2 = /* @__PURE__ */ new Map(), this._model.set(e, s2));
    let o3 = s2.get(t3);
    return o3 || (o3 = /* @__PURE__ */ new Map(), s2.set(t3, o3)), o3;
  }
  toObject() {
    const e = {};
    return [...this._model.keys()].forEach((s2) => {
      const o3 = this._model.get(s2), r = [...o3.keys()];
      e[s2] = {}, r.forEach((i) => {
        const a4 = o3.get(i);
        e[s2][i] = [...a4.values()];
      });
    }), e;
  }
  fromObject(e) {
    const t3 = /* @__PURE__ */ new Map();
    Object.keys(e).forEach((s2) => {
      const o3 = e[s2], r = /* @__PURE__ */ new Map();
      Object.keys(o3).forEach((i) => {
        const a4 = o3[i].reduce((u2, l4) => (u2.set(l4.id, l4), u2), /* @__PURE__ */ new Map());
        r.set(i, a4);
      }), t3.set(s2, r);
    }), this._model = t3;
  }
  deleteUnitModel(e) {
    this._model.delete(e);
  }
  createRuleId(e, t3) {
    let s2 = et(4);
    const o3 = this._ensureRuleMap(e, t3);
    for (; o3.has(s2); )
      s2 = et(4);
    return s2;
  }
  getTargetByPermissionId(e, t3) {
    const s2 = this._model.get(e);
    if (!s2) return null;
    for (const [o3, r] of s2)
      for (const i of r.values())
        if (i.permissionId === t3)
          return [e, o3];
    return null;
  }
};
var xh = (n3, e) => {
  const t3 = n3.get(me), s2 = e.ruleIds.map((r) => t3.getRule(e.unitId, e.subUnitId, r)).filter((r) => !!r);
  return { id: Be3.id, params: { subUnitId: e.subUnitId, unitId: e.unitId, rules: s2 } };
};
var ot2 = {
  id: "sheet.mutation.delete-range-protection",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const { unitId: t3, subUnitId: s2, ruleIds: o3 } = e, r = n3.get(me);
    return o3.forEach((i) => {
      r.deleteRule(t3, s2, i);
    }), true;
  }
};
var $h = (n3) => {
  const e = __spreadProps(__spreadValues({}, n3), { ruleIds: n3.rules.map((t3) => t3.id) });
  return { id: ot2.id, params: e };
};
var Be3 = {
  id: "sheet.mutation.add-range-protection",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const { unitId: t3, subUnitId: s2, rules: o3 } = e, r = n3.get(me);
    return o3.forEach((i) => {
      r.addRule(t3, s2, i);
    }), true;
  }
};
var $u = {
  type: Ls.COMMAND,
  id: "sheet.command.add-range-protection",
  handler(n3, e) {
    return __async(this, null, function* () {
      if (!e)
        return false;
      const t3 = n3.get(Ds), s2 = n3.get(ra), o3 = n3.get(me), { rule: r, permissionId: i } = e, { unitId: a4, subUnitId: u2, ranges: l4, description: c2, viewState: d2, editState: h9 } = r, g9 = [{
        ranges: l4,
        permissionId: i,
        id: o3.createRuleId(a4, u2),
        description: c2,
        unitType: r.unitType,
        unitId: a4,
        subUnitId: u2,
        viewState: d2,
        editState: h9
      }];
      if (yield t3.executeCommand(Be3.id, {
        unitId: a4,
        subUnitId: u2,
        rules: g9
      })) {
        const f4 = [{ id: Be3.id, params: { unitId: a4, subUnitId: u2, rules: g9 } }], C = [{ id: ot2.id, params: { unitId: a4, subUnitId: u2, ruleIds: g9.map((p3) => p3.id) } }];
        s2.pushUndoRedo({
          unitID: a4,
          redoMutations: f4,
          undoMutations: C
        });
      }
      return true;
    });
  }
};
var we3 = ((n3) => (n3[n3.MOVE_START = 0] = "MOVE_START", n3[n3.MOVING = 1] = "MOVING", n3[n3.MOVE_END = 2] = "MOVE_END", n3[n3.ONLY_SET = 3] = "ONLY_SET", n3))(we3 || {});
var Wu = class extends Ve {
  constructor(t3) {
    super();
    R(this, "_worksheetSelections", /* @__PURE__ */ new Map());
    R(this, "_selectionMoveStart$", new Subject());
    R(this, "selectionMoveStart$", this._selectionMoveStart$.asObservable());
    R(this, "_selectionMoving$", new Subject());
    R(this, "selectionMoving$", this._selectionMoving$.asObservable());
    R(this, "_selectionMoveEnd$", new BehaviorSubject([]));
    R(this, "selectionMoveEnd$", this._selectionMoveEnd$.asObservable());
    R(this, "_selectionSet$", new BehaviorSubject([]));
    R(this, "selectionSet$", this._selectionSet$.asObservable());
    R(this, "selectionChanged$");
    R(this, "_beforeSelectionMoveEnd$", new BehaviorSubject([]));
    R(this, "beforeSelectionMoveEnd$", this._beforeSelectionMoveEnd$.asObservable());
    this._workbook = t3, this.selectionChanged$ = merge(this._selectionMoveEnd$, this._selectionSet$);
  }
  dispose() {
    super.dispose(), this._beforeSelectionMoveEnd$.complete(), this._selectionMoveEnd$.complete(), this._selectionMoving$.complete(), this._selectionMoveStart$.complete(), this._selectionSet$.complete(), this._workbook = null;
  }
  addSelections(t3, s2) {
    const o3 = this.getSelectionsOfWorksheet(t3);
    o3.push(...s2), this._selectionSet$.next(o3);
  }
  /**
   * Set selectionDatas to _worksheetSelections, and emit selectionDatas by type.
   * @param sheetId
   * @param selectionDatas
   * @param type
   */
  setSelections(t3, s2 = [], o3) {
    switch (this.setSelectionsOfWorksheet(t3, s2), o3) {
      case we3.MOVE_START:
        this._selectionMoveStart$.next(s2);
        break;
      case we3.MOVING:
        this._selectionMoving$.next(s2);
        break;
      case we3.MOVE_END:
        this._beforeSelectionMoveEnd$.next(s2), this._selectionMoveEnd$.next(s2);
        break;
      case we3.ONLY_SET: {
        this._selectionSet$.next(s2);
        break;
      }
      default:
        this._selectionSet$.next(s2);
        break;
    }
  }
  getCurrentSelections() {
    return this._getCurrentSelections();
  }
  /**
   * @deprecated use `getSelectionsOfWorksheet` instead.
   * @param sheetId
   * @returns
   */
  getSelectionOfWorksheet(t3) {
    return this.getSelectionsOfWorksheet(t3);
  }
  getSelectionsOfWorksheet(t3) {
    return this._worksheetSelections.has(t3) || this._worksheetSelections.set(t3, []), this._worksheetSelections.get(t3);
  }
  setSelectionsOfWorksheet(t3, s2) {
    this._worksheetSelections.set(t3, [...s2]);
  }
  deleteSheetSelection(t3) {
    this._worksheetSelections.set(t3, []);
  }
  /** Clear all selections in this workbook. */
  clear() {
    this._worksheetSelections.clear(), this._selectionSet$.next([]);
  }
  _getCurrentSelections() {
    return this.getSelectionsOfWorksheet(this._workbook.getActiveSheet().getSheetId());
  }
  getCurrentLastSelection() {
    const t3 = this._getCurrentSelections();
    return t3[t3.length - 1];
  }
};
var Vu = Object.getOwnPropertyDescriptor;
var Lu = (n3, e, t3, s2) => {
  for (var o3 = s2 > 1 ? void 0 : s2 ? Vu(e, t3) : e, r = n3.length - 1, i; r >= 0; r--)
    (i = n3[r]) && (o3 = i(o3) || o3);
  return o3;
};
var Hu = (n3, e) => (t3, s2) => e(t3, s2, n3);
var z = class extends ER {
  constructor(e) {
    super();
    R(this, "_cellStylesCache", /* @__PURE__ */ new Map());
    R(this, "selectionMoveStart$");
    R(this, "selectionMoving$");
    R(this, "selectionMoveEnd$");
    R(this, "selectionSet$");
    R(this, "selectionChanged$");
    R(this, "_workbookSelections", /* @__PURE__ */ new Map());
    this._instanceSrv = e, this._init();
  }
  get _currentSelectionPos() {
    const e = this._instanceSrv.getCurrentUnitForType(we.UNIVER_SHEET);
    if (!e) return null;
    const t3 = e.getActiveSheet();
    return { unitId: e.getUnitId(), sheetId: t3.getSheetId() };
  }
  get currentSelectionParam() {
    return this._currentSelectionPos;
  }
  _init() {
    const e = this._instanceSrv.getCurrentTypeOfUnit$(we.UNIVER_SHEET).pipe(shareReplay(1), takeUntil(this.dispose$));
    this.selectionMoveStart$ = e.pipe().pipe(switchMap((t3) => t3 ? this._ensureWorkbookSelection(t3.getUnitId()).selectionMoveStart$ : of())).pipe(takeUntil(this.dispose$)), this.selectionMoving$ = e.pipe(switchMap((t3) => t3 ? this._ensureWorkbookSelection(t3.getUnitId()).selectionMoving$ : of())).pipe(takeUntil(this.dispose$)), this.selectionMoveEnd$ = e.pipe(switchMap((t3) => t3 ? this._ensureWorkbookSelection(t3.getUnitId()).selectionMoveEnd$ : of([]))).pipe(takeUntil(this.dispose$)), this.selectionSet$ = e.pipe(switchMap((t3) => t3 ? this._ensureWorkbookSelection(t3.getUnitId()).selectionSet$ : of([]))).pipe(takeUntil(this.dispose$)), this.selectionChanged$ = e.pipe(switchMap((t3) => t3 ? this._ensureWorkbookSelection(t3.getUnitId()).selectionChanged$ : of([]))).pipe(
      distinctUntilChanged((t3, s2) => t3.length !== s2.length ? false : t3.length === 0 && s2.length === 0 ? true : t3.every((o3, r) => JSON.stringify(o3) === JSON.stringify(s2[r]))),
      skip(1)
    ).pipe(takeUntil(this.dispose$)), this.disposeWithMe(
      this._instanceSrv.getTypeOfUnitDisposed$(we.UNIVER_SHEET).pipe(takeUntil(this.dispose$)).subscribe((t3) => {
        this._removeWorkbookSelection(t3.getUnitId());
      })
    ), this.disposeWithMe(
      this.selectionChanged$.pipe(takeUntil(this.dispose$)).subscribe(() => {
        this._cellStylesCache.clear();
      })
    );
  }
  dispose() {
    super.dispose(), this._cellStylesCache.clear(), this._workbookSelections.forEach((e) => e.dispose()), this._workbookSelections.clear(), this.selectionMoveStart$ = of(null), this.selectionMoving$ = of(null), this.selectionMoveEnd$ = of([]), this.selectionSet$ = of(null), this.selectionChanged$ = of(null);
  }
  /**
   * Clear all selections in all workbooks.
   * invoked by prompt.controller
   */
  clear() {
    this._workbookSelections.forEach((e) => e.clear());
  }
  getCurrentSelections() {
    return this._getCurrentSelections();
  }
  getCurrentLastSelection() {
    const e = this._getCurrentSelections();
    return e == null ? void 0 : e[e.length - 1];
  }
  addSelections(e, t3, s2) {
    if (typeof e == "string") {
      this._ensureWorkbookSelection(e).addSelections(t3, s2);
      return;
    }
    const o3 = this._currentSelectionPos;
    if (!o3)
      throw new Error("[SheetsSelectionsService]: cannot find current selection position!");
    const { unitId: r, sheetId: i } = o3;
    this._ensureWorkbookSelection(r).addSelections(i, e);
  }
  setSelections(e, t3, s2, o3) {
    if (typeof e == "string" && typeof t3 == "string") {
      const u2 = e;
      this._ensureWorkbookSelection(u2).setSelections(
        t3,
        s2 || [],
        o3 != null ? o3 : we3.ONLY_SET
      );
      return;
    }
    const r = this._currentSelectionPos;
    if (!r)
      throw new Error("[SheetsSelectionsService]: cannot find current selection position!");
    const { unitId: i, sheetId: a4 } = r;
    if (typeof e == "object") {
      const u2 = e != null ? e : s2, l4 = t3 != null ? t3 : we3.ONLY_SET;
      this._ensureWorkbookSelection(i).setSelections(a4, u2, l4);
    }
  }
  clearCurrentSelections() {
    this._getCurrentSelections().splice(0);
  }
  /**
   * Determine whether multiple current selections overlap
   *
   * @deprecated this should be extracted to an pure function
   */
  isOverlapping() {
    const e = this.getCurrentSelections();
    return e == null ? false : e.some(
      ({ range: t3 }, s2) => e.some(({ range: o3 }, r) => s2 === r ? false : t3.startRow <= o3.endRow && t3.endRow >= o3.startRow && t3.startColumn <= o3.endColumn && t3.endColumn >= o3.startColumn)
    );
  }
  _getCurrentSelections() {
    const e = this._currentSelectionPos;
    if (!e)
      return [];
    const { unitId: t3, sheetId: s2 } = e;
    return this._ensureWorkbookSelection(t3).getSelectionsOfWorksheet(s2);
  }
  getWorkbookSelections(e) {
    return this._ensureWorkbookSelection(e);
  }
  _ensureWorkbookSelection(e) {
    let t3 = this._workbookSelections.get(e);
    if (!t3) {
      const s2 = this._instanceSrv.getUnit(e);
      if (!s2)
        throw new Error(`[SheetsSelectionsService]: cannot resolve unit with id "${e}"!`);
      t3 = new Wu(s2), this._workbookSelections.set(e, t3);
    }
    return t3;
  }
  _removeWorkbookSelection(e) {
    this._workbookSelections.delete(e);
  }
  /**
   * This method is used to get the common value of a specific cell style property in the current selections.
   * Used to determine the state related to color panels in the toolbar.
   * Because in Excel, only the color panels need to show the common color of the current selections, other properties based on the current selection primary cell.
   * Now only handles text color, fill color, border style, border color.
   */
  getCellStylesProperty(e) {
    var r;
    const t3 = (r = this._instanceSrv.getCurrentUnitForType(we.UNIVER_SHEET)) == null ? void 0 : r.getActiveSheet(), s2 = this.getCurrentSelections();
    if (!t3 || s2.length === 0)
      return {
        isAllValuesSame: false,
        value: null
      };
    let o3 = null;
    for (let i = 0; i < s2.length; i++) {
      const a4 = s2[i], { startRow: u2, endRow: l4, startColumn: c2, endColumn: d2 } = a4.range;
      for (let h9 = u2; h9 <= l4; h9++)
        for (let g9 = c2; g9 <= d2; g9++) {
          const m9 = `${h9}_${g9}`;
          let f4;
          this._cellStylesCache.has(m9) ? f4 = this._cellStylesCache.get(m9) : (f4 = t3.getComposedCellStyle(h9, g9), this._cellStylesCache.set(m9, f4));
          const C = f4[e];
          if (o3 != null && !Z.diffValue(o3, C))
            return {
              isAllValuesSame: false,
              value: null
            };
          o3 = C;
        }
    }
    return {
      isAllValuesSame: true,
      value: o3
    };
  }
};
z = Lu([
  Hu(0, br)
], z);
var Wh = "DISABLE_NORMAL_SELECTIONS";
var Vh = "SELECTIONS_ENABLED";
var Fu = "REF_SELECTIONS_ENABLED";
var Ls2 = {
  id: "sheet.command.clear-selection-all",
  type: Ls.COMMAND,
  handler: (n3, e) => {
    var S;
    const t3 = n3.get(br), s2 = n3.get(Ds), o3 = n3.get(z), r = n3.get(ra), i = n3.get(G), a4 = t3.getCurrentUnitForType(we.UNIVER_SHEET);
    if (!a4) return false;
    const u2 = (e == null ? void 0 : e.unitId) || a4.getUnitId(), l4 = a4.getActiveSheet();
    if (!l4) return false;
    const c2 = (e == null ? void 0 : e.subUnitId) || l4.getSheetId(), d2 = (e == null ? void 0 : e.ranges) || ((S = o3.getCurrentSelections()) == null ? void 0 : S.map((I6) => I6.range));
    if (!(d2 != null && d2.length))
      return false;
    const h9 = ls(d2, n3, u2, c2), g9 = [], m9 = [], f4 = {
      subUnitId: c2,
      unitId: u2,
      cellValue: sr2(h9)
    }, C = Ae4(
      n3,
      f4
    );
    g9.push({
      id: ee2.id,
      params: f4
    }), m9.push({
      id: ee2.id,
      params: C
    });
    const p3 = i.onCommandExecute({ id: Ls2.id });
    return g9.push(...p3.redos), m9.unshift(...p3.undos), po(g9, s2) ? (r.pushUndoRedo({
      // If there are multiple mutations that form an encapsulated project, they must be encapsulated in the same undo redo element.
      // Hooks can be used to hook the code of external controllers to add new actions.
      unitID: u2,
      undoMutations: m9,
      redoMutations: g9
    }), true) : false;
  }
};
var Hs2 = {
  id: "sheet.command.clear-selection-format",
  type: Ls.COMMAND,
  handler: (n3, e) => {
    var S;
    const t3 = n3.get(br), s2 = n3.get(Ds), o3 = n3.get(z), r = n3.get(ra), i = n3.get(G), a4 = t3.getCurrentUnitForType(we.UNIVER_SHEET);
    if (!a4) return false;
    const u2 = (e == null ? void 0 : e.unitId) || a4.getUnitId(), l4 = a4.getActiveSheet();
    if (!l4) return false;
    const c2 = (e == null ? void 0 : e.subUnitId) || l4.getSheetId(), d2 = (e == null ? void 0 : e.ranges) || ((S = o3.getCurrentSelections()) == null ? void 0 : S.map((I6) => I6.range));
    if (!(d2 != null && d2.length))
      return false;
    const h9 = ls(d2, n3, u2, c2), g9 = [], m9 = [], f4 = {
      subUnitId: c2,
      unitId: u2,
      cellValue: Ou(h9)
    }, C = Ae4(
      n3,
      f4
    );
    g9.push({
      id: ee2.id,
      params: f4
    }), m9.push({
      id: ee2.id,
      params: C
    });
    const p3 = i.onCommandExecute({ id: Hs2.id });
    return g9.push(...p3.redos), m9.unshift(...p3.undos), po(g9, s2) ? (r.pushUndoRedo({
      // If there are multiple mutations that form an encapsulated project, they must be encapsulated in the same undo redo element.
      // Hooks can be used to hook the code of external controllers to add new actions.
      unitID: u2,
      undoMutations: m9,
      redoMutations: g9
    }), true) : false;
  }
};
function cs2(n3, e, t3 = true) {
  const s2 = e.getMatrixWithMergedCells(...$R(n3)), o3 = [];
  if (s2.forValue((i, a4, u2) => {
    if (u2.colSpan !== void 0 && u2.rowSpan !== void 0) {
      const l4 = {
        startRow: i,
        startColumn: a4,
        endRow: i + u2.rowSpan - 1,
        endColumn: a4 + u2.colSpan - 1
      };
      Cn.contains(n3, l4) || o3.push(l4);
    }
  }), o3.length === 0)
    return n3;
  const r = Cn.union(n3, ...o3);
  return t3 ? cs2(r, e, t3) : r;
}
function Lh(n3, e, t3) {
  let s2 = null;
  return t3.getMatrixWithMergedCells(n3, e, n3, e).forValue((r, i, a4) => (s2 = {
    actualRow: r,
    actualColumn: i,
    startRow: r,
    startColumn: i,
    isMerged: a4.rowSpan !== void 0 || a4.colSpan !== void 0,
    isMergedMainCell: a4.rowSpan !== void 0 && a4.colSpan !== void 0,
    endRow: r + (a4.rowSpan !== void 0 ? a4.rowSpan - 1 : 0),
    endColumn: i + (a4.colSpan !== void 0 ? a4.colSpan - 1 : 0),
    rangeType: ge.NORMAL
  }, false)), s2 || {
    actualColumn: e,
    actualRow: n3,
    startRow: n3,
    startColumn: e,
    endRow: n3,
    endColumn: e,
    isMerged: false,
    isMergedMainCell: false,
    rangeType: ge.NORMAL
  };
}
function Hh(n3, e, t3) {
  const { startRow: s2, startColumn: o3, endRow: r, endColumn: i } = n3;
  return Number.isNaN(s2) && (n3.startRow = 0), Number.isNaN(r) && (n3.endRow = e - 1), Number.isNaN(o3) && (n3.startColumn = 0), Number.isNaN(i) && (n3.endColumn = t3 - 1), n3;
}
function _e3(n3, e) {
  const t3 = Number.isNaN(n3.startRow) ? 0 : n3.startRow, s2 = Number.isNaN(n3.startColumn) ? 0 : n3.startColumn, o3 = e.getMergedCell(t3, s2);
  return o3 ? __spreadProps(__spreadValues({}, o3), {
    actualRow: t3,
    actualColumn: s2,
    rangeType: ge.NORMAL,
    isMerged: true,
    isMergedMainCell: true
  }) : {
    startRow: t3,
    startColumn: s2,
    endRow: n3.startRow,
    endColumn: n3.startColumn,
    actualRow: t3,
    actualColumn: s2,
    rangeType: ge.NORMAL,
    isMerged: false,
    isMergedMainCell: false
  };
}
var ut2 = (n3, e, t3) => ({
  id: ie5.id,
  params: {
    unitId: e.getUnitId(),
    subUnitId: t3.getSheetId(),
    reveal: true,
    selections: [{ range: n3, primary: _e3(n3, t3) }]
  }
});
function Fh(n3) {
  if (!n3)
    return false;
  const { range: e, primary: t3 } = n3;
  return Cn.equals(e, t3);
}
function Bu2(n3) {
  function e(t3, s2) {
    function o3(r) {
      for (let i = r.startRow; i <= r.endRow; i++)
        if (!n3.getRowFiltered(i))
          for (let a4 = r.startColumn; a4 <= r.endColumn; a4++)
            s2(i, a4, r);
    }
    o3(t3);
  }
  return {
    forOperableEach: e
  };
}
var Ro = (n3) => n3.id !== Jo2;
function Ct2(n3, e, t3, s2, o3, r, i) {
  const a4 = {};
  for (let u2 = e; u2 <= t3; u2++)
    for (let l4 = s2; l4 <= o3; l4++) {
      const c2 = r ? n3.getCellWithFilteredInterceptors(i, l4, lo, Ro) : n3.getCellWithFilteredInterceptors(u2, i, lo, Ro);
      !c2 || !c2.s || (a4[u2] || (a4[u2] = {}), a4[u2][l4] = { s: c2.s });
    }
  for (const u2 in a4) {
    for (const l4 in a4[u2]) {
      const c2 = a4[u2][l4];
      c2.s && typeof c2.s == "object" && Z.isEmptyObject(c2.s) && delete c2.s, Z.isEmptyObject(c2) && delete a4[u2][l4];
    }
    Z.isEmptyObject(a4[u2]) && delete a4[u2];
  }
  return a4;
}
var ju = Object.getOwnPropertyDescriptor;
var zu = (n3, e, t3, s2) => {
  for (var o3 = s2 > 1 ? void 0 : s2 ? ju(e, t3) : e, r = n3.length - 1, i; r >= 0; r--)
    (i = n3[r]) && (o3 = i(o3) || o3);
  return o3;
};
var Gu = (n3, e) => (t3, s2) => e(t3, s2, n3);
var Ku = createIdentifier("sheets-formula.ref-selections.service");
var Co = class extends z {
  constructor(n3) {
    super(n3);
  }
  _init() {
    const n3 = this._getAliveWorkbooks$().pipe(takeUntil(this.dispose$));
    this.selectionMoveStart$ = n3.pipe(switchMap((e) => merge(...e.map((t3) => t3.selectionMoveStart$)))), this.selectionMoving$ = n3.pipe(switchMap((e) => merge(...e.map((t3) => t3.selectionMoving$)))), this.selectionMoveEnd$ = n3.pipe(switchMap((e) => merge(...e.map((t3) => t3.selectionMoveEnd$)))), this.selectionSet$ = n3.pipe(switchMap((e) => merge(...e.map((t3) => t3.selectionSet$))));
  }
  dispose() {
    super.dispose(), this.selectionMoveStart$ = of(null), this.selectionMoving$ = of(null), this.selectionMoveEnd$ = of(null), this.selectionSet$ = of(null), delete this._instanceSrv, this._workbookSelections.clear();
  }
  _getAliveWorkbooks$() {
    const n3 = this._instanceSrv.getAllUnitsForType(we.UNIVER_SHEET);
    n3.forEach((t3) => this._ensureWorkbookSelection(t3.getUnitId()));
    const e = new BehaviorSubject(n3);
    return this.disposeWithMe(this._instanceSrv.getTypeOfUnitAdded$(we.UNIVER_SHEET).subscribe((t3) => {
      this._ensureWorkbookSelection(t3.getUnitId()), e.next([...e.getValue(), t3]);
    })), this.disposeWithMe(this._instanceSrv.getTypeOfUnitDisposed$(we.UNIVER_SHEET).subscribe((t3) => {
      this._removeWorkbookSelection(t3.getUnitId()), e.next(e.getValue().filter((s2) => s2 !== t3));
    })), e.pipe(map((t3) => t3.map((s2) => this._ensureWorkbookSelection(s2.getUnitId()))));
  }
};
Co = zu([
  Gu(0, br)
], Co);
function Ju(n3, e) {
  const s2 = n3.get(Tr).getContextValue(Fu);
  return n3.get(s2 && !e ? Ku : z);
}
var ie5 = {
  id: "sheet.operation.set-selections",
  type: Ls.OPERATION,
  handler: (n3, e) => {
    if (!e) return false;
    const { selections: t3, type: s2, unitId: o3, subUnitId: r } = e;
    return Ju(n3).setSelections(o3, r, [...t3], s2), true;
  }
};
var qu = {
  id: "sheet.command.select-range",
  type: Ls.COMMAND,
  handler: (n3, e) => {
    if (!e) return false;
    const { unitId: t3, subUnit: s2, range: o3 } = e, r = n3.get(Ds), i = P5(n3.get(br), e);
    if (!i) return false;
    const a4 = [{
      range: o3,
      primary: _e3(o3, i.worksheet),
      style: null
    }];
    return r.syncExecuteCommand(ie5.id, {
      unitId: t3,
      subUnitId: s2,
      selections: a4
    });
  }
};
var or2 = "sheet.command.move-range";
var yt2 = {
  type: Ls.COMMAND,
  id: or2,
  // eslint-disable-next-line max-lines-per-function
  handler: (n3, e) => __async(void 0, null, function* () {
    var w6, S;
    const t3 = n3.get(Ds), s2 = n3.get(ra), o3 = n3.get(br), r = n3.get(CE), i = n3.get(Hn), a4 = n3.get(G), u2 = P5(o3);
    if (!u2 || !(yield a4.beforeCommandExecute({ id: yt2.id, params: e })))
      return false;
    const { worksheet: c2, subUnitId: d2, unitId: h9 } = u2, g9 = Fs2(
      n3,
      { unitId: h9, subUnitId: d2, range: e.fromRange },
      { subUnitId: d2, range: e.toRange }
    );
    if (g9 === null)
      return r.emit(i.t("sheets.info.acrossMergedCell")), false;
    const m9 = a4.onCommandExecute({
      id: yt2.id,
      params: e
    }), f4 = [
      ...(w6 = m9.preRedos) != null ? w6 : [],
      ...g9.redos,
      ...m9.redos,
      {
        id: ie5.id,
        params: {
          unitId: h9,
          subUnitId: d2,
          selections: [{ range: e.toRange, primary: Yu(e.fromRange, e.toRange, c2) }],
          type: we3.MOVE_END
        }
      }
    ], C = [
      ...(S = m9.preUndos) != null ? S : [],
      ...g9.undos,
      ...m9.undos,
      {
        id: ie5.id,
        params: {
          unitId: h9,
          subUnitId: d2,
          selections: [{ range: e.fromRange, primary: _e3(e.fromRange, c2) }],
          type: we3.MOVE_END
        }
      }
    ];
    if (po(f4, t3).result) {
      const { undos: I6, redos: y6 } = a4.generateMutationsOfAutoHeight({
        unitId: h9,
        subUnitId: d2,
        ranges: [e.fromRange, e.toRange]
      }), b4 = a4.afterCommandExecute({
        id: yt2.id,
        params: e
      });
      return po([...b4.redos, ...y6], t3), s2.pushUndoRedo({
        unitID: h9,
        undoMutations: [...C, ...b4.undos, ...I6],
        redoMutations: [...f4, ...b4.redos, ...y6]
      }), true;
    }
    return false;
  })
};
function Fs2(n3, e, t3, s2 = false) {
  const o3 = [], r = [], { range: i, subUnitId: a4, unitId: u2 } = e, { range: l4, subUnitId: c2 } = t3, h9 = n3.get(br).getUniverSheetInstance(u2), g9 = h9 == null ? void 0 : h9.getSheetBySheetId(c2), m9 = h9 == null ? void 0 : h9.getSheetBySheetId(a4), f4 = g9 == null ? void 0 : g9.getCellMatrix(), C = m9 == null ? void 0 : m9.getCellMatrix();
  if (g9 && m9 && f4 && C) {
    const p3 = cs2(l4, g9, false);
    if (!Cn.equals(l4, p3) && !s2)
      return null;
    const w6 = new ht(), S = new ht(), I6 = new ht();
    vr.foreach(i, (T10, k6) => {
      const D5 = C.getValue(T10, k6);
      if (w6.setValue(T10, k6, Z.deepClone(D5)), D5) {
        const H6 = h9 == null ? void 0 : h9.getStyles().get(D5.s);
        I6.setValue(T10, k6, Z.deepClone(H6));
      }
      S.setValue(T10, k6, null);
    });
    const y6 = new ht(), b4 = new ht();
    vr.foreach(l4, (T10, k6) => {
      y6.setValue(T10, k6, Z.deepClone(f4.getValue(T10, k6)));
    }), vr.foreach(i, (T10, k6) => {
      const D5 = QR(T10, k6), H6 = Cn.getRelativeRange(D5, i), F7 = Cn.getPositionRange(H6, l4), K5 = Z.deepClone(I6.getValue(T10, k6)), J6 = Z.deepClone(w6.getValue(T10, k6));
      J6 && K5 && (J6.s = K5), b4.setValue(F7.startRow, F7.startColumn, J6);
    });
    const N6 = {
      fromRange: e.range,
      toRange: t3.range,
      from: {
        value: S.getMatrix(),
        subUnitId: a4
      },
      to: {
        value: b4.getMatrix(),
        subUnitId: c2
      },
      unitId: u2
    }, U3 = {
      fromRange: t3.range,
      toRange: e.range,
      from: {
        value: w6.getMatrix(),
        subUnitId: a4
      },
      to: {
        value: y6.getMatrix(),
        subUnitId: c2
      },
      unitId: u2
    };
    o3.push({ id: wt2.id, params: N6 }), r.push({ id: wt2.id, params: U3 });
  }
  return {
    redos: o3,
    undos: r
  };
}
function Yu(n3, e, t3) {
  const s2 = n3.startRow, o3 = n3.startColumn, r = t3.getMergedCell(s2, o3), i = _e3(e, t3);
  if (r) {
    const a4 = r.endRow - r.startRow + 1, u2 = r.endColumn - r.startColumn + 1;
    i.endRow = i.startRow + a4 - 1, i.endColumn = i.startColumn + u2 - 1, i.actualRow = i.startRow, i.actualColumn = i.startColumn, i.isMerged = false, i.isMergedMainCell = true;
  }
  return i;
}
var Dn2 = ((n3) => (n3[n3.UNIVER_UNKNOWN = 0] = "UNIVER_UNKNOWN", n3[n3.UNIVER_DOC = 1] = "UNIVER_DOC", n3[n3.UNIVER_SHEET = 2] = "UNIVER_SHEET", n3[n3.UNIVER_SLIDE = 3] = "UNIVER_SLIDE", n3[n3.UNIVER_PROJECT = 4] = "UNIVER_PROJECT", n3[n3.UNRECOGNIZED = -1] = "UNRECOGNIZED", n3))(Dn2 || {});
var _ = ((n3) => (n3[n3.View = 0] = "View", n3[n3.Edit = 1] = "Edit", n3[n3.ManageCollaborator = 2] = "ManageCollaborator", n3[n3.Print = 3] = "Print", n3[n3.Duplicate = 4] = "Duplicate", n3[n3.Comment = 5] = "Comment", n3[n3.Copy = 6] = "Copy", n3[n3.Share = 7] = "Share", n3[n3.Export = 8] = "Export", n3[n3.MoveWorksheet = 9] = "MoveWorksheet", n3[n3.DeleteWorksheet = 10] = "DeleteWorksheet", n3[n3.HideWorksheet = 11] = "HideWorksheet", n3[n3.RenameWorksheet = 12] = "RenameWorksheet", n3[n3.CreateWorksheet = 13] = "CreateWorksheet", n3[n3.SetWorksheetStyle = 14] = "SetWorksheetStyle", n3[n3.EditWorksheetCell = 15] = "EditWorksheetCell", n3[n3.InsertHyperlink = 16] = "InsertHyperlink", n3[n3.Sort = 17] = "Sort", n3[n3.Filter = 18] = "Filter", n3[n3.PivotTable = 19] = "PivotTable", n3[n3.FloatImg = 20] = "FloatImg", n3[n3.History = 21] = "History", n3[n3.RwHgtClWdt = 22] = "RwHgtClWdt", n3[n3.ViemRwHgtClWdt = 23] = "ViemRwHgtClWdt", n3[n3.ViewFilter = 24] = "ViewFilter", n3[n3.MoveSheet = 25] = "MoveSheet", n3[n3.DeleteSheet = 26] = "DeleteSheet", n3[n3.HideSheet = 27] = "HideSheet", n3[n3.CopySheet = 28] = "CopySheet", n3[n3.RenameSheet = 29] = "RenameSheet", n3[n3.CreateSheet = 30] = "CreateSheet", n3[n3.SelectProtectedCells = 31] = "SelectProtectedCells", n3[n3.SelectUnProtectedCells = 32] = "SelectUnProtectedCells", n3[n3.SetCellStyle = 33] = "SetCellStyle", n3[n3.SetCellValue = 34] = "SetCellValue", n3[n3.SetRowStyle = 35] = "SetRowStyle", n3[n3.SetColumnStyle = 36] = "SetColumnStyle", n3[n3.InsertRow = 37] = "InsertRow", n3[n3.InsertColumn = 38] = "InsertColumn", n3[n3.DeleteRow = 39] = "DeleteRow", n3[n3.DeleteColumn = 40] = "DeleteColumn", n3[n3.EditExtraObject = 41] = "EditExtraObject", n3[n3.Delete = 42] = "Delete", n3[n3.RecoverHistory = 43] = "RecoverHistory", n3[n3.ViewHistory = 44] = "ViewHistory", n3[n3.CreatePermissionObject = 45] = "CreatePermissionObject", n3[n3.UNRECOGNIZED = -1] = "UNRECOGNIZED", n3))(_ || {});
var x4 = ((n3) => (n3[n3.Unkonwn = 0] = "Unkonwn", n3[n3.Workbook = 1] = "Workbook", n3[n3.Worksheet = 2] = "Worksheet", n3[n3.SelectRange = 3] = "SelectRange", n3[n3.Document = 4] = "Document", n3[n3.Slide = 5] = "Slide", n3[n3.UNRECOGNIZED = -1] = "UNRECOGNIZED", n3))(x4 || {});
var Ve4 = class {
  constructor(e, t3, s2) {
    R(this, "type", x4.SelectRange);
    R(this, "subType", _.Edit);
    R(this, "status", mc.INIT);
    R(this, "value", true);
    R(this, "id");
    R(this, "unitId");
    R(this, "subUnitId");
    R(this, "permissionId");
    this.unitId = e, this.subUnitId = t3, this.permissionId = s2, this.id = `${x4.SelectRange}.${_.Edit}.${s2}`;
  }
};
var Bs2 = class {
  constructor(e, t3, s2) {
    R(this, "type", x4.SelectRange);
    R(this, "subType", _.View);
    R(this, "status", mc.INIT);
    R(this, "value", false);
    R(this, "id");
    R(this, "unitId");
    R(this, "subUnitId");
    R(this, "permissionId");
    this.unitId = e, this.subUnitId = t3, this.permissionId = s2, this.id = `${x4.SelectRange}.${_.View}.${s2}`;
  }
};
var rr2 = class {
  constructor(e) {
    R(this, "id");
    R(this, "value", true);
    R(this, "type", x4.Workbook);
    R(this, "status", mc.INIT);
    R(this, "subType", _.Comment);
    this.unitId = e, this.unitId = e, this.id = `${this.type}.${_.Comment}_${e}`;
  }
};
var ir4 = class {
  constructor(e) {
    R(this, "id");
    R(this, "value", true);
    R(this, "type", x4.Workbook);
    R(this, "status", mc.INIT);
    R(this, "subType", _.Copy);
    this.unitId = e, this.unitId = e, this.id = `${this.type}.${_.Copy}_${e}`;
  }
};
var Xu = class {
  constructor(e) {
    R(this, "id");
    R(this, "value", true);
    R(this, "type", x4.Workbook);
    R(this, "subType", _.CopySheet);
    R(this, "status", mc.INIT);
    this.unitId = e, this.unitId = e, this.id = `${this.type}.${_.CopySheet}_${e}`;
  }
};
var ar3 = class {
  constructor(e) {
    R(this, "id");
    R(this, "value", true);
    R(this, "type", x4.Workbook);
    R(this, "status", mc.INIT);
    R(this, "subType", _.CreatePermissionObject);
    this.unitId = e, this.unitId = e, this.id = `${this.type}.${_.CreatePermissionObject}_${e}`;
  }
};
var ur2 = class {
  constructor(e) {
    R(this, "id");
    R(this, "value", true);
    R(this, "type", x4.Workbook);
    R(this, "status", mc.INIT);
    R(this, "subType", _.CreateSheet);
    this.unitId = e, this.unitId = e, this.id = `${this.type}.${_.CreateSheet}_${e}`;
  }
};
var Zu = class {
  constructor(e) {
    R(this, "value", true);
    R(this, "type", x4.Workbook);
    R(this, "status", mc.INIT);
    R(this, "id");
    R(this, "subType", _.DeleteColumn);
    this.unitId = e, this.id = `${this.type}.${_.DeleteColumn}_${e}`;
  }
};
var Qu = class {
  constructor(e) {
    R(this, "value", true);
    R(this, "type", x4.Workbook);
    R(this, "status", mc.INIT);
    R(this, "id");
    R(this, "subType", _.DeleteRow);
    this.unitId = e, this.id = `${this.type}.${_.DeleteRow}_${e}`;
  }
};
var lr2 = class {
  constructor(e) {
    R(this, "id");
    R(this, "value", true);
    R(this, "type", x4.Workbook);
    R(this, "status", mc.INIT);
    R(this, "subType", _.DeleteSheet);
    this.unitId = e, this.unitId = e, this.id = `${this.type}.${_.DeleteSheet}_${e}`;
  }
};
var cr2 = class {
  constructor(e) {
    R(this, "id");
    R(this, "value", true);
    R(this, "type", x4.Workbook);
    R(this, "status", mc.INIT);
    R(this, "subType", _.Duplicate);
    this.unitId = e, this.unitId = e, this.id = `${this.type}.${_.Duplicate}_${e}`;
  }
};
var Pe3 = class {
  constructor(e) {
    R(this, "id");
    R(this, "value", true);
    R(this, "type", x4.Workbook);
    R(this, "status", mc.INIT);
    R(this, "subType", _.Edit);
    this.unitId = e, this.unitId = e, this.id = `${this.type}.${_.Edit}_${e}`;
  }
};
var dr2 = class {
  constructor(e) {
    R(this, "id");
    R(this, "value", true);
    R(this, "type", x4.Workbook);
    R(this, "status", mc.INIT);
    R(this, "subType", _.Export);
    this.unitId = e, this.unitId = e, this.id = `${this.type}.${_.Export}_${e}`;
  }
};
var js2 = class {
  constructor(e) {
    R(this, "id");
    R(this, "value", true);
    R(this, "type", x4.Workbook);
    R(this, "status", mc.INIT);
    R(this, "subType", _.HideSheet);
    this.unitId = e, this.unitId = e, this.id = `${this.type}.${_.HideSheet}_${e}`;
  }
};
var el = class {
  constructor(e) {
    R(this, "id");
    R(this, "value", true);
    R(this, "type", x4.Workbook);
    R(this, "status", mc.INIT);
    R(this, "subType", _.History);
    this.unitId = e, this.unitId = e, this.id = `${this.type}.${_.History}_${e}`;
  }
};
var tl = class {
  constructor(e) {
    R(this, "value", true);
    R(this, "type", x4.Workbook);
    R(this, "status", mc.INIT);
    R(this, "id");
    R(this, "subType", _.InsertColumn);
    this.unitId = e, this.id = `${this.type}.${_.InsertColumn}_${e}`;
  }
};
var nl = class {
  constructor(e) {
    R(this, "value", true);
    R(this, "type", x4.Workbook);
    R(this, "status", mc.INIT);
    R(this, "id");
    R(this, "subType", _.InsertRow);
    this.unitId = e, this.id = `${this.type}.${_.InsertRow}_${e}`;
  }
};
var zs = class {
  constructor(e) {
    R(this, "id");
    R(this, "value", true);
    R(this, "type", x4.Workbook);
    R(this, "status", mc.INIT);
    R(this, "subType", _.ManageCollaborator);
    this.unitId = e, this.unitId = e, this.id = `${this.type}.${_.ManageCollaborator}_${e}`;
  }
};
var Gs = class {
  constructor(e) {
    R(this, "id");
    R(this, "value", true);
    R(this, "type", x4.Workbook);
    R(this, "status", mc.INIT);
    R(this, "subType", _.MoveSheet);
    this.unitId = e, this.unitId = e, this.id = `${this.type}.${_.MoveSheet}_${e}`;
  }
};
var hr2 = class {
  constructor(e) {
    R(this, "id");
    R(this, "value", true);
    R(this, "type", x4.Workbook);
    R(this, "status", mc.INIT);
    R(this, "subType", _.Print);
    this.unitId = e, this.unitId = e, this.id = `${this.type}.${_.Print}_${e}`;
  }
};
var gr3 = class {
  constructor(e) {
    R(this, "id");
    R(this, "value", true);
    R(this, "type", x4.Workbook);
    R(this, "status", mc.INIT);
    R(this, "subType", _.RecoverHistory);
    this.unitId = e, this.unitId = e, this.id = `${this.type}.${_.RecoverHistory}_${e}`;
  }
};
var Ks = class {
  constructor(e) {
    R(this, "id");
    R(this, "value", true);
    R(this, "type", x4.Workbook);
    R(this, "status", mc.INIT);
    R(this, "subType", _.RenameSheet);
    this.unitId = e, this.unitId = e, this.id = `${this.type}.${_.RenameSheet}_${e}`;
  }
};
var mr2 = class {
  constructor(e) {
    R(this, "id");
    R(this, "value", true);
    R(this, "type", x4.Workbook);
    R(this, "status", mc.INIT);
    R(this, "subType", _.Share);
    this.unitId = e, this.unitId = e, this.id = `${this.type}.${_.Share}_${e}`;
  }
};
var fr4 = class {
  constructor(e) {
    R(this, "id");
    R(this, "value", true);
    R(this, "type", x4.Workbook);
    R(this, "status", mc.INIT);
    R(this, "subType", _.View);
    this.unitId = e, this.unitId = e, this.id = `${this.type}.${_.View}_${e}`;
  }
};
var Rr2 = class {
  constructor(e) {
    R(this, "id");
    R(this, "value", true);
    R(this, "type", x4.Workbook);
    R(this, "status", mc.INIT);
    R(this, "subType", _.ViewHistory);
    this.unitId = e, this.unitId = e, this.id = `${this.type}.${_.ViewHistory}_${e}`;
  }
};
var Cr = class {
  constructor(e, t3) {
    R(this, "value", true);
    R(this, "type", x4.Worksheet);
    R(this, "status", mc.INIT);
    R(this, "id");
    R(this, "subType", _.Copy);
    this.unitId = e, this.subUnitId = t3, this.id = `${this.type}.${_.Copy}_${e}_${t3}`;
  }
};
var pr2 = class {
  constructor(e, t3) {
    R(this, "value", true);
    R(this, "type", x4.Worksheet);
    R(this, "status", mc.INIT);
    R(this, "id");
    R(this, "subType", _.DeleteColumn);
    this.unitId = e, this.subUnitId = t3, this.id = `${this.type}.${_.DeleteColumn}_${e}_${t3}`;
  }
};
var Sr2 = class {
  constructor(e, t3) {
    R(this, "value", true);
    R(this, "type", x4.Worksheet);
    R(this, "status", mc.INIT);
    R(this, "id");
    R(this, "subType", _.Delete);
    this.unitId = e, this.subUnitId = t3, this.id = `${this.type}.${_.Delete}_${e}_${t3}`;
  }
};
var wr2 = class {
  constructor(e, t3) {
    R(this, "value", true);
    R(this, "type", x4.Worksheet);
    R(this, "status", mc.INIT);
    R(this, "id");
    R(this, "subType", _.DeleteRow);
    this.unitId = e, this.subUnitId = t3, this.id = `${this.type}.${_.DeleteRow}_${e}_${t3}`;
  }
};
var Le2 = class {
  constructor(e, t3) {
    R(this, "value", true);
    R(this, "type", x4.Worksheet);
    R(this, "status", mc.INIT);
    R(this, "id");
    R(this, "subType", _.Edit);
    this.unitId = e, this.subUnitId = t3, this.id = `${this.type}.${_.Edit}_${e}_${t3}`;
  }
};
var Ir2 = class {
  constructor(e, t3) {
    R(this, "value", true);
    R(this, "type", x4.Worksheet);
    R(this, "status", mc.INIT);
    R(this, "id");
    R(this, "subType", _.EditExtraObject);
    this.unitId = e, this.subUnitId = t3, this.id = `${this.type}.${_.EditExtraObject}_${e}_${t3}`;
  }
};
var vr3 = class {
  constructor(e, t3) {
    R(this, "value", true);
    R(this, "type", x4.Worksheet);
    R(this, "status", mc.INIT);
    R(this, "id");
    R(this, "subType", _.Filter);
    this.unitId = e, this.subUnitId = t3, this.id = `${this.type}.${_.Filter}_${e}_${t3}`;
  }
};
var Mr = class {
  constructor(e, t3) {
    R(this, "value", true);
    R(this, "type", x4.Worksheet);
    R(this, "status", mc.INIT);
    R(this, "id");
    R(this, "subType", _.InsertColumn);
    this.unitId = e, this.subUnitId = t3, this.id = `${this.type}.${_.InsertColumn}_${e}_${t3}`;
  }
};
var _r2 = class {
  constructor(e, t3) {
    R(this, "value", true);
    R(this, "type", x4.Worksheet);
    R(this, "status", mc.INIT);
    R(this, "id");
    R(this, "subType", _.InsertHyperlink);
    this.unitId = e, this.subUnitId = t3, this.id = `${this.type}.${_.InsertHyperlink}_${e}_${t3}`;
  }
};
var yr2 = class {
  constructor(e, t3) {
    R(this, "value", true);
    R(this, "type", x4.Worksheet);
    R(this, "status", mc.INIT);
    R(this, "id");
    R(this, "subType", _.InsertRow);
    this.unitId = e, this.subUnitId = t3, this.id = `${this.type}.${_.InsertRow}_${e}_${t3}`;
  }
};
var br4 = class {
  constructor(e, t3) {
    R(this, "value", true);
    R(this, "type", x4.Worksheet);
    R(this, "status", mc.INIT);
    R(this, "id");
    R(this, "subType", _.ManageCollaborator);
    this.unitId = e, this.subUnitId = t3, this.id = `${this.type}.${_.ManageCollaborator}_${e}_${t3}`;
  }
};
var Er = class {
  constructor(e, t3) {
    R(this, "value", true);
    R(this, "type", x4.Worksheet);
    R(this, "status", mc.INIT);
    R(this, "id");
    R(this, "subType", _.PivotTable);
    this.unitId = e, this.subUnitId = t3, this.id = `${this.type}.${_.PivotTable}_${e}_${t3}`;
  }
};
var Bh = class {
  constructor(e, t3) {
    R(this, "value", true);
    R(this, "type", x4.Worksheet);
    R(this, "status", mc.INIT);
    R(this, "id");
    R(this, "subType", _.SelectProtectedCells);
    this.unitId = e, this.subUnitId = t3, this.id = `${this.type}.${_.SelectProtectedCells}_${e}_${t3}`;
  }
};
var jh2 = class {
  constructor(e, t3) {
    R(this, "value", true);
    R(this, "type", x4.Worksheet);
    R(this, "status", mc.INIT);
    R(this, "id");
    R(this, "subType", _.SelectUnProtectedCells);
    this.unitId = e, this.subUnitId = t3, this.id = `${this.type}.${_.SelectUnProtectedCells}_${e}_${t3}`;
  }
};
var kr2 = class {
  constructor(e, t3) {
    R(this, "value", true);
    R(this, "type", x4.Worksheet);
    R(this, "status", mc.INIT);
    R(this, "id");
    R(this, "subType", _.SetCellStyle);
    this.unitId = e, this.subUnitId = t3, this.id = `${this.type}.${_.SetCellStyle}_${e}_${t3}`;
  }
};
var An3 = class {
  constructor(e, t3) {
    R(this, "value", true);
    R(this, "type", x4.Worksheet);
    R(this, "status", mc.INIT);
    R(this, "id");
    R(this, "subType", _.SetCellValue);
    this.unitId = e, this.subUnitId = t3, this.id = `${this.type}.${_.SetCellValue}_${e}_${t3}`;
  }
};
var Zt3 = class {
  constructor(e, t3) {
    R(this, "value", true);
    R(this, "type", x4.Worksheet);
    R(this, "status", mc.INIT);
    R(this, "id");
    R(this, "subType", _.SetColumnStyle);
    this.unitId = e, this.subUnitId = t3, this.id = `${this.type}.${_.SetColumnStyle}_${e}_${t3}`;
  }
};
var Qt3 = class {
  constructor(e, t3) {
    R(this, "value", true);
    R(this, "type", x4.Worksheet);
    R(this, "status", mc.INIT);
    R(this, "id");
    R(this, "subType", _.SetRowStyle);
    this.unitId = e, this.subUnitId = t3, this.id = `${this.type}.${_.SetRowStyle}_${e}_${t3}`;
  }
};
var Ur = class {
  constructor(e, t3) {
    R(this, "value", true);
    R(this, "type", x4.Worksheet);
    R(this, "status", mc.INIT);
    R(this, "id");
    R(this, "subType", _.Sort);
    this.unitId = e, this.subUnitId = t3, this.id = `${this.type}.${_.Sort}_${e}_${t3}`;
  }
};
var ds = class {
  constructor(e, t3) {
    R(this, "value", true);
    R(this, "type", x4.Worksheet);
    R(this, "status", mc.INIT);
    R(this, "id");
    R(this, "subType", _.View);
    this.unitId = e, this.subUnitId = t3, this.id = `${this.type}.${_.View}_${e}_${t3}`;
  }
};
var Sn2 = {
  id: "sheet.command.set-range-values",
  type: Ls.COMMAND,
  handler: (n3, e) => {
    var H6;
    const t3 = n3.get(Ds), s2 = n3.get(ra), o3 = n3.get(br), r = n3.get(z), i = n3.get(G), a4 = n3.get(aC), u2 = P5(o3, e);
    if (!u2) return false;
    const { subUnitId: l4, unitId: c2, workbook: d2, worksheet: h9 } = u2, { value: g9, range: m9, redoUndoId: f4 } = e, C = m9 ? [m9] : (H6 = r.getCurrentSelections()) == null ? void 0 : H6.map((F7) => F7.range);
    if (!C || !C.length || !a4.getPermissionPoint(new Le2(c2, l4).id)) return false;
    const p3 = new ht();
    let w6;
    if (Z.isArray(g9))
      for (let F7 = 0; F7 < C.length; F7++) {
        const { startRow: K5, startColumn: J6, endRow: ae5, endColumn: oe5 } = C[F7];
        for (let le3 = 0; le3 <= ae5 - K5; le3++)
          for (let Se5 = 0; Se5 <= oe5 - J6; Se5++)
            p3.setValue(le3 + K5, Se5 + J6, g9[le3][Se5]);
      }
    else if (Wg(g9))
      for (let F7 = 0; F7 < C.length; F7++) {
        const { startRow: K5, startColumn: J6, endRow: ae5, endColumn: oe5 } = C[F7];
        for (let le3 = K5; le3 <= ae5; le3++)
          for (let Se5 = J6; Se5 <= oe5; Se5++)
            p3.setValue(le3, Se5, g9);
      }
    else
      w6 = g9;
    const S = { subUnitId: l4, unitId: c2, cellValue: w6 != null ? w6 : p3.getMatrix() }, I6 = Ae4(n3, S), y6 = jR(S.cellValue, (F7, K5) => h9.getCellHeight(F7, K5) || void 0);
    if (!t3.syncExecuteCommand(ee2.id, S)) return false;
    const { undos: N6, redos: U3 } = i.onCommandExecute({
      id: Sn2.id,
      params: S
    }), { undos: T10, redos: k6 } = i.generateMutationsOfAutoHeight({
      unitId: c2,
      subUnitId: l4,
      ranges: C,
      cellHeights: new ht(y6)
    });
    if (po([...U3, ...k6], t3).result) {
      const F7 = ut2(m9 != null ? m9 : p3.getRange(), d2, h9);
      return s2.pushUndoRedo({
        unitID: c2,
        undoMutations: [
          { id: ee2.id, params: I6 },
          ...N6,
          ...T10,
          F7
        ],
        redoMutations: [
          { id: ee2.id, params: S },
          ...U3,
          ...k6,
          Z.deepClone(F7)
        ],
        id: f4
      }), true;
    }
    return false;
  }
};
function Tr2(n3, e) {
  const t3 = [], s2 = [], { unitId: o3, subUnitId: r, range: i, shiftDimension: a4, cellValue: u2 = {} } = e, l4 = n3.get(br), c2 = n3.get(G), d2 = l4.getUniverSheetInstance(o3), h9 = d2 == null ? void 0 : d2.getSheetBySheetId(r);
  if (h9) {
    const g9 = h9.getCellMatrix(), m9 = g9.getDataRange();
    if (i.startColumn <= m9.endColumn || i.startRow <= m9.endRow) {
      let S, I6;
      if (a4 === Im.COLUMNS) {
        const b4 = Math.min(i.endRow, m9.endRow);
        let N6 = 0;
        for (let T10 = i.startRow; T10 <= b4; T10++) {
          const k6 = g9.getRow(T10), D5 = k6 ? gn(k6) - 1 : 0;
          N6 = Math.max(N6, D5);
        }
        S = {
          startRow: i.startRow,
          startColumn: i.startColumn,
          endRow: b4,
          endColumn: N6
        };
        const U3 = i.endColumn - i.startColumn + 1;
        I6 = {
          startRow: i.startRow,
          startColumn: S.startColumn + U3,
          endRow: b4,
          endColumn: S.endColumn + U3
        };
      } else {
        const b4 = Math.min(i.endColumn, m9.endColumn), N6 = m9.endRow;
        S = {
          startRow: i.startRow,
          startColumn: i.startColumn,
          endRow: N6,
          endColumn: b4
        };
        const U3 = i.endRow - i.startRow + 1;
        I6 = {
          startRow: S.startRow + U3,
          startColumn: i.startColumn,
          endRow: S.endRow + U3,
          endColumn: b4
        };
      }
      const y6 = Fs2(
        n3,
        { unitId: o3, subUnitId: r, range: S },
        { subUnitId: r, range: I6 },
        true
      );
      y6 && (t3.push(...y6.redos), s2.push(...y6.undos));
    }
    if (Object.entries(u2).length === 0)
      for (let S = i.startRow; S <= i.endRow; S++) {
        u2[S] || (u2[S] = {});
        for (let I6 = i.startColumn; I6 <= i.endColumn; I6++)
          u2[S][I6] = null;
      }
    const f4 = {
      subUnitId: r,
      unitId: o3,
      cellValue: u2
    }, C = Ae4(
      n3,
      f4
    ), { undos: p3, redos: w6 } = c2.onCommandExecute({
      id: Sn2.id,
      params: __spreadProps(__spreadValues({}, f4), { range: i })
    });
    t3.push({ id: ee2.id, params: f4 }, ...w6), s2.push({ id: ee2.id, params: C }, ...p3);
  }
  return {
    redo: t3,
    undo: s2
  };
}
function Pr2(n3, e) {
  const t3 = [], s2 = [], { unitId: o3, subUnitId: r, range: i, shiftDimension: a4 } = e, u2 = n3.get(br), l4 = n3.get(G), c2 = u2.getUniverSheetInstance(o3), d2 = c2 == null ? void 0 : c2.getSheetBySheetId(r);
  if (d2) {
    const h9 = d2.getCellMatrix(), g9 = h9.getDataRange(), m9 = {
      subUnitId: r,
      unitId: o3,
      cellValue: sr2([i])
    }, f4 = Ae4(
      n3,
      m9
    ), C = l4.onCommandExecute({
      id: Sn2.id,
      params: m9
    });
    if (t3.push({ id: ee2.id, params: m9 }, ...C.redos), s2.push(...C.undos, {
      id: ee2.id,
      params: f4
    }), i.startColumn <= g9.endColumn || i.startRow <= g9.endRow) {
      let p3 = null, w6 = null;
      if (a4 === Im.COLUMNS && i.endColumn < g9.endColumn) {
        const S = Math.min(i.endRow, g9.endRow);
        let I6 = 0;
        for (let b4 = i.startRow; b4 <= S; b4++) {
          const N6 = h9.getRow(b4), U3 = N6 ? gn(N6) - 1 : 0;
          I6 = Math.max(I6, U3);
        }
        p3 = {
          startRow: i.startRow,
          startColumn: i.endColumn + 1,
          endRow: S,
          endColumn: I6
        };
        const y6 = i.endColumn - i.startColumn + 1;
        w6 = {
          startRow: i.startRow,
          startColumn: p3.startColumn - y6,
          endRow: S,
          endColumn: p3.endColumn - y6
        };
      }
      if (a4 === Im.ROWS && i.endRow < g9.endRow) {
        const S = Math.min(i.endColumn, g9.endColumn), I6 = g9.endRow;
        p3 = {
          startRow: i.endRow + 1,
          startColumn: i.startColumn,
          endRow: I6,
          endColumn: S
        };
        const y6 = i.endRow - i.startRow + 1;
        w6 = {
          startRow: p3.startRow - y6,
          startColumn: i.startColumn,
          endRow: p3.endRow - y6,
          endColumn: S
        };
      }
      if (p3 && w6) {
        const S = Fs2(
          n3,
          { unitId: o3, subUnitId: r, range: p3 },
          { subUnitId: r, range: w6 },
          true
        );
        S && (t3.push(...S.redos), s2.push(...S.undos));
      }
    }
  }
  return {
    redo: t3,
    undo: s2
  };
}
function zh(n3, e, t3, s2, o3, r) {
  const { startRow: i, endRow: a4, startColumn: u2, endColumn: l4 } = e;
  if (o3 === Im.ROWS) {
    const c2 = a4 - i + 1;
    for (let d2 = t3; d2 >= i; d2--)
      for (let h9 = u2; h9 <= l4; h9++) {
        const g9 = n3.getValue(d2, h9);
        g9 == null ? n3.realDeleteValue(d2 + c2, h9) : n3.setValue(d2 + c2, h9, g9);
      }
    for (let d2 = a4; d2 >= i; d2--)
      for (let h9 = u2; h9 <= l4; h9++)
        r && r[d2] && r[d2][h9] ? n3.setValue(d2, h9, r[d2][h9]) : n3.realDeleteValue(d2, h9);
  } else if (o3 === Im.COLUMNS) {
    const c2 = l4 - u2 + 1;
    for (let d2 = i; d2 <= a4; d2++)
      for (let h9 = s2; h9 >= u2; h9--) {
        const g9 = n3.getValue(d2, h9);
        g9 == null ? n3.realDeleteValue(d2, h9 + c2) : n3.setValue(d2, h9 + c2, g9);
      }
    for (let d2 = i; d2 <= a4; d2++)
      for (let h9 = l4; h9 >= u2; h9--)
        r && r[d2] && r[d2][h9] ? n3.setValue(d2, h9, r[d2][h9]) : n3.realDeleteValue(d2, h9);
  }
}
function Gh(n3, e, t3, s2, o3) {
  const { startRow: r, endRow: i, startColumn: a4, endColumn: u2 } = e, l4 = i - r + 1, c2 = u2 - a4 + 1;
  if (o3 === Im.ROWS)
    for (let d2 = r; d2 <= t3; d2++)
      for (let h9 = a4; h9 <= u2; h9++) {
        const g9 = n3.getValue(d2 + l4, h9);
        g9 == null ? n3.realDeleteValue(d2, h9) : n3.setValue(d2, h9, g9);
      }
  else if (o3 === Im.COLUMNS)
    for (let d2 = r; d2 <= i; d2++)
      for (let h9 = a4; h9 <= s2; h9++) {
        const g9 = n3.getValue(d2, h9 + c2);
        g9 == null ? n3.realDeleteValue(d2, h9) : n3.setValue(d2, h9, g9);
      }
}
var Nr = "sheet.command.delete-range-move-left";
var It2 = {
  type: Ls.COMMAND,
  id: Nr,
  handler: (n3, e) => __async(void 0, null, function* () {
    var I6, y6, b4;
    const t3 = n3.get(Ds), s2 = n3.get(ra), o3 = n3.get(br), r = n3.get(z), i = n3.get(G), a4 = P5(o3);
    if (!a4) return false;
    const { worksheet: u2, workbook: l4, subUnitId: c2, unitId: d2 } = a4;
    let h9 = e == null ? void 0 : e.range;
    if (h9 || (h9 = (I6 = r.getCurrentLastSelection()) == null ? void 0 : I6.range), !h9) return false;
    const g9 = {
      range: h9,
      subUnitId: c2,
      unitId: d2,
      shiftDimension: Im.COLUMNS
    }, m9 = i.onCommandExecute({
      id: It2.id,
      params: { range: h9 }
    }), { redo: f4, undo: C } = Pr2(
      n3,
      g9
    ), p3 = [...(y6 = m9.preRedos) != null ? y6 : [], ...f4], w6 = [...m9.undos, ...C];
    if (p3.push(...m9.redos), p3.push(ut2(h9, l4, u2)), w6.push(...(b4 = m9.preUndos) != null ? b4 : []), po(p3, t3).result) {
      const N6 = i.afterCommandExecute({
        id: It2.id,
        params: { range: h9 }
      });
      return po(N6.redos, t3), w6.push(...N6.undos), p3.push(...N6.redos), s2.pushUndoRedo({
        unitID: d2,
        undoMutations: w6.reverse(),
        redoMutations: p3
      }), true;
    }
    return false;
  })
  // all subsequent mutations should succeed inorder to make the whole process succeed
  // Promise.all([]).then(() => true),
};
var Or = "sheet.command.delete-range-move-up";
var vt2 = {
  type: Ls.COMMAND,
  id: Or,
  handler: (n3, e) => __async(void 0, null, function* () {
    var I6, y6, b4;
    const t3 = n3.get(Ds), s2 = n3.get(ra), o3 = n3.get(br), r = n3.get(z), i = n3.get(G), a4 = P5(o3);
    if (!a4) return false;
    const { unitId: u2, subUnitId: l4, workbook: c2, worksheet: d2 } = a4;
    let h9 = e == null ? void 0 : e.range;
    if (h9 || (h9 = (I6 = r.getCurrentLastSelection()) == null ? void 0 : I6.range), !h9) return false;
    const g9 = {
      range: h9,
      subUnitId: l4,
      unitId: u2,
      shiftDimension: Im.ROWS
    }, m9 = i.onCommandExecute({
      id: vt2.id,
      params: { range: h9 }
    }), { redo: f4, undo: C } = Pr2(
      n3,
      g9
    ), p3 = [...(y6 = m9.preRedos) != null ? y6 : [], ...f4], w6 = [...m9.undos, ...C];
    if (p3.push(...m9.redos), p3.push(ut2(h9, c2, d2)), w6.push(...(b4 = m9.preUndos) != null ? b4 : []), po(p3, t3).result) {
      const N6 = i.afterCommandExecute({
        id: vt2.id,
        params: { range: h9 }
      });
      return po(N6.redos, t3), w6.push(...N6.undos), p3.push(...N6.redos), s2.pushUndoRedo({
        unitID: u2,
        undoMutations: w6.reverse(),
        redoMutations: p3
      }), true;
    }
    return false;
  })
  // all subsequent mutations should succeed inorder to make the whole process succeed
  // Promise.all([]).then(() => true),
};
var sl = "sheet.command.insert-range-move-down";
var Pt4 = {
  type: Ls.COMMAND,
  id: "sheet.command.insert-range-move-down",
  // eslint-disable-next-line max-lines-per-function
  handler: (n3, e) => __async(void 0, null, function* () {
    var H6, F7, K5;
    const t3 = n3.get(Ds), s2 = n3.get(ra), o3 = n3.get(br), r = n3.get(z), i = n3.get(G), a4 = n3.get(CE), u2 = n3.get(Hn);
    if (r.isOverlapping())
      return a4.emit(u2.t("sheets.info.overlappingSelections")), false;
    const l4 = P5(o3);
    if (!l4) return false;
    const { unitId: c2, subUnitId: d2, worksheet: h9, workbook: g9 } = l4;
    let m9 = e == null ? void 0 : e.range;
    if (m9 || (m9 = (H6 = r.getCurrentLastSelection()) == null ? void 0 : H6.range), !m9) return false;
    const f4 = [], C = [], p3 = h9.getCellMatrix(), w6 = p3.getDataRange(), I6 = p3.getSlice(w6.startRow, w6.endRow, m9.startColumn, m9.endColumn).getDataRange().endRow, y6 = Math.max(I6 + (m9.endRow - m9.startRow + 1) - w6.endRow, 0);
    if (y6 > 0) {
      const J6 = m9.startRow - 1, ae5 = h9.getRowHeight(J6), oe5 = {
        unitId: c2,
        subUnitId: d2,
        range: {
          startRow: w6.endRow + 1,
          endRow: w6.endRow + y6,
          startColumn: w6.startColumn,
          endColumn: w6.endColumn
        },
        rowInfo: new Array(y6).fill(void 0).map(() => ({
          h: ae5,
          hd: ie.FALSE
        }))
      };
      f4.push({
        id: ke2.id,
        params: oe5
      });
      const le3 = Ws(
        n3,
        oe5
      );
      C.push({ id: Te.id, params: le3 });
    }
    const b4 = {};
    vr.foreach(m9, (J6, ae5) => {
      const oe5 = h9.getCell(J6, ae5);
      oe5 && (b4[J6] || (b4[J6] = {}), b4[J6][ae5] = { s: oe5.s });
    });
    const N6 = {
      range: m9,
      subUnitId: d2,
      unitId: c2,
      shiftDimension: Im.ROWS,
      cellValue: b4
    }, { redo: U3, undo: T10 } = Tr2(
      n3,
      N6
    );
    f4.push(...U3), C.push(...T10);
    const k6 = i.onCommandExecute({
      id: Pt4.id,
      params: { range: m9 }
    });
    if (f4.push(...k6.redos), f4.push(ut2(m9, g9, h9)), C.push(...(F7 = k6.preUndos) != null ? F7 : []), f4.unshift(...(K5 = k6.preRedos) != null ? K5 : []), C.unshift(...k6.undos), po(f4, t3)) {
      const J6 = i.afterCommandExecute({
        id: Pt4.id,
        params: { range: m9 }
      });
      return po(J6.redos, t3), C.push(...J6.undos), f4.push(...J6.redos), s2.pushUndoRedo({
        unitID: c2,
        undoMutations: C.reverse(),
        redoMutations: f4
      }), true;
    }
    return false;
  })
  // all subsequent mutations should succeed inorder to make the whole process succeed
  // Promise.all([]).then(() => true),
};
var Js2 = "sheet.command.insert-range-move-right";
var rn = {
  type: Ls.COMMAND,
  id: Js2,
  // eslint-disable-next-line max-lines-per-function
  handler: (n3, e) => __async(void 0, null, function* () {
    var H6, F7, K5;
    const t3 = n3.get(Ds), s2 = n3.get(ra), o3 = n3.get(br), r = n3.get(z), i = n3.get(G), a4 = n3.get(CE), u2 = n3.get(Hn);
    if (r.isOverlapping())
      return a4.emit(u2.t("sheets.info.overlappingSelections")), false;
    const l4 = P5(o3);
    if (!l4) return false;
    const { workbook: c2, worksheet: d2, unitId: h9, subUnitId: g9 } = l4;
    let m9 = e == null ? void 0 : e.range;
    if (m9 || (m9 = (H6 = r.getCurrentLastSelection()) == null ? void 0 : H6.range), !m9) return false;
    const f4 = [], C = [], p3 = d2.getCellMatrix(), w6 = p3.getDataRange(), I6 = p3.getSlice(m9.startRow, m9.endRow, w6.startColumn, w6.endColumn).getDataRange().endColumn, y6 = Math.max(
      I6 + (m9.endColumn - m9.startColumn + 1) - w6.endColumn,
      0
    );
    if (y6 > 0) {
      const J6 = m9.startColumn - 1, ae5 = d2.getColumnWidth(J6), oe5 = {
        unitId: h9,
        subUnitId: g9,
        range: {
          startRow: w6.startRow + 1,
          endRow: w6.endRow,
          startColumn: w6.endColumn + 1,
          endColumn: w6.endColumn + y6
        },
        colInfo: new Array(y6).fill(void 0).map(() => ({
          w: ae5,
          hd: ie.FALSE
        }))
      };
      f4.push({
        id: Ue2.id,
        params: oe5
      });
      const le3 = as(
        n3,
        oe5
      );
      C.push({ id: Me.id, params: le3 });
    }
    const b4 = {};
    vr.foreach(m9, (J6, ae5) => {
      const oe5 = d2.getCell(J6, ae5);
      !oe5 || !oe5.s || (b4[J6] || (b4[J6] = {}), b4[J6][ae5] = { s: oe5.s });
    });
    const N6 = {
      range: m9,
      subUnitId: g9,
      unitId: h9,
      shiftDimension: Im.COLUMNS,
      cellValue: b4
    }, { redo: U3, undo: T10 } = Tr2(
      n3,
      N6
    );
    f4.push(...U3), C.push(...T10);
    const k6 = i.onCommandExecute({
      id: rn.id,
      params: { range: m9 }
    });
    if (f4.push(...k6.redos), f4.push(ut2(m9, c2, d2)), C.push(...(F7 = k6.preUndos) != null ? F7 : []), f4.unshift(...(K5 = k6.preRedos) != null ? K5 : []), C.unshift(...k6.undos), po(f4, t3).result) {
      const J6 = i.afterCommandExecute({
        id: rn.id,
        params: { range: m9 }
      });
      return po(J6.redos, t3), C.push(...J6.undos), f4.push(...J6.redos), s2.pushUndoRedo({
        unitID: h9,
        undoMutations: C.reverse(),
        redoMutations: f4
      }), true;
    }
    return false;
  })
  // all subsequent mutations should succeed in order to make the whole process succeed
  // Promise.all([]).then(() => true),
};
var Dr2 = "sheet.command.insert-row";
var Ye3 = {
  type: Ls.COMMAND,
  id: Dr2,
  handler: (n3, e) => __async(void 0, null, function* () {
    const t3 = n3.get(Ds), s2 = n3.get(G), { range: o3, direction: r, unitId: i, subUnitId: a4, cellValue: u2 } = e;
    return (yield s2.beforeCommandExecute({
      id: Ye3.id,
      params: e
    })) ? t3.syncExecuteCommand(Ar.id, {
      range: o3,
      direction: r,
      unitId: i,
      subUnitId: a4,
      cellValue: u2
    }) : false;
  })
};
var Ar = {
  type: Ls.COMMAND,
  id: "sheet.command.insert-row-by-range",
  handler: (n3, e) => {
    var U3, T10, k6, D5;
    const t3 = n3.get(Ds), s2 = n3.get(ra), o3 = n3.get(br), r = n3.get(G), i = P5(o3, e);
    if (!i) return false;
    const { workbook: a4, worksheet: u2 } = i, { range: l4, direction: c2, unitId: d2, subUnitId: h9, cellValue: g9 } = e, { startRow: m9, endRow: f4 } = l4;
    l4.rangeType = ge.ROW;
    const C = c2 === wm.UP ? m9 : m9 - 1, p3 = u2.getRowHeight(C), w6 = {
      unitId: d2,
      subUnitId: h9,
      range: l4,
      rowInfo: new Array(f4 - m9 + 1).fill(void 0).map(() => ({
        h: p3,
        hd: ie.FALSE
      }))
      // row height should inherit from the anchor row
    }, S = Ws(
      n3,
      w6
    ), I6 = [{ id: ke2.id, params: w6 }], y6 = [{ id: Te.id, params: S }];
    g9 && Object.keys(g9).length > 0 && I6.push({
      id: ee2.id,
      params: {
        unitId: d2,
        subUnitId: h9,
        cellValue: g9
      }
    });
    const b4 = r.onCommandExecute({
      id: Ye3.id,
      params: e
    });
    if (I6.unshift(...(U3 = b4.preRedos) != null ? U3 : []), I6.push(...(T10 = b4.redos) != null ? T10 : []), I6.push(ut2(l4, a4, u2)), y6.unshift(...(k6 = b4.preUndos) != null ? k6 : []), y6.push(...(D5 = b4.undos) != null ? D5 : []), po(I6, t3).result) {
      const H6 = r.afterCommandExecute({
        id: Ye3.id,
        params: e
      });
      return po(H6.redos, t3), I6.push(...H6.redos), y6.push(...H6.undos), s2.pushUndoRedo({
        unitID: e.unitId,
        undoMutations: y6,
        redoMutations: I6
      }), true;
    }
    return false;
  }
};
var ol = {
  type: Ls.COMMAND,
  id: "sheet.command.insert-row-before",
  handler: (n3, e) => __async(void 0, null, function* () {
    var C;
    const s2 = (C = n3.get(z).getCurrentSelections()) == null ? void 0 : C.map((p3) => p3.range);
    let o3;
    if ((s2 == null ? void 0 : s2.length) === 1)
      o3 = s2[0];
    else
      return false;
    const r = n3.get(br), i = P5(r);
    if (!i) return false;
    const { worksheet: a4, subUnitId: u2, unitId: l4 } = i, c2 = e.value || 0, d2 = o3.startRow, h9 = o3.startRow + c2 - 1, g9 = 0, m9 = a4.getColumnCount() - 1, f4 = {
      unitId: l4,
      subUnitId: u2,
      direction: wm.UP,
      range: {
        startRow: d2,
        endRow: h9,
        startColumn: g9,
        endColumn: m9
      },
      // copy styles from the row above
      cellValue: Ct2(a4, d2, h9, g9, m9, true, d2 - 1)
    };
    return n3.get(Ds).executeCommand(Ye3.id, f4);
  })
};
var rl = {
  type: Ls.COMMAND,
  id: "sheet.command.insert-row-after",
  handler: (n3) => __async(void 0, null, function* () {
    var f4;
    const t3 = (f4 = n3.get(z).getCurrentSelections()) == null ? void 0 : f4.map((C) => C.range);
    let s2;
    if ((t3 == null ? void 0 : t3.length) === 1)
      s2 = t3[0];
    else
      return false;
    const o3 = n3.get(br), r = P5(o3);
    if (!r) return false;
    const { worksheet: i, unitId: a4, subUnitId: u2 } = r, l4 = s2.endRow - s2.startRow + 1, c2 = s2.endRow + 1, d2 = s2.endRow + l4, h9 = 0, g9 = i.getColumnCount() - 1, m9 = {
      unitId: a4,
      subUnitId: u2,
      direction: wm.DOWN,
      range: {
        startRow: c2,
        endRow: d2,
        startColumn: h9,
        endColumn: g9,
        rangeType: ge.ROW
      },
      // copy styles from the row below
      cellValue: Ct2(i, c2, d2, h9, g9, true, s2.endRow)
    };
    return n3.get(Ds).executeCommand(Ye3.id, m9);
  })
};
var il = {
  type: Ls.COMMAND,
  id: "sheet.command.insert-multi-rows-above",
  handler: (n3, e) => __async(void 0, null, function* () {
    var p3;
    const s2 = (p3 = n3.get(z).getCurrentSelections()) == null ? void 0 : p3.map((w6) => w6.range);
    let o3;
    if ((s2 == null ? void 0 : s2.length) === 1)
      o3 = s2[0];
    else
      return false;
    const r = n3.get(br), i = P5(r);
    if (!i) return false;
    const { worksheet: a4, unitId: u2, subUnitId: l4 } = i, c2 = e.value || 0, d2 = o3.startRow, h9 = o3.startRow + c2 - 1, g9 = 0, m9 = a4.getColumnCount() - 1, f4 = Ct2(a4, d2, h9, g9, m9, true, d2 - 1), C = {
      unitId: u2,
      subUnitId: l4,
      direction: wm.UP,
      range: {
        startRow: d2,
        endRow: h9,
        startColumn: g9,
        endColumn: m9,
        rangeType: ge.ROW
      },
      // copy styles from the row above
      cellValue: f4
    };
    return n3.get(Ds).executeCommand(Ye3.id, C);
  })
};
var al = {
  type: Ls.COMMAND,
  id: "sheet.command.insert-multi-rows-after",
  handler: (n3, e) => __async(void 0, null, function* () {
    var C;
    const s2 = (C = n3.get(z).getCurrentSelections()) == null ? void 0 : C.map((p3) => p3.range);
    let o3;
    if ((s2 == null ? void 0 : s2.length) === 1)
      o3 = s2[0];
    else
      return false;
    const r = n3.get(br), i = P5(r);
    if (!i) return false;
    const { worksheet: a4, unitId: u2, subUnitId: l4 } = i, c2 = e.value || 0, d2 = o3.endRow + 1, h9 = o3.endRow + c2, g9 = 0, m9 = a4.getColumnCount() - 1, f4 = {
      unitId: u2,
      subUnitId: l4,
      direction: wm.DOWN,
      range: {
        startRow: d2,
        endRow: h9,
        startColumn: g9,
        endColumn: m9,
        rangeType: ge.ROW
      },
      // copy styles from the row below
      cellValue: Ct2(a4, d2, h9, g9, m9, true, o3.endRow)
    };
    return n3.get(Ds).executeCommand(Ye3.id, f4);
  })
};
var xr = "sheet.command.insert-col";
var Xe6 = {
  type: Ls.COMMAND,
  id: xr,
  handler: (n3, e) => __async(void 0, null, function* () {
    const t3 = n3.get(Ds), s2 = n3.get(G), { range: o3, direction: r, subUnitId: i, unitId: a4, cellValue: u2 } = e;
    return (yield s2.beforeCommandExecute({
      id: Xe6.id,
      params: e
    })) ? t3.syncExecuteCommand($r2.id, {
      range: o3,
      direction: r,
      unitId: a4,
      subUnitId: i,
      cellValue: u2
    }) : false;
  })
};
var $r2 = {
  type: Ls.COMMAND,
  id: "sheet.command.insert-col-by-range",
  handler: (n3, e) => {
    var N6, U3, T10, k6;
    const t3 = n3.get(Ds), s2 = n3.get(ra), o3 = n3.get(br), r = n3.get(G), { range: i, direction: a4, subUnitId: u2, unitId: l4, cellValue: c2 } = e, { startColumn: d2, endColumn: h9 } = e.range;
    i.rangeType = ge.COLUMN;
    const g9 = o3.getUniverSheetInstance(e.unitId), m9 = g9.getSheetBySheetId(e.subUnitId), f4 = a4 === wm.LEFT ? d2 : d2 - 1, C = m9.getColumnWidth(f4), p3 = {
      unitId: l4,
      subUnitId: u2,
      range: i,
      colInfo: new Array(h9 - d2 + 1).fill(void 0).map(() => ({
        w: C,
        hd: ie.FALSE
      }))
    }, w6 = as(
      n3,
      p3
    ), S = [{ id: Ue2.id, params: p3 }], I6 = [{ id: Me.id, params: w6 }];
    c2 && S.push({
      id: ee2.id,
      params: {
        unitId: l4,
        subUnitId: u2,
        cellValue: c2
      }
    });
    const y6 = r.onCommandExecute({
      id: Xe6.id,
      params: e
    });
    if (S.unshift(...(N6 = y6.preRedos) != null ? N6 : []), S.push(...(U3 = y6.redos) != null ? U3 : []), S.push(ut2(i, g9, m9)), I6.unshift(...(T10 = y6.preUndos) != null ? T10 : []), I6.push(...(k6 = y6.undos) != null ? k6 : []), po(S, t3).result) {
      const D5 = r.afterCommandExecute({
        id: Xe6.id,
        params: e
      });
      return po(D5.redos, t3), S.push(...D5.redos), I6.push(...D5.undos), s2.pushUndoRedo({
        unitID: e.unitId,
        undoMutations: I6.filter(Boolean),
        redoMutations: S.filter(Boolean)
      }), true;
    }
    return false;
  }
};
var ul = {
  type: Ls.COMMAND,
  id: "sheet.command.insert-col-before",
  handler: (n3, e) => __async(void 0, null, function* () {
    const s2 = n3.get(z).getCurrentSelections();
    let o3;
    if ((s2 == null ? void 0 : s2.length) === 1)
      o3 = s2[0].range;
    else
      return false;
    const r = n3.get(br), i = P5(r);
    if (!i) return false;
    const { worksheet: a4, unitId: u2, subUnitId: l4 } = i, c2 = e.value || 0, d2 = o3.startColumn, h9 = o3.startColumn + c2 - 1, g9 = 0, m9 = a4.getRowCount() - 1, f4 = {
      unitId: u2,
      subUnitId: l4,
      direction: wm.LEFT,
      range: {
        startColumn: d2,
        endColumn: h9,
        startRow: g9,
        endRow: m9,
        rangeType: ge.COLUMN
      },
      // copy styles from the column before
      cellValue: Ct2(a4, g9, m9, d2, h9, false, d2 - 1)
    };
    return n3.get(Ds).executeCommand(Xe6.id, f4);
  })
};
var ll = {
  type: Ls.COMMAND,
  id: "sheet.command.insert-col-after",
  handler: (n3) => __async(void 0, null, function* () {
    const t3 = n3.get(z).getCurrentSelections();
    let s2;
    if ((t3 == null ? void 0 : t3.length) === 1)
      s2 = t3[0].range;
    else
      return false;
    const o3 = n3.get(br), r = P5(o3);
    if (!r) return false;
    const { worksheet: i, unitId: a4, subUnitId: u2 } = r, l4 = s2.endColumn - s2.startColumn + 1, c2 = s2.endColumn + 1, d2 = s2.endColumn + l4, h9 = 0, g9 = i.getRowCount() - 1, m9 = {
      unitId: a4,
      subUnitId: u2,
      direction: wm.RIGHT,
      range: {
        startColumn: c2,
        endColumn: d2,
        startRow: h9,
        endRow: g9
      },
      // copy styles from the column after
      cellValue: Ct2(i, h9, g9, c2, d2, false, s2.endColumn)
    };
    return n3.get(Ds).executeCommand(Xe6.id, m9);
  })
};
var cl = {
  type: Ls.COMMAND,
  id: "sheet.command.insert-multi-cols-before",
  handler: (n3, e) => __async(void 0, null, function* () {
    const s2 = n3.get(z).getCurrentSelections();
    let o3;
    if ((s2 == null ? void 0 : s2.length) === 1)
      o3 = s2[0].range;
    else
      return false;
    const r = n3.get(br), i = P5(r);
    if (!i) return false;
    const { worksheet: a4, unitId: u2, subUnitId: l4 } = i, c2 = e.value || 0, d2 = o3.startColumn, h9 = o3.startColumn + c2 - 1, g9 = 0, m9 = a4.getRowCount() - 1, f4 = {
      unitId: u2,
      subUnitId: l4,
      direction: wm.LEFT,
      range: {
        startColumn: d2,
        endColumn: h9,
        startRow: g9,
        endRow: m9,
        rangeType: ge.COLUMN
      },
      // copy styles from the column before
      cellValue: Ct2(a4, g9, m9, d2, h9, false, d2 - 1)
    };
    return n3.get(Ds).executeCommand(Xe6.id, f4);
  })
};
var dl = {
  type: Ls.COMMAND,
  id: "sheet.command.insert-multi-cols-right",
  handler: (n3, e) => __async(void 0, null, function* () {
    const s2 = n3.get(z).getCurrentSelections();
    let o3;
    if ((s2 == null ? void 0 : s2.length) === 1)
      o3 = s2[0].range;
    else
      return false;
    const r = n3.get(br), i = P5(r);
    if (!i) return false;
    const { worksheet: a4, unitId: u2, subUnitId: l4 } = i, c2 = e.value || 0, d2 = o3.endColumn + 1, h9 = o3.endColumn + c2, g9 = 0, m9 = a4.getRowCount() - 1, f4 = {
      unitId: u2,
      subUnitId: l4,
      direction: wm.RIGHT,
      range: {
        startColumn: d2,
        endColumn: h9,
        startRow: g9,
        endRow: m9
      },
      // copy styles from the column after
      cellValue: Ct2(a4, g9, m9, d2, h9, false, o3.endColumn)
    };
    return n3.get(Ds).executeCommand(Xe6.id, f4);
  })
};
var xn3 = "sheet.command.remove-row";
var Wr2 = {
  type: Ls.COMMAND,
  id: "sheet.command.remove-row-by-range",
  handler: (n3, e) => {
    var C, p3, w6;
    if (!e)
      return false;
    const t3 = n3.get(br), s2 = P5(t3, e);
    if (!s2) return false;
    const { workbook: o3, worksheet: r } = s2, i = n3.get(G), { range: a4, unitId: u2, subUnitId: l4 } = e, c2 = ls([a4], n3, u2, l4).reverse(), d2 = [], h9 = [];
    c2.forEach((S) => {
      const I6 = [], y6 = [], b4 = {
        unitId: u2,
        subUnitId: l4,
        range: S
      }, N6 = Fa2(
        b4,
        r
      ), U3 = r.getCellMatrix().getSlice(S.startRow, S.endRow, 0, r.getColumnCount() - 1), T10 = {
        unitId: u2,
        subUnitId: l4,
        cellValue: U3.getMatrix()
      };
      y6.push({ id: Te.id, params: b4 }), I6.push({ id: ke2.id, params: N6 }), I6.push({ id: ee2.id, params: T10 }), h9.push(...y6), d2.unshift(...I6);
    });
    const g9 = i.onCommandExecute({
      id: xn3,
      params: { range: a4 }
    }), m9 = n3.get(Ds);
    if (po(
      [
        ...(C = g9.preRedos) != null ? C : [],
        ...h9,
        ...g9.redos,
        ut2(a4, o3, r)
      ],
      m9
    ).result) {
      const S = i.afterCommandExecute({
        id: xn3,
        params: { range: a4 }
      });
      return po(S.redos, m9), n3.get(ra).pushUndoRedo({
        unitID: u2,
        undoMutations: [
          ...(p3 = g9.preUndos) != null ? p3 : [],
          ...d2,
          ...g9.undos,
          ...S.undos
        ],
        redoMutations: [
          ...(w6 = g9.preRedos) != null ? w6 : [],
          ...h9,
          ...g9.redos,
          ...S.redos
        ]
      }), true;
    }
    return false;
  }
};
var hs = {
  type: Ls.COMMAND,
  id: xn3,
  handler: (n3, e) => __async(void 0, null, function* () {
    var h9;
    const t3 = n3.get(z), s2 = n3.get(G), o3 = n3.get(Ds);
    let r = e == null ? void 0 : e.range;
    if (r || (r = (h9 = t3.getCurrentLastSelection()) == null ? void 0 : h9.range), !r) return false;
    const i = n3.get(br), a4 = P5(i);
    if (!a4) return false;
    const { worksheet: u2, subUnitId: l4, unitId: c2 } = a4;
    return r = __spreadProps(__spreadValues({}, r), {
      startColumn: 0,
      endColumn: Math.max(u2.getMaxColumns() - 1, 0)
    }), (yield s2.beforeCommandExecute({
      id: hs.id,
      params: { range: r }
    })) ? o3.syncExecuteCommand(Wr2.id, {
      range: r,
      unitId: c2,
      subUnitId: l4
    }) : false;
  })
};
var $n2 = "sheet.command.remove-col";
var Vr2 = {
  type: Ls.COMMAND,
  id: "sheet.command.remove-col-by-range",
  handler: (n3, e) => {
    var p3, w6, S;
    if (!e)
      return false;
    const t3 = n3.get(br), s2 = P5(t3, e);
    if (!s2) return false;
    const { workbook: o3, worksheet: r } = s2, i = n3.get(G), { range: a4, unitId: u2, subUnitId: l4 } = e, c2 = {
      unitId: u2,
      subUnitId: l4,
      range: a4
    }, d2 = Ba(n3, c2), h9 = r.getCellMatrix().getSlice(0, r.getRowCount() - 1, a4.startColumn, a4.endColumn), g9 = {
      unitId: u2,
      subUnitId: l4,
      cellValue: h9.getMatrix()
    }, m9 = i.onCommandExecute({
      id: $n2,
      params: { range: a4 }
    }), f4 = n3.get(Ds);
    if (po(
      [
        ...(p3 = m9.preRedos) != null ? p3 : [],
        { id: Me.id, params: c2 },
        ...m9.redos,
        ut2(a4, o3, r)
      ],
      f4
    ).result) {
      const I6 = i.afterCommandExecute({
        id: $n2,
        params: { range: a4 }
      });
      return po(I6.redos, f4), n3.get(ra).pushUndoRedo({
        unitID: u2,
        undoMutations: [
          ...(w6 = m9.preUndos) != null ? w6 : [],
          { id: Ue2.id, params: d2 },
          { id: ee2.id, params: g9 },
          ...m9.undos,
          ...I6.undos
        ],
        redoMutations: [
          ...(S = m9.preRedos) != null ? S : [],
          { id: Me.id, params: c2 },
          ...m9.redos,
          ...I6.redos
        ]
      }), true;
    }
    return false;
  }
};
var gs = {
  type: Ls.COMMAND,
  id: $n2,
  handler: (n3, e) => __async(void 0, null, function* () {
    var h9;
    const t3 = n3.get(z), s2 = n3.get(G), o3 = n3.get(Ds);
    let r = e == null ? void 0 : e.range;
    if (r || (r = (h9 = t3.getCurrentLastSelection()) == null ? void 0 : h9.range), !r) return false;
    const i = n3.get(br), a4 = P5(i);
    if (!a4) return false;
    const { worksheet: u2, subUnitId: l4, unitId: c2 } = a4;
    return r = __spreadProps(__spreadValues({}, r), {
      startRow: 0,
      endRow: Math.max(u2.getMaxRows() - 1, 0)
    }), (yield s2.beforeCommandExecute({
      id: gs.id,
      params: { range: r }
    })) ? o3.syncExecuteCommand(Vr2.id, {
      range: r,
      unitId: c2,
      subUnitId: l4
    }) : false;
  })
};
var hl = (n3, e) => {
  const t3 = n3.get(br), { subUnitId: s2, unitId: o3 } = e, r = Qe2(t3, e);
  if (!r)
    throw new Error("[RemoveSheetUndoMutationFactory]: Worksheet is null error!");
  const { workbook: i, worksheet: a4 } = r, u2 = a4.getConfig();
  return {
    index: i.getConfig().sheetOrder.findIndex((d2) => d2 === s2),
    sheet: u2,
    unitId: o3
  };
};
var Lt2 = {
  id: "sheet.mutation.remove-sheet",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const t3 = n3.get(br), { subUnitId: s2, unitId: o3 } = e, r = t3.getUniverSheetInstance(o3);
    return r ? r.removeSheet(s2) : false;
  }
};
function gl(n3, e) {
  return e.getMergeData().some((t3) => t3.startRow < n3 && n3 <= t3.endRow);
}
function ml(n3, e) {
  return e.getMergeData().some((t3) => t3.startColumn < n3 && n3 <= t3.endColumn);
}
var Lr2 = "sheet.command.move-rows";
var an = {
  id: Lr2,
  type: Ls.COMMAND,
  // eslint-disable-next-line max-lines-per-function
  handler: (n3, e) => {
    var H6, F7;
    const t3 = n3.get(z), {
      fromRange: { startRow: s2 },
      toRange: { startRow: o3 },
      range: r
    } = e, i = r ? [Fr2(r)] : t3.getCurrentSelections(), a4 = i == null ? void 0 : i.filter(
      (K5) => K5.range.rangeType === ge.ROW && K5.range.startRow <= s2 && s2 <= K5.range.endRow
    );
    if ((a4 == null ? void 0 : a4.length) !== 1)
      return false;
    const u2 = n3.get(G), l4 = n3.get(br), c2 = P5(l4, e);
    if (!c2) return false;
    const { workbook: d2, worksheet: h9 } = c2, g9 = d2.getUnitId(), m9 = h9.getSheetId(), f4 = n3.get(CE), C = n3.get(Hn), p3 = a4[0].range, w6 = a4[0].primary, S = cs2(p3, h9, false);
    if (!Cn.equals(p3, S))
      return f4.emit(C.t("sheets.info.partOfCell")), false;
    if (gl(o3, h9))
      return f4.emit(C.t("sheets.info.acrossMergedCell")), false;
    const I6 = __spreadProps(__spreadValues({}, p3), {
      startRow: o3,
      endRow: o3 + p3.endRow - p3.startRow
    }), y6 = {
      unitId: g9,
      subUnitId: m9,
      sourceRange: p3,
      targetRange: I6
    }, b4 = La(n3, y6), N6 = n3.get(Ds), U3 = u2.onCommandExecute({ id: an.id, params: e }), T10 = [
      ...(H6 = U3.preRedos) != null ? H6 : [],
      { id: Je3.id, params: y6 }
    ], k6 = [
      ...(F7 = U3.preUndos) != null ? F7 : [],
      { id: Je3.id, params: b4 }
    ];
    if (w6) {
      const J6 = o3 - s2 < 0, ae5 = p3.endRow - p3.startRow + 1, oe5 = J6 ? I6 : __spreadProps(__spreadValues({}, I6), {
        startRow: I6.startRow - ae5,
        endRow: I6.endRow - ae5
      }), le3 = {
        unitId: g9,
        subUnitId: m9,
        type: we3.MOVE_END,
        selections: [{
          range: oe5,
          primary: _e3(oe5, h9),
          style: null
        }]
      }, Se5 = {
        unitId: g9,
        subUnitId: m9,
        type: we3.MOVE_END,
        selections: [{ range: p3, primary: w6, style: null }]
      };
      T10.push({ id: ie5.id, params: le3 }), k6.push({ id: ie5.id, params: Se5 });
    }
    if (T10.push(...U3.redos), k6.push(...U3.undos), po(T10, N6).result) {
      const K5 = u2.afterCommandExecute({
        id: an.id,
        params: e
      });
      return po(K5.redos, N6), T10.push(...K5.redos), k6.push(...K5.undos), n3.get(ra).pushUndoRedo({
        unitID: g9,
        undoMutations: k6,
        redoMutations: T10
      }), true;
    }
    return false;
  }
};
var Hr = "sheet.command.move-cols";
var un = {
  id: Hr,
  type: Ls.COMMAND,
  // eslint-disable-next-line max-lines-per-function
  handler: (n3, e) => {
    var H6, F7;
    const t3 = n3.get(z), {
      fromRange: { startColumn: s2 },
      toRange: { startColumn: o3 },
      range: r
    } = e, i = r ? [Fr2(r)] : t3.getCurrentSelections(), a4 = i == null ? void 0 : i.filter(
      (K5) => K5.range.rangeType === ge.COLUMN && K5.range.startColumn <= s2 && s2 <= K5.range.endColumn
    );
    if ((a4 == null ? void 0 : a4.length) !== 1)
      return false;
    const u2 = n3.get(G), l4 = n3.get(br), c2 = P5(l4, e);
    if (!c2) return false;
    const { workbook: d2, worksheet: h9 } = c2, g9 = d2.getUnitId(), m9 = h9.getSheetId(), f4 = n3.get(CE), C = n3.get(Hn), p3 = a4[0].range, w6 = a4[0].primary, S = cs2(p3, h9, false);
    if (!Cn.equals(p3, S))
      return f4.emit(C.t("sheets.info.partOfCell")), false;
    if (ml(o3, h9))
      return f4.emit(C.t("sheets.info.acrossMergedCell")), false;
    const I6 = __spreadProps(__spreadValues({}, p3), {
      startColumn: o3,
      endColumn: o3 + p3.endColumn - p3.startColumn
    }), y6 = {
      unitId: g9,
      subUnitId: m9,
      sourceRange: p3,
      targetRange: I6
    }, b4 = Ha2(n3, y6), N6 = n3.get(Ds), U3 = u2.onCommandExecute({ id: un.id, params: e }), T10 = [
      ...(H6 = U3.preRedos) != null ? H6 : [],
      { id: qe2.id, params: y6 }
    ], k6 = [
      ...(F7 = U3.preUndos) != null ? F7 : [],
      { id: qe2.id, params: b4 }
    ];
    if (w6) {
      const K5 = p3.endColumn - p3.startColumn + 1, oe5 = o3 - s2 < 0 ? I6 : __spreadProps(__spreadValues({}, I6), {
        startColumn: I6.startColumn - K5,
        endColumn: I6.endColumn - K5
      }), le3 = {
        unitId: g9,
        subUnitId: m9,
        type: we3.MOVE_END,
        selections: [{ range: oe5, primary: _e3(oe5, h9), style: null }]
      }, Se5 = {
        unitId: g9,
        subUnitId: m9,
        type: we3.MOVE_END,
        selections: [{ range: p3, primary: w6, style: null }]
      };
      T10.push({ id: ie5.id, params: le3 }), k6.push({ id: ie5.id, params: Se5 });
    }
    if (T10.push(...U3.redos), k6.push(...U3.undos), po(T10, N6).result) {
      const K5 = u2.afterCommandExecute({
        id: un.id,
        params: e
      });
      return po(K5.redos, N6), T10.push(...K5.redos), k6.push(...K5.undos), n3.get(ra).pushUndoRedo({
        unitID: g9,
        undoMutations: k6,
        redoMutations: T10
      }), true;
    }
    return false;
  }
};
function Fr2(n3) {
  return {
    range: n3,
    primary: null,
    style: null
  };
}
var fl2 = Object.getOwnPropertyDescriptor;
var Rl = (n3, e, t3, s2) => {
  for (var o3 = s2 > 1 ? void 0 : s2 ? fl2(e, t3) : e, r = n3.length - 1, i; r >= 0; r--)
    (i = n3[r]) && (o3 = i(o3) || o3);
  return o3;
};
var Cl = (n3, e) => (t3, s2) => e(t3, s2, n3);
var rt3 = class extends Ve {
  constructor(e) {
    super();
    R(this, "_sheetSkeletonStore", /* @__PURE__ */ new Map());
    this._injector = e, this.disposeWithMe(() => {
      this._sheetSkeletonStore = /* @__PURE__ */ new Map();
    });
  }
  getSkeleton(e, t3) {
    if (this._sheetSkeletonStore.has(e))
      return this._sheetSkeletonStore.get(e).get(t3);
  }
  setSkeleton(e, t3, s2) {
    this._sheetSkeletonStore.has(e) || this._sheetSkeletonStore.set(e, /* @__PURE__ */ new Map()), this._sheetSkeletonStore.get(e).set(t3, s2);
  }
  deleteSkeleton(e, t3) {
    this._sheetSkeletonStore.has(e) && this._sheetSkeletonStore.get(e).delete(t3);
  }
};
rt3 = Rl([
  Cl(0, Inject(Injector))
], rt3);
function qs(n3, e) {
  const t3 = new ht();
  return n3.map((s2) => vr.transformRange(s2, e)).forEach((s2) => {
    vr.foreach(s2, (o3, r) => {
      const i = e.getCellHeight(o3, r);
      i && t3.setValue(o3, r, i);
    });
  }), t3;
}
var pl = 1e4;
function wn(n3, e) {
  if (!e)
    return { suitableRanges: n3, remainingRanges: [] };
  const t3 = e.worksheet.getColumnCount(), s2 = Math.ceil(pl / t3), o3 = [], r = [], i = e.getOffsetRelativeToRowCol(0, e.scrollY).row, a4 = n3.map((l4) => {
    let c2;
    return i >= l4.startRow && i <= l4.endRow ? c2 = 0 : i < l4.startRow ? c2 = l4.startRow - i : c2 = i - l4.endRow, {
      range: l4,
      distance: c2,
      rowCount: l4.endRow - l4.startRow + 1
      // Number of rows in the range
    };
  });
  a4.sort((l4, c2) => l4.distance !== c2.distance ? l4.distance - c2.distance : l4.rowCount - c2.rowCount);
  let u2 = 0;
  for (const l4 of a4)
    if (u2 + l4.rowCount <= s2)
      o3.push(l4.range), u2 += l4.rowCount;
    else {
      const c2 = s2 - u2;
      if (c2 > 0) {
        const d2 = __spreadProps(__spreadValues({}, l4.range), {
          endRow: l4.range.startRow + c2 - 1
        }), h9 = __spreadProps(__spreadValues({}, l4.range), {
          startRow: l4.range.startRow + c2
        });
        o3.push(d2), r.push(h9), u2 = s2;
      } else
        r.push(l4.range);
    }
  return { suitableRanges: o3, remainingRanges: r };
}
function Sl2(n3) {
  let e = 0;
  return n3.forEach(() => {
    e++;
  }), e;
}
var Br = "sheet.command.reorder-range";
var ks = {
  id: Br,
  type: Ls.COMMAND,
  handler: (n3, e) => {
    var S, I6;
    const { subUnitId: t3, unitId: s2, range: o3, order: r } = e, i = n3.get(Ds), a4 = {
      id: On2.id,
      params: {
        unitId: s2,
        subUnitId: t3,
        order: r,
        range: o3
      }
    }, u2 = {
      id: On2.id,
      params: ja4(a4.params)
    }, l4 = n3.get(G), c2 = l4.onCommandExecute({ id: ks.id, params: e }), d2 = [
      ...(S = c2.preRedos) != null ? S : [],
      a4,
      ...c2.redos
    ], h9 = [
      ...(I6 = c2.preUndos) != null ? I6 : [],
      u2,
      ...c2.undos
    ], g9 = po(d2, i), { suitableRanges: m9, remainingRanges: f4 } = wn([o3], n3.get(rt3).getSkeleton(s2, t3)), { undos: C, redos: p3 } = l4.generateMutationsOfAutoHeight({
      unitId: s2,
      subUnitId: t3,
      ranges: [o3],
      autoHeightRanges: m9,
      lazyAutoHeightRanges: f4
    }), w6 = l4.afterCommandExecute({ id: ks.id, params: e });
    return g9.result ? (po([...w6.redos, ...p3], i), n3.get(ra).pushUndoRedo({
      unitID: s2,
      undoMutations: [...h9, ...w6.undos, ...C],
      redoMutations: [...d2, ...w6.redos, ...p3]
    }), true) : false;
  }
};
var W2 = {
  MoveRangeCommandId: or2,
  InsertRowCommandId: Dr2,
  InsertColCommandId: xr,
  RemoveColCommandId: $n2,
  RemoveRowCommandId: xn3,
  DeleteRangeMoveLeftCommandId: Nr,
  DeleteRangeMoveUpCommandId: Or,
  InsertRangeMoveDownCommandId: sl,
  InsertRangeMoveRightCommandId: Js2,
  MoveColsCommandId: Hr,
  MoveRowsCommandId: Lr2,
  ReorderRangeCommandId: Br
};
var Q4 = ((n3) => (n3[n3.Set = 0] = "Set", n3[n3.Delete = 1] = "Delete", n3[n3.HorizontalMove = 2] = "HorizontalMove", n3[n3.VerticalMove = 3] = "VerticalMove", n3[n3.Unknown = 4] = "Unknown", n3))(Q4 || {});
var _n2 = Number.MAX_SAFE_INTEGER;
var Ke4 = (n3) => {
  const e = __spreadValues({}, n3), t3 = Number.isNaN(e.startRow) && Number.isNaN(e.endRow) && !Number.isNaN(e.startColumn) && !Number.isNaN(e.endColumn), s2 = Number.isNaN(e.startColumn) && Number.isNaN(e.endColumn) && !Number.isNaN(e.startRow) && !Number.isNaN(e.endRow);
  return (e.rangeType === ge.COLUMN || t3) && (e.startRow = 0, e.endRow = _n2), (e.rangeType === ge.ROW || s2) && (e.startColumn = 0, e.endColumn = _n2), e.rangeType === ge.ALL && (e.startColumn = 0, e.endColumn = _n2, e.startRow = 0, e.endRow = _n2), e;
};
var Oe = (n3) => {
  let e = n3.rangeType;
  return n3.rangeType === ge.COLUMN ? e = ge.ROW : n3.rangeType === ge.ROW && (e = ge.COLUMN), {
    startRow: n3.startColumn,
    endRow: n3.endColumn,
    startColumn: n3.startRow,
    endColumn: n3.endRow,
    rangeType: e
  };
};
var Wn2 = (n3, e, t3) => {
  const s2 = __spreadValues({}, t3), o3 = __spreadValues({}, e), r = (f4, C) => {
    const p3 = Math.max(f4.start, C.start), w6 = Math.min(f4.end, C.end);
    return w6 < p3 ? null : { start: p3, end: w6 };
  }, i = (f4) => f4.end - f4.start + 1, a4 = (f4, C) => ({
    start: f4.start - C.start,
    end: f4.start - C.start + f4.end - f4.start
  }), u2 = (f4, C) => ({
    start: C.start + f4.start,
    end: C.start + f4.start + f4.end - f4.start
  }), l4 = e.start > n3.start;
  if (l4) {
    const f4 = Math.min(n3.end, e.start) - n3.start + 1;
    o3.start -= f4, o3.end -= f4;
  }
  const c2 = i(n3), d2 = c2, h9 = r(n3, s2), g9 = h9 && i(h9) >= i(s2);
  if (n3.end < s2.start)
    s2.start -= c2, s2.end -= c2;
  else if (h9) {
    const f4 = i(h9);
    if (g9) {
      const C = a4(s2, n3), p3 = u2(C, o3);
      s2.start = p3.start, s2.end = p3.end;
    } else h9.start > n3.start ? l4 ? (s2.end -= f4 + c2, s2.start -= c2) : s2.end -= f4 : l4 ? s2.end -= f4 : s2.start > n3.start && s2.end > n3.end ? (s2.start -= c2, s2.end -= c2 + f4) : s2.end -= f4;
  }
  const m9 = r(o3, s2);
  return g9 || (o3.start <= s2.start ? (s2.start += d2, s2.end += d2) : m9 && (l4 ? o3.end <= s2.start || o3.start <= s2.start && o3.end >= s2.start ? (s2.start += d2, s2.end += d2) : o3.start >= s2.start && o3.start <= s2.end && (s2.end += d2) : s2.start < o3.start && s2.end > o3.start ? s2.end += d2 : (s2.start >= o3.end || s2.start >= o3.start && s2.start <= o3.end) && (s2.end += d2, s2.start += d2))), {
    step: s2.start - t3.start,
    length: i(s2) - i(t3)
  };
};
var jr2 = (n3, e) => {
  const { fromRange: t3, toRange: s2 } = n3.params || {};
  if (!s2 || !t3)
    return [];
  const o3 = Ke4(t3), r = Ke4(s2), i = Ke4(e), a4 = Wn2(
    { start: o3.startRow, end: o3.endRow },
    { start: r.startRow, end: r.endRow },
    { start: i.startRow, end: i.endRow }
  );
  return a4 === null ? [
    {
      type: Q4.Delete
    }
  ] : [
    {
      type: Q4.VerticalMove,
      step: a4.step || 0,
      length: a4.length || 0
    }
  ];
};
var wl2 = (n3, e) => {
  const { fromRange: t3, toRange: s2 } = n3.params || {};
  if (!t3 || !s2)
    return [e];
  const o3 = t3.startRow, r = t3.endRow - t3.startRow + 1, i = s2.startRow, a4 = new ht();
  return vr.foreach(e, (l4, c2) => {
    a4.setValue(l4, c2, 1);
  }), a4.moveRows(o3, r, i), S1(a4, (l4) => l4 === 1);
};
var Il = (n3, e) => {
  const { range: t3, order: s2 } = n3.params || {};
  if (!t3 || !s2)
    return [e];
  const o3 = new ht();
  vr.foreach(e, (a4, u2) => {
    o3.setValue(a4, u2, 1);
  });
  const r = new ht();
  return vr.foreach(t3, (a4, u2) => {
    var l4;
    if (Object.prototype.hasOwnProperty.call(s2, a4)) {
      const c2 = s2[a4], d2 = (l4 = o3.getValue(c2, u2)) != null ? l4 : 0;
      r.setValue(a4, u2, d2);
    }
  }), r.forValue((a4, u2, l4) => {
    o3.setValue(a4, u2, l4);
  }), S1(o3, (a4) => a4 === 1);
};
var zr = (n3, e) => {
  const { fromRange: t3, toRange: s2 } = n3.params || {};
  if (!s2 || !t3)
    return [];
  const o3 = Ke4(t3), r = Ke4(s2), i = Ke4(e), a4 = Wn2(
    { start: o3.startColumn, end: o3.endColumn },
    { start: r.startColumn, end: r.endColumn },
    { start: i.startColumn, end: i.endColumn }
  );
  return a4 === null ? [
    {
      type: Q4.Delete
    }
  ] : [
    {
      type: Q4.HorizontalMove,
      step: a4.step || 0,
      length: a4.length || 0
    }
  ];
};
var vl = (n3, e) => {
  const { fromRange: t3, toRange: s2 } = n3.params || {};
  if (!t3 || !s2)
    return [e];
  const o3 = t3.startColumn, r = t3.endColumn - t3.startColumn + 1, i = s2.startColumn, a4 = new ht();
  return vr.foreach(e, (u2, l4) => {
    a4.setValue(u2, l4, 1);
  }), a4.moveColumns(o3, r, i), S1(a4, (u2) => u2 === 1);
};
var Ml = (n3, e) => {
  var r, i;
  const t3 = (r = n3.params) == null ? void 0 : r.toRange, s2 = (i = n3.params) == null ? void 0 : i.fromRange;
  if (!t3 || !s2)
    return [];
  const o3 = [];
  if (Cn.contains(t3, e) && o3.push({
    type: Q4.Delete
  }), Cn.contains(s2, e)) {
    o3.push({
      type: Q4.Delete
    });
    const a4 = Cn.getRelativeRange(e, s2), u2 = Cn.getPositionRange(a4, t3);
    return [
      {
        type: Q4.Set,
        range: u2
      }
    ];
  }
  return o3;
};
var _l = (n3, e) => {
  var d2, h9;
  const t3 = (d2 = n3.params) == null ? void 0 : d2.toRange, s2 = (h9 = n3.params) == null ? void 0 : h9.fromRange;
  if (!t3 || !s2)
    return [e];
  if (!Cn.intersects(s2, e) && !Cn.intersects(t3, e))
    return [e];
  if (Cn.contains(s2, e)) {
    const g9 = Cn.getRelativeRange(e, s2);
    return [Cn.getPositionRange(g9, t3)];
  }
  const o3 = new ht();
  vr.foreach(e, (g9, m9) => {
    o3.setValue(g9, m9, 1);
  });
  const r = new ht(), i = Cn.getIntersects(s2, e);
  i && vr.foreach(i, (g9, m9) => {
    o3.getValue(g9, m9) && (o3.setValue(g9, m9, void 0), r.setValue(g9, m9, 1));
  });
  const a4 = t3.startColumn - s2.startColumn, u2 = t3.startRow - s2.startRow, l4 = {
    startColumn: t3.startColumn - a4,
    endColumn: t3.endColumn - a4,
    startRow: t3.startRow - u2,
    endRow: t3.endRow - u2
  };
  return l4 && vr.foreach(l4, (g9, m9) => {
    var p3;
    const f4 = g9 + u2, C = m9 + a4;
    o3.setValue(f4, C, (p3 = r.getValue(g9, m9)) != null ? p3 : 0);
  }), S1(o3, (g9) => g9 === 1);
};
var Nt3 = (n3, e) => {
  const t3 = Ke4(n3), s2 = Ke4(e), o3 = (i) => i.endColumn - i.startColumn + 1, r = (i) => i.endRow - i.startRow + 1;
  if (t3.startRow <= s2.startRow && t3.endRow >= s2.endRow) {
    if (
      // 2
      s2.startColumn < t3.startColumn && s2.endColumn >= t3.startColumn && s2.endColumn <= t3.endColumn || // 6
      s2.startColumn < t3.startColumn && s2.endColumn >= t3.endColumn
    ) {
      const i = Cn.getIntersects(s2, t3);
      if (i)
        return { step: 0, length: -o3(i) };
    }
    if (s2.startColumn >= t3.startColumn && s2.endColumn <= t3.endColumn && r(t3) >= r(s2))
      return null;
    if (s2.startColumn >= t3.startColumn && s2.startColumn <= t3.endColumn && s2.endColumn > t3.endColumn) {
      const i = Cn.getIntersects(s2, t3);
      if (i) {
        const a4 = -o3(i);
        return { step: -(o3(t3) - o3(i)), length: a4 };
      }
    }
    if (s2.startColumn > t3.endColumn)
      return { step: -o3(t3), length: 0 };
  }
  return { step: 0, length: 0 };
};
var Gr3 = (n3, e) => {
  var r;
  const t3 = (r = n3.params) == null ? void 0 : r.range;
  if (!t3)
    return [];
  const s2 = [], o3 = Nt3(t3, e);
  if (!o3)
    s2.push({ type: Q4.Delete });
  else {
    const { step: i, length: a4 } = o3;
    s2.push({
      type: Q4.HorizontalMove,
      step: i,
      length: a4
    });
  }
  return s2;
};
var yl3 = (n3, e, t3) => {
  var i;
  const s2 = (i = n3.params) == null ? void 0 : i.range;
  if (!s2)
    return [];
  const o3 = [];
  if (t3 && t3.length > 0) {
    let a4 = s2.startRow;
    for (let u2 = s2.startRow; u2 <= s2.endRow; u2++) {
      if (t3.includes(u2)) {
        if (u2 === a4) {
          a4 = u2 + 1;
          continue;
        }
        r(__spreadProps(__spreadValues({}, s2), {
          startRow: a4,
          endRow: u2 - 1
        })), a4 = u2 + 1;
        continue;
      }
      u2 === s2.endRow && r(__spreadProps(__spreadValues({}, s2), {
        startRow: a4,
        endRow: s2.endRow
      }));
    }
  } else
    r(s2);
  function r(a4) {
    const u2 = Nt3(Oe(a4), Oe(e));
    if (!u2)
      o3.push({ type: Q4.Delete });
    else {
      const { step: l4, length: c2 } = u2;
      o3.push({
        type: Q4.VerticalMove,
        step: l4,
        length: c2
      });
    }
  }
  return o3;
};
var bl = (n3, e) => {
  const { range: t3, order: s2 } = n3.params || {};
  if (!t3 || !s2)
    return [];
  if (Cn.contains(t3, e) && e.endRow === e.startRow) {
    const o3 = [], r = e.startRow;
    for (const i in s2)
      if (s2[i] === r) {
        const a4 = Number(i);
        return o3.push({
          type: Q4.VerticalMove,
          step: a4 - r,
          length: 0
        }), o3;
      }
    return [];
  }
  return [];
};
var Ot = (n3, e) => {
  const t3 = Ke4(n3), s2 = Ke4(e), o3 = (r) => r.endColumn - r.startColumn + 1;
  return t3.startRow <= s2.startRow && t3.endRow >= s2.endRow ? (
    // 2
    // Case 2: Overlap on the left side
    // Target range starts before the insert range and ends within the insert range boundaries
    // targetRange:  |----------|
    // insertRange:         |-------|
    // insertRange:
    s2.startColumn < t3.startColumn && s2.endColumn >= t3.startColumn && s2.endColumn <= t3.endColumn || // 6
    // Case 6: Fully overlapping on both sides
    // Target range starts before the insert range and ends after the insert range
    // targetRange:  |----------------|
    // insertRange:         |-------|
    s2.startColumn < t3.startColumn && s2.endColumn >= t3.endColumn ? { step: 0, length: o3(t3) } : (
      // 3
      // Case 3: Fully contained
      // Target range is completely within the insert range
      // targetRange:      |---|
      // insertRange:    |-------|
      s2.startColumn >= t3.startColumn && s2.endColumn <= t3.endColumn || // 4
      // Case 4: Overlap on the right side
      // Target range starts within the insert range and ends after the insert range
      // targetRange:         |---------|
      // insertRange:    |-------|
      s2.startColumn >= t3.startColumn && s2.startColumn <= t3.endColumn && s2.endColumn > t3.endColumn || //5
      // Case 5: No overlap (target range starts after the insert range ends)
      // targetRange:                |-------|
      // insertRange:    |-------|
      s2.startColumn >= t3.endColumn ? { step: o3(t3), length: 0 } : { step: 0, length: 0 }
    )
  ) : { step: 0, length: 0 };
};
function El(n3, e, t3) {
  const s2 = [];
  if (Cn.contains(e, t3) && s2.push({
    type: Q4.Delete
  }), Cn.contains(n3, t3)) {
    s2.push({
      type: Q4.Delete
    });
    const o3 = Cn.getRelativeRange(t3, n3), r = Cn.getPositionRange(o3, e);
    return [
      {
        type: Q4.Set,
        range: r
      }
    ];
  }
  return s2;
}
var kl2 = (n3, e) => {
  var a4;
  const t3 = (a4 = n3.params) == null ? void 0 : a4.range;
  if (!t3)
    return [];
  const s2 = [], o3 = Ot(Oe(t3), Oe(e)), { step: r, length: i } = o3;
  return s2.push({
    type: Q4.VerticalMove,
    step: r,
    length: i
  }), s2;
};
var Ul = (n3, e) => {
  var a4;
  const t3 = (a4 = n3.params) == null ? void 0 : a4.range;
  if (!t3)
    return [];
  const s2 = [], o3 = Ot(t3, e), { step: r, length: i } = o3;
  return s2.push({
    type: Q4.HorizontalMove,
    step: r,
    length: i
  }), s2;
};
var Tl = (n3, e) => {
  var a4;
  const t3 = (a4 = n3.params) == null ? void 0 : a4.range;
  if (!t3)
    return [];
  const s2 = [], o3 = Ot(Oe(t3), Oe(e)), { step: r, length: i } = o3;
  return s2.push({
    type: Q4.VerticalMove,
    step: r,
    length: i
  }), s2;
};
var Pl = (n3, e) => {
  var u2;
  const t3 = (u2 = n3.params) == null ? void 0 : u2.range;
  if (!t3)
    return [e];
  const s2 = t3.endRow - t3.startRow + 1, o3 = __spreadProps(__spreadValues({}, t3), {
    startRow: t3.startRow,
    endRow: Number.POSITIVE_INFINITY
  }), r = Cn.subtract(e, o3), i = Cn.getIntersects(o3, e);
  if (!i)
    return [e];
  const a4 = new ht();
  return r.forEach((l4) => {
    vr.foreach(l4, (c2, d2) => {
      a4.setValue(c2, d2, 1);
    });
  }), i && vr.foreach(i, (l4, c2) => {
    a4.setValue(l4 + s2, c2, 1);
  }), S1(a4, (l4) => l4 === 1);
};
var Nl3 = (n3, e) => {
  var a4;
  const t3 = (a4 = n3.params) == null ? void 0 : a4.range;
  if (!t3)
    return [];
  const s2 = [], o3 = Ot(t3, e), { step: r, length: i } = o3;
  return s2.push({
    type: Q4.HorizontalMove,
    step: r,
    length: i
  }), s2;
};
var Ol = (n3, e) => {
  var u2;
  const t3 = (u2 = n3.params) == null ? void 0 : u2.range;
  if (!t3)
    return [e];
  const s2 = t3.endColumn - t3.startColumn + 1, o3 = __spreadProps(__spreadValues({}, t3), {
    startColumn: t3.startColumn,
    endColumn: Number.POSITIVE_INFINITY
  }), r = Cn.subtract(e, o3), i = Cn.getIntersects(o3, e);
  if (!i)
    return [e];
  const a4 = new ht();
  return r.forEach((l4) => {
    vr.foreach(l4, (c2, d2) => {
      a4.setValue(c2, d2, 1);
    });
  }), i && vr.foreach(i, (l4, c2) => {
    a4.setValue(l4, c2 + s2, 1);
  }), S1(a4, (l4) => l4 === 1);
};
var Dl = (n3, e) => {
  var r;
  const t3 = (r = n3.params) == null ? void 0 : r.range;
  if (!t3)
    return [];
  const s2 = [], o3 = Nt3(t3, e);
  if (!o3)
    s2.push({ type: Q4.Delete });
  else {
    const { step: i, length: a4 } = o3;
    s2.push({
      type: Q4.HorizontalMove,
      step: i,
      length: a4
    });
  }
  return s2;
};
var Al = (n3, e) => {
  var l4;
  const t3 = (l4 = n3.params) == null ? void 0 : l4.range;
  if (!t3)
    return [e];
  const s2 = {
    startRow: t3.startRow,
    endRow: t3.endRow,
    startColumn: t3.startColumn,
    endColumn: Number.POSITIVE_INFINITY
  }, o3 = t3.endColumn - t3.startColumn + 1, r = Cn.getIntersects(t3, e), i = Cn.subtract(e, s2), a4 = Cn.getIntersects(s2, e);
  if (!r && !a4)
    return [e];
  const u2 = new ht();
  return a4 && vr.foreach(a4, (c2, d2) => {
    u2.setValue(c2, d2 - o3, 1);
  }), r && vr.foreach(r, (c2, d2) => {
    u2.setValue(c2, d2 - o3, 0);
  }), i.forEach((c2) => {
    vr.foreach(c2, (d2, h9) => {
      u2.setValue(d2, h9, 1);
    });
  }), S1(u2, (c2) => c2 === 1);
};
var xl2 = (n3, e) => {
  var r;
  const t3 = (r = n3.params) == null ? void 0 : r.range;
  if (!t3)
    return [];
  const s2 = [], o3 = Nt3(Oe(t3), Oe(e));
  if (!o3)
    s2.push({ type: Q4.Delete });
  else {
    const { step: i, length: a4 } = o3;
    s2.push({
      type: Q4.VerticalMove,
      step: i,
      length: a4
    });
  }
  return s2;
};
var $l2 = (n3, e) => {
  var l4;
  const t3 = (l4 = n3.params) == null ? void 0 : l4.range;
  if (!t3)
    return [e];
  const s2 = __spreadProps(__spreadValues({}, t3), {
    startRow: t3.startRow,
    endRow: Number.POSITIVE_INFINITY
  }), o3 = t3.endRow - t3.startRow + 1, r = Cn.getIntersects(t3, e), i = Cn.subtract(e, s2), a4 = Cn.getIntersects(s2, e);
  if (!r && !a4)
    return [e];
  const u2 = new ht();
  return a4 && vr.foreach(a4, (c2, d2) => {
    u2.setValue(c2 - o3, d2, 1);
  }), r && vr.foreach(r, (c2, d2) => {
    u2.setValue(c2 - o3, d2, 0);
  }), i.forEach((c2) => {
    vr.foreach(c2, (d2, h9) => {
      u2.setValue(d2, h9, 1);
    });
  }), S1(u2, (c2) => c2 === 1);
};
var Wl = (n3, e) => {
  var o3;
  const t3 = (o3 = n3.ranges) != null ? o3 : [n3.range], s2 = new ht();
  return vr.foreach(e, (r, i) => {
    s2.setValue(r, i, 1);
  }), t3.forEach((r) => {
    const i = r.startRow, u2 = r.endRow - i + 1;
    s2.removeRows(i, u2);
  }), S1(s2, (r) => r === 1);
};
var Vl = (n3, e) => {
  const t3 = n3.params, s2 = t3.range.startRow, o3 = t3.range.endRow - t3.range.startRow + 1;
  return e.startRow >= s2 ? [{
    startRow: e.startRow + o3,
    endRow: e.endRow + o3,
    startColumn: e.startColumn,
    endColumn: e.endColumn
  }] : e.endRow < s2 ? [e] : [{
    startRow: e.startRow,
    endRow: e.endRow + o3,
    startColumn: e.startColumn,
    endColumn: e.endColumn
  }];
};
var Ll2 = (n3, e) => {
  const t3 = n3.params, s2 = t3.range.startColumn, o3 = t3.range.endColumn - t3.range.startColumn + 1;
  return e.startColumn >= s2 ? [{
    startRow: e.startRow,
    endRow: e.endRow,
    startColumn: e.startColumn + o3,
    endColumn: e.endColumn + o3
  }] : e.endColumn < s2 ? [e] : [{
    startRow: e.startRow,
    endRow: e.endRow,
    startColumn: e.startColumn,
    endColumn: e.endColumn + o3
  }];
};
var Dt = (n3, e) => {
  let t3 = __spreadValues({}, e);
  return n3.forEach((s2) => {
    switch (s2.type) {
      case Q4.Delete: {
        t3 = null;
        break;
      }
      case Q4.HorizontalMove: {
        if (!t3)
          return;
        t3.startColumn += s2.step, t3.endColumn += s2.step + (s2.length || 0);
        break;
      }
      case Q4.VerticalMove: {
        if (!t3)
          return;
        t3.startRow += s2.step, t3.endRow += s2.step + (s2.length || 0);
        break;
      }
      case Q4.Set: {
        t3 = s2.range;
        break;
      }
    }
  }), t3 && (t3.endColumn < t3.startColumn || t3.endRow < t3.startRow) ? null : t3;
};
var po2 = (n3, e) => {
  let t3 = [];
  switch (e.id) {
    case W2.DeleteRangeMoveLeftCommandId: {
      t3 = Dl(e, n3);
      break;
    }
    case W2.DeleteRangeMoveUpCommandId: {
      t3 = xl2(e, n3);
      break;
    }
    case W2.InsertColCommandId: {
      t3 = Ul(e, n3);
      break;
    }
    case W2.InsertRangeMoveDownCommandId: {
      t3 = Tl(e, n3);
      break;
    }
    case W2.InsertRangeMoveRightCommandId: {
      t3 = Nl3(e, n3);
      break;
    }
    case W2.InsertRowCommandId: {
      t3 = kl2(e, n3);
      break;
    }
    case W2.MoveColsCommandId: {
      t3 = zr(e, n3);
      break;
    }
    case W2.MoveRangeCommandId: {
      t3 = Ml(e, n3);
      break;
    }
    case W2.MoveRowsCommandId: {
      t3 = jr2(e, n3);
      break;
    }
    case W2.RemoveColCommandId: {
      t3 = Gr3(e, n3);
      break;
    }
    case W2.RemoveRowCommandId: {
      t3 = yl3(e, n3);
      break;
    }
    case W2.ReorderRangeCommandId: {
      t3 = bl(e, n3);
      break;
    }
  }
  return Dt(t3, n3);
};
var Kh = (n3, e, t3) => [It2.id, vt2.id].includes(e.id) || Kr2(e, t3).some((r) => Cn.intersects(r, n3)) ? po2(n3, e) : n3;
var So3 = (n3, e) => {
  let t3 = [];
  switch (e.id) {
    case W2.DeleteRangeMoveLeftCommandId:
      return Al(e, n3);
    case W2.DeleteRangeMoveUpCommandId:
      return $l2(e, n3);
    case W2.InsertRangeMoveDownCommandId:
      return Pl(e, n3);
    case W2.InsertRangeMoveRightCommandId:
      return Ol(e, n3);
    case W2.InsertColCommandId:
      return Ll2(e, n3);
    case W2.InsertRowCommandId:
      return Vl(e, n3);
    case W2.MoveColsCommandId:
      return vl(e, n3);
    case W2.MoveRangeCommandId:
      return _l(e, n3);
    case W2.MoveRowsCommandId:
      return wl2(e, n3);
    case W2.ReorderRangeCommandId:
      return Il(e, n3);
    case W2.RemoveColCommandId: {
      t3 = Gr3(e, n3);
      break;
    }
    case W2.RemoveRowCommandId:
      return Wl(e.params, n3);
  }
  const s2 = Dt(t3, n3);
  return s2 ? [s2] : [];
};
var Jh = (n3, e, t3) => [It2.id, vt2.id, Pt4.id, Js2].includes(e.id) || Kr2(e, t3).some((r) => Cn.intersects(r, n3)) ? So3(n3, e) : n3;
function Hl2(n3, e) {
  const { id: t3, params: s2 } = e;
  let o3 = {
    length: 0,
    step: 0,
    type: Q4.Unknown
  };
  switch (t3) {
    case Lt2.id:
      o3.type = Q4.Delete;
      break;
    case Je3.id:
      o3 = Wn2(
        { start: s2.sourceRange.startRow, end: s2.sourceRange.endRow },
        { start: s2.targetRange.startRow, end: s2.targetRange.endRow },
        { start: n3.startRow, end: n3.endRow }
      ), o3.type = Q4.VerticalMove;
      break;
    case qe2.id:
      o3 = Wn2(
        { start: s2.sourceRange.startColumn, end: s2.sourceRange.endColumn },
        { start: s2.targetRange.startColumn, end: s2.targetRange.endColumn },
        { start: n3.startColumn, end: n3.endColumn }
      ), o3.type = Q4.HorizontalMove;
      break;
    case Me.id:
      o3 = Nt3(s2.range, n3), o3 ? o3.type = Q4.HorizontalMove : o3 = { step: 0, length: 0, type: Q4.Delete };
      break;
    case Te.id:
      o3 = Nt3(Oe(s2.range), Oe(n3)), o3 ? o3.type = Q4.VerticalMove : o3 = { step: 0, length: 0, type: Q4.Delete };
      break;
    case ke2.id:
      o3 = Ot(Oe(s2.range), Oe(n3)), o3.type = Q4.VerticalMove;
      break;
    case Ue2.id:
      o3 = Ot(s2.range, n3), o3.type = Q4.HorizontalMove;
      break;
    case wt2.id:
      {
        const r = s2.fromRange || new ht(s2.from).getRange(), i = s2.toRange || new ht(s2.to).getRange();
        o3 = El(
          r,
          i,
          n3
        );
      }
      break;
  }
  return o3 ? Array.isArray(o3) ? Dt(o3, n3) : Dt([o3], n3) : n3;
}
function Kr2(n3, e) {
  var s2, o3, r, i, a4, u2;
  const { selectionManagerService: t3 } = e;
  switch (n3.id) {
    case W2.MoveColsCommandId: {
      const l4 = n3.params;
      return [
        l4.fromRange,
        __spreadProps(__spreadValues({}, l4.toRange), {
          startColumn: l4.toRange.startColumn - 0.5,
          endColumn: l4.toRange.endColumn - 0.5
        })
      ];
    }
    case W2.MoveRowsCommandId: {
      const l4 = n3.params;
      return [
        l4.fromRange,
        __spreadProps(__spreadValues({}, l4.toRange), {
          startRow: l4.toRange.startRow - 0.5,
          endRow: l4.toRange.startRow - 0.5
        })
      ];
    }
    case W2.MoveRangeCommandId: {
      const l4 = n3;
      return [l4.params.fromRange, l4.params.toRange];
    }
    case W2.InsertRowCommandId: {
      const c2 = n3.params.range;
      return [
        __spreadProps(__spreadValues({}, c2), {
          startRow: c2.startRow - 0.5,
          endRow: c2.endRow - 0.5
        })
      ];
    }
    case W2.InsertColCommandId: {
      const c2 = n3.params.range;
      return [
        __spreadProps(__spreadValues({}, c2), {
          startColumn: c2.startColumn - 0.5,
          endColumn: c2.endColumn - 0.5
        })
      ];
    }
    case W2.RemoveRowCommandId:
      return [n3.params.range];
    case W2.RemoveColCommandId:
      return [n3.params.range];
    case W2.DeleteRangeMoveUpCommandId:
    case W2.InsertRangeMoveDownCommandId: {
      const c2 = ((s2 = n3.params) == null ? void 0 : s2.range) || ((r = (o3 = t3.getCurrentSelections()) == null ? void 0 : o3.map((d2) => d2.range)) == null ? void 0 : r[0]);
      return c2 ? [c2] : [];
    }
    case W2.DeleteRangeMoveLeftCommandId:
    case W2.InsertRangeMoveRightCommandId: {
      const c2 = ((i = n3.params) == null ? void 0 : i.range) || ((u2 = (a4 = t3.getCurrentSelections()) == null ? void 0 : a4.map((d2) => d2.range)) == null ? void 0 : u2[0]);
      return c2 ? [c2] : [];
    }
    case W2.ReorderRangeCommandId: {
      const l4 = n3, { range: c2, order: d2 } = l4.params, h9 = [];
      for (let g9 = c2.startRow; g9 <= c2.endRow; g9++)
        g9 in d2 && h9.push({
          startRow: g9,
          endRow: g9,
          startColumn: c2.startColumn,
          endColumn: c2.endColumn
        });
      return h9;
    }
  }
}
function Fl3(n3) {
  switch (n3.id) {
    case qe2.id: {
      const e = n3.params;
      return [
        e.sourceRange,
        __spreadProps(__spreadValues({}, e.targetRange), {
          startColumn: e.targetRange.startColumn - 0.5,
          endColumn: e.targetRange.startColumn - 0.5
        })
      ];
    }
    case Je3.id: {
      const e = n3.params;
      return [
        e.sourceRange,
        __spreadProps(__spreadValues({}, e.targetRange), {
          startRow: e.targetRange.startRow - 0.5,
          endRow: e.targetRange.startRow - 0.5
        })
      ];
    }
    case wt2.id: {
      const e = n3.params;
      return [new ht(e.from.value).getRange(), new ht(e.to.value).getRange()];
    }
    case Ue2.id: {
      const t3 = n3.params.range;
      return [
        __spreadProps(__spreadValues({}, t3), {
          startColumn: t3.startColumn - 0.5,
          endColumn: t3.startColumn - 0.5
        })
      ];
    }
    case ke2.id: {
      const t3 = n3.params.range;
      return [
        __spreadProps(__spreadValues({}, t3), {
          startRow: t3.startRow - 0.5,
          endRow: t3.startRow - 0.5
        })
      ];
    }
    case Me.id:
      return [n3.params.range];
    case Te.id:
      return [n3.params.range];
  }
}
function qh(n3, e) {
  var o3, r, i, a4, u2, l4;
  const t3 = n3.get(br), s2 = n3.get(z);
  switch (e.id) {
    case W2.MoveColsCommandId: {
      const c2 = e.params, d2 = P5(t3, {
        unitId: c2.unitId,
        subUnitId: c2.subUnitId
      });
      return {
        unitId: d2.unitId,
        subUnitId: d2.subUnitId,
        ranges: [
          c2.fromRange,
          __spreadProps(__spreadValues({}, c2.toRange), {
            startColumn: c2.fromRange.startColumn < c2.toRange.startColumn ? c2.fromRange.endColumn + 1 : c2.toRange.startColumn,
            endColumn: c2.fromRange.startColumn < c2.toRange.startColumn ? c2.toRange.endColumn - 1 : c2.fromRange.startColumn - 1
          })
        ]
      };
    }
    case W2.MoveRowsCommandId: {
      const c2 = e.params, d2 = P5(t3, {
        unitId: c2.unitId,
        subUnitId: c2.subUnitId
      });
      return {
        unitId: d2.unitId,
        subUnitId: d2.subUnitId,
        ranges: [
          c2.fromRange,
          __spreadProps(__spreadValues({}, c2.toRange), {
            startRow: c2.fromRange.startRow < c2.toRange.startRow ? c2.fromRange.endRow + 1 : c2.toRange.startRow,
            endRow: c2.fromRange.startRow < c2.toRange.startRow ? c2.toRange.endRow - 1 : c2.fromRange.startRow - 1
          })
        ]
      };
    }
    case W2.MoveRangeCommandId: {
      const c2 = e.params, d2 = P5(t3);
      return {
        unitId: d2.unitId,
        subUnitId: d2.subUnitId,
        ranges: [c2.fromRange, c2.toRange]
      };
    }
    case W2.InsertRowCommandId: {
      const c2 = e.params, d2 = c2.range;
      return {
        unitId: c2.unitId,
        subUnitId: c2.subUnitId,
        ranges: [
          ...d2.startRow > 0 ? [__spreadProps(__spreadValues({}, d2), {
            startRow: d2.startRow - 1,
            endRow: d2.endRow - 1
          })] : [],
          __spreadProps(__spreadValues({}, d2), {
            startRow: d2.startRow,
            endRow: Number.MAX_SAFE_INTEGER
          })
        ]
      };
    }
    case W2.InsertColCommandId: {
      const c2 = e.params, d2 = c2.range;
      return {
        unitId: c2.unitId,
        subUnitId: c2.subUnitId,
        ranges: [
          ...d2.startColumn > 0 ? [__spreadProps(__spreadValues({}, d2), {
            startColumn: d2.startColumn - 1,
            endColumn: d2.endColumn - 1
          })] : [],
          __spreadProps(__spreadValues({}, d2), {
            startColumn: d2.startColumn,
            endColumn: Number.MAX_SAFE_INTEGER
          })
        ]
      };
    }
    case W2.RemoveRowCommandId: {
      const d2 = e.params.range, h9 = P5(t3);
      return {
        unitId: h9.unitId,
        subUnitId: h9.subUnitId,
        ranges: [
          d2,
          __spreadProps(__spreadValues({}, d2), {
            startRow: d2.endRow + 1,
            endRow: Number.MAX_SAFE_INTEGER
          })
        ]
      };
    }
    case W2.RemoveColCommandId: {
      const d2 = e.params.range, h9 = P5(t3);
      return {
        unitId: h9.unitId,
        subUnitId: h9.subUnitId,
        ranges: [
          d2,
          __spreadProps(__spreadValues({}, d2), {
            startColumn: d2.endColumn + 1,
            endColumn: Number.MAX_SAFE_INTEGER
          })
        ]
      };
    }
    case W2.DeleteRangeMoveUpCommandId:
    case W2.InsertRangeMoveDownCommandId: {
      const c2 = e, d2 = P5(t3), h9 = ((o3 = c2.params) == null ? void 0 : o3.range) || ((i = (r = s2.getCurrentSelections()) == null ? void 0 : r.map((g9) => g9.range)) == null ? void 0 : i[0]);
      return h9 ? {
        unitId: d2.unitId,
        subUnitId: d2.subUnitId,
        ranges: [
          h9,
          __spreadProps(__spreadValues({}, h9), {
            startRow: h9.endRow + 1,
            endRow: Number.MAX_SAFE_INTEGER
          })
        ]
      } : {
        unitId: d2.unitId,
        subUnitId: d2.subUnitId,
        ranges: []
      };
    }
    case W2.DeleteRangeMoveLeftCommandId:
    case W2.InsertRangeMoveRightCommandId: {
      const d2 = ((a4 = e.params) == null ? void 0 : a4.range) || ((l4 = (u2 = s2.getCurrentSelections()) == null ? void 0 : u2.map((g9) => g9.range)) == null ? void 0 : l4[0]), h9 = P5(t3);
      return d2 ? {
        unitId: h9.unitId,
        subUnitId: h9.subUnitId,
        ranges: [
          d2,
          __spreadProps(__spreadValues({}, d2), {
            startColumn: d2.endColumn + 1,
            endColumn: Number.MAX_SAFE_INTEGER
          })
        ]
      } : {
        unitId: h9.unitId,
        subUnitId: h9.subUnitId,
        ranges: []
      };
    }
    case W2.ReorderRangeCommandId: {
      const c2 = e, { range: d2, order: h9 } = c2.params, g9 = [];
      for (let f4 = d2.startRow; f4 <= d2.endRow; f4++)
        f4 in h9 && g9.push({
          startRow: f4,
          endRow: f4,
          startColumn: d2.startColumn,
          endColumn: d2.endColumn
        });
      const m9 = P5(t3);
      return {
        unitId: m9.unitId,
        subUnitId: m9.subUnitId,
        ranges: g9
      };
    }
  }
}
var Bl = Object.getOwnPropertyDescriptor;
var jl = (n3, e, t3, s2) => {
  for (var o3 = s2 > 1 ? void 0 : s2 ? Bl(e, t3) : e, r = n3.length - 1, i; r >= 0; r--)
    (i = n3[r]) && (o3 = i(o3) || o3);
  return o3;
};
var yn2 = (n3, e) => (t3, s2) => e(t3, s2, n3);
var zl = rR("MERGE_REDO");
var Gl = rR("MERGE_UNDO");
var wo2 = Math.floor(Number.MAX_SAFE_INTEGER / 10);
var Kl2 = class extends Ve {
  constructor(e, t3, s2, o3, r = false) {
    super(), this._unitId = e, this._subUnitId = t3, this._range = s2, this._callback = o3, this._skipIntersects = r;
  }
  onMutation(e) {
    var o3, r;
    if (((o3 = e.params) == null ? void 0 : o3.unitId) !== this._unitId)
      return;
    if (e.id === wt2.id) {
      const i = e.params;
      if (i.from.subUnitId !== this._subUnitId || i.to.subUnitId !== this._subUnitId)
        return;
    } else if (((r = e.params) == null ? void 0 : r.subUnitId) !== this._subUnitId)
      return;
    if (!this._range)
      return;
    if (this._skipIntersects) {
      if (e.id === Lt2.id)
        return;
      const i = Fl3(e);
      if (i != null && i.some((a4) => Cn.intersects(a4, this._range)))
        return;
    }
    const t3 = Hl2(this._range, e);
    if (t3 && Cn.equals(t3, this._range))
      return false;
    const s2 = this._range;
    this._range = t3, this._callback(s2, t3);
  }
};
var At3 = class extends Ve {
  constructor(e, t3, s2, o3) {
    super();
    R(this, "interceptor", new sR({ MERGE_REDO: zl, MERGE_UNDO: Gl }));
    R(this, "_watchRanges", /* @__PURE__ */ new Set());
    R(this, "_refRangeManagerMap", /* @__PURE__ */ new Map());
    R(this, "_serializer", Jl());
    R(this, "_onRefRangeChange", () => {
      this._sheetInterceptorService.interceptCommand({
        // eslint-disable-next-line max-lines-per-function
        getMutations: (e4) => {
          const t4 = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET).getActiveSheet(), s4 = Io2(this._univerInstanceService), o4 = vo2(this._univerInstanceService);
          if (!t4 || !s4 || !o4)
            return { redos: [], undos: [], preRedos: [], preUndos: [] };
          const a4 = ((() => {
            switch (e4.id) {
              case W2.MoveColsCommandId: {
                const h9 = e4.params, g9 = Math.min(h9.fromRange.startColumn, h9.toRange.startColumn);
                return this._checkRange(
                  [__spreadProps(__spreadValues({}, h9.fromRange), { startColumn: g9, endColumn: t4.getColumnCount() - 1 })],
                  s4,
                  o4
                );
              }
              case W2.MoveRowsCommandId: {
                const h9 = e4.params, g9 = Math.min(h9.fromRange.startRow, h9.toRange.startRow);
                return this._checkRange(
                  [__spreadProps(__spreadValues({}, h9.fromRange), { startRow: g9, endRow: t4.getRowCount() - 1 })],
                  s4,
                  o4
                );
              }
              case W2.MoveRangeCommandId: {
                const h9 = e4;
                return this._checkRange(
                  [h9.params.fromRange, h9.params.toRange],
                  s4,
                  o4
                );
              }
              case W2.InsertRowCommandId: {
                const m9 = {
                  startRow: e4.params.range.startRow,
                  endRow: t4.getRowCount() - 1,
                  startColumn: 0,
                  endColumn: t4.getColumnCount() - 1,
                  rangeType: ge.ROW
                };
                return this._checkRange([m9], s4, o4);
              }
              case W2.InsertColCommandId: {
                const g9 = e4.params.range.startColumn, m9 = {
                  startRow: 0,
                  endRow: t4.getRowCount() - 1,
                  startColumn: g9,
                  endColumn: t4.getColumnCount() - 1,
                  rangeType: ge.COLUMN
                };
                return this._checkRange([m9], s4, o4);
              }
              case W2.RemoveRowCommandId: {
                const m9 = {
                  startRow: e4.params.range.startRow,
                  endRow: t4.getRowCount() - 1,
                  startColumn: 0,
                  endColumn: t4.getColumnCount() - 1,
                  rangeType: ge.ROW
                };
                return this._checkRange([m9], s4, o4);
              }
              case W2.RemoveColCommandId: {
                const g9 = e4.params.range.startColumn, m9 = {
                  startRow: 0,
                  endRow: t4.getRowCount() - 1,
                  startColumn: g9,
                  endColumn: t4.getColumnCount() - 1,
                  rangeType: ge.COLUMN
                };
                return this._checkRange([m9], s4, o4);
              }
              case W2.DeleteRangeMoveUpCommandId:
              case W2.InsertRangeMoveDownCommandId: {
                const g9 = e4.params.range || Mo3(this._selectionManagerService)[0], m9 = {
                  startRow: g9.startRow,
                  startColumn: g9.startColumn,
                  endColumn: g9.endColumn,
                  endRow: wo2
                };
                return this._checkRange([m9], s4, o4);
              }
              case W2.DeleteRangeMoveLeftCommandId:
              case W2.InsertRangeMoveRightCommandId: {
                const g9 = e4.params.range || Mo3(this._selectionManagerService)[0], m9 = {
                  startRow: g9.startRow,
                  startColumn: g9.startColumn,
                  endColumn: wo2,
                  endRow: g9.endRow
                };
                return this._checkRange([m9], s4, o4);
              }
              case W2.ReorderRangeCommandId: {
                const h9 = e4, { range: g9, order: m9 } = h9.params, f4 = [];
                for (let C = g9.startRow; C <= g9.endRow; C++)
                  C in m9 && f4.push({
                    startRow: C,
                    endRow: C,
                    startColumn: g9.startColumn,
                    endColumn: g9.endColumn
                  });
                return this._checkRange(f4, s4, o4);
              }
            }
          })() || []).reduce(
            (h9, g9) => {
              const m9 = g9(e4);
              return h9.push(m9), h9;
            },
            []
          ).reduce(
            (h9, g9) => {
              var m9, f4;
              return h9.redos.push(...g9.redos), h9.undos.push(...g9.undos), h9.preRedos.push(...(m9 = g9.preRedos) != null ? m9 : []), h9.preUndos.push(...(f4 = g9.preUndos) != null ? f4 : []), h9;
            },
            { redos: [], undos: [], preUndos: [], preRedos: [] }
          ), u2 = this.interceptor.fetchThroughInterceptors(this.interceptor.getInterceptPoints().MERGE_REDO)(
            a4.preRedos,
            null
          ) || [], l4 = this.interceptor.fetchThroughInterceptors(this.interceptor.getInterceptPoints().MERGE_REDO)(
            a4.redos,
            null
          ) || [], c2 = this.interceptor.fetchThroughInterceptors(this.interceptor.getInterceptPoints().MERGE_UNDO)(
            a4.preUndos,
            null
          ) || [], d2 = this.interceptor.fetchThroughInterceptors(this.interceptor.getInterceptPoints().MERGE_UNDO)(
            a4.undos,
            null
          ) || [];
          return { redos: l4, undos: d2, preRedos: u2, preUndos: c2 };
        }
      });
    });
    R(this, "_checkRange", (e4, t4, s4) => {
      const o4 = _o(t4, s4), r = this._refRangeManagerMap.get(o4);
      if (r) {
        const i = /* @__PURE__ */ new Set();
        return [...r.keys()].forEach((u2) => {
          const l4 = r.get(u2), c2 = this._serializer.deserialize(u2), d2 = __spreadProps(__spreadValues({}, c2), {
            startRow: +c2.startRow,
            endRow: +c2.endRow,
            startColumn: +c2.startColumn,
            endColumn: +c2.endColumn,
            rangeType: c2.rangeType && +c2.rangeType
          });
          e4.some((h9) => Cn.intersects(h9, d2)) && l4 && l4.forEach((h9) => {
            i.add(h9);
          });
        }), [...i];
      }
      return [];
    });
    R(this, "registerRefRange", (e4, t4, s4, o4) => {
      const r = s4 || Io2(this._univerInstanceService), i = o4 || vo2(this._univerInstanceService);
      if (!r || !i)
        return Be(() => {
        });
      const a4 = _o(r, i), u2 = this._serializer.serialize(e4);
      let l4 = this._refRangeManagerMap.get(a4);
      l4 || (l4 = /* @__PURE__ */ new Map(), this._refRangeManagerMap.set(a4, l4));
      const c2 = l4.get(u2);
      return c2 ? c2.add(t4) : l4.set(u2, /* @__PURE__ */ new Set([t4])), Be(() => {
        const d2 = l4.get(u2);
        d2 && (d2.delete(t4), d2.size || (l4.delete(u2), l4.size || this._refRangeManagerMap.delete(a4)));
      });
    });
    this._commandService = e, this._sheetInterceptorService = t3, this._univerInstanceService = s2, this._selectionManagerService = o3, this._onRefRangeChange(), this.interceptor.intercept(this.interceptor.getInterceptPoints().MERGE_REDO, {
      priority: -1,
      handler: (r) => r
    }), this.interceptor.intercept(this.interceptor.getInterceptPoints().MERGE_UNDO, {
      priority: -1,
      handler: (r) => r
    });
  }
  watchRange(e, t3, s2, o3, r) {
    let i;
    this._watchRanges.size === 0 && (i = this._commandService.onCommandExecuted((c2) => {
      if (c2.type !== Ls.MUTATION) return false;
      for (const d2 of this._watchRanges)
        d2.onMutation(c2);
    }));
    const a4 = new Kl2(e, t3, s2, o3, r);
    this._watchRanges.add(a4);
    const u2 = Be(() => {
      this._watchRanges.delete(a4), this._watchRanges.size === 0 && (i == null || i.dispose(), i = null);
    }), l4 = this.disposeWithMe(u2);
    return Be(() => {
      l4.dispose(), u2.dispose();
    });
  }
};
At3 = jl([
  yn2(0, Ds),
  yn2(1, Inject(G)),
  yn2(2, Inject(br)),
  yn2(3, Inject(z))
], At3);
function Io2(n3) {
  return n3.getCurrentUnitForType(we.UNIVER_SHEET).getUnitId();
}
function vo2(n3) {
  var e;
  return (e = n3.getCurrentUnitForType(we.UNIVER_SHEET).getActiveSheet()) == null ? void 0 : e.getSheetId();
}
function Mo3(n3) {
  var e;
  return ((e = n3.getCurrentSelections()) == null ? void 0 : e.map((t3) => t3.range)) || [];
}
function _o(n3, e) {
  return `${n3}_${e}`;
}
function Jl() {
  const n3 = ["startRow", "startColumn", "endRow", "endColumn", "rangeType"];
  return {
    deserialize: (t3) => {
      const s2 = n3.reduce(
        (r, i, a4) => (r[String(a4)] = i, r),
        {}
      );
      return t3.split("_").reduce(
        (r, i, a4) => {
          const u2 = String(a4);
          return i && s2[u2] && (r[s2[u2]] = i), r;
        },
        {}
      );
    },
    serialize: (t3) => n3.reduce((s2, o3, r) => {
      const i = t3[o3];
      return i !== void 0 ? `${s2}${r > 0 ? "_" : ""}${i}` : `${s2}`;
    }, "")
  };
}
var ql = Object.getOwnPropertyDescriptor;
var Yl = (n3, e, t3, s2) => {
  for (var o3 = s2 > 1 ? void 0 : s2 ? ql(e, t3) : e, r = n3.length - 1, i; r >= 0; r--)
    (i = n3[r]) && (o3 = i(o3) || o3);
  return o3;
};
var _t2 = (n3, e) => (t3, s2) => e(t3, s2, n3);
var Xl = [Ue2.id, ke2.id, Me.id, Te.id];
var Zl = [Je3.id, qe2.id];
function Jr3(n3, e) {
  let t3 = n3;
  if (e !== void 0) {
    const s2 = [];
    for (let o3 = 0; o3 < t3.length; o3++) {
      const { startRow: r, endRow: i, startColumn: a4, endColumn: u2 } = t3[o3];
      if (e === Im.ROWS)
        for (let l4 = r; l4 <= i; l4++) {
          const c2 = {
            startRow: l4,
            endRow: l4,
            startColumn: a4,
            endColumn: u2
          };
          s2.push(c2);
        }
      else if (e === Im.COLUMNS)
        for (let l4 = a4; l4 <= u2; l4++) {
          const c2 = {
            startRow: r,
            endRow: i,
            startColumn: l4,
            endColumn: l4
          };
          s2.push(c2);
        }
    }
    t3 = s2;
  }
  return t3;
}
var Ql = rR("mergeCellPermissionCheck");
var Vn = class extends Ve {
  constructor(e, t3, s2, o3, r, i) {
    super();
    R(this, "disposableCollection", new ho());
    R(this, "interceptor", new sR({ MERGE_CELL_INTERCEPTOR_CHECK: Ql }));
    this._commandService = e, this._refRangeService = t3, this._univerInstanceService = s2, this._injector = o3, this._sheetInterceptorService = r, this._selectionManagerService = i, this._onRefRangeChange(), this._initCommandInterceptor(), this._commandExecutedListener();
  }
  _initCommandInterceptor() {
    const e = this;
    this._sheetInterceptorService.interceptCommand({
      getMutations(t3) {
        var s2;
        switch (t3.id) {
          case Ls2.id:
          case Hs2.id: {
            const o3 = e._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET), r = o3.getUnitId(), i = o3 == null ? void 0 : o3.getActiveSheet();
            if (!i)
              return { redos: [], undos: [] };
            const a4 = i.getSheetId(), u2 = i.getConfig().mergeData, l4 = (s2 = e._selectionManagerService.getCurrentSelections()) == null ? void 0 : s2.map((c2) => c2.range);
            if (l4 && l4.length > 0 && l4.some(
              (d2) => u2.some((h9) => Cn.intersects(h9, d2))
            )) {
              const d2 = {
                unitId: r,
                subUnitId: a4,
                ranges: l4
              }, h9 = ye3(e._injector, d2), g9 = [
                { id: se2.id, params: d2 }
              ], m9 = [
                { id: ne.id, params: h9 }
              ];
              return { redos: g9, undos: m9 };
            }
          }
        }
        return { redos: [], undos: [] };
      }
    }), this._sheetInterceptorService.interceptRanges({
      getMutations: ({ unitId: t3, subUnitId: s2, ranges: o3 }) => {
        const r = [], i = [], a4 = { redos: r, undos: i };
        if (!o3 || !o3.length)
          return a4;
        const u2 = P5(this._univerInstanceService, { unitId: t3, subUnitId: s2 });
        if (!u2)
          return a4;
        const { worksheet: l4 } = u2, d2 = l4.getMergeData().filter((h9) => o3.some((g9) => Cn.intersects(h9, g9)));
        return d2.length ? (r.push({
          id: se2.id,
          params: {
            unitId: t3,
            subUnitId: s2,
            ranges: d2
          }
        }), i.push({
          id: ne.id,
          params: {
            unitId: t3,
            subUnitId: s2,
            ranges: d2
          }
        }), { undos: i, redos: r }) : a4;
      }
    });
  }
  refRangeHandle(e, t3, s2) {
    switch (e.id) {
      case W2.MoveColsCommandId: {
        const o3 = e.params;
        return this._handleMoveColsCommand(o3, t3, s2);
      }
      case W2.MoveRowsCommandId: {
        const o3 = e.params;
        return this._handleMoveRowsCommand(o3, t3, s2);
      }
      case Ye3.id: {
        const o3 = e.params, r = o3.unitId || t3, i = o3.subUnitId || s2;
        return this._handleInsertRowCommand(o3, r, i);
      }
      case Xe6.id: {
        const o3 = e.params, r = o3.unitId || t3, i = o3.subUnitId || s2;
        return this._handleInsertColCommand(o3, r, i);
      }
      case gs.id: {
        const o3 = e.params;
        return this._handleRemoveColCommand(o3, t3, s2);
      }
      case hs.id: {
        const o3 = e.params;
        return this._handleRemoveRowCommand(o3, t3, s2);
      }
      case yt2.id: {
        const o3 = e.params;
        return this._handleMoveRangeCommand(o3, t3, s2);
      }
      case rn.id: {
        const o3 = e.params;
        return this._handleInsertRangeMoveRightCommand(o3, t3, s2);
      }
      case Pt4.id: {
        const o3 = e.params;
        return this._handleInsertRangeMoveDownCommand(o3, t3, s2);
      }
      case vt2.id: {
        const o3 = e.params;
        return this._handleDeleteRangeMoveUpCommand(o3, t3, s2);
      }
      case It2.id: {
        const o3 = e.params;
        return this._handleDeleteRangeMoveLeftCommand(o3, t3, s2);
      }
    }
    return { redos: [], undos: [] };
  }
  _onRefRangeChange() {
    const e = (t3, s2) => {
      const o3 = this._univerInstanceService.getUniverSheetInstance(t3);
      if (!o3)
        return;
      const r = o3 == null ? void 0 : o3.getSheetBySheetId(s2);
      if (!r)
        return;
      this.disposableCollection.dispose();
      const i = r.getMergeData(), a4 = (u2) => this.refRangeHandle(u2, t3, s2);
      i.forEach((u2) => {
        this.disposableCollection.add(this._refRangeService.registerRefRange(u2, a4, t3, s2));
      });
    };
    this.disposeWithMe(
      this._commandService.onCommandExecuted((t3) => {
        if (t3.id === pn.id) {
          const s2 = t3.params, o3 = s2.subUnitId, r = s2.unitId;
          if (!o3 || !r)
            return;
          e(r, o3);
        }
        if (t3.id === ne.id) {
          const s2 = t3.params, o3 = s2.subUnitId, r = s2.unitId;
          if (!o3 || !r)
            return;
          e(s2.unitId, s2.subUnitId);
        }
      })
    ), this._univerInstanceService.getCurrentTypeOfUnit$(we.UNIVER_SHEET).pipe(first((t3) => !!t3)).subscribe((t3) => {
      const s2 = t3.getActiveSheet();
      s2 && e(t3.getUnitId(), s2.getSheetId());
    });
  }
  _handleMoveRowsCommand(e, t3, s2) {
    const o3 = xe2(this._univerInstanceService, t3);
    if (!o3)
      return this._handleNull();
    const r = $e4(o3, s2);
    if (!r)
      return this._handleNull();
    const i = [...r.getMergeData()], a4 = { unitId: t3, subUnitId: s2, ranges: [] }, u2 = { unitId: t3, subUnitId: s2, ranges: [] }, { fromRange: l4 } = e, { startRow: c2, endRow: d2 } = l4;
    if (i.forEach((m9) => {
      if (c2 <= m9.startRow && d2 >= m9.endRow) {
        a4.ranges.push(m9);
        const f4 = jr2({ id: W2.MoveRowsCommandId, params: e }, m9), C = Dt(f4, m9);
        C && u2.ranges.push(C);
      }
    }), a4.ranges.length === 0)
      return this._handleNull();
    const h9 = ye3(this._injector, a4), g9 = We3(this._injector, u2);
    return {
      preRedos: [{ id: se2.id, params: a4 }],
      redos: [{ id: ne.id, params: u2 }],
      preUndos: [{ id: se2.id, params: g9 }],
      undos: [{ id: ne.id, params: h9 }]
    };
  }
  _handleMoveColsCommand(e, t3, s2) {
    const o3 = xe2(this._univerInstanceService, t3);
    if (!o3)
      return this._handleNull();
    const r = $e4(o3, s2);
    if (!r)
      return this._handleNull();
    const i = [...r.getMergeData()], a4 = { unitId: t3, subUnitId: s2, ranges: [] }, u2 = { unitId: t3, subUnitId: s2, ranges: [] }, { fromRange: l4 } = e, { startColumn: c2, endColumn: d2 } = l4;
    if (i.forEach((m9) => {
      if (c2 <= m9.startColumn && d2 >= m9.endColumn) {
        a4.ranges.push(m9);
        const f4 = zr({ id: W2.MoveColsCommandId, params: e }, m9), C = Dt(f4, m9);
        C && u2.ranges.push(C);
      }
    }), a4.ranges.length === 0)
      return this._handleNull();
    const h9 = ye3(this._injector, a4), g9 = We3(this._injector, u2);
    return {
      preRedos: [{ id: se2.id, params: a4 }],
      redos: [{ id: ne.id, params: u2 }],
      preUndos: [{ id: se2.id, params: g9 }],
      undos: [{ id: ne.id, params: h9 }]
    };
  }
  _handleMoveRangeCommand(e, t3, s2) {
    const o3 = xe2(this._univerInstanceService, t3);
    if (!o3)
      return this._handleNull();
    const r = $e4(o3, s2);
    if (!r)
      return this._handleNull();
    const i = r.getMergeData(), a4 = i.filter((g9) => Cn.intersects(g9, e.fromRange)), u2 = i.filter((g9) => Cn.intersects(g9, e.toRange)), l4 = a4.map((g9) => Cn.getRelativeRange(g9, e.fromRange)).map((g9) => Cn.getPositionRange(g9, e.toRange)), c2 = Jr3(l4).filter(
      (g9) => !i.some((m9) => Cn.equals(g9, m9))
    ), d2 = [
      {
        id: se2.id,
        params: {
          unitId: t3,
          subUnitId: s2,
          ranges: a4
        }
      },
      {
        id: se2.id,
        params: {
          unitId: t3,
          subUnitId: s2,
          ranges: u2
        }
      },
      {
        id: ne.id,
        params: {
          unitId: t3,
          subUnitId: s2,
          ranges: c2
        }
      }
    ], h9 = [
      {
        id: se2.id,
        params: {
          unitId: t3,
          subUnitId: s2,
          ranges: c2
        }
      },
      {
        id: ne.id,
        params: {
          unitId: t3,
          subUnitId: s2,
          ranges: u2
        }
      },
      {
        id: ne.id,
        params: {
          unitId: t3,
          subUnitId: s2,
          ranges: a4
        }
      }
    ];
    return { redos: d2, undos: h9 };
  }
  _handleInsertRowCommand(e, t3, s2) {
    const o3 = xe2(this._univerInstanceService, t3);
    if (!o3)
      return this._handleNull();
    const r = $e4(o3, s2);
    if (!r)
      return this._handleNull();
    const { range: i } = e, { startRow: a4, endRow: u2 } = i, l4 = Z.deepClone(r.getMergeData()).reduce((p3, w6) => (a4 > w6.startRow && a4 <= w6.endRow && p3.push(w6), p3), []);
    if (l4.length === 0)
      return this._handleNull();
    const c2 = Z.deepClone(r.getMergeData()).reduce((p3, w6) => {
      if (a4 > w6.startRow && a4 <= w6.endRow) {
        const S = u2 - a4 + 1;
        w6.endRow += S, this._checkIsMergeCell(w6) && p3.push(w6);
      }
      return p3;
    }, []), d2 = {
      unitId: t3,
      subUnitId: s2,
      ranges: l4
    }, h9 = ye3(
      this._injector,
      d2
    ), g9 = {
      unitId: t3,
      subUnitId: s2,
      ranges: c2
    }, m9 = We3(
      this._injector,
      g9
    ), f4 = [
      { id: se2.id, params: d2 },
      { id: ne.id, params: g9 }
    ], C = [
      { id: se2.id, params: m9 },
      { id: ne.id, params: h9 }
    ];
    return { redos: f4, undos: C };
  }
  _handleInsertColCommand(e, t3, s2) {
    const { range: o3 } = e, r = xe2(this._univerInstanceService, t3);
    if (!r)
      return this._handleNull();
    const i = $e4(r, s2);
    if (!i)
      return this._handleNull();
    const { startColumn: a4, endColumn: u2 } = o3, l4 = Z.deepClone(i.getMergeData()).reduce((p3, w6) => (a4 > w6.startColumn && a4 <= w6.endColumn && p3.push(w6), p3), []);
    if (l4.length === 0)
      return this._handleNull();
    const c2 = Z.deepClone(i.getMergeData()).reduce((p3, w6) => {
      if (a4 > w6.startColumn && a4 <= w6.endColumn) {
        const S = u2 - a4 + 1;
        w6.endColumn += S, this._checkIsMergeCell(w6) && p3.push(w6);
      }
      return p3;
    }, []), d2 = {
      unitId: t3,
      subUnitId: s2,
      ranges: l4
    }, h9 = ye3(
      this._injector,
      d2
    ), g9 = {
      unitId: t3,
      subUnitId: s2,
      ranges: c2
    }, m9 = We3(
      this._injector,
      g9
    ), f4 = [
      { id: se2.id, params: d2 },
      { id: ne.id, params: g9 }
    ], C = [
      { id: se2.id, params: m9 },
      { id: ne.id, params: h9 }
    ];
    return { redos: f4, undos: C };
  }
  _handleRemoveColCommand(e, t3, s2) {
    const o3 = xe2(this._univerInstanceService, t3);
    if (!o3)
      return this._handleNull();
    const r = $e4(o3, s2);
    if (!r)
      return this._handleNull();
    const { range: i } = e, { startColumn: a4, endColumn: u2 } = i, l4 = Z.deepClone(r.getMergeData()).reduce((S, I6) => (Cn.intersects(i, I6) && S.push(I6), S), []);
    if (l4.length === 0)
      return this._handleNull();
    const c2 = Z.deepClone(r.getMergeData()).reduce((S, I6) => {
      if (Cn.intersects(i, I6)) {
        if (a4 <= I6.startColumn && u2 >= I6.endColumn)
          return S;
        a4 >= I6.startColumn && u2 <= I6.endColumn ? I6.endColumn -= u2 - a4 + 1 : a4 < I6.startColumn ? (I6.startColumn = a4, I6.endColumn -= u2 - a4 + 1) : u2 > I6.endColumn && (I6.endColumn = a4 - 1), this._checkIsMergeCell(I6) && S.push(I6);
      }
      return S;
    }, []), d2 = {
      unitId: t3,
      subUnitId: s2,
      ranges: l4
    }, h9 = ye3(
      this._injector,
      d2
    ), g9 = {
      unitId: t3,
      subUnitId: s2,
      ranges: c2
    }, m9 = We3(
      this._injector,
      g9
    ), f4 = [{ id: se2.id, params: d2 }], C = [{ id: ne.id, params: g9 }], p3 = [{ id: se2.id, params: m9 }], w6 = [{ id: ne.id, params: h9 }];
    return { preUndos: p3, undos: w6, preRedos: f4, redos: C };
  }
  _handleRemoveRowCommand(e, t3, s2) {
    const { range: o3 } = e, r = xe2(this._univerInstanceService, t3);
    if (!r)
      return this._handleNull();
    const i = $e4(r, s2);
    if (!i)
      return this._handleNull();
    const { startRow: a4, endRow: u2 } = o3, l4 = Z.deepClone(i.getMergeData()).reduce((S, I6) => (Cn.intersects(o3, I6) && S.push(I6), S), []);
    if (l4.length === 0)
      return this._handleNull();
    const c2 = Z.deepClone(i.getMergeData()).reduce((S, I6) => {
      if (Cn.intersects(o3, I6)) {
        if (a4 <= I6.startRow && u2 >= I6.endRow)
          return S;
        a4 >= I6.startRow && u2 <= I6.endRow ? I6.endRow -= u2 - a4 + 1 : a4 < I6.startRow ? (I6.startRow = a4, I6.endRow -= u2 - a4 + 1) : u2 > I6.endRow && (I6.endRow = a4 - 1), this._checkIsMergeCell(I6) && S.push(I6);
      }
      return S;
    }, []), d2 = {
      unitId: t3,
      subUnitId: s2,
      ranges: l4
    }, h9 = ye3(
      this._injector,
      d2
    ), g9 = {
      unitId: t3,
      subUnitId: s2,
      ranges: c2
    }, m9 = We3(
      this._injector,
      g9
    ), f4 = [{ id: se2.id, params: d2 }], C = [{ id: ne.id, params: g9 }], p3 = [{ id: se2.id, params: m9 }], w6 = [{ id: ne.id, params: h9 }];
    return { preUndos: p3, undos: w6, preRedos: f4, redos: C };
  }
  _handleInsertRangeMoveRightCommand(e, t3, s2) {
    const o3 = xe2(this._univerInstanceService, t3);
    if (!o3)
      return this._handleNull();
    const r = $e4(o3, s2);
    if (!r)
      return this._handleNull();
    const i = e.range, a4 = r.getMaxColumns() - 1, u2 = r.getMergeData(), l4 = [], c2 = [];
    u2.forEach((f4) => {
      const { startRow: C, endRow: p3, startColumn: w6, endColumn: S } = i;
      if (Cn.intersects(
        {
          startRow: C,
          startColumn: w6,
          endRow: p3,
          endColumn: a4
        },
        f4
      ) && (l4.push(f4), Cn.contains(
        {
          startRow: C,
          startColumn: w6,
          endRow: p3,
          endColumn: a4
        },
        f4
      ))) {
        const b4 = S - w6 + 1;
        c2.push({
          startRow: f4.startRow,
          startColumn: f4.startColumn + b4,
          endRow: f4.endRow,
          endColumn: f4.endColumn + b4
        });
      }
    });
    const d2 = {
      unitId: t3,
      subUnitId: s2,
      ranges: l4
    }, h9 = ye3(
      this._injector,
      d2
    ), g9 = {
      unitId: t3,
      subUnitId: s2,
      ranges: c2
    }, m9 = We3(
      this._injector,
      g9
    );
    return {
      preRedos: [
        { id: se2.id, params: d2 }
      ],
      redos: [
        {
          id: ne.id,
          params: g9
        }
      ],
      preUndos: [
        { id: se2.id, params: m9 }
      ],
      undos: [
        {
          id: ne.id,
          params: h9
        }
      ]
    };
  }
  _handleInsertRangeMoveDownCommand(e, t3, s2) {
    const o3 = xe2(this._univerInstanceService, t3);
    if (!o3)
      return this._handleNull();
    const r = $e4(o3, s2);
    if (!r)
      return this._handleNull();
    const i = e.range, a4 = r.getMaxRows() - 1, u2 = r.getMergeData(), l4 = [], c2 = [];
    u2.forEach((S) => {
      const { startRow: I6, startColumn: y6, endColumn: b4, endRow: N6 } = i;
      if (Cn.intersects({ startRow: I6, startColumn: y6, endRow: a4, endColumn: b4 }, S) && (l4.push(S), Cn.contains({ startRow: I6, startColumn: y6, endRow: a4, endColumn: b4 }, S))) {
        const k6 = N6 - I6 + 1;
        c2.push({
          startRow: S.startRow + k6,
          startColumn: S.startColumn,
          endRow: S.endRow + k6,
          endColumn: S.endColumn
        });
      }
    });
    const d2 = {
      unitId: t3,
      subUnitId: s2,
      ranges: l4
    }, h9 = ye3(
      this._injector,
      d2
    ), g9 = {
      unitId: t3,
      subUnitId: s2,
      ranges: c2
    }, m9 = We3(
      this._injector,
      g9
    ), f4 = [
      {
        id: se2.id,
        params: d2
      }
    ], C = [
      {
        id: ne.id,
        params: g9
      }
    ], p3 = [
      {
        id: se2.id,
        params: m9
      }
    ], w6 = [
      {
        id: ne.id,
        params: h9
      }
    ];
    return { redos: C, undos: w6, preRedos: f4, preUndos: p3 };
  }
  _handleDeleteRangeMoveUpCommand(e, t3, s2) {
    const o3 = xe2(this._univerInstanceService, t3);
    if (!o3)
      return this._handleNull();
    const r = $e4(o3, s2);
    if (!r)
      return this._handleNull();
    const i = e.range, a4 = r.getMaxRows() - 1, u2 = r.getMergeData(), l4 = [], c2 = [];
    u2.forEach((S) => {
      const { startRow: I6, startColumn: y6, endColumn: b4, endRow: N6 } = i;
      if (Cn.intersects({ startRow: I6, startColumn: y6, endRow: a4, endColumn: b4 }, S) && (l4.push(S), Cn.contains({ startRow: I6, startColumn: y6, endRow: a4, endColumn: b4 }, S))) {
        const k6 = N6 - I6 + 1, D5 = Cn.moveVertical(S, -k6);
        c2.push(D5);
      }
    });
    const d2 = {
      unitId: t3,
      subUnitId: s2,
      ranges: l4
    }, h9 = ye3(
      this._injector,
      d2
    ), g9 = {
      unitId: t3,
      subUnitId: s2,
      ranges: c2
    }, m9 = We3(
      this._injector,
      g9
    ), f4 = [
      {
        id: se2.id,
        params: d2
      }
    ], C = [
      {
        id: ne.id,
        params: g9
      }
    ], p3 = [
      {
        id: se2.id,
        params: m9
      }
    ], w6 = [
      {
        id: ne.id,
        params: h9
      }
    ];
    return { redos: C, undos: w6, preRedos: f4, preUndos: p3 };
  }
  _handleDeleteRangeMoveLeftCommand(e, t3, s2) {
    const o3 = xe2(this._univerInstanceService, t3);
    if (!o3)
      return this._handleNull();
    const r = $e4(o3, s2);
    if (!r)
      return this._handleNull();
    const i = e.range, a4 = r.getMaxColumns() - 1, u2 = r.getMergeData(), l4 = [], c2 = [];
    u2.forEach((f4) => {
      const { startRow: C, endRow: p3, startColumn: w6, endColumn: S } = i;
      if (Cn.intersects(
        {
          startRow: C,
          startColumn: w6,
          endRow: p3,
          endColumn: a4
        },
        f4
      ) && (l4.push(f4), Cn.contains(
        {
          startRow: C,
          startColumn: w6,
          endRow: p3,
          endColumn: a4
        },
        f4
      ))) {
        const b4 = S - w6 + 1;
        c2.push({
          startRow: f4.startRow,
          startColumn: f4.startColumn - b4,
          endRow: f4.endRow,
          endColumn: f4.endColumn - b4
        });
      }
    });
    const d2 = {
      unitId: t3,
      subUnitId: s2,
      ranges: l4
    }, h9 = ye3(this._injector, d2), g9 = {
      unitId: t3,
      subUnitId: s2,
      ranges: c2
    }, m9 = We3(this._injector, g9);
    return {
      preRedos: [
        { id: se2.id, params: d2 }
      ],
      redos: [
        {
          id: ne.id,
          params: g9
        }
      ],
      undos: [
        {
          id: ne.id,
          params: h9
        }
      ],
      preUndos: [
        { id: se2.id, params: m9 }
      ]
    };
  }
  _checkIsMergeCell(e) {
    return !(e.startRow === e.endRow && e.startColumn === e.endColumn);
  }
  _handleNull() {
    return { redos: [], undos: [] };
  }
  _commandExecutedListener() {
    this.disposeWithMe(this._commandService.onCommandExecuted((e) => {
      if (Zl.includes(e.id)) {
        if (!e.params) return;
        const t3 = this._univerInstanceService.getUniverSheetInstance(e.params.unitId);
        if (!t3) return;
        const s2 = t3.getSheetBySheetId(e.params.subUnitId);
        if (!s2) return;
        const { sourceRange: o3, targetRange: r } = e.params, i = o3.startColumn === r.startColumn && o3.endColumn === r.endColumn, a4 = i ? o3.endRow - o3.startRow + 1 : o3.endColumn - o3.startColumn + 1, u2 = i ? o3.startRow : o3.startColumn, l4 = i ? r.startRow : r.startColumn, c2 = s2.getConfig().mergeData, d2 = [];
        c2.forEach((f4) => {
          let { startRow: C, endRow: p3, startColumn: w6, endColumn: S, rangeType: I6 } = f4;
          Cn.intersects(f4, o3) || (i ? u2 < C && l4 > p3 ? (C -= a4, p3 -= a4) : u2 > p3 && l4 <= C && (C += a4, p3 += a4) : u2 < w6 && l4 > S ? (w6 -= a4, S -= a4) : u2 > S && l4 <= w6 && (w6 += a4, S += a4)), f4.startRow === f4.endRow && f4.startColumn === f4.endColumn || d2.push({ startRow: C, endRow: p3, startColumn: w6, endColumn: S, rangeType: I6 });
        }), s2.setMergeData(d2), this.disposableCollection.dispose();
        const { unitId: h9, subUnitId: g9 } = e.params, m9 = (f4) => this.refRangeHandle(f4, h9, g9);
        d2.forEach((f4) => {
          this.disposableCollection.add(this._refRangeService.registerRefRange(f4, m9, h9, g9));
        });
      }
      if (Xl.includes(e.id)) {
        const t3 = this._univerInstanceService.getUniverSheetInstance(e.params.unitId);
        if (!t3) return;
        const s2 = t3.getSheetBySheetId(e.params.subUnitId);
        if (!s2) return;
        const o3 = s2.getConfig().mergeData, r = e.params;
        if (!r) return;
        const { range: i } = r, a4 = e.id.includes("row"), u2 = e.id.includes("insert"), l4 = a4 ? i.startRow : i.startColumn, c2 = a4 ? i.endRow : i.endColumn, d2 = c2 - l4 + 1, h9 = [];
        o3.forEach((C) => {
          let { startRow: p3, endRow: w6, startColumn: S, endColumn: I6, rangeType: y6 } = C;
          u2 ? a4 ? l4 <= p3 && (p3 += d2, w6 += d2) : l4 <= S && (S += d2, I6 += d2) : a4 ? c2 < p3 && (p3 -= d2, w6 -= d2) : c2 < S && (S -= d2, I6 -= d2), C.startRow === C.endRow && C.startColumn === C.endColumn || h9.push({ startRow: p3, endRow: w6, startColumn: S, endColumn: I6, rangeType: y6 });
        }), s2.setMergeData(h9), this.disposableCollection.dispose();
        const { unitId: g9, subUnitId: m9 } = e.params, f4 = (C) => this.refRangeHandle(C, g9, m9);
        h9.forEach((C) => {
          this.disposableCollection.add(this._refRangeService.registerRefRange(C, f4, g9, m9));
        });
      }
    }));
  }
};
Vn = Yl([
  _t2(0, Inject(Ds)),
  _t2(1, Inject(At3)),
  _t2(2, Inject(br)),
  _t2(3, Inject(Injector)),
  _t2(4, Inject(G)),
  _t2(5, Inject(z))
], Vn);
function xe2(n3, e) {
  return e ? n3.getUniverSheetInstance(e) : n3.getCurrentUnitForType(we.UNIVER_SHEET);
}
function $e4(n3, e) {
  return e ? n3.getSheetBySheetId(e) : n3.getActiveSheet();
}
function ec(n3, e) {
  return e.some((t3) => tc(n3, t3));
}
function tc(n3, e) {
  const { startRow: t3, startColumn: s2, endColumn: o3, endRow: r } = e, i = n3.getMatrixWithMergedCells(t3, s2, r, o3);
  let a4 = false;
  return i.forValue((u2, l4, c2) => {
    if (c2 && (u2 !== t3 || l4 !== s2) && n3.cellHasValue(c2))
      return a4 = true, false;
  }), a4;
}
function nc(n3, e, t3, s2) {
  const o3 = [], r = [], i = t3.getSheetId();
  return s2.forEach((a4) => {
    const u2 = sc(t3, a4), l4 = {
      unitId: e,
      subUnitId: i,
      cellValue: u2.getData()
    }, c2 = Ae4(
      n3,
      l4
    );
    o3.push({ id: ee2.id, params: c2 }), r.push({ id: ee2.id, params: l4 });
  }), {
    undos: o3,
    redos: r
  };
}
function sc(n3, e) {
  const { startRow: t3, startColumn: s2, endColumn: o3, endRow: r } = e, i = n3.getMatrixWithMergedCells(t3, s2, r, o3, ar.Raw), a4 = new ht();
  return i.forValue((u2, l4, c2) => {
    c2 && (u2 !== t3 || l4 !== s2) && a4.setValue(u2, l4, null);
  }), a4;
}
var ms = {
  type: Ls.COMMAND,
  id: "sheet.command.add-worksheet-merge",
  handler: (n3, e) => {
    const t3 = n3.get(Ds), s2 = n3.get(ra), o3 = n3.get(br), r = e.unitId, i = e.subUnitId, a4 = e.selections, u2 = Jr3(a4, e.value), l4 = o3.getUniverSheetInstance(r).getSheetBySheetId(i), c2 = [], d2 = [], h9 = ec(l4, u2), g9 = {
      unitId: r,
      subUnitId: i,
      ranges: u2
    }, m9 = {
      unitId: r,
      subUnitId: i,
      ranges: u2
    };
    c2.push({ id: se2.id, params: g9 }), c2.push({ id: ne.id, params: m9 });
    const f4 = ye3(n3, g9), C = We3(n3, m9);
    if (d2.push({ id: se2.id, params: C }), d2.push({ id: ne.id, params: f4 }), h9) {
      const w6 = nc(n3, r, l4, u2);
      c2.unshift(...w6.redos), d2.push(...w6.undos);
    }
    return po(c2, t3).result ? (s2.pushUndoRedo({
      unitID: r,
      undoMutations: d2,
      redoMutations: c2
    }), true) : false;
  }
};
var Yh = {
  type: Ls.COMMAND,
  id: "sheet.command.add-worksheet-merge-all",
  handler: (n3) => __async(void 0, null, function* () {
    var l4;
    const e = n3.get(Ds), s2 = (l4 = n3.get(z).getCurrentSelections()) == null ? void 0 : l4.map((c2) => c2.range);
    if (!(s2 != null && s2.length))
      return false;
    const r = n3.get(br).getCurrentUnitForType(we.UNIVER_SHEET);
    if (!r) return false;
    const i = r.getActiveSheet();
    if (!i) return false;
    const a4 = r.getUnitId(), u2 = i.getSheetId();
    return e.executeCommand(ms.id, {
      selections: s2,
      unitId: a4,
      subUnitId: u2
    });
  })
};
var Xh = {
  type: Ls.COMMAND,
  id: "sheet.command.add-worksheet-merge-vertical",
  handler: (n3) => __async(void 0, null, function* () {
    var l4;
    const e = n3.get(Ds), s2 = (l4 = n3.get(z).getCurrentSelections()) == null ? void 0 : l4.map((c2) => c2.range);
    if (!(s2 != null && s2.length))
      return false;
    const r = n3.get(br).getCurrentUnitForType(we.UNIVER_SHEET);
    if (!r) return false;
    const i = r.getActiveSheet();
    if (!i) return false;
    const a4 = r.getUnitId(), u2 = i.getSheetId();
    return e.executeCommand(ms.id, {
      value: Im.COLUMNS,
      selections: s2,
      unitId: a4,
      subUnitId: u2
    });
  })
};
var Zh = {
  type: Ls.COMMAND,
  id: "sheet.command.add-worksheet-merge-horizontal",
  handler: (n3) => __async(void 0, null, function* () {
    var l4;
    const e = n3.get(Ds), s2 = (l4 = n3.get(z).getCurrentSelections()) == null ? void 0 : l4.map((c2) => c2.range);
    if (!(s2 != null && s2.length))
      return false;
    const r = n3.get(br).getCurrentUnitForType(we.UNIVER_SHEET);
    if (!r) return false;
    const i = r.getActiveSheet();
    if (!i) return false;
    const a4 = r.getUnitId(), u2 = i.getSheetId();
    return e.executeCommand(ms.id, {
      value: Im.ROWS,
      selections: s2,
      unitId: a4,
      subUnitId: u2
    });
  })
};
function Qh(n3, e, t3, s2, o3) {
  const r = n3.get(br), i = P5(r, { unitId: e, subUnitId: t3 });
  if (!i) return;
  const { worksheet: a4 } = i;
  if (a4.getMergeData().some((d2) => s2.some((h9) => Cn.intersects(h9, d2))))
    throw new Error("The ranges to be merged overlap with the existing merged cells");
  n3.get(Ds).executeCommand(ms.id, {
    unitId: e,
    subUnitId: t3,
    selections: s2,
    defaultMerge: o3
  });
}
var lt3 = class {
  constructor() {
    R(this, "_model", /* @__PURE__ */ new Map());
    R(this, "_ruleChange", new Subject());
    R(this, "_ruleRefresh", new Subject());
    R(this, "_resetOrder", new Subject());
    R(this, "ruleChange$", this._ruleChange.asObservable());
    R(this, "ruleRefresh$", this._ruleRefresh.asObservable());
    R(this, "resetOrder$", this._resetOrder.asObservable());
    R(this, "_worksheetRuleInitStateChange", new BehaviorSubject(false));
    R(this, "worksheetRuleInitStateChange$", this._worksheetRuleInitStateChange.asObservable());
  }
  changeRuleInitState(e) {
    this._worksheetRuleInitStateChange.next(e);
  }
  getSheetRuleInitState() {
    return this._worksheetRuleInitStateChange.value;
  }
  addRule(e, t3) {
    this._ensureSubUnitMap(e).set(t3.subUnitId, t3), this._ruleChange.next({ unitId: e, rule: t3, type: "add", subUnitId: t3.subUnitId });
  }
  deleteRule(e, t3) {
    var o3, r, i;
    const s2 = (r = (o3 = this._model) == null ? void 0 : o3.get(e)) == null ? void 0 : r.get(t3);
    s2 && ((i = this._model.get(e)) == null || i.delete(t3), this._ruleChange.next({ unitId: e, rule: s2, type: "delete", subUnitId: t3 }));
  }
  setRule(e, t3, s2) {
    var r, i;
    const o3 = this.getRule(e, t3);
    o3 && ((i = (r = this._model) == null ? void 0 : r.get(e)) == null || i.set(t3, s2), this._ruleChange.next({ unitId: e, oldRule: o3, rule: s2, type: "set", subUnitId: t3 }));
  }
  getRule(e, t3) {
    var s2, o3;
    return (o3 = (s2 = this._model) == null ? void 0 : s2.get(e)) == null ? void 0 : o3.get(t3);
  }
  toObject() {
    const e = {};
    return [...this._model.keys()].forEach((s2) => {
      const o3 = this._model.get(s2);
      o3 != null && o3.size && (e[s2] = [], [...o3.keys()].forEach((i) => {
        const a4 = o3.get(i);
        a4 && e[s2].push(a4);
      }));
    }), e;
  }
  fromObject(e) {
    const t3 = /* @__PURE__ */ new Map();
    Object.keys(e).forEach((s2) => {
      const o3 = e[s2];
      if (o3 != null && o3.length) {
        const r = /* @__PURE__ */ new Map();
        o3.forEach((i) => {
          r.set(i.subUnitId, i);
        }), t3.set(s2, r);
      }
    }), this._model = t3;
  }
  deleteUnitModel(e) {
    this._model.delete(e);
  }
  _ensureSubUnitMap(e) {
    let t3 = this._model.get(e);
    return t3 || (t3 = /* @__PURE__ */ new Map(), this._model.set(e, t3)), t3;
  }
  ruleRefresh(e) {
    this._ruleRefresh.next(e);
  }
  resetOrder() {
    this._resetOrder.next(Math.random());
  }
  getTargetByPermissionId(e, t3) {
    const s2 = this._model.get(e);
    if (!s2) return null;
    for (const [o3, r] of s2)
      if (r.permissionId === t3)
        return [e, o3];
  }
};
var Mt2 = {
  id: "sheet.mutation.add-worksheet-protection",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const t3 = n3.get(lt3), { unitId: s2, rule: o3 } = e;
    return t3.addRule(s2, o3), true;
  }
};
var xt = {
  id: "sheet.mutation.delete-worksheet-protection",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const t3 = n3.get(lt3), { unitId: s2, subUnitId: o3 } = e;
    return t3.deleteRule(s2, o3), true;
  }
};
var oc = {
  type: Ls.COMMAND,
  id: "sheet.command.add-worksheet-protection",
  handler(n3, e) {
    return __async(this, null, function* () {
      if (!e)
        return false;
      const t3 = n3.get(Ds), s2 = n3.get(ra), { rule: o3, unitId: r } = e, i = o3.subUnitId;
      if (yield t3.executeCommand(Mt2.id, {
        unitId: r,
        rule: o3,
        subUnitId: o3.subUnitId
      })) {
        const u2 = [{ id: Mt2.id, params: { unitId: r, rule: o3, subUnitId: o3.subUnitId } }], l4 = [{ id: xt.id, params: { unitId: r, subUnitId: i } }];
        s2.pushUndoRedo({
          unitID: r,
          redoMutations: u2,
          undoMutations: l4
        });
      }
      return true;
    });
  }
};
var rc = {
  type: Ls.COMMAND,
  id: "sheet.command.set-worksheet-range-theme-style",
  handler: (n3, e) => {
    const t3 = n3.get(Ds), s2 = n3.get(ra), { unitId: o3 } = e, r = Wa2(n3, e);
    return t3.syncExecuteCommand(tn.id, e) ? (s2.pushUndoRedo({
      unitID: o3,
      undoMutations: [{ id: nn2.id, params: r }],
      redoMutations: [{ id: tn.id, params: e }]
    }), true) : false;
  }
};
var ic = "sheet.command.append-row";
var ac = {
  type: Ls.COMMAND,
  id: ic,
  handler: (n3, e) => {
    const t3 = n3.get(Ds), s2 = n3.get(ra), { unitId: o3, subUnitId: r, cellValue: i, insertRowNums: a4, insertColumnNums: u2, maxRows: l4, maxColumns: c2 } = e, d2 = {
      unitId: o3,
      subUnitId: r,
      cellValue: i
    }, h9 = Ae4(
      n3,
      d2
    ), g9 = [{ id: ee2.id, params: d2 }], m9 = [{ id: ee2.id, params: h9 }];
    if (a4) {
      const C = {
        unitId: o3,
        subUnitId: r,
        range: {
          startRow: l4,
          endRow: l4,
          startColumn: 0,
          endColumn: c2 - 1
        }
      }, p3 = Ws(
        n3,
        C
      );
      g9.unshift({ id: ke2.id, params: C }), m9.push({ id: Te.id, params: p3 });
    }
    if (u2) {
      const C = {
        unitId: o3,
        subUnitId: r,
        range: {
          startRow: 0,
          endRow: l4 - 1,
          startColumn: c2,
          endColumn: c2 - 1 + u2
        }
      }, p3 = as(
        n3,
        C
      );
      g9.unshift({ id: Ue2.id, params: C }), m9.push({ id: Me.id, params: p3 });
    }
    return po(g9, t3).result ? (s2.pushUndoRedo({
      unitID: o3,
      undoMutations: m9,
      redoMutations: g9
    }), true) : false;
  }
};
var Ys = {
  id: "sheet.command.clear-selection-content",
  type: Ls.COMMAND,
  handler: (n3, e) => {
    var S;
    const t3 = n3.get(br), s2 = n3.get(Ds), o3 = n3.get(z), r = n3.get(ra), i = n3.get(G), a4 = t3.getCurrentUnitForType(we.UNIVER_SHEET);
    if (!a4) return false;
    const u2 = (e == null ? void 0 : e.unitId) || a4.getUnitId(), l4 = a4.getActiveSheet();
    if (!l4) return false;
    const c2 = (e == null ? void 0 : e.subUnitId) || l4.getSheetId(), d2 = (e == null ? void 0 : e.ranges) || ((S = o3.getCurrentSelections()) == null ? void 0 : S.map((I6) => I6.range));
    if (!(d2 != null && d2.length))
      return false;
    const h9 = ls(d2, n3, u2, c2), g9 = {
      subUnitId: c2,
      unitId: u2,
      cellValue: Nu(h9)
    }, m9 = Ae4(
      n3,
      g9
    ), f4 = i.onCommandExecute({ id: Ys.id }), C = [{ id: ee2.id, params: g9 }, ...f4.redos], p3 = [...f4.undos, { id: ee2.id, params: m9 }];
    return po(C, s2).result ? (r.pushUndoRedo({
      // If there are multiple mutations that form an encapsulated project, they must be encapsulated in the same undo redo element.
      // Hooks can be used to hook the code of external controllers to add new actions.
      unitID: u2,
      undoMutations: p3,
      redoMutations: C
    }), true) : false;
  }
};
var fs = "sheets.config";
var qr2 = {
  largeSheetCellCountThreshold: 6e3,
  batchSize: 3e3
};
var yo = {};
var uc2 = Object.getOwnPropertyDescriptor;
var lc = (n3, e, t3, s2) => {
  for (var o3 = s2 > 1 ? void 0 : s2 ? uc2(e, t3) : e, r = n3.length - 1, i; r >= 0; r--)
    (i = n3[r]) && (o3 = i(o3) || o3);
  return o3;
};
var bo3 = (n3, e) => (t3, s2) => e(t3, s2, n3);
var Ln = class extends Ve {
  constructor(e, t3) {
    super();
    R(this, "_tasks", /* @__PURE__ */ new Map());
    R(this, "_idleCallbackId", null);
    R(this, "_beforeUnloadHandler", null);
    this._commandService = e, this._univerInstanceService = t3, this._setupBeforeUnloadListener(), this.disposeWithMe(() => {
      this._cancelAllTasks(), this._removeBeforeUnloadListener();
    });
  }
  /**
   * Check if there are any pending tasks
   */
  hasPendingTasks() {
    return this._tasks.size > 0;
  }
  /**
   * Get the count of pending mutations across all tasks
   */
  getPendingMutationsCount() {
    let e = 0;
    for (const t3 of this._tasks.values())
      e += t3.mutations.length - t3.currentIndex;
    return e;
  }
  /**
   * Schedule mutations to be executed during idle time
   * @param unitId - The workbook unit ID
   * @param subUnitId - The sheet ID (newly created sheet)
   * @param mutations - Remaining SetRangeValuesMutation to execute
   */
  scheduleMutations(e, t3, s2) {
    if (s2.length === 0)
      return;
    const o3 = `${e}_${t3}`;
    this._cancelTask(o3), this._tasks.set(o3, {
      unitId: e,
      subUnitId: t3,
      mutations: s2,
      currentIndex: 0
    }), this._scheduleNextIdle();
  }
  /**
   * Cancel scheduled mutations for a specific sheet
   * Called when the sheet is deleted
   */
  cancelScheduledMutations(e, t3) {
    const s2 = `${e}_${t3}`;
    this._cancelTask(s2);
  }
  _cancelTask(e) {
    this._tasks.delete(e), this._tasks.size === 0 && this._idleCallbackId !== null && (typeof cancelIdleCallback < "u" && cancelIdleCallback(this._idleCallbackId), this._idleCallbackId = null);
  }
  _cancelAllTasks() {
    this._tasks.clear(), this._idleCallbackId !== null && (typeof cancelIdleCallback < "u" && cancelIdleCallback(this._idleCallbackId), this._idleCallbackId = null);
  }
  _scheduleNextIdle() {
    this._idleCallbackId === null && (typeof requestIdleCallback < "u" ? this._idleCallbackId = requestIdleCallback(
      (e) => this._processIdleTasks(e),
      { timeout: 1e3 * 60 }
    ) : this._idleCallbackId = setTimeout(() => {
      this._processIdleTasks({ didTimeout: false, timeRemaining: () => 16 });
    }, 16));
  }
  _processIdleTasks(e) {
    this._idleCallbackId = null;
    for (const [t3, s2] of this._tasks) {
      if (!this._isSheetExist(s2.unitId, s2.subUnitId)) {
        this._tasks.delete(t3);
        continue;
      }
      for (s2.currentIndex; s2.currentIndex < s2.mutations.length; ) {
        if (e.timeRemaining() <= 0 && !e.didTimeout) {
          this._scheduleNextIdle();
          return;
        }
        const o3 = s2.mutations[s2.currentIndex];
        this._commandService.syncExecuteCommand(o3.id, o3.params, { onlyLocal: true }), s2.currentIndex++;
      }
      this._tasks.delete(t3);
    }
    this._tasks.size > 0 && this._scheduleNextIdle();
  }
  _isSheetExist(e, t3) {
    const s2 = this._univerInstanceService.getUnit(e, we.UNIVER_SHEET);
    return s2 ? s2.getSheetBySheetId(t3) !== null : false;
  }
  _setupBeforeUnloadListener() {
    typeof window > "u" || (this._beforeUnloadHandler = (e) => {
      if (this.hasPendingTasks())
        return e.preventDefault(), e.returnValue = "", "";
    }, window.addEventListener("beforeunload", this._beforeUnloadHandler));
  }
  _removeBeforeUnloadListener() {
    typeof window > "u" || !this._beforeUnloadHandler || (window.removeEventListener("beforeunload", this._beforeUnloadHandler), this._beforeUnloadHandler = null);
  }
};
Ln = lc([
  bo3(0, Ds),
  bo3(1, br)
], Ln);
var Yr = {
  id: "sheet.mutation.copy-worksheet-end",
  type: Ls.MUTATION,
  handler: () => true
};
var Xr2 = (n3, e) => ({
  subUnitId: e.sheet.id,
  unitId: e.unitId,
  subUnitName: e.sheet.name
});
var ln = {
  id: "sheet.mutation.insert-sheet",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const t3 = n3.get(br), { sheet: s2, index: o3, unitId: r, styles: i } = e, a4 = t3.getUniverSheetInstance(r);
    return a4 ? (i && a4.addStyles(i), a4.addWorksheet(s2.id, o3, s2)) : false;
  }
};
function cc(n3) {
  let e = 0;
  for (const t3 of Object.keys(n3)) {
    const s2 = n3[Number(t3)];
    s2 && (e += Object.keys(s2).length);
  }
  return e;
}
function dc(n3, e, t3, s2) {
  const o3 = [];
  let r = {}, i = 0;
  for (const l4 in t3) {
    const c2 = Number(l4), d2 = t3[c2];
    if (!d2) continue;
    const h9 = Object.keys(d2).length;
    i > 0 && i + h9 > s2 && (o3.push(r), r = {}, i = 0), r[c2] = d2, i += h9, i >= s2 && (o3.push(r), r = {}, i = 0);
  }
  i > 0 && o3.push(r);
  const a4 = o3.length > 0 ? o3[0] : {}, u2 = o3.slice(1).map((l4) => ({
    id: ee2.id,
    params: {
      unitId: n3,
      subUnitId: e,
      cellValue: l4,
      __splitChunk__: true
    }
  }));
  return { firstChunkCellData: a4, remainingMutations: u2 };
}
var Zr2 = "sheet.command.copy-sheet";
function hc(n3, e, t3, s2, o3, r, i) {
  var b4, N6;
  const u2 = n3.get(xs).getConfig(fs), l4 = __spreadValues(__spreadValues({}, qr2), u2 == null ? void 0 : u2.largeSheetOperation), c2 = VE(t3.getConfig());
  c2.name = mc2(e, r, c2.name);
  const d2 = et();
  c2.id = d2;
  const h9 = e.getSheetIndex(t3), { cellData: g9 } = c2, f4 = cc(g9) >= l4.largeSheetCellCountThreshold;
  let C, p3 = [];
  if (f4) {
    const { firstChunkCellData: U3, remainingMutations: T10 } = dc(
      s2,
      d2,
      g9,
      l4.batchSize
    ), k6 = __spreadProps(__spreadValues({}, c2), { cellData: U3 });
    C = {
      index: h9 + 1,
      sheet: k6,
      unitId: s2
    }, p3 = T10;
  } else
    C = {
      index: h9 + 1,
      sheet: c2,
      unitId: s2
    };
  const w6 = Xr2(
    n3,
    C
  ), S = i.onCommandExecute({
    id: Zr2,
    params: { unitId: s2, subUnitId: o3, targetSubUnitId: c2.id }
  }), I6 = [
    ...(b4 = S.preRedos) != null ? b4 : [],
    { id: ln.id, params: C },
    ...S.redos
  ], y6 = [
    ...(N6 = S.preUndos) != null ? N6 : [],
    { id: Lt2.id, params: w6 },
    ...S.undos
  ];
  return {
    redos: I6,
    undos: y6,
    unitId: s2,
    newSheetId: d2,
    isSplit: f4,
    scheduledMutations: p3
  };
}
var gc = {
  type: Ls.COMMAND,
  id: Zr2,
  handler: (n3, e) => {
    const t3 = n3.get(Ds), s2 = n3.get(ra), o3 = n3.get(br), r = n3.get(G), i = n3.get(Hn), a4 = n3.get(Ln), u2 = P5(o3, e);
    if (!u2)
      return false;
    const { workbook: l4, worksheet: c2, unitId: d2, subUnitId: h9 } = u2, { redos: g9, undos: m9, newSheetId: f4, isSplit: C, scheduledMutations: p3 } = hc(
      n3,
      l4,
      c2,
      d2,
      h9,
      i,
      r
    );
    if (po(g9, t3).result) {
      if (C) {
        if (s2.pushUndoRedo({
          unitID: d2,
          undoMutations: m9,
          redoMutations: []
          // No redo for split case
        }), p3.length > 0) {
          for (const S of p3)
            t3.syncExecuteCommand(S.id, S.params, { syncOnly: true });
          t3.syncExecuteCommand(Yr.id, { unitId: d2, subUnitId: f4 }, { syncOnly: true }), a4.scheduleMutations(d2, f4, p3);
        }
      } else
        s2.pushUndoRedo({
          unitID: d2,
          undoMutations: m9,
          redoMutations: g9
        });
      return true;
    }
    return false;
  }
};
function mc2(n3, e, t3) {
  let s2 = `${t3} ${e.t("sheets.tabs.sheetCopy", "")}`, o3 = 2;
  for (; n3.checkSheetName(s2); )
    s2 = `${t3} ${e.t("sheets.tabs.sheetCopy", `${o3}`)}`, o3++;
  return s2;
}
var fc = {
  type: Ls.COMMAND,
  id: "sheet.command.delete-range-protection",
  handler(n3, e) {
    return __async(this, null, function* () {
      if (!e)
        return false;
      const t3 = n3.get(Ds), s2 = n3.get(ra), { unitId: o3, subUnitId: r, rule: i } = e, a4 = {
        unitId: o3,
        subUnitId: r,
        ruleIds: [i.id]
      };
      return (yield t3.executeCommand(ot2.id, a4)) && s2.pushUndoRedo({
        unitID: o3,
        redoMutations: [{ id: ot2.id, params: a4 }],
        undoMutations: [{ id: Be3.id, params: { unitId: o3, subUnitId: r, rules: [i] } }]
      }), true;
    });
  }
};
var Rc = {
  type: Ls.COMMAND,
  id: "sheet.command.delete-worksheet-protection",
  handler(n3, e) {
    if (!e)
      return false;
    const t3 = n3.get(Ds), s2 = n3.get(ra), { rule: o3, unitId: r, subUnitId: i } = e;
    t3.executeCommand(xt.id, {
      unitId: r,
      subUnitId: i
    });
    const a4 = [{ id: xt.id, params: { unitId: r, subUnitId: i } }], u2 = [{ id: Mt2.id, params: { unitId: r, rule: o3, subUnitId: i } }];
    return s2.pushUndoRedo({
      unitID: r,
      redoMutations: a4,
      undoMutations: u2
    }), true;
  }
};
var Cc = {
  type: Ls.COMMAND,
  id: "sheet.command.remove-worksheet-range-theme-style",
  handler: (n3, e) => {
    const t3 = n3.get(Ds), s2 = n3.get(ra), { unitId: o3 } = e, r = Va2(n3, e);
    return t3.syncExecuteCommand(nn2.id, e) ? (s2.pushUndoRedo({
      unitID: o3,
      undoMutations: [{ id: tn.id, params: r }],
      redoMutations: [{ id: nn2.id, params: e }]
    }), true) : false;
  }
};
var pc = {
  id: "sheet.command.insert-defined-name",
  type: Ls.COMMAND,
  handler: (n3, e) => {
    const t3 = n3.get(Ds), s2 = n3.get(ra);
    if (!e) return false;
    const o3 = __spreadValues({}, e);
    return t3.syncExecuteCommand(_a2.id, o3) ? (s2.pushUndoRedo({
      unitID: e.unitId,
      undoMutations: [{ id: Vo2.id, params: o3 }],
      redoMutations: [{ id: _a2.id, params: o3 }]
    }), true) : false;
  }
};
var Sc = {
  id: "sheet.command.insert-sheet",
  type: Ls.COMMAND,
  handler: (n3, e) => {
    var C;
    const t3 = n3.get(Ds), s2 = n3.get(ra), o3 = n3.get(br), r = n3.get(Hn), i = Yo(o3, { unitId: e == null ? void 0 : e.unitId });
    if (!i) return false;
    const { unitId: a4, workbook: u2 } = i;
    let l4 = u2.getSheets().length;
    const c2 = e == null ? void 0 : e.sheet, d2 = c2 == null ? void 0 : c2.id, h9 = $E(c2 || {});
    e ? (l4 = (C = e.index) != null ? C : l4, h9.id = d2 || et(), h9.name = (c2 == null ? void 0 : c2.name) || u2.generateNewSheetName(`${r.t("sheets.tabs.sheet")}`)) : (h9.id = et(), h9.name = u2.generateNewSheetName(`${r.t("sheets.tabs.sheet")}`));
    const g9 = {
      index: l4,
      sheet: h9,
      unitId: a4
    }, m9 = Xr2(
      n3,
      g9
    );
    return t3.syncExecuteCommand(ln.id, g9) ? (s2.pushUndoRedo({
      unitID: a4,
      undoMutations: [{ id: Lt2.id, params: m9 }],
      redoMutations: [{ id: ln.id, params: g9 }]
    }), true) : false;
  }
};
var cn = {
  id: "sheet.mutation.register-worksheet-range-theme-style",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const { unitId: t3, rangeThemeStyleJson: s2, themeName: o3 } = e, r = n3.get(br), i = P5(r), a4 = n3.get(ve2);
    if (!i) return false;
    const u2 = new Rt(o3, s2);
    return a4.registerRangeThemeStyle(t3, u2), true;
  }
};
var Xs = {
  id: "sheet.mutation.unregister-worksheet-range-theme-style",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const { unitId: t3, themeName: s2 } = e, o3 = n3.get(br), r = P5(o3), i = n3.get(ve2);
    return r ? (i.unregisterRangeThemeStyle(t3, s2), true) : false;
  }
};
var wc = {
  id: "sheet.command.register-worksheet-range-theme-style",
  type: Ls.COMMAND,
  handler: (n3, e) => {
    if (!e)
      return false;
    const { unitId: t3, rangeThemeStyle: s2 } = e, o3 = n3.get(br), r = n3.get(Ds), i = n3.get(ra);
    if (!P5(o3)) return false;
    const u2 = {
      unitId: t3,
      themeName: s2.getName(),
      rangeThemeStyleJson: s2.toJson()
    }, l4 = {
      unitId: t3,
      themeName: s2.getName()
    };
    return r.syncExecuteCommand(cn.id, u2) && i.pushUndoRedo({
      unitID: t3,
      undoMutations: [{ id: Xs.id, params: l4 }],
      redoMutations: [{ id: cn.id, params: u2 }]
    }), true;
  }
};
var Qr2 = {
  id: "sheet.command.remove-defined-name",
  type: Ls.COMMAND,
  handler: (n3, e) => {
    var c2, d2;
    const t3 = n3.get(Ds), s2 = n3.get(ra), o3 = n3.get(G);
    if (!e) return false;
    const r = __spreadValues({}, e), i = o3.onCommandExecute({ id: Qr2.id, params: e }), a4 = [
      ...(c2 = i.preRedos) != null ? c2 : [],
      { id: Vo2.id, params: r },
      ...i.redos
    ], u2 = [
      ...(d2 = i.preUndos) != null ? d2 : [],
      { id: _a2.id, params: r },
      ...i.undos
    ];
    return po(a4, t3) ? (s2.pushUndoRedo({
      unitID: e.unitId,
      undoMutations: u2.filter(Boolean),
      redoMutations: a4.filter(Boolean)
    }), true) : false;
  }
};
var Zs = {
  id: "sheet.command.remove-sheet",
  type: Ls.COMMAND,
  handler: (n3, e) => {
    var b4, N6;
    const t3 = n3.get(Ds), s2 = n3.get(ra), o3 = n3.get(br), r = n3.get(G), i = n3.get(xs), a4 = P5(o3, e);
    if (!a4) return false;
    const { unitId: u2, subUnitId: l4, workbook: c2, worksheet: d2 } = a4;
    if (c2.getSheets().length <= 1) return false;
    const h9 = i.getConfig(fs), g9 = __spreadValues(__spreadValues({}, qr2), h9 == null ? void 0 : h9.largeSheetOperation), f4 = Sl2(d2.getCellMatrix()) >= g9.largeSheetCellCountThreshold, C = {
      subUnitId: l4,
      unitId: u2,
      subUnitName: d2.getName()
    }, p3 = f4 ? null : hl(n3, C), w6 = r.onCommandExecute({
      id: Zs.id,
      params: { unitId: u2, subUnitId: l4 }
    }), S = [...(b4 = w6.preRedos) != null ? b4 : [], { id: Lt2.id, params: C }, ...w6.redos], I6 = f4 ? [] : [...(N6 = w6.preUndos) != null ? N6 : [], { id: ln.id, params: p3 }, ...w6.undos];
    return po(S, t3).result ? (f4 ? s2.clearUndoRedo(u2) : s2.pushUndoRedo({
      unitID: u2,
      undoMutations: I6,
      redoMutations: S
    }), true) : false;
  }
};
var Ic = {
  type: Ls.COMMAND,
  id: "sheet.command.remove-worksheet-merge",
  // eslint-disable-next-line max-lines-per-function
  handler: (n3, e) => {
    var D5;
    const t3 = n3.get(z), s2 = n3.get(Ds), o3 = n3.get(ra), r = n3.get(br), i = (e == null ? void 0 : e.ranges) || ((D5 = t3.getCurrentSelections()) == null ? void 0 : D5.map((H6) => H6.range));
    if (!(i != null && i.length)) return false;
    const a4 = P5(r);
    if (!a4) return false;
    const { subUnitId: u2, unitId: l4, worksheet: c2 } = a4, d2 = {
      unitId: l4,
      subUnitId: u2,
      ranges: i
    }, g9 = c2.getConfig().mergeData.filter((H6) => i.some((F7) => Cn.intersects(F7, H6)));
    if (!g9.length) return false;
    const m9 = ye3(
      n3,
      d2
    ), f4 = t3.getCurrentSelections();
    if (!(f4 != null && f4.length)) return false;
    const C = Z.deepClone(f4), p3 = Z.deepClone(f4), w6 = p3[p3.length - 1], { startRow: S, startColumn: I6 } = w6.range;
    w6.primary = {
      startRow: S,
      startColumn: I6,
      endRow: S,
      endColumn: I6,
      actualRow: S,
      actualColumn: I6,
      isMerged: false,
      isMergedMainCell: false
    };
    const y6 = vc(c2, g9), b4 = {
      unitId: l4,
      subUnitId: u2,
      cellValue: y6.redoParams.getMatrix()
    }, N6 = {
      unitId: l4,
      subUnitId: u2,
      cellValue: y6.undoParams.getMatrix()
    }, U3 = [
      { id: se2.id, params: m9 },
      { id: ee2.id, params: b4 },
      { id: ie5.id, params: { selections: p3 } }
    ], T10 = [
      { id: ne.id, params: m9 },
      { id: ee2.id, params: N6 },
      { id: ie5.id, params: { selections: C } }
    ];
    return po(U3, s2) ? (o3.pushUndoRedo({
      unitID: l4,
      undoMutations: T10,
      redoMutations: U3
    }), true) : false;
  }
};
function vc(n3, e) {
  const t3 = new ht(), s2 = new ht();
  return e.forEach((o3) => {
    const { startRow: r, startColumn: i, endColumn: a4, endRow: u2 } = o3, l4 = n3.getCellMatrix().getValue(r, i);
    if (l4 != null && l4.s)
      for (let c2 = r; c2 <= u2; c2++)
        for (let d2 = i; d2 <= a4; d2++)
          (c2 !== r || d2 !== i) && (t3.setValue(c2, d2, { s: l4.s }), s2.setValue(c2, d2, null));
  }), {
    redoParams: t3,
    undoParams: s2
  };
}
var Ht2 = class {
  constructor() {
    R(this, "_borderInfo", {
      type: _m.ALL,
      color: "#000000",
      style: xe.THIN,
      activeBorderType: false
    });
    R(this, "_borderInfo$", new BehaviorSubject(this._borderInfo));
    R(this, "borderInfo$", this._borderInfo$.asObservable());
  }
  dispose() {
    this._borderInfo$.complete();
  }
  setType(e) {
    this._borderInfo.type = e, this.setActiveBorderType(true), this._refresh();
  }
  setColor(e) {
    this._borderInfo.color = e, this._refresh();
  }
  setStyle(e) {
    this._borderInfo.style = e, this._refresh();
  }
  setActiveBorderType(e) {
    this._borderInfo.activeBorderType = e;
  }
  getBorderInfo() {
    return this._borderInfo;
  }
  _refresh() {
    this._borderInfo$.next(this._borderInfo);
  }
};
function Hn3(n3, e) {
  const { startRow: t3, startColumn: s2, endRow: o3, endColumn: r } = n3;
  for (let i = t3; i <= o3; i++)
    for (let a4 = s2; a4 <= r; a4++)
      e(i, a4);
}
var Qs = (n3, e, t3, s2) => {
  const { mr: o3, worksheet: r } = n3;
  e.startRow < 0 || e.startColumn < 0 || Hn3(e, (i, a4) => {
    var c2, d2;
    const u2 = r.getMergedCell(i, a4);
    let l4 = t3;
    if (u2 && (t3.bc_tr || t3.ml_tr || t3.bl_tr || t3.tl_mr || t3.tl_bc || t3.tl_br)) {
      if (s2) {
        const h9 = Z.deepClone(
          (c2 = o3.getValue(u2.startRow, u2.startColumn)) == null ? void 0 : c2.s
        );
        l4 = h9 != null && h9.bd ? Object.assign(h9.bd, t3) : t3;
      }
      o3.setValue(u2.startRow, u2.startColumn, {
        s: {
          bd: l4
        }
      });
    } else {
      if (s2) {
        const h9 = Z.deepClone((d2 = o3.getValue(i, a4)) == null ? void 0 : d2.s);
        l4 = h9 != null && h9.bd ? Object.assign(h9.bd, t3) : t3;
      }
      o3.setValue(i, a4, { s: { bd: l4 } });
    }
  });
};
var Mc = (n3) => {
  const e = {
    startRow: n3.startRow - 1,
    startColumn: n3.startColumn,
    endRow: n3.startRow - 1,
    endColumn: n3.endColumn
  }, t3 = {
    startRow: n3.startRow,
    startColumn: n3.startColumn - 1,
    endRow: n3.endRow,
    endColumn: n3.startColumn - 1
  }, s2 = {
    startRow: n3.endRow + 1,
    startColumn: n3.startColumn,
    endRow: n3.endRow + 1,
    endColumn: n3.endColumn
  }, o3 = {
    startRow: n3.startRow,
    startColumn: n3.endColumn + 1,
    endRow: n3.endRow,
    endColumn: n3.endColumn + 1
  }, r = {
    startRow: n3.startRow,
    startColumn: n3.startColumn,
    endRow: n3.startRow,
    endColumn: n3.endColumn
  }, i = {
    startRow: n3.startRow,
    startColumn: n3.startColumn,
    endRow: n3.endRow,
    endColumn: n3.startColumn
  }, a4 = {
    startRow: n3.endRow,
    startColumn: n3.startColumn,
    endRow: n3.endRow,
    endColumn: n3.endColumn
  }, u2 = {
    startRow: n3.startRow,
    startColumn: n3.endColumn,
    endRow: n3.endRow,
    endColumn: n3.endColumn
  };
  return {
    topRangeOut: e,
    leftRangeOut: t3,
    bottomRangeOut: s2,
    rightRangeOut: o3,
    topRange: r,
    leftRange: i,
    bottomRange: a4,
    rightRange: u2
  };
};
function _c(n3, e, t3) {
  const { style: s2, color: o3, type: r } = n3.getBorderInfo(), i = r === _m.TOP || r === _m.ALL || r === _m.OUTSIDE, a4 = r === _m.LEFT || r === _m.ALL || r === _m.OUTSIDE, u2 = r === _m.BOTTOM || r === _m.ALL || r === _m.OUTSIDE, l4 = r === _m.RIGHT || r === _m.ALL || r === _m.OUTSIDE, c2 = r === _m.VERTICAL || r === _m.ALL || r === _m.INSIDE, d2 = r === _m.HORIZONTAL || r === _m.ALL || r === _m.INSIDE, h9 = r.indexOf("tlbr") > -1, g9 = r.indexOf("tlbc") > -1, m9 = r.indexOf("tlmr") > -1, f4 = r.indexOf("bltr") > -1, C = r.indexOf("mltr") > -1, p3 = r.indexOf("bctr") > -1, w6 = t3[0], {
    topRangeOut: S,
    leftRangeOut: I6,
    bottomRangeOut: y6,
    rightRangeOut: b4,
    topRange: N6,
    leftRange: U3,
    bottomRange: T10,
    rightRange: k6
  } = Mc(w6), D5 = new ht(), { worksheet: H6, unitId: F7, subUnitId: K5 } = e;
  return {
    worksheet: H6,
    unitId: F7,
    subUnitId: K5,
    style: s2,
    color: o3,
    type: r,
    top: i,
    left: a4,
    right: l4,
    bottom: u2,
    vertical: c2,
    horizontal: d2,
    tl_br: h9,
    tl_bc: g9,
    tl_mr: m9,
    bl_tr: f4,
    ml_tr: C,
    bc_tr: p3,
    topRangeOut: S,
    leftRangeOut: I6,
    bottomRangeOut: y6,
    rightRangeOut: b4,
    topRange: N6,
    leftRange: U3,
    bottomRange: T10,
    rightRange: k6,
    range: w6,
    mr: D5,
    borderStyle: {
      s: s2,
      cl: {
        rgb: o3
      }
    }
  };
}
var yc2 = (n3) => {
  const { range: e, mr: t3, borderStyle: s2, vertical: o3, horizontal: r, worksheet: i } = n3;
  o3 && Hn3(e, (a4, u2) => {
    var c2, d2, h9;
    const l4 = i.getMergedCell(a4, u2);
    if (l4) {
      const g9 = (c2 = t3.getValue(l4.startRow, l4.startColumn)) == null ? void 0 : c2.s;
      l4.startColumn !== e.startColumn && t3.setValue(a4, u2, {
        s: {
          bd: g9 != null && g9.bd ? Object.assign(g9.bd, { l: Z.deepClone(s2) }) : { l: Z.deepClone(s2) }
        }
      });
    } else {
      if (u2 !== e.endColumn) {
        const g9 = (d2 = t3.getValue(a4, u2)) == null ? void 0 : d2.s;
        t3.setValue(a4, u2, {
          s: {
            bd: g9 != null && g9.bd ? Object.assign(g9.bd, { r: Z.deepClone(s2) }) : { r: Z.deepClone(s2) }
          }
        });
      }
      if (u2 !== e.startColumn) {
        const g9 = (h9 = t3.getValue(a4, u2)) == null ? void 0 : h9.s;
        t3.setValue(a4, u2, {
          s: {
            bd: g9 != null && g9.bd ? Object.assign(g9.bd, { l: Z.deepClone(s2) }) : { l: Z.deepClone(s2) }
          }
        });
      }
    }
  }), r && Hn3(e, (a4, u2) => {
    var c2, d2, h9;
    const l4 = i.getMergedCell(a4, u2);
    if (l4) {
      const g9 = (c2 = t3.getValue(l4.startRow, l4.startColumn)) == null ? void 0 : c2.s;
      l4.startRow !== e.startRow && t3.setValue(a4, u2, {
        s: {
          bd: g9 != null && g9.bd ? Object.assign(g9.bd, { t: Z.deepClone(s2) }) : { t: Z.deepClone(s2) }
        }
      });
    } else {
      if (a4 !== e.endRow) {
        const g9 = (d2 = t3.getValue(a4, u2)) == null ? void 0 : d2.s;
        t3.setValue(a4, u2, {
          s: {
            bd: g9 != null && g9.bd ? Object.assign(g9.bd, { b: Z.deepClone(s2) }) : { b: Z.deepClone(s2) }
          }
        });
      }
      if (a4 !== e.startRow) {
        const g9 = (h9 = t3.getValue(a4, u2)) == null ? void 0 : h9.s;
        t3.setValue(a4, u2, {
          s: {
            bd: g9 != null && g9.bd ? Object.assign(g9.bd, { t: Z.deepClone(s2) }) : { t: Z.deepClone(s2) }
          }
        });
      }
    }
  });
};
function bc(n3) {
  const { borderStyle: e, tl_br: t3, tl_bc: s2, tl_mr: o3, bl_tr: r, ml_tr: i, bc_tr: a4 } = n3, u2 = (l4, c2, d2) => {
    Qs(n3, l4, c2, d2);
  };
  t3 && u2(n3.range, { tl_br: Z.deepClone(e) }, true), s2 && u2(n3.range, { tl_bc: Z.deepClone(e) }, true), o3 && u2(n3.range, { tl_mr: Z.deepClone(e) }, true), r && u2(n3.range, { bl_tr: Z.deepClone(e) }, true), i && u2(n3.range, { ml_tr: Z.deepClone(e) }, true), a4 && u2(n3.range, { bc_tr: Z.deepClone(e) }, true);
}
var Ec = (n3) => {
  const { top: e, left: t3, right: s2, bottom: o3, borderStyle: r, bottomRange: i, topRange: a4, leftRange: u2, rightRange: l4, bottomRangeOut: c2, topRangeOut: d2, leftRangeOut: h9, rightRangeOut: g9 } = n3, m9 = (f4, C, p3) => {
    Qs(n3, f4, C, p3);
  };
  e && (m9(d2, { b: null }), m9(a4, { t: Z.deepClone(r) }, true)), o3 && (m9(c2, { t: null }), m9(i, { b: Z.deepClone(r) }, true)), t3 && (m9(h9, { r: null }), m9(u2, { l: Z.deepClone(r) }, true)), s2 && (m9(g9, { l: null }), m9(l4, { r: Z.deepClone(r) }, true));
};
var kc = (n3) => {
  const { range: e, worksheet: t3, mr: s2, top: o3, bottom: r, left: i, right: a4, vertical: u2, horizontal: l4, tl_br: c2, tl_bc: d2, tl_mr: h9, bl_tr: g9, ml_tr: m9, bc_tr: f4, topRange: C, bottomRange: p3, leftRange: w6, rightRange: S, topRangeOut: I6, bottomRangeOut: y6, leftRangeOut: b4, rightRangeOut: N6 } = n3, U3 = (T10, k6, D5) => {
    Qs(n3, T10, k6, D5);
  };
  !o3 && !r && !i && !a4 && !u2 && !l4 && !c2 && !d2 && !h9 && !g9 && !m9 && !f4 && (Hn3(e, (T10, k6) => {
    var H6, F7, K5, J6, ae5, oe5, le3, Se5;
    const D5 = t3.getMergedCell(T10, k6);
    if (D5) {
      if (D5.endColumn !== e.endColumn) {
        const Z9 = (H6 = s2.getValue(D5.startRow, D5.startColumn)) == null ? void 0 : H6.s;
        s2.setValue(T10, k6, {
          s: {
            bd: Z9 != null && Z9.bd ? Object.assign(Z9.bd, { r: null }) : { r: null }
          }
        });
      }
      if (D5.startColumn !== e.startColumn) {
        const Z9 = (F7 = s2.getValue(D5.startRow, D5.startColumn)) == null ? void 0 : F7.s;
        s2.setValue(T10, k6, {
          s: {
            bd: Z9 != null && Z9.bd ? Object.assign(Z9.bd, { l: null }) : { l: null }
          }
        });
      }
      if (D5.endRow !== e.endRow) {
        const Z9 = (K5 = s2.getValue(D5.startRow, D5.startColumn)) == null ? void 0 : K5.s;
        s2.setValue(T10, k6, {
          s: {
            bd: Z9 != null && Z9.bd ? Object.assign(Z9.bd, { b: null }) : { b: null }
          }
        });
      }
      if (D5.startRow !== e.startRow) {
        const Z9 = (J6 = s2.getValue(D5.startRow, D5.startColumn)) == null ? void 0 : J6.s;
        s2.setValue(T10, k6, {
          s: {
            bd: Z9 != null && Z9.bd ? Object.assign(Z9.bd, { t: null }) : { t: null }
          }
        });
      }
    } else {
      if (k6 !== e.endColumn) {
        const Z9 = (ae5 = s2.getValue(T10, k6)) == null ? void 0 : ae5.s;
        s2.setValue(T10, k6, {
          s: {
            bd: Z9 != null && Z9.bd ? Object.assign(Z9.bd, { r: null }) : { r: null }
          }
        });
      }
      if (k6 !== e.startColumn) {
        const Z9 = (oe5 = s2.getValue(T10, k6)) == null ? void 0 : oe5.s;
        s2.setValue(T10, k6, {
          s: {
            bd: Z9 != null && Z9.bd ? Object.assign(Z9.bd, { l: null }) : { l: null }
          }
        });
      }
      if (T10 !== e.endRow) {
        const Z9 = (le3 = s2.getValue(T10, k6)) == null ? void 0 : le3.s;
        s2.setValue(T10, k6, {
          s: {
            bd: Z9 != null && Z9.bd ? Object.assign(Z9.bd, { b: null }) : { b: null }
          }
        });
      }
      if (T10 !== e.startRow) {
        const Z9 = (Se5 = s2.getValue(T10, k6)) == null ? void 0 : Se5.s;
        s2.setValue(T10, k6, {
          s: {
            bd: Z9 != null && Z9.bd ? Object.assign(Z9.bd, { t: null }) : { t: null }
          }
        });
      }
    }
  }), U3(I6, { b: null }), U3(C, { t: null }, true), U3(y6, { t: null }), U3(p3, { b: null }, true), U3(b4, { r: null }), U3(w6, { l: null }, true), U3(N6, { l: null }), U3(S, { r: null }, true), U3(e, { tl_br: null }, true), U3(e, { tl_bc: null }, true), U3(e, { tl_mr: null }, true), U3(e, { bl_tr: null }, true), U3(e, { ml_tr: null }, true), U3(e, { bc_tr: null }, true));
};
var In2 = {
  id: "sheet.command.set-border",
  type: Ls.COMMAND,
  handler: (n3, e) => {
    var p3;
    const t3 = n3.get(Ds), s2 = n3.get(ra), o3 = n3.get(br), r = n3.get(z), i = n3.get(Ht2), a4 = P5(o3, e);
    if (!a4) return false;
    const u2 = (e == null ? void 0 : e.ranges) || ((p3 = r.getCurrentSelections()) == null ? void 0 : p3.map((w6) => w6.range));
    if (!(u2 != null && u2.length))
      return false;
    const { activeBorderType: l4 } = i.getBorderInfo();
    if (!l4) return false;
    const c2 = _c(i, a4, u2);
    yc2(c2), Ec(c2), bc(c2), kc(c2);
    const { unitId: d2, subUnitId: h9, mr: g9 } = c2, m9 = {
      unitId: d2,
      subUnitId: h9,
      cellValue: g9.getData()
    }, f4 = Ae4(
      n3,
      m9
    );
    return t3.syncExecuteCommand(ee2.id, m9) ? (s2.pushUndoRedo({
      unitID: d2,
      undoMutations: [{ id: ee2.id, params: f4 }],
      redoMutations: [{ id: ee2.id, params: m9 }]
    }), true) : false;
  }
};
var Uc = {
  id: "sheet.command.set-border-position",
  type: Ls.COMMAND,
  handler: (n3, e) => {
    if (!e.value) return false;
    const t3 = n3.get(Ds);
    return n3.get(Ht2).setType(e.value), t3.syncExecuteCommand(In2.id);
  }
};
var Tc = {
  id: "sheet.command.set-border-style",
  type: Ls.COMMAND,
  handler: (n3, e) => {
    const t3 = n3.get(Ds);
    return n3.get(Ht2).setStyle(e.value), t3.syncExecuteCommand(In2.id);
  }
};
var Pc = {
  id: "sheet.command.set-border-color",
  type: Ls.COMMAND,
  handler: (n3, e) => {
    const t3 = n3.get(Ds);
    return n3.get(Ht2).setColor(e.value), t3.syncExecuteCommand(In2.id);
  }
};
var Nc = {
  id: "sheet.command.set-border-basic",
  type: Ls.COMMAND,
  handler: (n3, e) => {
    const { unitId: t3, subUnitId: s2, value: o3, ranges: r } = e, { type: i, color: a4, style: u2 } = o3, l4 = n3.get(Ds), c2 = n3.get(Ht2);
    return c2.setType(i), a4 && c2.setColor(a4), c2.setStyle(u2), l4.syncExecuteCommand(In2.id, {
      unitId: t3,
      subUnitId: s2,
      ranges: r
    });
  }
};
var Oc = {
  type: Ls.COMMAND,
  id: "sheet.command.set-col-data",
  handler: (n3, e) => {
    const t3 = n3.get(Ds), s2 = n3.get(ra), o3 = n3.get(br), r = P5(o3, e);
    if (!r) return false;
    const { columnData: i } = e, { unitId: a4, subUnitId: u2, worksheet: l4 } = r, c2 = {
      subUnitId: u2,
      unitId: a4,
      columnData: i
    }, d2 = Ka(c2, l4);
    return t3.syncExecuteCommand(zt.id, c2) ? (s2.pushUndoRedo({
      unitID: a4,
      undoMutations: [{ id: zt.id, params: d2 }],
      redoMutations: [{ id: zt.id, params: c2 }]
    }), true) : false;
  }
};
var dn = {
  type: Ls.COMMAND,
  id: "sheet.command.set-col-visible-on-cols",
  handler: (n3, e) => {
    var p3, w6;
    const { unitId: t3, subUnitId: s2, ranges: o3 } = e, r = n3.get(G), i = n3.get(Ds), a4 = n3.get(br), u2 = P5(a4, { unitId: t3, subUnitId: s2 });
    if (!u2) return false;
    const { worksheet: l4 } = u2, c2 = {
      unitId: t3,
      subUnitId: s2,
      ranges: o3
    }, d2 = {
      unitId: t3,
      subUnitId: s2,
      reveal: true,
      selections: o3.map((S) => ({ range: S, primary: _e3(S, l4), style: null }))
    }, h9 = qa(n3, c2), g9 = {
      unitId: t3,
      subUnitId: s2,
      selections: ti2(o3).map((S) => ({
        range: S,
        primary: _e3(S, l4),
        style: null
      }))
    }, m9 = po([
      { id: on.id, params: c2 },
      { id: ie5.id, params: d2 }
    ], i), f4 = r.onCommandExecute({
      id: dn.id,
      params: e
    }), C = po([...f4.redos], i);
    if (m9.result && C.result) {
      const S = r.afterCommandExecute({
        id: dn.id,
        params: e
      });
      return po(S.redos, i), n3.get(ra).pushUndoRedo({
        unitID: t3,
        undoMutations: [
          { id: sn.id, params: h9 },
          { id: ie5.id, params: g9 },
          ...(p3 = f4.undos) != null ? p3 : [],
          ...S.undos
        ],
        redoMutations: [
          ...(w6 = f4.preRedos) != null ? w6 : [],
          { id: on.id, params: c2 },
          { id: ie5.id, params: d2 },
          ...f4.redos,
          ...S.redos
        ]
      }), true;
    }
    return true;
  }
};
var ei = {
  type: Ls.COMMAND,
  id: "sheet.command.set-selected-cols-visible",
  handler: (n3) => {
    var l4;
    const e = n3.get(z), t3 = n3.get(Ds), s2 = (l4 = e.getCurrentSelections()) == null ? void 0 : l4.map((c2) => c2.range).filter((c2) => c2.rangeType === ge.COLUMN);
    if (!(s2 != null && s2.length)) return false;
    const o3 = P5(n3.get(br));
    if (!o3) return false;
    const { worksheet: r, unitId: i, subUnitId: a4 } = o3, u2 = s2.map((c2) => r.getHiddenCols(c2.startColumn, c2.endColumn)).flat();
    return t3.executeCommand(dn.id, {
      unitId: i,
      subUnitId: a4,
      ranges: u2
    });
  }
};
var Us = {
  type: Ls.COMMAND,
  id: "sheet.command.set-col-hidden",
  handler: (n3, e) => {
    var w6, S, I6, y6;
    const t3 = n3.get(z), s2 = n3.get(G), o3 = n3.get(br), r = n3.get(Ds);
    let i = (w6 = e == null ? void 0 : e.ranges) != null && w6.length ? e.ranges : (S = t3.getCurrentSelections()) == null ? void 0 : S.map((b4) => b4.range).filter((b4) => b4.rangeType === ge.COLUMN);
    if (!(i != null && i.length)) return false;
    const a4 = P5(o3, e);
    if (!a4) return false;
    const { worksheet: u2, unitId: l4, subUnitId: c2 } = a4;
    i = Dc(a4.worksheet, i);
    const d2 = { unitId: l4, subUnitId: c2, ranges: i }, h9 = {
      unitId: l4,
      subUnitId: c2,
      selections: ti2(i).map((b4) => ({
        range: b4,
        primary: _e3(b4, u2),
        style: null
      }))
    }, g9 = Ja(n3, d2), m9 = {
      unitId: l4,
      subUnitId: c2,
      reveal: true,
      selections: i.map((b4) => ({
        range: b4,
        primary: _e3(b4, u2),
        style: null
      }))
    }, f4 = po([
      { id: sn.id, params: d2 },
      { id: ie5.id, params: h9 }
    ], r), C = s2.onCommandExecute({
      id: Us.id,
      params: d2
    }), p3 = po([...C.redos], r);
    if (f4.result && p3.result) {
      const b4 = s2.afterCommandExecute({
        id: Us.id,
        params: d2
      });
      return po(b4.redos, r), n3.get(ra).pushUndoRedo({
        unitID: l4,
        undoMutations: [
          { id: on.id, params: g9 },
          { id: ie5.id, params: m9 },
          ...(I6 = C.undos) != null ? I6 : [],
          ...b4.undos
        ],
        redoMutations: [
          ...(y6 = C.preRedos) != null ? y6 : [],
          { id: sn.id, params: d2 },
          { id: ie5.id, params: h9 },
          ...C.redos,
          ...b4.redos
        ]
      }), true;
    }
    return false;
  }
};
function Dc(n3, e) {
  const t3 = n3.getRowCount() - 1, s2 = n3.getHiddenCols(), o3 = [];
  return e.forEach((r) => {
    const i = s2.filter((a4) => a4.startColumn >= r.startColumn && a4.endColumn <= r.endColumn);
    if (i.length) {
      let a4 = r.startColumn;
      i.forEach((u2) => {
        u2.startColumn > a4 && (o3.push({ startColumn: a4, endColumn: u2.startColumn - 1, startRow: 0, endRow: t3 }), a4 = u2.endColumn + 1);
      }), a4 <= r.endColumn && o3.push({ startColumn: a4, endColumn: r.endColumn, startRow: 0, endRow: t3 });
    } else
      o3.push(r);
  }), o3;
}
function ti2(n3) {
  return Ac(n3).map((t3) => {
    const s2 = t3.startColumn === 0 ? t3.endColumn + 1 : t3.startColumn - 1;
    return __spreadProps(__spreadValues({}, t3), {
      startColumn: s2,
      endColumn: s2
    });
  });
}
function Ac(n3) {
  const e = [];
  let t3;
  return n3.sort((s2, o3) => s2.startColumn - o3.startColumn).forEach((s2) => {
    if (!t3) {
      t3 = s2;
      return;
    }
    t3.endColumn === s2.startColumn - 1 ? t3.endColumn = s2.endColumn : (e.push(t3), t3 = s2);
  }), e.push(t3), e;
}
var ni = {
  id: "sheet.command.set-defined-name",
  type: Ls.COMMAND,
  handler: (n3, e) => {
    var d2, h9;
    const t3 = n3.get(Ds), s2 = n3.get(ra), o3 = n3.get(G);
    if (!e) return false;
    const r = __spreadValues({}, e), i = Fb(n3, e), a4 = o3.onCommandExecute({ id: ni.id, params: e }), u2 = [
      ...(d2 = a4.preRedos) != null ? d2 : [],
      { id: Vo2.id, params: i },
      { id: _a2.id, params: r },
      ...a4.redos
    ], l4 = [
      ...(h9 = a4.preUndos) != null ? h9 : [],
      { id: Vo2.id, params: r },
      { id: _a2.id, params: i },
      ...a4.undos
    ];
    return po(u2, t3) ? (s2.pushUndoRedo({
      unitID: e.unitId,
      undoMutations: l4.filter(Boolean),
      redoMutations: u2.filter(Boolean)
    }), true) : false;
  }
};
var si = (n3, e) => {
  const s2 = n3.get(br).getUniverSheetInstance(e.unitId);
  if (s2 == null)
    throw new Error("universheet is null error!");
  const o3 = s2.getSheetBySheetId(e.subUnitId);
  if (o3 == null)
    throw new Error("worksheet is null error!");
  const i = o3.getConfig().freeze;
  return __spreadValues({
    unitId: e.unitId,
    subUnitId: e.subUnitId
  }, i);
};
var st2 = {
  id: "sheet.mutation.set-frozen",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const s2 = n3.get(br).getUniverSheetInstance(e.unitId);
    if (s2 == null)
      throw new Error("universheet is null error!");
    const o3 = s2.getSheetBySheetId(e.subUnitId);
    if (!o3) return false;
    const r = o3.getConfig(), { startRow: i, startColumn: a4, ySplit: u2, xSplit: l4 } = e;
    return r.freeze = { startRow: i, startColumn: a4, ySplit: u2, xSplit: l4 }, true;
  }
};
var xc = {
  type: Ls.COMMAND,
  id: "sheet.command.set-frozen",
  handler: (n3, e) => {
    const t3 = n3.get(Ds), s2 = n3.get(ra), o3 = n3.get(br), r = P5(o3, { unitId: e.unitId, subUnitId: e.subUnitId });
    if (!r) return false;
    const { unitId: i, subUnitId: a4, worksheet: u2 } = r, { startColumn: l4, startRow: c2, xSplit: d2, ySplit: h9 } = e;
    if (c2 >= u2.getRowCount() || l4 >= u2.getColumnCount() || d2 >= u2.getColumnCount() || h9 >= u2.getRowCount())
      return false;
    const g9 = __spreadValues({
      unitId: i,
      subUnitId: a4
    }, e), m9 = si(n3, g9);
    return t3.syncExecuteCommand(st2.id, g9) ? (s2.pushUndoRedo({
      unitID: i,
      undoMutations: [{ id: st2.id, params: m9 }],
      redoMutations: [{ id: st2.id, params: g9 }]
    }), true) : false;
  }
};
var $c = {
  type: Ls.COMMAND,
  id: "sheet.command.cancel-frozen",
  handler: (n3, e) => {
    const t3 = n3.get(Ds), s2 = n3.get(br), o3 = n3.get(ra), r = P5(s2, { unitId: e == null ? void 0 : e.unitId, subUnitId: e == null ? void 0 : e.subUnitId });
    if (!r) return false;
    const { unitId: i, subUnitId: a4 } = r, u2 = {
      unitId: i,
      subUnitId: a4,
      startRow: -1,
      startColumn: -1,
      xSplit: 0,
      ySplit: 0
    }, l4 = si(n3, u2);
    return t3.syncExecuteCommand(st2.id, u2) && o3.pushUndoRedo({
      unitID: i,
      undoMutations: [{ id: st2.id, params: l4 }],
      redoMutations: [{ id: st2.id, params: u2 }]
    }), true;
  }
};
var Wc = {
  type: Ls.COMMAND,
  id: "sheet.command.set-gridlines-color",
  handler: (n3, e) => {
    const t3 = n3.get(Ds), s2 = n3.get(ra), o3 = n3.get(br), r = P5(o3);
    if (!r) return false;
    const { worksheet: i } = r, a4 = i.getConfig().gridlinesColor;
    if (a4 === (e == null ? void 0 : e.color)) return false;
    const { unitId: u2, subUnitId: l4 } = r, c2 = {
      color: e == null ? void 0 : e.color,
      unitId: u2,
      subUnitId: l4
    }, d2 = {
      color: a4,
      unitId: u2,
      subUnitId: l4
    };
    return t3.syncExecuteCommand(Gt.id, c2) ? (s2.pushUndoRedo({
      unitID: u2,
      undoMutations: [{ id: Gt.id, params: d2 }],
      redoMutations: [{ id: Gt.id, params: c2 }]
    }), true) : false;
  }
};
var fe3 = {
  id: "sheet.mutation.set-range-protection",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const { unitId: t3, subUnitId: s2, rule: o3, ruleId: r } = e;
    return n3.get(me).setRule(t3, s2, r, o3), true;
  }
};
var eg = (n3, e) => {
  const { unitId: t3, subUnitId: s2, ruleId: o3 } = e, i = n3.get(me).getRule(t3, s2, o3);
  return i ? {
    id: fe3.id,
    params: __spreadProps(__spreadValues({}, e), {
      rule: i
    })
  } : null;
};
var bt2 = {
  id: "sheet.mutation.set-worksheet-protection",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const { unitId: t3, subUnitId: s2, rule: o3 } = e;
    return n3.get(lt3).setRule(t3, s2, o3), true;
  }
};
var Vc2 = {
  type: Ls.COMMAND,
  id: "sheet.command.set-protection",
  handler(n3, e) {
    return __async(this, null, function* () {
      if (!e)
        return false;
      const t3 = n3.get(Ds), s2 = n3.get(ra), o3 = n3.get(me), { rule: r, oldRule: i } = e, { unitId: a4, subUnitId: u2 } = r, l4 = [], c2 = [];
      return (i == null ? void 0 : i.unitType) === r.unitType ? r.unitType === x4.Worksheet ? (l4.push({ id: bt2.id, params: { unitId: a4, subUnitId: u2, rule: r } }), c2.push({ id: bt2.id, params: { unitId: a4, subUnitId: u2, rule: i } })) : (l4.push({ id: fe3.id, params: { unitId: a4, subUnitId: u2, rule: r, ruleId: r.id } }), c2.push({ id: fe3.id, params: { unitId: a4, subUnitId: u2, ruleId: i.id, rule: i } })) : (i && (i.unitType === x4.Worksheet ? (l4.push({ id: xt.id, params: { unitId: a4, subUnitId: u2 } }), c2.push({ id: Mt2.id, params: { unitId: a4, rule: i, subUnitId: i.subUnitId } })) : i.unitType === x4.SelectRange && (l4.push({ id: ot2.id, params: { unitId: a4, subUnitId: u2, ruleIds: [i.id] } }), c2.push({ id: Be3.id, params: { unitId: a4, subUnitId: u2, rules: [i] } }))), r.unitType === x4.Worksheet ? (l4.push({ id: Mt2.id, params: { unitId: a4, rule: r, subUnitId: r.subUnitId } }), c2.unshift({ id: xt.id, params: { unitId: a4, subUnitId: u2 } })) : r.unitType === x4.SelectRange && (r.id = o3.createRuleId(a4, u2), l4.push({ id: Be3.id, params: { unitId: a4, subUnitId: u2, rules: [r] } }), c2.unshift({ id: ot2.id, params: { unitId: a4, subUnitId: u2, ruleIds: [r.id] } }))), po(l4, t3) && s2.pushUndoRedo({
        unitID: a4,
        undoMutations: c2,
        redoMutations: l4
      }), true;
    });
  }
};
var Lc = {
  type: Ls.COMMAND,
  id: "sheet.command.set-row-data",
  handler: (n3, e) => {
    const t3 = n3.get(Ds), s2 = n3.get(ra), o3 = n3.get(br), r = P5(o3, e);
    if (!r) return false;
    const { rowData: i } = e, { unitId: a4, subUnitId: u2, worksheet: l4 } = r, c2 = {
      subUnitId: u2,
      unitId: a4,
      rowData: i
    }, d2 = ru2(c2, l4);
    return t3.syncExecuteCommand(Kt2.id, c2) ? (s2.pushUndoRedo({
      unitID: a4,
      undoMutations: [{ id: Kt2.id, params: d2 }],
      redoMutations: [{ id: Kt2.id, params: c2 }]
    }), true) : false;
  }
};
var hn = {
  type: Ls.COMMAND,
  id: "sheet.command.set-specific-rows-visible",
  handler: (n3, e) => {
    var p3, w6, S;
    const { unitId: t3, subUnitId: s2, ranges: o3 } = e, r = n3.get(Ds), i = n3.get(ra), a4 = n3.get(G), u2 = P5(n3.get(br), { unitId: t3, subUnitId: s2 });
    if (!u2) return false;
    const { worksheet: l4 } = u2, c2 = { unitId: t3, subUnitId: s2, ranges: o3 }, d2 = {
      unitId: t3,
      subUnitId: s2,
      reveal: true,
      selections: o3.map((I6) => ({
        range: I6,
        primary: _e3(I6, l4),
        style: null
      }))
    }, h9 = iu(n3, c2), g9 = {
      unitId: t3,
      subUnitId: s2,
      selections: ri(o3).map((I6) => ({
        range: I6,
        primary: _e3(I6, l4),
        style: null
      }))
    }, m9 = po(
      [
        { id: Ut2.id, params: c2 },
        { id: ie5.id, params: d2 }
      ],
      r
    ), f4 = a4.onCommandExecute({
      id: hn.id,
      params: e
    }), C = po([...f4.redos], r);
    if (m9.result && C.result) {
      const I6 = a4.afterCommandExecute({
        id: hn.id,
        params: e
      });
      return po(I6.redos, r), i.pushUndoRedo({
        unitID: t3,
        undoMutations: [
          ...(p3 = f4.preUndos) != null ? p3 : [],
          { id: Tt.id, params: h9 },
          { id: ie5.id, params: g9 },
          ...(w6 = f4.undos) != null ? w6 : [],
          ...I6.undos
        ],
        redoMutations: [
          ...(S = f4.preRedos) != null ? S : [],
          { id: Ut2.id, params: c2 },
          { id: ie5.id, params: d2 },
          ...f4.redos,
          ...I6.redos
        ]
      }), true;
    }
    return true;
  }
};
var oi = {
  type: Ls.COMMAND,
  id: "sheet.command.set-selected-rows-visible",
  handler: (n3) => __async(void 0, null, function* () {
    var c2;
    const e = n3.get(z), t3 = n3.get(br), s2 = n3.get(Ds), o3 = (c2 = e.getCurrentSelections()) == null ? void 0 : c2.map((d2) => d2.range).filter((d2) => d2.rangeType === ge.ROW);
    if (!(o3 != null && o3.length)) return false;
    const r = P5(t3);
    if (!r) return false;
    const { worksheet: i, unitId: a4, subUnitId: u2 } = r, l4 = o3.map((d2) => i.getHiddenRows(d2.startRow, d2.endRow)).flat();
    return s2.executeCommand(hn.id, {
      unitId: a4,
      subUnitId: u2,
      ranges: l4
    });
  })
};
var Ts3 = {
  type: Ls.COMMAND,
  id: "sheet.command.set-rows-hidden",
  handler: (n3, e) => {
    var w6, S, I6, y6, b4, N6;
    const t3 = n3.get(z), s2 = n3.get(Ds), o3 = n3.get(ra), r = n3.get(br), i = n3.get(G);
    let a4 = (w6 = e == null ? void 0 : e.ranges) != null && w6.length ? e.ranges : (S = t3.getCurrentSelections()) == null ? void 0 : S.map((U3) => U3.range).filter((U3) => U3.rangeType === ge.ROW);
    if (!(a4 != null && a4.length)) return false;
    const u2 = P5(r, e);
    if (!u2) return false;
    a4 = Hc(u2.worksheet, a4);
    const { unitId: l4, subUnitId: c2, worksheet: d2 } = u2, h9 = { unitId: l4, subUnitId: c2, ranges: a4 }, g9 = {
      unitId: l4,
      subUnitId: c2,
      selections: ri(a4).map((U3) => ({
        range: U3,
        primary: _e3(U3, d2),
        style: null
      }))
    }, m9 = au(n3, h9), f4 = {
      unitId: l4,
      subUnitId: c2,
      reveal: true,
      selections: a4.map((U3) => ({
        range: U3,
        primary: _e3(U3, d2),
        style: null
      }))
    }, C = i.onCommandExecute({ id: Ts3.id, params: h9 });
    if (po([
      ...(I6 = C.preRedos) != null ? I6 : [],
      { id: Tt.id, params: h9 },
      { id: ie5.id, params: g9 },
      ...C.redos
    ], s2).result) {
      const U3 = i.afterCommandExecute({
        id: Ts3.id,
        params: h9
      });
      return po(U3.redos, s2), o3.pushUndoRedo({
        unitID: l4,
        undoMutations: [
          ...(y6 = C.preUndos) != null ? y6 : [],
          { id: Ut2.id, params: m9 },
          { id: ie5.id, params: f4 },
          ...(b4 = C.undos) != null ? b4 : [],
          ...U3.undos
        ],
        redoMutations: [
          ...(N6 = C.preRedos) != null ? N6 : [],
          { id: Tt.id, params: h9 },
          { id: ie5.id, params: g9 },
          ...C.redos,
          ...U3.redos
        ]
      }), true;
    }
    return true;
  }
};
function Hc(n3, e) {
  const t3 = n3.getMaxColumns() - 1, s2 = n3.getHiddenRows(), o3 = [];
  return e.forEach((r) => {
    const i = s2.filter((a4) => a4.startRow >= r.startRow && a4.endRow <= r.endRow);
    if (i.length) {
      let a4 = r.startRow;
      i.forEach((u2) => {
        u2.startRow > a4 && (o3.push({ startRow: a4, endRow: u2.startRow - 1, startColumn: 0, endColumn: t3 }), a4 = u2.endRow + 1);
      }), a4 <= r.endRow && o3.push({ startRow: a4, endRow: r.endRow, startColumn: 0, endColumn: t3 });
    } else
      o3.push(r);
  }), o3;
}
function ri(n3) {
  return Fc(n3).map((t3) => {
    const s2 = t3.startRow === 0 ? t3.endRow + 1 : t3.startRow - 1;
    return __spreadProps(__spreadValues({}, t3), {
      startRow: s2,
      endRow: s2
    });
  });
}
function Fc(n3) {
  const e = [];
  let t3;
  return n3.sort((s2, o3) => s2.startRow - o3.startRow).forEach((s2) => {
    if (!t3) {
      t3 = s2;
      return;
    }
    s2.startRow === t3.endRow + 1 ? t3.endRow = s2.endRow : (e.push(t3), t3 = s2);
  }), e.push(t3), e;
}
var Bc = ["ff", "fs", "tr", "tb"];
var Ce = {
  type: Ls.COMMAND,
  id: "sheet.command.set-style",
  // eslint-disable-next-line max-lines-per-function
  handler: (n3, e) => {
    var T10;
    const t3 = n3.get(br), s2 = P5(t3, e);
    if (!s2) return false;
    const { unitId: o3, subUnitId: r, worksheet: i } = s2, { range: a4, style: u2 } = e, l4 = n3.get(Ds), c2 = n3.get(ra), d2 = n3.get(z), h9 = a4 ? [a4] : (T10 = d2.getCurrentSelections()) == null ? void 0 : T10.map((k6) => k6.range);
    if (!(h9 != null && h9.length))
      return false;
    const g9 = new ht(), m9 = Bu2(i);
    if (Z.isArray(u2.value))
      for (let k6 = 0; k6 < h9.length; k6++)
        m9.forOperableEach(h9[k6], (D5, H6, F7) => {
          g9.setValue(D5, H6, {
            s: {
              [u2.type]: u2.value[D5 - F7.startRow][H6 - F7.startColumn]
            }
          });
        });
    else
      for (let k6 = 0; k6 < h9.length; k6++) {
        const D5 = {
          s: {
            [u2.type]: u2.value
          }
        };
        m9.forOperableEach(h9[k6], (H6, F7) => g9.setValue(H6, F7, D5));
      }
    const f4 = {
      subUnitId: r,
      unitId: o3,
      cellValue: g9.getMatrix()
    }, C = n3.get(rt3).getSkeleton(o3, r), p3 = Ae4(
      n3,
      f4
    ), w6 = l4.syncExecuteCommand(
      ee2.id,
      f4
    ), S = n3.get(G);
    let I6 = [], y6 = [];
    if (Bc.includes(e == null ? void 0 : e.style.type)) {
      const { suitableRanges: k6, remainingRanges: D5 } = wn(h9, C), H6 = qs(k6, i), { undos: F7, redos: K5 } = S.generateMutationsOfAutoHeight({
        unitId: o3,
        subUnitId: r,
        ranges: k6,
        autoHeightRanges: k6,
        lazyAutoHeightRanges: D5,
        cellHeights: H6
      });
      I6 = F7, y6 = K5;
    }
    const { undos: b4, redos: N6 } = S.onCommandExecute({
      id: Ce.id,
      params: e
    }), U3 = po([...N6, ...y6], l4);
    return w6 && U3.result ? (c2.pushUndoRedo({
      unitID: f4.unitId,
      undoMutations: [{ id: ee2.id, params: p3 }, ...b4, ...I6],
      redoMutations: [{ id: ee2.id, params: f4 }, ...N6, ...y6]
    }), true) : false;
  }
};
var tg = {
  type: Ls.COMMAND,
  id: "sheet.command.set-bold",
  handler: (n3) => {
    const e = n3.get(z).getCurrentLastSelection();
    if (!e) return false;
    const t3 = P5(n3.get(br));
    if (!t3) return false;
    const { worksheet: s2 } = t3, { actualRow: o3, actualColumn: r } = e.primary, a4 = {
      style: {
        type: "bl",
        value: s2.getRange(o3, r).getFontWeight() === bi.BOLD ? ie.FALSE : ie.TRUE
      }
    };
    return n3.get(Ds).syncExecuteCommand(Ce.id, a4);
  }
};
var ng = {
  type: Ls.COMMAND,
  id: "sheet.command.set-italic",
  handler: (n3) => {
    const e = n3.get(z).getCurrentLastSelection();
    if (!e) return false;
    const t3 = P5(n3.get(br));
    if (!t3) return false;
    const { worksheet: s2 } = t3;
    let o3 = true;
    if (e.primary) {
      const { startRow: i, startColumn: a4 } = e.primary;
      o3 = s2.getRange(i, a4).getFontStyle() === vi.ITALIC;
    }
    const r = {
      style: {
        type: "it",
        value: o3 ? ie.FALSE : ie.TRUE
      }
    };
    return n3.get(Ds).syncExecuteCommand(Ce.id, r);
  }
};
var sg = {
  type: Ls.COMMAND,
  id: "sheet.command.set-underline",
  handler: (n3) => {
    const e = n3.get(z).getCurrentLastSelection();
    if (!e) return false;
    const t3 = P5(n3.get(br));
    if (!t3) return false;
    const { worksheet: s2 } = t3;
    let o3 = true;
    e.primary && (o3 = !!s2.getRange(e.primary.startRow, e.primary.startColumn).getUnderline().s);
    const r = {
      style: {
        type: "ul",
        value: {
          s: o3 ? ie.FALSE : ie.TRUE
        }
      }
    };
    return n3.get(Ds).syncExecuteCommand(Ce.id, r);
  }
};
var og = {
  type: Ls.COMMAND,
  id: "sheet.command.set-stroke",
  handler: (n3) => {
    const e = n3.get(z).getCurrentLastSelection();
    if (!e) return false;
    const t3 = P5(n3.get(br));
    if (!t3) return false;
    const { worksheet: s2 } = t3;
    let o3 = true;
    e.primary && (o3 = !!s2.getRange(e.primary.actualRow, e.primary.actualColumn).getStrikeThrough().s);
    const r = {
      style: {
        type: "st",
        value: { s: o3 ? ie.FALSE : ie.TRUE }
      }
    };
    return n3.get(Ds).syncExecuteCommand(Ce.id, r);
  }
};
var rg = {
  type: Ls.COMMAND,
  id: "sheet.command.set-overline",
  handler: (n3) => {
    const e = n3.get(z).getCurrentLastSelection();
    if (!e) return false;
    const t3 = P5(n3.get(br));
    if (!t3) return false;
    const { worksheet: s2 } = t3;
    let o3 = true;
    e.primary && (o3 = !!s2.getRange(e.primary.startRow, e.primary.startColumn).getOverline().s);
    const r = {
      style: {
        type: "ol",
        value: {
          s: o3 ? ie.FALSE : ie.TRUE
        }
      }
    };
    return n3.get(Ds).syncExecuteCommand(Ce.id, r);
  }
};
var ig2 = {
  type: Ls.COMMAND,
  id: "sheet.command.set-font-family",
  handler: (n3, e) => {
    if (!e)
      return false;
    const t3 = n3.get(Ds), s2 = {
      style: {
        type: "ff",
        value: e.value
      }
    };
    return t3.syncExecuteCommand(Ce.id, s2);
  }
};
var ag = {
  type: Ls.COMMAND,
  id: "sheet.command.set-font-size",
  handler: (n3, e) => {
    if (!e)
      return false;
    const t3 = n3.get(Ds), s2 = {
      style: {
        type: "fs",
        value: e.value
      }
    };
    return t3.syncExecuteCommand(Ce.id, s2);
  }
};
var jc = {
  type: Ls.COMMAND,
  id: "sheet.command.set-text-color",
  handler: (n3, e) => {
    if (!e)
      return false;
    const t3 = n3.get(Ds), s2 = {
      style: {
        type: "cl",
        value: {
          rgb: e.value
        }
      }
    };
    return t3.syncExecuteCommand(Ce.id, s2);
  }
};
var zc2 = {
  type: Ls.COMMAND,
  id: "sheet.command.reset-text-color",
  handler: (n3) => {
    const e = n3.get(Ds), t3 = {
      style: {
        type: "cl",
        value: {
          rgb: null
          // use null to reset text color
        }
      }
    };
    return e.syncExecuteCommand(Ce.id, t3);
  }
};
var Gc = {
  type: Ls.COMMAND,
  id: "sheet.command.set-background-color",
  handler: (n3, e) => {
    if (!e || !e.value)
      return false;
    const t3 = n3.get(Ds), s2 = {
      style: {
        type: "bg",
        value: {
          rgb: e.value
        }
      }
    };
    return t3.syncExecuteCommand(Ce.id, s2);
  }
};
var Kc3 = {
  type: Ls.COMMAND,
  id: "sheet.command.reset-background-color",
  handler: (n3) => {
    const e = n3.get(Ds), t3 = {
      style: {
        type: "bg",
        value: {
          rgb: null
          // use null to reset background color
        }
      }
    };
    return e.syncExecuteCommand(Ce.id, t3);
  }
};
var Jc2 = {
  type: Ls.COMMAND,
  id: "sheet.command.set-vertical-text-align",
  handler: (n3, e) => {
    if (!e)
      return false;
    const t3 = n3.get(Ds), s2 = {
      unitId: e.unitId,
      subUnitId: e.subUnitId,
      range: e.range,
      style: {
        type: "vt",
        value: e.value
      }
    };
    return t3.syncExecuteCommand(Ce.id, s2);
  }
};
var qc2 = {
  type: Ls.COMMAND,
  id: "sheet.command.set-horizontal-text-align",
  handler: (n3, e) => {
    if (!e)
      return false;
    const t3 = n3.get(Ds), s2 = {
      unitId: e.unitId,
      subUnitId: e.subUnitId,
      range: e.range,
      style: {
        type: "ht",
        value: e.value
      }
    };
    return t3.syncExecuteCommand(Ce.id, s2);
  }
};
var Yc2 = {
  type: Ls.COMMAND,
  id: "sheet.command.set-text-wrap",
  handler: (n3, e) => {
    if (!e)
      return false;
    const t3 = n3.get(Ds), s2 = {
      unitId: e.unitId,
      subUnitId: e.subUnitId,
      range: e.range,
      style: {
        type: "tb",
        value: e.value
      }
    };
    return t3.syncExecuteCommand(Ce.id, s2);
  }
};
var Xc2 = {
  type: Ls.COMMAND,
  id: "sheet.command.set-text-rotation",
  handler: (n3, e) => {
    if (!e)
      return false;
    const t3 = typeof e.value == "number" ? { a: e.value } : { a: 0, v: ie.TRUE }, s2 = n3.get(Ds), o3 = {
      unitId: e.unitId,
      subUnitId: e.subUnitId,
      range: e.range,
      style: {
        type: "tr",
        value: t3
      }
    };
    return s2.syncExecuteCommand(Ce.id, o3);
  }
};
var Zc = (n3, e) => {
  const r = n3.get(br).getUniverSheetInstance(e.unitId).getSheetBySheetId(e.subUnitId).getConfig().tabColor;
  return __spreadProps(__spreadValues({}, Z.deepClone(e)), {
    color: r
  });
};
var Un4 = {
  id: "sheet.mutation.set-tab-color",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const t3 = n3.get(br).getUniverSheetInstance(e.unitId);
    if (!t3) return false;
    const s2 = t3.getSheetBySheetId(e.subUnitId);
    return s2 ? (s2.getConfig().tabColor = e.color, true) : false;
  }
};
var Qc = {
  type: Ls.COMMAND,
  id: "sheet.command.set-tab-color",
  handler: (n3, e) => {
    const t3 = n3.get(Ds), s2 = n3.get(ra), o3 = P5(n3.get(br));
    if (!o3) return false;
    const { unitId: r, subUnitId: i } = o3, a4 = {
      color: e.value,
      unitId: r,
      subUnitId: i
    }, u2 = Zc(n3, a4);
    return t3.syncExecuteCommand(Un4.id, a4) ? (s2.pushUndoRedo({
      unitID: r,
      undoMutations: [{ id: Un4.id, params: u2 }],
      redoMutations: [{ id: Un4.id, params: a4 }]
    }), true) : false;
  }
};
var ii = {
  id: "sheet.mutation.set-workbook-name",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const t3 = n3.get(br).getUnit(e.unitId, we.UNIVER_SHEET);
    return t3 ? (t3.setName(e.name), true) : false;
  }
};
var ai = {
  type: Ls.COMMAND,
  id: "sheet.command.set-workbook-name",
  handler: (n3, e) => {
    var u2;
    const t3 = n3.get(Ds), s2 = n3.get(G);
    if (!Yo(n3.get(br), e)) return false;
    const r = s2.onCommandExecute({
      id: ai.id,
      params: e
    }), i = {
      name: e.name,
      unitId: e.unitId
    }, a4 = [
      ...(u2 = r.preRedos) != null ? u2 : [],
      { id: ii.id, params: i },
      ...r.redos
    ];
    return po(a4, t3).result;
  }
};
var ed = 4;
var ui = {
  type: Ls.COMMAND,
  id: "sheet.command.set-worksheet-activate",
  handler: (n3, e, t3) => {
    const s2 = n3.get(Ds), o3 = P5(n3.get(br), e);
    if (!o3) return false;
    const { unitId: r, subUnitId: i } = o3;
    return new Promise((a4) => {
      setTimeout(() => {
        const u2 = s2.syncExecuteCommand(pn.id, {
          unitId: r,
          subUnitId: i
        }, t3);
        a4(u2);
      }, ed);
    });
  }
};
var Fn4 = {
  type: Ls.COMMAND,
  id: "sheet.command.delta-column-width",
  // eslint-disable-next-line max-lines-per-function
  handler: (n3, e) => __async(void 0, null, function* () {
    const s2 = n3.get(z).getCurrentSelections();
    if (!(s2 != null && s2.length))
      return false;
    const o3 = n3.get(Ds), r = n3.get(ra), i = P5(n3.get(br));
    if (!i) return false;
    const { worksheet: a4, unitId: u2, subUnitId: l4 } = i, { anchorCol: c2, deltaX: d2 } = e, g9 = a4.getColumnWidth(c2) + d2, m9 = s2.length === 1 && s2[0].range.rangeType === ge.ALL, f4 = s2.filter((J6) => J6.range.rangeType === ge.COLUMN), C = m9 ? ge.ALL : f4.some(({ range: J6 }) => {
      const { startColumn: ae5, endColumn: oe5 } = J6;
      return ae5 <= c2 && c2 <= oe5;
    }) ? ge.COLUMN : ge.NORMAL;
    let p3;
    if (C === ge.ALL) {
      const J6 = a4.getRowCount(), ae5 = new Array(a4.getColumnCount()).fill(void 0).map(
        (oe5, le3) => ({ startRow: 0, endRow: J6 - 1, startColumn: le3, endColumn: le3 })
      );
      p3 = {
        subUnitId: l4,
        unitId: u2,
        colWidth: g9,
        ranges: ae5
      };
    } else C === ge.COLUMN ? p3 = {
      subUnitId: l4,
      unitId: u2,
      ranges: f4.map((J6) => Cn.clone(J6.range)),
      colWidth: g9
    } : p3 = {
      subUnitId: l4,
      unitId: u2,
      colWidth: g9,
      ranges: [
        {
          startRow: 0,
          endRow: a4.getMaxRows() - 1,
          startColumn: c2,
          endColumn: c2
        }
      ]
    };
    const w6 = n3.get(rt3).getSkeleton(u2, l4), { suitableRanges: S, remainingRanges: I6 } = wn(p3.ranges, w6);
    qs(S, a4);
    const y6 = n3.get(G), { undos: b4, redos: N6 } = y6.onCommandExecute({
      id: Fn4.id,
      params: p3
    }), U3 = Zo(
      p3,
      a4
    ), T10 = o3.syncExecuteCommand(
      mt2.id,
      p3
    ), { undos: k6, redos: D5 } = y6.generateMutationsOfAutoHeight({
      unitId: u2,
      subUnitId: l4,
      ranges: S,
      autoHeightRanges: S,
      lazyAutoHeightRanges: I6
    }), { undos: H6, redos: F7 } = n3.get(G).afterCommandExecute({
      id: Fn4.id,
      params: p3
    }), K5 = po([...N6, ...F7, ...D5], o3);
    return T10 && K5.result && r.pushUndoRedo({
      unitID: u2,
      undoMutations: [{ id: mt2.id, params: U3 }, ...b4, ...H6, ...k6],
      redoMutations: [{ id: mt2.id, params: p3 }, ...N6, ...F7, ...D5]
    }), true;
  })
};
var Bn4 = {
  type: Ls.COMMAND,
  id: "sheet.command.set-worksheet-col-width",
  handler: (n3, e) => {
    var y6, b4, N6, U3;
    const t3 = n3.get(z), s2 = n3.get(Ds), o3 = n3.get(ra), r = n3.get(G), i = (y6 = e == null ? void 0 : e.ranges) != null && y6.length ? e.ranges : (b4 = t3.getCurrentSelections()) == null ? void 0 : b4.map((T10) => T10.range);
    if (!(i != null && i.length)) return false;
    const a4 = P5(n3.get(br), e);
    if (!a4) return false;
    const { subUnitId: u2, unitId: l4, worksheet: c2 } = a4, d2 = n3.get(rt3).getSkeleton(l4, u2), h9 = {
      subUnitId: u2,
      unitId: l4,
      ranges: i,
      colWidth: e.value
    }, { suitableRanges: g9, remainingRanges: m9 } = wn(h9.ranges, d2);
    qs(g9, c2);
    const f4 = Zo(h9, c2), C = s2.syncExecuteCommand(mt2.id, h9), { undos: p3, redos: w6 } = r.generateMutationsOfAutoHeight({
      unitId: l4,
      subUnitId: u2,
      ranges: g9,
      autoHeightRanges: g9,
      lazyAutoHeightRanges: m9
    }), S = r.onCommandExecute({
      id: Bn4.id,
      params: h9
    }), I6 = po([...S.redos, ...w6], s2);
    if (C && I6.result) {
      const T10 = r.afterCommandExecute({
        id: Bn4.id,
        params: h9
      });
      return po(T10.redos, s2), o3.pushUndoRedo({
        unitID: l4,
        undoMutations: [
          ...(N6 = S.preUndos) != null ? N6 : [],
          { id: mt2.id, params: f4 },
          ...S.undos,
          ...T10.undos,
          ...p3
        ],
        redoMutations: [
          ...(U3 = S.preRedos) != null ? U3 : [],
          { id: mt2.id, params: h9 },
          ...S.redos,
          ...T10.redos,
          ...w6
        ]
      }), true;
    }
    return false;
  }
};
Ls.COMMAND;
var td = {
  type: Ls.COMMAND,
  id: "sheet.command.set-worksheet-column-count",
  handler: (n3, e) => {
    const { unitId: t3, subUnitId: s2, columnCount: o3 } = e, r = n3.get(Ds), i = n3.get(ra), a4 = n3.get(br);
    if (!P5(a4, e)) return false;
    const l4 = {
      unitId: t3,
      subUnitId: s2,
      columnCount: o3
    }, c2 = uu(n3, l4);
    return r.syncExecuteCommand(Jt2.id, l4) ? (i.pushUndoRedo({
      unitID: t3,
      undoMutations: [{ id: Jt2.id, params: c2 }],
      redoMutations: [{ id: Jt2.id, params: l4 }]
    }), true) : false;
  }
};
var nd2 = {
  type: Ls.COMMAND,
  id: "sheet.command.set-worksheet-default-style",
  handler: (n3, e) => {
    const t3 = n3.get(Ds), s2 = n3.get(ra), { unitId: o3 } = e, r = lu(n3, e);
    return t3.syncExecuteCommand(qt.id, e) ? (s2.pushUndoRedo({
      unitID: o3,
      undoMutations: [{ id: qt.id, params: r }],
      redoMutations: [{ id: qt.id, params: e }]
    }), true) : false;
  }
};
var li = (n3, e) => {
  const t3 = Qe2(n3.get(br), e);
  if (!t3)
    throw new Error("[SetWorksheetHideMutationFactory]: worksheet is null error!");
  const { worksheet: s2 } = t3;
  return {
    hidden: s2.isSheetHidden(),
    unitId: e.unitId,
    subUnitId: s2.getSheetId()
  };
};
var St2 = {
  id: "sheet.mutation.set-worksheet-hidden",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const t3 = n3.get(br).getUniverSheetInstance(e.unitId);
    if (t3 == null)
      return false;
    const s2 = t3.getSheetBySheetId(e.subUnitId);
    return s2 ? (s2.getConfig().hidden = e.hidden, true) : false;
  }
};
var sd2 = {
  type: Ls.COMMAND,
  id: "sheet.command.set-worksheet-hidden",
  handler: (n3, e) => {
    const t3 = n3.get(Ds), s2 = n3.get(ra), o3 = n3.get(CE), r = n3.get(Hn), i = P5(n3.get(br), e);
    if (!i) return false;
    const { workbook: a4, worksheet: u2, unitId: l4, subUnitId: c2 } = i;
    if (u2.getConfig().hidden === ie.TRUE) return false;
    const h9 = {
      unitId: l4,
      subUnitId: c2,
      hidden: ie.TRUE
    }, g9 = li(n3, h9);
    return a4.getSheets().filter((p3) => p3.getConfig().hidden === ie.FALSE).length === 1 ? (o3.emit(r.t("sheets.info.hideSheet")), false) : t3.syncExecuteCommand(St2.id, h9) ? (s2.pushUndoRedo({
      unitID: l4,
      undoMutations: [{ id: St2.id, params: g9 }],
      redoMutations: [{ id: St2.id, params: h9 }]
    }), true) : false;
  }
};
var od2 = (n3, e) => {
  const t3 = Qe2(n3.get(br), e);
  if (!t3)
    throw new Error("[SetWorksheetNameMutationFactory]: worksheet is null error!");
  const { worksheet: s2 } = t3;
  return {
    unitId: e.unitId,
    name: s2.getName(),
    subUnitId: s2.getSheetId()
  };
};
var jn3 = {
  id: "sheet.mutation.set-worksheet-name",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const t3 = n3.get(br).getUniverSheetInstance(e.unitId);
    if (t3 == null)
      return false;
    const s2 = t3.getSheetBySheetId(e.subUnitId);
    return s2 ? (s2.getConfig().name = e.name, true) : false;
  }
};
var eo2 = {
  type: Ls.COMMAND,
  id: "sheet.command.set-worksheet-name",
  handler: (n3, e) => {
    var m9, f4;
    const t3 = n3.get(Ds), s2 = n3.get(ra), o3 = n3.get(G), r = P5(n3.get(br), e);
    if (!r) return false;
    const { unitId: i, subUnitId: a4 } = r, u2 = {
      subUnitId: a4,
      name: e.name,
      unitId: i
    }, l4 = od2(
      n3,
      u2
    ), c2 = o3.onCommandExecute({
      id: eo2.id,
      params: e
    }), d2 = [
      ...(m9 = c2.preRedos) != null ? m9 : [],
      { id: jn3.id, params: u2 },
      ...c2.redos
    ], h9 = [
      ...(f4 = c2.preUndos) != null ? f4 : [],
      { id: jn3.id, params: l4 },
      ...c2.undos
    ];
    return po(d2, t3).result ? (s2.pushUndoRedo({
      unitID: i,
      undoMutations: h9,
      redoMutations: d2
    }), true) : false;
  }
};
var rd2 = (n3, e) => __spreadProps(__spreadValues({}, Z.deepClone(e)), {
  toOrder: e.fromOrder,
  fromOrder: e.toOrder
});
var Tn2 = {
  id: "sheet.mutation.set-worksheet-order",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const t3 = n3.get(br).getUniverSheetInstance(e.unitId);
    if (!t3) return false;
    const s2 = t3.getConfig();
    return s2.sheetOrder.splice(e.fromOrder, 1), s2.sheetOrder.splice(e.toOrder, 0, e.subUnitId), true;
  }
};
var ci = {
  type: Ls.COMMAND,
  id: "sheet.command.set-worksheet-order",
  handler: (n3, e) => {
    const t3 = n3.get(Ds), s2 = n3.get(ra), o3 = P5(n3.get(br), e);
    if (!o3) return false;
    const { workbook: r, unitId: i, subUnitId: a4 } = o3, l4 = {
      fromOrder: r.getConfig().sheetOrder.indexOf(a4),
      toOrder: e.order,
      unitId: i,
      subUnitId: a4
    }, c2 = rd2(n3, l4);
    return t3.syncExecuteCommand(Tn2.id, l4) ? (s2.pushUndoRedo({
      unitID: i,
      undoMutations: [{ id: Tn2.id, params: c2 }],
      redoMutations: [{ id: Tn2.id, params: l4 }]
    }), true) : false;
  }
};
var vn2 = class {
  constructor() {
    R(this, "_model", /* @__PURE__ */ new Map());
    R(this, "_pointChange", new Subject());
    R(this, "pointChange$", this._pointChange.asObservable());
  }
  addRule(e) {
    this._ensureSubUnitMap(e.unitId).set(e.subUnitId, e), this._pointChange.next(e);
  }
  deleteRule(e, t3) {
    var o3, r, i;
    const s2 = (o3 = this._model.get(e)) == null ? void 0 : o3.get(t3);
    s2 && ((i = (r = this._model) == null ? void 0 : r.get(e)) == null || i.delete(t3), this._pointChange.next(s2));
  }
  getRule(e, t3) {
    var s2, o3;
    return (o3 = (s2 = this._model) == null ? void 0 : s2.get(e)) == null ? void 0 : o3.get(t3);
  }
  toObject() {
    const e = {};
    return [...this._model.keys()].forEach((s2) => {
      const o3 = this._model.get(s2);
      o3 != null && o3.size && (e[s2] = [], [...o3.keys()].forEach((i) => {
        const a4 = o3.get(i);
        a4 && e[s2].push(a4);
      }));
    }), e;
  }
  fromObject(e) {
    const t3 = /* @__PURE__ */ new Map();
    Object.keys(e).forEach((s2) => {
      const o3 = e[s2];
      if (o3 != null && o3.length) {
        const r = /* @__PURE__ */ new Map();
        o3.forEach((i) => {
          r.set(i.subUnitId, i);
        }), t3.set(s2, r);
      }
    }), this._model = t3;
  }
  deleteUnitModel(e) {
    this._model.delete(e);
  }
  _ensureSubUnitMap(e) {
    let t3 = this._model.get(e);
    return t3 || (t3 = /* @__PURE__ */ new Map(), this._model.set(e, t3)), t3;
  }
  getTargetByPermissionId(e, t3) {
    const s2 = this._model.get(e);
    if (!s2) return null;
    for (const [o3, r] of s2)
      if (r.permissionId === t3)
        return [e, o3];
  }
};
var di = class {
  constructor(e, t3, s2) {
    R(this, "type", x4.SelectRange);
    R(this, "subType", _.Delete);
    R(this, "status", mc.INIT);
    R(this, "value", true);
    R(this, "id");
    R(this, "unitId");
    R(this, "subUnitId");
    R(this, "permissionId");
    this.unitId = e, this.subUnitId = t3, this.permissionId = s2, this.id = `${x4.SelectRange}.${_.Delete}.${s2}`;
  }
};
var hi = class {
  constructor(e, t3, s2) {
    R(this, "type", x4.SelectRange);
    R(this, "subType", _.ManageCollaborator);
    R(this, "status", mc.INIT);
    R(this, "value", true);
    R(this, "id");
    R(this, "unitId");
    R(this, "subUnitId");
    R(this, "permissionId");
    this.unitId = e, this.subUnitId = t3, this.permissionId = s2, this.id = `${x4.SelectRange}.${_.ManageCollaborator}.${s2}`;
  }
};
var Ee4 = () => [Bs2, Ve4, hi, di];
var pt2 = [_.Edit, _.View, _.ManageCollaborator, _.Delete];
var ug2 = (n3 = "unitId", e = "subUnitId", t3 = "permissionId") => Ee4().reduce((s2, o3) => {
  const r = new o3(n3, e, t3);
  return s2[r.subType] = r.value, s2;
}, {});
var gn2 = () => [
  Pe3,
  hr2,
  rr2,
  fr4,
  ir4,
  dr2,
  zs,
  ur2,
  lr2,
  Ks,
  js2,
  cr2,
  mr2,
  Gs,
  Xu,
  Rr2,
  gr3,
  ar3,
  nl,
  tl,
  Qu,
  Zu
];
var id2 = [
  _.Edit,
  _.Print,
  _.Comment,
  _.View,
  _.Copy,
  _.Export,
  _.ManageCollaborator,
  _.CreateSheet,
  _.DeleteSheet,
  _.RenameSheet,
  _.HideSheet,
  _.Duplicate,
  _.Share,
  _.MoveSheet,
  _.CopySheet,
  _.RecoverHistory,
  _.ViewHistory,
  _.CreatePermissionObject,
  _.InsertRow,
  _.InsertColumn,
  _.DeleteRow,
  _.DeleteColumn
];
var be3 = () => [
  Le2,
  ds,
  br4,
  Sr2
];
var He2 = () => [
  Cr,
  pr2,
  wr2,
  Ir2,
  vr3,
  Mr,
  yr2,
  _r2,
  Er,
  kr2,
  An3,
  Zt3,
  Qt3,
  Ur
];
var ws = [
  _.Copy,
  _.DeleteColumn,
  _.DeleteRow,
  _.EditExtraObject,
  _.Filter,
  _.InsertColumn,
  _.InsertRow,
  _.InsertHyperlink,
  _.PivotTable,
  _.SetCellStyle,
  _.SetCellValue,
  _.SetColumnStyle,
  _.SetRowStyle,
  _.Sort
];
var ad2 = Object.getOwnPropertyDescriptor;
var ud = (n3, e, t3, s2) => {
  for (var o3 = s2 > 1 ? void 0 : s2 ? ad2(e, t3) : e, r = n3.length - 1, i; r >= 0; r--)
    (i = n3[r]) && (o3 = i(o3) || o3);
  return o3;
};
var ct4 = (n3, e) => (t3, s2) => e(t3, s2, n3);
var ld = "SHEET_WORKSHEET_PROTECTION_PLUGIN";
var cd2 = "SHEET_WORKSHEET_PROTECTION_POINT_PLUGIN";
var zn2 = class extends ER {
  constructor(n3, e, t3, s2, o3, r, i, a4) {
    super(), this._permissionService = n3, this._univerInstanceService = e, this._injector = t3, this._worksheetProtectionRuleModel = s2, this._worksheetProtectionPointRuleModel = o3, this._resourceManagerService = r, this._rangeProtectionRuleModel = i, this._logService = a4, this._init(), this._initRuleChange(), this._initRuleSnapshot(), this._initPointSnapshot();
  }
  _init() {
    const n3 = (e) => {
      const t3 = e.getUnitId(), s2 = (o3) => {
        const r = o3.getSheetId();
        [...be3(), ...He2()].forEach((i) => {
          const a4 = new i(t3, r);
          this._permissionService.addPermissionPoint(a4);
        }), this._logService.debug("[WorksheetPermissionService]", "Initialization completed", t3, r);
      };
      e.getSheets().forEach((o3) => {
        s2(o3);
      }), e.sheetCreated$.subscribe((o3) => {
        s2(o3);
      }), e.sheetDisposed$.subscribe((o3) => {
        const r = o3.getSheetId();
        this._rangeProtectionRuleModel.getSubunitRuleList(t3, r).forEach((a4) => {
          [...Ee4()].forEach((u2) => {
            const l4 = new u2(t3, r, a4.permissionId);
            this._permissionService.deletePermissionPoint(l4.id);
          });
        }), [...be3(), ...He2()].forEach((a4) => {
          const u2 = new a4(t3, r);
          this._permissionService.deletePermissionPoint(u2.id);
        });
      });
    };
    this._univerInstanceService.getAllUnitsForType(we.UNIVER_SHEET).forEach((e) => {
      n3(e);
    }), this._univerInstanceService.getTypeOfUnitAdded$(we.UNIVER_SHEET).pipe(takeUntil(this.dispose$)).subscribe(n3), this._univerInstanceService.getTypeOfUnitDisposed$(we.UNIVER_SHEET).pipe(takeUntil(this.dispose$)).subscribe((e) => {
      e.getSheets().forEach((t3) => {
        const s2 = e.getUnitId(), o3 = t3.getSheetId();
        be3().forEach((r) => {
          const i = new r(s2, o3);
          this._permissionService.deletePermissionPoint(i.id);
        });
      });
    });
  }
  _initRuleChange() {
    this.disposeWithMe(
      this._worksheetProtectionRuleModel.ruleChange$.subscribe((n3) => {
        switch (n3.type) {
          case "add":
            break;
          case "delete": {
            be3().forEach((e) => {
              const t3 = new e(n3.unitId, n3.subUnitId);
              this._permissionService.updatePermissionPoint(t3.id, true);
            });
            break;
          }
          case "set": {
            be3().forEach((e) => {
              const t3 = new e(n3.unitId, n3.subUnitId);
              this._permissionService.updatePermissionPoint(t3.id, n3.rule);
            });
            break;
          }
        }
      })
    );
  }
  _initRuleSnapshot() {
    const n3 = () => {
      const t3 = this._worksheetProtectionRuleModel.toObject();
      return JSON.stringify(t3);
    }, e = (t3) => {
      if (!t3)
        return {};
      try {
        return JSON.parse(t3);
      } catch (e4) {
        return {};
      }
    };
    this.disposeWithMe(
      this._resourceManagerService.registerPluginResource({
        toJson: n3,
        parseJson: e,
        pluginName: ld,
        businesses: [Dn2.UNIVER_SHEET],
        onLoad: (t3, s2) => {
          this._worksheetProtectionRuleModel.fromObject(s2), Object.keys(s2).forEach((o3) => {
            be3().forEach((r) => {
              const i = new r(t3, o3);
              i.value = false, this._permissionService.addPermissionPoint(i);
            });
          }), this._worksheetProtectionRuleModel.changeRuleInitState(true);
        },
        onUnLoad: (t3) => {
          const s2 = this._univerInstanceService.getUnit(t3);
          s2 && (s2.getSheets().forEach((o3) => {
            const r = o3.getSheetId();
            [...be3(), ...He2()].forEach((i) => {
              const a4 = new i(t3, r);
              this._permissionService.deletePermissionPoint(a4.id);
            });
          }), gn2().forEach((o3) => {
            const r = new o3(t3);
            this._permissionService.deletePermissionPoint(r.id);
          })), this._worksheetProtectionRuleModel.deleteUnitModel(t3);
        }
      })
    );
  }
  _initPointSnapshot() {
    const n3 = () => {
      const t3 = this._worksheetProtectionPointRuleModel.toObject();
      return JSON.stringify(t3);
    }, e = (t3) => {
      if (!t3)
        return {};
      try {
        return JSON.parse(t3);
      } catch (e4) {
        return {};
      }
    };
    this.disposeWithMe(
      this._resourceManagerService.registerPluginResource({
        toJson: n3,
        parseJson: e,
        pluginName: cd2,
        businesses: [Dn2.UNIVER_SHEET],
        onLoad: (t3, s2) => {
          this._worksheetProtectionPointRuleModel.fromObject(s2), Object.keys(s2).forEach((o3) => {
            He2().forEach((r) => {
              const i = new r(t3, o3);
              this._permissionService.addPermissionPoint(i);
            });
          });
        },
        onUnLoad: (t3) => {
          this._worksheetProtectionPointRuleModel.deleteUnitModel(t3);
        }
      })
    );
  }
};
zn2 = ud([
  ct4(0, Inject(aC)),
  ct4(1, Inject(br)),
  ct4(2, Inject(Injector)),
  ct4(3, Inject(lt3)),
  ct4(4, Inject(vn2)),
  ct4(5, Inject(na)),
  ct4(6, Inject(me)),
  ct4(7, Inject(Nt))
], zn2);
var to2 = {
  id: "sheet.mutation.set-worksheet-permission-points",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const { rule: t3 } = e;
    return n3.get(vn2).addRule(t3), true;
  }
};
var dd = {
  type: Ls.COMMAND,
  id: "sheet.command.set-worksheet-permission-points",
  handler(n3, e) {
    return __async(this, null, function* () {
      if (!e)
        return false;
      const t3 = n3.get(Ds), { rule: s2 } = e;
      return t3.executeCommand(to2.id, {
        rule: s2,
        unitId: s2.unitId,
        subUnitId: s2.subUnitId
      }), true;
    });
  }
};
var hd = {
  type: Ls.COMMAND,
  id: "sheet.command.set-worksheet-protection",
  handler(n3, e) {
    return __async(this, null, function* () {
      if (!e)
        return false;
      const t3 = n3.get(Ds), s2 = n3.get(ra), { rule: o3, permissionId: r, oldRule: i } = e, { unitId: a4, subUnitId: u2 } = o3, l4 = __spreadProps(__spreadValues({}, o3), { permissionId: r });
      if (yield t3.executeCommand(bt2.id, {
        unitId: a4,
        subUnitId: u2,
        newRule: l4
      })) {
        const d2 = [{ id: bt2.id, params: { unitId: a4, subUnitId: u2, newRule: l4 } }], h9 = [{ id: bt2.id, params: { unitId: a4, subUnitId: u2, rule: i } }];
        s2.pushUndoRedo({
          unitID: a4,
          redoMutations: d2,
          undoMutations: h9
        });
      }
      return true;
    });
  }
};
var gd = (n3, e) => {
  const r = n3.get(br).getUniverSheetInstance(e.unitId).getSheetBySheetId(e.subUnitId).getConfig().rightToLeft;
  return __spreadProps(__spreadValues({}, Z.deepClone(e)), {
    rightToLeft: r
  });
};
var Is4 = {
  id: "sheet.mutation.set-worksheet-right-to-left",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    const t3 = n3.get(br).getUniverSheetInstance(e.unitId);
    if (!t3) return false;
    const s2 = t3.getSheetBySheetId(e.subUnitId);
    if (!s2) return false;
    const o3 = s2.getConfig();
    return o3.rightToLeft = e.rightToLeft, true;
  }
};
var lg = {
  type: Ls.COMMAND,
  id: "sheet.command.set-worksheet-right-to-left",
  handler: (n3, e) => __async(void 0, null, function* () {
    var d2;
    const t3 = n3.get(Ds), s2 = n3.get(ra), o3 = P5(n3.get(br), e);
    if (!o3) return false;
    const { unitId: r, subUnitId: i } = o3;
    let a4 = ie.FALSE;
    e && (a4 = (d2 = e.rightToLeft) != null ? d2 : ie.FALSE);
    const u2 = {
      rightToLeft: a4,
      unitId: r,
      subUnitId: i
    }, l4 = gd(
      n3,
      u2
    );
    return t3.syncExecuteCommand(
      Is4.id,
      u2
    ) ? (s2.pushUndoRedo({
      unitID: r,
      undoMutations: [{ id: Is4.id, params: l4 }],
      redoMutations: [
        { id: Is4.id, params: u2 }
      ]
    }), true) : false;
  })
};
var md = {
  type: Ls.COMMAND,
  id: "sheet.command.set-worksheet-row-count",
  handler: (n3, e) => {
    const { unitId: t3, subUnitId: s2, rowCount: o3 } = e, r = n3.get(Ds), i = n3.get(ra), a4 = n3.get(br);
    if (!P5(a4, e)) return false;
    const l4 = {
      unitId: t3,
      subUnitId: s2,
      rowCount: o3
    }, c2 = cu(n3, l4);
    return r.syncExecuteCommand(Yt2.id, l4) ? (i.pushUndoRedo({
      unitID: t3,
      undoMutations: [{ id: Yt2.id, params: c2 }],
      redoMutations: [{ id: Yt2.id, params: l4 }]
    }), true) : false;
  }
};
var Gn = {
  type: Ls.COMMAND,
  id: "sheet.command.delta-row-height",
  // eslint-disable-next-line max-lines-per-function
  handler: (n3, e) => __async(void 0, null, function* () {
    var T10, k6;
    const s2 = n3.get(z).getCurrentSelections(), o3 = n3.get(G);
    if (!(s2 != null && s2.length))
      return false;
    const r = P5(n3.get(br));
    if (!r) return false;
    const { worksheet: i, subUnitId: a4, unitId: u2 } = r, { anchorRow: l4, deltaY: c2 } = e, h9 = i.getRowHeight(l4) + c2, g9 = s2.length === 1 && s2[0].range.rangeType === ge.ALL, m9 = s2.filter((D5) => D5.range.rangeType === ge.ROW), f4 = g9 ? ge.ALL : m9.some(({ range: D5 }) => {
      const { startRow: H6, endRow: F7 } = D5;
      return H6 <= l4 && l4 <= F7;
    }) ? ge.ROW : ge.NORMAL;
    let C;
    if (f4 === ge.ALL) {
      const D5 = i.getColumnCount(), H6 = new Array(i.getRowCount()).fill(void 0).map(
        (F7, K5) => ({ startRow: K5, endRow: K5, startColumn: 0, endColumn: D5 - 1 })
      );
      C = {
        subUnitId: a4,
        unitId: u2,
        rowHeight: h9,
        ranges: H6
      };
    } else f4 === ge.ROW ? C = {
      subUnitId: a4,
      unitId: u2,
      ranges: m9.map((D5) => Cn.clone(D5.range)),
      rowHeight: h9
    } : C = {
      subUnitId: a4,
      unitId: u2,
      rowHeight: h9,
      ranges: [
        {
          startRow: l4,
          endRow: l4,
          startColumn: 0,
          endColumn: i.getMaxColumns() - 1
        }
      ]
    };
    const p3 = Qo2(C, i), w6 = {
      unitId: u2,
      subUnitId: a4,
      ranges: C.ranges,
      autoHeightInfo: ie.FALSE
    }, S = Vs(w6, i), I6 = n3.get(Ds), y6 = n3.get(ra), b4 = o3.onCommandExecute({
      id: Gn.id,
      params: C
    }), N6 = po([
      {
        id: nt2.id,
        params: C
      },
      {
        id: Fe3.id,
        params: w6
      }
    ], I6), U3 = po([...b4.redos], I6);
    if (N6.result && U3.result) {
      const D5 = o3.afterCommandExecute({
        id: Gn.id,
        params: C
      });
      return po(D5.redos, I6), y6.pushUndoRedo({
        unitID: u2,
        undoMutations: [
          ...(T10 = b4.preUndos) != null ? T10 : [],
          {
            id: nt2.id,
            params: p3
          },
          {
            id: Fe3.id,
            params: S
          },
          ...b4.undos,
          ...D5.undos
        ],
        redoMutations: [
          ...(k6 = b4.preRedos) != null ? k6 : [],
          {
            id: nt2.id,
            params: C
          },
          {
            id: Fe3.id,
            params: w6
          },
          ...b4.redos,
          ...D5.redos
        ]
      }), true;
    }
    return false;
  })
};
var Kn = {
  type: Ls.COMMAND,
  id: "sheet.command.set-row-height",
  // eslint-disable-next-line max-lines-per-function
  handler: (n3, e) => {
    var S, I6, y6, b4;
    const t3 = n3.get(z), s2 = n3.get(Ds), o3 = n3.get(ra), r = n3.get(br), i = n3.get(G), a4 = (S = e == null ? void 0 : e.ranges) != null && S.length ? e.ranges : (I6 = t3.getCurrentSelections()) == null ? void 0 : I6.map((N6) => N6.range);
    if (!(a4 != null && a4.length))
      return false;
    const u2 = P5(r, e);
    if (!u2) return false;
    const { unitId: l4, subUnitId: c2, worksheet: d2 } = u2, h9 = {
      subUnitId: c2,
      unitId: l4,
      ranges: a4,
      rowHeight: e.value
    }, g9 = Qo2(h9, d2), m9 = {
      unitId: l4,
      subUnitId: c2,
      ranges: h9.ranges,
      autoHeightInfo: ie.FALSE
    }, f4 = Vs(m9, d2), C = po([
      {
        id: nt2.id,
        params: h9
      },
      {
        id: Fe3.id,
        params: m9
      }
    ], s2), p3 = i.onCommandExecute({
      id: Kn.id,
      params: h9
    }), w6 = po([...p3.redos], s2);
    if (C.result && w6.result) {
      const N6 = i.afterCommandExecute({
        id: Kn.id,
        params: h9
      });
      return po(N6.redos, s2), o3.pushUndoRedo({
        unitID: l4,
        undoMutations: [
          ...(y6 = p3.preRedos) != null ? y6 : [],
          {
            id: nt2.id,
            params: g9
          },
          {
            id: Fe3.id,
            params: f4
          },
          ...p3.undos,
          ...N6.undos
        ],
        redoMutations: [
          ...(b4 = p3.preRedos) != null ? b4 : [],
          {
            id: nt2.id,
            params: h9
          },
          {
            id: Fe3.id,
            params: m9
          },
          ...p3.redos,
          ...N6.redos
        ]
      }), true;
    }
    return false;
  }
};
var no = {
  type: Ls.COMMAND,
  id: "sheet.command.set-row-is-auto-height",
  handler: (n3, e) => {
    var N6, U3;
    const t3 = n3.get(Ds), s2 = n3.get(ra), o3 = n3.get(z), r = n3.get(br), i = P5(r, e);
    if (!i) return false;
    const { unitId: a4, subUnitId: u2, worksheet: l4 } = i, c2 = (N6 = e == null ? void 0 : e.ranges) != null && N6.length ? e.ranges : (U3 = o3.getCurrentSelections()) == null ? void 0 : U3.map((T10) => T10.range);
    if (!(c2 != null && c2.length))
      return false;
    const d2 = {
      unitId: a4,
      subUnitId: u2,
      ranges: c2,
      autoHeightInfo: ie.TRUE
      // Hard code first, maybe it will change by the menu item in the future.
    }, h9 = Vs(d2, l4), g9 = t3.syncExecuteCommand(
      Fe3.id,
      d2
    ), m9 = n3.get(rt3).getSkeleton(a4, u2), { suitableRanges: f4, remainingRanges: C } = wn(d2.ranges, m9), p3 = n3.get(G), { undos: w6, redos: S } = p3.generateMutationsOfAutoHeight({
      unitId: a4,
      subUnitId: u2,
      ranges: f4,
      autoHeightRanges: f4,
      lazyAutoHeightRanges: C
    }), { undos: I6, redos: y6 } = p3.onCommandExecute({
      id: no.id,
      params: d2
    }), b4 = po([...y6, ...S], t3);
    return g9 && b4.result ? (s2.pushUndoRedo({
      unitID: a4,
      undoMutations: [{ id: Fe3.id, params: h9 }, ...I6, ...w6],
      redoMutations: [{ id: Fe3.id, params: d2 }, ...y6, ...S]
    }), true) : false;
  }
};
var gi = {
  type: Ls.COMMAND,
  id: "sheet.command.set-worksheet-show",
  handler: (n3, e) => {
    const { unitId: t3, subUnitId: s2 } = e, o3 = n3.get(Ds), r = n3.get(ra), i = n3.get(br);
    if (!P5(n3.get(br))) return false;
    const u2 = i.getCurrentUnitForType(we.UNIVER_SHEET);
    if (!u2) return false;
    const l4 = u2.getSheetBySheetId(s2);
    if (!l4 || l4.getConfig().hidden === ie.FALSE) return false;
    const d2 = {
      unitId: t3,
      subUnitId: s2,
      hidden: ie.FALSE
    }, h9 = li(n3, d2), g9 = o3.syncExecuteCommand(St2.id, d2), m9 = {
      unitId: t3,
      subUnitId: s2
    }, f4 = o3.syncExecuteCommand(
      pn.id,
      m9
    );
    return g9 && f4 ? (r.pushUndoRedo({
      unitID: t3,
      undoMutations: [
        { id: St2.id, params: h9 }
        // { id: SetWorksheetActiveOperation.id, params: unActiveMutationParams },
      ],
      redoMutations: [
        // { id: SetWorksheetActiveOperation.id, params: activeSheetMutationParams },
        { id: St2.id, params: d2 }
      ]
    }), true) : false;
  }
};
var fd = {
  type: Ls.COMMAND,
  id: "sheet.command.split-text-to-columns",
  // eslint-disable-next-line max-lines-per-function
  handler: (n3, e) => {
    const { unitId: t3, subUnitId: s2, range: o3, delimiter: r, customDelimiter: i, treatMultipleDelimitersAsOne: a4 } = e, u2 = n3.get(Ds), l4 = n3.get(br), c2 = n3.get(ra);
    if (!P5(n3.get(br))) return false;
    const h9 = l4.getCurrentUnitForType(we.UNIVER_SHEET);
    if (!h9) return false;
    const g9 = h9.getSheetBySheetId(s2);
    if (!g9) return false;
    const { lastRow: m9, rs: f4, maxLength: C } = ku(g9, o3, r, i, a4), p3 = g9.getColumnCount(), { startColumn: w6 } = vr.transformRange(o3, g9);
    if (o3.startColumn !== o3.endColumn)
      return false;
    const S = [], I6 = [], y6 = w6 + C + 1 - p3;
    if (y6 > 0) {
      const D5 = {
        unitId: t3,
        subUnitId: s2,
        range: {
          startRow: 0,
          endRow: g9.getRowCount() - 1,
          startColumn: p3 - 1,
          endColumn: p3 - 1 + y6
        }
      };
      S.push({
        id: Ue2.id,
        params: D5
      });
      const H6 = as(
        n3,
        D5
      );
      I6.push({ id: Me.id, params: H6 });
    }
    const b4 = {
      startRow: o3.startRow,
      endRow: m9,
      startColumn: w6,
      endColumn: w6 + C
    }, N6 = new ht();
    for (let D5 = b4.startRow; D5 <= b4.endRow; D5++)
      for (let H6 = b4.startColumn; H6 <= b4.endColumn; H6++) {
        const F7 = f4[D5 - b4.startRow];
        H6 === 0 && (F7 == null ? void 0 : F7.length) === 1 ? N6.setValue(D5, H6, g9.getCell(D5, H6)) : N6.setValue(D5, H6, {
          v: (F7 == null ? void 0 : F7[H6 - b4.startColumn]) || null,
          p: null,
          f: null,
          si: null,
          custom: null
        });
      }
    const U3 = {
      unitId: t3,
      subUnitId: s2,
      cellValue: N6.clone()
    }, T10 = Ae4(n3, U3);
    return S.push({
      id: ee2.id,
      params: U3
    }), I6.unshift({
      id: ee2.id,
      params: T10
    }), po(S, u2).result ? (c2.pushUndoRedo({
      unitID: t3,
      undoMutations: I6,
      redoMutations: S
    }), true) : false;
  }
};
var Rd2 = {
  id: "sheet.command.toggle-cell-checkbox",
  type: Ls.COMMAND,
  handler: (n3, e) => {
    if (!e)
      return false;
    const { unitId: t3, subUnitId: s2, row: o3, col: r, paragraphIndex: i } = e, u2 = n3.get(br).getUnit(t3, we.UNIVER_SHEET), l4 = u2 == null ? void 0 : u2.getSheetBySheetId(s2), c2 = n3.get(ra), d2 = n3.get(Ds);
    if (!l4)
      return false;
    const h9 = l4.getCell(o3, r);
    if (!(h9 != null && h9.p))
      return false;
    const g9 = Z.deepClone(h9.p), m9 = new Ft(g9), f4 = Ze.paragraph.bullet.toggleChecklist({
      document: m9,
      paragraphIndex: i
    });
    if (!f4)
      return false;
    Ne.apply(m9.getBody(), f4.serialize());
    const C = {
      unitId: t3,
      subUnitId: s2,
      cellValue: {
        [o3]: {
          [r]: {
            p: g9,
            t: mn.STRING
          }
        }
      }
    }, p3 = {
      id: ee2.id,
      params: C
    }, w6 = Ae4(n3, C), S = {
      id: ee2.id,
      params: w6
    }, I6 = [p3], y6 = [S];
    return c2.pushUndoRedo({
      redoMutations: I6,
      undoMutations: y6,
      unitID: t3
    }), d2.syncExecuteCommand(p3.id, p3.params);
  }
};
var Cd = {
  type: Ls.COMMAND,
  id: "sheet.command.toggle-gridlines",
  handler: (n3, e) => {
    const t3 = n3.get(Ds), s2 = n3.get(ra), o3 = n3.get(br), r = P5(o3);
    if (!r) return false;
    const { worksheet: i } = r, a4 = i.getConfig().showGridlines;
    if (a4 === (e == null ? void 0 : e.showGridlines)) return false;
    const { unitId: u2, subUnitId: l4 } = r, c2 = {
      showGridlines: a4 === ie.TRUE ? ie.FALSE : ie.TRUE,
      unitId: u2,
      subUnitId: l4
    }, d2 = {
      showGridlines: a4,
      unitId: u2,
      subUnitId: l4
    };
    return t3.syncExecuteCommand(Xt2.id, c2) ? (s2.pushUndoRedo({
      unitID: u2,
      undoMutations: [{ id: Xt2.id, params: d2 }],
      redoMutations: [{ id: Xt2.id, params: c2 }]
    }), true) : false;
  }
};
var pd = {
  id: "sheet.command.unregister-worksheet-range-theme-style",
  type: Ls.COMMAND,
  handler: (n3, e) => {
    var h9;
    if (!e)
      return false;
    const { unitId: t3, themeName: s2 } = e, o3 = n3.get(br), r = n3.get(Ds), i = n3.get(ra), a4 = n3.get(ve2);
    if (!P5(o3)) return false;
    const l4 = {
      unitId: t3,
      themeName: s2
    }, c2 = {
      unitId: t3,
      themeName: s2,
      rangeThemeStyleJson: (h9 = a4.getRangeThemeStyle(t3, s2)) == null ? void 0 : h9.toJson()
    };
    return r.syncExecuteCommand(cn.id, e) && i.pushUndoRedo({
      unitID: t3,
      undoMutations: [{ id: cn.id, params: c2 }],
      redoMutations: [{ id: Xs.id, params: l4 }]
    }), true;
  }
};
var Sd = {
  id: "sheet.mutation.add-range-theme",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    if (!e)
      return false;
    const { styleJSON: t3, unitId: s2 } = e, o3 = n3.get(ve2), r = new Rt(t3.name);
    return r.fromJson(t3), o3.registerRangeThemeStyle(s2, r), true;
  }
};
var wd = {
  id: "sheet.mutation.empty",
  type: Ls.MUTATION,
  handler: () => true
};
var Id = {
  id: "sheet.operation.mark-dirty-row-auto-height",
  type: Ls.OPERATION,
  handler: () => true
};
var vd = {
  id: "sheet.operation.cancel-mark-dirty-row-auto-height",
  type: Ls.OPERATION,
  handler: () => true
};
var $t2 = createIdentifier("INumfmtService");
var cg = (n3, e) => {
  const t3 = n3.get($t2), { values: s2, unitId: o3, subUnitId: r } = e, i = [], a4 = [];
  Object.keys(s2).forEach((l4) => {
    s2[l4].ranges.forEach((d2) => {
      vr.foreach(d2, (h9, g9) => {
        const m9 = t3.getValue(o3, r, h9, g9);
        m9 ? i.push({
          pattern: m9.pattern,
          row: h9,
          col: g9
        }) : a4.push({ startColumn: g9, endColumn: g9, startRow: h9, endRow: h9 });
      });
    });
  });
  const u2 = [];
  if (i.length) {
    const l4 = Ps(o3, r, i);
    Object.keys(l4.values).forEach((c2) => {
      const d2 = l4.values[c2];
      d2.ranges = nr3(d2.ranges);
    }), u2.push({
      id: so2.id,
      params: Ps(o3, r, i)
    });
  }
  return a4.length && u2.push({
    id: mi.id,
    params: {
      unitId: o3,
      subUnitId: r,
      ranges: a4
    }
  }), u2;
};
var so2 = {
  id: "sheet.mutation.set.numfmt",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    if (!e)
      return false;
    const { values: t3, refMap: s2 } = e, o3 = n3.get($t2), r = e.unitId, i = e.subUnitId, a4 = Object.keys(t3).reduce(
      (u2, l4) => {
        const c2 = s2[l4], d2 = t3[l4].ranges;
        return c2 && u2.push(__spreadProps(__spreadValues({}, c2), {
          ranges: d2
        })), u2;
      },
      []
    );
    return o3.setValues(r, i, a4), true;
  }
};
var mi = {
  id: "sheet.mutation.remove.numfmt",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    if (!e)
      return false;
    const { unitId: t3, subUnitId: s2, ranges: o3 } = e;
    return n3.get($t2).deleteValues(t3, s2, o3), true;
  }
};
var dg2 = (n3, e) => {
  const t3 = n3.get($t2), { ranges: s2, unitId: o3, subUnitId: r } = e, i = [];
  if (s2.forEach((u2) => {
    vr.foreach(u2, (l4, c2) => {
      const d2 = t3.getValue(o3, r, l4, c2);
      d2 && i.push({
        pattern: d2.pattern,
        row: l4,
        col: c2
      });
    });
  }), !i.length)
    return [];
  const a4 = Ps(o3, r, i);
  return Object.keys(a4.values).forEach((u2) => {
    const l4 = a4.values[u2];
    l4.ranges = nr3(l4.ranges);
  }), [{ id: so2.id, params: a4 }];
};
var Ps = (n3, e, t3) => {
  const s2 = Uu(t3, "pattern"), o3 = {}, r = {}, i = Tu();
  return Object.keys(s2).forEach((a4) => {
    const u2 = s2[a4], l4 = i();
    o3[l4] = {
      pattern: a4
    }, u2.forEach((c2) => {
      r[l4] || (r[l4] = { ranges: [] }), r[l4].ranges.push(QR(c2.row, c2.col));
    });
  }), { unitId: n3, subUnitId: e, refMap: o3, values: r };
};
var Md2 = {
  id: "sheet.mutation.remove-range-theme",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    if (!e)
      return false;
    const { styleName: t3, unitId: s2 } = e;
    return n3.get(ve2).unregisterRangeThemeStyle(s2, t3), true;
  }
};
var _d = {
  id: "sheet.mutation.set-range-theme",
  type: Ls.MUTATION,
  handler: (n3, e) => {
    if (!e)
      return false;
    const { unitId: t3, styleName: s2, style: o3 } = e, i = n3.get(ve2).getRangeThemeStyle(t3, s2);
    return i && (o3.headerRowStyle && i.setHeaderRowStyle(o3.headerRowStyle), o3.firstRowStyle && i.setFirstRowStyle(o3.firstRowStyle), o3.secondRowStyle && i.setSecondRowStyle(o3.secondRowStyle), o3.lastRowStyle && i.setLastRowStyle(o3.lastRowStyle)), true;
  }
};
var yd = {
  id: "sheet.operation.scroll-to-cell",
  type: Ls.OPERATION,
  handler: () => true
};
var hg = (n3, e, t3) => {
  const o3 = n3.get(z).getCurrentSelections(), { value: r, selections: i, unitId: a4, subUnitId: u2 } = e;
  if (o3) {
    const c2 = o3[(o3 == null ? void 0 : o3.length) - 1].primary;
    if (c2) {
      const { actualColumn: d2, actualRow: h9 } = c2;
      let { startRow: g9, startColumn: m9, endRow: f4, endColumn: C } = i[i.length - 1];
      if (r === Im.COLUMNS) {
        const I6 = t3.find((y6) => y6.startColumn === d2 && y6.endColumn === d2 && h9 === y6.startRow);
        I6 && (C = I6.endColumn, g9 = I6.startRow, f4 = I6.endRow);
      } else if (r === Im.ROWS) {
        const I6 = t3.find((y6) => y6.startRow === h9 && y6.endRow === h9 && d2 === y6.startColumn);
        I6 && (f4 = I6.endRow, m9 = I6.startColumn, C = I6.endColumn);
      }
      const p3 = {
        startRow: g9,
        startColumn: m9,
        endRow: f4,
        endColumn: C,
        actualRow: h9,
        actualColumn: d2,
        isMerged: true,
        isMergedMainCell: g9 === h9 && m9 === d2
      }, w6 = o3.map((I6, y6, b4) => ({
        range: I6.range,
        style: null,
        primary: y6 === b4.length - 1 ? p3 : null
      })), S = {
        unitId: a4,
        subUnitId: u2,
        type: we3.ONLY_SET,
        selections: w6
      };
      return {
        id: ie5.id,
        params: S
      };
    }
    return null;
  }
  return null;
};
var gg2 = (n3, e) => {
  const s2 = n3.get(z).getCurrentSelections(), { unitId: o3, subUnitId: r } = e;
  if (s2 && s2[(s2 == null ? void 0 : s2.length) - 1].primary) {
    const u2 = {
      unitId: o3,
      subUnitId: r,
      type: we3.ONLY_SET,
      selections: [...s2]
    };
    return {
      id: ie5.id,
      params: u2
    };
  }
  return null;
};
var bd = "maxCellsPerSheet";
var Ed = 3e6;
var kd = Object.getOwnPropertyDescriptor;
var Ud2 = (n3, e, t3, s2) => {
  for (var o3 = s2 > 1 ? void 0 : s2 ? kd(e, t3) : e, r = n3.length - 1, i; r >= 0; r--)
    (i = n3[r]) && (o3 = i(o3) || o3);
  return o3;
};
var Eo = (n3, e) => (t3, s2) => e(t3, s2, n3);
var Td = "SHEET_DEFINED_NAME_PLUGIN";
var mg = "AllDefaultWorkbook";
var Jn3 = class extends Ve {
  constructor(n3, e) {
    super(), this._definedNamesService = n3, this._resourceManagerService = e, this._initialize();
  }
  _initialize() {
    this._initSnapshot();
  }
  _initSnapshot() {
    const n3 = (t3) => {
      const s2 = this._definedNamesService.getDefinedNameMap(t3);
      return s2 ? JSON.stringify(s2) : "";
    }, e = (t3) => {
      if (!t3)
        return {};
      try {
        return JSON.parse(t3);
      } catch (e4) {
        return {};
      }
    };
    this.disposeWithMe(
      this._resourceManagerService.registerPluginResource({
        pluginName: Td,
        businesses: [we.UNIVER_SHEET],
        toJson: (t3) => n3(t3),
        parseJson: (t3) => e(t3),
        onUnLoad: (t3) => {
          this._definedNamesService.removeUnitDefinedName(t3);
        },
        onLoad: (t3, s2) => {
          this._definedNamesService.registerDefinedNames(t3, s2);
        }
      })
    );
  }
};
Jn3 = Ud2([
  Eo(0, Lr),
  Eo(1, na)
], Jn3);
var Pd = Object.getOwnPropertyDescriptor;
var Nd = (n3, e, t3, s2) => {
  for (var o3 = s2 > 1 ? void 0 : s2 ? Pd(e, t3) : e, r = n3.length - 1, i; r >= 0; r--)
    (i = n3[r]) && (o3 = i(o3) || o3);
  return o3;
};
var vs3 = (n3, e) => (t3, s2) => e(t3, s2, n3);
var Od = [
  st2.id
];
var Dd = [
  ke2.id,
  Ue2.id,
  Te.id,
  Me.id,
  Je3.id,
  qe2.id
];
var qn3 = class extends Ve {
  constructor(e, t3, s2) {
    var r, i;
    super();
    R(this, "_d", new ho());
    R(this, "_enabled", true);
    this._univerInstanceService = e, this._commandService = t3, this._configService = s2;
    const o3 = (i = (r = this._configService.getConfig(fs)) == null ? void 0 : r.freezeSync) != null ? i : true;
    this.setEnabled(o3);
  }
  getEnabled() {
    return this._enabled;
  }
  setEnabled(e) {
    e ? this._d.dispose() : this._initOnlyLocalListener(), this._enabled = e;
  }
  _initOnlyLocalListener() {
    this._d.add(
      this._commandService.beforeCommandExecuted((e, t3) => {
        Od.includes(e.id) && (t3 || (t3 = {}), t3.onlyLocal = true);
      })
    ), this._d.add(
      this._commandService.onCommandExecuted((e, t3) => {
        if (Dd.includes(e.id) && (t3 != null && t3.fromCollab)) {
          const { id: s2, params: o3 } = e;
          s2 === ke2.id ? this._handleInsertRowMutation(o3, t3) : s2 === Ue2.id ? this._handleInsertColMutation(o3, t3) : s2 === Te.id ? this._handleRemoveRowMutation(o3, t3) : s2 === Me.id ? this._handleRemoveColMutation(o3, t3) : s2 === Je3.id ? this._handleMoveRowsMutation(o3, t3) : s2 === qe2.id && this._handleMoveColsMutation(o3, t3);
        }
      })
    );
  }
  _handleInsertRowMutation(e, t3) {
    const { range: s2, unitId: o3, subUnitId: r } = e, i = this._getFreeze(o3, r);
    if (i && s2.startRow < i.startRow) {
      const a4 = s2.endRow - s2.startRow + 1, u2 = __spreadProps(__spreadValues({}, i), {
        startRow: Math.max(1, i.startRow + a4),
        ySplit: Math.max(1, i.ySplit + a4)
      });
      this._sequenceExecute(o3, r, u2, t3);
    }
  }
  _handleInsertColMutation(e, t3) {
    const { range: s2, unitId: o3, subUnitId: r } = e, i = this._getFreeze(o3, r);
    if (i && s2.startColumn < i.startColumn) {
      const a4 = s2.endColumn - s2.startColumn + 1, u2 = __spreadProps(__spreadValues({}, i), {
        startColumn: Math.max(1, i.startColumn + a4),
        xSplit: Math.max(1, i.xSplit + a4)
      });
      this._sequenceExecute(o3, r, u2, t3);
    }
  }
  _handleRemoveRowMutation(e, t3) {
    const { range: s2, unitId: o3, subUnitId: r } = e, i = this._getFreeze(o3, r);
    if (i && s2.startRow < i.startRow) {
      const a4 = Math.min(i.startRow, s2.endRow + 1) - s2.startRow, u2 = __spreadProps(__spreadValues({}, i), {
        startRow: Math.max(1, i.startRow - a4),
        ySplit: Math.max(1, i.ySplit - a4)
      });
      this._sequenceExecute(o3, r, u2, t3);
    }
  }
  _handleRemoveColMutation(e, t3) {
    const { range: s2, unitId: o3, subUnitId: r } = e, i = this._getFreeze(o3, r);
    if (i && s2.startColumn < i.startColumn) {
      const a4 = Math.min(i.startColumn, s2.endColumn + 1) - s2.startColumn, u2 = __spreadProps(__spreadValues({}, i), {
        startColumn: Math.max(1, i.startColumn - a4),
        xSplit: Math.max(1, i.xSplit - a4)
      });
      this._sequenceExecute(o3, r, u2, t3);
    }
  }
  _handleMoveRowsMutation(e, t3) {
    const { sourceRange: s2, targetRange: o3, unitId: r, subUnitId: i } = e, a4 = this._getFreeze(r, i);
    if (!a4 || a4.startRow <= 0 || s2.startRow >= a4.startRow && o3.startRow >= a4.startRow || s2.endRow < a4.startRow && o3.endRow < a4.startRow)
      return;
    const u2 = s2.endRow - s2.startRow + 1, l4 = Math.max(
      Math.min(a4.startRow, s2.endRow + 1) - s2.startRow,
      0
    ), c2 = __spreadValues({}, a4);
    o3.startRow >= a4.startRow ? (c2.startRow = Math.max(1, a4.startRow - l4), c2.ySplit = Math.max(1, a4.ySplit - l4)) : (c2.startRow = a4.startRow + u2 - l4, c2.ySplit = a4.ySplit + u2 - l4), this._sequenceExecute(r, i, c2, t3);
  }
  _handleMoveColsMutation(e, t3) {
    const { sourceRange: s2, targetRange: o3, unitId: r, subUnitId: i } = e, a4 = this._getFreeze(r, i);
    if (!a4 || a4.startColumn <= 0 || s2.startColumn >= a4.startColumn && o3.startColumn >= a4.startColumn || s2.endColumn < a4.startColumn && o3.endColumn < a4.startColumn)
      return;
    const u2 = s2.endColumn - s2.startColumn + 1, l4 = Math.max(
      Math.min(a4.startColumn, s2.endColumn + 1) - s2.startColumn,
      0
    ), c2 = __spreadValues({}, a4);
    o3.startColumn >= a4.startColumn ? (c2.startColumn = Math.max(1, a4.startColumn - l4), c2.xSplit = Math.max(1, a4.xSplit - l4)) : (c2.startColumn = a4.startColumn + u2 - l4, c2.xSplit = a4.xSplit + u2 - l4), this._sequenceExecute(r, i, c2, t3);
  }
  _getFreeze(e, t3) {
    const s2 = this._univerInstanceService.getUnit(e, we.UNIVER_SHEET);
    if (!s2) return null;
    const o3 = s2.getSheetBySheetId(t3);
    return o3 ? o3.getFreeze() : null;
  }
  _sequenceExecute(e, t3, s2, o3) {
    po([
      {
        id: st2.id,
        params: __spreadProps(__spreadValues({}, s2), {
          unitId: e,
          subUnitId: t3,
          resetScroll: false
        })
      }
    ], this._commandService, o3);
  }
};
qn3 = Nd([
  vs3(0, Inject(br)),
  vs3(1, Ds),
  vs3(2, xs)
], qn3);
var Ad3 = Object.getOwnPropertyDescriptor;
var xd = (n3, e, t3, s2) => {
  for (var o3 = s2 > 1 ? void 0 : s2 ? Ad3(e, t3) : e, r = n3.length - 1, i; r >= 0; r--)
    (i = n3[r]) && (o3 = i(o3) || o3);
  return o3;
};
var ze5 = (n3, e) => (t3, s2) => e(t3, s2, n3);
var Yn2 = class extends Ve {
  constructor(e, t3, s2, o3, r, i, a4, u2, l4, c2) {
    super();
    R(this, "disposableCollection", new ho());
    R(this, "_triggerPermissionUIEvent$", new Subject());
    R(this, "triggerPermissionUIEvent$", this._triggerPermissionUIEvent$.asObservable());
    this._commandService = e, this._univerInstanceService = t3, this._permissionService = s2, this._selectionManagerService = o3, this._rangeProtectionRuleModel = r, this._worksheetProtectionRuleModel = i, this._localeService = a4, this._lexerTreeBuilder = u2, this._contextService = l4, this._definedNamesService = c2, this._initialize();
  }
  blockExecuteWithoutPermission(e) {
    throw this._triggerPermissionUIEvent$.next(e), new Ci("have no permission");
  }
  _getPermissionCheck(e, t3) {
    let s2 = true, o3 = "";
    switch (e) {
      case Sn2.id:
        Wg(t3.value) && t3.value.f ? (s2 = this._permissionCheckWithFormula(t3), o3 = this._localeService.t("permission.dialog.formulaErr")) : s2 = this._permissionCheckBySetRangeValue({
          workbookTypes: [Pe3],
          rangeTypes: [Ve4],
          worksheetTypes: [An3, Le2]
        }, t3);
        break;
      case Ys.id:
        s2 = this.permissionCheckWithRanges(
          {
            workbookTypes: [Pe3],
            rangeTypes: [Ve4],
            worksheetTypes: [An3, Le2]
          },
          t3 == null ? void 0 : t3.ranges,
          t3 == null ? void 0 : t3.unitId,
          t3 == null ? void 0 : t3.subUnitId
        ), o3 = this._localeService.t("permission.dialog.editErr");
        break;
      case Fn4.id:
      case Bn4.id:
        s2 = this.permissionCheckWithoutRange({
          worksheetTypes: [Zt3]
        }), o3 = this._localeService.t("permission.dialog.setRowColStyleErr");
        break;
      case Gn.id:
      case Kn.id:
      case no.id:
        s2 = this.permissionCheckWithoutRange({
          worksheetTypes: [Qt3]
        }), o3 = this._localeService.t("permission.dialog.setRowColStyleErr");
        break;
      case un.id:
      case an.id:
        s2 = this._permissionCheckByMoveCommand(t3), o3 = this._localeService.t("permission.dialog.moveRowColErr");
        break;
      case yt2.id:
        s2 = this._permissionCheckByMoveRangeCommand(t3), o3 = this._localeService.t("permission.dialog.moveRangeErr");
        break;
      case ci.id:
        s2 = this._permissionCheckByWorksheetCommand([Pe3, Gs]), o3 = this._localeService.t("permission.dialog.operatorSheetErr"), s2 === false && this._worksheetProtectionRuleModel.resetOrder();
        break;
      case eo2.id:
        s2 = this._permissionCheckByWorksheetCommand([Pe3, Ks]), o3 = this._localeService.t("permission.dialog.operatorSheetErr"), s2 === false && this._worksheetProtectionRuleModel.resetOrder();
        break;
      case gi.id:
        {
          const { unitId: r, subUnitId: i } = t3;
          s2 = this._permissionCheckByWorksheetCommand([Pe3, js2], r, i), o3 = this._localeService.t("permission.dialog.operatorSheetErr"), s2 === false && this._worksheetProtectionRuleModel.resetOrder();
        }
        break;
      case dn.id:
        s2 = this.permissionCheckWithRanges(
          {
            workbookTypes: [Pe3],
            rangeTypes: [Ve4],
            worksheetTypes: [Le2, Zt3]
          },
          t3.ranges,
          t3.unitId,
          t3.subUnitId
        ), o3 = this._localeService.t("permission.dialog.setRowColStyleErr");
        break;
      case hn.id:
        s2 = this.permissionCheckWithRanges(
          {
            workbookTypes: [Pe3],
            rangeTypes: [Ve4],
            worksheetTypes: [Le2, Qt3]
          },
          t3.ranges,
          t3.unitId,
          t3.subUnitId
        ), o3 = this._localeService.t("permission.dialog.setRowColStyleErr");
        break;
      case ei.id:
        s2 = this.permissionCheckWithRanges({
          workbookTypes: [Pe3],
          rangeTypes: [Ve4],
          worksheetTypes: [Le2, Zt3]
        }), o3 = this._localeService.t("permission.dialog.setRowColStyleErr");
        break;
      case oi.id:
        s2 = this.permissionCheckWithRanges({
          workbookTypes: [Pe3],
          rangeTypes: [Ve4],
          worksheetTypes: [Le2, Qt3]
        }), o3 = this._localeService.t("permission.dialog.setRowColStyleErr");
        break;
      case rn.id:
        s2 = this._permissionCheckWithInsertRangeMove("right"), o3 = this._localeService.t("permission.dialog.insertOrDeleteMoveRangeErr");
        break;
      case Pt4.id:
        s2 = this._permissionCheckWithInsertRangeMove("bottom"), o3 = this._localeService.t("permission.dialog.insertOrDeleteMoveRangeErr");
        break;
      case It2.id:
        s2 = this._permissionCheckWithInsertRangeMove("left"), o3 = this._localeService.t("permission.dialog.insertOrDeleteMoveRangeErr");
        break;
      case vt2.id:
        s2 = this._permissionCheckWithInsertRangeMove("top"), o3 = this._localeService.t("permission.dialog.insertOrDeleteMoveRangeErr");
        break;
    }
    s2 || this.blockExecuteWithoutPermission(o3);
  }
  _initialize() {
    this._commandExecutedListener();
  }
  _commandExecutedListener() {
    this.disposeWithMe(
      this._commandService.beforeCommandExecuted((e) => {
        this._getPermissionCheck(e.id, e == null ? void 0 : e.params);
      })
    ), this.disposeWithMe(
      this._commandService.onCommandExecuted((e) => {
        var t3;
        if (e.id === jn3.id) {
          const s2 = e.params, { unitId: o3 = (t3 = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET)) == null ? void 0 : t3.getUnitId(), subUnitId: r } = s2;
          if (!o3 || !r)
            return;
          const i = this._worksheetProtectionRuleModel.getRule(o3, r), a4 = this._rangeProtectionRuleModel.getSubunitRuleList(o3, r);
          i && this._worksheetProtectionRuleModel.ruleRefresh(i.permissionId), a4.length && this._rangeProtectionRuleModel.ruleRefresh(r);
        }
      })
    );
  }
  _permissionCheckWithInsertRangeMove(e) {
    var l4;
    const t3 = P5(this._univerInstanceService);
    if (!t3)
      return false;
    const { worksheet: s2, unitId: o3, subUnitId: r } = t3, i = Z.deepClone((l4 = this._selectionManagerService.getCurrentLastSelection()) == null ? void 0 : l4.range);
    return !(!i || (e === "top" || e === "bottom" ? i.endRow = s2.getRowCount() - 1 : (e === "left" || e === "right") && (i.endColumn = s2.getColumnCount() - 1), this._rangeProtectionRuleModel.getSubunitRuleList(o3, r).map((c2) => c2.ranges).flat().some((c2) => Cn.getIntersects(i, c2))));
  }
  _permissionCheckByWorksheetCommand(e, t3, s2) {
    var l4, c2;
    const o3 = P5(this._univerInstanceService, { unitId: t3, subUnitId: s2 });
    if (!o3)
      return false;
    const { unitId: r, subUnitId: i } = o3, a4 = this._worksheetProtectionRuleModel.getRule(r, i), u2 = this._rangeProtectionRuleModel.getSubunitRuleList(r, i).length > 0;
    return a4 || u2 ? (c2 = (l4 = this._permissionService.getPermissionPoint(new zs(r).id)) == null ? void 0 : l4.value) != null ? c2 : false : this._permissionService.composePermission(e.map((d2) => new d2(r).id)).every((d2) => d2.value);
  }
  permissionCheckWithoutRange(e) {
    var h9, g9, m9, f4;
    const t3 = P5(this._univerInstanceService);
    if (!t3)
      return false;
    const { worksheet: s2, unitId: o3, subUnitId: r } = t3, i = this._selectionManagerService.getCurrentLastSelection();
    if (!i)
      return true;
    const a4 = (g9 = (h9 = i == null ? void 0 : i.primary) == null ? void 0 : h9.actualRow) != null ? g9 : 0, u2 = (f4 = (m9 = i == null ? void 0 : i.primary) == null ? void 0 : m9.actualColumn) != null ? f4 : 0, { workbookTypes: l4, worksheetTypes: c2, rangeTypes: d2 } = e;
    return !(l4 && l4.some((p3) => {
      var I6, y6;
      const w6 = new p3(o3);
      return ((y6 = (I6 = this._permissionService.getPermissionPoint(w6.id)) == null ? void 0 : I6.value) != null ? y6 : false) === false;
    }) === true || c2 && c2.some((p3) => {
      var I6, y6;
      const w6 = new p3(o3, r);
      return ((y6 = (I6 = this._permissionService.getPermissionPoint(w6.id)) == null ? void 0 : I6.value) != null ? y6 : false) === false;
    }) === true || d2 && d2.some((p3) => {
      var b4, N6, U3, T10, k6;
      const w6 = (N6 = (b4 = s2.getCell(a4, u2)) == null ? void 0 : b4.selectionProtection) == null ? void 0 : N6[0];
      if (!(w6 != null && w6.ruleId))
        return false;
      const S = (U3 = this._rangeProtectionRuleModel.getRule(o3, r, w6.ruleId)) == null ? void 0 : U3.permissionId;
      if (!S)
        return false;
      const I6 = new p3(o3, r, S);
      return ((k6 = (T10 = this._permissionService.getPermissionPoint(I6.id)) == null ? void 0 : T10.value) != null ? k6 : false) === false;
    }) === true);
  }
  permissionCheckWithRanges(e, t3, s2, o3) {
    var g9;
    const r = P5(this._univerInstanceService);
    if (!r)
      return false;
    const { workbook: i, worksheet: a4 } = r;
    s2 || (s2 = i.getUnitId()), o3 || (o3 = a4.getSheetId());
    const u2 = t3 != null ? t3 : (g9 = this._selectionManagerService.getCurrentSelections()) == null ? void 0 : g9.map((m9) => m9.range);
    if (!u2)
      return false;
    const { workbookTypes: l4, worksheetTypes: c2, rangeTypes: d2 } = e, h9 = [];
    return l4 && h9.push(...l4.map((m9) => new m9(s2).id)), c2 && h9.push(...c2.map((m9) => new m9(s2, o3).id)), d2 && this._rangeProtectionRuleModel.getSubunitRuleList(s2, o3).forEach((m9) => {
      u2.some((C) => m9.ranges.some((p3) => Cn.intersects(p3, C))) && h9.push(...d2.map((C) => new C(s2, o3, m9.permissionId).id));
    }), h9.length ? this._permissionService.composePermission(h9).every((m9) => m9.value) : true;
  }
  _permissionCheckByMoveCommand(e) {
    const t3 = P5(this._univerInstanceService);
    if (!t3)
      return false;
    const { worksheet: s2, unitId: o3, subUnitId: r } = t3, i = e.toRange;
    i.endRow === s2.getRowCount() - 1 ? i.endColumn = i.startColumn : i.endRow = i.startRow;
    const a4 = this._rangeProtectionRuleModel.getSubunitRuleList(o3, r).reduce((u2, l4) => [...u2, ...l4.ranges], []).filter((u2) => Cn.intersects(u2, i));
    return a4.length > 0 ? false : (a4.forEach((u2) => {
      var l4, c2;
      for (let d2 = u2.startRow; d2 <= u2.endRow; d2++)
        for (let h9 = u2.startColumn; h9 <= u2.endColumn; h9++) {
          const g9 = (c2 = (l4 = s2.getCell(d2, h9)) == null ? void 0 : l4.selectionProtection) == null ? void 0 : c2[0];
          if ((g9 == null ? void 0 : g9[_.Edit]) === false)
            return false;
        }
    }), true);
  }
  _permissionCheckByMoveRangeCommand(e) {
    const t3 = P5(this._univerInstanceService);
    if (!t3)
      return false;
    const { worksheet: s2, unitId: o3, subUnitId: r } = t3, i = e.toRange, a4 = this._rangeProtectionRuleModel.getSubunitRuleList(o3, r).reduce((u2, l4) => [...u2, ...l4.ranges], []).filter((u2) => Cn.intersects(u2, i));
    return a4.length > 0 ? false : (a4.forEach((u2) => {
      var l4, c2;
      for (let d2 = u2.startRow; d2 <= u2.endRow; d2++)
        for (let h9 = u2.startColumn; h9 <= u2.endColumn; h9++) {
          const g9 = (c2 = (l4 = s2.getCell(d2, h9)) == null ? void 0 : l4.selectionProtection) == null ? void 0 : c2[0];
          if ((g9 == null ? void 0 : g9[_.Edit]) === false)
            return false;
        }
    }), true);
  }
  _permissionCheckBySetRangeValue(e, t3) {
    let s2 = [];
    t3.range ? s2 = [t3.range] : s2 = [new ht(t3.value).getDataRange()];
    const { unitId: o3, subUnitId: r } = t3;
    return this.permissionCheckWithRanges(e, s2, o3, r);
  }
  _permissionCheckWithFormula(e) {
    var r, i, a4, u2, l4;
    const t3 = e.value, s2 = e.range, o3 = t3.f;
    if (o3) {
      const c2 = o3.substring(1), d2 = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET), h9 = (r = e.unitId) != null ? r : d2.getUnitId(), g9 = this._definedNamesService.getValueByName(h9, c2);
      if (g9) {
        let m9 = g9.formulaOrRefString;
        m9.startsWith(Z6.EQUALS) && (m9 = m9.slice(1));
        const f4 = m9.split(",");
        for (let C = 0; C < f4.length; C++) {
          const p3 = f4[C], w6 = kr(p3);
          if (w6.sheetName) {
            const S = d2.getSheetBySheetName(w6.sheetName);
            if (!S)
              return true;
            const { startRow: I6, endRow: y6, startColumn: b4, endColumn: N6 } = w6.range;
            for (let U3 = I6; U3 <= y6; U3++)
              for (let T10 = b4; T10 <= N6; T10++) {
                const k6 = (a4 = (i = S.getCell(U3, T10)) == null ? void 0 : i.selectionProtection) == null ? void 0 : a4[0];
                if ((k6 == null ? void 0 : k6[_.View]) === false)
                  return false;
              }
          }
        }
        return true;
      } else {
        const m9 = this._lexerTreeBuilder.sequenceNodesBuilder(o3);
        if (!m9)
          return true;
        for (let f4 = 0; f4 < m9.length; f4++) {
          const C = m9[f4];
          if (typeof C == "string" || C.nodeType !== He.REFERENCE)
            continue;
          const { token: p3 } = C, w6 = br3(p3), S = w6.unitId ? this._univerInstanceService.getUnit(w6.unitId) : this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET);
          if (!S) return true;
          let I6 = w6.sheetName ? S.getSheetBySheetName(w6.sheetName) : S.getActiveSheet();
          const y6 = S.getUnitId();
          if (w6.sheetName) {
            if (I6 = S.getSheetBySheetName(w6.sheetName), !I6)
              return true;
            const k6 = I6 == null ? void 0 : I6.getSheetId();
            if (!this._permissionService.getPermissionPoint(new ds(y6, k6).id)) return false;
          }
          if (!I6)
            return true;
          const { startRow: b4, endRow: N6, startColumn: U3, endColumn: T10 } = w6.range;
          for (let k6 = b4; k6 <= N6; k6++)
            for (let D5 = U3; D5 <= T10; D5++) {
              const H6 = (l4 = (u2 = I6.getCell(k6, D5)) == null ? void 0 : u2.selectionProtection) == null ? void 0 : l4[0];
              if ((H6 == null ? void 0 : H6[_.View]) === false)
                return false;
            }
        }
        return true;
      }
    }
    if (s2) {
      const c2 = P5(this._univerInstanceService);
      if (!c2)
        return false;
      const d2 = e.unitId || c2.unitId, h9 = e.subUnitId || c2.subUnitId, m9 = this._rangeProtectionRuleModel.getSubunitRuleList(d2, h9).filter((C) => C.ranges.some((p3) => Cn.intersects(p3, s2))).map((C) => new Ve4(d2, h9, C.permissionId).id);
      if (!this._permissionService.composePermission(m9).every((C) => C.value))
        return false;
    }
    return true;
  }
};
Yn2 = xd([
  ze5(0, Ds),
  ze5(1, br),
  ze5(2, aC),
  ze5(3, Inject(z)),
  ze5(4, Inject(me)),
  ze5(5, Inject(lt3)),
  ze5(6, Inject(Hn)),
  ze5(7, Inject(Mn)),
  ze5(8, Tr),
  ze5(9, Lr)
], Yn2);
var $d = Object.getOwnPropertyDescriptor;
var Wd = (n3, e, t3, s2) => {
  for (var o3 = s2 > 1 ? void 0 : s2 ? $d(e, t3) : e, r = n3.length - 1, i; r >= 0; r--)
    (i = n3[r]) && (o3 = i(o3) || o3);
  return o3;
};
var Ft4 = (n3, e) => (t3, s2) => e(t3, s2, n3);
var mn2 = class extends Ve {
  constructor(e, t3, s2, o3, r) {
    super();
    R(this, "_unitPermissionInitStateChange", new BehaviorSubject(false));
    R(this, "unitPermissionInitStateChange$", this._unitPermissionInitStateChange.asObservable());
    this._permissionService = e, this._univerInstanceService = t3, this._rangeProtectionRuleModel = s2, this._worksheetProtectionRuleModel = o3, this._worksheetProtectionPointModel = r, this._init();
  }
  _init() {
    const e = (t3) => {
      const s2 = t3.getUnitId();
      gn2().forEach((o3) => {
        const r = new o3(s2);
        this._permissionService.addPermissionPoint(r);
      });
    };
    this._univerInstanceService.getAllUnitsForType(we.UNIVER_SHEET).forEach((t3) => {
      e(t3);
    }), this.disposeWithMe(this._univerInstanceService.getTypeOfUnitAdded$(we.UNIVER_SHEET).subscribe((t3) => {
      e(t3);
    })), this.disposeWithMe(this._univerInstanceService.getTypeOfUnitDisposed$(we.UNIVER_SHEET).subscribe((t3) => {
      const s2 = t3.getUnitId();
      t3.getSheets().forEach((o3) => {
        const r = o3.getSheetId();
        this._rangeProtectionRuleModel.getSubunitRuleList(s2, r).forEach((a4) => {
          [...Ee4()].forEach((u2) => {
            const l4 = new u2(s2, r, a4.permissionId);
            this._permissionService.deletePermissionPoint(l4.id);
          });
        }), [...be3(), ...He2()].forEach((a4) => {
          const u2 = new a4(s2, r);
          this._permissionService.deletePermissionPoint(u2.id);
        });
      }), gn2().forEach((o3) => {
        const r = new o3(s2);
        this._permissionService.deletePermissionPoint(r.id);
      }), this._rangeProtectionRuleModel.deleteUnitModel(s2), this._worksheetProtectionPointModel.deleteUnitModel(s2), this._worksheetProtectionRuleModel.deleteUnitModel(s2);
    }));
  }
  changeUnitInitState(e) {
    this._unitPermissionInitStateChange.next(e);
  }
};
mn2 = Wd([
  Ft4(0, Inject(aC)),
  Ft4(1, Inject(br)),
  Ft4(2, Inject(me)),
  Ft4(3, Inject(lt3)),
  Ft4(4, Inject(vn2))
], mn2);
var Vd2 = Object.getOwnPropertyDescriptor;
var Ld = (n3, e, t3, s2) => {
  for (var o3 = s2 > 1 ? void 0 : s2 ? Vd2(e, t3) : e, r = n3.length - 1, i; r >= 0; r--)
    (i = n3[r]) && (o3 = i(o3) || o3);
  return o3;
};
var Ge4 = (n3, e) => (t3, s2) => e(t3, s2, n3);
var Xn3 = class extends Ve {
  constructor(n3, e, t3, s2, o3, r, i, a4, u2, l4) {
    super(), this._univerInstanceService = n3, this._permissionService = e, this._authzIoService = t3, this._rangeProtectionRuleModel = s2, this._worksheetProtectionRuleModel = o3, this._userManagerService = r, this._worksheetProtectionPointRuleModel = i, this._workbookPermissionService = a4, this._undoRedoService = u2, this._commandService = l4;
  }
  initPermission() {
    this._initRangePermissionFromSnapshot(), this._initRangePermissionChange(), this._initWorksheetPermissionFromSnapshot(), this._initWorksheetPermissionChange(), this._initWorksheetPermissionPointsChange(), this._initWorkbookPermissionFromSnapshot(), this._initUserChange(), this._refreshPermissionByCollaCreate();
  }
  refreshRangeProtectPermission() {
    this._initRangePermissionFromSnapshot();
  }
  _initRangePermissionFromSnapshot() {
    return __async(this, null, function* () {
      const n3 = (e) => __async(this, null, function* () {
        const t3 = [], s2 = e.getUnitId(), o3 = e.getSheets(), r = /* @__PURE__ */ new Map();
        if (o3.forEach((i) => {
          const a4 = i.getSheetId();
          this._rangeProtectionRuleModel.getSubunitRuleList(s2, a4).forEach((u2) => {
            r.set(u2.permissionId, u2), t3.push({
              objectID: u2.permissionId,
              unitID: s2,
              objectType: x4.SelectRange,
              actions: pt2
            });
          });
        }), !t3.length) {
          this._rangeProtectionRuleModel.changeRuleInitState(true);
          return;
        }
        this._authzIoService.batchAllowed(t3).then((i) => {
          i.forEach((a4) => {
            const u2 = r.get(a4.objectID);
            if (u2) {
              if (!this._rangeProtectionRuleModel.getRule(s2, u2.subUnitId, u2.id))
                return;
              Ee4().forEach((c2) => {
                const d2 = new c2(s2, u2.subUnitId, a4.objectID), h9 = d2.subType, g9 = a4.actions.find((m9) => m9.action === h9);
                (g9 == null ? void 0 : g9.allowed) !== void 0 && this._permissionService.updatePermissionPoint(d2.id, g9.allowed);
              });
            }
          }), this._rangeProtectionRuleModel.changeRuleInitState(true);
        });
      });
      yield Promise.all(this._univerInstanceService.getAllUnitsForType(we.UNIVER_SHEET).map((e) => n3(e))), this._rangeProtectionRuleModel.changeRuleInitState(true);
    });
  }
  _initRangePermissionChange() {
    this.disposeWithMe(
      this._rangeProtectionRuleModel.ruleChange$.subscribe((n3) => {
        n3.type !== "delete" ? this._authzIoService.allowed({
          objectID: n3.rule.permissionId,
          unitID: n3.unitId,
          objectType: x4.SelectRange,
          actions: pt2
        }).then((e) => {
          this._rangeProtectionRuleModel.getRule(n3.unitId, n3.subUnitId, n3.rule.id) && (Ee4().forEach((s2) => {
            if (n3.type === "set") {
              const { rule: u2, oldRule: l4 } = n3;
              if (u2.permissionId === (l4 == null ? void 0 : l4.permissionId))
                return;
            }
            const o3 = n3.rule, r = new s2(o3.unitId, o3.subUnitId, o3.permissionId), i = r.subType, a4 = e.find((u2) => u2.action === i);
            a4 && this._permissionService.updatePermissionPoint(r.id, a4.allowed);
          }), this._rangeProtectionRuleModel.ruleRefresh(n3.rule.permissionId));
        }) : this._rangeProtectionRuleModel.getSubunitRuleList(n3.unitId, n3.subUnitId).length === 0 && (this._worksheetProtectionPointRuleModel.deleteRule(n3.unitId, n3.subUnitId), [...He2()].forEach((t3) => {
          const s2 = new t3(n3.unitId, n3.subUnitId);
          this._permissionService.updatePermissionPoint(s2.id, s2.value);
        }));
      })
    );
  }
  initWorkbookPermissionChange(n3) {
    return __async(this, null, function* () {
      var t3;
      const e = n3 || ((t3 = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET)) == null ? void 0 : t3.getUnitId());
      if (e)
        return this._authzIoService.allowed({
          objectID: e,
          objectType: x4.Workbook,
          unitID: e,
          actions: id2
        }).then((s2) => {
          gn2().forEach((o3) => {
            const r = new o3(e), i = r.subType, a4 = s2.find((u2) => u2.action === i);
            a4 && this._permissionService.updatePermissionPoint(r.id, a4.allowed);
          });
        });
    });
  }
  _initWorkbookPermissionFromSnapshot() {
    return __async(this, null, function* () {
      yield Promise.all(this._univerInstanceService.getAllUnitsForType(we.UNIVER_SHEET).map((n3) => this.initWorkbookPermissionChange(n3.getUnitId()))), this._workbookPermissionService.changeUnitInitState(true);
    });
  }
  _initWorksheetPermissionChange() {
    this.disposeWithMe(
      this._worksheetProtectionRuleModel.ruleChange$.subscribe((n3) => {
        n3.type !== "delete" ? this._authzIoService.allowed({
          objectID: n3.rule.permissionId,
          unitID: n3.unitId,
          objectType: x4.Worksheet,
          actions: pt2
        }).then((e) => {
          const t3 = this._worksheetProtectionRuleModel.getRule(n3.unitId, n3.subUnitId);
          !t3 || t3.permissionId !== n3.rule.permissionId || (be3().forEach((s2) => {
            const o3 = new s2(n3.unitId, n3.subUnitId), r = o3.subType, i = e.find((a4) => a4.action === r);
            i && this._permissionService.updatePermissionPoint(o3.id, i.allowed);
          }), this._worksheetProtectionRuleModel.ruleRefresh(n3.rule.permissionId));
        }) : ([...be3(), ...He2()].forEach((e) => {
          const t3 = new e(n3.unitId, n3.subUnitId);
          this._permissionService.updatePermissionPoint(t3.id, true);
        }), this._worksheetProtectionPointRuleModel.deleteRule(n3.unitId, n3.subUnitId));
      })
    );
  }
  _initWorksheetPermissionPointsChange() {
    this.disposeWithMe(
      this._worksheetProtectionPointRuleModel.pointChange$.subscribe((n3) => {
        this._authzIoService.allowed({
          objectID: n3.permissionId,
          unitID: n3.unitId,
          objectType: x4.Worksheet,
          actions: ws
        }).then((e) => {
          const t3 = this._worksheetProtectionPointRuleModel.getRule(n3.unitId, n3.subUnitId);
          !t3 || t3.permissionId !== n3.permissionId || He2().forEach((s2) => {
            const o3 = new s2(n3.unitId, n3.subUnitId), r = o3.subType, i = e.find((a4) => a4.action === r);
            i && this._permissionService.updatePermissionPoint(o3.id, i.allowed);
          });
        });
      })
    );
  }
  _initWorksheetPermissionFromSnapshot() {
    return __async(this, null, function* () {
      const n3 = (e) => __async(this, null, function* () {
        const t3 = [], s2 = e.getUnitId(), o3 = e.getSheets(), r = /* @__PURE__ */ new Map();
        if (o3.forEach((i) => {
          const a4 = i.getSheetId(), u2 = this._worksheetProtectionRuleModel.getRule(s2, a4);
          u2 && (r.set(u2.permissionId, u2), t3.push({
            objectID: u2.permissionId,
            unitID: s2,
            objectType: x4.Worksheet,
            actions: pt2
          }));
          const l4 = this._worksheetProtectionPointRuleModel.getRule(s2, a4);
          l4 && (r.set(l4.permissionId, l4), t3.push({
            objectID: l4.permissionId,
            unitID: s2,
            objectType: x4.Worksheet,
            actions: ws
          }));
        }), !t3.length) {
          this._worksheetProtectionRuleModel.changeRuleInitState(true);
          return;
        }
        this._authzIoService.batchAllowed(t3).then((i) => {
          i.forEach((a4) => {
            const u2 = r.get(a4.objectID);
            if (u2) {
              const l4 = this._worksheetProtectionRuleModel.getRule(s2, u2.subUnitId) || this._worksheetProtectionPointRuleModel.getRule(s2, u2.subUnitId);
              if (!l4 || l4.permissionId !== a4.objectID)
                return;
              [...be3(), ...He2()].forEach((c2) => {
                const d2 = new c2(s2, u2.subUnitId), h9 = d2.subType, g9 = a4.actions.find((m9) => m9.action === h9);
                (g9 == null ? void 0 : g9.allowed) !== void 0 && this._permissionService.updatePermissionPoint(d2.id, g9.allowed);
              });
            }
          }), this._worksheetProtectionRuleModel.changeRuleInitState(true);
        });
      });
      yield Promise.all(this._univerInstanceService.getAllUnitsForType(we.UNIVER_SHEET).map((e) => n3(e))), this._worksheetProtectionRuleModel.changeRuleInitState(true);
    });
  }
  _initUserChange() {
    this.disposeWithMe(
      // When the user changes, the permission points are updated. The first modification needs to be filtered here because it is a Behavior type, but in fact the user information is ready when this controller is initialized.
      this._userManagerService.currentUser$.pipe(skip(1)).subscribe(() => {
        const n3 = this._permissionService.getAllPermissionPoint();
        this._permissionService.clearPermissionMap(), this._worksheetProtectionRuleModel.changeRuleInitState(false), this._univerInstanceService.getAllUnitsForType(we.UNIVER_SHEET).forEach((t3) => {
          const s2 = t3.getUnitId();
          gn2().forEach((o3) => {
            let r = new o3(s2);
            n3.has(r.id) && (r = n3.get(r.id)), this._permissionService.addPermissionPoint(r);
          }), t3.getSheets().forEach((o3) => {
            const r = o3.getSheetId();
            [...be3(), ...He2()].forEach((a4) => {
              let u2 = new a4(s2, r);
              n3.has(u2.id) && (u2 = n3.get(u2.id)), this._permissionService.addPermissionPoint(u2);
            }), this._rangeProtectionRuleModel.getSubunitRuleList(s2, r).forEach((a4) => {
              Ee4().forEach((u2) => {
                let l4 = new u2(s2, r, a4.permissionId);
                n3.has(l4.id) && (l4 = n3.get(l4.id)), this._permissionService.addPermissionPoint(l4);
              });
            });
          }), this._initWorkbookPermissionFromSnapshot(), this._initWorksheetPermissionFromSnapshot(), this._initRangePermissionFromSnapshot();
        });
      })
    );
  }
  refreshPermission(n3, e) {
    const t3 = this._worksheetProtectionRuleModel.getTargetByPermissionId(n3, e);
    let s2 = false;
    if (t3) {
      const [i, a4] = t3;
      this._authzIoService.allowed({
        objectID: e,
        unitID: n3,
        objectType: x4.Worksheet,
        actions: pt2
      }).then((u2) => {
        if (!this._worksheetProtectionRuleModel.getTargetByPermissionId(n3, e))
          return;
        let c2 = "";
        be3().forEach((d2) => {
          var f4;
          const h9 = new d2(n3, a4), g9 = h9.subType, m9 = u2.find((C) => C.action === g9);
          m9 && (((f4 = this._permissionService.getPermissionPoint(h9.id)) == null ? void 0 : f4.value) !== m9.allowed && (s2 = true), this._permissionService.updatePermissionPoint(h9.id, m9.allowed), c2 += `${m9.action}_${m9.allowed}`);
        }), this._worksheetProtectionRuleModel.ruleRefresh(`${e}_${c2}`), s2 && this._undoRedoService.clearUndoRedo(n3);
      });
    }
    const o3 = this._worksheetProtectionPointRuleModel.getTargetByPermissionId(n3, e);
    if (o3) {
      const [i, a4] = o3;
      this._authzIoService.allowed({
        objectID: e,
        unitID: n3,
        objectType: x4.Worksheet,
        actions: ws
      }).then((u2) => {
        this._worksheetProtectionPointRuleModel.getTargetByPermissionId(n3, e) && (He2().forEach((c2) => {
          var m9;
          const d2 = new c2(n3, a4), h9 = d2.subType, g9 = u2.find((f4) => f4.action === h9);
          g9 && (((m9 = this._permissionService.getPermissionPoint(d2.id)) == null ? void 0 : m9.value) !== g9.allowed && (s2 = true), this._permissionService.updatePermissionPoint(d2.id, g9.allowed));
        }), s2 && this._undoRedoService.clearUndoRedo(n3));
      });
    }
    const r = this._rangeProtectionRuleModel.getTargetByPermissionId(n3, e);
    if (r) {
      const [i, a4] = r;
      this._authzIoService.allowed({
        objectID: e,
        unitID: n3,
        objectType: x4.SelectRange,
        actions: pt2
      }).then((u2) => {
        if (!this._rangeProtectionRuleModel.getTargetByPermissionId(n3, e))
          return;
        let c2 = "";
        Ee4().forEach((d2) => {
          var f4;
          const h9 = new d2(n3, a4, e), g9 = h9.subType, m9 = u2.find((C) => C.action === g9);
          m9 && (((f4 = this._permissionService.getPermissionPoint(h9.id)) == null ? void 0 : f4.value) !== m9.allowed && (s2 = true), this._permissionService.updatePermissionPoint(h9.id, m9.allowed), c2 += `${m9.action}_${m9.allowed}`);
        }), this._rangeProtectionRuleModel.ruleRefresh(`${e}_${c2}`), s2 && this._undoRedoService.clearUndoRedo(n3);
      });
    }
  }
  _refreshPermissionByCollaCreate() {
    this.disposeWithMe(
      this._commandService.onCommandExecuted((n3, e) => {
        if (e != null && e.fromCollab && (n3.id === Be3.id || n3.id === Mt2.id || n3.id === to2.id)) {
          const t3 = n3.params;
          this._undoRedoService.clearUndoRedo(t3.unitId);
        }
      })
    );
  }
};
Xn3 = Ld([
  Ge4(0, br),
  Ge4(1, aC),
  Ge4(2, _E),
  Ge4(3, Inject(me)),
  Ge4(4, Inject(lt3)),
  Ge4(5, Inject(Is)),
  Ge4(6, Inject(vn2)),
  Ge4(7, Inject(mn2)),
  Ge4(8, Inject(ra)),
  Ge4(9, Inject(Ds))
], Xn3);
var Hd = Object.getOwnPropertyDescriptor;
var Fd2 = (n3, e, t3, s2) => {
  for (var o3 = s2 > 1 ? void 0 : s2 ? Hd(e, t3) : e, r = n3.length - 1, i; r >= 0; r--)
    (i = n3[r]) && (o3 = i(o3) || o3);
  return o3;
};
var Ms2 = (n3, e) => (t3, s2) => e(t3, s2, n3);
var Zn = class extends Ve {
  constructor(e, t3, s2) {
    super();
    R(this, "_zebraCacheUpdateSubject", new Subject());
    this._commandService = e, this._sheetRangeThemeModel = t3, this._univerInstanceService = s2, this._init();
  }
  _init() {
    this._initializeCommandListener(), this._initTriggerCacheUpdateListener();
  }
  /**
   * Update the zebra crossing cache for a specific unit and sub-unit.
   * @param {string} unitId - The ID of the unit.
   * @param {string} subUnitId - The ID of the sub-unit.
   */
  updateZebraCrossingCache(e, t3) {
    this._zebraCacheUpdateSubject.next({ unitId: e, subUnitId: t3 });
  }
  _initializeCommandListener() {
    this.disposeWithMe(this._commandService.onCommandExecuted((e) => {
      const { id: t3 } = e;
      let s2, o3;
      switch (t3) {
        case ke2.id:
          {
            const r = e.params;
            s2 = r.unitId, o3 = r.subUnitId;
          }
          break;
        case Ut2.id:
          {
            const r = e.params;
            s2 = r.unitId, o3 = r.subUnitId;
          }
          break;
        case Tt.id:
          {
            const r = e.params;
            s2 = r.unitId, o3 = r.subUnitId;
          }
          break;
        case Te.id:
          {
            const r = e.params;
            s2 = r.unitId, o3 = r.subUnitId;
          }
          break;
        case nt2.id:
          {
            const r = e.params;
            s2 = r.unitId, o3 = r.subUnitId;
          }
          break;
      }
      s2 && o3 && (this._sheetRangeThemeModel.refreshSheetRowVisibleFuncSet(s2, o3), this._sheetRangeThemeModel.refreshZebraCrossingCacheBySheet(s2, o3));
    }));
  }
  _initTriggerCacheUpdateListener() {
    this.disposeWithMe(
      this._zebraCacheUpdateSubject.subscribe(({ unitId: e, subUnitId: t3 }) => {
        this._sheetRangeThemeModel.refreshSheetRowVisibleFuncSet(e, t3), this._sheetRangeThemeModel.refreshZebraCrossingCacheBySheet(e, t3);
      })
    );
  }
};
Zn = Fd2([
  Ms2(0, Inject(Ds)),
  Ms2(1, Inject(ve2)),
  Ms2(2, Inject(br))
], Zn);
var Bd2 = Object.getOwnPropertyDescriptor;
var jd = (n3, e, t3, s2) => {
  for (var o3 = s2 > 1 ? void 0 : s2 ? Bd2(e, t3) : e, r = n3.length - 1, i; r >= 0; r--)
    (i = n3[r]) && (o3 = i(o3) || o3);
  return o3;
};
var ko3 = (n3, e) => (t3, s2) => e(t3, s2, n3);
var fn2 = class {
  constructor(n3, e) {
    R(this, "_cache", new _s(1e4));
    this._selectionProtectionRuleModel = n3, this._permissionService = e, this._init();
  }
  _init() {
    this._permissionService.permissionPointUpdate$.pipe(
      filter((n3) => n3.type === x4.SelectRange),
      filter((n3) => Ee4().some((e) => n3 instanceof e)),
      map((n3) => n3)
    ).subscribe((n3) => {
      const e = this._selectionProtectionRuleModel.getSubunitRuleList(n3.unitId, n3.subUnitId);
      for (const t3 of e)
        t3.permissionId === n3.permissionId && t3.ranges.forEach((s2) => {
          vr.foreach(s2, (o3, r) => {
            const i = this._createKey(n3.unitId, n3.subUnitId, o3, r);
            this._cache.delete(i);
          });
        });
    }), this._selectionProtectionRuleModel.ruleChange$.subscribe((n3) => {
      var e;
      n3.rule.ranges.forEach((t3) => {
        vr.foreach(t3, (s2, o3) => {
          const r = this._createKey(n3.unitId, n3.subUnitId, s2, o3);
          this._cache.delete(r);
        });
      }), n3.type === "set" && ((e = n3.oldRule) == null || e.ranges.forEach((t3) => {
        vr.foreach(t3, (s2, o3) => {
          const r = this._createKey(n3.unitId, n3.subUnitId, s2, o3);
          this._cache.delete(r);
        });
      }));
    });
  }
  _createKey(n3, e, t3, s2) {
    return `${n3}_${e}_${t3}_${s2}`;
  }
  getCellInfo(n3, e, t3, s2) {
    const o3 = this._selectionProtectionRuleModel.getSubunitRuleList(n3, e), r = [];
    if (!o3 || !o3.length)
      return r;
    const i = this._createKey(n3, e, t3, s2), a4 = this._cache.get(i);
    if (a4)
      return a4;
    const u2 = [];
    for (const l4 of o3)
      if (l4.ranges.some((c2) => c2.startRow <= t3 && c2.endRow >= t3 && c2.startColumn <= s2 && c2.endColumn >= s2)) {
        const c2 = Ee4().reduce((d2, h9) => {
          var f4;
          const g9 = new h9(n3, e, l4.permissionId), m9 = this._permissionService.getPermissionPoint(g9.id);
          return d2[g9.subType] = (f4 = m9 == null ? void 0 : m9.value) != null ? f4 : g9.value, d2;
        }, {});
        u2.push(__spreadProps(__spreadValues({}, c2), { ruleId: l4.id, ranges: l4.ranges }));
      }
    return this._cache.set(i, u2), u2;
  }
  clear() {
    this._cache.clear();
  }
};
fn2 = jd([
  ko3(0, Inject(me)),
  ko3(1, Inject(aC))
], fn2);
var zd = Object.getOwnPropertyDescriptor;
var Gd = (n3, e, t3, s2) => {
  for (var o3 = s2 > 1 ? void 0 : s2 ? zd(e, t3) : e, r = n3.length - 1, i; r >= 0; r--)
    (i = n3[r]) && (o3 = i(o3) || o3);
  return o3;
};
var _s2 = (n3, e) => (t3, s2) => e(t3, s2, n3);
var Wt2 = class extends Ve {
  constructor(e, t3, s2) {
    super();
    R(this, "_cellRuleCache", /* @__PURE__ */ new Map());
    R(this, "_permissionIdCache", /* @__PURE__ */ new Map());
    R(this, "_cellInfoCache", /* @__PURE__ */ new Map());
    R(this, "_rowInfoCache", /* @__PURE__ */ new Map());
    R(this, "_colInfoCache", /* @__PURE__ */ new Map());
    this._ruleModel = e, this._permissionService = t3, this._univerInstanceService = s2, this._initUpdateCellRuleCache(), this._initUpdateCellInfoCache(), this._initUpdateRowColInfoCache(), this._initCache();
  }
  _initCache() {
    this._univerInstanceService.getAllUnitsForType(we.UNIVER_SHEET).forEach((e) => {
      e.getSheets().forEach((t3) => {
        const s2 = e.getUnitId(), o3 = t3.getSheetId();
        this.reBuildCache(s2, o3);
      });
    });
  }
  _initUpdateCellInfoCache() {
    this._permissionService.permissionPointUpdate$.pipe(
      filter((e) => e.type === x4.SelectRange),
      map((e) => e)
    ).subscribe((e) => {
      const { subUnitId: t3, unitId: s2, permissionId: o3 } = e, r = this._permissionIdCache.get(o3);
      if (!r)
        return;
      const i = this._ruleModel.getRule(s2, t3, r);
      if (!i)
        return;
      const a4 = this._ensureCellInfoMap(s2, t3);
      i.ranges.forEach((u2) => {
        const { startRow: l4, endRow: c2, startColumn: d2, endColumn: h9 } = u2;
        for (let g9 = l4; g9 <= c2; g9++)
          for (let m9 = d2; m9 <= h9; m9++)
            a4.delete(`${g9}-${m9}`);
      });
    }), this._ruleModel.ruleChange$.subscribe((e) => {
      var r;
      const { unitId: t3, subUnitId: s2 } = e, o3 = this._ensureCellInfoMap(t3, s2);
      e.rule.ranges.forEach((i) => {
        vr.foreach(i, (a4, u2) => {
          o3.delete(`${a4}-${u2}`);
        });
      }), e.type === "set" && ((r = e.oldRule) == null || r.ranges.forEach((i) => {
        vr.foreach(i, (a4, u2) => {
          this._cellInfoCache.delete(`${a4}-${u2}`);
        });
      }));
    });
  }
  _initUpdateCellRuleCache() {
    this._ruleModel.ruleChange$.subscribe((e) => {
      const { type: t3 } = e;
      t3 === "add" ? this._addCellRuleCache(e) : t3 === "delete" ? this._deleteCellRuleCache(e) : (this._deleteCellRuleCache(__spreadProps(__spreadValues({}, e), { rule: e.oldRule })), this._addCellRuleCache(e));
    });
  }
  _ensureRuleMap(e, t3) {
    let s2 = this._cellRuleCache.get(e);
    s2 || (s2 = /* @__PURE__ */ new Map(), this._cellRuleCache.set(e, s2));
    let o3 = s2.get(t3);
    return o3 || (o3 = /* @__PURE__ */ new Map(), s2.set(t3, o3)), o3;
  }
  _ensureCellInfoMap(e, t3) {
    let s2 = this._cellInfoCache.get(e);
    s2 || (s2 = /* @__PURE__ */ new Map(), this._cellInfoCache.set(e, s2));
    let o3 = s2.get(t3);
    return o3 || (o3 = /* @__PURE__ */ new Map(), s2.set(t3, o3)), o3;
  }
  _ensureRowColInfoMap(e, t3, s2) {
    let o3 = s2 === "row" ? this._rowInfoCache.get(e) : this._colInfoCache.get(e);
    o3 || (o3 = /* @__PURE__ */ new Map(), s2 === "row" ? this._rowInfoCache.set(e, o3) : this._colInfoCache.set(e, o3));
    let r = o3.get(t3);
    return r || (r = /* @__PURE__ */ new Map(), o3.set(t3, r)), r;
  }
  _addCellRuleCache(e) {
    const { subUnitId: t3, unitId: s2, rule: o3 } = e, r = this._ensureRuleMap(s2, t3);
    o3.ranges.forEach((i) => {
      const { startRow: a4, endRow: u2, startColumn: l4, endColumn: c2 } = i;
      for (let d2 = a4; d2 <= u2; d2++)
        for (let h9 = l4; h9 <= c2; h9++)
          r.set(`${d2}-${h9}`, o3.id);
    }), this._permissionIdCache.set(o3.permissionId, o3.id);
  }
  _deleteCellRuleCache(e) {
    const { subUnitId: t3, unitId: s2, rule: o3 } = e, r = this._ensureRuleMap(s2, t3), i = this._ensureCellInfoMap(s2, t3);
    o3.ranges.forEach((a4) => {
      const { startRow: u2, endRow: l4, startColumn: c2, endColumn: d2 } = a4;
      for (let h9 = u2; h9 <= l4; h9++)
        for (let g9 = c2; g9 <= d2; g9++)
          r.delete(`${h9}-${g9}`), i.delete(`${h9}-${g9}`);
    }), this._permissionIdCache.delete(o3.permissionId);
  }
  _getSelectionActions(e, t3, s2) {
    var l4, c2, d2, h9, g9, m9, f4, C, p3, w6, S, I6;
    const o3 = (d2 = (c2 = this._permissionService.getPermissionPoint((l4 = new Ve4(e, t3, s2.permissionId)) == null ? void 0 : l4.id)) == null ? void 0 : c2.value) != null ? d2 : false, r = (m9 = (g9 = this._permissionService.getPermissionPoint((h9 = new Bs2(e, t3, s2.permissionId)) == null ? void 0 : h9.id)) == null ? void 0 : g9.value) != null ? m9 : false, i = (p3 = (C = this._permissionService.getPermissionPoint((f4 = new hi(e, t3, s2.permissionId)) == null ? void 0 : f4.id)) == null ? void 0 : C.value) != null ? p3 : false, a4 = (I6 = (S = this._permissionService.getPermissionPoint((w6 = new di(e, t3, s2.permissionId)) == null ? void 0 : w6.id)) == null ? void 0 : S.value) != null ? I6 : false;
    return {
      [_.Edit]: o3,
      [_.View]: r,
      [_.ManageCollaborator]: i,
      [_.Delete]: a4
    };
  }
  reBuildCache(e, t3) {
    const s2 = this._ensureRuleMap(e, t3), o3 = this._ensureCellInfoMap(e, t3);
    s2.clear(), o3.clear();
    const r = this._ensureRowColInfoMap(e, t3, "row"), i = this._ensureRowColInfoMap(e, t3, "col");
    r.clear(), i.clear(), this._ruleModel.getSubunitRuleList(e, t3).forEach((a4) => {
      const u2 = this._getSelectionActions(e, t3, a4), l4 = __spreadProps(__spreadValues({}, u2), {
        ruleId: a4.id,
        ranges: a4.ranges
      });
      a4.ranges.forEach((c2) => {
        const { startRow: d2, endRow: h9, startColumn: g9, endColumn: m9 } = c2;
        for (let f4 = d2; f4 <= h9; f4++) {
          const C = r.get(`${f4}`);
          C ? C.set(a4.id, u2) : r.set(`${f4}`, /* @__PURE__ */ new Map([[a4.id, u2]]));
          for (let p3 = g9; p3 <= m9; p3++) {
            s2.set(`${f4}-${p3}`, a4.id), o3.set(`${f4}-${p3}`, l4);
            const w6 = i.get(`${p3}`);
            w6 ? w6.set(a4.id, u2) : i.set(`${p3}`, /* @__PURE__ */ new Map([[a4.id, u2]]));
          }
        }
      }), this._permissionIdCache.set(a4.permissionId, a4.id);
    });
  }
  getRowPermissionInfo(e, t3, s2, o3) {
    var a4;
    const r = (a4 = this._rowInfoCache.get(e)) == null ? void 0 : a4.get(t3);
    if (!r)
      return true;
    const i = r.get(`${s2}`);
    return i ? o3.every((u2) => {
      for (const l4 of i.values())
        if (l4[u2] === false)
          return false;
      return true;
    }) : true;
  }
  getColPermissionInfo(e, t3, s2, o3) {
    var a4;
    const r = (a4 = this._colInfoCache.get(e)) == null ? void 0 : a4.get(t3);
    if (!r)
      return true;
    const i = r.get(`${s2}`);
    return i ? o3.every((u2) => {
      for (const l4 of i.values())
        if (l4[u2] === false)
          return false;
      return true;
    }) : true;
  }
  _initUpdateRowColInfoCache() {
    this._permissionService.permissionPointUpdate$.pipe(
      filter((e) => e.type === x4.SelectRange),
      map((e) => e)
    ).subscribe({
      next: (e) => {
        const { subUnitId: t3, unitId: s2, permissionId: o3 } = e, r = this._permissionIdCache.get(o3);
        if (!r)
          return;
        const i = this._ruleModel.getRule(s2, t3, r);
        if (!i)
          return;
        const a4 = this._ensureRowColInfoMap(s2, t3, "row"), u2 = this._ensureRowColInfoMap(s2, t3, "col"), l4 = this._getSelectionActions(s2, t3, i);
        i.ranges.forEach((c2) => {
          const { startRow: d2, endRow: h9, startColumn: g9, endColumn: m9 } = c2;
          for (let f4 = d2; f4 <= h9; f4++) {
            const C = a4.get(`${f4}`);
            C ? C.set(r, l4) : a4.set(`${f4}`, /* @__PURE__ */ new Map([[r, l4]]));
            for (let p3 = g9; p3 <= m9; p3++) {
              const w6 = u2.get(`${p3}`);
              w6 ? w6.set(r, l4) : u2.set(`${p3}`, /* @__PURE__ */ new Map([[r, l4]]));
            }
          }
        });
      }
    }), this._ruleModel.ruleChange$.subscribe((e) => {
      if (e.type === "delete") {
        const { unitId: t3, subUnitId: s2, rule: o3 } = e, r = this._ensureRowColInfoMap(t3, s2, "row"), i = this._ensureRowColInfoMap(t3, s2, "col");
        o3.ranges.forEach((a4) => {
          const { startRow: u2, endRow: l4, startColumn: c2, endColumn: d2 } = a4;
          for (let h9 = u2; h9 <= l4; h9++) {
            const g9 = r.get(`${h9}`);
            g9 == null || g9.delete(o3.id);
            for (let m9 = c2; m9 <= d2; m9++) {
              const f4 = i.get(`${m9}`);
              f4 == null || f4.delete(o3.id);
            }
          }
        });
      }
    });
  }
  getCellInfo(e, t3, s2, o3) {
    var l4, c2;
    const r = this._ensureCellInfoMap(e, t3), i = r.get(`${s2}-${o3}`);
    if (i)
      return i;
    const a4 = (c2 = (l4 = this._cellRuleCache.get(e)) == null ? void 0 : l4.get(t3)) == null ? void 0 : c2.get(`${s2}-${o3}`);
    if (!a4)
      return;
    const u2 = this._ruleModel.getRule(e, t3, a4);
    if (u2) {
      const h9 = __spreadProps(__spreadValues({}, this._getSelectionActions(e, t3, u2)), {
        ruleId: a4,
        ranges: u2.ranges
      });
      return r.set(`${s2}-${o3}`, h9), h9;
    }
  }
  deleteUnit(e) {
    this._cellRuleCache.delete(e), this._cellInfoCache.delete(e), this._rowInfoCache.delete(e), this._colInfoCache.delete(e);
    const t3 = this._univerInstanceService.getUnit(e);
    t3 == null || t3.getSheets().forEach((s2) => {
      const o3 = s2.getSheetId();
      this._ruleModel.getSubunitRuleList(e, o3).forEach((r) => {
        this._permissionIdCache.delete(r.permissionId);
      });
    });
  }
};
Wt2 = Gd([
  _s2(0, Inject(me)),
  _s2(1, Inject(aC)),
  _s2(2, Inject(br))
], Wt2);
var fi2 = "ONLY_REGISTER_FORMULA_RELATED_MUTATIONS_KEY";
var Kd2 = Object.getOwnPropertyDescriptor;
var Jd2 = (n3, e, t3, s2) => {
  for (var o3 = s2 > 1 ? void 0 : s2 ? Kd2(e, t3) : e, r = n3.length - 1, i; r >= 0; r--)
    (i = n3[r]) && (o3 = i(o3) || o3);
  return o3;
};
var ys2 = (n3, e) => (t3, s2) => e(t3, s2, n3);
var Qn = class extends Ve {
  // eslint-disable-next-line max-lines-per-function
  constructor(n3, e, t3) {
    var o3;
    super(), this._commandService = n3, this._configService = e, this._dataSyncPrimaryController = t3, [
      ee2,
      Ue2,
      ke2,
      ln,
      wt2,
      Je3,
      qe2,
      Me,
      Te,
      Lt2,
      se2,
      mi,
      ne,
      ii,
      jn3,
      so2,
      On2,
      wd,
      Tt,
      // formula SUBTOTAL
      Ut2,
      Id,
      vd,
      Yr
    ].forEach((r) => {
      var i;
      this._commandService.registerCommand(r), (i = this._dataSyncPrimaryController) == null || i.registerSyncingMutations(r);
    }), ((o3 = this._configService.getConfig(fi2)) != null ? o3 : false) || [
      ac,
      Ls2,
      Ys,
      Hs2,
      gc,
      It2,
      vt2,
      Fn4,
      Gn,
      ll,
      ul,
      cl,
      dl,
      $r2,
      Xe6,
      Pt4,
      rn,
      rl,
      ol,
      al,
      il,
      Ar,
      Ye3,
      Sc,
      un,
      yt2,
      an,
      Wr2,
      gs,
      Vr2,
      hs,
      Zs,
      ks,
      Ic,
      Kc3,
      zc2,
      Gc,
      Nc,
      Pc,
      In2,
      Uc,
      Tc,
      Us,
      sn,
      on,
      Bn4,
      Oc,
      zt,
      xc,
      st2,
      $c,
      qc2,
      Sn2,
      Kn,
      Ts3,
      Lc,
      Kt2,
      ei,
      oi,
      dn,
      hn,
      Ce,
      Qc,
      Un4,
      jc,
      Xc2,
      Yc2,
      Jc2,
      ai,
      ui,
      pn,
      sd2,
      St2,
      eo2,
      ci,
      Tn2,
      er2,
      nt2,
      no,
      Fe3,
      mt2,
      // SetWorksheetColIsAutoWidthCommand,
      md,
      Yt2,
      td,
      Jt2,
      qu,
      ie5,
      yd,
      pc,
      Qr2,
      ni,
      gi,
      Cd,
      Xt2,
      Wc,
      Gt,
      // permissions range protection
      dd,
      Mt2,
      bt2,
      xt,
      to2,
      $u,
      Vc2,
      fc,
      oc,
      Rc,
      hd,
      Be3,
      ot2,
      fe3,
      Rd2,
      qt,
      nd2,
      fd,
      // range theme
      nn2,
      tn,
      Xs,
      cn,
      pd,
      wc,
      rc,
      Cc,
      Sd,
      _d,
      Md2
    ].forEach((r) => this.disposeWithMe(this._commandService.registerCommand(r))), this._configService.setConfig(bd, Ed);
  }
};
Qn = Jd2([
  ys2(0, Ds),
  ys2(1, xs),
  ys2(2, Optional(y))
], Qn);
var qd2 = Object.getOwnPropertyDescriptor;
var Yd = (n3, e, t3, s2) => {
  for (var o3 = s2 > 1 ? void 0 : s2 ? qd2(e, t3) : e, r = n3.length - 1, i; r >= 0; r--)
    (i = n3[r]) && (o3 = i(o3) || o3);
  return o3;
};
var Uo3 = (n3, e) => (t3, s2) => e(t3, s2, n3);
var es = class extends Ve {
  constructor(n3, e) {
    super(), this._univerInstanceService = n3, this._commandService = e, this._initialize();
  }
  _initialize() {
    this.disposeWithMe(
      this._commandService.onCommandExecuted((n3) => {
        if (n3.id !== Mo2.id)
          return;
        const e = n3.params, { unitData: t3 } = e, s2 = Object.keys(t3), o3 = [];
        for (let i = 0; i < s2.length; i++) {
          const a4 = s2[i], u2 = t3[a4];
          if (u2 == null)
            continue;
          const l4 = Object.keys(u2);
          for (let c2 = 0; c2 < l4.length; c2++) {
            const d2 = l4[c2], h9 = u2[d2];
            if (h9 == null)
              continue;
            const g9 = this._getMergedCellData(a4, d2, h9), m9 = {
              subUnitId: d2,
              unitId: a4,
              cellValue: g9
            };
            o3.push({
              id: ee2.id,
              params: m9
            });
          }
        }
        return o3.every(
          (i) => this._commandService.executeCommand(i.id, i.params, {
            onlyLocal: true,
            fromFormula: true
          })
        );
      })
    );
  }
  /**
   * Priority that mainly deals with number format in unitData
   * @param unitId
   * @param sheetId
   * @param cellData
   * @returns
   */
  _getMergedCellData(n3, e, t3) {
    const s2 = this._univerInstanceService.getUniverSheetInstance(n3), o3 = s2 == null ? void 0 : s2.getStyles(), r = s2 == null ? void 0 : s2.getSheetBySheetId(e), i = r == null ? void 0 : r.getCellMatrix(), a4 = new ht(t3);
    return a4.forValue((u2, l4, c2) => {
      const d2 = i == null ? void 0 : i.getValue(u2, l4), h9 = Yb(d2, c2, o3);
      a4.setValue(u2, l4, h9);
    }), a4.getMatrix();
  }
};
es = Yd([
  Uo3(0, Inject(br)),
  Uo3(1, Ds)
], es);
var Xd = Object.getOwnPropertyDescriptor;
var Zd2 = (n3, e, t3, s2) => {
  for (var o3 = s2 > 1 ? void 0 : s2 ? Xd(e, t3) : e, r = n3.length - 1, i; r >= 0; r--)
    (i = n3[r]) && (o3 = i(o3) || o3);
  return o3;
};
var Qd2 = (n3, e) => (t3, s2) => e(t3, s2, n3);
var ts = class extends Ve {
  constructor(n3) {
    super(), this._sheetInterceptorService = n3, this._initialize();
  }
  _initialize() {
    this._initInterceptorCellContent();
  }
  _initInterceptorCellContent() {
    this.disposeWithMe(
      this._sheetInterceptorService.intercept(ht2.CELL_CONTENT, {
        priority: 11,
        effect: ir.Value | ir.Style,
        handler: (n3, e, t3) => {
          var o3;
          if (!n3)
            return t3(n3);
          const s2 = e.workbook.getStyles().getStyleByCell(n3);
          return u1((o3 = s2 == null ? void 0 : s2.n) == null ? void 0 : o3.pattern) && (n3 == null ? void 0 : n3.t) === mn.NUMBER && n3.v !== void 0 && n3.v !== null && s1(n3.v) && ((!n3 || n3 === e.rawData) && (n3 = __spreadValues({}, e.rawData)), n3.v = Sa2(Number(n3.v))), t3(n3);
        }
      })
    );
  }
};
ts = Zd2([
  Qd2(0, Inject(G))
], ts);
var eh = Object.getOwnPropertyDescriptor;
var th = (n3, e, t3, s2) => {
  for (var o3 = s2 > 1 ? void 0 : s2 ? eh(e, t3) : e, r = n3.length - 1, i; r >= 0; r--)
    (i = n3[r]) && (o3 = i(o3) || o3);
  return o3;
};
var bn2 = (n3, e) => (t3, s2) => e(t3, s2, n3);
var ns = class extends Ve {
  constructor(n3, e, t3, s2) {
    super(), this._permissionService = n3, this._worksheetProtectionRuleModel = e, this._sheetInterceptorService = t3, this._rangeProtectionCache = s2, this._initViewModelByRangeInterceptor(), this._initViewModelBySheetInterceptor();
  }
  _initViewModelByRangeInterceptor() {
    this.disposeWithMe(this._sheetInterceptorService.intercept(ht2.CELL_CONTENT, {
      // permissions are placed at a high level to prioritize whether to filter subsequent renderings.
      priority: 999,
      effect: ir.Value | ir.Style,
      handler: (n3, e, t3) => {
        const { unitId: s2, subUnitId: o3, row: r, col: i } = e, a4 = this._rangeProtectionCache.getCellInfo(s2, o3, r, i);
        if (a4) {
          const u2 = a4[_.View] === false, l4 = !n3 || n3 === e.rawData ? __spreadValues({}, e.rawData) : n3;
          return l4.selectionProtection = [a4], u2 ? (delete l4.s, delete l4.v, delete l4.p, l4) : t3(l4);
        }
        return t3(n3);
      }
    }));
  }
  _initViewModelBySheetInterceptor() {
    this.disposeWithMe(this._sheetInterceptorService.intercept(ht2.CELL_CONTENT, {
      // permissions are placed at a high level to prioritize whether to filter subsequent renderings.
      priority: 999,
      effect: ir.Value | ir.Style,
      handler: (n3, e, t3) => {
        var i, a4, u2, l4, c2;
        const { unitId: s2, subUnitId: o3 } = e, r = this._worksheetProtectionRuleModel.getRule(s2, o3);
        if (r != null && r.permissionId) {
          const d2 = [{
            [_.View]: (a4 = (i = this._permissionService.getPermissionPoint(new ds(s2, o3).id)) == null ? void 0 : i.value) != null ? a4 : false,
            [_.Edit]: (l4 = (u2 = this._permissionService.getPermissionPoint(new Le2(s2, o3).id)) == null ? void 0 : u2.value) != null ? l4 : false
          }], h9 = !((c2 = d2[0]) != null && c2[_.View]), g9 = !n3 || n3 === e.rawData ? __spreadValues({}, n3) : n3;
          return g9.hasWorksheetRule = true, g9.selectionProtection = d2, h9 ? (delete g9.s, delete g9.v, delete g9.p, g9) : t3(g9);
        }
        return t3(n3);
      }
    }));
  }
};
ns = th([
  bn2(0, aC),
  bn2(1, Inject(lt3)),
  bn2(2, Inject(G)),
  bn2(3, Inject(Wt2))
], ns);
var To = createIdentifier("univer.exclusive-range-service");
var nh = class extends Ve {
  constructor() {
    super(...arguments);
    R(this, "_exclusiveRanges", /* @__PURE__ */ new Map());
    R(this, "_exclusiveRangesChange$", new Subject());
    R(this, "exclusiveRangesChange$", this._exclusiveRangesChange$.asObservable());
  }
  _ensureUnitMap(t3) {
    return this._exclusiveRanges.has(t3) || this._exclusiveRanges.set(t3, /* @__PURE__ */ new Map()), this._exclusiveRanges.get(t3);
  }
  _ensureSubunitMap(t3, s2) {
    const o3 = this._ensureUnitMap(t3);
    return o3.has(s2) || o3.set(s2, /* @__PURE__ */ new Map()), o3.get(s2);
  }
  _ensureFeature(t3, s2, o3) {
    const r = this._ensureSubunitMap(t3, s2);
    return r.has(o3) || r.set(o3, []), r.get(o3);
  }
  addExclusiveRange(t3, s2, o3, r) {
    const i = this._ensureFeature(t3, s2, o3);
    i.push(...r), this._exclusiveRangesChange$.next({ unitId: t3, subUnitId: s2, ranges: i.map((a4) => a4.range) });
  }
  getExclusiveRanges(t3, s2, o3) {
    var r, i;
    return (i = (r = this._exclusiveRanges.get(t3)) == null ? void 0 : r.get(s2)) == null ? void 0 : i.get(o3);
  }
  clearExclusiveRanges(t3, s2, o3) {
    const r = this.getExclusiveRanges(t3, s2, o3);
    this._exclusiveRangesChange$.next({ unitId: t3, subUnitId: s2, ranges: (r == null ? void 0 : r.map((i) => i.range)) || [] }), this._ensureFeature(t3, s2, o3), this._exclusiveRanges.get(t3).get(s2).set(o3, []);
  }
  clearExclusiveRangesByGroupId(t3, s2, o3, r) {
    const i = this.getExclusiveRanges(t3, s2, o3);
    this._exclusiveRangesChange$.next({ unitId: t3, subUnitId: s2, ranges: (i == null ? void 0 : i.map((u2) => u2.range)) || [] });
    const a4 = this.getExclusiveRanges(t3, s2, o3);
    if (a4) {
      const u2 = a4.filter((l4) => l4.groupId !== r);
      this._exclusiveRanges.get(t3).get(s2).set(o3, u2);
    }
  }
  getInterestGroupId(t3) {
    const s2 = [];
    return t3.forEach((o3) => {
      var l4;
      const r = o3.range, { unitId: i, sheetId: a4 } = r;
      if (!i || !a4) return;
      const u2 = (l4 = this._exclusiveRanges.get(i)) == null ? void 0 : l4.get(a4);
      if (u2)
        for (const c2 of u2.keys()) {
          const d2 = u2.get(c2);
          if (d2) {
            for (const h9 of d2)
              if (Cn.intersects(r, h9.range)) {
                s2.push(c2);
                break;
              }
          }
        }
    }), s2;
  }
};
var sh = Object.getOwnPropertyDescriptor;
var oh = (n3, e, t3, s2) => {
  for (var o3 = s2 > 1 ? void 0 : s2 ? sh(e, t3) : e, r = n3.length - 1, i; r >= 0; r--)
    (i = n3[r]) && (o3 = i(o3) || o3);
  return o3;
};
var bs3 = (n3, e) => (t3, s2) => e(t3, s2, n3);
var Ns = class extends Ve {
  constructor(n3, e, t3) {
    super(), this._resourceManagerService = n3, this._univerInstanceService = e, this._logService = t3;
  }
  getValue(n3, e, t3, s2) {
    const o3 = this._univerInstanceService.getUniverSheetInstance(n3);
    if (!o3)
      return;
    const r = o3 == null ? void 0 : o3.getSheetBySheetId(e);
    if (!r)
      return;
    const i = o3.getStyles(), a4 = r.getCellRaw(t3, s2);
    if (a4 != null && a4.s) {
      const u2 = i.get(a4.s);
      if (u2 != null && u2.n)
        return u2.n;
    }
    return null;
  }
  deleteValues(n3, e, t3) {
    const s2 = this._univerInstanceService.getUniverSheetInstance(n3);
    if (!s2)
      return;
    const o3 = s2 == null ? void 0 : s2.getSheetBySheetId(e);
    if (!o3)
      return;
    const r = s2.getStyles();
    t3.forEach((i) => {
      vr.foreach(i, (a4, u2) => {
        const l4 = o3.getCellRaw(a4, u2);
        if (!l4)
          return;
        const c2 = l4 == null ? void 0 : l4.s, h9 = __spreadValues({}, c2 && r.get(c2) || {});
        delete h9.n;
        const g9 = r.setValue(h9);
        l4.s = g9;
      });
    });
  }
  setValues(n3, e, t3) {
    const s2 = this._univerInstanceService.getUniverSheetInstance(n3);
    if (!s2)
      return;
    const o3 = s2 == null ? void 0 : s2.getSheetBySheetId(e);
    if (!o3)
      return;
    const r = s2.getStyles(), i = o3.getCellMatrix();
    t3.forEach((a4) => {
      a4.ranges.forEach((u2) => {
        vr.foreach(u2, (l4, c2) => {
          const d2 = o3.getCellRaw(l4, c2);
          if (d2) {
            const g9 = __spreadProps(__spreadValues({}, r.getStyleByCell(d2) || {}), { n: { pattern: a4.pattern } }), m9 = r.setValue(g9);
            d2.s = m9;
          } else {
            const h9 = { n: { pattern: a4.pattern } }, g9 = r.setValue(h9);
            g9 && i.setValue(l4, c2, { s: g9 });
          }
        });
      });
    });
  }
};
Ns = oh([
  bs3(0, na),
  bs3(1, br),
  bs3(2, Nt)
], Ns);
var rh = Object.getOwnPropertyDescriptor;
var ih = (n3, e, t3, s2) => {
  for (var o3 = s2 > 1 ? void 0 : s2 ? rh(e, t3) : e, r = n3.length - 1, i; r >= 0; r--)
    (i = n3[r]) && (o3 = i(o3) || o3);
  return o3;
};
var dt2 = (n3, e) => (t3, s2) => e(t3, s2, n3);
var Po2 = [Ue2.id, ke2.id, Me.id, Te.id];
var No2 = [Je3.id, qe2.id];
var ss = class extends Ve {
  constructor(e, t3, s2, o3, r, i, a4, u2) {
    super();
    R(this, "disposableCollection", new ho());
    this._selectionProtectionRuleModel = e, this._univerInstanceService = t3, this._commandService = s2, this._refRangeService = o3, this._selectionProtectionRenderModel = r, this._rangeProtectionCache = i, this._sheetInterceptorService = a4, this._rangeProtectionRuleModel = u2, this._onRefRangeChange(), this._correctPermissionRange(), this._initReBuildCache(), this._initRemoveSheet();
  }
  _onRefRangeChange() {
    const e = (s2, o3) => {
      const r = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET);
      if (!r || !(r == null ? void 0 : r.getSheetBySheetId(o3)))
        return;
      this.disposableCollection.dispose();
      const a4 = (l4) => this.refRangeHandle(l4, s2, o3);
      this._selectionProtectionRuleModel.getSubunitRuleList(s2, o3).reduce((l4, c2) => [...l4, ...c2.ranges], []).forEach((l4) => {
        this.disposableCollection.add(this._refRangeService.registerRefRange(l4, a4, s2, o3));
      });
    };
    this.disposeWithMe(
      this._commandService.onCommandExecuted((s2) => {
        if (s2.id === ui.id) {
          const o3 = s2.params, r = o3.subUnitId, i = o3.unitId;
          if (!r || !i)
            return;
          e(i, r);
        }
        if (s2.id === fe3.id || s2.id === Be3.id) {
          const o3 = s2.params, r = o3.subUnitId, i = o3.unitId;
          if (!r || !i)
            return;
          e(i, r);
        }
      })
    );
    const t3 = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET);
    if (t3) {
      const s2 = t3.getActiveSheet();
      if (!s2) return;
      e(t3.getUnitId(), s2.getSheetId());
    }
  }
  refRangeHandle(e, t3, s2) {
    switch (e.id) {
      case an.id:
        return this._getRefRangeMutationsByMoveRows(e.params, t3, s2);
      case un.id:
        return this._getRefRangeMutationsByMoveCols(e.params, t3, s2);
      case Ye3.id:
        return this._getRefRangeMutationsByInsertRows(e.params, t3, s2);
      case Xe6.id:
        return this._getRefRangeMutationsByInsertCols(e.params, t3, s2);
      case gs.id:
        return this._getRefRangeMutationsByDeleteCols(e.params, t3, s2);
      case hs.id:
        return this._getRefRangeMutationsByDeleteRows(e.params, t3, s2);
    }
    return { redos: [], undos: [] };
  }
  _getRefRangeMutationsByDeleteCols(e, t3, s2) {
    const o3 = this._selectionProtectionRuleModel.getSubunitRuleList(t3, s2).filter((i) => i.ranges.some((a4) => Cn.intersects(a4, e.range))), r = e.range;
    if (o3.length) {
      const i = [], a4 = [];
      return o3.forEach((u2) => {
        const l4 = Z.deepClone(u2), c2 = l4.ranges.reduce((d2, h9) => {
          if (Cn.intersects(h9, r)) {
            const g9 = Z.deepClone(h9), { startColumn: m9, endColumn: f4 } = r;
            if (m9 <= g9.startColumn && f4 >= g9.endColumn)
              return d2;
            m9 >= g9.startColumn && f4 <= g9.endColumn ? g9.endColumn -= f4 - m9 + 1 : m9 < g9.startColumn ? (g9.startColumn = m9, g9.endColumn -= f4 - m9 + 1) : f4 > g9.endColumn && (g9.endColumn = m9 - 1), this._checkIsRightRange(g9) && d2.push(g9);
          }
          return d2;
        }, []);
        l4.ranges = c2, l4.ranges.length ? (i.push({ id: fe3.id, params: { unitId: t3, subUnitId: s2, rule: l4, ruleId: u2.id } }), a4.push({ id: fe3.id, params: { unitId: t3, subUnitId: s2, rule: u2, ruleId: u2.id } })) : (i.push({ id: ot2.id, params: { unitId: t3, subUnitId: s2, ruleIds: [u2.id] } }), a4.push({ id: Be3.id, params: { unitId: t3, subUnitId: s2, name: "", rules: [u2] } }));
      }), { redos: i, undos: a4 };
    }
    return { undos: [], redos: [] };
  }
  _getRefRangeMutationsByDeleteRows(e, t3, s2) {
    const o3 = this._selectionProtectionRuleModel.getSubunitRuleList(t3, s2).filter((i) => i.ranges.some((a4) => Cn.intersects(a4, e.range))), r = e.range;
    if (o3.length) {
      const i = [], a4 = [];
      return o3.forEach((u2) => {
        const l4 = Z.deepClone(u2), c2 = l4.ranges.reduce((d2, h9) => {
          if (Cn.intersects(h9, r)) {
            const g9 = Z.deepClone(h9), { startRow: m9, endRow: f4 } = r;
            if (m9 <= g9.startRow && f4 >= g9.endRow)
              return d2;
            m9 >= g9.startRow && f4 <= g9.endRow ? g9.endRow -= f4 - m9 + 1 : m9 < g9.startRow ? (g9.startRow = m9, g9.endRow -= f4 - m9 + 1) : f4 > g9.endRow && (g9.endRow = m9 - 1), this._checkIsRightRange(g9) && d2.push(g9);
          }
          return d2;
        }, []);
        l4.ranges = c2, i.push({ id: fe3.id, params: { unitId: t3, subUnitId: s2, rule: l4, ruleId: u2.id } }), a4.push({ id: fe3.id, params: { unitId: t3, subUnitId: s2, rule: u2, ruleId: u2.id } });
      }), { redos: i, undos: a4 };
    }
    return { undos: [], redos: [] };
  }
  _getRefRangeMutationsByInsertCols(e, t3, s2) {
    const o3 = e.range.startColumn, r = e.range.endColumn - e.range.startColumn + 1, i = this._selectionProtectionRuleModel.getSubunitRuleList(t3, s2).filter((a4) => a4.ranges.some((u2) => o3 > u2.startColumn && o3 <= u2.endColumn));
    if (i.length) {
      const a4 = [], u2 = [];
      return i.forEach((l4) => {
        const c2 = Z.deepClone(l4);
        let d2 = false;
        c2.ranges.forEach((h9) => {
          o3 > h9.startColumn && o3 <= h9.endColumn && (h9.endColumn += r, d2 = true);
        }), d2 && (a4.push({ id: fe3.id, params: { unitId: t3, subUnitId: s2, rule: c2, ruleId: l4.id } }), u2.push({ id: fe3.id, params: { unitId: t3, subUnitId: s2, rule: l4, ruleId: l4.id } }));
      }), { redos: a4, undos: u2 };
    }
    return { undos: [], redos: [] };
  }
  _getRefRangeMutationsByInsertRows(e, t3, s2) {
    const o3 = e.range.startRow, r = e.range.endRow - e.range.startRow + 1, i = this._selectionProtectionRuleModel.getSubunitRuleList(t3, s2).filter((a4) => a4.ranges.some((u2) => o3 > u2.startRow && o3 <= u2.endRow));
    if (i.length) {
      const a4 = [], u2 = [];
      return i.forEach((l4) => {
        const c2 = Z.deepClone(l4);
        let d2 = false;
        c2.ranges.forEach((h9) => {
          o3 > h9.startRow && o3 <= h9.endRow && (h9.endRow += r, d2 = true);
        }), d2 && (a4.push({ id: fe3.id, params: { unitId: t3, subUnitId: s2, rule: c2, ruleId: l4.id } }), u2.push({ id: fe3.id, params: { unitId: t3, subUnitId: s2, rule: l4, ruleId: l4.id } }));
      }), { redos: a4, undos: u2 };
    }
    return { undos: [], redos: [] };
  }
  _getRefRangeMutationsByMoveRows(e, t3, s2) {
    const o3 = e.toRange, r = o3.startRow, i = o3.endRow - o3.startRow + 1, a4 = this._selectionProtectionRuleModel.getSubunitRuleList(t3, s2).filter((u2) => u2.ranges.some((l4) => r > l4.startRow && r <= l4.endRow));
    if (a4.length) {
      const u2 = [], l4 = [];
      return a4.forEach((c2) => {
        const d2 = Z.deepClone(c2), g9 = e.fromRange.startRow;
        let m9 = false;
        d2.ranges.forEach((f4) => {
          r > f4.startRow && r <= f4.endRow && (g9 < f4.startRow && (f4.startRow = f4.startRow - i, f4.endRow = f4.endRow - i), f4.endRow += i, m9 = true);
        }), m9 && (u2.push({ id: fe3.id, params: { unitId: t3, subUnitId: s2, rule: d2, ruleId: c2.id } }), l4.push({ id: fe3.id, params: { unitId: t3, subUnitId: s2, rule: c2, ruleId: c2.id } }));
      }), { redos: u2, undos: l4 };
    }
    return { undos: [], redos: [] };
  }
  _getRefRangeMutationsByMoveCols(e, t3, s2) {
    const o3 = e.toRange, r = o3.startColumn, i = o3.endColumn - o3.startColumn + 1, a4 = this._selectionProtectionRuleModel.getSubunitRuleList(t3, s2).filter((u2) => u2.ranges.some((l4) => r > l4.startColumn && r <= l4.endColumn));
    if (a4.length) {
      const u2 = [], l4 = [];
      return a4.forEach((c2) => {
        const d2 = Z.deepClone(c2), g9 = e.fromRange.startColumn;
        let m9 = false;
        d2.ranges.forEach((f4) => {
          r > f4.startColumn && r <= f4.endColumn && (g9 < f4.startColumn && (f4.startColumn = f4.startColumn - i, f4.endColumn = f4.endColumn - i), f4.endColumn += i, m9 = true);
        }), m9 && (u2.push({ id: fe3.id, params: { unitId: t3, subUnitId: s2, rule: d2, ruleId: c2.id } }), l4.push({ id: fe3.id, params: { unitId: t3, subUnitId: s2, rule: c2, ruleId: c2.id } }));
      }), { redos: u2, undos: l4 };
    }
    return { undos: [], redos: [] };
  }
  _correctPermissionRange() {
    this.disposeWithMe(this._commandService.onCommandExecuted((e) => {
      if (No2.includes(e.id)) {
        if (!e.params) return;
        const t3 = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET);
        if (!t3) return;
        const s2 = t3.getSheetBySheetId(e.params.subUnitId);
        if (!s2) return;
        const { sourceRange: o3, targetRange: r } = e.params, i = o3.startColumn === r.startColumn && o3.endColumn === r.endColumn, a4 = i ? o3.endRow - o3.startRow + 1 : o3.endColumn - o3.startColumn + 1, u2 = i ? o3.startRow : o3.startColumn, l4 = i ? r.startRow : r.startColumn;
        this._selectionProtectionRuleModel.getSubunitRuleList(t3.getUnitId(), s2.getSheetId()).forEach((f4) => {
          f4.ranges.forEach((p3) => {
            let { startRow: w6, endRow: S, startColumn: I6, endColumn: y6 } = p3;
            Cn.intersects(p3, o3) || (i ? u2 < w6 && l4 > S ? (w6 -= a4, S -= a4) : u2 > S && l4 <= w6 && (w6 += a4, S += a4) : u2 < I6 && l4 > y6 ? (I6 -= a4, y6 -= a4) : u2 > y6 && l4 <= I6 && (I6 += a4, y6 += a4)), this._checkIsRightRange({ startRow: w6, endRow: S, startColumn: I6, endColumn: y6 }) && (p3.startColumn = I6, p3.endColumn = y6, p3.startRow = w6, p3.endRow = S);
          });
        }), this.disposableCollection.dispose();
        const { unitId: d2, subUnitId: h9 } = e.params, g9 = (f4) => this.refRangeHandle(f4, d2, h9);
        this._selectionProtectionRuleModel.getSubunitRuleList(d2, h9).reduce((f4, C) => [...f4, ...C.ranges], []).forEach((f4) => {
          this.disposableCollection.add(this._refRangeService.registerRefRange(f4, g9, d2, h9));
        }), this._selectionProtectionRenderModel.clear();
      }
      if (Po2.includes(e.id)) {
        const t3 = this._univerInstanceService.getUniverSheetInstance(e.params.unitId);
        if (!t3) return;
        const s2 = t3.getSheetBySheetId(e.params.subUnitId);
        if (!s2) return;
        const o3 = e.params;
        if (!o3) return;
        const { range: r } = o3, i = e.id.includes("row"), a4 = e.id.includes("insert"), u2 = i ? r.startRow : r.startColumn, l4 = i ? r.endRow : r.endColumn, c2 = l4 - u2 + 1;
        this._selectionProtectionRuleModel.getSubunitRuleList(t3.getUnitId(), s2.getSheetId()).forEach((C) => {
          C.ranges.forEach((w6) => {
            let { startRow: S, endRow: I6, startColumn: y6, endColumn: b4 } = w6;
            a4 ? i ? u2 <= S && (S += c2, I6 += c2) : u2 <= y6 && (y6 += c2, b4 += c2) : i ? l4 < S && (S -= c2, I6 -= c2) : l4 < y6 && (y6 -= c2, b4 -= c2), this._checkIsRightRange({ startRow: S, endRow: I6, startColumn: y6, endColumn: b4 }) && (w6.startColumn = y6, w6.endColumn = b4, w6.startRow = S, w6.endRow = I6);
          });
        }), this.disposableCollection.dispose();
        const { unitId: h9, subUnitId: g9 } = e.params, m9 = (C) => this.refRangeHandle(C, h9, g9);
        this._selectionProtectionRuleModel.getSubunitRuleList(h9, g9).reduce((C, p3) => [...C, ...p3.ranges], []).forEach((C) => {
          this.disposableCollection.add(this._refRangeService.registerRefRange(C, m9, h9, g9));
        }), this._selectionProtectionRenderModel.clear();
      }
    }));
  }
  _checkIsRightRange(e) {
    return e.startRow <= e.endRow && e.startColumn <= e.endColumn;
  }
  _initReBuildCache() {
    this.disposeWithMe(this._commandService.onCommandExecuted((e) => {
      if (Po2.includes(e.id) || No2.includes(e.id)) {
        const { unitId: t3, subUnitId: s2 } = e.params;
        this._rangeProtectionCache.reBuildCache(t3, s2);
      }
    }));
  }
  _initRemoveSheet() {
    this._sheetInterceptorService.interceptCommand(
      {
        getMutations: (e) => {
          const t3 = [], s2 = [], o3 = [], r = [];
          if (e.id === Zs.id) {
            const i = e.params, a4 = [], u2 = [];
            this._rangeProtectionRuleModel.getSubunitRuleList(i.unitId, i.subUnitId).forEach((l4) => {
              a4.push(l4.id), u2.push(l4);
            }), a4.length && u2.length && (o3.push({ id: ot2.id, params: { unitId: i.unitId, subUnitId: i.subUnitId, ruleIds: a4 } }), t3.push({ id: Be3.id, params: { unitId: i.unitId, subUnitId: i.subUnitId, name: "", rules: u2 } }));
          }
          return {
            redos: s2,
            undos: t3,
            preRedos: o3,
            preUndos: r
          };
        }
      }
    );
  }
};
ss = ih([
  dt2(0, Inject(me)),
  dt2(1, Inject(br)),
  dt2(2, Ds),
  dt2(3, Inject(At3)),
  dt2(4, Inject(fn2)),
  dt2(5, Inject(Wt2)),
  dt2(6, Inject(G)),
  dt2(7, Inject(me))
], ss);
var ah = Object.getOwnPropertyDescriptor;
var uh = (n3, e, t3, s2) => {
  for (var o3 = s2 > 1 ? void 0 : s2 ? ah(e, t3) : e, r = n3.length - 1, i; r >= 0; r--)
    (i = n3[r]) && (o3 = i(o3) || o3);
  return o3;
};
var Bt = (n3, e) => (t3, s2) => e(t3, s2, n3);
var lh = "SHEET_RANGE_PROTECTION_PLUGIN";
var os = class extends Ve {
  constructor(n3, e, t3, s2, o3) {
    super(), this._selectionProtectionRuleModel = n3, this._permissionService = e, this._resourceManagerService = t3, this._selectionProtectionCache = s2, this._univerInstanceService = o3, this._initSnapshot(), this._initRuleChange();
  }
  _initRuleChange() {
    this.disposeWithMe(
      this._selectionProtectionRuleModel.ruleChange$.subscribe((n3) => {
        switch (n3.type) {
          case "add": {
            Ee4().forEach((e) => {
              const t3 = new e(n3.unitId, n3.subUnitId, n3.rule.permissionId);
              this._permissionService.addPermissionPoint(t3);
            });
            break;
          }
          case "delete": {
            Ee4().forEach((e) => {
              const t3 = new e(n3.unitId, n3.subUnitId, n3.rule.permissionId);
              this._permissionService.deletePermissionPoint(t3.id);
            });
            break;
          }
          case "set": {
            n3.oldRule.permissionId !== n3.rule.permissionId && Ee4().forEach((e) => {
              const t3 = new e(n3.unitId, n3.subUnitId, n3.oldRule.permissionId);
              this._permissionService.deletePermissionPoint(t3.id);
              const s2 = new e(n3.unitId, n3.subUnitId, n3.rule.permissionId);
              this._permissionService.addPermissionPoint(s2);
            });
            break;
          }
        }
      })
    );
  }
  _initSnapshot() {
    const n3 = (t3) => {
      const o3 = this._selectionProtectionRuleModel.toObject()[t3];
      return o3 ? JSON.stringify(o3) : "";
    }, e = (t3) => {
      if (!t3)
        return {};
      try {
        return JSON.parse(t3);
      } catch (e4) {
        return {};
      }
    };
    this.disposeWithMe(
      this._resourceManagerService.registerPluginResource({
        toJson: n3,
        parseJson: e,
        pluginName: lh,
        businesses: [Dn2.UNIVER_SHEET],
        onLoad: (t3, s2) => {
          const o3 = this._selectionProtectionRuleModel.toObject();
          o3[t3] = s2, this._selectionProtectionRuleModel.fromObject(o3);
          const r = [];
          Object.keys(s2).forEach((i) => {
            const a4 = s2[i];
            this._selectionProtectionRuleModel.getSubunitRuleList(t3, i).forEach((u2) => {
              r.push({
                objectID: u2.permissionId,
                unitID: t3,
                objectType: x4.SelectRange,
                actions: pt2
              });
            }), a4.forEach((u2) => {
              Ee4().forEach((l4) => {
                const c2 = new l4(t3, i, u2.permissionId);
                c2.value = false, this._permissionService.addPermissionPoint(c2);
              });
            }), this._selectionProtectionCache.reBuildCache(t3, i);
          });
        },
        onUnLoad: (t3) => {
          this._selectionProtectionCache.deleteUnit(t3);
        }
      })
    );
  }
};
os = uh([
  Bt(0, Inject(me)),
  Bt(1, Inject(aC)),
  Bt(2, Inject(na)),
  Bt(3, Inject(Wt2)),
  Bt(4, Inject(br))
], os);
var ch = Object.getOwnPropertyDescriptor;
var dh = (n3, e, t3, s2) => {
  for (var o3 = s2 > 1 ? void 0 : s2 ? ch(e, t3) : e, r = n3.length - 1, i; r >= 0; r--)
    (i = n3[r]) && (o3 = i(o3) || o3);
  return o3;
};
var hh = (n3, e) => (t3, s2) => e(t3, s2, n3);
var Os2 = class extends Ve {
  constructor(n3) {
    super(), this._sheetRangeThemeModel = n3;
  }
  /**
   * Register a custom range theme style.
   * @param {string} unitId Which unit to register the range theme style.
   * @param {RangeThemeStyle} rangeThemeStyle The range theme style to register.
   */
  registerRangeTheme(n3, e) {
    this._sheetRangeThemeModel.registerRangeThemeStyle(n3, e);
  }
  removeRangeThemeRule(n3, e) {
    this._sheetRangeThemeModel.removeRangeThemeRule(n3, e);
  }
  /**
   * Get custom register themes name list
   * @param {string} unitId Which unit to register the range theme style.
   * @returns {string[]} The list of custom register themes name.
   */
  getALLRegisterThemes(n3) {
    return this._sheetRangeThemeModel.getALLRegisteredTheme(n3);
  }
  /**
   * Register range theme style to the range.
   * @param {string} themeName The defined theme name.
   * @param {IRangeThemeRangeInfo} rangeInfo The range info to apply the theme style.
   */
  registerRangeThemeStyle(n3, e) {
    this._sheetRangeThemeModel.registerRangeThemeRule(n3, e);
  }
  /**
   * Get applied range theme style name.
   * @param {IRangeThemeRangeInfo} rangeInfo The range info to get the applied theme style.
   * @returns {string | undefined} The applied theme style name or not exist.
   */
  getAppliedRangeThemeStyle(n3) {
    return this._sheetRangeThemeModel.getRegisteredRangeThemeStyle(n3);
  }
  /**
   * Get registered build-in range theme style
   */
  getRegisteredRangeThemes() {
    return this._sheetRangeThemeModel.getRegisteredRangeThemes();
  }
};
Os2 = dh([
  hh(0, Inject(ve2))
], Os2);
var gh = Object.defineProperty;
var mh = Object.getOwnPropertyDescriptor;
var fh = (n3, e, t3) => e in n3 ? gh(n3, e, { enumerable: true, configurable: true, writable: true, value: t3 }) : n3[e] = t3;
var Rh2 = (n3, e, t3, s2) => {
  for (var o3 = s2 > 1 ? void 0 : s2 ? mh(e, t3) : e, r = n3.length - 1, i; r >= 0; r--)
    (i = n3[r]) && (o3 = i(o3) || o3);
  return o3;
};
var Oo2 = (n3, e) => (t3, s2) => e(t3, s2, n3);
var Ri = (n3, e, t3) => fh(n3, typeof e != "symbol" ? e + "" : e, t3);
var Ch = "SHEET_PLUGIN";
var rs2 = class extends yl {
  constructor(n3 = yo, e, t3) {
    super(), this._config = n3, this._injector = e, this._configService = t3;
    const s2 = __objRest(co(
      {},
      yo,
      this._config
    ), []);
    this._configService.setConfig(fs, s2), this._initConfig(), this._initDependencies();
  }
  _initConfig() {
    var n3, e, t3;
    (n3 = this._config) != null && n3.onlyRegisterFormulaRelatedMutations && this._configService.setConfig(fi2, true), (e = this._config) != null && e.isRowStylePrecedeColumnStyle && this._configService.setConfig(zc, true), (t3 = this._config) != null && t3.autoHeightForMergedCells && this._configService.setConfig(Vc, true);
  }
  _initDependencies() {
    var e;
    const n3 = [
      // services
      [Ht2],
      [Ln],
      [z],
      [At3],
      [mn2],
      [$t2, { useClass: Ns }],
      [G],
      [Os2],
      [rt3],
      // controllers
      [Qn],
      [Vn],
      [ts],
      [Jn3],
      [Zn],
      [qn3],
      // permission
      [zn2],
      [lt3],
      [vn2],
      [ns],
      [Xn3],
      [Yn2],
      // range theme
      [ve2],
      // range protection
      [fn2],
      [me],
      [Wt2],
      [ss],
      [os],
      [To, {
        useClass: nh,
        deps: [z]
      }]
    ];
    (e = this._config) != null && e.notExecuteFormula || n3.push([es]), eR(this._injector, uC(n3, this._config.override)), Kc(this._injector, [
      [G],
      [os],
      [To],
      [Xn3],
      [qn3]
    ]);
  }
  onStarting() {
    Kc(this._injector, [
      [Qn],
      [Vn],
      [mn2],
      [zn2],
      [ns],
      [rt3]
    ]);
  }
  onRendered() {
    Kc(this._injector, [
      [$t2]
    ]);
  }
  onReady() {
    Kc(this._injector, [
      [es],
      [Jn3],
      [Zn],
      [ve2],
      [ts],
      [fn2],
      [ss],
      [At3],
      [Yn2]
    ]);
  }
};
Ri(rs2, "pluginName", Ch);
Ri(rs2, "type", we.UNIVER_SHEET);
rs2 = Rh2([
  sI(uo3),
  Oo2(1, Inject(Injector)),
  Oo2(2, xs)
], rs2);
var fg = {
  /**
   * The permission point for adding or editing workbook comments
   */
  WorkbookCommentPermission: rr2,
  /**
   * The permission point for copy in workbook
   */
  WorkbookCopyPermission: ir4,
  /**
   * The permission point for creating protect in a workbook
   */
  WorkbookCreateProtectPermission: ar3,
  /**
   * The permission point for creating new sheets in a workbook
   */
  WorkbookCreateSheetPermission: ur2,
  /**
   * The permission point for deleting sheets in a workbook
   */
  WorkbookDeleteSheetPermission: lr2,
  /**
   * The permission point for duplicating a sheet in a workbook
   */
  WorkbookDuplicatePermission: cr2,
  /**
   * The permission point for editing workbook content
   */
  WorkbookEditablePermission: Pe3,
  /**
   * The permission point for exporting workbook data
   */
  WorkbookExportPermission: dr2,
  /**
   * The permission point for hiding sheets in a workbook
   */
  WorkbookHideSheetPermission: js2,
  /**
   * The permission point for viewing and managing workbook history
   */
  WorkbookHistoryPermission: el,
  /**
   * The permission point for managing collaborators in a workbook
   */
  WorkbookManageCollaboratorPermission: zs,
  /**
   * The permission point for moving sheets within a workbook
   */
  WorkbookMoveSheetPermission: Gs,
  /**
   * The permission point for printing a workbook
   */
  WorkbookPrintPermission: hr2,
  /**
   * The permission point for recovering a previous history state of a workbook
   */
  WorkbookRecoverHistoryPermission: gr3,
  /**
   * The permission point for renaming sheets in a workbook
   */
  WorkbookRenameSheetPermission: Ks,
  /**
   * The permission point for sharing a workbook with others
   */
  WorkbookSharePermission: mr2,
  /**
   * The permission point for viewing the history of a workbook
   */
  WorkbookViewHistoryPermission: Rr2,
  /**
   * The permission point for viewing a workbook
   */
  WorkbookViewPermission: fr4,
  /**
   * The permission point for copying contents from a worksheet
   */
  WorksheetCopyPermission: Cr,
  /**
   * The permission point for deleting columns in a worksheet
   */
  WorksheetDeleteColumnPermission: pr2,
  /**
   * The permission point for deleting worksheet protection rules
   */
  WorksheetDeleteProtectionPermission: Sr2,
  /**
   * The permission point for deleting rows in a worksheet
   */
  WorksheetDeleteRowPermission: wr2,
  /**
   * The permission point for editing extra objects (e.g. shapes) in a worksheet
   */
  WorksheetEditExtraObjectPermission: Ir2,
  /**
   * The permission point for editing the content of a worksheet
   */
  WorksheetEditPermission: Le2,
  /**
   * The permission point for applying filters in a worksheet
   */
  WorksheetFilterPermission: vr3,
  /**
   * The permission point for inserting columns into a worksheet
   */
  WorksheetInsertColumnPermission: Mr,
  /**
   * The permission point for inserting hyperlinks in a worksheet
   */
  WorksheetInsertHyperlinkPermission: _r2,
  /**
   * The permission point for inserting rows into a worksheet
   */
  WorksheetInsertRowPermission: yr2,
  /**
   * The permission point for managing collaborators of a worksheet
   */
  WorksheetManageCollaboratorPermission: br4,
  /**
   * The permission point for creating or modifying pivot tables in a worksheet
   */
  WorksheetPivotTablePermission: Er,
  /**
   * The permission point for setting the style of cells in a worksheet
   */
  WorksheetSetCellStylePermission: kr2,
  /**
   * The permission point for setting the value of cells in a worksheet
   */
  WorksheetSetCellValuePermission: An3,
  /**
   * The permission point for setting the style of columns in a worksheet
   */
  WorksheetSetColumnStylePermission: Zt3,
  /**
   * The permission point for setting the style of rows in a worksheet
   */
  WorksheetSetRowStylePermission: Qt3,
  /**
   * The permission point for performing sort operations on a worksheet
   */
  WorksheetSortPermission: Ur,
  /**
   * The permission point for viewing the content of a worksheet
   */
  WorksheetViewPermission: ds,
  /**
   * The permission point for editing the range protection settings
   */
  RangeProtectionPermissionEditPoint: Ve4,
  /**
   * The permission point for viewing the range protection settings
   */
  RangeProtectionPermissionViewPoint: Bs2
};
var Rg = (n3, e, t3, s2) => {
  const o3 = n3.get(aC), r = n3.get(me), i = o3.getPermissionPoint(new Pe3(e).id);
  if (!(i != null && i.value))
    return false;
  const a4 = o3.getPermissionPoint(new Le2(e, t3).id);
  if (!(a4 != null && a4.value))
    return false;
  const l4 = r.getSubunitRuleList(e, t3).filter((c2) => c2.ranges.some((d2) => s2.some((h9) => Cn.intersects(d2, h9))));
  return l4.length ? l4.every((c2) => {
    const d2 = c2.permissionId, h9 = o3.getPermissionPoint(new Ve4(e, t3, d2).id);
    return !!(h9 != null && h9.value);
  }) : true;
};
var Ci2 = (n3, e, t3, s2 = 1, o3 = true, r = true) => {
  const i = vr.transformRange(n3, e), { startRow: a4, endRow: u2 } = i;
  let l4 = t3.startRow - s2, c2 = e.getMergedCell(l4, t3.startColumn), d2 = !c2 || c2.startRow === l4 && c2.startColumn === t3.startColumn;
  for (; !e.getRowVisible(l4) || !d2; )
    l4--, c2 = e.getMergedCell(l4, t3.startColumn), d2 = !c2 || c2.startRow === l4 && c2.startColumn === t3.startColumn;
  if (l4 >= a4)
    return __spreadProps(__spreadValues({}, t3), { startRow: l4, endRow: l4 });
  if (r) {
    const h9 = __spreadProps(__spreadValues({}, t3), { startRow: u2, endRow: u2 });
    return Si(n3, e, h9, s2, o3, false);
  }
};
var pi = (n3, e, t3, s2 = 1, o3 = true, r = true) => {
  const i = vr.transformRange(n3, e), { startRow: a4, endRow: u2 } = i;
  let l4 = t3.endRow + s2, c2 = e.getMergedCell(l4, t3.startColumn), d2 = !c2 || c2.startRow === l4 && c2.startColumn === t3.startColumn;
  for (; !e.getRowVisible(l4) || !d2; )
    l4++, c2 = e.getMergedCell(l4, t3.startColumn), d2 = !c2 || c2.startRow === l4 && c2.startColumn === t3.startColumn;
  if (l4 <= u2)
    return __spreadProps(__spreadValues({}, t3), { startRow: l4, endRow: l4 });
  if (r) {
    const h9 = __spreadProps(__spreadValues({}, t3), { startRow: a4, endRow: a4 });
    return wi(n3, e, h9, s2, o3, false);
  }
};
var Si = (n3, e, t3, s2 = 1, o3 = true, r = true) => {
  const i = vr.transformRange(n3, e), { startColumn: a4, endColumn: u2 } = i;
  let l4 = t3.startColumn - s2, c2 = e.getMergedCell(t3.startRow, l4), d2 = !c2 || c2.startRow === t3.startRow && c2.startColumn === l4;
  for (; !e.getColVisible(l4) || !d2; )
    l4--, c2 = e.getMergedCell(t3.startRow, l4), d2 = !c2 || c2.startRow === t3.startRow && c2.startColumn === l4;
  if (l4 >= a4)
    return __spreadProps(__spreadValues({}, t3), { startColumn: l4, endColumn: l4 });
  if (r) {
    const h9 = __spreadProps(__spreadValues({}, t3), { startColumn: u2, endColumn: u2 });
    return Ci2(n3, e, h9, s2, o3, false);
  }
};
var wi = (n3, e, t3, s2 = 1, o3 = true, r = true) => {
  const i = vr.transformRange(n3, e), { startColumn: a4, endColumn: u2 } = i;
  let l4 = t3.endColumn + s2, c2 = e.getMergedCell(t3.startRow, l4), d2 = !c2 || c2.startRow === t3.startRow && c2.startColumn === l4;
  for (; !e.getColVisible(l4) || !d2; )
    l4++, c2 = e.getMergedCell(t3.startRow, l4), d2 = !c2 || c2.startRow === t3.startRow && c2.startColumn === l4;
  if (l4 <= u2)
    return __spreadProps(__spreadValues({}, t3), { endColumn: l4, startColumn: l4 });
  if (r) {
    const h9 = __spreadProps(__spreadValues({}, t3), { startColumn: a4, endColumn: a4 });
    return pi(n3, e, h9, s2, o3, false);
  }
};
function En2(n3, e, t3) {
  let s2 = null;
  return t3.getMatrixWithMergedCells(n3, e, n3, e).forValue((r, i, a4) => (s2 = {
    actualRow: r,
    actualColumn: i,
    startRow: r,
    startColumn: i,
    isMerged: a4.rowSpan !== void 0 || a4.colSpan !== void 0,
    isMergedMainCell: a4.rowSpan !== void 0 && a4.colSpan !== void 0,
    endRow: r + (a4.rowSpan !== void 0 ? a4.rowSpan - 1 : 0),
    endColumn: i + (a4.colSpan !== void 0 ? a4.colSpan - 1 : 0),
    rangeType: ge.NORMAL
  }, false)), s2 || {
    actualColumn: e,
    actualRow: n3,
    startRow: n3,
    startColumn: e,
    endRow: n3,
    endColumn: e,
    isMerged: false,
    isMergedMainCell: false,
    rangeType: ge.NORMAL
  };
}
var ph = (n3, e, t3, s2, o3 = 1) => {
  switch (s2) {
    case wm.UP:
      return Ci2(n3, e, t3, o3);
    case wm.DOWN:
      return pi(n3, e, t3, o3);
    case wm.LEFT:
      return Si(n3, e, t3, o3);
    case wm.RIGHT:
      return wi(n3, e, t3, o3);
  }
};
var Cg2 = (n3, e, t3) => {
  let s2, o3 = -1, r;
  for (let p3 = 0; p3 < n3.length; p3++)
    if (n3[p3].primary) {
      s2 = n3[p3], o3 = p3, r = s2.primary;
      break;
    }
  if (o3 === -1)
    return null;
  const i = e === wm.LEFT || e === wm.UP, a4 = i ? o3 - 1 >= 0 ? o3 - 1 : n3.length - 1 : o3 + 1 < n3.length ? o3 + 1 : 0, u2 = n3[a4];
  if (!s2 || !r)
    return null;
  const l4 = __spreadValues({}, r), { startRow: c2, startColumn: d2, endRow: h9, endColumn: g9 } = s2.range, m9 = i ? l4.startRow === c2 && l4.startColumn === d2 : l4.endRow === h9 && l4.endColumn === g9, f4 = m9 && i;
  if (!Cn.equals(s2.range, l4)) {
    const p3 = m9 ? u2.range : ph(s2.range, t3, l4, e);
    if (!p3)
      return null;
    const w6 = f4 ? En2(p3.endRow, p3.endColumn, t3) : En2(p3.startRow, p3.startColumn, t3);
    return {
      startRow: w6.startRow,
      startColumn: w6.startColumn,
      endRow: w6.endRow,
      endColumn: w6.endColumn
    };
  }
  const C = f4 ? En2(u2.range.endRow, u2.range.endColumn, t3) : En2(u2.range.startRow, u2.range.startColumn, t3);
  return {
    startRow: C.startRow,
    startColumn: C.startColumn,
    endRow: C.endRow,
    endColumn: C.endColumn
  };
};

// node_modules/@univerjs/sheets-formula/lib/es/index.js
var en = Object.defineProperty;
var tn2 = (n3, e, a4) => e in n3 ? en(n3, e, { enumerable: true, configurable: true, writable: true, value: a4 }) : n3[e] = a4;
var w = (n3, e, a4) => tn2(n3, typeof e != "symbol" ? e + "" : e, a4);
var Ri2 = {
  id: "formula.command.insert-function",
  type: Ls.COMMAND,
  handler: (n3, e) => __async(void 0, null, function* () {
    const { list: a4, listOfRangeHasNumber: i } = e, r = n3.get(Ds), o3 = new ht();
    a4.forEach((f4) => {
      const { range: m9, primary: c2, formula: l4 } = f4, { row: p3, column: T10 } = c2, L6 = et(6);
      o3.setValue(p3, T10, {
        f: l4,
        si: L6
      });
      const { startRow: I6, startColumn: A4, endRow: N6, endColumn: d2 } = m9;
      for (let S = I6; S <= N6; S++)
        for (let R9 = A4; R9 <= d2; R9++)
          (S !== p3 || R9 !== T10) && o3.setValue(S, R9, {
            si: L6
          });
    }), i && i.length > 0 && i.forEach((f4) => {
      const { primary: m9, formula: c2 } = f4;
      o3.setValue(m9.row, m9.column, {
        f: c2
      });
    });
    const u2 = {
      value: o3.getData()
    };
    return r.executeCommand(Sn2.id, u2);
  })
};
var Si2 = {
  id: "sheets-formula.command.quick-sum",
  type: Ls.COMMAND,
  handler: (n3) => __async(void 0, null, function* () {
    const a4 = n3.get(z).getCurrentLastSelection();
    if (!a4) return false;
    const i = n3.get(br), r = P5(i);
    if (!r) return false;
    const o3 = a4.range, { worksheet: u2 } = r;
    let f4 = Ah(o3, u2);
    if (!f4) return false;
    f4 = cs2(f4, u2);
    const m9 = Th({
      startRow: f4.startRow,
      startColumn: f4.startColumn,
      endRow: o3.endRow,
      endColumn: o3.endColumn
    }, { left: true, right: true, up: true, down: true }, u2), c2 = new ht(), l4 = cs2({
      startRow: m9.endRow,
      endRow: m9.endRow,
      startColumn: m9.startColumn,
      endColumn: m9.endColumn
    }, u2);
    if (!Cn.equals(l4, m9))
      for (const L6 of u2.iterateByColumn(l4))
        (!L6.value || !u2.cellHasValue(L6.value)) && c2.setValue(L6.row, L6.col, {
          f: `=SUM(${Yt({
            startColumn: L6.col,
            endColumn: L6.col,
            startRow: m9.startRow,
            endRow: L6.row - 1
          })})`
        });
    const p3 = cs2({
      startRow: m9.startRow,
      startColumn: m9.endColumn,
      endRow: m9.endRow,
      endColumn: m9.endColumn
    }, u2);
    if (!Cn.equals(p3, m9))
      for (const L6 of u2.iterateByRow(p3))
        (!L6.value || !u2.cellHasValue(L6.value)) && c2.setValue(L6.row, L6.col, {
          f: `=SUM(${Yt({
            startColumn: m9.startColumn,
            endColumn: L6.col - 1,
            startRow: L6.row,
            endRow: L6.row
          })})`
        });
    const T10 = n3.get(Ds);
    return (yield vR([
      {
        id: Sn2.id,
        params: {
          range: m9,
          value: c2.getMatrix()
        }
      },
      {
        id: ie5.id,
        params: {
          unitId: r.unitId,
          subUnitId: r.subUnitId,
          selections: [{
            range: m9,
            primary: Cn.contains(m9, a4.primary) ? a4.primary : __spreadProps(__spreadValues({}, f4), { actualRow: f4.startRow, actualColumn: f4.startColumn }),
            style: null
          }]
        }
      }
    ], T10)).result;
  })
};
var _e4 = {
  type: Ls.MUTATION,
  id: "sheet.mutation.data-validation-formula-mark-dirty",
  handler() {
    return true;
  }
};
var Ue3 = "sheets-formula.base.config";
var Te2 = ((n3) => (n3[n3.FORCED = 0] = "FORCED", n3[n3.WHEN_EMPTY = 1] = "WHEN_EMPTY", n3[n3.NO_CALCULATION = 2] = "NO_CALCULATION", n3))(Te2 || {});
var La2 = {};
var Ai = "sheets-formula.remote.config";
var Pa3 = {};
var Ci3 = Object.getOwnPropertyDescriptor;
var Di = (n3, e, a4, i) => {
  for (var r = i > 1 ? void 0 : i ? Ci3(e, a4) : e, o3 = n3.length - 1, u2; o3 >= 0; o3--)
    (u2 = n3[o3]) && (r = u2(r) || r);
  return r;
};
var Ct3 = (n3, e) => (a4, i) => e(a4, i, n3);
var Je4 = class extends Ve {
  constructor(e, a4, i) {
    super();
    w(this, "_errorValueCell", {
      v: h.VALUE,
      t: mn.STRING
    });
    w(this, "_refreshRender");
    this._commandService = e, this._sheetInterceptorService = a4, this._formulaDataModel = i, this._initialize();
  }
  _initialize() {
    this._commandExecutedListener(), this._initInterceptorCellContent();
  }
  _commandExecutedListener() {
    this.disposeWithMe(
      this._commandService.onCommandExecuted((e) => __async(this, null, function* () {
        if (e.id === wo.id) {
          const a4 = e.params;
          if (!a4) return;
          const { imageFormulaData: i } = a4;
          if (!i || i.length === 0) return;
          const r = yield Promise.all(
            i.map((u2) => this._getImageNatureSize(u2))
          ), o3 = {};
          r.forEach((u2) => {
            const _a5 = u2, { unitId: f4, sheetId: m9, row: c2, column: l4 } = _a5, p3 = __objRest(_a5, ["unitId", "sheetId", "row", "column"]);
            o3[f4] || (o3[f4] = {}), o3[f4][m9] || (o3[f4][m9] = new ht()), o3[f4][m9].setValue(c2, l4, p3);
          }), this._formulaDataModel.mergeUnitImageFormulaData(o3), this._refreshRender();
        }
      }))
    );
  }
  // eslint-disable-next-line max-lines-per-function
  _initInterceptorCellContent() {
    this.disposeWithMe(
      this._sheetInterceptorService.intercept(ht2.CELL_CONTENT, {
        priority: Ca3.CELL_IMAGE,
        effect: ir.Value | ir.Style,
        // eslint-disable-next-line max-lines-per-function
        handler: (e, a4, i) => {
          var h9, M10;
          const { unitId: r, subUnitId: o3, row: u2, col: f4 } = a4, m9 = this._formulaDataModel.getUnitImageFormulaData(), c2 = (M10 = (h9 = m9 == null ? void 0 : m9[r]) == null ? void 0 : h9[o3]) == null ? void 0 : M10.getValue(u2, f4);
          if (!c2)
            return i(e);
          const {
            source: l4,
            // altText,
            // sizing,
            height: p3,
            width: T10,
            isErrorImage: L6,
            imageNaturalWidth: I6,
            imageNaturalHeight: A4
          } = c2;
          if (L6)
            return i(this._errorValueCell);
          const N6 = T10 || I6, d2 = p3 || A4, S = Qr("", {}), R9 = {
            unitId: r,
            subUnitId: o3,
            drawingId: et(),
            drawingType: ig.DRAWING_IMAGE,
            imageSourceType: uc.URL,
            source: l4,
            transform: {
              left: 0,
              top: 0,
              width: N6,
              height: d2
            },
            docTransform: {
              size: {
                width: N6,
                height: d2
              },
              positionH: {
                relativeFrom: Jm.PAGE,
                posOffset: 0
              },
              positionV: {
                relativeFrom: Zm.PARAGRAPH,
                posOffset: 0
              },
              angle: 0
            },
            behindDoc: ie.FALSE,
            title: "",
            description: "",
            layoutType: Bm.INLINE,
            // Insert inline drawing by default.
            wrapText: $m.BOTH_SIDES,
            distB: 0,
            distL: 0,
            distR: 0,
            distT: 0
          }, P8 = Ze.drawing.add({
            documentDataModel: S,
            drawings: [R9],
            selection: {
              collapsed: true,
              startOffset: 0,
              endOffset: 0
            }
          });
          return P8 ? (S.apply(P8), i(__spreadProps(__spreadValues({}, e), {
            p: S.getSnapshot()
          }))) : i(this._errorValueCell);
        }
      })
    );
  }
  _getImageNatureSize(e) {
    return __async(this, null, function* () {
      const a4 = yield this._getImageSize(e.source);
      return a4.image ? __spreadProps(__spreadValues({}, e), {
        isErrorImage: false,
        imageNaturalHeight: a4.height,
        imageNaturalWidth: a4.width
      }) : __spreadProps(__spreadValues({}, e), { isErrorImage: true });
    });
  }
  _getImageSize(e) {
    return __async(this, null, function* () {
      return new Promise((a4) => {
        const i = new Image();
        i.src = e, i.onload = () => {
          a4({
            width: i.width,
            height: i.height,
            image: i
          });
        }, i.onerror = () => {
          a4({
            width: 0,
            height: 0,
            image: null
          });
        };
      });
    });
  }
  registerRefreshRenderFunction(e) {
    this._refreshRender = e;
  }
};
Je4 = Di([
  Ct3(0, Ds),
  Ct3(1, Inject(G)),
  Ct3(2, Inject(yr))
], Je4);
var Re2 = ((n3) => (n3[n3.NOT_REGISTER = 1] = "NOT_REGISTER", n3[n3.SUCCESS = 2] = "SUCCESS", n3[n3.WAIT = 3] = "WAIT", n3[n3.ERROR = 4] = "ERROR", n3))(Re2 || {});
var bi3 = Object.getOwnPropertyDescriptor;
var Oi3 = (n3, e, a4, i) => {
  for (var r = i > 1 ? void 0 : i ? bi3(e, a4) : e, o3 = n3.length - 1, u2; o3 >= 0; o3--)
    (u2 = n3[o3]) && (r = u2(r) || r);
  return r;
};
var Dt2 = (n3, e) => (a4, i) => e(a4, i, n3);
var et3 = class extends Ve {
  constructor(e, a4, i) {
    super();
    w(this, "_formulaCacheMap", /* @__PURE__ */ new Map());
    w(this, "_formulaChangeWithRange$", new Subject());
    w(this, "formulaChangeWithRange$", this._formulaChangeWithRange$.asObservable());
    w(this, "_formulaResult$", new Subject());
    w(this, "formulaResult$", this._formulaResult$.asObservable());
    w(this, "calculateStarted$", new BehaviorSubject(false));
    this._commandService = e, this._activeDirtyManagerService = a4, this._lifecycleService = i, this._initFormulaRegister(), this._initFormulaCalculationResultChange();
  }
  dispose() {
    super.dispose(), this._formulaChangeWithRange$.complete(), this._formulaResult$.complete(), this.calculateStarted$.complete();
  }
  _ensureCacheMap(e, a4) {
    let i = this._formulaCacheMap.get(e);
    i || (i = /* @__PURE__ */ new Map(), this._formulaCacheMap.set(e, i));
    let r = i.get(a4);
    return r || (r = /* @__PURE__ */ new Map(), i.set(a4, r)), r;
  }
  _createFormulaId(e, a4) {
    return `formula.${e}_${a4}_${et(8)}`;
  }
  _initFormulaRegister() {
    this._activeDirtyManagerService.register(
      _e4.id,
      {
        commandId: _e4.id,
        getDirtyData(a4) {
          return {
            dirtyUnitOtherFormulaMap: a4.params
          };
        }
      }
    );
    const e = (a4) => {
      const { unitId: i, subUnitId: r, formulaText: o3, formulaId: u2, ranges: f4 } = a4;
      if (!this._ensureCacheMap(i, r).has(u2))
        return;
      const c2 = {
        unitId: i,
        subUnitId: r,
        formulaMap: {
          [u2]: {
            f: o3,
            ranges: f4
          }
        }
      };
      this._commandService.executeCommand(Ra.id, c2).then(() => {
        this._commandService.executeCommand(
          _e4.id,
          { [i]: { [r]: { [u2]: true } } }
        );
      });
    };
    this.disposeWithMe(
      this._formulaChangeWithRange$.pipe(bufferWhen(() => this.calculateStarted$.pipe(filter((a4) => a4)))).subscribe((a4) => a4.forEach(e))
    ), this.disposeWithMe(
      this._formulaChangeWithRange$.pipe(filter(() => this.calculateStarted$.getValue())).subscribe(e)
    );
  }
  _initFormulaCalculationResultChange() {
    this.disposeWithMe(this._commandService.onCommandExecuted((e) => {
      if (e.id === Mo2.id) {
        const a4 = e.params, { unitOtherData: i } = a4, r = {};
        for (const o3 in i) {
          const u2 = i[o3], f4 = {};
          r[o3] = f4;
          for (const m9 in u2) {
            const c2 = this._ensureCacheMap(o3, m9), l4 = u2[m9], p3 = [];
            f4[m9] = p3;
            for (const T10 in l4) {
              const L6 = l4[T10];
              if (c2.has(T10)) {
                const I6 = c2.get(T10);
                if (!I6)
                  continue;
                I6.result || (I6.result = {});
                const A4 = new ht(L6), N6 = new ht(I6.result);
                A4.forValue((d2, S, R9) => {
                  N6.setValue(d2, S, R9);
                }), I6.status = Re2.SUCCESS, I6.callbacks.forEach((d2) => {
                  d2(L6);
                }), I6.callbacks.clear(), p3.push(I6);
              }
            }
          }
        }
        this._formulaResult$.next(r);
      }
    }));
  }
  registerFormulaWithRange(e, a4, i, r = [{ startRow: 0, endRow: 0, startColumn: 0, endColumn: 0 }], o3) {
    const u2 = this._createFormulaId(e, a4);
    return this._ensureCacheMap(e, a4).set(u2, {
      result: void 0,
      status: Re2.WAIT,
      formulaId: u2,
      callbacks: /* @__PURE__ */ new Set(),
      extra: o3
    }), this._formulaChangeWithRange$.next({
      unitId: e,
      subUnitId: a4,
      formulaText: i,
      formulaId: u2,
      ranges: r
    }), u2;
  }
  deleteFormula(e, a4, i) {
    const r = {
      unitId: e,
      subUnitId: a4,
      formulaIdList: i
    };
    this._commandService.executeCommand(ba2.id, r);
    const o3 = this._ensureCacheMap(e, a4);
    i.forEach((u2) => o3.delete(u2));
  }
  getFormulaValue(e, a4, i) {
    const r = this._ensureCacheMap(e, a4), o3 = r.get(i);
    return o3 ? o3.status === Re2.SUCCESS || o3.status === Re2.ERROR ? Promise.resolve(o3) : new Promise((u2) => {
      o3.callbacks.add(() => {
        u2(r.get(i));
      });
    }) : Promise.resolve(null);
  }
  getFormulaValueSync(e, a4, i) {
    return this._ensureCacheMap(e, a4).get(i);
  }
  markFormulaDirty(e, a4, i) {
    const r = this.getFormulaValueSync(e, a4, i);
    r && (r.status = Re2.WAIT, this._commandService.executeCommand(
      _e4.id,
      { [e]: { [a4]: { [i]: true } } }
    ));
  }
};
et3 = Oi3([
  Dt2(0, Ds),
  Dt2(1, Mb),
  Dt2(2, Inject(Yn))
], et3);
var Mi = Object.getOwnPropertyDescriptor;
var xi = (n3, e, a4, i) => {
  for (var r = i > 1 ? void 0 : i ? Mi(e, a4) : e, o3 = n3.length - 1, u2; o3 >= 0; o3--)
    (u2 = n3[o3]) && (r = u2(r) || r);
  return r;
};
var pe = (n3, e) => (a4, i) => e(a4, i, n3);
var Ta3 = { done: 0, count: 0 };
var bt3 = { onlyLocal: true };
var ge4 = class extends Ve {
  constructor(e, a4, i, r, o3, u2, f4) {
    super();
    w(this, "_waitingCommandQueue", []);
    w(this, "_executingDirtyData", {
      forceCalculation: false,
      dirtyRanges: [],
      dirtyNameMap: {},
      dirtyDefinedNameMap: {},
      dirtyUnitFeatureMap: {},
      dirtyUnitOtherFormulaMap: {},
      clearDependencyTreeCache: {}
    });
    w(this, "_setTimeoutKey", -1);
    w(this, "_startExecutionTime", 0);
    w(this, "_totalCalculationTaskCount", 0);
    w(this, "_doneCalculationTaskCount", 0);
    w(this, "_executionInProgressParams", null);
    w(this, "_restartCalculation", false);
    w(this, "_forceCalculating", false);
    w(this, "_progress$", new BehaviorSubject(Ta3));
    w(this, "progress$", this._progress$.asObservable());
    this._commandService = e, this._activeDirtyManagerService = a4, this._logService = i, this._configService = r, this._formulaDataModel = o3, this._localeService = u2, this._registerOtherFormulaService = f4, this._commandExecutedListener(), this._initialExecuteFormulaProcessListener(), this._initialExecuteFormula();
  }
  _emitProgress(e) {
    this._progress$.next({ done: this._doneCalculationTaskCount, count: this._totalCalculationTaskCount, label: e });
  }
  _startProgress() {
    this._doneCalculationTaskCount = 0, this._totalCalculationTaskCount = 1;
    const e = this._localeService.t("formula.progress.analyzing");
    this._emitProgress(e);
  }
  _calculateProgress(e) {
    if (this._executionInProgressParams) {
      const { totalFormulasToCalculate: a4, completedFormulasCount: i, totalArrayFormulasToCalculate: r, completedArrayFormulasCount: o3 } = this._executionInProgressParams;
      if (this._doneCalculationTaskCount = i + o3, this._totalCalculationTaskCount = a4 + r, this._totalCalculationTaskCount === 0)
        return;
      this._emitProgress(e);
    }
  }
  _completeProgress() {
    this._doneCalculationTaskCount = this._totalCalculationTaskCount = 1;
    const e = this._localeService.t("formula.progress.done");
    this._emitProgress(e);
  }
  clearProgress() {
    this._doneCalculationTaskCount = 0, this._totalCalculationTaskCount = 0, this._emitProgress();
  }
  dispose() {
    super.dispose(), this._progress$.next(Ta3), this._progress$.complete(), clearTimeout(this._setTimeoutKey);
  }
  _getCalculationMode() {
    var a4;
    const e = this._configService.getConfig(Ue3);
    return (a4 = e == null ? void 0 : e.initialFormulaComputing) != null ? a4 : Te2.WHEN_EMPTY;
  }
  _commandExecutedListener() {
    this.disposeWithMe(
      this._commandService.beforeCommandExecuted((e) => {
        if (e.id === Oo.id) {
          const a4 = e.params;
          a4.rowData = this._formulaDataModel.getHiddenRowsFiltered();
        }
      })
    ), this.disposeWithMe(
      this._commandService.onCommandExecuted((e, a4) => {
        if (this._activeDirtyManagerService.get(e.id)) {
          if (e.id === ee2.id) {
            const i = e.params;
            if (a4 && a4.onlyLocal === true || i.trigger === Ce.id || i.trigger === In2.id || i.trigger === Hs2.id)
              return;
          }
          this._waitingCommandQueue.push(e), clearTimeout(this._setTimeoutKey), this._setTimeoutKey = setTimeout(() => {
            const i = this._generateDirty(this._waitingCommandQueue);
            this._executingDirtyData = this._mergeDirty(this._executingDirtyData, i), this._executionInProgressParams == null ? this._commandService.executeCommand(Oo.id, __spreadValues({}, this._executingDirtyData), bt3) : (this._restartCalculation = true, this._commandService.executeCommand(So2.id, {})), this._waitingCommandQueue = [];
          }, 100);
        }
      })
    );
  }
  _generateDirty(e) {
    const a4 = [], i = {}, r = {}, o3 = {}, u2 = {}, f4 = {};
    for (const m9 of e) {
      const c2 = this._activeDirtyManagerService.get(m9.id);
      if (c2 == null)
        continue;
      const l4 = c2.getDirtyData(m9), { dirtyRanges: p3, dirtyNameMap: T10, dirtyDefinedNameMap: L6, dirtyUnitFeatureMap: I6, dirtyUnitOtherFormulaMap: A4, clearDependencyTreeCache: N6 } = l4;
      p3 != null && this._mergeDirtyRanges(a4, p3), T10 != null && this._mergeDirtyNameMap(i, T10), L6 != null && this._mergeDirtyNameMap(r, L6), I6 != null && this._mergeDirtyUnitFeatureOrOtherFormulaMap(o3, I6), A4 != null && this._mergeDirtyUnitFeatureOrOtherFormulaMap(u2, A4), N6 != null && this._mergeDirtyNameMap(f4, N6);
    }
    return {
      dirtyRanges: a4,
      dirtyNameMap: i,
      dirtyDefinedNameMap: r,
      dirtyUnitFeatureMap: o3,
      dirtyUnitOtherFormulaMap: u2,
      forceCalculation: false,
      clearDependencyTreeCache: f4,
      maxIteration: this._configService.getConfig(kb2)
      // numfmtItemMap,
    };
  }
  _mergeDirty(e, a4) {
    const i = [...e.dirtyRanges, ...a4.dirtyRanges], r = __spreadValues({}, e.dirtyNameMap), o3 = __spreadValues({}, e.dirtyDefinedNameMap), u2 = __spreadValues({}, e.dirtyUnitFeatureMap), f4 = __spreadValues({}, e.dirtyUnitOtherFormulaMap), m9 = __spreadValues({}, e.clearDependencyTreeCache);
    this._mergeDirtyNameMap(r, a4.dirtyNameMap), this._mergeDirtyNameMap(o3, a4.dirtyDefinedNameMap), this._mergeDirtyUnitFeatureOrOtherFormulaMap(u2, a4.dirtyUnitFeatureMap), this._mergeDirtyUnitFeatureOrOtherFormulaMap(f4, a4.dirtyUnitOtherFormulaMap), this._mergeDirtyNameMap(m9, a4.clearDependencyTreeCache);
    const c2 = e.maxIteration || a4.maxIteration;
    return {
      dirtyRanges: i,
      dirtyNameMap: r,
      dirtyDefinedNameMap: o3,
      dirtyUnitFeatureMap: u2,
      dirtyUnitOtherFormulaMap: f4,
      forceCalculation: !!this._forceCalculating,
      clearDependencyTreeCache: m9,
      maxIteration: c2
    };
  }
  /**
   * dirtyRanges may overlap with the ranges in allDirtyRanges and need to be deduplicated
   * @param allDirtyRanges
   * @param dirtyRanges
   */
  _mergeDirtyRanges(e, a4) {
    for (const i of a4) {
      let r = false;
      for (const o3 of e)
        if (i.unitId === o3.unitId && i.sheetId === o3.sheetId) {
          const { startRow: u2, startColumn: f4, endRow: m9, endColumn: c2 } = i.range, { startRow: l4, startColumn: p3, endRow: T10, endColumn: L6 } = o3.range;
          if (u2 === l4 && f4 === p3 && m9 === T10 && c2 === L6) {
            r = true;
            break;
          }
        }
      r || e.push(i);
    }
  }
  _mergeDirtyNameMap(e, a4) {
    Object.keys(a4).forEach((i) => {
      e[i] == null && (e[i] = {}), Object.keys(a4[i]).forEach((r) => {
        var o3;
        (o3 = a4[i]) != null && o3[r] && (e[i][r] = a4[i][r]);
      });
    });
  }
  _mergeDirtyUnitFeatureOrOtherFormulaMap(e, a4) {
    Object.keys(a4).forEach((i) => {
      e[i] == null && (e[i] = {}), Object.keys(a4[i]).forEach((r) => {
        e[i][r] == null && (e[i][r] = {}), Object.keys(a4[i][r]).forEach((o3) => {
          e[i][r][o3] = a4[i][r][o3] || false;
        });
      });
    });
  }
  // eslint-disable-next-line max-lines-per-function
  _initialExecuteFormulaProcessListener() {
    let e = null, a4 = 0;
    this.disposeWithMe(
      // eslint-disable-next-line max-lines-per-function, complexity
      this._commandService.onCommandExecuted((i) => {
        if (i.id === Oo.id) {
          const { forceCalculation: o3 = false } = i.params;
          o3 && (this._forceCalculating = true);
        } else i.id === So2.id && this.clearProgress();
        if (i.id !== Sn.id)
          return;
        const r = i.params;
        if (r.stageInfo != null) {
          const {
            stage: o3
          } = r.stageInfo;
          if (o3 === tt3.START)
            a4 === 0 && (this._startExecutionTime = performance.now()), a4++, e !== null && (clearTimeout(e), e = null), e = setTimeout(() => {
              e = null, this._startProgress();
            }, 1e3);
          else if (o3 === tt3.CURRENTLY_CALCULATING) {
            if (this._executionInProgressParams = r.stageInfo, e === null) {
              const u2 = this._localeService.t("formula.progress.calculating");
              this._calculateProgress(u2);
            }
          } else if (o3 === tt3.START_DEPENDENCY_ARRAY_FORMULA) {
            if (this._executionInProgressParams = r.stageInfo, e === null) {
              const u2 = this._localeService.t("formula.progress.array-analysis");
              this._calculateProgress(u2);
            }
          } else if (o3 === tt3.CURRENTLY_CALCULATING_ARRAY_FORMULA && (this._executionInProgressParams = r.stageInfo, e === null)) {
            const u2 = this._localeService.t("formula.progress.array-calculation");
            this._calculateProgress(u2);
          }
        } else {
          const o3 = r.functionsExecutedState;
          let u2 = "";
          switch (a4--, o3) {
            case Ir.NOT_EXECUTED:
              u2 = "No tasks are being executed anymore", this._resetExecutingDirtyData();
              break;
            case Ir.STOP_EXECUTION:
              u2 = "The execution of the formula has been stopped", a4 = 0;
              break;
            case Ir.SUCCESS:
              u2 = "Formula calculation succeeded", (a4 === 0 || a4 === -1) && (u2 += `. Total time consumed: ${performance.now() - this._startExecutionTime} ms`), this._resetExecutingDirtyData();
              break;
            case Ir.INITIAL:
              u2 = "Waiting for calculation", this._resetExecutingDirtyData();
              break;
          }
          (a4 === 0 || a4 === -1) && (e ? (clearTimeout(e), e = null, this.clearProgress()) : this._completeProgress(), a4 = 0, this._doneCalculationTaskCount = 0, this._totalCalculationTaskCount = 0, this._forceCalculating = false), o3 === Ir.STOP_EXECUTION && this._restartCalculation ? (this._restartCalculation = false, this._commandService.executeCommand(
            Oo.id,
            __spreadValues({}, this._executingDirtyData),
            bt3
          )) : this._executionInProgressParams = null, this._logService.debug("[TriggerCalculationController]", u2);
        }
      })
    );
  }
  _resetExecutingDirtyData() {
    this._executingDirtyData = {
      dirtyRanges: [],
      dirtyNameMap: {},
      dirtyDefinedNameMap: {},
      dirtyUnitFeatureMap: {},
      dirtyUnitOtherFormulaMap: {},
      forceCalculation: false,
      clearDependencyTreeCache: {}
    };
  }
  _initialExecuteFormula() {
    const e = this._getCalculationMode(), a4 = this._getDirtyDataByCalculationMode(e);
    this._commandService.executeCommand(Oo.id, a4, bt3), this._registerOtherFormulaService.calculateStarted$.next(true);
  }
  _getDirtyDataByCalculationMode(e) {
    const a4 = e === Te2.FORCED, i = e === Te2.WHEN_EMPTY ? this._formulaDataModel.getFormulaDirtyRanges() : [];
    return {
      forceCalculation: a4,
      dirtyRanges: i,
      dirtyNameMap: {},
      dirtyDefinedNameMap: {},
      dirtyUnitFeatureMap: {},
      dirtyUnitOtherFormulaMap: {},
      clearDependencyTreeCache: {},
      maxIteration: this._configService.getConfig(kb2)
    };
  }
};
ge4 = xi([
  pe(0, Ds),
  pe(1, Mb),
  pe(2, Nt),
  pe(3, xs),
  pe(4, Inject(yr)),
  pe(5, Inject(Hn)),
  pe(6, Inject(et3))
], ge4);
function _i(n3, e, a4) {
  var i;
  return n3 == null || n3[e] == null || ((i = n3[e]) == null ? void 0 : i[a4]) == null;
}
function Ot2(n3, e, a4) {
  var i;
  if (a4) {
    if (n3 && n3[e] && ((i = n3[e]) != null && i[a4]))
      return delete n3[e][a4], {
        [e]: {
          [a4]: null
        }
      };
  } else if (n3 && n3[e])
    return delete n3[e], {
      [e]: null
    };
}
var y3 = ((n3) => (n3[n3.MoveRange = 0] = "MoveRange", n3[n3.MoveRows = 1] = "MoveRows", n3[n3.MoveCols = 2] = "MoveCols", n3[n3.InsertRow = 3] = "InsertRow", n3[n3.InsertColumn = 4] = "InsertColumn", n3[n3.RemoveRow = 5] = "RemoveRow", n3[n3.RemoveColumn = 6] = "RemoveColumn", n3[n3.DeleteMoveLeft = 7] = "DeleteMoveLeft", n3[n3.DeleteMoveUp = 8] = "DeleteMoveUp", n3[n3.InsertMoveDown = 9] = "InsertMoveDown", n3[n3.InsertMoveRight = 10] = "InsertMoveRight", n3[n3.SetName = 11] = "SetName", n3[n3.RemoveSheet = 12] = "RemoveSheet", n3[n3.SetDefinedName = 13] = "SetDefinedName", n3[n3.RemoveDefinedName = 14] = "RemoveDefinedName", n3))(y3 || {});
var yi2 = [
  11,
  12,
  13,
  14
  /* RemoveDefinedName */
];
function gi2(n3, e, a4) {
  const { type: i } = a4;
  return yi2.includes(i) ? hi2(n3, e) : qi2(n3, e, a4);
}
function hi2(n3, e) {
  const a4 = [], i = [];
  return Object.keys(e).forEach((r) => {
    const o3 = e[r], u2 = n3[r];
    if (o3 == null || u2 == null)
      return true;
    Object.keys(o3).forEach((f4) => {
      const m9 = new ht(o3[f4] || {}), c2 = new ht(u2[f4] || {}), l4 = new ht(), p3 = new ht();
      if (m9.forValue((N6, d2, S) => {
        if (S == null)
          return true;
        const R9 = he(S);
        R9 !== null && (l4.setValue(N6, d2, R9), p3.setValue(N6, d2, c2.getValue(N6, d2)));
      }), l4.getSizeOf() === 0)
        return;
      const T10 = {
        subUnitId: f4,
        unitId: r,
        cellValue: l4.getMatrix()
      }, L6 = {
        id: ee2.id,
        params: T10
      };
      i.push(L6);
      const I6 = {
        subUnitId: f4,
        unitId: r,
        cellValue: p3.getMatrix()
      }, A4 = {
        id: ee2.id,
        params: I6
      };
      a4.push(A4);
    });
  }), {
    undos: a4,
    redos: i
  };
}
function qi2(n3, e, a4) {
  const { redoFormulaData: i, undoFormulaData: r } = Ui(n3, e, a4), o3 = [], u2 = [];
  return Object.keys(i).forEach((f4) => {
    Object.keys(i[f4]).forEach((m9) => {
      if (Object.keys(i[f4][m9]).length !== 0) {
        const c2 = {
          subUnitId: m9,
          unitId: f4,
          cellValue: i[f4][m9]
        }, l4 = {
          id: ee2.id,
          params: c2
        };
        o3.push(l4);
      }
    });
  }), Object.keys(r).forEach((f4) => {
    Object.keys(r[f4]).forEach((m9) => {
      if (Object.keys(r[f4][m9]).length !== 0) {
        const c2 = {
          subUnitId: m9,
          unitId: f4,
          cellValue: r[f4][m9]
        }, l4 = {
          id: ee2.id,
          params: c2
        };
        u2.push(l4);
      }
    });
  }), {
    undos: u2,
    redos: o3
  };
}
function Ui(n3, e, a4) {
  const i = {}, r = {}, { unitId: o3, sheetId: u2 } = a4;
  return (/* @__PURE__ */ new Set([...Object.keys(n3), ...Object.keys(e)])).forEach((m9) => {
    if (_i(n3, m9, u2))
      return;
    (/* @__PURE__ */ new Set([
      ...Object.keys(n3[m9] || {}),
      ...Object.keys(e[m9] || {})
    ])).forEach((l4) => {
      var S, R9;
      const p3 = (S = n3[m9]) == null ? void 0 : S[l4], T10 = (R9 = e[m9]) == null ? void 0 : R9[l4], L6 = new ht(p3 || {}), I6 = new ht(T10 || {});
      let A4 = [];
      m9 !== o3 || l4 !== u2 ? A4 = Bi2(I6) : A4 = Fi(L6, I6, a4);
      const N6 = zi(A4, L6, I6), d2 = Zi(A4, L6);
      i[m9] || (i[m9] = {}), r[m9] || (r[m9] = {}), i[m9][l4] = __spreadValues(__spreadValues({}, i[m9][l4]), N6), r[m9][l4] = __spreadValues(__spreadValues({}, r[m9][l4]), d2);
    });
  }), {
    redoFormulaData: i,
    undoFormulaData: r
  };
}
function Fi(n3, e, a4) {
  const { type: i, from: r, to: o3, range: u2 } = a4, f4 = [];
  return n3.forValue((m9, c2, l4) => {
    if (l4 == null || !ka4(l4)) return true;
    const p3 = QR(m9, c2);
    let T10 = null, L6 = false;
    if ([
      0,
      1,
      2
      /* MoveCols */
    ].includes(i))
      T10 = vi3(i, r, o3, p3);
    else if (u2 != null) {
      const I6 = Vi2(p3, a4);
      T10 = I6.newCell, L6 = I6.isReverse;
    }
    if (Z.diffValue(p3, T10) && !e.getValue(m9, c2))
      return true;
    L6 ? f4.unshift({ oldCell: p3, newCell: T10 }) : f4.push({ oldCell: p3, newCell: T10 });
  }), f4;
}
function Bi2(n3) {
  const e = [];
  return n3.forValue((a4, i, r) => {
    if (r == null || !ka4(r)) return true;
    const o3 = QR(a4, i);
    e.push({ oldCell: o3, newCell: o3 });
  }), e;
}
function vi3(n3, e, a4, i) {
  if (e == null || a4 == null)
    return null;
  switch (n3) {
    case 0:
      return Gi2(e, a4, i);
    case 1:
      return Hi2(e, a4, i);
    case 2:
      return wi2(e, a4, i);
    default:
      return null;
  }
}
function Vi2(n3, e) {
  const { type: a4, rangeFilteredRows: i } = e, r = e.range;
  let o3 = null, u2 = false;
  switch (a4) {
    case 3:
      o3 = Yi(r, n3), u2 = true;
      break;
    case 4:
      o3 = Xi2(r, n3), u2 = true;
      break;
    case 5:
      o3 = Wi(r, n3, i);
      break;
    case 6:
      o3 = Ki2(r, n3);
      break;
    case 7:
      o3 = ki(r, n3);
      break;
    case 8:
      o3 = Qi2(r, n3);
      break;
    case 9:
      o3 = $i(r, n3), u2 = true;
      break;
    case 10:
      o3 = ji2(r, n3), u2 = true;
      break;
  }
  return { newCell: o3, isReverse: u2 };
}
function Gi2(n3, e, a4) {
  const i = Ml(
    {
      id: W2.MoveRangeCommandId,
      params: { toRange: e, fromRange: n3 }
    },
    a4
  );
  return Dt(i, a4);
}
function Hi2(n3, e, a4) {
  const i = jr2(
    {
      id: W2.MoveRowsCommandId,
      params: { toRange: e, fromRange: n3 }
    },
    a4
  );
  return Dt(i, a4);
}
function wi2(n3, e, a4) {
  const i = zr(
    {
      id: W2.MoveColsCommandId,
      params: { toRange: e, fromRange: n3 }
    },
    a4
  );
  return Dt(i, a4);
}
function Yi(n3, e) {
  const a4 = kl2(
    {
      id: W2.InsertRowCommandId,
      params: { range: n3, unitId: "", subUnitId: "", direction: wm.DOWN }
    },
    e
  );
  return Dt(a4, e);
}
function Xi2(n3, e) {
  const a4 = Ul(
    {
      id: W2.InsertColCommandId,
      params: { range: n3, unitId: "", subUnitId: "", direction: wm.RIGHT }
    },
    e
  );
  return Dt(a4, e);
}
function Wi(n3, e, a4) {
  const i = yl3(
    {
      id: W2.RemoveRowCommandId,
      params: { range: n3 }
    },
    e,
    a4
  );
  return Dt(i, e);
}
function Ki2(n3, e) {
  const a4 = Gr3(
    {
      id: W2.RemoveColCommandId,
      params: { range: n3 }
    },
    e
  );
  return Dt(a4, e);
}
function ki(n3, e) {
  const a4 = Dl(
    {
      id: W2.DeleteRangeMoveLeftCommandId,
      params: { range: n3 }
    },
    e
  );
  return Dt(a4, e);
}
function Qi2(n3, e) {
  const a4 = xl2(
    {
      id: W2.DeleteRangeMoveUpCommandId,
      params: { range: n3 }
    },
    e
  );
  return Dt(a4, e);
}
function $i(n3, e) {
  const a4 = Tl(
    {
      id: W2.InsertRangeMoveDownCommandId,
      params: { range: n3 }
    },
    e
  );
  return Dt(a4, e);
}
function ji2(n3, e) {
  const a4 = Nl3(
    {
      id: W2.InsertRangeMoveRightCommandId,
      params: { range: n3 }
    },
    e
  );
  return Dt(a4, e);
}
function zi(n3, e, a4) {
  var r, o3, u2;
  const i = new ht({});
  for (let f4 = 0; f4 < n3.length; f4++) {
    const { oldCell: m9, newCell: c2 } = n3[f4];
    if ((r = i.getValue(m9.startRow, m9.startColumn)) != null && r.f || (o3 = i.getValue(m9.startRow, m9.startColumn)) != null && o3.si || i.setValue(m9.startRow, m9.startColumn, { f: null, si: null }), c2) {
      const l4 = (u2 = a4.getValue(m9.startRow, m9.startColumn)) != null ? u2 : e.getValue(m9.startRow, m9.startColumn), p3 = he(l4);
      i.setValue(c2.startRow, c2.startColumn, p3);
    }
  }
  return i.getMatrix();
}
function Zi(n3, e) {
  const a4 = new ht({});
  for (let i = n3.length - 1; i >= 0; i--) {
    const { oldCell: r, newCell: o3 } = n3[i], u2 = e.getValue(r.startRow, r.startColumn), f4 = he(u2);
    if (a4.setValue(r.startRow, r.startColumn, f4), o3) {
      const m9 = e.getValue(o3.startRow, o3.startColumn), c2 = he(m9);
      a4.setValue(o3.startRow, o3.startColumn, c2 != null ? c2 : { f: null, si: null });
    }
  }
  return a4.getMatrix();
}
function he(n3) {
  if (n3 == null)
    return null;
  const { f: e, si: a4, x: i = 0, y: r = 0 } = n3, o3 = Jg(e), u2 = KR(a4);
  if (!o3 && !u2)
    return {
      f: null,
      si: null
    };
  const f4 = {};
  return u2 && (f4.si = a4), o3 && i === 0 && r === 0 && (f4.f = e), f4.f === void 0 && (f4.f = null), f4.si === void 0 && (f4.si = null), f4;
}
function Ji3(n3) {
  const e = new ht({});
  return new ht(n3).forValue((i, r, o3) => {
    const u2 = he(o3);
    u2 !== void 0 && e.setValue(i, r, u2);
  }), e.getMatrix();
}
function ka4(n3) {
  const e = (n3 == null ? void 0 : n3.f) || "", a4 = (n3 == null ? void 0 : n3.si) || "", i = Jg(e), r = KR(a4);
  return !!(i || r);
}
function Qa2(n3, e, a4, i, r, o3) {
  if ((r == null || r.length === 0) && (o3 == null || o3.length === 0)) {
    if (n3 === a4 && e === i)
      return true;
  } else if ((n3 === r || r == null || r.length === 0) && e === o3)
    return true;
  return false;
}
function $a3(n3, e, a4 = 0, i = 0) {
  const r = [];
  for (let o3 = 0, u2 = n3.length; o3 < u2; o3++) {
    const f4 = n3[o3];
    if (typeof f4 == "string" || f4.nodeType !== He.REFERENCE || e.includes(o3)) {
      r.push(f4);
      continue;
    }
    const { token: m9 } = f4, c2 = br3(m9), { range: l4, sheetName: p3, unitId: T10 } = c2, L6 = Cn.moveOffset(l4, a4, i);
    r.push(__spreadProps(__spreadValues({}, f4), {
      token: Ts2({
        range: L6,
        unitId: T10,
        sheetName: p3
      })
    }));
  }
  return r;
}
function ja5(n3, e, a4, i) {
  const { type: r, unitId: o3, sheetId: u2, range: f4, from: m9, to: c2, rangeFilteredRows: l4 } = e, {
    range: p3,
    sheetId: T10,
    unitId: L6,
    sheetName: I6,
    refOffsetX: A4,
    refOffsetY: N6
  } = n3;
  if (!Qa2(
    o3,
    u2,
    a4,
    i,
    L6,
    T10
  ))
    return;
  const d2 = Cn.moveOffset(p3, A4, N6);
  let S = null;
  if (r === y3.MoveRange) {
    if (m9 == null || c2 == null)
      return;
    const R9 = xt2(d2, m9), P8 = Gp(d2, m9);
    if (P8 == null || R9 !== 4)
      return;
    const h9 = Ml(
      { id: W2.MoveRangeCommandId, params: { toRange: c2, fromRange: m9 } },
      P8
    ), M10 = Dt(h9, P8);
    if (M10 == null)
      return h.REF;
    S = Mt3(R9, M10, m9, c2, d2, P8);
  } else if (r === y3.MoveRows) {
    if (m9 == null || c2 == null)
      return;
    const R9 = xt2(d2, m9);
    let P8 = Gp(d2, m9);
    if (P8 == null && (m9.endRow < d2.startRow && c2.endRow <= d2.startRow || m9.startRow > d2.endRow && c2.startRow > d2.endRow))
      return;
    P8 == null && (P8 = {
      startRow: d2.startRow,
      endRow: d2.endRow,
      startColumn: d2.startColumn,
      endColumn: d2.endColumn,
      rangeType: ge.NORMAL
    });
    const h9 = jr2(
      { id: W2.MoveRowsCommandId, params: { toRange: c2, fromRange: m9 } },
      P8
    ), M10 = Dt(h9, P8);
    if (M10 == null)
      return h.REF;
    S = Mt3(R9, M10, m9, c2, d2, P8);
  } else if (r === y3.MoveCols) {
    if (m9 == null || c2 == null)
      return;
    const R9 = xt2(d2, m9);
    let P8 = Gp(d2, m9);
    if (P8 == null && (m9.endColumn < d2.startColumn && c2.endColumn <= d2.startColumn || m9.startColumn > d2.endColumn && c2.startColumn > d2.endColumn))
      return;
    P8 == null && (P8 = {
      startRow: d2.startRow,
      endRow: d2.endRow,
      startColumn: d2.startColumn,
      endColumn: d2.endColumn,
      rangeType: ge.NORMAL
    });
    const h9 = zr(
      { id: W2.MoveColsCommandId, params: { toRange: c2, fromRange: m9 } },
      P8
    ), M10 = Dt(h9, P8);
    if (M10 == null)
      return h.REF;
    S = Mt3(R9, M10, m9, c2, d2, P8);
  }
  if (f4 != null) {
    if (r === y3.InsertRow) {
      const R9 = kl2(
        {
          id: W2.InsertRowCommandId,
          params: { range: f4, unitId: "", subUnitId: "", direction: wm.DOWN }
        },
        d2
      ), P8 = Dt(R9, d2);
      if (P8 == null)
        return;
      S = __spreadValues(__spreadValues({}, d2), P8);
    } else if (r === y3.InsertColumn) {
      const R9 = Ul(
        {
          id: W2.InsertColCommandId,
          params: { range: f4, unitId: "", subUnitId: "", direction: wm.RIGHT }
        },
        d2
      ), P8 = Dt(R9, d2);
      if (P8 == null)
        return;
      S = __spreadValues(__spreadValues({}, d2), P8);
    } else if (r === y3.RemoveRow) {
      const R9 = yl3(
        {
          id: W2.RemoveRowCommandId,
          params: { range: f4 }
        },
        d2,
        l4
      ), P8 = Dt(R9, d2);
      if (P8 == null)
        return h.REF;
      S = __spreadValues(__spreadValues({}, d2), P8);
    } else if (r === y3.RemoveColumn) {
      const R9 = Gr3(
        {
          id: W2.RemoveColCommandId,
          params: { range: f4 }
        },
        d2
      ), P8 = Dt(R9, d2);
      if (P8 == null)
        return h.REF;
      S = __spreadValues(__spreadValues({}, d2), P8);
    } else if (r === y3.DeleteMoveLeft) {
      const R9 = Dl(
        {
          id: W2.DeleteRangeMoveLeftCommandId,
          params: { range: f4 }
        },
        d2
      ), P8 = Dt(R9, d2);
      if (P8 == null)
        return h.REF;
      S = __spreadValues(__spreadValues({}, d2), P8);
    } else if (r === y3.DeleteMoveUp) {
      const R9 = xl2(
        {
          id: W2.DeleteRangeMoveUpCommandId,
          params: { range: f4 }
        },
        d2
      ), P8 = Dt(R9, d2);
      if (P8 == null)
        return h.REF;
      S = __spreadValues(__spreadValues({}, d2), P8);
    } else if (r === y3.InsertMoveDown) {
      const R9 = Tl(
        {
          id: W2.InsertRangeMoveDownCommandId,
          params: { range: f4 }
        },
        d2
      ), P8 = Dt(R9, d2);
      if (P8 == null)
        return;
      S = __spreadValues(__spreadValues({}, d2), P8);
    } else if (r === y3.InsertMoveRight) {
      const R9 = Nl3(
        {
          id: W2.InsertRangeMoveRightCommandId,
          params: { range: f4 }
        },
        d2
      ), P8 = Dt(R9, d2);
      if (P8 == null)
        return;
      S = __spreadValues(__spreadValues({}, d2), P8);
    }
  }
  if (S != null)
    return Ts2({
      range: S,
      sheetName: I6,
      unitId: L6
    });
}
function Mt3(n3, e, a4, i, r, o3) {
  const { startRow: u2, endRow: f4, startColumn: m9, endColumn: c2, rangeType: l4 } = xe3(e), {
    startRow: p3,
    startColumn: T10,
    endRow: L6,
    endColumn: I6,
    rangeType: A4 = ge.NORMAL
  } = xe3(a4), { startRow: N6, startColumn: d2, endRow: S, endColumn: R9 } = xe3(i), {
    startRow: P8,
    endRow: h9,
    startColumn: M10,
    endColumn: U3
  } = xe3(o3), {
    startRow: q9,
    endRow: x7,
    startColumn: F7,
    endColumn: B5,
    rangeType: ae5 = ge.NORMAL
  } = xe3(r), O9 = __spreadValues({}, r);
  function ce5() {
    return l4 === ge.COLUMN && ae5 === ge.COLUMN ? true : m9 >= F7 && c2 <= B5;
  }
  function ne4() {
    return l4 === ge.ROW && ae5 === ge.ROW ? true : u2 >= q9 && f4 <= x7;
  }
  if (n3 === 0)
    if (ce5())
      if (u2 < q9)
        O9.startRow = u2;
      else if (u2 >= x7)
        O9.endRow -= L6 + 1 - q9;
      else
        return;
    else
      return;
  else if (n3 === 1)
    if (ce5())
      if (f4 > x7)
        O9.endRow = f4;
      else if (f4 <= q9)
        O9.startRow += x7 - p3 + 1;
      else
        return;
    else
      return;
  else if (n3 === 2)
    if (ne4())
      if (m9 < F7)
        O9.startColumn = m9;
      else if (m9 >= B5)
        O9.endColumn -= I6 + 1 - F7;
      else
        return;
    else
      return;
  else if (n3 === 3)
    if (ne4())
      if (c2 > B5)
        O9.endColumn = c2;
      else if (c2 <= F7)
        O9.startColumn += B5 - T10 + 1;
      else
        return;
    else
      return;
  else n3 === 4 ? (O9.startRow = u2, O9.startColumn = m9, O9.endRow = f4, O9.endColumn = c2) : T10 <= F7 && I6 >= B5 || A4 === ge.ROW && ae5 === ge.ROW ? a4.endRow < q9 ? (N6 >= q9 && (O9.startRow -= L6 - p3 + 1), N6 >= x7 && (O9.endRow -= L6 - p3 + 1)) : a4.startRow > x7 ? (S <= x7 && (O9.endRow += L6 - p3 + 1), S <= q9 && (O9.startRow += L6 - p3 + 1)) : a4.startRow >= q9 && a4.endRow <= x7 && (N6 <= q9 ? O9.startRow += L6 - p3 + 1 : N6 >= x7 && (O9.endRow -= L6 - p3 + 1)) : p3 <= q9 && L6 >= x7 || A4 === ge.COLUMN && ae5 === ge.COLUMN ? a4.endColumn < F7 ? (d2 >= F7 && (O9.startColumn -= I6 - T10 + 1), d2 >= B5 && (O9.endColumn -= I6 - T10 + 1)) : a4.startColumn > B5 ? (R9 <= B5 && (O9.endColumn += I6 - T10 + 1), R9 <= F7 && (O9.startColumn += I6 - T10 + 1)) : a4.startColumn >= F7 && a4.endColumn <= B5 && (d2 <= F7 ? O9.startColumn += I6 - T10 + 1 : d2 >= B5 && (O9.endColumn -= I6 - T10 + 1)) : ((d2 <= U3 + 1 && R9 >= B5 || d2 <= F7 && R9 >= M10 - 1) && N6 <= q9 && S >= x7 || (N6 <= h9 + 1 && S >= x7 || N6 <= q9 && S >= P8 - 1) && d2 <= F7 && R9 >= B5, O9.startRow = u2, O9.startColumn = m9, O9.endRow = f4, O9.endColumn = c2);
  return O9;
}
function xt2(n3, e) {
  const a4 = Se3(n3.startRow), i = Ae5(n3.endRow), r = Se3(n3.startColumn), o3 = Ae5(n3.endColumn), u2 = Se3(e.startRow), f4 = Ae5(e.endRow), m9 = Se3(e.startColumn), c2 = Ae5(e.endColumn);
  function l4() {
    return n3.rangeType === ge.COLUMN && e.rangeType === ge.COLUMN ? true : a4 >= u2 && i <= f4;
  }
  function p3() {
    return n3.rangeType === ge.ROW && e.rangeType === ge.ROW ? true : r >= m9 && o3 <= c2;
  }
  function T10() {
    return n3.rangeType === ge.ALL && e.rangeType === ge.ALL;
  }
  return l4() && p3() || T10() ? 4 : p3() && a4 >= u2 && a4 <= f4 && i > f4 ? 0 : p3() && i >= u2 && i <= f4 && a4 < u2 ? 1 : l4() && r >= m9 && r <= c2 && o3 > c2 ? 2 : l4() && o3 >= m9 && o3 <= c2 && r < m9 ? 3 : null;
}
function Se3(n3) {
  return isNaN(n3) ? -1 / 0 : n3;
}
function Ae5(n3) {
  return isNaN(n3) ? 1 / 0 : n3;
}
function xe3(n3) {
  const { startRow: e, endRow: a4, startColumn: i, endColumn: r } = n3;
  return __spreadProps(__spreadValues({}, n3), {
    startRow: Se3(e),
    endRow: Ae5(a4),
    startColumn: Se3(i),
    endColumn: Ae5(r)
  });
}
function za3(n3, e) {
  const { id: a4 } = e;
  let i = null;
  switch (a4) {
    case yt2.id:
      i = er3(e, n3);
      break;
    case an.id:
      i = tr2(e, n3);
      break;
    case un.id:
      i = ar4(e, n3);
      break;
    case Ye3.id:
      i = nr4(e);
      break;
    case Xe6.id:
      i = ir5(e);
      break;
    case rn.id:
      i = rr3(e, n3);
      break;
    case Pt4.id:
      i = or3(e, n3);
      break;
    case hs.id:
      i = ur3(e, n3);
      break;
    case gs.id:
      i = mr3(e, n3);
      break;
    case vt2.id:
      i = fr5(e, n3);
      break;
    case It2.id:
      i = cr3(e, n3);
      break;
    case eo2.id:
      i = lr3(e, n3);
      break;
    case Zs.id:
      i = sr3(e, n3);
      break;
    case ni.id:
      i = dr3(e, n3);
      break;
    case Qr2.id:
      i = pr3(e, n3);
      break;
  }
  return i;
}
function te2(n3) {
  var i;
  const e = n3.getUnitId(), a4 = ((i = n3.getActiveSheet()) == null ? void 0 : i.getSheetId()) || "";
  return {
    unitId: e,
    sheetId: a4
  };
}
function er3(n3, e) {
  const { params: a4 } = n3;
  if (!a4) return null;
  const { fromRange: i, toRange: r } = a4;
  if (!i || !r) return null;
  const { unitId: o3, sheetId: u2 } = te2(e);
  return {
    type: y3.MoveRange,
    from: i,
    to: r,
    unitId: o3,
    sheetId: u2
  };
}
function tr2(n3, e) {
  const { params: a4 } = n3;
  if (!a4) return null;
  const {
    fromRange: { startRow: i, endRow: r },
    toRange: { startRow: o3, endRow: u2 }
  } = a4, f4 = e.getUnitId(), m9 = e.getActiveSheet();
  if (!m9) return null;
  const c2 = m9.getSheetId(), l4 = {
    startRow: i,
    startColumn: 0,
    endRow: r,
    endColumn: m9.getColumnCount() - 1,
    rangeType: ge.ROW
  }, p3 = {
    startRow: o3,
    startColumn: 0,
    endRow: u2,
    endColumn: m9.getColumnCount() - 1,
    rangeType: ge.ROW
  };
  return {
    type: y3.MoveRows,
    from: l4,
    to: p3,
    unitId: f4,
    sheetId: c2
  };
}
function ar4(n3, e) {
  const { params: a4 } = n3;
  if (!a4) return null;
  const {
    fromRange: { startColumn: i, endColumn: r },
    toRange: { startColumn: o3, endColumn: u2 }
  } = a4, f4 = e.getUnitId(), m9 = e.getActiveSheet();
  if (!m9) return null;
  const c2 = m9.getSheetId(), l4 = {
    startRow: 0,
    startColumn: i,
    endRow: m9.getRowCount() - 1,
    endColumn: r,
    rangeType: ge.COLUMN
  }, p3 = {
    startRow: 0,
    startColumn: o3,
    endRow: m9.getRowCount() - 1,
    endColumn: u2,
    rangeType: ge.COLUMN
  };
  return {
    type: y3.MoveCols,
    from: l4,
    to: p3,
    unitId: f4,
    sheetId: c2
  };
}
function nr4(n3) {
  const { params: e } = n3;
  if (!e) return null;
  const { range: a4, unitId: i, subUnitId: r } = e;
  return {
    type: y3.InsertRow,
    range: a4,
    unitId: i,
    sheetId: r
  };
}
function ir5(n3) {
  const { params: e } = n3;
  if (!e) return null;
  const { range: a4, unitId: i, subUnitId: r } = e;
  return {
    type: y3.InsertColumn,
    range: a4,
    unitId: i,
    sheetId: r
  };
}
function rr3(n3, e) {
  const { params: a4 } = n3;
  if (!a4) return null;
  const { range: i } = a4, { unitId: r, sheetId: o3 } = te2(e);
  return {
    type: y3.InsertMoveRight,
    range: i,
    unitId: r,
    sheetId: o3
  };
}
function or3(n3, e) {
  const { params: a4 } = n3;
  if (!a4) return null;
  const { range: i } = a4, { unitId: r, sheetId: o3 } = te2(e);
  return {
    type: y3.InsertMoveDown,
    range: i,
    unitId: r,
    sheetId: o3
  };
}
function ur3(n3, e) {
  var u2, f4;
  const { params: a4 } = n3;
  if (!a4) return null;
  const { range: i } = a4, { unitId: r, sheetId: o3 } = te2(e);
  return {
    type: y3.RemoveRow,
    range: i,
    unitId: r,
    sheetId: o3,
    rangeFilteredRows: (f4 = (u2 = e.getSheetBySheetId(o3)) == null ? void 0 : u2.getRangeFilterRows(i)) != null ? f4 : []
  };
}
function mr3(n3, e) {
  const { params: a4 } = n3;
  if (!a4) return null;
  const { range: i } = a4, { unitId: r, sheetId: o3 } = te2(e);
  return {
    type: y3.RemoveColumn,
    range: i,
    unitId: r,
    sheetId: o3
  };
}
function fr5(n3, e) {
  const { params: a4 } = n3;
  if (!a4) return null;
  const { range: i } = a4, { unitId: r, sheetId: o3 } = te2(e);
  return {
    type: y3.DeleteMoveUp,
    range: i,
    unitId: r,
    sheetId: o3
  };
}
function cr3(n3, e) {
  const { params: a4 } = n3;
  if (!a4) return null;
  const { range: i } = a4, { unitId: r, sheetId: o3 } = te2(e);
  return {
    type: y3.DeleteMoveLeft,
    range: i,
    unitId: r,
    sheetId: o3
  };
}
function lr3(n3, e) {
  const { params: a4 } = n3;
  if (!a4) return null;
  const { unitId: i, subUnitId: r, name: o3 } = a4, { unitId: u2, sheetId: f4 } = te2(e);
  return {
    type: y3.SetName,
    unitId: i || u2,
    sheetId: r || f4,
    sheetName: o3
  };
}
function sr3(n3, e) {
  const { params: a4 } = n3;
  if (!a4) return null;
  const { unitId: i, subUnitId: r } = a4, { unitId: o3, sheetId: u2 } = te2(e);
  return {
    type: y3.RemoveSheet,
    unitId: i || o3,
    sheetId: r || u2
  };
}
function dr3(n3, e) {
  const { params: a4 } = n3;
  if (!a4) return null;
  const { unitId: i, name: r, id: o3 } = a4, { sheetId: u2 } = te2(e);
  return {
    type: y3.SetDefinedName,
    unitId: i,
    sheetId: u2,
    definedName: r,
    definedNameId: o3
  };
}
function pr3(n3, e) {
  const { params: a4 } = n3;
  if (!a4) return null;
  const { unitId: i, name: r, id: o3 } = a4, { sheetId: u2 } = te2(e);
  return {
    type: y3.RemoveDefinedName,
    unitId: i,
    sheetId: u2,
    definedName: r,
    definedNameId: o3
  };
}
var Lr3 = Object.getOwnPropertyDescriptor;
var Pr3 = (n3, e, a4, i) => {
  for (var r = i > 1 ? void 0 : i ? Lr3(e, a4) : e, o3 = n3.length - 1, u2; o3 >= 0; o3--)
    (u2 = n3[o3]) && (r = u2(r) || r);
  return r;
};
var He3 = (n3, e) => (a4, i) => e(a4, i, n3);
var tt4 = class extends Ve {
  constructor(n3, e, a4, i) {
    super(), this._definedNamesService = n3, this._univerInstanceService = e, this._sheetInterceptorService = a4, this._lexerTreeBuilder = i, this._initialize();
  }
  _initialize() {
    this._commandExecutedListener();
  }
  _commandExecutedListener() {
    this.disposeWithMe(
      this._sheetInterceptorService.interceptCommand({
        getMutations: (n3) => {
          if (n3.id === ni.id || n3.id === Qr2.id)
            return {
              redos: [],
              undos: []
            };
          const e = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET);
          if (e == null)
            return {
              redos: [],
              undos: []
            };
          const a4 = za3(e, n3);
          return a4 ? this._getUpdateDefinedNameMutations(e, a4) : {
            redos: [],
            undos: []
          };
        }
      })
    );
  }
  // eslint-disable-next-line max-lines-per-function
  _getUpdateDefinedNameMutations(n3, e) {
    const { type: a4, unitId: i, sheetId: r } = e, o3 = this._definedNamesService.getDefinedNameMap(i);
    if (!o3)
      return {
        redos: [],
        undos: []
      };
    const u2 = [], f4 = [];
    return Object.values(o3).forEach((m9) => {
      var N6;
      const { formulaOrRefString: c2 } = m9, l4 = this._lexerTreeBuilder.sequenceNodesBuilder(c2);
      if (l4 == null)
        return true;
      let p3 = false;
      const T10 = [];
      for (let d2 = 0, S = l4.length; d2 < S; d2++) {
        const R9 = l4[d2];
        if (typeof R9 == "string" || R9.nodeType !== He.REFERENCE)
          continue;
        const { token: P8 } = R9, h9 = br3(P8), { range: M10, sheetName: U3, unitId: q9 } = h9, x7 = ((N6 = n3.getSheetBySheetName(U3)) == null ? void 0 : N6.getSheetId()) || "", F7 = {
          range: M10,
          sheetId: x7,
          unitId: q9,
          sheetName: U3,
          refOffsetX: 0,
          refOffsetY: 0
        };
        let B5 = null;
        if (a4 === y3.RemoveSheet)
          B5 = this._removeSheet(m9, i, r);
        else if (a4 === y3.SetName) {
          const {
            sheetId: ae5,
            sheetName: O9
          } = e;
          if (O9 == null || x7 == null || x7.length === 0 || ae5 !== x7)
            continue;
          B5 = Ts2({
            range: M10,
            sheetName: O9,
            unitId: q9
          });
        } else
          B5 = ja5(
            F7,
            e,
            i,
            r
          );
        B5 != null && (l4[d2] = __spreadProps(__spreadValues({}, R9), {
          token: B5
        }), p3 = true, T10.push(d2));
      }
      if (!p3)
        return true;
      const L6 = yi($a3(l4, T10)), I6 = {
        id: _a2.id,
        params: __spreadProps(__spreadValues({
          unitId: i
        }, m9), {
          formulaOrRefString: L6
        })
      };
      u2.push(I6);
      const A4 = {
        id: _a2.id,
        params: __spreadValues({
          unitId: i
        }, m9)
      };
      f4.push(A4);
    }), {
      redos: u2,
      undos: f4
    };
  }
  _removeSheet(n3, e, a4) {
    var o3;
    const { formulaOrRefString: i } = n3;
    return ((o3 = this._definedNamesService.getWorksheetByRef(e, i)) == null ? void 0 : o3.getSheetId()) === a4 ? h.REF : null;
  }
};
tt4 = Pr3([
  He3(0, Lr),
  He3(1, br),
  He3(2, Inject(G)),
  He3(3, Inject(Mn))
], tt4);
var Tr3 = Object.getOwnPropertyDescriptor;
var Er2 = (n3, e, a4, i) => {
  for (var r = i > 1 ? void 0 : i ? Tr3(e, a4) : e, o3 = n3.length - 1, u2; o3 >= 0; o3--)
    (u2 = n3[o3]) && (r = u2(r) || r);
  return r;
};
var me2 = (n3, e) => (a4, i) => e(a4, i, n3);
var at2 = class extends Ve {
  constructor(n3, e, a4, i, r, o3, u2, f4) {
    super(), this._univerInstanceService = n3, this._commandService = e, this._lexerTreeBuilder = a4, this._formulaDataModel = i, this._sheetInterceptorService = r, this._definedNamesService = o3, this._configService = u2, this._injector = f4, this._commandExecutedListener();
  }
  _commandExecutedListener() {
    this.disposeWithMe(this._sheetInterceptorService.interceptCommand({
      getMutations: (n3) => this._getUpdateFormula(n3)
    })), this.disposeWithMe(
      this._commandService.onCommandExecuted((n3) => {
        if (n3.params)
          if (n3.id === Lt2.id) {
            const { subUnitId: e, unitId: a4 } = n3.params;
            this._handleWorkbookDisposed(a4, e);
          } else n3.id === ln.id && this._handleInsertSheetMutation(n3.params);
      })
    ), this.disposeWithMe(
      this._commandService.beforeCommandExecuted((n3, e) => {
        if (n3.id === ee2.id) {
          const a4 = n3.params;
          if (e && e.onlyLocal === true || e && e.syncOnly === true || a4.trigger === Ce.id || a4.trigger === In2.id || a4.trigger === Hs2.id)
            return;
          this._handleSetRangeValuesMutation(a4);
        }
      })
    ), this.disposeWithMe(this._univerInstanceService.getTypeOfUnitAdded$(we.UNIVER_SHEET).subscribe((n3) => this._handleWorkbookAdded(n3))), this.disposeWithMe(this._univerInstanceService.getTypeOfUnitDisposed$(we.UNIVER_SHEET).pipe(map((n3) => n3.getUnitId())).subscribe((n3) => this._handleWorkbookDisposed(n3)));
  }
  _handleSetRangeValuesMutation(n3) {
    const { subUnitId: e, unitId: a4, cellValue: i } = n3;
    if (i == null)
      return;
    const r = this._formulaDataModel.updateFormulaData(a4, e, i);
    if (Object.keys(r).length === 0)
      return;
    const o3 = {
      [a4]: {
        [e]: r
      }
    };
    this._commandService.executeCommand(
      ee2.id,
      {
        unitId: a4,
        subUnitId: e,
        cellValue: Ji3(r)
      },
      {
        onlyLocal: true,
        fromFormula: true
      }
    ), this._formulaDataModel.updateArrayFormulaCellData(a4, e, i), this._formulaDataModel.updateArrayFormulaRange(a4, e, i), this._formulaDataModel.updateImageFormulaData(a4, e, i), this._commandService.executeCommand(
      Do2.id,
      {
        formulaData: o3
      },
      {
        onlyLocal: true
      }
    ), this._commandService.executeCommand(
      vs2.id,
      {
        arrayFormulaRange: this._formulaDataModel.getArrayFormulaRange(),
        arrayFormulaCellData: this._formulaDataModel.getArrayFormulaCellData()
      },
      {
        onlyLocal: true,
        remove: true
        // remove array formula range shape
      }
    );
  }
  _handleWorkbookDisposed(n3, e) {
    const a4 = this._formulaDataModel.getFormulaData(), i = Ot2(a4, n3, e), r = this._formulaDataModel.getArrayFormulaRange(), o3 = Ot2(r, n3, e), u2 = this._formulaDataModel.getArrayFormulaCellData(), f4 = Ot2(u2, n3, e);
    i && this._commandService.executeCommand(
      Do2.id,
      {
        formulaData: i
      },
      {
        onlyLocal: true
      }
    ), o3 && f4 && this._commandService.executeCommand(
      vs2.id,
      {
        arrayFormulaRange: r,
        arrayFormulaCellData: u2
      },
      {
        onlyLocal: true
      }
    );
  }
  _handleInsertSheetMutation(n3) {
    const { sheet: e, unitId: a4 } = n3, i = this._formulaDataModel.getFormulaData(), { id: r, cellData: o3 } = e, u2 = new ht(o3), f4 = Ni(i, a4, r, u2);
    this._commandService.executeCommand(
      Do2.id,
      {
        formulaData: f4
      },
      {
        onlyLocal: true
      }
    );
  }
  _handleWorkbookAdded(n3) {
    var m9;
    const e = {}, a4 = n3.getUnitId(), i = { [a4]: {} };
    n3.getSheets().forEach((c2) => {
      var L6;
      const l4 = c2.getCellMatrix(), p3 = c2.getSheetId(), T10 = Ni(e, a4, p3, l4);
      i[a4][p3] = (L6 = T10[a4]) == null ? void 0 : L6[p3];
    }), this._commandService.executeCommand(Do2.id, { formulaData: i }, { onlyLocal: true });
    const o3 = this._configService.getConfig(Ue3), u2 = (m9 = o3 == null ? void 0 : o3.initialFormulaComputing) != null ? m9 : Te2.WHEN_EMPTY, f4 = this._getDirtyDataByCalculationMode(u2);
    this._commandService.executeCommand(Oo.id, f4, { onlyLocal: true });
  }
  _getDirtyDataByCalculationMode(n3) {
    const e = n3 === Te2.FORCED, a4 = n3 === Te2.WHEN_EMPTY ? this._formulaDataModel.getFormulaDirtyRanges() : [];
    return {
      forceCalculation: e,
      dirtyRanges: a4,
      dirtyNameMap: {},
      dirtyDefinedNameMap: {},
      dirtyUnitFeatureMap: {},
      dirtyUnitOtherFormulaMap: {},
      clearDependencyTreeCache: {}
    };
  }
  _getUpdateFormula(n3) {
    const e = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET);
    if (!e)
      return {
        undos: [],
        redos: []
      };
    const a4 = za3(e, n3);
    if (a4) {
      const { unitSheetNameMap: i } = this._formulaDataModel.getCalculateData(), r = this._formulaDataModel.getFormulaData(), { newFormulaData: o3 } = this._getFormulaReferenceMoveInfo(
        r,
        i,
        a4
      ), { undos: u2, redos: f4 } = gi2(r, o3, a4);
      return {
        undos: u2,
        redos: f4
      };
    }
    return {
      undos: [],
      redos: []
    };
  }
  // eslint-disable-next-line max-lines-per-function
  _getFormulaReferenceMoveInfo(n3, e, a4) {
    if (!Z.isDefine(n3)) return { newFormulaData: {}, oldFormulaData: {} };
    const i = Object.keys(n3);
    if (i.length === 0) return { newFormulaData: {}, oldFormulaData: {} };
    const r = {}, o3 = {};
    for (const u2 of i) {
      const f4 = n3[u2];
      if (f4 == null)
        continue;
      const m9 = Object.keys(f4);
      Z.isDefine(r[u2]) || (r[u2] = {}), Z.isDefine(o3[u2]) || (o3[u2] = {});
      for (const c2 of m9) {
        const l4 = new ht(f4[c2] || {}), p3 = new ht(), T10 = [];
        l4.forValue((L6, I6, A4) => {
          var F7;
          if (!A4) return true;
          const { f: N6, x: d2, y: S, si: R9 } = A4, P8 = this._lexerTreeBuilder.sequenceNodesBuilder(N6);
          if (P8 == null)
            return true;
          let h9 = false;
          const M10 = [], { type: U3, from: q9 } = a4;
          for (let B5 = 0, ae5 = P8.length; B5 < ae5; B5++) {
            const O9 = P8[B5];
            if (typeof O9 == "string")
              continue;
            const { token: ce5, nodeType: ne4 } = O9;
            if ((U3 === y3.SetDefinedName || U3 === y3.RemoveDefinedName) && (ne4 === He.DEFINED_NAME || ne4 === He.FUNCTION)) {
              const { definedNameId: Be6, definedName: Ie } = a4;
              if (Be6 === void 0 || Ie === void 0)
                continue;
              const se4 = this._definedNamesService.getValueById(u2, Be6);
              if (se4 == null || se4.name !== ce5)
                continue;
              P8[B5] = __spreadProps(__spreadValues({}, O9), {
                token: U3 === y3.SetDefinedName ? Ie : h.REF
              }), h9 = true, M10.push(B5);
              continue;
            } else if (ne4 !== He.REFERENCE)
              continue;
            const le3 = br3(ce5), { range: Z9, sheetName: oe5, unitId: ue4 } = le3, Fe6 = ue4 == null || ue4.length === 0 ? u2 : ue4, J6 = ((F7 = e == null ? void 0 : e[Fe6]) == null ? void 0 : F7[oe5]) || "";
            if (!Qa2(
              a4.unitId,
              a4.sheetId,
              u2,
              c2,
              ue4,
              J6
            ))
              continue;
            const Nt5 = {
              range: Z9,
              sheetId: J6,
              unitId: ue4,
              sheetName: oe5,
              refOffsetX: d2 || 0,
              refOffsetY: S || 0
            };
            let Oe5 = null;
            if (U3 === y3.SetName) {
              const {
                unitId: Be6,
                sheetId: Ie,
                sheetName: se4
              } = a4;
              if (se4 == null || J6 == null || J6.length === 0 || Ie !== J6)
                continue;
              Oe5 = Ts2({
                range: Z9,
                sheetName: se4,
                unitId: ue4
              });
            } else if (U3 === y3.RemoveSheet) {
              const {
                unitId: Be6,
                sheetId: Ie,
                sheetName: se4
              } = a4;
              if (J6 == null || J6.length === 0 || Ie !== J6)
                continue;
              Oe5 = h.REF;
            } else U3 !== y3.SetDefinedName && (Oe5 = ja5(
              Nt5,
              a4,
              u2,
              c2
            ));
            Oe5 != null && (P8[B5] = __spreadProps(__spreadValues({}, O9), {
              token: Oe5
            }), h9 = true, M10.push(B5), R9 && (d2 != null ? d2 : 0) === 0 && (S != null ? S : 0) === 0 && T10.push(R9));
          }
          if (!h9)
            if (R9 && [y3.MoveRows, y3.MoveCols, y3.MoveRange].includes(U3)) {
              if (q9 && q9.startRow <= L6 && L6 <= q9.endRow && q9.startColumn <= I6 && I6 <= q9.endColumn)
                (d2 != null ? d2 : 0) === 0 && (S != null ? S : 0) === 0 && T10.push(R9);
              else if (!T10.includes(R9))
                return true;
            } else
              return true;
          const x7 = $a3(P8, M10, d2, S);
          p3.setValue(L6, I6, {
            f: `=${yi(x7)}`
          });
        }), o3[u2] && (o3[u2][c2] = p3.getData());
      }
    }
    return { newFormulaData: o3 };
  }
};
at2 = Er2([
  me2(0, br),
  me2(1, Ds),
  me2(2, Inject(Mn)),
  me2(3, Inject(yr)),
  me2(4, Inject(G)),
  me2(5, Lr),
  me2(6, xs),
  me2(7, Inject(Injector))
], at2);
var Ir3 = "SHEETS_FORMULA_PLUGIN";
var Nr2 = Object.getOwnPropertyDescriptor;
var Rr3 = (n3, e, a4, i) => {
  for (var r = i > 1 ? void 0 : i ? Nr2(e, a4) : e, o3 = n3.length - 1, u2; o3 >= 0; o3--)
    (u2 = n3[o3]) && (r = u2(r) || r);
  return r;
};
var _t3 = (n3, e) => (a4, i) => e(a4, i, n3);
var nt3 = class extends Ve {
  constructor(n3, e, a4) {
    super(), this._activeDirtyManagerService = n3, this._univerInstanceService = e, this._formulaDataModel = a4, this._initialize();
  }
  _initialize() {
    this._initialConversion();
  }
  _initialConversion() {
    this._activeDirtyManagerService.register(ee2.id, {
      commandId: ee2.id,
      getDirtyData: (n3) => {
        const e = n3.params;
        return e.trigger === Ce.id ? {} : {
          dirtyRanges: this._getSetRangeValuesMutationDirtyRange(e)
        };
      }
    }), this._initialMove(), this._initialRowAndColumn(), this._initialHideRow(), this._initialSheet(), this._initialDefinedName();
  }
  _initialMove() {
    this._activeDirtyManagerService.register(wt2.id, {
      commandId: wt2.id,
      getDirtyData: (n3) => {
        const e = n3.params;
        return {
          dirtyRanges: this._getMoveRangeMutationDirtyRange(e),
          clearDependencyTreeCache: {
            [e.unitId]: {
              [e.to.subUnitId]: "1",
              [e.from.subUnitId]: "1"
            }
          }
        };
      }
    }), this._activeDirtyManagerService.register(Je3.id, {
      commandId: Je3.id,
      getDirtyData: (n3) => {
        const e = n3.params;
        return {
          dirtyRanges: this._getMoveRowsMutationDirtyRange(e),
          clearDependencyTreeCache: {
            [e.unitId]: {
              [e.subUnitId]: "1"
            }
          }
        };
      }
    }), this._activeDirtyManagerService.register(qe2.id, {
      commandId: qe2.id,
      getDirtyData: (n3) => {
        const e = n3.params;
        return {
          dirtyRanges: this._getMoveRowsMutationDirtyRange(e),
          clearDependencyTreeCache: {
            [e.unitId]: {
              [e.subUnitId]: "1"
            }
          }
        };
      }
    }), this._activeDirtyManagerService.register(On2.id, {
      commandId: On2.id,
      getDirtyData: (n3) => {
        const e = n3.params;
        return {
          dirtyRanges: this._getReorderRangeMutationDirtyRange(e),
          clearDependencyTreeCache: {
            [e.unitId]: {
              [e.subUnitId]: "1"
            }
          }
        };
      }
    });
  }
  _initialRowAndColumn() {
    this._activeDirtyManagerService.register(Te.id, {
      commandId: Te.id,
      getDirtyData: (n3) => {
        const e = n3.params;
        return {
          dirtyRanges: this._getRemoveRowOrColumnMutation(e, true),
          clearDependencyTreeCache: {
            [e.unitId]: {
              [e.subUnitId]: "1"
            }
          }
        };
      }
    }), this._activeDirtyManagerService.register(Me.id, {
      commandId: Me.id,
      getDirtyData: (n3) => {
        const e = n3.params;
        return {
          dirtyRanges: this._getRemoveRowOrColumnMutation(e, false),
          clearDependencyTreeCache: {
            [e.unitId]: {
              [e.subUnitId]: "1"
            }
          }
        };
      }
    }), this._activeDirtyManagerService.register(Ue2.id, {
      commandId: Ue2.id,
      getDirtyData: (n3) => {
        const e = n3.params;
        return {
          clearDependencyTreeCache: {
            [e.unitId]: {
              [e.subUnitId]: "1"
            }
          }
        };
      }
    }), this._activeDirtyManagerService.register(ke2.id, {
      commandId: ke2.id,
      getDirtyData: (n3) => {
        const e = n3.params;
        return {
          clearDependencyTreeCache: {
            [e.unitId]: {
              [e.subUnitId]: "1"
            }
          }
        };
      }
    });
  }
  _initialHideRow() {
    this._activeDirtyManagerService.register(Tt.id, {
      commandId: Tt.id,
      getDirtyData: (n3) => {
        const e = n3.params;
        return {
          dirtyRanges: this._getHideRowMutation(e),
          clearDependencyTreeCache: {
            [e.unitId]: {
              [e.subUnitId]: "1"
            }
          }
        };
      }
    }), this._activeDirtyManagerService.register(Ut2.id, {
      commandId: Ut2.id,
      getDirtyData: (n3) => {
        const e = n3.params;
        return {
          dirtyRanges: this._getHideRowMutation(e),
          clearDependencyTreeCache: {
            [e.unitId]: {
              [e.subUnitId]: "1"
            }
          }
        };
      }
    });
  }
  _initialSheet() {
    this._activeDirtyManagerService.register(Lt2.id, {
      commandId: Lt2.id,
      getDirtyData: (n3) => {
        const e = n3.params;
        return {
          dirtyNameMap: this._getRemoveSheetMutation(e),
          clearDependencyTreeCache: {
            [e.unitId]: {
              [e.subUnitId]: "1"
            }
          }
        };
      }
    }), this._activeDirtyManagerService.register(ln.id, {
      commandId: ln.id,
      getDirtyData: (n3) => {
        const e = n3.params;
        return {
          dirtyNameMap: this._getInsertSheetMutation(e)
        };
      }
    });
  }
  _initialDefinedName() {
    this._activeDirtyManagerService.register(_a2.id, {
      commandId: _a2.id,
      getDirtyData: (n3) => {
        const e = n3.params;
        return { dirtyDefinedNameMap: this._getDefinedNameMutation(e) };
      }
    }), this._activeDirtyManagerService.register(Vo2.id, {
      commandId: Vo2.id,
      getDirtyData: (n3) => {
        const e = n3.params;
        return { dirtyDefinedNameMap: this._getDefinedNameMutation(e) };
      }
    });
  }
  _getDefinedNameMutation(n3) {
    const { unitId: e, name: a4, formulaOrRefString: i } = n3, r = {};
    return n3 == null ? {} : (r[e] = {}, r[e][a4] = i, r);
  }
  _getSetRangeValuesMutationDirtyRange(n3) {
    const { subUnitId: e, unitId: a4, cellValue: i } = n3, r = [];
    return i == null || (r.push(...this._getDirtyRangesByCellValue(a4, e, i)), r.push(...this._getDirtyRangesForArrayFormula(a4, e, i))), r;
  }
  _getMoveRangeMutationDirtyRange(n3) {
    const { unitId: e, from: a4, to: i } = n3, r = [];
    return r.push(...this._getDirtyRangesByCellValue(e, a4.subUnitId, a4.value)), r.push(...this._getDirtyRangesByCellValue(e, i.subUnitId, i.value)), r.push(...this._getDirtyRangesForArrayFormula(e, i.subUnitId, i.value)), r;
  }
  _getMoveRowsMutationDirtyRange(n3) {
    const { subUnitId: e, unitId: a4, sourceRange: i, targetRange: r } = n3, o3 = [], u2 = this._rangeToMatrix(i).getData(), f4 = this._rangeToMatrix(r).getData();
    return o3.push(...this._getDirtyRangesByCellValue(a4, e, u2)), o3.push(...this._getDirtyRangesByCellValue(a4, e, f4)), o3.push(...this._getDirtyRangesForArrayFormula(a4, e, f4)), o3;
  }
  _getReorderRangeMutationDirtyRange(n3) {
    const { unitId: e, subUnitId: a4, range: i } = n3, r = this._rangeToMatrix(i).getData(), o3 = [];
    return o3.push(...this._getDirtyRangesByCellValue(e, a4, r)), o3.push(...this._getDirtyRangesForArrayFormula(e, a4, r)), o3;
  }
  _getRemoveRowOrColumnMutation(n3, e = true) {
    const { subUnitId: a4, unitId: i, range: r } = n3, o3 = [], u2 = this._univerInstanceService.getUniverSheetInstance(i), f4 = u2 == null ? void 0 : u2.getSheetBySheetId(a4), m9 = (f4 == null ? void 0 : f4.getRowCount()) || 0, c2 = (f4 == null ? void 0 : f4.getColumnCount()) || 0;
    let l4 = null;
    const { startRow: p3, endRow: T10, startColumn: L6, endColumn: I6 } = r;
    e === true ? l4 = this._rangeToMatrix({
      startRow: p3,
      startColumn: 0,
      endRow: T10,
      endColumn: c2 - 1
    }) : l4 = this._rangeToMatrix({
      startRow: 0,
      startColumn: L6,
      endRow: m9,
      endColumn: I6
    });
    const A4 = l4.getData();
    return o3.push(...this._getDirtyRangesByCellValue(i, a4, A4)), o3.push(...this._getDirtyRangesForArrayFormula(i, a4, A4)), o3;
  }
  _getHideRowMutation(n3) {
    const { subUnitId: e, unitId: a4, ranges: i } = n3, r = [];
    return i.forEach((o3) => {
      const u2 = this._rangeToMatrix(o3).getMatrix();
      r.push(...this._getDirtyRangesByCellValue(a4, e, u2));
    }), r;
  }
  _getRemoveSheetMutation(n3) {
    const e = {}, { subUnitId: a4, unitId: i, subUnitName: r } = n3;
    return e[i] == null && (e[i] = {}), e[i][a4] = r, e;
  }
  _getInsertSheetMutation(n3) {
    const e = {}, { sheet: a4, unitId: i } = n3;
    return e[i] == null && (e[i] = {}), e[i][a4.id] = a4.name, e;
  }
  _rangeToMatrix(n3) {
    const e = new ht(), { startRow: a4, startColumn: i, endRow: r, endColumn: o3 } = n3;
    for (let u2 = a4; u2 <= r; u2++)
      for (let f4 = i; f4 <= o3; f4++)
        e.setValue(u2, f4, {});
    return e;
  }
  _getDirtyRangesByCellValue(n3, e, a4) {
    const i = [];
    return a4 == null || new ht(a4).getDiscreteRanges().forEach((u2) => {
      i.push({ unitId: n3, sheetId: e, range: u2 });
    }), i;
  }
  /**
   * The array formula is a range where only the top-left corner contains the formula value.
   * All other positions, apart from the top-left corner, need to be marked as dirty.
   */
  _getDirtyRangesForArrayFormula(n3, e, a4) {
    var u2, f4;
    const i = [];
    if (a4 == null)
      return i;
    const r = new ht(a4), o3 = this._formulaDataModel.getArrayFormulaRange();
    if ((u2 = o3 == null ? void 0 : o3[n3]) != null && u2[e]) {
      const m9 = new ht((f4 = o3 == null ? void 0 : o3[n3]) == null ? void 0 : f4[e]);
      r.forValue((c2, l4) => {
        m9.forValue((p3, T10, L6) => {
          if (L6 == null)
            return true;
          const { startRow: I6, startColumn: A4, endRow: N6, endColumn: d2 } = L6;
          c2 >= I6 && c2 <= N6 && l4 >= A4 && l4 <= d2 && i.push({
            unitId: n3,
            sheetId: e,
            range: {
              startRow: I6,
              startColumn: A4,
              endRow: I6,
              endColumn: A4
            }
          });
        });
      });
    }
    return i;
  }
};
nt3 = Rr3([
  _t3(0, Mb),
  _t3(1, br),
  _t3(2, Inject(yr))
], nt3);
var Sr3 = Object.getOwnPropertyDescriptor;
var Ar2 = (n3, e, a4, i) => {
  for (var r = i > 1 ? void 0 : i ? Sr3(e, a4) : e, o3 = n3.length - 1, u2; o3 >= 0; o3--)
    (u2 = n3[o3]) && (r = u2(r) || r);
  return r;
};
var Le3 = (n3, e) => (a4, i) => e(a4, i, n3);
var it = class extends Ve {
  constructor(n3, e, a4, i, r, o3, u2) {
    super(), this._commandService = n3, this._configService = e, this._sheetInterceptorService = a4, this._formulaDataModel = i, this._lexerTreeBuilder = r, this._functionService = o3, this._definedNamesService = u2, this._initialize();
  }
  _initialize() {
    this._commandExecutedListener(), this._initInterceptorCellContent();
  }
  _commandExecutedListener() {
    this.disposeWithMe(
      this._commandService.onCommandExecuted((n3) => {
        var a4;
        const e = (a4 = this._configService.getConfig(Ue3)) == null ? void 0 : a4.writeArrayFormulaToSnapshot;
        if (n3.id === vs2.id) {
          const i = n3.params;
          if (i == null)
            return;
          const { arrayFormulaRange: r, arrayFormulaCellData: o3, arrayFormulaEmbedded: u2 } = i;
          this._formulaDataModel.setArrayFormulaRange(r), this._formulaDataModel.setArrayFormulaCellData(o3), e && this._writeArrayFormulaToSnapshot(r, o3, u2);
        } else n3.id === Mo2.id && e && (this._addPrefixToFunctionSnapshot(), this._addPrefixToDefinedNamesFunctionSnapshot());
      })
    );
  }
  _addPrefixToDefinedNamesFunctionSnapshot() {
    const n3 = this._definedNamesService.getAllDefinedNames();
    Object.entries(n3).forEach(([e, a4]) => {
      a4 && Array.from(Object.entries(a4)).forEach(([i, r]) => {
        const { formulaOrRefString: o3 } = r;
        if (o3.substring(0, 1) === "=") {
          const u2 = this._lexerTreeBuilder.getNewFormulaWithPrefix(o3, this._functionService.hasExecutor.bind(this._functionService));
          u2 && this._commandService.executeCommand(_a2.id, __spreadProps(__spreadValues({}, r), {
            unitId: e,
            formulaOrRefStringWithPrefix: u2
          }), {
            onlyLocal: true,
            fromFormula: true
          });
        }
      });
    });
  }
  _addPrefixToFunctionSnapshot() {
    const n3 = this._formulaDataModel.getFormulaData(), e = /* @__PURE__ */ new Map();
    Object.entries(n3).forEach(([a4, i]) => {
      i && Array.from(Object.entries(i)).forEach(([r, o3]) => {
        if (!o3)
          return;
        const u2 = new ht();
        new ht(o3).forValue((m9, c2, l4) => {
          const p3 = l4 == null ? void 0 : l4.f;
          if ((l4 == null ? void 0 : l4.x) != null || !p3 || p3.length === 0)
            return;
          if (e.has(p3)) {
            const L6 = e.get(p3);
            u2.setValue(m9, c2, { xf: L6 });
            return;
          }
          const T10 = this._lexerTreeBuilder.getNewFormulaWithPrefix(p3, this._functionService.hasExecutor.bind(this._functionService));
          T10 && (u2.setValue(m9, c2, { xf: T10 }), e.set(p3, T10));
        }), this._commandService.executeCommand(ee2.id, {
          unitId: a4,
          subUnitId: r,
          cellValue: u2.getMatrix()
        }, {
          onlyLocal: true,
          fromFormula: true
        });
      });
    }), e.clear();
  }
  _writeArrayFormulaToSnapshot(n3, e, a4) {
    n3 && Object.entries(n3).forEach(([i, r]) => {
      r && Array.from(Object.entries(r)).forEach(([o3, u2]) => {
        const f4 = new ht();
        new ht(u2).forValue((c2, l4, p3) => {
          f4.setValue(c2, l4, { ref: Yt(p3) });
        }), this._commandService.executeCommand(ee2.id, {
          unitId: i,
          subUnitId: o3,
          cellValue: f4.getMatrix()
        }, {
          onlyLocal: true,
          fromFormula: true
        });
      });
    }), a4 && Object.entries(a4).forEach(([i, r]) => {
      r && Array.from(Object.entries(r)).forEach(([o3, u2]) => {
        const f4 = new ht();
        new ht(u2).forValue((c2, l4) => {
          var T10, L6, I6;
          (I6 = (L6 = (T10 = n3 == null ? void 0 : n3[i]) == null ? void 0 : T10[o3]) == null ? void 0 : L6[c2]) != null && I6[l4] || f4.setValue(c2, l4, {
            ref: Yt({
              startRow: c2,
              endRow: c2,
              startColumn: l4,
              endColumn: l4
            })
          });
        }), this._commandService.executeCommand(ee2.id, {
          unitId: i,
          subUnitId: o3,
          cellValue: f4.getMatrix()
        }, {
          onlyLocal: true,
          fromFormula: true
        });
      });
    }), e && Object.entries(e).forEach(([i, r]) => {
      r && Array.from(Object.entries(r)).forEach(([o3, u2]) => {
        this._commandService.executeCommand(ee2.id, {
          unitId: i,
          subUnitId: o3,
          cellValue: u2
        }, {
          onlyLocal: true,
          fromFormula: true
        });
      });
    });
  }
  _initInterceptorCellContent() {
    this.disposeWithMe(
      this._sheetInterceptorService.intercept(ht2.CELL_CONTENT, {
        priority: 100,
        effect: ir.Value,
        handler: (n3, e, a4) => {
          var l4, p3, T10;
          let i = n3;
          const { unitId: r, subUnitId: o3, row: u2, col: f4 } = e, m9 = this._formulaDataModel.getArrayFormulaCellData(), c2 = (T10 = (p3 = (l4 = m9 == null ? void 0 : m9[r]) == null ? void 0 : l4[o3]) == null ? void 0 : p3[u2]) == null ? void 0 : T10[f4];
          return c2 == null ? a4(i) : ((!i || i === e.rawData) && (i = __spreadValues({}, e.rawData)), c2.v == null && c2.t == null ? (i.v = 0, i.t = mn.NUMBER, a4(i)) : (i == null ? void 0 : i.t) === mn.NUMBER && i.v !== void 0 && i.v !== null && s1(i.v) ? (i.v = Sa2(Number(i.v)), a4(i)) : (i.v = c2.v, i.t = c2.t, a4(i)));
        }
      })
    );
  }
};
it = Ar2([
  Le3(0, Ds),
  Le3(1, xs),
  Le3(2, Inject(G)),
  Le3(3, Inject(yr)),
  Le3(4, Inject(Mn)),
  Le3(5, Xt),
  Le3(6, Lr)
], it);
var Cr2 = [
  {
    functionName: ca2.ARRAY_CONSTRAIN,
    functionType: Kc2.Array,
    description: "formula.functionList.ARRAY_CONSTRAIN.description",
    abstract: "formula.functionList.ARRAY_CONSTRAIN.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ARRAY_CONSTRAIN.functionParameter.inputRange.name",
        detail: "formula.functionList.ARRAY_CONSTRAIN.functionParameter.inputRange.detail",
        example: "A1:C3",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ARRAY_CONSTRAIN.functionParameter.numRows.name",
        detail: "formula.functionList.ARRAY_CONSTRAIN.functionParameter.numRows.detail",
        example: "2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ARRAY_CONSTRAIN.functionParameter.numCols.name",
        detail: "formula.functionList.ARRAY_CONSTRAIN.functionParameter.numCols.detail",
        example: "2",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: ca2.FLATTEN,
    functionType: Kc2.Array,
    description: "formula.functionList.FLATTEN.description",
    abstract: "formula.functionList.FLATTEN.abstract",
    functionParameter: [
      {
        name: "formula.functionList.FLATTEN.functionParameter.range1.name",
        detail: "formula.functionList.FLATTEN.functionParameter.range1.detail",
        example: "A1:C3",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.FLATTEN.functionParameter.range2.name",
        detail: "formula.functionList.FLATTEN.functionParameter.range2.detail",
        example: "D1:F3",
        require: 0,
        repeat: 1
      }
    ]
  }
];
var Dr3 = [
  {
    functionName: fe2.BETADIST,
    functionType: Kc2.Compatibility,
    description: "formula.functionList.BETADIST.description",
    abstract: "formula.functionList.BETADIST.abstract",
    functionParameter: [
      {
        name: "formula.functionList.BETADIST.functionParameter.x.name",
        detail: "formula.functionList.BETADIST.functionParameter.x.detail",
        example: "2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.BETADIST.functionParameter.alpha.name",
        detail: "formula.functionList.BETADIST.functionParameter.alpha.detail",
        example: "8",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.BETADIST.functionParameter.beta.name",
        detail: "formula.functionList.BETADIST.functionParameter.beta.detail",
        example: "10",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.BETADIST.functionParameter.A.name",
        detail: "formula.functionList.BETADIST.functionParameter.A.detail",
        example: "1",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.BETADIST.functionParameter.B.name",
        detail: "formula.functionList.BETADIST.functionParameter.B.detail",
        example: "3",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: fe2.BETAINV,
    functionType: Kc2.Compatibility,
    description: "formula.functionList.BETAINV.description",
    abstract: "formula.functionList.BETAINV.abstract",
    functionParameter: [
      {
        name: "formula.functionList.BETAINV.functionParameter.probability.name",
        detail: "formula.functionList.BETAINV.functionParameter.probability.detail",
        example: "0.685470581",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.BETAINV.functionParameter.alpha.name",
        detail: "formula.functionList.BETAINV.functionParameter.alpha.detail",
        example: "8",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.BETAINV.functionParameter.beta.name",
        detail: "formula.functionList.BETAINV.functionParameter.beta.detail",
        example: "10",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.BETAINV.functionParameter.A.name",
        detail: "formula.functionList.BETAINV.functionParameter.A.detail",
        example: "1",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.BETAINV.functionParameter.B.name",
        detail: "formula.functionList.BETAINV.functionParameter.B.detail",
        example: "3",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: fe2.BINOMDIST,
    functionType: Kc2.Compatibility,
    description: "formula.functionList.BINOMDIST.description",
    abstract: "formula.functionList.BINOMDIST.abstract",
    functionParameter: [
      {
        name: "formula.functionList.BINOMDIST.functionParameter.numberS.name",
        detail: "formula.functionList.BINOMDIST.functionParameter.numberS.detail",
        example: "6",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.BINOMDIST.functionParameter.trials.name",
        detail: "formula.functionList.BINOMDIST.functionParameter.trials.detail",
        example: "10",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.BINOMDIST.functionParameter.probabilityS.name",
        detail: "formula.functionList.BINOMDIST.functionParameter.probabilityS.detail",
        example: "0.5",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.BINOMDIST.functionParameter.cumulative.name",
        detail: "formula.functionList.BINOMDIST.functionParameter.cumulative.detail",
        example: "false",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: fe2.CHIDIST,
    functionType: Kc2.Compatibility,
    description: "formula.functionList.CHIDIST.description",
    abstract: "formula.functionList.CHIDIST.abstract",
    functionParameter: [
      {
        name: "formula.functionList.CHIDIST.functionParameter.x.name",
        detail: "formula.functionList.CHIDIST.functionParameter.x.detail",
        example: "0.5",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CHIDIST.functionParameter.degFreedom.name",
        detail: "formula.functionList.CHIDIST.functionParameter.degFreedom.detail",
        example: "1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: fe2.CHIINV,
    functionType: Kc2.Compatibility,
    description: "formula.functionList.CHIINV.description",
    abstract: "formula.functionList.CHIINV.abstract",
    functionParameter: [
      {
        name: "formula.functionList.CHIINV.functionParameter.probability.name",
        detail: "formula.functionList.CHIINV.functionParameter.probability.detail",
        example: "0.93",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CHIINV.functionParameter.degFreedom.name",
        detail: "formula.functionList.CHIINV.functionParameter.degFreedom.detail",
        example: "1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: fe2.CHITEST,
    functionType: Kc2.Compatibility,
    description: "formula.functionList.CHITEST.description",
    abstract: "formula.functionList.CHITEST.abstract",
    functionParameter: [
      {
        name: "formula.functionList.CHITEST.functionParameter.actualRange.name",
        detail: "formula.functionList.CHITEST.functionParameter.actualRange.detail",
        example: "A1:A4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CHITEST.functionParameter.expectedRange.name",
        detail: "formula.functionList.CHITEST.functionParameter.expectedRange.detail",
        example: "B1:B4",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: fe2.CONFIDENCE,
    functionType: Kc2.Compatibility,
    description: "formula.functionList.CONFIDENCE.description",
    abstract: "formula.functionList.CONFIDENCE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.CONFIDENCE.functionParameter.alpha.name",
        detail: "formula.functionList.CONFIDENCE.functionParameter.alpha.detail",
        example: "0.05",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CONFIDENCE.functionParameter.standardDev.name",
        detail: "formula.functionList.CONFIDENCE.functionParameter.standardDev.detail",
        example: "2.5",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CONFIDENCE.functionParameter.size.name",
        detail: "formula.functionList.CONFIDENCE.functionParameter.size.detail",
        example: "50",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: fe2.COVAR,
    functionType: Kc2.Compatibility,
    description: "formula.functionList.COVAR.description",
    abstract: "formula.functionList.COVAR.abstract",
    functionParameter: [
      {
        name: "formula.functionList.COVAR.functionParameter.array1.name",
        detail: "formula.functionList.COVAR.functionParameter.array1.detail",
        example: "A1:A4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.COVAR.functionParameter.array2.name",
        detail: "formula.functionList.COVAR.functionParameter.array2.detail",
        example: "B1:B4",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: fe2.CRITBINOM,
    functionType: Kc2.Compatibility,
    description: "formula.functionList.CRITBINOM.description",
    abstract: "formula.functionList.CRITBINOM.abstract",
    functionParameter: [
      {
        name: "formula.functionList.CRITBINOM.functionParameter.trials.name",
        detail: "formula.functionList.CRITBINOM.functionParameter.trials.detail",
        example: "6",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CRITBINOM.functionParameter.probabilityS.name",
        detail: "formula.functionList.CRITBINOM.functionParameter.probabilityS.detail",
        example: "0.5",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CRITBINOM.functionParameter.alpha.name",
        detail: "formula.functionList.CRITBINOM.functionParameter.alpha.detail",
        example: "0.75",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: fe2.EXPONDIST,
    functionType: Kc2.Compatibility,
    description: "formula.functionList.EXPONDIST.description",
    abstract: "formula.functionList.EXPONDIST.abstract",
    functionParameter: [
      {
        name: "formula.functionList.EXPONDIST.functionParameter.x.name",
        detail: "formula.functionList.EXPONDIST.functionParameter.x.detail",
        example: "0.2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.EXPONDIST.functionParameter.lambda.name",
        detail: "formula.functionList.EXPONDIST.functionParameter.lambda.detail",
        example: "10",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.EXPONDIST.functionParameter.cumulative.name",
        detail: "formula.functionList.EXPONDIST.functionParameter.cumulative.detail",
        example: "true",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: fe2.FDIST,
    functionType: Kc2.Compatibility,
    description: "formula.functionList.FDIST.description",
    abstract: "formula.functionList.FDIST.abstract",
    functionParameter: [
      {
        name: "formula.functionList.FDIST.functionParameter.x.name",
        detail: "formula.functionList.FDIST.functionParameter.x.detail",
        example: "15.2069",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.FDIST.functionParameter.degFreedom1.name",
        detail: "formula.functionList.FDIST.functionParameter.degFreedom1.detail",
        example: "6",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.FDIST.functionParameter.degFreedom2.name",
        detail: "formula.functionList.FDIST.functionParameter.degFreedom2.detail",
        example: "4",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: fe2.FINV,
    functionType: Kc2.Compatibility,
    description: "formula.functionList.FINV.description",
    abstract: "formula.functionList.FINV.abstract",
    functionParameter: [
      {
        name: "formula.functionList.FINV.functionParameter.probability.name",
        detail: "formula.functionList.FINV.functionParameter.probability.detail",
        example: "0.01",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.FINV.functionParameter.degFreedom1.name",
        detail: "formula.functionList.FINV.functionParameter.degFreedom1.detail",
        example: "6",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.FINV.functionParameter.degFreedom2.name",
        detail: "formula.functionList.FINV.functionParameter.degFreedom2.detail",
        example: "4",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: fe2.FTEST,
    functionType: Kc2.Compatibility,
    description: "formula.functionList.FTEST.description",
    abstract: "formula.functionList.FTEST.abstract",
    functionParameter: [
      {
        name: "formula.functionList.FTEST.functionParameter.array1.name",
        detail: "formula.functionList.FTEST.functionParameter.array1.detail",
        example: "A1:A4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.FTEST.functionParameter.array2.name",
        detail: "formula.functionList.FTEST.functionParameter.array2.detail",
        example: "B1:B4",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: fe2.GAMMADIST,
    functionType: Kc2.Compatibility,
    description: "formula.functionList.GAMMADIST.description",
    abstract: "formula.functionList.GAMMADIST.abstract",
    functionParameter: [
      {
        name: "formula.functionList.GAMMADIST.functionParameter.x.name",
        detail: "formula.functionList.GAMMADIST.functionParameter.x.detail",
        example: "10",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.GAMMADIST.functionParameter.alpha.name",
        detail: "formula.functionList.GAMMADIST.functionParameter.alpha.detail",
        example: "8",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.GAMMADIST.functionParameter.beta.name",
        detail: "formula.functionList.GAMMADIST.functionParameter.beta.detail",
        example: "2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.GAMMADIST.functionParameter.cumulative.name",
        detail: "formula.functionList.GAMMADIST.functionParameter.cumulative.detail",
        example: "true",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: fe2.GAMMAINV,
    functionType: Kc2.Compatibility,
    description: "formula.functionList.GAMMAINV.description",
    abstract: "formula.functionList.GAMMAINV.abstract",
    functionParameter: [
      {
        name: "formula.functionList.GAMMAINV.functionParameter.probability.name",
        detail: "formula.functionList.GAMMAINV.functionParameter.probability.detail",
        example: "0.068094",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.GAMMAINV.functionParameter.alpha.name",
        detail: "formula.functionList.GAMMAINV.functionParameter.alpha.detail",
        example: "9",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.GAMMAINV.functionParameter.beta.name",
        detail: "formula.functionList.GAMMAINV.functionParameter.beta.detail",
        example: "2",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: fe2.HYPGEOMDIST,
    functionType: Kc2.Compatibility,
    description: "formula.functionList.HYPGEOMDIST.description",
    abstract: "formula.functionList.HYPGEOMDIST.abstract",
    functionParameter: [
      {
        name: "formula.functionList.HYPGEOMDIST.functionParameter.sampleS.name",
        detail: "formula.functionList.HYPGEOMDIST.functionParameter.sampleS.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.HYPGEOMDIST.functionParameter.numberSample.name",
        detail: "formula.functionList.HYPGEOMDIST.functionParameter.numberSample.detail",
        example: "4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.HYPGEOMDIST.functionParameter.populationS.name",
        detail: "formula.functionList.HYPGEOMDIST.functionParameter.populationS.detail",
        example: "8",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.HYPGEOMDIST.functionParameter.numberPop.name",
        detail: "formula.functionList.HYPGEOMDIST.functionParameter.numberPop.detail",
        example: "20",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: fe2.LOGINV,
    functionType: Kc2.Compatibility,
    description: "formula.functionList.LOGINV.description",
    abstract: "formula.functionList.LOGINV.abstract",
    functionParameter: [
      {
        name: "formula.functionList.LOGINV.functionParameter.probability.name",
        detail: "formula.functionList.LOGINV.functionParameter.probability.detail",
        example: "0.908789",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.LOGINV.functionParameter.mean.name",
        detail: "formula.functionList.LOGINV.functionParameter.mean.detail",
        example: "40",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.LOGINV.functionParameter.standardDev.name",
        detail: "formula.functionList.LOGINV.functionParameter.standardDev.detail",
        example: "1.5",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: fe2.LOGNORMDIST,
    functionType: Kc2.Compatibility,
    description: "formula.functionList.LOGNORMDIST.description",
    abstract: "formula.functionList.LOGNORMDIST.abstract",
    functionParameter: [
      {
        name: "formula.functionList.LOGNORMDIST.functionParameter.x.name",
        detail: "formula.functionList.LOGNORMDIST.functionParameter.x.detail",
        example: "42",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.LOGNORMDIST.functionParameter.mean.name",
        detail: "formula.functionList.LOGNORMDIST.functionParameter.mean.detail",
        example: "40",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.LOGNORMDIST.functionParameter.standardDev.name",
        detail: "formula.functionList.LOGNORMDIST.functionParameter.standardDev.detail",
        example: "1.5",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: fe2.MODE,
    functionType: Kc2.Compatibility,
    description: "formula.functionList.MODE.description",
    abstract: "formula.functionList.MODE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.MODE.functionParameter.number1.name",
        detail: "formula.functionList.MODE.functionParameter.number1.detail",
        example: "A1:A4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.MODE.functionParameter.number2.name",
        detail: "formula.functionList.MODE.functionParameter.number2.detail",
        example: "2",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: fe2.NEGBINOMDIST,
    functionType: Kc2.Compatibility,
    description: "formula.functionList.NEGBINOMDIST.description",
    abstract: "formula.functionList.NEGBINOMDIST.abstract",
    functionParameter: [
      {
        name: "formula.functionList.NEGBINOMDIST.functionParameter.numberF.name",
        detail: "formula.functionList.NEGBINOMDIST.functionParameter.numberF.detail",
        example: "10",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.NEGBINOMDIST.functionParameter.numberS.name",
        detail: "formula.functionList.NEGBINOMDIST.functionParameter.numberS.detail",
        example: "5",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.NEGBINOMDIST.functionParameter.probabilityS.name",
        detail: "formula.functionList.NEGBINOMDIST.functionParameter.probabilityS.detail",
        example: "0.25",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: fe2.NORMDIST,
    functionType: Kc2.Compatibility,
    description: "formula.functionList.NORMDIST.description",
    abstract: "formula.functionList.NORMDIST.abstract",
    functionParameter: [
      {
        name: "formula.functionList.NORMDIST.functionParameter.x.name",
        detail: "formula.functionList.NORMDIST.functionParameter.x.detail",
        example: "42",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.NORMDIST.functionParameter.mean.name",
        detail: "formula.functionList.NORMDIST.functionParameter.mean.detail",
        example: "40",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.NORMDIST.functionParameter.standardDev.name",
        detail: "formula.functionList.NORMDIST.functionParameter.standardDev.detail",
        example: "1.5",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.NORMDIST.functionParameter.cumulative.name",
        detail: "formula.functionList.NORMDIST.functionParameter.cumulative.detail",
        example: "true",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: fe2.NORMINV,
    functionType: Kc2.Compatibility,
    description: "formula.functionList.NORMINV.description",
    abstract: "formula.functionList.NORMINV.abstract",
    functionParameter: [
      {
        name: "formula.functionList.NORMINV.functionParameter.probability.name",
        detail: "formula.functionList.NORMINV.functionParameter.probability.detail",
        example: "0.908789",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.NORMINV.functionParameter.mean.name",
        detail: "formula.functionList.NORMINV.functionParameter.mean.detail",
        example: "40",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.NORMINV.functionParameter.standardDev.name",
        detail: "formula.functionList.NORMINV.functionParameter.standardDev.detail",
        example: "1.5",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: fe2.NORMSDIST,
    functionType: Kc2.Compatibility,
    description: "formula.functionList.NORMSDIST.description",
    abstract: "formula.functionList.NORMSDIST.abstract",
    functionParameter: [
      {
        name: "formula.functionList.NORMSDIST.functionParameter.z.name",
        detail: "formula.functionList.NORMSDIST.functionParameter.z.detail",
        example: "1.333333",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: fe2.NORMSINV,
    functionType: Kc2.Compatibility,
    description: "formula.functionList.NORMSINV.description",
    abstract: "formula.functionList.NORMSINV.abstract",
    functionParameter: [
      {
        name: "formula.functionList.NORMSINV.functionParameter.probability.name",
        detail: "formula.functionList.NORMSINV.functionParameter.probability.detail",
        example: "0.908789",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: fe2.PERCENTILE,
    functionType: Kc2.Compatibility,
    description: "formula.functionList.PERCENTILE.description",
    abstract: "formula.functionList.PERCENTILE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.PERCENTILE.functionParameter.array.name",
        detail: "formula.functionList.PERCENTILE.functionParameter.array.detail",
        example: "A1:A4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PERCENTILE.functionParameter.k.name",
        detail: "formula.functionList.PERCENTILE.functionParameter.k.detail",
        example: "0.3",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: fe2.PERCENTRANK,
    functionType: Kc2.Compatibility,
    description: "formula.functionList.PERCENTRANK.description",
    abstract: "formula.functionList.PERCENTRANK.abstract",
    functionParameter: [
      {
        name: "formula.functionList.PERCENTRANK.functionParameter.array.name",
        detail: "formula.functionList.PERCENTRANK.functionParameter.array.detail",
        example: "A1:A4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PERCENTRANK.functionParameter.x.name",
        detail: "formula.functionList.PERCENTRANK.functionParameter.x.detail",
        example: "1.5",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PERCENTRANK.functionParameter.significance.name",
        detail: "formula.functionList.PERCENTRANK.functionParameter.significance.detail",
        example: "3",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: fe2.POISSON,
    functionType: Kc2.Compatibility,
    description: "formula.functionList.POISSON.description",
    abstract: "formula.functionList.POISSON.abstract",
    functionParameter: [
      {
        name: "formula.functionList.POISSON.functionParameter.x.name",
        detail: "formula.functionList.POISSON.functionParameter.x.detail",
        example: "2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.POISSON.functionParameter.mean.name",
        detail: "formula.functionList.POISSON.functionParameter.mean.detail",
        example: "5",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.POISSON.functionParameter.cumulative.name",
        detail: "formula.functionList.POISSON.functionParameter.cumulative.detail",
        example: "true",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: fe2.QUARTILE,
    functionType: Kc2.Compatibility,
    description: "formula.functionList.QUARTILE.description",
    abstract: "formula.functionList.QUARTILE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.QUARTILE.functionParameter.array.name",
        detail: "formula.functionList.QUARTILE.functionParameter.array.detail",
        example: "A1:A4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.QUARTILE.functionParameter.quart.name",
        detail: "formula.functionList.QUARTILE.functionParameter.quart.detail",
        example: "1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: fe2.RANK,
    functionType: Kc2.Compatibility,
    description: "formula.functionList.RANK.description",
    abstract: "formula.functionList.RANK.abstract",
    functionParameter: [
      {
        name: "formula.functionList.RANK.functionParameter.number.name",
        detail: "formula.functionList.RANK.functionParameter.number.detail",
        example: "A3",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.RANK.functionParameter.ref.name",
        detail: "formula.functionList.RANK.functionParameter.ref.detail",
        example: "A2:A6",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.RANK.functionParameter.order.name",
        detail: "formula.functionList.RANK.functionParameter.order.detail",
        example: "1",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: fe2.STDEV,
    functionType: Kc2.Compatibility,
    description: "formula.functionList.STDEV.description",
    abstract: "formula.functionList.STDEV.abstract",
    functionParameter: [
      {
        name: "formula.functionList.STDEV.functionParameter.number1.name",
        detail: "formula.functionList.STDEV.functionParameter.number1.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.STDEV.functionParameter.number2.name",
        detail: "formula.functionList.STDEV.functionParameter.number2.detail",
        example: "2",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: fe2.STDEVP,
    functionType: Kc2.Compatibility,
    description: "formula.functionList.STDEVP.description",
    abstract: "formula.functionList.STDEVP.abstract",
    functionParameter: [
      {
        name: "formula.functionList.STDEVP.functionParameter.number1.name",
        detail: "formula.functionList.STDEVP.functionParameter.number1.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.STDEVP.functionParameter.number2.name",
        detail: "formula.functionList.STDEVP.functionParameter.number2.detail",
        example: "2",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: fe2.TDIST,
    functionType: Kc2.Compatibility,
    description: "formula.functionList.TDIST.description",
    abstract: "formula.functionList.TDIST.abstract",
    functionParameter: [
      {
        name: "formula.functionList.TDIST.functionParameter.x.name",
        detail: "formula.functionList.TDIST.functionParameter.x.detail",
        example: "8",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.TDIST.functionParameter.degFreedom.name",
        detail: "formula.functionList.TDIST.functionParameter.degFreedom.detail",
        example: "3",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.TDIST.functionParameter.tails.name",
        detail: "formula.functionList.TDIST.functionParameter.tails.detail",
        example: "1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: fe2.TINV,
    functionType: Kc2.Compatibility,
    description: "formula.functionList.TINV.description",
    abstract: "formula.functionList.TINV.abstract",
    functionParameter: [
      {
        name: "formula.functionList.TINV.functionParameter.probability.name",
        detail: "formula.functionList.TINV.functionParameter.probability.detail",
        example: "0.75",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.TINV.functionParameter.degFreedom.name",
        detail: "formula.functionList.TINV.functionParameter.degFreedom.detail",
        example: "2",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: fe2.TTEST,
    functionType: Kc2.Compatibility,
    description: "formula.functionList.TTEST.description",
    abstract: "formula.functionList.TTEST.abstract",
    functionParameter: [
      {
        name: "formula.functionList.TTEST.functionParameter.array1.name",
        detail: "formula.functionList.TTEST.functionParameter.array1.detail",
        example: "A1:A4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.TTEST.functionParameter.array2.name",
        detail: "formula.functionList.TTEST.functionParameter.array2.detail",
        example: "B1:B4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.TTEST.functionParameter.tails.name",
        detail: "formula.functionList.TTEST.functionParameter.tails.detail",
        example: "2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.TTEST.functionParameter.type.name",
        detail: "formula.functionList.TTEST.functionParameter.type.detail",
        example: "1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: fe2.VAR,
    functionType: Kc2.Compatibility,
    description: "formula.functionList.VAR.description",
    abstract: "formula.functionList.VAR.abstract",
    functionParameter: [
      {
        name: "formula.functionList.VAR.functionParameter.number1.name",
        detail: "formula.functionList.VAR.functionParameter.number1.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.VAR.functionParameter.number2.name",
        detail: "formula.functionList.VAR.functionParameter.number2.detail",
        example: "2",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: fe2.VARP,
    functionType: Kc2.Compatibility,
    description: "formula.functionList.VARP.description",
    abstract: "formula.functionList.VARP.abstract",
    functionParameter: [
      {
        name: "formula.functionList.VARP.functionParameter.number1.name",
        detail: "formula.functionList.VARP.functionParameter.number1.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.VARP.functionParameter.number2.name",
        detail: "formula.functionList.VARP.functionParameter.number2.detail",
        example: "2",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: fe2.WEIBULL,
    functionType: Kc2.Compatibility,
    description: "formula.functionList.WEIBULL.description",
    abstract: "formula.functionList.WEIBULL.abstract",
    functionParameter: [
      {
        name: "formula.functionList.WEIBULL.functionParameter.x.name",
        detail: "formula.functionList.WEIBULL.functionParameter.x.detail",
        example: "105",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.WEIBULL.functionParameter.alpha.name",
        detail: "formula.functionList.WEIBULL.functionParameter.alpha.detail",
        example: "20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.WEIBULL.functionParameter.beta.name",
        detail: "formula.functionList.WEIBULL.functionParameter.beta.detail",
        example: "100",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.WEIBULL.functionParameter.cumulative.name",
        detail: "formula.functionList.WEIBULL.functionParameter.cumulative.detail",
        example: "true",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: fe2.ZTEST,
    functionType: Kc2.Compatibility,
    description: "formula.functionList.ZTEST.description",
    abstract: "formula.functionList.ZTEST.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ZTEST.functionParameter.array.name",
        detail: "formula.functionList.ZTEST.functionParameter.array.detail",
        example: "A2:A11",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ZTEST.functionParameter.x.name",
        detail: "formula.functionList.ZTEST.functionParameter.x.detail",
        example: "4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ZTEST.functionParameter.sigma.name",
        detail: "formula.functionList.ZTEST.functionParameter.sigma.detail",
        example: "10",
        require: 0,
        repeat: 0
      }
    ]
  }
];
var br5 = [
  {
    functionName: Cg.CUBEKPIMEMBER,
    functionType: Kc2.Cube,
    description: "formula.functionList.CUBEKPIMEMBER.description",
    abstract: "formula.functionList.CUBEKPIMEMBER.abstract",
    functionParameter: [
      {
        name: "formula.functionList.CUBEKPIMEMBER.functionParameter.number1.name",
        detail: "formula.functionList.CUBEKPIMEMBER.functionParameter.number1.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CUBEKPIMEMBER.functionParameter.number2.name",
        detail: "formula.functionList.CUBEKPIMEMBER.functionParameter.number2.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Cg.CUBEMEMBER,
    functionType: Kc2.Cube,
    description: "formula.functionList.CUBEMEMBER.description",
    abstract: "formula.functionList.CUBEMEMBER.abstract",
    functionParameter: [
      {
        name: "formula.functionList.CUBEMEMBER.functionParameter.number1.name",
        detail: "formula.functionList.CUBEMEMBER.functionParameter.number1.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CUBEMEMBER.functionParameter.number2.name",
        detail: "formula.functionList.CUBEMEMBER.functionParameter.number2.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Cg.CUBEMEMBERPROPERTY,
    functionType: Kc2.Cube,
    description: "formula.functionList.CUBEMEMBERPROPERTY.description",
    abstract: "formula.functionList.CUBEMEMBERPROPERTY.abstract",
    functionParameter: [
      {
        name: "formula.functionList.CUBEMEMBERPROPERTY.functionParameter.number1.name",
        detail: "formula.functionList.CUBEMEMBERPROPERTY.functionParameter.number1.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CUBEMEMBERPROPERTY.functionParameter.number2.name",
        detail: "formula.functionList.CUBEMEMBERPROPERTY.functionParameter.number2.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Cg.CUBERANKEDMEMBER,
    functionType: Kc2.Cube,
    description: "formula.functionList.CUBERANKEDMEMBER.description",
    abstract: "formula.functionList.CUBERANKEDMEMBER.abstract",
    functionParameter: [
      {
        name: "formula.functionList.CUBERANKEDMEMBER.functionParameter.number1.name",
        detail: "formula.functionList.CUBERANKEDMEMBER.functionParameter.number1.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CUBERANKEDMEMBER.functionParameter.number2.name",
        detail: "formula.functionList.CUBERANKEDMEMBER.functionParameter.number2.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Cg.CUBESET,
    functionType: Kc2.Cube,
    description: "formula.functionList.CUBESET.description",
    abstract: "formula.functionList.CUBESET.abstract",
    functionParameter: [
      {
        name: "formula.functionList.CUBESET.functionParameter.number1.name",
        detail: "formula.functionList.CUBESET.functionParameter.number1.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CUBESET.functionParameter.number2.name",
        detail: "formula.functionList.CUBESET.functionParameter.number2.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Cg.CUBESETCOUNT,
    functionType: Kc2.Cube,
    description: "formula.functionList.CUBESETCOUNT.description",
    abstract: "formula.functionList.CUBESETCOUNT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.CUBESETCOUNT.functionParameter.number1.name",
        detail: "formula.functionList.CUBESETCOUNT.functionParameter.number1.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CUBESETCOUNT.functionParameter.number2.name",
        detail: "formula.functionList.CUBESETCOUNT.functionParameter.number2.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Cg.CUBEVALUE,
    functionType: Kc2.Cube,
    description: "formula.functionList.CUBEVALUE.description",
    abstract: "formula.functionList.CUBEVALUE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.CUBEVALUE.functionParameter.number1.name",
        detail: "formula.functionList.CUBEVALUE.functionParameter.number1.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CUBEVALUE.functionParameter.number2.name",
        detail: "formula.functionList.CUBEVALUE.functionParameter.number2.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      }
    ]
  }
];
var Or2 = [
  {
    functionName: Xe5.DAVERAGE,
    functionType: Kc2.Database,
    description: "formula.functionList.DAVERAGE.description",
    abstract: "formula.functionList.DAVERAGE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.DAVERAGE.functionParameter.database.name",
        detail: "formula.functionList.DAVERAGE.functionParameter.database.detail",
        example: "A4:E10",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DAVERAGE.functionParameter.field.name",
        detail: "formula.functionList.DAVERAGE.functionParameter.field.detail",
        example: "D4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DAVERAGE.functionParameter.criteria.name",
        detail: "formula.functionList.DAVERAGE.functionParameter.criteria.detail",
        example: "A1:B2",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Xe5.DCOUNT,
    functionType: Kc2.Database,
    description: "formula.functionList.DCOUNT.description",
    abstract: "formula.functionList.DCOUNT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.DCOUNT.functionParameter.database.name",
        detail: "formula.functionList.DCOUNT.functionParameter.database.detail",
        example: "A4:E10",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DCOUNT.functionParameter.field.name",
        detail: "formula.functionList.DCOUNT.functionParameter.field.detail",
        example: "D4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DCOUNT.functionParameter.criteria.name",
        detail: "formula.functionList.DCOUNT.functionParameter.criteria.detail",
        example: "A1:B2",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Xe5.DCOUNTA,
    functionType: Kc2.Database,
    description: "formula.functionList.DCOUNTA.description",
    abstract: "formula.functionList.DCOUNTA.abstract",
    functionParameter: [
      {
        name: "formula.functionList.DCOUNTA.functionParameter.database.name",
        detail: "formula.functionList.DCOUNTA.functionParameter.database.detail",
        example: "A4:E10",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DCOUNTA.functionParameter.field.name",
        detail: "formula.functionList.DCOUNTA.functionParameter.field.detail",
        example: "D4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DCOUNTA.functionParameter.criteria.name",
        detail: "formula.functionList.DCOUNTA.functionParameter.criteria.detail",
        example: "A1:B2",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Xe5.DGET,
    functionType: Kc2.Database,
    description: "formula.functionList.DGET.description",
    abstract: "formula.functionList.DGET.abstract",
    functionParameter: [
      {
        name: "formula.functionList.DGET.functionParameter.database.name",
        detail: "formula.functionList.DGET.functionParameter.database.detail",
        example: "A4:E10",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DGET.functionParameter.field.name",
        detail: "formula.functionList.DGET.functionParameter.field.detail",
        example: "D4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DGET.functionParameter.criteria.name",
        detail: "formula.functionList.DGET.functionParameter.criteria.detail",
        example: "A1:B2",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Xe5.DMAX,
    functionType: Kc2.Database,
    description: "formula.functionList.DMAX.description",
    abstract: "formula.functionList.DMAX.abstract",
    functionParameter: [
      {
        name: "formula.functionList.DMAX.functionParameter.database.name",
        detail: "formula.functionList.DMAX.functionParameter.database.detail",
        example: "A4:E10",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DMAX.functionParameter.field.name",
        detail: "formula.functionList.DMAX.functionParameter.field.detail",
        example: "D4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DMAX.functionParameter.criteria.name",
        detail: "formula.functionList.DMAX.functionParameter.criteria.detail",
        example: "A1:B2",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Xe5.DMIN,
    functionType: Kc2.Database,
    description: "formula.functionList.DMIN.description",
    abstract: "formula.functionList.DMIN.abstract",
    functionParameter: [
      {
        name: "formula.functionList.DMIN.functionParameter.database.name",
        detail: "formula.functionList.DMIN.functionParameter.database.detail",
        example: "A4:E10",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DMIN.functionParameter.field.name",
        detail: "formula.functionList.DMIN.functionParameter.field.detail",
        example: "D4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DMIN.functionParameter.criteria.name",
        detail: "formula.functionList.DMIN.functionParameter.criteria.detail",
        example: "A1:B2",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Xe5.DPRODUCT,
    functionType: Kc2.Database,
    description: "formula.functionList.DPRODUCT.description",
    abstract: "formula.functionList.DPRODUCT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.DPRODUCT.functionParameter.database.name",
        detail: "formula.functionList.DPRODUCT.functionParameter.database.detail",
        example: "A4:E10",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DPRODUCT.functionParameter.field.name",
        detail: "formula.functionList.DPRODUCT.functionParameter.field.detail",
        example: "D4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DPRODUCT.functionParameter.criteria.name",
        detail: "formula.functionList.DPRODUCT.functionParameter.criteria.detail",
        example: "A1:B2",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Xe5.DSTDEV,
    functionType: Kc2.Database,
    description: "formula.functionList.DSTDEV.description",
    abstract: "formula.functionList.DSTDEV.abstract",
    functionParameter: [
      {
        name: "formula.functionList.DSTDEV.functionParameter.database.name",
        detail: "formula.functionList.DSTDEV.functionParameter.database.detail",
        example: "A4:E10",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DSTDEV.functionParameter.field.name",
        detail: "formula.functionList.DSTDEV.functionParameter.field.detail",
        example: "D4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DSTDEV.functionParameter.criteria.name",
        detail: "formula.functionList.DSTDEV.functionParameter.criteria.detail",
        example: "A1:B2",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Xe5.DSTDEVP,
    functionType: Kc2.Database,
    description: "formula.functionList.DSTDEVP.description",
    abstract: "formula.functionList.DSTDEVP.abstract",
    functionParameter: [
      {
        name: "formula.functionList.DSTDEVP.functionParameter.database.name",
        detail: "formula.functionList.DSTDEVP.functionParameter.database.detail",
        example: "A4:E10",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DSTDEVP.functionParameter.field.name",
        detail: "formula.functionList.DSTDEVP.functionParameter.field.detail",
        example: "D4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DSTDEVP.functionParameter.criteria.name",
        detail: "formula.functionList.DSTDEVP.functionParameter.criteria.detail",
        example: "A1:B2",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Xe5.DSUM,
    functionType: Kc2.Database,
    description: "formula.functionList.DSUM.description",
    abstract: "formula.functionList.DSUM.abstract",
    functionParameter: [
      {
        name: "formula.functionList.DSUM.functionParameter.database.name",
        detail: "formula.functionList.DSUM.functionParameter.database.detail",
        example: "A4:E10",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DSUM.functionParameter.field.name",
        detail: "formula.functionList.DSUM.functionParameter.field.detail",
        example: "D4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DSUM.functionParameter.criteria.name",
        detail: "formula.functionList.DSUM.functionParameter.criteria.detail",
        example: "A1:B2",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Xe5.DVAR,
    functionType: Kc2.Database,
    description: "formula.functionList.DVAR.description",
    abstract: "formula.functionList.DVAR.abstract",
    functionParameter: [
      {
        name: "formula.functionList.DVAR.functionParameter.database.name",
        detail: "formula.functionList.DVAR.functionParameter.database.detail",
        example: "A4:E10",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DVAR.functionParameter.field.name",
        detail: "formula.functionList.DVAR.functionParameter.field.detail",
        example: "D4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DVAR.functionParameter.criteria.name",
        detail: "formula.functionList.DVAR.functionParameter.criteria.detail",
        example: "A1:B2",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Xe5.DVARP,
    functionType: Kc2.Database,
    description: "formula.functionList.DVARP.description",
    abstract: "formula.functionList.DVARP.abstract",
    functionParameter: [
      {
        name: "formula.functionList.DVARP.functionParameter.database.name",
        detail: "formula.functionList.DVARP.functionParameter.database.detail",
        example: "A4:E10",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DVARP.functionParameter.field.name",
        detail: "formula.functionList.DVARP.functionParameter.field.detail",
        example: "D4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DVARP.functionParameter.criteria.name",
        detail: "formula.functionList.DVARP.functionParameter.criteria.detail",
        example: "A1:B2",
        require: 1,
        repeat: 0
      }
    ]
  }
];
var Mr2 = [
  {
    functionName: Ae3.DATE,
    functionType: Kc2.Date,
    description: "formula.functionList.DATE.description",
    abstract: "formula.functionList.DATE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.DATE.functionParameter.year.name",
        detail: "formula.functionList.DATE.functionParameter.year.detail",
        example: "2024",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DATE.functionParameter.month.name",
        detail: "formula.functionList.DATE.functionParameter.month.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DATE.functionParameter.day.name",
        detail: "formula.functionList.DATE.functionParameter.day.detail",
        example: "1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ae3.DATEDIF,
    functionType: Kc2.Date,
    description: "formula.functionList.DATEDIF.description",
    abstract: "formula.functionList.DATEDIF.abstract",
    functionParameter: [
      {
        name: "formula.functionList.DATEDIF.functionParameter.startDate.name",
        detail: "formula.functionList.DATEDIF.functionParameter.startDate.detail",
        example: '"2001-6-1"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DATEDIF.functionParameter.endDate.name",
        detail: "formula.functionList.DATEDIF.functionParameter.endDate.detail",
        example: '"2002-8-15"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DATEDIF.functionParameter.method.name",
        detail: "formula.functionList.DATEDIF.functionParameter.method.detail",
        example: '"D"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ae3.DATEVALUE,
    functionType: Kc2.Date,
    description: "formula.functionList.DATEVALUE.description",
    abstract: "formula.functionList.DATEVALUE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.DATEVALUE.functionParameter.dateText.name",
        detail: "formula.functionList.DATEVALUE.functionParameter.dateText.detail",
        example: '"2024-8-8"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ae3.DAY,
    functionType: Kc2.Date,
    description: "formula.functionList.DAY.description",
    abstract: "formula.functionList.DAY.abstract",
    functionParameter: [
      {
        name: "formula.functionList.DAY.functionParameter.serialNumber.name",
        detail: "formula.functionList.DAY.functionParameter.serialNumber.detail",
        example: '"1969-7-20"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ae3.DAYS,
    functionType: Kc2.Date,
    description: "formula.functionList.DAYS.description",
    abstract: "formula.functionList.DAYS.abstract",
    functionParameter: [
      {
        name: "formula.functionList.DAYS.functionParameter.endDate.name",
        detail: "formula.functionList.DAYS.functionParameter.endDate.detail",
        example: '"2021-12-31"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DAYS.functionParameter.startDate.name",
        detail: "formula.functionList.DAYS.functionParameter.startDate.detail",
        example: '"2021-1-1"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ae3.DAYS360,
    functionType: Kc2.Date,
    description: "formula.functionList.DAYS360.description",
    abstract: "formula.functionList.DAYS360.abstract",
    functionParameter: [
      {
        name: "formula.functionList.DAYS360.functionParameter.startDate.name",
        detail: "formula.functionList.DAYS360.functionParameter.startDate.detail",
        example: '"2021-1-29"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DAYS360.functionParameter.endDate.name",
        detail: "formula.functionList.DAYS360.functionParameter.endDate.detail",
        example: '"2021-3-31"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DAYS360.functionParameter.method.name",
        detail: "formula.functionList.DAYS360.functionParameter.method.detail",
        example: "1",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ae3.EDATE,
    functionType: Kc2.Date,
    description: "formula.functionList.EDATE.description",
    abstract: "formula.functionList.EDATE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.EDATE.functionParameter.startDate.name",
        detail: "formula.functionList.EDATE.functionParameter.startDate.detail",
        example: "A1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.EDATE.functionParameter.months.name",
        detail: "formula.functionList.EDATE.functionParameter.months.detail",
        example: "1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ae3.EOMONTH,
    functionType: Kc2.Date,
    description: "formula.functionList.EOMONTH.description",
    abstract: "formula.functionList.EOMONTH.abstract",
    functionParameter: [
      {
        name: "formula.functionList.EOMONTH.functionParameter.startDate.name",
        detail: "formula.functionList.EOMONTH.functionParameter.startDate.detail",
        example: '"2011-1-1"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.EOMONTH.functionParameter.months.name",
        detail: "formula.functionList.EOMONTH.functionParameter.months.detail",
        example: "1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ae3.EPOCHTODATE,
    functionType: Kc2.Date,
    description: "formula.functionList.EPOCHTODATE.description",
    abstract: "formula.functionList.EPOCHTODATE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.EPOCHTODATE.functionParameter.timestamp.name",
        detail: "formula.functionList.EPOCHTODATE.functionParameter.timestamp.detail",
        example: "1655906710",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.EPOCHTODATE.functionParameter.unit.name",
        detail: "formula.functionList.EPOCHTODATE.functionParameter.unit.detail",
        example: "1",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ae3.HOUR,
    functionType: Kc2.Date,
    description: "formula.functionList.HOUR.description",
    abstract: "formula.functionList.HOUR.abstract",
    functionParameter: [
      {
        name: "formula.functionList.HOUR.functionParameter.serialNumber.name",
        detail: "formula.functionList.HOUR.functionParameter.serialNumber.detail",
        example: '"2011-7-18 7:45"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ae3.ISOWEEKNUM,
    functionType: Kc2.Date,
    description: "formula.functionList.ISOWEEKNUM.description",
    abstract: "formula.functionList.ISOWEEKNUM.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ISOWEEKNUM.functionParameter.date.name",
        detail: "formula.functionList.ISOWEEKNUM.functionParameter.date.detail",
        example: '"2012-3-9"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ae3.MINUTE,
    functionType: Kc2.Date,
    description: "formula.functionList.MINUTE.description",
    abstract: "formula.functionList.MINUTE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.MINUTE.functionParameter.serialNumber.name",
        detail: "formula.functionList.MINUTE.functionParameter.serialNumber.detail",
        example: '"12:45"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ae3.MONTH,
    functionType: Kc2.Date,
    description: "formula.functionList.MONTH.description",
    abstract: "formula.functionList.MONTH.abstract",
    functionParameter: [
      {
        name: "formula.functionList.MONTH.functionParameter.serialNumber.name",
        detail: "formula.functionList.MONTH.functionParameter.serialNumber.detail",
        example: '"1969-7-20"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ae3.NETWORKDAYS,
    functionType: Kc2.Date,
    description: "formula.functionList.NETWORKDAYS.description",
    abstract: "formula.functionList.NETWORKDAYS.abstract",
    functionParameter: [
      {
        name: "formula.functionList.NETWORKDAYS.functionParameter.startDate.name",
        detail: "formula.functionList.NETWORKDAYS.functionParameter.startDate.detail",
        example: '"2012-10-1"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.NETWORKDAYS.functionParameter.endDate.name",
        detail: "formula.functionList.NETWORKDAYS.functionParameter.endDate.detail",
        example: '"2013-3-1"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.NETWORKDAYS.functionParameter.holidays.name",
        detail: "formula.functionList.NETWORKDAYS.functionParameter.holidays.detail",
        example: '"2012-11-22"',
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ae3.NETWORKDAYS_INTL,
    functionType: Kc2.Date,
    description: "formula.functionList.NETWORKDAYS_INTL.description",
    abstract: "formula.functionList.NETWORKDAYS_INTL.abstract",
    functionParameter: [
      {
        name: "formula.functionList.NETWORKDAYS_INTL.functionParameter.startDate.name",
        detail: "formula.functionList.NETWORKDAYS_INTL.functionParameter.startDate.detail",
        example: '"2012-10-1"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.NETWORKDAYS_INTL.functionParameter.endDate.name",
        detail: "formula.functionList.NETWORKDAYS_INTL.functionParameter.endDate.detail",
        example: '"2013-3-1"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.NETWORKDAYS_INTL.functionParameter.weekend.name",
        detail: "formula.functionList.NETWORKDAYS_INTL.functionParameter.weekend.detail",
        example: "6",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.NETWORKDAYS_INTL.functionParameter.holidays.name",
        detail: "formula.functionList.NETWORKDAYS_INTL.functionParameter.holidays.detail",
        example: '"2012-11-22"',
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ae3.NOW,
    functionType: Kc2.Date,
    description: "formula.functionList.NOW.description",
    abstract: "formula.functionList.NOW.abstract",
    functionParameter: []
  },
  {
    functionName: Ae3.SECOND,
    functionType: Kc2.Date,
    description: "formula.functionList.SECOND.description",
    abstract: "formula.functionList.SECOND.abstract",
    functionParameter: [
      {
        name: "formula.functionList.SECOND.functionParameter.serialNumber.name",
        detail: "formula.functionList.SECOND.functionParameter.serialNumber.detail",
        example: '"4:48:18"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ae3.TIME,
    functionType: Kc2.Date,
    description: "formula.functionList.TIME.description",
    abstract: "formula.functionList.TIME.abstract",
    functionParameter: [
      {
        name: "formula.functionList.TIME.functionParameter.hour.name",
        detail: "formula.functionList.TIME.functionParameter.hour.detail",
        example: "15",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.TIME.functionParameter.minute.name",
        detail: "formula.functionList.TIME.functionParameter.minute.detail",
        example: "20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.TIME.functionParameter.second.name",
        detail: "formula.functionList.TIME.functionParameter.second.detail",
        example: "59",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ae3.TIMEVALUE,
    functionType: Kc2.Date,
    description: "formula.functionList.TIMEVALUE.description",
    abstract: "formula.functionList.TIMEVALUE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.TIMEVALUE.functionParameter.timeText.name",
        detail: "formula.functionList.TIMEVALUE.functionParameter.timeText.detail",
        example: '"15:20:59"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ae3.TO_DATE,
    functionType: Kc2.Date,
    description: "formula.functionList.TO_DATE.description",
    abstract: "formula.functionList.TO_DATE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.TO_DATE.functionParameter.value.name",
        detail: "formula.functionList.TO_DATE.functionParameter.value.detail",
        example: "40826.4375",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ae3.TODAY,
    functionType: Kc2.Date,
    description: "formula.functionList.TODAY.description",
    abstract: "formula.functionList.TODAY.abstract",
    functionParameter: []
  },
  {
    functionName: Ae3.WEEKDAY,
    functionType: Kc2.Date,
    description: "formula.functionList.WEEKDAY.description",
    abstract: "formula.functionList.WEEKDAY.abstract",
    functionParameter: [
      {
        name: "formula.functionList.WEEKDAY.functionParameter.serialNumber.name",
        detail: "formula.functionList.WEEKDAY.functionParameter.serialNumber.detail",
        example: '"2008-2-14"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.WEEKDAY.functionParameter.returnType.name",
        detail: "formula.functionList.WEEKDAY.functionParameter.returnType.detail",
        example: "2",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ae3.WEEKNUM,
    functionType: Kc2.Date,
    description: "formula.functionList.WEEKNUM.description",
    abstract: "formula.functionList.WEEKNUM.abstract",
    functionParameter: [
      {
        name: "formula.functionList.WEEKNUM.functionParameter.serialNumber.name",
        detail: "formula.functionList.WEEKNUM.functionParameter.serialNumber.detail",
        example: '"2012-3-9"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.WEEKNUM.functionParameter.returnType.name",
        detail: "formula.functionList.WEEKNUM.functionParameter.returnType.detail",
        example: "2",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ae3.WORKDAY,
    functionType: Kc2.Date,
    description: "formula.functionList.WORKDAY.description",
    abstract: "formula.functionList.WORKDAY.abstract",
    functionParameter: [
      {
        name: "formula.functionList.WORKDAY.functionParameter.startDate.name",
        detail: "formula.functionList.WORKDAY.functionParameter.startDate.detail",
        example: '"2008-10-1"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.WORKDAY.functionParameter.days.name",
        detail: "formula.functionList.WORKDAY.functionParameter.days.detail",
        example: "151",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.WORKDAY.functionParameter.holidays.name",
        detail: "formula.functionList.WORKDAY.functionParameter.holidays.detail",
        example: '"2008-11-26"',
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ae3.WORKDAY_INTL,
    functionType: Kc2.Date,
    description: "formula.functionList.WORKDAY_INTL.description",
    abstract: "formula.functionList.WORKDAY_INTL.abstract",
    functionParameter: [
      {
        name: "formula.functionList.WORKDAY_INTL.functionParameter.startDate.name",
        detail: "formula.functionList.WORKDAY_INTL.functionParameter.startDate.detail",
        example: '"2008-10-1"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.WORKDAY_INTL.functionParameter.days.name",
        detail: "formula.functionList.WORKDAY_INTL.functionParameter.days.detail",
        example: "151",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.WORKDAY_INTL.functionParameter.weekend.name",
        detail: "formula.functionList.WORKDAY_INTL.functionParameter.weekend.detail",
        example: "6",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.WORKDAY_INTL.functionParameter.holidays.name",
        detail: "formula.functionList.WORKDAY_INTL.functionParameter.holidays.detail",
        example: '"2008-11-26"',
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ae3.YEAR,
    functionType: Kc2.Date,
    description: "formula.functionList.YEAR.description",
    abstract: "formula.functionList.YEAR.abstract",
    functionParameter: [
      {
        name: "formula.functionList.YEAR.functionParameter.serialNumber.name",
        detail: "formula.functionList.YEAR.functionParameter.serialNumber.detail",
        example: '"1969-7-20"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ae3.YEARFRAC,
    functionType: Kc2.Date,
    description: "formula.functionList.YEARFRAC.description",
    abstract: "formula.functionList.YEARFRAC.abstract",
    functionParameter: [
      {
        name: "formula.functionList.YEARFRAC.functionParameter.startDate.name",
        detail: "formula.functionList.YEARFRAC.functionParameter.startDate.detail",
        example: '"2012-1-1"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.YEARFRAC.functionParameter.endDate.name",
        detail: "formula.functionList.YEARFRAC.functionParameter.endDate.detail",
        example: '"2012-7-30"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.YEARFRAC.functionParameter.basis.name",
        detail: "formula.functionList.YEARFRAC.functionParameter.basis.detail",
        example: "1",
        require: 0,
        repeat: 0
      }
    ]
  }
];
var xr2 = [
  {
    functionName: Q3.BESSELI,
    functionType: Kc2.Engineering,
    description: "formula.functionList.BESSELI.description",
    abstract: "formula.functionList.BESSELI.abstract",
    functionParameter: [
      {
        name: "formula.functionList.BESSELI.functionParameter.x.name",
        detail: "formula.functionList.BESSELI.functionParameter.x.detail",
        example: "1.5",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.BESSELI.functionParameter.n.name",
        detail: "formula.functionList.BESSELI.functionParameter.n.detail",
        example: "1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.BESSELJ,
    functionType: Kc2.Engineering,
    description: "formula.functionList.BESSELJ.description",
    abstract: "formula.functionList.BESSELJ.abstract",
    functionParameter: [
      {
        name: "formula.functionList.BESSELJ.functionParameter.x.name",
        detail: "formula.functionList.BESSELJ.functionParameter.x.detail",
        example: "1.5",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.BESSELJ.functionParameter.n.name",
        detail: "formula.functionList.BESSELJ.functionParameter.n.detail",
        example: "1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.BESSELK,
    functionType: Kc2.Engineering,
    description: "formula.functionList.BESSELK.description",
    abstract: "formula.functionList.BESSELK.abstract",
    functionParameter: [
      {
        name: "formula.functionList.BESSELK.functionParameter.x.name",
        detail: "formula.functionList.BESSELK.functionParameter.x.detail",
        example: "1.5",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.BESSELK.functionParameter.n.name",
        detail: "formula.functionList.BESSELK.functionParameter.n.detail",
        example: "1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.BESSELY,
    functionType: Kc2.Engineering,
    description: "formula.functionList.BESSELY.description",
    abstract: "formula.functionList.BESSELY.abstract",
    functionParameter: [
      {
        name: "formula.functionList.BESSELY.functionParameter.x.name",
        detail: "formula.functionList.BESSELY.functionParameter.x.detail",
        example: "1.5",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.BESSELY.functionParameter.n.name",
        detail: "formula.functionList.BESSELY.functionParameter.n.detail",
        example: "1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.BIN2DEC,
    functionType: Kc2.Engineering,
    description: "formula.functionList.BIN2DEC.description",
    abstract: "formula.functionList.BIN2DEC.abstract",
    functionParameter: [
      {
        name: "formula.functionList.BIN2DEC.functionParameter.number.name",
        detail: "formula.functionList.BIN2DEC.functionParameter.number.detail",
        example: "1100100",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.BIN2HEX,
    functionType: Kc2.Engineering,
    description: "formula.functionList.BIN2HEX.description",
    abstract: "formula.functionList.BIN2HEX.abstract",
    functionParameter: [
      {
        name: "formula.functionList.BIN2HEX.functionParameter.number.name",
        detail: "formula.functionList.BIN2HEX.functionParameter.number.detail",
        example: "11111011",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.BIN2HEX.functionParameter.places.name",
        detail: "formula.functionList.BIN2HEX.functionParameter.places.detail",
        example: "4",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.BIN2OCT,
    functionType: Kc2.Engineering,
    description: "formula.functionList.BIN2OCT.description",
    abstract: "formula.functionList.BIN2OCT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.BIN2OCT.functionParameter.number.name",
        detail: "formula.functionList.BIN2OCT.functionParameter.number.detail",
        example: "1001",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.BIN2OCT.functionParameter.places.name",
        detail: "formula.functionList.BIN2OCT.functionParameter.places.detail",
        example: "3",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.BITAND,
    functionType: Kc2.Engineering,
    description: "formula.functionList.BITAND.description",
    abstract: "formula.functionList.BITAND.abstract",
    functionParameter: [
      {
        name: "formula.functionList.BITAND.functionParameter.number1.name",
        detail: "formula.functionList.BITAND.functionParameter.number1.detail",
        example: "13",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.BITAND.functionParameter.number2.name",
        detail: "formula.functionList.BITAND.functionParameter.number2.detail",
        example: "25",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.BITLSHIFT,
    functionType: Kc2.Engineering,
    description: "formula.functionList.BITLSHIFT.description",
    abstract: "formula.functionList.BITLSHIFT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.BITLSHIFT.functionParameter.number.name",
        detail: "formula.functionList.BITLSHIFT.functionParameter.number.detail",
        example: "4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.BITLSHIFT.functionParameter.shiftAmount.name",
        detail: "formula.functionList.BITLSHIFT.functionParameter.shiftAmount.detail",
        example: "2",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.BITOR,
    functionType: Kc2.Engineering,
    description: "formula.functionList.BITOR.description",
    abstract: "formula.functionList.BITOR.abstract",
    functionParameter: [
      {
        name: "formula.functionList.BITOR.functionParameter.number1.name",
        detail: "formula.functionList.BITOR.functionParameter.number1.detail",
        example: "23",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.BITOR.functionParameter.number2.name",
        detail: "formula.functionList.BITOR.functionParameter.number2.detail",
        example: "10",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.BITRSHIFT,
    functionType: Kc2.Engineering,
    description: "formula.functionList.BITRSHIFT.description",
    abstract: "formula.functionList.BITRSHIFT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.BITRSHIFT.functionParameter.number.name",
        detail: "formula.functionList.BITRSHIFT.functionParameter.number.detail",
        example: "13",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.BITRSHIFT.functionParameter.shiftAmount.name",
        detail: "formula.functionList.BITRSHIFT.functionParameter.shiftAmount.detail",
        example: "2",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.BITXOR,
    functionType: Kc2.Engineering,
    description: "formula.functionList.BITXOR.description",
    abstract: "formula.functionList.BITXOR.abstract",
    functionParameter: [
      {
        name: "formula.functionList.BITXOR.functionParameter.number1.name",
        detail: "formula.functionList.BITXOR.functionParameter.number1.detail",
        example: "5",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.BITXOR.functionParameter.number2.name",
        detail: "formula.functionList.BITXOR.functionParameter.number2.detail",
        example: "3",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.COMPLEX,
    functionType: Kc2.Engineering,
    description: "formula.functionList.COMPLEX.description",
    abstract: "formula.functionList.COMPLEX.abstract",
    functionParameter: [
      {
        name: "formula.functionList.COMPLEX.functionParameter.realNum.name",
        detail: "formula.functionList.COMPLEX.functionParameter.realNum.detail",
        example: "3",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.COMPLEX.functionParameter.iNum.name",
        detail: "formula.functionList.COMPLEX.functionParameter.iNum.detail",
        example: "4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.COMPLEX.functionParameter.suffix.name",
        detail: "formula.functionList.COMPLEX.functionParameter.suffix.detail",
        example: '"i"',
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.CONVERT,
    functionType: Kc2.Engineering,
    description: "formula.functionList.CONVERT.description",
    abstract: "formula.functionList.CONVERT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.CONVERT.functionParameter.number.name",
        detail: "formula.functionList.CONVERT.functionParameter.number.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CONVERT.functionParameter.fromUnit.name",
        detail: "formula.functionList.CONVERT.functionParameter.fromUnit.detail",
        example: '"lbm"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CONVERT.functionParameter.toUnit.name",
        detail: "formula.functionList.CONVERT.functionParameter.toUnit.detail",
        example: '"kg"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.DEC2BIN,
    functionType: Kc2.Engineering,
    description: "formula.functionList.DEC2BIN.description",
    abstract: "formula.functionList.DEC2BIN.abstract",
    functionParameter: [
      {
        name: "formula.functionList.DEC2BIN.functionParameter.number.name",
        detail: "formula.functionList.DEC2BIN.functionParameter.number.detail",
        example: "9",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DEC2BIN.functionParameter.places.name",
        detail: "formula.functionList.DEC2BIN.functionParameter.places.detail",
        example: "4",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.DEC2HEX,
    functionType: Kc2.Engineering,
    description: "formula.functionList.DEC2HEX.description",
    abstract: "formula.functionList.DEC2HEX.abstract",
    functionParameter: [
      {
        name: "formula.functionList.DEC2HEX.functionParameter.number.name",
        detail: "formula.functionList.DEC2HEX.functionParameter.number.detail",
        example: "100",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DEC2HEX.functionParameter.places.name",
        detail: "formula.functionList.DEC2HEX.functionParameter.places.detail",
        example: "4",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.DEC2OCT,
    functionType: Kc2.Engineering,
    description: "formula.functionList.DEC2OCT.description",
    abstract: "formula.functionList.DEC2OCT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.DEC2OCT.functionParameter.number.name",
        detail: "formula.functionList.DEC2OCT.functionParameter.number.detail",
        example: "58",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DEC2OCT.functionParameter.places.name",
        detail: "formula.functionList.DEC2OCT.functionParameter.places.detail",
        example: "3",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.DELTA,
    functionType: Kc2.Engineering,
    description: "formula.functionList.DELTA.description",
    abstract: "formula.functionList.DELTA.abstract",
    functionParameter: [
      {
        name: "formula.functionList.DELTA.functionParameter.number1.name",
        detail: "formula.functionList.DELTA.functionParameter.number1.detail",
        example: "5",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DELTA.functionParameter.number2.name",
        detail: "formula.functionList.DELTA.functionParameter.number2.detail",
        example: "4",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.ERF,
    functionType: Kc2.Engineering,
    description: "formula.functionList.ERF.description",
    abstract: "formula.functionList.ERF.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ERF.functionParameter.lowerLimit.name",
        detail: "formula.functionList.ERF.functionParameter.lowerLimit.detail",
        example: "0.745",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ERF.functionParameter.upperLimit.name",
        detail: "formula.functionList.ERF.functionParameter.upperLimit.detail",
        example: "2",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.ERF_PRECISE,
    functionType: Kc2.Engineering,
    description: "formula.functionList.ERF_PRECISE.description",
    abstract: "formula.functionList.ERF_PRECISE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ERF_PRECISE.functionParameter.x.name",
        detail: "formula.functionList.ERF_PRECISE.functionParameter.x.detail",
        example: "1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.ERFC,
    functionType: Kc2.Engineering,
    description: "formula.functionList.ERFC.description",
    abstract: "formula.functionList.ERFC.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ERFC.functionParameter.x.name",
        detail: "formula.functionList.ERFC.functionParameter.x.detail",
        example: "1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.ERFC_PRECISE,
    functionType: Kc2.Engineering,
    description: "formula.functionList.ERFC_PRECISE.description",
    abstract: "formula.functionList.ERFC_PRECISE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ERFC_PRECISE.functionParameter.x.name",
        detail: "formula.functionList.ERFC_PRECISE.functionParameter.x.detail",
        example: "1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.GESTEP,
    functionType: Kc2.Engineering,
    description: "formula.functionList.GESTEP.description",
    abstract: "formula.functionList.GESTEP.abstract",
    functionParameter: [
      {
        name: "formula.functionList.GESTEP.functionParameter.number.name",
        detail: "formula.functionList.GESTEP.functionParameter.number.detail",
        example: "5",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.GESTEP.functionParameter.step.name",
        detail: "formula.functionList.GESTEP.functionParameter.step.detail",
        example: "4",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.HEX2BIN,
    functionType: Kc2.Engineering,
    description: "formula.functionList.HEX2BIN.description",
    abstract: "formula.functionList.HEX2BIN.abstract",
    functionParameter: [
      {
        name: "formula.functionList.HEX2BIN.functionParameter.number.name",
        detail: "formula.functionList.HEX2BIN.functionParameter.number.detail",
        example: '"F"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.HEX2BIN.functionParameter.places.name",
        detail: "formula.functionList.HEX2BIN.functionParameter.places.detail",
        example: "8",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.HEX2DEC,
    functionType: Kc2.Engineering,
    description: "formula.functionList.HEX2DEC.description",
    abstract: "formula.functionList.HEX2DEC.abstract",
    functionParameter: [
      {
        name: "formula.functionList.HEX2DEC.functionParameter.number.name",
        detail: "formula.functionList.HEX2DEC.functionParameter.number.detail",
        example: '"A5"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.HEX2OCT,
    functionType: Kc2.Engineering,
    description: "formula.functionList.HEX2OCT.description",
    abstract: "formula.functionList.HEX2OCT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.HEX2OCT.functionParameter.number.name",
        detail: "formula.functionList.HEX2OCT.functionParameter.number.detail",
        example: '"F"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.HEX2OCT.functionParameter.places.name",
        detail: "formula.functionList.HEX2OCT.functionParameter.places.detail",
        example: "3",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.IMABS,
    functionType: Kc2.Engineering,
    description: "formula.functionList.IMABS.description",
    abstract: "formula.functionList.IMABS.abstract",
    functionParameter: [
      {
        name: "formula.functionList.IMABS.functionParameter.inumber.name",
        detail: "formula.functionList.IMABS.functionParameter.inumber.detail",
        example: '"5+12i"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.IMAGINARY,
    functionType: Kc2.Engineering,
    description: "formula.functionList.IMAGINARY.description",
    abstract: "formula.functionList.IMAGINARY.abstract",
    functionParameter: [
      {
        name: "formula.functionList.IMAGINARY.functionParameter.inumber.name",
        detail: "formula.functionList.IMAGINARY.functionParameter.inumber.detail",
        example: '"3+4i"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.IMARGUMENT,
    functionType: Kc2.Engineering,
    description: "formula.functionList.IMARGUMENT.description",
    abstract: "formula.functionList.IMARGUMENT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.IMARGUMENT.functionParameter.inumber.name",
        detail: "formula.functionList.IMARGUMENT.functionParameter.inumber.detail",
        example: '"3+4i"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.IMCONJUGATE,
    functionType: Kc2.Engineering,
    description: "formula.functionList.IMCONJUGATE.description",
    abstract: "formula.functionList.IMCONJUGATE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.IMCONJUGATE.functionParameter.inumber.name",
        detail: "formula.functionList.IMCONJUGATE.functionParameter.inumber.detail",
        example: '"3+4i"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.IMCOS,
    functionType: Kc2.Engineering,
    description: "formula.functionList.IMCOS.description",
    abstract: "formula.functionList.IMCOS.abstract",
    functionParameter: [
      {
        name: "formula.functionList.IMCOS.functionParameter.inumber.name",
        detail: "formula.functionList.IMCOS.functionParameter.inumber.detail",
        example: '"1+i"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.IMCOSH,
    functionType: Kc2.Engineering,
    description: "formula.functionList.IMCOSH.description",
    abstract: "formula.functionList.IMCOSH.abstract",
    functionParameter: [
      {
        name: "formula.functionList.IMCOSH.functionParameter.inumber.name",
        detail: "formula.functionList.IMCOSH.functionParameter.inumber.detail",
        example: '"4+3i"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.IMCOT,
    functionType: Kc2.Engineering,
    description: "formula.functionList.IMCOT.description",
    abstract: "formula.functionList.IMCOT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.IMCOT.functionParameter.inumber.name",
        detail: "formula.functionList.IMCOT.functionParameter.inumber.detail",
        example: '"4+3i"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.IMCOTH,
    functionType: Kc2.Engineering,
    description: "formula.functionList.IMCOTH.description",
    abstract: "formula.functionList.IMCOTH.abstract",
    functionParameter: [
      {
        name: "formula.functionList.IMCOTH.functionParameter.inumber.name",
        detail: "formula.functionList.IMCOTH.functionParameter.inumber.detail",
        example: '"4+3i"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.IMCSC,
    functionType: Kc2.Engineering,
    description: "formula.functionList.IMCSC.description",
    abstract: "formula.functionList.IMCSC.abstract",
    functionParameter: [
      {
        name: "formula.functionList.IMCSC.functionParameter.inumber.name",
        detail: "formula.functionList.IMCSC.functionParameter.inumber.detail",
        example: '"4+3i"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.IMCSCH,
    functionType: Kc2.Engineering,
    description: "formula.functionList.IMCSCH.description",
    abstract: "formula.functionList.IMCSCH.abstract",
    functionParameter: [
      {
        name: "formula.functionList.IMCSCH.functionParameter.inumber.name",
        detail: "formula.functionList.IMCSCH.functionParameter.inumber.detail",
        example: '"4+3i"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.IMDIV,
    functionType: Kc2.Engineering,
    description: "formula.functionList.IMDIV.description",
    abstract: "formula.functionList.IMDIV.abstract",
    functionParameter: [
      {
        name: "formula.functionList.IMDIV.functionParameter.inumber1.name",
        detail: "formula.functionList.IMDIV.functionParameter.inumber1.detail",
        example: '"-238+240i"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.IMDIV.functionParameter.inumber2.name",
        detail: "formula.functionList.IMDIV.functionParameter.inumber2.detail",
        example: '"10+24i"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.IMEXP,
    functionType: Kc2.Engineering,
    description: "formula.functionList.IMEXP.description",
    abstract: "formula.functionList.IMEXP.abstract",
    functionParameter: [
      {
        name: "formula.functionList.IMEXP.functionParameter.inumber.name",
        detail: "formula.functionList.IMEXP.functionParameter.inumber.detail",
        example: '"1+i"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.IMLN,
    functionType: Kc2.Engineering,
    description: "formula.functionList.IMLN.description",
    abstract: "formula.functionList.IMLN.abstract",
    functionParameter: [
      {
        name: "formula.functionList.IMLN.functionParameter.inumber.name",
        detail: "formula.functionList.IMLN.functionParameter.inumber.detail",
        example: '"3+4i"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.IMLOG,
    functionType: Kc2.Engineering,
    description: "formula.functionList.IMLOG.description",
    abstract: "formula.functionList.IMLOG.abstract",
    functionParameter: [
      {
        name: "formula.functionList.IMLOG.functionParameter.inumber.name",
        detail: "formula.functionList.IMLOG.functionParameter.inumber.detail",
        example: '"3+4i"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.IMLOG.functionParameter.base.name",
        detail: "formula.functionList.IMLOG.functionParameter.base.detail",
        example: "10",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.IMLOG10,
    functionType: Kc2.Engineering,
    description: "formula.functionList.IMLOG10.description",
    abstract: "formula.functionList.IMLOG10.abstract",
    functionParameter: [
      {
        name: "formula.functionList.IMLOG10.functionParameter.inumber.name",
        detail: "formula.functionList.IMLOG10.functionParameter.inumber.detail",
        example: '"3+4i"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.IMLOG2,
    functionType: Kc2.Engineering,
    description: "formula.functionList.IMLOG2.description",
    abstract: "formula.functionList.IMLOG2.abstract",
    functionParameter: [
      {
        name: "formula.functionList.IMLOG2.functionParameter.inumber.name",
        detail: "formula.functionList.IMLOG2.functionParameter.inumber.detail",
        example: '"3+4i"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.IMPOWER,
    functionType: Kc2.Engineering,
    description: "formula.functionList.IMPOWER.description",
    abstract: "formula.functionList.IMPOWER.abstract",
    functionParameter: [
      {
        name: "formula.functionList.IMPOWER.functionParameter.inumber.name",
        detail: "formula.functionList.IMPOWER.functionParameter.inumber.detail",
        example: '"2+3i"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.IMPOWER.functionParameter.number.name",
        detail: "formula.functionList.IMPOWER.functionParameter.number.detail",
        example: "3",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.IMPRODUCT,
    functionType: Kc2.Engineering,
    description: "formula.functionList.IMPRODUCT.description",
    abstract: "formula.functionList.IMPRODUCT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.IMPRODUCT.functionParameter.inumber1.name",
        detail: "formula.functionList.IMPRODUCT.functionParameter.inumber1.detail",
        example: '"3+4i"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.IMPRODUCT.functionParameter.inumber2.name",
        detail: "formula.functionList.IMPRODUCT.functionParameter.inumber2.detail",
        example: '"5-3i"',
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: Q3.IMREAL,
    functionType: Kc2.Engineering,
    description: "formula.functionList.IMREAL.description",
    abstract: "formula.functionList.IMREAL.abstract",
    functionParameter: [
      {
        name: "formula.functionList.IMREAL.functionParameter.inumber.name",
        detail: "formula.functionList.IMREAL.functionParameter.inumber.detail",
        example: '"6-9i"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.IMSEC,
    functionType: Kc2.Engineering,
    description: "formula.functionList.IMSEC.description",
    abstract: "formula.functionList.IMSEC.abstract",
    functionParameter: [
      {
        name: "formula.functionList.IMSEC.functionParameter.inumber.name",
        detail: "formula.functionList.IMSEC.functionParameter.inumber.detail",
        example: '"4+3i"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.IMSECH,
    functionType: Kc2.Engineering,
    description: "formula.functionList.IMSECH.description",
    abstract: "formula.functionList.IMSECH.abstract",
    functionParameter: [
      {
        name: "formula.functionList.IMSECH.functionParameter.inumber.name",
        detail: "formula.functionList.IMSECH.functionParameter.inumber.detail",
        example: '"4+3i"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.IMSIN,
    functionType: Kc2.Engineering,
    description: "formula.functionList.IMSIN.description",
    abstract: "formula.functionList.IMSIN.abstract",
    functionParameter: [
      {
        name: "formula.functionList.IMSIN.functionParameter.inumber.name",
        detail: "formula.functionList.IMSIN.functionParameter.inumber.detail",
        example: '"4+3i"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.IMSINH,
    functionType: Kc2.Engineering,
    description: "formula.functionList.IMSINH.description",
    abstract: "formula.functionList.IMSINH.abstract",
    functionParameter: [
      {
        name: "formula.functionList.IMSINH.functionParameter.inumber.name",
        detail: "formula.functionList.IMSINH.functionParameter.inumber.detail",
        example: '"4+3i"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.IMSQRT,
    functionType: Kc2.Engineering,
    description: "formula.functionList.IMSQRT.description",
    abstract: "formula.functionList.IMSQRT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.IMSQRT.functionParameter.inumber.name",
        detail: "formula.functionList.IMSQRT.functionParameter.inumber.detail",
        example: '"1+i"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.IMSUB,
    functionType: Kc2.Engineering,
    description: "formula.functionList.IMSUB.description",
    abstract: "formula.functionList.IMSUB.abstract",
    functionParameter: [
      {
        name: "formula.functionList.IMSUB.functionParameter.inumber1.name",
        detail: "formula.functionList.IMSUB.functionParameter.inumber1.detail",
        example: '"13+4i"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.IMSUB.functionParameter.inumber2.name",
        detail: "formula.functionList.IMSUB.functionParameter.inumber2.detail",
        example: '"5+3i"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.IMSUM,
    functionType: Kc2.Engineering,
    description: "formula.functionList.IMSUM.description",
    abstract: "formula.functionList.IMSUM.abstract",
    functionParameter: [
      {
        name: "formula.functionList.IMSUM.functionParameter.inumber1.name",
        detail: "formula.functionList.IMSUM.functionParameter.inumber1.detail",
        example: '"3+4i"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.IMSUM.functionParameter.inumber2.name",
        detail: "formula.functionList.IMSUM.functionParameter.inumber2.detail",
        example: '"5-3i"',
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: Q3.IMTAN,
    functionType: Kc2.Engineering,
    description: "formula.functionList.IMTAN.description",
    abstract: "formula.functionList.IMTAN.abstract",
    functionParameter: [
      {
        name: "formula.functionList.IMTAN.functionParameter.inumber.name",
        detail: "formula.functionList.IMTAN.functionParameter.inumber.detail",
        example: '"4+3i"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.IMTANH,
    functionType: Kc2.Engineering,
    description: "formula.functionList.IMTANH.description",
    abstract: "formula.functionList.IMTANH.abstract",
    functionParameter: [
      {
        name: "formula.functionList.IMTANH.functionParameter.inumber.name",
        detail: "formula.functionList.IMTANH.functionParameter.inumber.detail",
        example: '"4+3i"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.OCT2BIN,
    functionType: Kc2.Engineering,
    description: "formula.functionList.OCT2BIN.description",
    abstract: "formula.functionList.OCT2BIN.abstract",
    functionParameter: [
      {
        name: "formula.functionList.OCT2BIN.functionParameter.number.name",
        detail: "formula.functionList.OCT2BIN.functionParameter.number.detail",
        example: "3",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.OCT2BIN.functionParameter.places.name",
        detail: "formula.functionList.OCT2BIN.functionParameter.places.detail",
        example: "3",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.OCT2DEC,
    functionType: Kc2.Engineering,
    description: "formula.functionList.OCT2DEC.description",
    abstract: "formula.functionList.OCT2DEC.abstract",
    functionParameter: [
      {
        name: "formula.functionList.OCT2DEC.functionParameter.number.name",
        detail: "formula.functionList.OCT2DEC.functionParameter.number.detail",
        example: "54",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Q3.OCT2HEX,
    functionType: Kc2.Engineering,
    description: "formula.functionList.OCT2HEX.description",
    abstract: "formula.functionList.OCT2HEX.abstract",
    functionParameter: [
      {
        name: "formula.functionList.OCT2HEX.functionParameter.number.name",
        detail: "formula.functionList.OCT2HEX.functionParameter.number.detail",
        example: "100",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.OCT2HEX.functionParameter.places.name",
        detail: "formula.functionList.OCT2HEX.functionParameter.places.detail",
        example: "4",
        require: 0,
        repeat: 0
      }
    ]
  }
];
var _r3 = [
  {
    functionName: ee.ACCRINT,
    functionType: Kc2.Financial,
    description: "formula.functionList.ACCRINT.description",
    abstract: "formula.functionList.ACCRINT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ACCRINT.functionParameter.issue.name",
        detail: "formula.functionList.ACCRINT.functionParameter.issue.detail",
        example: '"2008-3-1"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ACCRINT.functionParameter.firstInterest.name",
        detail: "formula.functionList.ACCRINT.functionParameter.firstInterest.detail",
        example: '"2008-8-31"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ACCRINT.functionParameter.settlement.name",
        detail: "formula.functionList.ACCRINT.functionParameter.settlement.detail",
        example: '"2008-5-1"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ACCRINT.functionParameter.rate.name",
        detail: "formula.functionList.ACCRINT.functionParameter.rate.detail",
        example: "10%",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ACCRINT.functionParameter.par.name",
        detail: "formula.functionList.ACCRINT.functionParameter.par.detail",
        example: "1000",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ACCRINT.functionParameter.frequency.name",
        detail: "formula.functionList.ACCRINT.functionParameter.frequency.detail",
        example: "2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ACCRINT.functionParameter.basis.name",
        detail: "formula.functionList.ACCRINT.functionParameter.basis.detail",
        example: "0",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.ACCRINT.functionParameter.calcMethod.name",
        detail: "formula.functionList.ACCRINT.functionParameter.calcMethod.detail",
        example: "true",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.ACCRINTM,
    functionType: Kc2.Financial,
    description: "formula.functionList.ACCRINTM.description",
    abstract: "formula.functionList.ACCRINTM.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ACCRINTM.functionParameter.issue.name",
        detail: "formula.functionList.ACCRINTM.functionParameter.issue.detail",
        example: '"2008-4-1"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ACCRINTM.functionParameter.settlement.name",
        detail: "formula.functionList.ACCRINTM.functionParameter.settlement.detail",
        example: '"2008-6-15"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ACCRINTM.functionParameter.rate.name",
        detail: "formula.functionList.ACCRINTM.functionParameter.rate.detail",
        example: "10%",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ACCRINTM.functionParameter.par.name",
        detail: "formula.functionList.ACCRINTM.functionParameter.par.detail",
        example: "1000",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ACCRINTM.functionParameter.basis.name",
        detail: "formula.functionList.ACCRINTM.functionParameter.basis.detail",
        example: "3",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.AMORDEGRC,
    functionType: Kc2.Financial,
    description: "formula.functionList.AMORDEGRC.description",
    abstract: "formula.functionList.AMORDEGRC.abstract",
    functionParameter: [
      {
        name: "formula.functionList.AMORDEGRC.functionParameter.number1.name",
        detail: "formula.functionList.AMORDEGRC.functionParameter.number1.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.AMORDEGRC.functionParameter.number2.name",
        detail: "formula.functionList.AMORDEGRC.functionParameter.number2.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.AMORLINC,
    functionType: Kc2.Financial,
    description: "formula.functionList.AMORLINC.description",
    abstract: "formula.functionList.AMORLINC.abstract",
    functionParameter: [
      {
        name: "formula.functionList.AMORLINC.functionParameter.cost.name",
        detail: "formula.functionList.AMORLINC.functionParameter.cost.detail",
        example: "2400",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.AMORLINC.functionParameter.datePurchased.name",
        detail: "formula.functionList.AMORLINC.functionParameter.datePurchased.detail",
        example: '"2008-8-19"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.AMORLINC.functionParameter.firstPeriod.name",
        detail: "formula.functionList.AMORLINC.functionParameter.firstPeriod.detail",
        example: '"2008-12-31"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.AMORLINC.functionParameter.salvage.name",
        detail: "formula.functionList.AMORLINC.functionParameter.salvage.detail",
        example: "300",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.AMORLINC.functionParameter.period.name",
        detail: "formula.functionList.AMORLINC.functionParameter.period.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.AMORLINC.functionParameter.rate.name",
        detail: "formula.functionList.AMORLINC.functionParameter.rate.detail",
        example: "15%",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.AMORLINC.functionParameter.basis.name",
        detail: "formula.functionList.AMORLINC.functionParameter.basis.detail",
        example: "0",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.COUPDAYBS,
    functionType: Kc2.Financial,
    description: "formula.functionList.COUPDAYBS.description",
    abstract: "formula.functionList.COUPDAYBS.abstract",
    functionParameter: [
      {
        name: "formula.functionList.COUPDAYBS.functionParameter.settlement.name",
        detail: "formula.functionList.COUPDAYBS.functionParameter.settlement.detail",
        example: '"2011-1-25"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.COUPDAYBS.functionParameter.maturity.name",
        detail: "formula.functionList.COUPDAYBS.functionParameter.maturity.detail",
        example: '"2011-11-15"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.COUPDAYBS.functionParameter.frequency.name",
        detail: "formula.functionList.COUPDAYBS.functionParameter.frequency.detail",
        example: "2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.COUPDAYBS.functionParameter.basis.name",
        detail: "formula.functionList.COUPDAYBS.functionParameter.basis.detail",
        example: "1",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.COUPDAYS,
    functionType: Kc2.Financial,
    description: "formula.functionList.COUPDAYS.description",
    abstract: "formula.functionList.COUPDAYS.abstract",
    functionParameter: [
      {
        name: "formula.functionList.COUPDAYS.functionParameter.settlement.name",
        detail: "formula.functionList.COUPDAYS.functionParameter.settlement.detail",
        example: '"2011-1-25"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.COUPDAYS.functionParameter.maturity.name",
        detail: "formula.functionList.COUPDAYS.functionParameter.maturity.detail",
        example: '"2011-11-15"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.COUPDAYS.functionParameter.frequency.name",
        detail: "formula.functionList.COUPDAYS.functionParameter.frequency.detail",
        example: "2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.COUPDAYS.functionParameter.basis.name",
        detail: "formula.functionList.COUPDAYS.functionParameter.basis.detail",
        example: "1",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.COUPDAYSNC,
    functionType: Kc2.Financial,
    description: "formula.functionList.COUPDAYSNC.description",
    abstract: "formula.functionList.COUPDAYSNC.abstract",
    functionParameter: [
      {
        name: "formula.functionList.COUPDAYSNC.functionParameter.settlement.name",
        detail: "formula.functionList.COUPDAYSNC.functionParameter.settlement.detail",
        example: '"2011-1-25"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.COUPDAYSNC.functionParameter.maturity.name",
        detail: "formula.functionList.COUPDAYSNC.functionParameter.maturity.detail",
        example: '"2011-11-15"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.COUPDAYSNC.functionParameter.frequency.name",
        detail: "formula.functionList.COUPDAYSNC.functionParameter.frequency.detail",
        example: "2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.COUPDAYSNC.functionParameter.basis.name",
        detail: "formula.functionList.COUPDAYSNC.functionParameter.basis.detail",
        example: "1",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.COUPNCD,
    functionType: Kc2.Financial,
    description: "formula.functionList.COUPNCD.description",
    abstract: "formula.functionList.COUPNCD.abstract",
    functionParameter: [
      {
        name: "formula.functionList.COUPNCD.functionParameter.settlement.name",
        detail: "formula.functionList.COUPNCD.functionParameter.settlement.detail",
        example: '"2011-1-25"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.COUPNCD.functionParameter.maturity.name",
        detail: "formula.functionList.COUPNCD.functionParameter.maturity.detail",
        example: '"2011-11-15"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.COUPNCD.functionParameter.frequency.name",
        detail: "formula.functionList.COUPNCD.functionParameter.frequency.detail",
        example: "2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.COUPNCD.functionParameter.basis.name",
        detail: "formula.functionList.COUPNCD.functionParameter.basis.detail",
        example: "1",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.COUPNUM,
    functionType: Kc2.Financial,
    description: "formula.functionList.COUPNUM.description",
    abstract: "formula.functionList.COUPNUM.abstract",
    functionParameter: [
      {
        name: "formula.functionList.COUPNUM.functionParameter.settlement.name",
        detail: "formula.functionList.COUPNUM.functionParameter.settlement.detail",
        example: '"2011-1-25"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.COUPNUM.functionParameter.maturity.name",
        detail: "formula.functionList.COUPNUM.functionParameter.maturity.detail",
        example: '"2011-11-15"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.COUPNUM.functionParameter.frequency.name",
        detail: "formula.functionList.COUPNUM.functionParameter.frequency.detail",
        example: "2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.COUPNUM.functionParameter.basis.name",
        detail: "formula.functionList.COUPNUM.functionParameter.basis.detail",
        example: "1",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.COUPPCD,
    functionType: Kc2.Financial,
    description: "formula.functionList.COUPPCD.description",
    abstract: "formula.functionList.COUPPCD.abstract",
    functionParameter: [
      {
        name: "formula.functionList.COUPPCD.functionParameter.settlement.name",
        detail: "formula.functionList.COUPPCD.functionParameter.settlement.detail",
        example: '"2011-1-25"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.COUPPCD.functionParameter.maturity.name",
        detail: "formula.functionList.COUPPCD.functionParameter.maturity.detail",
        example: '"2011-11-15"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.COUPPCD.functionParameter.frequency.name",
        detail: "formula.functionList.COUPPCD.functionParameter.frequency.detail",
        example: "2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.COUPPCD.functionParameter.basis.name",
        detail: "formula.functionList.COUPPCD.functionParameter.basis.detail",
        example: "1",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.CUMIPMT,
    functionType: Kc2.Financial,
    description: "formula.functionList.CUMIPMT.description",
    abstract: "formula.functionList.CUMIPMT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.CUMIPMT.functionParameter.rate.name",
        detail: "formula.functionList.CUMIPMT.functionParameter.rate.detail",
        example: "9%/12",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CUMIPMT.functionParameter.nper.name",
        detail: "formula.functionList.CUMIPMT.functionParameter.nper.detail",
        example: "30*12",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CUMIPMT.functionParameter.pv.name",
        detail: "formula.functionList.CUMIPMT.functionParameter.pv.detail",
        example: "125000",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CUMIPMT.functionParameter.startPeriod.name",
        detail: "formula.functionList.CUMIPMT.functionParameter.startPeriod.detail",
        example: "13",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CUMIPMT.functionParameter.endPeriod.name",
        detail: "formula.functionList.CUMIPMT.functionParameter.endPeriod.detail",
        example: "24",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CUMIPMT.functionParameter.type.name",
        detail: "formula.functionList.CUMIPMT.functionParameter.type.detail",
        example: "0",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.CUMPRINC,
    functionType: Kc2.Financial,
    description: "formula.functionList.CUMPRINC.description",
    abstract: "formula.functionList.CUMPRINC.abstract",
    functionParameter: [
      {
        name: "formula.functionList.CUMPRINC.functionParameter.rate.name",
        detail: "formula.functionList.CUMPRINC.functionParameter.rate.detail",
        example: "9%/12",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CUMPRINC.functionParameter.nper.name",
        detail: "formula.functionList.CUMPRINC.functionParameter.nper.detail",
        example: "30*12",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CUMPRINC.functionParameter.pv.name",
        detail: "formula.functionList.CUMPRINC.functionParameter.pv.detail",
        example: "125000",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CUMPRINC.functionParameter.startPeriod.name",
        detail: "formula.functionList.CUMPRINC.functionParameter.startPeriod.detail",
        example: "13",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CUMPRINC.functionParameter.endPeriod.name",
        detail: "formula.functionList.CUMPRINC.functionParameter.endPeriod.detail",
        example: "24",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CUMPRINC.functionParameter.type.name",
        detail: "formula.functionList.CUMPRINC.functionParameter.type.detail",
        example: "0",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.DB,
    functionType: Kc2.Financial,
    description: "formula.functionList.DB.description",
    abstract: "formula.functionList.DB.abstract",
    functionParameter: [
      {
        name: "formula.functionList.DB.functionParameter.cost.name",
        detail: "formula.functionList.DB.functionParameter.cost.detail",
        example: "10000000",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DB.functionParameter.salvage.name",
        detail: "formula.functionList.DB.functionParameter.salvage.detail",
        example: "1000000",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DB.functionParameter.life.name",
        detail: "formula.functionList.DB.functionParameter.life.detail",
        example: "6",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DB.functionParameter.period.name",
        detail: "formula.functionList.DB.functionParameter.period.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DB.functionParameter.month.name",
        detail: "formula.functionList.DB.functionParameter.month.detail",
        example: "7",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.DDB,
    functionType: Kc2.Financial,
    description: "formula.functionList.DDB.description",
    abstract: "formula.functionList.DDB.abstract",
    functionParameter: [
      {
        name: "formula.functionList.DDB.functionParameter.cost.name",
        detail: "formula.functionList.DDB.functionParameter.cost.detail",
        example: "24000",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DDB.functionParameter.salvage.name",
        detail: "formula.functionList.DDB.functionParameter.salvage.detail",
        example: "3000",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DDB.functionParameter.life.name",
        detail: "formula.functionList.DDB.functionParameter.life.detail",
        example: "10",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DDB.functionParameter.period.name",
        detail: "formula.functionList.DDB.functionParameter.period.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DDB.functionParameter.factor.name",
        detail: "formula.functionList.DDB.functionParameter.factor.detail",
        example: "2",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.DISC,
    functionType: Kc2.Financial,
    description: "formula.functionList.DISC.description",
    abstract: "formula.functionList.DISC.abstract",
    functionParameter: [
      {
        name: "formula.functionList.DISC.functionParameter.settlement.name",
        detail: "formula.functionList.DISC.functionParameter.settlement.detail",
        example: '"2018-7-1"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DISC.functionParameter.maturity.name",
        detail: "formula.functionList.DISC.functionParameter.maturity.detail",
        example: '"2048-1-1"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DISC.functionParameter.pr.name",
        detail: "formula.functionList.DISC.functionParameter.pr.detail",
        example: "97.975",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DISC.functionParameter.redemption.name",
        detail: "formula.functionList.DISC.functionParameter.redemption.detail",
        example: "100",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DISC.functionParameter.basis.name",
        detail: "formula.functionList.DISC.functionParameter.basis.detail",
        example: "1",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.DOLLARDE,
    functionType: Kc2.Financial,
    description: "formula.functionList.DOLLARDE.description",
    abstract: "formula.functionList.DOLLARDE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.DOLLARDE.functionParameter.fractionalDollar.name",
        detail: "formula.functionList.DOLLARDE.functionParameter.fractionalDollar.detail",
        example: "1.02",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DOLLARDE.functionParameter.fraction.name",
        detail: "formula.functionList.DOLLARDE.functionParameter.fraction.detail",
        example: "16",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.DOLLARFR,
    functionType: Kc2.Financial,
    description: "formula.functionList.DOLLARFR.description",
    abstract: "formula.functionList.DOLLARFR.abstract",
    functionParameter: [
      {
        name: "formula.functionList.DOLLARFR.functionParameter.decimalDollar.name",
        detail: "formula.functionList.DOLLARFR.functionParameter.decimalDollar.detail",
        example: "1.125",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DOLLARFR.functionParameter.fraction.name",
        detail: "formula.functionList.DOLLARFR.functionParameter.fraction.detail",
        example: "16",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.DURATION,
    functionType: Kc2.Financial,
    description: "formula.functionList.DURATION.description",
    abstract: "formula.functionList.DURATION.abstract",
    functionParameter: [
      {
        name: "formula.functionList.DURATION.functionParameter.settlement.name",
        detail: "formula.functionList.DURATION.functionParameter.settlement.detail",
        example: '"2018-7-1"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DURATION.functionParameter.maturity.name",
        detail: "formula.functionList.DURATION.functionParameter.maturity.detail",
        example: '"2048-1-1"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DURATION.functionParameter.coupon.name",
        detail: "formula.functionList.DURATION.functionParameter.coupon.detail",
        example: "8%",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DURATION.functionParameter.yld.name",
        detail: "formula.functionList.DURATION.functionParameter.yld.detail",
        example: "9%",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DURATION.functionParameter.frequency.name",
        detail: "formula.functionList.DURATION.functionParameter.frequency.detail",
        example: "2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DURATION.functionParameter.basis.name",
        detail: "formula.functionList.DURATION.functionParameter.basis.detail",
        example: "1",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.EFFECT,
    functionType: Kc2.Financial,
    description: "formula.functionList.EFFECT.description",
    abstract: "formula.functionList.EFFECT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.EFFECT.functionParameter.nominalRate.name",
        detail: "formula.functionList.EFFECT.functionParameter.nominalRate.detail",
        example: "5.25%",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.EFFECT.functionParameter.npery.name",
        detail: "formula.functionList.EFFECT.functionParameter.npery.detail",
        example: "4",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.FV,
    functionType: Kc2.Financial,
    description: "formula.functionList.FV.description",
    abstract: "formula.functionList.FV.abstract",
    functionParameter: [
      {
        name: "formula.functionList.FV.functionParameter.rate.name",
        detail: "formula.functionList.FV.functionParameter.rate.detail",
        example: "6%/12",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.FV.functionParameter.nper.name",
        detail: "formula.functionList.FV.functionParameter.nper.detail",
        example: "10",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.FV.functionParameter.pmt.name",
        detail: "formula.functionList.FV.functionParameter.pmt.detail",
        example: "-200",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.FV.functionParameter.pv.name",
        detail: "formula.functionList.FV.functionParameter.pv.detail",
        example: "-500",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.FV.functionParameter.type.name",
        detail: "formula.functionList.FV.functionParameter.type.detail",
        example: "1",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.FVSCHEDULE,
    functionType: Kc2.Financial,
    description: "formula.functionList.FVSCHEDULE.description",
    abstract: "formula.functionList.FVSCHEDULE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.FVSCHEDULE.functionParameter.principal.name",
        detail: "formula.functionList.FVSCHEDULE.functionParameter.principal.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.FVSCHEDULE.functionParameter.schedule.name",
        detail: "formula.functionList.FVSCHEDULE.functionParameter.schedule.detail",
        example: "A1:A4",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.INTRATE,
    functionType: Kc2.Financial,
    description: "formula.functionList.INTRATE.description",
    abstract: "formula.functionList.INTRATE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.INTRATE.functionParameter.settlement.name",
        detail: "formula.functionList.INTRATE.functionParameter.settlement.detail",
        example: '"2008-2-15"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.INTRATE.functionParameter.maturity.name",
        detail: "formula.functionList.INTRATE.functionParameter.maturity.detail",
        example: '"2008-5-15"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.INTRATE.functionParameter.investment.name",
        detail: "formula.functionList.INTRATE.functionParameter.investment.detail",
        example: "10000000",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.INTRATE.functionParameter.redemption.name",
        detail: "formula.functionList.INTRATE.functionParameter.redemption.detail",
        example: "10144200",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.INTRATE.functionParameter.basis.name",
        detail: "formula.functionList.INTRATE.functionParameter.basis.detail",
        example: "2",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.IPMT,
    functionType: Kc2.Financial,
    description: "formula.functionList.IPMT.description",
    abstract: "formula.functionList.IPMT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.IPMT.functionParameter.rate.name",
        detail: "formula.functionList.IPMT.functionParameter.rate.detail",
        example: "10%/12",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.IPMT.functionParameter.per.name",
        detail: "formula.functionList.IPMT.functionParameter.per.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.IPMT.functionParameter.nper.name",
        detail: "formula.functionList.IPMT.functionParameter.nper.detail",
        example: "3*12",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.IPMT.functionParameter.pv.name",
        detail: "formula.functionList.IPMT.functionParameter.pv.detail",
        example: "80000",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.IPMT.functionParameter.fv.name",
        detail: "formula.functionList.IPMT.functionParameter.fv.detail",
        example: "0",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.IPMT.functionParameter.type.name",
        detail: "formula.functionList.IPMT.functionParameter.type.detail",
        example: "0",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.IRR,
    functionType: Kc2.Financial,
    description: "formula.functionList.IRR.description",
    abstract: "formula.functionList.IRR.abstract",
    functionParameter: [
      {
        name: "formula.functionList.IRR.functionParameter.values.name",
        detail: "formula.functionList.IRR.functionParameter.values.detail",
        example: "A1:A4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.IRR.functionParameter.guess.name",
        detail: "formula.functionList.IRR.functionParameter.guess.detail",
        example: "0.1",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.ISPMT,
    functionType: Kc2.Financial,
    description: "formula.functionList.ISPMT.description",
    abstract: "formula.functionList.ISPMT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ISPMT.functionParameter.rate.name",
        detail: "formula.functionList.ISPMT.functionParameter.rate.detail",
        example: "10%",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ISPMT.functionParameter.per.name",
        detail: "formula.functionList.ISPMT.functionParameter.per.detail",
        example: "2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ISPMT.functionParameter.nper.name",
        detail: "formula.functionList.ISPMT.functionParameter.nper.detail",
        example: "5",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ISPMT.functionParameter.pv.name",
        detail: "formula.functionList.ISPMT.functionParameter.pv.detail",
        example: "1000",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.MDURATION,
    functionType: Kc2.Financial,
    description: "formula.functionList.MDURATION.description",
    abstract: "formula.functionList.MDURATION.abstract",
    functionParameter: [
      {
        name: "formula.functionList.MDURATION.functionParameter.settlement.name",
        detail: "formula.functionList.MDURATION.functionParameter.settlement.detail",
        example: '"2018-7-1"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.MDURATION.functionParameter.maturity.name",
        detail: "formula.functionList.MDURATION.functionParameter.maturity.detail",
        example: '"2048-1-1"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.MDURATION.functionParameter.coupon.name",
        detail: "formula.functionList.MDURATION.functionParameter.coupon.detail",
        example: "8%",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.MDURATION.functionParameter.yld.name",
        detail: "formula.functionList.MDURATION.functionParameter.yld.detail",
        example: "9%",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.MDURATION.functionParameter.frequency.name",
        detail: "formula.functionList.MDURATION.functionParameter.frequency.detail",
        example: "2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.MDURATION.functionParameter.basis.name",
        detail: "formula.functionList.MDURATION.functionParameter.basis.detail",
        example: "1",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.MIRR,
    functionType: Kc2.Financial,
    description: "formula.functionList.MIRR.description",
    abstract: "formula.functionList.MIRR.abstract",
    functionParameter: [
      {
        name: "formula.functionList.MIRR.functionParameter.values.name",
        detail: "formula.functionList.MIRR.functionParameter.values.detail",
        example: "A1:A4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.MIRR.functionParameter.financeRate.name",
        detail: "formula.functionList.MIRR.functionParameter.financeRate.detail",
        example: "10%",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.MIRR.functionParameter.reinvestRate.name",
        detail: "formula.functionList.MIRR.functionParameter.reinvestRate.detail",
        example: "12%",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.NOMINAL,
    functionType: Kc2.Financial,
    description: "formula.functionList.NOMINAL.description",
    abstract: "formula.functionList.NOMINAL.abstract",
    functionParameter: [
      {
        name: "formula.functionList.NOMINAL.functionParameter.effectRate.name",
        detail: "formula.functionList.NOMINAL.functionParameter.effectRate.detail",
        example: "5.3543%",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.NOMINAL.functionParameter.npery.name",
        detail: "formula.functionList.NOMINAL.functionParameter.npery.detail",
        example: "4",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.NPER,
    functionType: Kc2.Financial,
    description: "formula.functionList.NPER.description",
    abstract: "formula.functionList.NPER.abstract",
    functionParameter: [
      {
        name: "formula.functionList.NPER.functionParameter.rate.name",
        detail: "formula.functionList.NPER.functionParameter.rate.detail",
        example: "12%/12",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.NPER.functionParameter.pmt.name",
        detail: "formula.functionList.NPER.functionParameter.pmt.detail",
        example: "-100",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.NPER.functionParameter.pv.name",
        detail: "formula.functionList.NPER.functionParameter.pv.detail",
        example: "-1000",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.NPER.functionParameter.fv.name",
        detail: "formula.functionList.NPER.functionParameter.fv.detail",
        example: "10000",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.NPER.functionParameter.type.name",
        detail: "formula.functionList.NPER.functionParameter.type.detail",
        example: "1",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.NPV,
    functionType: Kc2.Financial,
    description: "formula.functionList.NPV.description",
    abstract: "formula.functionList.NPV.abstract",
    functionParameter: [
      {
        name: "formula.functionList.NPV.functionParameter.rate.name",
        detail: "formula.functionList.NPV.functionParameter.rate.detail",
        example: "10%",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.NPV.functionParameter.value1.name",
        detail: "formula.functionList.NPV.functionParameter.value1.detail",
        example: "A1:A4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.NPV.functionParameter.value2.name",
        detail: "formula.functionList.NPV.functionParameter.value2.detail",
        example: "-9000",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: ee.ODDFPRICE,
    functionType: Kc2.Financial,
    description: "formula.functionList.ODDFPRICE.description",
    abstract: "formula.functionList.ODDFPRICE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ODDFPRICE.functionParameter.settlement.name",
        detail: "formula.functionList.ODDFPRICE.functionParameter.settlement.detail",
        example: '"2008-11-11"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ODDFPRICE.functionParameter.maturity.name",
        detail: "formula.functionList.ODDFPRICE.functionParameter.maturity.detail",
        example: '"2021-3-1"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ODDFPRICE.functionParameter.issue.name",
        detail: "formula.functionList.ODDFPRICE.functionParameter.issue.detail",
        example: '"2008-10-15"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ODDFPRICE.functionParameter.firstCoupon.name",
        detail: "formula.functionList.ODDFPRICE.functionParameter.firstCoupon.detail",
        example: '"2009-3-1"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ODDFPRICE.functionParameter.rate.name",
        detail: "formula.functionList.ODDFPRICE.functionParameter.rate.detail",
        example: "7.85%",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ODDFPRICE.functionParameter.yld.name",
        detail: "formula.functionList.ODDFPRICE.functionParameter.yld.detail",
        example: "6.25%",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ODDFPRICE.functionParameter.redemption.name",
        detail: "formula.functionList.ODDFPRICE.functionParameter.redemption.detail",
        example: "100",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ODDFPRICE.functionParameter.frequency.name",
        detail: "formula.functionList.ODDFPRICE.functionParameter.frequency.detail",
        example: "2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ODDFPRICE.functionParameter.basis.name",
        detail: "formula.functionList.ODDFPRICE.functionParameter.basis.detail",
        example: "1",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.ODDFYIELD,
    functionType: Kc2.Financial,
    description: "formula.functionList.ODDFYIELD.description",
    abstract: "formula.functionList.ODDFYIELD.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ODDFYIELD.functionParameter.settlement.name",
        detail: "formula.functionList.ODDFYIELD.functionParameter.settlement.detail",
        example: '"2008-11-11"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ODDFYIELD.functionParameter.maturity.name",
        detail: "formula.functionList.ODDFYIELD.functionParameter.maturity.detail",
        example: '"2021-3-1"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ODDFYIELD.functionParameter.issue.name",
        detail: "formula.functionList.ODDFYIELD.functionParameter.issue.detail",
        example: '"2008-10-15"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ODDFYIELD.functionParameter.firstCoupon.name",
        detail: "formula.functionList.ODDFYIELD.functionParameter.firstCoupon.detail",
        example: '"2009-3-1"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ODDFYIELD.functionParameter.rate.name",
        detail: "formula.functionList.ODDFYIELD.functionParameter.rate.detail",
        example: "5.75%",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ODDFYIELD.functionParameter.pr.name",
        detail: "formula.functionList.ODDFYIELD.functionParameter.pr.detail",
        example: "84.5",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ODDFYIELD.functionParameter.redemption.name",
        detail: "formula.functionList.ODDFYIELD.functionParameter.redemption.detail",
        example: "100",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ODDFYIELD.functionParameter.frequency.name",
        detail: "formula.functionList.ODDFYIELD.functionParameter.frequency.detail",
        example: "2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ODDFYIELD.functionParameter.basis.name",
        detail: "formula.functionList.ODDFYIELD.functionParameter.basis.detail",
        example: "0",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.ODDLPRICE,
    functionType: Kc2.Financial,
    description: "formula.functionList.ODDLPRICE.description",
    abstract: "formula.functionList.ODDLPRICE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ODDLPRICE.functionParameter.settlement.name",
        detail: "formula.functionList.ODDLPRICE.functionParameter.settlement.detail",
        example: '"2008-2-7"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ODDLPRICE.functionParameter.maturity.name",
        detail: "formula.functionList.ODDLPRICE.functionParameter.maturity.detail",
        example: '"2008-6-15"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ODDLPRICE.functionParameter.lastInterest.name",
        detail: "formula.functionList.ODDLPRICE.functionParameter.lastInterest.detail",
        example: '"2007-10-15"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ODDLPRICE.functionParameter.rate.name",
        detail: "formula.functionList.ODDLPRICE.functionParameter.rate.detail",
        example: "3.75%",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ODDLPRICE.functionParameter.yld.name",
        detail: "formula.functionList.ODDLPRICE.functionParameter.yld.detail",
        example: "4.05%",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ODDLPRICE.functionParameter.redemption.name",
        detail: "formula.functionList.ODDLPRICE.functionParameter.redemption.detail",
        example: "100",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ODDLPRICE.functionParameter.frequency.name",
        detail: "formula.functionList.ODDLPRICE.functionParameter.frequency.detail",
        example: "2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ODDLPRICE.functionParameter.basis.name",
        detail: "formula.functionList.ODDLPRICE.functionParameter.basis.detail",
        example: "0",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.ODDLYIELD,
    functionType: Kc2.Financial,
    description: "formula.functionList.ODDLYIELD.description",
    abstract: "formula.functionList.ODDLYIELD.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ODDLYIELD.functionParameter.settlement.name",
        detail: "formula.functionList.ODDLYIELD.functionParameter.settlement.detail",
        example: '"2008-4-20"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ODDLYIELD.functionParameter.maturity.name",
        detail: "formula.functionList.ODDLYIELD.functionParameter.maturity.detail",
        example: '"2008-6-15"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ODDLYIELD.functionParameter.lastInterest.name",
        detail: "formula.functionList.ODDLYIELD.functionParameter.lastInterest.detail",
        example: '"2007-12-24"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ODDLYIELD.functionParameter.rate.name",
        detail: "formula.functionList.ODDLYIELD.functionParameter.rate.detail",
        example: "3.75%",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ODDLYIELD.functionParameter.pr.name",
        detail: "formula.functionList.ODDLYIELD.functionParameter.pr.detail",
        example: "99.875",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ODDLYIELD.functionParameter.redemption.name",
        detail: "formula.functionList.ODDLYIELD.functionParameter.redemption.detail",
        example: "100",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ODDLYIELD.functionParameter.frequency.name",
        detail: "formula.functionList.ODDLYIELD.functionParameter.frequency.detail",
        example: "2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ODDLYIELD.functionParameter.basis.name",
        detail: "formula.functionList.ODDLYIELD.functionParameter.basis.detail",
        example: "0",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.PDURATION,
    functionType: Kc2.Financial,
    description: "formula.functionList.PDURATION.description",
    abstract: "formula.functionList.PDURATION.abstract",
    functionParameter: [
      {
        name: "formula.functionList.PDURATION.functionParameter.rate.name",
        detail: "formula.functionList.PDURATION.functionParameter.rate.detail",
        example: "2.5%",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PDURATION.functionParameter.pv.name",
        detail: "formula.functionList.PDURATION.functionParameter.pv.detail",
        example: "2000",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PDURATION.functionParameter.fv.name",
        detail: "formula.functionList.PDURATION.functionParameter.fv.detail",
        example: "2200",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.PMT,
    functionType: Kc2.Financial,
    description: "formula.functionList.PMT.description",
    abstract: "formula.functionList.PMT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.PMT.functionParameter.rate.name",
        detail: "formula.functionList.PMT.functionParameter.rate.detail",
        example: "8%/12",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PMT.functionParameter.nper.name",
        detail: "formula.functionList.PMT.functionParameter.nper.detail",
        example: "10",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PMT.functionParameter.pv.name",
        detail: "formula.functionList.PMT.functionParameter.pv.detail",
        example: "10000",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PMT.functionParameter.fv.name",
        detail: "formula.functionList.PMT.functionParameter.fv.detail",
        example: "0",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.PMT.functionParameter.type.name",
        detail: "formula.functionList.PMT.functionParameter.type.detail",
        example: "0",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.PPMT,
    functionType: Kc2.Financial,
    description: "formula.functionList.PPMT.description",
    abstract: "formula.functionList.PPMT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.PPMT.functionParameter.rate.name",
        detail: "formula.functionList.PPMT.functionParameter.rate.detail",
        example: "10%/12",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PPMT.functionParameter.per.name",
        detail: "formula.functionList.PPMT.functionParameter.per.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PPMT.functionParameter.nper.name",
        detail: "formula.functionList.PPMT.functionParameter.nper.detail",
        example: "3*12",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PPMT.functionParameter.pv.name",
        detail: "formula.functionList.PPMT.functionParameter.pv.detail",
        example: "80000",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PPMT.functionParameter.fv.name",
        detail: "formula.functionList.PPMT.functionParameter.fv.detail",
        example: "0",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.PPMT.functionParameter.type.name",
        detail: "formula.functionList.PPMT.functionParameter.type.detail",
        example: "0",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.PRICE,
    functionType: Kc2.Financial,
    description: "formula.functionList.PRICE.description",
    abstract: "formula.functionList.PRICE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.PRICE.functionParameter.settlement.name",
        detail: "formula.functionList.PRICE.functionParameter.settlement.detail",
        example: '"2008-11-11"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PRICE.functionParameter.maturity.name",
        detail: "formula.functionList.PRICE.functionParameter.maturity.detail",
        example: '"2021-3-1"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PRICE.functionParameter.rate.name",
        detail: "formula.functionList.PRICE.functionParameter.rate.detail",
        example: "7.85%",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PRICE.functionParameter.yld.name",
        detail: "formula.functionList.PRICE.functionParameter.yld.detail",
        example: "6.25%",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PRICE.functionParameter.redemption.name",
        detail: "formula.functionList.PRICE.functionParameter.redemption.detail",
        example: "100",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PRICE.functionParameter.frequency.name",
        detail: "formula.functionList.PRICE.functionParameter.frequency.detail",
        example: "2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PRICE.functionParameter.basis.name",
        detail: "formula.functionList.PRICE.functionParameter.basis.detail",
        example: "1",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.PRICEDISC,
    functionType: Kc2.Financial,
    description: "formula.functionList.PRICEDISC.description",
    abstract: "formula.functionList.PRICEDISC.abstract",
    functionParameter: [
      {
        name: "formula.functionList.PRICEDISC.functionParameter.settlement.name",
        detail: "formula.functionList.PRICEDISC.functionParameter.settlement.detail",
        example: '"2008-11-11"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PRICEDISC.functionParameter.maturity.name",
        detail: "formula.functionList.PRICEDISC.functionParameter.maturity.detail",
        example: '"2021-3-1"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PRICEDISC.functionParameter.discount.name",
        detail: "formula.functionList.PRICEDISC.functionParameter.discount.detail",
        example: "6.25%",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PRICEDISC.functionParameter.redemption.name",
        detail: "formula.functionList.PRICEDISC.functionParameter.redemption.detail",
        example: "100",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PRICEDISC.functionParameter.basis.name",
        detail: "formula.functionList.PRICEDISC.functionParameter.basis.detail",
        example: "1",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.PRICEMAT,
    functionType: Kc2.Financial,
    description: "formula.functionList.PRICEMAT.description",
    abstract: "formula.functionList.PRICEMAT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.PRICEMAT.functionParameter.settlement.name",
        detail: "formula.functionList.PRICEMAT.functionParameter.settlement.detail",
        example: '"2008-11-11"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PRICEMAT.functionParameter.maturity.name",
        detail: "formula.functionList.PRICEMAT.functionParameter.maturity.detail",
        example: '"2021-3-1"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PRICEMAT.functionParameter.issue.name",
        detail: "formula.functionList.PRICEMAT.functionParameter.issue.detail",
        example: '"2008-10-15"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PRICEMAT.functionParameter.rate.name",
        detail: "formula.functionList.PRICEMAT.functionParameter.rate.detail",
        example: "7.85%",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PRICEMAT.functionParameter.yld.name",
        detail: "formula.functionList.PRICEMAT.functionParameter.yld.detail",
        example: "6.25%",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PRICEMAT.functionParameter.basis.name",
        detail: "formula.functionList.PRICEMAT.functionParameter.basis.detail",
        example: "1",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.PV,
    functionType: Kc2.Financial,
    description: "formula.functionList.PV.description",
    abstract: "formula.functionList.PV.abstract",
    functionParameter: [
      {
        name: "formula.functionList.PV.functionParameter.rate.name",
        detail: "formula.functionList.PV.functionParameter.rate.detail",
        example: "2%",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PV.functionParameter.nper.name",
        detail: "formula.functionList.PV.functionParameter.nper.detail",
        example: "12",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PV.functionParameter.pmt.name",
        detail: "formula.functionList.PV.functionParameter.pmt.detail",
        example: "100",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PV.functionParameter.fv.name",
        detail: "formula.functionList.PV.functionParameter.fv.detail",
        example: "0",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.PV.functionParameter.type.name",
        detail: "formula.functionList.PV.functionParameter.type.detail",
        example: "0",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.RATE,
    functionType: Kc2.Financial,
    description: "formula.functionList.RATE.description",
    abstract: "formula.functionList.RATE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.RATE.functionParameter.nper.name",
        detail: "formula.functionList.RATE.functionParameter.nper.detail",
        example: "4*12",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.RATE.functionParameter.pmt.name",
        detail: "formula.functionList.RATE.functionParameter.pmt.detail",
        example: "-200",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.RATE.functionParameter.pv.name",
        detail: "formula.functionList.RATE.functionParameter.pv.detail",
        example: "8000",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.RATE.functionParameter.fv.name",
        detail: "formula.functionList.RATE.functionParameter.fv.detail",
        example: "0",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.RATE.functionParameter.type.name",
        detail: "formula.functionList.RATE.functionParameter.type.detail",
        example: "0",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.RATE.functionParameter.guess.name",
        detail: "formula.functionList.RATE.functionParameter.guess.detail",
        example: "0.1",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.RECEIVED,
    functionType: Kc2.Financial,
    description: "formula.functionList.RECEIVED.description",
    abstract: "formula.functionList.RECEIVED.abstract",
    functionParameter: [
      {
        name: "formula.functionList.RECEIVED.functionParameter.settlement.name",
        detail: "formula.functionList.RECEIVED.functionParameter.settlement.detail",
        example: '"2008-2-15"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.RECEIVED.functionParameter.maturity.name",
        detail: "formula.functionList.RECEIVED.functionParameter.maturity.detail",
        example: '"2008-3-15"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.RECEIVED.functionParameter.investment.name",
        detail: "formula.functionList.RECEIVED.functionParameter.investment.detail",
        example: "10000000",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.RECEIVED.functionParameter.discount.name",
        detail: "formula.functionList.RECEIVED.functionParameter.discount.detail",
        example: "5.75%",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.RECEIVED.functionParameter.basis.name",
        detail: "formula.functionList.RECEIVED.functionParameter.basis.detail",
        example: "2",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.RRI,
    functionType: Kc2.Financial,
    description: "formula.functionList.RRI.description",
    abstract: "formula.functionList.RRI.abstract",
    functionParameter: [
      {
        name: "formula.functionList.RRI.functionParameter.nper.name",
        detail: "formula.functionList.RRI.functionParameter.nper.detail",
        example: "96",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.RRI.functionParameter.pv.name",
        detail: "formula.functionList.RRI.functionParameter.pv.detail",
        example: "10000",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.RRI.functionParameter.fv.name",
        detail: "formula.functionList.RRI.functionParameter.fv.detail",
        example: "11000",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.SLN,
    functionType: Kc2.Financial,
    description: "formula.functionList.SLN.description",
    abstract: "formula.functionList.SLN.abstract",
    functionParameter: [
      {
        name: "formula.functionList.SLN.functionParameter.cost.name",
        detail: "formula.functionList.SLN.functionParameter.cost.detail",
        example: "300000",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SLN.functionParameter.salvage.name",
        detail: "formula.functionList.SLN.functionParameter.salvage.detail",
        example: "75000",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SLN.functionParameter.life.name",
        detail: "formula.functionList.SLN.functionParameter.life.detail",
        example: "10",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.SYD,
    functionType: Kc2.Financial,
    description: "formula.functionList.SYD.description",
    abstract: "formula.functionList.SYD.abstract",
    functionParameter: [
      {
        name: "formula.functionList.SYD.functionParameter.cost.name",
        detail: "formula.functionList.SYD.functionParameter.cost.detail",
        example: "300000",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SYD.functionParameter.salvage.name",
        detail: "formula.functionList.SYD.functionParameter.salvage.detail",
        example: "75000",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SYD.functionParameter.life.name",
        detail: "formula.functionList.SYD.functionParameter.life.detail",
        example: "10",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SYD.functionParameter.per.name",
        detail: "formula.functionList.SYD.functionParameter.per.detail",
        example: "10",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.TBILLEQ,
    functionType: Kc2.Financial,
    description: "formula.functionList.TBILLEQ.description",
    abstract: "formula.functionList.TBILLEQ.abstract",
    functionParameter: [
      {
        name: "formula.functionList.TBILLEQ.functionParameter.settlement.name",
        detail: "formula.functionList.TBILLEQ.functionParameter.settlement.detail",
        example: '"2008-3-31"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.TBILLEQ.functionParameter.maturity.name",
        detail: "formula.functionList.TBILLEQ.functionParameter.maturity.detail",
        example: '"2008-6-1"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.TBILLEQ.functionParameter.discount.name",
        detail: "formula.functionList.TBILLEQ.functionParameter.discount.detail",
        example: "9.14%",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.TBILLPRICE,
    functionType: Kc2.Financial,
    description: "formula.functionList.TBILLPRICE.description",
    abstract: "formula.functionList.TBILLPRICE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.TBILLPRICE.functionParameter.settlement.name",
        detail: "formula.functionList.TBILLPRICE.functionParameter.settlement.detail",
        example: '"2008-3-31"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.TBILLPRICE.functionParameter.maturity.name",
        detail: "formula.functionList.TBILLPRICE.functionParameter.maturity.detail",
        example: '"2008-6-1"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.TBILLPRICE.functionParameter.discount.name",
        detail: "formula.functionList.TBILLPRICE.functionParameter.discount.detail",
        example: "9.14%",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.TBILLYIELD,
    functionType: Kc2.Financial,
    description: "formula.functionList.TBILLYIELD.description",
    abstract: "formula.functionList.TBILLYIELD.abstract",
    functionParameter: [
      {
        name: "formula.functionList.TBILLYIELD.functionParameter.settlement.name",
        detail: "formula.functionList.TBILLYIELD.functionParameter.settlement.detail",
        example: '"2008-3-31"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.TBILLYIELD.functionParameter.maturity.name",
        detail: "formula.functionList.TBILLYIELD.functionParameter.maturity.detail",
        example: '"2008-6-1"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.TBILLYIELD.functionParameter.pr.name",
        detail: "formula.functionList.TBILLYIELD.functionParameter.pr.detail",
        example: "98.45",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.VDB,
    functionType: Kc2.Financial,
    description: "formula.functionList.VDB.description",
    abstract: "formula.functionList.VDB.abstract",
    functionParameter: [
      {
        name: "formula.functionList.VDB.functionParameter.cost.name",
        detail: "formula.functionList.VDB.functionParameter.cost.detail",
        example: "2400",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.VDB.functionParameter.salvage.name",
        detail: "formula.functionList.VDB.functionParameter.salvage.detail",
        example: "300",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.VDB.functionParameter.life.name",
        detail: "formula.functionList.VDB.functionParameter.life.detail",
        example: "10",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.VDB.functionParameter.startPeriod.name",
        detail: "formula.functionList.VDB.functionParameter.startPeriod.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.VDB.functionParameter.endPeriod.name",
        detail: "formula.functionList.VDB.functionParameter.endPeriod.detail",
        example: "2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.VDB.functionParameter.factor.name",
        detail: "formula.functionList.VDB.functionParameter.factor.detail",
        example: "2",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.VDB.functionParameter.noSwitch.name",
        detail: "formula.functionList.VDB.functionParameter.noSwitch.detail",
        example: "false",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.XIRR,
    functionType: Kc2.Financial,
    description: "formula.functionList.XIRR.description",
    abstract: "formula.functionList.XIRR.abstract",
    functionParameter: [
      {
        name: "formula.functionList.XIRR.functionParameter.values.name",
        detail: "formula.functionList.XIRR.functionParameter.values.detail",
        example: "A1:A4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.XIRR.functionParameter.dates.name",
        detail: "formula.functionList.XIRR.functionParameter.dates.detail",
        example: "B1:B4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.XIRR.functionParameter.guess.name",
        detail: "formula.functionList.XIRR.functionParameter.guess.detail",
        example: "0.1",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.XNPV,
    functionType: Kc2.Financial,
    description: "formula.functionList.XNPV.description",
    abstract: "formula.functionList.XNPV.abstract",
    functionParameter: [
      {
        name: "formula.functionList.XNPV.functionParameter.rate.name",
        detail: "formula.functionList.XNPV.functionParameter.rate.detail",
        example: "10%",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.XNPV.functionParameter.values.name",
        detail: "formula.functionList.XNPV.functionParameter.values.detail",
        example: "A1:A4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.XNPV.functionParameter.dates.name",
        detail: "formula.functionList.XNPV.functionParameter.dates.detail",
        example: "B1:B4",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.YIELD,
    functionType: Kc2.Financial,
    description: "formula.functionList.YIELD.description",
    abstract: "formula.functionList.YIELD.abstract",
    functionParameter: [
      {
        name: "formula.functionList.YIELD.functionParameter.settlement.name",
        detail: "formula.functionList.YIELD.functionParameter.settlement.detail",
        example: '"2008-11-11"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.YIELD.functionParameter.maturity.name",
        detail: "formula.functionList.YIELD.functionParameter.maturity.detail",
        example: '"2021-3-1"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.YIELD.functionParameter.rate.name",
        detail: "formula.functionList.YIELD.functionParameter.rate.detail",
        example: "7.85%",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.YIELD.functionParameter.pr.name",
        detail: "formula.functionList.YIELD.functionParameter.pr.detail",
        example: "98.45",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.YIELD.functionParameter.redemption.name",
        detail: "formula.functionList.YIELD.functionParameter.redemption.detail",
        example: "100",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.YIELD.functionParameter.frequency.name",
        detail: "formula.functionList.YIELD.functionParameter.frequency.detail",
        example: "2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.YIELD.functionParameter.basis.name",
        detail: "formula.functionList.YIELD.functionParameter.basis.detail",
        example: "1",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.YIELDDISC,
    functionType: Kc2.Financial,
    description: "formula.functionList.YIELDDISC.description",
    abstract: "formula.functionList.YIELDDISC.abstract",
    functionParameter: [
      {
        name: "formula.functionList.YIELDDISC.functionParameter.settlement.name",
        detail: "formula.functionList.YIELDDISC.functionParameter.settlement.detail",
        example: '"2008-11-11"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.YIELDDISC.functionParameter.maturity.name",
        detail: "formula.functionList.YIELDDISC.functionParameter.maturity.detail",
        example: '"2021-3-1"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.YIELDDISC.functionParameter.pr.name",
        detail: "formula.functionList.YIELDDISC.functionParameter.pr.detail",
        example: "98.45",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.YIELDDISC.functionParameter.redemption.name",
        detail: "formula.functionList.YIELDDISC.functionParameter.redemption.detail",
        example: "100",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.YIELDDISC.functionParameter.basis.name",
        detail: "formula.functionList.YIELDDISC.functionParameter.basis.detail",
        example: "1",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: ee.YIELDMAT,
    functionType: Kc2.Financial,
    description: "formula.functionList.YIELDMAT.description",
    abstract: "formula.functionList.YIELDMAT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.YIELDMAT.functionParameter.settlement.name",
        detail: "formula.functionList.YIELDMAT.functionParameter.settlement.detail",
        example: '"2008-11-11"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.YIELDMAT.functionParameter.maturity.name",
        detail: "formula.functionList.YIELDMAT.functionParameter.maturity.detail",
        example: '"2021-3-1"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.YIELDMAT.functionParameter.issue.name",
        detail: "formula.functionList.YIELDMAT.functionParameter.issue.detail",
        example: '"2008-10-15"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.YIELDMAT.functionParameter.rate.name",
        detail: "formula.functionList.YIELDMAT.functionParameter.rate.detail",
        example: "7.85%",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.YIELDMAT.functionParameter.pr.name",
        detail: "formula.functionList.YIELDMAT.functionParameter.pr.detail",
        example: "98.45",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.YIELDMAT.functionParameter.basis.name",
        detail: "formula.functionList.YIELDMAT.functionParameter.basis.detail",
        example: "1",
        require: 0,
        repeat: 0
      }
    ]
  }
];
var yr3 = [
  {
    functionName: Ve3.CELL,
    functionType: Kc2.Information,
    description: "formula.functionList.CELL.description",
    abstract: "formula.functionList.CELL.abstract",
    functionParameter: [
      {
        name: "formula.functionList.CELL.functionParameter.infoType.name",
        detail: "formula.functionList.CELL.functionParameter.infoType.detail",
        example: '"type"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CELL.functionParameter.reference.name",
        detail: "formula.functionList.CELL.functionParameter.reference.detail",
        example: "A1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ve3.ERROR_TYPE,
    functionType: Kc2.Information,
    description: "formula.functionList.ERROR_TYPE.description",
    abstract: "formula.functionList.ERROR_TYPE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ERROR_TYPE.functionParameter.errorVal.name",
        detail: "formula.functionList.ERROR_TYPE.functionParameter.errorVal.detail",
        example: '"#NULL!"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ve3.INFO,
    functionType: Kc2.Information,
    description: "formula.functionList.INFO.description",
    abstract: "formula.functionList.INFO.abstract",
    functionParameter: [
      {
        name: "formula.functionList.INFO.functionParameter.number1.name",
        detail: "formula.functionList.INFO.functionParameter.number1.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.INFO.functionParameter.number2.name",
        detail: "formula.functionList.INFO.functionParameter.number2.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ve3.ISBETWEEN,
    functionType: Kc2.Information,
    description: "formula.functionList.ISBETWEEN.description",
    abstract: "formula.functionList.ISBETWEEN.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ISBETWEEN.functionParameter.valueToCompare.name",
        detail: "formula.functionList.ISBETWEEN.functionParameter.valueToCompare.detail",
        example: "7.9",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ISBETWEEN.functionParameter.lowerValue.name",
        detail: "formula.functionList.ISBETWEEN.functionParameter.lowerValue.detail",
        example: "1.2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ISBETWEEN.functionParameter.upperValue.name",
        detail: "formula.functionList.ISBETWEEN.functionParameter.upperValue.detail",
        example: "12.45",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ISBETWEEN.functionParameter.lowerValueIsInclusive.name",
        detail: "formula.functionList.ISBETWEEN.functionParameter.lowerValueIsInclusive.detail",
        example: "true",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.ISBETWEEN.functionParameter.upperValueIsInclusive.name",
        detail: "formula.functionList.ISBETWEEN.functionParameter.upperValueIsInclusive.detail",
        example: "true",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ve3.ISBLANK,
    functionType: Kc2.Information,
    description: "formula.functionList.ISBLANK.description",
    abstract: "formula.functionList.ISBLANK.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ISBLANK.functionParameter.value.name",
        detail: "formula.functionList.ISBLANK.functionParameter.value.detail",
        example: "A1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ve3.ISDATE,
    functionType: Kc2.Information,
    description: "formula.functionList.ISDATE.description",
    abstract: "formula.functionList.ISDATE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ISDATE.functionParameter.value.name",
        detail: "formula.functionList.ISDATE.functionParameter.value.detail",
        example: "A1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ve3.ISEMAIL,
    functionType: Kc2.Information,
    description: "formula.functionList.ISEMAIL.description",
    abstract: "formula.functionList.ISEMAIL.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ISEMAIL.functionParameter.value.name",
        detail: "formula.functionList.ISEMAIL.functionParameter.value.detail",
        example: '"developer@univer.ai"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ve3.ISERR,
    functionType: Kc2.Information,
    description: "formula.functionList.ISERR.description",
    abstract: "formula.functionList.ISERR.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ISERR.functionParameter.value.name",
        detail: "formula.functionList.ISERR.functionParameter.value.detail",
        example: "A1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ve3.ISERROR,
    functionType: Kc2.Information,
    description: "formula.functionList.ISERROR.description",
    abstract: "formula.functionList.ISERROR.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ISERROR.functionParameter.value.name",
        detail: "formula.functionList.ISERROR.functionParameter.value.detail",
        example: "A1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ve3.ISEVEN,
    functionType: Kc2.Information,
    description: "formula.functionList.ISEVEN.description",
    abstract: "formula.functionList.ISEVEN.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ISEVEN.functionParameter.value.name",
        detail: "formula.functionList.ISEVEN.functionParameter.value.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ve3.ISFORMULA,
    functionType: Kc2.Information,
    description: "formula.functionList.ISFORMULA.description",
    abstract: "formula.functionList.ISFORMULA.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ISFORMULA.functionParameter.reference.name",
        detail: "formula.functionList.ISFORMULA.functionParameter.reference.detail",
        example: "A1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ve3.ISLOGICAL,
    functionType: Kc2.Information,
    description: "formula.functionList.ISLOGICAL.description",
    abstract: "formula.functionList.ISLOGICAL.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ISLOGICAL.functionParameter.value.name",
        detail: "formula.functionList.ISLOGICAL.functionParameter.value.detail",
        example: "A1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ve3.ISNA,
    functionType: Kc2.Information,
    description: "formula.functionList.ISNA.description",
    abstract: "formula.functionList.ISNA.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ISNA.functionParameter.value.name",
        detail: "formula.functionList.ISNA.functionParameter.value.detail",
        example: "A1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ve3.ISNONTEXT,
    functionType: Kc2.Information,
    description: "formula.functionList.ISNONTEXT.description",
    abstract: "formula.functionList.ISNONTEXT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ISNONTEXT.functionParameter.value.name",
        detail: "formula.functionList.ISNONTEXT.functionParameter.value.detail",
        example: "A1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ve3.ISNUMBER,
    functionType: Kc2.Information,
    description: "formula.functionList.ISNUMBER.description",
    abstract: "formula.functionList.ISNUMBER.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ISNUMBER.functionParameter.value.name",
        detail: "formula.functionList.ISNUMBER.functionParameter.value.detail",
        example: "A1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ve3.ISODD,
    functionType: Kc2.Information,
    description: "formula.functionList.ISODD.description",
    abstract: "formula.functionList.ISODD.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ISODD.functionParameter.value.name",
        detail: "formula.functionList.ISODD.functionParameter.value.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ve3.ISOMITTED,
    functionType: Kc2.Information,
    description: "formula.functionList.ISOMITTED.description",
    abstract: "formula.functionList.ISOMITTED.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ISOMITTED.functionParameter.number1.name",
        detail: "formula.functionList.ISOMITTED.functionParameter.number1.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ISOMITTED.functionParameter.number2.name",
        detail: "formula.functionList.ISOMITTED.functionParameter.number2.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ve3.ISREF,
    functionType: Kc2.Information,
    description: "formula.functionList.ISREF.description",
    abstract: "formula.functionList.ISREF.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ISREF.functionParameter.value.name",
        detail: "formula.functionList.ISREF.functionParameter.value.detail",
        example: "A1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ve3.ISTEXT,
    functionType: Kc2.Information,
    description: "formula.functionList.ISTEXT.description",
    abstract: "formula.functionList.ISTEXT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ISTEXT.functionParameter.value.name",
        detail: "formula.functionList.ISTEXT.functionParameter.value.detail",
        example: "A1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ve3.ISURL,
    functionType: Kc2.Information,
    description: "formula.functionList.ISURL.description",
    abstract: "formula.functionList.ISURL.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ISURL.functionParameter.value.name",
        detail: "formula.functionList.ISURL.functionParameter.value.detail",
        example: '"univer.ai"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ve3.N,
    functionType: Kc2.Information,
    description: "formula.functionList.N.description",
    abstract: "formula.functionList.N.abstract",
    functionParameter: [
      {
        name: "formula.functionList.N.functionParameter.value.name",
        detail: "formula.functionList.N.functionParameter.value.detail",
        example: "7",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ve3.NA,
    functionType: Kc2.Information,
    description: "formula.functionList.NA.description",
    abstract: "formula.functionList.NA.abstract",
    functionParameter: []
  },
  {
    functionName: Ve3.SHEET,
    functionType: Kc2.Information,
    description: "formula.functionList.SHEET.description",
    abstract: "formula.functionList.SHEET.abstract",
    functionParameter: [
      {
        name: "formula.functionList.SHEET.functionParameter.value.name",
        detail: "formula.functionList.SHEET.functionParameter.value.detail",
        example: "A1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ve3.SHEETS,
    functionType: Kc2.Information,
    description: "formula.functionList.SHEETS.description",
    abstract: "formula.functionList.SHEETS.abstract",
    functionParameter: []
  },
  {
    functionName: Ve3.TYPE,
    functionType: Kc2.Information,
    description: "formula.functionList.TYPE.description",
    abstract: "formula.functionList.TYPE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.TYPE.functionParameter.value.name",
        detail: "formula.functionList.TYPE.functionParameter.value.detail",
        example: "A2",
        require: 1,
        repeat: 0
      }
    ]
  }
];
var gr4 = [
  {
    functionName: Ee3.AND,
    functionType: Kc2.Logical,
    description: "formula.functionList.AND.description",
    abstract: "formula.functionList.AND.abstract",
    functionParameter: [
      {
        name: "formula.functionList.AND.functionParameter.logical1.name",
        detail: "formula.functionList.AND.functionParameter.logical1.detail",
        example: "A1=1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.AND.functionParameter.logical2.name",
        detail: "formula.functionList.AND.functionParameter.logical2.detail",
        example: "A2=2",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: Ee3.BYCOL,
    functionType: Kc2.Logical,
    description: "formula.functionList.BYCOL.description",
    abstract: "formula.functionList.BYCOL.abstract",
    functionParameter: [
      {
        name: "formula.functionList.BYCOL.functionParameter.array.name",
        detail: "formula.functionList.BYCOL.functionParameter.array.detail",
        example: "A1:C2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.BYCOL.functionParameter.lambda.name",
        detail: "formula.functionList.BYCOL.functionParameter.lambda.detail",
        example: "LAMBDA(array, MAX(array))",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ee3.BYROW,
    functionType: Kc2.Logical,
    description: "formula.functionList.BYROW.description",
    abstract: "formula.functionList.BYROW.abstract",
    functionParameter: [
      {
        name: "formula.functionList.BYROW.functionParameter.array.name",
        detail: "formula.functionList.BYROW.functionParameter.array.detail",
        example: "A1:C2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.BYROW.functionParameter.lambda.name",
        detail: "formula.functionList.BYROW.functionParameter.lambda.detail",
        example: "LAMBDA(array, MAX(array))",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ee3.FALSE,
    functionType: Kc2.Logical,
    description: "formula.functionList.FALSE.description",
    abstract: "formula.functionList.FALSE.abstract",
    functionParameter: []
  },
  {
    functionName: Ee3.IF,
    functionType: Kc2.Logical,
    description: "formula.functionList.IF.description",
    abstract: "formula.functionList.IF.abstract",
    functionParameter: [
      {
        name: "formula.functionList.IF.functionParameter.logicalTest.name",
        detail: "formula.functionList.IF.functionParameter.logicalTest.detail",
        example: 'A2 = "foo"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.IF.functionParameter.valueIfTrue.name",
        detail: "formula.functionList.IF.functionParameter.valueIfTrue.detail",
        example: '"A2 is foo"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.IF.functionParameter.valueIfFalse.name",
        detail: "formula.functionList.IF.functionParameter.valueIfFalse.detail",
        example: '"A2 is not foo"',
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ee3.IFERROR,
    functionType: Kc2.Logical,
    description: "formula.functionList.IFERROR.description",
    abstract: "formula.functionList.IFERROR.abstract",
    functionParameter: [
      {
        name: "formula.functionList.IFERROR.functionParameter.value.name",
        detail: "formula.functionList.IFERROR.functionParameter.value.detail",
        example: "A2/B2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.IFERROR.functionParameter.valueIfError.name",
        detail: "formula.functionList.IFERROR.functionParameter.valueIfError.detail",
        example: '"Error in calculation"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ee3.IFNA,
    functionType: Kc2.Logical,
    description: "formula.functionList.IFNA.description",
    abstract: "formula.functionList.IFNA.abstract",
    functionParameter: [
      {
        name: "formula.functionList.IFNA.functionParameter.value.name",
        detail: "formula.functionList.IFNA.functionParameter.value.detail",
        example: "VLOOKUP(C3,C6:D11,2,FALSE)",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.IFNA.functionParameter.valueIfNa.name",
        detail: "formula.functionList.IFNA.functionParameter.valueIfNa.detail",
        example: '"Not Found"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ee3.IFS,
    functionType: Kc2.Logical,
    description: "formula.functionList.IFS.description",
    abstract: "formula.functionList.IFS.abstract",
    functionParameter: [
      {
        name: "formula.functionList.IFS.functionParameter.logicalTest1.name",
        detail: "formula.functionList.IFS.functionParameter.logicalTest1.detail",
        example: 'A2 = "foo"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.IFS.functionParameter.valueIfTrue1.name",
        detail: "formula.functionList.IFS.functionParameter.valueIfTrue1.detail",
        example: '"A2 is foo"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.IFS.functionParameter.logicalTest2.name",
        detail: "formula.functionList.IFS.functionParameter.logicalTest2.detail",
        example: "F2=1",
        require: 0,
        repeat: 1
      },
      {
        name: "formula.functionList.IFS.functionParameter.valueIfTrue2.name",
        detail: "formula.functionList.IFS.functionParameter.valueIfTrue2.detail",
        example: "D2",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: Ee3.LAMBDA,
    functionType: Kc2.Logical,
    description: "formula.functionList.LAMBDA.description",
    abstract: "formula.functionList.LAMBDA.abstract",
    functionParameter: [
      {
        name: "formula.functionList.LAMBDA.functionParameter.parameter.name",
        detail: "formula.functionList.LAMBDA.functionParameter.parameter.detail",
        example: "[x, y, â€¦,]",
        require: 0,
        repeat: 1
      },
      {
        name: "formula.functionList.LAMBDA.functionParameter.calculation.name",
        detail: "formula.functionList.LAMBDA.functionParameter.calculation.detail",
        example: "x+y",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ee3.LET,
    functionType: Kc2.Logical,
    description: "formula.functionList.LET.description",
    abstract: "formula.functionList.LET.abstract",
    functionParameter: [
      {
        name: "formula.functionList.LET.functionParameter.name1.name",
        detail: "formula.functionList.LET.functionParameter.name1.detail",
        example: "x",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.LET.functionParameter.nameValue1.name",
        detail: "formula.functionList.LET.functionParameter.nameValue1.detail",
        example: "5",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.LET.functionParameter.calculationOrName2.name",
        detail: "formula.functionList.LET.functionParameter.calculationOrName2.detail",
        example: "y",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.LET.functionParameter.nameValue2.name",
        detail: "formula.functionList.LET.functionParameter.nameValue2.detail",
        example: "6",
        require: 0,
        repeat: 1
      },
      {
        name: "formula.functionList.LET.functionParameter.calculationOrName3.name",
        detail: "formula.functionList.LET.functionParameter.calculationOrName3.detail",
        example: "SUM(x,y)",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: Ee3.MAKEARRAY,
    aliasFunctionName: "formula.functionList.MAKEARRAY.aliasFunctionName",
    functionType: Kc2.Logical,
    description: "formula.functionList.MAKEARRAY.description",
    abstract: "formula.functionList.MAKEARRAY.abstract",
    functionParameter: [
      {
        name: "formula.functionList.MAKEARRAY.functionParameter.number1.name",
        detail: "formula.functionList.MAKEARRAY.functionParameter.number1.detail",
        example: "8",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.MAKEARRAY.functionParameter.number2.name",
        detail: "formula.functionList.MAKEARRAY.functionParameter.number2.detail",
        example: "7",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.MAKEARRAY.functionParameter.value3.name",
        detail: "formula.functionList.MAKEARRAY.functionParameter.value3.detail",
        example: "LAMBDA(r,c, r*c)",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ee3.MAP,
    functionType: Kc2.Logical,
    description: "formula.functionList.MAP.description",
    abstract: "formula.functionList.MAP.abstract",
    functionParameter: [
      {
        name: "formula.functionList.MAP.functionParameter.array1.name",
        detail: "formula.functionList.MAP.functionParameter.array1.detail",
        example: "D2:D11",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.MAP.functionParameter.array2.name",
        detail: "formula.functionList.MAP.functionParameter.array2.detail",
        example: "E2:E11",
        require: 0,
        repeat: 1
      },
      {
        name: "formula.functionList.MAP.functionParameter.lambda.name",
        detail: "formula.functionList.MAP.functionParameter.lambda.detail",
        example: 'LAMBDA(s,c,AND(s="Large",c="Red"))',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ee3.NOT,
    functionType: Kc2.Logical,
    description: "formula.functionList.NOT.description",
    abstract: "formula.functionList.NOT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.NOT.functionParameter.logical.name",
        detail: "formula.functionList.NOT.functionParameter.logical.detail",
        example: "A2>100",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ee3.OR,
    functionType: Kc2.Logical,
    description: "formula.functionList.OR.description",
    abstract: "formula.functionList.OR.abstract",
    functionParameter: [
      {
        name: "formula.functionList.OR.functionParameter.logical1.name",
        detail: "formula.functionList.OR.functionParameter.logical1.detail",
        example: "A1=1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.OR.functionParameter.logical2.name",
        detail: "formula.functionList.OR.functionParameter.logical2.detail",
        example: "A2=2",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: Ee3.REDUCE,
    functionType: Kc2.Logical,
    description: "formula.functionList.REDUCE.description",
    abstract: "formula.functionList.REDUCE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.REDUCE.functionParameter.initialValue.name",
        detail: "formula.functionList.REDUCE.functionParameter.initialValue.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.REDUCE.functionParameter.array.name",
        detail: "formula.functionList.REDUCE.functionParameter.array.detail",
        example: "A1:C2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.REDUCE.functionParameter.lambda.name",
        detail: "formula.functionList.REDUCE.functionParameter.lambda.detail",
        example: "LAMBDA(a,b,a+b^2)",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ee3.SCAN,
    functionType: Kc2.Logical,
    description: "formula.functionList.SCAN.description",
    abstract: "formula.functionList.SCAN.abstract",
    functionParameter: [
      {
        name: "formula.functionList.SCAN.functionParameter.initialValue.name",
        detail: "formula.functionList.SCAN.functionParameter.initialValue.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SCAN.functionParameter.array.name",
        detail: "formula.functionList.SCAN.functionParameter.array.detail",
        example: "A1:C2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SCAN.functionParameter.lambda.name",
        detail: "formula.functionList.SCAN.functionParameter.lambda.detail",
        example: "LAMBDA(a,b,a+b^2)",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: Ee3.SWITCH,
    functionType: Kc2.Logical,
    description: "formula.functionList.SWITCH.description",
    abstract: "formula.functionList.SWITCH.abstract",
    functionParameter: [
      {
        name: "formula.functionList.SWITCH.functionParameter.expression.name",
        detail: "formula.functionList.SWITCH.functionParameter.expression.detail",
        example: "WEEKDAY(A2)",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SWITCH.functionParameter.value1.name",
        detail: "formula.functionList.SWITCH.functionParameter.value1.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SWITCH.functionParameter.result1.name",
        detail: "formula.functionList.SWITCH.functionParameter.result1.detail",
        example: '"Sunday"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SWITCH.functionParameter.defaultOrValue2.name",
        detail: "formula.functionList.SWITCH.functionParameter.defaultOrValue2.detail",
        example: "2",
        require: 0,
        repeat: 1
      },
      {
        name: "formula.functionList.SWITCH.functionParameter.result2.name",
        detail: "formula.functionList.SWITCH.functionParameter.result2.detail",
        example: '"Monday"',
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: Ee3.TRUE,
    functionType: Kc2.Logical,
    description: "formula.functionList.TRUE.description",
    abstract: "formula.functionList.TRUE.abstract",
    functionParameter: []
  },
  {
    functionName: Ee3.XOR,
    functionType: Kc2.Logical,
    description: "formula.functionList.XOR.description",
    abstract: "formula.functionList.XOR.abstract",
    functionParameter: [
      {
        name: "formula.functionList.XOR.functionParameter.logical1.name",
        detail: "formula.functionList.XOR.functionParameter.logical1.detail",
        example: "3>0",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.XOR.functionParameter.logical2.name",
        detail: "formula.functionList.XOR.functionParameter.logical2.detail",
        example: "2<9",
        require: 0,
        repeat: 1
      }
    ]
  }
];
var hr3 = [
  {
    functionName: re3.ADDRESS,
    functionType: Kc2.Lookup,
    description: "formula.functionList.ADDRESS.description",
    abstract: "formula.functionList.ADDRESS.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ADDRESS.functionParameter.row_num.name",
        detail: "formula.functionList.ADDRESS.functionParameter.row_num.detail",
        example: "2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ADDRESS.functionParameter.column_num.name",
        detail: "formula.functionList.ADDRESS.functionParameter.column_num.detail",
        example: "2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ADDRESS.functionParameter.abs_num.name",
        detail: "formula.functionList.ADDRESS.functionParameter.abs_num.detail",
        example: "1",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.ADDRESS.functionParameter.a1.name",
        detail: "formula.functionList.ADDRESS.functionParameter.a1.detail",
        example: "TRUE",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.ADDRESS.functionParameter.sheet_text.name",
        detail: "formula.functionList.ADDRESS.functionParameter.sheet_text.detail",
        example: '"Sheet2"',
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: re3.AREAS,
    functionType: Kc2.Lookup,
    description: "formula.functionList.AREAS.description",
    abstract: "formula.functionList.AREAS.abstract",
    functionParameter: [
      {
        name: "formula.functionList.AREAS.functionParameter.reference.name",
        detail: "formula.functionList.AREAS.functionParameter.reference.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: re3.CHOOSE,
    functionType: Kc2.Lookup,
    description: "formula.functionList.CHOOSE.description",
    abstract: "formula.functionList.CHOOSE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.CHOOSE.functionParameter.indexNum.name",
        detail: "formula.functionList.CHOOSE.functionParameter.indexNum.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CHOOSE.functionParameter.value1.name",
        detail: "formula.functionList.CHOOSE.functionParameter.value1.detail",
        example: '"Hello"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CHOOSE.functionParameter.value2.name",
        detail: "formula.functionList.CHOOSE.functionParameter.value2.detail",
        example: '"Univer"',
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: re3.CHOOSECOLS,
    functionType: Kc2.Lookup,
    description: "formula.functionList.CHOOSECOLS.description",
    abstract: "formula.functionList.CHOOSECOLS.abstract",
    functionParameter: [
      {
        name: "formula.functionList.CHOOSECOLS.functionParameter.array.name",
        detail: "formula.functionList.CHOOSECOLS.functionParameter.array.detail",
        example: "A1:C2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CHOOSECOLS.functionParameter.colNum1.name",
        detail: "formula.functionList.CHOOSECOLS.functionParameter.colNum1.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CHOOSECOLS.functionParameter.colNum2.name",
        detail: "formula.functionList.CHOOSECOLS.functionParameter.colNum2.detail",
        example: "2",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: re3.CHOOSEROWS,
    functionType: Kc2.Lookup,
    description: "formula.functionList.CHOOSEROWS.description",
    abstract: "formula.functionList.CHOOSEROWS.abstract",
    functionParameter: [
      {
        name: "formula.functionList.CHOOSEROWS.functionParameter.array.name",
        detail: "formula.functionList.CHOOSEROWS.functionParameter.array.detail",
        example: "A1:C2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CHOOSEROWS.functionParameter.rowNum1.name",
        detail: "formula.functionList.CHOOSEROWS.functionParameter.rowNum1.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CHOOSEROWS.functionParameter.rowNum2.name",
        detail: "formula.functionList.CHOOSEROWS.functionParameter.rowNum2.detail",
        example: "2",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: re3.COLUMN,
    functionType: Kc2.Lookup,
    description: "formula.functionList.COLUMN.description",
    abstract: "formula.functionList.COLUMN.abstract",
    functionParameter: [
      {
        name: "formula.functionList.COLUMN.functionParameter.reference.name",
        detail: "formula.functionList.COLUMN.functionParameter.reference.detail",
        example: "A1:A20",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: re3.COLUMNS,
    functionType: Kc2.Lookup,
    description: "formula.functionList.COLUMNS.description",
    abstract: "formula.functionList.COLUMNS.abstract",
    functionParameter: [
      {
        name: "formula.functionList.COLUMNS.functionParameter.array.name",
        detail: "formula.functionList.COLUMNS.functionParameter.array.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: re3.DROP,
    functionType: Kc2.Lookup,
    description: "formula.functionList.DROP.description",
    abstract: "formula.functionList.DROP.abstract",
    functionParameter: [
      {
        name: "formula.functionList.DROP.functionParameter.array.name",
        detail: "formula.functionList.DROP.functionParameter.array.detail",
        example: "A2:C4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DROP.functionParameter.rows.name",
        detail: "formula.functionList.DROP.functionParameter.rows.detail",
        example: "2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DROP.functionParameter.columns.name",
        detail: "formula.functionList.DROP.functionParameter.columns.detail",
        example: "2",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: re3.EXPAND,
    functionType: Kc2.Lookup,
    description: "formula.functionList.EXPAND.description",
    abstract: "formula.functionList.EXPAND.abstract",
    functionParameter: [
      {
        name: "formula.functionList.EXPAND.functionParameter.array.name",
        detail: "formula.functionList.EXPAND.functionParameter.array.detail",
        example: "A2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.EXPAND.functionParameter.rows.name",
        detail: "formula.functionList.EXPAND.functionParameter.rows.detail",
        example: "3",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.EXPAND.functionParameter.columns.name",
        detail: "formula.functionList.EXPAND.functionParameter.columns.detail",
        example: "3",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.EXPAND.functionParameter.padWith.name",
        detail: "formula.functionList.EXPAND.functionParameter.padWith.detail",
        example: '"-"',
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: re3.FILTER,
    functionType: Kc2.Lookup,
    description: "formula.functionList.FILTER.description",
    abstract: "formula.functionList.FILTER.abstract",
    functionParameter: [
      {
        name: "formula.functionList.FILTER.functionParameter.array.name",
        detail: "formula.functionList.FILTER.functionParameter.array.detail",
        example: "A5:D20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.FILTER.functionParameter.include.name",
        detail: "formula.functionList.FILTER.functionParameter.include.detail",
        example: '(C5:C20="Apple")*(A5:A20="East")',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.FILTER.functionParameter.ifEmpty.name",
        detail: "formula.functionList.FILTER.functionParameter.ifEmpty.detail",
        example: '""',
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: re3.FORMULATEXT,
    functionType: Kc2.Lookup,
    description: "formula.functionList.FORMULATEXT.description",
    abstract: "formula.functionList.FORMULATEXT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.FORMULATEXT.functionParameter.reference.name",
        detail: "formula.functionList.FORMULATEXT.functionParameter.reference.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: re3.GETPIVOTDATA,
    functionType: Kc2.Lookup,
    description: "formula.functionList.GETPIVOTDATA.description",
    abstract: "formula.functionList.GETPIVOTDATA.abstract",
    functionParameter: [
      {
        name: "formula.functionList.GETPIVOTDATA.functionParameter.number1.name",
        detail: "formula.functionList.GETPIVOTDATA.functionParameter.number1.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.GETPIVOTDATA.functionParameter.number2.name",
        detail: "formula.functionList.GETPIVOTDATA.functionParameter.number2.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: re3.HLOOKUP,
    functionType: Kc2.Lookup,
    description: "formula.functionList.HLOOKUP.description",
    abstract: "formula.functionList.HLOOKUP.abstract",
    functionParameter: [
      {
        name: "formula.functionList.HLOOKUP.functionParameter.lookupValue.name",
        detail: "formula.functionList.HLOOKUP.functionParameter.lookupValue.detail",
        example: "A1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.HLOOKUP.functionParameter.tableArray.name",
        detail: "formula.functionList.HLOOKUP.functionParameter.tableArray.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.HLOOKUP.functionParameter.rowIndexNum.name",
        detail: "formula.functionList.HLOOKUP.functionParameter.rowIndexNum.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.HLOOKUP.functionParameter.rangeLookup.name",
        detail: "formula.functionList.HLOOKUP.functionParameter.rangeLookup.detail",
        example: "false",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: re3.HSTACK,
    functionType: Kc2.Lookup,
    description: "formula.functionList.HSTACK.description",
    abstract: "formula.functionList.HSTACK.abstract",
    functionParameter: [
      {
        name: "formula.functionList.HSTACK.functionParameter.array1.name",
        detail: "formula.functionList.HSTACK.functionParameter.array1.detail",
        example: "A2:C3",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.HSTACK.functionParameter.array2.name",
        detail: "formula.functionList.HSTACK.functionParameter.array2.detail",
        example: "E2:G3",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: re3.HYPERLINK,
    functionType: Kc2.Lookup,
    description: "formula.functionList.HYPERLINK.description",
    abstract: "formula.functionList.HYPERLINK.abstract",
    functionParameter: [
      {
        name: "formula.functionList.HYPERLINK.functionParameter.url.name",
        detail: "formula.functionList.HYPERLINK.functionParameter.url.detail",
        example: '"https://univer.ai/"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.HYPERLINK.functionParameter.linkLabel.name",
        detail: "formula.functionList.HYPERLINK.functionParameter.linkLabel.detail",
        example: '"Univer"',
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: re3.IMAGE,
    functionType: Kc2.Lookup,
    description: "formula.functionList.IMAGE.description",
    abstract: "formula.functionList.IMAGE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.IMAGE.functionParameter.source.name",
        detail: "formula.functionList.IMAGE.functionParameter.source.detail",
        example: '"https://github.com/dream-num.png"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.IMAGE.functionParameter.altText.name",
        detail: "formula.functionList.IMAGE.functionParameter.altText.detail",
        example: '"Univer Logo"',
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.IMAGE.functionParameter.sizing.name",
        detail: "formula.functionList.IMAGE.functionParameter.sizing.detail",
        example: "3",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.IMAGE.functionParameter.height.name",
        detail: "formula.functionList.IMAGE.functionParameter.height.detail",
        example: "100",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.IMAGE.functionParameter.width.name",
        detail: "formula.functionList.IMAGE.functionParameter.width.detail",
        example: "100",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: re3.INDEX,
    functionType: Kc2.Lookup,
    description: "formula.functionList.INDEX.description",
    abstract: "formula.functionList.INDEX.abstract",
    functionParameter: [
      {
        name: "formula.functionList.INDEX.functionParameter.reference.name",
        detail: "formula.functionList.INDEX.functionParameter.reference.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.INDEX.functionParameter.rowNum.name",
        detail: "formula.functionList.INDEX.functionParameter.rowNum.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.INDEX.functionParameter.columnNum.name",
        detail: "formula.functionList.INDEX.functionParameter.columnNum.detail",
        example: "1",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.INDEX.functionParameter.areaNum.name",
        detail: "formula.functionList.INDEX.functionParameter.areaNum.detail",
        example: "2",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: re3.INDIRECT,
    functionType: Kc2.Lookup,
    description: "formula.functionList.INDIRECT.description",
    abstract: "formula.functionList.INDIRECT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.INDIRECT.functionParameter.refText.name",
        detail: "formula.functionList.INDIRECT.functionParameter.refText.detail",
        example: '"A1"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.INDIRECT.functionParameter.a1.name",
        detail: "formula.functionList.INDIRECT.functionParameter.a1.detail",
        example: "TRUE",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: re3.LOOKUP,
    functionType: Kc2.Lookup,
    description: "formula.functionList.LOOKUP.description",
    abstract: "formula.functionList.LOOKUP.abstract",
    functionParameter: [
      {
        name: "formula.functionList.LOOKUP.functionParameter.lookupValue.name",
        detail: "formula.functionList.LOOKUP.functionParameter.lookupValue.detail",
        example: "A1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.LOOKUP.functionParameter.lookupVectorOrArray.name",
        detail: "formula.functionList.LOOKUP.functionParameter.lookupVectorOrArray.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.LOOKUP.functionParameter.resultVector.name",
        detail: "formula.functionList.LOOKUP.functionParameter.resultVector.detail",
        example: "A1:A20",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: re3.MATCH,
    functionType: Kc2.Lookup,
    description: "formula.functionList.MATCH.description",
    abstract: "formula.functionList.MATCH.abstract",
    functionParameter: [
      {
        name: "formula.functionList.MATCH.functionParameter.lookupValue.name",
        detail: "formula.functionList.MATCH.functionParameter.lookupValue.detail",
        example: "10",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.MATCH.functionParameter.lookupArray.name",
        detail: "formula.functionList.MATCH.functionParameter.lookupArray.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.MATCH.functionParameter.matchType.name",
        detail: "formula.functionList.MATCH.functionParameter.matchType.detail",
        example: "1",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: re3.OFFSET,
    functionType: Kc2.Lookup,
    description: "formula.functionList.OFFSET.description",
    abstract: "formula.functionList.OFFSET.abstract",
    functionParameter: [
      {
        name: "formula.functionList.OFFSET.functionParameter.reference.name",
        detail: "formula.functionList.OFFSET.functionParameter.reference.detail",
        example: "A1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.OFFSET.functionParameter.rows.name",
        detail: "formula.functionList.OFFSET.functionParameter.rows.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.OFFSET.functionParameter.cols.name",
        detail: "formula.functionList.OFFSET.functionParameter.cols.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.OFFSET.functionParameter.height.name",
        detail: "formula.functionList.OFFSET.functionParameter.height.detail",
        example: "1",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.OFFSET.functionParameter.width.name",
        detail: "formula.functionList.OFFSET.functionParameter.width.detail",
        example: "1",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: re3.ROW,
    functionType: Kc2.Lookup,
    description: "formula.functionList.ROW.description",
    abstract: "formula.functionList.ROW.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ROW.functionParameter.reference.name",
        detail: "formula.functionList.ROW.functionParameter.reference.detail",
        example: "A1",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: re3.ROWS,
    functionType: Kc2.Lookup,
    description: "formula.functionList.ROWS.description",
    abstract: "formula.functionList.ROWS.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ROWS.functionParameter.array.name",
        detail: "formula.functionList.ROWS.functionParameter.array.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: re3.RTD,
    functionType: Kc2.Lookup,
    description: "formula.functionList.RTD.description",
    abstract: "formula.functionList.RTD.abstract",
    functionParameter: [
      {
        name: "formula.functionList.RTD.functionParameter.number1.name",
        detail: "formula.functionList.RTD.functionParameter.number1.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.RTD.functionParameter.number2.name",
        detail: "formula.functionList.RTD.functionParameter.number2.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: re3.SORT,
    functionType: Kc2.Lookup,
    description: "formula.functionList.SORT.description",
    abstract: "formula.functionList.SORT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.SORT.functionParameter.array.name",
        detail: "formula.functionList.SORT.functionParameter.array.detail",
        example: "A2:A17",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SORT.functionParameter.sortIndex.name",
        detail: "formula.functionList.SORT.functionParameter.sortIndex.detail",
        example: "1",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.SORT.functionParameter.sortOrder.name",
        detail: "formula.functionList.SORT.functionParameter.sortOrder.detail",
        example: "1",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.SORT.functionParameter.byCol.name",
        detail: "formula.functionList.SORT.functionParameter.byCol.detail",
        example: "false",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: re3.SORTBY,
    functionType: Kc2.Lookup,
    description: "formula.functionList.SORTBY.description",
    abstract: "formula.functionList.SORTBY.abstract",
    functionParameter: [
      {
        name: "formula.functionList.SORTBY.functionParameter.array.name",
        detail: "formula.functionList.SORTBY.functionParameter.array.detail",
        example: "D2:D9",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SORTBY.functionParameter.byArray1.name",
        detail: "formula.functionList.SORTBY.functionParameter.byArray1.detail",
        example: "E2:E9",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SORTBY.functionParameter.sortOrder1.name",
        detail: "formula.functionList.SORTBY.functionParameter.sortOrder1.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SORTBY.functionParameter.byArray2.name",
        detail: "formula.functionList.SORTBY.functionParameter.byArray2.detail",
        example: "E2:E9",
        require: 0,
        repeat: 1
      },
      {
        name: "formula.functionList.SORTBY.functionParameter.sortOrder2.name",
        detail: "formula.functionList.SORTBY.functionParameter.sortOrder2.detail",
        example: "1",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: re3.TAKE,
    functionType: Kc2.Lookup,
    description: "formula.functionList.TAKE.description",
    abstract: "formula.functionList.TAKE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.TAKE.functionParameter.array.name",
        detail: "formula.functionList.TAKE.functionParameter.array.detail",
        example: "A2:C4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.TAKE.functionParameter.rows.name",
        detail: "formula.functionList.TAKE.functionParameter.rows.detail",
        example: "2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.TAKE.functionParameter.columns.name",
        detail: "formula.functionList.TAKE.functionParameter.columns.detail",
        example: "2",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: re3.TOCOL,
    functionType: Kc2.Lookup,
    description: "formula.functionList.TOCOL.description",
    abstract: "formula.functionList.TOCOL.abstract",
    functionParameter: [
      {
        name: "formula.functionList.TOCOL.functionParameter.array.name",
        detail: "formula.functionList.TOCOL.functionParameter.array.detail",
        example: "A2:D4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.TOCOL.functionParameter.ignore.name",
        detail: "formula.functionList.TOCOL.functionParameter.ignore.detail",
        example: "1",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.TOCOL.functionParameter.scanByColumn.name",
        detail: "formula.functionList.TOCOL.functionParameter.scanByColumn.detail",
        example: "TRUE",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: re3.TOROW,
    functionType: Kc2.Lookup,
    description: "formula.functionList.TOROW.description",
    abstract: "formula.functionList.TOROW.abstract",
    functionParameter: [
      {
        name: "formula.functionList.TOROW.functionParameter.array.name",
        detail: "formula.functionList.TOROW.functionParameter.array.detail",
        example: "A2:D4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.TOROW.functionParameter.ignore.name",
        detail: "formula.functionList.TOROW.functionParameter.ignore.detail",
        example: "1",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.TOROW.functionParameter.scanByColumn.name",
        detail: "formula.functionList.TOROW.functionParameter.scanByColumn.detail",
        example: "TRUE",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: re3.TRANSPOSE,
    functionType: Kc2.Lookup,
    description: "formula.functionList.TRANSPOSE.description",
    abstract: "formula.functionList.TRANSPOSE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.TRANSPOSE.functionParameter.array.name",
        detail: "formula.functionList.TRANSPOSE.functionParameter.array.detail",
        example: "A2:F9",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: re3.UNIQUE,
    functionType: Kc2.Lookup,
    description: "formula.functionList.UNIQUE.description",
    abstract: "formula.functionList.UNIQUE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.UNIQUE.functionParameter.array.name",
        detail: "formula.functionList.UNIQUE.functionParameter.array.detail",
        example: "A2:A12",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.UNIQUE.functionParameter.byCol.name",
        detail: "formula.functionList.UNIQUE.functionParameter.byCol.detail",
        example: "false",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.UNIQUE.functionParameter.exactlyOnce.name",
        detail: "formula.functionList.UNIQUE.functionParameter.exactlyOnce.detail",
        example: "false",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: re3.VLOOKUP,
    functionType: Kc2.Lookup,
    description: "formula.functionList.VLOOKUP.description",
    abstract: "formula.functionList.VLOOKUP.abstract",
    functionParameter: [
      {
        name: "formula.functionList.VLOOKUP.functionParameter.lookupValue.name",
        detail: "formula.functionList.VLOOKUP.functionParameter.lookupValue.detail",
        example: "B2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.VLOOKUP.functionParameter.tableArray.name",
        detail: "formula.functionList.VLOOKUP.functionParameter.tableArray.detail",
        example: "C2:E7",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.VLOOKUP.functionParameter.colIndexNum.name",
        detail: "formula.functionList.VLOOKUP.functionParameter.colIndexNum.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.VLOOKUP.functionParameter.rangeLookup.name",
        detail: "formula.functionList.VLOOKUP.functionParameter.rangeLookup.detail",
        example: "TRUE",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: re3.VSTACK,
    functionType: Kc2.Lookup,
    description: "formula.functionList.VSTACK.description",
    abstract: "formula.functionList.VSTACK.abstract",
    functionParameter: [
      {
        name: "formula.functionList.VSTACK.functionParameter.array1.name",
        detail: "formula.functionList.VSTACK.functionParameter.array1.detail",
        example: "A2:C3",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.VSTACK.functionParameter.array2.name",
        detail: "formula.functionList.VSTACK.functionParameter.array2.detail",
        example: "E2:G3",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: re3.WRAPCOLS,
    functionType: Kc2.Lookup,
    description: "formula.functionList.WRAPCOLS.description",
    abstract: "formula.functionList.WRAPCOLS.abstract",
    functionParameter: [
      {
        name: "formula.functionList.WRAPCOLS.functionParameter.vector.name",
        detail: "formula.functionList.WRAPCOLS.functionParameter.vector.detail",
        example: "A2:G2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.WRAPCOLS.functionParameter.wrapCount.name",
        detail: "formula.functionList.WRAPCOLS.functionParameter.wrapCount.detail",
        example: "3",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.WRAPCOLS.functionParameter.padWith.name",
        detail: "formula.functionList.WRAPCOLS.functionParameter.padWith.detail",
        example: '"x"',
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: re3.WRAPROWS,
    functionType: Kc2.Lookup,
    description: "formula.functionList.WRAPROWS.description",
    abstract: "formula.functionList.WRAPROWS.abstract",
    functionParameter: [
      {
        name: "formula.functionList.WRAPROWS.functionParameter.vector.name",
        detail: "formula.functionList.WRAPROWS.functionParameter.vector.detail",
        example: "A2:G2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.WRAPROWS.functionParameter.wrapCount.name",
        detail: "formula.functionList.WRAPROWS.functionParameter.wrapCount.detail",
        example: "3",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.WRAPROWS.functionParameter.padWith.name",
        detail: "formula.functionList.WRAPROWS.functionParameter.padWith.detail",
        example: '"x"',
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: re3.XLOOKUP,
    functionType: Kc2.Lookup,
    description: "formula.functionList.XLOOKUP.description",
    abstract: "formula.functionList.XLOOKUP.abstract",
    functionParameter: [
      {
        name: "formula.functionList.XLOOKUP.functionParameter.lookupValue.name",
        detail: "formula.functionList.XLOOKUP.functionParameter.lookupValue.detail",
        example: "A1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.XLOOKUP.functionParameter.lookupArray.name",
        detail: "formula.functionList.XLOOKUP.functionParameter.lookupArray.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.XLOOKUP.functionParameter.returnArray.name",
        detail: "formula.functionList.XLOOKUP.functionParameter.returnArray.detail",
        example: "B1:B20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.XLOOKUP.functionParameter.ifNotFound.name",
        detail: "formula.functionList.XLOOKUP.functionParameter.ifNotFound.detail",
        example: "default",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.XLOOKUP.functionParameter.matchMode.name",
        detail: "formula.functionList.XLOOKUP.functionParameter.matchMode.detail",
        example: "0",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.XLOOKUP.functionParameter.searchMode.name",
        detail: "formula.functionList.XLOOKUP.functionParameter.searchMode.detail",
        example: "1",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: re3.XMATCH,
    functionType: Kc2.Lookup,
    description: "formula.functionList.XMATCH.description",
    abstract: "formula.functionList.XMATCH.abstract",
    functionParameter: [
      {
        name: "formula.functionList.XMATCH.functionParameter.lookupValue.name",
        detail: "formula.functionList.XMATCH.functionParameter.lookupValue.detail",
        example: "B1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.XMATCH.functionParameter.lookupArray.name",
        detail: "formula.functionList.XMATCH.functionParameter.lookupArray.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.XMATCH.functionParameter.matchMode.name",
        detail: "formula.functionList.XMATCH.functionParameter.matchMode.detail",
        example: "0",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.XMATCH.functionParameter.searchMode.name",
        detail: "formula.functionList.XMATCH.functionParameter.searchMode.detail",
        example: "1",
        require: 0,
        repeat: 0
      }
    ]
  }
];
var qr3 = [
  {
    functionName: F.ABS,
    functionType: Kc2.Math,
    description: "formula.functionList.ABS.description",
    abstract: "formula.functionList.ABS.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ABS.functionParameter.number.name",
        detail: "formula.functionList.ABS.functionParameter.number.detail",
        example: "-2",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.ACOS,
    functionType: Kc2.Math,
    description: "formula.functionList.ACOS.description",
    abstract: "formula.functionList.ACOS.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ACOS.functionParameter.number.name",
        detail: "formula.functionList.ACOS.functionParameter.number.detail",
        example: "0",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.ACOSH,
    functionType: Kc2.Math,
    description: "formula.functionList.ACOSH.description",
    abstract: "formula.functionList.ACOSH.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ACOSH.functionParameter.number.name",
        detail: "formula.functionList.ACOSH.functionParameter.number.detail",
        example: "2",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.ACOT,
    functionType: Kc2.Math,
    description: "formula.functionList.ACOT.description",
    abstract: "formula.functionList.ACOT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ACOT.functionParameter.number.name",
        detail: "formula.functionList.ACOT.functionParameter.number.detail",
        example: "0",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.ACOTH,
    functionType: Kc2.Math,
    description: "formula.functionList.ACOTH.description",
    abstract: "formula.functionList.ACOTH.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ACOTH.functionParameter.number.name",
        detail: "formula.functionList.ACOTH.functionParameter.number.detail",
        example: "6",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.AGGREGATE,
    functionType: Kc2.Math,
    description: "formula.functionList.AGGREGATE.description",
    abstract: "formula.functionList.AGGREGATE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.AGGREGATE.functionParameter.functionNum.name",
        detail: "formula.functionList.AGGREGATE.functionParameter.functionNum.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.AGGREGATE.functionParameter.options.name",
        detail: "formula.functionList.AGGREGATE.functionParameter.options.detail",
        example: "6",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.AGGREGATE.functionParameter.ref1.name",
        detail: "formula.functionList.AGGREGATE.functionParameter.ref1.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.AGGREGATE.functionParameter.ref2.name",
        detail: "formula.functionList.AGGREGATE.functionParameter.ref2.detail",
        example: "B1:B20",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: F.ARABIC,
    functionType: Kc2.Math,
    description: "formula.functionList.ARABIC.description",
    abstract: "formula.functionList.ARABIC.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ARABIC.functionParameter.text.name",
        detail: "formula.functionList.ARABIC.functionParameter.text.detail",
        example: '"LVII"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.ASIN,
    functionType: Kc2.Math,
    description: "formula.functionList.ASIN.description",
    abstract: "formula.functionList.ASIN.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ASIN.functionParameter.number.name",
        detail: "formula.functionList.ASIN.functionParameter.number.detail",
        example: "0",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.ASINH,
    functionType: Kc2.Math,
    description: "formula.functionList.ASINH.description",
    abstract: "formula.functionList.ASINH.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ASINH.functionParameter.number.name",
        detail: "formula.functionList.ASINH.functionParameter.number.detail",
        example: "10",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.ATAN,
    functionType: Kc2.Math,
    description: "formula.functionList.ATAN.description",
    abstract: "formula.functionList.ATAN.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ATAN.functionParameter.number.name",
        detail: "formula.functionList.ATAN.functionParameter.number.detail",
        example: "1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.ATAN2,
    functionType: Kc2.Math,
    description: "formula.functionList.ATAN2.description",
    abstract: "formula.functionList.ATAN2.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ATAN2.functionParameter.xNum.name",
        detail: "formula.functionList.ATAN2.functionParameter.xNum.detail",
        example: "4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ATAN2.functionParameter.yNum.name",
        detail: "formula.functionList.ATAN2.functionParameter.yNum.detail",
        example: "3",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.ATANH,
    functionType: Kc2.Math,
    description: "formula.functionList.ATANH.description",
    abstract: "formula.functionList.ATANH.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ATANH.functionParameter.number.name",
        detail: "formula.functionList.ATANH.functionParameter.number.detail",
        example: "0.1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.BASE,
    functionType: Kc2.Math,
    description: "formula.functionList.BASE.description",
    abstract: "formula.functionList.BASE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.BASE.functionParameter.number.name",
        detail: "formula.functionList.BASE.functionParameter.number.detail",
        example: "15",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.BASE.functionParameter.radix.name",
        detail: "formula.functionList.BASE.functionParameter.radix.detail",
        example: "2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.BASE.functionParameter.minLength.name",
        detail: "formula.functionList.BASE.functionParameter.minLength.detail",
        example: "10",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.CEILING,
    functionType: Kc2.Math,
    description: "formula.functionList.CEILING.description",
    abstract: "formula.functionList.CEILING.abstract",
    functionParameter: [
      {
        name: "formula.functionList.CEILING.functionParameter.number.name",
        detail: "formula.functionList.CEILING.functionParameter.number.detail",
        example: "2.5",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CEILING.functionParameter.significance.name",
        detail: "formula.functionList.CEILING.functionParameter.significance.detail",
        example: "1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.CEILING_MATH,
    functionType: Kc2.Math,
    description: "formula.functionList.CEILING_MATH.description",
    abstract: "formula.functionList.CEILING_MATH.abstract",
    functionParameter: [
      {
        name: "formula.functionList.CEILING_MATH.functionParameter.number.name",
        detail: "formula.functionList.CEILING_MATH.functionParameter.number.detail",
        example: "-5.5",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CEILING_MATH.functionParameter.significance.name",
        detail: "formula.functionList.CEILING_MATH.functionParameter.significance.detail",
        example: "2",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.CEILING_MATH.functionParameter.mode.name",
        detail: "formula.functionList.CEILING_MATH.functionParameter.mode.detail",
        example: "-1",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.CEILING_PRECISE,
    functionType: Kc2.Math,
    description: "formula.functionList.CEILING_PRECISE.description",
    abstract: "formula.functionList.CEILING_PRECISE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.CEILING_PRECISE.functionParameter.number.name",
        detail: "formula.functionList.CEILING_PRECISE.functionParameter.number.detail",
        example: "4.3",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CEILING_PRECISE.functionParameter.significance.name",
        detail: "formula.functionList.CEILING_PRECISE.functionParameter.significance.detail",
        example: "2",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.COMBIN,
    functionType: Kc2.Math,
    description: "formula.functionList.COMBIN.description",
    abstract: "formula.functionList.COMBIN.abstract",
    functionParameter: [
      {
        name: "formula.functionList.COMBIN.functionParameter.number.name",
        detail: "formula.functionList.COMBIN.functionParameter.number.detail",
        example: "8",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.COMBIN.functionParameter.numberChosen.name",
        detail: "formula.functionList.COMBIN.functionParameter.numberChosen.detail",
        example: "2",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.COMBINA,
    functionType: Kc2.Math,
    description: "formula.functionList.COMBINA.description",
    abstract: "formula.functionList.COMBINA.abstract",
    functionParameter: [
      {
        name: "formula.functionList.COMBINA.functionParameter.number.name",
        detail: "formula.functionList.COMBINA.functionParameter.number.detail",
        example: "8",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.COMBINA.functionParameter.numberChosen.name",
        detail: "formula.functionList.COMBINA.functionParameter.numberChosen.detail",
        example: "2",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.COS,
    functionType: Kc2.Math,
    description: "formula.functionList.COS.description",
    abstract: "formula.functionList.COS.abstract",
    functionParameter: [
      {
        name: "formula.functionList.COS.functionParameter.number.name",
        detail: "formula.functionList.COS.functionParameter.number.detail",
        example: "1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.COSH,
    functionType: Kc2.Math,
    description: "formula.functionList.COSH.description",
    abstract: "formula.functionList.COSH.abstract",
    functionParameter: [
      {
        name: "formula.functionList.COSH.functionParameter.number.name",
        detail: "formula.functionList.COSH.functionParameter.number.detail",
        example: "4",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.COT,
    functionType: Kc2.Math,
    description: "formula.functionList.COT.description",
    abstract: "formula.functionList.COT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.COT.functionParameter.number.name",
        detail: "formula.functionList.COT.functionParameter.number.detail",
        example: "30",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.COTH,
    functionType: Kc2.Math,
    description: "formula.functionList.COTH.description",
    abstract: "formula.functionList.COTH.abstract",
    functionParameter: [
      {
        name: "formula.functionList.COTH.functionParameter.number.name",
        detail: "formula.functionList.COTH.functionParameter.number.detail",
        example: "2",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.CSC,
    functionType: Kc2.Math,
    description: "formula.functionList.CSC.description",
    abstract: "formula.functionList.CSC.abstract",
    functionParameter: [
      {
        name: "formula.functionList.CSC.functionParameter.number.name",
        detail: "formula.functionList.CSC.functionParameter.number.detail",
        example: "15",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.CSCH,
    functionType: Kc2.Math,
    description: "formula.functionList.CSCH.description",
    abstract: "formula.functionList.CSCH.abstract",
    functionParameter: [
      {
        name: "formula.functionList.CSCH.functionParameter.number.name",
        detail: "formula.functionList.CSCH.functionParameter.number.detail",
        example: "1.5",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.DECIMAL,
    functionType: Kc2.Math,
    description: "formula.functionList.DECIMAL.description",
    abstract: "formula.functionList.DECIMAL.abstract",
    functionParameter: [
      {
        name: "formula.functionList.DECIMAL.functionParameter.text.name",
        detail: "formula.functionList.DECIMAL.functionParameter.text.detail",
        example: '"FF"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DECIMAL.functionParameter.radix.name",
        detail: "formula.functionList.DECIMAL.functionParameter.radix.detail",
        example: "16",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.DEGREES,
    functionType: Kc2.Math,
    description: "formula.functionList.DEGREES.description",
    abstract: "formula.functionList.DEGREES.abstract",
    functionParameter: [
      {
        name: "formula.functionList.DEGREES.functionParameter.angle.name",
        detail: "formula.functionList.DEGREES.functionParameter.angle.detail",
        example: "PI()",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.EVEN,
    functionType: Kc2.Math,
    description: "formula.functionList.EVEN.description",
    abstract: "formula.functionList.EVEN.abstract",
    functionParameter: [
      {
        name: "formula.functionList.EVEN.functionParameter.number.name",
        detail: "formula.functionList.EVEN.functionParameter.number.detail",
        example: "1.5",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.EXP,
    functionType: Kc2.Math,
    description: "formula.functionList.EXP.description",
    abstract: "formula.functionList.EXP.abstract",
    functionParameter: [
      {
        name: "formula.functionList.EXP.functionParameter.number.name",
        detail: "formula.functionList.EXP.functionParameter.number.detail",
        example: "2",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.FACT,
    functionType: Kc2.Math,
    description: "formula.functionList.FACT.description",
    abstract: "formula.functionList.FACT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.FACT.functionParameter.number.name",
        detail: "formula.functionList.FACT.functionParameter.number.detail",
        example: "5",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.FACTDOUBLE,
    functionType: Kc2.Math,
    description: "formula.functionList.FACTDOUBLE.description",
    abstract: "formula.functionList.FACTDOUBLE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.FACTDOUBLE.functionParameter.number.name",
        detail: "formula.functionList.FACTDOUBLE.functionParameter.number.detail",
        example: "6",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.FLOOR,
    functionType: Kc2.Math,
    description: "formula.functionList.FLOOR.description",
    abstract: "formula.functionList.FLOOR.abstract",
    functionParameter: [
      {
        name: "formula.functionList.FLOOR.functionParameter.number.name",
        detail: "formula.functionList.FLOOR.functionParameter.number.detail",
        example: "3.7",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.FLOOR.functionParameter.significance.name",
        detail: "formula.functionList.FLOOR.functionParameter.significance.detail",
        example: "2",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.FLOOR_MATH,
    functionType: Kc2.Math,
    description: "formula.functionList.FLOOR_MATH.description",
    abstract: "formula.functionList.FLOOR_MATH.abstract",
    functionParameter: [
      {
        name: "formula.functionList.FLOOR_MATH.functionParameter.number.name",
        detail: "formula.functionList.FLOOR_MATH.functionParameter.number.detail",
        example: "-5.5",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.FLOOR_MATH.functionParameter.significance.name",
        detail: "formula.functionList.FLOOR_MATH.functionParameter.significance.detail",
        example: "2",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.FLOOR_MATH.functionParameter.mode.name",
        detail: "formula.functionList.FLOOR_MATH.functionParameter.mode.detail",
        example: "-1",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.FLOOR_PRECISE,
    functionType: Kc2.Math,
    description: "formula.functionList.FLOOR_PRECISE.description",
    abstract: "formula.functionList.FLOOR_PRECISE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.FLOOR_PRECISE.functionParameter.number.name",
        detail: "formula.functionList.FLOOR_PRECISE.functionParameter.number.detail",
        example: "-3.2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.FLOOR_PRECISE.functionParameter.significance.name",
        detail: "formula.functionList.FLOOR_PRECISE.functionParameter.significance.detail",
        example: "-1",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.GCD,
    functionType: Kc2.Math,
    description: "formula.functionList.GCD.description",
    abstract: "formula.functionList.GCD.abstract",
    functionParameter: [
      {
        name: "formula.functionList.GCD.functionParameter.number1.name",
        detail: "formula.functionList.GCD.functionParameter.number1.detail",
        example: "5",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.GCD.functionParameter.number2.name",
        detail: "formula.functionList.GCD.functionParameter.number2.detail",
        example: "2",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: F.INT,
    functionType: Kc2.Math,
    description: "formula.functionList.INT.description",
    abstract: "formula.functionList.INT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.INT.functionParameter.number.name",
        detail: "formula.functionList.INT.functionParameter.number.detail",
        example: "8.9",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.ISO_CEILING,
    functionType: Kc2.Math,
    description: "formula.functionList.ISO_CEILING.description",
    abstract: "formula.functionList.ISO_CEILING.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ISO_CEILING.functionParameter.number1.name",
        detail: "formula.functionList.ISO_CEILING.functionParameter.number1.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ISO_CEILING.functionParameter.number2.name",
        detail: "formula.functionList.ISO_CEILING.functionParameter.number2.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.LCM,
    functionType: Kc2.Math,
    description: "formula.functionList.LCM.description",
    abstract: "formula.functionList.LCM.abstract",
    functionParameter: [
      {
        name: "formula.functionList.LCM.functionParameter.number1.name",
        detail: "formula.functionList.LCM.functionParameter.number1.detail",
        example: "5",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.LCM.functionParameter.number2.name",
        detail: "formula.functionList.LCM.functionParameter.number2.detail",
        example: "2",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: F.LET,
    functionType: Kc2.Math,
    description: "formula.functionList.LET.description",
    abstract: "formula.functionList.LET.abstract",
    functionParameter: [
      {
        name: "formula.functionList.LET.functionParameter.number1.name",
        detail: "formula.functionList.LET.functionParameter.number1.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.LET.functionParameter.number2.name",
        detail: "formula.functionList.LET.functionParameter.number2.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.LN,
    functionType: Kc2.Math,
    description: "formula.functionList.LN.description",
    abstract: "formula.functionList.LN.abstract",
    functionParameter: [
      {
        name: "formula.functionList.LN.functionParameter.number.name",
        detail: "formula.functionList.LN.functionParameter.number.detail",
        example: "EXP(3)",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.LOG,
    functionType: Kc2.Math,
    description: "formula.functionList.LOG.description",
    abstract: "formula.functionList.LOG.abstract",
    functionParameter: [
      {
        name: "formula.functionList.LOG.functionParameter.number.name",
        detail: "formula.functionList.LOG.functionParameter.number.detail",
        example: "8",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.LOG.functionParameter.base.name",
        detail: "formula.functionList.LOG.functionParameter.base.detail",
        example: "2",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.LOG10,
    functionType: Kc2.Math,
    description: "formula.functionList.LOG10.description",
    abstract: "formula.functionList.LOG10.abstract",
    functionParameter: [
      {
        name: "formula.functionList.LOG10.functionParameter.number.name",
        detail: "formula.functionList.LOG10.functionParameter.number.detail",
        example: "100000",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.MDETERM,
    functionType: Kc2.Math,
    description: "formula.functionList.MDETERM.description",
    abstract: "formula.functionList.MDETERM.abstract",
    functionParameter: [
      {
        name: "formula.functionList.MDETERM.functionParameter.array.name",
        detail: "formula.functionList.MDETERM.functionParameter.array.detail",
        example: "A1:C3",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.MINVERSE,
    functionType: Kc2.Math,
    description: "formula.functionList.MINVERSE.description",
    abstract: "formula.functionList.MINVERSE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.MINVERSE.functionParameter.array.name",
        detail: "formula.functionList.MINVERSE.functionParameter.array.detail",
        example: "A1:C3",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.MMULT,
    functionType: Kc2.Math,
    description: "formula.functionList.MMULT.description",
    abstract: "formula.functionList.MMULT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.MMULT.functionParameter.array1.name",
        detail: "formula.functionList.MMULT.functionParameter.array1.detail",
        example: "A2:B3",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.MMULT.functionParameter.array2.name",
        detail: "formula.functionList.MMULT.functionParameter.array2.detail",
        example: "A5:B6",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.MOD,
    functionType: Kc2.Math,
    description: "formula.functionList.MOD.description",
    abstract: "formula.functionList.MOD.abstract",
    functionParameter: [
      {
        name: "formula.functionList.MOD.functionParameter.number.name",
        detail: "formula.functionList.MOD.functionParameter.number.detail",
        example: "3",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.MOD.functionParameter.divisor.name",
        detail: "formula.functionList.MOD.functionParameter.divisor.detail",
        example: "2",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.MROUND,
    functionType: Kc2.Math,
    description: "formula.functionList.MROUND.description",
    abstract: "formula.functionList.MROUND.abstract",
    functionParameter: [
      {
        name: "formula.functionList.MROUND.functionParameter.number.name",
        detail: "formula.functionList.MROUND.functionParameter.number.detail",
        example: "10",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.MROUND.functionParameter.multiple.name",
        detail: "formula.functionList.MROUND.functionParameter.multiple.detail",
        example: "3",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.MULTINOMIAL,
    functionType: Kc2.Math,
    description: "formula.functionList.MULTINOMIAL.description",
    abstract: "formula.functionList.MULTINOMIAL.abstract",
    functionParameter: [
      {
        name: "formula.functionList.MULTINOMIAL.functionParameter.number1.name",
        detail: "formula.functionList.MULTINOMIAL.functionParameter.number1.detail",
        example: "5",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.MULTINOMIAL.functionParameter.number2.name",
        detail: "formula.functionList.MULTINOMIAL.functionParameter.number2.detail",
        example: "2",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: F.MUNIT,
    functionType: Kc2.Math,
    description: "formula.functionList.MUNIT.description",
    abstract: "formula.functionList.MUNIT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.MUNIT.functionParameter.dimension.name",
        detail: "formula.functionList.MUNIT.functionParameter.dimension.detail",
        example: "3",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.ODD,
    functionType: Kc2.Math,
    description: "formula.functionList.ODD.description",
    abstract: "formula.functionList.ODD.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ODD.functionParameter.number.name",
        detail: "formula.functionList.ODD.functionParameter.number.detail",
        example: "1.5",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.PI,
    functionType: Kc2.Math,
    description: "formula.functionList.PI.description",
    abstract: "formula.functionList.PI.abstract",
    functionParameter: []
  },
  {
    functionName: F.POWER,
    functionType: Kc2.Math,
    description: "formula.functionList.POWER.description",
    abstract: "formula.functionList.POWER.abstract",
    functionParameter: [
      {
        name: "formula.functionList.POWER.functionParameter.number.name",
        detail: "formula.functionList.POWER.functionParameter.number.detail",
        example: "5",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.POWER.functionParameter.power.name",
        detail: "formula.functionList.POWER.functionParameter.power.detail",
        example: "2",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.PRODUCT,
    functionType: Kc2.Math,
    description: "formula.functionList.PRODUCT.description",
    abstract: "formula.functionList.PRODUCT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.PRODUCT.functionParameter.number1.name",
        detail: "formula.functionList.PRODUCT.functionParameter.number1.detail",
        example: "A1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PRODUCT.functionParameter.number2.name",
        detail: "formula.functionList.PRODUCT.functionParameter.number2.detail",
        example: "A2",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: F.QUOTIENT,
    functionType: Kc2.Math,
    description: "formula.functionList.QUOTIENT.description",
    abstract: "formula.functionList.QUOTIENT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.QUOTIENT.functionParameter.numerator.name",
        detail: "formula.functionList.QUOTIENT.functionParameter.numerator.detail",
        example: "5",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.QUOTIENT.functionParameter.denominator.name",
        detail: "formula.functionList.QUOTIENT.functionParameter.denominator.detail",
        example: "2",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.RADIANS,
    functionType: Kc2.Math,
    description: "formula.functionList.RADIANS.description",
    abstract: "formula.functionList.RADIANS.abstract",
    functionParameter: [
      {
        name: "formula.functionList.RADIANS.functionParameter.angle.name",
        detail: "formula.functionList.RADIANS.functionParameter.angle.detail",
        example: "270",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.RAND,
    functionType: Kc2.Math,
    description: "formula.functionList.RAND.description",
    abstract: "formula.functionList.RAND.abstract",
    functionParameter: []
  },
  {
    functionName: F.RANDARRAY,
    functionType: Kc2.Math,
    description: "formula.functionList.RANDARRAY.description",
    abstract: "formula.functionList.RANDARRAY.abstract",
    functionParameter: [
      {
        name: "formula.functionList.RANDARRAY.functionParameter.rows.name",
        detail: "formula.functionList.RANDARRAY.functionParameter.rows.detail",
        example: "5",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.RANDARRAY.functionParameter.columns.name",
        detail: "formula.functionList.RANDARRAY.functionParameter.columns.detail",
        example: "3",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.RANDARRAY.functionParameter.min.name",
        detail: "formula.functionList.RANDARRAY.functionParameter.min.detail",
        example: "1",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.RANDARRAY.functionParameter.max.name",
        detail: "formula.functionList.RANDARRAY.functionParameter.max.detail",
        example: "100",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.RANDARRAY.functionParameter.wholeNumber.name",
        detail: "formula.functionList.RANDARRAY.functionParameter.wholeNumber.detail",
        example: "TRUE",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.RANDBETWEEN,
    functionType: Kc2.Math,
    description: "formula.functionList.RANDBETWEEN.description",
    abstract: "formula.functionList.RANDBETWEEN.abstract",
    functionParameter: [
      {
        name: "formula.functionList.RANDBETWEEN.functionParameter.bottom.name",
        detail: "formula.functionList.RANDBETWEEN.functionParameter.bottom.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.RANDBETWEEN.functionParameter.top.name",
        detail: "formula.functionList.RANDBETWEEN.functionParameter.top.detail",
        example: "100",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.ROMAN,
    functionType: Kc2.Math,
    description: "formula.functionList.ROMAN.description",
    abstract: "formula.functionList.ROMAN.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ROMAN.functionParameter.number.name",
        detail: "formula.functionList.ROMAN.functionParameter.number.detail",
        example: "499",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ROMAN.functionParameter.form.name",
        detail: "formula.functionList.ROMAN.functionParameter.form.detail",
        example: "0",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.ROUND,
    functionType: Kc2.Math,
    description: "formula.functionList.ROUND.description",
    abstract: "formula.functionList.ROUND.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ROUND.functionParameter.number.name",
        detail: "formula.functionList.ROUND.functionParameter.number.detail",
        example: "2.15",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ROUND.functionParameter.numDigits.name",
        detail: "formula.functionList.ROUND.functionParameter.numDigits.detail",
        example: "1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.ROUNDBANK,
    functionType: Kc2.Math,
    description: "formula.functionList.ROUNDBANK.description",
    abstract: "formula.functionList.ROUNDBANK.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ROUNDBANK.functionParameter.number.name",
        detail: "formula.functionList.ROUNDBANK.functionParameter.number.detail",
        example: "2.345",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ROUNDBANK.functionParameter.numDigits.name",
        detail: "formula.functionList.ROUNDBANK.functionParameter.numDigits.detail",
        example: "2",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.ROUNDDOWN,
    functionType: Kc2.Math,
    description: "formula.functionList.ROUNDDOWN.description",
    abstract: "formula.functionList.ROUNDDOWN.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ROUNDDOWN.functionParameter.number.name",
        detail: "formula.functionList.ROUNDDOWN.functionParameter.number.detail",
        example: "3.2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ROUNDDOWN.functionParameter.numDigits.name",
        detail: "formula.functionList.ROUNDDOWN.functionParameter.numDigits.detail",
        example: "0",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.ROUNDUP,
    functionType: Kc2.Math,
    description: "formula.functionList.ROUNDUP.description",
    abstract: "formula.functionList.ROUNDUP.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ROUNDUP.functionParameter.number.name",
        detail: "formula.functionList.ROUNDUP.functionParameter.number.detail",
        example: "3.2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ROUNDUP.functionParameter.numDigits.name",
        detail: "formula.functionList.ROUNDUP.functionParameter.numDigits.detail",
        example: "0",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.SEC,
    functionType: Kc2.Math,
    description: "formula.functionList.SEC.description",
    abstract: "formula.functionList.SEC.abstract",
    functionParameter: [
      {
        name: "formula.functionList.SEC.functionParameter.number.name",
        detail: "formula.functionList.SEC.functionParameter.number.detail",
        example: "30",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.SECH,
    functionType: Kc2.Math,
    description: "formula.functionList.SECH.description",
    abstract: "formula.functionList.SECH.abstract",
    functionParameter: [
      {
        name: "formula.functionList.SECH.functionParameter.number.name",
        detail: "formula.functionList.SECH.functionParameter.number.detail",
        example: "30",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.SERIESSUM,
    functionType: Kc2.Math,
    description: "formula.functionList.SERIESSUM.description",
    abstract: "formula.functionList.SERIESSUM.abstract",
    functionParameter: [
      {
        name: "formula.functionList.SERIESSUM.functionParameter.x.name",
        detail: "formula.functionList.SERIESSUM.functionParameter.x.detail",
        example: "0.785398163",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SERIESSUM.functionParameter.n.name",
        detail: "formula.functionList.SERIESSUM.functionParameter.n.detail",
        example: "0",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SERIESSUM.functionParameter.m.name",
        detail: "formula.functionList.SERIESSUM.functionParameter.m.detail",
        example: "2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SERIESSUM.functionParameter.coefficients.name",
        detail: "formula.functionList.SERIESSUM.functionParameter.coefficients.detail",
        example: "A1:A4",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.SEQUENCE,
    functionType: Kc2.Math,
    description: "formula.functionList.SEQUENCE.description",
    abstract: "formula.functionList.SEQUENCE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.SEQUENCE.functionParameter.rows.name",
        detail: "formula.functionList.SEQUENCE.functionParameter.rows.detail",
        example: "4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SEQUENCE.functionParameter.columns.name",
        detail: "formula.functionList.SEQUENCE.functionParameter.columns.detail",
        example: "5",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.SEQUENCE.functionParameter.start.name",
        detail: "formula.functionList.SEQUENCE.functionParameter.start.detail",
        example: "1",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.SEQUENCE.functionParameter.step.name",
        detail: "formula.functionList.SEQUENCE.functionParameter.step.detail",
        example: "1",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.SIGN,
    functionType: Kc2.Math,
    description: "formula.functionList.SIGN.description",
    abstract: "formula.functionList.SIGN.abstract",
    functionParameter: [
      {
        name: "formula.functionList.SIGN.functionParameter.number.name",
        detail: "formula.functionList.SIGN.functionParameter.number.detail",
        example: "10",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.SIN,
    functionType: Kc2.Math,
    description: "formula.functionList.SIN.description",
    abstract: "formula.functionList.SIN.abstract",
    functionParameter: [
      {
        name: "formula.functionList.SIN.functionParameter.number.name",
        detail: "formula.functionList.SIN.functionParameter.number.detail",
        example: "30*PI()/180",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.SINH,
    functionType: Kc2.Math,
    description: "formula.functionList.SINH.description",
    abstract: "formula.functionList.SINH.abstract",
    functionParameter: [
      {
        name: "formula.functionList.SINH.functionParameter.number.name",
        detail: "formula.functionList.SINH.functionParameter.number.detail",
        example: "0.0342*1.03",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.SQRT,
    functionType: Kc2.Math,
    description: "formula.functionList.SQRT.description",
    abstract: "formula.functionList.SQRT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.SQRT.functionParameter.number.name",
        detail: "formula.functionList.SQRT.functionParameter.number.detail",
        example: "16",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.SQRTPI,
    functionType: Kc2.Math,
    description: "formula.functionList.SQRTPI.description",
    abstract: "formula.functionList.SQRTPI.abstract",
    functionParameter: [
      {
        name: "formula.functionList.SQRTPI.functionParameter.number.name",
        detail: "formula.functionList.SQRTPI.functionParameter.number.detail",
        example: "1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.SUBTOTAL,
    functionType: Kc2.Math,
    description: "formula.functionList.SUBTOTAL.description",
    abstract: "formula.functionList.SUBTOTAL.abstract",
    functionParameter: [
      {
        name: "formula.functionList.SUBTOTAL.functionParameter.functionNum.name",
        detail: "formula.functionList.SUBTOTAL.functionParameter.functionNum.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SUBTOTAL.functionParameter.ref1.name",
        detail: "formula.functionList.SUBTOTAL.functionParameter.ref1.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SUBTOTAL.functionParameter.ref2.name",
        detail: "formula.functionList.SUBTOTAL.functionParameter.ref2.detail",
        example: "B1:B20",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: F.SUM,
    aliasFunctionName: "formula.functionList.SUM.aliasFunctionName",
    functionType: Kc2.Math,
    description: "formula.functionList.SUM.description",
    abstract: "formula.functionList.SUM.abstract",
    functionParameter: [
      {
        name: "formula.functionList.SUM.functionParameter.number1.name",
        detail: "formula.functionList.SUM.functionParameter.number1.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SUM.functionParameter.number2.name",
        detail: "formula.functionList.SUM.functionParameter.number2.detail",
        example: "B2:B10",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: F.SUMIF,
    aliasFunctionName: "formula.functionList.SUMIF.aliasFunctionName",
    functionType: Kc2.Math,
    description: "formula.functionList.SUMIF.description",
    abstract: "formula.functionList.SUMIF.abstract",
    functionParameter: [
      {
        name: "formula.functionList.SUMIF.functionParameter.range.name",
        detail: "formula.functionList.SUMIF.functionParameter.range.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SUMIF.functionParameter.criteria.name",
        detail: "formula.functionList.SUMIF.functionParameter.criteria.detail",
        example: '">5"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SUMIF.functionParameter.sumRange.name",
        detail: "formula.functionList.SUMIF.functionParameter.sumRange.detail",
        example: "B1:B20",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.SUMIFS,
    functionType: Kc2.Math,
    description: "formula.functionList.SUMIFS.description",
    abstract: "formula.functionList.SUMIFS.abstract",
    functionParameter: [
      {
        name: "formula.functionList.SUMIFS.functionParameter.sumRange.name",
        detail: "formula.functionList.SUMIFS.functionParameter.sumRange.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SUMIFS.functionParameter.criteriaRange1.name",
        detail: "formula.functionList.SUMIFS.functionParameter.criteriaRange1.detail",
        example: "B1:B20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SUMIFS.functionParameter.criteria1.name",
        detail: "formula.functionList.SUMIFS.functionParameter.criteria1.detail",
        example: '">10"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SUMIFS.functionParameter.criteriaRange2.name",
        detail: "formula.functionList.SUMIFS.functionParameter.criteriaRange2.detail",
        example: "C1:C20",
        require: 0,
        repeat: 1
      },
      {
        name: "formula.functionList.SUMIFS.functionParameter.criteria2.name",
        detail: "formula.functionList.SUMIFS.functionParameter.criteria2.detail",
        example: '"<20"',
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: F.SUMPRODUCT,
    functionType: Kc2.Math,
    description: "formula.functionList.SUMPRODUCT.description",
    abstract: "formula.functionList.SUMPRODUCT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.SUMPRODUCT.functionParameter.array1.name",
        detail: "formula.functionList.SUMPRODUCT.functionParameter.array1.detail",
        example: "C2:C5",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SUMPRODUCT.functionParameter.array2.name",
        detail: "formula.functionList.SUMPRODUCT.functionParameter.array2.detail",
        example: "D2:D5",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: F.SUMSQ,
    functionType: Kc2.Math,
    description: "formula.functionList.SUMSQ.description",
    abstract: "formula.functionList.SUMSQ.abstract",
    functionParameter: [
      {
        name: "formula.functionList.SUMSQ.functionParameter.number1.name",
        detail: "formula.functionList.SUMSQ.functionParameter.number1.detail",
        example: "3",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SUMSQ.functionParameter.number2.name",
        detail: "formula.functionList.SUMSQ.functionParameter.number2.detail",
        example: "4",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: F.SUMX2MY2,
    functionType: Kc2.Math,
    description: "formula.functionList.SUMX2MY2.description",
    abstract: "formula.functionList.SUMX2MY2.abstract",
    functionParameter: [
      {
        name: "formula.functionList.SUMX2MY2.functionParameter.arrayX.name",
        detail: "formula.functionList.SUMX2MY2.functionParameter.arrayX.detail",
        example: "A2:A8",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SUMX2MY2.functionParameter.arrayY.name",
        detail: "formula.functionList.SUMX2MY2.functionParameter.arrayY.detail",
        example: "B2:B8",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.SUMX2PY2,
    functionType: Kc2.Math,
    description: "formula.functionList.SUMX2PY2.description",
    abstract: "formula.functionList.SUMX2PY2.abstract",
    functionParameter: [
      {
        name: "formula.functionList.SUMX2PY2.functionParameter.arrayX.name",
        detail: "formula.functionList.SUMX2PY2.functionParameter.arrayX.detail",
        example: "A2:A8",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SUMX2PY2.functionParameter.arrayY.name",
        detail: "formula.functionList.SUMX2PY2.functionParameter.arrayY.detail",
        example: "B2:B8",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.SUMXMY2,
    functionType: Kc2.Math,
    description: "formula.functionList.SUMXMY2.description",
    abstract: "formula.functionList.SUMXMY2.abstract",
    functionParameter: [
      {
        name: "formula.functionList.SUMXMY2.functionParameter.arrayX.name",
        detail: "formula.functionList.SUMXMY2.functionParameter.arrayX.detail",
        example: "A2:A8",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SUMXMY2.functionParameter.arrayY.name",
        detail: "formula.functionList.SUMXMY2.functionParameter.arrayY.detail",
        example: "B2:B8",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.TAN,
    functionType: Kc2.Math,
    description: "formula.functionList.TAN.description",
    abstract: "formula.functionList.TAN.abstract",
    functionParameter: [
      {
        name: "formula.functionList.TAN.functionParameter.number.name",
        detail: "formula.functionList.TAN.functionParameter.number.detail",
        example: "1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.TANH,
    functionType: Kc2.Math,
    description: "formula.functionList.TANH.description",
    abstract: "formula.functionList.TANH.abstract",
    functionParameter: [
      {
        name: "formula.functionList.TANH.functionParameter.number.name",
        detail: "formula.functionList.TANH.functionParameter.number.detail",
        example: "1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: F.TRUNC,
    functionType: Kc2.Math,
    description: "formula.functionList.TRUNC.description",
    abstract: "formula.functionList.TRUNC.abstract",
    functionParameter: [
      {
        name: "formula.functionList.TRUNC.functionParameter.number.name",
        detail: "formula.functionList.TRUNC.functionParameter.number.detail",
        example: "0.45",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.TRUNC.functionParameter.numDigits.name",
        detail: "formula.functionList.TRUNC.functionParameter.numDigits.detail",
        example: "1",
        require: 0,
        repeat: 0
      }
    ]
  }
];
var Ur2 = [
  {
    functionName: P2.AVEDEV,
    functionType: Kc2.Statistical,
    description: "formula.functionList.AVEDEV.description",
    abstract: "formula.functionList.AVEDEV.abstract",
    functionParameter: [
      {
        name: "formula.functionList.AVEDEV.functionParameter.number1.name",
        detail: "formula.functionList.AVEDEV.functionParameter.number1.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.AVEDEV.functionParameter.number2.name",
        detail: "formula.functionList.AVEDEV.functionParameter.number2.detail",
        example: "B1:B20",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: P2.AVERAGE,
    aliasFunctionName: "formula.functionList.AVERAGE.aliasFunctionName",
    functionType: Kc2.Statistical,
    description: "formula.functionList.AVERAGE.description",
    abstract: "formula.functionList.AVERAGE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.AVERAGE.functionParameter.number1.name",
        detail: "formula.functionList.AVERAGE.functionParameter.number1.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.AVERAGE.functionParameter.number2.name",
        detail: "formula.functionList.AVERAGE.functionParameter.number2.detail",
        example: "B1:B20",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: P2.AVERAGE_WEIGHTED,
    aliasFunctionName: "formula.functionList.AVERAGE_WEIGHTED.aliasFunctionName",
    functionType: Kc2.Statistical,
    description: "formula.functionList.AVERAGE_WEIGHTED.description",
    abstract: "formula.functionList.AVERAGE_WEIGHTED.abstract",
    functionParameter: [
      {
        name: "formula.functionList.AVERAGE_WEIGHTED.functionParameter.values.name",
        detail: "formula.functionList.AVERAGE_WEIGHTED.functionParameter.values.detail",
        example: "10",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.AVERAGE_WEIGHTED.functionParameter.weights.name",
        detail: "formula.functionList.AVERAGE_WEIGHTED.functionParameter.weights.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.AVERAGE_WEIGHTED.functionParameter.additionalValues.name",
        detail: "formula.functionList.AVERAGE_WEIGHTED.functionParameter.additionalValues.detail",
        example: "20",
        require: 0,
        repeat: 1
      },
      {
        name: "formula.functionList.AVERAGE_WEIGHTED.functionParameter.additionalWeights.name",
        detail: "formula.functionList.AVERAGE_WEIGHTED.functionParameter.additionalWeights.detail",
        example: "3",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: P2.AVERAGEA,
    functionType: Kc2.Statistical,
    description: "formula.functionList.AVERAGEA.description",
    abstract: "formula.functionList.AVERAGEA.abstract",
    functionParameter: [
      {
        name: "formula.functionList.AVERAGEA.functionParameter.value1.name",
        detail: "formula.functionList.AVERAGEA.functionParameter.value1.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.AVERAGEA.functionParameter.value2.name",
        detail: "formula.functionList.AVERAGEA.functionParameter.value2.detail",
        example: "B1:B20",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: P2.AVERAGEIF,
    functionType: Kc2.Statistical,
    description: "formula.functionList.AVERAGEIF.description",
    abstract: "formula.functionList.AVERAGEIF.abstract",
    functionParameter: [
      {
        name: "formula.functionList.AVERAGEIF.functionParameter.range.name",
        detail: "formula.functionList.AVERAGEIF.functionParameter.range.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.AVERAGEIF.functionParameter.criteria.name",
        detail: "formula.functionList.AVERAGEIF.functionParameter.criteria.detail",
        example: '">5"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.AVERAGEIF.functionParameter.averageRange.name",
        detail: "formula.functionList.AVERAGEIF.functionParameter.averageRange.detail",
        example: "B1:B20",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.AVERAGEIFS,
    functionType: Kc2.Statistical,
    description: "formula.functionList.AVERAGEIFS.description",
    abstract: "formula.functionList.AVERAGEIFS.abstract",
    functionParameter: [
      {
        name: "formula.functionList.AVERAGEIFS.functionParameter.averageRange.name",
        detail: "formula.functionList.AVERAGEIFS.functionParameter.averageRange.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.AVERAGEIFS.functionParameter.criteriaRange1.name",
        detail: "formula.functionList.AVERAGEIFS.functionParameter.criteriaRange1.detail",
        example: "B1:B20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.AVERAGEIFS.functionParameter.criteria1.name",
        detail: "formula.functionList.AVERAGEIFS.functionParameter.criteria1.detail",
        example: '">10"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.AVERAGEIFS.functionParameter.criteriaRange2.name",
        detail: "formula.functionList.AVERAGEIFS.functionParameter.criteriaRange2.detail",
        example: "C1:C20",
        require: 0,
        repeat: 1
      },
      {
        name: "formula.functionList.AVERAGEIFS.functionParameter.criteria2.name",
        detail: "formula.functionList.AVERAGEIFS.functionParameter.criteria2.detail",
        example: '"<20"',
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: P2.BETA_DIST,
    functionType: Kc2.Statistical,
    description: "formula.functionList.BETA_DIST.description",
    abstract: "formula.functionList.BETA_DIST.abstract",
    functionParameter: [
      {
        name: "formula.functionList.BETA_DIST.functionParameter.x.name",
        detail: "formula.functionList.BETA_DIST.functionParameter.x.detail",
        example: "2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.BETA_DIST.functionParameter.alpha.name",
        detail: "formula.functionList.BETA_DIST.functionParameter.alpha.detail",
        example: "8",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.BETA_DIST.functionParameter.beta.name",
        detail: "formula.functionList.BETA_DIST.functionParameter.beta.detail",
        example: "10",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.BETA_DIST.functionParameter.cumulative.name",
        detail: "formula.functionList.BETA_DIST.functionParameter.cumulative.detail",
        example: "true",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.BETA_DIST.functionParameter.A.name",
        detail: "formula.functionList.BETA_DIST.functionParameter.A.detail",
        example: "1",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.BETA_DIST.functionParameter.B.name",
        detail: "formula.functionList.BETA_DIST.functionParameter.B.detail",
        example: "3",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.BETA_INV,
    functionType: Kc2.Statistical,
    description: "formula.functionList.BETA_INV.description",
    abstract: "formula.functionList.BETA_INV.abstract",
    functionParameter: [
      {
        name: "formula.functionList.BETA_INV.functionParameter.probability.name",
        detail: "formula.functionList.BETA_INV.functionParameter.probability.detail",
        example: "0.685470581",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.BETA_INV.functionParameter.alpha.name",
        detail: "formula.functionList.BETA_INV.functionParameter.alpha.detail",
        example: "8",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.BETA_INV.functionParameter.beta.name",
        detail: "formula.functionList.BETA_INV.functionParameter.beta.detail",
        example: "10",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.BETA_INV.functionParameter.A.name",
        detail: "formula.functionList.BETA_INV.functionParameter.A.detail",
        example: "1",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.BETA_INV.functionParameter.B.name",
        detail: "formula.functionList.BETA_INV.functionParameter.B.detail",
        example: "3",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.BINOM_DIST,
    functionType: Kc2.Statistical,
    description: "formula.functionList.BINOM_DIST.description",
    abstract: "formula.functionList.BINOM_DIST.abstract",
    functionParameter: [
      {
        name: "formula.functionList.BINOM_DIST.functionParameter.numberS.name",
        detail: "formula.functionList.BINOM_DIST.functionParameter.numberS.detail",
        example: "6",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.BINOM_DIST.functionParameter.trials.name",
        detail: "formula.functionList.BINOM_DIST.functionParameter.trials.detail",
        example: "10",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.BINOM_DIST.functionParameter.probabilityS.name",
        detail: "formula.functionList.BINOM_DIST.functionParameter.probabilityS.detail",
        example: "0.5",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.BINOM_DIST.functionParameter.cumulative.name",
        detail: "formula.functionList.BINOM_DIST.functionParameter.cumulative.detail",
        example: "false",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.BINOM_DIST_RANGE,
    functionType: Kc2.Statistical,
    description: "formula.functionList.BINOM_DIST_RANGE.description",
    abstract: "formula.functionList.BINOM_DIST_RANGE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.BINOM_DIST_RANGE.functionParameter.trials.name",
        detail: "formula.functionList.BINOM_DIST_RANGE.functionParameter.trials.detail",
        example: "60",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.BINOM_DIST_RANGE.functionParameter.probabilityS.name",
        detail: "formula.functionList.BINOM_DIST_RANGE.functionParameter.probabilityS.detail",
        example: "0.75",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.BINOM_DIST_RANGE.functionParameter.numberS.name",
        detail: "formula.functionList.BINOM_DIST_RANGE.functionParameter.numberS.detail",
        example: "45",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.BINOM_DIST_RANGE.functionParameter.numberS2.name",
        detail: "formula.functionList.BINOM_DIST_RANGE.functionParameter.numberS2.detail",
        example: "50",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.BINOM_INV,
    functionType: Kc2.Statistical,
    description: "formula.functionList.BINOM_INV.description",
    abstract: "formula.functionList.BINOM_INV.abstract",
    functionParameter: [
      {
        name: "formula.functionList.BINOM_INV.functionParameter.trials.name",
        detail: "formula.functionList.BINOM_INV.functionParameter.trials.detail",
        example: "6",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.BINOM_INV.functionParameter.probabilityS.name",
        detail: "formula.functionList.BINOM_INV.functionParameter.probabilityS.detail",
        example: "0.5",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.BINOM_INV.functionParameter.alpha.name",
        detail: "formula.functionList.BINOM_INV.functionParameter.alpha.detail",
        example: "0.75",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.CHISQ_DIST,
    functionType: Kc2.Statistical,
    description: "formula.functionList.CHISQ_DIST.description",
    abstract: "formula.functionList.CHISQ_DIST.abstract",
    functionParameter: [
      {
        name: "formula.functionList.CHISQ_DIST.functionParameter.x.name",
        detail: "formula.functionList.CHISQ_DIST.functionParameter.x.detail",
        example: "0.5",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CHISQ_DIST.functionParameter.degFreedom.name",
        detail: "formula.functionList.CHISQ_DIST.functionParameter.degFreedom.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CHISQ_DIST.functionParameter.cumulative.name",
        detail: "formula.functionList.CHISQ_DIST.functionParameter.cumulative.detail",
        example: "true",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.CHISQ_DIST_RT,
    functionType: Kc2.Statistical,
    description: "formula.functionList.CHISQ_DIST_RT.description",
    abstract: "formula.functionList.CHISQ_DIST_RT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.CHISQ_DIST_RT.functionParameter.x.name",
        detail: "formula.functionList.CHISQ_DIST_RT.functionParameter.x.detail",
        example: "0.5",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CHISQ_DIST_RT.functionParameter.degFreedom.name",
        detail: "formula.functionList.CHISQ_DIST_RT.functionParameter.degFreedom.detail",
        example: "1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.CHISQ_INV,
    functionType: Kc2.Statistical,
    description: "formula.functionList.CHISQ_INV.description",
    abstract: "formula.functionList.CHISQ_INV.abstract",
    functionParameter: [
      {
        name: "formula.functionList.CHISQ_INV.functionParameter.probability.name",
        detail: "formula.functionList.CHISQ_INV.functionParameter.probability.detail",
        example: "0.93",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CHISQ_INV.functionParameter.degFreedom.name",
        detail: "formula.functionList.CHISQ_INV.functionParameter.degFreedom.detail",
        example: "1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.CHISQ_INV_RT,
    functionType: Kc2.Statistical,
    description: "formula.functionList.CHISQ_INV_RT.description",
    abstract: "formula.functionList.CHISQ_INV_RT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.CHISQ_INV_RT.functionParameter.probability.name",
        detail: "formula.functionList.CHISQ_INV_RT.functionParameter.probability.detail",
        example: "0.93",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CHISQ_INV_RT.functionParameter.degFreedom.name",
        detail: "formula.functionList.CHISQ_INV_RT.functionParameter.degFreedom.detail",
        example: "1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.CHISQ_TEST,
    functionType: Kc2.Statistical,
    description: "formula.functionList.CHISQ_TEST.description",
    abstract: "formula.functionList.CHISQ_TEST.abstract",
    functionParameter: [
      {
        name: "formula.functionList.CHISQ_TEST.functionParameter.actualRange.name",
        detail: "formula.functionList.CHISQ_TEST.functionParameter.actualRange.detail",
        example: "A1:A4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CHISQ_TEST.functionParameter.expectedRange.name",
        detail: "formula.functionList.CHISQ_TEST.functionParameter.expectedRange.detail",
        example: "B1:B4",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.CONFIDENCE_NORM,
    functionType: Kc2.Statistical,
    description: "formula.functionList.CONFIDENCE_NORM.description",
    abstract: "formula.functionList.CONFIDENCE_NORM.abstract",
    functionParameter: [
      {
        name: "formula.functionList.CONFIDENCE_NORM.functionParameter.alpha.name",
        detail: "formula.functionList.CONFIDENCE_NORM.functionParameter.alpha.detail",
        example: "0.05",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CONFIDENCE_NORM.functionParameter.standardDev.name",
        detail: "formula.functionList.CONFIDENCE_NORM.functionParameter.standardDev.detail",
        example: "2.5",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CONFIDENCE_NORM.functionParameter.size.name",
        detail: "formula.functionList.CONFIDENCE_NORM.functionParameter.size.detail",
        example: "50",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.CONFIDENCE_T,
    functionType: Kc2.Statistical,
    description: "formula.functionList.CONFIDENCE_T.description",
    abstract: "formula.functionList.CONFIDENCE_T.abstract",
    functionParameter: [
      {
        name: "formula.functionList.CONFIDENCE_T.functionParameter.alpha.name",
        detail: "formula.functionList.CONFIDENCE_T.functionParameter.alpha.detail",
        example: "0.05",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CONFIDENCE_T.functionParameter.standardDev.name",
        detail: "formula.functionList.CONFIDENCE_T.functionParameter.standardDev.detail",
        example: "2.5",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CONFIDENCE_T.functionParameter.size.name",
        detail: "formula.functionList.CONFIDENCE_T.functionParameter.size.detail",
        example: "50",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.CORREL,
    functionType: Kc2.Statistical,
    description: "formula.functionList.CORREL.description",
    abstract: "formula.functionList.CORREL.abstract",
    functionParameter: [
      {
        name: "formula.functionList.CORREL.functionParameter.array1.name",
        detail: "formula.functionList.CORREL.functionParameter.array1.detail",
        example: "A1:A4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CORREL.functionParameter.array2.name",
        detail: "formula.functionList.CORREL.functionParameter.array2.detail",
        example: "B1:B4",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.COUNT,
    aliasFunctionName: "formula.functionList.COUNT.aliasFunctionName",
    functionType: Kc2.Statistical,
    description: "formula.functionList.COUNT.description",
    abstract: "formula.functionList.COUNT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.COUNT.functionParameter.value1.name",
        detail: "formula.functionList.COUNT.functionParameter.value1.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.COUNT.functionParameter.value2.name",
        detail: "formula.functionList.COUNT.functionParameter.value2.detail",
        example: "B2:B10",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: P2.COUNTA,
    aliasFunctionName: "formula.functionList.COUNTA.aliasFunctionName",
    functionType: Kc2.Statistical,
    description: "formula.functionList.COUNTA.description",
    abstract: "formula.functionList.COUNTA.abstract",
    functionParameter: [
      {
        name: "formula.functionList.COUNTA.functionParameter.number1.name",
        detail: "formula.functionList.COUNTA.functionParameter.number1.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.COUNTA.functionParameter.number2.name",
        detail: "formula.functionList.COUNTA.functionParameter.number2.detail",
        example: "B2:B10",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: P2.COUNTBLANK,
    functionType: Kc2.Statistical,
    description: "formula.functionList.COUNTBLANK.description",
    abstract: "formula.functionList.COUNTBLANK.abstract",
    functionParameter: [
      {
        name: "formula.functionList.COUNTBLANK.functionParameter.range.name",
        detail: "formula.functionList.COUNTBLANK.functionParameter.range.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.COUNTIF,
    functionType: Kc2.Statistical,
    description: "formula.functionList.COUNTIF.description",
    abstract: "formula.functionList.COUNTIF.abstract",
    functionParameter: [
      {
        name: "formula.functionList.COUNTIF.functionParameter.range.name",
        detail: "formula.functionList.COUNTIF.functionParameter.range.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.COUNTIF.functionParameter.criteria.name",
        detail: "formula.functionList.COUNTIF.functionParameter.criteria.detail",
        example: '">5"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.COUNTIFS,
    functionType: Kc2.Statistical,
    description: "formula.functionList.COUNTIFS.description",
    abstract: "formula.functionList.COUNTIFS.abstract",
    functionParameter: [
      {
        name: "formula.functionList.COUNTIFS.functionParameter.criteriaRange1.name",
        detail: "formula.functionList.COUNTIFS.functionParameter.criteriaRange1.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.COUNTIFS.functionParameter.criteria1.name",
        detail: "formula.functionList.COUNTIFS.functionParameter.criteria1.detail",
        example: '">10"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.COUNTIFS.functionParameter.criteriaRange2.name",
        detail: "formula.functionList.COUNTIFS.functionParameter.criteriaRange2.detail",
        example: "B1:B20",
        require: 0,
        repeat: 1
      },
      {
        name: "formula.functionList.COUNTIFS.functionParameter.criteria2.name",
        detail: "formula.functionList.COUNTIFS.functionParameter.criteria2.detail",
        example: '"<20"',
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: P2.COVARIANCE_P,
    functionType: Kc2.Statistical,
    description: "formula.functionList.COVARIANCE_P.description",
    abstract: "formula.functionList.COVARIANCE_P.abstract",
    functionParameter: [
      {
        name: "formula.functionList.COVARIANCE_P.functionParameter.array1.name",
        detail: "formula.functionList.COVARIANCE_P.functionParameter.array1.detail",
        example: "A1:A4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.COVARIANCE_P.functionParameter.array2.name",
        detail: "formula.functionList.COVARIANCE_P.functionParameter.array2.detail",
        example: "B1:B4",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.COVARIANCE_S,
    functionType: Kc2.Statistical,
    description: "formula.functionList.COVARIANCE_S.description",
    abstract: "formula.functionList.COVARIANCE_S.abstract",
    functionParameter: [
      {
        name: "formula.functionList.COVARIANCE_S.functionParameter.array1.name",
        detail: "formula.functionList.COVARIANCE_S.functionParameter.array1.detail",
        example: "A1:A4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.COVARIANCE_S.functionParameter.array2.name",
        detail: "formula.functionList.COVARIANCE_S.functionParameter.array2.detail",
        example: "B1:B4",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.DEVSQ,
    functionType: Kc2.Statistical,
    description: "formula.functionList.DEVSQ.description",
    abstract: "formula.functionList.DEVSQ.abstract",
    functionParameter: [
      {
        name: "formula.functionList.DEVSQ.functionParameter.number1.name",
        detail: "formula.functionList.DEVSQ.functionParameter.number1.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DEVSQ.functionParameter.number2.name",
        detail: "formula.functionList.DEVSQ.functionParameter.number2.detail",
        example: "2",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: P2.EXPON_DIST,
    functionType: Kc2.Statistical,
    description: "formula.functionList.EXPON_DIST.description",
    abstract: "formula.functionList.EXPON_DIST.abstract",
    functionParameter: [
      {
        name: "formula.functionList.EXPON_DIST.functionParameter.x.name",
        detail: "formula.functionList.EXPON_DIST.functionParameter.x.detail",
        example: "0.2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.EXPON_DIST.functionParameter.lambda.name",
        detail: "formula.functionList.EXPON_DIST.functionParameter.lambda.detail",
        example: "10",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.EXPON_DIST.functionParameter.cumulative.name",
        detail: "formula.functionList.EXPON_DIST.functionParameter.cumulative.detail",
        example: "true",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.F_DIST,
    functionType: Kc2.Statistical,
    description: "formula.functionList.F_DIST.description",
    abstract: "formula.functionList.F_DIST.abstract",
    functionParameter: [
      {
        name: "formula.functionList.F_DIST.functionParameter.x.name",
        detail: "formula.functionList.F_DIST.functionParameter.x.detail",
        example: "15.2069",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.F_DIST.functionParameter.degFreedom1.name",
        detail: "formula.functionList.F_DIST.functionParameter.degFreedom1.detail",
        example: "6",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.F_DIST.functionParameter.degFreedom2.name",
        detail: "formula.functionList.F_DIST.functionParameter.degFreedom2.detail",
        example: "4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.F_DIST.functionParameter.cumulative.name",
        detail: "formula.functionList.F_DIST.functionParameter.cumulative.detail",
        example: "true",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.F_DIST_RT,
    functionType: Kc2.Statistical,
    description: "formula.functionList.F_DIST_RT.description",
    abstract: "formula.functionList.F_DIST_RT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.F_DIST_RT.functionParameter.x.name",
        detail: "formula.functionList.F_DIST_RT.functionParameter.x.detail",
        example: "15.2069",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.F_DIST_RT.functionParameter.degFreedom1.name",
        detail: "formula.functionList.F_DIST_RT.functionParameter.degFreedom1.detail",
        example: "6",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.F_DIST_RT.functionParameter.degFreedom2.name",
        detail: "formula.functionList.F_DIST_RT.functionParameter.degFreedom2.detail",
        example: "4",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.F_INV,
    functionType: Kc2.Statistical,
    description: "formula.functionList.F_INV.description",
    abstract: "formula.functionList.F_INV.abstract",
    functionParameter: [
      {
        name: "formula.functionList.F_INV.functionParameter.probability.name",
        detail: "formula.functionList.F_INV.functionParameter.probability.detail",
        example: "0.01",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.F_INV.functionParameter.degFreedom1.name",
        detail: "formula.functionList.F_INV.functionParameter.degFreedom1.detail",
        example: "6",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.F_INV.functionParameter.degFreedom2.name",
        detail: "formula.functionList.F_INV.functionParameter.degFreedom2.detail",
        example: "4",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.F_INV_RT,
    functionType: Kc2.Statistical,
    description: "formula.functionList.F_INV_RT.description",
    abstract: "formula.functionList.F_INV_RT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.F_INV_RT.functionParameter.probability.name",
        detail: "formula.functionList.F_INV_RT.functionParameter.probability.detail",
        example: "0.01",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.F_INV_RT.functionParameter.degFreedom1.name",
        detail: "formula.functionList.F_INV_RT.functionParameter.degFreedom1.detail",
        example: "6",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.F_INV_RT.functionParameter.degFreedom2.name",
        detail: "formula.functionList.F_INV_RT.functionParameter.degFreedom2.detail",
        example: "4",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.F_TEST,
    functionType: Kc2.Statistical,
    description: "formula.functionList.F_TEST.description",
    abstract: "formula.functionList.F_TEST.abstract",
    functionParameter: [
      {
        name: "formula.functionList.F_TEST.functionParameter.array1.name",
        detail: "formula.functionList.F_TEST.functionParameter.array1.detail",
        example: "A1:A4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.F_TEST.functionParameter.array2.name",
        detail: "formula.functionList.F_TEST.functionParameter.array2.detail",
        example: "B1:B4",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.FISHER,
    functionType: Kc2.Statistical,
    description: "formula.functionList.FISHER.description",
    abstract: "formula.functionList.FISHER.abstract",
    functionParameter: [
      {
        name: "formula.functionList.FISHER.functionParameter.x.name",
        detail: "formula.functionList.FISHER.functionParameter.x.detail",
        example: "0.75",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.FISHERINV,
    functionType: Kc2.Statistical,
    description: "formula.functionList.FISHERINV.description",
    abstract: "formula.functionList.FISHERINV.abstract",
    functionParameter: [
      {
        name: "formula.functionList.FISHERINV.functionParameter.y.name",
        detail: "formula.functionList.FISHERINV.functionParameter.y.detail",
        example: "0.75",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.FORECAST,
    functionType: Kc2.Statistical,
    description: "formula.functionList.FORECAST.description",
    abstract: "formula.functionList.FORECAST.abstract",
    functionParameter: [
      {
        name: "formula.functionList.FORECAST.functionParameter.x.name",
        detail: "formula.functionList.FORECAST.functionParameter.x.detail",
        example: "30",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.FORECAST.functionParameter.knownYs.name",
        detail: "formula.functionList.FORECAST.functionParameter.knownYs.detail",
        example: "A1:A4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.FORECAST.functionParameter.knownXs.name",
        detail: "formula.functionList.FORECAST.functionParameter.knownXs.detail",
        example: "B1:B4",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.FORECAST_ETS,
    functionType: Kc2.Statistical,
    description: "formula.functionList.FORECAST_ETS.description",
    abstract: "formula.functionList.FORECAST_ETS.abstract",
    functionParameter: [
      {
        name: "formula.functionList.FORECAST_ETS.functionParameter.number1.name",
        detail: "formula.functionList.FORECAST_ETS.functionParameter.number1.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.FORECAST_ETS.functionParameter.number2.name",
        detail: "formula.functionList.FORECAST_ETS.functionParameter.number2.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.FORECAST_ETS_CONFINT,
    functionType: Kc2.Statistical,
    description: "formula.functionList.FORECAST_ETS_CONFINT.description",
    abstract: "formula.functionList.FORECAST_ETS_CONFINT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.FORECAST_ETS_CONFINT.functionParameter.number1.name",
        detail: "formula.functionList.FORECAST_ETS_CONFINT.functionParameter.number1.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.FORECAST_ETS_CONFINT.functionParameter.number2.name",
        detail: "formula.functionList.FORECAST_ETS_CONFINT.functionParameter.number2.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.FORECAST_ETS_SEASONALITY,
    functionType: Kc2.Statistical,
    description: "formula.functionList.FORECAST_ETS_SEASONALITY.description",
    abstract: "formula.functionList.FORECAST_ETS_SEASONALITY.abstract",
    functionParameter: [
      {
        name: "formula.functionList.FORECAST_ETS_SEASONALITY.functionParameter.number1.name",
        detail: "formula.functionList.FORECAST_ETS_SEASONALITY.functionParameter.number1.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.FORECAST_ETS_SEASONALITY.functionParameter.number2.name",
        detail: "formula.functionList.FORECAST_ETS_SEASONALITY.functionParameter.number2.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.FORECAST_ETS_STAT,
    functionType: Kc2.Statistical,
    description: "formula.functionList.FORECAST_ETS_STAT.description",
    abstract: "formula.functionList.FORECAST_ETS_STAT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.FORECAST_ETS_STAT.functionParameter.number1.name",
        detail: "formula.functionList.FORECAST_ETS_STAT.functionParameter.number1.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.FORECAST_ETS_STAT.functionParameter.number2.name",
        detail: "formula.functionList.FORECAST_ETS_STAT.functionParameter.number2.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.FORECAST_LINEAR,
    functionType: Kc2.Statistical,
    description: "formula.functionList.FORECAST_LINEAR.description",
    abstract: "formula.functionList.FORECAST_LINEAR.abstract",
    functionParameter: [
      {
        name: "formula.functionList.FORECAST_LINEAR.functionParameter.x.name",
        detail: "formula.functionList.FORECAST_LINEAR.functionParameter.x.detail",
        example: "30",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.FORECAST_LINEAR.functionParameter.knownYs.name",
        detail: "formula.functionList.FORECAST_LINEAR.functionParameter.knownYs.detail",
        example: "A1:A4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.FORECAST_LINEAR.functionParameter.knownXs.name",
        detail: "formula.functionList.FORECAST_LINEAR.functionParameter.knownXs.detail",
        example: "B1:B4",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.FREQUENCY,
    functionType: Kc2.Statistical,
    description: "formula.functionList.FREQUENCY.description",
    abstract: "formula.functionList.FREQUENCY.abstract",
    functionParameter: [
      {
        name: "formula.functionList.FREQUENCY.functionParameter.dataArray.name",
        detail: "formula.functionList.FREQUENCY.functionParameter.dataArray.detail",
        example: "A2:A10",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.FREQUENCY.functionParameter.binsArray.name",
        detail: "formula.functionList.FREQUENCY.functionParameter.binsArray.detail",
        example: "B2:B4",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.GAMMA,
    functionType: Kc2.Statistical,
    description: "formula.functionList.GAMMA.description",
    abstract: "formula.functionList.GAMMA.abstract",
    functionParameter: [
      {
        name: "formula.functionList.GAMMA.functionParameter.number.name",
        detail: "formula.functionList.GAMMA.functionParameter.number.detail",
        example: "2.5",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.GAMMA_DIST,
    functionType: Kc2.Statistical,
    description: "formula.functionList.GAMMA_DIST.description",
    abstract: "formula.functionList.GAMMA_DIST.abstract",
    functionParameter: [
      {
        name: "formula.functionList.GAMMA_DIST.functionParameter.x.name",
        detail: "formula.functionList.GAMMA_DIST.functionParameter.x.detail",
        example: "10",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.GAMMA_DIST.functionParameter.alpha.name",
        detail: "formula.functionList.GAMMA_DIST.functionParameter.alpha.detail",
        example: "8",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.GAMMA_DIST.functionParameter.beta.name",
        detail: "formula.functionList.GAMMA_DIST.functionParameter.beta.detail",
        example: "2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.GAMMA_DIST.functionParameter.cumulative.name",
        detail: "formula.functionList.GAMMA_DIST.functionParameter.cumulative.detail",
        example: "true",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.GAMMA_INV,
    functionType: Kc2.Statistical,
    description: "formula.functionList.GAMMA_INV.description",
    abstract: "formula.functionList.GAMMA_INV.abstract",
    functionParameter: [
      {
        name: "formula.functionList.GAMMA_INV.functionParameter.probability.name",
        detail: "formula.functionList.GAMMA_INV.functionParameter.probability.detail",
        example: "0.068094",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.GAMMA_INV.functionParameter.alpha.name",
        detail: "formula.functionList.GAMMA_INV.functionParameter.alpha.detail",
        example: "9",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.GAMMA_INV.functionParameter.beta.name",
        detail: "formula.functionList.GAMMA_INV.functionParameter.beta.detail",
        example: "2",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.GAMMALN,
    functionType: Kc2.Statistical,
    description: "formula.functionList.GAMMALN.description",
    abstract: "formula.functionList.GAMMALN.abstract",
    functionParameter: [
      {
        name: "formula.functionList.GAMMALN.functionParameter.x.name",
        detail: "formula.functionList.GAMMALN.functionParameter.x.detail",
        example: "4",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.GAMMALN_PRECISE,
    functionType: Kc2.Statistical,
    description: "formula.functionList.GAMMALN_PRECISE.description",
    abstract: "formula.functionList.GAMMALN_PRECISE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.GAMMALN_PRECISE.functionParameter.x.name",
        detail: "formula.functionList.GAMMALN_PRECISE.functionParameter.x.detail",
        example: "4",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.GAUSS,
    functionType: Kc2.Statistical,
    description: "formula.functionList.GAUSS.description",
    abstract: "formula.functionList.GAUSS.abstract",
    functionParameter: [
      {
        name: "formula.functionList.GAUSS.functionParameter.z.name",
        detail: "formula.functionList.GAUSS.functionParameter.z.detail",
        example: "2",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.GEOMEAN,
    functionType: Kc2.Statistical,
    description: "formula.functionList.GEOMEAN.description",
    abstract: "formula.functionList.GEOMEAN.abstract",
    functionParameter: [
      {
        name: "formula.functionList.GEOMEAN.functionParameter.number1.name",
        detail: "formula.functionList.GEOMEAN.functionParameter.number1.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.GEOMEAN.functionParameter.number2.name",
        detail: "formula.functionList.GEOMEAN.functionParameter.number2.detail",
        example: "2",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: P2.GROWTH,
    functionType: Kc2.Statistical,
    description: "formula.functionList.GROWTH.description",
    abstract: "formula.functionList.GROWTH.abstract",
    functionParameter: [
      {
        name: "formula.functionList.GROWTH.functionParameter.knownYs.name",
        detail: "formula.functionList.GROWTH.functionParameter.knownYs.detail",
        example: "B2:B7",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.GROWTH.functionParameter.knownXs.name",
        detail: "formula.functionList.GROWTH.functionParameter.knownXs.detail",
        example: "A2:A7",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.GROWTH.functionParameter.newXs.name",
        detail: "formula.functionList.GROWTH.functionParameter.newXs.detail",
        example: "A9:A10",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.GROWTH.functionParameter.constb.name",
        detail: "formula.functionList.GROWTH.functionParameter.constb.detail",
        example: "true",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.HARMEAN,
    functionType: Kc2.Statistical,
    description: "formula.functionList.HARMEAN.description",
    abstract: "formula.functionList.HARMEAN.abstract",
    functionParameter: [
      {
        name: "formula.functionList.HARMEAN.functionParameter.number1.name",
        detail: "formula.functionList.HARMEAN.functionParameter.number1.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.HARMEAN.functionParameter.number2.name",
        detail: "formula.functionList.HARMEAN.functionParameter.number2.detail",
        example: "2",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: P2.HYPGEOM_DIST,
    functionType: Kc2.Statistical,
    description: "formula.functionList.HYPGEOM_DIST.description",
    abstract: "formula.functionList.HYPGEOM_DIST.abstract",
    functionParameter: [
      {
        name: "formula.functionList.HYPGEOM_DIST.functionParameter.sampleS.name",
        detail: "formula.functionList.HYPGEOM_DIST.functionParameter.sampleS.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.HYPGEOM_DIST.functionParameter.numberSample.name",
        detail: "formula.functionList.HYPGEOM_DIST.functionParameter.numberSample.detail",
        example: "4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.HYPGEOM_DIST.functionParameter.populationS.name",
        detail: "formula.functionList.HYPGEOM_DIST.functionParameter.populationS.detail",
        example: "8",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.HYPGEOM_DIST.functionParameter.numberPop.name",
        detail: "formula.functionList.HYPGEOM_DIST.functionParameter.numberPop.detail",
        example: "20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.HYPGEOM_DIST.functionParameter.cumulative.name",
        detail: "formula.functionList.HYPGEOM_DIST.functionParameter.cumulative.detail",
        example: "true",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.INTERCEPT,
    functionType: Kc2.Statistical,
    description: "formula.functionList.INTERCEPT.description",
    abstract: "formula.functionList.INTERCEPT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.INTERCEPT.functionParameter.knownYs.name",
        detail: "formula.functionList.INTERCEPT.functionParameter.knownYs.detail",
        example: "A1:A4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.INTERCEPT.functionParameter.knownXs.name",
        detail: "formula.functionList.INTERCEPT.functionParameter.knownXs.detail",
        example: "B1:B4",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.KURT,
    functionType: Kc2.Statistical,
    description: "formula.functionList.KURT.description",
    abstract: "formula.functionList.KURT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.KURT.functionParameter.number1.name",
        detail: "formula.functionList.KURT.functionParameter.number1.detail",
        example: "A1:A4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.KURT.functionParameter.number2.name",
        detail: "formula.functionList.KURT.functionParameter.number2.detail",
        example: "4",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: P2.LARGE,
    functionType: Kc2.Statistical,
    description: "formula.functionList.LARGE.description",
    abstract: "formula.functionList.LARGE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.LARGE.functionParameter.array.name",
        detail: "formula.functionList.LARGE.functionParameter.array.detail",
        example: "A2:B6",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.LARGE.functionParameter.k.name",
        detail: "formula.functionList.LARGE.functionParameter.k.detail",
        example: "3",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.LINEST,
    functionType: Kc2.Statistical,
    description: "formula.functionList.LINEST.description",
    abstract: "formula.functionList.LINEST.abstract",
    functionParameter: [
      {
        name: "formula.functionList.LINEST.functionParameter.knownYs.name",
        detail: "formula.functionList.LINEST.functionParameter.knownYs.detail",
        example: "B2:B7",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.LINEST.functionParameter.knownXs.name",
        detail: "formula.functionList.LINEST.functionParameter.knownXs.detail",
        example: "A2:A7",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.LINEST.functionParameter.constb.name",
        detail: "formula.functionList.LINEST.functionParameter.constb.detail",
        example: "true",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.LINEST.functionParameter.stats.name",
        detail: "formula.functionList.LINEST.functionParameter.stats.detail",
        example: "true",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.LOGEST,
    functionType: Kc2.Statistical,
    description: "formula.functionList.LOGEST.description",
    abstract: "formula.functionList.LOGEST.abstract",
    functionParameter: [
      {
        name: "formula.functionList.LOGEST.functionParameter.knownYs.name",
        detail: "formula.functionList.LOGEST.functionParameter.knownYs.detail",
        example: "B2:B7",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.LOGEST.functionParameter.knownXs.name",
        detail: "formula.functionList.LOGEST.functionParameter.knownXs.detail",
        example: "A2:A7",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.LOGEST.functionParameter.constb.name",
        detail: "formula.functionList.LOGEST.functionParameter.constb.detail",
        example: "true",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.LOGEST.functionParameter.stats.name",
        detail: "formula.functionList.LOGEST.functionParameter.stats.detail",
        example: "true",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.LOGNORM_DIST,
    functionType: Kc2.Statistical,
    description: "formula.functionList.LOGNORM_DIST.description",
    abstract: "formula.functionList.LOGNORM_DIST.abstract",
    functionParameter: [
      {
        name: "formula.functionList.LOGNORM_DIST.functionParameter.x.name",
        detail: "formula.functionList.LOGNORM_DIST.functionParameter.x.detail",
        example: "42",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.LOGNORM_DIST.functionParameter.mean.name",
        detail: "formula.functionList.LOGNORM_DIST.functionParameter.mean.detail",
        example: "40",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.LOGNORM_DIST.functionParameter.standardDev.name",
        detail: "formula.functionList.LOGNORM_DIST.functionParameter.standardDev.detail",
        example: "1.5",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.LOGNORM_DIST.functionParameter.cumulative.name",
        detail: "formula.functionList.LOGNORM_DIST.functionParameter.cumulative.detail",
        example: "true",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.LOGNORM_INV,
    functionType: Kc2.Statistical,
    description: "formula.functionList.LOGNORM_INV.description",
    abstract: "formula.functionList.LOGNORM_INV.abstract",
    functionParameter: [
      {
        name: "formula.functionList.LOGNORM_INV.functionParameter.probability.name",
        detail: "formula.functionList.LOGNORM_INV.functionParameter.probability.detail",
        example: "0.908789",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.LOGNORM_INV.functionParameter.mean.name",
        detail: "formula.functionList.LOGNORM_INV.functionParameter.mean.detail",
        example: "40",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.LOGNORM_INV.functionParameter.standardDev.name",
        detail: "formula.functionList.LOGNORM_INV.functionParameter.standardDev.detail",
        example: "1.5",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.MARGINOFERROR,
    aliasFunctionName: "formula.functionList.MARGINOFERROR.aliasFunctionName",
    functionType: Kc2.Statistical,
    description: "formula.functionList.MARGINOFERROR.description",
    abstract: "formula.functionList.MARGINOFERROR.abstract",
    functionParameter: [
      {
        name: "formula.functionList.MARGINOFERROR.functionParameter.range.name",
        detail: "formula.functionList.MARGINOFERROR.functionParameter.range.detail",
        example: "A1:A4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.MARGINOFERROR.functionParameter.confidence.name",
        detail: "formula.functionList.MARGINOFERROR.functionParameter.confidence.detail",
        example: "0.95",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.MAX,
    aliasFunctionName: "formula.functionList.MAX.aliasFunctionName",
    functionType: Kc2.Statistical,
    description: "formula.functionList.MAX.description",
    abstract: "formula.functionList.MAX.abstract",
    functionParameter: [
      {
        name: "formula.functionList.MAX.functionParameter.number1.name",
        detail: "formula.functionList.MAX.functionParameter.number1.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.MAX.functionParameter.number2.name",
        detail: "formula.functionList.MAX.functionParameter.number2.detail",
        example: "B2:B10",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: P2.MAXA,
    functionType: Kc2.Statistical,
    description: "formula.functionList.MAXA.description",
    abstract: "formula.functionList.MAXA.abstract",
    functionParameter: [
      {
        name: "formula.functionList.MAXA.functionParameter.value1.name",
        detail: "formula.functionList.MAXA.functionParameter.value1.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.MAXA.functionParameter.value2.name",
        detail: "formula.functionList.MAXA.functionParameter.value2.detail",
        example: "B1:B20",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: P2.MAXIFS,
    functionType: Kc2.Statistical,
    description: "formula.functionList.MAXIFS.description",
    abstract: "formula.functionList.MAXIFS.abstract",
    functionParameter: [
      {
        name: "formula.functionList.MAXIFS.functionParameter.maxRange.name",
        detail: "formula.functionList.MAXIFS.functionParameter.maxRange.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.MAXIFS.functionParameter.criteriaRange1.name",
        detail: "formula.functionList.MAXIFS.functionParameter.criteriaRange1.detail",
        example: "B1:B20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.MAXIFS.functionParameter.criteria1.name",
        detail: "formula.functionList.MAXIFS.functionParameter.criteria1.detail",
        example: '">10"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.MAXIFS.functionParameter.criteriaRange2.name",
        detail: "formula.functionList.MAXIFS.functionParameter.criteriaRange2.detail",
        example: "C1:C20",
        require: 0,
        repeat: 1
      },
      {
        name: "formula.functionList.MAXIFS.functionParameter.criteria2.name",
        detail: "formula.functionList.MAXIFS.functionParameter.criteria2.detail",
        example: '"<20"',
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: P2.MEDIAN,
    functionType: Kc2.Statistical,
    description: "formula.functionList.MEDIAN.description",
    abstract: "formula.functionList.MEDIAN.abstract",
    functionParameter: [
      {
        name: "formula.functionList.MEDIAN.functionParameter.number1.name",
        detail: "formula.functionList.MEDIAN.functionParameter.number1.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.MEDIAN.functionParameter.number2.name",
        detail: "formula.functionList.MEDIAN.functionParameter.number2.detail",
        example: "2",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: P2.MIN,
    aliasFunctionName: "formula.functionList.MIN.aliasFunctionName",
    functionType: Kc2.Statistical,
    description: "formula.functionList.MIN.description",
    abstract: "formula.functionList.MIN.abstract",
    functionParameter: [
      {
        name: "formula.functionList.MIN.functionParameter.number1.name",
        detail: "formula.functionList.MIN.functionParameter.number1.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.MIN.functionParameter.number2.name",
        detail: "formula.functionList.MIN.functionParameter.number2.detail",
        example: "B2:B10",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: P2.MINA,
    functionType: Kc2.Statistical,
    description: "formula.functionList.MINA.description",
    abstract: "formula.functionList.MINA.abstract",
    functionParameter: [
      {
        name: "formula.functionList.MINA.functionParameter.value1.name",
        detail: "formula.functionList.MINA.functionParameter.value1.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.MINA.functionParameter.value2.name",
        detail: "formula.functionList.MINA.functionParameter.value2.detail",
        example: "B1:B20",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: P2.MINIFS,
    functionType: Kc2.Statistical,
    description: "formula.functionList.MINIFS.description",
    abstract: "formula.functionList.MINIFS.abstract",
    functionParameter: [
      {
        name: "formula.functionList.MINIFS.functionParameter.minRange.name",
        detail: "formula.functionList.MINIFS.functionParameter.minRange.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.MINIFS.functionParameter.criteriaRange1.name",
        detail: "formula.functionList.MINIFS.functionParameter.criteriaRange1.detail",
        example: "B1:B20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.MINIFS.functionParameter.criteria1.name",
        detail: "formula.functionList.MINIFS.functionParameter.criteria1.detail",
        example: '">10"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.MINIFS.functionParameter.criteriaRange2.name",
        detail: "formula.functionList.MINIFS.functionParameter.criteriaRange2.detail",
        example: "C1:C20",
        require: 0,
        repeat: 1
      },
      {
        name: "formula.functionList.MINIFS.functionParameter.criteria2.name",
        detail: "formula.functionList.MINIFS.functionParameter.criteria2.detail",
        example: '"<20"',
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: P2.MODE_MULT,
    functionType: Kc2.Statistical,
    description: "formula.functionList.MODE_MULT.description",
    abstract: "formula.functionList.MODE_MULT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.MODE_MULT.functionParameter.number1.name",
        detail: "formula.functionList.MODE_MULT.functionParameter.number1.detail",
        example: "A1:A4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.MODE_MULT.functionParameter.number2.name",
        detail: "formula.functionList.MODE_MULT.functionParameter.number2.detail",
        example: "2",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: P2.MODE_SNGL,
    functionType: Kc2.Statistical,
    description: "formula.functionList.MODE_SNGL.description",
    abstract: "formula.functionList.MODE_SNGL.abstract",
    functionParameter: [
      {
        name: "formula.functionList.MODE_SNGL.functionParameter.number1.name",
        detail: "formula.functionList.MODE_SNGL.functionParameter.number1.detail",
        example: "A1:A4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.MODE_SNGL.functionParameter.number2.name",
        detail: "formula.functionList.MODE_SNGL.functionParameter.number2.detail",
        example: "2",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: P2.NEGBINOM_DIST,
    functionType: Kc2.Statistical,
    description: "formula.functionList.NEGBINOM_DIST.description",
    abstract: "formula.functionList.NEGBINOM_DIST.abstract",
    functionParameter: [
      {
        name: "formula.functionList.NEGBINOM_DIST.functionParameter.numberF.name",
        detail: "formula.functionList.NEGBINOM_DIST.functionParameter.numberF.detail",
        example: "10",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.NEGBINOM_DIST.functionParameter.numberS.name",
        detail: "formula.functionList.NEGBINOM_DIST.functionParameter.numberS.detail",
        example: "5",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.NEGBINOM_DIST.functionParameter.probabilityS.name",
        detail: "formula.functionList.NEGBINOM_DIST.functionParameter.probabilityS.detail",
        example: "0.25",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.NEGBINOM_DIST.functionParameter.cumulative.name",
        detail: "formula.functionList.NEGBINOM_DIST.functionParameter.cumulative.detail",
        example: "true",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.NORM_DIST,
    functionType: Kc2.Statistical,
    description: "formula.functionList.NORM_DIST.description",
    abstract: "formula.functionList.NORM_DIST.abstract",
    functionParameter: [
      {
        name: "formula.functionList.NORM_DIST.functionParameter.x.name",
        detail: "formula.functionList.NORM_DIST.functionParameter.x.detail",
        example: "42",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.NORM_DIST.functionParameter.mean.name",
        detail: "formula.functionList.NORM_DIST.functionParameter.mean.detail",
        example: "40",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.NORM_DIST.functionParameter.standardDev.name",
        detail: "formula.functionList.NORM_DIST.functionParameter.standardDev.detail",
        example: "1.5",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.NORM_DIST.functionParameter.cumulative.name",
        detail: "formula.functionList.NORM_DIST.functionParameter.cumulative.detail",
        example: "true",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.NORM_INV,
    functionType: Kc2.Statistical,
    description: "formula.functionList.NORM_INV.description",
    abstract: "formula.functionList.NORM_INV.abstract",
    functionParameter: [
      {
        name: "formula.functionList.NORM_INV.functionParameter.probability.name",
        detail: "formula.functionList.NORM_INV.functionParameter.probability.detail",
        example: "0.908789",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.NORM_INV.functionParameter.mean.name",
        detail: "formula.functionList.NORM_INV.functionParameter.mean.detail",
        example: "40",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.NORM_INV.functionParameter.standardDev.name",
        detail: "formula.functionList.NORM_INV.functionParameter.standardDev.detail",
        example: "1.5",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.NORM_S_DIST,
    functionType: Kc2.Statistical,
    description: "formula.functionList.NORM_S_DIST.description",
    abstract: "formula.functionList.NORM_S_DIST.abstract",
    functionParameter: [
      {
        name: "formula.functionList.NORM_S_DIST.functionParameter.z.name",
        detail: "formula.functionList.NORM_S_DIST.functionParameter.z.detail",
        example: "1.333333",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.NORM_S_DIST.functionParameter.cumulative.name",
        detail: "formula.functionList.NORM_S_DIST.functionParameter.cumulative.detail",
        example: "true",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.NORM_S_INV,
    functionType: Kc2.Statistical,
    description: "formula.functionList.NORM_S_INV.description",
    abstract: "formula.functionList.NORM_S_INV.abstract",
    functionParameter: [
      {
        name: "formula.functionList.NORM_S_INV.functionParameter.probability.name",
        detail: "formula.functionList.NORM_S_INV.functionParameter.probability.detail",
        example: "0.908789",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.PEARSON,
    functionType: Kc2.Statistical,
    description: "formula.functionList.PEARSON.description",
    abstract: "formula.functionList.PEARSON.abstract",
    functionParameter: [
      {
        name: "formula.functionList.PEARSON.functionParameter.array1.name",
        detail: "formula.functionList.PEARSON.functionParameter.array1.detail",
        example: "A1:A4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PEARSON.functionParameter.array2.name",
        detail: "formula.functionList.PEARSON.functionParameter.array2.detail",
        example: "B1:B4",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.PERCENTILE_EXC,
    functionType: Kc2.Statistical,
    description: "formula.functionList.PERCENTILE_EXC.description",
    abstract: "formula.functionList.PERCENTILE_EXC.abstract",
    functionParameter: [
      {
        name: "formula.functionList.PERCENTILE_EXC.functionParameter.array.name",
        detail: "formula.functionList.PERCENTILE_EXC.functionParameter.array.detail",
        example: "A1:A4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PERCENTILE_EXC.functionParameter.k.name",
        detail: "formula.functionList.PERCENTILE_EXC.functionParameter.k.detail",
        example: "0.3",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.PERCENTILE_INC,
    functionType: Kc2.Statistical,
    description: "formula.functionList.PERCENTILE_INC.description",
    abstract: "formula.functionList.PERCENTILE_INC.abstract",
    functionParameter: [
      {
        name: "formula.functionList.PERCENTILE_INC.functionParameter.array.name",
        detail: "formula.functionList.PERCENTILE_INC.functionParameter.array.detail",
        example: "A1:A4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PERCENTILE_INC.functionParameter.k.name",
        detail: "formula.functionList.PERCENTILE_INC.functionParameter.k.detail",
        example: "0.3",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.PERCENTRANK_EXC,
    functionType: Kc2.Statistical,
    description: "formula.functionList.PERCENTRANK_EXC.description",
    abstract: "formula.functionList.PERCENTRANK_EXC.abstract",
    functionParameter: [
      {
        name: "formula.functionList.PERCENTRANK_EXC.functionParameter.array.name",
        detail: "formula.functionList.PERCENTRANK_EXC.functionParameter.array.detail",
        example: "A1:A4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PERCENTRANK_EXC.functionParameter.x.name",
        detail: "formula.functionList.PERCENTRANK_EXC.functionParameter.x.detail",
        example: "1.5",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PERCENTRANK_EXC.functionParameter.significance.name",
        detail: "formula.functionList.PERCENTRANK_EXC.functionParameter.significance.detail",
        example: "3",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.PERCENTRANK_INC,
    functionType: Kc2.Statistical,
    description: "formula.functionList.PERCENTRANK_INC.description",
    abstract: "formula.functionList.PERCENTRANK_INC.abstract",
    functionParameter: [
      {
        name: "formula.functionList.PERCENTRANK_INC.functionParameter.array.name",
        detail: "formula.functionList.PERCENTRANK_INC.functionParameter.array.detail",
        example: "A1:A4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PERCENTRANK_INC.functionParameter.x.name",
        detail: "formula.functionList.PERCENTRANK_INC.functionParameter.x.detail",
        example: "1.5",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PERCENTRANK_INC.functionParameter.significance.name",
        detail: "formula.functionList.PERCENTRANK_INC.functionParameter.significance.detail",
        example: "3",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.PERMUT,
    functionType: Kc2.Statistical,
    description: "formula.functionList.PERMUT.description",
    abstract: "formula.functionList.PERMUT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.PERMUT.functionParameter.number.name",
        detail: "formula.functionList.PERMUT.functionParameter.number.detail",
        example: "8",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PERMUT.functionParameter.numberChosen.name",
        detail: "formula.functionList.PERMUT.functionParameter.numberChosen.detail",
        example: "2",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.PERMUTATIONA,
    functionType: Kc2.Statistical,
    description: "formula.functionList.PERMUTATIONA.description",
    abstract: "formula.functionList.PERMUTATIONA.abstract",
    functionParameter: [
      {
        name: "formula.functionList.PERMUT.functionParameter.number.name",
        detail: "formula.functionList.PERMUT.functionParameter.number.detail",
        example: "8",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PERMUT.functionParameter.numberChosen.name",
        detail: "formula.functionList.PERMUT.functionParameter.numberChosen.detail",
        example: "2",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.PHI,
    functionType: Kc2.Statistical,
    description: "formula.functionList.PHI.description",
    abstract: "formula.functionList.PHI.abstract",
    functionParameter: [
      {
        name: "formula.functionList.PHI.functionParameter.x.name",
        detail: "formula.functionList.PHI.functionParameter.x.detail",
        example: "0.75",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.POISSON_DIST,
    functionType: Kc2.Statistical,
    description: "formula.functionList.POISSON_DIST.description",
    abstract: "formula.functionList.POISSON_DIST.abstract",
    functionParameter: [
      {
        name: "formula.functionList.POISSON_DIST.functionParameter.x.name",
        detail: "formula.functionList.POISSON_DIST.functionParameter.x.detail",
        example: "2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.POISSON_DIST.functionParameter.mean.name",
        detail: "formula.functionList.POISSON_DIST.functionParameter.mean.detail",
        example: "5",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.POISSON_DIST.functionParameter.cumulative.name",
        detail: "formula.functionList.POISSON_DIST.functionParameter.cumulative.detail",
        example: "true",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.PROB,
    functionType: Kc2.Statistical,
    description: "formula.functionList.PROB.description",
    abstract: "formula.functionList.PROB.abstract",
    functionParameter: [
      {
        name: "formula.functionList.PROB.functionParameter.xRange.name",
        detail: "formula.functionList.PROB.functionParameter.xRange.detail",
        example: "A1:A4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PROB.functionParameter.probRange.name",
        detail: "formula.functionList.PROB.functionParameter.probRange.detail",
        example: "B1:B4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PROB.functionParameter.lowerLimit.name",
        detail: "formula.functionList.PROB.functionParameter.lowerLimit.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PROB.functionParameter.upperLimit.name",
        detail: "formula.functionList.PROB.functionParameter.upperLimit.detail",
        example: "3",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.QUARTILE_EXC,
    functionType: Kc2.Statistical,
    description: "formula.functionList.QUARTILE_EXC.description",
    abstract: "formula.functionList.QUARTILE_EXC.abstract",
    functionParameter: [
      {
        name: "formula.functionList.QUARTILE_EXC.functionParameter.array.name",
        detail: "formula.functionList.QUARTILE_EXC.functionParameter.array.detail",
        example: "A1:A4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.QUARTILE_EXC.functionParameter.quart.name",
        detail: "formula.functionList.QUARTILE_EXC.functionParameter.quart.detail",
        example: "1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.QUARTILE_INC,
    functionType: Kc2.Statistical,
    description: "formula.functionList.QUARTILE_INC.description",
    abstract: "formula.functionList.QUARTILE_INC.abstract",
    functionParameter: [
      {
        name: "formula.functionList.QUARTILE_INC.functionParameter.array.name",
        detail: "formula.functionList.QUARTILE_INC.functionParameter.array.detail",
        example: "A1:A4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.QUARTILE_INC.functionParameter.quart.name",
        detail: "formula.functionList.QUARTILE_INC.functionParameter.quart.detail",
        example: "1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.RANK_AVG,
    functionType: Kc2.Statistical,
    description: "formula.functionList.RANK_AVG.description",
    abstract: "formula.functionList.RANK_AVG.abstract",
    functionParameter: [
      {
        name: "formula.functionList.RANK_AVG.functionParameter.number.name",
        detail: "formula.functionList.RANK_AVG.functionParameter.number.detail",
        example: "A3",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.RANK_AVG.functionParameter.ref.name",
        detail: "formula.functionList.RANK_AVG.functionParameter.ref.detail",
        example: "A2:A6",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.RANK_AVG.functionParameter.order.name",
        detail: "formula.functionList.RANK_AVG.functionParameter.order.detail",
        example: "1",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.RANK_EQ,
    functionType: Kc2.Statistical,
    description: "formula.functionList.RANK_EQ.description",
    abstract: "formula.functionList.RANK_EQ.abstract",
    functionParameter: [
      {
        name: "formula.functionList.RANK_EQ.functionParameter.number.name",
        detail: "formula.functionList.RANK_EQ.functionParameter.number.detail",
        example: "A3",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.RANK_EQ.functionParameter.ref.name",
        detail: "formula.functionList.RANK_EQ.functionParameter.ref.detail",
        example: "A2:A6",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.RANK_EQ.functionParameter.order.name",
        detail: "formula.functionList.RANK_EQ.functionParameter.order.detail",
        example: "1",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.RSQ,
    functionType: Kc2.Statistical,
    description: "formula.functionList.RSQ.description",
    abstract: "formula.functionList.RSQ.abstract",
    functionParameter: [
      {
        name: "formula.functionList.RSQ.functionParameter.array1.name",
        detail: "formula.functionList.RSQ.functionParameter.array1.detail",
        example: "A1:A4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.RSQ.functionParameter.array2.name",
        detail: "formula.functionList.RSQ.functionParameter.array2.detail",
        example: "B1:B4",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.SKEW,
    functionType: Kc2.Statistical,
    description: "formula.functionList.SKEW.description",
    abstract: "formula.functionList.SKEW.abstract",
    functionParameter: [
      {
        name: "formula.functionList.SKEW.functionParameter.number1.name",
        detail: "formula.functionList.SKEW.functionParameter.number1.detail",
        example: "A1:C3",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SKEW.functionParameter.number2.name",
        detail: "formula.functionList.SKEW.functionParameter.number2.detail",
        example: "4",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: P2.SKEW_P,
    functionType: Kc2.Statistical,
    description: "formula.functionList.SKEW_P.description",
    abstract: "formula.functionList.SKEW_P.abstract",
    functionParameter: [
      {
        name: "formula.functionList.SKEW_P.functionParameter.number1.name",
        detail: "formula.functionList.SKEW_P.functionParameter.number1.detail",
        example: "A1:C3",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SKEW_P.functionParameter.number2.name",
        detail: "formula.functionList.SKEW_P.functionParameter.number2.detail",
        example: "4",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: P2.SLOPE,
    functionType: Kc2.Statistical,
    description: "formula.functionList.SLOPE.description",
    abstract: "formula.functionList.SLOPE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.SLOPE.functionParameter.knownYs.name",
        detail: "formula.functionList.SLOPE.functionParameter.knownYs.detail",
        example: "A1:A4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SLOPE.functionParameter.knownXs.name",
        detail: "formula.functionList.SLOPE.functionParameter.knownXs.detail",
        example: "B1:B4",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.SMALL,
    functionType: Kc2.Statistical,
    description: "formula.functionList.SMALL.description",
    abstract: "formula.functionList.SMALL.abstract",
    functionParameter: [
      {
        name: "formula.functionList.SMALL.functionParameter.array.name",
        detail: "formula.functionList.SMALL.functionParameter.array.detail",
        example: "A2:B6",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SMALL.functionParameter.k.name",
        detail: "formula.functionList.SMALL.functionParameter.k.detail",
        example: "3",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.STANDARDIZE,
    functionType: Kc2.Statistical,
    description: "formula.functionList.STANDARDIZE.description",
    abstract: "formula.functionList.STANDARDIZE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.STANDARDIZE.functionParameter.x.name",
        detail: "formula.functionList.STANDARDIZE.functionParameter.x.detail",
        example: "42",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.STANDARDIZE.functionParameter.mean.name",
        detail: "formula.functionList.STANDARDIZE.functionParameter.mean.detail",
        example: "40",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.STANDARDIZE.functionParameter.standardDev.name",
        detail: "formula.functionList.STANDARDIZE.functionParameter.standardDev.detail",
        example: "1.5",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.STDEV_P,
    functionType: Kc2.Statistical,
    description: "formula.functionList.STDEV_P.description",
    abstract: "formula.functionList.STDEV_P.abstract",
    functionParameter: [
      {
        name: "formula.functionList.STDEV_P.functionParameter.number1.name",
        detail: "formula.functionList.STDEV_P.functionParameter.number1.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.STDEV_P.functionParameter.number2.name",
        detail: "formula.functionList.STDEV_P.functionParameter.number2.detail",
        example: "2",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: P2.STDEV_S,
    functionType: Kc2.Statistical,
    description: "formula.functionList.STDEV_S.description",
    abstract: "formula.functionList.STDEV_S.abstract",
    functionParameter: [
      {
        name: "formula.functionList.STDEV_S.functionParameter.number1.name",
        detail: "formula.functionList.STDEV_S.functionParameter.number1.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.STDEV_S.functionParameter.number2.name",
        detail: "formula.functionList.STDEV_S.functionParameter.number2.detail",
        example: "2",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: P2.STDEVA,
    functionType: Kc2.Statistical,
    description: "formula.functionList.STDEVA.description",
    abstract: "formula.functionList.STDEVA.abstract",
    functionParameter: [
      {
        name: "formula.functionList.STDEVA.functionParameter.value1.name",
        detail: "formula.functionList.STDEVA.functionParameter.value1.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.STDEVA.functionParameter.value2.name",
        detail: "formula.functionList.STDEVA.functionParameter.value2.detail",
        example: "2",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: P2.STDEVPA,
    functionType: Kc2.Statistical,
    description: "formula.functionList.STDEVPA.description",
    abstract: "formula.functionList.STDEVPA.abstract",
    functionParameter: [
      {
        name: "formula.functionList.STDEVPA.functionParameter.value1.name",
        detail: "formula.functionList.STDEVPA.functionParameter.value1.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.STDEVPA.functionParameter.value2.name",
        detail: "formula.functionList.STDEVPA.functionParameter.value2.detail",
        example: "2",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: P2.STEYX,
    functionType: Kc2.Statistical,
    description: "formula.functionList.STEYX.description",
    abstract: "formula.functionList.STEYX.abstract",
    functionParameter: [
      {
        name: "formula.functionList.STEYX.functionParameter.knownYs.name",
        detail: "formula.functionList.STEYX.functionParameter.knownYs.detail",
        example: "A1:A4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.STEYX.functionParameter.knownXs.name",
        detail: "formula.functionList.STEYX.functionParameter.knownXs.detail",
        example: "B1:B4",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.T_DIST,
    functionType: Kc2.Statistical,
    description: "formula.functionList.T_DIST.description",
    abstract: "formula.functionList.T_DIST.abstract",
    functionParameter: [
      {
        name: "formula.functionList.T_DIST.functionParameter.x.name",
        detail: "formula.functionList.T_DIST.functionParameter.x.detail",
        example: "8",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.T_DIST.functionParameter.degFreedom.name",
        detail: "formula.functionList.T_DIST.functionParameter.degFreedom.detail",
        example: "3",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.T_DIST.functionParameter.cumulative.name",
        detail: "formula.functionList.T_DIST.functionParameter.cumulative.detail",
        example: "true",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.T_DIST_2T,
    functionType: Kc2.Statistical,
    description: "formula.functionList.T_DIST_2T.description",
    abstract: "formula.functionList.T_DIST_2T.abstract",
    functionParameter: [
      {
        name: "formula.functionList.T_DIST_2T.functionParameter.x.name",
        detail: "formula.functionList.T_DIST_2T.functionParameter.x.detail",
        example: "8",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.T_DIST_2T.functionParameter.degFreedom.name",
        detail: "formula.functionList.T_DIST_2T.functionParameter.degFreedom.detail",
        example: "3",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.T_DIST_RT,
    functionType: Kc2.Statistical,
    description: "formula.functionList.T_DIST_RT.description",
    abstract: "formula.functionList.T_DIST_RT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.T_DIST_RT.functionParameter.x.name",
        detail: "formula.functionList.T_DIST_RT.functionParameter.x.detail",
        example: "8",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.T_DIST_RT.functionParameter.degFreedom.name",
        detail: "formula.functionList.T_DIST_RT.functionParameter.degFreedom.detail",
        example: "3",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.T_INV,
    functionType: Kc2.Statistical,
    description: "formula.functionList.T_INV.description",
    abstract: "formula.functionList.T_INV.abstract",
    functionParameter: [
      {
        name: "formula.functionList.T_INV.functionParameter.probability.name",
        detail: "formula.functionList.T_INV.functionParameter.probability.detail",
        example: "0.75",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.T_INV.functionParameter.degFreedom.name",
        detail: "formula.functionList.T_INV.functionParameter.degFreedom.detail",
        example: "2",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.T_INV_2T,
    functionType: Kc2.Statistical,
    description: "formula.functionList.T_INV_2T.description",
    abstract: "formula.functionList.T_INV_2T.abstract",
    functionParameter: [
      {
        name: "formula.functionList.T_INV_2T.functionParameter.probability.name",
        detail: "formula.functionList.T_INV_2T.functionParameter.probability.detail",
        example: "0.75",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.T_INV_2T.functionParameter.degFreedom.name",
        detail: "formula.functionList.T_INV_2T.functionParameter.degFreedom.detail",
        example: "2",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.T_TEST,
    functionType: Kc2.Statistical,
    description: "formula.functionList.T_TEST.description",
    abstract: "formula.functionList.T_TEST.abstract",
    functionParameter: [
      {
        name: "formula.functionList.T_TEST.functionParameter.array1.name",
        detail: "formula.functionList.T_TEST.functionParameter.array1.detail",
        example: "A1:A4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.T_TEST.functionParameter.array2.name",
        detail: "formula.functionList.T_TEST.functionParameter.array2.detail",
        example: "B1:B4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.T_TEST.functionParameter.tails.name",
        detail: "formula.functionList.T_TEST.functionParameter.tails.detail",
        example: "2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.T_TEST.functionParameter.type.name",
        detail: "formula.functionList.T_TEST.functionParameter.type.detail",
        example: "1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.TREND,
    functionType: Kc2.Statistical,
    description: "formula.functionList.TREND.description",
    abstract: "formula.functionList.TREND.abstract",
    functionParameter: [
      {
        name: "formula.functionList.TREND.functionParameter.knownYs.name",
        detail: "formula.functionList.TREND.functionParameter.knownYs.detail",
        example: "B2:B7",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.TREND.functionParameter.knownXs.name",
        detail: "formula.functionList.TREND.functionParameter.knownXs.detail",
        example: "A2:A7",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.TREND.functionParameter.newXs.name",
        detail: "formula.functionList.TREND.functionParameter.newXs.detail",
        example: "A9:A10",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.TREND.functionParameter.constb.name",
        detail: "formula.functionList.TREND.functionParameter.constb.detail",
        example: "true",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.TRIMMEAN,
    functionType: Kc2.Statistical,
    description: "formula.functionList.TRIMMEAN.description",
    abstract: "formula.functionList.TRIMMEAN.abstract",
    functionParameter: [
      {
        name: "formula.functionList.TRIMMEAN.functionParameter.array.name",
        detail: "formula.functionList.TRIMMEAN.functionParameter.array.detail",
        example: "A2:A12",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.TRIMMEAN.functionParameter.percent.name",
        detail: "formula.functionList.TRIMMEAN.functionParameter.percent.detail",
        example: "0.2",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.VAR_P,
    functionType: Kc2.Statistical,
    description: "formula.functionList.VAR_P.description",
    abstract: "formula.functionList.VAR_P.abstract",
    functionParameter: [
      {
        name: "formula.functionList.VAR_P.functionParameter.number1.name",
        detail: "formula.functionList.VAR_P.functionParameter.number1.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.VAR_P.functionParameter.number2.name",
        detail: "formula.functionList.VAR_P.functionParameter.number2.detail",
        example: "2",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: P2.VAR_S,
    functionType: Kc2.Statistical,
    description: "formula.functionList.VAR_S.description",
    abstract: "formula.functionList.VAR_S.abstract",
    functionParameter: [
      {
        name: "formula.functionList.VAR_S.functionParameter.number1.name",
        detail: "formula.functionList.VAR_S.functionParameter.number1.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.VAR_S.functionParameter.number2.name",
        detail: "formula.functionList.VAR_S.functionParameter.number2.detail",
        example: "2",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: P2.VARA,
    functionType: Kc2.Statistical,
    description: "formula.functionList.VARA.description",
    abstract: "formula.functionList.VARA.abstract",
    functionParameter: [
      {
        name: "formula.functionList.VARA.functionParameter.value1.name",
        detail: "formula.functionList.VARA.functionParameter.value1.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.VARA.functionParameter.value2.name",
        detail: "formula.functionList.VARA.functionParameter.value2.detail",
        example: "2",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: P2.VARPA,
    functionType: Kc2.Statistical,
    description: "formula.functionList.VARPA.description",
    abstract: "formula.functionList.VARPA.abstract",
    functionParameter: [
      {
        name: "formula.functionList.VARPA.functionParameter.value1.name",
        detail: "formula.functionList.VARPA.functionParameter.value1.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.VARPA.functionParameter.value2.name",
        detail: "formula.functionList.VARPA.functionParameter.value2.detail",
        example: "2",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: P2.WEIBULL_DIST,
    functionType: Kc2.Statistical,
    description: "formula.functionList.WEIBULL_DIST.description",
    abstract: "formula.functionList.WEIBULL_DIST.abstract",
    functionParameter: [
      {
        name: "formula.functionList.WEIBULL_DIST.functionParameter.x.name",
        detail: "formula.functionList.WEIBULL_DIST.functionParameter.x.detail",
        example: "105",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.WEIBULL_DIST.functionParameter.alpha.name",
        detail: "formula.functionList.WEIBULL_DIST.functionParameter.alpha.detail",
        example: "20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.WEIBULL_DIST.functionParameter.beta.name",
        detail: "formula.functionList.WEIBULL_DIST.functionParameter.beta.detail",
        example: "100",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.WEIBULL_DIST.functionParameter.cumulative.name",
        detail: "formula.functionList.WEIBULL_DIST.functionParameter.cumulative.detail",
        example: "true",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: P2.Z_TEST,
    functionType: Kc2.Statistical,
    description: "formula.functionList.Z_TEST.description",
    abstract: "formula.functionList.Z_TEST.abstract",
    functionParameter: [
      {
        name: "formula.functionList.Z_TEST.functionParameter.array.name",
        detail: "formula.functionList.Z_TEST.functionParameter.array.detail",
        example: "A2:A11",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.Z_TEST.functionParameter.x.name",
        detail: "formula.functionList.Z_TEST.functionParameter.x.detail",
        example: "4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.Z_TEST.functionParameter.sigma.name",
        detail: "formula.functionList.Z_TEST.functionParameter.sigma.detail",
        example: "10",
        require: 0,
        repeat: 0
      }
    ]
  }
];
var Fr3 = [
  {
    functionName: J2.ASC,
    functionType: Kc2.Text,
    description: "formula.functionList.ASC.description",
    abstract: "formula.functionList.ASC.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ASC.functionParameter.text.name",
        detail: "formula.functionList.ASC.functionParameter.text.detail",
        example: '"ï¼µï½Žï½‰ï½–ï½…ï½’"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.ARRAYTOTEXT,
    functionType: Kc2.Text,
    description: "formula.functionList.ARRAYTOTEXT.description",
    abstract: "formula.functionList.ARRAYTOTEXT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ARRAYTOTEXT.functionParameter.array.name",
        detail: "formula.functionList.ARRAYTOTEXT.functionParameter.array.detail",
        example: "A2:B4",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.ARRAYTOTEXT.functionParameter.format.name",
        detail: "formula.functionList.ARRAYTOTEXT.functionParameter.format.detail",
        example: "0",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.BAHTTEXT,
    functionType: Kc2.Text,
    description: "formula.functionList.BAHTTEXT.description",
    abstract: "formula.functionList.BAHTTEXT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.BAHTTEXT.functionParameter.number.name",
        detail: "formula.functionList.BAHTTEXT.functionParameter.number.detail",
        example: "1234",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.CHAR,
    functionType: Kc2.Text,
    description: "formula.functionList.CHAR.description",
    abstract: "formula.functionList.CHAR.abstract",
    functionParameter: [
      {
        name: "formula.functionList.CHAR.functionParameter.number.name",
        detail: "formula.functionList.CHAR.functionParameter.number.detail",
        example: "65",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.CLEAN,
    functionType: Kc2.Text,
    description: "formula.functionList.CLEAN.description",
    abstract: "formula.functionList.CLEAN.abstract",
    functionParameter: [
      {
        name: "formula.functionList.CLEAN.functionParameter.text.name",
        detail: "formula.functionList.CLEAN.functionParameter.text.detail",
        example: 'CHAR(1)&"Univer"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.CODE,
    functionType: Kc2.Text,
    description: "formula.functionList.CODE.description",
    abstract: "formula.functionList.CODE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.CODE.functionParameter.text.name",
        detail: "formula.functionList.CODE.functionParameter.text.detail",
        example: '"Univer"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.CONCAT,
    functionType: Kc2.Text,
    description: "formula.functionList.CONCAT.description",
    abstract: "formula.functionList.CONCAT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.CONCAT.functionParameter.text1.name",
        detail: "formula.functionList.CONCAT.functionParameter.text1.detail",
        example: '"Hello"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CONCAT.functionParameter.text2.name",
        detail: "formula.functionList.CONCAT.functionParameter.text2.detail",
        example: '"Univer"',
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: J2.CONCATENATE,
    functionType: Kc2.Text,
    description: "formula.functionList.CONCATENATE.description",
    abstract: "formula.functionList.CONCATENATE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.CONCATENATE.functionParameter.text1.name",
        detail: "formula.functionList.CONCATENATE.functionParameter.text1.detail",
        example: "A1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CONCATENATE.functionParameter.text2.name",
        detail: "formula.functionList.CONCATENATE.functionParameter.text2.detail",
        example: "A2",
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: J2.DBCS,
    functionType: Kc2.Text,
    description: "formula.functionList.DBCS.description",
    abstract: "formula.functionList.DBCS.abstract",
    functionParameter: [
      {
        name: "formula.functionList.DBCS.functionParameter.text.name",
        detail: "formula.functionList.DBCS.functionParameter.text.detail",
        example: '"Univer"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.DOLLAR,
    functionType: Kc2.Text,
    description: "formula.functionList.DOLLAR.description",
    abstract: "formula.functionList.DOLLAR.abstract",
    functionParameter: [
      {
        name: "formula.functionList.DOLLAR.functionParameter.number.name",
        detail: "formula.functionList.DOLLAR.functionParameter.number.detail",
        example: "1234.567",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.DOLLAR.functionParameter.decimals.name",
        detail: "formula.functionList.DOLLAR.functionParameter.decimals.detail",
        example: "2",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.EXACT,
    functionType: Kc2.Text,
    description: "formula.functionList.EXACT.description",
    abstract: "formula.functionList.EXACT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.EXACT.functionParameter.text1.name",
        detail: "formula.functionList.EXACT.functionParameter.text1.detail",
        example: '"Univer"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.EXACT.functionParameter.text2.name",
        detail: "formula.functionList.EXACT.functionParameter.text2.detail",
        example: '"univer"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.FIND,
    functionType: Kc2.Text,
    description: "formula.functionList.FIND.description",
    abstract: "formula.functionList.FIND.abstract",
    functionParameter: [
      {
        name: "formula.functionList.FIND.functionParameter.findText.name",
        detail: "formula.functionList.FIND.functionParameter.findText.detail",
        example: '"Univer"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.FIND.functionParameter.withinText.name",
        detail: "formula.functionList.FIND.functionParameter.withinText.detail",
        example: '"Hello Univer"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.FIND.functionParameter.startNum.name",
        detail: "formula.functionList.FIND.functionParameter.startNum.detail",
        example: "1",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.FINDB,
    functionType: Kc2.Text,
    description: "formula.functionList.FINDB.description",
    abstract: "formula.functionList.FINDB.abstract",
    functionParameter: [
      {
        name: "formula.functionList.FINDB.functionParameter.findText.name",
        detail: "formula.functionList.FINDB.functionParameter.findText.detail",
        example: '"Univer"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.FINDB.functionParameter.withinText.name",
        detail: "formula.functionList.FINDB.functionParameter.withinText.detail",
        example: '"Hello Univer"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.FINDB.functionParameter.startNum.name",
        detail: "formula.functionList.FINDB.functionParameter.startNum.detail",
        example: "1",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.FIXED,
    functionType: Kc2.Text,
    description: "formula.functionList.FIXED.description",
    abstract: "formula.functionList.FIXED.abstract",
    functionParameter: [
      {
        name: "formula.functionList.FIXED.functionParameter.number.name",
        detail: "formula.functionList.FIXED.functionParameter.number.detail",
        example: "1234.567",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.FIXED.functionParameter.decimals.name",
        detail: "formula.functionList.FIXED.functionParameter.decimals.detail",
        example: "2",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.FIXED.functionParameter.noCommas.name",
        detail: "formula.functionList.FIXED.functionParameter.noCommas.detail",
        example: "0",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.LEFT,
    functionType: Kc2.Text,
    description: "formula.functionList.LEFT.description",
    abstract: "formula.functionList.LEFT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.LEFT.functionParameter.text.name",
        detail: "formula.functionList.LEFT.functionParameter.text.detail",
        example: '"Univer"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.LEFT.functionParameter.numChars.name",
        detail: "formula.functionList.LEFT.functionParameter.numChars.detail",
        example: "3",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.LEFTB,
    functionType: Kc2.Text,
    description: "formula.functionList.LEFTB.description",
    abstract: "formula.functionList.LEFTB.abstract",
    functionParameter: [
      {
        name: "formula.functionList.LEFTB.functionParameter.text.name",
        detail: "formula.functionList.LEFTB.functionParameter.text.detail",
        example: '"Univer"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.LEFTB.functionParameter.numBytes.name",
        detail: "formula.functionList.LEFTB.functionParameter.numBytes.detail",
        example: "3",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.LEN,
    functionType: Kc2.Text,
    description: "formula.functionList.LEN.description",
    abstract: "formula.functionList.LEN.abstract",
    functionParameter: [
      {
        name: "formula.functionList.LEN.functionParameter.text.name",
        detail: "formula.functionList.LEN.functionParameter.text.detail",
        example: '"Univer"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.LENB,
    functionType: Kc2.Text,
    description: "formula.functionList.LENB.description",
    abstract: "formula.functionList.LENB.abstract",
    functionParameter: [
      {
        name: "formula.functionList.LENB.functionParameter.text.name",
        detail: "formula.functionList.LENB.functionParameter.text.detail",
        example: '"Univer"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.LOWER,
    functionType: Kc2.Text,
    description: "formula.functionList.LOWER.description",
    abstract: "formula.functionList.LOWER.abstract",
    functionParameter: [
      {
        name: "formula.functionList.LOWER.functionParameter.text.name",
        detail: "formula.functionList.LOWER.functionParameter.text.detail",
        example: '"Univer"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.MID,
    functionType: Kc2.Text,
    description: "formula.functionList.MID.description",
    abstract: "formula.functionList.MID.abstract",
    functionParameter: [
      {
        name: "formula.functionList.MID.functionParameter.text.name",
        detail: "formula.functionList.MID.functionParameter.text.detail",
        example: '"Univer"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.MID.functionParameter.startNum.name",
        detail: "formula.functionList.MID.functionParameter.startNum.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.MID.functionParameter.numChars.name",
        detail: "formula.functionList.MID.functionParameter.numChars.detail",
        example: "3",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.MIDB,
    functionType: Kc2.Text,
    description: "formula.functionList.MIDB.description",
    abstract: "formula.functionList.MIDB.abstract",
    functionParameter: [
      {
        name: "formula.functionList.MIDB.functionParameter.text.name",
        detail: "formula.functionList.MIDB.functionParameter.text.detail",
        example: '"Univer"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.MIDB.functionParameter.startNum.name",
        detail: "formula.functionList.MIDB.functionParameter.startNum.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.MIDB.functionParameter.numBytes.name",
        detail: "formula.functionList.MIDB.functionParameter.numBytes.detail",
        example: "3",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.NUMBERSTRING,
    functionType: Kc2.Text,
    description: "formula.functionList.NUMBERSTRING.description",
    abstract: "formula.functionList.NUMBERSTRING.abstract",
    functionParameter: [
      {
        name: "formula.functionList.NUMBERSTRING.functionParameter.number.name",
        detail: "formula.functionList.NUMBERSTRING.functionParameter.number.detail",
        example: "123",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.NUMBERSTRING.functionParameter.type.name",
        detail: "formula.functionList.NUMBERSTRING.functionParameter.type.detail",
        example: "1",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.NUMBERVALUE,
    functionType: Kc2.Text,
    description: "formula.functionList.NUMBERVALUE.description",
    abstract: "formula.functionList.NUMBERVALUE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.NUMBERVALUE.functionParameter.text.name",
        detail: "formula.functionList.NUMBERVALUE.functionParameter.text.detail",
        example: '"2.500,27"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.NUMBERVALUE.functionParameter.decimalSeparator.name",
        detail: "formula.functionList.NUMBERVALUE.functionParameter.decimalSeparator.detail",
        example: '","',
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.NUMBERVALUE.functionParameter.groupSeparator.name",
        detail: "formula.functionList.NUMBERVALUE.functionParameter.groupSeparator.detail",
        example: '"."',
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.PHONETIC,
    functionType: Kc2.Text,
    description: "formula.functionList.PHONETIC.description",
    abstract: "formula.functionList.PHONETIC.abstract",
    functionParameter: [
      {
        name: "formula.functionList.PHONETIC.functionParameter.number1.name",
        detail: "formula.functionList.PHONETIC.functionParameter.number1.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.PHONETIC.functionParameter.number2.name",
        detail: "formula.functionList.PHONETIC.functionParameter.number2.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.PROPER,
    functionType: Kc2.Text,
    description: "formula.functionList.PROPER.description",
    abstract: "formula.functionList.PROPER.abstract",
    functionParameter: [
      {
        name: "formula.functionList.PROPER.functionParameter.text.name",
        detail: "formula.functionList.PROPER.functionParameter.text.detail",
        example: '"hello univer"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.REGEXEXTRACT,
    functionType: Kc2.Text,
    description: "formula.functionList.REGEXEXTRACT.description",
    abstract: "formula.functionList.REGEXEXTRACT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.REGEXEXTRACT.functionParameter.text.name",
        detail: "formula.functionList.REGEXEXTRACT.functionParameter.text.detail",
        example: '"abcdefg"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.REGEXEXTRACT.functionParameter.regularExpression.name",
        detail: "formula.functionList.REGEXEXTRACT.functionParameter.regularExpression.detail",
        example: '"c.*f"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.REGEXMATCH,
    functionType: Kc2.Text,
    description: "formula.functionList.REGEXMATCH.description",
    abstract: "formula.functionList.REGEXMATCH.abstract",
    functionParameter: [
      {
        name: "formula.functionList.REGEXMATCH.functionParameter.text.name",
        detail: "formula.functionList.REGEXMATCH.functionParameter.text.detail",
        example: '"Spreadsheets"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.REGEXMATCH.functionParameter.regularExpression.name",
        detail: "formula.functionList.REGEXMATCH.functionParameter.regularExpression.detail",
        example: '"S.r"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.REGEXREPLACE,
    functionType: Kc2.Text,
    description: "formula.functionList.REGEXREPLACE.description",
    abstract: "formula.functionList.REGEXREPLACE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.REGEXREPLACE.functionParameter.text.name",
        detail: "formula.functionList.REGEXREPLACE.functionParameter.text.detail",
        example: '"abcedfg"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.REGEXREPLACE.functionParameter.regularExpression.name",
        detail: "formula.functionList.REGEXREPLACE.functionParameter.regularExpression.detail",
        example: '"a.*d"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.REGEXREPLACE.functionParameter.replacement.name",
        detail: "formula.functionList.REGEXREPLACE.functionParameter.replacement.detail",
        example: '"xyz"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.REPLACE,
    functionType: Kc2.Text,
    description: "formula.functionList.REPLACE.description",
    abstract: "formula.functionList.REPLACE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.REPLACE.functionParameter.oldText.name",
        detail: "formula.functionList.REPLACE.functionParameter.oldText.detail",
        example: '"Univer"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.REPLACE.functionParameter.startNum.name",
        detail: "formula.functionList.REPLACE.functionParameter.startNum.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.REPLACE.functionParameter.numChars.name",
        detail: "formula.functionList.REPLACE.functionParameter.numChars.detail",
        example: "0",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.REPLACE.functionParameter.newText.name",
        detail: "formula.functionList.REPLACE.functionParameter.newText.detail",
        example: '"Hello "',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.REPLACEB,
    functionType: Kc2.Text,
    description: "formula.functionList.REPLACEB.description",
    abstract: "formula.functionList.REPLACEB.abstract",
    functionParameter: [
      {
        name: "formula.functionList.REPLACEB.functionParameter.oldText.name",
        detail: "formula.functionList.REPLACEB.functionParameter.oldText.detail",
        example: '"Univer"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.REPLACEB.functionParameter.startNum.name",
        detail: "formula.functionList.REPLACEB.functionParameter.startNum.detail",
        example: "1",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.REPLACEB.functionParameter.numBytes.name",
        detail: "formula.functionList.REPLACEB.functionParameter.numBytes.detail",
        example: "0",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.REPLACEB.functionParameter.newText.name",
        detail: "formula.functionList.REPLACEB.functionParameter.newText.detail",
        example: '"Hello "',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.REPT,
    functionType: Kc2.Text,
    description: "formula.functionList.REPT.description",
    abstract: "formula.functionList.REPT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.REPT.functionParameter.text.name",
        detail: "formula.functionList.REPT.functionParameter.text.detail",
        example: '"*-"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.REPT.functionParameter.numberTimes.name",
        detail: "formula.functionList.REPT.functionParameter.numberTimes.detail",
        example: "3",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.RIGHT,
    functionType: Kc2.Text,
    description: "formula.functionList.RIGHT.description",
    abstract: "formula.functionList.RIGHT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.RIGHT.functionParameter.text.name",
        detail: "formula.functionList.RIGHT.functionParameter.text.detail",
        example: '"Univer"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.RIGHT.functionParameter.numChars.name",
        detail: "formula.functionList.RIGHT.functionParameter.numChars.detail",
        example: "3",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.RIGHTB,
    functionType: Kc2.Text,
    description: "formula.functionList.RIGHTB.description",
    abstract: "formula.functionList.RIGHTB.abstract",
    functionParameter: [
      {
        name: "formula.functionList.RIGHTB.functionParameter.text.name",
        detail: "formula.functionList.RIGHTB.functionParameter.text.detail",
        example: '"Univer"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.RIGHTB.functionParameter.numBytes.name",
        detail: "formula.functionList.RIGHTB.functionParameter.numBytes.detail",
        example: "3",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.SEARCH,
    functionType: Kc2.Text,
    description: "formula.functionList.SEARCH.description",
    abstract: "formula.functionList.SEARCH.abstract",
    functionParameter: [
      {
        name: "formula.functionList.SEARCH.functionParameter.findText.name",
        detail: "formula.functionList.SEARCH.functionParameter.findText.detail",
        example: '"univer"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SEARCH.functionParameter.withinText.name",
        detail: "formula.functionList.SEARCH.functionParameter.withinText.detail",
        example: '"Hello Univer"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SEARCH.functionParameter.startNum.name",
        detail: "formula.functionList.SEARCH.functionParameter.startNum.detail",
        example: "1",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.SEARCHB,
    functionType: Kc2.Text,
    description: "formula.functionList.SEARCHB.description",
    abstract: "formula.functionList.SEARCHB.abstract",
    functionParameter: [
      {
        name: "formula.functionList.SEARCHB.functionParameter.findText.name",
        detail: "formula.functionList.SEARCHB.functionParameter.findText.detail",
        example: '"univer"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SEARCHB.functionParameter.withinText.name",
        detail: "formula.functionList.SEARCHB.functionParameter.withinText.detail",
        example: '"Hello Univer"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SEARCHB.functionParameter.startNum.name",
        detail: "formula.functionList.SEARCHB.functionParameter.startNum.detail",
        example: "1",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.SUBSTITUTE,
    functionType: Kc2.Text,
    description: "formula.functionList.SUBSTITUTE.description",
    abstract: "formula.functionList.SUBSTITUTE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.SUBSTITUTE.functionParameter.text.name",
        detail: "formula.functionList.SUBSTITUTE.functionParameter.text.detail",
        example: '"Hello Univer"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SUBSTITUTE.functionParameter.oldText.name",
        detail: "formula.functionList.SUBSTITUTE.functionParameter.oldText.detail",
        example: '"Hello"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SUBSTITUTE.functionParameter.newText.name",
        detail: "formula.functionList.SUBSTITUTE.functionParameter.newText.detail",
        example: '"Hi"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.SUBSTITUTE.functionParameter.instanceNum.name",
        detail: "formula.functionList.SUBSTITUTE.functionParameter.instanceNum.detail",
        example: "1",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.T,
    functionType: Kc2.Text,
    description: "formula.functionList.T.description",
    abstract: "formula.functionList.T.abstract",
    functionParameter: [
      {
        name: "formula.functionList.T.functionParameter.value.name",
        detail: "formula.functionList.T.functionParameter.value.detail",
        example: '"Univer"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.TEXT,
    functionType: Kc2.Text,
    description: "formula.functionList.TEXT.description",
    abstract: "formula.functionList.TEXT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.TEXT.functionParameter.value.name",
        detail: "formula.functionList.TEXT.functionParameter.value.detail",
        example: "1.23",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.TEXT.functionParameter.formatText.name",
        detail: "formula.functionList.TEXT.functionParameter.formatText.detail",
        example: '"$0.00"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.TEXTAFTER,
    functionType: Kc2.Text,
    description: "formula.functionList.TEXTAFTER.description",
    abstract: "formula.functionList.TEXTAFTER.abstract",
    functionParameter: [
      {
        name: "formula.functionList.TEXTAFTER.functionParameter.text.name",
        detail: "formula.functionList.TEXTAFTER.functionParameter.text.detail",
        example: '"Red riding hoodâ€™s, red hood"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.TEXTAFTER.functionParameter.delimiter.name",
        detail: "formula.functionList.TEXTAFTER.functionParameter.delimiter.detail",
        example: '"hood"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.TEXTAFTER.functionParameter.instanceNum.name",
        detail: "formula.functionList.TEXTAFTER.functionParameter.instanceNum.detail",
        example: "1",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.TEXTAFTER.functionParameter.matchMode.name",
        detail: "formula.functionList.TEXTAFTER.functionParameter.matchMode.detail",
        example: "1",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.TEXTAFTER.functionParameter.matchEnd.name",
        detail: "formula.functionList.TEXTAFTER.functionParameter.matchEnd.detail",
        example: "0",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.TEXTAFTER.functionParameter.ifNotFound.name",
        detail: "formula.functionList.TEXTAFTER.functionParameter.ifNotFound.detail",
        example: '"not found"',
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.TEXTBEFORE,
    functionType: Kc2.Text,
    description: "formula.functionList.TEXTBEFORE.description",
    abstract: "formula.functionList.TEXTBEFORE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.TEXTBEFORE.functionParameter.text.name",
        detail: "formula.functionList.TEXTBEFORE.functionParameter.text.detail",
        example: '"Red riding hoodâ€™s, red hood"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.TEXTBEFORE.functionParameter.delimiter.name",
        detail: "formula.functionList.TEXTBEFORE.functionParameter.delimiter.detail",
        example: '"hood"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.TEXTBEFORE.functionParameter.instanceNum.name",
        detail: "formula.functionList.TEXTBEFORE.functionParameter.instanceNum.detail",
        example: "1",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.TEXTBEFORE.functionParameter.matchMode.name",
        detail: "formula.functionList.TEXTBEFORE.functionParameter.matchMode.detail",
        example: "1",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.TEXTBEFORE.functionParameter.matchEnd.name",
        detail: "formula.functionList.TEXTBEFORE.functionParameter.matchEnd.detail",
        example: "0",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.TEXTBEFORE.functionParameter.ifNotFound.name",
        detail: "formula.functionList.TEXTBEFORE.functionParameter.ifNotFound.detail",
        example: '"not found"',
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.TEXTJOIN,
    functionType: Kc2.Text,
    description: "formula.functionList.TEXTJOIN.description",
    abstract: "formula.functionList.TEXTJOIN.abstract",
    functionParameter: [
      {
        name: "formula.functionList.TEXTJOIN.functionParameter.delimiter.name",
        detail: "formula.functionList.TEXTJOIN.functionParameter.delimiter.detail",
        example: '", "',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.TEXTJOIN.functionParameter.ignoreEmpty.name",
        detail: "formula.functionList.TEXTJOIN.functionParameter.ignoreEmpty.detail",
        example: "true",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.TEXTJOIN.functionParameter.text1.name",
        detail: "formula.functionList.TEXTJOIN.functionParameter.text1.detail",
        example: '"Hi"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.TEXTJOIN.functionParameter.text2.name",
        detail: "formula.functionList.TEXTJOIN.functionParameter.text2.detail",
        example: '"Univer"',
        require: 0,
        repeat: 1
      }
    ]
  },
  {
    functionName: J2.TEXTSPLIT,
    functionType: Kc2.Text,
    description: "formula.functionList.TEXTSPLIT.description",
    abstract: "formula.functionList.TEXTSPLIT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.TEXTSPLIT.functionParameter.text.name",
        detail: "formula.functionList.TEXTSPLIT.functionParameter.text.detail",
        example: "A1:C2",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.TEXTSPLIT.functionParameter.colDelimiter.name",
        detail: "formula.functionList.TEXTSPLIT.functionParameter.colDelimiter.detail",
        example: '","',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.TEXTSPLIT.functionParameter.rowDelimiter.name",
        detail: "formula.functionList.TEXTSPLIT.functionParameter.rowDelimiter.detail",
        example: '";"',
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.TEXTSPLIT.functionParameter.ignoreEmpty.name",
        detail: "formula.functionList.TEXTSPLIT.functionParameter.ignoreEmpty.detail",
        example: "",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.TEXTSPLIT.functionParameter.matchMode.name",
        detail: "formula.functionList.TEXTSPLIT.functionParameter.matchMode.detail",
        example: "",
        require: 0,
        repeat: 0
      },
      {
        name: "formula.functionList.TEXTSPLIT.functionParameter.padWith.name",
        detail: "formula.functionList.TEXTSPLIT.functionParameter.padWith.detail",
        example: "",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.TRIM,
    functionType: Kc2.Text,
    description: "formula.functionList.TRIM.description",
    abstract: "formula.functionList.TRIM.abstract",
    functionParameter: [
      {
        name: "formula.functionList.TRIM.functionParameter.text.name",
        detail: "formula.functionList.TRIM.functionParameter.text.detail",
        example: '" Hello  Univer "',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.UNICHAR,
    functionType: Kc2.Text,
    description: "formula.functionList.UNICHAR.description",
    abstract: "formula.functionList.UNICHAR.abstract",
    functionParameter: [
      {
        name: "formula.functionList.UNICHAR.functionParameter.number.name",
        detail: "formula.functionList.UNICHAR.functionParameter.number.detail",
        example: "65",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.UNICODE,
    functionType: Kc2.Text,
    description: "formula.functionList.UNICODE.description",
    abstract: "formula.functionList.UNICODE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.UNICODE.functionParameter.text.name",
        detail: "formula.functionList.UNICODE.functionParameter.text.detail",
        example: '"Univer"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.UPPER,
    functionType: Kc2.Text,
    description: "formula.functionList.UPPER.description",
    abstract: "formula.functionList.UPPER.abstract",
    functionParameter: [
      {
        name: "formula.functionList.UPPER.functionParameter.text.name",
        detail: "formula.functionList.UPPER.functionParameter.text.detail",
        example: '"Univer"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.VALUE,
    functionType: Kc2.Text,
    description: "formula.functionList.VALUE.description",
    abstract: "formula.functionList.VALUE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.VALUE.functionParameter.text.name",
        detail: "formula.functionList.VALUE.functionParameter.text.detail",
        example: '"123"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.VALUETOTEXT,
    functionType: Kc2.Text,
    description: "formula.functionList.VALUETOTEXT.description",
    abstract: "formula.functionList.VALUETOTEXT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.VALUETOTEXT.functionParameter.value.name",
        detail: "formula.functionList.VALUETOTEXT.functionParameter.value.detail",
        example: '"Univer"',
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.VALUETOTEXT.functionParameter.format.name",
        detail: "formula.functionList.VALUETOTEXT.functionParameter.format.detail",
        example: "1",
        require: 0,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.CALL,
    functionType: Kc2.Text,
    description: "formula.functionList.CALL.description",
    abstract: "formula.functionList.CALL.abstract",
    functionParameter: [
      {
        name: "formula.functionList.CALL.functionParameter.number1.name",
        detail: "formula.functionList.CALL.functionParameter.number1.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.CALL.functionParameter.number2.name",
        detail: "formula.functionList.CALL.functionParameter.number2.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.EUROCONVERT,
    functionType: Kc2.Text,
    description: "formula.functionList.EUROCONVERT.description",
    abstract: "formula.functionList.EUROCONVERT.abstract",
    functionParameter: [
      {
        name: "formula.functionList.EUROCONVERT.functionParameter.number1.name",
        detail: "formula.functionList.EUROCONVERT.functionParameter.number1.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.EUROCONVERT.functionParameter.number2.name",
        detail: "formula.functionList.EUROCONVERT.functionParameter.number2.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: J2.REGISTER_ID,
    functionType: Kc2.Text,
    description: "formula.functionList.REGISTER_ID.description",
    abstract: "formula.functionList.REGISTER_ID.abstract",
    functionParameter: [
      {
        name: "formula.functionList.REGISTER_ID.functionParameter.number1.name",
        detail: "formula.functionList.REGISTER_ID.functionParameter.number1.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.REGISTER_ID.functionParameter.number2.name",
        detail: "formula.functionList.REGISTER_ID.functionParameter.number2.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      }
    ]
  }
];
var Br2 = [];
var vr4 = [
  {
    functionName: ti.ENCODEURL,
    functionType: Kc2.Web,
    description: "formula.functionList.ENCODEURL.description",
    abstract: "formula.functionList.ENCODEURL.abstract",
    functionParameter: [
      {
        name: "formula.functionList.ENCODEURL.functionParameter.text.name",
        detail: "formula.functionList.ENCODEURL.functionParameter.text.detail",
        example: '"https://univer.ai/"',
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: ti.FILTERXML,
    functionType: Kc2.Web,
    description: "formula.functionList.FILTERXML.description",
    abstract: "formula.functionList.FILTERXML.abstract",
    functionParameter: [
      {
        name: "formula.functionList.FILTERXML.functionParameter.number1.name",
        detail: "formula.functionList.FILTERXML.functionParameter.number1.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.FILTERXML.functionParameter.number2.name",
        detail: "formula.functionList.FILTERXML.functionParameter.number2.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      }
    ]
  },
  {
    functionName: ti.WEBSERVICE,
    functionType: Kc2.Web,
    description: "formula.functionList.WEBSERVICE.description",
    abstract: "formula.functionList.WEBSERVICE.abstract",
    functionParameter: [
      {
        name: "formula.functionList.WEBSERVICE.functionParameter.number1.name",
        detail: "formula.functionList.WEBSERVICE.functionParameter.number1.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      },
      {
        name: "formula.functionList.WEBSERVICE.functionParameter.number2.name",
        detail: "formula.functionList.WEBSERVICE.functionParameter.number2.detail",
        example: "A1:A20",
        require: 1,
        repeat: 0
      }
    ]
  }
];
var Vr3 = [
  ..._r3,
  ...Mr2,
  ...qr3,
  ...Ur2,
  ...hr3,
  ...Or2,
  ...Fr3,
  ...gr4,
  ...yr3,
  ...xr2,
  ...br5,
  ...Dr3,
  ...vr4,
  ...Cr2,
  ...Br2
];
function Gr4(n3, e) {
  let a4 = "";
  return n3.aliasFunctionName ? (a4 = e.t(n3.aliasFunctionName), a4 === n3.aliasFunctionName && (a4 = n3.functionName)) : a4 = n3.functionName, a4;
}
var Hr2 = Object.getOwnPropertyDescriptor;
var wr3 = (n3, e, a4, i) => {
  for (var r = i > 1 ? void 0 : i ? Hr2(e, a4) : e, o3 = n3.length - 1, u2; o3 >= 0; o3--)
    (u2 = n3[o3]) && (r = u2(r) || r);
  return r;
};
var yt3 = (n3, e) => (a4, i) => e(a4, i, n3);
var Et2 = createIdentifier("formula.description-service");
var Gt2 = class {
  constructor(n3, e, a4) {
    w(this, "_descriptions", []);
    this._functionService = n3, this._localeService = e, this._configService = a4, this._initialize();
  }
  dispose() {
    this._localeService.localeChanged$.complete();
  }
  getDescriptions() {
    return this._functionService.getDescriptions();
  }
  hasFunction(n3) {
    return this._functionService.getDescriptions().get(n3.toLocaleUpperCase()) !== void 0;
  }
  getFunctionInfo(n3) {
    return this._functionService.getDescriptions().get(n3.toLocaleUpperCase());
  }
  getSearchListByName(n3) {
    const e = [], a4 = this._functionService.getDescriptions(), i = n3.toLocaleUpperCase().trim();
    return a4.forEach((r) => {
      const { functionName: o3, abstract: u2, functionType: f4 } = r;
      o3.toLocaleUpperCase().indexOf(i) > -1 && f4 !== Kc2.DefinedName && e.push({ name: o3, desc: u2 });
    }), e;
  }
  getSearchListByNameFirstLetter(n3) {
    const e = [], a4 = this._functionService.getDescriptions(), i = n3.toLocaleUpperCase().trim();
    return a4.forEach((r) => {
      const { functionName: o3, abstract: u2, functionType: f4 } = r;
      o3.toLocaleUpperCase().indexOf(i) === 0 && e.push({ name: o3, desc: u2, functionType: f4 });
    }), e;
  }
  getSearchListByType(n3) {
    const e = [];
    return this._functionService.getDescriptions().forEach((i) => {
      const { functionName: r, functionType: o3, abstract: u2 } = i;
      (o3 === n3 || n3 === -1) && o3 !== Kc2.DefinedName && e.push({ name: r, desc: u2 });
    }), e;
  }
  registerDescriptions(n3) {
    return this._descriptions = this._descriptions.concat(n3), this._registerDescriptions(), Be(() => {
      const e = n3.map((a4) => a4.functionName);
      this.unregisterDescriptions(e);
    });
  }
  unregisterDescriptions(n3) {
    this._descriptions = this._descriptions.filter((e) => !n3.includes(e.functionName)), this._functionService.unregisterDescriptions(...n3);
  }
  hasDescription(n3) {
    return this._descriptions.some((e) => e.functionName === n3);
  }
  hasDefinedNameDescription(n3) {
    return this._descriptions.some((e) => e.functionName === n3 && e.functionType === Kc2.DefinedName);
  }
  isFormulaDefinedName(n3) {
    const e = this._descriptions.filter((i) => i.functionName === n3 && i.functionType === Kc2.DefinedName);
    if (e.length === 0)
      return false;
    const a4 = e[0].description;
    return !xl(a4);
  }
  _initialize() {
    this._localeService.localeChanged$.subscribe(() => {
      this._registerDescriptions();
    }), this._initDescription(), this._registerDescriptions();
  }
  _initDescription() {
    var i;
    const n3 = [
      ...jh,
      ...gg,
      ...dg,
      ...wg,
      ...g1,
      ...Ad2,
      ...p0,
      ...Q0,
      ...hC,
      ...ZC2,
      ...SA,
      ...jA,
      ...nR2,
      ...lb2,
      ...fb2,
      ...gb2
    ].map((r) => r[1]), e = Vr3.filter((r) => n3.includes(r.functionName)), a4 = this._configService.getConfig(Ue3);
    this._descriptions = e.concat((i = a4 == null ? void 0 : a4.description) != null ? i : []);
  }
  _registerDescriptions() {
    const n3 = this._localeService, e = this._descriptions.map((a4) => ({
      functionName: Gr4(a4, n3),
      functionType: a4.functionType,
      description: n3.t(a4.description),
      abstract: n3.t(a4.abstract),
      functionParameter: a4.functionParameter.map((i) => ({
        name: n3.t(i.name),
        detail: n3.t(i.detail),
        example: i.example,
        require: i.require,
        repeat: i.repeat
      }))
    }));
    this._functionService.registerDescriptions(...e);
  }
};
Gt2 = wr3([
  yt3(0, Xt),
  yt3(1, Inject(Hn)),
  yt3(2, xs)
], Gt2);
var Yr2 = Object.getOwnPropertyDescriptor;
var Xr3 = (n3, e, a4, i) => {
  for (var r = i > 1 ? void 0 : i ? Yr2(e, a4) : e, o3 = n3.length - 1, u2; o3 >= 0; o3--)
    (u2 = n3[o3]) && (r = u2(r) || r);
  return r;
};
var we4 = (n3, e) => (a4, i) => e(a4, i, n3);
var rt4 = class extends Ve {
  constructor(e, a4, i, r) {
    super();
    w(this, "_preUnitId", null);
    this._descriptionService = e, this._definedNamesService = a4, this._univerInstanceService = i, this._commandService = r, this._initialize();
  }
  _initialize() {
    this._descriptionListener(), this._changeUnitListener(), this._changeSheetListener();
  }
  _descriptionListener() {
    Be(
      this._definedNamesService.update$.subscribe(() => {
        this._registerDescriptions();
      })
    );
  }
  _changeUnitListener() {
    Be(
      this._univerInstanceService.getCurrentTypeOfUnit$(we.UNIVER_SHEET).subscribe(() => {
        this._unRegisterDescriptions(), this._registerDescriptions();
      })
    );
  }
  _changeSheetListener() {
    this.disposeWithMe(
      this._commandService.onCommandExecuted((e, a4) => {
        if (!(a4 != null && a4.fromCollab)) {
          if (e.id === pn.id)
            this._unregisterDescriptionsForNotInSheetId(), this._registerDescriptions();
          else if (e.id === _a2.id) {
            const i = e.params;
            this._registerDescription(i);
          } else if (e.id === Vo2.id) {
            const i = e.params;
            this._unregisterDescription(i);
          }
        }
      })
    );
  }
  _registerDescription(e) {
    const { unitId: a4, sheetId: i } = this._getUnitIdAndSheetId();
    if (a4 == null || i == null)
      return;
    const { name: r, comment: o3, formulaOrRefString: u2, localSheetId: f4 } = e;
    !this._descriptionService.hasDescription(r) && (f4 == null || f4 === mg || f4 === i) && this._descriptionService.registerDescriptions([{
      functionName: r,
      description: u2 + (o3 || ""),
      abstract: u2,
      functionType: Kc2.DefinedName,
      functionParameter: []
    }]);
  }
  _unregisterDescription(e) {
    const { name: a4 } = e;
    this._descriptionService.unregisterDescriptions([a4]);
  }
  _unRegisterDescriptions() {
    if (this._preUnitId == null)
      return;
    const e = this._definedNamesService.getDefinedNameMap(this._preUnitId);
    if (e == null)
      return;
    const a4 = [];
    Array.from(Object.values(e)).forEach((i) => {
      const { name: r } = i;
      a4.push(r);
    }), this._descriptionService.unregisterDescriptions(a4), this._preUnitId = null;
  }
  _getUnitIdAndSheetId() {
    const e = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET);
    if (e == null)
      return {};
    const a4 = e.getActiveSheet();
    return a4 == null ? {} : {
      unitId: e.getUnitId(),
      sheetId: a4.getSheetId()
    };
  }
  _registerDescriptions() {
    const { unitId: e, sheetId: a4 } = this._getUnitIdAndSheetId();
    if (e == null || a4 == null)
      return;
    const i = this._definedNamesService.getDefinedNameMap(e);
    if (!i)
      return;
    const r = [];
    this._preUnitId = e, Array.from(Object.values(i)).forEach((o3) => {
      const { name: u2, comment: f4, formulaOrRefString: m9, localSheetId: c2 } = o3;
      !this._descriptionService.hasDescription(u2) && (c2 == null || c2 === mg || c2 === a4) && r.push({
        functionName: u2,
        description: m9 + (f4 || ""),
        abstract: m9,
        functionType: Kc2.DefinedName,
        functionParameter: []
      });
    }), this._descriptionService.registerDescriptions(r);
  }
  _unregisterDescriptionsForNotInSheetId() {
    const { unitId: e, sheetId: a4 } = this._getUnitIdAndSheetId();
    if (e == null || a4 == null)
      return;
    const i = this._definedNamesService.getDefinedNameMap(e);
    if (!i)
      return;
    const r = [];
    Array.from(Object.values(i)).forEach((o3) => {
      const { name: u2, localSheetId: f4 } = o3;
      f4 !== mg && f4 !== a4 && r.push(u2);
    }), this._descriptionService.unregisterDescriptions(r);
  }
};
rt4 = Xr3([
  we4(0, Et2),
  we4(1, Lr),
  we4(2, br),
  we4(3, Ds)
], rt4);
var Wr3 = Object.getOwnPropertyDescriptor;
var Kr3 = (n3, e, a4, i) => {
  for (var r = i > 1 ? void 0 : i ? Wr3(e, a4) : e, o3 = n3.length - 1, u2; o3 >= 0; o3--)
    (u2 = n3[o3]) && (r = u2(r) || r);
  return r;
};
var kr3 = (n3, e) => (a4, i) => e(a4, i, n3);
var ot3 = class extends Ve {
  constructor(n3) {
    super(), this._commandService = n3, [
      Ri2,
      Si2,
      _e4
    ].forEach((e) => this._commandService.registerCommand(e));
  }
};
ot3 = Kr3([
  kr3(0, Ds)
], ot3);
var Qr3 = Object.getOwnPropertyDescriptor;
var $r3 = (n3, e, a4, i) => {
  for (var r = i > 1 ? void 0 : i ? Qr3(e, a4) : e, o3 = n3.length - 1, u2; o3 >= 0; o3--)
    (u2 = n3[o3]) && (r = u2(r) || r);
  return r;
};
var Ye4 = (n3, e) => (a4, i) => e(a4, i, n3);
var ut3 = class extends Ve {
  constructor(e, a4, i, r) {
    super();
    w(this, "_preUnitId", null);
    this._descriptionService = e, this._univerInstanceService = a4, this._commandService = i, this._superTableService = r, this._initialize();
  }
  _initialize() {
    this._descriptionListener(), this._changeUnitListener(), this._changeSheetListener();
  }
  _descriptionListener() {
    Be(
      this._superTableService.update$.subscribe(() => {
        this._registerDescriptions();
      })
    );
  }
  _changeUnitListener() {
    Be(
      this._univerInstanceService.getCurrentTypeOfUnit$(we.UNIVER_SHEET).subscribe(() => {
        this._unRegisterDescriptions(), this._registerDescriptions();
      })
    );
  }
  _changeSheetListener() {
    this.disposeWithMe(
      this._commandService.onCommandExecuted((e, a4) => {
        if (!(a4 != null && a4.fromCollab)) {
          if (e.id === pn.id)
            this._unregisterDescriptionsForNotInSheetId(), this._registerDescriptions();
          else if (e.id === kl.id) {
            const i = e.params;
            this._registerDescription(i);
          } else if (e.id === $l.id) {
            const i = e.params;
            this._unregisterDescription(i);
          }
        }
      })
    );
  }
  _registerDescription(e) {
    var u2, f4;
    const { unitId: a4, sheetId: i } = this._getUnitIdAndSheetId();
    if (a4 == null || i == null)
      return;
    const { tableName: r, reference: o3 } = e;
    if (!this._descriptionService.hasDescription(r)) {
      const m9 = ((f4 = (u2 = this._univerInstanceService.getUnit(a4)) == null ? void 0 : u2.getSheetBySheetId(o3.sheetId)) == null ? void 0 : f4.getName()) || "", c2 = wl(m9, o3.range);
      this._descriptionService.registerDescriptions([{
        functionName: r,
        description: c2,
        abstract: c2,
        functionType: Kc2.Table,
        functionParameter: []
      }]);
    }
  }
  _unregisterDescription(e) {
    const { tableName: a4 } = e;
    this._descriptionService.unregisterDescriptions([a4]);
  }
  _unRegisterDescriptions() {
    if (this._preUnitId == null)
      return;
    const e = this._superTableService.getTableMap(this._preUnitId);
    if (e == null)
      return;
    const a4 = [];
    e.forEach((i, r) => {
      a4.push(r);
    }), this._descriptionService.unregisterDescriptions(a4), this._preUnitId = null;
  }
  _getUnitIdAndSheetId() {
    const e = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET);
    if (e == null)
      return {};
    const a4 = e.getActiveSheet();
    return a4 == null ? {} : {
      unitId: e.getUnitId(),
      sheetId: a4.getSheetId()
    };
  }
  _registerDescriptions() {
    const { unitId: e, sheetId: a4 } = this._getUnitIdAndSheetId();
    if (e == null || a4 == null)
      return;
    const i = this._superTableService.getTableMap(e);
    if (!i)
      return;
    const r = [];
    this._preUnitId = e, i.forEach((o3, u2) => {
      var c2, l4;
      const f4 = ((l4 = (c2 = this._univerInstanceService.getUnit(e)) == null ? void 0 : c2.getSheetBySheetId(o3.sheetId)) == null ? void 0 : l4.getName()) || "", m9 = wl(f4, o3.range);
      this._descriptionService.hasDescription(u2) || r.push({
        functionName: u2,
        description: m9,
        abstract: m9,
        functionType: Kc2.Table,
        functionParameter: []
      });
    }), this._descriptionService.registerDescriptions(r);
  }
  _unregisterDescriptionsForNotInSheetId() {
    const { unitId: e, sheetId: a4 } = this._getUnitIdAndSheetId();
    if (e == null || a4 == null)
      return;
    const i = this._superTableService.getTableMap(e);
    if (!i)
      return;
    const r = [];
    i.forEach((o3, u2) => {
      r.push(u2);
    }), this._descriptionService.unregisterDescriptions(r);
  }
};
ut3 = $r3([
  Ye4(0, Et2),
  Ye4(1, br),
  Ye4(2, Ds),
  Ye4(3, Pr)
], ut3);
var jr3 = Object.getOwnPropertyDescriptor;
var zr2 = (n3, e, a4, i) => {
  for (var r = i > 1 ? void 0 : i ? jr3(e, a4) : e, o3 = n3.length - 1, u2; o3 >= 0; o3--)
    (u2 = n3[o3]) && (r = u2(r) || r);
  return r;
};
var Xe7 = (n3, e) => (a4, i) => e(a4, i, n3);
function Ea3(n3, e, a4, i) {
  const r = n3.sequenceNodesBuilder(e);
  if (r == null)
    return e;
  const o3 = [];
  for (let u2 = 0, f4 = r.length; u2 < f4; u2++) {
    const m9 = r[u2];
    if (typeof m9 == "string" || m9.nodeType !== He.REFERENCE)
      continue;
    const { token: c2 } = m9, l4 = br3(c2), { sheetName: p3, unitId: T10 } = l4;
    let L6 = l4.range;
    L6.startAbsoluteRefType === ye.ALL && L6.endAbsoluteRefType === ye.ALL || (L6 = w1(L6, a4, i), o3.push({
      unitId: T10,
      sheetName: p3,
      range: L6
    }));
  }
  return o3.map((u2) => `${u2.unitId}!${u2.sheetName}!${u2.range.startRow}!${u2.range.endRow}!${u2.range.startColumn}!${u2.range.endColumn}`).join("|");
}
var Ht3 = class extends Ve {
  constructor(n3, e, a4, i) {
    super(), this._refRangeService = n3, this._lexerTreeBuilder = e, this._univerInstanceService = a4, this._injector = i;
  }
  transformFormulaByEffectCommand(n3, e, a4, i) {
    const r = this._lexerTreeBuilder.sequenceNodesBuilder(a4), o3 = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET), u2 = o3.getActiveSheet(), f4 = o3.getUnitId(), m9 = u2.getSheetId(), c2 = r == null ? void 0 : r.map((l4) => {
      if (typeof l4 == "object" && l4.nodeType === He.REFERENCE) {
        const p3 = br3(l4.token), { range: T10, unitId: L6, sheetName: I6 } = p3, A4 = this._univerInstanceService.getUnit(L6 || n3), N6 = I6 ? A4 == null ? void 0 : A4.getSheetBySheetName(I6) : A4 == null ? void 0 : A4.getSheetBySheetId(e);
        if (!N6)
          throw new Error("Sheet not found");
        const d2 = A4.getUnitId(), S = N6.getSheetId();
        if (d2 !== f4 || S !== m9)
          return l4;
        const R9 = po2(T10, i);
        let P8 = "";
        if (R9) {
          const h9 = R9.startColumn - T10.startColumn, M10 = R9.startRow - T10.startRow, U3 = w1(T10, h9, M10);
          L6 && I6 ? P8 = Ll(L6, I6, U3) : I6 ? P8 = wl(I6, U3) : P8 = Yt(U3);
        } else
          P8 = h.REF;
        return __spreadProps(__spreadValues({}, l4), {
          token: P8
        });
      } else
        return l4;
    });
    return c2 ? `=${yi(c2)}` : "";
  }
  registerFormula(n3, e, a4, i) {
    const r = /* @__PURE__ */ new Map(), o3 = this._lexerTreeBuilder.sequenceNodesBuilder(a4), u2 = new ho(), f4 = (m9) => {
      const c2 = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET), l4 = c2.getActiveSheet(), p3 = c2.getUnitId(), T10 = l4.getSheetId(), L6 = o3 == null ? void 0 : o3.map((A4) => {
        if (typeof A4 == "object" && A4.nodeType === He.REFERENCE) {
          const N6 = r.get(A4.token);
          if (N6.unitId !== p3 || N6.subUnitId !== T10)
            return A4;
          const d2 = po2(N6.range, m9);
          let S = "";
          if (d2) {
            const R9 = d2.startColumn - N6.range.startColumn, P8 = d2.startRow - N6.range.startRow, h9 = w1(N6.range, R9, P8);
            N6.unitId && N6.sheetName ? S = Ll(N6.unitId, N6.sheetName, h9) : N6.sheetName ? S = wl(N6.sheetName, h9) : S = Yt(h9);
          } else
            S = h.REF;
          return __spreadProps(__spreadValues({}, A4), {
            token: S
          });
        } else
          return A4;
      }), I6 = L6 && yi(L6);
      return i(`=${I6}`);
    };
    return o3 == null || o3.forEach((m9) => {
      if (typeof m9 == "object" && m9.nodeType === He.REFERENCE) {
        const c2 = br3(m9.token), { range: l4, unitId: p3, sheetName: T10 } = c2, L6 = this._univerInstanceService.getUnit(p3 || n3), I6 = T10 ? L6 == null ? void 0 : L6.getSheetBySheetName(T10) : L6 == null ? void 0 : L6.getSheetBySheetId(e);
        if (!I6)
          return;
        const A4 = L6.getUnitId(), N6 = I6.getSheetId(), d2 = {
          unitId: A4,
          subUnitId: N6,
          range: l4,
          sheetName: T10
        };
        r.set(m9.token, d2), u2.add(this._refRangeService.registerRefRange(l4, f4, A4, N6));
      }
    }), u2;
  }
  _getFormulaDependcy(n3, e, a4, i) {
    const r = Jg(a4) ? this._lexerTreeBuilder.sequenceNodesBuilder(a4) : null, o3 = [];
    return r == null || r.forEach((u2) => {
      if (typeof u2 == "object" && u2.nodeType === He.REFERENCE) {
        const f4 = br3(u2.token), { range: m9, unitId: c2, sheetName: l4 } = f4;
        if (m9.startAbsoluteRefType === ye.ALL && m9.endAbsoluteRefType === ye.ALL)
          return;
        const p3 = this._univerInstanceService.getUnit(c2 || n3), T10 = l4 ? p3 == null ? void 0 : p3.getSheetBySheetName(l4) : p3 == null ? void 0 : p3.getSheetBySheetId(e);
        if (!T10)
          return;
        const L6 = p3.getUnitId(), I6 = T10.getSheetId(), A4 = i[0].startRow, N6 = i[0].startColumn, d2 = m9.startRow, S = m9.startColumn, R9 = i.map((P8) => ({
          startRow: P8.startRow - A4 + d2,
          endRow: P8.endRow - A4 + d2,
          startColumn: P8.startColumn - N6 + S,
          endColumn: P8.endColumn - N6 + S
        }));
        o3.push({
          unitId: L6,
          subUnitId: I6,
          ranges: R9
        });
      }
    }), o3;
  }
  // eslint-disable-next-line max-lines-per-function
  registerRangeFormula(n3, e, a4, i, r) {
    const o3 = new ho(), u2 = i.map((m9) => this._getFormulaDependcy(n3, e, m9, a4)), f4 = (m9) => {
      const c2 = a4[0].startRow, l4 = a4[0].startColumn, p3 = [{ unitId: n3, subUnitId: e, ranges: a4 }, ...u2.flat()], T10 = [], L6 = qh(this._injector, m9);
      for (const { unitId: I6, subUnitId: A4, ranges: N6 } of p3)
        if (I6 === L6.unitId && A4 === L6.subUnitId) {
          const d2 = [], S = N6[0].startRow, R9 = N6[0].startColumn, P8 = S - c2, h9 = R9 - l4;
          for (const M10 of L6.ranges) {
            const U3 = N6.map((q9) => Gp(M10, q9)).filter(Boolean);
            U3.length > 0 && d2.push(...U3);
          }
          d2.length > 0 && T10.push(
            d2.map((M10) => ({
              startRow: M10.startRow - P8,
              endRow: M10.endRow - P8,
              startColumn: M10.startColumn - h9,
              endColumn: M10.endColumn - h9
            }))
          );
        }
      if (T10.length > 0) {
        const I6 = Cn.splitIntoGrid([...T10.flat()]), A4 = Cn.subtractMulti(a4, I6);
        A4.sort((P8, h9) => P8.startRow - h9.startRow || P8.startColumn - h9.startColumn);
        const N6 = /* @__PURE__ */ new Map();
        for (let P8 = 0; P8 < I6.length; P8++) {
          const h9 = I6[P8], M10 = h9.startRow, U3 = h9.startColumn, q9 = M10 - c2, x7 = U3 - l4, F7 = So3(h9, m9).sort((Z9, oe5) => Z9.startRow - oe5.startRow || Z9.startColumn - oe5.startColumn);
          if (!F7.length)
            continue;
          const B5 = F7[0].startRow, ae5 = F7[0].startColumn, O9 = B5 - c2, ce5 = ae5 - l4, ne4 = [];
          for (let Z9 = 0; Z9 < i.length; Z9++) {
            const oe5 = i[Z9], ue4 = Jg(oe5), Fe6 = ue4 ? this._lexerTreeBuilder.moveFormulaRefOffset(oe5, x7, q9) : oe5, J6 = ue4 ? this.transformFormulaByEffectCommand(n3, e, Fe6, m9) : Fe6, Nt5 = Ea3(this._lexerTreeBuilder, J6, -ce5, -O9);
            ne4.push({
              newFormula: J6,
              orginFormula: Nt5
            });
          }
          const le3 = {
            formulas: ne4,
            ranges: F7,
            key: ne4.map((Z9) => Z9.orginFormula).join("_")
          };
          N6.has(le3.key) ? N6.get(le3.key).push(le3) : N6.set(le3.key, [le3]);
        }
        const d2 = i.map((P8) => Ea3(this._lexerTreeBuilder, P8, 0, 0)).join("_");
        if (A4.length > 0) {
          const P8 = A4[0].startRow, h9 = A4[0].startColumn, M10 = [];
          for (let q9 = 0; q9 < i.length; q9++) {
            const x7 = i[q9];
            M10.push({
              newFormula: Jg(x7) ? this._lexerTreeBuilder.moveFormulaRefOffset(x7, h9 - l4, P8 - c2) : x7,
              orginFormula: x7
            });
          }
          const U3 = {
            formulas: M10,
            ranges: A4,
            key: d2
          };
          N6.has(U3.key) ? N6.get(U3.key).push(U3) : N6.set(U3.key, [U3]);
        }
        const S = [], R9 = Array.from(N6.keys());
        for (let P8 = R9.length - 1; P8 >= 0; P8--) {
          const h9 = R9[P8], M10 = N6.get(h9).sort((x7, F7) => x7.ranges[0].startRow - F7.ranges[0].startRow || x7.ranges[0].startColumn - F7.ranges[0].startColumn), U3 = [];
          for (let x7 = 0; x7 < M10[0].formulas.length; x7++)
            U3.push(M10[0].formulas[x7].newFormula);
          const q9 = Cn.mergeRanges(M10.map((x7) => x7.ranges).flat());
          q9.sort((x7, F7) => x7.startRow - F7.startRow || x7.startColumn - F7.startColumn), S.push({
            formulas: U3,
            ranges: q9
          });
        }
        return r(S);
      }
      return {
        undos: [],
        redos: []
      };
    };
    return a4.forEach((m9) => {
      const c2 = this._refRangeService.registerRefRange(m9, f4, n3, e);
      o3.add(c2);
    }), [...u2.flat()].forEach(({ unitId: m9, subUnitId: c2, ranges: l4 }) => {
      l4.forEach((p3) => {
        const T10 = this._refRangeService.registerRefRange(p3, f4, m9, c2);
        o3.add(T10);
      });
    }), o3;
  }
};
Ht3 = zr2([
  Xe7(0, Inject(At3)),
  Xe7(1, Inject(Mn)),
  Xe7(2, br),
  Xe7(3, Inject(Injector))
], Ht3);
var Zr3 = Object.getOwnPropertyDescriptor;
var Jr4 = (n3, e, a4, i) => {
  for (var r = i > 1 ? void 0 : i ? Zr3(e, a4) : e, o3 = n3.length - 1, u2; o3 >= 0; o3--)
    (u2 = n3[o3]) && (r = u2(r) || r);
  return r;
};
var eo3 = (n3, e) => (a4, i) => e(a4, i, n3);
var $t3 = "sheets-formula.remote-register-function.service";
var Za3 = createIdentifier($t3);
var mt3 = class {
  constructor(n3) {
    this._functionService = n3;
  }
  registerFunctions(n3) {
    return __async(this, null, function* () {
      const e = n3.map(([a4, i]) => to3(a4, i));
      this._functionService.registerExecutors(...e);
    });
  }
  registerAsyncFunctions(n3) {
    return __async(this, null, function* () {
      const e = n3.map(([a4, i]) => ao2(a4, i));
      this._functionService.registerExecutors(...e);
    });
  }
  unregisterFunctions(n3) {
    return __async(this, null, function* () {
      this._functionService.unregisterExecutors(...n3), this._functionService.unregisterDescriptions(...n3), this._functionService.deleteFormulaAstCacheKey(...n3);
    });
  }
};
mt3 = Jr4([
  eo3(0, Xt)
], mt3);
function to3(n3, e) {
  const a4 = new _g(e), i = new Function(`return ${n3}`)();
  return a4.calculateCustom = i, a4;
}
function ao2(n3, e) {
  const a4 = new Hb(e), i = new Function(`return ${n3}`)();
  return a4.calculateCustom = i, a4;
}
var no2 = Object.getOwnPropertyDescriptor;
var io = (n3, e, a4, i) => {
  for (var r = i > 1 ? void 0 : i ? no2(e, a4) : e, o3 = n3.length - 1, u2; o3 >= 0; o3--)
    (u2 = n3[o3]) && (r = u2(r) || r);
  return r;
};
var We4 = (n3, e) => (a4, i) => e(a4, i, n3);
var ro3 = createIdentifier(
  "sheets-formula.register-function-service"
);
var wt3 = class extends Ve {
  constructor(n3, e, a4, i) {
    super(), this._localeService = n3, this._descriptionService = e, this._functionService = a4, this._remoteRegisterFunctionService = i;
  }
  registerFunction(n3) {
    return this._registerSingleFunction(n3);
  }
  registerAsyncFunction(n3) {
    return this._registerSingleFunction(__spreadProps(__spreadValues({}, n3), { async: true }));
  }
  registerFunctions(n3) {
    const { locales: e, description: a4, calculate: i } = n3;
    e && this._localeService.load(e);
    const r = new ho();
    if (a4)
      r.add(this._descriptionService.registerDescriptions(a4));
    else {
      const o3 = i.map(([u2, f4, m9]) => ({
        functionName: f4,
        functionType: Kc2.User,
        description: "",
        abstract: m9 || "",
        functionParameter: []
      }));
      r.add(this._functionService.registerDescriptions(...o3));
    }
    return r.add(this._registerLocalExecutors(i)), this._remoteRegisterFunctionService && r.add(this._registerRemoteExecutors(i)), r;
  }
  _registerSingleFunction(n3) {
    const { name: e, func: a4, description: i, locales: r, async: o3 = false } = n3, u2 = new ho();
    if (r && this._localeService.load(r), typeof i == "string") {
      const m9 = {
        functionName: e,
        functionType: Kc2.User,
        description: i,
        abstract: i || "",
        functionParameter: []
      };
      u2.add(this._descriptionService.registerDescriptions([m9]));
    } else
      u2.add(this._descriptionService.registerDescriptions([i]));
    const f4 = o3 ? new Hb(e) : new _g(e);
    return f4.calculateCustom = a4, this._functionService.registerExecutors(f4), u2.add(Be(() => this._functionService.unregisterExecutors(e))), u2.add(Be(() => this._functionService.unregisterDescriptions(e))), u2.add(Be(() => this._functionService.deleteFormulaAstCacheKey(e))), this._remoteRegisterFunctionService && (this._remoteRegisterFunctionService.registerAsyncFunctions([[a4.toString(), e]]), u2.add(
      Be(() => this._remoteRegisterFunctionService.unregisterFunctions([e]))
    )), u2;
  }
  _registerLocalExecutors(n3) {
    const e = n3.map(([i, r]) => r), a4 = n3.map(([i, r]) => {
      const o3 = new _g(r);
      return o3.calculateCustom = i, o3;
    });
    return this._functionService.registerExecutors(...a4), Be(() => this._functionService.unregisterExecutors(...e));
  }
  _registerRemoteExecutors(n3) {
    const e = [], a4 = n3.map(([i, r]) => (e.push(r), [i.toString(), r]));
    return this._remoteRegisterFunctionService.registerFunctions(a4), Be(() => this._remoteRegisterFunctionService.unregisterFunctions(e));
  }
};
wt3 = io([
  We4(0, Inject(Hn)),
  We4(1, Inject(Et2)),
  We4(2, Xt),
  We4(3, Optional(Za3))
], wt3);
var oo2 = Object.defineProperty;
var uo5 = Object.getOwnPropertyDescriptor;
var mo2 = (n3, e, a4) => e in n3 ? oo2(n3, e, { enumerable: true, configurable: true, writable: true, value: a4 }) : n3[e] = a4;
var Ja2 = (n3, e, a4, i) => {
  for (var r = i > 1 ? void 0 : i ? uo5(e, a4) : e, o3 = n3.length - 1, u2; o3 >= 0; o3--)
    (u2 = n3[o3]) && (r = u2(r) || r);
  return r;
};
var ft = (n3, e) => (a4, i) => e(a4, i, n3);
var It3 = (n3, e, a4) => mo2(n3, typeof e != "symbol" ? e + "" : e, a4);
var ct5 = class extends yl {
  constructor(n3 = Pa3, e, a4) {
    super(), this._config = n3, this._injector = e, this._configService = a4;
    const i = __objRest(co(
      {},
      Pa3,
      this._config
    ), []);
    this._configService.setConfig(Ai, i);
  }
  onStarting() {
    this._injector.add([mt3]), this._injector.get(I3).registerChannel(
      $t3,
      Y2(this._injector.get(mt3))
    );
  }
};
It3(ct5, "pluginName", "SHEET_FORMULA_REMOTE_PLUGIN");
It3(ct5, "type", we.UNIVER_SHEET);
ct5 = Ja2([
  sI(uo3),
  ft(1, Inject(Injector)),
  ft(2, xs)
], ct5);
var lt4 = class extends yl {
  constructor(n3 = La2, e, a4) {
    super(), this._config = n3, this._injector = e, this._configService = a4;
    const i = __objRest(co(
      {},
      La2,
      this._config
    ), []);
    this._configService.setConfig(Ue3, i, { merge: true });
  }
  onStarting() {
    const n3 = this._injector, e = [
      [ro3, { useClass: wt3 }],
      [Et2, { useClass: Gt2 }],
      [ot3],
      [Ht3],
      [et3],
      [it],
      [Je4],
      [ge4],
      [at2],
      [nt3],
      [rt4],
      [tt4],
      [ut3]
    ];
    if (this._config.notExecuteFormula) {
      const a4 = n3.get(I3);
      e.push([Za3, {
        useFactory: () => B(a4.requestChannel($t3))
      }]);
    }
    e.forEach((a4) => n3.add(a4));
  }
  onReady() {
    Kc(this._injector, [
      [ot3],
      [nt3],
      [it],
      [Je4],
      [at2],
      [tt4]
    ]), RR() && Kc(this._injector, [
      [ge4]
    ]);
  }
  onRendered() {
    Kc(this._injector, [
      [rt4],
      [ut3]
    ]), RR() || Kc(this._injector, [
      [ge4]
    ]);
  }
};
It3(lt4, "pluginName", Ir3);
It3(lt4, "type", we.UNIVER_SHEET);
lt4 = Ja2([
  sI(uo3, rs2),
  ft(1, Inject(Injector)),
  ft(2, xs)
], lt4);
function Po3(n3, e, a4, i) {
  const r = n3.get(Wt), o3 = n3.get(pr), u2 = n3.get(Gr2), f4 = n3.get(Vr);
  r.load({
    formulaData: {},
    arrayFormulaCellData: {},
    arrayFormulaRange: {},
    forceCalculate: false,
    dirtyRanges: [],
    dirtyNameMap: {},
    dirtyDefinedNameMap: {},
    dirtyUnitFeatureMap: {},
    excludedCell: {},
    allUnitData: {
      [a4]: i
    },
    dirtyUnitOtherFormulaMap: {}
  });
  const m9 = o3.treeBuilder(e), c2 = u2.parse(m9), l4 = f4.execute(Bi(c2));
  return Qb(l4);
}

// node_modules/@univerjs/sheets-ui/lib/es/index.js
var import_react = __toESM(require_react());
var import_jsx_runtime = __toESM(require_jsx_runtime());

// node_modules/@univerjs/telemetry/lib/es/index.js
var t = createIdentifier("telemetry.service");

// node_modules/@univerjs/sheets-ui/lib/es/index.js
var Qp = Object.defineProperty;
var Kp = (n3, e, t3) => e in n3 ? Qp(n3, e, { enumerable: true, configurable: true, writable: true, value: t3 }) : n3[e] = t3;
var _2 = (n3, e, t3) => Kp(n3, typeof e != "symbol" ? e + "" : e, t3);
function Xd2(n3, e) {
  if (n3 == null)
    return;
  const t3 = e.getRenderById(n3);
  if (t3 == null)
    return;
  const { mainComponent: r, scene: i, engine: o3, components: s2 } = t3, l4 = r, a4 = s2.get($e3.BACKGROUND);
  return {
    document: l4,
    docBackground: a4,
    scene: i,
    engine: o3
  };
}
var Xc3 = [10, 400];
var _m2 = "RANGE_SELECTOR_COMPONENT_KEY";
var zd2 = "EMBEDDING_FORMULA_EDITOR_COMPONENT_KEY";
var Ge5 = ((n3) => (n3.MAIN = "__SpreadsheetRender__", n3.ROW = "__SpreadsheetRowHeader__", n3.COLUMN = "__SpreadsheetColumnHeader__", n3.LEFT_TOP = "__SpreadsheetLeftTopPlaceholder__", n3))(Ge5 || {});
var Zu2 = 0;
var Js3 = 1;
var nr5 = 10;
var BC = 11;
var Gu2 = 12;
var ca3 = {
  id: "sheet.command.set-row-header-width",
  type: Ls.COMMAND,
  handler: (n3, e) => __async(void 0, null, function* () {
    if (!e)
      return false;
    const t3 = n3.get(JE);
    if (!t3)
      return false;
    const { unitId: r, subUnitId: i, size: o3 } = e, s2 = t3.getRenderById(r);
    if (s2) {
      t3.getRenderById(r).with(he2).setRowHeaderSize(s2, i, o3);
      const { components: a4 } = s2, c2 = a4.get(Ge5.ROW);
      c2 && c2.setCustomHeader({ headerStyle: { size: o3 } }, i);
    }
    return true;
  })
};
var da = {
  id: "sheet.command.set-col-header-height",
  type: Ls.COMMAND,
  handler: (n3, e) => __async(void 0, null, function* () {
    if (!e)
      return false;
    const t3 = n3.get(JE);
    if (!t3)
      return false;
    const { unitId: r, subUnitId: i, size: o3 } = e, s2 = t3.getRenderById(r);
    if (s2) {
      t3.getRenderById(r).with(he2).setColumnHeaderSize(s2, i, o3);
      const { components: a4 } = s2, c2 = a4.get(Ge5.COLUMN);
      c2 && c2.setCustomHeader({ headerStyle: { size: o3 } }, i);
    }
    return true;
  })
};
var zc3 = rR("rangeMovePermissionCheck");
var jc2 = rR("rangeFillPermissionCheck");
var Rm = ((n3) => (n3[n3.FORMULA_EDITOR_SHOW = 100] = "FORMULA_EDITOR_SHOW", n3[n3.MARK_SELECTION = 1e4] = "MARK_SELECTION", n3))(Rm || {});
function Sr4(n3) {
  const e = n3.getColorFromTheme("primary.600"), t3 = n3.getColorFromTheme("white"), r = new At(e).setAlpha(0.07).toRgbString();
  return {
    strokeWidth: 1,
    stroke: e,
    fill: r,
    // widgets: { tl: true, tc: true, tr: true, ml: true, mr: true, bl: true, bc: true, br: true },
    widgets: {},
    widgetSize: 6,
    widgetStrokeWidth: 1,
    widgetStroke: t3,
    autofillSize: 6,
    autofillStrokeWidth: 1,
    autofillStroke: t3,
    rowHeaderFill: r,
    rowHeaderStroke: e,
    rowHeaderStrokeWidth: 1,
    columnHeaderFill: r,
    columnHeaderStroke: e,
    columnHeaderStrokeWidth: 1,
    expandCornerSize: 40
  };
}
var FC = class {
  constructor() {
    _2(this, "_startColumn", -1);
    _2(this, "_startRow", -1);
    _2(this, "_endColumn", -1);
    _2(this, "_endRow", -1);
    _2(this, "_startX", 0);
    _2(this, "_startY", 0);
    _2(this, "_endX", 0);
    _2(this, "_endY", 0);
    _2(this, "_primary");
    _2(this, "_rangeType", ge.NORMAL);
  }
  get startColumn() {
    return this._startColumn;
  }
  get startRow() {
    return this._startRow;
  }
  get endColumn() {
    return this._endColumn;
  }
  get endRow() {
    return this._endRow;
  }
  get startX() {
    return this._startX;
  }
  get startY() {
    return this._startY;
  }
  get endX() {
    return this._endX;
  }
  get endY() {
    return this._endY;
  }
  get currentCell() {
    return this._primary;
  }
  get rangeType() {
    return this._rangeType;
  }
  /**
   * @deprecated, Duplicate with `Rectangle`
   */
  isEqual(e) {
    const { startColumn: t3, startRow: r, endColumn: i, endRow: o3 } = this, {
      startColumn: s2,
      startRow: l4,
      endColumn: a4,
      endRow: c2
    } = e;
    return t3 === s2 && r === l4 && i === a4 && o3 === c2;
  }
  highlightToSelection() {
    if (this._primary)
      return Xg(this._primary);
  }
  getRange() {
    return {
      startColumn: this._startColumn,
      startRow: this._startRow,
      endColumn: this._endColumn,
      endRow: this._endRow,
      startX: this._startX,
      startY: this._startY,
      endX: this._endX,
      endY: this._endY,
      rangeType: this.rangeType
    };
  }
  getCell() {
    return this._primary;
  }
  getRangeType() {
    return this._rangeType;
  }
  setRangeType(e) {
    this._rangeType = e;
  }
  getValue() {
    return {
      rangeWithCoord: this.getRange(),
      primaryWithCoord: this._primary
    };
  }
  setValue(e, t3) {
    const {
      startColumn: r,
      startRow: i,
      endColumn: o3,
      endRow: s2,
      startX: l4,
      startY: a4,
      endX: c2,
      endY: d2,
      rangeType: u2
    } = e;
    this._startColumn = r, this._startRow = i, this._endColumn = o3, this._endRow = s2, this._startX = l4, this._startY = a4, this._endX = c2, this._endY = d2, u2 !== void 0 && (this._rangeType = u2), t3 !== void 0 && this.setCurrentCell(t3);
  }
  /**
   * Set primary cell.
   * @TODO lumixraku there are 3 concepts for same thing, primary and current and highlight
   * highlight is best. primary sometimes means the actual cell(actual means ignore merge)
   * @param currentCell
   */
  setCurrentCell(e) {
    this._primary = e;
  }
  clearCurrentCell() {
    this._primary = null;
  }
};
function Io3(n3, e) {
  const { startRow: t3, startColumn: r, endRow: i, endColumn: o3, rangeType: s2 } = e, l4 = i < t3 ? i : t3, a4 = i < t3 ? t3 : i, c2 = o3 < r ? o3 : r, d2 = o3 < r ? r : o3, u2 = n3.getNoMergeCellWithCoordByIndex(l4, c2), h9 = n3.getNoMergeCellWithCoordByIndex(a4, d2);
  return {
    startRow: t3,
    startColumn: r,
    endRow: i,
    endColumn: o3,
    rangeType: s2,
    startY: (u2 == null ? void 0 : u2.startY) || 0,
    endY: (h9 == null ? void 0 : h9.endY) || 0,
    startX: (u2 == null ? void 0 : u2.startX) || 0,
    endX: (h9 == null ? void 0 : h9.endX) || 0
  };
}
function Wt3(n3, e) {
  const { range: t3, primary: r, style: i } = n3, o3 = Io3(e, t3), s2 = r && $s2(e, r);
  return {
    rangeWithCoord: o3,
    primaryWithCoord: s2,
    style: i
  };
}
function $s2(n3, e) {
  const { actualRow: t3, actualColumn: r, isMerged: i, isMergedMainCell: o3, startRow: s2, startColumn: l4, endRow: a4, endColumn: c2 } = e, d2 = n3.getNoMergeCellWithCoordByIndex(t3, r), u2 = n3.getNoMergeCellWithCoordByIndex(s2, l4), h9 = n3.getNoMergeCellWithCoordByIndex(a4, c2);
  return {
    actualRow: t3,
    actualColumn: r,
    isMerged: i,
    isMergedMainCell: o3,
    startX: d2.startX,
    startY: d2.startY,
    endX: d2.endX,
    endY: d2.endY,
    mergeInfo: {
      startRow: s2,
      startColumn: l4,
      endRow: a4,
      endColumn: c2,
      startY: (u2 == null ? void 0 : u2.startY) || 0,
      endY: (h9 == null ? void 0 : h9.endY) || 0,
      startX: (u2 == null ? void 0 : u2.startX) || 0,
      endX: (h9 == null ? void 0 : h9.endX) || 0
    }
  };
}
var qu2 = "__SpreadsheetHelperSelectionTempRect";
var UC = 35;
var XC = class {
  constructor(e, t3) {
    _2(this, "_startOffsetX", 0);
    _2(this, "_startOffsetY", 0);
    _2(this, "_relativeSelectionPositionRow", 0);
    _2(this, "_relativeSelectionPositionColumn", 0);
    _2(this, "_relativeSelectionRowLength", 0);
    _2(this, "_relativeSelectionColumnLength", 0);
    _2(this, "_scenePointerMoveSub");
    _2(this, "_scenePointerUpSub");
    _2(this, "_disabled", false);
    _2(this, "_helperSelection");
    _2(this, "_scrollTimer");
    _2(this, "_activeViewport");
    _2(this, "_targetSelection", {
      startY: 0,
      endY: 0,
      startX: 0,
      endX: 0,
      startRow: -1,
      endRow: -1,
      startColumn: -1,
      endColumn: -1
    });
    _2(this, "_isInMergeState", false);
    _2(this, "_fillControlColors", []);
    _2(this, "_skeleton");
    _2(this, "_scene");
    _2(this, "_themeService");
    _2(this, "_injector");
    _2(this, "_selectionHooks");
    this._control = e, this._skeleton = t3.skeleton, this._scene = t3.scene, this._themeService = t3.themeService, this._injector = t3.injector, this._selectionHooks = t3.selectionHooks, this._initialControl(), this._initialWidget(), this._initialAutoFill(), this._control.dispose$.subscribe(() => {
      this.dispose();
    });
  }
  get isHelperSelection() {
    return this._control.isHelperSelection;
  }
  dispose() {
    var e, t3;
    (e = this._scrollTimer) == null || e.dispose(), this._fillControlColors = [], this._clearObserverEvent(), (t3 = this._helperSelection) == null || t3.dispose();
  }
  setDisabled(e) {
    this._disabled = e;
  }
  _getFreeze() {
    var t3, r;
    return (r = (t3 = fA(
      we.UNIVER_SHEET,
      he2,
      this._injector.get(br),
      this._injector.get(JE)
    )) == null ? void 0 : t3.getCurrentParam()) == null ? void 0 : r.skeleton.getWorksheetConfig().freeze;
  }
  _isSelectionInViewport(e, t3) {
    const r = this._getFreeze() || {
      startRow: -1,
      startColumn: -1
    };
    switch (t3.viewportKey) {
      case k2.VIEW_MAIN:
        return e.endRow >= r.startRow && e.endColumn >= r.startColumn;
      case k2.VIEW_MAIN_TOP:
      case k2.VIEW_COLUMN_RIGHT:
        return e.endColumn >= r.startColumn && e.startRow < r.startRow;
      case k2.VIEW_MAIN_LEFT:
      case k2.VIEW_ROW_BOTTOM:
        return e.endRow >= r.startRow && e.startColumn < r.startColumn;
      case k2.VIEW_MAIN_LEFT_TOP:
      case k2.VIEW_COLUMN_LEFT:
      case k2.VIEW_ROW_TOP:
      case k2.VIEW_LEFT_TOP:
        return e.startRow < r.startRow && e.startColumn < r.startColumn;
    }
  }
  _clearObserverEvent() {
    var e, t3;
    (e = this._scenePointerMoveSub) == null || e.unsubscribe(), (t3 = this._scenePointerUpSub) == null || t3.unsubscribe(), this._scenePointerMoveSub = null, this._scenePointerUpSub = null;
  }
  _initialControl() {
    const { leftControl: e, rightControl: t3, topControl: r, bottomControl: i } = this._control;
    [e, t3, r, i].forEach((o3) => {
      o3.onPointerEnter$.subscribeEvent(() => {
        var l4;
        ((l4 = this._injector.get(gt, Quantity.OPTIONAL)) == null ? void 0 : l4.interceptor.fetchThroughInterceptors(zc3)(false, null)) !== false && o3.setCursor(v1.MOVE);
      }), o3.onPointerLeave$.subscribeEvent(() => {
        o3.resetCursor();
      }), o3.onPointerDown$.subscribeEvent(this._controlPointerDownHandler.bind(this));
    });
  }
  /**
   * Move the whole selection control after cursor turn into move state.
   * NOT same as widgetMoving, that's for 8 control points.
   * @param moveOffsetX
   * @param moveOffsetY
   */
  _controlMoving(e, t3) {
    var M10;
    const r = this._scene, i = r.getScrollXYInfoByViewport(U.FromArray([e, t3])), { scaleX: o3, scaleY: s2 } = r.getAncestorScale(), l4 = this._skeleton.getCellIndexByOffset(
      e,
      t3,
      o3,
      s2,
      i
    ), { row: a4, column: c2 } = l4, d2 = this._skeleton.getRowCount() - 1, u2 = this._skeleton.getColumnCount() - 1;
    let h9 = Math.max(0, a4 + this._relativeSelectionPositionRow), m9 = h9 + this._relativeSelectionRowLength;
    m9 > d2 && (m9 = d2, m9 - h9 < this._relativeSelectionRowLength && (h9 = m9 - this._relativeSelectionRowLength));
    let g9 = Math.max(0, c2 + this._relativeSelectionPositionColumn), f4 = g9 + this._relativeSelectionColumnLength;
    f4 > u2 && (f4 = u2, f4 - g9 < this._relativeSelectionColumnLength && (g9 = f4 - this._relativeSelectionColumnLength));
    const p3 = this._skeleton.worksheet.getCellInfoInMergeData(h9, g9), S = Wt3({
      range: { startRow: h9, endRow: m9, startColumn: g9, endColumn: f4 },
      primary: p3,
      style: null
    }, this._skeleton), w6 = this._skeleton.getNoMergeCellWithCoordByIndex(h9, g9), C = this._skeleton.getNoMergeCellWithCoordByIndex(m9, f4), I6 = (w6 == null ? void 0 : w6.startY) || 0, R9 = (C == null ? void 0 : C.endY) || 0, y6 = (w6 == null ? void 0 : w6.startX) || 0, E3 = (C == null ? void 0 : C.endX) || 0;
    (M10 = this._helperSelection) == null || M10.transformByState({
      left: y6,
      top: I6,
      width: E3 - y6,
      height: R9 - I6
    }), this._targetSelection = __spreadValues({}, S.rangeWithCoord), this._control.selectionMoving$.next(S.rangeWithCoord);
  }
  /**
   * Drag move whole selectionControl when cursor turns to crosshair. Not for dragging 8 control points.
   * @param evt
   */
  _controlPointerDownHandler(e) {
    const { offsetX: t3, offsetY: r } = e, i = this._scene, o3 = i.getCoordRelativeToViewport(U.FromArray([t3, r])), { x: s2, y: l4 } = o3, a4 = i.getScrollXYInfoByViewport(o3), { scaleX: c2, scaleY: d2 } = i.getAncestorScale(), u2 = this._skeleton.getCellIndexByOffset(
      s2,
      l4,
      c2,
      d2,
      a4
    );
    this._startOffsetX = s2, this._startOffsetY = l4;
    const { row: h9, column: m9 } = u2, {
      startRow: g9,
      startColumn: f4,
      endRow: p3,
      endColumn: v6
    } = this._control.model;
    let S = 0, w6 = 0;
    h9 < g9 ? S -= 1 : h9 > p3 && (S += 1), m9 < f4 ? w6 -= 1 : m9 > v6 && (w6 += 1), this._relativeSelectionPositionRow = g9 - h9 + S, this._relativeSelectionPositionColumn = f4 - m9 + w6, this._relativeSelectionRowLength = p3 - g9, this._relativeSelectionColumnLength = v6 - f4;
    const C = this._control.currentStyle, I6 = this._getScale();
    this.isHelperSelection && (this._helperSelection = new I1(qu2, {
      stroke: C.stroke,
      strokeWidth: C.strokeWidth / I6
    }), i.addObject(this._helperSelection));
    const R9 = i.getViewport(k2.VIEW_MAIN), y6 = y0.create(i);
    this._scrollTimer = y6, y6.startScroll(s2, l4, R9), i.disableObjectsEvent(), this._scenePointerMoveSub = i.onPointerMove$.subscribeEvent((E3) => {
      var H6;
      if (this._disabled)
        return;
      const { offsetX: M10, offsetY: T10 } = E3;
      if (((H6 = this._injector.get(gt, Quantity.OPTIONAL)) == null ? void 0 : H6.interceptor.fetchThroughInterceptors(zc3)(false, null)) === false)
        return;
      const { x: A4, y: x7 } = i.getCoordRelativeToViewport(
        U.FromArray([M10, T10])
      );
      this._controlMoving(A4, x7), i.setCursor(v1.MOVE), y6.scrolling(A4, x7, () => {
        this._controlMoving(A4, x7);
      });
    }), this._scenePointerUpSub = i.onPointerUp$.subscribeEvent(() => {
      var M10, T10, P8, A4;
      (M10 = this._helperSelection) == null || M10.dispose();
      const E3 = this._scene;
      E3.resetCursor(), this._clearObserverEvent(), E3.enableObjectsEvent(), (T10 = this._scrollTimer) == null || T10.dispose(), this._control.selectionMoveEnd$.next(this._targetSelection), (A4 = (P8 = this._selectionHooks).selectionMoveEnd) == null || A4.call(P8);
    });
  }
  _initialWidget() {
    const {
      topLeftWidget: e,
      topCenterWidget: t3,
      topRightWidget: r,
      middleLeftWidget: i,
      middleRightWidget: o3,
      bottomLeftWidget: s2,
      bottomCenterWidget: l4,
      bottomRightWidget: a4
    } = this._control, c2 = [
      v1.NORTH_WEST_RESIZE,
      v1.NORTH_RESIZE,
      v1.NORTH_EAST_RESIZE,
      v1.WEST_RESIZE,
      v1.EAST_RESIZE,
      v1.SOUTH_WEST_RESIZE,
      v1.SOUTH_RESIZE,
      v1.SOUTH_EAST_RESIZE
    ];
    [
      e,
      t3,
      r,
      i,
      o3,
      s2,
      l4,
      a4
    ].forEach((d2, u2) => {
      d2.onPointerEnter$.subscribeEvent(() => {
        d2.setCursor(c2[u2]);
      }), d2.onPointerLeave$.subscribeEvent(() => {
        d2.resetCursor();
      }), d2.onPointerDown$.subscribeEvent((h9) => {
        this._widgetPointerDownEvent(h9, c2[u2]);
      });
    });
  }
  /**
   * Pointer down Events for 8 control point.
   * @param evt
   * @param cursor
   */
  _widgetPointerDownEvent(e, t3) {
    const r = this._scene, { offsetX: i, offsetY: o3 } = e, s2 = r.getCoordRelativeToViewport(U.FromArray([i, o3])), { x: l4, y: a4 } = s2;
    this._startOffsetX = i, this._startOffsetY = o3;
    const {
      startRow: c2,
      startColumn: d2,
      endRow: u2,
      endColumn: h9
    } = this._control.model, m9 = Math.min(c2, u2), g9 = Math.min(d2, h9), f4 = Math.max(c2, u2), p3 = Math.max(d2, h9);
    this._relativeSelectionPositionRow = m9, this._relativeSelectionPositionColumn = g9, this._relativeSelectionRowLength = f4 - m9, this._relativeSelectionColumnLength = p3 - g9, t3 === v1.NORTH_WEST_RESIZE ? (this._relativeSelectionPositionRow = f4, this._relativeSelectionPositionColumn = p3) : t3 === v1.NORTH_RESIZE ? this._relativeSelectionPositionRow = f4 : t3 === v1.NORTH_EAST_RESIZE ? this._relativeSelectionPositionRow = f4 : t3 === v1.WEST_RESIZE ? this._relativeSelectionPositionColumn = p3 : t3 === v1.SOUTH_WEST_RESIZE ? this._relativeSelectionPositionColumn = p3 : t3 === v1.SOUTH_RESIZE && (this._relativeSelectionPositionRow = m9);
    const v6 = y0.create(r), S = r.getViewport(k2.VIEW_MAIN);
    v6.startScroll(l4, a4, S), this._scrollTimer = v6, r.disableObjectsEvent(), this._scenePointerMoveSub = r.onPointerMove$.subscribeEvent((w6) => {
      const { offsetX: C, offsetY: I6 } = w6, { x: R9, y: y6 } = r.getCoordRelativeToViewport(
        U.FromArray([C, I6])
      );
      this._widgetMoving(R9, y6, t3), r.setCursor(t3), v6.scrolling(R9, y6, () => {
        this._widgetMoving(R9, y6, t3);
      });
    }), this._scenePointerUpSub = r.onPointerUp$.subscribeEvent(() => {
      var C, I6, R9;
      const w6 = this._scene;
      w6.resetCursor(), this._clearObserverEvent(), w6.enableObjectsEvent(), (C = this._scrollTimer) == null || C.dispose(), this._control.selectionScaled$.next(this._targetSelection), (R9 = (I6 = this._selectionHooks).selectionMoveEnd) == null || R9.call(I6);
    });
  }
  /**
   * Pointer move Events for 8 control point.
   * @param moveOffsetX
   * @param moveOffsetY
   * @param cursor
   */
  _widgetMoving(e, t3, r) {
    const i = this._scene, o3 = i.getScrollXYInfoByViewport(U.FromArray([this._startOffsetX, this._startOffsetY])), { scaleX: s2, scaleY: l4 } = i.getAncestorScale(), a4 = this._skeleton.getCellIndexByOffset(
      e,
      t3,
      s2,
      l4,
      o3
    ), { row: c2, column: d2 } = a4;
    let u2 = this._relativeSelectionPositionRow, h9 = this._relativeSelectionPositionColumn, m9 = c2, g9 = d2;
    r === v1.NORTH_WEST_RESIZE ? (u2 = c2, h9 = d2, m9 = this._relativeSelectionPositionRow, g9 = this._relativeSelectionPositionColumn) : r === v1.NORTH_RESIZE ? (u2 = c2, h9 = this._relativeSelectionPositionColumn, m9 = this._relativeSelectionPositionRow, g9 = this._relativeSelectionPositionColumn + this._relativeSelectionColumnLength) : r === v1.NORTH_EAST_RESIZE ? (u2 = c2, h9 = this._relativeSelectionPositionColumn, m9 = this._relativeSelectionPositionRow, g9 = d2) : r === v1.WEST_RESIZE ? (u2 = this._relativeSelectionPositionRow, h9 = d2, m9 = this._relativeSelectionPositionRow + this._relativeSelectionRowLength, g9 = this._relativeSelectionPositionColumn) : r === v1.EAST_RESIZE ? m9 = this._relativeSelectionPositionRow + this._relativeSelectionRowLength : r === v1.SOUTH_WEST_RESIZE ? (u2 = this._relativeSelectionPositionRow, h9 = d2, m9 = c2, g9 = this._relativeSelectionPositionColumn) : r === v1.SOUTH_RESIZE && (u2 = this._relativeSelectionPositionRow, h9 = this._relativeSelectionPositionColumn, m9 = c2, g9 = this._relativeSelectionPositionColumn + this._relativeSelectionColumnLength);
    const f4 = this._swapPositions(u2, h9, m9, g9), p3 = this._skeleton.getCellWithMergeInfoByIndex(u2, h9), S = Wt3({ range: f4, primary: p3, style: null }, this._skeleton);
    this._targetSelection = __spreadValues({}, S.rangeWithCoord), this._control.updateRangeBySelectionWithCoord(S), this._control.selectionScaling$.next(this._targetSelection);
  }
  _initialAutoFill() {
    const { fillControl: e } = this._control;
    e.onPointerEnter$.subscribeEvent((t3) => {
      this._injector.get(gt).interceptor.fetchThroughInterceptors(jc2)(false, { x: t3.offsetX, y: t3.offsetY, skeleton: this._skeleton, scene: this._scene }) && e.setCursor(v1.CROSSHAIR);
    }), e.onPointerLeave$.subscribeEvent(() => {
      e.resetCursor();
    }), e.onPointerDown$.subscribeEvent(this._autoFillForPointerdown.bind(this));
  }
  // eslint-disable-next-line complexity
  _autoFillMoving(e, t3) {
    var T10, P8, A4;
    const r = this._scene, i = r.getViewportScrollXY(this._activeViewport), { scaleX: o3, scaleY: s2 } = r.getAncestorScale(), l4 = this._skeleton.getCellIndexByOffset(
      e,
      t3,
      o3,
      s2,
      i
    ), { row: a4, column: c2 } = l4, d2 = r.getCoordRelativeToViewport(U.FromArray([e, t3])), u2 = this._skeleton.getRowCount() - 1, h9 = this._skeleton.getColumnCount() - 1;
    let m9 = this._relativeSelectionPositionRow, g9 = this._relativeSelectionPositionColumn, f4 = this._relativeSelectionPositionRow + this._relativeSelectionRowLength, p3 = this._relativeSelectionPositionColumn + this._relativeSelectionColumnLength, v6 = false, S = true;
    if ((c2 < g9 || c2 > p3) && a4 >= m9 && a4 <= f4) {
      const x7 = this._fillRuler(
        c2,
        g9,
        p3,
        this._relativeSelectionColumnLength,
        h9
      );
      g9 = x7.startRowOrColumn, p3 = x7.endRowOrColumn, v6 = x7.isLighten, S = false;
    } else if ((a4 < m9 || a4 > f4) && c2 >= g9 && c2 <= p3) {
      const x7 = this._fillRuler(a4, m9, f4, this._relativeSelectionRowLength, u2);
      m9 = x7.startRowOrColumn, f4 = x7.endRowOrColumn, v6 = x7.isLighten;
    } else if (Math.abs(this._startOffsetX - d2.x - i.x) / 2 > Math.abs(this._startOffsetY - d2.y - i.y)) {
      const x7 = this._fillRuler(
        c2,
        g9,
        p3,
        this._relativeSelectionColumnLength,
        h9
      );
      g9 = x7.startRowOrColumn, p3 = x7.endRowOrColumn, v6 = x7.isLighten, S = false;
    } else {
      const x7 = this._fillRuler(a4, m9, f4, this._relativeSelectionRowLength, u2);
      m9 = x7.startRowOrColumn, f4 = x7.endRowOrColumn, v6 = x7.isLighten;
    }
    const w6 = this._skeleton.getNoMergeCellWithCoordByIndex(m9, g9), C = this._skeleton.getNoMergeCellWithCoordByIndex(f4, p3), I6 = (w6 == null ? void 0 : w6.startY) || 0, R9 = (C == null ? void 0 : C.endY) || 0, y6 = (w6 == null ? void 0 : w6.startX) || 0, E3 = (C == null ? void 0 : C.endX) || 0;
    v6 ? this._controlHandler((x7, H6) => {
      const V7 = new At(this._fillControlColors[H6]).lighten(UC).toRgbString();
      x7.setProps({
        fill: V7
      });
    }) : this._controlHandler((x7, H6) => {
      x7.setProps({
        fill: this._fillControlColors[H6]
      });
    });
    const M10 = Nh / this._getScale();
    m9 === f4 && S === true || g9 === p3 && S === false ? (T10 = this._helperSelection) == null || T10.hide() : ((P8 = this._helperSelection) == null || P8.transformByState({
      left: y6 - M10 / 2,
      top: I6 - M10 / 2,
      width: E3 - y6,
      height: R9 - I6
    }), (A4 = this._helperSelection) == null || A4.show()), this._targetSelection = {
      startY: I6,
      endY: R9,
      startX: y6,
      endX: E3,
      startRow: m9,
      endRow: f4,
      startColumn: g9,
      endColumn: p3
    }, this._control.selectionFilling$.next(this._targetSelection);
  }
  // eslint-disable-next-line max-lines-per-function
  _autoFillForPointerdown(e) {
    const { offsetX: t3, offsetY: r } = e, i = this._scene, o3 = i.getCoordRelativeToViewport(U.FromArray([t3, r])), { x: s2, y: l4 } = o3;
    this._startOffsetX = s2, this._startOffsetY = l4;
    const {
      startRow: a4,
      startColumn: c2,
      endRow: d2,
      endColumn: u2
    } = this._control.model;
    this._isInMergeState = this._hasMergeInRange(a4, c2, d2, u2), this._relativeSelectionPositionRow = a4, this._relativeSelectionPositionColumn = c2, this._relativeSelectionRowLength = d2 - a4, this._relativeSelectionColumnLength = u2 - c2;
    const h9 = this._control.currentStyle;
    let m9 = h9 == null ? void 0 : h9.stroke, g9 = h9 == null ? void 0 : h9.strokeWidth;
    const f4 = Sr4(this._themeService);
    m9 == null && (m9 = f4.stroke), g9 == null && (g9 = f4.strokeWidth);
    const p3 = this._getScale();
    g9 /= p3;
    const v6 = Nh / p3, S = new At(m9).darken(2).toRgbString();
    this.isHelperSelection && (this._helperSelection = new I1(qu2, {
      stroke: S,
      strokeWidth: g9 + v6 / 2
    }), i.addObject(this._helperSelection)), this._activeViewport = i.getActiveViewportByCoord(U.FromArray([t3, r]));
    const w6 = i.getViewport(k2.VIEW_MAIN), C = y0.create(
      i,
      this._activeViewport.viewportKey === k2.VIEW_MAIN ? OE.ALL : OE.NONE
    );
    C.startScroll(s2, l4, w6), this._scrollTimer = C, i.disableObjectsEvent(), this._controlHandler((I6) => {
      this._fillControlColors.push(I6.fill);
    }), this._scenePointerMoveSub = i.onPointerMove$.subscribeEvent((I6) => {
      var x7;
      const { offsetX: R9, offsetY: y6 } = I6, E3 = i.getActiveViewportByCoord(U.FromArray([R9, y6]));
      if (!this._injector.get(gt).interceptor.fetchThroughInterceptors(jc2)(false, { x: e.offsetX, y: e.offsetY, skeleton: this._skeleton, scene: this._scene }))
        return;
      const { x: T10, y: P8 } = i.getCoordRelativeToViewport(
        U.FromArray([R9, y6])
      );
      this._autoFillMoving(T10, P8), i.setCursor(v1.CROSSHAIR);
      const A4 = this._targetSelection;
      if (w6 && E3 && ((x7 = this._activeViewport) == null ? void 0 : x7.viewportKey) !== (E3 == null ? void 0 : E3.viewportKey)) {
        let H6;
        A4.startRow !== a4 ? (C.scrollTimerType = OE.Y, H6 = __spreadProps(__spreadValues({}, A4), {
          endRow: A4.startRow
        })) : A4.endRow !== d2 ? (C.scrollTimerType = OE.Y, H6 = __spreadProps(__spreadValues({}, A4), {
          startRow: A4.endRow
        })) : A4.startColumn !== c2 ? (C.scrollTimerType = OE.X, H6 = __spreadProps(__spreadValues({}, A4), {
          endColumn: A4.startColumn
        })) : (C.scrollTimerType = OE.X, H6 = __spreadProps(__spreadValues({}, A4), {
          startColumn: A4.endColumn
        })), this._isSelectionInViewport(H6, E3) && (this._viewportMainScrollBarNeedResetPosition(C.scrollTimerType, this._activeViewport.viewportKey, E3.viewportKey) && w6.scrollToBarPos({
          x: C.scrollTimerType === OE.X ? 0 : void 0,
          y: C.scrollTimerType === OE.Y ? 0 : void 0
        }), this._activeViewport = E3);
      }
      C.scrolling(T10, P8, () => {
        this._autoFillMoving(T10, P8);
      });
    }), this._scenePointerUpSub = i.onPointerUp$.subscribeEvent(() => {
      var R9, y6;
      (R9 = this._helperSelection) == null || R9.dispose();
      const I6 = this._scene;
      I6.resetCursor(), this._clearObserverEvent(), I6.enableObjectsEvent(), (y6 = this._scrollTimer) == null || y6.dispose(), this._control.refreshSelectionFilled(this._targetSelection), this._isInMergeState = false, this._controlHandler((E3, M10) => {
        E3.setProps({
          fill: this._fillControlColors[M10]
        });
      }), this._fillControlColors = [];
    });
  }
  _viewportMainScrollBarNeedResetPosition(e, t3, r) {
    return e === OE.X && (t3 === k2.VIEW_MAIN_LEFT || t3 === k2.VIEW_MAIN_LEFT_TOP) && (r === k2.VIEW_MAIN || r === k2.VIEW_MAIN_TOP) || e === OE.Y && (t3 === k2.VIEW_MAIN_TOP || t3 === k2.VIEW_MAIN_LEFT_TOP) && (r === k2.VIEW_MAIN || r === k2.VIEW_MAIN_LEFT);
  }
  _hasMergeInRange(e, t3, r, i) {
    return this._skeleton.worksheet.getMergedCellRange(e, t3, r, i).length > 0;
  }
  /**
   * Make sure startRow < endRow and startColumn < endColumn
   *
   * @param startRow
   * @param startColumn
   * @param endRow
   * @param endColumn
   * @returns {IRange} range
   */
  _swapPositions(e, t3, r, i) {
    const o3 = Math.min(e, r), s2 = Math.min(t3, i), l4 = Math.max(e, r), a4 = Math.max(t3, i);
    return {
      startRow: o3,
      startColumn: s2,
      endRow: l4,
      endColumn: a4
    };
  }
  _controlHandler(e) {
    const {
      leftControl: t3,
      rightControl: r,
      topControl: i,
      bottomControl: o3,
      backgroundControlTop: s2,
      backgroundControlMiddleLeft: l4,
      backgroundControlMiddleRight: a4,
      backgroundControlBottom: c2,
      fillControl: d2
    } = this._control, u2 = [
      t3,
      r,
      i,
      o3,
      s2,
      l4,
      a4,
      c2,
      d2
    ];
    for (let h9 = 0, m9 = u2.length; h9 < m9; h9++) {
      const g9 = u2[h9];
      e(g9, h9);
    }
  }
  _fillRuler(e, t3, r, i, o3) {
    let s2 = false;
    if (e < t3)
      if (this._isInMergeState && e < t3) {
        const l4 = t3 - e, a4 = i + 1, c2 = Math.ceil(l4 / a4);
        let d2 = t3 - c2 * a4;
        d2 < 0 && (d2 = t3 - (c2 - 1) * a4), t3 = d2;
      } else
        t3 = e;
    else if (e >= t3 && e <= r)
      s2 = true, this._isInMergeState || (r = e);
    else if (this._isInMergeState && e > r) {
      const l4 = e - r, a4 = i + 1, c2 = Math.ceil(l4 / a4);
      let d2 = r + c2 * a4;
      d2 > o3 && (d2 = r + (c2 - 1) * a4), r = d2;
    } else
      r = e;
    return {
      rowOrColumn: e,
      startRowOrColumn: t3,
      endRowOrColumn: r,
      isLighten: s2
    };
  }
  _getScale() {
    const { scaleX: e, scaleY: t3 } = this._scene.getAncestorScale();
    return Math.max(e, t3);
  }
};
var Yc3 = ((n3) => (n3.Selection = "__SpreadsheetSelectionShape__", n3.top = "__SpreadsheetSelectionTopControl__", n3.bottom = "__SpreadsheetSelectionBottomControl__", n3.left = "__SpreadsheetSelectionShapeLeftControl__", n3.right = "__SpreadsheetSelectionShapeRightControl__", n3.backgroundTop = "__SpreadsheetSelectionBackgroundControlTop__", n3.backgroundMiddleLeft = "__SpreadsheetSelectionBackgroundControlMiddleLeft__", n3.backgroundMiddleRight = "__SpreadsheetSelectionBackgroundControlMiddleRight__", n3.backgroundBottom = "__SpreadsheetSelectionBackgroundControlBottom__", n3.fill = "__SpreadsheetSelectionFillControl__", n3.fillTopLeft = "__SpreadsheetSelectionFillControlTopLeft__", n3.fillBottomRight = "__SpreadsheetSelectionFillControlBottomRight__", n3.fillTopLeftInner = "__SpreadsheetSelectionFillControlTopLeftInner__", n3.fillBottomRightInner = "__SpreadsheetSelectionFillControlBottomRightInner__", n3.lineMain = "__SpreadsheetDragLineMainControl__", n3.lineContent = "__SpreadsheetDragLineContentControl__", n3.line = "__SpreadsheetDragLineControl__", n3.dash = "__SpreadsheetDragDashControl__", n3.rowHeaderBackground = "__SpreadSheetSelectionRowHeaderBackground__", n3.rowHeaderBorder = "__SpreadSheetSelectionRowHeaderBorder__", n3.rowHeaderGroup = "__SpreadSheetSelectionRowHeaderGroup__", n3.columnHeaderBackground = "__SpreadSheetSelectionColumnHeaderBackground__", n3.columnHeaderBorder = "__SpreadSheetSelectionColumnHeaderBorder__", n3.columnHeaderGroup = "__SpreadSheetSelectionColumnHeaderGroup__", n3.topLeftWidget = "__SpreadSheetSelectionTopLeftWidget__", n3.topCenterWidget = "__SpreadSheetSelectionTopCenterWidget__", n3.topRightWidget = "__SpreadSheetSelectionTopRightWidget__", n3.middleLeftWidget = "__SpreadSheetSelectionMiddleLeftWidget__", n3.middleRightWidget = "__SpreadSheetSelectionMiddleRightWidget__", n3.bottomLeftWidget = "__SpreadSheetSelectionBottomLeftWidget__", n3.bottomCenterWidget = "__SpreadSheetSelectionBottomCenterWidget__", n3.bottomRightWidget = "__SpreadSheetSelectionBottomRightWidget__", n3))(Yc3 || {});
var Qu2 = 0.3;
var jd2 = class extends Ve {
  constructor(t3, r, i, o3) {
    var s2, l4, a4, c2;
    super();
    _2(this, "_isHelperSelection", true);
    _2(this, "_enableAutoFill", true);
    _2(this, "_showAutoFill", false);
    _2(this, "_highlightHeader", true);
    _2(this, "_selectionRenderModel");
    _2(this, "_leftBorder");
    _2(this, "_rightBorder");
    _2(this, "_topBorder");
    _2(this, "_bottomBorder");
    _2(this, "_backgroundControlTop");
    _2(this, "_backgroundControlBottom");
    _2(this, "_backgroundControlMiddleLeft");
    _2(this, "_backgroundControlMiddleRight");
    _2(this, "_autoFillControl");
    _2(this, "_selectionShapeGroup");
    _2(this, "_rowHeaderBackground");
    _2(this, "_rowHeaderBorder");
    _2(this, "_rowHeaderGroup");
    _2(this, "_columnHeaderBackground");
    _2(this, "_columnHeaderBorder");
    _2(this, "_columnHeaderGroup");
    _2(this, "_dashedRect");
    _2(this, "_topLeftWidget");
    _2(this, "_topCenterWidget");
    _2(this, "_topRightWidget");
    _2(this, "_middleLeftWidget");
    _2(this, "_middleRightWidget");
    _2(this, "_bottomLeftWidget");
    _2(this, "_bottomCenterWidget");
    _2(this, "_bottomRightWidget");
    _2(this, "_defaultStyle");
    _2(this, "_currentStyle");
    _2(this, "_rowHeaderWidth", 0);
    _2(this, "_columnHeaderHeight", 0);
    _2(this, "_widgetRects", []);
    _2(this, "_controlExtension");
    _2(this, "_dispose$", new BehaviorSubject(this));
    _2(this, "dispose$", this._dispose$.asObservable());
    _2(this, "selectionMoving$", new Subject());
    _2(this, "selectionMoveEnd$", new Subject());
    _2(this, "selectionScaling$", new Subject());
    _2(this, "selectionScaled$", new Subject());
    _2(this, "selectionFilling$", new Subject());
    _2(this, "_selectionFilled$", new Subject());
    _2(this, "selectionFilled$", this._selectionFilled$.asObservable());
    _2(this, "_antLineOffset", 0);
    _2(this, "_antRequestNewFrame", -1);
    this._scene = t3, this._zIndex = r, this._themeService = i, this._enableAutoFill = (s2 = o3 == null ? void 0 : o3.enableAutoFill) != null ? s2 : true, this._highlightHeader = (l4 = o3 == null ? void 0 : o3.highlightHeader) != null ? l4 : true, this._rowHeaderWidth = (a4 = o3 == null ? void 0 : o3.rowHeaderWidth) != null ? a4 : 0, this._columnHeaderHeight = (c2 = o3 == null ? void 0 : o3.columnHeaderHeight) != null ? c2 : 0, this._initializeSheetBody(), this._initialHeader();
  }
  _initializeSheetBody() {
    this._defaultStyle = Sr4(this._themeService), this._currentStyle = Sr4(this._themeService), this._selectionRenderModel = new FC();
    const t3 = this._zIndex;
    this._leftBorder = new I1("__SpreadsheetSelectionShapeLeftControl__" + t3, {
      zIndex: t3
    }), this._rightBorder = new I1("__SpreadsheetSelectionShapeRightControl__" + t3, {
      zIndex: t3
    }), this._topBorder = new I1("__SpreadsheetSelectionTopControl__" + t3, {
      zIndex: t3
    }), this._bottomBorder = new I1("__SpreadsheetSelectionBottomControl__" + t3, {
      zIndex: t3
    }), this._backgroundControlTop = new I1("__SpreadsheetSelectionBackgroundControlTop__" + t3, {
      zIndex: t3 - 1,
      evented: false
    }), this._backgroundControlBottom = new I1("__SpreadsheetSelectionBackgroundControlBottom__" + t3, {
      zIndex: t3 - 1,
      evented: false
    }), this._backgroundControlMiddleLeft = new I1("__SpreadsheetSelectionBackgroundControlMiddleLeft__" + t3, {
      zIndex: t3 - 1,
      evented: false
    }), this._backgroundControlMiddleRight = new I1("__SpreadsheetSelectionBackgroundControlMiddleRight__" + t3, {
      zIndex: t3 - 1,
      evented: false
    }), this._autoFillControl = new I1("__SpreadsheetSelectionFillControl__" + t3, {
      zIndex: t3 + 1
    }), this._autoFillControl.hide(), this._dashedRect = new _8("__SpreadsheetDragDashControl__" + t3, {
      zIndex: t3 + 2,
      evented: false,
      stroke: "#fff"
    });
    const r = [
      this._autoFillControl,
      this._leftBorder,
      this._rightBorder,
      this._topBorder,
      this._bottomBorder,
      this._backgroundControlTop,
      this._backgroundControlMiddleLeft,
      this._backgroundControlMiddleRight,
      this._backgroundControlBottom,
      this._dashedRect
    ];
    this._widgetRects = this._initialWidget(), this._selectionShapeGroup = new s7("__SpreadsheetSelectionShape__" + t3, ...r, ...this._widgetRects), this._selectionShapeGroup.hide(), this._selectionShapeGroup.evented = false, this._selectionShapeGroup.zIndex = t3;
    const i = this.getScene();
    i.addObject(this._selectionShapeGroup, Js3), this.disposeWithMe(
      Be(
        i.onTransformChange$.subscribeEvent((o3) => {
          o3.type === x1.scale && (this._updateLayoutOfSelectionControl(this._currentStyle), this._updateControlCoord());
        })
      )
    );
  }
  _initialHeader() {
    const t3 = this._zIndex;
    this._rowHeaderBackground = new I1("__SpreadSheetSelectionRowHeaderBackground__" + t3, {
      zIndex: t3 - 1,
      evented: false
    }), this._rowHeaderBorder = new I1("__SpreadSheetSelectionRowHeaderBorder__" + t3, {
      zIndex: t3 - 1,
      evented: false
    }), this._rowHeaderGroup = new s7(
      "__SpreadSheetSelectionRowHeaderGroup__" + t3,
      this._rowHeaderBackground,
      this._rowHeaderBorder
    ), this._rowHeaderGroup.hide(), this._rowHeaderGroup.evented = false, this._rowHeaderGroup.zIndex = t3, this._columnHeaderBackground = new I1("__SpreadSheetSelectionColumnHeaderBackground__" + t3, {
      zIndex: t3 - 1,
      evented: false
    }), this._columnHeaderBorder = new I1("__SpreadSheetSelectionColumnHeaderBorder__" + t3, {
      zIndex: t3 - 1,
      evented: false
    }), this._columnHeaderGroup = new s7(
      "__SpreadSheetSelectionColumnHeaderGroup__" + t3,
      this._columnHeaderBackground,
      this._columnHeaderBorder
    ), this._columnHeaderGroup.hide(), this._columnHeaderGroup.evented = false, this._columnHeaderGroup.zIndex = t3, this.getScene().addObjects([this._rowHeaderGroup, this._columnHeaderGroup], BC);
  }
  _initialWidget() {
    const t3 = this._zIndex;
    return this._topLeftWidget = new I1("__SpreadSheetSelectionTopLeftWidget__" + t3, {
      zIndex: t3 + 1
    }), this._topCenterWidget = new I1("__SpreadSheetSelectionTopCenterWidget__" + t3, {
      zIndex: t3 + 1
    }), this._topRightWidget = new I1("__SpreadSheetSelectionTopRightWidget__" + t3, {
      zIndex: t3 + 1
    }), this._middleLeftWidget = new I1("__SpreadSheetSelectionMiddleLeftWidget__" + t3, {
      zIndex: t3 + 1
    }), this._middleRightWidget = new I1("__SpreadSheetSelectionMiddleRightWidget__" + t3, {
      zIndex: t3 + 1
    }), this._bottomLeftWidget = new I1("__SpreadSheetSelectionBottomLeftWidget__" + t3, {
      zIndex: t3 + 1
    }), this._bottomCenterWidget = new I1("__SpreadSheetSelectionBottomCenterWidget__" + t3, {
      zIndex: t3 + 1
    }), this._bottomRightWidget = new I1("__SpreadSheetSelectionBottomRightWidget__" + t3, {
      zIndex: t3 + 1
    }), [
      this._topLeftWidget,
      this._topCenterWidget,
      this._topRightWidget,
      this._middleLeftWidget,
      this._middleRightWidget,
      this._bottomLeftWidget,
      this._bottomCenterWidget,
      this._bottomRightWidget
    ];
  }
  get zIndex() {
    return this._zIndex;
  }
  get leftControl() {
    return this._leftBorder;
  }
  get rightControl() {
    return this._rightBorder;
  }
  get topControl() {
    return this._topBorder;
  }
  get bottomControl() {
    return this._bottomBorder;
  }
  get fillControl() {
    return this._autoFillControl;
  }
  get backgroundControlTop() {
    return this._backgroundControlTop;
  }
  get backgroundControlBottom() {
    return this._backgroundControlBottom;
  }
  get backgroundControlMiddleLeft() {
    return this._backgroundControlMiddleLeft;
  }
  get backgroundControlMiddleRight() {
    return this._backgroundControlMiddleRight;
  }
  get selectionShape() {
    return this._selectionShapeGroup;
  }
  get columnHeaderGroup() {
    return this._columnHeaderGroup;
  }
  get rowHeaderGroup() {
    return this._rowHeaderGroup;
  }
  get selectionShapeGroup() {
    return this._selectionShapeGroup;
  }
  // That's so bad! _selectionModel is protected! But I don't want to expose it to the outside world
  get model() {
    return this._selectionRenderModel;
  }
  get topLeftWidget() {
    return this._topLeftWidget;
  }
  get topCenterWidget() {
    return this._topCenterWidget;
  }
  get topRightWidget() {
    return this._topRightWidget;
  }
  get middleLeftWidget() {
    return this._middleLeftWidget;
  }
  get middleRightWidget() {
    return this._middleRightWidget;
  }
  get bottomLeftWidget() {
    return this._bottomLeftWidget;
  }
  get bottomCenterWidget() {
    return this._bottomCenterWidget;
  }
  get bottomRightWidget() {
    return this._bottomRightWidget;
  }
  get themeService() {
    return this._themeService;
  }
  get selectionModel() {
    return this._selectionRenderModel;
  }
  set selectionModel(t3) {
    this._selectionRenderModel = t3;
  }
  // get defaultStyle(): ISelectionStyle {
  //     return this._defaultStyle;
  // }
  // set defaultStyle(style: ISelectionStyle) {
  //     this._defaultStyle = style;
  // }
  get currentStyle() {
    return this._currentStyle;
  }
  set currentStyle(t3) {
    this._currentStyle = t3;
  }
  get dashedRect() {
    return this._dashedRect;
  }
  get isHelperSelection() {
    return this._isHelperSelection;
  }
  get rowHeaderWidth() {
    return this._rowHeaderWidth;
  }
  set rowHeaderWidth(t3) {
    this._rowHeaderWidth = t3;
  }
  get columnHeaderHeight() {
    return this._columnHeaderHeight;
  }
  set columnHeaderHeight(t3) {
    this._columnHeaderHeight = t3;
  }
  setControlExtension(t3) {
    this._controlExtension = new XC(this, t3);
  }
  setControlExtensionDisable(t3) {
    this._controlExtension && this._controlExtension.setDisabled(t3);
  }
  setEvent(t3) {
    this.leftControl.evented = t3, this.rightControl.evented = t3, this.topControl.evented = t3, this.bottomControl.evented = t3;
  }
  refreshSelectionFilled(t3) {
    this._selectionFilled$.next(t3);
  }
  /**
   * Update Control Style And Position of SelectionControl
   * @param selectionStyle
   */
  _updateLayoutOfSelectionControl(t3) {
    t3 && (this.currentStyle = Object.assign({}, this._defaultStyle, t3));
    const r = this.currentStyle, {
      stroke: i,
      widgets: o3,
      autofillStroke: s2,
      strokeDash: l4,
      isAnimationDash: a4
    } = r;
    let c2 = r.autofillSize, d2 = r.strokeWidth, u2 = r.autofillStrokeWidth;
    const h9 = this._getScale(), m9 = (d2 + Nh) / 2 / h9;
    d2 /= h9, c2 /= h9, u2 /= h9 < 1 ? 1 : h9;
    const g9 = Nh / h9, f4 = p2 / h9, { startX: p3, startY: v6, endX: S, endY: w6 } = this._selectionRenderModel;
    if (this.leftControl.transformByState({
      height: w6 - v6,
      left: -m9 + f4,
      width: d2,
      strokeWidth: g9,
      top: -g9 / 2 + f4
    }), this.leftControl.setProps({
      fill: i,
      stroke: Oh
    }), this.rightControl.transformByState({
      height: w6 - v6,
      left: S - p3 - m9 + f4,
      width: d2,
      strokeWidth: g9,
      top: -g9 / 2 + f4
    }), this.rightControl.setProps({
      fill: i,
      stroke: Oh
    }), this.topControl.transformByState({
      width: S - p3 + d2,
      top: -m9 + f4,
      left: -m9 + f4,
      height: d2,
      strokeWidth: g9
    }), this.topControl.setProps({
      fill: i,
      stroke: Oh
    }), this.bottomControl.transformByState({
      width: S - p3 + d2,
      top: w6 - v6 - m9 + f4,
      height: d2,
      left: -m9 + f4,
      strokeWidth: g9
    }), this.bottomControl.setProps({
      fill: i,
      stroke: Oh
    }), l4 == null)
      this.dashedRect.hide(), this._stopAntLineAnimation();
    else {
      const C = r.strokeWidth * 2 / h9;
      this.dashedRect.transformByState({
        height: w6 - v6,
        width: S - p3,
        strokeWidth: C,
        left: -C / 2 + f4,
        top: -C / 2 + f4
      }), this.dashedRect.setProps({
        strokeDashArray: [0, l4 / h9]
      }), this._stopAntLineAnimation(), a4 !== false && this._startAntLineAnimation(), this.dashedRect.show();
    }
    if (this._showAutoFill = this._showAutoFill && this._enableAutoFill, this._showAutoFill && !this._hasWidgets(o3)) {
      const C = {
        fill: i,
        stroke: s2,
        strokeScaleEnabled: false
      }, I6 = {
        width: c2 - u2,
        height: c2 - u2,
        left: S - p3 - c2 / 2 + u2 / 2 - f4,
        top: w6 - v6 - c2 / 2 + u2 / 2 - f4,
        strokeWidth: u2
      };
      this._autoFillControl.setProps(C), this._autoFillControl.transformByState(I6), this._autoFillControl.show();
    } else
      this._autoFillControl.hide();
    this._updateBackgroundControl(r), this._updateHeaderBackground(r), this._updateWidgets(r);
  }
  /**
   * update selection control coordination by curr selection model
   */
  _updateControlCoord() {
    const { startX: t3, startY: r } = this._selectionRenderModel;
    this.selectionShapeGroup.show(), this.selectionShapeGroup.translate(t3, r), this.selectionShapeGroup.makeDirtyNoDebounce(true);
  }
  updateStyle(t3) {
    this._updateLayoutOfSelectionControl(t3), this._updateControlCoord();
  }
  /**
   * Update range and primary range.
   *
   * highlight cell would update if primaryWithCoord has value.
   * highlight cell would be cleared if primaryWithCoord is null.
   * highlight would keep prev value if primaryWithCoord is undefined.
   * @param rangeWithCoord
   * @param primaryWithCoord
   */
  updateRange(t3, r) {
    this._selectionRenderModel.setValue(t3, r), this._showAutoFill = r !== null, this._updateLayoutOfSelectionControl(), this._updateControlCoord();
  }
  /**
   * Update range and primary range and style.
   * @param selectionWthCoord
   */
  updateRangeBySelectionWithCoord(t3, r) {
    r && (this._rowHeaderWidth = r.rowHeaderWidth, this._columnHeaderHeight = r.columnHeaderHeight), this._selectionRenderModel.setValue(t3.rangeWithCoord, t3.primaryWithCoord), this._showAutoFill = t3.primaryWithCoord !== null, this._updateLayoutOfSelectionControl(t3.style), this._updateControlCoord();
  }
  /**
   * Update selection model with new range & primary cell(aka: highlight/current), also update row/col selection size & style.
   *
   * @deprecated  use `updateRangeBySelectionWithCoord` and `updateStyle` to do same thing.
   *
   * @param newSelectionRange
   * @param rowHeaderWidth
   * @param columnHeaderHeight
   * @param style
   * @param primaryCell primary cell
   */
  update(t3, r = 0, i = 0, o3, s2) {
    this._rowHeaderWidth = r, this._columnHeaderHeight = i, this.updateRangeBySelectionWithCoord({
      rangeWithCoord: t3,
      primaryWithCoord: s2,
      style: o3
    }), o3 && this.updateStyle(o3);
  }
  /**
   * Update primary range.
   * highlight cell would update if primary cell has value.
   * highlight cell would be cleared if primary cell is null.
   * highlight would keep prev value if primary cell is undefined.
   *
   * @param primaryCell model.current (aka: highlight)
   */
  // @TODO lumixraku there are 3 concepts for same thing, primary and current and highlight
  // highlight is best. primary sometimes means the actual cell(actual means ignore merge)
  updateCurrCell(t3) {
    this._showAutoFill = t3 !== null, this._selectionRenderModel.setCurrentCell(t3);
  }
  clearHighlight() {
    this._showAutoFill = false, this._selectionRenderModel.clearCurrentCell(), this._updateLayoutOfSelectionControl(this._currentStyle);
  }
  getScene() {
    return this._scene;
  }
  // eslint-disable-next-line complexity
  dispose() {
    var t3, r, i, o3, s2, l4, a4, c2, d2, u2, h9, m9, g9, f4, p3, v6, S, w6, C, I6, R9, y6, E3, M10, T10;
    (t3 = this._leftBorder) == null || t3.dispose(), (r = this._rightBorder) == null || r.dispose(), (i = this._topBorder) == null || i.dispose(), (o3 = this._bottomBorder) == null || o3.dispose(), (s2 = this._backgroundControlTop) == null || s2.dispose(), (l4 = this._backgroundControlMiddleLeft) == null || l4.dispose(), (a4 = this._backgroundControlMiddleRight) == null || a4.dispose(), (c2 = this._backgroundControlBottom) == null || c2.dispose(), this._autoFillControl.dispose(), (d2 = this._selectionShapeGroup) == null || d2.dispose(), (u2 = this._rowHeaderBackground) == null || u2.dispose(), (h9 = this._rowHeaderBorder) == null || h9.dispose(), (m9 = this._rowHeaderGroup) == null || m9.dispose(), (g9 = this._rowHeaderBackground) == null || g9.dispose(), (f4 = this._columnHeaderBackground) == null || f4.dispose(), (p3 = this._columnHeaderBorder) == null || p3.dispose(), (v6 = this._columnHeaderGroup) == null || v6.dispose(), (S = this._topLeftWidget) == null || S.dispose(), (w6 = this._topCenterWidget) == null || w6.dispose(), (C = this._topRightWidget) == null || C.dispose(), (I6 = this._middleLeftWidget) == null || I6.dispose(), (R9 = this._middleRightWidget) == null || R9.dispose(), (y6 = this._bottomLeftWidget) == null || y6.dispose(), (E3 = this._bottomCenterWidget) == null || E3.dispose(), (M10 = this._bottomRightWidget) == null || M10.dispose(), (T10 = this._controlExtension) == null || T10.dispose(), super.dispose(), this._dispose$.next(this), this._dispose$.complete();
  }
  /**
   * Get the cell information of the current selection, considering the case of merging cells
   */
  getCurrentCellInfo() {
    const t3 = this.model.currentCell;
    if (t3) {
      let r;
      if (t3.isMerged) {
        const i = t3.mergeInfo;
        r = {
          startRow: i.startRow,
          endRow: i.endRow,
          startColumn: i.startColumn,
          endColumn: i.endColumn,
          startX: i.startX,
          endX: i.endX,
          startY: i.startY,
          endY: i.endY
        };
      } else {
        const { actualRow: i, actualColumn: o3, startX: s2, endX: l4, startY: a4, endY: c2 } = t3;
        r = {
          startRow: i,
          endRow: i,
          startColumn: o3,
          endColumn: o3,
          startX: s2,
          endX: l4,
          startY: a4,
          endY: c2
        };
      }
      return r;
    }
  }
  getValue() {
    return __spreadProps(__spreadValues({}, this._selectionRenderModel.getValue()), {
      style: this._currentStyle
    });
  }
  getRange() {
    return this._selectionRenderModel.getValue().rangeWithCoord;
  }
  enableHelperSelection() {
    this._isHelperSelection = true;
  }
  disableHelperSelection() {
    this._isHelperSelection = false;
  }
  _updateHeaderBackground(t3) {
    const { startX: r, startY: i, endX: o3, endY: s2, rangeType: l4 } = this._selectionRenderModel, a4 = this._currentStyle, c2 = this._getScale(), {
      stroke: d2,
      rowHeaderFill: u2 = a4.rowHeaderFill,
      rowHeaderStroke: h9 = a4.rowHeaderStroke,
      columnHeaderFill: m9 = a4.columnHeaderFill,
      columnHeaderStroke: g9 = a4.columnHeaderStroke
    } = t3;
    let {
      rowHeaderStrokeWidth: f4 = a4.rowHeaderStrokeWidth,
      columnHeaderStrokeWidth: p3 = a4.columnHeaderStrokeWidth
    } = t3;
    f4 /= c2, p3 /= c2;
    const v6 = this._rowHeaderWidth, S = this._columnHeaderHeight;
    if (this._highlightHeader && S > 0) {
      let w6 = m9;
      l4 === ge.COLUMN && (w6 = new At(d2).setAlpha(Qu2).toString()), this._columnHeaderBackground.setProps({
        fill: w6
      }), this._columnHeaderBackground.resize(o3 - r, S), this._columnHeaderBorder.setProps({
        fill: g9
      }), this._columnHeaderBorder.transformByState({
        width: o3 - r,
        height: p3,
        top: S - p3 + 1 / c2
        // + 1 / scale: Avoid appearing thicker due to the adjacency of the first row cells.
      }), this._columnHeaderGroup.show(), this._columnHeaderGroup.translate(r, 0);
    } else
      this._columnHeaderGroup.hide();
    if (this._columnHeaderGroup.makeDirty(true), this._highlightHeader && v6 > 0) {
      let w6 = u2;
      l4 === ge.ROW && (w6 = new At(d2).setAlpha(Qu2).toString()), this._rowHeaderBackground.setProps({
        fill: w6
      }), this._rowHeaderBackground.resize(v6, s2 - i), this._rowHeaderBorder.setProps({
        fill: h9
      }), this._rowHeaderBorder.transformByState({
        width: f4,
        height: s2 - i,
        left: v6 - f4 + 1 / c2
      }), this._rowHeaderGroup.show(), this._rowHeaderGroup.translate(0, i);
    } else
      this._rowHeaderGroup.hide();
    this._rowHeaderGroup.makeDirty(true);
  }
  _updateBackgroundControl(t3) {
    const { startX: r, startY: i, endX: o3, endY: s2 } = this._selectionRenderModel, l4 = this._getScale(), { fill: a4 = t3.fill } = t3;
    let { strokeWidth: c2 } = t3;
    c2 /= l4;
    const d2 = this._selectionRenderModel.highlightToSelection();
    if (!d2) {
      this._backgroundControlTop.resize(o3 - r, s2 - i), this._backgroundControlTop.setProps({ fill: a4 }), this._backgroundControlBottom.resize(0, 0), this._backgroundControlMiddleLeft.resize(0, 0), this._backgroundControlMiddleRight.resize(0, 0);
      return;
    }
    const { startX: u2, startY: h9, endX: m9, endY: g9 } = d2, f4 = c2 / 2, p3 = {
      left: -f4,
      top: -f4,
      width: o3 - r + f4 * 2,
      height: h9 - i + f4
    };
    p3.height < 0 && (p3.width = 0, p3.height = 0), this._backgroundControlTop.transformByState(p3);
    const v6 = {
      left: -f4,
      top: h9 - i,
      width: u2 - r + f4,
      height: g9 - h9
    };
    v6.width < 0 && (v6.width = 0, v6.height = 0), this._backgroundControlMiddleLeft.transformByState(v6);
    const S = {
      left: m9 - r - f4,
      top: h9 - i,
      width: o3 - m9 + f4 * 2,
      height: g9 - h9
    };
    S.width < 0 && (S.width = 0, S.height = 0), this._backgroundControlMiddleRight.transformByState(S);
    const w6 = {
      left: -f4,
      top: g9 - i,
      width: o3 - r + f4 * 2,
      height: s2 - g9 + f4
    };
    w6.height < 0 && (w6.width = 0, w6.height = 0), this._backgroundControlBottom.transformByState(w6), this._backgroundControlTop.setProps({ fill: a4 }), this._backgroundControlMiddleLeft.setProps({ fill: a4 }), this._backgroundControlMiddleRight.setProps({ fill: a4 }), this._backgroundControlBottom.setProps({ fill: a4 });
  }
  _updateWidgets(t3) {
    const { startX: r, startY: i, endX: o3, endY: s2 } = this._selectionRenderModel, { stroke: l4 = t3.stroke, widgets: a4 = t3.widgets, widgetStroke: c2 = t3.widgetStroke } = t3, d2 = this._getScale();
    let { widgetSize: u2, widgetStrokeWidth: h9 } = t3;
    u2 /= d2, h9 /= d2;
    const m9 = { left: -u2 / 2 + h9 / 2, center: (o3 - r) / 2 - u2 / 2 + h9 / 2, right: o3 - r - u2 / 2 + h9 / 2, top: -u2 / 2, middle: (s2 - i) / 2 - u2 / 2, bottom: s2 - i - u2 / 2 + h9 / 2 }, g9 = u2 - h9;
    this._widgetRects.forEach((f4) => {
      f4.setProps({ fill: l4, stroke: c2 });
    }), a4.tl === true ? (this._topLeftWidget.transformByState({ height: g9, width: g9, left: m9.left, top: m9.top, strokeWidth: h9 }), this._topLeftWidget.show()) : this._topLeftWidget.hide(), a4.tc === true ? (this._topCenterWidget.transformByState({ height: g9, width: g9, left: m9.center, top: m9.top, strokeWidth: h9 }), this._topCenterWidget.show()) : this._topCenterWidget.hide(), a4.tr === true ? (this._topRightWidget.transformByState({ height: g9, width: g9, left: m9.right, top: m9.top, strokeWidth: h9 }), this._topRightWidget.show()) : this._topRightWidget.hide(), a4.ml === true ? (this._middleLeftWidget.transformByState({ height: g9, width: g9, left: m9.left, top: m9.middle, strokeWidth: h9 }), this._middleLeftWidget.show()) : this._middleLeftWidget.hide(), a4.mr === true ? (this._middleRightWidget.transformByState({ height: g9, width: g9, left: m9.right, top: m9.middle, strokeWidth: h9 }), this._middleRightWidget.show()) : this._middleRightWidget.hide(), a4.bl === true ? (this._bottomLeftWidget.transformByState({ height: g9, width: g9, left: m9.left, top: m9.bottom, strokeWidth: h9 }), this._bottomLeftWidget.show()) : this._bottomLeftWidget.hide(), a4.bc === true ? (this._bottomCenterWidget.transformByState({ height: g9, width: g9, left: m9.center, top: m9.bottom, strokeWidth: h9 }), this._bottomCenterWidget.show()) : this._bottomCenterWidget.hide(), a4.br === true ? (this._bottomRightWidget.transformByState({ height: g9, width: g9, left: m9.right, top: m9.bottom, strokeWidth: h9 }), this._bottomRightWidget.show()) : this._bottomRightWidget.hide();
  }
  _hasWidgets(t3) {
    if (t3 == null)
      return false;
    const r = Object.keys(t3);
    if (r.length === 0)
      return false;
    for (const i of r)
      if (t3[i] === true)
        return true;
    return false;
  }
  _getScale() {
    const { scaleX: t3, scaleY: r } = this._scene.getAncestorScale();
    return Math.max(t3, r);
  }
  _stopAntLineAnimation() {
    this._antLineOffset = 0, Hv(this._antRequestNewFrame);
  }
  _startAntLineAnimation() {
    const t3 = this._getScale();
    this._antLineOffset += 0.6 / t3, this._antLineOffset > 160 / t3 && (this._antLineOffset = 0), this.dashedRect.setProps({
      strokeDashOffset: -this._antLineOffset
    }), this._antRequestNewFrame = a0(() => {
      this._startAntLineAnimation();
    });
  }
};
var zC = class extends j8 {
  render(e, t3 = false) {
    const r = Z.now();
    return super.render(e, t3), this._afterRender(r), this;
  }
  _afterRender(e) {
    this.scene.getEngine().renderFrameTimeMetric$.next(["selectionLayer", Z.now() - e]);
  }
};
var gt = createIdentifier("univer.sheet.selection-render-service");
var Im2 = class extends Ve {
  constructor(t3, r, i, o3, s2) {
    super();
    _2(this, "_downObserver");
    _2(this, "_scenePointerMoveSub");
    _2(this, "_scenePointerUpSub");
    _2(this, "_controlFillConfig$", new BehaviorSubject(null));
    _2(this, "controlFillConfig$", this._controlFillConfig$.asObservable());
    _2(this, "_selectionControls", []);
    _2(this, "_startRangeWhenPointerDown", {
      startY: 0,
      endY: 0,
      startX: 0,
      endX: 0,
      startRow: -1,
      endRow: -1,
      startColumn: -1,
      endColumn: -1
    });
    _2(this, "_activeControlIndex", -1);
    _2(this, "_startViewportPosX", 0);
    _2(this, "_startViewportPosY", 0);
    _2(this, "_scrollTimer");
    _2(this, "_cancelDownSubscription");
    _2(this, "_cancelUpSubscription");
    _2(this, "_skeleton");
    _2(this, "_scene");
    _2(this, "_highlightHeader", true);
    _2(this, "_rangeType", ge.NORMAL);
    _2(this, "_selectionStyle");
    _2(this, "_remainLastEnabled", false);
    _2(this, "_skipLastEnabled", false);
    _2(this, "_singleSelectionEnabled", false);
    _2(this, "_selectionMoveEnd$", new BehaviorSubject([]));
    _2(this, "selectionMoveEnd$", this._selectionMoveEnd$.asObservable());
    _2(this, "_selectionMoving$", new Subject());
    _2(this, "selectionMoving$", this._selectionMoving$.asObservable());
    _2(this, "_selectionMoveStart$", new Subject());
    _2(this, "selectionMoveStart$", this._selectionMoveStart$.asObservable());
    _2(this, "_selectionMoving", false);
    _2(this, "_selectionTheme");
    _2(this, "_activeViewport");
    _2(this, "interceptor", new sR({ RANGE_MOVE_PERMISSION_CHECK: zc3, RANGE_FILL_PERMISSION_CHECK: jc2 }));
    _2(this, "_escapeShortcutDisposable", null);
    this._injector = t3, this._themeService = r, this._shortcutService = i, this._sheetSkeletonManagerService = o3, this.contextService = s2, this._initSelectionThemeFromThemeService(), this._initMoving();
  }
  get selectionMoving() {
    return this._selectionMoving;
  }
  /**
   * If true, the selector will respond to the range of merged cells and automatically extend the selected range. If false, it will ignore the merged cells.
   */
  get _shouldDetectMergedCells() {
    return this._rangeType === ge.NORMAL;
  }
  _initMoving() {
    this.disposeWithMe(this._selectionMoving$.subscribe(() => {
      this._selectionMoving = true;
    })), this.disposeWithMe(this._selectionMoveEnd$.subscribe(() => {
      this._selectionMoving = false;
    }));
  }
  _setSelectionStyle(t3) {
    this._selectionStyle = t3;
  }
  /**
   * Reset this._selectionStyle to default normal selection style
   */
  // protected _resetSelectionStyle(): void {
  //     this._setSelectionStyle(genNormalSelectionStyle(this._themeService));
  // }
  /** @deprecated This should not be provided by the selection render service. */
  getViewPort() {
    return this._activeViewport;
  }
  setSingleSelectionEnabled(t3 = false) {
    this._singleSelectionEnabled = t3;
  }
  newSelectionControl(t3, r, i) {
    const o3 = this.getSelectionControls().length, { rowHeaderWidth: s2, columnHeaderHeight: l4 } = r, a4 = new jd2(t3, o3, this._selectionTheme, {
      highlightHeader: this._highlightHeader,
      rowHeaderWidth: s2,
      columnHeaderHeight: l4
    });
    this._selectionControls.push(a4);
    const c2 = Wt3(i, r);
    return a4.updateRangeBySelectionWithCoord(c2, r), a4.setControlExtension({
      skeleton: r,
      scene: t3,
      themeService: this._selectionTheme,
      injector: this._injector,
      selectionHooks: {
        selectionMoveEnd: () => {
          this._selectionMoveEnd$.next(this.getSelectionDataWithStyle());
        }
      }
    }), a4;
  }
  /**
   * Update the corresponding selectionControl based on selectionsData from WorkbookSelectionModel
   * selectionData[i] --> selectionControls[i]
   * @param selectionsWithStyleList {ISelectionWithStyle[]} selectionsData from WorkbookSelectionModel
   */
  resetSelectionsByModelData(t3) {
    const r = this.getSelectionControls(), i = this._skeleton;
    if (!(!r || !i)) {
      for (let o3 = 0, s2 = t3.length; o3 < s2; o3++) {
        const l4 = t3[o3], a4 = Wt3(l4, this._skeleton), c2 = r[o3];
        c2 ? c2.updateRangeBySelectionWithCoord(a4, i) : this.isSelectionEnabled() && this.newSelectionControl(this._scene, i, l4);
      }
      t3.length < r.length && r.splice(t3.length).forEach((s2) => s2.dispose());
    }
  }
  refreshSelectionMoveStart() {
    this._selectionMoveStart$.next(this.getSelectionDataWithStyle());
  }
  refreshSelectionMoveEnd() {
    this._selectionMoveEnd$.next(this.getSelectionDataWithStyle());
  }
  _initSelectionThemeFromThemeService() {
    const t3 = this._themeService.getCurrentTheme();
    this._selectionTheme = new Ji(), this._selectionTheme.setTheme(t3);
  }
  setSelectionTheme(t3) {
    this._selectionTheme.setTheme(t3);
  }
  _changeRuntime(t3, r, i) {
    this._skeleton = t3, this._scene = r, this._activeViewport = i || (r == null ? void 0 : r.getViewports()[0]), r.findLayerByZIndex(Js3) || r.addLayer(new zC(r, [], Js3));
  }
  getSkeleton() {
    return this._skeleton;
  }
  /**
   * Generate selectionData from this._selectionControls.model .
   * @returns {ISelectionWithCoord[]} {range, primary, style}[]
   */
  getSelectionDataWithStyle() {
    const t3 = this._selectionControls;
    if (this._skeleton.worksheet) {
      const [r, i] = this._skeleton.getLocation();
      return t3.map((o3) => {
        const s2 = o3.getValue();
        return s2.rangeWithCoord.sheetId = i, s2.rangeWithCoord.unitId = r, s2;
      });
    }
    return [];
  }
  /**
   * @TODO lumixraku DO NOT expose private props.
   */
  getSelectionControls() {
    return this._selectionControls;
  }
  /**
   * Add a selection in spreadsheet, create a new SelectionControl and then update this control by range derives from selection.
   * @param {ISelectionWithCoord} selectionWithStyle
   */
  _addSelectionControlByModelData(t3) {
    var l4;
    const r = this._skeleton, i = (l4 = t3.style) != null ? l4 : Sr4(this._selectionTheme), o3 = this._scene;
    return t3.style = i, this.newSelectionControl(o3, r, t3);
  }
  _clearAllSelectionControls() {
    const t3 = this._selectionControls;
    for (const r of t3)
      r.dispose();
    this._selectionControls.length = 0;
  }
  _getFreeze() {
    var r;
    return (r = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : r.skeleton.getWorksheetConfig().freeze;
  }
  _getViewportByCell(t3, r) {
    if (t3 === void 0 || r === void 0)
      return null;
    const i = this._getFreeze();
    if (!i || i.startRow <= 0 && i.startColumn <= 0)
      return this._scene.getViewport(k2.VIEW_MAIN);
    if (t3 > i.startRow && r > i.startColumn)
      return this._scene.getViewport(k2.VIEW_MAIN);
    if (t3 <= i.startRow && r <= i.startColumn)
      return this._scene.getViewport(k2.VIEW_MAIN_LEFT_TOP);
    if (t3 <= i.startRow && r > i.startColumn)
      return this._scene.getViewport(k2.VIEW_MAIN_TOP);
    if (t3 > i.startRow && r <= i.startColumn)
      return this._scene.getViewport(k2.VIEW_MAIN_LEFT);
  }
  /**
   * Returns the selected range in the active sheet, or null if there is no active range. If multiple ranges are selected this method returns only the last selected range.
   */
  getActiveRange() {
    const t3 = this.getSelectionControls(), r = t3 && t3[t3.length - 1].model;
    return r && {
      startRow: r.startRow,
      startColumn: r.startColumn,
      endRow: r.endRow,
      endColumn: r.endColumn
    };
  }
  setActiveSelectionIndex(t3) {
    this._activeControlIndex = t3;
  }
  resetActiveSelectionIndex() {
    this._activeControlIndex = -1;
  }
  /**
   * get active(actually last) selection control
   * @returns T extends SelectionControl
   */
  getActiveSelectionControl() {
    const t3 = this.getSelectionControls();
    if (t3)
      return this._activeControlIndex < 0 ? t3[t3.length - 1] : t3[this._activeControlIndex];
  }
  endSelection() {
    var t3;
    this._clearUpdatingListeners(), this._selectionMoveEnd$.next(this.getSelectionDataWithStyle()), (t3 = this._escapeShortcutDisposable) == null || t3.dispose(), this._escapeShortcutDisposable = null;
  }
  /**
   * Clear existed selections by workbookSelections.selectionMoveEnd$
   */
  _reset() {
    var t3;
    this._clearAllSelectionControls(), (t3 = this._downObserver) == null || t3.unsubscribe(), this._downObserver = null;
  }
  /**
   * Init pointer move listener in each pointer down, unbind in each pointer up.
   * Both cell selections and row-column selections are supported by this method.
   * @param viewportMain
   * @param activeSelectionControl
   * @param rangeType
   * @param scrollTimerType
   * @param moveStartPosX
   * @param moveStartPosY
   */
  // eslint-disable-next-line max-lines-per-function
  _setupPointerMoveListener(t3, r, i, o3 = OE.ALL, s2, l4) {
    var g9, f4;
    let a4 = 0, c2 = 0, d2 = s2, u2 = l4;
    this._scrollTimer = y0.create(this._scene, o3), this._scrollTimer.startScroll((g9 = t3 == null ? void 0 : t3.left) != null ? g9 : 0, (f4 = t3 == null ? void 0 : t3.top) != null ? f4 : 0, t3);
    const h9 = this._scene, m9 = h9.getActiveViewportByCoord(U.FromArray([s2, l4]));
    this._scenePointerMoveSub = h9.onPointerMove$.subscribeEvent((p3) => {
      var A4, x7, H6, V7, D5, B5, F7, z5, Z9;
      const { offsetX: v6, offsetY: S } = p3, { x: w6, y: C } = h9.getCoordRelativeToViewport(U.FromArray([v6, S]));
      this._movingHandler(w6, C, r, i);
      let I6 = w6, R9 = C;
      const y6 = this.getActiveSelectionControl(), E3 = this._getFreeze(), M10 = y6 == null ? void 0 : y6.model, T10 = (A4 = h9.getActiveViewportByCoord(U.FromArray([v6, S]))) != null ? A4 : this._getViewportByCell(M10 == null ? void 0 : M10.endRow, M10 == null ? void 0 : M10.endColumn);
      if ((() => {
        if (!m9 || !T10 || !t3)
          return false;
        const de3 = [k2.VIEW_MAIN, k2.VIEW_MAIN_LEFT_TOP, k2.VIEW_MAIN_TOP, k2.VIEW_MAIN_LEFT];
        return de3.includes(m9.viewportKey) && de3.includes(T10.viewportKey);
      })()) {
        if (!m9 || !T10 || !t3)
          return false;
        const de3 = d2 < t3.left && w6 > t3.left || d2 > t3.left && w6 < t3.left, Re5 = u2 < t3.top && C > t3.top || u2 > t3.top && C < t3.top;
        de3 && (a4 += 1), Re5 && (c2 += 1);
        const we6 = m9.viewportKey, ke4 = T10.viewportKey;
        if (we6 === k2.VIEW_ROW_TOP)
          S < t3.top && ((x7 = M10 == null ? void 0 : M10.endRow) != null ? x7 : 0) < ((H6 = E3 == null ? void 0 : E3.startRow) != null ? H6 : 0) ? R9 = t3.top : Re5 && c2 % 2 === 1 && t3.scrollToViewportPos({
            viewportScrollY: 0
          });
        else if (we6 === k2.VIEW_COLUMN_LEFT)
          v6 < t3.left && ((V7 = M10 == null ? void 0 : M10.endColumn) != null ? V7 : 0) < ((D5 = E3 == null ? void 0 : E3.startColumn) != null ? D5 : 0) ? I6 = t3.left : de3 && a4 % 2 === 1 && t3.scrollToViewportPos({
            viewportScrollX: 0
          });
        else if (we6 === ke4) {
          let G5 = false, ee5 = false;
          we6 === k2.VIEW_MAIN_LEFT_TOP ? (G5 = true, ee5 = true) : we6 === k2.VIEW_MAIN_TOP ? ee5 = true : we6 === k2.VIEW_MAIN_LEFT && (G5 = true), ((B5 = M10 == null ? void 0 : M10.endRow) != null ? B5 : 0) > ((F7 = E3 == null ? void 0 : E3.startRow) != null ? F7 : 0) && (ee5 = false), ((z5 = M10 == null ? void 0 : M10.endColumn) != null ? z5 : 0) > ((Z9 = E3 == null ? void 0 : E3.startColumn) != null ? Z9 : 0) && (G5 = false), G5 && (I6 = t3.left), ee5 && (R9 = t3.top);
        } else {
          const G5 = {
            x: m9.scrollX,
            y: m9.scrollY
          }, ee5 = {
            x: T10.scrollX,
            y: T10.scrollY
          }, re5 = G5.x !== ee5.x && de3 && a4 % 2 === 1, fe5 = G5.y !== ee5.y && Re5 && c2 % 2 === 1;
          (re5 || fe5) && (t3.scrollToBarPos({
            x: re5 ? G5.x : void 0,
            y: fe5 ? G5.y : void 0
          }), re5 || (I6 = t3.left), fe5 || (R9 = t3.top)), (we6 === k2.VIEW_MAIN_LEFT_TOP && ke4 === k2.VIEW_MAIN_LEFT || ke4 === k2.VIEW_MAIN_LEFT_TOP && we6 === k2.VIEW_MAIN_LEFT) && (I6 = t3.left), (we6 === k2.VIEW_MAIN_LEFT_TOP && ke4 === k2.VIEW_MAIN_TOP || ke4 === k2.VIEW_MAIN_LEFT_TOP && we6 === k2.VIEW_MAIN_TOP) && (R9 = t3.top);
        }
        d2 = w6, u2 = C;
      }
      this._scrollTimer.scrolling(I6, R9, () => {
        this._movingHandler(w6, C, r, i);
      });
    });
  }
  /** @deprecated Use the function `attachSelectionWithCoord` instead`. */
  attachSelectionWithCoord(t3) {
    return Wt3(t3, this._skeleton);
  }
  /** @deprecated Use the function `attachPrimaryWithCoord` instead`. */
  attachPrimaryWithCoord(t3) {
    return $s2(this._skeleton, t3);
  }
  /**
   * @deprecated Please use `getCellWithCoordByOffset` instead.
   */
  getSelectionCellByPosition(t3, r) {
    return this.getCellWithCoordByOffset(t3, r);
  }
  getCellWithCoordByOffset(t3, r, i) {
    const o3 = this._scene, s2 = i != null ? i : this._skeleton, l4 = o3.getViewportScrollXY(o3.getViewport(k2.VIEW_MAIN)), { scaleX: a4, scaleY: c2 } = o3.getAncestorScale();
    return s2.getCellWithCoordByOffset(t3, r, a4, c2, l4);
  }
  /**
   * When mousedown and mouseup need to go to the coordination and undo stack, when mousemove does not need to go to the coordination and undo stack
   */
  _movingHandler(t3, r, i, o3) {
    var I6, R9, y6, E3, M10;
    const s2 = this._skeleton, l4 = this._scene, [a4, c2] = s2.getLocation(), d2 = {
      startRow: (I6 = i == null ? void 0 : i.model.startRow) != null ? I6 : -1,
      endRow: (R9 = i == null ? void 0 : i.model.endRow) != null ? R9 : -1,
      startColumn: (y6 = i == null ? void 0 : i.model.startColumn) != null ? y6 : -1,
      endColumn: (E3 = i == null ? void 0 : i.model.endColumn) != null ? E3 : -1
    }, u2 = l4.getViewport(k2.VIEW_MAIN), h9 = (M10 = this._getViewportByCell(d2.endRow, d2.endColumn)) != null ? M10 : u2, m9 = l4.getScrollXYInfoByViewport(
      U.FromArray([this._startViewportPosX, this._startViewportPosY]),
      h9
    ), { scaleX: g9, scaleY: f4 } = l4.getAncestorScale();
    o3 === ge.ROW ? t3 = Number.POSITIVE_INFINITY : o3 === ge.COLUMN && (r = Number.POSITIVE_INFINITY);
    const p3 = this._skeleton.getCellByOffset(t3, r, g9, f4, m9);
    if (!p3)
      return;
    let v6 = {
      startRow: Math.min(p3.startRow, this._startRangeWhenPointerDown.startRow),
      startColumn: Math.min(p3.startColumn, this._startRangeWhenPointerDown.startColumn),
      endRow: Math.max(p3.endRow, this._startRangeWhenPointerDown.endRow),
      endColumn: Math.max(p3.endColumn, this._startRangeWhenPointerDown.endColumn)
    };
    this._shouldDetectMergedCells && (v6 = s2.expandRangeByMerge(v6));
    const w6 = Wt3({ range: v6, primary: void 0, style: null }, s2);
    w6.rangeWithCoord.unitId = a4, w6.rangeWithCoord.sheetId = c2, w6.rangeWithCoord.rangeType = o3;
    const C = d2.startRow !== v6.startRow || d2.startColumn !== v6.startColumn || d2.endRow !== v6.endRow || d2.endColumn !== v6.endColumn;
    i != null && C && (i.updateRangeBySelectionWithCoord(w6), this._selectionMoving$.next(this.getSelectionDataWithStyle()));
  }
  _clearUpdatingListeners() {
    var r, i, o3, s2, l4;
    this._scene.enableObjectsEvent(), (r = this._scenePointerMoveSub) == null || r.unsubscribe(), this._scenePointerMoveSub = null, (i = this._scenePointerUpSub) == null || i.unsubscribe(), this._scenePointerUpSub = null, (o3 = this._cancelDownSubscription) == null || o3.unsubscribe(), this._cancelDownSubscription = null, (s2 = this._cancelUpSubscription) == null || s2.unsubscribe(), this._cancelUpSubscription = null, (l4 = this._scrollTimer) == null || l4.dispose();
  }
  _addEndingListeners() {
    var i, o3, s2;
    const t3 = this._scene, r = (i = t3.getEngine()) == null ? void 0 : i.activeScene;
    !r || r === t3 || ((o3 = this._cancelDownSubscription) == null || o3.unsubscribe(), this._cancelDownSubscription = null, (s2 = this._cancelUpSubscription) == null || s2.unsubscribe(), this._cancelUpSubscription = null, this._cancelDownSubscription = r.onPointerDown$.subscribeEvent(() => this._clearUpdatingListeners()), this._cancelUpSubscription = r.onPointerUp$.subscribeEvent(() => this._clearUpdatingListeners()));
  }
  /**
   * Get visible selection range & coord by offset on viewport. Nearly same as skeleton.getCellWithCoordByOffset
   * Returning selection is only one cell. primary and range are same cell.
   *
   * visible selection range means getCellWithCoordByOffset needs first matched row/col in rowHeightAccumulation & colWidthAccumulation.
   * Original name: _getCellRangeByCursorPosition
   *
   * @param offsetX position X in viewport.
   * @param offsetY
   * @param scaleX
   * @param scaleY
   * @param scrollXY
   * @returns {Nullable<ISelectionWithCoord>} selection range with coord.
   */
  _getSelectionWithCoordByOffset(t3, r, i, o3, s2) {
    const l4 = this._skeleton;
    if (l4 == null) return null;
    if (this._shouldDetectMergedCells) {
      const v6 = l4 == null ? void 0 : l4.getCellWithCoordByOffset(
        t3,
        r,
        i,
        o3,
        s2,
        { firstMatch: true }
      );
      if (!v6) return;
      const S = Xg(v6);
      return {
        primaryWithCoord: v6,
        rangeWithCoord: S
      };
    }
    const { row: a4, column: c2 } = l4.getCellIndexByOffset(t3, r, i, o3, s2), d2 = l4.getNoMergeCellWithCoordByIndex(a4, c2), { startX: u2, startY: h9, endX: m9, endY: g9 } = d2, f4 = {
      startY: h9,
      endY: g9,
      startX: u2,
      endX: m9,
      startRow: a4,
      endRow: a4,
      startColumn: c2,
      endColumn: c2
    };
    return {
      primaryWithCoord: {
        mergeInfo: f4,
        actualRow: a4,
        actualColumn: c2,
        isMerged: false,
        isMergedMainCell: false,
        startY: h9,
        endY: g9,
        startX: u2,
        endX: m9
      },
      rangeWithCoord: f4
    };
  }
  _checkClearPreviousControls(t3) {
    this.getSelectionControls().length !== 0 && (!t3.ctrlKey && !t3.shiftKey && !this._remainLastEnabled || this._singleSelectionEnabled && !t3.shiftKey) && this._clearAllSelectionControls();
  }
  _makeSelectionByTwoCells(t3, r, i, o3, s2) {
    const { actualRow: l4, actualColumn: a4, mergeInfo: c2 } = t3;
    this._startRangeWhenPointerDown = __spreadValues({}, t3.mergeInfo);
    const d2 = Math.min(l4, r.startRow, c2.startRow), u2 = Math.max(l4, r.endRow, c2.endRow), h9 = Math.min(a4, r.startColumn, c2.startColumn), m9 = Math.max(a4, r.endColumn, c2.endColumn), f4 = {
      range: i.expandRangeByMerge({
        startRow: d2,
        startColumn: h9,
        endRow: u2,
        endColumn: m9
      }),
      primary: Iu(t3),
      style: null
    }, p3 = Wt3(f4, i);
    s2.updateRangeBySelectionWithCoord(p3);
  }
  isSelectionEnabled() {
    return this.contextService.getContextValue(Vh);
  }
  isSelectionDisabled() {
    return this.contextService.getContextValue(Vh) === false;
  }
  inRefSelectionMode() {
    return this.contextService.getContextValue(Fu);
  }
};
function ym(n3) {
  return {
    range: {
      startRow: 0,
      startColumn: 0,
      endRow: n3.getRowCount() - 1,
      endColumn: n3.getColumnCount() - 1,
      rangeType: ge.ALL
    },
    primary: Yd2(n3).primary,
    style: null
  };
}
function Yd2(n3) {
  return jC(n3, {
    startRow: 0,
    startColumn: 0,
    endRow: 0,
    endColumn: 0
  });
}
function jC(n3, e) {
  const t3 = n3.worksheet.getCellInfoInMergeData(e.startRow, e.startColumn), r = n3.worksheet.getCellInfoInMergeData(e.endRow, e.endColumn);
  return {
    range: {
      startRow: t3.startRow,
      startColumn: t3.startColumn,
      endRow: r.endRow,
      endColumn: r.endColumn,
      rangeType: ge.NORMAL
    },
    primary: {
      actualRow: t3.startRow,
      actualColumn: t3.startColumn,
      startRow: t3.startRow,
      startColumn: t3.startColumn,
      endRow: t3.endRow,
      endColumn: t3.endColumn,
      isMerged: t3.isMerged,
      isMergedMainCell: t3.isMergedMainCell
    },
    style: null
  };
}
var YC = Object.getOwnPropertyDescriptor;
var ZC3 = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? YC(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var Ku2 = (n3, e) => (t3, r) => e(t3, r, n3);
var he2 = class extends Ve {
  constructor(e, t3, r) {
    super();
    _2(this, "_sheetId", "");
    _2(this, "_sheetSkeletonParamStore", /* @__PURE__ */ new Map());
    _2(this, "_currentSkeleton$", new BehaviorSubject(null));
    _2(this, "currentSkeleton$", this._currentSkeleton$.asObservable());
    _2(this, "_currentSkeletonBefore$", new BehaviorSubject(null));
    _2(this, "currentSkeletonBefore$", this._currentSkeletonBefore$.asObservable());
    this._context = e, this._injector = t3, this._sheetSkService = r, this.disposeWithMe(() => {
      this._currentSkeletonBefore$.complete(), this._currentSkeleton$.complete(), this._sheetSkeletonParamStore.forEach((i) => this.disposeSkeleton(i.sheetId)), this._sheetSkeletonParamStore.clear();
    }), this._initRemoveSheet();
  }
  _initRemoveSheet() {
    this.disposeWithMe(this._context.unit.sheetDisposed$.subscribe((e) => {
      this.disposeSkeleton(e.getSheetId());
    }));
  }
  getCurrentSkeleton() {
    var e;
    return (e = this.getCurrentParam()) == null ? void 0 : e.skeleton;
  }
  /**
   * @deprecated use `getCurrentSkeleton` instead.
   */
  getCurrent() {
    return this.getCurrentParam();
  }
  /**
   * get ISheetSkeletonManagerParam from _currentSkeletonSearchParam
   * @returns
   */
  getCurrentParam() {
    return this._getSkeletonParam(this._sheetId);
  }
  /**
   * Get skeleton by sheetId
   * @param sheetId
   */
  getSkeleton(e) {
    return this._getSkeleton(e);
  }
  /**
   * Get SkeletonParam by sheetId
   * @param sheetId
   */
  getSkeletonParam(e) {
    return this._getSkeletonParam(e);
  }
  /**
   * @deprecated use `getSkeleton` instead.
   */
  getWorksheetSkeleton(e) {
    return this.getSkeletonParam(e);
  }
  // why ?? what does unitId for ??? no need unitId, this service is registered in render unit already.
  getUnitSkeleton(e, t3) {
    const r = this._getSkeletonParam(t3);
    return r != null && (r.unitId = e), r;
  }
  /**
   * Command in COMMAND_LISTENER_SKELETON_CHANGE would cause setCurrent, see @packages/sheets-ui/src/controllers/render-controllers/sheet.render-controller.ts
   * @param searchParam
   */
  setCurrent(e) {
    this._setCurrent(e.sheetId);
  }
  setSkeletonParam(e, t3) {
    this._sheetSkService.setSkeleton(t3.unitId, e, t3.skeleton), this._sheetSkeletonParamStore.set(e, t3);
  }
  _setCurrent(e) {
    this._sheetId = e;
    const t3 = this._getSkeletonParam(e), r = this._context.unitId;
    if (t3 != null)
      this.reCalculate(t3);
    else {
      const s2 = this._context.unit.getSheetBySheetId(e);
      if (s2 == null)
        return;
      const l4 = this._context.scene, a4 = this._buildSkeleton(s2, l4);
      this.setSkeletonParam(e, {
        unitId: r,
        sheetId: e,
        skeleton: a4,
        dirty: false
      });
    }
    const i = this._getSkeletonParam(e);
    this._currentSkeletonBefore$.next(i), this._currentSkeleton$.next(i);
  }
  // @TODO why need this function? How about caller get skeleton and call sk.calculate()?
  reCalculate(e) {
    e || (e = this.getCurrentParam()), e != null && (e.dirty && (e.skeleton.makeDirty(true), e.dirty = false), e.skeleton.calculate());
  }
  /**
   * Make param dirty, if param is dirty, then the skeleton will be makeDirty in _reCalculate()
   * @param searchParm
   * @param state
   */
  makeDirty(e, t3 = true) {
    const r = this._getSkeletonParam(e.sheetId);
    r != null && (r.dirty = t3);
  }
  /**
   * @deprecated Use function `ensureSkeleton` instead.
   * @param searchParam
   */
  getOrCreateSkeleton(e) {
    return this.ensureSkeleton(e.sheetId);
  }
  ensureSkeleton(e) {
    const t3 = this._getSkeletonParam(e);
    if (t3)
      return t3.skeleton;
    const i = this._context.unit.getSheetBySheetId(e);
    if (!i)
      return;
    const o3 = this._buildSkeleton(i);
    return this.setSkeletonParam(e, {
      unitId: this._context.unitId,
      sheetId: e,
      skeleton: o3,
      dirty: false
    }), o3;
  }
  disposeSkeleton(e) {
    const t3 = this.getSkeletonParam(e);
    t3 && (t3.skeleton.dispose(), this._sheetSkeletonParamStore.delete(e), this._sheetSkService.deleteSkeleton(t3.unitId, e));
  }
  /** @deprecated Use function `attachRangeWithCoord` instead.  */
  attachRangeWithCoord(e) {
    const t3 = this.getCurrentSkeleton();
    return t3 ? Io3(t3, e) : null;
  }
  _getSkeletonParam(e) {
    return this._sheetSkeletonParamStore.get(e);
  }
  _getSkeleton(e) {
    const t3 = this._getSkeletonParam(e);
    return t3 ? t3.skeleton : null;
  }
  _buildSkeleton(e, t3) {
    return this._injector.createInstance(
      Z5,
      e,
      this._context.unit.getStyles()
    );
  }
  setColumnHeaderSize(e, t3, r) {
    var c2;
    if (!e) return;
    const i = (c2 = this.getWorksheetSkeleton(t3)) == null ? void 0 : c2.skeleton;
    if (!i) return;
    i.columnHeaderHeight = r, e.scene.getViewports()[0].top = r, e.scene.getViewport(k2.VIEW_COLUMN_RIGHT).setViewportSize({
      height: r
    }), e.scene.getViewport(k2.VIEW_COLUMN_LEFT).setViewportSize({
      height: r
    }), e.scene.getViewport(k2.VIEW_ROW_BOTTOM).setViewportSize({
      top: r
    }), e.scene.getViewport(k2.VIEW_ROW_TOP).setViewportSize({
      top: r
    }), e.scene.getViewport(k2.VIEW_LEFT_TOP).setViewportSize({
      height: r
    });
    const o3 = e == null ? void 0 : e.with(z), s2 = e == null ? void 0 : e.with(gt), l4 = o3.getCurrentSelections();
    s2.resetSelectionsByModelData(l4);
    const a4 = this.getUnitSkeleton(e.unitId, t3);
    a4 && (a4.commandId = da.id, this._currentSkeleton$.next(a4));
  }
  setRowHeaderSize(e, t3, r) {
    var m9;
    const i = (m9 = this.getWorksheetSkeleton(t3)) == null ? void 0 : m9.skeleton;
    if (!e || !i) return;
    i.rowHeaderWidth = r;
    const o3 = e.scene.getViewport(k2.VIEW_LEFT_TOP).width || 46, s2 = r - o3, l4 = e.scene.getViewports()[0].left;
    e.scene.getViewports()[0].left = l4 + s2, e.scene.getViewport(k2.VIEW_ROW_BOTTOM).setViewportSize({
      width: r
    }), e.scene.getViewport(k2.VIEW_ROW_TOP).setViewportSize({
      width: r
    }), e.scene.getViewport(k2.VIEW_COLUMN_LEFT).setViewportSize({
      left: r
    });
    const a4 = e.scene.getViewport(k2.VIEW_COLUMN_RIGHT).left || 0;
    e.scene.getViewport(k2.VIEW_COLUMN_RIGHT).setViewportSize({
      left: a4 + s2
    }), e.scene.getViewport(k2.VIEW_LEFT_TOP).setViewportSize({
      width: r
    });
    const c2 = e == null ? void 0 : e.with(z), d2 = e == null ? void 0 : e.with(gt), u2 = c2.getCurrentSelections();
    d2.resetSelectionsByModelData(u2);
    const h9 = this.getCurrent();
    h9 && (h9.commandId = ca3.id, this._currentSkeleton$.next(h9));
  }
};
he2 = ZC3([
  Ku2(1, Inject(Injector)),
  Ku2(2, Inject(rt3))
], he2);
var GC2 = Object.getOwnPropertyDescriptor;
var qC = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? GC2(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var Ki3 = (n3, e) => (t3, r) => e(t3, r, n3);
var QC2 = ["ff", "fs", "tr", "tb"];
var pi2 = class extends Ve {
  constructor(n3, e, t3, r, i) {
    super(), this._renderManagerService = n3, this._sheetInterceptorService = e, this._selectionManagerService = t3, this._univerInstanceService = r, this._configService = i, this._initialize();
  }
  _processLazyAutoHeight(n3, e, t3, r) {
    if (r != null && r.length) {
      const i = {
        id: Id.id,
        params: {
          unitId: e,
          subUnitId: t3,
          ranges: r,
          id: et()
        },
        options: {
          onlyLocal: true
        }
      }, o3 = {
        id: vd.id,
        params: {
          unitId: e,
          subUnitId: t3,
          id: i.params.id
        },
        options: {
          onlyLocal: true
        }
      };
      return {
        redos: [...n3.redos, i],
        undos: [...n3.undos, o3]
      };
    }
    return n3;
  }
  getUndoRedoParamsOfAutoHeight(n3, e, t3) {
    const { _univerInstanceService: r } = this, i = r.getCurrentUnitForType(we.UNIVER_SHEET), o3 = i.getUnitId();
    let s2 = i.getActiveSheet(), l4 = s2.getSheetId();
    if (e) {
      const g9 = P5(r, { unitId: o3, subUnitId: e });
      g9 && (s2 = g9.worksheet, l4 = s2.getSheetId());
    }
    const c2 = this._renderManagerService.getRenderById(o3).with(he2).ensureSkeleton(l4);
    if (!c2)
      return {
        redos: [],
        undos: []
      };
    const u2 = c2.calculateAutoHeightInRange(n3, t3).filter((g9) => {
      const { row: f4, autoHeight: p3 } = g9;
      return !(!p3 || s2.getRowHeight(f4) === p3);
    });
    if (u2.length === 0)
      return {
        redos: [],
        undos: []
      };
    const h9 = {
      subUnitId: l4,
      unitId: o3,
      rowsAutoHeightInfo: u2
    }, m9 = yh2(h9, s2);
    return {
      undos: [
        {
          id: er2.id,
          params: m9
        }
      ],
      redos: [
        {
          id: er2.id,
          params: h9
        }
      ]
    };
  }
  _initialize() {
    this.disposeWithMe(this._sheetInterceptorService.interceptAutoHeight({
      getMutations: (n3) => {
        const { unitId: e, subUnitId: t3, ranges: r, autoHeightRanges: i, lazyAutoHeightRanges: o3, cellHeights: s2 } = n3, l4 = this.getUndoRedoParamsOfAutoHeight(i != null ? i : r, t3, s2);
        return this._processLazyAutoHeight(l4, e, t3, o3);
      }
    }));
  }
};
pi2 = qC([
  Ki3(0, JE),
  Ki3(1, Inject(G)),
  Ki3(2, Inject(z)),
  Ki3(3, Inject(br)),
  Ki3(4, xs)
], pi2);
function Cr3(n3) {
  const { rows: e, cols: t3 } = n3;
  return {
    startRow: e[0],
    endRow: e[e.length - 1],
    startColumn: t3[0],
    endColumn: t3[t3.length - 1]
  };
}
function wr4(n3) {
  let e = [], t3 = [];
  const r = [];
  return n3.forEach((i) => {
    e = e.concat(i.rows), t3 = t3.concat(i.cols);
  }), e = Array.from(new Set(e)).sort((i, o3) => i - o3), t3 = Array.from(new Set(t3)).sort((i, o3) => i - o3), n3.forEach((i) => {
    r.push({
      startRow: e.findIndex((o3) => o3 === i.rows[0]),
      endRow: e.findIndex((o3) => o3 === i.rows[i.rows.length - 1]),
      startColumn: t3.findIndex((o3) => o3 === i.cols[0]),
      endColumn: t3.findIndex((o3) => o3 === i.cols[i.cols.length - 1])
    });
  }), {
    ranges: r,
    mapFunc: (i, o3) => ({
      row: e[i],
      col: t3[o3]
    })
  };
}
function KC(n3) {
  const e = new ht();
  return n3.forEach((t3) => {
    const { rows: r, cols: i } = t3;
    r.forEach((o3) => {
      i.forEach((s2) => {
        e.setValue(o3, s2, {
          v: null,
          p: null,
          f: null,
          si: null,
          custom: null
        });
      });
    });
  }), e.getData();
}
var Zc2 = { é›¶: 0, ä¸€: 1, äºŒ: 2, ä¸‰: 3, å››: 4, äº”: 5, å…­: 6, ä¸ƒ: 7, å…«: 8, ä¹: 9 };
var el2 = ["é›¶", "ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­", "ä¸ƒ", "å…«", "ä¹"];
var Ju2 = ["", "ä¸‡", "äº¿", "ä¸‡äº¿", "äº¿äº¿"];
var JC = ["", "å", "ç™¾", "åƒ"];
var Mm = {
  å: { value: 10, secUnit: false },
  ç™¾: { value: 100, secUnit: false },
  åƒ: { value: 1e3, secUnit: false },
  ä¸‡: { value: 1e4, secUnit: true },
  äº¿: { value: 1e8, secUnit: true }
};
function In3(n3) {
  if (!n3)
    return 0;
  let e = 0, t3 = 0, r = 0, i = false;
  const o3 = n3.split("");
  for (let s2 = 0; s2 < o3.length; s2++) {
    const l4 = Zc2[o3[s2]];
    if (typeof l4 < "u")
      r = l4, s2 === o3.length - 1 && (t3 += r);
    else {
      const a4 = Mm[o3[s2]], c2 = a4.value;
      i = a4.secUnit, i ? (t3 = (t3 + r) * c2, e += t3, t3 = 0) : t3 += r * c2, r = 0;
    }
  }
  return e + t3;
}
function $C(n3) {
  let e = "", t3 = "", r = 0, i = true;
  for (; n3 > 0; ) {
    const o3 = n3 % 10;
    o3 === 0 ? i || (i = true, t3 = el2[o3] + t3) : (i = false, e = el2[o3], e += JC[r], t3 = e + t3), r++, n3 = Math.floor(n3 / 10);
  }
  return t3;
}
function e13(n3) {
  let e = 0, t3 = "", r = "", i = false;
  if (n3 === 0)
    return el2[0];
  for (; n3 > 0; ) {
    const o3 = n3 % 1e4;
    i && (r = el2[0] + r), t3 = $C(o3), t3 += o3 !== 0 ? Ju2[e] : Ju2[0], r = t3 + r, i = o3 < 1e3 && o3 > 0, n3 = Math.floor(n3 / 1e4), e++;
  }
  return r;
}
function t1(n3) {
  if (!n3)
    return false;
  let e = true;
  if (n3)
    if (n3.length === 1)
      n3 === "æ—¥" || n3 in Zc2 ? e = true : e = false;
    else {
      const t3 = n3.split("");
      for (let r = 0; r < t3.length; r++)
        if (!(t3[r] in Zc2 || t3[r] in Mm)) {
          e = false;
          break;
        }
    }
  return e;
}
function ws2(n3) {
  if (!n3)
    return {
      isExtendNumber: false
    };
  const e = /0|([1-9]+[0-9]*)/g, t3 = e.test(n3);
  if (t3) {
    const r = n3.match(e);
    if (r && r.length > 0) {
      const i = r[r.length - 1], o3 = n3.lastIndexOf(i), s2 = n3.substr(0, o3), l4 = n3.substr(o3 + i.length);
      return {
        isExtendNumber: true,
        matchTxt: Number(i),
        beforeTxt: s2,
        afterTxt: l4
      };
    }
    return {
      isExtendNumber: false
    };
  }
  return {
    isExtendNumber: t3
  };
}
function n1(n3) {
  let e;
  return n3.length === 2 && (n3 === "å‘¨ä¸€" || n3 === "å‘¨äºŒ" || n3 === "å‘¨ä¸‰" || n3 === "å‘¨å››" || n3 === "å‘¨äº”" || n3 === "å‘¨å…­" || n3 === "å‘¨æ—¥") ? e = true : e = false, e;
}
function r1(n3) {
  let e;
  return n3.length === 3 && (n3 === "æ˜ŸæœŸä¸€" || n3 === "æ˜ŸæœŸäºŒ" || n3 === "æ˜ŸæœŸä¸‰" || n3 === "æ˜ŸæœŸå››" || n3 === "æ˜ŸæœŸäº”" || n3 === "æ˜ŸæœŸå…­" || n3 === "æ˜ŸæœŸæ—¥") ? e = true : e = false, e;
}
function i1(n3, e) {
  let t3 = 0;
  for (let r = 0; r < n3.length && n3[r] < e; r++)
    t3++;
  return t3;
}
function rs3(n3) {
  let e = true;
  const t3 = n3[1] - n3[0];
  for (let r = 1; r < n3.length; r++)
    if (n3[r] - n3[r - 1] !== t3) {
      e = false;
      break;
    }
  return e;
}
function o1(n3, e, t3) {
  const r = [], i = Math.floor(e / n3), o3 = e % n3;
  let s2 = 0;
  if (i > 0) {
    for (let l4 = 0; l4 < i; l4++)
      for (let a4 = 0; a4 < t3.length; a4++)
        r[t3[a4] + l4 * n3] = s2, s2++;
    for (let l4 = 0; l4 < t3.length && t3[l4] < o3; l4++)
      r[t3[l4] + n3 * i] = s2, s2++;
  } else
    for (let l4 = 0; l4 < t3.length && t3[l4] < o3; l4++)
      r[t3[l4]] = s2, s2++;
  return r;
}
function br6(n3, e) {
  const t3 = [];
  for (let r = 1; r <= e; r++) {
    const i = (r - 1) % n3.length, o3 = Z.deepClone(n3[i]);
    _r4(o3), t3.push(__spreadValues({
      v: null,
      s: null,
      p: null,
      f: null,
      si: null,
      t: null
    }, o3));
  }
  return t3;
}
function s12(n3, e) {
  var r;
  const t3 = [];
  for (let i = 1; i <= e; i++) {
    const o3 = (i - 1) % n3.length, s2 = { s: (r = n3[o3]) == null ? void 0 : r.s };
    t3.push(s2);
  }
  return t3;
}
function l12(n3) {
  let e = true;
  const t3 = n3[1] / n3[0];
  for (let r = 1; r < n3.length; r++)
    if (n3[r] / n3[r - 1] !== t3) {
      e = false;
      break;
    }
  return e;
}
function a12(n3) {
  const e = [];
  for (let t3 = 1; t3 <= n3; t3++)
    e.push(t3);
  return e;
}
function tl2(n3, e, t3) {
  var o3, s2, l4, a4;
  const r = [], i = [];
  for (let c2 = 0; c2 < n3.length; c2++)
    i.push(Number((o3 = n3[c2]) == null ? void 0 : o3.v));
  if (n3.length > 2 && l12(i))
    for (let c2 = 1; c2 <= e; c2++) {
      const d2 = (c2 - 1) % n3.length, u2 = Z.deepClone(n3[d2]);
      _r4(u2);
      const h9 = Number((s2 = n3[n3.length - 1]) == null ? void 0 : s2.v) * __pow(Number((l4 = n3[1]) == null ? void 0 : l4.v) / Number((a4 = n3[0]) == null ? void 0 : a4.v), c2);
      u2 && (nh2(u2) && (u2.v = h9), r.push(u2));
    }
  else {
    const c2 = a12(n3.length);
    for (let d2 = 1; d2 <= e; d2++) {
      const u2 = (d2 - 1) % n3.length, h9 = Z.deepClone(n3[u2]);
      _r4(h9);
      const m9 = t3 === wm.DOWN || t3 === wm.RIGHT, g9 = c14(n3.length + d2, i, c2, m9);
      h9 && (nh2(h9) && (h9.v = g9), r.push(h9));
    }
  }
  return r;
}
function c14(n3, e, t3, r = true) {
  function i(u2) {
    let h9 = 0;
    for (let m9 = 0; m9 < u2.length; m9++)
      h9 += u2[m9];
    return h9 / u2.length;
  }
  const o3 = i(t3), s2 = i(e);
  let l4 = 0, a4 = 0;
  for (let u2 = 0; u2 < t3.length; u2++)
    l4 += (t3[u2] - o3) * (e[u2] - s2), a4 += (t3[u2] - o3) * (t3[u2] - o3);
  let c2;
  a4 === 0 ? c2 = r ? 1 : -1 : c2 = l4 / a4;
  const d2 = s2 - c2 * o3;
  return Math.round((d2 + c2 * n3) * 1e5) / 1e5;
}
function $u2(n3, e, t3) {
  var o3;
  const r = [], i = /0|([1-9]+[0-9]*)/g;
  for (let s2 = 1; s2 <= e; s2++) {
    const l4 = (s2 - 1) % n3.length, a4 = Z.deepClone(n3[l4]);
    _r4(a4);
    const c2 = `${(o3 = n3[n3.length - 1]) == null ? void 0 : o3.v}`;
    if (!c2) continue;
    const d2 = c2 == null ? void 0 : c2.match(i), u2 = d2 == null ? void 0 : d2[d2.length - 1];
    if (!u2) continue;
    const h9 = Math.abs(Number(u2) + t3 * s2), m9 = c2.lastIndexOf(u2), g9 = c2.substr(0, m9) + h9.toString() + c2.substr(m9 + u2.length);
    a4 && (a4.v = g9, r.push(a4));
  }
  return r;
}
function vi4(n3, e, t3, r = 0) {
  var l4, a4;
  const i = [
    ["æ—¥", "ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­"],
    ["å‘¨æ—¥", "å‘¨ä¸€", "å‘¨äºŒ", "å‘¨ä¸‰", "å‘¨å››", "å‘¨äº”", "å‘¨å…­"],
    ["æ˜ŸæœŸæ—¥", "æ˜ŸæœŸä¸€", "æ˜ŸæœŸäºŒ", "æ˜ŸæœŸä¸‰", "æ˜ŸæœŸå››", "æ˜ŸæœŸäº”", "æ˜ŸæœŸå…­"]
  ];
  if (r >= i.length) return [];
  const o3 = i[r], s2 = [];
  for (let c2 = 1; c2 <= e; c2++) {
    const d2 = (c2 - 1) % n3.length, u2 = Z.deepClone(n3[d2]);
    _r4(u2);
    let h9 = 0;
    if (((l4 = n3[n3.length - 1]) == null ? void 0 : l4.v) === o3[0])
      h9 = 7 + t3 * c2;
    else {
      const g9 = `${(a4 = n3[n3.length - 1]) == null ? void 0 : a4.v}`;
      if (g9) {
        const f4 = g9.substr(g9.length - 1, 1);
        h9 = In3(f4) + t3 * c2;
      }
    }
    h9 < 0 && (h9 = Math.ceil(Math.abs(h9) / 7) * 7 + h9);
    const m9 = h9 % 7;
    u2 && (u2.v = o3[m9], s2.push(u2));
  }
  return s2;
}
function eh2(n3, e, t3) {
  var i;
  const r = [];
  for (let o3 = 1; o3 <= e; o3++) {
    const s2 = (o3 - 1) % n3.length, l4 = Z.deepClone(n3[s2]);
    _r4(l4);
    const a4 = `${(i = n3[n3.length - 1]) == null ? void 0 : i.v}`, c2 = In3(a4) + t3 * o3;
    let d2;
    c2 <= 0 ? d2 = "é›¶" : d2 = e13(c2), l4 && (l4.v = d2, r.push(l4));
  }
  return r;
}
var fo2 = {
  enWeek1: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"],
  enWeek2: ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"],
  enMonth1: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
  enMonth2: [
    "January",
    "February",
    "March",
    "April",
    "May",
    "June",
    "July",
    "August",
    "September",
    "October",
    "November",
    "December"
  ],
  chnMonth1: ["ä¸€æœˆ", "äºŒæœˆ", "ä¸‰æœˆ", "å››æœˆ", "äº”æœˆ", "å…­æœˆ", "ä¸ƒæœˆ", "å…«æœˆ", "ä¹æœˆ", "åæœˆ", "åä¸€æœˆ", "åäºŒæœˆ"],
  chnMonth2: ["æ­£æœˆ", "äºŒæœˆ", "ä¸‰æœˆ", "å››æœˆ", "äº”æœˆ", "å…­æœˆ", "ä¸ƒæœˆ", "å…«æœˆ", "ä¹æœˆ", "åæœˆ", "åä¸€æœˆ", "è…Šæœˆ"],
  chHour1: ["å­", "ä¸‘", "å¯…", "å¯", "è¾°", "å·³", "åˆ", "æœª", "ç”³", "é…‰", "æˆŒ", "äº¥"],
  chHour2: ["å­æ—¶", "ä¸‘æ—¶", "å¯…æ—¶", "å¯æ—¶", "è¾°æ—¶", "å·³æ—¶", "åˆæ—¶", "æœªæ—¶", "ç”³æ—¶", "é…‰æ—¶", "æˆŒæ—¶", "äº¥æ—¶"],
  chYear1: ["ç”²", "ä¹™", "ä¸™", "ä¸", "æˆŠ", "å·±", "åºš", "è¾›", "å£¬", "ç™¸"],
  chSeason1: ["æ˜¥", "å¤", "ç§‹", "å†¬"],
  chSeason2: ["æ˜¥å­£", "å¤å­£", "ç§‹å­£", "å†¬å­£"]
};
function d1(n3) {
  let e = false;
  return Object.keys(fo2).forEach((t3) => {
    fo2[t3].includes(n3) && (e = true);
  }), e;
}
function Wa3(n3) {
  let e = "";
  const t3 = [];
  return Object.keys(fo2).forEach((r) => {
    fo2[r].includes(n3) && (e = r, t3.push(...fo2[r]));
  }), { name: e, series: t3 };
}
function th2(n3, e, t3, r) {
  var s2;
  const i = r.length, o3 = [];
  for (let l4 = 1; l4 <= e; l4++) {
    const a4 = (l4 - 1) % n3.length, c2 = Z.deepClone(n3[a4]);
    _r4(c2);
    const d2 = `${(s2 = n3[n3.length - 1]) == null ? void 0 : s2.v}`;
    let u2 = r.indexOf(d2) + t3 * l4;
    u2 < 0 && (u2 += Math.abs(t3) * i);
    const h9 = u2 % i;
    c2 && (c2.v = r[h9], o3.push(c2));
  }
  return o3;
}
function dM(n3, e) {
  const t3 = [];
  let r;
  if (e.startRow < n3.startRow)
    r = wm.UP;
  else if (e.endRow > n3.endRow)
    r = wm.DOWN;
  else if (e.startColumn < n3.startColumn)
    r = wm.LEFT;
  else if (e.endColumn > n3.endColumn)
    r = wm.RIGHT;
  else
    return [];
  if (r === wm.DOWN || r === wm.UP) {
    const i = n3.endRow - n3.startRow + 1, o3 = e.endRow - e.startRow + 1, s2 = Math.floor(o3 / i), l4 = o3 % i, a4 = {
      startRow: 0,
      startColumn: 0,
      endRow: n3.endRow - n3.startRow,
      endColumn: n3.endColumn - n3.startColumn
    };
    if (r === wm.DOWN) {
      for (let c2 = 0; c2 < s2; c2++)
        t3.push({
          repeatStartCell: {
            row: n3.startRow + (c2 + 1) * i,
            col: n3.startColumn
          },
          relativeRange: a4
        });
      l4 > 0 && t3.push({
        repeatStartCell: {
          row: n3.startRow + (s2 + 1) * i,
          col: n3.startColumn
        },
        relativeRange: {
          startRow: 0,
          startColumn: 0,
          endRow: l4 - 1,
          endColumn: n3.endColumn - n3.startColumn
        }
      });
    } else {
      for (let c2 = 0; c2 < s2; c2++)
        t3.push({
          repeatStartCell: {
            row: n3.startRow - (c2 + 1) * i,
            col: n3.startColumn
          },
          relativeRange: a4
        });
      l4 > 0 && t3.push({
        repeatStartCell: {
          row: n3.startRow - (s2 + 1) * i,
          col: n3.startColumn
        },
        relativeRange: {
          startRow: i - l4,
          endRow: i - 1,
          startColumn: 0,
          endColumn: n3.endColumn - n3.startColumn
        }
      });
    }
  }
  if (r === wm.RIGHT || r === wm.LEFT) {
    const i = n3.endColumn - n3.startColumn + 1, o3 = e.endColumn - e.startColumn + 1, s2 = Math.floor(o3 / i), l4 = o3 % i, a4 = {
      startRow: 0,
      startColumn: 0,
      endRow: n3.endRow - n3.startRow,
      endColumn: n3.endColumn - n3.startColumn
    };
    if (r === wm.RIGHT) {
      for (let c2 = 0; c2 < s2; c2++)
        t3.push({
          repeatStartCell: {
            row: n3.startRow,
            col: n3.startColumn + (c2 + 1) * i
          },
          relativeRange: a4
        });
      l4 > 0 && t3.push({
        repeatStartCell: {
          row: n3.startRow,
          col: n3.startColumn + (s2 + 1) * i
        },
        relativeRange: {
          startRow: 0,
          startColumn: 0,
          endRow: n3.endRow - n3.startRow,
          endColumn: l4 - 1
        }
      });
    } else {
      for (let c2 = 0; c2 < s2; c2++)
        t3.push({
          repeatStartCell: {
            row: n3.startRow,
            col: n3.startColumn - (c2 + 1) * i
          },
          relativeRange: a4
        });
      l4 > 0 && t3.push({
        repeatStartCell: {
          row: n3.startRow,
          col: n3.startColumn - (s2 + 1) * i
        },
        relativeRange: {
          startRow: 0,
          startColumn: i - l4,
          endRow: n3.endRow - n3.startRow,
          endColumn: i - 1
        }
      });
    }
  }
  return t3;
}
function nh2(n3) {
  return !(Jg(n3.f) || KR(n3.si) || n3.t === mn.BOOLEAN);
}
function _r4(n3) {
  n3 && "custom" in n3 && delete n3.custom;
}
var ti3 = ((n3) => (n3.Append = "APPEND", n3.Default = "DEFAULT", n3.Only = "ONLY", n3))(ti3 || {});
var mt4 = ((n3) => (n3.NUMBER = "number", n3.DATE = "date", n3.EXTEND_NUMBER = "extendNumber", n3.CHN_NUMBER = "chnNumber", n3.CHN_WEEK2 = "chnWeek2", n3.CHN_WEEK3 = "chnWeek3", n3.LOOP_SERIES = "loopSeries", n3.FORMULA = "formula", n3.OTHER = "other", n3))(mt4 || {});
var Le4 = ((n3) => (n3.COPY = "COPY", n3.SERIES = "SERIES", n3.ONLY_FORMAT = "ONLY_FORMAT", n3.NO_FORMAT = "NO_FORMAT", n3))(Le4 || {});
var u13 = {
  type: mt4.DATE,
  priority: 1100,
  match: (n3, e) => {
    var t3;
    if (n3 != null && n3.f || n3 != null && n3.si)
      return false;
    if ((typeof (n3 == null ? void 0 : n3.v) == "number" || (n3 == null ? void 0 : n3.t) === mn.NUMBER) && n3.s) {
      if (typeof n3.s == "string") {
        const i = e.get(br).getFocusedUnit().getStyles().get(n3.s), o3 = (t3 = i == null ? void 0 : i.n) == null ? void 0 : t3.pattern;
        if (o3)
          return a1.getFormatInfo(o3).isDate;
      } else if (n3.s.n && a1.getFormatInfo(n3.s.n.pattern).isDate)
        return true;
    }
    return false;
  },
  isContinue: (n3, e) => n3.type === mt4.DATE,
  applyFunctions: {
    [Le4.SERIES]: (n3, e, t3) => {
      const { data: r } = n3;
      return t3 === wm.LEFT || t3 === wm.UP ? (r.reverse(), tl2(r, e, t3).reverse()) : tl2(r, e, t3);
    }
  }
};
var h12 = {
  type: mt4.NUMBER,
  priority: 1e3,
  match: (n3) => typeof (n3 == null ? void 0 : n3.v) == "number" || (n3 == null ? void 0 : n3.t) === mn.NUMBER,
  isContinue: (n3, e) => n3.type === mt4.NUMBER,
  applyFunctions: {
    [Le4.SERIES]: (n3, e, t3) => {
      const { data: r } = n3;
      return t3 === wm.LEFT || t3 === wm.UP ? (r.reverse(), tl2(r, e, t3).reverse()) : tl2(r, e, t3);
    }
  }
};
var Em = {
  type: mt4.OTHER,
  priority: 0,
  match: () => true,
  isContinue: (n3, e) => n3.type === mt4.OTHER
};
var g12 = {
  type: mt4.EXTEND_NUMBER,
  priority: 900,
  match: (n3) => ws2(`${n3 == null ? void 0 : n3.v}` || "").isExtendNumber,
  isContinue: (n3, e) => {
    var t3;
    if (n3.type === mt4.EXTEND_NUMBER) {
      const { beforeTxt: r, afterTxt: i } = ws2(`${(t3 = n3.cellData) == null ? void 0 : t3.v}` || ""), { beforeTxt: o3, afterTxt: s2 } = ws2(`${e == null ? void 0 : e.v}` || "");
      if (r === o3 && i === s2)
        return true;
    }
    return false;
  },
  applyFunctions: {
    [Le4.SERIES]: (n3, e, t3) => {
      var l4;
      const { data: r } = n3, i = t3 === wm.UP || t3 === wm.LEFT;
      let o3;
      if (r.length === 1)
        return o3 = i ? -1 : 1, Xt3($u2(r, e, o3), i);
      const s2 = [];
      for (let a4 = 0; a4 < r.length; a4++) {
        const c2 = `${(l4 = r[a4]) == null ? void 0 : l4.v}`;
        c2 && s2.push(Number(ws2(c2).matchTxt));
      }
      return i && (r.reverse(), s2.reverse()), rs3(s2) ? (o3 = s2[1] - s2[0], Xt3($u2(r, e, o3), i)) : br6(r, e);
    }
  }
};
var m1 = {
  type: mt4.CHN_NUMBER,
  priority: 830,
  match: (n3) => !!t1(`${n3 == null ? void 0 : n3.v}` || ""),
  isContinue: (n3, e) => n3.type === mt4.CHN_NUMBER,
  applyFunctions: {
    [Le4.SERIES]: (n3, e, t3) => {
      var a4, c2, d2;
      const { data: r } = n3, i = t3 === wm.LEFT || t3 === wm.UP;
      if (r.length === 1) {
        const u2 = `${(a4 = r[0]) == null ? void 0 : a4.v}`;
        let h9;
        return i ? h9 = -1 : h9 = 1, u2 && (u2 === "æ—¥" || In3(u2) < 7) ? Xt3(vi4(r, e, h9), i) : Xt3(eh2(r, e, h9), i);
      }
      let o3 = false;
      for (let u2 = 0; u2 < r.length; u2++)
        if (((c2 = r[u2]) == null ? void 0 : c2.v) === "æ—¥") {
          o3 = true;
          break;
        }
      const s2 = [];
      let l4 = 0;
      for (let u2 = 0; u2 < r.length; u2++) {
        const h9 = `${(d2 = r[u2]) == null ? void 0 : d2.v}`;
        h9 === "æ—¥" ? u2 === 0 ? s2.push(0) : (l4++, s2.push(l4 * 7)) : o3 && In3(h9) > 0 && In3(h9) < 7 ? s2.push(In3(h9) + l4 * 7) : s2.push(In3(h9));
      }
      if (i && (r.reverse(), s2.reverse()), rs3(s2)) {
        if (o3 || s2[s2.length - 1] < 6 && s2[0] > 0 || s2[0] < 6 && s2[s2.length - 1] > 0) {
          const h9 = s2[1] - s2[0];
          return Xt3(vi4(r, e, h9), i);
        }
        const u2 = s2[1] - s2[0];
        return Xt3(eh2(r, e, u2), i);
      }
      return br6(r, e);
    }
  }
};
var f1 = {
  type: mt4.CHN_WEEK2,
  priority: 820,
  match: (n3) => !!n1(`${n3 == null ? void 0 : n3.v}` || ""),
  isContinue: (n3, e) => n3.type === mt4.CHN_WEEK2,
  applyFunctions: {
    [Le4.SERIES]: (n3, e, t3) => {
      var l4;
      const { data: r } = n3, i = t3 === wm.LEFT || t3 === wm.UP;
      if (r.length === 1) {
        let a4;
        return i ? a4 = -1 : a4 = 1, Xt3(vi4(r, e, a4, 1), i);
      }
      const o3 = [];
      let s2 = 0;
      for (let a4 = 0; a4 < r.length; a4++) {
        const c2 = `${(l4 = r[a4]) == null ? void 0 : l4.v}`, d2 = c2 == null ? void 0 : c2.substr(c2.length - 1, 1);
        c2 === "å‘¨æ—¥" ? a4 === 0 ? o3.push(0) : (s2++, o3.push(s2 * 7)) : o3.push(In3(d2) + s2 * 7);
      }
      if (i && (r.reverse(), o3.reverse()), rs3(o3)) {
        const a4 = o3[1] - o3[0];
        return Xt3(vi4(r, e, a4, 1), i);
      }
      return br6(r, e);
    }
  }
};
var p1 = {
  type: mt4.CHN_WEEK3,
  priority: 810,
  match: (n3) => r1(`${n3 == null ? void 0 : n3.v}` || ""),
  isContinue: (n3, e) => n3.type === mt4.CHN_WEEK3,
  applyFunctions: {
    [Le4.SERIES]: (n3, e, t3) => {
      var l4;
      const { data: r } = n3, i = t3 === wm.LEFT || t3 === wm.UP;
      if (r.length === 1) {
        let a4;
        return i ? a4 = -1 : a4 = 1, Xt3(vi4(r, e, a4, 2), i);
      }
      const o3 = [];
      let s2 = 0;
      for (let a4 = 0; a4 < r.length; a4++) {
        const c2 = `${(l4 = r[a4]) == null ? void 0 : l4.v}`;
        if (c2) {
          const d2 = c2.substr(c2.length - 1, 1);
          c2 === "æ˜ŸæœŸæ—¥" ? a4 === 0 ? o3.push(0) : (s2++, o3.push(s2 * 7)) : o3.push(In3(d2) + s2 * 7);
        }
      }
      if (i && (r.reverse(), o3.reverse()), rs3(o3)) {
        const a4 = o3[1] - o3[0];
        return Xt3(vi4(r, e, a4, 2), i);
      }
      return br6(r, e);
    }
  }
};
var v12 = {
  type: mt4.LOOP_SERIES,
  priority: 800,
  match: (n3) => d1(`${n3 == null ? void 0 : n3.v}` || ""),
  isContinue: (n3, e) => {
    var t3;
    return n3.type === mt4.LOOP_SERIES ? Wa3(`${(t3 = n3.cellData) == null ? void 0 : t3.v}` || "").name === Wa3(`${e == null ? void 0 : e.v}` || "").name : false;
  },
  applyFunctions: {
    [Le4.SERIES]: (n3, e, t3) => {
      var a4, c2;
      const { data: r } = n3, i = t3 === wm.LEFT || t3 === wm.UP, { series: o3 } = Wa3(`${(a4 = r[0]) == null ? void 0 : a4.v}` || "");
      if (r.length === 1) {
        let d2;
        return i ? d2 = -1 : d2 = 1, Xt3(th2(r, e, d2, o3), i);
      }
      const s2 = [];
      let l4 = 0;
      for (let d2 = 0; d2 < r.length; d2++) {
        const u2 = `${(c2 = r[d2]) == null ? void 0 : c2.v}`;
        u2 && (u2 === o3[0] ? d2 === 0 ? s2.push(0) : (l4++, s2.push(l4 * o3.length)) : s2.push(o3.indexOf(u2) + l4 * 7));
      }
      if (i && (r.reverse(), s2.reverse()), rs3(s2)) {
        const d2 = s2[1] - s2[0];
        return Xt3(th2(r, e, d2, o3), i);
      }
      return br6(r, e);
    }
  }
};
function Xt3(n3, e) {
  return e ? n3.reverse() : n3;
}
var S14 = Object.getOwnPropertyDescriptor;
var C1 = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? S14(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var Ur3 = (n3, e) => (t3, r) => e(t3, r, n3);
var nl2 = class extends Ve {
  constructor(e, t3, r, i, o3, s2) {
    super();
    _2(this, "_rules", []);
    _2(this, "_hooks", []);
    _2(this, "_applyType$", new BehaviorSubject(Le4.SERIES));
    _2(this, "_isFillingStyle", true);
    _2(this, "_prevUndos", []);
    _2(this, "_autoFillLocation$", new BehaviorSubject(null));
    _2(this, "autoFillLocation$", this._autoFillLocation$.asObservable());
    _2(this, "_showMenu$", new BehaviorSubject(false));
    _2(this, "showMenu$", this._showMenu$.asObservable());
    _2(this, "_direction", wm.DOWN);
    _2(this, "applyType$", this._applyType$.asObservable());
    _2(this, "_menu$", new BehaviorSubject([
      {
        label: "autoFill.copy",
        value: Le4.COPY,
        disable: false
      },
      {
        label: "autoFill.series",
        value: Le4.SERIES,
        disable: false
      },
      {
        label: "autoFill.formatOnly",
        value: Le4.ONLY_FORMAT,
        disable: false
      },
      {
        label: "autoFill.noFormat",
        value: Le4.NO_FORMAT,
        disable: false
      }
    ]));
    _2(this, "menu$", this._menu$.asObservable());
    this._commandService = e, this._undoRedoService = t3, this._renderManagerService = r, this._univerInstanceService = i, this._selectionManagerService = o3, this._injector = s2, this._init();
  }
  _init() {
    this._rules = [
      u13,
      h12,
      g12,
      m1,
      f1,
      p1,
      v12,
      Em
    ].sort((e, t3) => t3.priority - e.priority), this._isFillingStyle = true;
  }
  _getOneByPriority(e) {
    return e.length <= 0 ? [] : [e.reduce((r, i) => (i.priority || 0) > (r.priority || 0) ? i : r, e[0])];
  }
  // a cache to undo commands of last apply-type
  _initPrevUndo() {
    this._prevUndos = [];
  }
  // eslint-disable-next-line max-lines-per-function, complexity
  triggerAutoFill(e, t3, r, i, o3) {
    return __async(this, null, function* () {
      var m9;
      if (r.startColumn === i.startColumn && r.startRow === i.startRow && r.endColumn === i.endColumn && r.endRow === i.endRow)
        return false;
      if (i.endColumn < r.endColumn && i.endColumn > r.startColumn)
        return this._commandService.executeCommand(yo2.id, {
          clearRange: {
            startRow: i.startRow,
            endRow: i.endRow,
            startColumn: i.endColumn + 1,
            endColumn: r.endColumn
          },
          selectionRange: i
        });
      if (i.endRow < r.endRow && i.endRow > r.startRow)
        return this._commandService.executeCommand(yo2.id, {
          clearRange: {
            startRow: i.endRow + 1,
            endRow: r.endRow,
            startColumn: i.startColumn,
            endColumn: i.endColumn
          },
          selectionRange: i
        });
      const s2 = {
        startRow: i.startRow,
        endRow: i.endRow,
        startColumn: i.startColumn,
        endColumn: i.endColumn
      };
      let l4 = null;
      if (i.startRow < r.startRow)
        l4 = wm.UP, s2.endRow = r.startRow - 1;
      else if (i.endRow > r.endRow)
        l4 = wm.DOWN, s2.startRow = r.endRow + 1;
      else if (i.startColumn < r.startColumn)
        l4 = wm.LEFT, s2.endColumn = r.startColumn - 1;
      else if (i.endColumn > r.endColumn)
        l4 = wm.RIGHT, s2.startColumn = r.endColumn + 1;
      else
        return false;
      this.direction = l4;
      const a4 = this._injector.invoke((g9) => Du(r, g9)), c2 = this._injector.invoke((g9) => Du(s2, g9));
      if (!a4 || !c2)
        return false;
      this.autoFillLocation = {
        source: a4,
        target: c2,
        unitId: e,
        subUnitId: t3
      };
      const d2 = [];
      if (this.getActiveHooks().forEach((g9) => {
        var p3;
        const f4 = (p3 = g9 == null ? void 0 : g9.onBeforeFillData) == null ? void 0 : p3.call(g9, { source: a4, target: c2, unitId: e, subUnitId: t3 }, l4);
        f4 && d2.unshift(f4);
      }), this._initPrevUndo(), o3)
        return this.fillData(o3);
      for (let g9 = 0; g9 < d2.length; g9++) {
        const f4 = this.menu.find((p3) => p3.value === d2[g9]);
        if (f4 && !f4.disable)
          return this.fillData(d2[g9]);
      }
      const h9 = (m9 = this.menu.find((g9) => g9.disable === false)) == null ? void 0 : m9.value;
      return h9 ? this.fillData(h9) : false;
    });
  }
  addHook(e) {
    if (this._hooks.find((t3) => t3.id === e.id))
      throw new Error(`Add hook failed, hook id '${e.id}' already exist!`);
    return e.priority === void 0 && (e.priority = 0), e.type === void 0 && (e.type = ti3.Append), this._hooks.push(e), Be(() => {
      const t3 = this._hooks.findIndex((r) => r === e);
      t3 > -1 && this._hooks.splice(t3, 1);
    });
  }
  registerRule(e) {
    if (this._rules.find((r) => r.type === e.type))
      throw new Error(`Registry rule failed, type '${e.type}' already exist!`);
    const t3 = this._rules.findIndex((r) => r.priority < e.priority);
    this._rules.splice(t3 === -1 ? this._rules.length : t3, 0, e);
  }
  getRules() {
    return this._rules;
  }
  getAllHooks() {
    return this._hooks;
  }
  getActiveHooks() {
    const { source: e, target: t3, unitId: r, subUnitId: i } = this.autoFillLocation || {};
    if (!e || !t3 || !r || !i)
      return [];
    const o3 = this._hooks.filter(
      (c2) => {
        var d2;
        return !((d2 = c2.disable) != null && d2.call(c2, { source: e, target: t3, unitId: r, subUnitId: i }, this._direction, this.applyType));
      }
    ), s2 = o3.filter((c2) => c2.type === ti3.Only);
    if (s2.length > 0)
      return this._getOneByPriority(s2);
    const l4 = this._getOneByPriority(o3.filter((c2) => c2.type === ti3.Default)), a4 = o3.filter((c2) => c2.type === ti3.Append) || [];
    return [...l4, ...a4];
  }
  get applyType() {
    return this._applyType$.getValue();
  }
  set applyType(e) {
    this._applyType$.next(e);
  }
  get menu() {
    return this._menu$.getValue();
  }
  get direction() {
    return this._direction;
  }
  set direction(e) {
    this._direction = e;
  }
  isFillingStyle() {
    return this._isFillingStyle;
  }
  setFillingStyle(e) {
    this._isFillingStyle = e;
  }
  get autoFillLocation() {
    return this._autoFillLocation$.getValue();
  }
  set autoFillLocation(e) {
    this._autoFillLocation$.next(e);
  }
  setDisableApplyType(e, t3) {
    this._menu$.next(
      this._menu$.getValue().map((r) => r.value === e ? __spreadProps(__spreadValues({}, r), {
        disable: t3
      }) : r)
    );
  }
  setShowMenu(e) {
    this._showMenu$.next(e);
  }
  // eslint-disable-next-line max-lines-per-function
  fillData(e) {
    var w6, C, I6;
    this.applyType = e;
    const t3 = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET), r = t3 == null ? void 0 : t3.getUnitId(), i = (w6 = t3 == null ? void 0 : t3.getActiveSheet()) == null ? void 0 : w6.getSheetId(), { source: o3, target: s2, unitId: l4 = r, subUnitId: a4 = i } = this.autoFillLocation || {};
    if (!o3 || !s2 || !l4 || !a4)
      return false;
    const c2 = this.direction;
    this._prevUndos.length > 0 && this._prevUndos.forEach((R9) => {
      this._commandService.syncExecuteCommand(R9.id, R9.params);
    }), this._prevUndos = [];
    const d2 = Cn.union(Cr3(o3), Cr3(s2)), u2 = this.getActiveHooks(), h9 = this._univerInstanceService.getUnit(l4, we.UNIVER_SHEET);
    l4 === r && a4 === i && this._commandService.syncExecuteCommand(ie5.id, {
      selections: [
        {
          primary: __spreadValues({}, (I6 = (C = this._selectionManagerService.getCurrentLastSelection()) == null ? void 0 : C.primary) != null ? I6 : d2),
          range: __spreadProps(__spreadValues({}, d2), {
            rangeType: ge.NORMAL
          })
        }
      ],
      unitId: l4,
      subUnitId: a4
    });
    const m9 = [], g9 = [];
    u2.forEach((R9) => {
      var M10;
      const { undos: y6, redos: E3 } = ((M10 = R9.onFillData) == null ? void 0 : M10.call(R9, { source: o3, target: s2, unitId: l4, subUnitId: a4 }, c2, e)) || {};
      y6 && m9.push(...y6), E3 && g9.push(...E3);
    });
    const f4 = g9.every((R9) => this._commandService.syncExecuteCommand(R9.id, R9.params)), p3 = [];
    e !== Le4.NO_FORMAT && g9.forEach((R9) => {
      if (R9.id === ee2.id) {
        const { cellValue: y6 } = R9.params;
        new ht(y6).forValue((M10, T10, P8) => {
          const A4 = Object.keys(h9.getStyles().get(P8 == null ? void 0 : P8.s) || {});
          (P8 != null && P8.p || A4.length && QC2.some((x7) => A4.includes(x7))) && p3.push({ startRow: M10, endRow: M10, startColumn: T10, endColumn: T10 });
        });
      }
    });
    const v6 = this._getAutoHeightUndoRedos(l4, a4, p3);
    return v6.redos.every((R9) => this._commandService.syncExecuteCommand(R9.id, R9.params)) && (m9.push(...v6.undos), g9.push(...v6.redos)), f4 && (this._prevUndos = m9, this._undoRedoService.pushUndoRedo({
      unitID: l4,
      undoMutations: m9,
      redoMutations: g9
    })), u2.forEach((R9) => {
      var y6;
      (y6 = R9.onAfterFillData) == null || y6.call(R9, { source: o3, target: s2, unitId: l4, subUnitId: a4 }, c2, e);
    }), this.setShowMenu(true), true;
  }
  _getAutoHeightUndoRedos(e, t3, r) {
    var d2, u2;
    const i = (d2 = this._renderManagerService.getRenderById(e)) == null ? void 0 : d2.with(he2), o3 = (u2 = i == null ? void 0 : i.getCurrentParam()) == null ? void 0 : u2.skeleton;
    if (!o3) return { redos: [], undos: [] };
    const s2 = o3.calculateAutoHeightInRange(r), l4 = { subUnitId: t3, unitId: e, rowsAutoHeightInfo: s2 }, a4 = o3.worksheet, c2 = yh2(l4, a4);
    return {
      undos: [{ id: er2.id, params: c2 }],
      redos: [{ id: er2.id, params: l4 }]
    };
  }
};
nl2 = C1([
  Ur3(0, Ds),
  Ur3(1, ra),
  Ur3(2, JE),
  Ur3(3, Inject(br)),
  Ur3(4, Inject(z)),
  Ur3(5, Inject(Injector))
], nl2);
var Nr3 = createIdentifier("univer.auto-fill-service");
var gr5 = {
  type: Ls.COMMAND,
  id: "sheet.command.auto-fill",
  handler: (n3, e) => __async(void 0, null, function* () {
    const t3 = n3.get(Nr3), r = n3.get(br), { sourceRange: i, targetRange: o3, applyType: s2 } = e, l4 = P5(r, e);
    if (!l4) return false;
    const { subUnitId: a4, unitId: c2 } = l4;
    return t3.triggerAutoFill(c2, a4, i, o3, s2);
  })
};
var yo2 = {
  id: "sheet.command.auto-clear-content",
  type: Ls.COMMAND,
  handler: (n3, e) => __async(void 0, null, function* () {
    const t3 = n3.get(br), r = n3.get(Ds), i = n3.get(ra), o3 = n3.get(G), s2 = P5(t3);
    if (!s2) return false;
    const { unitId: l4, subUnitId: a4 } = s2, { clearRange: c2, selectionRange: d2 } = e, u2 = {
      subUnitId: a4,
      unitId: l4,
      cellValue: Nu([c2])
    }, h9 = Ae4(
      n3,
      u2
    ), { startColumn: m9, startRow: g9 } = d2, f4 = {
      selections: [
        {
          primary: {
            startColumn: m9,
            startRow: g9,
            endColumn: m9,
            endRow: g9,
            actualRow: g9,
            actualColumn: m9,
            isMerged: false,
            isMergedMainCell: false
          },
          range: __spreadValues({}, d2)
        }
      ],
      unitId: l4,
      subUnitId: a4
    };
    if (r.executeCommand(ie5.id, f4), r.syncExecuteCommand(ee2.id, u2)) {
      const v6 = o3.afterCommandExecute({
        id: ee2.id,
        params: u2
      });
      return po(v6.redos, r), i.pushUndoRedo({
        // If there are multiple mutations that form an encapsulated project, they must be encapsulated in the same undo redo element.
        // Hooks can be used to hook the code of external controllers to add new actions.
        unitID: l4,
        undoMutations: [{ id: ee2.id, params: h9 }, ...v6.undos],
        redoMutations: [{ id: ee2.id, params: u2 }, ...v6.redos]
      }), true;
    }
    return false;
  })
};
function Zd3(n3) {
  return n3.getContextValue(_r);
}
function Ne2(n3) {
  return n3.getContextValue(_r) && n3.getContextValue($1) && !n3.getContextValue(pE) && !n3.getContextValue(Y1);
}
function Tm(n3) {
  return n3.getContextValue(_r) && n3.getContextValue($1) && !n3.getContextValue(pE) && !n3.getContextValue(EE) && !n3.getContextValue(Y1);
}
function w12(n3) {
  return n3.getContextValue(_r) && n3.getContextValue($1) && n3.getContextValue(pE);
}
function Gd2(n3) {
  return n3.getContextValue($1) && n3.getContextValue(pE);
}
function ua2(n3) {
  return n3.getContextValue(EE) && n3.getContextValue($1);
}
function uM(n3) {
  return n3.getContextValue(_r) && n3.getContextValue(pE) && n3.getContextValue(H1) && n3.getContextValue($1);
}
function Si3(n3) {
  return n3.getContextValue(_r) && n3.getContextValue($1) && n3.getContextValue(pE) && !n3.getContextValue(H1) && !n3.getContextValue(B1);
}
var b1 = Object.getOwnPropertyDescriptor;
var _12 = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? b1(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var Ba2 = (n3, e) => (t3, r) => e(t3, r, n3);
var rh2 = Rm.MARK_SELECTION;
var Xi3 = createIdentifier("univer.mark-selection-service");
var rl2 = class extends Ve {
  constructor(e, t3, r) {
    super();
    _2(this, "_shapeMap", /* @__PURE__ */ new Map());
    this._currentService = e, this._renderManagerService = t3, this._themeService = r;
  }
  addShape(e, t3 = [], r = rh2) {
    var a4;
    const i = this._currentService.getCurrentUnitForType(we.UNIVER_SHEET), o3 = (a4 = i.getActiveSheet()) == null ? void 0 : a4.getSheetId();
    if (!o3) return null;
    const s2 = et(), l4 = {
      selection: e,
      subUnitId: o3,
      unitId: i.getUnitId(),
      zIndex: r,
      control: null,
      exits: t3
    };
    return this._shapeMap.set(s2, l4), this.refreshShapes(), s2;
  }
  addShapeWithNoFresh(e, t3 = [], r = rh2) {
    var l4;
    const i = this._currentService.getCurrentUnitForType(we.UNIVER_SHEET), o3 = (l4 = i.getActiveSheet()) == null ? void 0 : l4.getSheetId();
    if (!o3) return null;
    const s2 = et();
    return this._shapeMap.set(s2, {
      selection: e,
      subUnitId: o3,
      unitId: i.getUnitId(),
      zIndex: r,
      control: null,
      exits: t3
    }), s2;
  }
  refreshShapes() {
    var i;
    const e = this._currentService.getCurrentUnitForType(we.UNIVER_SHEET);
    if (!e) return;
    const t3 = e.getUnitId(), r = (i = e.getActiveSheet()) == null ? void 0 : i.getSheetId();
    this._shapeMap.forEach((o3) => {
      const { unitId: s2, subUnitId: l4, selection: a4, control: c2, zIndex: d2 } = o3;
      if (c2 == null || c2.dispose(), s2 !== t3 || l4 !== r)
        return;
      const u2 = this._renderManagerService.getRenderById(s2);
      if (!u2) return;
      const h9 = u2.with(he2).getCurrentSkeleton();
      if (!h9) return;
      const { scene: m9 } = u2, { rowHeaderWidth: g9, columnHeaderHeight: f4 } = h9, p3 = new jd2(m9, d2, this._themeService, {
        enableAutoFill: false,
        highlightHeader: false,
        rowHeaderWidth: g9,
        columnHeaderHeight: f4
      }), v6 = Wt3(a4, h9);
      p3.updateRangeBySelectionWithCoord(v6), o3.control = p3;
    });
  }
  getShapeMap() {
    return this._shapeMap;
  }
  removeShape(e) {
    const t3 = this._shapeMap.get(e);
    if (!t3) return;
    const { control: r } = t3;
    r == null || r.dispose(), this._shapeMap.delete(e);
  }
  removeAllShapes() {
    for (const e of this._shapeMap.values()) {
      const { control: t3 } = e;
      t3 == null || t3.dispose();
    }
    this._shapeMap.clear();
  }
};
rl2 = _12([
  Ba2(0, br),
  Ba2(1, JE),
  Ba2(2, Inject(Ji))
], rl2);
function Pm(n3) {
  return {
    strokeWidth: 1.5,
    stroke: n3.getColorFromTheme("primary.600"),
    fill: "rgba(178, 178, 178, 0.10)",
    widgets: {},
    strokeDash: 8
  };
}
function R1(n3) {
  if (n3 == null)
    return n3;
  const e = {};
  return n3.p !== void 0 && (e.p = n3.p === null ? null : Ct(n3.p)), n3.s !== void 0 && (n3.s === null || typeof n3.s == "string" ? e.s = n3.s : e.s = Ct(n3.s)), n3.v !== void 0 && (e.v = n3.v), n3.t !== void 0 && (e.t = n3.t), n3.f !== void 0 && (e.f = n3.f), n3.ref !== void 0 && (e.ref = n3.ref), n3.xf !== void 0 && (e.xf = n3.xf), n3.si !== void 0 && (e.si = n3.si), n3.custom !== void 0 && (e.custom = n3.custom === null ? null : Ct(n3.custom)), n3.rowSpan !== void 0 && (e.rowSpan = n3.rowSpan), n3.colSpan !== void 0 && (e.colSpan = n3.colSpan), n3.plain !== void 0 && (e.plain = n3.plain), e;
}
var I13 = 10;
var y13 = 6;
function M12() {
  return et(y13);
}
function E1(n3) {
  const e = n3.match(/data-copy-id="([^\s]+)"/);
  return e && e[1] ? e[1] : null;
}
var T1 = class {
  constructor() {
    _2(this, "_cache", new _s(I13));
  }
  set(e, t3) {
    this._cache.set(e, t3);
  }
  get(e) {
    return this._cache.get(e);
  }
  del(e) {
    this._cache.delete(e);
  }
  clear() {
    this._cache.clear();
  }
  clearWithUnitId(e) {
    this._cache.forEach((t3, r) => {
      t3.unitId === e && this._cache.delete(r);
    });
  }
};
function il2(n3, e) {
  const t3 = e != null ? e : n3.style, r = {}, i = n3.tagName.toLowerCase();
  switch (i) {
    case "b":
    case "em":
    case "strong": {
      r.bl = ie.TRUE;
      break;
    }
    case "s": {
      r.st = {
        s: ie.TRUE
      };
      break;
    }
    case "u": {
      r.ul = {
        s: ie.TRUE
      };
      break;
    }
    case "i": {
      r.it = ie.TRUE;
      break;
    }
    case "sub":
    case "sup": {
      r.va = i === "sup" ? Zt.SUPERSCRIPT : Zt.SUBSCRIPT;
      break;
    }
  }
  return P1(t3, r), r;
}
function P1(n3, e) {
  if (n3 instanceof CSSStyleDeclaration)
    for (let t3 = 0; t3 < n3.length; t3++) {
      const r = n3[t3], i = n3.getPropertyValue(r);
      ih2(r, i, e);
    }
  else
    for (const t3 in n3) {
      const r = n3[t3];
      ih2(t3, r, e);
    }
}
function ih2(n3, e, t3) {
  switch (n3) {
    case "font-family":
      t3.ff = e;
      break;
    case "font-size": {
      const r = Number.parseInt(e);
      Number.isNaN(r) || (e.endsWith("pt") ? t3.fs = r : e.endsWith("px") && (t3.fs = r * 0.75));
      break;
    }
    case "font-style":
      e === "italic" && (t3.it = ie.TRUE);
      break;
    case "font-weight": {
      (Number(e) > 400 || e === "bold") && (t3.bl = ie.TRUE);
      break;
    }
    case "text-decoration": {
      /underline/.test(e) ? t3.ul = { s: ie.TRUE } : /overline/.test(e) ? t3.ol = { s: ie.TRUE } : /line-through/.test(e) && (t3.st = { s: ie.TRUE });
      break;
    }
    case "color": {
      try {
        const r = new At(e);
        r.isValid && (t3.cl = {
          rgb: r.toRgbString()
        });
      } catch (e4) {
      }
      break;
    }
    case "background-color": {
      const r = new At(e);
      r.isValid && (t3.bg = {
        rgb: r.toRgbString()
      });
      break;
    }
  }
}
function x13(n3) {
  const e = document.createElement("body");
  return e.innerHTML = n3, e;
}
function xm(n3) {
  const e = n3.style, t3 = {};
  for (let r = 0; r < e.length; r++) {
    const i = e[r], o3 = e.getPropertyValue(i);
    switch (i) {
      case "margin-top": {
        const s2 = Number.parseInt(o3);
        t3.spaceAbove = { v: /pt/.test(o3) ? c3(s2) : s2 };
        break;
      }
      case "margin-bottom": {
        const s2 = Number.parseInt(o3);
        t3.spaceBelow = { v: /pt/.test(o3) ? c3(s2) : s2 };
        break;
      }
      case "line-height": {
        const s2 = Number.parseFloat(o3);
        t3.lineSpacing = s2;
        break;
      }
    }
  }
  return Object.getOwnPropertyNames(t3).length ? t3 : null;
}
function Fa3(n3, e) {
  const t3 = [];
  for (let r = 0, i = n3.length; r < i; r++)
    n3[r] === ct.PARAGRAPH && t3.push({
      startIndex: r
    });
  return t3;
}
function oh2(n3, e, t3) {
  var s2, l4, a4;
  const r = e.length, o3 = ((s2 = t3 == null ? void 0 : t3.length) != null ? s2 : 0) === 1 && t3[0].st === 0 && t3[0].ed === r;
  return n3.p ? o3 && ((a4 = (l4 = n3.p.body) == null ? void 0 : l4.textRuns) != null && a4.length) ? (n3.p.body.textRuns = [], __spreadProps(__spreadValues({}, n3), {
    s: t3[0].ts
  })) : n3 : o3 ? __spreadProps(__spreadValues({}, n3), {
    s: t3[0].ts
  }) : n3;
}
var sh2 = [
  // Rich Text Style Rules,
  "color",
  "background",
  "font-size",
  "text-align",
  "vertical-align",
  "font-weight",
  "font-style",
  "font-family",
  "text-decoration",
  "white-space",
  "word-wrap",
  // Border Style Rules,
  "border-left",
  "border-right",
  "border-top",
  "border-bottom",
  // Custom Style Rules, '--' needs to be used as a prefix.
  "--data-rotate"
];
function lh2(n3, e) {
  const t3 = n3.tagName.toLowerCase();
  return typeof e == "string" ? t3 === e : Array.isArray(e) ? e.some((r) => r === t3) : e(n3);
}
var Wl2 = class Wl3 {
  constructor(e) {
    _2(this, "_styleMap", /* @__PURE__ */ new Map());
    _2(this, "_styleCache", /* @__PURE__ */ new Map());
    _2(this, "_styleRules", []);
    _2(this, "_afterProcessRules", []);
    _2(this, "_dom", null);
    _2(this, "_getCurrentSkeleton");
    this._getCurrentSkeleton = e.getCurrentSkeleton;
  }
  static use(e) {
    if (this._pluginList.includes(e))
      throw new Error(`Univer paste plugin ${e.name} already added`);
    this._pluginList.push(e);
  }
  // eslint-disable-next-line max-lines-per-function
  convert(e) {
    const t3 = Wl3._pluginList.find((f4) => f4.checkPasteType(e));
    t3 && (this._styleRules = [...t3.stylesRules], this._afterProcessRules = [...t3.afterProcessRules]);
    const r = new ht();
    this._dom = x13(e);
    const i = this._dom.querySelector("style");
    if (i) {
      const f4 = document.createElement("div"), p3 = f4.attachShadow({ mode: "open" });
      document.body.appendChild(f4), p3.appendChild(i);
      for (const v6 of i.sheet.cssRules) {
        const S = v6, w6 = S.selectorText, C = S.style;
        this._styleMap.set(w6, C);
      }
      i.remove(), f4.remove();
    }
    const o3 = {
      dataStream: "",
      textRuns: []
    }, s2 = [], l4 = [], a4 = e.match(/<table\b[^>]*>([\s\S]*?)<\/table>/gi), c2 = [];
    this.process(null, this._dom.childNodes, o3, c2);
    const { paragraphs: d2, dataStream: u2, textRuns: h9, payloads: m9, customRanges: g9 } = o3;
    if (d2) {
      const f4 = d2.map((p3) => p3.startIndex + 1);
      f4.unshift(0);
      for (let p3 = 0; p3 < f4.length; p3++) {
        let v6;
        if (p3 === f4.length - 1) {
          if (v6 = `${u2.substring(f4[p3])}\r
`, v6 === `\r
`)
            continue;
        } else
          v6 = `${u2.substring(f4[p3], f4[p3 + 1] - 1)}\r
`;
        const S = [];
        h9 == null || h9.forEach((R9) => {
          R9.st >= f4[p3] && R9.ed <= f4[p3 + 1] && S.push({
            st: R9.st - f4[p3],
            ed: R9.ed - f4[p3],
            ts: R9.ts
          });
        });
        const w6 = [];
        g9 == null || g9.forEach((R9) => {
          R9.startIndex >= f4[p3] && R9.endIndex <= f4[p3 + 1] && w6.push(__spreadProps(__spreadValues({}, R9), {
            startIndex: R9.startIndex - f4[p3],
            endIndex: R9.endIndex - f4[p3]
          }));
        });
        const C = this._generateDocumentDataModelSnapshot({
          body: {
            dataStream: v6,
            textRuns: S,
            paragraphs: Fa3(v6),
            customRanges: w6
          }
        }), I6 = Object.keys(r.getMatrix()).length === 0;
        r.setValue(I6 ? 0 : r.getLength(), 0, {
          v: v6,
          p: C
        }), s2.push({});
      }
    } else if (u2) {
      const f4 = `${u2}\r
`, p3 = {
        dataStream: f4,
        textRuns: h9,
        paragraphs: Fa3(f4),
        payloads: m9,
        customRanges: g9
      };
      if (!(g9 != null && g9.length))
        r.setValue(0, 0, oh2({ v: u2 }, u2, h9));
      else {
        const v6 = this._generateDocumentDataModelSnapshot({
          body: p3
        });
        r.setValue(0, 0, oh2({ v: u2, p: v6 }, u2, h9));
      }
      s2.push({});
    }
    return a4 && a4.forEach((f4, p3) => {
      const v6 = r.getDataRange().endRow + 1, { cellMatrix: S, rowProperties: w6, colProperties: C } = this._parseTable(f4, p3);
      S && S.forValue((I6, R9, y6) => {
        r.setValue(v6 + I6, R9, y6);
      }), C && l4.push(...C), s2.push(...w6);
    }), this.dispose(), {
      rowProperties: s2,
      colProperties: l4,
      cellMatrix: r
    };
  }
  _getStyleBySelectorText(e, t3) {
    var i;
    const r = (i = this._styleMap.get(e)) == null ? void 0 : i.getPropertyValue(t3);
    return r || "";
  }
  _getStyle(e, t3) {
    const r = ah2(t3), i = e.style;
    let o3 = "";
    for (let s2 = 0; s2 < sh2.length; s2++) {
      const l4 = sh2[s2];
      if (l4 === "background") {
        let c2 = "";
        e.classList.forEach((u2) => {
          c2 = this._getStyleBySelectorText(`.${u2}`, "background-color") || this._getStyleBySelectorText(`.${u2}`, l4);
        });
        const d2 = i.getPropertyValue("background-color") || c2 || this._getStyleBySelectorText(`#${e.id}`, "background-color") || this._getStyleBySelectorText(`#${e.id}`, l4) || this._getStyleBySelectorText(e.nodeName.toLowerCase(), l4) || this._getStyleBySelectorText(e.nodeName, "background-color") || r["background-color"] || "";
        d2 && (o3 += `background:${d2};`);
        continue;
      }
      if (l4 === "text-decoration") {
        let c2 = "";
        e.classList.forEach((u2) => {
          c2 = this._getStyleBySelectorText(`.${u2}`, "text-decoration-line") || this._getStyleBySelectorText(`.${u2}`, l4);
        });
        const d2 = i.getPropertyValue("text-decoration-line") || i.getPropertyValue("text-decoration") || c2 || this._getStyleBySelectorText(`#${e.id}`, "text-decoration-line") || this._getStyleBySelectorText(`#${e.id}`, l4) || this._getStyleBySelectorText(e.nodeName.toLowerCase(), l4) || this._getStyleBySelectorText(e.nodeName, "text-decoration-line") || r["text-decoration-line"] || "";
        d2 && (o3 += `text-decoration:${d2};`);
        continue;
      }
      let a4 = "";
      e.classList.forEach((c2) => {
        a4 = this._getStyleBySelectorText(`.${c2}`, l4);
      }), a4 = i.getPropertyValue(l4) || this._getStyleBySelectorText(`#${e.id}`, l4) || a4 || this._getStyleBySelectorText(e.nodeName.toLowerCase(), l4) || r[l4] || "", a4 && (o3 += `${l4}:${a4};`);
    }
    return o3;
  }
  _parseTable(e, t3) {
    var l4, a4;
    const r = new ht(), i = (l4 = A1(e)) != null ? l4 : [], { rowProperties: o3 = [] } = O1(e), s2 = this._parseTableByHtml(this._dom, t3, (a4 = this._getCurrentSkeleton()) == null ? void 0 : a4.skeleton);
    return s2 && s2.forValue((c2, d2, u2) => {
      var g9, f4, p3, v6, S, w6, C, I6, R9, y6, E3, M10, T10, P8, A4, x7, H6, V7, D5, B5, F7, z5, Z9, de3;
      let h9 = dt(void 0, u2.style);
      if ((v6 = (p3 = (f4 = (g9 = u2 == null ? void 0 : u2.richTextParma) == null ? void 0 : g9.p) == null ? void 0 : f4.body) == null ? void 0 : p3.textRuns) != null && v6.length) {
        const Re5 = (w6 = (S = u2 == null ? void 0 : u2.richTextParma) == null ? void 0 : S.v) == null ? void 0 : w6.length;
        for (let we6 = 0; we6 < ((y6 = (R9 = (I6 = (C = u2 == null ? void 0 : u2.richTextParma) == null ? void 0 : C.p) == null ? void 0 : I6.body) == null ? void 0 : R9.textRuns) == null ? void 0 : y6.length); we6++) {
          const ke4 = (T10 = (M10 = (E3 = u2 == null ? void 0 : u2.richTextParma) == null ? void 0 : E3.p) == null ? void 0 : M10.body) == null ? void 0 : T10.textRuns[we6];
          ke4.st === 0 && ke4.ed === Re5 && (h9 = __spreadValues(__spreadValues({}, ke4.ts), h9), (x7 = (A4 = (P8 = u2 == null ? void 0 : u2.richTextParma) == null ? void 0 : P8.p) == null ? void 0 : A4.body) == null || x7.textRuns.splice(we6, 1), we6--);
        }
        ((B5 = (D5 = (V7 = (H6 = u2 == null ? void 0 : u2.richTextParma) == null ? void 0 : H6.p) == null ? void 0 : V7.body) == null ? void 0 : D5.textRuns) == null ? void 0 : B5.length) === 0 && (u2.content = (F7 = u2 == null ? void 0 : u2.richTextParma) == null ? void 0 : F7.v, delete u2.richTextParma);
      }
      const m9 = (de3 = (Z9 = (z5 = u2 == null ? void 0 : u2.richTextParma) == null ? void 0 : z5.p) == null ? void 0 : Z9.body) != null && de3.textRuns ? {
        v: u2.richTextParma.v,
        p: u2.richTextParma.p,
        s: h9,
        rowSpan: u2.rowSpan,
        colSpan: u2.colSpan
      } : {
        v: u2.content,
        s: h9,
        rowSpan: u2.rowSpan,
        colSpan: u2.colSpan
      };
      r.setValue(c2, d2, m9);
    }), {
      rowProperties: o3,
      colProperties: i,
      cellMatrix: r
    };
  }
  _parseTableByHtml(e, t3, r) {
    var a4, c2;
    const i = new ht(), o3 = e.querySelectorAll("table")[t3];
    if (!o3)
      return i;
    const s2 = this._getStyle(o3, ""), l4 = o3 == null ? void 0 : o3.querySelectorAll("tr");
    for (let d2 = 0; d2 < l4.length; d2++) {
      const u2 = l4[d2], h9 = this._getStyle(u2, s2), m9 = u2.querySelectorAll("td, th");
      let g9 = 0;
      for (let f4 = 0; f4 < m9.length; ) {
        const p3 = m9[f4];
        let v6 = "";
        const S = Number(p3.getAttribute("rowSpan")) || 1, w6 = Number(p3.getAttribute("colSpan")) || 1;
        if (v6 = this._getStyle(p3, h9), d2 > 0) {
          const y6 = i.getValue(d2 - 1, g9);
          if ((a4 = y6 == null ? void 0 : y6.style) != null && a4.includes("border-bottom") && v6.includes("border-top")) {
            const E3 = ch2(y6.style, "border-bottom");
            E3 && R3(E3.substr(E3.indexOf(":") + 1)) !== "none" && (v6 = v6.replace(/border-top:[^;]+;/, ""));
          }
        }
        if (f4 > 0) {
          const y6 = i.getValue(d2, g9 - 1);
          if ((c2 = y6 == null ? void 0 : y6.style) != null && c2.includes("border-right") && v6.includes("border-left")) {
            const E3 = ch2(y6.style, "border-right");
            E3 && R3(E3.substr(E3.indexOf(":") + 1)) !== "none" && (v6 = v6.replace(/border-left:[^;]+;/, ""));
          }
        }
        const { cellText: C, cellRichStyle: I6 } = this._getCellTextAndRichText(p3, v6, r), R9 = {
          rowSpan: S,
          colSpan: w6,
          content: C,
          style: v6,
          richTextParma: {
            p: I6,
            v: C
          }
        };
        if (i.getValue(d2, g9)) {
          g9 += 1;
          continue;
        } else
          S > 1 || w6 > 1 ? V12(i, v6, R9, { colSpan: w6, rowSpan: S, rowIndex: d2, colSetValueIndex: g9 }) : i.setValue(d2, g9, R9), g9 += w6, f4++;
      }
    }
    return i;
  }
  _parseCellHtml(e, t3, r, i = /* @__PURE__ */ new Map(), o3) {
    var s2;
    for (const l4 of t3)
      if (l4.nodeType === Node.TEXT_NODE) {
        const a4 = (s2 = l4.nodeValue) == null ? void 0 : s2.replace(/[\r\n]/g, "");
        let c2;
        e && i.has(e) && (c2 = i.get(e)), r.dataStream += a4, c2 && Object.getOwnPropertyNames(c2).length && r.textRuns.push({
          st: r.dataStream.length - a4.length,
          ed: r.dataStream.length,
          ts: c2
        });
      } else {
        if (l4.nodeType === Node.COMMENT_NODE || l4.nodeName === "STYLE")
          continue;
        if (l4.nodeName.toLowerCase() === "br")
          r.paragraphs || (r.paragraphs = []), r.paragraphs.push({ startIndex: r.dataStream.length }), r.dataStream += "\r";
        else if (l4.nodeType === Node.ELEMENT_NODE) {
          const a4 = this._getStyle(l4, o3), c2 = e ? i.get(e) : {}, d2 = ah2(a4), u2 = il2(l4, d2);
          i.set(l4, __spreadValues(__spreadValues({}, c2), u2));
          const { childNodes: h9 } = l4;
          this._parseCellHtml(l4, h9, r, i, a4);
        }
      }
  }
  _getCellTextAndRichText(e, t3, r) {
    var l4;
    if (e.innerHTML.includes("mso-spacerun:yes")) {
      const a4 = e.innerHTML.replace(/<span[^>]*mso-spacerun:yes[^>]*>[\s\S]*?<\/span>/gi, ""), c2 = a1.parseNumber(a4);
      if (c2 && c2.v !== void 0 && c2.v !== null)
        return {
          cellText: a4,
          cellRichStyle: void 0
        };
    }
    let i = "", o3;
    if (/<[^>]+>/.test(e.innerHTML) && r) {
      const a4 = {
        dataStream: "",
        textRuns: []
      };
      this._parseCellHtml(null, e.childNodes, a4, void 0, t3);
      const c2 = (l4 = r.getBlankCellDocumentModel()) == null ? void 0 : l4.documentModel, d2 = c2 == null ? void 0 : c2.getSnapshot(), u2 = `${a4.dataStream}\r
`, h9 = __spreadProps(__spreadValues({}, d2), {
        body: {
          dataStream: u2,
          textRuns: a4.textRuns,
          paragraphs: Fa3(u2)
        }
      });
      c2 == null || c2.reset(h9), o3 = c2 == null ? void 0 : c2.getSnapshot(), i = a4.dataStream;
    } else
      i = H13(e.innerHTML.replace(/[\r\n]/g, ""));
    return {
      cellText: i,
      cellRichStyle: o3
    };
  }
  _generateDocumentDataModelSnapshot(e) {
    var l4;
    const t3 = this._getCurrentSkeleton();
    if (t3 == null)
      return null;
    const { skeleton: r } = t3, i = (l4 = r.getBlankCellDocumentModel()) == null ? void 0 : l4.documentModel, s2 = __spreadValues(__spreadValues({}, i == null ? void 0 : i.getSnapshot()), e);
    return i == null || i.reset(s2), i == null ? void 0 : i.getSnapshot();
  }
  process(e, t3, r, i) {
    var o3, s2, l4;
    for (const a4 of t3)
      if (a4.nodeName.toLowerCase() === "table")
        i.push({
          index: ((o3 = r == null ? void 0 : r.paragraphs) == null ? void 0 : o3.length) || 0
        });
      else if (a4.nodeType === Node.TEXT_NODE) {
        if (((s2 = a4.nodeValue) == null ? void 0 : s2.trim()) === "")
          continue;
        const c2 = (l4 = a4.nodeValue) == null ? void 0 : l4.replace(/[\r\n]/g, "");
        let d2;
        e && this._styleCache.has(e) && (d2 = this._styleCache.get(e));
        const u2 = {
          dataStream: "",
          textRuns: []
        };
        r.dataStream += c2, u2.dataStream += c2, d2 && Object.getOwnPropertyNames(d2).length && (r.textRuns.push({
          st: r.dataStream.length - c2.length,
          ed: r.dataStream.length,
          ts: d2
        }), u2.textRuns.push({
          st: r.dataStream.length - c2.length,
          ed: r.dataStream.length,
          ts: d2
        }));
      } else {
        if (hI.includes(a4.nodeName.toLowerCase()))
          continue;
        if (a4.nodeName.toLowerCase() === "br")
          r.paragraphs || (r.paragraphs = []), r.paragraphs.push({ startIndex: r.dataStream.length }), r.dataStream += "\r";
        else if (a4.nodeType === Node.ELEMENT_NODE) {
          if (a4.nodeName === "STYLE")
            continue;
          const c2 = a4, d2 = this._processBeforeLink(c2, { body: r }), u2 = e ? this._styleCache.get(e) : {}, h9 = this._styleRules.find(({ filter: p3 }) => lh2(a4, p3)), m9 = h9 ? h9.getStyle(a4) : il2(a4);
          this._styleCache.set(a4, __spreadValues(__spreadValues({}, u2), m9));
          const { childNodes: g9 } = a4;
          this.process(a4, g9, r, i);
          const f4 = this._afterProcessRules.find(
            ({ filter: p3 }) => lh2(a4, p3)
          );
          f4 && f4.handler(r, a4), this._processAfterLink(c2, { body: r }, d2);
        }
      }
  }
  _processBeforeLink(e, t3) {
    return t3.body.dataStream.length;
  }
  _processAfterLink(e, t3, r) {
    var s2, l4;
    const i = t3.body, o3 = e;
    o3.tagName.toUpperCase() === "A" && (i.customRanges = (s2 = i.customRanges) != null ? s2 : [], i.customRanges.push({
      startIndex: r,
      endIndex: i.dataStream.length - 1,
      rangeId: (l4 = o3.dataset.rangeid) != null ? l4 : et(),
      rangeType: En.HYPERLINK,
      properties: { url: o3.href }
    }));
  }
  dispose() {
    this._dom = null, this._styleCache.clear(), this._styleMap.clear();
  }
};
_2(Wl2, "_pluginList", []);
var Ci4 = Wl2;
function O1(n3) {
  const e = /<tr([\s\S]*?)>([\s\S]*?)<\/tr>/gi, t3 = n3.matchAll(e);
  if (!t3)
    return {
      rowProperties: [],
      rowCount: 0
    };
  const i = Array.from(t3).map((o3) => Om2(o3[1])).map((o3) => {
    if (!o3.height) {
      const s2 = o3.style, l4 = s2 && s2.match(/height\s*:\s*(\d+(\.\d+)?)px/);
      o3.height = `${l4 ? Number.parseInt(l4[1], 10) : PE}`;
    }
    return o3;
  });
  return {
    rowProperties: i,
    rowCount: i.length
  };
}
function ah2(n3) {
  const e = {};
  return n3.split(";").forEach((r) => {
    const [i, o3] = r.split(":");
    e[i] = o3;
  }), e;
}
function Om2(n3) {
  if (!n3)
    return {};
  const e = {}, t3 = /([\w-]+)\s*=\s*(?:(['"])([^'"]*)\2|(\S+))/g;
  let r;
  for (; (r = t3.exec(n3)) !== null; ) {
    const [, i, , o3, s2] = r, l4 = o3 !== void 0 ? o3 : s2;
    e[i] = l4;
  }
  return e;
}
function A1(n3) {
  const e = /<colgroup([\s\S]*?)>(.*?)<\/colgroup>/, t3 = n3.match(e), r = /<col([\s\S]*?)>/g;
  let i;
  if (t3 != null && t3[2] ? i = t3[2].matchAll(r) : i = n3.matchAll(r), !i)
    return null;
  const o3 = Array.from(i).map((l4) => Om2(l4[1])), s2 = [];
  return o3.forEach((l4) => {
    const a4 = Number(l4.span);
    if (a4)
      for (let c2 = 0; c2 < a4; c2++) {
        const d2 = __spreadValues({}, l4);
        delete d2.span, s2.push(d2);
      }
    else
      s2.push(l4);
  }), s2;
}
function H13(n3) {
  const e = {
    "&lt;": "<",
    "&gt;": ">",
    "&amp;": "&",
    "&quot;": '"',
    "&#39;": "'",
    "&nbsp;": " "
  };
  return n3.replace(/&lt;|&gt;|&amp;|&quot;|&#39;|&nbsp;|<br>/g, (t3) => e[t3]);
}
function ch2(n3, e) {
  if (!n3 || !e) return null;
  const t3 = new RegExp(`(${e}\\s*:\\s*[^;]+);`, "i"), r = n3.match(t3);
  return r ? r[1] : null;
}
function V12(n3, e, t3, r) {
  const { rowSpan: i, colSpan: o3, rowIndex: s2, colSetValueIndex: l4 } = r;
  for (let a4 = s2; a4 < s2 + i; a4++)
    for (let c2 = l4; c2 < l4 + o3; c2++)
      a4 === s2 && c2 === l4 ? n3.setValue(a4, c2, __spreadProps(__spreadValues({}, t3), { style: e })) : n3.setValue(a4, c2, { style: e });
}
var N12 = {
  name: "univer-doc-paste-plugin-lark",
  checkPasteType(n3) {
    return /lark-record-clipboard/i.test(n3);
  },
  // TODO: @JOCS, support inline code copy from lark.
  stylesRules: [
    {
      filter: ["s"],
      getStyle(n3) {
        const e = il2(n3);
        return __spreadValues({
          st: {
            s: ie.TRUE
          }
        }, e);
      }
    }
  ],
  afterProcessRules: [
    {
      filter(n3) {
        return n3.tagName === "DIV" && /ace-line/i.test(n3.className);
      },
      handler(n3) {
        n3.paragraphs == null && (n3.paragraphs = []), n3.paragraphs.push({
          startIndex: n3.dataStream.length
        }), n3.dataStream += "\r";
      }
    }
  ]
};
var k12 = {
  name: "univer-doc-paste-plugin-univer",
  checkPasteType(n3) {
    return /UniverNormal/i.test(n3);
  },
  stylesRules: [],
  afterProcessRules: [
    {
      filter(n3) {
        return n3.tagName === "P" && /UniverNormal/i.test(n3.className);
      },
      handler(n3, e) {
        n3.paragraphs == null && (n3.paragraphs = []);
        const t3 = {
          startIndex: n3.dataStream.length
        }, r = xm(e);
        r && (t3.paragraphStyle = r), n3.paragraphs.push(t3), n3.dataStream += "\r";
      }
    }
  ]
};
var D1 = {
  name: "univer-doc-paste-plugin-word",
  checkPasteType(n3) {
    return /word|mso/i.test(n3);
  },
  stylesRules: [
    {
      filter: ["b"],
      getStyle(n3) {
        const e = il2(n3);
        return __spreadValues({ bl: ie.TRUE }, e);
      }
    }
  ],
  afterProcessRules: [
    {
      filter(n3) {
        return n3.tagName === "P" && /mso/i.test(n3.className);
      },
      handler(n3, e) {
        n3.paragraphs == null && (n3.paragraphs = []);
        const t3 = {
          startIndex: n3.dataStream.length
        }, r = xm(e);
        r && (t3.paragraphStyle = r), n3.paragraphs.push(t3), n3.dataStream += "\r";
      }
    }
  ]
};
var jn4 = ((n3) => (n3.COPY = "COPY", n3.CUT = "CUT", n3))(jn4 || {});
function L1(n3, e, t3, r, i) {
  const o3 = t3.map((c2) => {
    var d2;
    return (d2 = c2.onCopyRow) == null ? void 0 : d2.call(c2, n3);
  }).filter((c2) => !!c2), s2 = qd3(o3), l4 = Qd3(s2), a4 = e.map((c2) => {
    if (!i.has(`${n3}-${c2}`)) {
      const d2 = r.getValue(n3, c2);
      if (d2 != null && d2.rowSpan && (d2 != null && d2.colSpan))
        for (let u2 = n3; u2 < n3 + d2.rowSpan; u2++)
          for (let h9 = c2; h9 < c2 + d2.colSpan; h9++)
            i.add(`${u2}-${h9}`);
      return W12(n3, c2, t3, r);
    }
    return null;
  }).filter((c2) => !!c2).join("");
  return `<tr${l4}>${a4}</tr>`;
}
function W12(n3, e, t3, r) {
  const i = r.getValue(n3, e), o3 = t3.map((c2) => {
    var d2;
    return (d2 = c2.onCopyCellStyle) == null ? void 0 : d2.call(c2, n3, e, i == null ? void 0 : i.rowSpan, i == null ? void 0 : i.colSpan);
  }).filter((c2) => !!c2), s2 = qd3(o3), l4 = Qd3(s2), a4 = t3.reduce((c2, d2) => {
    var u2;
    return c2 || ((u2 = d2.onCopyCellContent) == null ? void 0 : u2.call(d2, n3, e)) || "";
  }, "");
  return `<td${l4}>${a4}</td>`;
}
function B13(n3, e) {
  return `<colgroup>${n3.map((r) => {
    const i = e.map((l4) => {
      var a4;
      return (a4 = l4.onCopyColumn) == null ? void 0 : a4.call(l4, r);
    }).filter((l4) => !!l4), o3 = qd3(i);
    return `<col ${Qd3(o3)} />`;
  }).join("")}</colgroup>`;
}
function qd3(n3) {
  return n3.reduce((e, t3) => (Object.keys(t3).forEach((i) => {
    e[i] ? e[i] += `;${t3[i]}` : e[i] = t3[i];
  }), e), {});
}
function Qd3(n3) {
  return Object.keys(n3).reduce((e, t3) => `${e} ${t3}="${n3[t3]}"`, "");
}
var F12 = class {
  convert(e, t3, r) {
    const { cols: i, rows: o3 } = t3;
    if (!i.length)
      return "";
    const s2 = B13(i, r), l4 = [], a4 = /* @__PURE__ */ new Set();
    return o3.forEach((d2) => {
      l4.push(L1(d2, i, r, e, a4));
    }), `<google-sheets-html-origin><table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" cellpadding="0" dir="ltr" style="table-layout:fixed;font-size:10pt;font-family:Arial;width:0px;border-collapse:collapse;border:none">${s2}
<tbody>${l4.join("")}</tbody></table>`;
  }
};
var hM = (n3, e, t3 = false) => {
  const r = (u2) => u2.endRow - u2.startRow + 1, i = (u2) => u2.endColumn - u2.startColumn + 1, o3 = r(e) % r(n3), s2 = i(e) % i(n3), l4 = {
    startRow: 0,
    endRow: r(n3) - 1,
    startColumn: 0,
    endColumn: i(n3) - 1
  }, a4 = Math.floor(r(e) / r(n3)), c2 = Math.floor(i(e) / i(n3)), d2 = [];
  if (!o3 && !s2)
    for (let u2 = 1; u2 <= a4; u2++)
      for (let h9 = 1; h9 <= c2; h9++) {
        const m9 = r(n3) * (u2 - 1), g9 = i(n3) * (h9 - 1), f4 = {
          startRow: m9 + e.startRow,
          endRow: m9 + e.startRow,
          startColumn: g9 + e.startColumn,
          endColumn: g9 + e.startColumn
        };
        d2.push({ repeatRelativeRange: l4, startRange: f4 });
      }
  else if (!o3 && s2 && !t3)
    for (let u2 = 1; u2 <= a4; u2++) {
      const h9 = r(n3) * (u2 - 1), m9 = 0, g9 = {
        startRow: h9 + e.startRow,
        endRow: h9 + e.startRow,
        startColumn: m9 + e.startColumn,
        endColumn: m9 + e.startColumn
      };
      d2.push({ repeatRelativeRange: l4, startRange: g9 });
    }
  else if (o3 && !s2 && !t3)
    for (let u2 = 1; u2 <= c2; u2++) {
      const m9 = i(n3) * (u2 - 1), g9 = {
        startRow: 0 + e.startRow,
        endRow: 0 + e.startRow,
        startColumn: m9 + e.startColumn,
        endColumn: m9 + e.startColumn
      };
      d2.push({ repeatRelativeRange: l4, startRange: g9 });
    }
  else {
    const u2 = {
      startRow: e.startRow,
      endRow: e.startRow,
      startColumn: e.startColumn,
      endColumn: e.startColumn
    };
    d2.push({ startRange: u2, repeatRelativeRange: l4 });
  }
  return d2;
};
function dh2(n3) {
  return n3 ? [
    // Excel class names
    /<td[^>]*class=".*?xl.*?"[^>]*>/i,
    // Excel namespace
    /xmlns:x="urn:schemas-microsoft-com:office:excel"/i,
    // Excel ProgID
    /ProgId="Excel.Sheet"/i,
    // Office specific namespace
    /xmlns:o="urn:schemas-microsoft-com:office:office"/i,
    // Excel specific style markers
    /@mso-|mso-excel/i,
    // Excel workbook metadata
    /<x:ExcelWorkbook>/i
  ].some((t3) => t3.test(n3)) : false;
}
function U1(n3) {
  if (!n3)
    return false;
  const e = /<img[^>]*src\s*=\s*["']data:image\/[^;]+;base64,[^"']*["'][^>]*>/i;
  return (n3.match(e) || []).length > 0;
}
function X1(...n3) {
  if (n3.length === 1)
    return n3[0];
  const e = new ht();
  return n3.forEach((t3) => {
    t3 && new ht(t3).forValue((i, o3, s2) => {
      e.setValue(i, o3, __spreadValues(__spreadValues({}, e.getValue(i, o3)), s2));
    });
  }), e.getMatrix();
}
function z1(n3, e) {
  return n3.id === e.id && n3.params.unitId === e.params.unitId && n3.params.subUnitId === e.params.subUnitId;
}
function uh2(n3) {
  const e = [];
  for (let t3 = 0; t3 < n3.length; ) {
    let r = 1;
    if (n3[t3].id === ee2.id) {
      const i = n3[t3], o3 = [i];
      for (; t3 + r < n3.length && z1(i, n3[t3 + r]); )
        o3.push(n3[t3 + r]), r += 1;
      const s2 = X1(...o3.map((l4) => l4.params.cellValue || {}));
      e.push(__spreadProps(__spreadValues({}, i), {
        params: __spreadProps(__spreadValues({}, i.params), {
          cellValue: s2
        })
      }));
    } else
      e.push(n3[t3]);
    t3 += r;
  }
  return e;
}
function hh2(n3, e = {}) {
  const { maxCellsPerChunk: t3 = 2500, threshold: r = 6e3, maxChunks: i = 10 } = e;
  if (n3.id !== ee2.id)
    return [n3];
  const { cellValue: o3 } = n3.params;
  if (!o3)
    return [n3];
  const s2 = new ht(o3);
  let l4 = 0, a4 = 1 / 0, c2 = -1 / 0, d2 = 1 / 0, u2 = -1 / 0;
  if (s2.forValue((v6, S) => {
    l4++, a4 = Math.min(a4, v6), c2 = Math.max(c2, v6), d2 = Math.min(d2, S), u2 = Math.max(u2, S);
  }), a4 === 1 / 0 || l4 <= r)
    return [n3];
  const h9 = [], m9 = u2 - d2 + 1;
  let g9 = Math.max(1, Math.floor(t3 / m9));
  const f4 = c2 - a4 + 1;
  Math.ceil(f4 / g9) > i && (g9 = Math.ceil(f4 / i));
  for (let v6 = a4; v6 <= c2; v6 += g9) {
    const S = Math.min(v6 + g9 - 1, c2), w6 = new ht();
    let C = false;
    for (let I6 = v6; I6 <= S; I6++)
      for (let R9 = d2; R9 <= u2; R9++) {
        const y6 = s2.getValue(I6, R9);
        y6 !== void 0 && (w6.setValue(I6, R9, y6), C = true);
      }
    C && h9.push(__spreadProps(__spreadValues({}, n3), {
      params: __spreadProps(__spreadValues({}, n3.params), {
        cellValue: w6.getMatrix(),
        __splitChunk__: true
      })
    }));
  }
  return h9.length > 0 ? h9 : [n3];
}
function Ua2(n3, e) {
  const { startRow: t3, endRow: r, startColumn: i, endColumn: o3 } = n3;
  for (let s2 = t3; s2 <= r; s2++)
    for (let l4 = i; l4 <= o3; l4++)
      if (e.rows.includes(s2) && e.cols.includes(l4))
        return true;
}
function gh2(n3, e) {
  const { startRow: t3, endRow: r, startColumn: i, endColumn: o3 } = e;
  for (let s2 = t3; s2 <= r; s2++)
    if (!n3.rows.includes(s2))
      return false;
  for (let s2 = i; s2 <= o3; s2++)
    if (!n3.cols.includes(s2))
      return false;
  return true;
}
function j12(n3) {
  const e = n3.trim().split(`
`);
  let t3 = "<table>";
  return e.forEach((r) => {
    const i = r.split("	");
    t3 += "<tr>", i.forEach((o3) => {
      t3 += `<td>${o3}</td>`;
    }), t3 += "</tr>";
  }), t3 += "</table>", t3;
}
var Y13 = Object.getOwnPropertyDescriptor;
var Z12 = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? Y13(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var xt3 = (n3, e) => (t3, r) => e(t3, r, n3);
var et4 = {
  DEFAULT_COPY: "default-copy",
  DEFAULT_PASTE: "default-paste",
  SPECIAL_PASTE_VALUE: "special-paste-value",
  SPECIAL_PASTE_FORMAT: "special-paste-format",
  SPECIAL_PASTE_COL_WIDTH: "special-paste-col-width",
  SPECIAL_PASTE_BESIDES_BORDER: "special-paste-besides-border",
  SPECIAL_PASTE_FORMULA: "special-paste-formula"
};
var G1 = {
  [Fo]: "png",
  [ko]: "jpg",
  [Uo]: "webp",
  [jo]: "bmp"
};
Ci4.use(D1);
Ci4.use(N12);
Ci4.use(k12);
var tn3 = createIdentifier("sheet.clipboard-service");
var ol2 = class extends Ve {
  constructor(e, t3, r, i, o3, s2, l4, a4, c2, d2, u2, h9, m9, g9) {
    super();
    _2(this, "_clipboardHooks", []);
    _2(this, "_clipboardHooks$", new BehaviorSubject([]));
    _2(this, "clipboardHooks$", this._clipboardHooks$.asObservable());
    _2(this, "_htmlToUSM");
    _2(this, "_usmToHtml");
    _2(this, "_copyContentCache");
    _2(this, "_copyMarkId", null);
    _2(this, "_pasteOptionsCache$", new BehaviorSubject(null));
    _2(this, "pasteOptionsCache$", this._pasteOptionsCache$.asObservable());
    _2(this, "_showMenu$", new BehaviorSubject(false));
    _2(this, "showMenu$", this._showMenu$.asObservable());
    this._logService = e, this._univerInstanceService = t3, this._selectionManagerService = r, this._clipboardInterfaceService = i, this._undoRedoService = o3, this._commandService = s2, this._markSelectionService = l4, this._notificationService = a4, this._platformService = c2, this._renderManagerService = d2, this._themeService = u2, this._localeService = h9, this._errorService = m9, this._injector = g9, this._htmlToUSM = new Ci4({
      getCurrentSkeleton: () => {
        var f4;
        return (f4 = fA(
          we.UNIVER_SHEET,
          he2,
          this._univerInstanceService,
          this._renderManagerService
        )) == null ? void 0 : f4.getCurrentParam();
      }
    }), this._usmToHtml = new F12(), this._copyContentCache = new T1(), this.disposeWithMe(this._htmlToUSM), this._initUnitDisposed();
  }
  setShowMenu(e) {
    this._showMenu$.next(e);
  }
  getPasteMenuVisible() {
    return this._showMenu$.getValue();
  }
  getPasteOptionsCache() {
    return this._pasteOptionsCache$.getValue();
  }
  copyContentCache() {
    return this._copyContentCache;
  }
  generateCopyContent(e, t3, r, i = jn4.COPY) {
    const o3 = this._clipboardHooks;
    o3.forEach((l4) => {
      var a4;
      return (a4 = l4.onBeforeCopy) == null ? void 0 : a4.call(l4, e, t3, r, i);
    });
    const s2 = this._generateCopyContent(e, t3, r, this._clipboardHooks);
    return o3.forEach((l4) => {
      var a4;
      return (a4 = l4.onAfterCopy) == null ? void 0 : a4.call(l4);
    }), s2;
  }
  copy() {
    return __async(this, arguments, function* (e = jn4.COPY) {
      const t3 = this._selectionManagerService.getCurrentLastSelection();
      if (!t3)
        return false;
      const r = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET), i = r.getActiveSheet();
      if (!i)
        return false;
      const o3 = r.getUnitId(), s2 = i.getSheetId(), l4 = this.generateCopyContent(o3, s2, t3.range, e);
      if (!l4)
        return false;
      const { html: a4, plain: c2, matrixFragment: d2, copyId: u2, discreteRange: h9 } = l4;
      this._copyContentCache.set(u2, {
        unitId: r.getUnitId(),
        subUnitId: i.getSheetId(),
        range: h9,
        matrix: d2,
        copyType: e
      }), yield this._clipboardInterfaceService.write(c2, a4), this._markSelectionService.removeAllShapes();
      const m9 = Pm(this._themeService);
      return this._copyMarkId = this._markSelectionService.addShape(__spreadProps(__spreadValues({}, t3), { style: m9 })), true;
    });
  }
  cut() {
    return __async(this, null, function* () {
      return this.copy(jn4.CUT);
    });
  }
  paste(_02) {
    return __async(this, arguments, function* (e, t3 = et4.DEFAULT_PASTE) {
      const r = e.types, i = r.indexOf(Kt) !== -1 ? yield e.getType(Kt).then((a4) => a4 && a4.text()) : "", o3 = r.indexOf(e9) !== -1 ? yield e.getType(e9).then((a4) => a4 && a4.text()) : "", s2 = r.findIndex((a4) => c7.has(a4)), l4 = s2 === -1 || !U1(o3);
      if (o3 && l4)
        return this._platformService.isWindows && dh2(o3) && this._notificationService.show({
          type: "warning",
          title: this._localeService.t("clipboard.shortCutNotify.title"),
          content: this._localeService.t("clipboard.shortCutNotify.useShortCutInstead")
        }), this._pasteHTML(o3, t3);
      if (s2 !== -1) {
        const a4 = r[s2], c2 = yield e.getType(a4);
        if (c2) {
          const d2 = G1[a4], u2 = new File(
            [c2],
            `clipboard-image.${d2}`,
            { type: a4 }
          );
          return this._pasteFiles([u2], t3);
        }
      }
      return i ? this._pastePlainText(i, t3) : (this._logService.error("[SheetClipboardService]", "No valid data on clipboard"), false);
    });
  }
  legacyPaste(e, t3, r) {
    return __async(this, null, function* () {
      const i = dh2(e != null ? e : "");
      return r && !i ? this._pasteFiles(r, et4.DEFAULT_PASTE) : e ? this._pasteHTML(e, et4.DEFAULT_PASTE) : t3 ? /[\n\t]/.test(t3) ? this._pasteHTML(j12(t3), et4.DEFAULT_PASTE) : this._pastePlainText(t3, et4.DEFAULT_PASTE) : this._pasteUnrecognized();
    });
  }
  rePasteWithPasteType(e) {
    const t3 = this._pasteOptionsCache$.getValue();
    if (!t3)
      return false;
    const r = this._injector.get(ra), i = r.pitchTopUndoElement();
    i && po(i.undoMutations, this._commandService) && r.popUndoToRedo();
    const { cellMatrix: o3, rowProperties: s2 = [], colProperties: l4 = [], source: a4, target: c2 } = t3;
    return this._pasteUSM({
      cellMatrix: o3,
      colProperties: l4,
      rowProperties: s2
    }, c2, et4[e], a4), true;
  }
  updatePasteOptionsCache(e) {
    this._pasteOptionsCache$.next(e);
  }
  addClipboardHook(e) {
    if (this._clipboardHooks.findIndex((r) => r.id === e.id) !== -1)
      return this._logService.error("[SheetClipboardService]", "hook already exists", e.id), { dispose: () => {
      } };
    const t3 = this._clipboardHooks.findIndex((r) => {
      const i = r.priority || 0;
      return (e.priority || 0) < i;
    });
    return this._clipboardHooks.splice(t3 !== -1 ? t3 : this._clipboardHooks.length, 0, e), this._notifyClipboardHook(), Be(() => {
      const r = this._clipboardHooks.indexOf(e);
      r > -1 && (this._clipboardHooks.splice(r, 1), this._notifyClipboardHook());
    });
  }
  getClipboardHooks() {
    return this._clipboardHooks;
  }
  _generateCopyContent(e, t3, r, i) {
    const o3 = this._univerInstanceService.getUniverSheetInstance(e), s2 = o3 == null ? void 0 : o3.getSheetBySheetId(t3);
    if (!o3 || !s2)
      return null;
    const l4 = i.reduce((C, I6) => {
      var y6;
      const R9 = (y6 = I6.getFilteredOutRows) == null ? void 0 : y6.call(I6, r);
      return R9 == null || R9.forEach((E3) => C.add(E3)), C;
    }, /* @__PURE__ */ new Set()), { startColumn: a4, startRow: c2, endColumn: d2, endRow: u2 } = r, h9 = s2.getMatrixWithMergedCells(c2, a4, u2, d2, ar.Both), m9 = new ht();
    let g9 = c2;
    const f4 = new ht(), p3 = { rows: [], cols: [] };
    for (let C = c2; C <= u2; C++)
      if (!l4.has(C)) {
        p3.rows.push(C);
        for (let I6 = a4; I6 <= d2; I6++) {
          const R9 = h9.getValue(C, I6);
          if (R9) {
            const y6 = eI(R9);
            f4.setValue(g9 - c2, I6 - a4, __spreadValues(__spreadValues({}, Ji4()), y6)), delete y6.displayV, m9.setValue(g9 - c2, I6 - a4, __spreadValues(__spreadValues({}, Ji4()), y6));
          } else
            f4.setValue(g9 - c2, I6 - a4, Ji4()), m9.setValue(g9 - c2, I6 - a4, Ji4()), h9.setValue(C, I6, Ji4());
        }
        g9 += 1;
      }
    for (let C = a4; C <= d2; C++)
      p3.cols.push(C);
    let v6 = this._usmToHtml.convert(h9, p3, i);
    const S = q12(f4), w6 = M12();
    return v6 = v6.replace(/(<[a-z]+)/, (C, I6) => `${I6} data-copy-id="${w6}"`), {
      copyId: w6,
      plain: S,
      html: v6,
      matrixFragment: m9,
      discreteRange: p3
    };
  }
  _notifyClipboardHook() {
    this._clipboardHooks$.next(this._clipboardHooks);
  }
  _executePaste(e) {
    return __async(this, null, function* () {
      const t3 = this._getPastingTarget();
      if (!t3.subUnitId || !t3.selection)
        return false;
      const r = this._injector.invoke((h9) => Du(t3.selection.range, h9, t3.unitId, t3.subUnitId));
      if (!r)
        return false;
      const { unitId: i, subUnitId: o3 } = t3, s2 = this._clipboardHooks, l4 = [];
      if (s2.some(
        (h9) => {
          var m9;
          return l4.push(h9) && ((m9 = h9.onBeforePaste) == null ? void 0 : m9.call(h9, { unitId: i, subUnitId: o3, range: r })) === false;
        }
      ))
        return l4.forEach((h9) => {
          var m9;
          return (m9 = h9.onAfterPaste) == null ? void 0 : m9.call(h9, false);
        }), false;
      const c2 = [], d2 = [];
      l4.forEach((h9) => {
        const m9 = e(h9, {
          unitId: i,
          subUnitId: o3,
          range: r
        });
        m9 && (c2.push(...m9.redos), d2.push(...m9.undos));
      });
      const u2 = c2.every((h9) => this._commandService.executeCommand(h9.id, h9.params));
      return u2 && this._undoRedoService.pushUndoRedo({
        unitID: this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET).getUnitId(),
        undoMutations: d2,
        redoMutations: c2
      }), u2;
    });
  }
  _pasteFiles(e, t3) {
    return __async(this, null, function* () {
      return this._executePaste((r, i) => {
        var o3;
        return (o3 = r.onPasteFiles) == null ? void 0 : o3.call(r, i, e, { pasteType: t3 });
      });
    });
  }
  _pastePlainText(e, t3) {
    return __async(this, null, function* () {
      return this._executePaste((r, i) => {
        var o3;
        return (o3 = r.onPastePlainText) == null ? void 0 : o3.call(r, i, e, { pasteType: t3 });
      });
    });
  }
  _pasteUnrecognized() {
    return this._executePaste((e, t3) => {
      var r;
      return (r = e.onPasteUnrecognized) == null ? void 0 : r.call(e, t3);
    });
  }
  _pasteHTML(e, t3) {
    return __async(this, null, function* () {
      const r = E1(e);
      return r && this._copyContentCache.get(r) ? this._pasteInternal(r, t3) : this._pasteExternal(e, t3);
    });
  }
  _pasteExternal(e, t3) {
    return __async(this, null, function* () {
      var d2;
      const { rowProperties: r, colProperties: i, cellMatrix: o3 } = this._htmlToUSM.convert(e);
      if (!o3)
        return false;
      const s2 = this._getPastedRange(o3);
      if (!s2)
        return false;
      const l4 = (d2 = this._univerInstanceService.getUniverSheetInstance(s2.unitId)) == null ? void 0 : d2.getSheetBySheetId(s2.subUnitId);
      if (!l4)
        return false;
      const a4 = l4 == null ? void 0 : l4.getMergeData();
      return a4.length && a4.some((h9) => Ua2(h9, s2.pastedRange) && !gh2(s2.pastedRange, h9)) ? (this._errorService.emit(this._localeService.t("clipboard.paste.overlappingMergedCells")), false) : this._pasteUSM(
        {
          rowProperties: r,
          colProperties: i,
          cellMatrix: o3
        },
        s2,
        t3
      );
    });
  }
  // eslint-disable-next-line max-lines-per-function
  _pasteInternal(e, t3) {
    return __async(this, null, function* () {
      var I6, R9;
      const r = this._copyContentCache.get(e), { range: i, matrix: o3, unitId: s2, subUnitId: l4 } = r || {};
      if (!o3 || !r || !i || !s2 || !l4)
        return false;
      const { mapFunc: a4 } = wr4([i]), c2 = (I6 = this._univerInstanceService.getUniverSheetInstance(s2)) == null ? void 0 : I6.getSheetBySheetId(l4), d2 = new ht();
      o3.forValue((y6, E3, M10) => {
        const { row: T10, col: P8 } = a4(y6, E3), A4 = c2 == null ? void 0 : c2.getComposedCellStyle(T10, P8), x7 = R1(M10);
        if (x7.s = A4, d2.setValue(y6, E3, x7), M10.colSpan || M10.rowSpan)
          for (let H6 = 0; H6 < M10.rowSpan; H6++)
            for (let V7 = 0; V7 < M10.colSpan; V7++) {
              if (H6 === 0 && V7 === 0) continue;
              const D5 = y6 + H6, B5 = E3 + V7;
              d2.setValue(D5, B5, { s: A4 });
            }
      });
      const u2 = this._getPastedRange(d2);
      if (!u2) return false;
      const h9 = (R9 = this._univerInstanceService.getUniverSheetInstance(u2.unitId)) == null ? void 0 : R9.getSheetBySheetId(u2.subUnitId);
      if (!h9)
        return false;
      const m9 = h9 == null ? void 0 : h9.getMergeData();
      if (m9 && m9.some((E3) => Ua2(E3, u2.pastedRange) && !gh2(u2.pastedRange, E3)))
        return this._errorService.emit(this._localeService.t("clipboard.paste.overlappingMergedCells")), false;
      const g9 = this._univerInstanceService.getUnit(s2);
      if (!g9) return false;
      const f4 = g9.getSheetBySheetId(l4);
      if (!f4) return false;
      const p3 = f4.getColumnManager(), v6 = f4.getRowManager(), S = [], w6 = [];
      if (i.cols.forEach((y6) => {
        S.push({ width: `${p3.getColumnWidth(y6)}` });
      }), i.rows.forEach((y6) => {
        w6.push({ height: `${v6.getRowHeight(y6)}` });
      }), r.copyType === jn4.CUT) {
        const y6 = u2.pastedRange.rows[0], E3 = i.rows[i.rows.length - 1] - i.rows[0] + y6;
        u2.pastedRange.rows = Array.from(new Array(E3 + 1).keys()).slice(y6);
      }
      const C = this._pasteUSM(
        {
          cellMatrix: d2,
          colProperties: S,
          rowProperties: w6
        },
        // paste data
        u2,
        t3,
        {
          range: i,
          // paste source
          unitId: r.unitId,
          subUnitId: r.subUnitId,
          copyType: r.copyType,
          copyId: e
        }
      );
      return r.copyType === jn4.CUT && (this._copyContentCache.set(e, __spreadProps(__spreadValues({}, r), { matrix: null })), this._copyMarkId && this._markSelectionService.removeShape(this._copyMarkId), this._copyMarkId = null), C;
    });
  }
  // eslint-disable-next-line max-lines-per-function
  _pasteUSM(e, t3, r, i) {
    const { rowProperties: o3, colProperties: s2, cellMatrix: l4 } = e, { unitId: a4, subUnitId: c2, pastedRange: d2 } = t3, u2 = d2.cols.length, h9 = this._clipboardHooks, m9 = [];
    if (h9.some(
      (R9) => {
        var y6;
        return m9.push(R9) && ((y6 = R9.onBeforePaste) == null ? void 0 : y6.call(R9, { unitId: a4, subUnitId: c2, range: d2 })) === false;
      }
    ))
      return m9.forEach((R9) => {
        var y6;
        return (y6 = R9.onAfterPaste) == null ? void 0 : y6.call(R9, false);
      }), false;
    if (!l4) return false;
    const f4 = i ? {
      unitId: i.unitId,
      subUnitId: i.subUnitId,
      range: i.range
    } : null, p3 = {
      copyType: (i == null ? void 0 : i.copyType) || jn4.COPY,
      copyId: i == null ? void 0 : i.copyId,
      pasteType: r
    };
    let v6 = [], S = [];
    const w6 = m9.filter(
      (R9) => !R9.specialPasteInfo && R9.id !== et4.DEFAULT_PASTE || r === R9.id
    );
    w6.forEach((R9) => {
      var M10, T10, P8;
      if (o3) {
        const A4 = (M10 = R9.onPasteRows) == null ? void 0 : M10.call(R9, { range: d2, unitId: a4, subUnitId: c2 }, o3, {
          pasteType: r
        });
        A4 && (v6.push(...A4.redos), S.push(...A4.undos));
      }
      const y6 = (T10 = R9.onPasteColumns) == null ? void 0 : T10.call(
        R9,
        { range: d2, unitId: a4, subUnitId: c2 },
        s2 || new Array(u2).map(() => ({})),
        { pasteType: r }
      );
      y6 && (v6.push(...y6.redos), S.push(...y6.undos));
      const E3 = (P8 = R9.onPasteCells) == null ? void 0 : P8.call(
        R9,
        f4,
        { range: d2, unitId: a4, subUnitId: c2 },
        l4,
        p3
      );
      E3 && (v6.push(...E3.redos), S.push(...E3.undos));
    });
    const C = this._getSetSelectionOperation(a4, c2, d2, l4, r);
    C && v6.push(C), v6 = uh2(v6), S = uh2(S), v6 = v6.flatMap(
      (R9) => hh2(R9, {
        threshold: 2e4,
        maxCellsPerChunk: 1e4
      })
    ), S = S.flatMap(
      (R9) => hh2(R9, {
        threshold: 2e4,
        maxCellsPerChunk: 1e4
      })
    ), S.push({ id: pn.id, params: { unitId: t3.unitId, subUnitId: t3.subUnitId } }), this._logService.log("[SheetClipboardService]", "pasting mutations", {
      undoMutationsInfo: S,
      redoMutationsInfo: v6
    });
    const I6 = v6.every((R9) => this._commandService.syncExecuteCommand(R9.id, R9.params));
    return I6 && (this._undoRedoService.pushUndoRedo({
      unitID: a4,
      undoMutations: S,
      redoMutations: v6
    }), this.updatePasteOptionsCache({
      target: {
        pastedRange: d2,
        unitId: a4,
        subUnitId: c2
      },
      cellMatrix: l4,
      rowProperties: o3,
      colProperties: s2,
      pasteType: r,
      source: i
    }), this.setShowMenu(true)), w6.forEach((R9) => {
      var y6;
      return (y6 = R9.onAfterPaste) == null ? void 0 : y6.call(R9, I6);
    }), I6;
  }
  _getSetSelectionOperation(e, t3, r, i, o3) {
    var C;
    const s2 = (C = this._univerInstanceService.getUniverSheetInstance(e)) == null ? void 0 : C.getSheetBySheetId(t3);
    if (!s2)
      return null;
    const { rows: l4, cols: a4 } = r, c2 = l4[0], d2 = a4[0], u2 = l4[l4.length - 1], h9 = a4[a4.length - 1], g9 = _e3({
      startRow: c2,
      endRow: c2,
      startColumn: d2,
      endColumn: d2
    }, s2), f4 = i.getValue(0, 0), p3 = (f4 == null ? void 0 : f4.rowSpan) || 1, v6 = (f4 == null ? void 0 : f4.colSpan) || 1;
    if ((o3 === et4.DEFAULT_PASTE || o3 === et4.SPECIAL_PASTE_BESIDES_BORDER || o3 === et4.SPECIAL_PASTE_FORMAT) && (p3 > 1 || v6 > 1)) {
      const I6 = {
        startRow: c2,
        endRow: c2 + p3 - 1,
        startColumn: d2,
        endColumn: d2 + v6 - 1
      };
      g9.startRow = I6.startRow, g9.endRow = I6.endRow, g9.startColumn = I6.startColumn, g9.endColumn = I6.endColumn, g9.isMerged = true, g9.isMergedMainCell = true;
    }
    const w6 = {
      unitId: e,
      subUnitId: t3,
      selections: [{
        range: {
          startRow: c2,
          endRow: u2,
          startColumn: d2,
          endColumn: h9
        },
        primary: g9,
        style: null
      }]
    };
    return {
      id: ie5.id,
      params: w6
    };
  }
  _getPastingTarget() {
    const e = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET), t3 = e.getActiveSheet(), r = this._selectionManagerService.getCurrentLastSelection();
    return {
      unitId: e.getUnitId(),
      subUnitId: t3 == null ? void 0 : t3.getSheetId(),
      selection: r
    };
  }
  /**
   * Handles copying one range to another range, obtained by the following rules
   *
   * [Content to be assigned] => [Target range]
   *
   * I. There are no merged cells in the upper left corner of the pasted area
   *
   * 1. 1 -> 1: 1 => 1
   * 2. N -> 1: N => N
   * 3. 1 -> N: N => N
   * 4. N1 -> N2:
   *     1) N1 <N2: If N2 is a multiple of N1 (X), N1 * X => N2; If not, N1 => N1 (refer to office excel, different from google sheet)
   *     2) N1> N2: N1 => N1
   *
   * The above four cases can be combined and processed as
   *
   * Case 1, 1/2/4-2 merged into N1 => N1
   * Case 2, 3/4-1 merge into N1 * X => N2 or Case 1
   *
   * In the end we only need to judge whether N2 is a multiple of N1
   *
   * II. The pasted area contains merged cells
   *
   * 1. If N2 is a multiple of N1,
   *   1) If N2 === N1, paste this area directly and the range remains unchanged.
   *   2) Otherwise, determine whether other cells are included
   *     1] If included, tile, the range remains unchanged
   *     2] If not included, determine whether the source data is a combined cell
   *       1} If yes, tile, the range remains unchanged
   *       2} If not, only the content will be pasted, the original style will be discarded, and the scope will remain unchanged.
   *
   * 2. If N2 is not a multiple of N1, determine whether the upper left corner cell (merged or non-merged or combined) is consistent with the size of the original data.
   *   1) If consistent, only paste this area;
   *   2) If inconsistent, then determine whether the pasted area contains other cells.
   *     1] If yes, pasting is not allowed and an error will pop up;
   *     2] If not, only the content will be pasted and the original style will be discarded.
   *
   * @param rowCount
   * @param colCount
   * @param cellMatrix
   * @param range
   */
  // eslint-disable-next-line max-lines-per-function, complexity
  _transformPastedData(e, t3, r) {
    const i = this._getPastingTarget(), { selection: o3, unitId: s2, subUnitId: l4 } = i;
    if (!l4 || !o3)
      return null;
    const a4 = this._injector.invoke((T10) => Du(o3.range, T10, s2, l4));
    if (!a4)
      return null;
    const { ranges: [c2], mapFunc: d2 } = wr4([a4]), { startRow: u2, startColumn: h9, endRow: m9, endColumn: g9 } = c2, f4 = m9 - u2 + 1, p3 = g9 - h9 + 1, v6 = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET), S = v6 == null ? void 0 : v6.getActiveSheet();
    if (!S)
      return null;
    const C = S.getMergeData().filter(
      (T10) => a4.rows.includes(T10.startRow) && a4.cols.includes(T10.startColumn)
    ), I6 = C[0];
    let R9 = 0, y6 = 0, E3 = 0, M10 = 0;
    if (I6 && (R9 = I6.startRow, y6 = I6.startColumn, E3 = I6.endRow, M10 = I6.endColumn), f4 % e === 0 && p3 % t3 === 0)
      if (C.length > 0 && (f4 !== e || p3 !== t3))
        if (R9 === a4.rows[0] && y6 === a4.cols[0] && E3 === a4.rows[f4 - 1] && M10 === a4.cols[p3 - 1])
          if ($12(r))
            for (let P8 = 0; P8 < f4; P8++)
              for (let A4 = 0; A4 < p3; A4++) {
                const x7 = r.getValue(P8 % e, A4 % t3);
                x7 && r.setValue(P8, A4, x7);
              }
          else
            r.forValue((P8, A4, x7) => {
              x7.s = null, delete x7.colSpan, delete x7.rowSpan;
            });
        else
          for (let T10 = 0; T10 < f4; T10++)
            for (let P8 = 0; P8 < p3; P8++) {
              const A4 = r.getValue(T10 % e, P8 % t3);
              A4 && r.setValue(T10, P8, A4);
            }
      else
        for (let T10 = 0; T10 < f4; T10++)
          for (let P8 = 0; P8 < p3; P8++) {
            const A4 = r.getValue(T10 % e, P8 % t3);
            A4 && r.setValue(T10, P8, A4);
          }
    else if (C.length > 0) {
      const { row: T10, col: P8 } = d2(u2, h9);
      if (this._topLeftCellsMatch(e, t3, {
        topRow: T10,
        leftCol: P8
      })) {
        const x7 = this._expandOrShrinkRowsCols(s2, l4, a4, t3, e);
        a4.rows = x7.rows, a4.cols = x7.cols;
      } else {
        if (m9 > I6.endRow || g9 > I6.endColumn)
          return null;
        r.forValue((x7, H6, V7) => {
          V7.s = null, delete V7.colSpan, delete V7.rowSpan;
        });
      }
    } else {
      const T10 = this._expandOrShrinkRowsCols(s2, l4, a4, t3, e);
      a4.rows = T10.rows, a4.cols = T10.cols;
    }
    return {
      pastedRange: a4,
      unitId: s2,
      subUnitId: l4
    };
  }
  _getPastedRange(e) {
    var S;
    const t3 = this._getPastingTarget(), { selection: r, unitId: i, subUnitId: o3 } = t3;
    if (!o3 || !r)
      return null;
    const s2 = this._injector.invoke((w6) => Du(r.range, w6, i, o3));
    if (!s2)
      return null;
    const { startColumn: l4, endColumn: a4, startRow: c2, endRow: d2 } = e.getDataRange(), u2 = d2 - c2 + 1, h9 = a4 - l4 + 1;
    if (u2 <= 0 || h9 <= 0) return null;
    const m9 = s2.rows.length, g9 = s2.cols.length, f4 = (S = this._univerInstanceService.getUniverSheetInstance(i)) == null ? void 0 : S.getSheetBySheetId(o3);
    if (!f4)
      return null;
    const p3 = f4 == null ? void 0 : f4.getMergeData();
    if (m9 % u2 === 0 && g9 % h9 === 0 && !(p3 == null ? void 0 : p3.some((C) => Ua2(C, s2)))) {
      for (let C = 0; C < m9; C++)
        for (let I6 = 0; I6 < g9; I6++) {
          const R9 = e.getValue(C % u2, I6 % h9);
          R9 && e.setValue(C, I6, R9);
        }
      return {
        pastedRange: s2,
        unitId: i,
        subUnitId: o3
      };
    }
    const v6 = this._expandOrShrinkRowsCols(i, o3, s2, h9, u2);
    return s2.rows = v6.rows, s2.cols = v6.cols, {
      pastedRange: s2,
      unitId: i,
      subUnitId: o3
    };
  }
  _expandOrShrinkRowsCols(e, t3, r, i, o3) {
    const { rows: s2, cols: l4 } = r, a4 = this._univerInstanceService.getUniverSheetInstance(e), c2 = a4 == null ? void 0 : a4.getSheetBySheetId(t3);
    let d2, u2;
    if (s2.length >= o3)
      d2 = s2.slice(0, o3);
    else {
      d2 = s2.slice(0);
      let h9 = s2[s2.length - 1] + 1;
      for (; d2.length < o3; )
        c2.getRowFiltered(h9) || d2.push(h9), h9++;
    }
    if (l4.length >= i)
      u2 = l4.slice(0, i);
    else {
      u2 = l4.slice(0);
      let h9 = l4[l4.length - 1] + 1;
      for (; u2.length < i; )
        u2.push(h9), h9++;
    }
    return {
      rows: d2,
      cols: u2
    };
  }
  /**
   * Determine whether the cells starting from the upper left corner of the range (merged or non-merged or combined) are consistent with the size of the original data
   * @param cellMatrix
   * @param range
   */
  _topLeftCellsMatch(e, t3, r) {
    const i = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET), o3 = i == null ? void 0 : i.getActiveSheet();
    if (!o3)
      return false;
    const { topRow: s2, leftCol: l4 } = r, a4 = K1(
      s2 + e - 1,
      l4,
      l4 + t3 - 1,
      o3
    ), c2 = J13(
      l4 + t3 - 1,
      s2,
      s2 + e - 1,
      o3
    );
    return !a4 && !c2;
  }
  removeMarkSelection() {
    this._copyMarkId && (this._markSelectionService.removeShape(this._copyMarkId), this._copyMarkId = null);
  }
  _initUnitDisposed() {
    this.disposeWithMe(
      this._univerInstanceService.getTypeOfUnitDisposed$(we.UNIVER_SHEET).subscribe((e) => {
        e && this.copyContentCache().clearWithUnitId(e.getUnitId());
      })
    );
  }
  disposePasteOptionsCache() {
    this.setShowMenu(false), this.updatePasteOptionsCache(null);
  }
};
ol2 = Z12([
  xt3(0, Nt),
  xt3(1, br),
  xt3(2, Inject(z)),
  xt3(3, ar2),
  xt3(4, ra),
  xt3(5, Ds),
  xt3(6, Xi3),
  xt3(7, a32),
  xt3(8, tt),
  xt3(9, JE),
  xt3(10, Inject(Ji)),
  xt3(11, Inject(Hn)),
  xt3(12, Inject(CE)),
  xt3(13, Inject(Injector))
], ol2);
function q12(n3) {
  let e = "";
  const t3 = n3.getLength();
  return n3.forRow((r, i) => {
    const o3 = [];
    i.forEach((s2) => {
      const l4 = n3.getValue(r, s2);
      if (l4) {
        const a4 = Q12(l4);
        o3.push(a4);
      }
    }), e += o3.join("	"), r !== t3 - 1 && (e += `
`);
  }), e;
}
function Q12(n3) {
  return yE(n3.displayV) ? n3.displayV : GE(n3);
}
function K1(n3, e, t3, r) {
  return r.getMergeData().some(
    (i) => i.startRow <= n3 && n3 < i.endRow && e <= i.startColumn && i.startColumn <= t3
  );
}
function J13(n3, e, t3, r) {
  return r.getMergeData().some(
    (i) => i.startColumn <= n3 && n3 < i.endColumn && e <= i.startRow && i.startRow <= t3
  );
}
function $12(n3) {
  let e = 0;
  return n3.forValue((t3, r, i) => {
    if (i && e++, e > 1)
      return false;
  }), e > 1;
}
function Ji4() {
  return {
    p: null,
    v: null,
    s: null,
    f: null,
    si: null,
    t: null
  };
}
var Kd3 = 998;
var dn2 = {
  id: jn2.id,
  name: "sheet.command.copy",
  type: Ls.COMMAND,
  multi: true,
  priority: Kd3,
  preconditions: Zd3,
  handler: (n3) => __async(void 0, null, function* () {
    return n3.get(tn3).copy();
  })
};
var Jd3 = {
  id: Un.id,
  name: "sheet.command.cut",
  type: Ls.COMMAND,
  multi: true,
  priority: Kd3,
  preconditions: Zd3,
  handler: (n3) => __async(void 0, null, function* () {
    return n3.get(tn3).cut();
  })
};
var un2 = {
  id: zn.id,
  type: Ls.COMMAND,
  multi: true,
  name: "sheet.command.paste",
  priority: Kd3,
  preconditions: Zd3,
  handler: (n3, e) => __async(void 0, null, function* () {
    const r = yield n3.get(ar2).read(), i = n3.get(tn3);
    return r.length !== 0 ? i.paste(r[0], e == null ? void 0 : e.value) : false;
  })
};
var Gc2 = {
  id: l7,
  type: Ls.COMMAND,
  handler: (n3, e) => __async(void 0, null, function* () {
    const t3 = n3.get(tn3), { htmlContent: r, textContent: i, files: o3 } = e;
    return t3.legacyPaste(r, i, o3), true;
  })
};
var po3 = {
  id: "sheet.command.paste-value",
  type: Ls.COMMAND,
  handler: (n3) => __async(void 0, null, function* () {
    return n3.get(Ds).executeCommand(un2.id, { value: et4.SPECIAL_PASTE_VALUE });
  })
};
var vo3 = {
  id: "sheet.command.paste-format",
  type: Ls.COMMAND,
  handler: (n3) => __async(void 0, null, function* () {
    return n3.get(Ds).executeCommand(un2.id, {
      value: et4.SPECIAL_PASTE_FORMAT
    });
  })
};
var li2 = {
  id: "sheet.command.paste-col-width",
  type: Ls.COMMAND,
  handler: (n3) => __async(void 0, null, function* () {
    return n3.get(Ds).executeCommand(un2.id, {
      value: et4.SPECIAL_PASTE_COL_WIDTH
    });
  })
};
var So4 = {
  id: "sheet.command.paste-besides-border",
  type: Ls.COMMAND,
  handler: (n3) => __async(void 0, null, function* () {
    return n3.get(Ds).executeCommand(un2.id, {
      value: et4.SPECIAL_PASTE_BESIDES_BORDER
    });
  })
};
var Am = {
  id: "sheet.command.optional-paste",
  type: Ls.COMMAND,
  handler: (_02, _13) => __async(void 0, [_02, _13], function* (n3, { type: e }) {
    return n3.get(tn3).rePasteWithPasteType(e);
  })
};
var is2 = {
  type: Ls.COMMAND,
  id: "sheet.command.delete-range-move-left-confirm",
  handler: (n3) => __async(void 0, null, function* () {
    const e = n3.get(at), t3 = n3.get(Ds), r = n3.get(Hn), i = n3.get(z), o3 = n3.get(br), s2 = i.getCurrentSelections();
    if (!s2)
      return false;
    const l4 = P5(o3);
    if (!l4) return false;
    const { worksheet: a4 } = l4;
    let c2 = s2[0].range;
    if (!c2)
      return false;
    c2 = __spreadProps(__spreadValues({}, c2), { endColumn: a4.getColumnCount() - 1 });
    const d2 = (m9) => m9.endRow - m9.startRow;
    return a4.getMergeData().find((m9) => {
      const g9 = Cn.getIntersects(m9, c2);
      return g9 ? d2(m9) > d2(g9) : false;
    }) ? (yield e.confirm({
      id: is2.id,
      title: { title: r.t("merge.confirm.warning") },
      children: { title: r.t("merge.confirm.dismantleMergeCellWarning") },
      cancelText: r.t("button.cancel"),
      confirmText: r.t("button.confirm")
    })) ? t3.executeCommand(It2.id) : true : t3.executeCommand(It2.id);
  })
};
var wi3 = {
  type: Ls.COMMAND,
  id: "sheet.command.delete-range-move-up-confirm",
  handler: (n3) => __async(void 0, null, function* () {
    const e = n3.get(at), t3 = n3.get(Ds), r = n3.get(Hn), i = n3.get(z), o3 = n3.get(br), s2 = i.getCurrentSelections();
    if (!s2) return false;
    const l4 = P5(o3);
    if (!l4) return false;
    const { worksheet: a4 } = l4;
    let c2 = s2[0].range;
    if (!c2) return false;
    c2 = __spreadProps(__spreadValues({}, c2), { endRow: a4.getRowCount() - 1 });
    for (let m9 = c2.startRow; m9 <= c2.endRow; m9++)
      if (a4.getRowFiltered(m9) && (yield e.confirm({
        id: wi3.id,
        title: { title: r.t("filter.confirm.error") },
        children: { title: r.t("filter.confirm.notAllowedToInsertRange") },
        confirmText: r.t("button.confirm")
      })))
        return false;
    const d2 = (m9) => m9.endColumn - m9.startColumn;
    return a4.getMergeData().find((m9) => {
      const g9 = Cn.getIntersects(m9, c2);
      return g9 ? d2(m9) > d2(g9) : false;
    }) ? (yield e.confirm({
      id: wi3.id,
      title: { title: r.t("merge.confirm.warning") },
      children: { title: r.t("merge.confirm.dismantleMergeCellWarning") },
      cancelText: r.t("button.cancel"),
      confirmText: r.t("button.confirm")
    })) ? t3.executeCommand(vt2.id) : true : t3.executeCommand(vt2.id);
  })
};
var ha2 = ((n3) => (n3.MergeAll = "mergeAll", n3.MergeVertical = "mergeVertical", n3.MergeHorizontal = "mergeHorizontal", n3))(ha2 || {});
function Gn2(n3, e, t3, r, i = true, o3 = 1, s2 = true) {
  let l4 = __spreadValues({}, n3);
  r == null && (r = {
    startRow: 0,
    endRow: t3.getRowCount() - 1,
    startColumn: 0,
    endColumn: t3.getColumnCount() - 1
  });
  let a4;
  switch (e) {
    case wm.UP:
      for (a4 = n3.startRow - o3; a4 > -1 && !t3.getRowVisible(a4); )
        a4 -= 1;
      a4 >= r.startRow ? (l4.startRow = a4, l4.endRow = a4) : s2 && (l4.startRow = r.endRow, l4.endRow = r.endRow, i && (l4 = Gn2(l4, wm.LEFT, t3, r, false)));
      break;
    case wm.DOWN:
      for (a4 = n3.endRow + o3; a4 < t3.getRowCount() && !t3.getRowVisible(a4); )
        a4 += 1;
      a4 <= r.endRow ? (l4.startRow = a4, l4.endRow = a4) : s2 && (l4.startRow = r.startRow, l4.endRow = r.startRow, i && (l4 = Gn2(l4, wm.RIGHT, t3, r, false)));
      break;
    case wm.LEFT:
      for (a4 = n3.startColumn - o3; a4 > -1 && !t3.getColVisible(a4); )
        a4 -= 1;
      a4 >= r.startColumn ? (l4.startColumn = a4, l4.endColumn = a4) : s2 && (l4.startColumn = r.endColumn, l4.endColumn = r.endColumn, i && (l4 = Gn2(l4, wm.UP, t3, r, false)));
      break;
    case wm.RIGHT:
      for (a4 = n3.endColumn + o3; a4 < t3.getColumnCount() && !t3.getColVisible(a4); )
        a4 += 1;
      a4 <= r.endColumn ? (l4.startColumn = a4, l4.endColumn = a4) : s2 && (l4.startColumn = r.startColumn, l4.endColumn = r.startColumn, i && (l4 = Gn2(l4, wm.DOWN, t3, r, false)));
      break;
  }
  return l4;
}
function $d2(n3, e, t3) {
  const r = __spreadValues({}, n3), { startRow: i, startColumn: o3, endRow: s2, endColumn: l4 } = Mo4(n3, e, t3);
  let a4 = $i2(t3, i, o3, s2, l4).hasValue, c2 = true, d2 = true;
  for (; d2; ) {
    if (wm.UP === e) {
      let u2 = r.startRow - 1;
      for (; u2 > -1 && !t3.getRowVisible(u2); )
        u2 -= 1;
      if (u2 === -1) {
        d2 = false;
        break;
      }
      const { hasValue: h9, matrix: m9 } = $i2(
        t3,
        u2,
        r.startColumn,
        u2,
        r.endColumn
      );
      if (a4 && !h9 && !c2) {
        d2 = false;
        break;
      } else {
        if (m9.getLength() !== 0) {
          let g9 = u2;
          m9.forValue((f4) => {
            g9 = Math.min(f4, g9);
          }), r.startRow = g9;
        } else
          r.startRow = u2;
        if (r.endRow = r.startRow, !a4 && h9) {
          d2 = false;
          break;
        }
        a4 = h9, c2 = false;
      }
    }
    if (wm.DOWN === e) {
      let u2 = r.endRow + 1;
      for (; u2 < t3.getRowCount() && !t3.getRowVisible(u2); )
        u2 += 1;
      if (u2 === t3.getRowCount()) {
        d2 = false;
        break;
      }
      const { hasValue: h9, matrix: m9 } = $i2(
        t3,
        u2,
        r.startColumn,
        u2,
        r.endColumn
      );
      if (a4 && !h9 && !c2) {
        d2 = false;
        break;
      } else {
        if (m9.getLength() !== 0) {
          let g9 = u2;
          m9.forValue((f4, p3, v6) => {
            g9 = Math.max(f4 + (v6.rowSpan || 1) - 1, g9);
          }), r.endRow = g9;
        } else
          r.endRow = u2;
        if (r.startRow = r.endRow, !a4 && h9) {
          d2 = false;
          break;
        }
        a4 = h9, c2 = false;
      }
    }
    if (wm.LEFT === e) {
      let u2 = r.startColumn - 1;
      for (; u2 > -1 && !t3.getColVisible(u2); )
        u2 -= 1;
      if (u2 === -1) {
        d2 = false;
        break;
      }
      const { hasValue: h9, matrix: m9 } = $i2(
        t3,
        r.startRow,
        u2,
        r.endRow,
        u2
      );
      if (a4 && !h9 && !c2) {
        d2 = false;
        break;
      } else {
        if (m9.getLength() !== 0) {
          let g9 = u2;
          m9.forValue((f4, p3) => {
            g9 = Math.min(p3, g9);
          }), r.startColumn = g9;
        } else
          r.startColumn = u2;
        if (r.endColumn = r.startColumn, !a4 && h9) {
          d2 = false;
          break;
        }
        a4 = h9, c2 = false;
      }
    }
    if (wm.RIGHT === e) {
      let u2 = r.endColumn + 1;
      for (; u2 < t3.getColumnCount() && !t3.getColVisible(u2); )
        u2 += 1;
      if (u2 === t3.getColumnCount()) {
        d2 = false;
        break;
      }
      const { hasValue: h9, matrix: m9 } = $i2(
        t3,
        r.startRow,
        u2,
        r.endRow,
        u2
      );
      if (a4 && !h9 && !c2) {
        d2 = false;
        break;
      } else {
        if (m9.getLength() !== 0) {
          let g9 = u2;
          m9.forValue((f4, p3, v6) => {
            g9 = Math.max(p3 + (v6.colSpan || 1) - 1, g9);
          }), r.endColumn = g9;
        } else
          r.endColumn = u2;
        if (r.startColumn = r.endColumn, !a4 && h9) {
          d2 = false;
          break;
        }
        a4 = h9, c2 = false;
      }
    }
  }
  return cs2(r, t3, true);
}
function Hm(n3, e, t3) {
  return Gn2(n3, e, t3, void 0, false, 1, false);
}
function ew(n3, e, t3) {
  const r = $d2(n3, e, t3);
  return cs2(Cn.union(r, n3), t3, true);
}
function tw(n3, e, t3) {
  const r = Hm(n3, e, t3), i = {
    startRow: Math.min(n3.startRow, r.startRow),
    startColumn: Math.min(n3.startColumn, r.startColumn),
    endRow: Math.max(n3.endRow, r.endRow),
    endColumn: Math.max(n3.endColumn, r.endColumn)
  };
  return cs2(Cn.union(n3, i), t3);
}
function nw(n3, e, t3, r) {
  const i = wR(t3), o3 = $d2(Mo4(n3, i, r), t3, r);
  return t3 === wm.UP && o3.startRow <= n3.startRow ? cs2(
    __spreadProps(__spreadValues({}, e), { startColumn: n3.startColumn, endColumn: n3.endColumn }),
    r,
    true
  ) : t3 === wm.DOWN && o3.endRow >= n3.endRow ? cs2(
    __spreadProps(__spreadValues({}, e), { startColumn: n3.startColumn, endColumn: n3.endColumn }),
    r,
    true
  ) : t3 === wm.LEFT && o3.startColumn <= n3.startColumn ? cs2(
    __spreadProps(__spreadValues({}, e), { startRow: n3.startRow, endRow: n3.endRow }),
    r,
    true
  ) : t3 === wm.RIGHT && o3.endColumn >= n3.endColumn ? cs2(
    __spreadProps(__spreadValues({}, e), { startRow: n3.startRow, endRow: n3.endRow }),
    r,
    true
  ) : Cn.union(Cn.clone(e), o3);
}
function rw(n3, e, t3) {
  const r = wR(e), i = Mo4(n3, r, t3), o3 = Mo4(n3, e, t3), s2 = Hm(i, e, t3);
  return cs2(Cn.union(o3, s2), t3, false);
}
function mh2(n3) {
  return {
    startRow: 0,
    startColumn: 0,
    endRow: n3.getRowCount() - 1,
    endColumn: n3.getColumnCount() - 1,
    rangeType: ge.ALL
  };
}
function Mo4(n3, e, t3) {
  let r;
  switch (e) {
    case wm.UP:
      r = {
        startRow: n3.startRow,
        startColumn: n3.startColumn,
        endRow: n3.startRow,
        endColumn: n3.endColumn,
        rangeType: ge.NORMAL
      };
      break;
    case wm.DOWN:
      r = {
        startRow: n3.endRow,
        startColumn: n3.startColumn,
        endRow: n3.endRow,
        endColumn: n3.endColumn,
        rangeType: ge.NORMAL
      };
      break;
    case wm.LEFT:
      r = {
        startRow: n3.startRow,
        startColumn: n3.startColumn,
        endRow: n3.endRow,
        endColumn: n3.startColumn,
        rangeType: ge.NORMAL
      };
      break;
    case wm.RIGHT:
      r = {
        startRow: n3.startRow,
        startColumn: n3.endColumn,
        endRow: n3.endRow,
        endColumn: n3.endColumn,
        rangeType: ge.NORMAL
      };
      break;
    default:
      throw new Error("Invalid direction");
  }
  return cs2(r, t3, false);
}
function $i2(n3, e, t3, r, i) {
  let o3 = false;
  const s2 = n3.getMatrixWithMergedCells(e, t3, r, i).forValue((l4, a4, c2) => {
    if (ow(c2))
      return o3 = true, false;
  });
  return {
    hasValue: o3,
    matrix: s2
  };
}
function qc3(n3, e, t3) {
  const r = Cn.clone(n3);
  if (e == null)
    return r;
  switch (t3) {
    case wm.UP:
    case wm.DOWN:
      r.startColumn = r.endColumn = e.actualColumn;
      break;
    case wm.LEFT:
    case wm.RIGHT:
      r.startRow = r.endRow = e.actualRow;
      break;
  }
  return r;
}
function iw(n3, e, t3) {
  var l4, a4, c2, d2;
  const { primary: r, range: i } = n3, o3 = Cn.clone(i);
  switch (e) {
    case wm.UP:
    case wm.DOWN:
      o3.startRow = (l4 = r == null ? void 0 : r.startRow) != null ? l4 : i.startRow, o3.endRow = (a4 = r == null ? void 0 : r.endRow) != null ? a4 : i.startRow;
      break;
    case wm.LEFT:
    case wm.RIGHT:
      o3.startColumn = (c2 = r == null ? void 0 : r.startColumn) != null ? c2 : i.startColumn, o3.endColumn = (d2 = r == null ? void 0 : r.endColumn) != null ? d2 : i.startColumn;
      break;
  }
  const s2 = Mo4(o3, e, t3);
  switch (e) {
    case wm.DOWN:
      return i.startRow < s2.startRow;
    case wm.UP:
      return i.endRow > s2.endRow;
    case wm.LEFT:
      return s2.endColumn < i.endColumn;
    case wm.RIGHT:
      return s2.startColumn > i.startColumn;
  }
}
function Vm2(n3, e) {
  let t3 = n3[0].startRow, r = n3[0].endRow;
  n3.forEach((o3) => {
    const { startRow: s2, endRow: l4 } = o3;
    t3 = Math.min(t3, s2), r = Math.max(r, l4);
  });
  const i = new Array(r - t3 + 1).fill(false);
  return e.forEach((o3) => {
    const { startRow: s2, endRow: l4 } = o3;
    for (let a4 = Math.max(s2, t3); a4 <= Math.min(l4, r); a4++)
      i[a4 - t3] = true;
  }), n3.every((o3) => {
    const { startRow: s2, endRow: l4 } = o3;
    for (let a4 = s2; a4 <= l4; a4++)
      if (!i[a4 - t3])
        return false;
    return true;
  });
}
function Nm(n3, e) {
  let t3 = n3[0].startColumn, r = n3[0].endColumn;
  n3.forEach((o3) => {
    const { startColumn: s2, endColumn: l4 } = o3;
    t3 = Math.min(t3, s2), r = Math.max(r, l4);
  });
  const i = new Array(r - t3 + 1).fill(false);
  return e.forEach((o3) => {
    const { startColumn: s2, endColumn: l4 } = o3;
    for (let a4 = Math.max(s2, t3); a4 <= Math.min(l4, r); a4++)
      i[a4 - t3] = true;
  }), n3.every((o3) => {
    const { startColumn: s2, endColumn: l4 } = o3;
    for (let a4 = s2; a4 <= l4; a4++)
      if (!i[a4 - t3])
        return false;
    return true;
  });
}
function eu2(n3, e) {
  return e ? n3 === "mergeAll" ? e.filter((t3) => !(t3.startRow === t3.endRow && t3.startColumn === t3.endColumn)) : n3 === "mergeVertical" ? e.filter((t3) => t3.startRow !== t3.endRow) : n3 === "mergeHorizontal" ? e.filter((t3) => t3.startColumn !== t3.endColumn) : e : null;
}
function ow(n3) {
  return n3.v !== void 0 && n3.v !== null && n3.v !== "" || n3.p !== void 0;
}
var ga3 = {
  id: "sheet.command.hide-row-confirm",
  type: Ls.COMMAND,
  handler: (n3) => __async(void 0, null, function* () {
    var a4;
    const t3 = (a4 = n3.get(z).getCurrentSelections()) == null ? void 0 : a4.map((c2) => c2.range);
    if (!(t3 != null && t3.length)) return false;
    const r = n3.get(Ds), i = n3.get(br), o3 = P5(i);
    if (!o3) return false;
    const { worksheet: s2 } = o3, l4 = s2.getVisibleRows();
    if (Vm2(l4, t3)) {
      const c2 = n3.get(at), d2 = n3.get(Hn);
      return yield c2.confirm({
        id: "sheet.confirm.hide-row",
        title: {
          title: d2.t("info.problem")
        },
        children: { title: d2.t("rightClick.hideAllRowsAlert") },
        cancelText: d2.t("button.cancel"),
        confirmText: d2.t("button.confirm")
      }), false;
    }
    return yield r.executeCommand(Ts3.id), true;
  })
};
var ma4 = {
  id: "sheet.command.hide-col-confirm",
  type: Ls.COMMAND,
  handler: (n3) => __async(void 0, null, function* () {
    var a4;
    const t3 = (a4 = n3.get(z).getCurrentSelections()) == null ? void 0 : a4.map((c2) => c2.range);
    if (!(t3 != null && t3.length))
      return false;
    const r = n3.get(Ds), i = n3.get(br), o3 = P5(i);
    if (!o3) return false;
    const { worksheet: s2 } = o3, l4 = s2.getVisibleCols();
    if (Nm(l4, t3)) {
      const c2 = n3.get(at), d2 = n3.get(Hn);
      return yield c2.confirm({
        id: "sheet.confirm.hide-col",
        title: {
          title: d2.t("info.problem")
        },
        children: { title: d2.t("rightClick.hideAllColumnsAlert") },
        cancelText: d2.t("button.cancel"),
        confirmText: d2.t("button.confirm")
      }), false;
    }
    return yield r.executeCommand(Us.id), true;
  })
};
function kr4(n3) {
  var a4;
  const e = n3.get(br), t3 = n3.get(m), r = e.getUnit(Fl), i = t3.getActiveTextRange();
  if (r == null || i == null) return null;
  const o3 = (a4 = r.getBody()) == null ? void 0 : a4.textRuns;
  if (o3 == null) return;
  const { startOffset: s2 } = i;
  return o3.find(({ st: c2, ed: d2 }) => s2 >= c2 && s2 <= d2);
}
var zi2 = {
  type: Ls.COMMAND,
  id: "sheet.command.set-range-bold",
  handler: (n3) => __async(void 0, null, function* () {
    const e = n3.get(Ds);
    return n3.get(Tr).getContextValue(pE) ? e.executeCommand(Qt.id) : e.executeCommand(tg.id);
  })
};
var ji3 = {
  type: Ls.COMMAND,
  id: "sheet.command.set-range-italic",
  handler: (n3) => __async(void 0, null, function* () {
    const e = n3.get(Ds);
    return n3.get(Tr).getContextValue(pE) ? e.executeCommand(Ut.id) : e.executeCommand(ng.id);
  })
};
var Yi2 = {
  type: Ls.COMMAND,
  id: "sheet.command.set-range-underline",
  handler: (n3) => __async(void 0, null, function* () {
    const e = n3.get(Ds);
    return n3.get(Tr).getContextValue(pE) ? e.executeCommand(Ft2.id) : e.executeCommand(sg.id);
  })
};
var Zi2 = {
  type: Ls.COMMAND,
  id: "sheet.command.set-range-stroke",
  handler: (n3) => __async(void 0, null, function* () {
    const e = n3.get(Ds);
    return n3.get(Tr).getContextValue(pE) ? e.executeCommand(Ht.id) : e.executeCommand(og.id);
  })
};
var km2 = {
  type: Ls.COMMAND,
  id: "sheet.command.set-range-subscript",
  handler: (n3) => __async(void 0, null, function* () {
    const e = n3.get(Ds);
    return n3.get(Tr).getContextValue(pE) ? e.executeCommand(bt.id) : false;
  })
};
var Dm = {
  type: Ls.COMMAND,
  id: "sheet.command.set-range-superscript",
  handler: (n3) => __async(void 0, null, function* () {
    const e = n3.get(Ds);
    return n3.get(Tr).getContextValue(pE) ? e.executeCommand(kt3.id) : false;
  })
};
var fa2 = {
  type: Ls.COMMAND,
  id: "sheet.command.set-range-fontsize",
  handler: (n3, e) => __async(void 0, null, function* () {
    const t3 = n3.get(Ds);
    return n3.get(Tr).getContextValue(pE) ? t3.executeCommand(ct3.id, e) : t3.executeCommand(ag.id, e);
  })
};
var tu2 = {
  type: Ls.COMMAND,
  id: "sheet.command.set-range-font-increase",
  handler: (n3) => __async(void 0, null, function* () {
    var u2, h9, m9, g9;
    const e = n3.get(br), t3 = n3.get(Ds), i = n3.get(Tr).getContextValue(pE), o3 = n3.get(z), s2 = rt.fs, a4 = e.getCurrentUnitOfType(we.UNIVER_SHEET).getActiveSheet(), c2 = (u2 = o3.getCurrentLastSelection()) == null ? void 0 : u2.primary, d2 = {
      value: s2
    };
    if (i) {
      const f4 = kr4(n3);
      if (f4 != null) {
        const p3 = (m9 = (h9 = f4.ts) == null ? void 0 : h9.fs) != null ? m9 : s2;
        d2.value = p3 >= 400 ? 400 : p3 + 1;
      }
      return t3.executeCommand(ct3.id, d2);
    }
    if (c2 != null) {
      const p3 = (g9 = a4.getComposedCellStyle(c2.startRow, c2.startColumn).fs) != null ? g9 : s2;
      return d2.value = p3 >= 400 ? 400 : p3 + 1, t3.executeCommand(ag.id, d2);
    }
    return false;
  })
};
var nu3 = {
  type: Ls.COMMAND,
  id: "sheet.command.set-range-font-decrease",
  handler: (n3) => __async(void 0, null, function* () {
    var u2, h9, m9, g9;
    const e = n3.get(br), t3 = n3.get(Ds), i = n3.get(Tr).getContextValue(pE), o3 = n3.get(z), s2 = rt.fs, a4 = e.getCurrentUnitOfType(we.UNIVER_SHEET).getActiveSheet(), c2 = (u2 = o3.getCurrentLastSelection()) == null ? void 0 : u2.primary, d2 = {
      value: s2
    };
    if (i) {
      const f4 = kr4(n3);
      if (f4 != null) {
        const p3 = (m9 = (h9 = f4.ts) == null ? void 0 : h9.fs) != null ? m9 : s2;
        d2.value = p3 <= 6 ? 6 : p3 - 1;
      }
      return t3.executeCommand(ct3.id, d2);
    }
    if (c2 != null) {
      const p3 = (g9 = a4.getComposedCellStyle(c2.startRow, c2.startColumn).fs) != null ? g9 : s2;
      return d2.value = p3 <= 6 ? 6 : p3 - 1, t3.executeCommand(ag.id, d2);
    }
    return false;
  })
};
var Eo2 = {
  type: Ls.COMMAND,
  id: "sheet.command.set-range-font-family",
  handler: (n3, e) => __async(void 0, null, function* () {
    const t3 = n3.get(Ds);
    return n3.get(Tr).getContextValue(pE) ? t3.executeCommand(_t.id, e) : t3.executeCommand(ig2.id, e);
  })
};
var To2 = {
  type: Ls.COMMAND,
  id: "sheet.command.set-range-text-color",
  handler: (n3, e) => __async(void 0, null, function* () {
    const t3 = n3.get(Ds);
    return n3.get(Tr).getContextValue(pE) ? t3.executeCommand(mt.id, e) : t3.executeCommand(jc.id, e);
  })
};
var ru3 = {
  type: Ls.COMMAND,
  id: "sheet.command.reset-range-text-color",
  handler: (n3) => __async(void 0, null, function* () {
    const e = n3.get(Ds), r = n3.get(Tr).getContextValue(pE), i = n3.get(Ji);
    return r ? e.executeCommand(mt.id, { value: null }) : e.executeCommand(jc.id, {
      value: i.getColorFromTheme("gray.900")
    });
  })
};
var bi4 = {
  type: Ls.COMMAND,
  id: "sheet.command.insert-range-move-down-confirm",
  handler: (n3) => __async(void 0, null, function* () {
    const e = n3.get(at), t3 = n3.get(Ds), r = n3.get(Hn), i = n3.get(z), o3 = n3.get(br), s2 = i.getCurrentSelections();
    if (!s2)
      return false;
    const l4 = P5(o3);
    if (!l4) return false;
    const { worksheet: a4 } = l4;
    let c2 = s2[0].range;
    if (!c2)
      return false;
    c2 = __spreadProps(__spreadValues({}, c2), { endRow: a4.getRowCount() - 1 });
    for (let m9 = c2.startRow; m9 <= c2.endRow; m9++)
      if (a4.getRowFiltered(m9) && (yield e.confirm({
        id: bi4.id,
        title: { title: r.t("filter.confirm.error") },
        children: { title: r.t("filter.confirm.notAllowedToInsertRange") },
        confirmText: r.t("button.confirm")
      })))
        return false;
    const d2 = (m9) => m9.endColumn - m9.startColumn;
    return a4.getMergeData().find((m9) => {
      const g9 = Cn.getIntersects(m9, c2);
      return g9 ? d2(m9) > d2(g9) : false;
    }) ? (yield e.confirm({
      id: bi4.id,
      title: { title: r.t("merge.confirm.warning") },
      children: { title: r.t("merge.confirm.dismantleMergeCellWarning") },
      cancelText: r.t("button.cancel"),
      confirmText: r.t("button.confirm")
    })) ? t3.executeCommand(Pt4.id) : true : t3.executeCommand(Pt4.id);
  })
};
var os2 = {
  type: Ls.COMMAND,
  id: "sheet.command.insert-range-move-right-confirm",
  handler: (n3) => __async(void 0, null, function* () {
    const e = n3.get(at), t3 = n3.get(Ds), r = n3.get(Hn), i = n3.get(z), o3 = n3.get(br), s2 = i.getCurrentSelections();
    if (!s2)
      return false;
    const l4 = P5(o3);
    if (!l4) return false;
    const { worksheet: a4 } = l4;
    let c2 = s2[0].range;
    if (!c2)
      return false;
    c2 = __spreadProps(__spreadValues({}, c2), { endColumn: a4.getColumnCount() - 1 });
    const d2 = (m9) => m9.endRow - m9.startRow;
    return a4.getMergeData().find((m9) => {
      const g9 = Cn.getIntersects(m9, c2);
      return g9 ? d2(m9) > d2(g9) : false;
    }) ? (yield e.confirm({
      id: os2.id,
      title: { title: r.t("merge.confirm.warning") },
      children: { title: r.t("merge.confirm.dismantleMergeCellWarning") },
      cancelText: r.t("button.cancel"),
      confirmText: r.t("button.confirm")
    })) ? t3.executeCommand(rn.id) : true : t3.executeCommand(rn.id);
  })
};
var Lm = ((n3) => (n3[n3.UNIVER_UNKNOWN = 0] = "UNIVER_UNKNOWN", n3[n3.UNIVER_DOC = 1] = "UNIVER_DOC", n3[n3.UNIVER_SHEET = 2] = "UNIVER_SHEET", n3[n3.UNIVER_SLIDE = 3] = "UNIVER_SLIDE", n3[n3.UNIVER_PROJECT = 4] = "UNIVER_PROJECT", n3[n3.UNRECOGNIZED = -1] = "UNRECOGNIZED", n3))(Lm || {});
var ce3 = ((n3) => (n3[n3.View = 0] = "View", n3[n3.Edit = 1] = "Edit", n3[n3.ManageCollaborator = 2] = "ManageCollaborator", n3[n3.Print = 3] = "Print", n3[n3.Duplicate = 4] = "Duplicate", n3[n3.Comment = 5] = "Comment", n3[n3.Copy = 6] = "Copy", n3[n3.Share = 7] = "Share", n3[n3.Export = 8] = "Export", n3[n3.MoveWorksheet = 9] = "MoveWorksheet", n3[n3.DeleteWorksheet = 10] = "DeleteWorksheet", n3[n3.HideWorksheet = 11] = "HideWorksheet", n3[n3.RenameWorksheet = 12] = "RenameWorksheet", n3[n3.CreateWorksheet = 13] = "CreateWorksheet", n3[n3.SetWorksheetStyle = 14] = "SetWorksheetStyle", n3[n3.EditWorksheetCell = 15] = "EditWorksheetCell", n3[n3.InsertHyperlink = 16] = "InsertHyperlink", n3[n3.Sort = 17] = "Sort", n3[n3.Filter = 18] = "Filter", n3[n3.PivotTable = 19] = "PivotTable", n3[n3.FloatImg = 20] = "FloatImg", n3[n3.History = 21] = "History", n3[n3.RwHgtClWdt = 22] = "RwHgtClWdt", n3[n3.ViemRwHgtClWdt = 23] = "ViemRwHgtClWdt", n3[n3.ViewFilter = 24] = "ViewFilter", n3[n3.MoveSheet = 25] = "MoveSheet", n3[n3.DeleteSheet = 26] = "DeleteSheet", n3[n3.HideSheet = 27] = "HideSheet", n3[n3.CopySheet = 28] = "CopySheet", n3[n3.RenameSheet = 29] = "RenameSheet", n3[n3.CreateSheet = 30] = "CreateSheet", n3[n3.SelectProtectedCells = 31] = "SelectProtectedCells", n3[n3.SelectUnProtectedCells = 32] = "SelectUnProtectedCells", n3[n3.SetCellStyle = 33] = "SetCellStyle", n3[n3.SetCellValue = 34] = "SetCellValue", n3[n3.SetRowStyle = 35] = "SetRowStyle", n3[n3.SetColumnStyle = 36] = "SetColumnStyle", n3[n3.InsertRow = 37] = "InsertRow", n3[n3.InsertColumn = 38] = "InsertColumn", n3[n3.DeleteRow = 39] = "DeleteRow", n3[n3.DeleteColumn = 40] = "DeleteColumn", n3[n3.EditExtraObject = 41] = "EditExtraObject", n3[n3.Delete = 42] = "Delete", n3[n3.RecoverHistory = 43] = "RecoverHistory", n3[n3.ViewHistory = 44] = "ViewHistory", n3[n3.CreatePermissionObject = 45] = "CreatePermissionObject", n3[n3.UNRECOGNIZED = -1] = "UNRECOGNIZED", n3))(ce3 || {});
var Lt3 = ((n3) => (n3[n3.Reader = 0] = "Reader", n3[n3.Editor = 1] = "Editor", n3[n3.Owner = 2] = "Owner", n3[n3.UNRECOGNIZED = -1] = "UNRECOGNIZED", n3))(Lt3 || {});
var Rn = ((n3) => (n3[n3.Unkonwn = 0] = "Unkonwn", n3[n3.Workbook = 1] = "Workbook", n3[n3.Worksheet = 2] = "Worksheet", n3[n3.SelectRange = 3] = "SelectRange", n3[n3.Document = 4] = "Document", n3[n3.Slide = 5] = "Slide", n3[n3.UNRECOGNIZED = -1] = "UNRECOGNIZED", n3))(Rn || {});
var rn2 = ((n3) => (n3[n3.SomeCollaborator = 0] = "SomeCollaborator", n3[n3.AllCollaborator = 1] = "AllCollaborator", n3[n3.OneSelf = 2] = "OneSelf", n3[n3.UNRECOGNIZED = -1] = "UNRECOGNIZED", n3))(rn2 || {});
var Po4 = "UNIVER_SHEET_PERMISSION_PANEL";
var pa5 = "UNIVER_SHEET_PERMISSION_USER_PART";
var Wm = "UNIVER_SHEET_PERMISSION_USER_DIALOG";
var Bm2 = "UNIVER_SHEET_PERMISSION_DIALOG";
var sl2 = "UNIVER_SHEET_PERMISSION_USER_DIALOG_ID";
var ll2 = "UNIVER_SHEET_PERMISSION_DIALOG_ID";
var bs4 = {
  [ce3.Copy]: "Copy",
  [ce3.SetCellStyle]: "SetCellStyle",
  [ce3.SetCellValue]: "SetCellValue",
  [ce3.SetRowStyle]: "SetRowStyle",
  [ce3.SetColumnStyle]: "SetColumnStyle",
  [ce3.InsertRow]: "InsertRow",
  [ce3.InsertColumn]: "InsertColumn",
  [ce3.InsertHyperlink]: "InsertHyperlink",
  [ce3.DeleteRow]: "DeleteRow",
  [ce3.DeleteColumn]: "DeleteColumn",
  [ce3.Sort]: "Sort",
  [ce3.Filter]: "Filter",
  [ce3.PivotTable]: "PivotTable",
  [ce3.EditExtraObject]: "EditExtraObject"
};
var sw = [
  ce3.Copy,
  ce3.SetCellStyle,
  ce3.SetCellValue,
  ce3.SetRowStyle,
  ce3.SetColumnStyle,
  ce3.InsertRow,
  ce3.InsertColumn,
  ce3.InsertHyperlink,
  ce3.DeleteRow,
  ce3.DeleteColumn,
  ce3.Sort,
  ce3.Filter,
  ce3.PivotTable,
  ce3.EditExtraObject,
  ce3.View
];
var Fm = "sheet-permission-menu-icon";
var lw = "sheet-permission-delete-icon";
var aw = "sheet-permission-edit-icon";
var cw = "sheet-permission-check-icon";
var Um = "sheet-permission-lock-icon";
var dw = {
  unitId: "",
  subUnitId: "",
  permissionId: "",
  unitType: x4.SelectRange,
  id: "",
  ranges: [],
  viewState: Au.OthersCanView,
  editState: xu.OnlyMe
};
var Rr4 = class {
  constructor() {
    _2(this, "_rule", dw);
    _2(this, "_visible", false);
  }
  setVisible(e) {
    this._visible = e;
  }
  getVisible() {
    return this._visible;
  }
  reset() {
    this.setVisible(false);
  }
};
var Dr4 = class {
  constructor() {
    _2(this, "_userList", []);
    _2(this, "_userList$", new BehaviorSubject(this._userList));
    _2(this, "userList$", this._userList$.asObservable());
    _2(this, "_oldCollaboratorList", []);
    _2(this, "_selectUserList", []);
    _2(this, "_selectUserList$", new BehaviorSubject(this._selectUserList));
    _2(this, "selectUserList$", this._selectUserList$.asObservable());
  }
  get userList() {
    return this._userList;
  }
  // Set all editable users of this unit
  setCanEditUserList(e) {
    this._userList = e, this._userList$.next(e);
  }
  reset() {
    this._userList = [], this._oldCollaboratorList = [], this._selectUserList = [], this._selectUserList$.next([]);
  }
  get oldCollaboratorList() {
    return this._oldCollaboratorList;
  }
  setOldCollaboratorList(e) {
    this._oldCollaboratorList = e;
  }
  get selectUserList() {
    return this._selectUserList;
  }
  // The results of the user dialog selection panel should be rendered in the permission panel
  setSelectUserList(e) {
    this._selectUserList = e, this._selectUserList$.next(e);
  }
};
var On3 = {
  type: Ls.OPERATION,
  id: "sheet-permission.operation.openPanel",
  handler(_02) {
    return __async(this, arguments, function* (n3, e = {}) {
      const t3 = n3.get(be2), r = n3.get(Rr4), i = n3.get(Dr4), { showDetail: o3 = true, fromSheetBar: s2 = false, rule: l4, oldRule: a4 } = e, c2 = {
        header: { title: "permission.panel.title" },
        children: {
          label: Po4,
          showDetail: o3,
          fromSheetBar: s2,
          rule: l4,
          oldRule: a4
        },
        width: 330,
        onClose: () => {
          r.reset(), i.reset();
        }
      };
      return r.setVisible(true), t3.open(c2), true;
    });
  }
};
var va3 = {
  type: Ls.COMMAND,
  id: "sheet.command.add-range-protection-from-toolbar",
  handler(n3) {
    return __async(this, null, function* () {
      return yield n3.get(Ds).executeCommand(On3.id, { showDetail: true }), true;
    });
  }
};
var ai2 = {
  type: Ls.COMMAND,
  id: "sheet.command.add-range-protection-from-context-menu",
  handler(n3) {
    return __async(this, null, function* () {
      return yield n3.get(Ds).executeCommand(On3.id, { showDetail: true }), true;
    });
  }
};
var ci2 = {
  type: Ls.COMMAND,
  id: "sheet.command.view-sheet-permission-from-context-menu",
  handler(n3) {
    return __async(this, null, function* () {
      return yield n3.get(Ds).executeCommand(On3.id, { showDetail: false }), true;
    });
  }
};
var Sa4 = {
  type: Ls.COMMAND,
  id: "sheet.command.add-range-protection-from-sheet-bar",
  handler(n3) {
    return __async(this, null, function* () {
      return yield n3.get(Ds).executeCommand(On3.id, { fromSheetBar: true, showDetail: true }), true;
    });
  }
};
var Ca4 = {
  type: Ls.COMMAND,
  id: "sheet.command.view-sheet-permission-from-sheet-bar",
  handler(n3) {
    return __async(this, null, function* () {
      return yield n3.get(Ds).executeCommand(On3.id, { showDetail: false }), true;
    });
  }
};
var di2 = {
  type: Ls.COMMAND,
  id: "sheet.command.delete-range-protection-from-context-menu",
  handler(n3) {
    return __async(this, null, function* () {
      var u2;
      const e = n3.get(Ds), t3 = n3.get(br), r = n3.get(ra), i = n3.get(z), o3 = n3.get(lt3), s2 = t3.getCurrentUnitForType(we.UNIVER_SHEET), l4 = s2.getActiveSheet(), a4 = s2.getUnitId(), c2 = l4.getSheetId(), d2 = o3.getRule(a4, c2);
      if (d2 != null && d2.permissionId)
        return e.executeCommand(Rc.id, { unitId: a4, subUnitId: c2, rule: d2 });
      {
        const h9 = (u2 = i.getCurrentLastSelection()) == null ? void 0 : u2.range;
        if (!h9)
          return false;
        const f4 = n3.get(me).getSubunitRuleList(a4, c2).find((p3) => p3.ranges.some((v6) => Cn.intersects(v6, h9)));
        if (f4) {
          const p3 = {
            unitId: a4,
            subUnitId: c2,
            ruleIds: [f4.id]
          };
          return (yield e.executeCommand(ot2.id, p3)) && r.pushUndoRedo({
            unitID: a4,
            redoMutations: [{ id: ot2.id, params: p3 }],
            undoMutations: [{ id: Be3.id, params: { unitId: a4, subUnitId: c2, rules: [f4] } }]
          }), true;
        } else
          return false;
      }
    });
  }
};
var ui2 = {
  type: Ls.COMMAND,
  id: "sheet.command.set-range-protection-from-context-menu",
  handler(n3) {
    return __async(this, null, function* () {
      var d2;
      const e = n3.get(Ds), t3 = n3.get(br), r = n3.get(z), i = n3.get(lt3), o3 = t3.getCurrentUnitForType(we.UNIVER_SHEET), s2 = o3.getActiveSheet(), l4 = o3.getUnitId(), a4 = s2.getSheetId(), c2 = i.getRule(l4, a4);
      if (c2 != null && c2.permissionId) {
        const u2 = __spreadProps(__spreadValues({}, c2), {
          unitId: l4,
          subUnitId: a4,
          ranges: []
        });
        return yield e.executeCommand(On3.id, { showDetail: true, rule: Z.deepClone(u2), oldRule: Z.deepClone(u2) }), true;
      } else {
        const u2 = (d2 = r.getCurrentLastSelection()) == null ? void 0 : d2.range;
        if (!u2)
          return false;
        const g9 = n3.get(me).getSubunitRuleList(l4, a4).find((f4) => {
          var p3;
          return (p3 = f4 == null ? void 0 : f4.ranges) == null ? void 0 : p3.some((v6) => Cn.intersects(v6, u2));
        });
        if (g9) {
          const f4 = __spreadProps(__spreadValues({}, g9), {
            unitId: l4,
            subUnitId: a4
          });
          return yield e.executeCommand(On3.id, { showDetail: true, rule: Z.deepClone(f4), oldRule: Z.deepClone(f4) }), true;
        } else
          return false;
      }
    });
  }
};
var wa3 = {
  id: "sheet.command.refill",
  type: Ls.COMMAND,
  handler: (n3, e) => __async(void 0, null, function* () {
    return n3.get(Nr3).fillData(e.type);
  })
};
var xo = {
  id: "sheet.command.remove-row-confirm",
  type: Ls.COMMAND,
  handler: (n3, e) => __async(void 0, null, function* () {
    var c2;
    const t3 = n3.get(z);
    let r = e == null ? void 0 : e.range;
    if (r || (r = (c2 = t3.getCurrentLastSelection()) == null ? void 0 : c2.range), !r)
      return false;
    const i = n3.get(Ds), o3 = n3.get(br), s2 = P5(o3);
    if (!s2) return false;
    const { worksheet: l4 } = s2, a4 = l4.getVisibleRows();
    if (Vm2(a4, [r])) {
      const d2 = n3.get(at), u2 = n3.get(Hn);
      return yield d2.confirm({
        id: "sheet.confirm.remove-row",
        title: {
          title: u2.t("info.problem")
        },
        children: { title: u2.t("rightClick.deleteAllRowsAlert") },
        cancelText: u2.t("button.cancel"),
        confirmText: u2.t("button.confirm")
      }), false;
    }
    return yield i.executeCommand(hs.id, { range: r }), true;
  })
};
var Oo3 = {
  id: "sheet.command.remove-col-confirm",
  type: Ls.COMMAND,
  handler: (n3, e) => __async(void 0, null, function* () {
    var c2;
    const t3 = n3.get(z);
    let r = e == null ? void 0 : e.range;
    if (r || (r = (c2 = t3.getCurrentLastSelection()) == null ? void 0 : c2.range), !r)
      return false;
    const i = n3.get(Ds), o3 = n3.get(br), s2 = P5(o3);
    if (!s2) return false;
    const { worksheet: l4 } = s2, a4 = l4.getVisibleCols();
    if (Nm(a4, [r])) {
      const d2 = n3.get(at), u2 = n3.get(Hn);
      return yield d2.confirm({
        id: "sheet.confirm.remove-col",
        title: {
          title: u2.t("info.problem")
        },
        children: { title: u2.t("rightClick.deleteAllColumnsAlert") },
        cancelText: u2.t("button.cancel"),
        confirmText: u2.t("button.confirm")
      }), false;
    }
    return yield i.executeCommand(gs.id, { range: r }), true;
  })
};
var ba4 = {
  id: "sheet.command.remove-sheet-confirm",
  type: Ls.COMMAND,
  handler: (n3, e) => __async(void 0, null, function* () {
    const { subUnitId: t3 } = e, r = n3.get(at), i = n3.get(Ds), o3 = n3.get(Hn), s2 = n3.get(xs), l4 = n3.get(br), a4 = P5(l4, { subUnitId: t3 });
    if (!a4) return false;
    const { worksheet: c2 } = a4, d2 = s2.getConfig(fs), u2 = __spreadValues(__spreadValues({}, qr2), d2 == null ? void 0 : d2.largeSheetOperation), m9 = Sl2(c2.getCellMatrix()) >= u2.largeSheetCellCountThreshold;
    return (yield r.confirm({
      id: "sheet.confirm.remove-sheet",
      title: {
        title: o3.t("sheetConfig.deleteSheet")
      },
      children: { title: m9 ? o3.t("sheetConfig.deleteLargeSheetContent") : o3.t("sheetConfig.deleteSheetContent") },
      cancelText: o3.t("button.cancel"),
      confirmText: o3.t("button.confirm")
    })) ? (yield i.executeCommand(Zs.id, { subUnitId: t3 }), true) : false;
  })
};
var uw = Object.getOwnPropertyDescriptor;
var hw = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? uw(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var Xr4 = (n3, e) => (t3, r) => e(t3, r, n3);
var zt2 = ((n3) => (n3[n3.OFF = 0] = "OFF", n3[n3.ONCE = 1] = "ONCE", n3[n3.INFINITE = 2] = "INFINITE", n3))(zt2 || {});
var Nn = createIdentifier("univer.format-painter-service");
var al2 = class extends Ve {
  constructor(e, t3, r, i, o3, s2) {
    super();
    _2(this, "status$");
    _2(this, "_selectionFormat");
    _2(this, "_markId", null);
    _2(this, "_status$");
    _2(this, "_defaultHook", null);
    _2(this, "_extendHooks", []);
    this._selectionManagerService = e, this._themeService = t3, this._markSelectionService = r, this._logService = i, this._commandService = o3, this._undoRedoService = s2, this._status$ = new BehaviorSubject(
      0
      /* OFF */
    ), this.status$ = this._status$.asObservable(), this._selectionFormat = { styles: new ht(), merges: [] };
  }
  addHook(e) {
    var t3, r, i;
    e.isDefaultHook && ((t3 = e.priority) != null ? t3 : 0) > ((i = (r = this._defaultHook) == null ? void 0 : r.priority) != null ? i : -1) ? this._defaultHook = e : (this._extendHooks.push(e), this._extendHooks.sort((o3, s2) => (o3.priority || 0) - (s2.priority || 0)));
  }
  getHooks() {
    return this._defaultHook ? [this._defaultHook, ...this._extendHooks] : this._extendHooks;
  }
  setStatus(e) {
    this._updateRangeMark(e), this._status$.next(e), this.getHooks().forEach((r) => {
      r.onStatusChange !== void 0 && r.onStatusChange(e);
    });
  }
  getStatus() {
    return this._status$.getValue();
  }
  setSelectionFormat(e) {
    this._selectionFormat = e;
  }
  getSelectionFormat() {
    return this._selectionFormat;
  }
  applyFormatPainter(e, t3, r) {
    const i = this.getHooks(), o3 = [], s2 = [];
    i.forEach((a4) => {
      if (a4.onApply !== void 0) {
        const c2 = a4.onApply(
          e,
          t3,
          r,
          this._selectionFormat
        );
        c2 && (o3.push(...c2.redos), s2.push(...c2.undos));
      }
    });
    for (const a4 of i)
      if (a4.onBeforeApply !== void 0 && !a4.onBeforeApply({
        unitId: e,
        subUnitId: t3,
        range: r,
        redoMutationsInfo: o3,
        format: this._selectionFormat,
        undoMutationsInfo: s2
      }))
        return false;
    this._logService.log("[FormatPainterService]", "apply mutations", {
      undoMutationsInfo: s2,
      redoMutationsInfo: o3
    });
    const l4 = o3.every((a4) => this._commandService.executeCommand(a4.id, a4.params));
    return l4 && this._undoRedoService.pushUndoRedo({
      unitID: e,
      undoMutations: s2,
      redoMutations: o3
    }), l4;
  }
  _updateRangeMark(e) {
    if (this._markSelectionService.removeAllShapes(), e !== 0) {
      const t3 = this._selectionManagerService.getCurrentLastSelection();
      if (t3) {
        const r = Pm(this._themeService);
        e === 2 ? this._markId = this._markSelectionService.addShape(__spreadProps(__spreadValues({}, t3), { style: r })) : this._markId = this._markSelectionService.addShape(__spreadProps(__spreadValues({}, t3), { style: r }), [
          ee2.id
        ]);
      }
    }
  }
};
al2 = hw([
  Xr4(0, Inject(z)),
  Xr4(1, Inject(Ji)),
  Xr4(2, Xi3),
  Xr4(3, Nt),
  Xr4(4, Ds),
  Xr4(5, ra)
], al2);
var _a4 = {
  id: "sheet.operation.set-format-painter",
  type: Ls.OPERATION,
  handler: (n3, e) => e ? (n3.get(Nn).setStatus(e.status), true) : false
};
var iu2 = {
  type: Ls.COMMAND,
  id: "sheet.command.set-infinite-format-painter",
  handler: (n3) => __async(void 0, null, function* () {
    const t3 = n3.get(Nn).getStatus();
    let r;
    return t3 !== zt2.OFF ? r = zt2.OFF : r = zt2.INFINITE, n3.get(Ds).executeCommand(_a4.id, { status: r });
  })
};
var ss2 = {
  type: Ls.COMMAND,
  id: "sheet.command.set-once-format-painter",
  handler: (n3) => __async(void 0, null, function* () {
    const t3 = n3.get(Nn).getStatus();
    let r;
    return t3 !== zt2.OFF ? r = zt2.OFF : r = zt2.ONCE, n3.get(Ds).executeCommand(_a4.id, { status: r });
  })
};
var Ra3 = {
  type: Ls.COMMAND,
  id: "sheet.command.apply-format-painter",
  handler: (n3, e) => __async(void 0, null, function* () {
    return n3.get(Nn).applyFormatPainter(e.unitId, e.subUnitId, e.range);
  })
};
var gw = Object.getOwnPropertyDescriptor;
var mw = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? gw(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var fw = (n3, e) => (t3, r) => e(t3, r, n3);
var Et3 = class {
  constructor(n3, e) {
    _2(this, "_scrollStateMap", /* @__PURE__ */ new Map());
    _2(this, "_rawScrollInfo$", new BehaviorSubject(null));
    _2(this, "rawScrollInfo$", this._rawScrollInfo$.asObservable());
    _2(this, "validViewportScrollInfo$", new BehaviorSubject(null));
    _2(this, "_searchParamForScroll", null);
    this._context = n3, this._sheetSkeletonManagerService = e;
  }
  dispose() {
    this._rawScrollInfo$.complete();
  }
  calcViewportScrollFromRowColOffset(n3) {
    if (!n3)
      return {
        viewportScrollX: 0,
        viewportScrollY: 0
      };
    let { sheetViewStartColumn: e, sheetViewStartRow: t3, offsetX: r, offsetY: i } = n3;
    t3 = t3 || 0, i = i || 0;
    const o3 = this._sheetSkeletonManagerService.getCurrentSkeleton(), s2 = (o3 == null ? void 0 : o3.rowHeightAccumulation[t3 - 1]) || 0, a4 = ((o3 == null ? void 0 : o3.columnWidthAccumulation[e - 1]) || 0) + r, c2 = s2 + i;
    return {
      viewportScrollX: a4,
      viewportScrollY: c2
    };
  }
  setSearchParam(n3) {
    this._searchParamForScroll = n3;
  }
  getScrollStateByParam(n3) {
    return this._getCurrentScroll(n3);
  }
  getCurrentScrollState() {
    return this._getCurrentScroll(this._searchParamForScroll);
  }
  setValidScrollState(n3) {
    this._setScrollState(n3);
  }
  /**
   * emit raw scrollInfo by SetScrollOperation, call by ScrollCommand.id.
   * raw scrollInfo means not handled by limit scroll method.
   * @param param
   */
  emitRawScrollParam(n3) {
    this._emitRawScroll(n3);
  }
  /**
   * Set _scrollStateMap
   * @param scroll
   */
  setValidScrollStateToCurrSheet(n3) {
    if (this._searchParamForScroll == null)
      return;
    this._setScrollState(__spreadValues(__spreadValues({}, this._searchParamForScroll), n3));
    const e = this._searchParamForScroll.sheetId, t3 = this._sheetSkeletonManagerService.getSkeleton(e);
    t3 && t3.setScroll(n3.viewportScrollX, n3.viewportScrollY);
  }
  clear() {
    this._searchParamForScroll != null && this._clearByParamAndNotify(this._searchParamForScroll);
  }
  /**
   * scroll
   * @param scrollInfo
   */
  _setScrollState(n3) {
    const { unitId: e, sheetId: t3, sheetViewStartColumn: r, sheetViewStartRow: i, offsetX: o3, offsetY: s2 } = n3;
    this._scrollStateMap.has(e) || this._scrollStateMap.set(e, /* @__PURE__ */ new Map());
    const l4 = this._scrollStateMap.get(e), a4 = {
      sheetViewStartRow: i,
      sheetViewStartColumn: r,
      offsetX: o3,
      offsetY: s2
    };
    l4.set(t3, a4);
  }
  _clearByParamAndNotify(n3) {
    this._setScrollState(__spreadProps(__spreadValues({}, n3), {
      sheetViewStartRow: 0,
      sheetViewStartColumn: 0,
      offsetX: 0,
      offsetY: 0
    })), this._emitRawScroll({
      sheetViewStartRow: 0,
      sheetViewStartColumn: 0,
      offsetX: 0,
      offsetY: 0
    });
  }
  _getCurrentScroll(n3) {
    var o3;
    const e = {
      sheetViewStartRow: 0,
      sheetViewStartColumn: 0,
      offsetX: 0,
      offsetY: 0
    };
    if (n3 == null)
      return e;
    const { unitId: t3, sheetId: r } = n3;
    return ((o3 = this._scrollStateMap.get(t3)) == null ? void 0 : o3.get(r)) || e;
  }
  _emitRawScroll(n3) {
    this._rawScrollInfo$.next(n3);
  }
};
Et3 = mw([
  fw(1, Inject(he2))
], Et3);
var Jn4 = {
  type: Ls.COMMAND,
  id: "sheet.command.set-selection-frozen",
  handler: (n3, e) => __async(void 0, null, function* () {
    const { type: t3 } = e || {}, r = n3.get(br), i = n3.get(ra), o3 = P5(r);
    if (!o3) return false;
    const { unitId: s2, subUnitId: l4 } = o3, a4 = n3.get(Ds), d2 = n3.get(z).getCurrentSelections();
    if (!d2)
      return false;
    const u2 = d2[(d2 == null ? void 0 : d2.length) - 1], { range: h9 } = u2, g9 = n3.get(JE).getRenderById(s2).with(Et3), { sheetViewStartRow: f4 = 0, sheetViewStartColumn: p3 = 0 } = g9.getCurrentScrollState() || {};
    let v6, S, w6, C;
    const { startRow: I6, startColumn: R9, rangeType: y6 } = h9;
    if (y6 === ge.ROW || t3 === 1)
      v6 = I6, w6 = I6 - f4, S = -1, C = 0;
    else if (y6 === ge.COLUMN || t3 === 2)
      v6 = -1, w6 = 0, S = R9, C = R9 - p3;
    else if (y6 === ge.NORMAL)
      v6 = I6, w6 = I6 - f4, S = R9, C = R9 - p3;
    else
      return false;
    const E3 = {
      unitId: s2,
      subUnitId: l4,
      startRow: v6,
      startColumn: S,
      xSplit: S > 0 ? Math.max(1, C) : C,
      ySplit: v6 > 0 ? Math.max(1, w6) : w6
    }, M10 = si(n3, E3);
    return a4.syncExecuteCommand(st2.id, E3) && i.pushUndoRedo({
      unitID: s2,
      undoMutations: [{ id: st2.id, params: M10 }],
      redoMutations: [{ id: st2.id, params: E3 }]
    }), true;
  })
};
var Ia2 = {
  type: Ls.COMMAND,
  id: "sheet.command.set-row-frozen",
  handler: (n3) => __async(void 0, null, function* () {
    return n3.get(Ds).executeCommand(Jn4.id, {
      type: 1
      /* Row */
    }), true;
  })
};
var ya2 = {
  type: Ls.COMMAND,
  id: "sheet.command.set-col-frozen",
  handler: (n3) => __async(void 0, null, function* () {
    return n3.get(Ds).executeCommand(Jn4.id, {
      type: 2
      /* Column */
    }), true;
  })
};
var ou2 = class extends Ve {
  constructor() {
    super(...arguments);
    _2(this, "rangesStack", []);
    _2(this, "selectedRangeWorksheet", "");
  }
};
var pw = Object.getOwnPropertyDescriptor;
var vw = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? pw(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var fh2 = (n3, e) => (t3, r) => e(t3, r, n3);
var _i2 = class {
  constructor(n3, e) {
    _2(this, "_current", null);
    _2(this, "_shortcutParam", []);
    this._univerInstanceService = n3, this._localeService = e;
  }
  dispose() {
    this._shortcutParam = [];
  }
  getCurrentBySearch(n3) {
    return this._getCurrentBySearch(n3);
  }
  getCurrent() {
    return this._getCurrentBySearch(this._current);
  }
  addOrUpdate(n3) {
    const e = this._getCurrentBySearch({
      unitId: n3.unitId,
      sheetId: n3.sheetId,
      keycode: n3.keycode
    });
    if (e != null) {
      const t3 = this._shortcutParam.indexOf(e);
      this._shortcutParam.splice(t3, 1);
    }
    return this._shortcutParam.push(n3), e;
  }
  remove(n3) {
    if (n3 == null)
      return;
    const e = this._getCurrentBySearch(n3);
    if (e == null)
      return;
    const t3 = this._shortcutParam.indexOf(e);
    return this._shortcutParam.splice(t3, 1)[0];
  }
  _getCurrentBySearch(n3) {
    return n3 == null ? void 0 : this._shortcutParam.find(
      (t3) => t3.unitId === n3.unitId && t3.sheetId === n3.sheetId && t3.keycode === n3.keycode
    );
  }
};
_i2 = vw([
  fh2(0, br),
  fh2(1, Inject(Hn))
], _i2);
var kn3 = ((n3) => (n3[n3.moveStopeOne = 0] = "moveStopeOne", n3[n3.moveGap = 1] = "moveGap", n3[n3.moveStepPage = 2] = "moveStepPage", n3[n3.moveStepEnd = 3] = "moveStepEnd", n3))(kn3 || {});
var Ut3 = {
  id: "sheet.command.move-selection",
  type: Ls.COMMAND,
  handler: (n3, e) => {
    if (!e)
      return false;
    const t3 = P5(n3.get(br));
    if (!t3) return false;
    const { workbook: r, worksheet: i } = t3, o3 = Ju(n3, e.fromCurrentSelection).getCurrentLastSelection();
    if (!o3)
      return false;
    const { direction: s2, jumpOver: l4, extra: a4 } = e, { range: c2, primary: d2 } = o3, u2 = qc3(c2, d2, s2), h9 = l4 === 1 ? $d2(u2, s2, i) : Gn2(u2, s2, i), m9 = Lh(h9.startRow, h9.startColumn, i);
    if (Cn.equals(m9, u2))
      return false;
    const g9 = r.getUnitId();
    n3.get(_i2).remove({
      unitId: g9,
      sheetId: i.getSheetId(),
      keycode: q1.TAB
    });
    const f4 = [
      {
        range: Cn.clone(m9),
        primary: {
          startRow: m9.startRow,
          startColumn: m9.startColumn,
          endRow: m9.endRow,
          endColumn: m9.endColumn,
          actualRow: h9.startRow,
          actualColumn: h9.startColumn,
          isMerged: m9.isMerged,
          isMergedMainCell: m9.startRow === h9.startRow && m9.startColumn === h9.startColumn
        }
      }
    ];
    return n3.get(Ds).executeCommand(ie5.id, {
      unitId: r.getUnitId(),
      subUnitId: i.getSheetId(),
      selections: f4,
      type: we3.MOVE_END,
      extra: a4,
      reveal: true
    });
  }
};
var Dn3 = {
  id: "sheet.command.move-selection-enter-tab",
  type: Ls.COMMAND,
  // eslint-disable-next-line max-lines-per-function, complexity
  handler: (n3, e) => {
    var V7;
    if (!e)
      return false;
    const t3 = P5(n3.get(br));
    if (!t3) return false;
    const { workbook: r, worksheet: i } = t3, o3 = Ju(n3), { direction: s2, keycode: l4 } = e, a4 = s2 === wm.LEFT || s2 === wm.UP, c2 = o3.getCurrentSelections().concat(), d2 = c2.findIndex((D5) => D5.primary), u2 = c2[d2];
    if (!u2)
      return false;
    const h9 = a4 ? -1 : 1, m9 = d2 + h9 !== c2.length ? c2[d2 + h9] : c2[0], g9 = c2.findIndex((D5) => D5 === m9), f4 = r.getUnitId(), p3 = i.getSheetId();
    if (!u2)
      return false;
    const { range: v6 } = u2, S = u2.primary;
    let w6 = qc3(v6, S, s2);
    const C = n3.get(_i2), I6 = C.getCurrentBySearch({
      unitId: f4,
      sheetId: p3,
      keycode: q1.TAB
    });
    let R9;
    const { startRow: y6, endRow: E3, startColumn: M10, endColumn: T10 } = v6, P8 = a4 ? S.startRow === y6 && S.startColumn === M10 : S.endRow === E3 && S.endColumn === T10;
    if (Cn.equals(v6, S)) {
      if (l4 === q1.TAB)
        I6 == null && C.addOrUpdate({
          unitId: f4,
          sheetId: p3,
          keycode: q1.TAB,
          selection: u2
        });
      else {
        const F7 = I6 == null ? void 0 : I6.selection;
        if (F7 != null) {
          const { range: z5, primary: Z9 } = F7;
          w6 = qc3(z5, Z9, s2);
        }
        C.remove({
          unitId: f4,
          sheetId: p3,
          keycode: q1.TAB
        });
      }
      const D5 = Gn2(w6, s2, i), B5 = Lh(D5.startRow, D5.startColumn, i);
      if (Cn.equals(B5, w6))
        return false;
      R9 = {
        range: Cn.clone(B5),
        primary: {
          startRow: B5.startRow,
          startColumn: B5.startColumn,
          endRow: B5.endRow,
          endColumn: B5.endColumn,
          actualRow: D5.startRow,
          actualColumn: D5.startColumn,
          isMerged: B5.isMerged,
          isMergedMainCell: B5.startRow === D5.startRow && B5.startColumn === D5.startColumn
        }
      };
    } else {
      C.remove({
        unitId: f4,
        sheetId: p3,
        keycode: q1.TAB
      });
      const D5 = Z.deepClone(S), B5 = P8 ? m9.range : Gn2(
        {
          startRow: D5.startRow,
          startColumn: D5.startColumn,
          endRow: D5.endRow,
          endColumn: D5.endColumn
        },
        s2,
        i,
        {
          startRow: y6,
          endRow: E3,
          startColumn: M10,
          endColumn: T10
        }
      ), F7 = P8 && a4, z5 = F7 ? Lh(B5.endRow, B5.endColumn, i) : Lh(B5.startRow, B5.startColumn, i);
      R9 = {
        range: P8 ? m9.range : Cn.clone(v6),
        primary: {
          startRow: z5.startRow,
          startColumn: z5.startColumn,
          endRow: z5.endRow,
          endColumn: z5.endColumn,
          actualRow: F7 ? z5.startRow : B5.startRow,
          actualColumn: F7 ? z5.startColumn : B5.startColumn,
          isMerged: z5.isMerged,
          isMergedMainCell: z5.startRow === B5.startRow && z5.startColumn === B5.startColumn
        },
        style: P8 ? m9.style : u2.style
      };
    }
    P8 ? (c2[d2].primary = null, c2[g9] = R9, o3.setSelections(f4, p3, [], we3.MOVE_END)) : c2[d2] = R9;
    const A4 = n3.get(Ds).executeCommand(ie5.id, {
      unitId: f4,
      subUnitId: p3,
      type: we3.MOVE_END,
      selections: c2,
      reveal: true,
      extra: e.extra
    }), H6 = (V7 = n3.get(JE).getRenderById(f4)) == null ? void 0 : V7.with(gt);
    return H6 == null || H6.refreshSelectionMoveEnd(), A4;
  }
};
var Gt3 = {
  id: "sheet.command.expand-selection",
  type: Ls.COMMAND,
  handler: (n3, e) => {
    if (!e) return false;
    const t3 = P5(n3.get(br));
    if (!t3) return false;
    const { worksheet: r, unitId: i, subUnitId: o3 } = t3, s2 = Ju(n3).getCurrentLastSelection();
    if (!s2) return false;
    const { range: l4, primary: a4 } = s2, { jumpOver: c2, direction: d2, extra: u2 } = e, m9 = iw(s2, d2, r) ? c2 === 1 ? nw(
      l4,
      __spreadProps(__spreadValues({}, Cn.clone(a4)), { rangeType: ge.NORMAL }),
      d2,
      r
    ) : rw(l4, d2, r) : c2 === 1 ? ew(l4, d2, r) : tw(l4, d2, r);
    return m9.rangeType = s2.range.rangeType, Cn.equals(m9, l4) ? false : n3.get(Ds).syncExecuteCommand(ie5.id, {
      unitId: i,
      subUnitId: o3,
      type: we3.MOVE_END,
      selections: [
        {
          range: m9,
          primary: a4
          // this remains unchanged
        }
      ],
      extra: u2,
      reveal: true
    });
  }
};
var Ma2 = {
  id: "sheet.command.select-all",
  type: Ls.COMMAND,
  // eslint-disable-next-line max-lines-per-function
  handler: (_02, ..._13) => __async(void 0, [_02, ..._13], function* (n3, e = { expandToGapFirst: true, loop: false }) {
    const t3 = P5(n3.get(br));
    if (!t3) return false;
    const r = Ju(n3).getCurrentLastSelection();
    if (!r) return false;
    const i = n3.get(ou2), { worksheet: o3, unitId: s2, subUnitId: l4 } = t3, a4 = `${s2}|${l4}`;
    a4 !== i.selectedRangeWorksheet && (i.rangesStack = [], i.selectedRangeWorksheet = a4);
    const c2 = o3.getMaxRows(), d2 = o3.getMaxColumns(), { expandToGapFirst: u2, loop: h9 } = e, { range: m9, primary: g9 } = r, f4 = m9.endColumn === d2 - 1 && m9.endRow === c2 - 1 && m9.startRow === 0 && m9.startColumn === 0;
    i.rangesStack.some((I6) => Cn.equals(I6, m9)) || (i.rangesStack = [], i.rangesStack.push(m9));
    let p3;
    if (f4)
      if (h9) {
        if (i.rangesStack.findIndex((R9) => Cn.equals(R9, m9)) !== i.rangesStack.length - 1)
          return false;
        p3 = i.rangesStack[0];
      } else
        return false;
    else u2 ? (p3 = Th(m9, { left: true, right: true, up: true, down: true }, o3), Cn.equals(p3, m9) && (p3 = mh2(o3))) : p3 = mh2(o3);
    i.rangesStack.some((I6) => Cn.equals(I6, p3)) || i.rangesStack.push(p3);
    const v6 = [];
    v6.push({
      id: ie5.id,
      params: {
        unitId: s2,
        subUnitId: l4,
        reveal: true,
        selections: [
          {
            range: p3,
            primary: g9
            // this remains unchanged
          }
        ]
      }
    });
    const w6 = n3.get(G).onCommandExecute({
      id: Ma2.id,
      params: { range: m9 }
    });
    w6.redos.length && v6.push(...w6.redos);
    const C = n3.get(Ds);
    return po(v6, C), true;
  })
};
function Sw(n3) {
  return typeof n3.isMainScene > "u";
}
function $t4(n3, e) {
  const t3 = n3 instanceof Ss ? n3 : n3.getCurrentUnitForType(we.UNIVER_SHEET);
  if (!t3) return null;
  const r = t3.getUnitId();
  let i, o3, s2, l4;
  if (Sw(e)) {
    const h9 = e.getRenderById(r);
    if (h9 == null) return null;
    i = h9.components, i = h9.components, o3 = h9.mainComponent, s2 = h9.scene, l4 = h9.engine;
  } else
    i = e.components, o3 = e.mainComponent, s2 = e.scene, l4 = e.engine;
  if (!i || !o3) return null;
  const a4 = o3, c2 = i.get(Ge5.ROW), d2 = i.get(Ge5.COLUMN), u2 = i.get(Ge5.LEFT_TOP);
  return {
    spreadsheet: a4,
    spreadsheetRowHeader: c2,
    spreadsheetColumnHeader: d2,
    spreadsheetLeftTopPlaceholder: u2,
    scene: s2,
    engine: l4
  };
}
function ph2(n3, e, t3, r) {
  const { startX: i, startY: o3, endX: s2, endY: l4 } = r.getCellWithCoordByIndex(n3, e);
  return { startX: i, startY: o3, endX: s2, endY: l4 };
}
function An4(n3, e, t3, r, i, o3) {
  const s2 = t3.getCoordRelativeToViewport(U.FromArray([n3, e])), { x: l4, y: a4 } = s2, c2 = t3.getScrollXYInfoByViewport(s2, i), { scaleX: d2, scaleY: u2 } = t3.getAncestorScale(), h9 = r.getCellIndexByOffset(
    l4,
    a4,
    d2,
    u2,
    c2,
    { closeFirst: o3 }
  ), { row: m9, column: g9 } = h9, f4 = r.getNoMergeCellWithCoordByIndex(m9, g9), { startX: p3, startY: v6, endX: S, endY: w6 } = f4;
  return {
    startX: p3,
    startY: v6,
    endX: S,
    endY: w6,
    row: m9,
    column: g9
  };
}
function Vs2(n3, e, t3, r) {
  const i = t3.getCoordRelativeToViewport(U.FromArray([n3, e])), o3 = t3.getViewport(k2.VIEW_MAIN), s2 = t3.getScrollXYInfoByViewport(i, o3), { scaleX: l4, scaleY: a4 } = t3.getAncestorScale(), { x: c2, y: d2 } = s2, u2 = n3 / l4 + c2, h9 = e / a4 + d2;
  return { x: u2, y: h9 };
}
var Cw = Object.getOwnPropertyDescriptor;
var ww = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? Cw(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var zr3 = (n3, e) => (t3, r) => e(t3, r, n3);
Ut3.id, Dn3.id;
var bw = 3;
var Ri3 = class extends Ve {
  constructor(n3, e, t3, r, i, o3, s2) {
    super(), this._context = n3, this._injector = e, this._sheetSkeletonManagerService = t3, this._contextService = r, this._commandService = i, this._renderManagerService = o3, this._scrollManagerService = s2, this._initCommandListener(), this._wheelEventListener(), this._scrollBarEventListener(), this._initSkeletonListener();
  }
  _wheelEventListener() {
    const { scene: n3 } = this._context;
    if (!n3) return;
    const e = n3.getViewport(k2.VIEW_MAIN);
    e && this.disposeWithMe(
      n3.onMouseWheel$.subscribeEvent((t3, r) => {
        if (t3.ctrlKey || !this._contextService.getContextValue(_r))
          return;
        let i = 0, o3 = 0;
        i = t3.deltaX, t3.shiftKey ? i = (t3.deltaY || t3.deltaX) * bw : o3 = t3.deltaY, this._commandService.executeCommand(Ao3.id, { offsetX: i, offsetY: o3 }), this._context.scene.makeDirty(true);
        const s2 = e.limitedScroll(e.scrollX + i, e.scrollY + o3);
        s2 && !s2.isLimitedX && !s2.isLimitedY && (t3.preventDefault(), n3.getParent().classType === V.SCENE_VIEWER && r.stopPropagation()), e.isWheelPreventDefaultX && e.isWheelPreventDefaultY && t3.preventDefault();
      })
    );
  }
  // eslint-disable-next-line max-lines-per-function
  _scrollBarEventListener() {
    const { scene: n3 } = this._context;
    if (n3 == null) return;
    const e = n3.getViewport(k2.VIEW_MAIN);
    e && (this.disposeWithMe(
      Be(
        this._scrollManagerService.rawScrollInfo$.subscribe((t3) => {
          var m9;
          const r = (m9 = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : m9.skeleton;
          if (!r) return;
          if (t3 == null) {
            e.scrollToViewportPos({
              viewportScrollX: 0,
              viewportScrollY: 0
            });
            return;
          }
          const { sheetViewStartRow: i, sheetViewStartColumn: o3, offsetX: s2, offsetY: l4, duration: a4 } = t3, { startX: c2, startY: d2 } = r.getCellWithCoordByIndex(
            i,
            o3,
            false
          ), u2 = c2 + s2, h9 = d2 + l4;
          e.scrollAnimationFrameId !== null && cancelAnimationFrame(e.scrollAnimationFrameId), a4 ? this._smoothScrollToViewportPos({ viewportMain: e, viewportScrollX: u2, viewportScrollY: h9, duration: a4 }) : e.scrollToViewportPos({ viewportScrollX: u2, viewportScrollY: h9 });
        })
      )
    ), this.disposeWithMe(
      // set scrollInfo, the event is triggered in viewport@_scrollToScrollbarPos
      e.onScrollAfter$.subscribeEvent((t3) => {
        var g9;
        const r = (g9 = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : g9.skeleton;
        if (r == null || t3.isTrigger === false)
          return;
        const i = this._getSheetObject();
        if (r == null || i == null)
          return;
        const { viewportScrollX: o3, viewportScrollY: s2, scrollX: l4, scrollY: a4 } = t3, { row: c2, column: d2, rowOffset: u2, columnOffset: h9 } = r.getOffsetRelativeToRowCol(
          o3,
          s2
        ), m9 = {
          sheetViewStartRow: c2,
          sheetViewStartColumn: d2,
          offsetX: h9,
          offsetY: u2,
          viewportScrollX: o3,
          viewportScrollY: s2,
          scrollX: l4,
          scrollY: a4
        };
        this._scrollManagerService.setValidScrollStateToCurrSheet(m9), this._scrollManagerService.validViewportScrollInfo$.next(__spreadProps(__spreadValues({}, m9), {
          viewportScrollX: o3,
          viewportScrollY: s2,
          scrollX: l4,
          scrollY: a4
        }));
      })
    ), this.disposeWithMe(
      // get scrollByBar event from viewport and exec ScrollCommand.id.
      e.onScrollByBar$.subscribeEvent((t3) => {
        var u2;
        const r = (u2 = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : u2.skeleton;
        if (r == null || t3.isTrigger === false)
          return;
        const i = this._getSheetObject();
        if (r == null || i == null)
          return;
        const { viewportScrollX: o3 = 0, viewportScrollY: s2 = 0 } = t3;
        this._getFreeze();
        const { row: l4, column: a4, rowOffset: c2, columnOffset: d2 } = r.getOffsetRelativeToRowCol(
          o3,
          s2
        );
        this._commandService.executeCommand(hn2.id, {
          sheetViewStartRow: l4,
          sheetViewStartColumn: a4,
          offsetX: d2,
          offsetY: c2
        });
      })
    ));
  }
  _initSkeletonListener() {
    this.disposeWithMe(Be(
      this._sheetSkeletonManagerService.currentSkeletonBefore$.subscribe((n3) => {
        if (n3 == null)
          return;
        const e = { unitId: n3.unitId, sheetId: n3.sheetId };
        if (this._scrollManagerService.setSearchParam(e), !this._getSheetObject()) return;
        const r = this._scrollManagerService.getScrollStateByParam(e), { viewportScrollX: i, viewportScrollY: o3 } = this._scrollManagerService.calcViewportScrollFromRowColOffset(r);
        r && this._updateViewportScroll(i, o3);
      })
    ));
  }
  _smoothScrollToViewportPos(n3) {
    const { viewportMain: e, viewportScrollX: t3, viewportScrollY: r, duration: i } = n3, o3 = performance.now(), s2 = e.viewportScrollX, l4 = e.viewportScrollY, a4 = t3 - s2, c2 = r - l4;
    function d2(u2) {
      const h9 = u2 - o3, m9 = Math.min(h9 / i, 1), g9 = 1 - __pow(1 - m9, 3), f4 = s2 + a4 * g9, p3 = l4 + c2 * g9;
      e.scrollToViewportPos({
        viewportScrollX: f4,
        viewportScrollY: p3
      }), m9 < 1 ? e.scrollAnimationFrameId = requestAnimationFrame(d2) : e.scrollAnimationFrameId = null;
    }
    e.scrollAnimationFrameId = requestAnimationFrame(d2);
  }
  _updateViewportScroll(n3 = 0, e = 0) {
    const t3 = this._getSheetObject();
    if (!t3) return;
    const r = t3.scene, i = r.getViewport(k2.VIEW_MAIN), o3 = r.getViewport(k2.VIEW_COLUMN_RIGHT), s2 = r.getViewport(k2.VIEW_ROW_BOTTOM), l4 = r.getViewport(k2.VIEW_MAIN_LEFT), a4 = r.getViewport(k2.VIEW_MAIN_TOP);
    i && (i.viewportScrollX = n3, i.viewportScrollY = e), s2 && (s2.viewportScrollY = e), o3 && (o3.viewportScrollX = n3), l4 && (l4.viewportScrollY = e), a4 && (a4.viewportScrollX = n3);
  }
  scrollToRange(n3, e, t3) {
    let { endRow: r, endColumn: i, startColumn: o3, startRow: s2 } = n3;
    const l4 = this._getViewportBounding();
    if (n3.rangeType === ge.ROW ? (o3 = 0, i = 0) : n3.rangeType === ge.COLUMN && (s2 = 0, r = 0), l4 && !e && !t3) {
      const a4 = l4.startRow > r ? s2 : r, c2 = l4.startColumn > i ? o3 : i;
      return this._scrollToCell(a4, c2);
    } else
      return this._scrollToCell(s2, o3, e, t3);
  }
  /**
   * Scroll spreadsheet(viewMain) to cell position. Based on the limitations of viewport and the number of rows and columns, you can only scroll to the maximum scrollable range.
   *
   * if column A ~ B is frozen. set second param to 0 would make viewMain start at column C.
   * set second param to 2 would make viewMain start at column E.
   * @param {number} row - Cell row
   * @param {number} column - Cell column
   * @returns {boolean} - true if scroll is successful
   */
  scrollToCell(n3, e, t3) {
    const r = this._context.unit.getActiveSheet(), {
      ySplit: i,
      xSplit: o3
    } = r.getFreeze();
    return this._commandService.syncExecuteCommand(hn2.id, {
      sheetViewStartRow: n3 - i,
      sheetViewStartColumn: e - o3,
      offsetX: 0,
      offsetY: 0,
      duration: t3
    });
  }
  _initCommandListener() {
    this.disposeWithMe(this._commandService.onCommandExecuted((n3) => {
      switch (n3.id) {
        case ie5.id:
          {
            const e = n3.params;
            e.unitId === this._context.unitId && e.reveal && this._scrollToSelection();
          }
          break;
        case yd.id:
          {
            const e = n3.params;
            if (e.unitId === this._context.unitId) {
              const t3 = e.range;
              this.scrollToRange(t3);
            }
          }
          break;
        case Gt3.id:
          {
            const e = n3.params;
            this._scrollToSelectionForExpand(e);
          }
          break;
      }
    }));
  }
  _scrollToSelectionForExpand(n3) {
    setTimeout(() => {
      const e = this._getSelectionsService().getCurrentLastSelection();
      if (e == null)
        return;
      const { startRow: t3, startColumn: r, endRow: i, endColumn: o3 } = e.range, s2 = this._getViewportBounding();
      if (s2 == null)
        return;
      const { startRow: l4, startColumn: a4, endRow: c2, endColumn: d2 } = s2;
      let u2 = 0, h9 = 0;
      t3 > l4 ? u2 = i : i < c2 ? u2 = t3 : u2 = l4, r > a4 ? h9 = o3 : o3 < d2 ? h9 = r : h9 = a4, n3.direction === wm.DOWN ? u2 = i : n3.direction === wm.UP ? u2 = t3 : n3.direction === wm.RIGHT ? h9 = o3 : n3.direction === wm.LEFT && (h9 = r), this._scrollToCell(u2, h9);
    }, 0);
  }
  _getFreeze() {
    var e;
    const n3 = (e = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : e.skeleton.getWorksheetConfig();
    if (n3 != null)
      return n3.freeze;
  }
  _updateSceneSize(n3) {
    var d2;
    if (n3 == null)
      return;
    const { unitId: e } = this._context, { skeleton: t3 } = n3, r = (d2 = this._renderManagerService.getRenderById(e)) == null ? void 0 : d2.scene;
    if (t3 == null || r == null)
      return;
    const { rowTotalHeight: i, columnTotalWidth: o3, rowHeaderWidthAndMarginLeft: s2, columnHeaderHeightAndMarginTop: l4 } = t3;
    this._context.unit.getActiveSheet() && (r == null || r.transformByState({
      width: s2 + o3,
      height: l4 + i
    }));
  }
  _getSheetObject() {
    return $t4(this._context.unit, this._context);
  }
  _scrollToSelectionByDirection(n3) {
    const e = this._getViewportBounding();
    if (e == null)
      return false;
    const {
      startRow: t3,
      startColumn: r,
      endRow: i,
      endColumn: o3
    } = e;
    let s2 = 0, l4 = 0;
    const { startRow: a4, startColumn: c2, endRow: d2, endColumn: u2 } = n3;
    a4 >= t3 && (s2 = d2), d2 <= i && (s2 = a4), c2 >= r && (l4 = u2), u2 <= o3 && (l4 = c2), this._scrollToCell(s2, l4);
  }
  _scrollToSelection(n3 = true) {
    var a4;
    const e = this._getSelectionsService().getCurrentLastSelection();
    if (!e) return;
    const { startRow: t3, startColumn: r, actualRow: i, actualColumn: o3 } = (a4 = e.primary) != null ? a4 : e.range, s2 = n3 && i != null ? i : t3, l4 = n3 && o3 != null ? o3 : r;
    this._scrollToCell(s2, l4);
  }
  _getSelectionsService() {
    return Ju(this._injector);
  }
  _getViewportBounding() {
    var i, o3;
    const n3 = (i = this._getSheetObject()) == null ? void 0 : i.scene;
    if (n3 == null)
      return;
    const e = n3.getViewport(k2.VIEW_MAIN);
    if (e == null)
      return;
    const t3 = (o3 = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : o3.skeleton;
    if (t3 == null)
      return;
    const r = e.calcViewportInfo();
    return t3.getRangeByViewBound(r.viewBound);
  }
  // For arrow key to active cell cause scrolling.
  // eslint-disable-next-line max-lines-per-function, complexity
  _scrollToCell(n3, e, t3 = false, r = false) {
    var M10, T10, P8;
    const { rowHeightAccumulation: i, columnWidthAccumulation: o3 } = (M10 = this._sheetSkeletonManagerService.getCurrentSkeleton()) != null ? M10 : {};
    if (i == null || o3 == null) return false;
    const s2 = (T10 = this._getSheetObject()) == null ? void 0 : T10.scene;
    if (s2 == null) return false;
    const l4 = s2.getViewport(k2.VIEW_MAIN);
    if (l4 == null) return false;
    const a4 = (P8 = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : P8.skeleton;
    if (a4 == null) return false;
    const c2 = this._context.unit.getActiveSheet();
    if (!c2) return false;
    n3 = Z.clamp(n3, 0, i.length - 1), e = Z.clamp(e, 0, o3.length - 1);
    const {
      startColumn: d2,
      startRow: u2,
      ySplit: h9,
      xSplit: m9
    } = c2.getFreeze(), g9 = this._getViewportBounding();
    if (g9 == null) return false;
    const {
      startRow: f4,
      startColumn: p3,
      endRow: v6,
      endColumn: S
    } = g9;
    let w6, C;
    if (n3 >= u2 && e >= d2 - h9 && (n3 <= f4 && (w6 = n3, t3 = true), n3 >= v6)) {
      const A4 = i[n3] - l4.height;
      for (let x7 = f4; x7 <= n3 && (w6 = x7 + 1, !(i[x7] >= A4)); x7++)
        ;
    }
    if (e >= d2 && n3 >= u2 - h9 && (e <= p3 && (C = e, r = true), e >= S)) {
      const A4 = o3[e] - l4.width;
      for (let x7 = p3; x7 <= e && (C = x7 + 1, !(o3[x7] >= A4)); x7++)
        ;
    }
    if (w6 === void 0 && C === void 0) return false;
    let { offsetX: I6, offsetY: R9, sheetViewStartRow: y6, sheetViewStartColumn: E3 } = this._scrollManagerService.getCurrentScrollState() || {};
    if (w6 = w6 ? Math.min(w6, n3) : y6 + h9, C = C ? Math.min(C, e) : E3 + m9, r) {
      I6 = 0, C = e;
      const A4 = a4.getHiddenColumnsInRange({ startColumn: C - m9, endColumn: C });
      C = C - A4.length;
    }
    if (t3) {
      R9 = 0, w6 = n3;
      const A4 = a4.getHiddenRowsInRange({ startRow: w6 - h9, endRow: w6 });
      w6 = w6 - A4.length;
    }
    return this._commandService.syncExecuteCommand(hn2.id, {
      // sheetViewStartRow & offsetX should never be undefined, it's rendering, there should always be a value!
      // sheetViewStartRow: forceTop ? Math.max(0, row - freezeYSplit) : ((startSheetViewRow ?? 0) - freezeYSplit),
      // sheetViewStartColumn: forceLeft ? Math.max(0, column - freezeXSplit) : ((startSheetViewColumn ?? 0) - freezeXSplit),
      // offsetX: startSheetViewColumn === undefined ? offsetX : 0,
      // offsetY: startSheetViewRow === undefined ? offsetY : 0,
      sheetViewStartRow: Math.max(0, w6 - h9),
      sheetViewStartColumn: Math.max(0, C - m9),
      offsetX: I6,
      offsetY: R9
    });
  }
};
Ri3 = ww([
  zr3(1, Inject(Injector)),
  zr3(2, Inject(he2)),
  zr3(3, Tr),
  zr3(4, Ds),
  zr3(5, JE),
  zr3(6, Inject(Et3))
], Ri3);
var or4 = {
  id: "sheet.operation.set-scroll",
  type: Ls.OPERATION,
  handler: (n3, e) => {
    if (!e)
      return false;
    const { unitId: t3, sheetId: r, offsetX: i = 0, offsetY: o3 = 0, sheetViewStartColumn: s2, sheetViewStartRow: l4, duration: a4, screenRatioX: c2, screenRatioY: d2 } = e, u2 = n3.get(JE), h9 = u2.getRenderById(t3).with(Et3), m9 = u2.getRenderById(t3);
    if (!m9)
      return false;
    const g9 = m9.engine, f4 = g9.width, p3 = g9.height, v6 = c2 !== void 0 ? f4 * c2 + i : i, S = d2 !== void 0 ? p3 * d2 + o3 : o3;
    return h9.emitRawScrollParam({
      unitId: t3,
      sheetId: r,
      offsetX: v6,
      offsetY: S,
      sheetViewStartRow: l4,
      sheetViewStartColumn: s2,
      duration: a4
    }), true;
  }
};
var Ao3 = {
  id: "sheet.command.set-scroll-relative",
  type: Ls.COMMAND,
  // offsetXY derived from mouse wheel event
  // this._commandService.executeCommand(SetScrollRelativeCommand.id, { offsetY });
  handler: (n3, e) => __async(void 0, null, function* () {
    const t3 = n3.get(Ds), r = n3.get(br), i = n3.get(JE), o3 = P5(r);
    if (!o3) return false;
    const { unitId: s2, subUnitId: l4 } = o3, c2 = i.getRenderById(s2).with(Et3).getCurrentScrollState(), { offsetX: d2 = 0, offsetY: u2 = 0 } = e || {}, {
      sheetViewStartRow: h9 = 0,
      sheetViewStartColumn: m9 = 0,
      offsetX: g9 = 0,
      offsetY: f4 = 0
    } = c2 || {};
    return t3.executeCommand(or4.id, {
      unitId: s2,
      sheetId: l4,
      // why + ySplit? receiver - ySplit in scroll.operation.ts
      // sheetViewStartRow: sheetViewStartRow + ySplit,
      // sheetViewStartColumn: sheetViewStartColumn + xSplit,
      sheetViewStartRow: h9,
      sheetViewStartColumn: m9,
      offsetX: g9 + d2,
      // currentOffsetX + offsetX may be negative or over max
      offsetY: f4 + u2
    });
  })
};
var hn2 = {
  id: "sheet.command.scroll-view",
  type: Ls.COMMAND,
  handler: (n3, e) => {
    if (!e)
      return false;
    const t3 = n3.get(br), r = n3.get(JE), i = P5(t3);
    if (!i) return false;
    const { workbook: o3, worksheet: s2, unitId: l4 } = i, c2 = r.getRenderById(l4).with(Et3).getCurrentScrollState();
    if (!s2)
      return false;
    const { sheetViewStartRow: d2, sheetViewStartColumn: u2, offsetX: h9, offsetY: m9, duration: g9 } = e, {
      sheetViewStartColumn: f4,
      sheetViewStartRow: p3,
      offsetX: v6,
      offsetY: S
    } = c2 || {}, { xSplit: w6, ySplit: C } = i.worksheet.getConfig().freeze;
    return n3.get(Ds).syncExecuteCommand(or4.id, {
      unitId: o3.getUnitId(),
      sheetId: s2.getSheetId(),
      // why + ySplit? receiver - ySplit in scroll.operation.ts
      // sheetViewStartRow: sheetViewStartRow + ySplit,
      // sheetViewStartColumn: sheetViewStartColumn + xSplit,
      sheetViewStartRow: d2 != null ? d2 : p3 != null ? p3 : 0 + C,
      sheetViewStartColumn: u2 != null ? u2 : f4 != null ? f4 : 0 + w6,
      offsetX: h9 != null ? h9 : v6,
      offsetY: m9 != null ? m9 : S,
      duration: g9
    });
  }
};
var Xm = {
  id: "sheet.command.scroll-to-cell",
  type: Ls.COMMAND,
  handler: (n3, e) => {
    const t3 = n3.get(br);
    return n3.get(JE).getRenderById(t3.getCurrentUnitForType(we.UNIVER_SHEET).getUnitId()).with(Ri3).scrollToRange(e.range, e.forceTop, e.forceLeft);
  }
};
var gM = {
  id: "sheet.command.scroll-view-reset",
  type: Ls.COMMAND,
  handler: (n3) => __async(void 0, null, function* () {
    const e = n3.get(br), t3 = P5(e);
    if (!t3) return false;
    const { subUnitId: r, unitId: i } = t3;
    return n3.get(Ds).executeCommand(or4.id, {
      unitId: i,
      sheetId: r,
      sheetViewStartRow: 0,
      sheetViewStartColumn: 0
    });
  })
};
var _w = Object.getOwnPropertyDescriptor;
var Rw = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? _w(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var vh = (n3, e) => (t3, r) => e(t3, r, n3);
var Iw = (n3, e) => {
  const { unitId: t3, subUnitId: r, ranges: i } = n3, o3 = {}, s2 = e.getColumnManager();
  for (let l4 = 0; l4 < i.length; l4++) {
    const a4 = i[l4];
    for (let c2 = a4.startColumn; c2 < a4.endColumn + 1; c2++)
      o3[c2] = s2.getColumnWidth(c2);
  }
  return {
    unitId: t3,
    subUnitId: r,
    ranges: i,
    colWidth: o3
  };
};
var Ir4 = class extends Ve {
  constructor(n3, e) {
    super(), this._renderManagerService = n3, this._univerInstanceService = e;
  }
  getUndoRedoParamsOfColWidth(n3) {
    const e = { redos: [], undos: [] }, { _univerInstanceService: t3 } = this, r = P5(t3);
    if (!r) return e;
    const { unitId: i, subUnitId: o3, worksheet: s2 } = r, l4 = this._renderManagerService.getRenderById(i).with(he2);
    if (!l4.getCurrentParam()) return e;
    const { skeleton: a4 } = l4.getCurrentParam(), c2 = a4.calculateAutoWidthInRange(n3.ranges), d2 = {};
    for (const { col: m9, width: g9 } of c2)
      d2[m9] = g9;
    const u2 = {
      subUnitId: o3,
      unitId: i,
      ranges: n3.ranges,
      colWidth: d2
    }, h9 = Iw(u2, s2);
    return {
      undos: [
        {
          id: mt2.id,
          params: h9
        }
      ],
      redos: [
        {
          id: mt2.id,
          params: u2
        }
      ]
    };
  }
};
Ir4 = Rw([
  vh(0, JE),
  vh(1, Inject(br))
], Ir4);
var ls2 = {
  type: Ls.COMMAND,
  id: "sheet.command.set-col-auto-width",
  handler: (n3, e) => {
    const t3 = n3.get(Ds), r = n3.get(ra), i = n3.get(z), o3 = n3.get(br), s2 = P5(o3, e);
    if (!s2) return false;
    const { unitId: l4, subUnitId: a4 } = s2;
    let c2 = [];
    if (e != null && e.ranges)
      c2 = [...e.ranges];
    else {
      const g9 = i.getCurrentSelections();
      for (let f4 = 0; f4 < g9.length; f4++)
        c2.push(g9[f4].range);
    }
    if (!(c2 != null && c2.length))
      return false;
    const d2 = {
      unitId: l4,
      subUnitId: a4,
      ranges: c2
    }, { redos: u2, undos: h9 } = n3.get(Ir4).getUndoRedoParamsOfColWidth(d2);
    return po([...u2], t3).result ? (r.pushUndoRedo({
      unitID: l4,
      undoMutations: [...h9],
      redoMutations: [...u2]
    }), true) : false;
  }
};
var yw = Object.getOwnPropertyDescriptor;
var Mw = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? yw(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var jr4 = (n3, e) => (t3, r) => e(t3, r, n3);
var cl2 = class extends Ve {
  constructor(e, t3, r, i, o3, s2) {
    super();
    _2(this, "_editorUnitId", Fl);
    _2(this, "_editorIsDirty", false);
    _2(this, "_visibleParams", {
      visible: false,
      eventType: hb.Dblclick,
      unitId: ""
    });
    _2(this, "_currentEditCell", null);
    _2(this, "_currentEditCellState", null);
    _2(this, "_currentEditCellLayout", null);
    _2(this, "helpFunctionVisible$", new BehaviorSubject(true));
    _2(this, "_currentEditCellState$", new BehaviorSubject(null));
    _2(this, "currentEditCellState$", this._currentEditCellState$.asObservable());
    _2(this, "_currentEditCellLayout$", new BehaviorSubject(null));
    _2(this, "currentEditCellLayout$", this._currentEditCellLayout$.asObservable());
    _2(this, "currentEditCell$", this._currentEditCellState$.pipe(
      switchMap((e4) => this._currentEditCellLayout$.pipe(map((t4) => e4 && t4 ? __spreadValues(__spreadValues({}, e4), t4) : null)))
    ));
    _2(this, "_visibleParams$", new BehaviorSubject(this._visibleParams));
    _2(this, "visible$", this._visibleParams$.asObservable());
    _2(this, "_afterVisibleParams$", new BehaviorSubject(this._visibleParams));
    _2(this, "afterVisible$", this._afterVisibleParams$.asObservable());
    _2(this, "_forceKeepVisible$", new BehaviorSubject(false));
    _2(this, "forceKeepVisible$", this._forceKeepVisible$.asObservable());
    this._sheetInterceptorService = e, this._renderManagerService = t3, this._themeService = r, this._univerInstanceService = i, this._editorService = o3, this._contextService = s2, this.disposeWithMe(Be(() => {
      this._currentEditCellState$.complete(), this._currentEditCell = null;
    })), this._univerInstanceService.getTypeOfUnitDisposed$(we.UNIVER_SHEET).subscribe((l4) => {
      var a4;
      l4.getUnitId() === ((a4 = this._currentEditCellState) == null ? void 0 : a4.unitId) && this._clearCurrentEditCellState();
    });
  }
  refreshEditCellState() {
    const e = this.getLatestEditCellState();
    if (!e) {
      this._currentEditCellState = null, this._currentEditCellLayout = null, this._currentEditCellState$.next(null), this._currentEditCellLayout$.next(null);
      return;
    }
    const _a5 = e, { position: t3, scaleX: r, scaleY: i, canvasOffset: o3 } = _a5, s2 = __objRest(_a5, ["position", "scaleX", "scaleY", "canvasOffset"]);
    this._currentEditCellState = s2, this._currentEditCellLayout = { position: t3, scaleX: r, scaleY: i, canvasOffset: o3 }, this._currentEditCellState$.next(this._currentEditCellState), this._currentEditCellLayout$.next(this._currentEditCellLayout);
  }
  refreshEditCellPosition(e) {
    var C;
    const t3 = this._currentEditCell;
    if (t3 == null)
      return;
    const r = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET);
    if (!r) return;
    const i = this._renderManagerService.getRenderUnitById(r.getUnitId());
    if (!i) return;
    const o3 = (C = i.with(he2).getSkeletonParam(t3.sheetId)) == null ? void 0 : C.skeleton, s2 = i.with(gt);
    if (!o3 || !this._currentEditCellState) return;
    const { primary: l4, scene: a4, engine: c2 } = t3, d2 = $s2(o3, l4);
    if (d2 == null)
      return;
    const u2 = Xg(d2), h9 = dA2(c2);
    let { startX: m9, startY: g9, endX: f4, endY: p3 } = u2;
    const { scaleX: v6, scaleY: S } = a4.getAncestorScale(), w6 = a4.getViewportScrollXY(s2.getViewPort());
    m9 = aA(m9, v6, w6), g9 = rA(g9, S, w6), f4 = aA(f4, v6, w6), p3 = rA(p3, S, w6), e && this._currentEditCellLayout && (f4 = f4 - m9 + this._currentEditCellLayout.position.startX, p3 = p3 - g9 + this._currentEditCellLayout.position.startY, m9 = this._currentEditCellLayout.position.startX, g9 = this._currentEditCellLayout.position.startY), this._currentEditCellLayout = {
      position: {
        startX: m9,
        startY: g9,
        endX: f4,
        endY: p3
      },
      canvasOffset: h9,
      scaleX: v6,
      scaleY: S
    }, this._currentEditCellLayout$.next(this._currentEditCellLayout);
  }
  setEditCell(e) {
    this._currentEditCell = e, this._editorService.getFocusEditor() || (this._editorService.focus(Fl), this._contextService.setContextValue(pE, false), this._contextService.setContextValue(B1, false));
    const t3 = this.getLatestEditCellState();
    if (!t3) {
      this._currentEditCellState = t3, this._currentEditCellLayout = t3, this._currentEditCellState$.next(t3), this._currentEditCellLayout$.next(t3);
      return;
    }
    const _a5 = t3, { position: r, canvasOffset: i, scaleX: o3, scaleY: s2 } = _a5, l4 = __objRest(_a5, ["position", "canvasOffset", "scaleX", "scaleY"]);
    this._currentEditCellState = l4, this._currentEditCellLayout = { position: r, canvasOffset: i, scaleX: o3, scaleY: s2 }, this._currentEditCellState$.next(this._currentEditCellState), this._currentEditCellLayout$.next(this._currentEditCellLayout);
  }
  _clearCurrentEditCellState() {
    this._currentEditCellState = null, this._currentEditCellState$.next(null), this._currentEditCellLayout = null, this._currentEditCellLayout$.next(null);
  }
  getEditCellState() {
    return this._currentEditCellState == null || this._currentEditCellLayout == null ? null : __spreadValues(__spreadValues({}, this._currentEditCellState), this._currentEditCellLayout);
  }
  getEditCellLayout() {
    return this._currentEditCellLayout;
  }
  getEditLocation() {
    return this._currentEditCellState;
  }
  updateEditLocation(e, t3) {
    this._currentEditCellState && (this._currentEditCellState = __spreadProps(__spreadValues({}, this._currentEditCellState), {
      row: e,
      column: t3
    }));
  }
  // eslint-disable-next-line max-lines-per-function, complexity
  getLatestEditCellState() {
    var A4, x7, H6;
    const e = this._currentEditCell;
    if (e == null) return;
    const t3 = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET);
    if (!t3) return;
    const r = this._renderManagerService.getRenderUnitById(t3.getUnitId());
    if (!r) return;
    const i = r.with(he2).getCurrentSkeleton(), o3 = r.with(gt);
    if (!i) return;
    const { primary: s2, unitId: l4, sheetId: a4, scene: c2, engine: d2 } = e, { startRow: u2, startColumn: h9 } = s2, m9 = $s2(i, s2);
    if (m9 == null) return;
    const g9 = Xg(m9), f4 = dA2(d2);
    let { startX: p3, startY: v6, endX: S, endY: w6 } = g9;
    const { scaleX: C, scaleY: I6 } = c2.getAncestorScale(), R9 = c2.getViewportScrollXY(o3.getViewPort());
    p3 = aA(p3, C, R9), v6 = rA(v6, I6, R9), S = aA(S, C, R9), w6 = rA(w6, I6, R9);
    const y6 = t3.getActiveSheet();
    if (!y6) return;
    const E3 = {
      workbook: t3,
      worksheet: y6,
      unitId: t3.getUnitId(),
      subUnitId: y6.getSheetId(),
      row: u2,
      col: h9,
      origin: y6.getCellRaw(u2, h9)
    };
    let M10;
    const T10 = this._sheetInterceptorService.writeCellInterceptor.fetchThroughInterceptors(co3)(
      y6.getCell(u2, h9),
      E3
    );
    M10 = T10 && y6.getCellDocumentModelWithFormula(T10, E3.row, E3.col);
    const P8 = (A4 = M10 == null ? void 0 : M10.documentModel) == null ? void 0 : A4.documentStyle.renderConfig;
    if (P8 != null && (P8.cellValueType = mn.STRING), !M10 || M10.documentModel == null) {
      const V7 = y6.getBlankCellDocumentModel(T10, E3.row, E3.col);
      if (M10 != null) {
        const { verticalAlign: D5, horizontalAlign: B5, wrapStrategy: F7, textRotation: z5, fill: Z9 } = M10, { centerAngle: de3, vertexAngle: Re5 } = A3(z5);
        V7.documentModel.documentStyle.renderConfig = __spreadProps(__spreadValues({}, P8), {
          verticalAlign: D5,
          horizontalAlign: B5,
          wrapStrategy: F7,
          background: { rgb: Z9 },
          centerAngle: de3,
          vertexAngle: Re5
        });
      }
      M10 = V7;
    }
    if (M10.fill = M10.fill || "#fff", (x7 = M10.documentModel) == null || x7.setZoomRatio(Math.max(C, I6)), (T10 == null ? void 0 : T10.isInArrayFormulaRange) === true) {
      const V7 = (H6 = M10.documentModel) == null ? void 0 : H6.getBody();
      V7 && (V7.textRuns = [
        {
          st: 0,
          ed: V7.dataStream.length - 2,
          ts: {
            cl: {
              rgb: this._themeService.getColorFromTheme("gray.300")
            }
          }
        }
      ]);
    }
    return {
      position: {
        startX: p3,
        startY: v6,
        endX: S,
        endY: w6
      },
      scaleX: C,
      scaleY: I6,
      canvasOffset: f4,
      row: u2,
      column: h9,
      unitId: l4,
      sheetId: a4,
      documentLayoutObject: M10,
      editorUnitId: this._editorUnitId,
      isInArrayFormulaRange: T10 == null ? void 0 : T10.isInArrayFormulaRange
    };
  }
  getCurrentEditorId() {
    return this._editorUnitId;
  }
  changeVisible(e) {
    this._visibleParams = e, e.visible && (this._editorIsDirty = false), this._visibleParams$.next(this._visibleParams), this._afterVisibleParams$.next(this._visibleParams);
  }
  isVisible() {
    return this._visibleParams;
  }
  enableForceKeepVisible() {
    this._forceKeepVisible$.next(true);
  }
  disableForceKeepVisible() {
    this._forceKeepVisible$.next(false);
  }
  isForceKeepVisible() {
    return this._forceKeepVisible$.getValue();
  }
  changeEditorDirty(e) {
    this._editorIsDirty = e;
  }
  getEditorDirty() {
    return this._editorIsDirty;
  }
};
cl2 = Mw([
  jr4(0, Inject(G)),
  jr4(1, JE),
  jr4(2, Inject(Ji)),
  jr4(3, br),
  jr4(4, Ge3),
  jr4(5, Tr)
], cl2);
var Qe3 = createIdentifier("univer.sheet-editor-bridge.service");
var Ew = Object.getOwnPropertyDescriptor;
var Tw = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? Ew(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var _s3 = (n3, e) => (t3, r) => e(t3, r, n3);
var Ho2 = class extends Ve {
  constructor(e, t3, r, i, o3) {
    super();
    _2(this, "_zoom");
    this._context = e, this._sheetSkeletonManagerService = t3, this._commandService = r, this._contextService = i, this._editorBridgeService = o3, this._initSkeletonListener(), this._initZoomEventListener();
  }
  updateZoom(e, t3) {
    const r = this._context.unit.getSheetBySheetId(e);
    return r ? (r.getConfig().zoomRatio = t3, r === this._context.unit.getActiveSheet() && this._updateViewZoom(t3), true) : false;
  }
  _initZoomEventListener() {
    const e = $t4(this._context.unit, this._context).scene;
    this.disposeWithMe(
      // hold ctrl & mousewheel ---> zoom
      e.onMouseWheel$.subscribeEvent((t3) => {
        if (!t3.ctrlKey || !this._contextService.getContextValue(_r))
          return;
        if (this._editorBridgeService) {
          const c2 = this._editorBridgeService.isVisible();
          if ((c2.unitId === this._context.unitId || c2.unitId === Hl) && c2.visible)
            return;
        }
        const r = Math.abs(t3.deltaX);
        let i = r < 40 ? 0.2 : r < 80 ? 0.4 : 0.2;
        i *= t3.deltaY > 0 ? -1 : 1, e.scaleX < 1 && (i /= 2);
        const o3 = this._context.unit, s2 = o3.getActiveSheet();
        if (!s2) return;
        const l4 = s2.getZoomRatio();
        let a4 = +Number.parseFloat(`${l4 + i}`).toFixed(1);
        a4 = a4 >= 4 ? 4 : a4 <= 0.1 ? 0.1 : a4, this._commandService.executeCommand(cs3.id, {
          zoomRatio: Math.round(a4 * 10) / 10,
          unitId: o3.getUnitId(),
          subUnitId: s2.getSheetId()
        }), t3.preventDefault();
      })
    );
  }
  _initSkeletonListener() {
    this.disposeWithMe(this._sheetSkeletonManagerService.currentSkeleton$.subscribe((e) => {
      if (e == null)
        return;
      const r = this._context.unit.getActiveSheet();
      if (!r) return;
      const i = r.getZoomRatio() || 1;
      this._zoom !== i && this._updateViewZoom(i);
    }));
  }
  /**
   * Triggered when zoom and switch sheet.
   * @param zoomRatio
   */
  _updateViewZoom(e) {
    this._zoom = e;
    const t3 = $t4(this._context.unit, this._context);
    t3 == null || t3.scene.scale(e, e), t3 == null || t3.spreadsheet.makeForceDirty();
  }
};
Ho2 = Tw([
  _s3(1, Inject(he2)),
  _s3(2, Ds),
  _s3(3, Tr),
  _s3(4, Optional(Qe3))
], Ho2);
var Ln2 = {
  id: "sheet.operation.set-zoom-ratio",
  type: Ls.OPERATION,
  handler: (n3, e) => {
    const r = n3.get(JE).getRenderById(e.unitId);
    return r ? r.with(Ho2).updateZoom(e.subUnitId, e.zoomRatio) : false;
  }
};
var as2 = {
  id: "sheet.command.change-zoom-ratio",
  type: Ls.COMMAND,
  handler: (n3, e) => {
    if (!e)
      return false;
    const t3 = n3.get(br), r = P5(t3);
    if (!r) return false;
    const { worksheet: i, subUnitId: o3, unitId: s2 } = r, { delta: l4, reset: a4 } = e;
    let c2 = a4 ? 100 : Math.round((i.getConfig().zoomRatio + l4) * 100);
    c2 = Math.max(Xc3[0], c2), c2 = Math.min(Xc3[1], c2);
    const d2 = c2 / 100, h9 = n3.get(Qe3).isVisible();
    return (h9.unitId === s2 || h9.unitId === Hl) && h9.visible ? false : n3.get(Ds).executeCommand(Ln2.id, {
      unitId: s2,
      subUnitId: o3,
      zoomRatio: d2
    });
  }
};
var cs3 = {
  id: "sheet.command.set-zoom-ratio",
  type: Ls.COMMAND,
  handler: (n3, e) => {
    if (!e)
      return false;
    const { unitId: t3, subUnitId: r, zoomRatio: i } = e, s2 = n3.get(Qe3).isVisible();
    return (s2.unitId === t3 || s2.unitId === Hl) && s2.visible ? false : n3.get(Ds).executeCommand(Ln2.id, {
      unitId: t3,
      subUnitId: r,
      zoomRatio: i
    });
  }
};
var Lr4 = createIdentifier("univer.sheetbar-service");
var zm = class extends Ve {
  constructor() {
    super();
    _2(this, "renameId$");
    _2(this, "removeId$");
    _2(this, "scroll$");
    _2(this, "scrollX$");
    _2(this, "addSheet$");
    _2(this, "_renameId$");
    _2(this, "_removeId$");
    _2(this, "_scroll$");
    _2(this, "_scrollX$");
    _2(this, "_addSheet$");
    _2(this, "_currentHandler", null);
    this._renameId$ = new Subject(), this.renameId$ = this._renameId$.asObservable(), this._removeId$ = new Subject(), this.removeId$ = this._removeId$.asObservable(), this._scroll$ = new Subject(), this.scroll$ = this._scroll$.asObservable(), this._scrollX$ = new Subject(), this.scrollX$ = this._scrollX$.asObservable(), this._addSheet$ = new Subject(), this.addSheet$ = this._addSheet$.asObservable();
  }
  setRenameId(t3) {
    this._renameId$.next(t3);
  }
  setRemoveId(t3) {
    this._removeId$.next(t3);
  }
  setScroll(t3) {
    this._scroll$.next(t3);
  }
  setScrollX(t3) {
    this._scrollX$.next(t3);
  }
  setAddSheet(t3) {
    this._addSheet$.next(t3);
  }
  triggerSheetBarMenu() {
    var t3;
    (t3 = this._currentHandler) == null || t3.handleSheetBarMenu();
  }
  registerSheetBarMenuHandler(t3) {
    if (this._currentHandler)
      throw new Error("There is already a context menu handler!");
    return this._currentHandler = t3, Be(() => {
      this._currentHandler = null;
    });
  }
};
var Ea4 = {
  id: "ui-sheet.command.show-menu-list",
  type: Ls.OPERATION,
  handler: (n3) => __async(void 0, null, function* () {
    return n3.get(Lr4).triggerSheetBarMenu(), true;
  })
};
var Ta4 = {
  type: Ls.COMMAND,
  id: "sheet.command.delete-worksheet-protection-from-sheet-bar",
  handler(n3, e) {
    return __async(this, null, function* () {
      if (!e)
        return false;
      const t3 = n3.get(Ds), r = n3.get(ra), i = n3.get(lt3), s2 = n3.get(br).getCurrentUnitForType(Lm.UNIVER_SHEET), l4 = s2 == null ? void 0 : s2.getActiveSheet(), a4 = s2.getUnitId();
      if (!l4)
        return false;
      const c2 = l4.getSheetId(), d2 = i.getRule(a4, c2);
      if (yield t3.executeCommand(Rc.id, {
        unitId: a4,
        subUnitId: c2
      })) {
        const h9 = [{ id: Rc.id, params: { unitId: a4, subUnitId: c2 } }], m9 = [{ id: oc.id, params: { unitId: a4, rule: d2 } }];
        r.pushUndoRedo({
          unitID: a4,
          redoMutations: h9,
          undoMutations: m9
        });
      }
      return true;
    });
  }
};
var Pa4 = {
  type: Ls.COMMAND,
  id: "sheet.command.change-sheet-protection-from-sheet-bar",
  handler(n3) {
    return __async(this, null, function* () {
      return yield n3.get(Ds).executeCommand("sheet-permission.operation.openDialog"), true;
    });
  }
};
var su2 = {
  id: "sheet.operation.set-activate-cell-edit",
  type: Ls.OPERATION,
  handler: (n3, e) => (n3.get(Qe3).setEditCell(e), true)
};
var tt5 = {
  id: "sheet.operation.set-cell-edit-visible",
  type: Ls.OPERATION,
  handler: (n3, e) => {
    if (!e)
      return false;
    const { unitId: t3 } = e, i = n3.get(br).getCurrentUnitForType(we.UNIVER_SHEET);
    return i ? (n3.get(Qe3).changeVisible(__spreadProps(__spreadValues({}, e), {
      unitId: t3 != null ? t3 : i.getUnitId()
    })), true) : false;
  }
};
var xa3 = {
  id: "sheet.operation.set-cell-edit-visible-f2",
  type: Ls.OPERATION,
  handler: (n3, e) => {
    const t3 = n3.get(Ds), i = n3.get(br).getCurrentUnitForType(we.UNIVER_SHEET);
    return i ? t3.syncExecuteCommand(tt5.id, __spreadProps(__spreadValues({}, e), {
      unitId: i.getUnitId()
    })) : false;
  }
};
var Ii2 = {
  id: "sheet.operation.set-cell-edit-visible-arrow",
  type: Ls.OPERATION,
  handler: () => true
};
var Oa3 = {
  id: "sheet.operation.rename-sheet",
  type: Ls.OPERATION,
  handler: (n3, e) => __async(void 0, null, function* () {
    const t3 = n3.get(Lr4);
    return e && t3.setRenameId(e.subUnitId), true;
  })
};
var lu2 = {
  id: "sheet.operation.scroll-to-range",
  type: Ls.OPERATION,
  handler: (n3, e) => {
    if (!e)
      return false;
    const t3 = n3.get(br);
    return n3.get(JE).getRenderById(t3.getCurrentUnitForType(we.UNIVER_SHEET).getUnitId()).with(Ri3).scrollToRange(e.range, e.forceTop, e.forceLeft);
  }
};
var jm = {
  type: Ls.OPERATION,
  id: "sheet-permission.operation.openDialog",
  handler(n3, e) {
    return __async(this, null, function* () {
      const t3 = n3.get(ct2);
      return t3.close("DESKTOP_FIND_REPLACE_DIALOG"), t3.open({
        id: ll2,
        title: { title: "permission.dialog.allowedPermissionType" },
        children: { label: Bm2 },
        width: 393,
        destroyOnClose: true,
        onClose: () => t3.close(ll2)
      }), true;
    });
  }
};
var Vo3 = "DefinedNameContainer";
var au2 = {
  id: "sidebar.operation.defined-name",
  type: Ls.COMMAND,
  handler: (n3, e) => __async(void 0, null, function* () {
    const t3 = n3.get(be2);
    n3.get(Ge3);
    const r = n3.get(Hn), i = n3.get(br), o3 = P5(i);
    if (!o3) return false;
    const { unitId: s2 } = o3;
    switch (e.value) {
      case "open":
        t3.open({
          id: Vo3,
          header: { title: r.t("definedName.featureTitle") },
          children: { label: Vo3 },
          onClose: () => {
          },
          width: 333
        });
        break;
      case "close":
      default:
        t3.close();
        break;
    }
    return true;
  })
};
function Pw(n3, e) {
  if (n3.length !== e.length) return false;
  const t3 = n3.sort((i, o3) => i.id.localeCompare(o3.id)), r = e.sort((i, o3) => i.id.localeCompare(o3.id));
  return t3.every((i, o3) => {
    var s2, l4;
    return ((s2 = i.subject) == null ? void 0 : s2.userID) === ((l4 = r[o3].subject) == null ? void 0 : l4.userID) && i.role === r[o3].role;
  });
}
function Ym(n3, e) {
  return e.some((t3) => xw(n3, t3));
}
function xw(n3, e) {
  const { startRow: t3, startColumn: r, endColumn: i, endRow: o3 } = e, s2 = n3.getMatrixWithMergedCells(t3, r, o3, i);
  let l4 = false;
  return s2.forValue((a4, c2, d2) => {
    if (d2 && (a4 !== t3 || c2 !== r) && n3.cellHasValue(d2))
      return l4 = true, false;
  }), l4;
}
function Zm2(n3, e, t3, r) {
  const i = [], o3 = [], s2 = t3.getSheetId();
  return r.forEach((l4) => {
    const a4 = Ow(t3, l4), c2 = {
      unitId: e,
      subUnitId: s2,
      cellValue: a4.getData()
    }, d2 = Ae4(
      n3,
      c2
    );
    i.push({ id: ee2.id, params: d2 }), o3.push({ id: ee2.id, params: c2 });
  }), {
    undos: i,
    redos: o3
  };
}
function Ow(n3, e) {
  const { startRow: t3, startColumn: r, endColumn: i, endRow: o3 } = e, s2 = n3.getMatrixWithMergedCells(t3, r, o3, i, ar.Raw), l4 = new ht();
  let a4 = null;
  return s2.forValue((c2, d2, u2) => {
    var h9, m9, g9, f4;
    u2 && c2 >= t3 && d2 >= r && (!a4 && n3.cellHasValue(u2) && (u2.v !== "" || ((f4 = (g9 = (m9 = (h9 = u2.p) == null ? void 0 : h9.body) == null ? void 0 : m9.dataStream) == null ? void 0 : g9.length) != null ? f4 : 0) > 2) && (a4 = u2), l4.setValue(c2, d2, null));
  }), l4.setValue(t3, r, a4), l4;
}
function Aw(n3, e, t3, r) {
  const i = t3.getActiveViewportByCoord(
    U.FromArray([n3, e])
  );
  if (!i)
    return;
  const { scaleX: o3, scaleY: s2 } = t3.getAncestorScale(), l4 = {
    x: i.viewportScrollX,
    y: i.viewportScrollY
  }, a4 = r.getCellIndexByOffset(n3, e, o3, s2, l4), c2 = r.worksheet.getMergedCell(a4.row, a4.column);
  return {
    actualRow: c2 ? c2.startRow : a4.row,
    actualCol: c2 ? c2.startColumn : a4.column,
    mergeCell: c2,
    row: a4.row,
    col: a4.column
  };
}
function Sh2(n3, e, t3, r) {
  const i = r.getFreeze();
  if (!i || i.startRow <= 0 && i.startColumn <= 0)
    return t3.getViewport(k2.VIEW_MAIN);
  if (n3 >= i.startRow && e >= i.startColumn)
    return t3.getViewport(k2.VIEW_MAIN);
  if (n3 < i.startRow && e < i.startColumn)
    return t3.getViewport(k2.VIEW_MAIN_LEFT_TOP);
  if (n3 < i.startRow && e >= i.startColumn)
    return t3.getViewport(k2.VIEW_MAIN_TOP);
  if (n3 >= i.startRow && e < i.startColumn)
    return t3.getViewport(k2.VIEW_MAIN_LEFT);
}
function Hw(n3, e, t3, r) {
  const i = Ch2(n3.left, n3.top, e, t3, r), o3 = Ch2(n3.right, n3.bottom, e, t3, r);
  return {
    left: i.x,
    top: i.y,
    right: o3.x,
    bottom: o3.y
  };
}
function Ch2(n3, e, t3, r, i) {
  const { scaleX: o3, scaleY: s2 } = t3.getAncestorScale(), l4 = t3.getViewport(k2.VIEW_MAIN);
  if (!l4)
    return {
      x: n3,
      y: e
    };
  const a4 = i.getFreeze(), { startColumn: c2, startRow: d2, xSplit: u2, ySplit: h9 } = a4, m9 = r.getNoMergeCellWithCoordByIndex(d2 - h9, c2 - u2, false), g9 = r.getNoMergeCellWithCoordByIndex(d2, c2, false), { rowHeaderWidth: f4, columnHeaderHeight: p3 } = r, v6 = g9.startX - m9.startX, S = g9.startY - m9.startY, { top: w6, left: C, viewportScrollX: I6, viewportScrollY: R9 } = l4;
  let y6;
  n3 > C ? y6 = (n3 - I6) * o3 : y6 = (v6 + f4 - (C - n3)) * o3;
  let E3;
  return e > w6 ? E3 = (e - R9) * s2 : E3 = (S + p3 - (w6 - e)) * o3, {
    x: y6,
    y: E3
  };
}
function Vw(n3, e, t3, r, i) {
  let o3 = r, s2 = i;
  t3.overflowCache.forValue((c2, d2, u2) => {
    u2.startRow <= o3 && u2.endRow >= o3 && u2.startColumn <= s2 && u2.endColumn >= s2 && (s2 = d2, o3 = c2);
  });
  const l4 = t3.getCellWithCoordByIndex(o3, s2);
  return {
    unitId: n3.getUnitId(),
    subUnitId: e.getSheetId(),
    workbook: n3,
    worksheet: e,
    row: l4.actualRow,
    col: l4.actualColumn
  };
}
function Gm(n3, e, t3, r, i, o3) {
  const { scene: s2 } = n3, l4 = e.getUnitId(), { skeleton: a4, sheetId: c2 } = r, d2 = Aw(i, o3, s2, a4);
  if (!d2)
    return null;
  let { actualCol: u2, actualRow: h9 } = d2;
  const m9 = {
    unitId: l4,
    subUnitId: c2,
    workbook: e,
    worksheet: t3,
    row: h9,
    col: u2
  };
  a4.overflowCache.forValue((R9, y6, E3) => {
    E3.startRow <= h9 && E3.endRow >= h9 && E3.startColumn <= u2 && E3.endColumn >= u2 && (u2 = y6, h9 = R9);
  });
  const g9 = a4.getCellWithCoordByIndex(h9, u2), f4 = Vw(e, t3, a4, h9, u2);
  let p3;
  g9.mergeInfo ? p3 = g9.mergeInfo : p3 = {
    startRow: f4.row,
    endRow: f4.row,
    startColumn: f4.col,
    endColumn: f4.col
  };
  const v6 = s2.getActiveViewportByCoord(
    U.FromArray([i, o3])
  );
  if (!v6)
    return;
  const { scaleX: S, scaleY: w6 } = s2.getAncestorScale(), C = {
    x: v6.viewportScrollX,
    y: v6.viewportScrollY
  };
  return {
    position: {
      startX: (a4.getOffsetByColumn(p3.startColumn - 1) - C.x) * S,
      endX: (a4.getOffsetByColumn(p3.endColumn) - C.x) * S,
      startY: (a4.getOffsetByRow(p3.startRow - 1) - C.y) * w6,
      endY: (a4.getOffsetByRow(p3.endRow) - C.y) * w6
    },
    location: m9,
    overflowLocation: f4
  };
}
function Wr4() {
  const n3 = useDependency(br), e = useObservable(() => n3.getCurrentTypeOfUnit$(we.UNIVER_SHEET), void 0, void 0, []);
  return e != null ? e : null;
}
function mM(n3) {
  return useObservable(() => {
    var t3;
    return (t3 = n3 == null ? void 0 : n3.activeSheet$) != null ? t3 : of(null);
  }, void 0, void 0, [n3]);
}
function fM() {
  const n3 = useDependency(br);
  return useObservable(() => merge([
    n3.getTypeOfUnitAdded$(we.UNIVER_SHEET),
    n3.getTypeOfUnitDisposed$(we.UNIVER_SHEET)
  ]).pipe(
    map(() => n3.getAllUnitsForType(we.UNIVER_SHEET)),
    startWith(n3.getAllUnitsForType(we.UNIVER_SHEET))
  ), [], void 0, [n3]);
}
var pM = "SheetUI";
var qm = ((n3) => (n3.FILTER_PANEL_EMBED_POINT = "filter-panel-embed-point", n3.SHEETS_FOOTER = "sheets-footer", n3.FORMULA_AUX = "formula-aux", n3))(qm || {});
var Nw = Object.getOwnPropertyDescriptor;
var kw = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? Nw(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var Rs3 = (n3, e) => (t3, r) => e(t3, r, n3);
var wh2 = "univer-sheet-main-canvas";
var rr4 = class extends ER {
  constructor(e, t3, r, i) {
    super();
    _2(this, "_skeletonChangeMutations", /* @__PURE__ */ new Set());
    this._contextService = e, this._instanceSrv = t3, this._renderManagerService = r, this._themeService = i, Promise.resolve().then(() => this._init());
  }
  /**
   * Register a mutation id that will trigger the skeleton change.
   *
   * @param mutationId the id of the mutation
   * @returns a disposable to unregister the mutation
   */
  registerSkeletonChangingMutations(e) {
    return this._skeletonChangeMutations.has(e) ? Be(() => {
    }) : (this._skeletonChangeMutations.add(e), Be(() => this._skeletonChangeMutations.delete(e)));
  }
  /**
   * Examine if a mutation would make the skeleton to change.
   */
  checkMutationShouldTriggerRerender(e) {
    return this._skeletonChangeMutations.has(e);
  }
  _init() {
    this._initWorkbookListener(), this._initContextListener();
  }
  _initWorkbookListener() {
    this._instanceSrv.getTypeOfUnitAdded$(we.UNIVER_SHEET).pipe(takeUntil(this.dispose$)).subscribe((e) => this._createRenderer(e)), this._instanceSrv.getAllUnitsForType(we.UNIVER_SHEET).forEach((e) => this._createRenderer(e)), this._instanceSrv.getTypeOfUnitDisposed$(we.UNIVER_SHEET).pipe(takeUntil(this.dispose$)).subscribe((e) => this._disposeRenderer(e));
  }
  _createRenderer(e) {
    const t3 = e.getUnitId();
    this._renderManagerService.created$.subscribe((r) => {
      r.unitId === t3 && (r.engine.getCanvas().setId(`${wh2}_${t3}`), r.engine.getCanvas().getContext().setId(`${wh2}_${t3}`));
    }), this._renderManagerService.createRender(t3);
  }
  _disposeRenderer(e) {
    const t3 = e.getUnitId();
    this._renderManagerService.removeRender(t3);
  }
  _initContextListener() {
    this.disposeWithMe(this._contextService.subscribeContextValue$(Sx).pipe(distinctUntilChanged()).subscribe(() => {
      this._renderManagerService.getRenderAll().forEach((e) => {
        e.mainComponent instanceof dA && e.mainComponent.makeForceDirty(true);
      });
    }));
  }
};
rr4 = kw([
  Rs3(0, Tr),
  Rs3(1, br),
  Rs3(2, JE),
  Rs3(3, Inject(Ji))
], rr4);
var Dw = Object.getOwnPropertyDescriptor;
var Lw = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? Dw(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var lr4 = (n3, e) => (t3, r) => e(t3, r, n3);
var yi3 = class extends Ve {
  constructor(e, t3, r, i, o3, s2, l4) {
    super();
    _2(this, "_beforeApplyData", []);
    _2(this, "_currentLocation", null);
    _2(this, "_copyData", []);
    _2(this, "_defaultHook");
    this._univerInstanceService = e, this._commandService = t3, this._autoFillService = r, this._editorBridgeService = i, this._renderManagerService = o3, this._injector = s2, this._sheetsRenderService = l4, this._defaultHook = {
      id: "default",
      type: ti3.Default,
      priority: 0,
      onBeforeFillData: (a4, c2) => this._presetAndCacheData(a4, c2),
      onFillData: (a4, c2, d2) => this._fillData(a4, c2, d2)
    }, this._init();
  }
  _init() {
    this._initDefaultHook(), this._initSelectionControlFillChanged(), this._initQuitListener(), this._initSkeletonChange();
  }
  _initSkeletonChange() {
    this.disposeWithMe(this._sheetsRenderService.registerSkeletonChangingMutations(gr5.id));
  }
  _initDefaultHook() {
    this.disposeWithMe(this._autoFillService.addHook(this._defaultHook));
  }
  _initQuitListener() {
    const e = [
      tt5.id,
      yo2.id,
      Sn2.id,
      Ln2.id,
      pn.id,
      wt2.id,
      Te.id,
      Me.id,
      ke2.id,
      Ue2.id,
      Je3.id,
      qe2.id,
      mt2.id,
      nt2.id,
      ee2.id
    ];
    this.disposeWithMe(this._commandService.onCommandExecuted((t3, r) => {
      var l4, a4;
      const i = r == null ? void 0 : r.fromCollab, o3 = r == null ? void 0 : r.fromSync, s2 = r == null ? void 0 : r.fromFormula;
      e.includes(t3.id) && !i && !o3 && !s2 && t3.params.trigger !== gr5.id && t3.params.trigger !== wa3.id && this._quit(), t3.id === Lt2.id && t3.params.unitId === ((l4 = this._currentLocation) == null ? void 0 : l4.unitId) && t3.params.subUnitId === ((a4 = this._currentLocation) == null ? void 0 : a4.subUnitId) && this._quit();
    })), this.disposeWithMe(this._univerInstanceService.unitDisposed$.subscribe((t3) => {
      var r;
      t3.getUnitId() === ((r = this._currentLocation) == null ? void 0 : r.unitId) && this._quit();
    }));
  }
  _quit() {
    this._currentLocation = null, this._beforeApplyData = [], this._copyData = [], this._autoFillService.setShowMenu(false);
  }
  _initSelectionControlFillChanged() {
    const e = new ho(), t3 = () => {
      e.dispose();
      const r = eF(we.UNIVER_SHEET, this._univerInstanceService, this._renderManagerService);
      if (!r) return;
      r.with(gt).getSelectionControls().forEach((s2) => {
        e.add(s2.selectionFilled$.subscribe((l4) => {
          if (l4 == null || l4.startColumn === -1 || l4.startRow === -1 || l4.endColumn === -1 || l4.endRow === -1)
            return;
          const a4 = {
            startColumn: s2.model.startColumn,
            endColumn: s2.model.endColumn,
            startRow: s2.model.startRow,
            endRow: s2.model.endRow
          }, c2 = {
            startColumn: l4.startColumn,
            endColumn: l4.endColumn,
            startRow: l4.startRow,
            endRow: l4.endRow
          };
          this._commandService.executeCommand(gr5.id, { sourceRange: a4, targetRange: c2 });
        })), e.add(s2.fillControl.onDblclick$.subscribeEvent(() => {
          const l4 = {
            startColumn: s2.model.startColumn,
            endColumn: s2.model.endColumn,
            startRow: s2.model.startRow,
            endRow: s2.model.endRow
          };
          this._handleDbClickFill(l4);
        })), e.add(s2.fillControl.onPointerDown$.subscribeEvent(() => {
          this._editorBridgeService.isVisible().visible && this._commandService.syncExecuteCommand(
            tt5.id,
            {
              visible: false,
              eventType: hb.PointerDown,
              unitId: r.unitId
            }
          );
        }));
      });
    };
    t3(), this.disposeWithMe(this._commandService.onCommandExecuted((r) => {
      r.id === ie5.id && t3();
    })), this.disposeWithMe(this._univerInstanceService.getCurrentTypeOfUnit$(we.UNIVER_SHEET).subscribe(() => t3()));
  }
  _handleDbClickFill(e) {
    const t3 = this._detectFillRange(e);
    t3.endRow <= e.endRow || this._commandService.executeCommand(gr5.id, { sourceRange: e, targetRange: t3 });
  }
  _detectFillRange(e) {
    var u2, h9, m9, g9, f4, p3;
    const { startRow: t3, endRow: r, startColumn: i, endColumn: o3 } = e, s2 = (u2 = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET)) == null ? void 0 : u2.getActiveSheet();
    if (!s2)
      return e;
    const l4 = s2.getCellMatrix(), a4 = s2.getMaxRows() - 1, c2 = s2.getMaxColumns() - 1;
    let d2 = r;
    if (i > 0 && ((h9 = l4.getValue(t3, i - 1)) == null ? void 0 : h9.v) != null) {
      let v6 = t3;
      for (; ((m9 = l4.getValue(v6, i - 1)) == null ? void 0 : m9.v) != null && v6 < a4; )
        v6 += 1;
      d2 = v6 - 1;
    } else if (o3 < c2 && ((g9 = l4.getValue(r, o3 + 1)) == null ? void 0 : g9.v) != null) {
      let v6 = t3;
      for (; ((f4 = l4.getValue(v6, o3 + 1)) == null ? void 0 : f4.v) != null && v6 < a4; )
        v6 += 1;
      d2 = v6 - 1;
    }
    for (let v6 = r + 1; v6 <= d2; v6++)
      for (let S = i; S <= o3; S++)
        if (((p3 = l4.getValue(v6, S)) == null ? void 0 : p3.v) != null) {
          d2 = v6 - 1;
          break;
        }
    return {
      startColumn: i,
      endColumn: o3,
      startRow: t3,
      endRow: d2
    };
  }
  // calc apply data according to copy data and direction
  _getApplyData(e, t3, r, i, o3, s2 = true, l4) {
    const a4 = [], c2 = Math.floor(r / t3), d2 = r % t3, u2 = this._autoFillService.getRules();
    if (!s2 && o3 === Le4.ONLY_FORMAT)
      return console.error("ERROR: only format can not be applied when hasStyle is false"), [];
    const h9 = {};
    u2.forEach((m9) => {
      h9[m9.type] = [];
    }), u2.forEach((m9) => {
      const { type: g9, applyFunctions: f4 = {} } = m9, p3 = e[g9];
      p3 && p3.forEach((v6) => {
        const S = i1(v6.index, d2), w6 = v6.index.length * c2 + S, C = this._applyFunctions(
          v6,
          w6,
          i,
          o3,
          f4,
          e,
          l4
        ), I6 = o1(t3, r, v6.index);
        h9[g9].push({ data: C, index: I6 });
      });
    });
    for (let m9 = 0; m9 < r; m9++)
      u2.forEach((g9) => {
        const { type: f4 } = g9, p3 = h9[f4];
        for (let v6 = 0; v6 < p3.length; v6++)
          m9 in p3[v6].index && a4.push(p3[v6].data[p3[v6].index[m9]]);
      });
    return a4;
  }
  _applyFunctions(e, t3, r, i, o3, s2, l4) {
    const { data: a4 } = e, c2 = r === wm.UP || r === wm.LEFT;
    if (i === Le4.COPY) {
      const d2 = o3 == null ? void 0 : o3[Le4.COPY];
      return d2 ? d2(e, t3, r, s2, l4) : (c2 && a4.reverse(), br6(a4, t3));
    }
    if (i === Le4.SERIES) {
      const d2 = o3 == null ? void 0 : o3[Le4.SERIES];
      return d2 ? d2(e, t3, r, s2) : (c2 && a4.reverse(), o3 != null && o3[Le4.COPY] ? o3[Le4.COPY](e, t3, r, s2, l4) : br6(a4, t3));
    }
    if (i === Le4.ONLY_FORMAT) {
      const d2 = o3 == null ? void 0 : o3[Le4.ONLY_FORMAT];
      return d2 ? d2(e, t3, r, s2) : s12(a4, t3);
    }
  }
  _getCopyData(e, t3) {
    var m9;
    const { unitId: r, subUnitId: i, source: o3 } = e, s2 = (m9 = this._univerInstanceService.getUnit(r)) == null ? void 0 : m9.getSheetBySheetId(i);
    if (!s2)
      throw new Error("No worksheet found");
    const l4 = s2.getCellMatrix(), a4 = this._autoFillService.getRules(), c2 = [], d2 = t3 === wm.DOWN || t3 === wm.UP;
    let u2, h9;
    return d2 ? (u2 = o3.cols, h9 = o3.rows) : (u2 = o3.rows, h9 = o3.cols), u2.forEach((g9) => {
      const f4 = this._getEmptyCopyDataPiece(), p3 = {
        type: void 0,
        cellData: void 0
      };
      h9.forEach((v6) => {
        let S;
        d2 ? S = l4.getValue(v6, g9) : S = l4.getValue(g9, v6);
        const { type: w6, isContinue: C } = a4.find((I6) => I6.match(S, this._injector)) || Em;
        if (C(p3, S)) {
          const I6 = f4[w6], R9 = I6[I6.length - 1];
          R9.data.push(S), R9.index.push(v6 - h9[0]);
        } else {
          const I6 = f4[w6];
          I6 ? I6.push({
            data: [S],
            index: [v6 - h9[0]]
          }) : f4[w6] = [
            {
              data: [S],
              index: [v6 - h9[0]]
            }
          ];
        }
        p3.type = w6, p3.cellData = S;
      }), c2.push(f4);
    }), c2;
  }
  _getEmptyCopyDataPiece() {
    const e = {};
    return this._autoFillService.getRules().forEach((t3) => {
      e[t3.type] = [];
    }), e;
  }
  _getMergeApplyData(e, t3, r, i, o3) {
    var d2;
    const { unitId: s2, subUnitId: l4 } = o3, a4 = (d2 = this._univerInstanceService.getUnit(s2)) == null ? void 0 : d2.getSheetBySheetId(l4);
    if (!a4)
      throw new Error("No active sheet found");
    const c2 = [];
    for (let u2 = e.startRow; u2 <= e.endRow; u2++)
      for (let h9 = e.startColumn; h9 <= e.endColumn; h9++) {
        const { isMergedMainCell: m9, startRow: g9, startColumn: f4, endRow: p3, endColumn: v6 } = a4.getCellInfoInMergeData(u2, h9);
        if (m9) {
          if (r === wm.DOWN) {
            let S = g9 + i, w6 = p3 + i;
            for (; w6 <= t3.endRow; )
              c2.push({
                startRow: S,
                startColumn: f4,
                endRow: w6,
                endColumn: v6
              }), S += i, w6 += i;
          } else if (r === wm.UP) {
            let S = g9 - i, w6 = p3 - i;
            for (; S >= t3.startRow; )
              c2.push({
                startRow: S,
                startColumn: f4,
                endRow: w6,
                endColumn: v6
              }), S -= i, w6 -= i;
          } else if (r === wm.RIGHT) {
            let S = f4 + i, w6 = v6 + i;
            for (; w6 <= t3.endColumn; )
              c2.push({
                startRow: g9,
                startColumn: S,
                endRow: p3,
                endColumn: w6
              }), S += i, w6 += i;
          } else if (r === wm.LEFT) {
            let S = f4 - i, w6 = v6 - i;
            for (; S >= t3.startColumn; )
              c2.push({
                startRow: g9,
                startColumn: S,
                endRow: p3,
                endColumn: w6
              }), S -= i, w6 -= i;
          }
        }
      }
    return c2;
  }
  _presetAndCacheData(e, t3) {
    var c2;
    const { unitId: r, subUnitId: i, target: o3 } = e, s2 = (c2 = this._univerInstanceService.getUnit(r)) == null ? void 0 : c2.getSheetBySheetId(i);
    if (!s2)
      throw new Error("No active sheet found");
    const l4 = s2.getCellMatrix(), a4 = [];
    return o3.rows.forEach((d2) => {
      const u2 = [];
      o3.cols.forEach((h9) => {
        u2.push(Z.deepClone(l4.getValue(d2, h9)));
      }), a4.push(u2);
    }), this._beforeApplyData = a4, this._copyData = this._getCopyData(e, t3), this._currentLocation = e, this._shouldDisableSeries(this._copyData) ? (this._autoFillService.setDisableApplyType(Le4.SERIES, true), Le4.COPY) : (this._autoFillService.setDisableApplyType(Le4.SERIES, false), this._getPreferredApplyType(this._copyData));
  }
  // auto fill entry
  // eslint-disable-next-line max-lines-per-function
  _fillData(e, t3, r) {
    var A4, x7, H6;
    const i = [], o3 = [];
    let s2 = true;
    r === Le4.NO_FORMAT && (s2 = false, r = Le4.SERIES);
    const { source: l4, target: a4, unitId: c2, subUnitId: d2 } = e;
    if (!l4 || !a4 || t3 == null)
      return {
        undos: i,
        redos: o3
      };
    const u2 = Cr3(l4), h9 = Cr3(a4), { cols: m9, rows: g9 } = a4, { cols: f4, rows: p3 } = l4, v6 = this._copyData;
    let S;
    t3 === wm.DOWN || t3 === wm.UP ? S = p3.length : S = f4.length;
    const w6 = [];
    if (t3 === wm.DOWN || t3 === wm.UP) {
      const V7 = g9.length, D5 = [];
      m9.forEach((B5, F7) => {
        const z5 = v6[F7], Z9 = this._getApplyData(z5, S, V7, t3, r, s2, e);
        D5.push(Z9);
      });
      for (let B5 = 0; B5 < D5[0].length; B5++) {
        const F7 = [];
        for (let z5 = 0; z5 < D5.length; z5++)
          F7.push(__spreadValues({
            s: null
          }, D5[z5][B5]));
        w6.push(F7);
      }
    } else {
      const V7 = m9.length;
      g9.forEach((D5, B5) => {
        const F7 = v6[B5], z5 = this._getApplyData(F7, S, V7, t3, r, s2, e), Z9 = [];
        for (let de3 = 0; de3 < z5.length; de3++)
          Z9.push(__spreadValues({
            s: null
          }, z5[de3]));
        w6.push(Z9);
      });
    }
    let C = [];
    const I6 = (A4 = this._univerInstanceService.getUnit(c2)) == null ? void 0 : A4.getStyles();
    if (s2 ? (C = this._getMergeApplyData(u2, h9, t3, S, e), w6.forEach((V7) => {
      V7.forEach((D5) => {
        D5 && I6 && I6 && (D5.s = I6.getStyleByCell(D5));
      });
    })) : w6.forEach((V7, D5) => {
      V7.forEach((B5, F7) => {
        B5 && I6 && (B5.s = I6.getStyleByCell(this._beforeApplyData[D5][F7]) || null);
      });
    }), r === Le4.ONLY_FORMAT && w6.forEach((V7, D5) => {
      V7.forEach((B5, F7) => {
        if (B5) {
          const z5 = this._beforeApplyData[D5][F7] || {};
          B5.f = z5.f, B5.si = z5.si, B5.t = z5.t, B5.v = z5.v;
        }
      });
    }), s2) {
      const V7 = [], D5 = (H6 = (x7 = this._univerInstanceService.getUniverSheetInstance(c2)) == null ? void 0 : x7.getSheetBySheetId(d2)) == null ? void 0 : H6.getMergeData();
      D5 && D5.forEach((z5) => {
        Cn.intersects(z5, h9) && V7.push(z5);
      });
      const B5 = {
        unitId: c2,
        subUnitId: d2,
        ranges: V7
      }, F7 = this._injector.invoke(
        ye3,
        B5
      );
      V7.length && (o3.push({ id: se2.id, params: B5 }), i.unshift({ id: ne.id, params: F7 }));
    }
    const R9 = {
      subUnitId: d2,
      unitId: c2,
      cellValue: KC([a4])
    }, y6 = this._injector.invoke(
      Ae4,
      R9
    );
    o3.push({ id: ee2.id, params: R9 }), i.unshift({ id: ee2.id, params: y6 });
    const E3 = new ht();
    g9.forEach((V7, D5) => {
      m9.forEach((B5, F7) => {
        w6[D5][F7] && E3.setValue(V7, B5, w6[D5][F7]);
      });
    });
    const M10 = E3.getMatrix(), T10 = {
      subUnitId: d2,
      unitId: c2,
      cellValue: M10
    }, P8 = this._injector.invoke(
      Ae4,
      T10
    );
    if (this._autoFillService.getActiveHooks().forEach((V7) => {
      var D5;
      (D5 = V7.onBeforeSubmit) == null || D5.call(V7, e, t3, r, M10);
    }), i.unshift({ id: ee2.id, params: P8 }), o3.push({ id: ee2.id, params: T10 }), C != null && C.length) {
      const V7 = Jr3(C), D5 = {
        unitId: c2,
        subUnitId: d2,
        ranges: V7
      }, B5 = this._injector.invoke(
        We3,
        D5
      );
      i.unshift({ id: se2.id, params: B5 }), o3.push({ id: ne.id, params: D5 });
    }
    return {
      undos: i,
      redos: o3
    };
  }
  _shouldDisableSeries(e) {
    return e.every(
      (t3) => Object.keys(t3).every(
        (r) => {
          var i;
          return ((i = t3[r]) == null ? void 0 : i.length) === 0 || [mt4.OTHER, mt4.FORMULA].includes(r);
        }
      )
    );
  }
  _getPreferredApplyType(e) {
    return e.every(
      (r) => Object.keys(r).every(
        (i) => {
          var o3, s2;
          return ((o3 = r[i]) == null ? void 0 : o3.length) === 0 || ((s2 = r[i]) == null ? void 0 : s2.length) === 1 && r[i][0].data.length === 1 && mt4.NUMBER === i;
        }
      )
    ) ? Le4.COPY : Le4.SERIES;
  }
};
yi3 = Lw([
  lr4(0, br),
  lr4(1, Ds),
  lr4(2, Nr3),
  lr4(3, Qe3),
  lr4(4, JE),
  lr4(5, Inject(Injector)),
  lr4(6, Inject(rr4))
], yi3);
var Ww = Object.getOwnPropertyDescriptor;
var Bw = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? Ww(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var Xa2 = (n3, e) => (t3, r) => e(t3, r, n3);
var dl2 = class extends Ve {
  constructor(e, t3, r, i) {
    super();
    _2(this, "_enterActiveRender");
    this._context = e, this._sheetSkeletonManagerService = t3, this._renderManagerService = r, this._permissionService = i, this._initEventBinding();
  }
  // eslint-disable-next-line max-lines-per-function
  _initEventBinding() {
    const e = new ho(), t3 = this._context.unit, r = (i) => {
      if (e.dispose(), !i)
        return;
      const o3 = this._context.unitId, { skeleton: s2 } = i, l4 = this._renderManagerService.getRenderById(o3);
      if (l4 && l4.mainComponent) {
        const a4 = l4.mainComponent, c2 = (h9) => {
          const { offsetX: m9, offsetY: g9 } = h9, f4 = l4.scene, p3 = t3.getActiveSheet();
          if (!p3)
            return;
          const v6 = f4.getActiveViewportByCoord(
            U.FromArray([m9, g9])
          );
          if (!v6)
            return;
          const { scaleX: S, scaleY: w6 } = f4.getAncestorScale(), C = {
            x: v6.viewportScrollX,
            y: v6.viewportScrollY
          }, I6 = s2.getCellIndexByOffset(m9, g9, S, w6, C), R9 = s2.worksheet.getMergedCell(I6.row, I6.column), y6 = {
            actualRow: R9 ? R9.startRow : I6.row,
            actualCol: R9 ? R9.startColumn : I6.column,
            row: I6.row,
            col: I6.column
          };
          if (!y6 || !s2)
            return;
          const E3 = p3.getCell(y6.actualRow, y6.actualCol);
          if (!E3)
            return;
          const M10 = E3.customRender;
          if (!(M10 != null && M10.length))
            return;
          const T10 = y6.actualRow, P8 = y6.actualCol, A4 = M10.sort(y1), x7 = p3.getSheetId(), H6 = {
            data: E3,
            style: s2.getStyles().getStyleByCell(E3),
            primaryWithCoord: s2.getCellWithCoordByIndex(y6.actualRow, y6.actualCol),
            unitId: o3,
            subUnitId: x7,
            row: T10,
            col: P8,
            workbook: t3,
            worksheet: p3
          }, V7 = {
            x: C.x + m9 / S,
            y: C.y + g9 / w6
          }, D5 = A4.find((B5) => {
            var F7;
            return (F7 = B5.isHit) == null ? void 0 : F7.call(B5, V7, H6);
          });
          if (D5)
            return [D5, H6];
        }, d2 = a4.onPointerDown$.subscribeEvent((h9) => {
          var g9, f4, p3, v6;
          const m9 = c2(h9);
          if (m9) {
            const [S, w6] = m9, { row: C, col: I6, worksheet: R9, unitId: y6, subUnitId: E3 } = w6;
            if (!((g9 = this._permissionService.composePermission(
              [new Pe3(y6).id, new Le2(y6, E3).id]
            )) == null ? void 0 : g9.every((P8) => P8.value)))
              return false;
            const T10 = (p3 = (f4 = R9.getCell(C, I6)) == null ? void 0 : f4.selectionProtection) == null ? void 0 : p3[0];
            if ((T10 == null ? void 0 : T10[_.Edit]) === false)
              return false;
            (v6 = S.onPointerDown) == null || v6.call(S, w6, h9);
          }
        }), u2 = k1(a4.onPointerMove$).pipe(throttleTime(30)).subscribe((h9) => {
          var g9, f4, p3, v6, S, w6;
          const m9 = c2(h9);
          if (m9) {
            const [C, I6] = m9;
            this._enterActiveRender ? this._enterActiveRender.render !== C && ((f4 = (g9 = this._enterActiveRender.render).onPointerLeave) == null || f4.call(g9, this._enterActiveRender.cellContext, h9), this._enterActiveRender = {
              render: C,
              cellContext: I6
            }, (p3 = C.onPointerEnter) == null || p3.call(C, I6, h9)) : (this._enterActiveRender = {
              render: C,
              cellContext: I6
            }, (v6 = C.onPointerEnter) == null || v6.call(C, I6, h9));
          } else
            this._enterActiveRender && ((w6 = (S = this._enterActiveRender.render).onPointerLeave) == null || w6.call(S, this._enterActiveRender.cellContext, h9), this._enterActiveRender = null);
        });
        d2 && e.add(d2), u2 && e.add(u2);
      }
    };
    this.disposeWithMe(this._sheetSkeletonManagerService.currentSkeleton$.subscribe(r)), r(this._sheetSkeletonManagerService.getCurrentParam()), this.disposeWithMe(e);
  }
};
dl2 = Bw([
  Xa2(1, Inject(he2)),
  Xa2(2, JE),
  Xa2(3, aC)
], dl2);
var Fw = Object.getOwnPropertyDescriptor;
var Uw = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? Fw(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var bh3 = (n3, e) => (t3, r) => e(t3, r, n3);
var No3 = class extends Ve {
  constructor(e, t3) {
    super();
    _2(this, "_currentCell$", new Subject());
    _2(this, "currentCell$", this._currentCell$.asObservable().pipe(distinctUntilChanged(
      (e4, t4) => {
        var r, i, o3, s2, l4, a4, c2, d2;
        return ((r = e4 == null ? void 0 : e4.location) == null ? void 0 : r.unitId) === ((i = t4 == null ? void 0 : t4.location) == null ? void 0 : i.unitId) && ((o3 = e4 == null ? void 0 : e4.location) == null ? void 0 : o3.subUnitId) === ((s2 = t4 == null ? void 0 : t4.location) == null ? void 0 : s2.subUnitId) && ((l4 = e4 == null ? void 0 : e4.location) == null ? void 0 : l4.row) === ((a4 = t4 == null ? void 0 : t4.location) == null ? void 0 : a4.row) && ((c2 = e4 == null ? void 0 : e4.location) == null ? void 0 : c2.col) === ((d2 = t4 == null ? void 0 : t4.location) == null ? void 0 : d2.col);
      }
    )));
    _2(this, "_endCell$", new Subject());
    _2(this, "endCell$", this._endCell$.asObservable());
    this._univerInstanceService = e, this._renderManagerService = t3, this._initCellDisposableListener();
  }
  dispose() {
    super.dispose(), this._currentCell$.complete(), this._endCell$.complete();
  }
  _initCellDisposableListener() {
    this.disposeWithMe(this._univerInstanceService.getCurrentTypeOfUnit$(we.UNIVER_SHEET).subscribe((e) => {
      e || (this._currentCell$.next(null), this._endCell$.next(null));
    }));
  }
  _calcActiveCell(e, t3) {
    const r = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET);
    if (!r)
      return null;
    const i = r.getActiveSheet();
    if (!i) return;
    const o3 = this._renderManagerService.getRenderById(r.getUnitId());
    if (!o3) return;
    const s2 = o3.with(he2).getCurrentParam(), a4 = o3.with(Et3).getCurrentScrollState();
    if (!(!s2 || !a4 || !o3))
      return Gm(o3, r, i, s2, e, t3);
  }
  onDragOver(e) {
    const { offsetX: t3, offsetY: r, dataTransfer: i } = e, o3 = this._calcActiveCell(t3, r);
    if (!o3) {
      this._currentCell$.next(null);
      return;
    }
    const { location: s2, position: l4 } = o3;
    this._currentCell$.next({
      location: s2,
      position: l4,
      dataTransfer: i
    });
  }
  onDrop(e) {
    const { offsetX: t3, offsetY: r, dataTransfer: i } = e, o3 = this._calcActiveCell(t3, r);
    if (!o3) {
      this._endCell$.next(null);
      return;
    }
    const { location: s2, position: l4 } = o3;
    this._endCell$.next({
      location: s2,
      position: l4,
      dataTransfer: i
    });
  }
};
No3 = Uw([
  bh3(0, br),
  bh3(1, JE)
], No3);
var Xw = Object.getOwnPropertyDescriptor;
var zw = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? Xw(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var za4 = (n3, e) => (t3, r) => e(t3, r, n3);
var ul2 = class extends Ve {
  constructor(n3, e, t3, r) {
    super(), this._context = n3, this._renderManagerService = e, this._dragManagerService = t3, this._sheetSkeletonManagerService = r, this._initDragEvent();
  }
  _initDragEvent() {
    const n3 = new ho(), e = (t3) => {
      if (n3.dispose(), !t3)
        return;
      const { scene: r } = this._context, i = r.onDragOver$.subscribeEvent((s2) => {
        this._dragManagerService.onDragOver(s2);
      }), o3 = r.onDrop$.subscribeEvent((s2) => {
        this._dragManagerService.onDrop(s2);
      });
      n3.add({
        dispose() {
          i.unsubscribe(), o3.unsubscribe();
        }
      });
    };
    e(this._sheetSkeletonManagerService.getCurrentParam()), this.disposeWithMe(this._sheetSkeletonManagerService.currentSkeleton$.subscribe((t3) => {
      e(t3);
    }));
  }
};
ul2 = zw([
  za4(1, JE),
  za4(2, Inject(No3)),
  za4(3, Inject(he2))
], ul2);
var Qm = class {
  constructor() {
    _2(this, "_state", null);
    _2(this, "_rect", null);
    _2(this, "_state$", new BehaviorSubject(null));
    _2(this, "state$", this._state$.asObservable());
    _2(this, "_rect$", new BehaviorSubject(null));
    _2(this, "rect$", this._rect$.asObservable());
    _2(this, "_focus", false);
    _2(this, "_focus$", new BehaviorSubject(this._focus));
    _2(this, "focus$", this._focus$.asObservable());
  }
  dispose() {
    this._state$.complete(), this._state = null, this._rect$.complete(), this._rect = null;
  }
  setState(e) {
    this._state = e, this._refresh(e);
  }
  getRect() {
    return this._rect;
  }
  setRect(e) {
    this._rect = e, this._rect$.next(e);
  }
  getState() {
    return this._state;
  }
  setFocus(e = false) {
    this._focus = e, this._focus$.next(e);
  }
  _refresh(e) {
    this._state$.next(e);
  }
};
var ds2 = createIdentifier(
  "univer.sheet-cell-editor-manager.service"
);
var Tt2 = "sheets-ui.config";
var hl2 = {
  formulaBar: true,
  statusBarStatistic: true,
  protectedRangeShadow: true,
  maxAutoHeightCount: 1e3
};
function cu2(n3) {
  return n3 === true ? "always" : n3 === false ? "none" : n3 || "always";
}
function ct6(_a5) {
  var _b3 = _a5, { ref: n3 } = _b3, e = __objRest(_b3, ["ref"]);
  const _a6 = e, { icon: t3, id: r, className: i, extend: o3 } = _a6, s2 = __objRest(_a6, ["icon", "id", "className", "extend"]), l4 = `univerjs-icon univerjs-icon-${r} ${i || ""}`.trim(), a4 = (0, import_react.useRef)(`_${Zw()}`);
  return Km(t3, `${r}`, {
    defIds: t3.defIds,
    idSuffix: a4.current
  }, __spreadValues({
    ref: n3,
    className: l4
  }, s2), o3);
}
function Km(n3, e, t3, r, i) {
  return (0, import_react.createElement)(n3.tag, __spreadValues(__spreadValues({
    key: e
  }, jw(n3, t3, i)), r), (Yw(n3, t3).children || []).map((o3, s2) => Km(o3, `${e}-${n3.tag}-${s2}`, t3, void 0, i)));
}
function jw(n3, e, t3) {
  const r = __spreadValues({}, n3.attrs);
  t3 != null && t3.colorChannel1 && r.fill === "colorChannel1" && (r.fill = t3.colorChannel1), n3.tag === "mask" && r.id && (r.id = r.id + e.idSuffix), Object.entries(r).forEach(([o3, s2]) => {
    o3 === "mask" && typeof s2 == "string" && (r[o3] = s2.replace(/url\(#(.*)\)/, `url(#$1${e.idSuffix})`));
  });
  const { defIds: i } = e;
  return !i || i.length === 0 || (n3.tag === "use" && r["xlink:href"] && (r["xlink:href"] = r["xlink:href"] + e.idSuffix), Object.entries(r).forEach(([o3, s2]) => {
    typeof s2 == "string" && (r[o3] = s2.replace(/url\(#(.*)\)/, `url(#$1${e.idSuffix})`));
  })), r;
}
function Yw(n3, e) {
  var r;
  const { defIds: t3 } = e;
  return !t3 || t3.length === 0 ? n3 : n3.tag === "defs" && ((r = n3.children) != null && r.length) ? __spreadProps(__spreadValues({}, n3), {
    children: n3.children.map((i) => typeof i.attrs.id == "string" && t3 && t3.includes(i.attrs.id) ? __spreadProps(__spreadValues({}, i), {
      attrs: __spreadProps(__spreadValues({}, i.attrs), {
        id: i.attrs.id + e.idSuffix
      })
    }) : i)
  }) : n3;
}
function Zw() {
  return Math.random().toString(36).substring(2, 8);
}
ct6.displayName = "UniverIcon";
var Gw = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M14.1544 3.75557C14.3887 3.98988 14.3887 4.36978 14.1544 4.6041L6.51409 12.2444C6.40157 12.3569 6.24896 12.4201 6.08983 12.4201C5.9307 12.4201 5.77808 12.3569 5.66556 12.2444L1.84541 8.42425C1.6111 8.18993 1.6111 7.81003 1.84541 7.57572C2.07973 7.34141 2.45963 7.34141 2.69394 7.57572L6.08983 10.9716L13.3059 3.75557C13.5402 3.52126 13.9201 3.52126 14.1544 3.75557Z",
      fillRule: "evenodd",
      clipRule: "evenodd"
    }
  }]
};
var Br3 = (0, import_react.forwardRef)(function(e, t3) {
  return (0, import_react.createElement)(ct6, Object.assign({}, e, {
    id: "check-mark-icon",
    ref: t3,
    icon: Gw
  }));
});
Br3.displayName = "CheckMarkIcon";
var qw = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M3.71274 2.86421C3.47843 2.6299 3.09853 2.6299 2.86421 2.86421C2.6299 3.09853 2.6299 3.47843 2.86421 3.71274L7.15154 8.00007L2.86421 12.2874C2.6299 12.5217 2.6299 12.9016 2.86421 13.1359C3.09853 13.3702 3.47843 13.3702 3.71274 13.1359L8.00007 8.84859L12.2874 13.1359C12.5217 13.3702 12.9016 13.3702 13.1359 13.1359C13.3702 12.9016 13.3702 12.5217 13.1359 12.2874L8.84859 8.00007L13.1359 3.71274C13.3702 3.47843 13.3702 3.09853 13.1359 2.86421C12.9016 2.6299 12.5217 2.6299 12.2874 2.86421L8.00007 7.15154L3.71274 2.86421Z"
    }
  }]
};
var Jm2 = (0, import_react.forwardRef)(function(e, t3) {
  return (0, import_react.createElement)(ct6, Object.assign({}, e, {
    id: "close-icon",
    ref: t3,
    icon: qw
  }));
});
Jm2.displayName = "CloseIcon";
var Qw = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "g",
    attrs: {
      fill: "currentColor",
      clipPath: "url(#convert-icon_clip0_911_593)"
    },
    children: [
      {
        tag: "path",
        attrs: {
          d: "M2.44766 0.848145C1.564 0.848145 0.847656 1.56449 0.847656 2.44814V6.44814C0.847656 7.3318 1.564 8.04814 2.44766 8.04814H6.44766C7.33131 8.04814 8.04766 7.3318 8.04766 6.44814V2.44814C8.04766 1.56449 7.33131 0.848145 6.44766 0.848145H2.44766ZM2.04766 6.44814V5.04824H3.84775V6.84814H2.44766C2.22674 6.84814 2.04766 6.66906 2.04766 6.44814ZM2.04766 3.84824H3.84775V2.04814H2.44766C2.22674 2.04814 2.04766 2.22723 2.04766 2.44814V3.84824ZM5.04775 6.84814V5.04824H6.84766V6.44814C6.84766 6.66906 6.66857 6.84814 6.44766 6.84814H5.04775ZM5.04775 3.84824H6.84766V2.44814C6.84766 2.22723 6.66857 2.04814 6.44766 2.04814H5.04775V3.84824Z",
          fillRule: "evenodd",
          clipRule: "evenodd"
        }
      },
      {
        tag: "path",
        attrs: {
          d: "M9.55215 7.95166C8.66849 7.95166 7.95215 8.668 7.95215 9.55166V13.5517C7.95215 14.4353 8.66849 15.1517 9.55215 15.1517L11.5522 15.1517L13.5521 15.1517C14.4358 15.1517 15.1521 14.4353 15.1521 13.5517L15.1521 11.5518L15.1521 9.55166C15.1521 8.668 14.4358 7.95166 13.5521 7.95166H9.55215ZM13.9521 10.9518V9.55166C13.9521 9.33075 13.7731 9.15166 13.5521 9.15166H12.1522V10.9518H13.9521ZM10.9522 10.9518V9.15166H9.55215C9.33123 9.15166 9.15215 9.33075 9.15215 9.55166V10.9518H10.9522ZM9.15215 12.1518H10.9522V13.9517H9.55215C9.33123 13.9517 9.15215 13.7726 9.15215 13.5517V12.1518ZM12.1522 12.1518H13.9521V13.5517C13.9521 13.7726 13.7731 13.9517 13.5521 13.9517H12.1522V12.1518Z",
          fillRule: "evenodd",
          clipRule: "evenodd"
        }
      },
      {
        tag: "path",
        attrs: { d: "M9.62158 2.44912C9.62158 2.11775 9.89021 1.84912 10.2216 1.84912H12.7516C13.6352 1.84912 14.3516 2.56547 14.3516 3.44912V5.9791C14.3516 6.31047 14.0829 6.5791 13.7516 6.5791C13.4202 6.5791 13.1516 6.31047 13.1516 5.9791V3.44912C13.1516 3.22821 12.9725 3.04912 12.7516 3.04912H10.2216C9.89021 3.04912 9.62158 2.78049 9.62158 2.44912Z" }
      },
      {
        tag: "path",
        attrs: { d: "M5.77871 14.1507C6.11008 14.1507 6.37871 13.8821 6.37871 13.5507C6.37871 13.2193 6.11008 12.9507 5.77871 12.9507L3.24873 12.9507C3.02782 12.9507 2.84873 12.7716 2.84873 12.5507L2.84873 10.0207C2.84873 9.68933 2.5801 9.4207 2.24873 9.4207C1.91736 9.4207 1.64873 9.68933 1.64873 10.0207L1.64873 12.5507C1.64873 13.4343 2.36507 14.1507 3.24873 14.1507H5.77871Z" }
      }
    ]
  }, {
    tag: "defs",
    attrs: {},
    children: [{
      tag: "clipPath",
      attrs: { id: "convert-icon_clip0_911_593" },
      children: [{
        tag: "path",
        attrs: {
          fill: "white",
          d: "M0 0H16V16H0z"
        }
      }]
    }]
  }],
  defIds: ["convert-icon_clip0_911_593"]
};
var $m2 = (0, import_react.forwardRef)(function(e, t3) {
  return (0, import_react.createElement)(ct6, Object.assign({}, e, {
    id: "convert-icon",
    ref: t3,
    icon: Qw
  }));
});
$m2.displayName = "ConvertIcon";
var Kw = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M5.3313 1.4667C5.3313 1.13533 5.59993 0.866699 5.9313 0.866699H10.069C10.4004 0.866699 10.669 1.13533 10.669 1.4667C10.669 1.79807 10.4004 2.0667 10.069 2.0667H5.9313C5.59993 2.0667 5.3313 1.79807 5.3313 1.4667Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M1.09985 3.64443C1.09985 3.31306 1.36848 3.04443 1.69985 3.04443H14.2999C14.6312 3.04443 14.8999 3.31306 14.8999 3.64443C14.8999 3.9758 14.6312 4.24443 14.2999 4.24443H1.69985C1.36848 4.24443 1.09985 3.9758 1.09985 3.64443Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M6.12398 8.30171C6.35829 8.0674 6.73819 8.0674 6.97251 8.30171L8.00007 9.32928L9.02764 8.30171C9.26195 8.0674 9.64185 8.0674 9.87617 8.30171C10.1105 8.53603 10.1105 8.91593 9.87617 9.15024L8.8486 10.1778L9.87617 11.2054C10.1105 11.4397 10.1105 11.8196 9.87617 12.0539C9.64185 12.2882 9.26195 12.2882 9.02764 12.0539L8.00007 11.0263L6.97251 12.0539C6.73819 12.2882 6.35829 12.2882 6.12398 12.0539C5.88966 11.8196 5.88966 11.4397 6.12398 11.2054L7.15154 10.1778L6.12398 9.15024C5.88966 8.91593 5.88966 8.53603 6.12398 8.30171Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M4.75332 5.22217C3.86966 5.22217 3.15332 5.93851 3.15332 6.82217V12.5331C3.15332 13.9691 4.31738 15.1332 5.75332 15.1332H10.2465C11.6825 15.1332 12.8465 13.9691 12.8465 12.5331V6.82217C12.8465 5.93851 12.1302 5.22217 11.2465 5.22217H4.75332ZM4.35332 6.82217C4.35332 6.60125 4.53241 6.42217 4.75332 6.42217H11.2465C11.4674 6.42217 11.6465 6.60125 11.6465 6.82217V12.5331C11.6465 13.3063 11.0197 13.9332 10.2465 13.9332H5.75332C4.98012 13.9332 4.35332 13.3063 4.35332 12.5331V6.82217Z",
        fillRule: "evenodd",
        clipRule: "evenodd"
      }
    }
  ]
};
var Aa3 = (0, import_react.forwardRef)(function(e, t3) {
  return (0, import_react.createElement)(ct6, Object.assign({}, e, {
    id: "delete-icon",
    ref: t3,
    icon: Kw
  }));
});
Aa3.displayName = "DeleteIcon";
var Jw = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M8.85869 12.9216C8.38445 13.4708 7.61555 13.4708 7.14131 12.9216L0.358114 5.06726C-0.406895 4.18144 0.134916 2.66683 1.2168 2.66683L14.7832 2.66683C15.8651 2.66683 16.4069 4.18144 15.6419 5.06726L8.85869 12.9216Z"
    }
  }]
};
var ef = (0, import_react.forwardRef)(function(e, t3) {
  return (0, import_react.createElement)(ct6, Object.assign({}, e, {
    id: "dropdown-icon",
    ref: t3,
    icon: Jw
  }));
});
ef.displayName = "DropdownIcon";
var $w = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M15 8C15 11.866 11.866 15 8 15C4.13401 15 1 11.866 1 8C1 4.13401 4.13401 1 8 1C11.866 1 15 4.13401 15 8ZM10.3097 5.69014C10.544 5.92445 10.544 6.30435 10.3097 6.53867L8.84843 7.9999L10.3099 9.46137C10.5442 9.69569 10.5442 10.0756 10.3099 10.3099C10.0756 10.5442 9.69569 10.5442 9.46137 10.3099L7.9999 8.84843L6.53842 10.3099C6.30411 10.5442 5.92421 10.5442 5.6899 10.3099C5.45558 10.0756 5.45558 9.69569 5.6899 9.46137L7.15137 7.9999L5.69014 6.53867C5.45583 6.30435 5.45583 5.92445 5.69014 5.69014C5.92445 5.45583 6.30435 5.45583 6.53867 5.69014L7.9999 7.15137L9.46113 5.69014C9.69544 5.45583 10.0753 5.45583 10.3097 5.69014Z",
      fillRule: "evenodd",
      clipRule: "evenodd"
    }
  }]
};
var du2 = (0, import_react.forwardRef)(function(e, t3) {
  return (0, import_react.createElement)(ct6, Object.assign({}, e, {
    id: "error-icon",
    ref: t3,
    icon: $w
  }));
});
du2.displayName = "ErrorIcon";
var e0 = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M1.28096 4.6541C1.57489 4.50109 1.93721 4.61533 2.09022 4.90926C2.27315 5.26067 2.55999 5.60455 2.94829 5.92278C4.04628 6.82266 5.87505 7.44865 7.99828 7.44865C10.1215 7.44865 11.9503 6.82267 13.0482 5.92279C13.4366 5.60455 13.7234 5.26067 13.9063 4.90927C14.0594 4.61533 14.4217 4.50109 14.7156 4.65409C15.0095 4.8071 15.1238 5.16941 14.9708 5.46334C14.6995 5.98445 14.2981 6.44997 13.8089 6.8509C13.7298 6.91575 13.6481 6.97914 13.564 7.041L15.2245 8.70153C15.4588 8.93585 15.4588 9.31575 15.2245 9.55006C14.9902 9.78438 14.6103 9.78438 14.376 9.55006L12.5041 7.67822C11.8977 7.97568 11.2181 8.21208 10.4884 8.37706L11.0996 10.6581C11.1853 10.9782 10.9954 11.3072 10.6753 11.393C10.3552 11.4787 10.0262 11.2888 9.94045 10.9687L9.29949 8.57652C8.8758 8.62404 8.44081 8.64865 7.99828 8.64865C7.55276 8.64865 7.11487 8.62371 6.68846 8.57555L6.04723 10.9687C5.96147 11.2888 5.63247 11.4788 5.31239 11.393C4.99231 11.3073 4.80236 10.9783 4.88812 10.6582L5.49983 8.37516C4.7743 8.2105 4.09843 7.9752 3.49498 7.67947L1.62436 9.55009C1.39005 9.78441 1.01015 9.78441 0.775835 9.5501C0.54152 9.31578 0.541518 8.93588 0.775832 8.70157L2.43478 7.04261C2.34987 6.98024 2.26746 6.91632 2.18764 6.8509C1.69842 6.44997 1.29706 5.98445 1.0258 5.46335C0.872791 5.16942 0.987031 4.80711 1.28096 4.6541Z"
    }
  }]
};
var tf = (0, import_react.forwardRef)(function(e, t3) {
  return (0, import_react.createElement)(ct6, Object.assign({}, e, {
    id: "eyelash-icon",
    ref: t3,
    icon: e0
  }));
});
tf.displayName = "EyelashIcon";
var t02 = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 17 17",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M6.06409 5.53454C5.93592 5.53454 5.84083 5.41567 5.86897 5.29063L5.95442 4.9109C6.05444 4.48178 6.23806 4.11547 6.51182 3.81952C6.81082 3.49628 7.25398 3.35405 7.79738 3.35405C7.99847 3.35405 8.21359 3.37775 8.44188 3.42245C8.46089 3.42617 8.47974 3.43006 8.49846 3.4341C8.7099 3.4798 8.93698 3.38478 9.02031 3.18514L9.24767 2.6404C9.33457 2.43219 9.23178 2.19404 9.01582 2.12874C8.98358 2.11899 8.95028 2.10912 8.91591 2.09914C8.62745 2.01631 8.28392 1.97217 7.88074 1.97217C6.82015 1.97217 6.02714 2.23936 5.4746 2.7444C4.90987 3.26069 4.50889 3.99917 4.28413 4.9762L2.83703 11.1909C2.76126 11.5286 2.666 11.8917 2.54844 12.2812C2.42975 12.6734 2.2873 13.0595 2.12221 13.4373C1.95577 13.8159 1.76813 14.1762 1.55955 14.5171C1.49345 14.6251 1.42515 14.7282 1.35467 14.8263C1.26508 14.9509 1.3347 15.133 1.48655 15.1554C2.13635 15.2509 2.8179 15.0763 3.18197 14.5296C3.32661 14.3124 3.46779 14.0646 3.60509 13.7851C3.96635 13.0497 4.30522 12.0103 4.61867 10.6574L5.469 7.01534C5.49013 6.92483 5.57082 6.86081 5.66376 6.86081H7.62478C7.8097 6.86081 7.97051 6.73405 8.01371 6.55425L8.14014 6.02798C8.20057 5.77642 8.00992 5.53454 7.75121 5.53454H6.06409Z"
    }
  }, {
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M14.3211 5.72037L12.5124 7.96963L11.4089 5.77754C11.3422 5.63012 11.1954 5.5354 11.0336 5.5354H10.3129C10.0085 5.5354 9.80921 5.85428 9.9427 6.1279L11.4089 9.05502L8.79783 12.1493C8.56587 12.4158 8.75519 12.8315 9.10855 12.8315H9.68607C9.80672 12.8315 9.9605 12.7822 10.0388 12.6904L12.1108 10.2648L13.1176 12.561C13.1786 12.7231 13.333 12.8315 13.5061 12.8315H14.3C14.5831 12.8315 14.7417 12.6175 14.6426 12.3524L13.1728 9.28628C13.1728 9.28628 15.4009 6.45542 15.6013 6.17892C15.7966 5.90929 15.6023 5.5354 15.2693 5.5354H14.6661C14.5275 5.5354 14.4333 5.58887 14.3211 5.72037Z"
    }
  }]
};
var nf = (0, import_react.forwardRef)(function(e, t3) {
  return (0, import_react.createElement)(ct6, Object.assign({}, e, {
    id: "fx-icon",
    ref: t3,
    icon: t02
  }));
});
nf.displayName = "FxIcon";
var n0 = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M8.6 1.99991C8.60001 1.66854 8.33138 1.39991 8.00001 1.3999C7.66864 1.3999 7.40001 1.66853 7.4 1.9999L7.39996 7.3999H1.9999C1.66853 7.3999 1.3999 7.66853 1.3999 7.9999C1.3999 8.33127 1.66853 8.5999 1.9999 8.5999H7.39995L7.3999 13.9999C7.3999 14.3313 7.66853 14.5999 7.9999 14.5999C8.33127 14.5999 8.5999 14.3313 8.5999 13.9999L8.59995 8.5999H13.9999C14.3313 8.5999 14.5999 8.33127 14.5999 7.9999C14.5999 7.66853 14.3313 7.3999 13.9999 7.3999H8.59996L8.6 1.99991Z"
    }
  }]
};
var uu2 = (0, import_react.forwardRef)(function(e, t3) {
  return (0, import_react.createElement)(ct6, Object.assign({}, e, {
    id: "increase-icon",
    ref: t3,
    icon: n0
  }));
});
uu2.displayName = "IncreaseIcon";
var r02 = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M8.00016 1.33203C6.68162 1.33203 5.39269 1.72302 4.29636 2.45557C3.20004 3.18811 2.34555 4.2293 1.84097 5.44747C1.33638 6.66565 1.20436 8.00609 1.4616 9.2993C1.71883 10.5925 2.35377 11.7804 3.28612 12.7127C4.21847 13.6451 5.40636 14.28 6.69956 14.5373C7.99277 14.7945 9.33321 14.6625 10.5514 14.1579C11.7696 13.6533 12.8108 12.7988 13.5433 11.7025C14.2758 10.6062 14.6668 9.31724 14.6668 7.9987C14.6649 6.23118 13.9619 4.53662 12.7121 3.2868C11.4622 2.03697 9.76768 1.33397 8.00016 1.33203ZM7.66683 3.9987C7.86461 3.9987 8.05795 4.05735 8.2224 4.16723C8.38685 4.27711 8.51502 4.43329 8.59071 4.61601C8.6664 4.79874 8.6862 4.99981 8.64762 5.19379C8.60903 5.38777 8.51379 5.56595 8.37394 5.7058C8.23409 5.84566 8.0559 5.9409 7.86192 5.97948C7.66794 6.01807 7.46687 5.99826 7.28415 5.92258C7.10142 5.84689 6.94524 5.71872 6.83536 5.55427C6.72548 5.38982 6.66683 5.19648 6.66683 4.9987C6.66683 4.73348 6.77219 4.47913 6.95972 4.29159C7.14726 4.10405 7.40162 3.9987 7.66683 3.9987ZM9.3335 11.332H6.66683C6.49002 11.332 6.32045 11.2618 6.19543 11.1368C6.0704 11.0117 6.00016 10.8422 6.00016 10.6654C6.00016 10.4886 6.0704 10.319 6.19543 10.194C6.32045 10.0689 6.49002 9.9987 6.66683 9.9987H7.3335V7.9987H6.66683C6.49002 7.9987 6.32045 7.92846 6.19543 7.80343C6.0704 7.67841 6.00016 7.50884 6.00016 7.33203C6.00016 7.15522 6.0704 6.98565 6.19543 6.86063C6.32045 6.7356 6.49002 6.66536 6.66683 6.66536H8.00016C8.17698 6.66536 8.34655 6.7356 8.47157 6.86063C8.59659 6.98565 8.66683 7.15522 8.66683 7.33203V9.9987H9.3335C9.51031 9.9987 9.67988 10.0689 9.8049 10.194C9.92993 10.319 10.0002 10.4886 10.0002 10.6654C10.0002 10.8422 9.92993 11.0117 9.8049 11.1368C9.67988 11.2618 9.51031 11.332 9.3335 11.332Z"
    }
  }]
};
var rf = (0, import_react.forwardRef)(function(e, t3) {
  return (0, import_react.createElement)(ct6, Object.assign({}, e, {
    id: "info-icon",
    ref: t3,
    icon: r02
  }));
});
rf.displayName = "InfoIcon";
var i0 = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M2.62402 7.72905C2.58427 7.72905 2.55205 7.76127 2.55205 7.80102V13.6782C2.55205 13.7179 2.58427 13.7502 2.62402 13.7502H13.3755C13.4152 13.7502 13.4474 13.7179 13.4474 13.6782V7.80102C13.4474 7.76127 13.4152 7.72905 13.3755 7.72905H2.62402ZM1.35205 7.80102C1.35205 7.09853 1.92153 6.52905 2.62402 6.52905H13.3755C14.0779 6.52905 14.6474 7.09853 14.6474 7.80102V13.6782C14.6474 14.3807 14.0779 14.9502 13.3755 14.9502H2.62402C1.92153 14.9502 1.35205 14.3807 1.35205 13.6782V7.80102Z",
        fillRule: "evenodd",
        clipRule: "evenodd"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M8 2.25005C6.69847 2.25003 5.64336 3.30513 5.64336 4.60666V7.12895C5.64336 7.46032 5.37473 7.72895 5.04336 7.72895C4.71199 7.72895 4.44336 7.46032 4.44336 7.12895V4.60666C4.44336 2.64239 6.04451 1.05565 8.00879 1.05566M8 2.25005L8.00879 1.05566L8 2.25005ZM8.00879 1.05566L8 2.25005C9.30154 2.25003 10.3567 3.30513 10.3567 4.60666V7.12895C10.3567 7.46032 10.6253 7.72895 10.9567 7.72895C11.288 7.72895 11.5567 7.46032 11.5567 7.12895V4.60666C11.5567 2.64239 9.97306 1.05565 8.00879 1.05566Z",
        fillRule: "evenodd",
        clipRule: "evenodd"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M8.00039 9.4668C8.33176 9.4668 8.60039 9.73543 8.60039 10.0668V12.0827C8.60039 12.4141 8.33176 12.6827 8.00039 12.6827C7.66902 12.6827 7.40039 12.4141 7.40039 12.0827V10.0668C7.40039 9.73543 7.66902 9.4668 8.00039 9.4668Z",
        fillRule: "evenodd",
        clipRule: "evenodd"
      }
    }
  ]
};
var hu2 = (0, import_react.forwardRef)(function(e, t3) {
  return (0, import_react.createElement)(ct6, Object.assign({}, e, {
    id: "lock-icon",
    ref: t3,
    icon: i0
  }));
});
hu2.displayName = "LockIcon";
var o0 = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M11.3536 6.14645C11.5488 6.34171 11.5488 6.65829 11.3536 6.85355L8.35355 9.85355C8.15829 10.0488 7.84171 10.0488 7.64645 9.85355L4.64645 6.85355C4.45118 6.65829 4.45118 6.34171 4.64645 6.14645C4.84171 5.95118 5.15829 5.95118 5.35355 6.14645L8 8.79289L10.6464 6.14645C10.8417 5.95118 11.1583 5.95118 11.3536 6.14645Z",
      fillRule: "evenodd",
      clipRule: "evenodd"
    }
  }]
};
var Mi2 = (0, import_react.forwardRef)(function(e, t3) {
  return (0, import_react.createElement)(ct6, Object.assign({}, e, {
    id: "more-down-icon",
    ref: t3,
    icon: o0
  }));
});
Mi2.displayName = "MoreDownIcon";
var s02 = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M5.90913 3.57564C6.14345 3.34132 6.52335 3.34132 6.75766 3.57564L10.7577 7.57564C10.992 7.80995 10.992 8.18985 10.7577 8.42417L6.75766 12.4242C6.52335 12.6585 6.14345 12.6585 5.90913 12.4242C5.67482 12.1899 5.67482 11.81 5.90913 11.5756L9.48487 7.9999L5.90913 4.42417C5.67482 4.18985 5.67482 3.80995 5.90913 3.57564Z",
      fillRule: "evenodd",
      clipRule: "evenodd"
    }
  }]
};
var Qc2 = (0, import_react.forwardRef)(function(e, t3) {
  return (0, import_react.createElement)(ct6, Object.assign({}, e, {
    id: "more-icon",
    ref: t3,
    icon: s02
  }));
});
Qc2.displayName = "MoreIcon";
var l02 = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M12.666 2.70571C11.7769 1.76476 10.3295 1.76476 9.4404 2.70571L3.37843 9.12427C3.31779 9.18848 3.27756 9.26409 3.24979 9.3439C3.24809 9.3493 3.24299 9.3529 3.24129 9.3583L2.02912 13.2097C1.96112 13.4251 2.01439 13.6633 2.16626 13.8236C2.27393 13.9382 2.41901 14 2.56692 14C2.62699 14 2.68762 13.9898 2.74599 13.9688L6.3825 12.6846C6.3876 12.6828 6.391 12.678 6.39553 12.6762C6.47147 12.6474 6.54287 12.6042 6.60351 12.54L12.666 6.12202C13.5558 5.18048 13.5558 3.64725 12.666 2.70571ZM8.62832 5.26209L9.04031 5.69836C9.03918 5.69956 9.03748 5.70016 9.03634 5.70136L4.99182 9.9836L4.58096 9.54853L8.62832 5.26209ZM3.46287 12.4512L4.02673 10.6593L5.15446 11.8535L3.46287 12.4512ZM6.20342 11.2672L5.79256 10.8321L9.83709 6.54988C9.83822 6.54868 9.83879 6.54688 9.83992 6.54568L10.2513 6.98135L6.20342 11.2672ZM11.8647 5.27349L11.0532 6.13282L9.42963 4.41356L10.2411 3.55423C10.6888 3.08016 11.417 3.08076 11.8642 3.55423C12.3124 4.0283 12.3124 4.79942 11.8647 5.27349Z"
    }
  }]
};
var of2 = (0, import_react.forwardRef)(function(e, t3) {
  return (0, import_react.createElement)(ct6, Object.assign({}, e, {
    id: "pen-icon",
    ref: t3,
    icon: l02
  }));
});
of2.displayName = "PenIcon";
var a02 = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M5.785 6.77762C5.78908 6.7777 5.79316 6.77774 5.79725 6.77774C5.80134 6.77774 5.80543 6.7777 5.8095 6.77762H10.0184C10.0225 6.7777 10.0266 6.77774 10.0307 6.77774C10.0347 6.77774 10.0388 6.7777 10.0429 6.77762H13.6638V7.63727C13.6638 7.96864 13.9324 8.23727 14.2638 8.23727C14.5951 8.23727 14.8638 7.96864 14.8638 7.63727V3.9999C14.8638 2.56395 13.6997 1.39989 12.2637 1.3999L3.56389 1.39999C2.12797 1.40001 0.96393 2.56405 0.96392 3.99998L0.963867 11.6666C0.963857 13.1025 2.12792 14.2666 3.56387 14.2666H8.0542C8.38557 14.2666 8.6542 13.9979 8.6542 13.6666C8.6542 13.3352 8.38557 13.0666 8.0542 13.0666H3.56387C2.79067 13.0666 2.16386 12.4398 2.16387 11.6666L2.1639 6.77762H5.785ZM6.39725 2.59996L9.43065 2.59993V5.57762H6.39725V2.59996ZM5.19725 5.57762V2.59998L3.56391 2.59999C2.79072 2.6 2.16393 3.22679 2.16392 3.99998L2.16391 5.57762H5.19725ZM13.6638 5.57762V3.9999C13.6638 3.2267 13.037 2.59989 12.2638 2.5999L10.6307 2.59992V5.57762H13.6638Z",
      fillRule: "evenodd",
      clipRule: "evenodd"
    }
  }, {
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M14.1223 10.2333V10.7496C14.7087 10.9869 15.1223 11.5618 15.1223 12.2333V12.8999C15.1223 13.7836 14.406 14.4999 13.5223 14.4999H11.5223C10.6387 14.4999 9.92235 13.7836 9.92235 12.8999V12.2333C9.92235 11.5618 10.336 10.9869 10.9223 10.7496V10.2333C10.9223 9.34961 11.6387 8.63328 12.5223 8.63328C13.406 8.63328 14.1223 9.34961 14.1223 10.2333ZM11.1223 12.2333C11.1223 12.0124 11.3014 11.8333 11.5223 11.8333H13.5223C13.7433 11.8333 13.9223 12.0124 13.9223 12.2333V12.8999C13.9223 13.1209 13.7433 13.2999 13.5223 13.2999H11.5223C11.3014 13.2999 11.1223 13.1209 11.1223 12.8999V12.2333ZM12.9223 10.2333V10.6333H12.1223V10.2333C12.1223 10.0124 12.3014 9.83328 12.5223 9.83328C12.7433 9.83328 12.9223 10.0124 12.9223 10.2333Z",
      fillRule: "evenodd",
      clipRule: "evenodd"
    }
  }]
};
var sf2 = (0, import_react.forwardRef)(function(e, t3) {
  return (0, import_react.createElement)(ct6, Object.assign({}, e, {
    id: "protect-icon",
    ref: t3,
    icon: a02
  }));
});
sf2.displayName = "ProtectIcon";
var c0 = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M15 8C15 11.866 11.866 15 8 15C4.13401 15 1 11.866 1 8C1 4.13401 4.13401 1 8 1C11.866 1 15 4.13401 15 8ZM8.00008 12.3671C8.46031 12.3671 8.83342 11.994 8.83342 11.5338C8.83342 11.0735 8.46031 10.7004 8.00008 10.7004C7.53985 10.7004 7.16675 11.0735 7.16675 11.5338C7.16675 11.994 7.53985 12.3671 8.00008 12.3671ZM8.5999 4.4335C8.5999 4.10213 8.33127 3.8335 7.9999 3.8335C7.66853 3.8335 7.3999 4.10213 7.3999 4.4335V9.36683C7.3999 9.6982 7.66853 9.96683 7.9999 9.96683C8.33127 9.96683 8.5999 9.6982 8.5999 9.36683V4.4335Z",
      fillRule: "evenodd",
      clipRule: "evenodd"
    }
  }]
};
var lf = (0, import_react.forwardRef)(function(e, t3) {
  return (0, import_react.createElement)(ct6, Object.assign({}, e, {
    id: "warning-icon",
    ref: t3,
    icon: c0
  }));
});
lf.displayName = "WarningIcon";
var d02 = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 17 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M12.6551 1.98906C11.7476 1.08113 10.2757 1.08149 9.3686 1.98987L4.82542 6.53955C4.75087 6.61421 4.69336 6.70411 4.65682 6.80309L3.2461 10.625C3.16506 10.8446 3.21909 11.0912 3.3845 11.2568C3.54991 11.4224 3.79651 11.4767 4.01616 11.3959L7.85031 9.98517C7.94979 9.94856 8.04014 9.89077 8.11508 9.81579L12.6552 5.27327C13.5618 4.36621 13.5618 2.89607 12.6551 1.98906ZM10.2177 2.83779C10.6562 2.39869 11.3677 2.39851 11.8064 2.8374C12.2447 3.27584 12.2447 3.9865 11.8065 4.42497L7.3392 8.89457L4.82213 9.82068L5.74706 7.31487L10.2177 2.83779Z",
      fillRule: "evenodd",
      clipRule: "evenodd"
    }
  }, {
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M1.79238 13.2999C1.46101 13.2999 1.19238 13.5685 1.19238 13.8999C1.19238 14.2313 1.46101 14.4999 1.79238 14.4999H14.4924C14.8238 14.4999 15.0924 14.2313 15.0924 13.8999C15.0924 13.5685 14.8238 13.2999 14.4924 13.2999H1.79238Z"
    }
  }]
};
var gu2 = (0, import_react.forwardRef)(function(e, t3) {
  return (0, import_react.createElement)(ct6, Object.assign({}, e, {
    id: "write-icon",
    ref: t3,
    icon: d02
  }));
});
gu2.displayName = "WriteIcon";
var u0 = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [
    {
      tag: "path",
      attrs: {
        fill: "colorChannel1",
        d: "M11.0363 12.2367V14.0367C11.0363 14.3681 11.3049 14.6367 11.6363 14.6367C11.9676 14.6367 12.2363 14.3681 12.2363 14.0367V12.2367H14.0364C14.3677 12.2367 14.6364 11.9681 14.6364 11.6367C14.6364 11.3054 14.3677 11.0367 14.0364 11.0367H12.2363V9.23672C12.2363 8.90535 11.9676 8.63672 11.6363 8.63672C11.3049 8.63672 11.0363 8.90535 11.0363 9.23672V11.0367H9.23635C8.90498 11.0367 8.63635 11.3054 8.63635 11.6367C8.63635 11.9681 8.90498 12.2367 9.23635 12.2367H11.0363Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M2.56365 1.36377C1.90091 1.36377 1.36365 1.90103 1.36365 2.56377V6.16377C1.36365 6.82651 1.90091 7.36377 2.56365 7.36377H6.16365C6.82639 7.36377 7.36365 6.82651 7.36365 6.16377V2.56377C7.36365 1.90103 6.82639 1.36377 6.16365 1.36377H2.56365ZM6.16365 2.56377H2.56365L2.56365 6.16377H6.16365V2.56377Z",
        fillRule: "evenodd",
        clipRule: "evenodd"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M2.56365 8.63647C1.90091 8.63647 1.36365 9.17373 1.36365 9.83647V13.4365C1.36365 14.0992 1.90091 14.6365 2.56365 14.6365H6.16365C6.82639 14.6365 7.36365 14.0992 7.36365 13.4365V9.83647C7.36365 9.17373 6.82639 8.63647 6.16365 8.63647H2.56365ZM6.16365 9.83647H2.56365L2.56365 13.4365H6.16365V9.83647Z",
        fillRule: "evenodd",
        clipRule: "evenodd"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M9.83635 7.36377C9.17361 7.36377 8.63635 6.82651 8.63635 6.16377V2.56377C8.63635 1.90103 9.17361 1.36377 9.83635 1.36377H13.4364C14.0991 1.36377 14.6364 1.90103 14.6364 2.56377V6.16377C14.6364 6.82651 14.0991 7.36377 13.4364 7.36377H9.83635ZM9.83635 6.16377V2.56377L13.4364 2.56377V6.16377H9.83635Z",
        fillRule: "evenodd",
        clipRule: "evenodd"
      }
    }
  ]
};
var af = (0, import_react.forwardRef)(function(e, t3) {
  return (0, import_react.createElement)(ct6, Object.assign({}, e, {
    id: "autofill-double-icon",
    ref: t3,
    icon: u0
  }));
});
af.displayName = "AutofillDoubleIcon";
var h0 = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "colorChannel1",
      d: "M6.4833 1.65005C6.4833 1.31868 6.21467 1.05005 5.8833 1.05005C5.55193 1.05005 5.2833 1.31868 5.2833 1.65005V5.28345H1.65029C1.31892 5.28345 1.05029 5.55208 1.05029 5.88345C1.05029 6.21482 1.31892 6.48345 1.65029 6.48345H5.2833V9.51684H1.65029C1.31892 9.51684 1.05029 9.78547 1.05029 10.1168C1.05029 10.4482 1.31892 10.7168 1.65029 10.7168H5.2833V14.35C5.2833 14.6814 5.55193 14.95 5.8833 14.95C6.21467 14.95 6.4833 14.6814 6.4833 14.35V10.7168H9.5167V14.35C9.5167 14.6814 9.78533 14.95 10.1167 14.95C10.4481 14.95 10.7167 14.6814 10.7167 14.35V10.7168H14.3503C14.6817 10.7168 14.9503 10.4482 14.9503 10.1168C14.9503 9.78547 14.6817 9.51685 14.3503 9.51685H10.7167V6.48345H14.3503C14.6817 6.48345 14.9503 6.21482 14.9503 5.88345C14.9503 5.55208 14.6817 5.28345 14.3503 5.28345H10.7167V1.65005C10.7167 1.31868 10.4481 1.05005 10.1167 1.05005C9.78533 1.05005 9.5167 1.31868 9.5167 1.65005V5.28345L6.4833 5.28345V1.65005ZM6.4833 6.48345V9.51684L9.5167 9.51685V6.48345L6.4833 6.48345Z",
      fillRule: "evenodd",
      clipRule: "evenodd"
    }
  }, {
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M1.0498 3.65005C1.0498 2.21411 2.21386 1.05005 3.6498 1.05005H12.3498C13.7857 1.05005 14.9498 2.21411 14.9498 3.65005V12.3501C14.9498 13.786 13.7857 14.95 12.3498 14.95H3.6498C2.21386 14.95 1.0498 13.786 1.0498 12.35V3.65005ZM3.6498 2.25005C2.87661 2.25005 2.2498 2.87685 2.2498 3.65005V12.35C2.2498 13.1232 2.87661 13.75 3.6498 13.75H12.3498C13.123 13.75 13.7498 13.1232 13.7498 12.3501V3.65005C13.7498 2.87685 13.123 2.25005 12.3498 2.25005H3.6498Z",
      fillRule: "evenodd",
      clipRule: "evenodd"
    }
  }]
};
var mu2 = (0, import_react.forwardRef)(function(e, t3) {
  return (0, import_react.createElement)(ct6, Object.assign({}, e, {
    id: "hide-gridlines-double-icon",
    ref: t3,
    icon: h0
  }));
});
mu2.displayName = "HideGridlinesDoubleIcon";
var g0 = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 17 16",
    width: "1em",
    height: "1em"
  },
  children: [
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M8.01281 1.36643C8.79386 0.585377 10.0602 0.585378 10.8412 1.36643L12.9223 3.44752C13.7034 4.22857 13.7034 5.4949 12.9223 6.27595L9.36445 9.83383C8.5834 10.6149 7.31707 10.6149 6.53602 9.83383L4.45493 7.75273C3.67388 6.97168 3.67388 5.70535 4.45493 4.9243L8.01281 1.36643ZM9.9927 2.21495C9.68028 1.90253 9.17375 1.90253 8.86133 2.21495L5.30346 5.77283L5.29671 5.77966L10.839 6.66224L12.0738 5.42742C12.3862 5.115 12.3862 4.60847 12.0738 4.29605L9.9927 2.21495Z",
        fillRule: "evenodd",
        clipRule: "evenodd"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M14.5179 9.48875C14.5179 9.99175 14.1101 10.3995 13.607 10.3995C13.1041 10.3995 12.6963 9.99175 12.6963 9.48875C12.6963 9.1773 13.0455 8.59966 13.3114 8.20487C13.4549 7.99177 13.7591 7.99177 13.9027 8.20486C14.1687 8.59965 14.5179 9.1773 14.5179 9.48875Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "colorChannel1",
        d: "M1.98682 13.4992C1.98682 12.5603 2.74793 11.7992 3.68682 11.7992H14.2868C15.2257 11.7992 15.9868 12.5603 15.9868 13.4992V13.4992C15.9868 14.4381 15.2257 15.1992 14.2868 15.1992H3.68682C2.74793 15.1992 1.98682 14.4381 1.98682 13.4992V13.4992Z"
      }
    }
  ]
};
var cf = (0, import_react.forwardRef)(function(e, t3) {
  return (0, import_react.createElement)(ct6, Object.assign({}, e, {
    id: "paint-bucket-double-icon",
    ref: t3,
    icon: g0
  }));
});
cf.displayName = "PaintBucketDoubleIcon";
var m0 = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [
    {
      tag: "path",
      attrs: {
        fill: "colorChannel1",
        d: "M7.74692 9.12463C7.74692 9.46018 8.01893 9.73219 8.35448 9.73219H11.4933C11.8288 9.73219 12.1009 9.46018 12.1009 9.12463C12.1009 8.78909 11.8288 8.51707 11.4933 8.51707H8.35448C8.01893 8.51707 7.74692 8.78909 7.74692 9.12463Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "colorChannel1",
        d: "M10.8636 10.8523C10.8636 11.1879 10.5915 11.4599 10.256 11.4599H8.35448C8.01893 11.4599 7.74692 11.1879 7.74692 10.8523C7.74692 10.5168 8.01893 10.2447 8.35448 10.2447H10.256C10.5915 10.2447 10.8636 10.5168 10.8636 10.8523Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M5.4791 1.98268C5.47913 1.71529 5.87912 1.49854 6.37252 1.49854C6.86593 1.49854 7.26592 1.71529 7.26595 1.98268H7.62187C8.22277 1.98268 8.72459 2.39534 8.84412 2.9452H9.39563C10.0856 2.9452 10.6449 3.48923 10.6449 4.16032V6.00569H12.1261C13.161 6.00569 14 6.82174 14 7.82838V11.334C14 11.8174 13.8025 12.281 13.4511 12.6228L12.0693 13.9647C11.7179 14.3065 11.2412 14.4985 10.7442 14.4985H7.91116C7.05024 14.4985 6.32492 14.0431 6.10535 13.2737H3.34925C2.6593 13.2737 2.09998 12.7297 2.09998 12.0586V4.16032C2.09998 3.48923 2.6593 2.9452 3.34925 2.9452H3.90107C4.0206 2.39534 4.52241 1.98268 5.12332 1.98268H5.4791ZM3.97249 4.16032H3.24925L3.24925 12.0586H6.03725V7.82838C6.03725 6.82174 6.87623 6.00569 7.91116 6.00569H9.49563V4.16032H8.7727C8.58289 4.59611 8.13909 4.90183 7.62187 4.90183H5.12332C4.6061 4.90183 4.1623 4.59611 3.97249 4.16032ZM5.12332 2.89403H7.62187C7.79436 2.89403 7.93419 3.03003 7.93419 3.19781V3.68671C7.93419 3.85448 7.79436 3.99049 7.62187 3.99049H5.12332C4.95083 3.99049 4.811 3.85448 4.811 3.68671V3.19781C4.811 3.03003 4.95083 2.89403 5.12332 2.89403ZM7.91116 7.11157C7.56618 7.11157 7.28652 7.38359 7.28652 7.71913V12.7851C7.28652 13.1206 7.56618 13.3927 7.91116 13.3927H10.7442C10.8401 13.3927 10.9337 13.3712 11.0182 13.3311C11.1373 13.2746 11.1859 13.1423 11.1859 13.0134V12.0066C11.1859 11.8724 11.2978 11.7636 11.4358 11.7636H12.4709C12.6034 11.7636 12.7394 11.7163 12.7975 11.6004C12.8388 11.5182 12.8608 11.4272 12.8608 11.334V7.71913C12.8608 7.38359 12.5811 7.11157 12.2362 7.11157H7.91116Z",
        fillRule: "evenodd",
        clipRule: "evenodd"
      }
    }
  ]
};
var df = (0, import_react.forwardRef)(function(e, t3) {
  return (0, import_react.createElement)(ct6, Object.assign({}, e, {
    id: "paste-special-double-icon",
    ref: t3,
    icon: m0
  }));
});
df.displayName = "PasteSpecialDoubleIcon";
var f0 = () => {
  const [, n3] = (0, import_react.useState)({});
  return (0, import_react.useCallback)(() => n3((e) => !e), []);
};
function p02() {
  const n3 = useDependency(Ds), e = useDependency(br), t3 = useDependency(JE), r = useDependency(Nr3), i = useDependency(Hn), [o3, s2] = (0, import_react.useState)([]), [l4, a4] = (0, import_react.useState)(false), [c2, d2] = (0, import_react.useState)({ row: -1, col: -1 }), [u2, h9] = (0, import_react.useState)(Le4.SERIES), [m9, g9] = (0, import_react.useState)(false), f4 = Wr4(), { sheetSkeletonManagerService: p3, selectionRenderService: v6 } = (0, import_react.useMemo)(() => {
    if (f4) {
      const Z9 = t3.getRenderById(f4.getUnitId());
      return {
        sheetSkeletonManagerService: Z9 == null ? void 0 : Z9.with(he2),
        selectionRenderService: Z9 == null ? void 0 : Z9.with(gt)
      };
    }
    return { sheetSkeletonManagerService: null, selectionRenderService: null };
  }, [f4, t3]), S = () => {
    g9(true);
  }, w6 = () => {
    g9(false);
  }, C = f0();
  if ((0, import_react.useEffect)(() => n3.onCommandExecuted((de3, Re5) => {
    de3.id === or4.id && C();
  }).dispose, [C, n3]), (0, import_react.useEffect)(() => {
    const Z9 = p3 && Be(
      p3.currentSkeleton$.subscribe((de3) => {
        de3 && C();
      })
    );
    return Z9 == null ? void 0 : Z9.dispose;
  }, [p3, C]), (0, import_react.useEffect)(() => Be(
    r.menu$.subscribe((de3) => {
      s2(de3.map((Re5) => __spreadProps(__spreadValues({}, Re5), { index: de3.indexOf(Re5) })));
    })
  ).dispose, [r]), (0, import_react.useEffect)(() => Be(
    r.showMenu$.subscribe((de3) => {
      const { source: Re5, target: we6 } = r.autoFillLocation || { source: null, target: null };
      if (de3 && Re5 && we6) {
        const ke4 = Math.max(Re5.rows[Re5.rows.length - 1], we6.rows[we6.rows.length - 1]), G5 = Math.max(Re5.cols[Re5.cols.length - 1], we6.cols[we6.cols.length - 1]);
        d2({ row: ke4, col: G5 });
      } else
        d2({ row: -1, col: -1 });
    })
  ).dispose, [r]), (0, import_react.useEffect)(() => Be(
    r.applyType$.subscribe((de3) => {
      h9(de3);
    })
  ).dispose, [r]), (0, import_react.useEffect)(() => {
    function Z9() {
      a4(false);
    }
    return document.addEventListener("wheel", Z9), () => {
      document.removeEventListener("wheel", Z9);
    };
  }, [l4]), c2.col < 0 || c2.row < 0)
    return null;
  const I6 = $t4(e, t3);
  if (!I6 || !v6) return null;
  const { scene: R9 } = I6, y6 = p3 == null ? void 0 : p3.getCurrentSkeleton(), E3 = v6.getViewPort(), M10 = R9 == null ? void 0 : R9.scaleX, T10 = R9 == null ? void 0 : R9.scaleY, P8 = R9 == null ? void 0 : R9.getViewportScrollXY(E3);
  if (!M10 || !R9 || !M10 || !T10 || !P8) return null;
  const A4 = (y6 == null ? void 0 : y6.getNoMergeCellWithCoordByIndex(c2.row, c2.col).endX) || 0, x7 = (y6 == null ? void 0 : y6.getNoMergeCellWithCoordByIndex(c2.row, c2.col).endY) || 0, H6 = aA(A4, M10, P8), V7 = rA(x7, T10, P8);
  if (H6 == null || V7 == null) return null;
  const D5 = (Z9) => {
    a4(Z9);
  }, B5 = (Z9) => {
    n3.executeCommand(wa3.id, { type: Z9.value }), a4(false);
  }, F7 = l4 || m9, z5 = o3.filter((Z9) => !Z9.disable);
  return (0, import_jsx_runtime.jsx)("div", { className: "univer-absolute univer-inset-0 univer-z-10 univer-size-0", children: (0, import_jsx_runtime.jsx)(
    "div",
    {
      className: "univer-absolute",
      style: { left: `${H6 + 2}px`, top: `${V7 + 2}px` },
      onMouseEnter: S,
      onMouseLeave: w6,
      children: (0, import_jsx_runtime.jsx)(
        rp,
        {
          align: "start",
          items: z5.map((Z9) => ({
            type: "radio",
            value: u2,
            options: [{ label: i.t(Z9.label), value: Z9.value }],
            onSelect: () => B5(Z9)
          })),
          open: l4,
          onOpenChange: D5,
          children: (0, import_jsx_runtime.jsxs)(
            "div",
            {
              className: ie2("univer-flex univer-items-center univer-gap-2 univer-rounded univer-p-1 hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-800", kt2, {
                "univer-bg-gray-100 dark:!univer-bg-gray-800": l4,
                "univer-bg-white dark:!univer-bg-gray-900": !l4
              }),
              children: [
                (0, import_jsx_runtime.jsx)(
                  af,
                  {
                    className: "univer-fill-primary-600 univer-text-gray-900 dark:!univer-text-white"
                  }
                ),
                F7 && (0, import_jsx_runtime.jsx)(Mi2, { className: "dark:!univer-text-white" })
              ]
            }
          )
        }
      )
    }
  ) });
}
function uf(n3, e) {
  const t3 = useDependency(Qe3), r = useDependency(Ds);
  return (0, import_react.useMemo)(() => ({
    keyCodes: [
      { keyCode: q1.ENTER },
      { keyCode: q1.ESC },
      { keyCode: q1.TAB }
    ],
    handler: (o3) => {
      (o3 === q1.ENTER || o3 === q1.ESC || o3 === q1.TAB) && (t3.disableForceKeepVisible(), r.syncExecuteCommand(tt5.id, {
        visible: false,
        eventType: hb.Keyboard,
        keycode: o3,
        unitId: e
      }));
    }
  }), [r, t3, e]);
}
var gl2 = -1e3;
var _h = {
  width: 0,
  height: 0,
  top: gl2,
  left: gl2
};
var v0 = () => {
  const [n3, e] = (0, import_react.useState)(__spreadValues({}, _h)), t3 = useDependency(ds2), r = useDependency(Ge3), i = useDependency(Tr), o3 = useDependency(S13), s2 = useDependency(Qe3), l4 = useObservable(s2.visible$), a4 = useDependency(Ds), c2 = (0, import_react.useRef)(0), d2 = useObservable(
    () => i.subscribeContextValue$(Oi),
    false,
    void 0,
    [i, Oi]
  ), u2 = o3.get(zd2), h9 = s2.getEditLocation();
  (0, import_react.useEffect)(() => {
    const p3 = t3.state$.subscribe((v6) => {
      if (v6 == null)
        return;
      const {
        startX: S = gl2,
        startY: w6 = gl2,
        endX: C = 0,
        endY: I6 = 0,
        show: R9 = false
      } = v6;
      if (!R9)
        e(__spreadValues({}, _h));
      else {
        e({
          width: C - S,
          height: I6 - w6,
          left: S,
          top: w6
        });
        const y6 = r.getEditor(Fl);
        if (y6 == null)
          return;
        const { left: E3, top: M10, width: T10, height: P8 } = y6.getBoundingClientRect();
        t3.setRect({ left: E3, top: M10, width: T10, height: P8 });
      }
    });
    return () => {
      p3.unsubscribe();
    };
  }, []), (0, import_react.useEffect)(() => {
    d2 || t3.setFocus(true);
  }, [d2, n3]);
  const m9 = re2(() => {
    s2.isVisible().visible && a4.executeCommand(tt5.id, {
      visible: false,
      eventType: hb.PointerUp,
      unitId: h9 == null ? void 0 : h9.unitId
    });
  });
  f72(m9);
  const g9 = uf(c2, h9 == null ? void 0 : h9.unitId), f4 = re2((p3, v6) => {
    a4.executeCommand(Ii2.id, {
      keycode: p3,
      visible: false,
      eventType: hb.Keyboard,
      isShift: v6 === y12.SHIFT || v6 === (y12.CTRL_COMMAND | y12.SHIFT),
      unitId: h9 == null ? void 0 : h9.unitId
    });
  });
  return (0, import_jsx_runtime.jsx)(
    "div",
    {
      className: "univer-absolute univer-z-10 univer-flex",
      style: {
        left: n3.left,
        top: n3.top,
        width: n3.width,
        height: n3.height
      },
      children: u2 && (0, import_jsx_runtime.jsx)(
        u2,
        {
          editorId: Fl,
          className: "univer-relative univer-flex univer-h-full univer-w-full [&_canvas]:univer-absolute",
          initValue: "",
          onChange: () => {
          },
          isFocus: l4 == null ? void 0 : l4.visible,
          unitId: h9 == null ? void 0 : h9.unitId,
          subUnitId: h9 == null ? void 0 : h9.sheetId,
          keyboardEventConfig: g9,
          onMoveInEditor: f4,
          isSupportAcrossSheet: true,
          resetSelectionOnBlur: false,
          isSingle: false,
          autoScrollbar: false,
          onFormulaSelectingChange: (p3, v6) => {
            c2.current = p3, v6 && (p3 ? s2.enableForceKeepVisible() : s2.disableForceKeepVisible());
          },
          disableSelectionOnClick: true,
          disableContextMenu: false
        }
      )
    }
  );
};
var hf = class {
  constructor() {
    _2(this, "_position", null);
    _2(this, "_position$", new BehaviorSubject(null));
    _2(this, "position$", this._position$.asObservable());
    _2(this, "_focus", false);
    _2(this, "_focus$", new BehaviorSubject(this._focus));
    _2(this, "focus$", this._focus$.asObservable());
    _2(this, "_fxBtnClick$", new Subject());
    _2(this, "fxBtnClick$", this._fxBtnClick$.asObservable());
    _2(this, "_foldBtnStatus$", new Subject());
    _2(this, "foldBtnStatus$", this._foldBtnStatus$.asObservable());
  }
  dispose() {
    this._position$.complete(), this._focus$.complete(), this._position = null, this._focus = false;
  }
  setPosition(e) {
    this._position = e, this._refresh(e);
  }
  getPosition() {
    return this._position;
  }
  setFocus(e = false) {
    this._focus = e, this._focus$.next(e);
  }
  handleFxBtnClick(e) {
    this._fxBtnClick$.next(e);
  }
  handleFoldBtnClick(e) {
    this._foldBtnStatus$.next(e);
  }
  _refresh(e) {
    this._position$.next(e);
  }
};
var us2 = createIdentifier(
  "univer.sheet-formula-editor-manager.service"
);
function S0() {
  const n3 = useDependency(Ds), e = useDependency(Hn), t3 = useDependency(Lr), r = useDependency(br), i = useDependency(be2), s2 = r.getCurrentUnitForType(we.UNIVER_SHEET).getUnitId(), l4 = () => {
    const h9 = t3.getDefinedNameMap(s2);
    return h9 ? Array.from(Object.values(h9)) : [];
  }, [a4, c2] = (0, import_react.useState)(l4());
  (0, import_react.useEffect)(() => {
    const h9 = t3.update$.subscribe(() => {
      c2(l4());
    });
    return () => {
      h9.unsubscribe();
    };
  }, []), (0, import_react.useEffect)(() => {
    const h9 = i.sidebarOptions$.subscribe((m9) => {
      m9.id === Vo3 && (m9.visible || setTimeout(() => {
        i.sidebarOptions$.next({ visible: false });
      }));
    });
    return () => {
      h9.unsubscribe();
    };
  }, []);
  const d2 = () => {
    n3.executeCommand(au2.id, { value: "open" });
  }, u2 = (h9) => __async(this, null, function* () {
    const { formulaOrRefString: m9, id: g9 } = h9, f4 = t3.getWorksheetByRef(s2, m9);
    if (!f4)
      return;
    f4.isSheetHidden() && (yield n3.executeCommand(gi.id, { unitId: s2, subUnitId: f4.getSheetId() })), t3.focusRange(s2, g9);
  });
  return (0, import_jsx_runtime.jsxs)("div", { className: "univer-w-[300px]", children: [
    (0, import_jsx_runtime.jsx)(
      "ul",
      {
        className: ie2("univer-m-0 univer-max-h-[360px] univer-list-none univer-overflow-y-auto univer-p-0", vr2),
        children: a4.map((h9, m9) => (0, import_jsx_runtime.jsx)(
          "li",
          {
            className: "univer-cursor-pointer univer-px-2 univer-transition-colors univer-duration-200 hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-600",
            onClick: () => {
              u2(h9);
            },
            children: (0, import_jsx_runtime.jsxs)(
              "div",
              {
                className: ie2("univer-flex univer-items-center univer-justify-between univer-gap-2 univer-py-1", fE),
                children: [
                  (0, import_jsx_runtime.jsx)(
                    "div",
                    {
                      className: "univer-w-[50%] univer-flex-shrink-0 univer-truncate univer-text-sm univer-text-gray-600 dark:!univer-text-gray-200",
                      title: h9.name,
                      children: h9.name
                    }
                  ),
                  (0, import_jsx_runtime.jsx)(
                    "div",
                    {
                      className: "univer-w-[50%] univer-flex-shrink-0 univer-truncate univer-text-xs univer-text-gray-400",
                      title: h9.formulaOrRefString,
                      children: h9.formulaOrRefString
                    }
                  )
                ]
              }
            )
          },
          m9
        ))
      }
    ),
    (0, import_jsx_runtime.jsxs)(
      "div",
      {
        className: "univer-cursor-pointer univer-p-2 univer-transition-colors univer-duration-200 hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-600",
        onClick: d2,
        children: [
          (0, import_jsx_runtime.jsx)(
            "div",
            {
              className: "univer-mb-2 univer-text-sm univer-font-semibold univer-text-gray-600 dark:!univer-text-gray-200",
              children: e.t("definedName.managerTitle")
            }
          ),
          (0, import_jsx_runtime.jsx)("div", { className: "univer-text-xs univer-text-gray-400", children: e.t("definedName.managerDescription") })
        ]
      }
    )
  ] });
}
function C0({ disable: n3 }) {
  const [e, t3] = (0, import_react.useState)(""), r = useDependency(Lr);
  (0, import_react.useEffect)(() => {
    const o3 = r.currentRange$.subscribe(() => {
      t3(r.getCurrentRangeForString());
    });
    return () => {
      o3.unsubscribe();
    };
  }, []);
  function i() {
  }
  return (0, import_jsx_runtime.jsxs)(
    "div",
    {
      "data-u-comp": "defined-name",
      className: "univer-relative univer-box-border univer-flex univer-h-full univer-w-24 univer-border-r-gray-200 univer-py-1.5 univer-transition-all",
      children: [
        (0, import_jsx_runtime.jsx)(
          "input",
          {
            className: ie2("univer-box-border univer-h-full univer-w-full univer-appearance-none univer-px-1.5 univer-text-gray-900 focus:univer-outline-none dark:!univer-border-r-gray-700 dark:!univer-bg-gray-900 dark:!univer-text-white", vE, {
              "univer-cursor-not-allowed": n3
            }),
            type: "text",
            value: e,
            onChange: i
          }
        ),
        (0, import_jsx_runtime.jsx)(
          mf,
          {
            overlay: (0, import_jsx_runtime.jsx)("div", { className: "univer-z-[1001]", children: (0, import_jsx_runtime.jsx)(S0, {}) }),
            disabled: n3,
            children: (0, import_jsx_runtime.jsx)(
              "a",
              {
                className: ie2("univer-absolute univer-right-0 univer-top-0 univer-flex univer-h-full univer-cursor-pointer univer-items-center univer-justify-center univer-px-1 univer-transition-colors univer-duration-200 hover:univer-bg-gray-100 dark:!univer-text-white dark:hover:!univer-bg-gray-800", {
                  "univer-cursor-not-allowed univer-text-gray-300 hover:univer-bg-transparent dark:!univer-text-gray-700": n3
                }),
                children: (0, import_jsx_runtime.jsx)(Mi2, {})
              }
            )
          }
        )
      ]
    }
  );
}
function w0(n3) {
  var re5, fe5, Xe9, ge5;
  const { className: e, disableDefinedName: t3 } = n3, [r, i] = (0, import_react.useState)(false), [o3, s2] = (0, import_react.useState)(
    0
    /* Down */
  ), l4 = useDependency(us2), a4 = useDependency(Qe3), c2 = useDependency(lt3), d2 = useDependency(me), u2 = useDependency(br), h9 = useDependency(z), m9 = useDependency(aC), g9 = useDependency(Wt2), f4 = useDependency(Ds), [p3, v6] = (0, import_react.useState)({
    editDisable: false,
    viewDisable: false
  }), [S, w6] = (0, import_react.useState)(false), C = useDependency(S13), I6 = useObservable(() => u2.getCurrentTypeOfUnit$(we.UNIVER_SHEET), void 0, void 0, []), R9 = (0, import_react.useRef)(0), y6 = useObservable(a4.currentEditCellState$), E3 = uf(R9, (re5 = y6 == null ? void 0 : y6.unitId) != null ? re5 : ""), M10 = C.get(zd2), T10 = I12(qm.FORMULA_AUX), P8 = useDependency(Tr);
  useObservable((0, import_react.useMemo)(() => P8.subscribeContextValue$(EE), [P8]));
  const A4 = P8.getContextValue(EE), x7 = (0, import_react.useRef)(null), H6 = useDependency(Ge3);
  (0, import_react.useLayoutEffect)(() => {
    const be4 = I6.activeSheet$.pipe(
      switchMap((ae5) => ae5 ? merge(
        c2.ruleChange$,
        d2.ruleChange$,
        h9.selectionMoveEnd$,
        h9.selectionSet$
      ).pipe(
        switchMap(() => {
          var Wn5, Bn7;
          const it5 = I6.getUnitId(), ot6 = ae5.getSheetId();
          if (!((Wn5 = h9.getCurrentLastSelection()) == null ? void 0 : Wn5.range)) return EMPTY;
          const wt4 = (Bn7 = h9.getCurrentLastSelection()) == null ? void 0 : Bn7.primary;
          return wt4 ? of({
            unitId: it5,
            subUnitId: ot6,
            primary: wt4
          }) : of(null);
        })
      ) : EMPTY)
    ).subscribe((ae5) => {
      var it5, ot6, vt4, wt4, Wn5, Bn7;
      if (ae5) {
        const { unitId: gs2, subUnitId: ms2, primary: jp } = ae5;
        if (c2.getRule(gs2, ms2)) {
          const Gp2 = !((ot6 = (it5 = m9.getPermissionPoint(new Le2(gs2, ms2).id)) == null ? void 0 : it5.value) == null || ot6), qp = !((wt4 = (vt4 = m9.getPermissionPoint(new ds(gs2, ms2).id)) == null ? void 0 : vt4.value) == null || wt4);
          v6({
            viewDisable: qp,
            editDisable: Gp2
          });
          return;
        }
        const { actualRow: Yp, actualColumn: Zp } = jp, Fr5 = g9.getCellInfo(gs2, ms2, Yp, Zp);
        v6({
          editDisable: !((Wn5 = Fr5 == null ? void 0 : Fr5[_.Edit]) == null || Wn5),
          viewDisable: !((Bn7 = Fr5 == null ? void 0 : Fr5[_.View]) == null || Bn7)
        });
      } else
        v6({
          viewDisable: false,
          editDisable: false
        });
    });
    return () => {
      be4.unsubscribe();
    };
  }, [I6]), (0, import_react.useEffect)(() => {
    const be4 = a4.visible$.subscribe((ae5) => {
      i(ae5.visible);
    });
    return () => be4.unsubscribe();
  }, [a4.visible$]), (0, import_react.useEffect)(() => {
    const be4 = a4.currentEditCellState$.subscribe((ae5) => {
      var it5, ot6, vt4;
      (vt4 = (ot6 = (it5 = ae5 == null ? void 0 : ae5.documentLayoutObject.documentModel) == null ? void 0 : it5.getBody()) == null ? void 0 : ot6.customBlocks) != null && vt4.length ? w6(true) : w6(false);
    });
    return () => be4.unsubscribe();
  }, [a4.currentEditCellState$]), (0, import_react.useEffect)(() => {
    const be4 = () => {
      if (!x7.current) return;
      const ae5 = x7.current.getBoundingClientRect();
      l4.setPosition(ae5);
    };
    if (x7.current) {
      be4();
      const ae5 = new ResizeObserver(be4);
      return ae5.observe(x7.current), () => ae5.disconnect();
    }
  }, [l4]);
  function V7() {
    s2(
      o3 === 0 ? 1 : 0
      /* Down */
    ), setTimeout(() => {
      l4.handleFoldBtnClick(
        o3 === 1
        /* Up */
      );
    }, 150);
  }
  function D5() {
    a4.isVisible().visible && f4.executeCommand(tt5.id, {
      visible: false,
      eventType: hb.Keyboard,
      keycode: q1.ESC,
      unitId: y6.unitId
    });
  }
  function B5() {
    a4.isVisible().visible && f4.executeCommand(tt5.id, {
      visible: false,
      eventType: hb.PointerDown,
      unitId: y6.unitId
    });
  }
  function F7() {
    l4.handleFxBtnClick(true);
  }
  const { viewDisable: z5, editDisable: Z9 } = p3, de3 = Z9 || S, Re5 = (0, import_react.useRef)(false), we6 = () => {
    try {
      if (a4.isVisible().visible === false && !f4.syncExecuteCommand(
        tt5.id,
        {
          visible: true,
          eventType: hb.PointerDown,
          unitId: y6.unitId
        }
      )) {
        Re5.current = true;
        return;
      }
      P8.setContextValue(EE, true);
    } catch (be4) {
      throw Re5.current = true, be4;
    }
  }, ke4 = () => {
    Re5.current && setTimeout(() => {
      H6.blur(true);
    }, 30), Re5.current = false;
  }, ee5 = ((ge5 = (Xe9 = (fe5 = y6 == null ? void 0 : y6.documentLayoutObject.documentModel) == null ? void 0 : fe5.getDrawingsOrder()) == null ? void 0 : Xe9.length) != null ? ge5 : 0) > 0 || z5;
  return (0, import_jsx_runtime.jsxs)(
    "div",
    {
      "data-u-comp": "formula-bar",
      className: ie2("univer-box-border univer-flex univer-bg-white univer-transition-[height] univer-ease-linear dark:!univer-bg-gray-900", fE, e, {
        "univer-h-7": o3 === 0,
        "univer-h-20": o3 === 1,
        "univer-pointer-events-none": Z9
      }),
      children: [
        (0, import_jsx_runtime.jsx)("div", { className: "univer-relative univer-box-border univer-h-full univer-w-[100px]", children: (0, import_jsx_runtime.jsx)(C0, { disable: t3 != null ? t3 : Z9 }) }),
        (0, import_jsx_runtime.jsxs)("div", { className: "univer-flex univer-h-full univer-w-full", children: [
          (0, import_jsx_runtime.jsx)("div", { className: ie2("univer-py-1.5", { "univer-cursor-not-allowed univer-text-gray-200": de3 }), children: (0, import_jsx_runtime.jsxs)(
            "div",
            {
              className: ie2("univer-relative univer-box-border univer-flex univer-h-full univer-w-20 univer-items-center univer-justify-center univer-text-xs", vE),
              children: [
                (0, import_jsx_runtime.jsx)(
                  "span",
                  {
                    className: ie2("univer-flex univer-items-center univer-justify-center univer-rounded univer-p-1 univer-text-base dark:!univer-text-white", {
                      "univer-cursor-pointer univer-text-red-600 hover:univer-bg-gray-100 dark:!univer-text-green-400 dark:hover:!univer-bg-gray-700": r
                    }),
                    onClick: D5,
                    children: (0, import_jsx_runtime.jsx)(Jm2, {})
                  }
                ),
                (0, import_jsx_runtime.jsx)(
                  "span",
                  {
                    className: ie2("univer-flex univer-items-center univer-justify-center univer-rounded univer-p-1 univer-text-base dark:!univer-text-white", {
                      "univer-cursor-pointer univer-text-green-600 hover:univer-bg-gray-100 dark:!univer-text-red-400 dark:hover:!univer-bg-gray-700": r
                    }),
                    onClick: B5,
                    children: (0, import_jsx_runtime.jsx)(Br3, {})
                  }
                ),
                (0, import_jsx_runtime.jsx)(
                  "span",
                  {
                    className: "univer-flex univer-cursor-pointer univer-items-center univer-justify-center univer-rounded univer-p-1 univer-text-base hover:univer-bg-gray-100 dark:!univer-text-white dark:hover:!univer-bg-gray-700",
                    onClick: F7,
                    children: (0, import_jsx_runtime.jsx)(nf, {})
                  }
                )
              ]
            }
          ) }),
          (0, import_jsx_runtime.jsxs)("div", { className: "univer-flex univer-w-full univer-flex-1 univer-overflow-hidden univer-pl-3", children: [
            (0, import_jsx_runtime.jsxs)(
              "div",
              {
                ref: x7,
                className: "univer-relative univer-flex-1",
                onPointerDown: we6,
                onPointerUp: ke4,
                style: { pointerEvents: ee5 ? "none" : "auto" },
                children: [
                  M10 && (0, import_jsx_runtime.jsx)(
                    M10,
                    {
                      className: "univer-relative univer-h-full univer-w-full univer-break-words univer-outline-none [&>div]:univer-ring-transparent",
                      disableSelectionOnClick: true,
                      editorId: Hl,
                      initValue: "",
                      onChange: () => {
                      },
                      isFocus: A4,
                      unitId: y6 == null ? void 0 : y6.unitId,
                      subUnitId: y6 == null ? void 0 : y6.sheetId,
                      isSupportAcrossSheet: true,
                      resetSelectionOnBlur: false,
                      isSingle: false,
                      keyboardEventConfig: E3,
                      onFormulaSelectingChange: (be4, ae5) => {
                        R9.current = be4, ae5 && (be4 ? a4.enableForceKeepVisible() : a4.disableForceKeepVisible());
                      },
                      autoScrollbar: false,
                      disableContextMenu: false
                    }
                  ),
                  ee5 && (0, import_jsx_runtime.jsx)(
                    "div",
                    {
                      className: "univer-pointer-events-none univer-relative univer-left-0 univer-top-0 univer-z-[100] univer-h-full univer-w-full univer-cursor-not-allowed univer-bg-white"
                    }
                  )
                ]
              }
            ),
            (0, import_jsx_runtime.jsx)(
              "div",
              {
                className: ie2("univer-flex univer-h-full univer-w-5 univer-cursor-pointer univer-items-center univer-justify-center univer-text-xs univer-text-gray-700 dark:!univer-text-gray-200", { "univer-cursor-not-allowed univer-text-gray-200 dark:!univer-text-gray-700": Z9 }),
                onClick: V7,
                children: (0, import_jsx_runtime.jsx)(
                  ef,
                  {
                    className: ie2({
                      "univer-rotate-180": o3 === 1
                      /* Up */
                    })
                  }
                )
              }
            )
          ] })
        ] }),
        (0, import_jsx_runtime.jsx)(x12, { components: T10 }, "formula-aux")
      ]
    }
  );
}
function Ns2(n3) {
  const _a5 = n3, { children: e, className: t3, style: r, disabled: i = false, onClick: o3 } = _a5, s2 = __objRest(_a5, ["children", "className", "style", "disabled", "onClick"]);
  return (0, import_jsx_runtime.jsx)(
    fr,
    __spreadProps(__spreadValues({
      "data-u-comp": "sheet-bar-append-button",
      className: t3,
      size: "small",
      disabled: i,
      style: r,
      variant: "text",
      onClick: (a4) => {
        if (i) {
          a4.preventDefault();
          return;
        }
        o3 && o3(a4);
      }
    }, s2), {
      children: e
    })
  );
}
function b0() {
  const [n3, e] = (0, import_react.useState)([]), [t3, r] = (0, import_react.useState)(false), i = useDependency(br), o3 = useDependency(Ds), s2 = useDependency(Lr4), l4 = useDependency(lt3), a4 = useObservable(() => i.getCurrentTypeOfUnit$(we.UNIVER_SHEET), null, false, []), c2 = (f4) => {
    const { sheetId: p3 } = f4;
    !p3 || !a4 || (f4.hidden ? o3.executeCommand(gi.id, {
      unitId: a4.getUnitId(),
      subUnitId: p3,
      value: p3
    }) : f4.selected || o3.executeCommand(ui.id, {
      unitId: a4.getUnitId(),
      subUnitId: p3
    }), r(false));
  }, d2 = (0, import_react.useCallback)(() => {
    if (!a4) return;
    const f4 = a4.getSheets(), p3 = a4.getActiveSheet(), v6 = f4.map((S, w6) => ({
      label: S.getName(),
      index: `${w6}`,
      sheetId: S.getSheetId(),
      hidden: S.isSheetHidden() === ie.TRUE,
      selected: p3 === S
    }));
    e(v6);
  }, [a4, l4]), u2 = (0, import_react.useCallback)(() => o3.onCommandExecuted((f4) => {
    switch (f4.id) {
      case St2.id:
      case Lt2.id:
      case jn3.id:
      case ln.id:
      case Tn2.id:
      case pn.id:
        d2();
        break;
    }
  }), [o3, d2]);
  function h9() {
    r(true);
  }
  const m9 = (f4) => {
    r(f4);
  };
  (0, import_react.useEffect)(() => {
    d2();
    const f4 = new ho();
    return f4.add(u2()), f4.add(s2.registerSheetBarMenuHandler({ handleSheetBarMenu: h9 })), () => f4.dispose();
  }, [u2, s2, d2, a4]);
  const g9 = (0, import_react.useMemo)(() => n3.map((f4) => ({
    type: "item",
    children: (0, import_jsx_runtime.jsxs)("div", { className: "univer-relative univer-box-border univer-pl-6", children: [
      (f4.selected || f4.hidden) && (0, import_jsx_runtime.jsxs)("span", { className: "univer-absolute univer-left-1 univer-top-0.5", children: [
        f4.selected && (0, import_jsx_runtime.jsx)(Br3, { className: "univer-size-4 univer-text-primary-600" }),
        f4.hidden && (0, import_jsx_runtime.jsx)(tf, { className: "univer-size-4 univer-text-gray-400" })
      ] }),
      (0, import_jsx_runtime.jsx)(
        "span",
        {
          className: ie2({
            "univer-text-primary-600": f4.selected
          }),
          children: f4.label
        }
      )
    ] }),
    onSelect: () => {
      c2(f4);
    }
  })), [n3]);
  return (0, import_jsx_runtime.jsx)(
    rp,
    {
      align: "start",
      items: g9,
      open: t3,
      onOpenChange: m9,
      children: (0, import_jsx_runtime.jsx)("div", { children: (0, import_jsx_runtime.jsx)(Ns2, { children: (0, import_jsx_runtime.jsx)($m2, {}) }) })
    }
  );
}
function _0(n3) {
  const { sheetId: e, label: t3, color: r, selected: i, menuOverlay: o3 } = n3, [s2, l4] = (0, import_react.useState)(i), a4 = useDependency(Ji);
  (0, import_react.useEffect)(() => {
    l4(i);
  }, [i]);
  const c2 = (d2) => {
    const u2 = a4.getColorFromTheme("gray.900"), h9 = a4.getColorFromTheme("white");
    return new At(d2).isDark() ? h9 : u2;
  };
  return (0, import_jsx_runtime.jsx)(
    "div",
    {
      "data-u-comp": "slide-tab-item",
      "data-id": e,
      className: ie2("univer-mx-1 univer-box-border univer-flex univer-flex-grow univer-cursor-pointer univer-select-none univer-flex-row univer-items-center univer-rounded univer-text-xs univer-transition-[colors,box-shadow]", {
        "dark:!univer-text-white": !r || r && !c2(r),
        "univer-justify-center univer-bg-white univer-font-bold univer-text-primary-700 univer-shadow": s2,
        "dark:!univer-bg-gray-900": s2 && !r,
        "univer-font-medium univer-text-gray-900 hover:univer-bg-gray-100": !s2,
        "dark:hover:!univer-bg-gray-700": !s2 && !r
      }),
      style: {
        backgroundColor: !s2 && r ? r : "",
        color: !s2 && r ? c2(r) : "",
        boxShadow: s2 && r ? `0px 0px 8px rgba(0, 0, 0, 0.08), inset 0px -2px 0px 0px ${r}` : ""
      },
      children: (0, import_jsx_runtime.jsx)(
        "div",
        {
          className: "univer-box-border univer-flex univer-items-center univer-gap-1 univer-whitespace-nowrap univer-rounded univer-border-2 univer-border-solid univer-border-transparent univer-px-1.5 univer-py-1",
          children: t3
        }
      )
    },
    e
  );
}
var R0 = {
  easeOutStrong(n3, e, t3, r) {
    return -t3 * ((n3 = n3 / r - 1) * n3 * n3 * n3 - 1) + e;
  },
  backOut(n3, e, t3, r, i) {
    return typeof i > "u" && (i = 0.7), t3 * ((n3 = n3 / r - 1) * n3 * ((i + 1) * n3 + i) + 1) + e;
  }
};
var I0 = {
  loop: false,
  begin: 0,
  end: 0,
  duration: 300,
  delay: 0,
  type: "easeOutStrong",
  receive(n3) {
  },
  success(n3) {
  },
  cancel(n3) {
  },
  complete(n3) {
  }
};
var y02 = class {
  constructor(e) {
    _2(this, "_config");
    _2(this, "_status", 0);
    _2(this, "_start", 0);
    _2(this, "_handle", 0);
    _2(this, "_delayHandle", null);
    this._config = __spreadValues(__spreadValues({}, I0), e), this._config.loop && (this._config.complete = () => {
    }, this._config.success = () => {
      this.request();
    });
  }
  static success(...e) {
    let t3 = 0;
    return new Promise((r) => {
      for (let i = 0; i < e.length; i++) {
        const o3 = e[i], s2 = o3._config, l4 = s2.success;
        s2.loop || (s2.success = (c2) => {
          t3++, l4 && l4.call(o3, c2), t3 === e.length && r();
        });
      }
    });
  }
  request() {
    this._config.delay === 0 ? (this._status = 0, this._start = Date.now(), this._fakeHandle()) : (this._delayHandle && clearTimeout(this._delayHandle), this._delayHandle = setTimeout(() => {
      this._status = 0, this._start = Date.now(), this._fakeHandle();
    }, this._config.delay));
  }
  cancel() {
    this._status = 1, this._delayHandle && clearTimeout(this._delayHandle), cancelAnimationFrame(this._handle);
  }
  _fakeHandle() {
    let e = Date.now() - this._start;
    e = e >= this._config.duration ? this._config.duration : e;
    const r = R0[this._config.type](
      e,
      this._config.begin,
      this._config.end - this._config.begin,
      this._config.duration,
      0.7
    ).toFixed(2);
    if (this._config.receive(r), this._status === 1) {
      this._config.cancel(r), this._config.complete(r);
      return;
    }
    if (e === this._config.duration) {
      this._config.success(r), this._config.complete(r);
      return;
    }
    this._handle = requestAnimationFrame(() => {
      this._fakeHandle();
    });
  }
};
var vr5 = class _vr {
  constructor(e, t3) {
    _2(this, "_slideTabItem");
    _2(this, "_animate");
    _2(this, "_midline", 0);
    _2(this, "_translateX");
    _2(this, "_scrollbar");
    _2(this, "_slideTabBar");
    _2(this, "_editMode");
    _2(this, "_placeholder");
    this._slideTabItem = e, this._animate = null, this._translateX = 0, this._editMode = false, this._slideTabBar = t3, this._placeholder = null, this._scrollbar = t3.getScrollbar(), this.update();
  }
  static midline(e) {
    return e.getBoundingRect().x + e.getBoundingRect().width / 2;
  }
  static leftLine(e) {
    return e.getBoundingRect().x;
  }
  static rightLine(e) {
    return e.getBoundingRect().x + e.getBoundingRect().width;
  }
  static make(e, t3) {
    const r = [];
    return e.forEach((i) => r.push(new _vr(i, t3))), r;
  }
  getSlideTabItem() {
    return this._slideTabItem;
  }
  getEditor() {
    return this._slideTabItem.querySelector("span");
  }
  focus() {
    var e;
    (e = this.getEditor()) == null || e.focus();
  }
  selectAll() {
    const e = this.getEditor();
    e && hi3.keepSelectAll(e);
  }
  isEditMode() {
    return this._editMode;
  }
  classList() {
    return this._slideTabItem.classList;
  }
  translateX(e) {
    return this._translateX = e, this._slideTabItem.style.transform = `translateX(${e}px)`, this.getTranslateXDirection();
  }
  setEditor(e) {
    if (!this._slideTabBar.getConfig().onNameChangeCheck())
      return;
    let t3 = true;
    if (this._editMode === false) {
      const r = this._slideTabItem.querySelector("span"), i = (c2) => {
        if (!this.nameCheck()) {
          if (this._editMode = false, r && (r.removeAttribute("contentEditable"), r.removeEventListener("focusout", i), r.removeEventListener("compositionstart", s2), r.removeEventListener("compositionend", l4), r.removeEventListener("input", a4), r.removeEventListener("keydown", o3)), this._slideTabBar.removeListener(), this._slideTabBar.updateItems(), this._slideTabBar.getConfig().onChangeName) {
            const d2 = (r == null ? void 0 : r.innerText) || "", u2 = this.getId();
            this._slideTabBar.getConfig().onChangeName(u2, d2);
          }
          e && e(c2);
        }
      };
      let o3 = (c2) => {
        r && (c2.stopPropagation(), c2.key === "Enter" && r.blur());
      };
      const s2 = (c2) => {
        t3 = false;
      }, l4 = (c2) => {
        t3 = true;
      }, a4 = (c2) => {
        if (!r) return;
        const d2 = 31;
        setTimeout(() => {
          if (t3) {
            const u2 = r.innerText;
            u2.length > d2 && (r.innerText = u2.substring(0, d2), hi3.keepLastIndex(r));
          }
        }, 0);
      };
      r && (r.setAttribute("contentEditable", "true"), r.addEventListener("focusout", i), r.addEventListener("compositionstart", s2), r.addEventListener("compositionend", l4), r.addEventListener("input", a4), r.addEventListener("keydown", o3), this._editMode = true, hi3.keepSelectAll(r));
    }
  }
  nameCheck() {
    const e = this._slideTabItem.querySelector("span");
    if (!e) return false;
    const t3 = e.innerText;
    return this._slideTabBar.getConfig().onNameCheckAlert(t3);
  }
  animate() {
    return {
      translateX: (e) => {
        this._translateX !== e && (this._animate && (this._animate.cancel(), this._animate = null), this._animate = new y02({
          begin: this._translateX,
          end: e,
          receive: (t3) => {
            this._slideTabItem.style.transform = `translateX(${t3}px)`;
          }
        }), this._translateX = e, this._animate.request());
      },
      cancel: () => {
        this._animate && (this._animate.cancel(), this._animate = null);
      }
    };
  }
  after(e) {
    this._slideTabItem.after(e._slideTabItem || e);
  }
  update() {
    this._midline = _vr.midline(this);
  }
  disableFixed() {
    if (this._placeholder) {
      const e = this._slideTabBar.primeval();
      this._slideTabItem.style.removeProperty("position"), this._slideTabItem.style.removeProperty("left"), this._slideTabItem.style.removeProperty("top"), this._slideTabItem.style.removeProperty("width"), this._slideTabItem.style.removeProperty("height"), this._slideTabItem.style.removeProperty("background"), this._slideTabItem.style.removeProperty("padding"), this._slideTabItem.style.removeProperty("box-sizing"), this._slideTabItem.style.removeProperty("font-size"), this._slideTabItem.style.removeProperty("font-family"), this._slideTabItem.style.removeProperty("font-weight"), this._slideTabItem.style.removeProperty("color"), this._slideTabItem.style.removeProperty("border-radius"), this._placeholder.after(this._slideTabItem), e.removeChild(this._placeholder), this._placeholder = null;
    }
  }
  enableFixed() {
    const e = document.createElement("div"), t3 = this.getBoundingRect(), r = getComputedStyle(this._slideTabItem), i = this._slideTabItem.querySelector("span");
    if (this._placeholder = e, this._placeholder.style.width = `${t3.width}px`, this._placeholder.style.height = `${t3.height}px`, this._placeholder.style.flexShrink = "0", this._placeholder.style.margin = r.margin, this._slideTabItem.style.background = r.background, i) {
      const o3 = getComputedStyle(i).padding;
      this._slideTabItem.style.padding = o3;
    }
    this._slideTabItem.style.boxSizing = r.boxSizing, this._slideTabItem.style.fontSize = r.fontSize, this._slideTabItem.style.fontFamily = r.fontFamily, this._slideTabItem.style.fontWeight = r.fontWeight, this._slideTabItem.style.color = r.color, this._slideTabItem.style.borderRadius = r.borderRadius, this._slideTabItem.style.left = `${t3.x - this.getScrollbar().getScrollX()}px`, this._slideTabItem.style.top = `${t3.y}px`, this._slideTabItem.style.width = `${t3.width}px`, this._slideTabItem.style.height = `${t3.height}px`, this._slideTabItem.style.position = "fixed", this._slideTabItem.after(e), document.body.appendChild(this._slideTabItem);
  }
  addEventListener(e, t3, r) {
    this._slideTabItem.addEventListener(e, t3, r);
  }
  removeEventListener(e, t3, r) {
    this._slideTabItem.removeEventListener(e, t3, r);
  }
  getScrollbar() {
    return this._scrollbar;
  }
  getMidLine() {
    return this._midline;
  }
  getBoundingRect() {
    const e = this._slideTabItem.getBoundingClientRect();
    return e.x += this._scrollbar.getScrollX(), e;
  }
  getWidth() {
    return this.getBoundingRect().width;
  }
  getTranslateXDirection() {
    const e = _vr.midline(this);
    return e > this._midline ? 1 : e < this._midline ? -1 : 0;
  }
  equals(e) {
    return e && e._slideTabItem === this._slideTabItem;
  }
  getId() {
    return this._slideTabItem.dataset.id || "";
  }
};
var M0 = class {
  constructor(e) {
    _2(this, "_slideTabBar");
    _2(this, "_scrollX");
    const t3 = e.primeval();
    this._scrollX = t3.scrollLeft, this._slideTabBar = e;
  }
  scrollX(e) {
    const t3 = this._slideTabBar.primeval();
    t3.scrollLeft = e, this._scrollX = t3.scrollLeft;
  }
  scrollRight() {
    const e = this._slideTabBar.primeval();
    e.scrollLeft = e.scrollWidth, this._scrollX = e.scrollLeft;
  }
  getScrollX() {
    return this._scrollX;
  }
};
var ni2 = class ni3 {
  // eslint-disable-next-line max-lines-per-function
  constructor(e) {
    _2(this, "_activeTabItemIndex", 0);
    _2(this, "_slideTabBar");
    _2(this, "_slideTabItems", []);
    _2(this, "_config");
    _2(this, "_downActionX", 0);
    _2(this, "_moveActionX", 0);
    _2(this, "_compareIndex", 0);
    _2(this, "_activeTabItem", null);
    _2(this, "_moveAction");
    _2(this, "_upAction");
    _2(this, "_downAction");
    _2(this, "_wheelAction");
    _2(this, "_scrollIncremental", 0);
    _2(this, "_compareDirection", 0);
    _2(this, "_autoScrollTime", null);
    _2(this, "_slideScrollbar");
    _2(this, "_longPressTimer", null);
    _2(this, "_leftBoundingLine", 0);
    _2(this, "_rightBoundingLine", 0);
    _2(this, "_leftMoveX", 0);
    _2(this, "_rightMoveX", 0);
    if (e.slideTabBarContainer == null)
      throw new Error("not found slide-tab-bar root element");
    const t3 = e.slideTabBarContainer.querySelector(`${e.slideTabBarSelector}`);
    if (t3 == null)
      throw new Error("not found slide-tab-bar");
    this._slideTabBar = t3, this._slideScrollbar = new M0(this), this._config = e, this._initConfig();
    let r = 0, i = 0, o3 = 0;
    this._downAction = (s2) => {
      var I6, R9, y6, E3, M10, T10;
      if ((I6 = this._activeTabItem) != null && I6.isEditMode())
        return;
      this._longPressTimer && (clearTimeout(this._longPressTimer), this._longPressTimer = null);
      const l4 = (y6 = (R9 = s2.target) == null ? void 0 : R9.closest(`${e.slideTabBarItemSelector}`)) == null ? void 0 : y6.getAttribute("data-id"), a4 = this._slideTabItems.findIndex((P8) => P8.getId() === l4);
      if (l4 == null || a4 === -1) return;
      if (this._activeTabItemIndex !== a4) {
        (E3 = this._activeTabItem) == null || E3.removeEventListener("pointermove", this._moveAction), (M10 = this._activeTabItem) == null || M10.removeEventListener("pointerup", this._upAction), this.removeListener(), this._config.onChangeTab(s2, l4);
        return;
      }
      if (this._compareIndex = a4, this._downActionX = s2.pageX, this._moveActionX = 0, this._scrollIncremental = 0, this._activeTabItem = this._slideTabItems[a4], !this._activeTabItem) {
        console.error("Not found active slide-tab-item in sheet bar");
        return;
      }
      const c2 = this._activeTabItem.getSlideTabItem();
      c2 == null || c2.setPointerCapture(s2.pointerId), (T10 = this._activeTabItem) == null || T10.addEventListener("pointerup", this._upAction);
      const { x: d2, width: u2 } = this._activeTabItem.getBoundingRect(), { x: h9, width: m9 } = this.getBoundingRect(), g9 = this._slideScrollbar.getScrollX();
      if (this._leftBoundingLine = this._downActionX - (d2 - g9), this._rightBoundingLine = d2 - g9 + u2 - this._downActionX, this._leftMoveX = d2 - h9 - g9, this._rightMoveX = h9 + m9 - (d2 + u2) + g9, s2.button === 2 || this._hasEditItem())
        return;
      const { pageX: f4, pageY: p3 } = s2, v6 = Date.now(), S = v6 - o3 <= ni3.DoubleClickDelay, w6 = Math.abs(f4 - r) < 10, C = Math.abs(p3 - i) < 10;
      S && w6 && C && this._activeTabItem.setEditor(), r = f4, i = p3, o3 = v6, this._longPressTimer = setTimeout(() => {
        var P8, A4, x7;
        !c2 || (P8 = this._activeTabItem) != null && P8.isEditMode() || ((A4 = this._activeTabItem) == null || A4.enableFixed(), this._startAutoScroll(), c2.setPointerCapture(s2.pointerId), c2.style.cursor = "move", (x7 = this._activeTabItem) == null || x7.addEventListener("pointermove", this._moveAction));
      }, ni3.LongPressDelay);
    }, this._upAction = (s2) => {
      var c2, d2, u2, h9;
      if ((c2 = this._activeTabItem) != null && c2.isEditMode() || (this._longPressTimer && (clearTimeout(this._longPressTimer), this._longPressTimer = null), !this._activeTabItem)) return;
      const l4 = this._autoScrollTime !== null;
      this._closeAutoScroll(), this._activeTabItem.disableFixed(), this.updateItems();
      const a4 = (d2 = this._activeTabItem) == null ? void 0 : d2.getSlideTabItem();
      a4 && (a4.style.cursor = "", a4.releasePointerCapture(s2.pointerId), (u2 = this._activeTabItem) == null || u2.removeEventListener("pointermove", this._moveAction), (h9 = this._activeTabItem) == null || h9.removeEventListener("pointerup", this._upAction), this._config.onSlideEnd && this._activeTabItemIndex !== this._compareIndex && l4 && (this.removeListener(), this._config.onSlideEnd(s2, this._compareIndex || 0)), this._scrollIncremental = 0, this._downActionX = 0, this._moveActionX = 0, this._compareIndex = 0);
    }, this._moveAction = (s2) => {
      this._activeTabItem && (this._moveActionX = s2.pageX - this._downActionX, this._moveActionX <= -this._leftMoveX ? this._moveActionX = -this._leftMoveX : this._moveActionX >= this._rightMoveX && (this._moveActionX = this._rightMoveX), this._scrollIncremental = 0, this._scrollLeft(s2), this._scrollRight(s2));
    }, this._wheelAction = (s2) => {
      this.setScroll(s2.deltaY);
    }, this.addListener();
  }
  static checkedSkipSlide(e) {
    let t3 = e.target;
    for (; t3 != null && t3 !== document.body; ) {
      if (t3.getAttribute("data-slide-skip"))
        return true;
      t3 = t3.parentElement;
    }
    return false;
  }
  static keepLastIndex(e) {
    setTimeout(() => {
      const t3 = window.getSelection();
      t3 && (t3.selectAllChildren(e), t3.collapseToEnd());
    });
  }
  static keepSelectAll(e) {
    setTimeout(() => {
      const t3 = window.getSelection();
      if (!t3) return;
      const r = document.createRange();
      r.selectNodeContents(e), t3.removeAllRanges(), t3.addRange(r);
    });
  }
  /**
   * The current instance is persistent, but some parameters need to be updated after refreshing
   * @param currentIndex
   */
  update(e) {
    this._config.currentIndex = e, this._initConfig(), this.removeListener(), this.addListener(), this.scrollToItem(e);
  }
  primeval() {
    return this._slideTabBar;
  }
  updateItems() {
    for (let e = 0; e < this._slideTabItems.length; e++)
      this._slideTabItems[e].animate().cancel(), this._slideTabItems[e].translateX(0), this._slideTabItems[e].update();
  }
  getScrollbar() {
    return this._slideScrollbar;
  }
  getConfig() {
    return this._config;
  }
  getBoundingRect() {
    return this._slideTabBar.getBoundingClientRect();
  }
  getSlideTabItems() {
    return this._slideTabItems;
  }
  getActiveItem() {
    return this._activeTabItem;
  }
  isLeftEnd() {
    return this._slideTabBar.scrollLeft === 0;
  }
  isRightEnd() {
    const e = this._slideTabBar.parentElement;
    return e ? this._slideTabBar.scrollWidth - e.clientWidth === this._slideTabBar.scrollLeft : false;
  }
  addListener() {
    this._slideTabBar.addEventListener("wheel", this._wheelAction), this._slideTabItems.forEach((e) => {
      e.addEventListener("pointerdown", this._downAction);
    });
  }
  removeListener() {
    this._slideTabBar.removeEventListener("wheel", this._wheelAction), this._slideTabItems.forEach((e) => {
      e.removeEventListener("pointerdown", this._downAction);
    });
  }
  setScroll(e) {
    if (this._slideScrollbar.scrollX(this._slideScrollbar.getScrollX() + e), e > 0) {
      const t3 = this.calculateLeftScrollX();
      this._slideScrollbar.scrollX(this._slideScrollbar.getScrollX() + t3);
    } else if (e < 0) {
      const t3 = this.calculateRightScrollX();
      this._slideScrollbar.scrollX(this._slideScrollbar.getScrollX() + t3);
    }
    this._config.onScroll({
      leftEnd: this.isLeftEnd(),
      rightEnd: this.isRightEnd()
    });
  }
  flipPage(e) {
    if (e > 0) {
      const t3 = this.calculateLeftScrollX(true);
      this._slideScrollbar.scrollX(this._slideScrollbar.getScrollX() + t3);
    } else if (e < 0) {
      const t3 = this.calculateRightScrollX(true);
      this._slideScrollbar.scrollX(this._slideScrollbar.getScrollX() + t3);
    }
    this._config.onScroll({
      leftEnd: this.isLeftEnd(),
      rightEnd: this.isRightEnd()
    });
  }
  scrollToItem(e) {
    if (e = e != null ? e : this._config.currentIndex, e < 0 || e >= this._slideTabItems.length) {
      console.error("Index out of bounds");
      return;
    }
    const t3 = this.calculateTabItemScrollX(e);
    this._slideScrollbar.scrollX(this._slideScrollbar.getScrollX() + t3), this._config.onScroll({
      leftEnd: this.isLeftEnd(),
      rightEnd: this.isRightEnd()
    });
  }
  calculateLeftScrollX(e) {
    let t3 = 0;
    const r = 4;
    return this._slideTabItems.some((i) => {
      const o3 = this._slideTabBar.getBoundingClientRect(), s2 = o3.left + o3.width, l4 = i.getSlideTabItem().getBoundingClientRect(), a4 = l4.left, c2 = l4.width;
      return a4 < s2 && a4 + c2 + r * 2 > s2 ? (t3 = e ? a4 - o3.left - r : a4 + c2 - s2 + r, true) : false;
    }), t3;
  }
  calculateRightScrollX(e) {
    let t3 = 0;
    const r = 4;
    return this._slideTabItems.some((i) => {
      const o3 = this._slideTabBar.getBoundingClientRect(), s2 = o3.left, l4 = i.getSlideTabItem().getBoundingClientRect(), a4 = l4.left, c2 = l4.width;
      return a4 - r * 2 < s2 && a4 + c2 > s2 ? (t3 = e ? a4 + c2 - o3.left - o3.width + r : a4 - s2 - r, true) : false;
    }), t3;
  }
  calculateTabItemScrollX(e) {
    let t3 = 0;
    const r = 4, i = this._slideTabBar.getBoundingClientRect(), o3 = i.left, s2 = i.left + i.width, l4 = this._slideTabItems[e].getSlideTabItem().getBoundingClientRect(), a4 = l4.left, c2 = l4.width;
    return a4 - r * 2 < o3 && (t3 = a4 - o3 - r), a4 + c2 + r * 2 > s2 && (t3 = a4 + c2 - s2 + r), t3;
  }
  calculateActiveTabItemScrollX() {
    var c2;
    let e = 0;
    const t3 = 4, r = this._slideTabBar.getBoundingClientRect(), i = r.left, o3 = r.left + r.width, s2 = (c2 = this._activeTabItem) == null ? void 0 : c2.getSlideTabItem().getBoundingClientRect();
    if (!s2) return 0;
    const l4 = s2.left, a4 = s2.width;
    return l4 - t3 * 2 < i && l4 + a4 > i && (e = l4 - i - t3), l4 < o3 && l4 + a4 + t3 * 2 > o3 && (e = l4 + a4 - o3 + t3), e;
  }
  destroy() {
    this.removeListener(), this._downActionX = 0, this._moveActionX = 0, this._compareDirection = 0, this._compareIndex = 0, this._slideTabItems = [], this._activeTabItem = null;
  }
  _hasEditItem() {
    for (let e = 0; e < this._slideTabItems.length; e++)
      if (this._slideTabItems[e].isEditMode())
        return true;
    return false;
  }
  _autoScrollFrame() {
    if (this._activeTabItem)
      switch (this._compareDirection = this._activeTabItem.translateX(this._moveActionX), this._compareDirection) {
        case 1: {
          this._slideScrollbar.scrollX(this._slideScrollbar.getScrollX() + this._scrollIncremental), this._compareRight();
          break;
        }
        case 0: {
          this._slideScrollbar.scrollX(this._slideScrollbar.getScrollX() + this._scrollIncremental), this._compareIndex = this._activeTabItemIndex;
          break;
        }
        case -1: {
          this._slideScrollbar.scrollX(this._slideScrollbar.getScrollX() + this._scrollIncremental), this._compareLeft();
          break;
        }
      }
    this._autoScrollTime = requestAnimationFrame(() => {
      this._autoScrollFrame();
    });
  }
  _startAutoScroll() {
    this._autoScrollTime == null && this._autoScrollFrame();
  }
  _closeAutoScroll() {
    this._autoScrollTime && cancelAnimationFrame(this._autoScrollTime), this._autoScrollTime = null;
  }
  _scrollLeft(e) {
    const t3 = this.getBoundingRect(), r = e.pageX - t3.x;
    r < this._leftBoundingLine && (this._scrollIncremental = -Math.min(Math.abs(r - this._leftBoundingLine) * 0.1, 50));
  }
  _scrollRight(e) {
    const t3 = this.getBoundingRect(), r = e.pageX - t3.x;
    r > t3.width - this._rightBoundingLine && (this._scrollIncremental = Math.min(Math.abs(r - (t3.width - this._rightBoundingLine)) * 0.1, 50));
  }
  _sortedItems() {
    if (this._activeTabItem != null && this._activeTabItemIndex != null && this._compareIndex != null && (this._slideTabItems.splice(this._activeTabItemIndex, 1), this._slideTabItems.splice(this._compareIndex, 0, this._activeTabItem), this._config.slideTabBarItemAutoSort))
      for (let e = 0; e < this._slideTabItems.length; e++) {
        const t3 = this._slideTabItems[e], r = this._slideTabItems[e + 1];
        r && t3.after(r);
      }
  }
  _compareLeft() {
    if (this._activeTabItem && this._activeTabItemIndex) {
      const e = this._slideTabItems.findIndex((o3) => o3.equals(this._activeTabItem)), t3 = this._slideTabItems.length, r = [];
      for (let o3 = 0; o3 < e && !(o3 >= e); o3++)
        r.push(this._slideTabItems[o3]);
      for (let o3 = e + 1; o3 < t3; o3++)
        this._slideTabItems[o3].animate().translateX(0);
      let i = true;
      for (let o3 = r.length - 1; o3 >= 0; o3--) {
        const s2 = r[o3];
        vr5.leftLine(this._activeTabItem) < s2.getMidLine() ? (s2.animate().translateX(this._activeTabItem.getWidth()), this._compareIndex = o3, i = false) : (s2.animate().translateX(0), i && (this._compareIndex = this._activeTabItemIndex));
      }
    }
  }
  _compareRight() {
    if (this._activeTabItem) {
      const e = this._slideTabItems.findIndex((o3) => o3.equals(this._activeTabItem)), t3 = this._slideTabItems.length, r = [];
      for (let o3 = e + 1; o3 < t3; o3++)
        r.push(this._slideTabItems[o3]);
      for (let o3 = 0; o3 < e; o3++)
        this._slideTabItems[o3].animate().translateX(0);
      let i = true;
      for (let o3 = 0; o3 < r.length; o3++) {
        const s2 = r[o3];
        vr5.rightLine(this._activeTabItem) > s2.getMidLine() ? (s2.animate().translateX(-this._activeTabItem.getWidth()), this._compareIndex = e + o3 + 1, i = false) : (s2.animate().translateX(0), i && (this._compareIndex = this._activeTabItemIndex));
      }
    }
  }
  _initConfig() {
    const e = this._slideTabBar.querySelectorAll(`${this._config.slideTabBarItemSelector}`);
    this._downActionX = 0, this._moveActionX = 0, this._compareDirection = 0, this._compareIndex = 0, this._slideTabItems = vr5.make(e, this), this._activeTabItemIndex = this._config.currentIndex, this._activeTabItem = this._slideTabItems[this._activeTabItemIndex];
  }
};
_2(ni2, "LongPressDelay", 500), // in milliseconds
/** Time in milliseconds with two consecutive clicks will be considered as a double click */
_2(ni2, "DoubleClickDelay", 300);
var hi3 = ni2;
function E02() {
  var ke4;
  const [n3, e] = (0, import_react.useState)([]), [t3, r] = (0, import_react.useState)(""), [i, o3] = (0, import_react.useState)(""), [s2, l4] = (0, import_react.useState)(false), [a4, c2] = (0, import_react.useState)([0, 0]), d2 = (0, import_react.useRef)({ slideTabBar: null }), u2 = (0, import_react.useRef)(null), h9 = useDependency(Ds), m9 = useDependency(Lr4), g9 = useDependency(Hn), f4 = useDependency(at), p3 = useDependency(Qe3, Quantity.OPTIONAL), v6 = useDependency(lt3), S = useDependency(me), w6 = useObservable(v6.resetOrder$), C = Wr4(), I6 = useDependency(aC), R9 = (0, import_react.useCallback)(() => {
    var Xe9;
    const G5 = ((Xe9 = C.getActiveSheet()) == null ? void 0 : Xe9.getSheetId()) || "";
    r(G5);
    const ee5 = C.getSheets(), re5 = C.getActiveSheet(), fe5 = ee5.filter((ge5) => !ge5.isSheetHidden()).map((ge5, be4) => {
      var wt4;
      const ae5 = v6.getRule(C.getUnitId(), ge5.getSheetId()), it5 = S.getSubunitRuleList(C.getUnitId(), ge5.getSheetId()).length > 0, vt4 = (ae5 == null ? void 0 : ae5.permissionId) || it5 ? (0, import_jsx_runtime.jsxs)(import_jsx_runtime.Fragment, { children: [
        (0, import_jsx_runtime.jsx)(hu2, {}),
        (0, import_jsx_runtime.jsx)("span", { className: "univer-outline-none", children: ge5.getName() })
      ] }) : (0, import_jsx_runtime.jsx)("span", { className: "univer-outline-none", children: ge5.getName() });
      return {
        sheetId: ge5.getSheetId(),
        label: vt4,
        index: be4,
        selected: re5 === ge5,
        color: (wt4 = ge5.getTabColor()) != null ? wt4 : void 0
      };
    });
    e(fe5), r(G5);
  }, [S, C, v6]);
  (0, import_react.useEffect)(() => {
    R9();
    const { slideTabBar: G5, disconnectResizeObserver: ee5 } = y6(), re5 = D5(), fe5 = [
      B5(),
      F7(),
      z5()
      // When adding a sheet, it no longer slides, which has been uniformly handled in setupSlideTabBarUpdate
    ];
    return () => {
      re5.dispose(), G5.destroy(), fe5.forEach((Xe9) => Xe9.unsubscribe()), ee5 && ee5();
    };
  }, [w6, C]), (0, import_react.useEffect)(() => {
    n3.length > 0 && V7();
  }, [n3]), (0, import_react.useEffect)(() => {
    const G5 = merge(
      v6.ruleChange$,
      S.ruleChange$
    ).subscribe(() => {
      R9();
    });
    return () => {
      G5.unsubscribe();
    };
  }, [v6, R9]);
  const y6 = () => {
    const G5 = new hi3({
      slideTabBarSelector: "[data-u-comp=slide-tab-bar]",
      slideTabBarItemSelector: "[data-u-comp=slide-tab-item]",
      slideTabBarItemAutoSort: true,
      slideTabBarContainer: u2.current,
      currentIndex: 0,
      onChangeName: (re5, fe5) => {
        h9.executeCommand(eo2.id, {
          subUnitId: re5,
          name: fe5
        });
      },
      onSlideEnd: (re5, fe5) => __async(this, null, function* () {
        yield h9.executeCommand(ci.id, { order: fe5 });
      }),
      onChangeTab: (re5, fe5) => {
        h9.executeCommand(pn.id, {
          subUnitId: fe5,
          unitId: C.getUnitId()
        }).then(() => {
          re5.button === 2 && we6(true);
        });
      },
      onScroll: (re5) => {
        m9.setScroll(re5);
      },
      onNameCheckAlert: (re5) => T10(re5) || P8(re5) || A4(re5),
      onNameChangeCheck: () => {
        var ae5, it5, ot6, vt4;
        const re5 = C.getUnitId(), fe5 = C == null ? void 0 : C.getActiveSheet();
        if (!fe5)
          throw new Error("No active sheet found");
        const Xe9 = fe5.getSheetId(), ge5 = v6.getRule(re5, Xe9), be4 = S.getSubunitRuleList(re5, Xe9).length > 0;
        return ge5 || be4 ? (it5 = (ae5 = I6.getPermissionPoint(new zs(re5).id)) == null ? void 0 : ae5.value) != null ? it5 : false : (vt4 = (ot6 = I6.getPermissionPoint(new Ks(re5).id)) == null ? void 0 : ot6.value) != null ? vt4 : false;
      }
    });
    d2.current.slideTabBar = G5;
    const ee5 = Re5(G5);
    return { slideTabBar: G5, disconnectResizeObserver: ee5 };
  }, E3 = y5(ae), M10 = (ke4 = E3 == null ? void 0 : E3.contextMenu) != null ? ke4 : true, T10 = (G5) => {
    if (G5.trim() === "") {
      const ee5 = "sheetNameEmptyAlert";
      return f4.open({
        id: ee5,
        title: { title: g9.t("sheetConfig.sheetNameErrorTitle") },
        children: { title: g9.t("sheetConfig.sheetNameCannotIsEmptyError") },
        cancelText: g9.t("button.cancel"),
        confirmText: g9.t("button.confirm"),
        onClose() {
          x7(), f4.close(ee5);
        },
        onConfirm() {
          x7(), f4.close(ee5);
        }
      }), true;
    }
    return false;
  }, P8 = (G5) => {
    if (!iI(G5)) {
      const ee5 = "sheetNameSpecCharAlert";
      return f4.open({
        id: ee5,
        title: { title: g9.t("sheetConfig.sheetNameErrorTitle") },
        children: { title: g9.t("sheetConfig.sheetNameSpecCharError") },
        cancelText: g9.t("button.cancel"),
        confirmText: g9.t("button.confirm"),
        onClose() {
          x7(), f4.close(ee5);
        },
        onConfirm() {
          x7(), f4.close(ee5);
        }
      }), true;
    }
    return false;
  }, A4 = (G5) => {
    const ee5 = C.getActiveSheet();
    if ((ee5 == null ? void 0 : ee5.getName()) === G5) return false;
    const fe5 = C.checkSheetName(G5);
    if (fe5) {
      const Xe9 = "sheetNameRepeatAlert";
      f4.open({
        id: Xe9,
        title: { title: g9.t("sheetConfig.sheetNameErrorTitle") },
        children: { title: g9.t("sheetConfig.sheetNameAlreadyExistsError") },
        cancelText: g9.t("button.cancel"),
        confirmText: g9.t("button.confirm"),
        onClose() {
          f4.close(Xe9), x7();
        },
        onConfirm() {
          f4.close(Xe9), x7();
        }
      });
    }
    return fe5;
  }, x7 = () => {
    setTimeout(() => {
      var ee5;
      const G5 = (ee5 = d2.current.slideTabBar) == null ? void 0 : ee5.getActiveItem();
      G5 && (G5.focus(), G5.selectAll());
    }, 0);
  }, H6 = () => {
    var G5, ee5;
    (ee5 = (G5 = d2.current.slideTabBar) == null ? void 0 : G5.getActiveItem()) == null || ee5.setEditor();
  }, V7 = () => {
    var ee5;
    const G5 = n3.findIndex((re5) => re5.selected);
    (ee5 = d2.current.slideTabBar) == null || ee5.update(G5);
  }, D5 = () => h9.onCommandExecuted((G5) => {
    switch (G5.id) {
      case Un4.id:
      case St2.id:
      case Lt2.id:
      case jn3.id:
      case ln.id:
      case Tn2.id:
      case pn.id:
        R9();
        break;
    }
  }), B5 = () => m9.scroll$.subscribe((G5) => {
    Z9(G5);
  }), F7 = () => m9.scrollX$.subscribe((G5) => {
    var ee5;
    (ee5 = d2.current.slideTabBar) == null || ee5.flipPage(G5);
  }), z5 = () => m9.renameId$.subscribe(() => {
    H6();
  }), Z9 = (G5) => {
    const { leftEnd: ee5, rightEnd: re5 } = G5;
    let fe5 = "";
    ee5 && re5 ? fe5 = "" : ee5 && !re5 ? fe5 = "inset -10px 0px 10px -10px rgba(0, 0, 0, 0.2)" : !ee5 && re5 ? fe5 = "inset 10px 0px 10px -10px rgba(0, 0, 0, 0.2)" : !ee5 && !re5 && (fe5 = "inset 10px 0px 10px -10px rgba(0, 0, 0, 0.2), inset -10px 0px 10px -10px rgba(0, 0, 0, 0.2)"), o3(fe5);
  }, de3 = (G5) => {
    const ee5 = G5.calculateActiveTabItemScrollX();
    if (ee5) {
      const re5 = G5.getScrollbar();
      re5.scrollX(re5.getScrollX() + ee5);
    }
    m9.setScroll({
      leftEnd: G5.isLeftEnd(),
      rightEnd: G5.isRightEnd()
    });
  }, Re5 = (G5) => {
    var fe5;
    const ee5 = (fe5 = u2.current) == null ? void 0 : fe5.querySelector("[data-u-comp=slide-tab-bar]");
    if (!ee5) return;
    const re5 = new ResizeObserver(() => {
      de3(G5);
    });
    return re5.observe(ee5), () => re5.disconnect();
  }, we6 = (G5) => {
    var ee5, re5, fe5, Xe9, ge5;
    if (M10 && !(p3 != null && p3.isForceKeepVisible())) {
      if (G5) {
        const { left: be4 } = (re5 = (ee5 = u2.current) == null ? void 0 : ee5.getBoundingClientRect()) != null ? re5 : {}, { left: ae5 } = (ge5 = (Xe9 = (fe5 = d2.current.slideTabBar) == null ? void 0 : fe5.getActiveItem()) == null ? void 0 : Xe9.getSlideTabItem().getBoundingClientRect()) != null ? ge5 : {};
        be4 !== void 0 && ae5 !== void 0 && c2([ae5 - be4, 0]);
      }
      l4(G5);
    }
  };
  return (0, import_jsx_runtime.jsx)(
    NE,
    {
      className: "univer-select-none",
      visible: s2,
      align: { offset: a4 },
      trigger: ["contextMenu"],
      overlay: (0, import_jsx_runtime.jsx)(
        F5,
        {
          menuType: W1.FOOTER_TABS,
          onOptionSelect: (G5) => {
            const { label: ee5, value: re5, commandId: fe5 } = G5;
            h9.executeCommand(fe5 != null ? fe5 : ee5, { value: re5, subUnitId: t3 }), l4(false);
          }
        }
      ),
      onVisibleChange: we6,
      children: (0, import_jsx_runtime.jsx)(
        "div",
        {
          className: "univer-max-w-[calc(100%-112px)] univer-overflow-hidden",
          ref: u2,
          onDragStart: (G5) => G5.preventDefault(),
          onContextMenu: (G5) => G5.preventDefault(),
          children: (0, import_jsx_runtime.jsx)(
            "div",
            {
              "data-u-comp": "slide-tab-bar",
              className: "univer-flex univer-select-none univer-flex-row univer-items-center univer-overflow-hidden univer-px-1.5 univer-py-1",
              style: { boxShadow: i },
              children: n3.map((G5) => (0, import_react.createElement)(_0, __spreadProps(__spreadValues({}, G5), { key: G5.sheetId, selected: t3 === G5.sheetId })))
            }
          )
        }
      )
    }
  );
}
var Rh3 = 100;
var T0 = () => {
  var f4, p3;
  const [n3, e] = (0, import_react.useState)(true), [t3, r] = (0, import_react.useState)(true), i = useDependency(Ds), o3 = useDependency(Lr4), s2 = useDependency(aC), a4 = Wr4().getUnitId(), c2 = useObservable(s2.getPermissionPoint$((f4 = new Pe3(a4)) == null ? void 0 : f4.id)), d2 = useObservable(s2.getPermissionPoint$((p3 = new ur2(a4)) == null ? void 0 : p3.id)), u2 = (v6) => {
    const { leftEnd: S, rightEnd: w6 } = v6;
    e(S), r(w6);
  };
  (0, import_react.useEffect)(() => {
    const v6 = o3.scroll$.subscribe(nR((S) => {
      u2(S);
    }, 100));
    return () => {
      v6.unsubscribe();
    };
  }, []);
  const h9 = () => {
    i.executeCommand(Sc.id), setTimeout(() => {
      o3.setAddSheet(0);
    }, 0);
  }, m9 = () => {
    o3.setScrollX(-Rh3);
  }, g9 = () => {
    o3.setScrollX(Rh3);
  };
  return (0, import_jsx_runtime.jsxs)("div", { className: "univer-relative univer-flex univer-h-full univer-min-w-0 univer-flex-1", children: [
    (0, import_jsx_runtime.jsxs)("div", { className: "univer-flex univer-items-center", children: [
      (0, import_jsx_runtime.jsx)(
        Ns2,
        {
          className: "univer-mr-2",
          onClick: h9,
          disabled: !(d2 != null && d2.value && (c2 != null && c2.value)),
          children: (0, import_jsx_runtime.jsx)(uu2, {})
        }
      ),
      (0, import_jsx_runtime.jsx)(b0, {})
    ] }),
    (0, import_jsx_runtime.jsx)(E02, {}),
    (!n3 || !t3) && (0, import_jsx_runtime.jsxs)(
      "div",
      {
        className: 'univer-relative univer-flex univer-items-center univer-px-2 after:univer-absolute after:univer-right-0 after:univer-top-1/2 after:univer-h-4 after:univer-w-px after:-univer-translate-y-1/2 after:univer-bg-gray-200 after:univer-content-[""]',
        children: [
          (0, import_jsx_runtime.jsx)(Ns2, { disabled: n3, onClick: m9, children: (0, import_jsx_runtime.jsx)(Qc2, { className: "univer-rotate-180" }) }),
          (0, import_jsx_runtime.jsx)(Ns2, { disabled: t3, onClick: g9, children: (0, import_jsx_runtime.jsx)(Qc2, {}) })
        ]
      }
    )
  ] });
};
var P0 = [50, 75, 100, 125, 150, 175, 200, 400];
function x02() {
  const n3 = useDependency(Ds), e = useDependency(br), t3 = Wr4(), r = useDependency(Qe3), i = useObservable(r.visible$), o3 = (0, import_react.useCallback)(() => {
    if (!t3) return 100;
    const d2 = t3.getActiveSheet(), u2 = d2 && d2.getZoomRatio() * 100 || 100;
    return Math.round(u2);
  }, [t3]), [s2, l4] = (0, import_react.useState)(() => o3());
  (0, import_react.useEffect)(() => (l4(o3()), n3.onCommandExecuted((u2) => {
    if (u2.id === Ln2.id || u2.id === pn.id) {
      const h9 = o3();
      l4(h9);
    }
  }).dispose), [n3, o3]);
  function a4(d2) {
    l4(d2);
    const u2 = e.getCurrentUnitForType(we.UNIVER_SHEET), h9 = u2 == null ? void 0 : u2.getActiveSheet();
    if (h9 == null)
      return;
    const m9 = d2 / 100;
    n3.executeCommand(cs3.id, {
      unitId: u2.getUnitId(),
      subUnitId: h9.getSheetId(),
      zoomRatio: m9
    });
  }
  const c2 = (i == null ? void 0 : i.visible) && (i.unitId === (t3 == null ? void 0 : t3.getUnitId()) || i.unitId === Hl);
  return (0, import_jsx_runtime.jsx)(
    Ji2,
    {
      disabled: c2,
      min: Xc3[0],
      value: s2,
      shortcuts: P0,
      onChange: a4
    }
  );
}
function O0() {
  return (0, import_jsx_runtime.jsx)("section", { className: "univer-flex univer-flex-shrink-0 univer-justify-end", children: (0, import_jsx_runtime.jsx)(x02, {}) });
}
var gf = class {
  constructor() {
    _2(this, "_functions", [
      {
        func: P2.MAX,
        filter: (e) => {
          var t3, r, i, o3;
          return ((r = (t3 = e.values.find((s2) => s2.func === P2.COUNTA)) == null ? void 0 : t3.value) != null ? r : 0) > 1 && ((o3 = (i = e.values.find((s2) => s2.func === P2.COUNT)) == null ? void 0 : i.value) != null ? o3 : 0) > 0;
        }
      },
      {
        func: P2.MIN,
        filter: (e) => {
          var t3, r, i, o3;
          return ((r = (t3 = e.values.find((s2) => s2.func === P2.COUNTA)) == null ? void 0 : t3.value) != null ? r : 0) > 1 && ((o3 = (i = e.values.find((s2) => s2.func === P2.COUNT)) == null ? void 0 : i.value) != null ? o3 : 0) > 0;
        }
      },
      {
        func: F.SUM,
        filter: (e) => {
          var t3, r, i, o3;
          return ((r = (t3 = e.values.find((s2) => s2.func === P2.COUNTA)) == null ? void 0 : t3.value) != null ? r : 0) > 1 && ((o3 = (i = e.values.find((s2) => s2.func === P2.COUNT)) == null ? void 0 : i.value) != null ? o3 : 0) > 0;
        }
      },
      {
        func: P2.COUNTA,
        filter: (e) => {
          var t3, r;
          return ((r = (t3 = e.values.find((i) => i.func === P2.COUNTA)) == null ? void 0 : t3.value) != null ? r : 0) > 1;
        }
      },
      {
        func: P2.COUNT,
        filter: (e) => {
          var t3, r, i, o3;
          return ((r = (t3 = e.values.find((s2) => s2.func === P2.COUNTA)) == null ? void 0 : t3.value) != null ? r : 0) > 1 && ((o3 = (i = e.values.find((s2) => s2.func === P2.COUNT)) == null ? void 0 : i.value) != null ? o3 : 0) > 0;
        }
      },
      {
        func: P2.AVERAGE,
        filter: (e) => {
          var t3, r, i, o3;
          return ((r = (t3 = e.values.find((s2) => s2.func === P2.COUNTA)) == null ? void 0 : t3.value) != null ? r : 0) > 1 && ((o3 = (i = e.values.find((s2) => s2.func === P2.COUNT)) == null ? void 0 : i.value) != null ? o3 : 0) > 0;
        }
      }
    ]);
    _2(this, "_state$", new BehaviorSubject(null));
    _2(this, "state$", this._state$.asObservable());
  }
  dispose() {
    this._state$.complete();
  }
  setState(e) {
    var r;
    const t3 = {
      values: [],
      pattern: null
    };
    e == null || e.values.forEach((i) => {
      const o3 = this._functions.find((s2) => s2.func === i.func);
      o3 && (o3.filter === void 0 || o3.filter(e)) && t3.values.push(i);
    }), t3.pattern = (r = e == null ? void 0 : e.pattern) != null ? r : null, this._state$.next(t3);
  }
  getState() {
    return this._state$.getValue();
  }
  getFunctions() {
    return this._functions;
  }
  addFunctions(e) {
    this._functions.push(...e);
  }
};
var Ha3 = createIdentifier("univer.sheet-status-bar.service");
var A0 = [
  F.SUM,
  P2.AVERAGE,
  P2.MIN,
  P2.MAX
];
var ja6 = {
  [F.SUM]: "statusbar.sum",
  [P2.AVERAGE]: "statusbar.average",
  [P2.MIN]: "statusbar.min",
  [P2.MAX]: "statusbar.max",
  [P2.COUNT]: "statusbar.count",
  [P2.COUNTA]: "statusbar.countA",
  [J2.CONCATENATE]: "concatenate"
};
var H0 = (n3) => {
  const e = useDependency(Hn), t3 = useDependency(et2), r = useDependency(ar2), i = V0(n3), o3 = () => __async(void 0, null, function* () {
    yield r.writeText(n3.value.toString()), t3.show({
      type: GC.Success,
      content: e.t("statusbar.copied")
    });
  });
  return (0, import_jsx_runtime.jsx)(Np, { title: e.t("statusbar.clickToCopy"), placement: "top", children: (0, import_jsx_runtime.jsx)(
    "div",
    {
      className: "univer-flex univer-cursor-pointer univer-truncate univer-text-center univer-text-xs univer-text-gray-400",
      onClick: o3,
      children: (0, import_jsx_runtime.jsx)("span", { children: `${e.t(
        (ja6 == null ? void 0 : ja6[n3.name]) || n3.name
      )}: ${i}` })
    },
    n3.name
  ) });
};
function V0(n3) {
  const { pattern: e, value: t3 } = n3;
  return typeof t3 != "number" ? 0 : t3 >= 1e8 ? t3.toExponential(2) : e && A0.includes(n3.name) ? a1.format(e, t3, { throws: false }) : t3.toLocaleString();
}
var Ih = 800;
var N02 = 3;
var k0 = () => {
  var u2, h9;
  const n3 = (h9 = (u2 = y5(Tt2)) == null ? void 0 : u2.statusBarStatistic) != null ? h9 : true, [e, t3] = (0, import_react.useState)(window.innerWidth < Ih), r = useDependency(Ha3), i = r.getFunctions().map((m9, g9) => ({
    name: m9.func,
    value: 0,
    show: true,
    disable: false,
    pattern: null
  })), o3 = (m9, g9, f4, p3) => {
    const [v6, S] = (0, import_react.useState)(m9), [w6, C] = (0, import_react.useState)(true), I6 = (0, import_react.useMemo)(() => v6.filter((M10) => M10.show && !M10.disable), [v6]), R9 = (0, import_react.useMemo)(() => I6.find((M10) => M10.show && !M10.disable), [I6]), y6 = (0, import_react.useMemo)(() => f4 && R9 ? [R9] : I6, [f4, R9, I6]), E3 = (0, import_react.useCallback)((M10) => {
      const T10 = M10 == null ? void 0 : M10.values;
      if (!(T10 != null && T10.length)) {
        C(false);
        return;
      }
      C(true), S(
        (P8) => P8.map((A4) => {
          var x7, H6, V7;
          return __spreadProps(__spreadValues({}, A4), {
            value: (H6 = (x7 = T10.find((D5) => D5.func === A4.name)) == null ? void 0 : x7.value) != null ? H6 : A4.value,
            disable: !T10.some((D5) => D5.func === A4.name),
            pattern: (V7 = M10 == null ? void 0 : M10.pattern) != null ? V7 : null
          });
        })
      );
    }, []);
    return (0, import_react.useEffect)(() => {
      if (!p3) return;
      const M10 = g9.state$.subscribe(E3);
      return () => M10.unsubscribe();
    }, [p3, g9, E3]), {
      statistics: v6,
      showList: y6,
      show: w6
    };
  }, { showList: s2, show: l4 } = o3(
    i,
    r,
    e,
    n3
  ), a4 = uR(() => {
    const m9 = window.innerWidth < Ih;
    e !== m9 && t3(m9);
  }, 100);
  (0, import_react.useEffect)(() => (window.addEventListener("resize", a4), () => {
    window.removeEventListener("resize", a4);
  }), [e]);
  const d2 = ((m9, g9, f4) => n3 ? (0, import_react.useMemo)(() => m9.length > g9 ? m9.reduce((S, w6, C) => (C % 2 === 0 && S.push(m9.slice(C, C + 2)), S), []).map((S, w6) => (0, import_jsx_runtime.jsxs)("div", { className: "univer-grid univer-h-full univer-items-center", children: [
    S[0] && (0, import_jsx_runtime.jsx)(
      f4,
      __spreadValues({}, S[0]),
      S[0].name
    ),
    S[1] && (0, import_jsx_runtime.jsx)(
      f4,
      __spreadValues({}, S[1]),
      S[1].name
    )
  ] }, `stat-col-${w6}`)) : m9.map((v6) => (0, import_jsx_runtime.jsx)("div", { className: "univer-grid univer-h-full univer-items-center", children: (0, import_jsx_runtime.jsx)(f4, __spreadValues({}, v6)) }, v6.name)), [m9, g9, f4]) : null)(s2, N02, H0);
  return l4 && (0, import_jsx_runtime.jsx)(
    "div",
    {
      className: ie2('univer-relative univer-box-border univer-flex univer-h-full univer-items-center univer-overflow-hidden univer-px-2 after:univer-absolute after:univer-right-0 after:univer-top-1/2 after:univer-block after:univer-h-4 after:univer-w-px after:-univer-translate-y-1/2 after:univer-bg-gray-200 after:univer-content-[""]', {
        "univer-max-w-32": e,
        "univer-max-w-fit": !e
      }),
      children: (0, import_jsx_runtime.jsx)("div", { className: "univer-flex univer-h-full univer-gap-x-2", children: d2 })
    }
  );
};
var mf2 = 36;
function D0() {
  var c2;
  const n3 = y5(Tt2), e = useDependency(Z1), t3 = (c2 = n3 == null ? void 0 : n3.footer) != null ? c2 : true;
  if (!Wr4() || !t3) return null;
  const i = e.getMenuByPositionKey(W1.FOOTER_MENU), { sheetBar: o3 = true, statisticBar: s2 = true, menus: l4 = true, zoomSlider: a4 = true } = (n3 == null ? void 0 : n3.footer) || {};
  return !o3 && !s2 && !l4 && !a4 ? null : (0, import_jsx_runtime.jsxs)(
    "section",
    {
      className: "univer-box-border univer-grid univer-w-full univer-grid-flow-col univer-grid-cols-[1fr,auto,auto,auto] univer-items-center univer-justify-between univer-bg-white univer-px-5 univer-text-gray-900 dark:!univer-bg-gray-900 dark:!univer-text-gray-200",
      style: {
        height: mf2
      },
      "data-range-selector": true,
      children: [
        o3 && (0, import_jsx_runtime.jsx)(T0, {}),
        s2 && (0, import_jsx_runtime.jsx)(k0, {}),
        l4 && i.length > 0 && (0, import_jsx_runtime.jsx)("div", { className: "univer-box-border univer-flex univer-gap-2 univer-px-2", children: i.map((d2) => {
          var u2;
          return (u2 = d2.children) == null ? void 0 : u2.map((h9) => (h9 == null ? void 0 : h9.item) && (0, import_jsx_runtime.jsx)(
            Se,
            __spreadValues({}, h9.item),
            h9.key
          ));
        }) }),
        a4 && (0, import_jsx_runtime.jsx)(O0, {})
      ]
    }
  );
}
function L0() {
  const n3 = y5(Tt2);
  return pf() && (n3 == null ? void 0 : n3.formulaBar) !== false ? (0, import_jsx_runtime.jsx)(w0, {}) : null;
}
function ff() {
  return pf() ? (0, import_jsx_runtime.jsxs)(import_jsx_runtime.Fragment, { children: [
    (0, import_jsx_runtime.jsx)(v0, {}),
    (0, import_jsx_runtime.jsx)(p02, {})
  ] }) : null;
}
function pf() {
  const n3 = useDependency(br), t3 = !!useObservable(() => n3.getCurrentTypeOfUnit$(we.UNIVER_SHEET), null, false, []);
  return (0, import_react.useMemo)(
    () => n3.getAllUnitsForType(we.UNIVER_SHEET).length > 0,
    [n3, t3]
  );
}
var W0 = Object.getOwnPropertyDescriptor;
var B0 = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? W0(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var Yr3 = (n3, e) => (t3, r) => e(t3, r, n3);
var yh3 = 5;
var Mh = 2;
var ko4 = class extends Ve {
  constructor(n3, e, t3, r, i, o3) {
    super(), this._layoutService = n3, this._cellEditorManagerService = e, this._editorBridgeService = t3, this._renderManagerService = r, this._univerInstanceService = i, this._configService = o3;
  }
  get _currentRenderer() {
    return eF(we.UNIVER_SHEET, this._univerInstanceService, this._renderManagerService);
  }
  get _editingUnitId() {
    var n3, e;
    return (e = (n3 = this._editorBridgeService.getEditCellState()) == null ? void 0 : n3.unitId) != null ? e : "";
  }
  get _editingRenderer() {
    return this._renderManagerService.getRenderById(this._editingUnitId);
  }
  get _renderer() {
    var e;
    const n3 = (e = this._univerInstanceService.getCurrentUnitOfType(we.UNIVER_SHEET)) == null ? void 0 : e.getUnitId();
    return this._editingUnitId === n3 ? this._editingRenderer : this._currentRenderer;
  }
  get _sheetSkeletonManagerService() {
    var n3;
    return (n3 = this._renderer) == null ? void 0 : n3.with(he2);
  }
  get engine() {
    var n3;
    return (n3 = this._renderer) == null ? void 0 : n3.engine;
  }
  // eslint-disable-next-line complexity
  fitTextSize(n3) {
    var E3, M10, T10, P8;
    const e = this._editorBridgeService.getEditCellState();
    if (!e) return;
    const { position: t3, documentLayoutObject: r, canvasOffset: i, scaleX: o3, scaleY: s2 } = e, { startX: l4, startY: a4, endX: c2, endY: d2 } = t3, u2 = this._univerInstanceService.getUnit(Fl, we.UNIVER_DOC);
    if (u2 == null)
      return;
    const h9 = this._getEditorSkeleton();
    if (!h9) return;
    const m9 = this._predictingSize(
      t3,
      i,
      h9,
      r,
      o3,
      s2
    );
    if (!m9 || m9.actualWidth <= 0) return;
    let { actualWidth: g9, actualHeight: f4 } = m9;
    const { verticalAlign: p3, horizontalAlign: v6, paddingData: S, fill: w6 } = r;
    g9 = g9 + ((E3 = S.l) != null ? E3 : 0) + ((M10 = S.r) != null ? M10 : 0), f4 = f4 + ((T10 = S.t) != null ? T10 : 0) + ((P8 = S.b) != null ? P8 : 0);
    let C = c2 - l4, I6 = d2 - a4;
    C < g9 && (C = Math.ceil(g9)), I6 < f4 && (I6 = Math.ceil(f4));
    let R9 = 0;
    p3 === Dn.MIDDLE ? R9 = (I6 - f4) / 2 / s2 : p3 === Dn.TOP ? R9 = S.t || 0 : R9 = (I6 - f4) / s2;
    let y6 = 0;
    v6 === Pt.CENTER || (v6 === Pt.RIGHT ? y6 = (C - g9) / o3 : y6 = S.l || 0), R9 = R9 < (S.t || 0) ? S.t || 0 : R9, y6 = y6 < (S.l || 0) ? S.l || 0 : y6, u2.updateDocumentDataMargin({
      t: R9,
      l: y6
    }), h9.calculate(), this._editAreaProcessing(
      C,
      I6,
      t3,
      i,
      w6,
      o3,
      s2,
      v6,
      n3
    );
  }
  /**
   * Mainly used to pre-calculate the width of the editor,
   * to determine whether it needs to be automatically widened.
   */
  _predictingSize(n3, e, t3, r, i = 1, o3 = 1) {
    const { startX: s2, endX: l4 } = n3, { textRotation: a4, wrapStrategy: c2, paddingData: d2 } = r, u2 = this._univerInstanceService.getUnit(Fl, we.UNIVER_DOC), { vertexAngle: h9 } = A3(a4);
    if (c2 === jn.WRAP && h9 === 0) {
      u2 == null || u2.updateDocumentDataPageSize(l4 - s2), u2 == null || u2.updateDocumentDataMargin({ l: d2.l, t: d2.t }), t3.calculate();
      const { actualWidth: p3, actualHeight: v6 } = t3.getActualSize();
      return {
        actualWidth: p3 * i,
        actualHeight: v6 * o3
      };
    }
    const m9 = this._getEditorMaxSize(n3, e, r.horizontalAlign);
    if (!m9) return;
    u2 == null || u2.updateDocumentDataPageSize(m9.width / i), t3.calculate();
    const g9 = t3.getActualSize();
    let f4 = l4 - s2;
    return f4 < g9.actualWidth * i + yh3 * i && (f4 = g9.actualWidth * i + yh3 * i), u2 == null || u2.updateDocumentDataPageSize(f4 / i), u2 == null || u2.updateDocumentRenderConfig({
      horizontalAlign: Pt.UNSPECIFIED,
      cellValueType: void 0
    }), {
      actualWidth: g9.actualWidth * i,
      actualHeight: g9.actualHeight * o3
    };
  }
  _getEditorMaxSize(n3, e, t3) {
    var S, w6, C, I6;
    if (this._getEditorObject() == null)
      return;
    function i(R9) {
      return Number.parseInt(R9.replace("px", ""));
    }
    const o3 = this.engine;
    if (!o3) return;
    const s2 = o3.getCanvasElement(), l4 = s2.getBoundingClientRect(), a4 = i(s2.style.width), { width: c2 } = l4, d2 = c2 / a4, { startX: u2, startY: h9, endX: m9 } = n3, g9 = o3.width, f4 = ((w6 = (S = this._configService.getConfig(ae)) == null ? void 0 : S.footer) == null || w6) && ((I6 = (C = this._configService.getConfig(Tt2)) == null ? void 0 : C.footer) == null || I6) ? mf2 : 0, p3 = document.body.clientHeight - h9 - f4 - e.top - Mh * 2;
    let v6 = c2 - u2;
    if (t3 === Pt.CENTER) {
      const R9 = g9 - m9, y6 = u2;
      v6 = m9 - u2 + Math.min(y6, R9) * 2;
    } else t3 === Pt.RIGHT && (v6 = m9);
    return {
      height: p3,
      width: v6 - Mh,
      scaleAdjust: d2
    };
  }
  /**
   * Mainly used to calculate the volume of scenes and objects,
   * determine whether a scrollbar appears,
   * and calculate the editor's boundaries relative to the browser.
   */
  // eslint-disable-next-line max-lines-per-function
  _editAreaProcessing(n3, e, t3, r, i, o3 = 1, s2 = 1, l4, a4) {
    var x7;
    const c2 = this._getEditorObject();
    if (c2 == null)
      return;
    const d2 = this.engine;
    if (!d2) return;
    const u2 = d2.getCanvasElement();
    let { startX: h9, startY: m9 } = t3;
    const { document: g9, scene: f4, engine: p3 } = c2, v6 = f4.getViewport(We2.VIEW_MAIN), S = this._getEditorMaxSize(t3, r, l4), { height: w6, width: C, scaleAdjust: I6 } = S;
    let R9 = e, y6 = v6 == null ? void 0 : v6.getScrollBar();
    R9 > w6 ? (y6 == null ? v6 && new D8(v6, { enableHorizontal: false, barSize: 8 }) : v6 == null || v6.resetCanvasSizeAndUpdateScroll(), v6 == null || v6.scrollToViewportPos({
      viewportScrollY: R9 - w6
    }), R9 = w6) : (y6 = null, (x7 = v6 == null ? void 0 : v6.getScrollBar()) == null || x7.dispose()), n3 += (y6 == null ? void 0 : y6.barSize) || 0, n3 > C && (n3 = C), this._addBackground(f4, n3 / o3, e / s2, i);
    const { scaleX: E3, scaleY: M10 } = f4.getPrecisionScale();
    f4.transformByState({
      width: n3 * I6 / o3,
      height: e * I6 / s2,
      scaleX: o3 * I6,
      scaleY: s2 * I6
    }), g9.resize(n3 * I6 / o3, e * I6 / s2), setTimeout(() => {
      p3.resizeBySize(
        Z2(n3, E3),
        Z2(R9, M10)
      ), a4 == null || a4();
    }, 0);
    const T10 = this._layoutService.getContentElement().getBoundingClientRect(), P8 = u2.getBoundingClientRect();
    h9 = h9 * I6 + (P8.left - T10.left), m9 = m9 * I6 + (P8.top - T10.top);
    const A4 = t3.endX - t3.startX;
    l4 === Pt.RIGHT ? h9 += (A4 - n3) * I6 : l4 === Pt.CENTER && (h9 += (A4 - n3 * I6) / 2), this._cellEditorManagerService.setState({
      startX: h9,
      startY: m9,
      endX: n3 * I6 + h9,
      endY: R9 * I6 + m9,
      show: true
    });
  }
  /**
   * Since the document does not support cell background color, an additional rect needs to be added.
   */
  _addBackground(n3, e, t3, r) {
    const i = "_backgroundRectHelperColor_", o3 = n3.getObject(i);
    o3 == null && r == null || (o3 == null ? n3.addObjects(
      [
        new I1(i, {
          width: e,
          height: t3,
          fill: r,
          evented: false
        })
      ],
      zo
    ) : r == null ? o3.dispose() : (o3.setProps({
      fill: r
    }), o3.transformByState({
      width: e,
      height: t3
    })));
  }
  resizeCellEditor(n3) {
    var I6, R9;
    const e = this._cellEditorManagerService.getState();
    if (!e || !this._editorBridgeService.isVisible().visible) return;
    this._editorBridgeService.refreshEditCellPosition(true);
    const t3 = this._editorBridgeService.getEditCellState();
    if (!t3) return;
    const r = (R9 = (I6 = this._sheetSkeletonManagerService) == null ? void 0 : I6.getSkeletonParam(t3.sheetId)) == null ? void 0 : R9.skeleton;
    if (!r) return;
    const { row: i, column: o3, scaleX: s2, scaleY: l4, position: a4, canvasOffset: c2, documentLayoutObject: d2 } = t3, { horizontalAlign: u2 } = d2, h9 = this._getEditorMaxSize(a4, c2, u2);
    if (!h9) return;
    const { height: m9, width: g9, scaleAdjust: f4 } = h9, p3 = r.getCellWithCoordByIndex(i, o3), v6 = Math.min((p3.mergeInfo.endY - p3.mergeInfo.startY) * l4, m9) * f4, S = Math.min((p3.mergeInfo.endX - p3.mergeInfo.startX) * s2, g9) * f4, w6 = e.endY - e.startY, C = e.endX - e.startX;
    if (w6 !== v6 || C !== S) {
      if (this._editorBridgeService.refreshEditCellPosition(true), !this._getEditorSkeleton())
        return;
      this.fitTextSize(n3);
    }
  }
  _getEditorObject() {
    return Xd2(this._editorBridgeService.getCurrentEditorId(), this._renderManagerService);
  }
  _getEditorSkeleton() {
    var n3;
    return (n3 = this._renderManagerService.getRenderById(Fl)) == null ? void 0 : n3.with(D).getSkeleton();
  }
};
ko4 = B0([
  Yr3(0, j1),
  Yr3(1, ds2),
  Yr3(2, Qe3),
  Yr3(3, JE),
  Yr3(4, br),
  Yr3(5, xs)
], ko4);
var F0 = Object.getOwnPropertyDescriptor;
var U0 = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? F0(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var ar5 = (n3, e) => (t3, r) => e(t3, r, n3);
var Do3 = class extends ER {
  constructor(e, t3, r, i, o3, s2, l4, a4) {
    super();
    _2(this, "_d");
    this._context = e, this._instanceSrv = t3, this._commandService = r, this._editorBridgeService = i, this._selectionManagerService = o3, this._contextService = s2, this._renderManagerService = l4, this._sheetSkeletonManagerService = a4, this.disposeWithMe(this._instanceSrv.getCurrentTypeOfUnit$(we.UNIVER_SHEET).subscribe((c2) => {
      c2 && c2.getUnitId() === this._context.unitId ? this._d = this._init() : this._disposeCurrent();
    }));
  }
  _init() {
    const e = new ho();
    return this._initSelectionChangeListener(e), this._initEventListener(e), this._commandExecutedListener(e), this._initialKeyboardListener(e), e;
  }
  _disposeCurrent() {
    var e;
    (e = this._d) == null || e.dispose(), this._d = null;
  }
  _initSelectionChangeListener(e) {
    e.add(merge(
      this._selectionManagerService.selectionMoveEnd$,
      this._selectionManagerService.selectionSet$,
      this._selectionManagerService.selectionMoveStart$
    ).subscribe((t3) => this._updateEditorPosition(t3)));
  }
  _updateEditorPosition(e) {
    var r, i, o3;
    if (this._editorBridgeService.isVisible().visible) return;
    const t3 = (r = e == null ? void 0 : e[e.length - 1]) == null ? void 0 : r.primary;
    if (t3) {
      const s2 = this._getSheetObject(), { scene: l4, engine: a4 } = s2, c2 = this._context.unitId, d2 = (i = this._context.unit.getActiveSheet()) == null ? void 0 : i.getSheetId();
      if (!d2) return;
      const u2 = (o3 = this._sheetSkeletonManagerService.getSkeletonParam(d2)) == null ? void 0 : o3.skeleton.getCellWithCoordByIndex(t3.actualRow, t3.actualColumn), h9 = u2 ? {
        actualRow: u2.actualRow,
        actualColumn: u2.actualColumn,
        isMerged: u2.isMerged,
        startRow: u2.mergeInfo.startRow,
        startColumn: u2.mergeInfo.startColumn,
        endRow: u2.mergeInfo.endRow,
        endColumn: u2.mergeInfo.endColumn,
        isMergedMainCell: u2.isMergedMainCell
      } : t3;
      this._commandService.executeCommand(su2.id, {
        scene: l4,
        engine: a4,
        primary: h9,
        unitId: c2,
        sheetId: d2
      });
    }
  }
  refreshEditorPosition() {
    const e = this._selectionManagerService.getWorkbookSelections(this._context.unitId);
    if (e) {
      const t3 = e.getCurrentSelections();
      t3 && this._updateEditorPosition([...t3]);
    }
  }
  _initEventListener(e) {
    const t3 = this._getSheetObject(), { spreadsheet: r, spreadsheetColumnHeader: i, spreadsheetLeftTopPlaceholder: o3, spreadsheetRowHeader: s2 } = t3;
    e.add(r.onDblclick$.subscribeEvent((l4) => {
      l4.button !== 2 && this._commandService.executeCommand(tt5.id, {
        visible: true,
        eventType: hb.Dblclick,
        unitId: this._context.unitId
      });
    })), e.add(r.onPointerDown$.subscribeEvent({
      next: this._tryHideEditor.bind(this),
      priority: -1
    })), e.add(i.onPointerDown$.subscribeEvent({
      next: this._tryHideEditor.bind(this),
      priority: -1
    })), e.add(o3.onPointerDown$.subscribeEvent({
      next: this._tryHideEditor.bind(this),
      priority: -1
    })), e.add(s2.onPointerDown$.subscribeEvent({
      next: this._tryHideEditor.bind(this),
      priority: -1
    }));
  }
  /**
   * Should activate the editor when the user inputs text.
   * @param d DisposableCollection
   */
  _initialKeyboardListener(e) {
    let t3 = null;
    const r = (o3) => {
      const s2 = o3.with(Re);
      s2 && (t3 = Be(s2.onInputBefore$.subscribe((l4) => {
        if (!this._isCurrentSheetFocused())
          return;
        const a4 = this._contextService.getContextValue(EE), c2 = this._contextService.getContextValue(_r), d2 = o3.unitId;
        this._editorBridgeService.isVisible().visible || d2 && c2 && !a4 && this._showEditorByKeyboard(l4);
      })), e.add(t3));
    }, i = this._renderManagerService.getRenderById(Fl);
    i ? r(i) : this.disposeWithMe(this._renderManagerService.created$.pipe(filter((o3) => o3.unitId === Fl)).subscribe((o3) => {
      t3 == null || t3.dispose(), r(o3);
    }));
  }
  _commandExecutedListener(e) {
    const t3 = /* @__PURE__ */ new Set([Hs2.id, cs3.id]);
    e.add(this._commandService.onCommandExecuted((r) => {
      if (t3.has(r.id)) {
        if (this._editorBridgeService.isVisible().visible) return;
        this._editorBridgeService.refreshEditCellState();
      }
      if (r.id === ee2.id) {
        const i = r.params, { cellValue: o3, unitId: s2, subUnitId: l4 } = i;
        if (!o3) return;
        const a4 = this._editorBridgeService.getEditLocation();
        if (a4) {
          const { unitId: c2, sheetId: d2, row: u2, column: h9 } = a4;
          s2 === c2 && l4 === d2 && o3 && o3[u2] && Object.prototype.hasOwnProperty.call(o3[u2], h9) && this._editorBridgeService.refreshEditCellState();
        }
      }
    })), e.add(this._commandService.beforeCommandExecuted((r, i) => {
      i != null && i.fromCollab || r.id === pn.id && this._tryHideEditor();
    }));
  }
  _showEditorByKeyboard(e) {
    const t3 = e == null ? void 0 : e.event;
    e == null || !t3.data && t3.inputType !== "InsertParagraph" || this._commandService.syncExecuteCommand(tt5.id, {
      visible: true,
      eventType: hb.Keyboard,
      keycode: t3.which,
      unitId: this._context.unitId
    });
  }
  _tryHideEditor() {
    this._editorBridgeService.isForceKeepVisible() || this._hideEditor();
  }
  _hideEditor() {
    this._editorBridgeService.isVisible().visible === true && this._commandService.syncExecuteCommand(tt5.id, {
      visible: false,
      eventType: hb.PointerDown,
      unitId: this._context.unitId
    });
  }
  _getSheetObject() {
    return $t4(this._context.unit, this._context);
  }
  _isCurrentSheetFocused() {
    var e;
    return ((e = this._instanceSrv.getFocusedUnit()) == null ? void 0 : e.getUnitId()) === this._context.unitId;
  }
};
Do3 = U0([
  ar5(1, br),
  ar5(2, Ds),
  ar5(3, Qe3),
  ar5(4, Inject(z)),
  ar5(5, Tr),
  ar5(6, JE),
  ar5(7, Inject(he2))
], Do3);
var vf = [
  q1.ARROW_DOWN,
  q1.ARROW_UP,
  q1.ARROW_LEFT,
  q1.ARROW_RIGHT
];
var X0 = [q1.ENTER, q1.TAB, ...vf];
function Sf() {
  const n3 = [];
  for (const e of vf)
    n3.push({
      id: Ii2.id,
      binding: e,
      preconditions: (t3) => Si3(t3),
      staticParameters: {
        visible: false,
        eventType: hb.Keyboard,
        keycode: e,
        isShift: false
      }
    }), n3.push({
      id: Ii2.id,
      binding: e | y12.SHIFT,
      preconditions: (t3) => Si3(t3),
      staticParameters: {
        visible: false,
        eventType: hb.Keyboard,
        keycode: e,
        isShift: true
      }
    });
  return n3;
}
var Cf = {
  id: xa3.id,
  binding: q1.F2,
  description: "shortcut.sheet.start-editing",
  group: "4_sheet-edit",
  preconditions: Ne2,
  staticParameters: {
    visible: true,
    eventType: hb.Keyboard,
    keycode: q1.F2
  }
};
var wf = {
  id: tt5.id,
  binding: q1.ENTER,
  description: "shortcut.sheet.toggle-editing",
  group: "4_sheet-edit",
  preconditions: (n3) => Si3(n3),
  staticParameters: {
    visible: false,
    eventType: hb.Keyboard,
    keycode: q1.ENTER
  }
};
var bf = {
  id: tt5.id,
  binding: q1.TAB,
  preconditions: (n3) => Si3(n3),
  staticParameters: {
    visible: false,
    eventType: hb.Keyboard,
    keycode: q1.TAB
  }
};
var _f = {
  id: tt5.id,
  binding: q1.ESC,
  description: "shortcut.sheet.abort-editing",
  group: "4_sheet-edit",
  preconditions: (n3) => Si3(n3),
  staticParameters: {
    visible: false,
    eventType: hb.Keyboard,
    keycode: q1.ESC
  }
};
var Rf = {
  id: tt5.id,
  binding: q1.ENTER | y12.CTRL_COMMAND,
  mac: q1.ENTER | y12.MAC_CTRL,
  preconditions: (n3) => Si3(n3),
  staticParameters: {
    visible: false,
    eventType: hb.Keyboard,
    keycode: q1.ENTER | y12.CTRL_COMMAND
  }
};
var If = {
  id: Gr.id,
  description: "shortcut.sheet.break-line",
  group: "4_sheet-edit",
  preconditions: (n3) => w12(n3),
  binding: q1.ENTER | y12.ALT
};
var yf2 = {
  id: Do.id,
  preconditions: (n3) => Gd2(n3) || ua2(n3),
  binding: q1.BACKSPACE
};
var Mf = {
  id: ba.id,
  preconditions: (n3) => Gd2(n3) || ua2(n3),
  binding: q1.DELETE
};
var Ef = {
  id: Do.id,
  preconditions: (n3) => Gd2(n3) || ua2(n3),
  binding: q1.BACKSPACE | y12.SHIFT
};
var Tf2 = {
  id: tt5.id,
  description: "shortcut.sheet.delete-and-start-editing",
  group: "4_sheet-edit",
  preconditions: (n3) => Ne2(n3) && !ua2(n3),
  binding: q1.BACKSPACE,
  staticParameters: {
    visible: true,
    eventType: hb.Keyboard,
    keycode: q1.BACKSPACE
  }
};
function z02(n3) {
  return n3.startsWith("'");
}
function j0(n3) {
  return n3.slice(1);
}
var Y0 = {
  "ï¼": "0",
  "ï¼‘": "1",
  "ï¼’": "2",
  "ï¼“": "3",
  "ï¼”": "4",
  "ï¼•": "5",
  "ï¼–": "6",
  "ï¼—": "7",
  "ï¼˜": "8",
  "ï¼™": "9",
  ï¼¡: "A",
  ï¼¢: "B",
  ï¼£: "C",
  ï¼¤: "D",
  ï¼¥: "E",
  ï¼¦: "F",
  ï¼§: "G",
  ï¼¨: "H",
  ï¼©: "I",
  ï¼ª: "J",
  ï¼«: "K",
  ï¼¬: "L",
  ï¼­: "M",
  ï¼®: "N",
  ï¼¯: "O",
  ï¼°: "P",
  ï¼±: "Q",
  ï¼²: "R",
  ï¼³: "S",
  ï¼´: "T",
  ï¼µ: "U",
  ï¼¶: "V",
  ï¼·: "W",
  ï¼¸: "X",
  ï¼¹: "Y",
  ï¼º: "Z",
  ï½: "a",
  ï½‚: "b",
  ï½ƒ: "c",
  ï½„: "d",
  ï½…: "e",
  ï½†: "f",
  ï½‡: "g",
  ï½ˆ: "h",
  ï½‰: "i",
  ï½Š: "j",
  ï½‹: "k",
  ï½Œ: "l",
  ï½: "m",
  ï½Ž: "n",
  ï½: "o",
  ï½: "p",
  ï½‘: "q",
  ï½’: "r",
  ï½“: "s",
  ï½”: "t",
  ï½•: "u",
  ï½–: "v",
  ï½—: "w",
  ï½˜: "x",
  ï½™: "y",
  ï½š: "z",
  "ï¼…": "%",
  "ï¼": "-",
  "ï¼Ž": ".",
  "ï¼š": ":",
  "ï¼": "/",
  "ï¼‹": "+",
  "ï¼ ": "@",
  "ï¼†": "&",
  "ï¼Š": "*",
  "ï¼ƒ": "#",
  "ï¼": "=",
  "ï¼ž": ">",
  "ï¼œ": "<",
  "ï¼„": "$",
  "ï¼‚": '"',
  "ï¼‡": "'",
  "ï¼ˆ": "(",
  "ï¼‰": ")",
  "ã€€": " ",
  "ï¼Œ": ",",
  "ï¼": "!",
  "ï¼Ÿ": "?",
  "ï¼›": ";",
  "ï¼»": "[",
  "ï¼½": "]",
  "ï½›": "{",
  "ï½": "}"
};
var Kc4 = {
  true: "TRUE",
  false: "FALSE"
};
function Z0(n3) {
  return [Ts.ZH_CN, Ts.ZH_TW].includes(n3);
}
function G0(n3, e, t3, r) {
  let i = n3;
  if (Z0(t3)) {
    if (n3.startsWith("ï¼‡") || n3.startsWith("'"))
      return `'${n3.slice(1)}`;
    i = q0(i);
  }
  if (i.startsWith("="))
    return Q02(n3, i, e, r);
  const o3 = i.toLowerCase();
  return Kc4[o3] ? Kc4[o3] : a1.parseValue(i) == null ? n3 : i;
}
function q0(n3) {
  const e = /['"].*?['"]/g, t3 = [], r = n3.split(e);
  n3.replace(e, (o3) => (t3.push(o3), ""));
  let i = r.join("").split("").map($02).join("");
  return t3.forEach((o3, s2) => {
    i = i.slice(0, s2 * 2) + o3 + i.slice((s2 + 1) * 2);
  }), i;
}
function Q02(n3, e, t3, r) {
  const i = t3.sequenceNodesBuilder(e);
  if (!i) return n3;
  let o3 = e, s2 = 0;
  return i.forEach((l4, a4) => {
    if (typeof l4 == "object") {
      const c2 = l4.token;
      if (Kc4[c2.toLowerCase()]) {
        const d2 = l4.startIndex + s2 + 1, u2 = l4.endIndex + s2 + 2;
        o3 = Zr4(c2.toLocaleUpperCase(), o3, d2, u2);
      } else if (l4.nodeType === He.FUNCTION && K0(c2, r, i, a4) || l4.nodeType === He.REFERENCE) {
        const d2 = c2.indexOf("!");
        if (d2 > -1) {
          const u2 = c2.substring(d2 + 1), h9 = l4.startIndex + s2 + (d2 + 1) + 1, m9 = l4.endIndex + s2 + 2;
          o3 = Zr4(u2.toLocaleUpperCase(), o3, h9, m9);
        } else {
          const u2 = l4.startIndex + s2 + 1, h9 = l4.endIndex + s2 + 2;
          o3 = Zr4(c2.toLocaleUpperCase(), o3, u2, h9);
        }
      } else if (c2.startsWith('"') && c2.endsWith('"') || c2.startsWith("'") && c2.endsWith("'")) {
        const d2 = l4.startIndex + s2 + 2, u2 = l4.endIndex + s2 + 1;
        o3 = Zr4(n3.slice(d2, u2), o3, d2, u2);
      } else if (l4.nodeType !== He.ARRAY) {
        const d2 = a1.parseValue(c2);
        if (d2 == null) {
          const u2 = l4.startIndex + s2 + 1, h9 = l4.endIndex + s2 + 2;
          o3 = Zr4(n3.slice(u2, h9), o3, u2, h9);
        } else if (typeof d2.v == "number" && (d2.z === void 0 || !a1.getFormatInfo(d2.z).isDate)) {
          const u2 = `${d2.v}`, h9 = l4.startIndex + s2 + 1, m9 = l4.endIndex + s2 + 2, { processedString: g9, offset: f4 } = eb(c2, u2);
          o3 = Zr4(g9, o3, h9, m9), s2 += f4;
        }
      }
    }
  }), o3;
}
function K0(n3, e, t3, r) {
  const i = e.getDescriptions();
  return t3[r + 1] !== X4.OPEN_BRACKET ? false : i.get(J0(n3).toLocaleUpperCase()) !== void 0;
}
function J0(n3) {
  const e = /^@+/;
  return n3.replace(e, "");
}
function $02(n3) {
  return Y0[n3] || n3;
}
function Zr4(n3, e, t3, r) {
  return e.substring(0, t3) + n3 + e.substring(r);
}
function eb(n3, e) {
  var s2, l4;
  const t3 = ((s2 = n3.match(/^\s*/)) == null ? void 0 : s2[0]) || "", r = ((l4 = n3.match(/\s*$/)) == null ? void 0 : l4[0]) || "", i = t3 + e + r, o3 = i.length - n3.length;
  return { processedString: i, offset: o3 };
}
var tb2 = "range_selector";
var nb = (n3) => n3.includes(tb2);
var rb2 = Object.getOwnPropertyDescriptor;
var ib = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? rb2(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var Mt4 = (n3, e) => (t3, r) => e(t3, r, n3);
var Eh3 = -1e3;
var Ei2 = class extends Ve {
  constructor(e, t3, r, i, o3, s2, l4, a4, c2, d2, u2, h9, m9, g9, f4) {
    super();
    _2(this, "_cursorChange", 0);
    _2(this, "_editingUnit", "");
    _2(this, "_cursorTimeout");
    this._undoRedoService = e, this._contextService = t3, this._renderManagerService = r, this._editorBridgeService = i, this._cellEditorManagerService = o3, this._lexerTreeBuilder = s2, this._functionService = l4, this._textSelectionManagerService = a4, this._commandService = c2, this._localService = d2, this._editorService = u2, this._univerInstanceService = h9, this._sheetInterceptorService = m9, this._sheetCellEditorResizeService = g9, this._selectionManagerService = f4, this.disposeWithMe(this._init()), this._initEditorVisibilityListener();
  }
  dispose() {
    super.dispose();
  }
  get _workbookSelections() {
    return this._selectionManagerService.getWorkbookSelections(this._editingUnit);
  }
  _init() {
    const e = new ho();
    return this._subscribeToCurrentCell(e), this._initialCursorSync(e), this._listenEditorFocus(e), this._commandExecutedListener(e), this._initSkeletonListener(e), e.add(() => {
      clearTimeout(this._cursorTimeout);
    }), this._cursorTimeout = setTimeout(() => {
      this._cursorStateListener(e);
    }, 1e3), e;
  }
  _initEditorVisibilityListener() {
    this.disposeWithMe(this._univerInstanceService.getCurrentTypeOfUnit$(we.UNIVER_SHEET).subscribe((e) => __async(this, null, function* () {
      var t3;
      if (this._editingUnit && (e == null ? void 0 : e.getUnitId()) !== this._editingUnit && !this._editorBridgeService.isForceKeepVisible()) {
        this._commandService.syncExecuteCommand(tt5.id, {
          visible: false,
          eventType: hb.Keyboard,
          keycode: q1.ESC,
          unitId: this._editingUnit
        });
        const r = (t3 = this._renderManagerService.getRenderById(e.getUnitId())) == null ? void 0 : t3.with(Do3);
        r && r.refreshEditorPosition();
      }
    }))), this.disposeWithMe(
      this._editorBridgeService.visible$.pipe(distinctUntilChanged((e, t3) => e.visible === t3.visible)).subscribe((e) => __async(this, null, function* () {
        e.visible ? (this._editingUnit = e.unitId, this._handleEditorVisible(e)) : this._editingUnit && (yield this._handleEditorInvisible(e), this._editingUnit = "");
      }))
    );
  }
  _listenEditorFocus(e) {
    const t3 = this._getEditorObject();
    t3 && e.add(t3.document.onPointerDown$.subscribeEvent(() => {
      var r;
      if (this._editingUnit && this._editorBridgeService.isVisible()) {
        const i = this._editorBridgeService.getEditCellState(), o3 = this._editorBridgeService.getCurrentEditorId();
        if (!i || !o3)
          return;
        (r = this._sheetCellEditorResizeService) == null || r.fitTextSize();
      }
    }));
  }
  _initialCursorSync(e) {
    e.add(this._cellEditorManagerService.focus$.pipe(filter((t3) => !!t3)).subscribe(() => {
      var i;
      const t3 = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_DOC);
      if (!t3) return;
      const r = (i = this._renderManagerService.getRenderById(t3 == null ? void 0 : t3.getUnitId())) == null ? void 0 : i.with(Re);
      r && r.sync();
    }));
  }
  _initSkeletonListener(e) {
    const t3 = new Set(bh2);
    t3.delete(pn.id), e.add(this._commandService.onCommandExecuted((r) => {
      var i;
      if (t3.has(r.id)) {
        switch (r.id) {
          case Je3.id:
          case qe2.id:
          case Me.id:
          case Te.id:
          case Ue2.id:
          case ke2.id: {
            const o3 = this._editorBridgeService.getEditLocation();
            if (!o3) break;
            const s2 = {
              startRow: o3.row,
              startColumn: o3.column,
              endRow: o3.row,
              endColumn: o3.column
            }, l4 = Hl2(s2, r);
            if (!l4) break;
            const a4 = l4.startRow, c2 = l4.startColumn;
            this._editorBridgeService.updateEditLocation(a4, c2);
            break;
          }
        }
        (i = this._sheetCellEditorResizeService) == null || i.resizeCellEditor(() => {
          this._textSelectionManagerService.refreshSelection({
            unitId: Fl,
            subUnitId: Fl
          });
        });
      }
    }));
  }
  /**
   * Should update current editing cell info when selection is changed.
   * @param d DisposableCollection
   */
  _subscribeToCurrentCell(e) {
    e.add(this._editorBridgeService.currentEditCellState$.subscribe((t3) => {
      var v6, S;
      if (t3 == null || this._editorBridgeService.isForceKeepVisible())
        return;
      const r = this._editorBridgeService.getEditCellState();
      if (r == null)
        return;
      const { position: i, documentLayoutObject: o3, scaleX: s2, editorUnitId: l4 } = r;
      if (this._contextService.getContextValue(B1))
        return;
      const a4 = this._getDocumentDataModel();
      if (a4 == null) return;
      const { startX: c2, endX: d2 } = i, { textRotation: u2, wrapStrategy: h9, documentModel: m9 } = o3, { vertexAngle: g9 } = A3(u2);
      h9 === jn.WRAP && g9 === 0 && a4.updateDocumentDataPageSize((d2 - c2) / s2), this._commandService.syncExecuteCommand(_a.id, {
        unitId: l4,
        snapshot: m9.getSnapshot()
      }), this._contextService.setContextValue(F1, true), this._textSelectionManagerService.replaceDocRanges(
        [{
          startOffset: 0,
          endOffset: 0
        }],
        {
          unitId: Fl,
          subUnitId: Fl
        }
      );
      const f4 = (v6 = this._renderManagerService.getRenderById(Fl)) == null ? void 0 : v6.with(Re), p3 = (S = this._renderManagerService.getRenderById(Hl)) == null ? void 0 : S.with(Re);
      (f4 != null && f4.canFocusing || p3 != null && p3.canFocusing) && (this._univerInstanceService.setCurrentUnitForType(Fl), f4 == null || f4.activate(
        Eh3,
        Eh3,
        true
      ));
    }));
  }
  /**
   * Listen to document edits to refresh the size of the sheet editor, not for normal editor.
   */
  _commandExecutedListener(e) {
    e.add(this._commandService.onCommandExecuted((r) => {
      var i;
      if (r.id === M.id) {
        const o3 = r.params, { unitId: s2 } = o3;
        if (nb(s2) || (this._editorBridgeService.changeEditorDirty(true), !this._editorBridgeService.isVisible().visible))
          return;
        s2 === Fl && ((i = this._sheetCellEditorResizeService) == null || i.fitTextSize());
      }
    }));
    const t3 = [Ii2.id];
    e.add(this._commandService.onCommandExecuted((r) => {
      if (t3.includes(r.id)) {
        const i = r.params, { keycode: o3, isShift: s2 } = i;
        if (o3 != null && (this._cursorChange === 2 || this._contextService.getContextValue(EE))) {
          this._moveInEditor(o3, s2);
          return;
        }
        this._commandService.syncExecuteCommand(tt5.id, i);
      }
      r.id === xa3.id && (this._cursorChange = 2);
    }));
  }
  // You can double-click on the cell or input content by keyboard to put the cell into the edit state.
  // eslint-disable-next-line complexity
  _handleEditorVisible(e) {
    var m9, g9, f4, p3;
    const { eventType: t3, keycode: r } = e;
    this._cursorChange = t3 === hb.PointerDown || t3 === hb.Dblclick ? 2 : 1;
    const i = this._editorBridgeService.getEditLocation();
    if (i == null)
      return;
    this._commandService.syncExecuteCommand(lu2.id, {
      range: {
        startRow: i.row,
        startColumn: i.column,
        endRow: i.row,
        endColumn: i.column
      }
    }), this._editorBridgeService.refreshEditCellPosition(false);
    const { unitId: o3, isInArrayFormulaRange: s2 = false } = i, l4 = this._getEditorObject();
    if (l4 == null)
      return;
    const { document: a4, scene: c2 } = l4;
    this._contextService.setContextValue(pE, true);
    const d2 = this._getDocumentDataModel(), u2 = this._getEditorSkeleton(Fl);
    if (!u2 || !d2)
      return;
    (m9 = this._sheetCellEditorResizeService) == null || m9.fitTextSize(() => {
      const v6 = c2.getViewport(We2.VIEW_MAIN);
      v6 == null || v6.scrollToViewportPos({
        viewportScrollX: Number.POSITIVE_INFINITY,
        viewportScrollY: Number.POSITIVE_INFINITY
      });
    });
    const h9 = () => {
      this._emptyDocumentDataModel(d2.getSnapshot().documentStyle, !!s2), a4.makeDirty(), (r === q1.BACKSPACE || t3 === hb.Dblclick) && (u2.calculate(), this._editorBridgeService.changeEditorDirty(true)), this._textSelectionManagerService.replaceDocRanges(
        [{
          startOffset: 0,
          endOffset: 0
        }],
        {
          unitId: Fl,
          subUnitId: Fl
        }
      );
    };
    if (this._isCellImageData(d2.getSnapshot()))
      h9();
    else if (t3 === hb.Keyboard && r === q1.F2) {
      a4.makeDirty(), this._textSelectionManagerService.replaceDocRanges([
        {
          startOffset: 0,
          endOffset: 0
        }
      ]);
      const v6 = ((f4 = (g9 = d2.getBody()) == null ? void 0 : g9.dataStream.length) != null ? f4 : 2) - 2;
      this._textSelectionManagerService.replaceDocRanges(
        [{
          startOffset: v6,
          endOffset: v6
        }],
        {
          unitId: Fl,
          subUnitId: Fl
        }
      );
    } else if (
      // clear and edit
      t3 === hb.Keyboard || t3 === hb.Dblclick && s2
    )
      h9();
    else if (t3 === hb.Dblclick) {
      if (this._contextService.getContextValue(H1))
        return;
      const v6 = d2.getBody().dataStream.length - 2 || 0;
      this._textSelectionManagerService.replaceDocRanges([
        {
          startOffset: v6,
          endOffset: v6
        }
      ]);
    }
    (p3 = this._renderManagerService.getRenderById(o3)) == null || p3.scene.resetCursor();
  }
  _refreshCurrentSelections(e) {
    const t3 = this._workbookSelections.getSelectionsOfWorksheet(e);
    t3 && (this._contextService.setContextValue(Fu, false), this._commandService.syncExecuteCommand(ie5.id, {
      unitId: this._editingUnit,
      subUnitId: e,
      selections: t3
    }));
  }
  _handleEditorInvisible(e) {
    return __async(this, null, function* () {
      var f4, p3;
      const t3 = this._editorBridgeService.getEditCellState(), r = this._univerInstanceService.getUnit(Fl), i = Z.deepClone(r == null ? void 0 : r.getSnapshot()), { keycode: o3 } = e;
      this._cursorChange = 0;
      const s2 = (f4 = t3 == null ? void 0 : t3.unitId) != null ? f4 : "";
      if (this._exitInput(e), t3 == null)
        return;
      const l4 = this._univerInstanceService.getUnit(s2, we.UNIVER_SHEET);
      if (!l4)
        return;
      const a4 = l4.getActiveSheet(), c2 = l4.getUnitId(), d2 = a4.getSheetId(), { unitId: u2, sheetId: h9 } = t3;
      if (c2 === u2 && h9 !== d2 && (yield this._commandService.executeCommand(ui.id, {
        subUnitId: h9,
        unitId: u2
      })), o3 === q1.ESC) {
        this._editorBridgeService.isForceKeepVisible() && this._editorBridgeService.disableForceKeepVisible(), this._refreshCurrentSelections(h9);
        return;
      }
      const m9 = ((p3 = i == null ? void 0 : i.body) == null ? void 0 : p3.dataStream.length) === 2, g9 = t3.documentLayoutObject.documentModel ? this._isCellImageData(t3.documentLayoutObject.documentModel.getSnapshot()) : false;
      i && !(m9 && g9) && (yield this._submitEdit(i, o3 === (y12.CTRL_COMMAND | q1.ENTER) || o3 === (y12.MAC_CTRL | q1.ENTER))) === false || o3 !== void 0 && this._moveSelection(o3, s2, d2);
    });
  }
  _getEditorObject() {
    return Xd2(this._editorBridgeService.getCurrentEditorId(), this._renderManagerService);
  }
  _isCellImageData(e) {
    var r, i;
    return ((i = (r = e.drawingsOrder) == null ? void 0 : r.length) != null ? i : 0) > 0;
  }
  submitCellData(e) {
    return this._submitEdit(e.getSnapshot());
  }
  _submitEdit(e, t3 = false) {
    return __async(this, null, function* () {
      var p3;
      const r = this._editorBridgeService.getEditCellState();
      if (r == null)
        return true;
      const { unitId: i, sheetId: o3, row: s2, column: l4 } = r, a4 = this._univerInstanceService.getUnit(i, we.UNIVER_SHEET);
      if (!a4)
        return true;
      let c2 = a4.getActiveSheet();
      if (!a4.getSheetBySheetId(o3))
        return true;
      c2 = a4.getActiveSheet();
      const u2 = ob2(
        __spreadValues({}, c2.getCellRaw(s2, l4) || {}),
        e,
        this._lexerTreeBuilder,
        this._localService,
        this._functionService,
        a4.getStyles()
      );
      if (!u2)
        return true;
      this._removeComposedCellStyleInCellData(u2, c2.getComposedCellStyle(s2, l4));
      const h9 = this._sheetInterceptorService.onWriteCell(a4, c2, s2, l4, u2);
      if (Z.diffValue(Ph2(h9), Ph2(c2.getCellRaw(s2, l4))))
        return true;
      const m9 = t3 ? (p3 = this._workbookSelections.getCurrentLastSelection()) == null ? void 0 : p3.range : {
        startRow: s2,
        startColumn: l4,
        endRow: s2,
        endColumn: l4
      }, g9 = et(6);
      return this._commandService.syncExecuteCommand(Sn2.id, {
        subUnitId: o3,
        unitId: i,
        range: m9,
        value: h9,
        redoUndoId: g9
      }) && (yield this._sheetInterceptorService.onValidateCell(a4, c2, s2, l4)) === false ? (this._undoRedoService.rollback(g9, i), false) : true;
    });
  }
  _removeComposedCellStyleInCellData(e, t3) {
    if (!e.s || typeof e.s == "string")
      return;
    const r = Object.keys(e.s);
    for (const i of r)
      t3[i] !== void 0 && Z.diffValue(e.s[i], t3[i]) && delete e.s[i];
  }
  _exitInput(e) {
    var i, o3;
    this._contextService.setContextValue(H1, false), this._contextService.setContextValue(pE, false), this._contextService.setContextValue(F1, false), this._contextService.setContextValue(EE, false), this._cellEditorManagerService.setState({
      show: e.visible
    });
    const t3 = this._getEditorObject();
    (i = t3 == null ? void 0 : t3.scene.getViewport(We2.VIEW_MAIN)) == null || i.scrollToViewportPos({
      viewportScrollX: 0,
      viewportScrollY: 0
    });
    const r = this._editorBridgeService.getCurrentEditorId();
    r == null || !this._editorService.isSheetEditor(r) || (r === Fl && ((o3 = this._getEditorSkeleton(Fl)) == null || o3.resetInitialWidth()), this._undoRedoService.clearUndoRedo(r), this._undoRedoService.clearUndoRedo(Hl));
  }
  _moveSelection(e, t3, r) {
    if (e == null || !X0.includes(e)) {
      this._refreshCurrentSelections(r);
      return;
    }
    let i = wm.LEFT;
    switch (e) {
      case q1.ENTER:
        i = wm.DOWN;
        break;
      case q1.TAB:
        i = wm.RIGHT;
        break;
      case q1.ARROW_DOWN:
        i = wm.DOWN;
        break;
      case q1.ARROW_UP:
        i = wm.UP;
        break;
      case q1.ARROW_LEFT:
        i = wm.LEFT;
        break;
      case q1.ARROW_RIGHT:
        i = wm.RIGHT;
        break;
    }
    const o3 = this._univerInstanceService.getCurrentUnitOfType(we.UNIVER_SHEET);
    t3 && (o3 == null ? void 0 : o3.getUnitId()) !== t3 && this._univerInstanceService.setCurrentUnitForType(t3), e === q1.ENTER || e === q1.TAB ? this._commandService.executeCommand(Dn3.id, {
      keycode: e,
      direction: i
    }) : this._commandService.executeCommand(Ut3.id, {
      direction: i
    });
  }
  /**
   * The user's operations follow the sequence of opening the editor and then moving the cursor.
   * The logic here predicts the user's first cursor movement behavior based on this rule
   */
  _cursorStateListener(e) {
    const t3 = this._getEditorObject();
    if (!(t3 != null && t3.document)) return;
    const { document: r } = t3;
    e.add(Be(r.onPointerDown$.subscribeEvent(() => {
      this._cursorChange === 1 && (this._cursorChange = 2);
    })));
  }
  // TODO: @JOCS, is it necessary to move these commands MoveSelectionOperation\MoveCursorOperation to shortcut? and use multi-commands?
  _moveInEditor(e, t3) {
    let r = wm.LEFT;
    e === q1.ARROW_DOWN ? r = wm.DOWN : e === q1.ARROW_UP ? r = wm.UP : e === q1.ARROW_RIGHT && (r = wm.RIGHT), t3 ? this._commandService.executeCommand(vt.id, {
      direction: r
    }) : this._commandService.executeCommand(St.id, {
      direction: r
    });
  }
  _getDocumentDataModel() {
    return this._univerInstanceService.getUnit(Fl, we.UNIVER_DOC);
  }
  _getEditorSkeleton(e) {
    var t3;
    return (t3 = this._renderManagerService.getRenderById(e)) == null ? void 0 : t3.with(D).getSkeleton();
  }
  _getEditorViewModel(e) {
    var t3;
    return (t3 = this._renderManagerService.getRenderById(e)) == null ? void 0 : t3.with(D).getViewModel();
  }
  _getEditingUnit() {
    return this._editingUnit ? this._univerInstanceService.getUnit(this._editingUnit, we.UNIVER_SHEET) : null;
  }
  _emptyDocumentDataModel(e, t3) {
    const r = (s2, l4) => {
      const a4 = Z.deepClone(s2.getSnapshot()), c2 = this._getEditorViewModel(s2.getUnitId());
      c2 != null && (sb2(a4.body, t3), l4 && (a4.documentStyle = e), a4.drawings = {}, a4.drawingsOrder = [], s2.reset(a4), c2.reset(s2));
    }, i = this._getDocumentDataModel();
    i && r(i, true);
    const o3 = this._univerInstanceService.getUnit(Hl, we.UNIVER_DOC);
    o3 && r(o3);
  }
};
Ei2 = ib([
  Mt4(0, ra),
  Mt4(1, Tr),
  Mt4(2, JE),
  Mt4(3, Qe3),
  Mt4(4, ds2),
  Mt4(5, Inject(Mn)),
  Mt4(6, Xt),
  Mt4(7, Inject(m)),
  Mt4(8, Ds),
  Mt4(9, Inject(Hn)),
  Mt4(10, Ge3),
  Mt4(11, br),
  Mt4(12, Inject(G)),
  Mt4(13, Inject(ko4)),
  Mt4(14, Inject(z))
], Ei2);
function ob2(n3, e, t3, r, i, o3) {
  var u2, h9, m9;
  if ((e == null ? void 0 : e.body) == null)
    return null;
  const { body: s2 } = e;
  n3.t = void 0;
  const l4 = s2.dataStream;
  let c2 = l4.substring(l4.length - 2, l4.length) === Yc ? l4.substring(0, l4.length - 2) : l4;
  const d2 = r.getCurrentLocale();
  if (c2 = G0(c2, t3, d2, i), (u2 = e.drawingsOrder) != null && u2.length)
    n3.v = "", n3.f = null, n3.si = null, n3.p = e, n3.t = mn.STRING;
  else if (n3.s && l1((m9 = (h9 = o3 == null ? void 0 : o3.get(n3.s)) == null ? void 0 : h9.n) == null ? void 0 : m9.pattern)) {
    n3.v = c2, n3.f = null, n3.si = null, n3.p = null, n3.t = mn.STRING, Jc3(s2) && s2.dataStream !== `\r
` && (n3.p = e);
    const g9 = Th2(e);
    g9 && (n3.s = g9);
  } else if (Jg(c2)) {
    if (n3.f === c2)
      return null;
    const g9 = t3.checkIfAddBracket(c2);
    for (let f4 = 0; f4 < g9; f4++)
      c2 += X4.CLOSE_BRACKET;
    n3.f = c2, n3.si = null, n3.v = null, n3.p = null;
  } else if (z02(c2)) {
    const g9 = j0(c2);
    n3.v = g9, n3.f = null, n3.si = null, n3.p = null, n3.t = mn.FORCE_STRING;
  } else if (Jc3(s2))
    s2.dataStream === `\r
` ? (n3.v = "", n3.f = null, n3.si = null, n3.p = null) : (n3.p = e, n3.v = null, n3.f = null, n3.si = null);
  else {
    if (c2 === "" && n3.v == null && n3.p == null)
      return null;
    n3.v = c2, n3.f = null, n3.si = null, n3.p = null;
    const g9 = Th2(e);
    g9 && (n3.s = g9);
  }
  return n3;
}
function Jc3(n3) {
  const { textRuns: e = [], paragraphs: t3 = [], customRanges: r, customBlocks: i = [] } = n3, o3 = n3.dataStream.replace(/(\r\n)+$/, ""), s2 = ["va"];
  return (
    // This is because after editing, an inexplicable second paragraph style will appear \r\n
    e.filter((l4) => l4.st < o3.length).some((l4) => {
      var c2;
      return !!(l4.ts && Object.keys(l4.ts).some((d2) => s2.includes(d2))) || Object.keys((c2 = l4.ts) != null ? c2 : {}).length && l4.ed - l4.st < o3.length;
    }) || t3.some((l4) => l4.bullet) || t3.length >= 2 || !!(r != null && r.length) || i.length > 0
  );
}
function Th2(n3) {
  const { body: e } = n3;
  if (!e) return null;
  const { textRuns: t3 = [] } = e;
  let r = {};
  const i = e.dataStream.replace(`\r
`, "");
  return t3.forEach((o3) => {
    const { st: s2, ed: l4, ts: a4 } = o3;
    l4 - s2 >= i.length && (r = __spreadValues(__spreadValues({}, r), a4));
  }), Object.keys(r).length ? r : null;
}
function sb2(n3, e = false) {
  n3.dataStream = Yc, n3.textRuns != null && (n3.textRuns.length === 1 && !e ? (n3.textRuns[0].st = 0, n3.textRuns[0].ed = 1) : n3.textRuns = void 0), n3.paragraphs != null && (n3.paragraphs = [
    {
      startIndex: 0
    }
  ]), n3.sectionBreaks != null && (n3.sectionBreaks = void 0), n3.tables != null && (n3.tables = void 0), n3.customRanges != null && (n3.customRanges = void 0), n3.customBlocks != null && (n3.customBlocks = void 0);
}
function Ph2(n3) {
  return n3 && Object.fromEntries(
    Object.entries(n3).filter(([e, t3]) => !(t3 == null || Array.isArray(t3) && t3.length === 0 || typeof t3 == "object" && Object.keys(t3).length === 0))
  );
}
var lb3 = Object.getOwnPropertyDescriptor;
var ab2 = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? lb3(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var Sn3 = (n3, e) => (t3, r) => e(t3, r, n3);
var yr4 = class extends ER {
  constructor(e, t3, r, i, o3, s2, l4, a4, c2) {
    super();
    _2(this, "_loadedMap", /* @__PURE__ */ new WeakSet());
    _2(this, "_scheduledCallback", -1);
    this._univerInstanceService = e, this._renderManagerService = t3, this._editorBridgeService = r, this._commandService = i, this._contextService = o3, this._formulaEditorManagerService = s2, this._undoRedoService = l4, this._textSelectionManagerService = a4, this._editorService = c2, this._initialize();
  }
  _initialize() {
    this._syncEditorSize(), this._listenFxBtnClick(), this._handleContentChange(), this._univerInstanceService.focused$.pipe(takeUntil(this.dispose$)).subscribe((e) => {
      this._create(e);
    }), this._create(Hl), this.disposeWithMe(this._editorService.focus$.subscribe(() => {
      var t3;
      ((t3 = this._editorService.getFocusEditor()) == null ? void 0 : t3.getEditorId()) !== Hl ? this._contextService.setContextValue(EE, false) : this._contextService.setContextValue(EE, true);
    }));
  }
  _handleContentChange() {
    this.disposeWithMe(
      this._commandService.onCommandExecuted((e) => {
        if (e.id === M.id) {
          const t3 = e.params, { unitId: r } = t3;
          r === Hl && this.autoScroll();
        }
      })
    );
  }
  _create(e) {
    if (e !== Hl)
      return;
    const t3 = this._renderManagerService.getRenderById(e);
    if (t3 == null)
      return;
    const { mainComponent: r } = t3;
    r != null && (this._loadedMap.has(r) || this._loadedMap.add(r));
  }
  _listenFxBtnClick() {
    this._formulaEditorManagerService.fxBtnClick$.pipe(takeUntil(this.dispose$)).subscribe(() => {
      var t3;
      if (this._contextService.getContextValue(F1) && !this._contextService.getContextValue(pE)) {
        this._univerInstanceService.setCurrentUnitForType(Hl);
        const r = this._univerInstanceService.getUniverDocInstance(
          Hl
        );
        this._editorBridgeService.isVisible().visible === false && this._commandService.syncExecuteCommand(
          tt5.id,
          {
            visible: true,
            eventType: hb.PointerDown,
            unitId: Hl
          }
        );
        const o3 = (t3 = r == null ? void 0 : r.getBody()) == null ? void 0 : t3.dataStream;
        if (o3 == null)
          return;
        let s2 = o3.startsWith("=") ? o3 : `=${o3}`;
        s2 = s2.replace(/\r\n$/, "");
        const l4 = [
          {
            startOffset: s2.length,
            endOffset: s2.length
          }
        ], a4 = {
          unitId: Hl,
          body: {
            dataStream: s2
          },
          segmentId: "",
          textRanges: l4
        };
        this._commandService.syncExecuteCommand(qd.id, a4), requestAnimationFrame(() => {
          this._textSelectionManagerService.replaceDocRanges([], {
            unitId: Fl,
            subUnitId: Fl
          }), this._textSelectionManagerService.replaceDocRanges(l4, {
            unitId: Hl,
            subUnitId: Hl
          }), this._contextService.setContextValue(EE, true);
        });
      }
    });
  }
  _syncEditorSize() {
    const e = this._univerInstanceService.unitAdded$.pipe(filter((t3) => t3.getUnitId() === Hl));
    this.disposeWithMe(combineLatest([this._formulaEditorManagerService.position$, e]).subscribe(([t3]) => {
      if (!t3) return this._clearScheduledCallback();
      const r = Xd2(Hl, this._renderManagerService), i = this._univerInstanceService.getUniverDocInstance(
        Hl
      );
      if (r == null || i == null) return this._clearScheduledCallback();
      const { width: o3, height: s2 } = t3;
      if (o3 === 0 || s2 === 0) return this._clearScheduledCallback();
      const { engine: l4 } = r;
      i.updateDocumentDataPageSize(o3), this.autoScroll(), this._scheduledCallback = requestIdleCallback(() => l4.resizeBySize(o3, s2));
    }));
  }
  _clearScheduledCallback() {
    this._scheduledCallback !== -1 && cancelIdleCallback(this._scheduledCallback), this._scheduledCallback = -1;
  }
  autoScroll() {
    var g9, f4;
    const e = this._formulaEditorManagerService.getPosition(), t3 = (g9 = this._renderManagerService.getRenderById(Hl)) == null ? void 0 : g9.with(D).getSkeleton(), r = this._renderManagerService.getRenderById(Hl), i = this._univerInstanceService.getUniverDocInstance(
      Hl
    );
    if (t3 == null || e == null || r == null || i == null)
      return;
    const { marginTop: o3 = 0, marginBottom: s2 = 0 } = i.getSnapshot().documentStyle, { scene: l4, mainComponent: a4 } = r;
    let { actualHeight: c2 } = t3.getActualSize();
    c2 += o3 + s2;
    const { width: d2, height: u2 } = e, h9 = l4.getViewport(We2.VIEW_MAIN);
    let m9 = h9 == null ? void 0 : h9.getScrollBar();
    l4.transformByState({
      width: d2,
      height: c2
    }), a4 == null || a4.resize(d2, c2), c2 > u2 ? m9 == null ? h9 && new D8(h9, { enableHorizontal: false, barSize: 8 }) : h9 == null || h9.resetCanvasSizeAndUpdateScroll() : (m9 = null, h9 == null || h9.scrollToViewportPos({ viewportScrollX: 0, viewportScrollY: 0 }), (f4 = h9 == null ? void 0 : h9.getScrollBar()) == null || f4.dispose());
  }
};
yr4 = ab2([
  Sn3(0, br),
  Sn3(1, JE),
  Sn3(2, Qe3),
  Sn3(3, Ds),
  Sn3(4, Tr),
  Sn3(5, us2),
  Sn3(6, ra),
  Sn3(7, Inject(m)),
  Sn3(8, Ge3)
], yr4);
var cb2 = "embedding_formula_editor";
var vM = (n3) => n3.includes(cb2);
var fu3 = (n3, e) => {
  var u2, h9, m9, g9, f4;
  const r = e.findNodePositionByCharIndex(n3.startOffset, true, n3.segmentId, -1), i = e.getSkeletonData();
  let o3 = n3.endOffset;
  if (n3.segmentId) {
    const p3 = (f4 = Array.from((h9 = (u2 = i == null ? void 0 : i.skeFooters.get(n3.segmentId)) == null ? void 0 : u2.values()) != null ? h9 : [])[0]) != null ? f4 : Array.from((g9 = (m9 = i == null ? void 0 : i.skeHeaders.get(n3.segmentId)) == null ? void 0 : m9.values()) != null ? g9 : [])[0];
    p3 && (o3 = Math.min(p3.ed, o3));
  }
  const s2 = e.findNodePositionByCharIndex(o3, true, n3.segmentId, -1);
  if (!s2 || !r)
    return;
  const l4 = {
    docsLeft: 0,
    docsTop: 0,
    pageMarginLeft: 0,
    pageMarginTop: 0
  }, a4 = new It(l4, e), { borderBoxPointGroup: c2 } = a4.getRangePointData(r, s2);
  return Es(c2).map((p3) => ({
    top: p3.top,
    bottom: p3.bottom,
    left: p3.left,
    right: p3.right
  }));
};
var db2 = (n3, e, t3 = -1) => {
  const r = e.findPositionByGlyph(n3, t3);
  if (!r)
    return;
  const i = __spreadProps(__spreadValues({}, r), { isBack: true }), o3 = {
    docsLeft: 0,
    docsTop: 0,
    pageMarginLeft: 0,
    pageMarginTop: 0
  }, s2 = new It(o3, e), { borderBoxPointGroup: l4 } = s2.getRangePointData(i, i), c2 = Es(l4)[0];
  return {
    top: c2.top,
    bottom: c2.bottom,
    left: c2.left,
    right: c2.right
  };
};
var ub2 = (n3, e, t3 = 0, r = 0) => {
  const i = fu3({ startOffset: e.startIndex, endOffset: e.endIndex + 1 }, n3);
  if (i)
    return {
      rects: i.map((o3) => ({
        top: o3.top + r,
        bottom: o3.bottom + r,
        left: o3.left + t3,
        right: o3.right + t3
      })),
      range: e
    };
};
var hb2 = (n3, e, t3 = 0, r = 0) => {
  var u2, h9, m9;
  const i = n3.findNodeByCharIndex(e.startIndex), o3 = i == null ? void 0 : i.parent, s2 = o3 == null ? void 0 : o3.parent, l4 = s2 == null ? void 0 : s2.parent, a4 = l4 == null ? void 0 : l4.lines.find((g9) => g9.paragraphStart && g9.paragraphIndex === e.startIndex), c2 = (m9 = (h9 = (u2 = a4 == null ? void 0 : a4.divides) == null ? void 0 : u2[0]) == null ? void 0 : h9.glyphGroup) == null ? void 0 : m9[0];
  if (!c2 || !c2)
    return;
  const d2 = db2(c2, n3);
  if (d2)
    return {
      rect: {
        top: d2.top + r,
        bottom: d2.bottom + r,
        left: d2.left + t3,
        right: d2.right + t3
      },
      segmentId: void 0,
      segmentPageIndex: -1,
      paragraph: e
    };
};
var gb3 = (n3, e = 0, t3 = 0) => {
  var l4, a4, c2, d2, u2, h9, m9;
  const r = n3.getViewModel().getDataModel(), i = (c2 = (a4 = (l4 = r.getBody()) == null ? void 0 : l4.customRanges) == null ? void 0 : a4.filter((g9) => g9.rangeType === En.HYPERLINK)) != null ? c2 : [], o3 = (h9 = (u2 = (d2 = r.getBody()) == null ? void 0 : d2.paragraphs) == null ? void 0 : u2.filter((g9) => {
    var f4;
    return ((f4 = g9.bullet) == null ? void 0 : f4.listType.indexOf(Vt.CHECK_LIST)) === 0;
  })) != null ? h9 : [], s2 = (m9 = n3.getSkeletonData()) == null ? void 0 : m9.pages[0].skeDrawings;
  return {
    links: i.map((g9) => ub2(n3, g9, e, t3)).filter(Boolean),
    checkLists: o3.map((g9) => hb2(n3, g9, e, t3)).filter(Boolean),
    drawings: s2 ? Array.from(s2.keys()).map((g9) => ({
      drawingId: g9,
      rect: {
        top: s2.get(g9).aTop,
        bottom: s2.get(g9).aTop + s2.get(g9).width,
        left: s2.get(g9).aLeft,
        right: s2.get(g9).aLeft + s2.get(g9).height
      },
      drawing: s2.get(g9)
    })) : []
  };
};
function Pf(n3, e, t3) {
  var c2, d2, u2, h9, m9, g9;
  const r = (u2 = (d2 = (c2 = e.documentSkeleton) == null ? void 0 : c2.getSkeletonData()) == null ? void 0 : d2.pages[0].height) != null ? u2 : 0, i = (g9 = (m9 = (h9 = e.documentSkeleton) == null ? void 0 : h9.getSkeletonData()) == null ? void 0 : m9.pages[0].width) != null ? g9 : 0, o3 = e.verticalAlign, s2 = e.horizontalAlign;
  let l4 = 0;
  switch (o3) {
    case Dn.UNSPECIFIED:
    case Dn.BOTTOM:
      l4 = n3.mergeInfo.endY - n3.mergeInfo.startY - r;
      break;
    case Dn.MIDDLE:
      l4 = (n3.mergeInfo.endY - n3.mergeInfo.startY - r) / 2;
      break;
  }
  let a4 = 0;
  switch (s2) {
    case Pt.RIGHT:
      a4 = n3.mergeInfo.endX - n3.mergeInfo.startX - i;
      break;
    case Pt.CENTER:
      a4 = (n3.mergeInfo.endX - n3.mergeInfo.startX - i) / 2;
      break;
    case Pt.UNSPECIFIED: {
      t3 && (a4 = n3.mergeInfo.endX - n3.mergeInfo.startX - i);
      break;
    }
  }
  return {
    paddingLeft: a4,
    paddingTop: l4
  };
}
var SM = (n3, e, t3, r, i, o3) => {
  var P8, A4, x7;
  const s2 = n3.get(br), l4 = n3.get(JE), a4 = s2.getUnit(e, we.UNIVER_SHEET);
  if (!a4)
    return null;
  const c2 = a4.getSheetBySheetId(t3);
  if (!c2)
    return null;
  const d2 = l4.getRenderById(a4.getUnitId()), u2 = d2 == null ? void 0 : d2.with(he2).getSkeletonParam(c2.getSheetId()), h9 = u2 == null ? void 0 : u2.skeleton;
  if (!h9 || !d2) return;
  const m9 = h9.getFont(r, i), g9 = m9 == null ? void 0 : m9.documentSkeleton;
  if (!g9)
    return null;
  const f4 = (A4 = (P8 = g9.getViewModel().getBody()) == null ? void 0 : P8.customRanges) == null ? void 0 : A4.find((H6) => H6.rangeId === o3);
  if (!f4)
    return null;
  const p3 = Oi2, v6 = h9.getCellWithCoordByIndex(r, i);
  let { actualColumn: S, actualRow: w6 } = v6;
  h9.overflowCache.forValue((H6, V7, D5) => {
    D5.startRow <= w6 && D5.endRow >= w6 && D5.startColumn <= S && D5.endColumn >= S && (S = V7, w6 = H6);
  });
  const C = h9.getCellWithCoordByIndex(w6, S), I6 = c2.getCell(C.actualRow, C.actualColumn), { topOffset: R9 = 0, leftOffset: y6 = 0 } = (x7 = I6 == null ? void 0 : I6.fontRenderExtension) != null ? x7 : {}, { paddingLeft: E3, paddingTop: M10 } = Pf(C, m9, false), T10 = fu3({ startOffset: f4.startIndex, endOffset: f4.endIndex }, g9);
  return {
    rects: T10 == null ? void 0 : T10.map((H6) => ({
      top: H6.top + C.mergeInfo.startY + M10 + R9 + p3,
      bottom: H6.bottom + C.mergeInfo.startY + M10 + R9 + p3,
      left: H6.left + C.mergeInfo.startX + E3 + y6,
      right: H6.right + C.mergeInfo.startX + E3 + y6
    })),
    customRange: f4,
    label: g9.getViewModel().getBody().dataStream.slice(f4.startIndex, f4.endIndex + 1)
  };
};
var CM = (n3, e, t3, r, i, o3) => {
  var y6, E3, M10;
  const s2 = n3.get(Qe3), l4 = s2.getEditCellState();
  if (!l4 || !s2.isVisible().visible)
    return null;
  const { editorUnitId: c2, unitId: d2, sheetId: u2, row: h9, column: m9 } = l4;
  if (e !== d2 || t3 !== u2 || h9 !== r || m9 !== i)
    return null;
  const g9 = n3.get(JE), f4 = g9.getRenderById(c2), p3 = g9.getRenderById(e);
  if (!f4 || !p3)
    return null;
  const v6 = f4.with(D).getSkeleton(), S = (y6 = p3.with(he2).getSkeletonParam(u2)) == null ? void 0 : y6.skeleton;
  if (!v6 || !S)
    return null;
  const w6 = (M10 = (E3 = v6.getViewModel().getBody()) == null ? void 0 : E3.customRanges) == null ? void 0 : M10.find((T10) => T10.rangeId === o3);
  if (!w6)
    return null;
  const C = 4, I6 = fu3({ startOffset: w6.startIndex, endOffset: w6.endIndex }, v6), R9 = f4.engine.getCanvasElement().getBoundingClientRect();
  return {
    rects: I6 == null ? void 0 : I6.map((T10) => ({
      top: T10.top + R9.top - C,
      bottom: T10.bottom + R9.top + C,
      left: T10.left + R9.left,
      right: T10.right + R9.left
    })),
    customRange: w6,
    label: v6.getViewModel().getBody().dataStream.slice(w6.startIndex, w6.endIndex + 1)
  };
};
var mb3 = Object.getOwnPropertyDescriptor;
var fb3 = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? mb3(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var xh2 = (n3, e) => (t3, r) => e(t3, r, n3);
function cr4(n3) {
  const _a5 = n3, { workbook: e, worksheet: t3 } = _a5, r = __objRest(_a5, ["workbook", "worksheet"]);
  return r;
}
var Mr3 = class extends Ve {
  constructor(e, t3) {
    super();
    _2(this, "_currentCell$", new BehaviorSubject(null));
    _2(this, "_currentRichText$", new BehaviorSubject(null));
    _2(this, "_currentClickedCell$", new Subject());
    _2(this, "_currentDbClickedCell$", new Subject());
    _2(this, "_currentCellWithEvent$", new Subject());
    _2(this, "_currentPointerDownCell$", new Subject());
    _2(this, "_currentPointerUpCell$", new Subject());
    _2(this, "_currentHoveredRowHeader$", new BehaviorSubject(null));
    _2(this, "_currentHoveredColHeader$", new BehaviorSubject(null));
    _2(this, "_currentRowHeaderClick$", new Subject());
    _2(this, "_currentColHeaderClick$", new Subject());
    _2(this, "_currentRowHeaderDbClick$", new Subject());
    _2(this, "_currentColHeaderDbClick$", new Subject());
    _2(this, "_currentRowHeaderPointerDown$", new Subject());
    _2(this, "_currentColHeaderPointerDown$", new Subject());
    _2(this, "_currentRowHeaderPointerUp$", new Subject());
    _2(this, "_currentColHeaderPointerUp$", new Subject());
    _2(this, "currentCell$", this._currentCell$.asObservable().pipe(
      distinctUntilChanged(
        (e4, t4) => {
          var r, i, o3, s2, l4, a4, c2, d2;
          return ((r = e4 == null ? void 0 : e4.location) == null ? void 0 : r.unitId) === ((i = t4 == null ? void 0 : t4.location) == null ? void 0 : i.unitId) && ((o3 = e4 == null ? void 0 : e4.location) == null ? void 0 : o3.subUnitId) === ((s2 = t4 == null ? void 0 : t4.location) == null ? void 0 : s2.subUnitId) && ((l4 = e4 == null ? void 0 : e4.location) == null ? void 0 : l4.row) === ((a4 = t4 == null ? void 0 : t4.location) == null ? void 0 : a4.row) && ((c2 = e4 == null ? void 0 : e4.location) == null ? void 0 : c2.col) === ((d2 = t4 == null ? void 0 : t4.location) == null ? void 0 : d2.col);
        }
      )
    ));
    _2(this, "currentRichTextNoDistinct$", this._currentRichText$.pipe(
      map((e4) => e4 && {
        unitId: e4.location.unitId,
        subUnitId: e4.location.subUnitId,
        row: e4.location.row,
        col: e4.location.col,
        customRange: e4.customRange,
        bullet: e4.bullet,
        rect: e4.rect,
        drawing: e4.drawing
      })
    ));
    _2(this, "currentRichText$", this._currentRichText$.pipe(
      distinctUntilChanged(
        // eslint-disable-next-line complexity
        (e4, t4) => {
          var r, i, o3, s2, l4, a4, c2, d2, u2, h9, m9, g9, f4, p3, v6, S, w6, C;
          return ((r = e4 == null ? void 0 : e4.location) == null ? void 0 : r.unitId) === ((i = t4 == null ? void 0 : t4.location) == null ? void 0 : i.unitId) && ((o3 = e4 == null ? void 0 : e4.location) == null ? void 0 : o3.subUnitId) === ((s2 = t4 == null ? void 0 : t4.location) == null ? void 0 : s2.subUnitId) && ((l4 = e4 == null ? void 0 : e4.location) == null ? void 0 : l4.row) === ((a4 = t4 == null ? void 0 : t4.location) == null ? void 0 : a4.row) && ((c2 = e4 == null ? void 0 : e4.location) == null ? void 0 : c2.col) === ((d2 = t4 == null ? void 0 : t4.location) == null ? void 0 : d2.col) && ((u2 = e4 == null ? void 0 : e4.customRange) == null ? void 0 : u2.rangeId) === ((h9 = t4 == null ? void 0 : t4.customRange) == null ? void 0 : h9.rangeId) && ((m9 = e4 == null ? void 0 : e4.bullet) == null ? void 0 : m9.startIndex) === ((g9 = t4 == null ? void 0 : t4.bullet) == null ? void 0 : g9.startIndex) && ((f4 = e4 == null ? void 0 : e4.customRange) == null ? void 0 : f4.startIndex) === ((p3 = t4 == null ? void 0 : t4.customRange) == null ? void 0 : p3.startIndex) && ((v6 = e4 == null ? void 0 : e4.customRange) == null ? void 0 : v6.endIndex) === ((S = t4 == null ? void 0 : t4.customRange) == null ? void 0 : S.endIndex) && ((w6 = e4 == null ? void 0 : e4.drawing) == null ? void 0 : w6.drawingId) === ((C = t4 == null ? void 0 : t4.drawing) == null ? void 0 : C.drawingId);
        }
      ),
      map((e4) => e4 && {
        unitId: e4.location.unitId,
        subUnitId: e4.location.subUnitId,
        row: e4.location.row,
        col: e4.location.col,
        customRange: e4.customRange,
        bullet: e4.bullet,
        rect: e4.rect,
        drawing: e4.drawing
      })
    ));
    _2(this, "currentCellPosWithEvent$", this._currentCellWithEvent$.pipe(
      distinctUntilChanged(
        (e4, t4) => {
          var r, i, o3, s2, l4, a4, c2, d2;
          return ((r = e4 == null ? void 0 : e4.location) == null ? void 0 : r.unitId) === ((i = t4 == null ? void 0 : t4.location) == null ? void 0 : i.unitId) && ((o3 = e4 == null ? void 0 : e4.location) == null ? void 0 : o3.subUnitId) === ((s2 = t4 == null ? void 0 : t4.location) == null ? void 0 : s2.subUnitId) && ((l4 = e4 == null ? void 0 : e4.location) == null ? void 0 : l4.row) === ((a4 = t4 == null ? void 0 : t4.location) == null ? void 0 : a4.row) && ((c2 = e4 == null ? void 0 : e4.location) == null ? void 0 : c2.col) === ((d2 = t4 == null ? void 0 : t4.location) == null ? void 0 : d2.col);
        }
      ),
      map((e4) => e4 && {
        unitId: e4.location.unitId,
        subUnitId: e4.location.subUnitId,
        row: e4.location.row,
        col: e4.location.col,
        event: e4.event
      })
    ));
    _2(this, "currentPosition$", this._currentCell$.asObservable());
    _2(this, "currentClickedCell$", this._currentClickedCell$.asObservable());
    _2(this, "currentDbClickedCell$", this._currentDbClickedCell$.asObservable());
    _2(this, "currentPointerDownCell$", this._currentPointerDownCell$.asObservable());
    _2(this, "currentPointerUpCell$", this._currentPointerUpCell$.asObservable());
    _2(this, "currentHoveredRowHeader$", this._currentHoveredRowHeader$.asObservable());
    _2(this, "currentHoveredColHeader$", this._currentHoveredColHeader$.asObservable());
    _2(this, "currentRowHeaderClick$", this._currentRowHeaderClick$.asObservable());
    _2(this, "currentColHeaderClick$", this._currentColHeaderClick$.asObservable());
    _2(this, "currentRowHeaderDbClick$", this._currentRowHeaderDbClick$.asObservable());
    _2(this, "currentColHeaderDbClick$", this._currentColHeaderDbClick$.asObservable());
    _2(this, "currentRowHeaderPointerDown$", this._currentRowHeaderPointerDown$.asObservable());
    _2(this, "currentColHeaderPointerDown$", this._currentColHeaderPointerDown$.asObservable());
    _2(this, "currentRowHeaderPointerUp$", this._currentRowHeaderPointerUp$.asObservable());
    _2(this, "currentColHeaderPointerUp$", this._currentColHeaderPointerUp$.asObservable());
    this._univerInstanceService = e, this._renderManagerService = t3, this._initCellDisposableListener();
  }
  dispose() {
    super.dispose(), this._currentCell$.complete(), this._currentClickedCell$.complete(), this._currentPointerDownCell$.complete(), this._currentPointerUpCell$.complete(), this._currentCellWithEvent$.complete(), this._currentRichText$.complete(), this._currentDbClickedCell$.complete(), this._currentHoveredRowHeader$.complete(), this._currentHoveredColHeader$.complete(), this._currentRowHeaderClick$.complete(), this._currentColHeaderClick$.complete(), this._currentRowHeaderDbClick$.complete(), this._currentColHeaderDbClick$.complete(), this._currentRowHeaderPointerDown$.complete(), this._currentColHeaderPointerDown$.complete(), this._currentRowHeaderPointerUp$.complete(), this._currentColHeaderPointerUp$.complete(), this.currentCellPosWithEvent$ = of(null), this.currentRichText$ = of(null);
  }
  _initCellDisposableListener() {
    this.disposeWithMe(this._univerInstanceService.getCurrentTypeOfUnit$(we.UNIVER_SHEET).subscribe((e) => {
      e || this._currentCell$.next(null);
    })), this.disposeWithMe(this._univerInstanceService.unitDisposed$.subscribe((e) => {
      var t3, r;
      ((t3 = this._currentCell$.getValue()) == null ? void 0 : t3.location.unitId) === e.getUnitId() && this._currentCell$.next(null), ((r = this._currentRichText$.getValue()) == null ? void 0 : r.location.unitId) === e.getUnitId() && this._currentRichText$.next(null);
    }));
  }
  _getCalcDeps(e) {
    const t3 = this._univerInstanceService.getUnit(e, we.UNIVER_SHEET);
    if (!t3)
      return null;
    const r = t3.getActiveSheet();
    if (!r)
      return null;
    const i = this._renderManagerService.getRenderById(t3.getUnitId());
    if (!i) return null;
    const o3 = i.with(he2).getSkeletonParam(r.getSheetId());
    if (!o3) return null;
    const s2 = i.with(Et3);
    if (!(!(s2 != null && s2.getCurrentScrollState()) || !i))
      return { currentRender: i, workbook: t3, worksheet: r, skeletonParam: o3 };
  }
  _calcActiveCell(e, t3, r, i, o3, s2) {
    var R9, y6, E3;
    const l4 = Gm(e, t3, r, i, o3, s2), a4 = i.skeleton;
    if (!l4)
      return null;
    const { position: c2, overflowLocation: d2, location: u2 } = l4, h9 = a4.getFont(d2.row, d2.col);
    let m9 = null, g9 = null, f4 = null;
    const p3 = a4.getCellWithCoordByIndex(d2.row, d2.col), v6 = r.getCell(d2.row, d2.col), { topOffset: S = 0, leftOffset: w6 = 0 } = (R9 = v6 == null ? void 0 : v6.fontRenderExtension) != null ? R9 : {};
    if (h9 != null && h9.documentSkeleton) {
      const { paddingLeft: M10, paddingTop: T10 } = Pf(p3, h9, (v6 == null ? void 0 : v6.v) !== null && (v6 == null ? void 0 : v6.v) !== void 0 ? !Number.isNaN(+v6.v) : false), P8 = gb3(h9.documentSkeleton, M10, T10), A4 = o3 - c2.startX - w6, x7 = s2 - c2.startY - S;
      m9 = P8.links.find((H6) => H6.rects.some((V7) => V7.left <= A4 && A4 <= V7.right && V7.top <= x7 && x7 <= V7.bottom)), g9 = P8.checkLists.find((H6) => H6.rect.left <= A4 && A4 <= H6.rect.right && H6.rect.top <= x7 && x7 <= H6.rect.bottom), f4 = P8.drawings.find((H6) => H6.rect.left <= A4 && A4 <= H6.rect.right && H6.rect.top <= x7 && x7 <= H6.rect.bottom);
    }
    const C = (E3 = (y6 = m9 == null ? void 0 : m9.rects.pop()) != null ? y6 : g9 == null ? void 0 : g9.rect) != null ? E3 : f4 == null ? void 0 : f4.rect, I6 = C && (() => {
      const M10 = C.top + p3.mergeInfo.startY + S, T10 = C.bottom + p3.mergeInfo.startY + S, P8 = C.left + p3.mergeInfo.startX + w6, A4 = C.right + p3.mergeInfo.startX + w6, x7 = p3.mergeInfo.startY + S, H6 = p3.mergeInfo.endY + S, V7 = p3.mergeInfo.startX + w6, D5 = p3.mergeInfo.endX + w6, B5 = Math.min(Math.max(M10, x7), x7), F7 = Math.min(T10, H6), z5 = Math.min(Math.max(P8, V7), V7), Z9 = Math.min(A4, D5);
      return {
        top: B5,
        bottom: F7,
        left: z5,
        right: Z9
      };
    })();
    return {
      location: u2,
      position: c2,
      overflowLocation: d2,
      customRange: m9 == null ? void 0 : m9.range,
      bullet: g9 == null ? void 0 : g9.paragraph,
      drawing: f4,
      rect: I6
    };
  }
  _calcActiveRowHeader(e, t3, r) {
    const i = this._getCalcDeps(e);
    if (!i)
      return;
    const { currentRender: o3, worksheet: s2, skeletonParam: l4 } = i, { scaleY: a4 } = o3.scene.getAncestorScale(), c2 = o3.scene.getViewports().find((h9) => h9.isHit(new U(t3, r)));
    if (!c2 || c2.viewportKey !== k2.VIEW_ROW_TOP && c2.viewportKey !== k2.VIEW_ROW_BOTTOM)
      return;
    const d2 = {
      x: c2.viewportScrollX,
      y: c2.viewportScrollY
    }, u2 = l4.skeleton.getRowIndexByOffsetY(r, a4, d2);
    return { unitId: e, index: u2, subUnitId: s2.getSheetId() };
  }
  _calcActiveColHeader(e, t3, r) {
    const i = this._getCalcDeps(e);
    if (!i)
      return;
    const { currentRender: o3, worksheet: s2, skeletonParam: l4 } = i, { scaleX: a4 } = o3.scene.getAncestorScale(), c2 = o3.scene.getViewports().find((h9) => h9.isHit(new U(t3, r)));
    if (!c2 || c2.viewportKey !== k2.VIEW_COLUMN_LEFT && c2.viewportKey !== k2.VIEW_COLUMN_RIGHT)
      return;
    const d2 = {
      x: c2.viewportScrollX,
      y: c2.viewportScrollY
    }, u2 = l4.skeleton.getColumnIndexByOffsetX(t3, a4, d2);
    return { unitId: e, index: u2, subUnitId: s2.getSheetId() };
  }
  triggerPointerDown(e, t3) {
    const r = this._getCalcDeps(e);
    if (!r)
      return;
    const { currentRender: i, workbook: o3, worksheet: s2, skeletonParam: l4 } = r, a4 = this._calcActiveCell(i, o3, s2, l4, t3.offsetX, t3.offsetY);
    if (a4 && a4.location) {
      const { unitId: c2, subUnitId: d2, row: u2, col: h9 } = cr4(a4.location);
      this._currentPointerDownCell$.next({
        unitId: c2,
        subUnitId: d2,
        row: u2,
        col: h9,
        event: t3
      });
    }
  }
  triggerPointerUp(e, t3) {
    const r = this._getCalcDeps(e);
    if (!r)
      return;
    const { currentRender: i, workbook: o3, worksheet: s2, skeletonParam: l4 } = r, a4 = this._calcActiveCell(i, o3, s2, l4, t3.offsetX, t3.offsetY);
    if (a4) {
      const c2 = cr4(a4.location);
      this._currentPointerUpCell$.next(__spreadProps(__spreadValues({}, c2), {
        event: t3
      }));
    }
  }
  triggerMouseMove(e, t3) {
    const r = this._getCalcDeps(e);
    if (!r)
      return;
    const { currentRender: i, workbook: o3, worksheet: s2, skeletonParam: l4 } = r, a4 = this._calcActiveCell(i, o3, s2, l4, t3.offsetX, t3.offsetY);
    this._currentCell$.next(a4 && {
      location: cr4(a4.location),
      position: a4.position
    }), this._currentRichText$.next(a4 && __spreadProps(__spreadValues({}, a4), {
      location: cr4(a4.overflowLocation)
    })), this._currentCellWithEvent$.next(a4 && __spreadProps(__spreadValues({}, a4), {
      location: cr4(a4.location),
      event: t3
    }));
  }
  /**
   * Trigger by pointerup.
   * @param unitId
   * @param offsetX
   * @param offsetY
   */
  triggerClick(e, t3, r) {
    const i = this._getCalcDeps(e);
    if (!i)
      return;
    const { currentRender: o3, workbook: s2, worksheet: l4, skeletonParam: a4 } = i, c2 = this._calcActiveCell(o3, s2, l4, a4, t3, r);
    c2 && this._currentClickedCell$.next(__spreadProps(__spreadValues({}, c2), {
      location: cr4(c2.location)
    }));
  }
  triggerDbClick(e, t3, r) {
    const i = this._getCalcDeps(e);
    if (!i)
      return;
    const { currentRender: o3, workbook: s2, worksheet: l4, skeletonParam: a4 } = i, c2 = this._calcActiveCell(o3, s2, l4, a4, t3, r);
    c2 && this._currentDbClickedCell$.next(__spreadProps(__spreadValues({}, c2), {
      location: cr4(c2.location)
    }));
  }
  triggerScroll() {
    this._currentCell$.next(null);
  }
  triggerRowHeaderClick(e, t3, r) {
    const i = this._calcActiveRowHeader(e, t3, r);
    i && this._currentRowHeaderClick$.next(i);
  }
  triggerColHeaderClick(e, t3, r) {
    const i = this._calcActiveColHeader(e, t3, r);
    i && this._currentColHeaderClick$.next(i);
  }
  triggerRowHeaderDbClick(e, t3, r) {
    const i = this._calcActiveRowHeader(e, t3, r);
    i && this._currentRowHeaderDbClick$.next(i);
  }
  triggerColHeaderDbClick(e, t3, r) {
    const i = this._calcActiveColHeader(e, t3, r);
    i && this._currentColHeaderDbClick$.next(i);
  }
  triggerRowHeaderMouseMove(e, t3, r) {
    this._currentHoveredRowHeader$.next(this._calcActiveRowHeader(e, t3, r));
  }
  triggerColHeaderMouseMove(e, t3, r) {
    this._currentHoveredColHeader$.next(this._calcActiveColHeader(e, t3, r));
  }
  triggerRowHeaderPoniterDown(e, t3, r) {
    const i = this._calcActiveRowHeader(e, t3, r);
    i && this._currentRowHeaderPointerDown$.next(i);
  }
  triggerColHeaderPoniterDown(e, t3, r) {
    const i = this._calcActiveColHeader(e, t3, r);
    i && this._currentColHeaderPointerDown$.next(i);
  }
  triggerRowHeaderPoniterUp(e, t3, r) {
    const i = this._calcActiveRowHeader(e, t3, r);
    i && this._currentRowHeaderPointerUp$.next(i);
  }
  triggerColHeaderPoniterUp(e, t3, r) {
    const i = this._calcActiveColHeader(e, t3, r);
    i && this._currentColHeaderPointerUp$.next(i);
  }
};
Mr3 = fb3([
  xh2(0, br),
  xh2(1, JE)
], Mr3);
var pb2 = Object.getOwnPropertyDescriptor;
var vb3 = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? pb2(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var Ya2 = (n3, e) => (t3, r) => e(t3, r, n3);
var ml2 = class extends Ve {
  constructor(e, t3, r, i) {
    super();
    _2(this, "_active", false);
    this._context = e, this._hoverManagerService = t3, this._sheetSkeletonManagerService = r, this._scrollManagerService = i, this._initPointerEvent(), this._initScrollEvent();
  }
  get active() {
    return this._active;
  }
  // eslint-disable-next-line max-lines-per-function
  _initPointerEvent() {
    const e = new ho(), t3 = (r) => {
      if (e.dispose(), !r)
        return;
      const { mainComponent: i, unitId: o3, components: s2 } = this._context;
      if (!i)
        return;
      e.add(i.onPointerEnter$.subscribeEvent((c2) => {
        this._active = true;
      })), e.add(k1(i.onPointerMove$).subscribe((c2) => {
        this._active = true, this._hoverManagerService.triggerMouseMove(o3, c2);
      })), e.add(i.onPointerDown$.subscribeEvent((c2) => {
        this._hoverManagerService.triggerPointerDown(o3, c2);
      })), e.add(i.onPointerUp$.subscribeEvent((c2) => {
        this._hoverManagerService.triggerPointerUp(o3, c2);
      })), e.add(i.onClick$.subscribeEvent((c2) => {
        this._hoverManagerService.triggerClick(o3, c2.offsetX, c2.offsetY);
      })), e.add(i.onDblclick$.subscribeEvent((c2) => {
        this._hoverManagerService.triggerDbClick(o3, c2.offsetX, c2.offsetY);
      })), e.add(i.onPointerLeave$.subscribeEvent(() => {
        this._active = false;
      }));
      const l4 = s2.get(Ge5.ROW), a4 = s2.get(Ge5.COLUMN);
      l4 && (e.add(l4.onPointerMove$.subscribeEvent((c2) => {
        this._hoverManagerService.triggerRowHeaderMouseMove(o3, c2.offsetX, c2.offsetY);
      })), e.add(l4.onPointerDown$.subscribeEvent((c2) => {
        this._hoverManagerService.triggerRowHeaderPoniterDown(o3, c2.offsetX, c2.offsetY);
      })), e.add(l4.onPointerUp$.subscribeEvent((c2) => {
        this._hoverManagerService.triggerRowHeaderPoniterUp(o3, c2.offsetX, c2.offsetY), this._hoverManagerService.triggerRowHeaderClick(o3, c2.offsetX, c2.offsetY);
      })), e.add(l4.onDblclick$.subscribeEvent((c2) => {
        this._hoverManagerService.triggerRowHeaderDbClick(o3, c2.offsetX, c2.offsetY);
      }))), a4 && (e.add(a4.onPointerMove$.subscribeEvent((c2) => {
        this._hoverManagerService.triggerColHeaderMouseMove(o3, c2.offsetX, c2.offsetY);
      })), e.add(a4.onPointerDown$.subscribeEvent((c2) => {
        this._hoverManagerService.triggerColHeaderPoniterDown(o3, c2.offsetX, c2.offsetY);
      })), e.add(a4.onPointerUp$.subscribeEvent((c2) => {
        this._hoverManagerService.triggerColHeaderPoniterUp(o3, c2.offsetX, c2.offsetY), this._hoverManagerService.triggerColHeaderClick(o3, c2.offsetX, c2.offsetY);
      })), e.add(a4.onDblclick$.subscribeEvent((c2) => {
        this._hoverManagerService.triggerColHeaderDbClick(o3, c2.offsetX, c2.offsetY);
      })));
    };
    t3(this._sheetSkeletonManagerService.getCurrentParam()), this.disposeWithMe(this._sheetSkeletonManagerService.currentSkeleton$.subscribe((r) => {
      t3(r);
    }));
  }
  _initScrollEvent() {
    this.disposeWithMe(this._scrollManagerService.validViewportScrollInfo$.subscribe(() => this._hoverManagerService.triggerScroll()));
  }
};
ml2 = vb3([
  Ya2(1, Inject(Mr3)),
  Ya2(2, Inject(he2)),
  Ya2(3, Inject(Et3))
], ml2);
var xf = "UI_PLUGIN_SHEETS";
var pu2 = `${xf}_BORDER_PANEL_COMPONENT`;
var Of = [
  {
    label: "borderLine.borderTop",
    icon: "UpBorderDoubleIcon",
    value: "top"
  },
  {
    label: "borderLine.borderBottom",
    icon: "DownBorderDoubleIcon",
    value: "bottom"
  },
  {
    label: "borderLine.borderLeft",
    icon: "LeftBorderDoubleIcon",
    value: "left"
  },
  {
    label: "borderLine.borderRight",
    icon: "RightBorderDoubleIcon",
    value: "right"
  },
  {
    label: "borderLine.borderNone",
    icon: "NoBorderIcon",
    value: "none"
  },
  {
    label: "borderLine.borderAll",
    icon: "AllBorderIcon",
    value: "all"
  },
  {
    label: "borderLine.borderOutside",
    icon: "OuterBorderDoubleIcon",
    value: "outside"
  },
  {
    label: "borderLine.borderInside",
    icon: "InnerBorderDoubleIcon",
    value: "inside"
  },
  {
    label: "borderLine.borderHorizontal",
    icon: "HorizontalBorderDoubleIcon",
    value: "horizontal"
  },
  {
    label: "borderLine.borderVertical",
    icon: "VerticalBorderDoubleIcon",
    value: "vertical"
  },
  {
    label: "borderLine.borderTlbr",
    icon: "BackSlashDoubleIcon",
    value: "tlbr"
  },
  {
    label: "borderLine.borderTlbcTlmr",
    icon: "LeftDoubleDiagonalDoubleIcon",
    value: "tlbc_tlmr"
  },
  {
    label: "borderLine.borderTlbrTlbcTlmr",
    icon: "LeftTridiagonalDoubleIcon",
    value: "tlbr_tlbc_tlmr"
  },
  {
    label: "borderLine.borderBlTr",
    icon: "SlashDoubleIcon",
    value: "bltr"
  },
  {
    label: "borderLine.borderMltrBctr",
    icon: "RightDoubleDiagonalDoubleIcon",
    value: "mltr_bctr"
  }
];
function Sb3(n3) {
  return n3.getCurrentTypeOfUnit$(we.UNIVER_SHEET).pipe(switchMap((e) => e ? e.activeSheet$.pipe(map((t3) => t3 ? { workbook: e, worksheet: t3 } : null)) : of(null)));
}
function pt3(n3, e, t3) {
  return Sb3(n3).pipe(switchMap((r) => r ? t3(r) : of(e)));
}
function Cb2(n3, e) {
  const t3 = n3.get(br), r = n3.get(To), i = n3.get(z);
  return t3.getCurrentTypeOfUnit$(we.UNIVER_SHEET).pipe(
    switchMap((s2) => s2 ? combineLatest([i.selectionMoveEnd$, s2.activeSheet$]).pipe(
      switchMap(([l4, a4]) => {
        if (!a4)
          return of(false);
        if (l4.length === 0)
          return of(false);
        const c2 = r.getInterestGroupId(l4);
        if (e) {
          const d2 = c2.filter((u2) => e.has(u2));
          return of(d2.length > 0);
        } else
          return of(c2.length > 0);
      })
    ) : of(false))
  );
}
function Gi3(n3, e, t3) {
  return combineLatest([e, Cb2(n3, t3)]).pipe(
    map(([r, i]) => r || i)
  );
}
function ue2(n3, e = {}, t3 = false) {
  var h9;
  const i = n3.get(br).getCurrentTypeOfUnit$(we.UNIVER_SHEET), o3 = n3.get(Is), s2 = n3.has(Qe3) ? n3.get(Qe3) : null, l4 = n3.get(Tr), c2 = ((h9 = s2 == null ? void 0 : s2.visible$) != null ? h9 : of(null)).pipe(
    startWith(null),
    shareReplay(1)
  ), d2 = l4.subscribeContextValue$(EE).pipe(
    startWith(false),
    shareReplay(1)
  );
  return combineLatest([o3.currentUser$, i, c2, d2]).pipe(
    switchMap(([m9, g9, f4, p3]) => !g9 || f4 != null && f4.visible && f4.unitId === g9.getUnitId() && !t3 || p3 && !t3 ? of(true) : g9.activeSheet$.pipe(
      switchMap((v6) => {
        if (!v6)
          return of(true);
        const S = n3.get(z), w6 = n3.get(me), C = n3.get(lt3), R9 = n3.get(Tr).subscribeContextValue$(Y1).pipe(startWith(false));
        return combineLatest([S.selectionMoveEnd$, R9]).pipe(
          switchMap(([y6, E3]) => {
            if (E3)
              return of(true);
            const M10 = g9.getUnitId(), T10 = v6.getSheetId(), P8 = n3.get(aC), { workbookTypes: A4 = [Pe3], worksheetTypes: x7, rangeTypes: H6 } = e, V7 = [];
            if (A4 == null || A4.forEach((z5) => {
              V7.push(new z5(M10).id);
            }), x7 == null || x7.forEach((z5) => {
              V7.push(new z5(M10, T10).id);
            }), C.getRule(M10, T10))
              return P8.composePermission$(V7).pipe(map((z5) => z5.some((Z9) => Z9.value === false)));
            const B5 = y6 == null ? void 0 : y6.map((z5) => z5.range), F7 = w6.getSubunitRuleList(M10, T10).filter((z5) => B5 == null ? void 0 : B5.some((Z9) => z5.ranges.some((de3) => Cn.intersects(Z9, de3))));
            return H6 == null || H6.forEach((z5) => {
              F7.forEach((Z9) => {
                V7.push(new z5(M10, T10, Z9.permissionId).id);
              });
            }), P8.composePermission$(V7).pipe(map((z5) => z5.some((Z9) => Z9.value === false)));
          })
        );
      })
    ))
  );
}
function qi3(n3) {
  const e = n3.get(br), t3 = n3.get(z), r = n3.get(me), i = n3.get(aC);
  return merge(t3.selectionMoveEnd$, i.permissionPointUpdate$.pipe(debounceTime(100))).pipe(
    map(() => {
      var u2;
      const o3 = (u2 = t3.getCurrentLastSelection()) == null ? void 0 : u2.range;
      if (!o3) return true;
      const s2 = e.getCurrentUnitForType(we.UNIVER_SHEET), l4 = s2 == null ? void 0 : s2.getActiveSheet();
      if (!s2 || !l4)
        return true;
      const a4 = s2.getUnitId(), c2 = l4.getSheetId(), d2 = [new Pe3(a4).id, new Le2(a4, c2).id];
      return r.getSubunitRuleList(a4, c2).filter((h9) => h9.ranges.some((m9) => Cn.intersects(o3, m9))).forEach((h9) => {
        d2.push(new Ve4(a4, c2, h9.permissionId).id);
      }), i.composePermission(d2).some((h9) => h9.value === false);
    })
  );
}
function Af(n3, e) {
  const t3 = n3.get(br), r = n3.get(z), i = n3.get(me), o3 = n3.get(aC);
  return merge(r.selectionMoveEnd$, o3.permissionPointUpdate$.pipe(debounceTime(100))).pipe(
    map(() => {
      var h9;
      const s2 = (h9 = r.getCurrentLastSelection()) == null ? void 0 : h9.range;
      if (!s2) return true;
      const l4 = t3.getCurrentUnitForType(we.UNIVER_SHEET), a4 = l4 == null ? void 0 : l4.getActiveSheet();
      if (!l4 || !a4)
        return true;
      const c2 = l4.getUnitId(), d2 = a4.getSheetId(), u2 = [new Pe3(c2).id, new Le2(c2, d2).id];
      return i.getSubunitRuleList(c2, d2).filter((m9) => e === "row" ? m9.ranges.some((g9) => s2.startRow > g9.startRow && s2.startRow <= g9.endRow) : m9.ranges.some((g9) => s2.startColumn > g9.startColumn && s2.startColumn <= g9.endColumn)).forEach((m9) => {
        u2.push(new Ve4(c2, d2, m9.permissionId).id);
      }), o3.composePermission(u2).some((m9) => m9.value === false);
    })
  );
}
function Hf(n3, e) {
  const t3 = n3.get(br), r = n3.get(z), i = n3.get(me), o3 = n3.get(aC);
  return merge(r.selectionMoveEnd$, o3.permissionPointUpdate$.pipe(debounceTime(100))).pipe(
    map(() => {
      var m9;
      const s2 = (m9 = r.getCurrentLastSelection()) == null ? void 0 : m9.range;
      if (!s2) return true;
      const l4 = t3.getCurrentUnitForType(we.UNIVER_SHEET), a4 = l4 == null ? void 0 : l4.getActiveSheet();
      if (!l4 || !a4)
        return true;
      const c2 = l4.getUnitId(), d2 = a4.getSheetId(), u2 = [new Pe3(c2).id, new Le2(c2, d2).id], h9 = Z.deepClone(s2);
      return e === "row" ? (h9.startColumn = 0, h9.endColumn = a4.getColumnCount() - 1) : (h9.startRow = 0, h9.endRow = a4.getRowCount() - 1), i.getSubunitRuleList(c2, d2).filter((g9) => g9.ranges.some((f4) => Cn.intersects(h9, f4))).forEach((g9) => {
        u2.push(new Ve4(c2, d2, g9.permissionId).id);
      }), o3.composePermission(u2).some((g9) => g9.value === false);
    })
  );
}
function Va3(n3, e) {
  const t3 = n3.get(br), r = n3.get(z), i = n3.get(me), o3 = n3.get(aC);
  return merge(r.selectionMoveEnd$, o3.permissionPointUpdate$.pipe(debounceTime(100))).pipe(
    map(() => {
      var m9;
      const s2 = (m9 = r.getCurrentLastSelection()) == null ? void 0 : m9.range;
      if (!s2) return true;
      const l4 = t3.getCurrentUnitForType(we.UNIVER_SHEET), a4 = l4 == null ? void 0 : l4.getActiveSheet();
      if (!l4 || !a4)
        return true;
      const c2 = l4.getUnitId(), d2 = a4.getSheetId(), u2 = [new Pe3(c2).id, new Le2(c2, d2).id], h9 = Z.deepClone(s2);
      return e === "row" ? h9.endRow = a4.getRowCount() - 1 : h9.endColumn = a4.getColumnCount() - 1, i.getSubunitRuleList(c2, d2).filter((g9) => g9.ranges.some((f4) => Cn.intersects(h9, f4))).forEach((g9) => {
        u2.push(new Ve4(c2, d2, g9.permissionId).id);
      }), o3.composePermission(u2).some((g9) => g9.value === false);
    })
  );
}
function Qi3(n3, e) {
  const r = n3.get(br).getCurrentTypeOfUnit$(we.UNIVER_SHEET), i = n3.get(lt3), o3 = n3.get(me), s2 = n3.get(aC), l4 = n3.get(Is);
  return combineLatest([l4.currentUser$, r]).pipe(
    switchMap(([a4, c2]) => c2 ? c2.activeSheet$.pipe(
      switchMap((d2) => {
        if (!d2)
          return of(true);
        const u2 = c2.getUnitId(), h9 = [];
        return e.forEach((g9) => h9.push(new g9(u2).id)), s2.composePermission$(h9).pipe(map((g9) => g9.every((f4) => f4.value === true))).pipe(
          map((g9) => {
            if (!g9)
              return true;
            const f4 = d2.getSheetId(), p3 = i.getRule(u2, f4), v6 = o3.getSubunitRuleList(u2, f4);
            return !!(p3 || v6.length);
          })
        );
      })
    ) : of(true))
  );
}
function wb2(n3) {
  const e = n3.get(Ht2), t3 = ue2(n3, { workbookTypes: [Pe3], worksheetTypes: [Le2, kr2], rangeTypes: [Ve4] });
  return {
    id: Nc.id,
    icon: new Observable((r) => {
      const i = "AllBorderIcon", o3 = n3.get(Ht2), s2 = n3.get(Ds).onCommandExecuted((l4) => {
        var h9;
        if (l4.id !== Nc.id)
          return;
        const { type: c2 } = o3.getBorderInfo(), d2 = Of.find((m9) => m9.value === c2), u2 = (h9 = d2 == null ? void 0 : d2.icon) != null ? h9 : i;
        r.next(u2);
      });
      return r.next(i), s2.dispose;
    }),
    tooltip: "toolbar.border.main",
    type: H12.BUTTON_SELECTOR,
    slot: true,
    selections: [
      {
        label: {
          name: pu2,
          hoverable: false,
          selectable: false
        },
        value$: e.borderInfo$
      }
    ],
    value$: e.borderInfo$,
    hidden$: Xi(n3, we.UNIVER_SHEET),
    disabled$: t3
  };
}
var ks2 = "sheet.menu.clear-selection";
function Za4(n3) {
  return {
    id: ks2,
    type: H12.SUBITEMS,
    icon: "ClearFormatDoubleIcon",
    title: "rightClick.clearSelection",
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
function Ga2(n3) {
  return {
    id: Ys.id,
    type: H12.BUTTON,
    icon: "ClearFormatDoubleIcon",
    title: "rightClick.clearContent",
    disabled$: Gi3(n3, ue2(n3, {
      workbookTypes: [Pe3],
      worksheetTypes: [Le2, An3],
      rangeTypes: [Ve4]
    })),
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
function qa2(n3) {
  return {
    id: Hs2.id,
    type: H12.BUTTON,
    icon: "ClearFormatDoubleIcon",
    title: "rightClick.clearFormat",
    disabled$: ue2(n3, {
      workbookTypes: [Pe3],
      worksheetTypes: [Le2, kr2],
      rangeTypes: [Ve4]
    }),
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
function Is5(n3) {
  return {
    id: Ls2.id,
    type: H12.BUTTON,
    icon: "ClearFormatDoubleIcon",
    title: "rightClick.clearAll",
    tooltip: "rightClick.clearAll",
    disabled$: Gi3(n3, ue2(n3, {
      workbookTypes: [Pe3],
      worksheetTypes: [Le2, An3, kr2],
      rangeTypes: [Ve4]
    })),
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
var Vf = "sheet.menu.delete";
function bb2(n3) {
  return {
    id: Vf,
    type: H12.SUBITEMS,
    title: "rightClick.delete",
    icon: "ReduceDoubleIcon",
    hidden$: Gi3(n3, qi3(n3)),
    disabled$: ue2(n3, { workbookTypes: [Pe3], worksheetTypes: [Le2] })
  };
}
function Oh2(n3) {
  return {
    id: Oo3.id,
    type: H12.BUTTON,
    icon: "DeleteColumnDoubleIcon",
    title: "rightClick.deleteSelectedColumn",
    hidden$: Hf(n3, "col"),
    disabled$: ue2(n3, { workbookTypes: [Pe3, Zu], worksheetTypes: [Le2, pr2] })
  };
}
function Ah2(n3) {
  return {
    id: xo.id,
    type: H12.BUTTON,
    icon: "DeleteRowDoubleIcon",
    title: "rightClick.deleteSelectedRow",
    disabled$: ue2(n3, { workbookTypes: [Pe3, Qu], worksheetTypes: [Le2, wr2] }),
    hidden$: Hf(n3, "row")
  };
}
function _b2(n3) {
  return {
    id: is2.id,
    type: H12.BUTTON,
    title: "rightClick.moveLeft",
    icon: "DeleteCellShiftLeftDoubleIcon",
    disabled$: ue2(n3, { workbookTypes: [Pe3], worksheetTypes: [Le2], rangeTypes: [Ve4] }),
    hidden$: Va3(n3, "col")
  };
}
function Rb(n3) {
  return {
    id: wi3.id,
    type: H12.BUTTON,
    title: "rightClick.moveUp",
    icon: "DeleteCellShiftUpDoubleIcon",
    disabled$: ue2(n3, { workbookTypes: [Pe3], worksheetTypes: [Le2], rangeTypes: [Ve4] }),
    hidden$: Va3(n3, "row")
  };
}
function Ib2(n3, e) {
  const t3 = n3.get(z), r = n3.get(br), i = n3.get(Ds), o3 = n3.get(Tr);
  return pt3(r, e, ({ worksheet: s2 }) => new Observable((l4) => {
    const a4 = () => {
      var m9;
      let u2 = e;
      const h9 = (m9 = t3.getCurrentLastSelection()) == null ? void 0 : m9.primary;
      if (h9 != null) {
        const g9 = s2.getComposedCellStyle(h9.startRow, h9.startColumn);
        g9.fs && (u2 = g9.fs);
      }
      l4.next(u2);
    }, c2 = () => {
      var h9, m9;
      const u2 = kr4(n3);
      if (u2 != null) {
        const g9 = (m9 = (h9 = u2.ts) == null ? void 0 : h9.fs) != null ? m9 : e;
        l4.next(g9);
      }
    }, d2 = i.onCommandExecuted((u2) => {
      const h9 = u2.id;
      (h9 === ee2.id || h9 === ie5.id || h9 === pn.id) && a4(), (h9 === k.id || h9 === yt.id) && o3.getContextValue(pE) && o3.getContextValue(_r) && c2();
    });
    return a4(), d2.dispose;
  }));
}
function yb2(n3) {
  const e = rt.fs, t3 = ue2(n3, {
    workbookTypes: [Pe3],
    worksheetTypes: [Le2, kr2],
    rangeTypes: [Ve4]
  }, true);
  return {
    id: fa2.id,
    type: H12.SELECTOR,
    tooltip: "toolbar.fontSize",
    label: {
      name: $5,
      props: {
        min: 6,
        max: 400,
        disabled$: t3
      }
    },
    selections: Qi,
    disabled$: t3,
    value$: Ib2(n3, e),
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
function Mb2(n3) {
  const e = ue2(n3, {
    workbookTypes: [Pe3],
    worksheetTypes: [Le2, kr2],
    rangeTypes: [Ve4]
  }, true);
  return {
    id: tu2.id,
    type: H12.BUTTON,
    icon: "FontSizeIncreaseIcon",
    tooltip: "toolbar.fontSizeIncrease",
    disabled$: e,
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
function Eb(n3) {
  const e = ue2(n3, {
    workbookTypes: [Pe3],
    worksheetTypes: [Le2, kr2],
    rangeTypes: [Ve4]
  }, true);
  return {
    id: nu3.id,
    type: H12.BUTTON,
    icon: "FontSizeReduceIcon",
    tooltip: "toolbar.fontSizeDecrease",
    disabled$: e,
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
function Tb2(n3) {
  const e = n3.get(Ds), t3 = n3.get(br);
  return {
    id: Cd.id,
    type: H12.BUTTON,
    tooltip: "toolbar.toggleGridlines",
    icon: "HideGridlinesDoubleIcon",
    activated$: new Observable((r) => {
      const i = () => {
        const s2 = t3.getCurrentUnitForType(we.UNIVER_SHEET);
        return s2 ? s2.getActiveSheet().getConfig().showGridlines === ie.TRUE : false;
      }, o3 = new ho();
      return o3.add(e.onCommandExecuted((s2) => {
        (s2.id === Xt2.id || s2.id === pn.id) && r.next(i());
      })), o3.add(t3.getCurrentTypeOfUnit$(we.UNIVER_SHEET).subscribe(() => {
        r.next(i());
      })), r.next(i()), () => o3.dispose();
    }),
    disabled$: ue2(n3, { workbookTypes: [Pe3], worksheetTypes: [Le2] })
  };
}
var pn2 = `${xf}_MENU_ITEM_INPUT_COMPONENT`;
var Nf = (n3) => {
  const {
    prefix: e,
    suffix: t3,
    value: r,
    min: i = Number.MIN_SAFE_INTEGER,
    max: o3 = Number.MAX_SAFE_INTEGER,
    disabled$: s2,
    onChange: l4
  } = n3, a4 = useDependency(Hn), c2 = useDependency(l3), [d2, u2] = (0, import_react.useState)(false), [h9, m9] = (0, import_react.useState)(), g9 = (p3) => {
    if (!p3) {
      m9(i.toString());
      return;
    }
    const v6 = p3.toString();
    m9(v6), l4(v6);
  };
  (0, import_react.useEffect)(() => {
    if (!s2)
      return;
    const p3 = s2.subscribe((v6) => {
      u2(v6);
    });
    return () => {
      p3.unsubscribe();
    };
  }, []), (0, import_react.useEffect)(() => {
    c2.visible || m9(r);
  }, [c2.visible]), (0, import_react.useEffect)(() => {
    +r < i ? m9(i.toString()) : +r > o3 ? m9(o3.toString()) : m9(r);
  }, [r]);
  function f4() {
    h9 && l4(h9);
  }
  return (0, import_jsx_runtime.jsxs)("div", { className: "univer-inline-flex univer-items-center univer-gap-1", children: [
    a4.t(e),
    (0, import_jsx_runtime.jsx)("div", { className: "univer-w-16", onClick: (p3) => p3.stopPropagation(), children: (0, import_jsx_runtime.jsx)(
      TE,
      {
        value: Number(h9),
        size: "mini",
        precision: 0,
        min: i,
        max: o3,
        disabled: d2,
        onPressEnter: f4,
        onChange: g9
      }
    ) }),
    a4.t(t3)
  ] });
};
var kf = "sheet.menu.cell-insert";
function Pb(n3) {
  return {
    id: kf,
    type: H12.SUBITEMS,
    title: "rightClick.insert",
    icon: "InsertDoubleIcon",
    hidden$: Gi3(n3, qi3(n3)),
    disabled$: ue2(n3, { workbookTypes: [Pe3, tl, nl], worksheetTypes: [Mr, yr2, Le2], rangeTypes: [Ve4] })
  };
}
function xb(n3) {
  const e = n3.get(br), t3 = n3.get(z), r = n3.get(Ds), i = 1, o3 = ue2(n3, {
    workbookTypes: [Pe3, nl],
    worksheetTypes: [yr2, Le2],
    rangeTypes: [Ve4]
  });
  return {
    id: ol.id,
    type: H12.BUTTON,
    icon: "InsertRowAboveDoubleIcon",
    label: {
      name: pn2,
      props: {
        prefix: "rightClick.insertRowsAbove",
        min: 1,
        max: 1e3,
        suffix: "rightClick.insertRowsAboveSuffix",
        disabled$: o3
      }
    },
    value$: pt3(e, i, () => new Observable((s2) => {
      function l4() {
        var u2;
        const c2 = (u2 = t3.getCurrentLastSelection()) == null ? void 0 : u2.range;
        let d2 = i;
        c2 && (d2 = (c2 == null ? void 0 : c2.endRow) - (c2 == null ? void 0 : c2.startRow) + 1), s2.next(d2);
      }
      const a4 = r.onCommandExecuted((c2) => {
        if (c2.id === ie5.id)
          return l4();
      });
      return l4(), a4.dispose;
    })),
    disabled$: o3,
    hidden$: Af(n3, "row")
  };
}
function Ob2(n3) {
  const e = n3.get(br), t3 = n3.get(z), r = n3.get(Ds), i = 1, o3 = ue2(n3, {
    workbookTypes: [Pe3, tl],
    worksheetTypes: [Mr, Le2],
    rangeTypes: [Ve4]
  });
  return {
    id: ul.id,
    type: H12.BUTTON,
    icon: "LeftInsertColumnDoubleIcon",
    label: {
      name: pn2,
      props: {
        prefix: "rightClick.insertColsLeft",
        min: 1,
        max: 1e3,
        suffix: "rightClick.insertColsLeftSuffix",
        disabled$: o3
      }
    },
    value$: pt3(e, i, () => new Observable((s2) => {
      function l4() {
        var u2;
        const c2 = (u2 = t3.getCurrentLastSelection()) == null ? void 0 : u2.range;
        let d2 = i;
        c2 && (d2 = (c2 == null ? void 0 : c2.endColumn) - (c2 == null ? void 0 : c2.startColumn) + 1), s2.next(d2);
      }
      const a4 = r.onCommandExecuted((c2) => {
        if (c2.id === ie5.id)
          return l4();
      });
      return l4(), a4.dispose;
    })),
    disabled$: o3,
    hidden$: Af(n3, "col")
  };
}
function Ab2(n3) {
  return {
    id: os2.id,
    type: H12.BUTTON,
    title: "rightClick.moveRight",
    icon: "InsertCellShiftRightDoubleIcon",
    disabled$: ue2(n3, {
      workbookTypes: [Pe3],
      worksheetTypes: [Le2],
      rangeTypes: [Ve4]
    }),
    hidden$: Va3(n3, "col")
  };
}
function Hb2(n3) {
  return {
    id: bi4.id,
    type: H12.BUTTON,
    title: "rightClick.moveDown",
    icon: "InsertCellDownDoubleIcon",
    disabled$: ue2(n3, {
      workbookTypes: [Pe3],
      worksheetTypes: [Le2],
      rangeTypes: [Ve4]
    }),
    hidden$: Va3(n3, "row")
  };
}
function Vb(n3) {
  const e = n3.get(br), t3 = n3.get(z), r = n3.get(Ds), i = 1, o3 = ue2(n3, {
    workbookTypes: [Pe3, nl],
    worksheetTypes: [yr2, Le2],
    rangeTypes: [Ve4]
  });
  return {
    id: al.id,
    type: H12.BUTTON,
    icon: "InsertRowBelowDoubleIcon",
    label: {
      name: pn2,
      props: {
        prefix: "rightClick.insertRowsAfter",
        min: 1,
        max: 1e3,
        suffix: "rightClick.insertRowsAfterSuffix",
        disabled$: o3
      }
    },
    value$: pt3(e, i, () => new Observable((s2) => {
      function l4() {
        var u2;
        const c2 = (u2 = t3.getCurrentLastSelection()) == null ? void 0 : u2.range;
        let d2 = i;
        c2 && (d2 = (c2 == null ? void 0 : c2.endRow) - (c2 == null ? void 0 : c2.startRow) + 1), s2.next(d2);
      }
      const a4 = r.onCommandExecuted((c2) => {
        if (c2.id === ie5.id)
          return l4();
      });
      return l4(), a4.dispose;
    })),
    disabled$: o3,
    hidden$: qi3(n3)
  };
}
function Nb2(n3) {
  const e = n3.get(br), t3 = n3.get(z), r = n3.get(Ds), i = 1, o3 = ue2(n3, {
    workbookTypes: [Pe3, nl],
    worksheetTypes: [yr2, Le2],
    rangeTypes: [Ve4]
  });
  return {
    id: il.id,
    type: H12.BUTTON,
    icon: "InsertRowAboveDoubleIcon",
    label: {
      name: pn2,
      props: {
        prefix: "rightClick.insertRowsAbove",
        min: 1,
        max: 1e3,
        suffix: "rightClick.insertRowsAboveSuffix",
        disabled$: o3
      }
    },
    value$: pt3(e, i, () => new Observable((s2) => {
      function l4() {
        var u2;
        const c2 = (u2 = t3.getCurrentLastSelection()) == null ? void 0 : u2.range;
        let d2 = i;
        c2 && (d2 = (c2 == null ? void 0 : c2.endRow) - (c2 == null ? void 0 : c2.startRow) + 1), s2.next(d2);
      }
      const a4 = r.onCommandExecuted((c2) => {
        if (c2.id === ie5.id)
          return l4();
      });
      return l4(), a4.dispose;
    })),
    disabled$: o3,
    hidden$: qi3(n3)
  };
}
function kb3(n3) {
  const e = n3.get(br), t3 = n3.get(z), r = n3.get(Ds), i = 1, o3 = ue2(n3, {
    workbookTypes: [Pe3, tl],
    worksheetTypes: [Mr, Le2],
    rangeTypes: [Ve4]
  });
  return {
    id: cl.id,
    type: H12.BUTTON,
    icon: "LeftInsertColumnDoubleIcon",
    label: {
      name: pn2,
      props: {
        prefix: "rightClick.insertColsLeft",
        min: 1,
        max: 1e3,
        suffix: "rightClick.insertColsLeftSuffix",
        disabled$: o3
      }
    },
    value$: pt3(e, i, () => new Observable((s2) => {
      function l4() {
        var u2;
        const c2 = (u2 = t3.getCurrentLastSelection()) == null ? void 0 : u2.range;
        let d2 = i;
        c2 && (d2 = (c2 == null ? void 0 : c2.endColumn) - (c2 == null ? void 0 : c2.startColumn) + 1), s2.next(d2);
      }
      const a4 = r.onCommandExecuted((c2) => {
        if (c2.id === ie5.id)
          return l4();
      });
      return l4(), a4.dispose;
    })),
    disabled$: o3,
    hidden$: qi3(n3)
  };
}
function Db2(n3) {
  const e = n3.get(br), t3 = n3.get(z), r = n3.get(Ds), i = 1, o3 = ue2(n3, {
    workbookTypes: [Pe3, tl],
    worksheetTypes: [Mr, Le2],
    rangeTypes: [Ve4]
  });
  return {
    id: dl.id,
    type: H12.BUTTON,
    icon: "RightInsertColumnDoubleIcon",
    label: {
      name: pn2,
      props: {
        prefix: "rightClick.insertColsRight",
        min: 1,
        max: 1e3,
        suffix: "rightClick.insertColsRightSuffix",
        disabled$: o3
      }
    },
    value$: pt3(e, i, () => new Observable((s2) => {
      function l4() {
        var u2;
        const c2 = (u2 = t3.getCurrentLastSelection()) == null ? void 0 : u2.range;
        let d2 = i;
        c2 && (d2 = (c2 == null ? void 0 : c2.endColumn) - (c2 == null ? void 0 : c2.startColumn) + 1), s2.next(d2);
      }
      const a4 = r.onCommandExecuted((c2) => {
        if (c2.id === ie5.id)
          return l4();
      });
      return l4(), a4.dispose;
    })),
    disabled$: o3,
    hidden$: qi3(n3)
  };
}
var Lb = ((n3) => (n3.ROW_HEADER_CONTEXT_MENU = "ROW_HEADER_CONTEXT_MENU", n3.COL_HEADER_CONTEXT_MENU = "COL_HEADER_CONTEXT_MENU", n3.SHEET_BAR = "SHEET_BAR", n3.SHEET_FOOTER = "SHEET_FOOTER", n3))(Lb || {});
function Wb2(n3) {
  const e = n3.get(Nn);
  return {
    id: ss2.id,
    subId: iu2.id,
    type: H12.BUTTON,
    icon: "BrushIcon",
    title: "Format Painter",
    tooltip: "toolbar.formatPainter",
    activated$: new Observable((t3) => {
      let r = false;
      const i = e.status$.subscribe((o3) => {
        r = o3 !== zt2.OFF, t3.next(r);
      });
      return t3.next(r), () => {
        i.unsubscribe();
      };
    }),
    hidden$: Xi(n3, we.UNIVER_SHEET),
    disabled$: ue2(n3, { workbookTypes: [Pe3], worksheetTypes: [Cr, Le2], rangeTypes: [Ve4] }, true)
  };
}
function Bb2(n3) {
  const e = n3.get(Ds), t3 = n3.get(br), r = n3.get(Tr), i = n3.get(z);
  return {
    id: zi2.id,
    type: H12.BUTTON,
    icon: "BoldIcon",
    title: "Set bold",
    tooltip: "toolbar.bold",
    disabled$: ue2(n3, { workbookTypes: [Pe3], worksheetTypes: [Le2, kr2], rangeTypes: [Ve4] }, true),
    activated$: pt3(t3, false, ({ worksheet: o3 }) => new Observable((s2) => {
      var d2;
      const l4 = e.onCommandExecuted((u2) => {
        var m9, g9;
        const h9 = u2.id;
        if (h9 === ee2.id || h9 === ie5.id || h9 === pn.id) {
          const f4 = (m9 = i.getCurrentLastSelection()) == null ? void 0 : m9.primary;
          let p3 = bi.NORMAL;
          if (f4 != null) {
            const v6 = o3.getRange(f4.startRow, f4.startColumn);
            p3 = v6 == null ? void 0 : v6.getFontWeight();
          }
          s2.next(p3 === bi.BOLD);
        }
        if ((h9 === k.id || h9 === yt.id) && r.getContextValue(pE) && r.getContextValue(_r)) {
          const f4 = kr4(n3);
          if (f4 == null)
            return;
          const p3 = (g9 = f4.ts) == null ? void 0 : g9.bl;
          s2.next(p3 === ie.TRUE);
        }
      }), a4 = (d2 = i.getCurrentLastSelection()) == null ? void 0 : d2.primary;
      if (!o3) {
        s2.next(false);
        return;
      }
      let c2 = bi.NORMAL;
      if (a4 != null) {
        const u2 = o3.getRange(a4.startRow, a4.startColumn);
        c2 = u2 == null ? void 0 : u2.getFontWeight();
      }
      return s2.next(c2 === bi.BOLD), l4.dispose;
    })),
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
function Fb2(n3) {
  const e = n3.get(Ds), t3 = n3.get(br), r = n3.get(z), i = n3.get(Tr);
  return {
    id: ji3.id,
    type: H12.BUTTON,
    icon: "ItalicIcon",
    title: "Set italic",
    tooltip: "toolbar.italic",
    disabled$: ue2(
      n3,
      {
        workbookTypes: [Pe3],
        worksheetTypes: [Le2, kr2],
        rangeTypes: [Ve4]
      },
      true
    ),
    activated$: pt3(t3, false, ({ worksheet: o3 }) => new Observable((s2) => {
      var d2;
      const l4 = e.onCommandExecuted((u2) => {
        var m9, g9;
        const h9 = u2.id;
        if (h9 === ee2.id || h9 === ie5.id || h9 === pn.id) {
          const f4 = (m9 = r.getCurrentLastSelection()) == null ? void 0 : m9.primary;
          let p3 = vi.NORMAL;
          if (f4 != null) {
            const v6 = o3.getRange(f4.startRow, f4.startColumn);
            p3 = v6 == null ? void 0 : v6.getFontStyle();
          }
          s2.next(p3 === vi.ITALIC);
        }
        if ((h9 === k.id || h9 === yt.id) && i.getContextValue(pE) && i.getContextValue(_r)) {
          const f4 = kr4(n3);
          if (f4 == null) return;
          const p3 = (g9 = f4.ts) == null ? void 0 : g9.it;
          s2.next(p3 === ie.TRUE);
        }
      }), a4 = (d2 = r.getCurrentLastSelection()) == null ? void 0 : d2.primary;
      let c2 = vi.NORMAL;
      if (a4 != null) {
        const u2 = o3.getRange(a4.startRow, a4.startColumn);
        c2 = u2 == null ? void 0 : u2.getFontStyle();
      }
      return s2.next(c2 === vi.ITALIC), l4.dispose;
    })),
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
function Ub(n3) {
  const e = n3.get(Ds), t3 = n3.get(br), r = n3.get(z), i = n3.get(Tr);
  return {
    id: Yi2.id,
    type: H12.BUTTON,
    icon: "UnderlineIcon",
    title: "Set underline",
    tooltip: "toolbar.underline",
    activated$: pt3(t3, false, ({ worksheet: o3 }) => new Observable((s2) => {
      var d2;
      const l4 = e.onCommandExecuted((u2) => {
        var m9, g9;
        const h9 = u2.id;
        if (h9 === ee2.id || h9 === ie5.id || h9 === pn.id) {
          const f4 = (m9 = r.getCurrentLastSelection()) == null ? void 0 : m9.primary;
          let p3;
          if (f4 != null) {
            const v6 = o3.getRange(f4.startRow, f4.startColumn);
            p3 = v6 == null ? void 0 : v6.getUnderline();
          }
          s2.next(!!(p3 && p3.s));
        }
        if ((h9 === k.id || h9 === yt.id) && i.getContextValue(pE) && i.getContextValue(_r)) {
          const f4 = kr4(n3);
          if (f4 == null) return;
          const p3 = (g9 = f4.ts) == null ? void 0 : g9.ul;
          s2.next((p3 == null ? void 0 : p3.s) === ie.TRUE);
        }
      }), a4 = (d2 = r.getCurrentLastSelection()) == null ? void 0 : d2.primary;
      let c2;
      if (a4 != null) {
        const u2 = o3.getRange(a4.startRow, a4.startColumn);
        c2 = u2 == null ? void 0 : u2.getUnderline();
      }
      return s2.next(!!(c2 && c2.s)), l4.dispose;
    })),
    disabled$: ue2(n3, {
      workbookTypes: [Pe3],
      worksheetTypes: [Le2, kr2],
      rangeTypes: [Ve4]
    }, true),
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
function Xb(n3) {
  const e = n3.get(Ds), t3 = n3.get(br), r = n3.get(z), i = n3.get(Tr);
  return {
    id: Zi2.id,
    type: H12.BUTTON,
    icon: "StrikethroughIcon",
    title: "Set strike through",
    tooltip: "toolbar.strikethrough",
    disabled$: ue2(n3, {
      workbookTypes: [Pe3],
      worksheetTypes: [Le2, kr2],
      rangeTypes: [Ve4]
    }, true),
    activated$: pt3(t3, false, ({ worksheet: o3 }) => new Observable((s2) => {
      var d2;
      const l4 = e.onCommandExecuted((u2) => {
        var m9, g9;
        const h9 = u2.id;
        if (h9 === ee2.id || h9 === ie5.id || h9 === pn.id) {
          const f4 = (m9 = r.getCurrentLastSelection()) == null ? void 0 : m9.primary;
          let p3;
          if (f4 != null) {
            const v6 = o3.getRange(f4.startRow, f4.startColumn);
            p3 = v6 == null ? void 0 : v6.getStrikeThrough();
          }
          s2.next(!!(p3 && p3.s));
        }
        if ((h9 === k.id || h9 === yt.id) && i.getContextValue(pE) && i.getContextValue(_r)) {
          const f4 = kr4(n3);
          if (f4 == null)
            return;
          const p3 = (g9 = f4.ts) == null ? void 0 : g9.st;
          s2.next((p3 == null ? void 0 : p3.s) === ie.TRUE);
        }
      }), a4 = (d2 = r.getCurrentLastSelection()) == null ? void 0 : d2.primary;
      let c2;
      if (a4 != null) {
        const u2 = o3.getRange(a4.startRow, a4.startColumn);
        c2 = u2 == null ? void 0 : u2.getStrikeThrough();
      }
      return s2.next(!!(c2 && c2.s)), l4.dispose;
    })),
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
function zb2(n3) {
  const e = n3.get(Ds), t3 = n3.get(br), r = n3.get(z), i = rt.ff;
  return {
    id: Eo2.id,
    tooltip: "toolbar.font",
    type: H12.SELECTOR,
    label: R5,
    selections: [{
      label: {
        name: V5,
        hoverable: false,
        selectable: false,
        props: {
          id: Eo2.id
        }
      }
    }],
    disabled$: ue2(n3, {
      workbookTypes: [Pe3],
      worksheetTypes: [Le2, kr2],
      rangeTypes: [Ve4]
    }, true),
    value$: pt3(t3, i, ({ worksheet: o3 }) => new Observable((s2) => {
      const l4 = () => {
        var u2;
        let c2 = i;
        const d2 = (u2 = r.getCurrentLastSelection()) == null ? void 0 : u2.primary;
        if (d2 != null) {
          const h9 = o3.getCellStyle(d2.startRow, d2.startColumn), m9 = o3.getDefaultCellStyleInternal(), g9 = o3.getRowStyle(d2.startRow), f4 = o3.getColumnStyle(d2.startColumn), p3 = Dr(m9, g9, f4, h9);
          p3.ff && (c2 = p3.ff);
        }
        s2.next(c2);
      }, a4 = e.onCommandExecuted((c2) => {
        const d2 = c2.id;
        (d2 === ee2.id || d2 === ie5.id || d2 === pn.id) && l4();
      });
      return l4(), a4.dispose;
    })),
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
function jb2(n3) {
  return {
    id: ru3.id,
    type: H12.BUTTON,
    title: "toolbar.resetColor",
    icon: "NoColorDoubleIcon",
    disabled$: ue2(n3, {
      workbookTypes: [Pe3],
      worksheetTypes: [Le2, kr2],
      rangeTypes: [Ve4]
    }, true),
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
function Yb2(n3) {
  const e = n3.get(Ds), t3 = n3.get(Ji), r = n3.get(z);
  return {
    id: To2.id,
    icon: "FontColorDoubleIcon",
    tooltip: "toolbar.textColor.main",
    type: H12.BUTTON_SELECTOR,
    selections: [
      {
        label: {
          name: _5,
          hoverable: false,
          selectable: false
        },
        value$: new Observable((i) => {
          var a4;
          const o3 = rt.cl.rgb, { isAllValuesSame: s2, value: l4 } = r.getCellStylesProperty("cl");
          s2 ? i.next((a4 = l4 == null ? void 0 : l4.rgb) != null ? a4 : o3) : i.next(o3);
        })
      }
    ],
    value$: new Observable((i) => {
      const o3 = t3.getColorFromTheme("gray.900"), s2 = e.onCommandExecuted((l4) => {
        if (l4.id === To2.id) {
          const a4 = l4.params.value;
          i.next(a4 != null ? a4 : o3);
        }
      });
      return i.next(o3), s2.dispose;
    }),
    hidden$: Xi(n3, we.UNIVER_SHEET),
    disabled$: ue2(n3, {
      workbookTypes: [Pe3],
      worksheetTypes: [Le2, kr2],
      rangeTypes: [Ve4]
    }, true)
  };
}
function Zb(n3) {
  return {
    id: Kc3.id,
    type: H12.BUTTON,
    title: "toolbar.resetColor",
    icon: "NoColorDoubleIcon",
    disabled$: ue2(n3, {
      workbookTypes: [Pe3],
      worksheetTypes: [Le2, kr2],
      rangeTypes: [Ve4]
    })
  };
}
function Gb(n3) {
  const e = n3.get(Ds), t3 = n3.get(Ji), r = n3.get(z);
  return {
    id: Gc.id,
    tooltip: "toolbar.fillColor.main",
    type: H12.BUTTON_SELECTOR,
    icon: "PaintBucketDoubleIcon",
    selections: [
      {
        label: {
          name: _5,
          hoverable: false,
          selectable: false
        },
        value$: new Observable((i) => {
          var a4;
          const o3 = rt.bg.rgb, { isAllValuesSame: s2, value: l4 } = r.getCellStylesProperty("bg");
          s2 ? i.next((a4 = l4 == null ? void 0 : l4.rgb) != null ? a4 : o3) : i.next(o3);
        })
      }
    ],
    value$: new Observable((i) => {
      const o3 = t3.getColorFromTheme("primary.600"), s2 = e.onCommandExecuted((l4) => {
        if (l4.id === Gc.id) {
          const a4 = l4.params.value;
          i.next(a4 != null ? a4 : o3);
        }
      });
      return i.next(o3), s2.dispose;
    }),
    hidden$: Xi(n3, we.UNIVER_SHEET),
    disabled$: ue2(n3, {
      workbookTypes: [Pe3],
      worksheetTypes: [Le2, kr2],
      rangeTypes: [Ve4]
    })
  };
}
var Hh2 = [
  {
    label: "align.left",
    icon: "LeftJustifyingIcon",
    value: Pt.LEFT
  },
  {
    label: "align.center",
    icon: "HorizontallyIcon",
    value: Pt.CENTER
  },
  {
    label: "align.right",
    icon: "RightJustifyingIcon",
    value: Pt.RIGHT
  }
];
function qb(n3) {
  var s2, l4;
  const e = n3.get(br), t3 = n3.get(z), r = e.getCurrentUnitOfType(we.UNIVER_SHEET), i = r == null ? void 0 : r.getActiveSheet().getDefaultCellStyleInternal(), o3 = (s2 = i == null ? void 0 : i.ht) != null ? s2 : Pt.LEFT;
  return {
    id: qc2.id,
    icon: (l4 = Hh2.find((a4) => a4.value === o3)) == null ? void 0 : l4.icon,
    tooltip: "toolbar.horizontalAlignMode.main",
    type: H12.SELECTOR,
    selections: Hh2,
    value$: pt3(e, o3, ({ worksheet: a4 }) => new Observable((c2) => {
      var m9, g9;
      const d2 = n3.get(Ds).onCommandExecuted((f4) => {
        var w6, C;
        const p3 = f4.id;
        if (p3 !== qc2.id && p3 !== ie5.id && p3 !== pn.id)
          return;
        const v6 = (w6 = t3.getCurrentLastSelection()) == null ? void 0 : w6.primary;
        let S;
        if (v6 != null) {
          const I6 = a4.getRange(v6.startRow, v6.startColumn), R9 = r == null ? void 0 : r.getActiveSheet().getComposedCellStyle(v6.startRow, v6.startColumn);
          S = (C = R9 == null ? void 0 : R9.ht) != null ? C : I6 == null ? void 0 : I6.getHorizontalAlignment();
        }
        c2.next(S != null ? S : o3);
      }), u2 = (m9 = t3.getCurrentLastSelection()) == null ? void 0 : m9.primary;
      let h9;
      if (u2 != null) {
        const f4 = a4.getRange(u2.startRow, u2.startColumn), p3 = r == null ? void 0 : r.getActiveSheet().getComposedCellStyle(u2.startRow, u2.startColumn);
        h9 = (g9 = p3 == null ? void 0 : p3.ht) != null ? g9 : f4 == null ? void 0 : f4.getHorizontalAlignment();
      }
      return c2.next(h9 != null ? h9 : o3), d2.dispose;
    })),
    hidden$: Xi(n3, we.UNIVER_SHEET),
    disabled$: ue2(n3, {
      workbookTypes: [Pe3],
      worksheetTypes: [Le2, kr2],
      rangeTypes: [Ve4]
    })
  };
}
var Vh2 = [
  {
    label: "align.top",
    icon: "AlignTopIcon",
    value: Dn.TOP
  },
  {
    label: "align.middle",
    icon: "VerticalCenterIcon",
    value: Dn.MIDDLE
  },
  {
    label: "align.bottom",
    icon: "AlignBottomIcon",
    value: Dn.BOTTOM
  }
];
function Qb2(n3) {
  var s2, l4;
  const e = n3.get(br), t3 = n3.get(z), r = e.getCurrentUnitOfType(we.UNIVER_SHEET), i = r == null ? void 0 : r.getActiveSheet().getDefaultCellStyleInternal(), o3 = (s2 = i == null ? void 0 : i.vt) != null ? s2 : Dn.BOTTOM;
  return {
    id: Jc2.id,
    icon: (l4 = Vh2.find((a4) => a4.value === o3)) == null ? void 0 : l4.icon,
    tooltip: "toolbar.verticalAlignMode.main",
    type: H12.SELECTOR,
    selections: Vh2,
    value$: pt3(e, o3, ({ worksheet: a4 }) => new Observable((c2) => {
      var m9, g9;
      const d2 = n3.get(Ds).onCommandExecuted((f4) => {
        var w6, C;
        const p3 = f4.id;
        if (p3 !== Jc2.id && p3 !== ie5.id && p3 !== pn.id)
          return;
        const v6 = (w6 = t3.getCurrentLastSelection()) == null ? void 0 : w6.primary;
        let S;
        if (v6 != null) {
          const I6 = a4.getRange(v6.startRow, v6.startColumn), R9 = r == null ? void 0 : r.getActiveSheet().getComposedCellStyle(v6.startRow, v6.startColumn);
          S = (C = R9 == null ? void 0 : R9.vt) != null ? C : I6 == null ? void 0 : I6.getVerticalAlignment();
        }
        c2.next(S != null ? S : o3);
      }), u2 = (m9 = t3.getCurrentLastSelection()) == null ? void 0 : m9.primary;
      let h9;
      if (u2 != null) {
        const f4 = a4.getRange(u2.startRow, u2.startColumn), p3 = r == null ? void 0 : r.getActiveSheet().getComposedCellStyle(u2.startRow, u2.startColumn);
        h9 = (g9 = p3 == null ? void 0 : p3.vt) != null ? g9 : f4 == null ? void 0 : f4.getVerticalAlignment();
      }
      return c2.next(h9 != null ? h9 : o3), d2.dispose;
    })),
    hidden$: Xi(n3, we.UNIVER_SHEET),
    disabled$: ue2(n3, {
      workbookTypes: [Pe3],
      worksheetTypes: [Le2, kr2],
      rangeTypes: [Ve4]
    })
  };
}
var Nh2 = [
  {
    label: "textWrap.overflow",
    icon: "OverflowIcon",
    value: jn.OVERFLOW
  },
  {
    label: "textWrap.wrap",
    icon: "AutowrapIcon",
    value: jn.WRAP
  },
  {
    label: "textWrap.clip",
    icon: "TruncationIcon",
    value: jn.CLIP
  }
];
function Kb(n3) {
  var s2, l4;
  const e = n3.get(z), t3 = n3.get(br), r = t3.getCurrentUnitOfType(we.UNIVER_SHEET), i = r == null ? void 0 : r.getActiveSheet().getDefaultCellStyleInternal(), o3 = (s2 = i == null ? void 0 : i.tb) != null ? s2 : jn.OVERFLOW;
  return {
    id: Yc2.id,
    tooltip: "toolbar.textWrapMode.main",
    icon: (l4 = Nh2.find((a4) => a4.value === o3)) == null ? void 0 : l4.icon,
    type: H12.SELECTOR,
    selections: Nh2,
    value$: pt3(t3, o3, ({ worksheet: a4 }) => new Observable((c2) => {
      var m9, g9;
      const d2 = n3.get(Ds).onCommandExecuted((f4) => {
        var w6, C;
        const p3 = f4.id;
        if (p3 !== Yc2.id && p3 !== ie5.id && p3 !== pn.id)
          return;
        const v6 = (w6 = e.getCurrentLastSelection()) == null ? void 0 : w6.primary;
        let S;
        if (v6 != null) {
          const I6 = a4.getRange(v6.startRow, v6.startColumn), R9 = r == null ? void 0 : r.getActiveSheet().getComposedCellStyle(v6.startRow, v6.startColumn);
          S = (C = R9 == null ? void 0 : R9.tb) != null ? C : I6 == null ? void 0 : I6.getWrapStrategy();
        }
        c2.next(S != null ? S : o3);
      }), u2 = (m9 = e.getCurrentLastSelection()) == null ? void 0 : m9.primary;
      let h9;
      if (u2 != null) {
        const f4 = a4.getRange(u2.startRow, u2.startColumn), p3 = r == null ? void 0 : r.getActiveSheet().getComposedCellStyle(u2.startRow, u2.startColumn);
        h9 = (g9 = p3 == null ? void 0 : p3.tb) != null ? g9 : f4 == null ? void 0 : f4.getWrapStrategy();
      }
      return c2.next(h9 != null ? h9 : o3), d2.dispose;
    })),
    hidden$: Xi(n3, we.UNIVER_SHEET),
    disabled$: ue2(n3, {
      workbookTypes: [Pe3],
      worksheetTypes: [Le2, kr2],
      rangeTypes: [Ve4]
    })
  };
}
var kh2 = [
  {
    label: "textRotate.none",
    icon: "NoRotationIcon",
    value: 0
  },
  {
    label: "textRotate.angleUp",
    icon: "LeftRotationFortyFiveDegreesIcon",
    value: -45
  },
  {
    label: "textRotate.angleDown",
    icon: "RightRotationFortyFiveDegreesIcon",
    value: 45
  },
  {
    label: "textRotate.vertical",
    icon: "VerticalTextIcon",
    value: "v"
  },
  {
    label: "textRotate.rotationUp",
    icon: "LeftRotationNinetyDegreesIcon",
    value: -90
  },
  {
    label: "textRotate.rotationDown",
    icon: "RightRotationNinetyDegreesIcon",
    value: 90
  }
];
function Jb(n3) {
  const e = n3.get(z), t3 = n3.get(br), r = 0;
  return {
    id: Xc2.id,
    tooltip: "toolbar.textRotateMode.main",
    icon: kh2[0].icon,
    type: H12.SELECTOR,
    selections: kh2,
    value$: pt3(t3, r, ({ worksheet: i }) => new Observable((o3) => {
      var c2, d2;
      const s2 = n3.get(Ds).onCommandExecuted((u2) => {
        var f4, p3;
        const h9 = u2.id;
        if (h9 !== Xc2.id && h9 !== ie5.id && h9 !== pn.id)
          return;
        const m9 = (f4 = e.getCurrentLastSelection()) == null ? void 0 : f4.primary;
        let g9;
        if (m9 != null) {
          const v6 = i.getRange(m9.startRow, m9.startColumn);
          g9 = v6 == null ? void 0 : v6.getTextRotation();
        }
        (g9 == null ? void 0 : g9.v) === ie.TRUE ? o3.next("v") : o3.next((p3 = g9 && g9.a) != null ? p3 : r);
      }), l4 = (c2 = e.getCurrentLastSelection()) == null ? void 0 : c2.primary;
      let a4;
      if (l4 != null) {
        const u2 = i.getRange(l4.startRow, l4.startColumn);
        a4 = u2 == null ? void 0 : u2.getTextRotation();
      }
      return (a4 == null ? void 0 : a4.v) === ie.TRUE ? o3.next("v") : o3.next((d2 = a4 && a4.a) != null ? d2 : r), s2.dispose;
    })),
    hidden$: Xi(n3, we.UNIVER_SHEET),
    disabled$: ue2(n3, {
      workbookTypes: [Pe3],
      worksheetTypes: [Le2, kr2],
      rangeTypes: [Ve4]
    })
  };
}
function hs2(n3) {
  return new Observable((t3) => t3.next(!n3.get(ar2).supportClipboard));
}
function gi3(n3) {
  return {
    id: dn2.name,
    commandId: dn2.id,
    type: H12.BUTTON,
    title: "rightClick.copy",
    icon: "CopyDoubleIcon",
    disabled$: ue2(n3, {
      workbookTypes: [ir4],
      worksheetTypes: [Cr],
      rangeTypes: [Bs2]
    }),
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
function Qa3(n3) {
  return {
    id: un2.name,
    commandId: un2.id,
    type: H12.BUTTON,
    title: "rightClick.paste",
    icon: "PasteSpecialDoubleIcon",
    disabled$: hs2(n3).pipe(
      combineLatestWith(ue2(n3, {
        rangeTypes: [Ve4],
        worksheetTypes: [Le2, kr2, An3],
        workbookTypes: [Pe3]
      })),
      map(([e, t3]) => e || t3)
    ),
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
var Ds2 = "sheet.menu.paste-special";
function Ka2(n3) {
  return {
    id: Ds2,
    type: H12.SUBITEMS,
    icon: "PasteSpecialDoubleIcon",
    title: "rightClick.pasteSpecial",
    hidden$: Gi3(n3, Xi(n3, we.UNIVER_SHEET))
  };
}
function Ja3(n3) {
  return {
    id: po3.id,
    type: H12.BUTTON,
    title: "rightClick.pasteValue",
    disabled$: hs2(n3).pipe(
      combineLatestWith(ue2(n3, {
        rangeTypes: [Ve4],
        worksheetTypes: [An3, Le2],
        workbookTypes: [Pe3]
      })),
      map(([e, t3]) => e || t3)
    ),
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
function $a4(n3) {
  return {
    id: vo3.id,
    type: H12.BUTTON,
    title: "rightClick.pasteFormat",
    disabled$: hs2(n3).pipe(
      combineLatestWith(ue2(n3, {
        rangeTypes: [Ve4],
        worksheetTypes: [kr2, Le2],
        workbookTypes: [Pe3]
      })),
      map(([e, t3]) => e || t3)
    ),
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
function ec2(n3) {
  return {
    id: li2.id,
    type: H12.BUTTON,
    title: "rightClick.pasteColWidth",
    disabled$: hs2(n3).pipe(
      combineLatestWith(ue2(n3, {
        rangeTypes: [Ve4],
        worksheetTypes: [Zt3, Le2],
        workbookTypes: [Pe3]
      })),
      map(([e, t3]) => e || t3)
    )
  };
}
function tc2(n3) {
  return {
    id: So4.id,
    type: H12.BUTTON,
    title: "rightClick.pasteBesidesBorder",
    disabled$: hs2(n3).pipe(
      combineLatestWith(ue2(n3, {
        rangeTypes: [Ve4],
        worksheetTypes: [
          Le2,
          kr2,
          An3,
          Qt3,
          Zt3
        ],
        workbookTypes: [Pe3]
      })),
      map(([e, t3]) => e || t3)
    ),
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
function $b2(n3) {
  return {
    id: no.id,
    type: H12.BUTTON,
    icon: "AutoHeightDoubleIcon",
    title: "rightClick.fitContent",
    disabled$: ue2(n3, {
      workbookTypes: [Pe3],
      worksheetTypes: [Qt3, Le2],
      rangeTypes: [Ve4]
    }),
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
function e_(n3) {
  return {
    id: ls2.id,
    type: H12.BUTTON,
    icon: "AutoWidthDoubleIcon",
    title: "rightClick.fitContent",
    disabled$: ue2(n3, {
      workbookTypes: [Pe3],
      worksheetTypes: [Qt3, Le2],
      rangeTypes: [Ve4]
    }),
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
var Df = "sheet.menu.sheet-frozen";
function t_(n3) {
  return {
    id: Df,
    type: H12.SUBITEMS,
    title: "rightClick.freeze",
    icon: "FreezeToSelectedIcon",
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
var $c2 = "sheet.header-menu.sheet-frozen";
function Dh2(n3) {
  return {
    id: $c2,
    type: H12.SUBITEMS,
    title: "rightClick.freeze",
    icon: "FreezeToSelectedIcon",
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
function nc2(n3) {
  return {
    id: Jn4.id,
    type: H12.BUTTON,
    title: "rightClick.freeze",
    icon: "FreezeToSelectedIcon",
    // disabled$: getCurrentRangeDisable$(accessor, { workbookTypes: [WorkbookEditablePermission], worksheetTypes: [WorksheetEditPermission], rangeTypes: [RangeProtectionPermissionEditPoint] }),
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
function n_(n3) {
  return {
    id: Ia2.id,
    type: H12.BUTTON,
    title: "rightClick.freezeRow",
    icon: "FreezeRowIcon",
    // disabled$: getCurrentRangeDisable$(accessor, { workbookTypes: [WorkbookEditablePermission], worksheetTypes: [WorksheetEditPermission], rangeTypes: [RangeProtectionPermissionEditPoint] }),
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
function r_(n3) {
  return {
    id: ya2.id,
    type: H12.BUTTON,
    title: "rightClick.freezeCol",
    icon: "FreezeColumnIcon",
    // disabled$: getCurrentRangeDisable$(accessor, { workbookTypes: [WorkbookEditablePermission], worksheetTypes: [WorksheetEditPermission], rangeTypes: [RangeProtectionPermissionEditPoint] }),
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
function rc2(n3) {
  return {
    id: $c.id,
    type: H12.BUTTON,
    title: "rightClick.cancelFreeze",
    icon: "CancelFreezeIcon",
    // disabled$: getCurrentRangeDisable$(accessor, { workbookTypes: [WorkbookEditablePermission], worksheetTypes: [WorksheetEditPermission], rangeTypes: [RangeProtectionPermissionEditPoint] }),
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
function i_(n3) {
  return {
    id: ga3.id,
    type: H12.BUTTON,
    icon: "HideDoubleIcon",
    title: "rightClick.hideSelectedRow",
    disabled$: ue2(n3, {
      workbookTypes: [Pe3],
      worksheetTypes: [Qt3, Le2],
      rangeTypes: [Ve4]
    }),
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
function o_(n3) {
  return {
    id: ma4.id,
    type: H12.BUTTON,
    icon: "HideDoubleIcon",
    title: "rightClick.hideSelectedColumn",
    disabled$: ue2(n3, {
      workbookTypes: [Pe3],
      worksheetTypes: [Le2, Zt3],
      rangeTypes: [Ve4]
    }),
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
function s_(n3) {
  const e = n3.get(br), t3 = n3.get(z), r = n3.get(Ds), i = [ie5, Tt, Ut2].map((o3) => o3.id);
  return {
    id: oi.id,
    type: H12.BUTTON,
    icon: "EyeOutlineIcon",
    title: "rightClick.showHideRow",
    hidden$: pt3(e, true, ({ worksheet: o3 }) => new Observable((s2) => {
      function l4() {
        var d2;
        const c2 = (d2 = t3.getCurrentSelections()) == null ? void 0 : d2.map((u2) => u2.range).filter((u2) => u2.rangeType === ge.ROW);
        return !!(c2 != null && c2.some((u2) => {
          for (let h9 = u2.startRow; h9 <= u2.endRow; h9++)
            if (!o3.getRowRawVisible(h9)) return true;
          return false;
        }));
      }
      const a4 = r.onCommandExecuted((c2) => {
        i.findIndex((d2) => d2 === c2.id) !== -1 && s2.next(!l4());
      });
      return s2.next(!l4()), () => a4.dispose();
    })),
    disabled$: ue2(n3, {
      workbookTypes: [Pe3],
      worksheetTypes: [Le2, Qt3],
      rangeTypes: [Ve4]
    })
  };
}
function l_(n3) {
  const e = n3.get(br), t3 = n3.get(z), r = n3.get(Ds), i = [ie5, sn, on].map((o3) => o3.id);
  return {
    id: ei.id,
    type: H12.BUTTON,
    icon: "EyeOutlineIcon",
    title: "rightClick.showHideColumn",
    hidden$: pt3(e, true, ({ worksheet: o3 }) => new Observable((s2) => {
      function l4() {
        var d2;
        const c2 = (d2 = t3.getCurrentSelections()) == null ? void 0 : d2.map((u2) => u2.range).filter((u2) => u2.rangeType === ge.COLUMN);
        return !c2 || c2.length === 0 ? false : !!c2.some((u2) => {
          for (let h9 = u2.startColumn; h9 <= u2.endColumn; h9++)
            if (!o3.getColVisible(h9)) return true;
          return false;
        });
      }
      const a4 = r.onCommandExecuted((c2) => {
        i.findIndex((d2) => d2 === c2.id) !== -1 && s2.next(!l4());
      });
      return s2.next(!l4()), () => a4.dispose();
    })),
    disabled$: ue2(n3, {
      workbookTypes: [Pe3],
      worksheetTypes: [Zt3, Le2],
      rangeTypes: [Ve4]
    })
  };
}
function a_(n3) {
  const e = n3.get(Ds), t3 = n3.get(br), r = n3.get(z), i = 2;
  return {
    id: Kn.id,
    type: H12.BUTTON,
    icon: "AdjustHeightDoubleIcon",
    label: {
      name: pn2,
      props: {
        prefix: "rightClick.rowHeight",
        suffix: "px",
        min: i,
        max: 1e3
      }
    },
    value$: pt3(t3, i, ({ worksheet: o3 }) => new Observable((s2) => {
      function l4() {
        var u2;
        const c2 = (u2 = r.getCurrentLastSelection()) == null ? void 0 : u2.primary, d2 = c2 ? o3.getRowHeight(c2.startRow) : o3.getConfig().defaultRowHeight;
        s2.next(d2);
      }
      const a4 = e.onCommandExecuted((c2) => {
        const d2 = c2.id;
        if (d2 === ee2.id || d2 === ie5.id || d2 === Fe3.id)
          return l4();
      });
      return l4(), a4.dispose;
    })),
    hidden$: ue2(n3, {
      workbookTypes: [Pe3],
      worksheetTypes: [Le2, Qt3],
      rangeTypes: [Ve4]
    })
  };
}
function c_(n3) {
  const e = n3.get(Ds), t3 = n3.get(br), r = n3.get(z), i = 2;
  return {
    id: Bn4.id,
    type: H12.BUTTON,
    icon: "AdjustWidthDoubleIcon",
    label: {
      name: pn2,
      props: {
        prefix: "rightClick.columnWidth",
        suffix: "px",
        min: i,
        max: 1e3
      }
    },
    value$: pt3(t3, i, ({ worksheet: o3 }) => new Observable((s2) => {
      function l4() {
        var u2;
        const c2 = (u2 = r.getCurrentLastSelection()) == null ? void 0 : u2.primary, d2 = c2 ? o3.getColumnWidth(c2.startColumn) : o3.getConfig().defaultColumnWidth;
        s2.next(d2);
      }
      const a4 = e.onCommandExecuted((c2) => {
        const d2 = c2.id;
        if (d2 === ee2.id || d2 === ie5.id || d2 === mt2.id)
          return l4();
      });
      return l4(), a4.dispose;
    })),
    hidden$: ue2(n3, {
      workbookTypes: [Pe3],
      worksheetTypes: [Le2, Zt3],
      rangeTypes: [Ve4]
    })
  };
}
var sr4 = {
  type: Ls.COMMAND,
  id: "sheet.command.add-worksheet-merge",
  handler: (n3, e) => __async(void 0, null, function* () {
    const t3 = n3.get(Ds), r = n3.get(ra), i = n3.get(br), o3 = n3.get(at), s2 = n3.get(Hn), l4 = e.unitId, a4 = e.subUnitId, c2 = e.selections, d2 = Jr3(c2, e.value), u2 = i.getUniverSheetInstance(l4).getSheetBySheetId(a4), h9 = [], m9 = [], g9 = Ym(u2, d2);
    if (g9 && !e.defaultMerge && !(yield o3.confirm({
      id: "merge.confirm.add-worksheet-merge",
      title: {
        title: "merge.confirm.warning"
      },
      children: {
        title: "merge.confirm.title"
      },
      cancelText: s2.t("merge.confirm.cancel"),
      confirmText: s2.t("merge.confirm.confirm")
    })))
      return false;
    const f4 = {
      unitId: l4,
      subUnitId: a4,
      ranges: Z.deepClone(d2)
    }, p3 = {
      unitId: l4,
      subUnitId: a4,
      ranges: Z.deepClone(d2)
    }, v6 = ye3(n3, f4), S = We3(n3, p3);
    if (v6.ranges.length > 0 && h9.push({ id: se2.id, params: v6 }), h9.push({ id: ne.id, params: p3 }), m9.push({ id: se2.id, params: S }), v6.ranges.length > 0 && m9.push({ id: ne.id, params: v6 }), g9) {
      const E3 = Zm2(n3, l4, u2, d2);
      h9.unshift(...E3.redos), m9.push(...E3.undos);
    }
    const w6 = hg(n3, e, d2);
    w6 && h9.push(w6);
    const C = gg2(n3, e);
    C && m9.push(C);
    const R9 = n3.get(G).onCommandExecute({
      id: sr4.id,
      params: { unitId: l4, subUnitId: a4, ranges: d2 }
    });
    return h9.push(...R9.redos), m9.push(...R9.undos), po(h9, t3).result ? (r.pushUndoRedo({
      unitID: l4,
      undoMutations: m9,
      redoMutations: h9
    }), true) : false;
  })
};
var vu2 = {
  type: Ls.COMMAND,
  id: "sheet.command.add-worksheet-merge-all",
  handler: (n3) => __async(void 0, null, function* () {
    var d2;
    const e = n3.get(Ds), r = (d2 = n3.get(z).getCurrentSelections()) == null ? void 0 : d2.map((u2) => u2.range), i = eu2(ha2.MergeAll, r);
    if (!(i != null && i.length))
      return false;
    const s2 = n3.get(br).getCurrentUnitForType(we.UNIVER_SHEET);
    if (!s2) return false;
    const l4 = s2.getActiveSheet();
    if (!l4) return false;
    const a4 = s2.getUnitId(), c2 = l4.getSheetId();
    return e.executeCommand(sr4.id, {
      selections: i,
      unitId: a4,
      subUnitId: c2
    });
  })
};
var Su2 = {
  type: Ls.COMMAND,
  id: "sheet.command.add-worksheet-merge-vertical",
  handler: (n3) => __async(void 0, null, function* () {
    var d2;
    const e = n3.get(Ds), r = (d2 = n3.get(z).getCurrentSelections()) == null ? void 0 : d2.map((u2) => u2.range), i = eu2(ha2.MergeVertical, r);
    if (!(i != null && i.length))
      return false;
    const s2 = n3.get(br).getCurrentUnitForType(we.UNIVER_SHEET);
    if (!s2) return false;
    const l4 = s2.getActiveSheet();
    if (!l4) return false;
    const a4 = s2.getUnitId(), c2 = l4.getSheetId();
    return e.executeCommand(sr4.id, {
      value: Im.COLUMNS,
      selections: i,
      unitId: a4,
      subUnitId: c2
    });
  })
};
var Cu2 = {
  type: Ls.COMMAND,
  id: "sheet.command.add-worksheet-merge-horizontal",
  handler: (n3) => __async(void 0, null, function* () {
    var d2;
    const e = n3.get(Ds), r = (d2 = n3.get(z).getCurrentSelections()) == null ? void 0 : d2.map((u2) => u2.range), i = eu2(ha2.MergeHorizontal, r);
    if (!(i != null && i.length))
      return false;
    const s2 = n3.get(br).getCurrentUnitForType(we.UNIVER_SHEET);
    if (!s2) return false;
    const l4 = s2.getActiveSheet();
    if (!l4) return false;
    const a4 = s2.getUnitId(), c2 = l4.getSheetId();
    return e.executeCommand(sr4.id, {
      value: Im.ROWS,
      selections: i,
      unitId: a4,
      subUnitId: c2
    });
  })
};
function d_(n3) {
  const e = n3.get(z), t3 = n3.get(me), r = n3.get(br), i = n3.get(Vn), o3 = r.getCurrentTypeOfUnit$(we.UNIVER_SHEET);
  return combineLatest([
    e.selectionMoveEnd$,
    o3.pipe(map((s2) => {
      var l4;
      return (l4 = s2 == null ? void 0 : s2.getUnitId()) != null ? l4 : "";
    })),
    o3.pipe(switchMap((s2) => {
      var l4;
      return (l4 = s2 == null ? void 0 : s2.activeSheet$) != null ? l4 : of(null);
    }))
  ]).pipe(
    map(([s2, l4, a4]) => {
      if (!a4 || !s2 || s2.length === 0) return false;
      const c2 = a4.getSheetId(), d2 = s2.map((m9) => m9.range);
      if (i.interceptor.fetchThroughInterceptors(Ql)(false, d2))
        return true;
      const h9 = t3.getSubunitRuleList(l4, c2).map((m9) => m9.ranges).flat();
      if (s2.length < 2) {
        const m9 = s2[0].range;
        return h9.some((f4) => Cn.intersects(f4, m9) && !Cn.contains(f4, m9));
      }
      for (let m9 = 0; m9 < s2.length; m9++)
        for (let g9 = m9 + 1; g9 < s2.length; g9++)
          if (Cn.intersects(s2[m9].range, s2[g9].range))
            return true;
      return false;
    })
  );
}
function Lf(n3, e) {
  return !!fl3(n3, e, ge.ROW);
}
function Wf(n3, e) {
  return !!fl3(n3, e, ge.COLUMN);
}
function fl3(n3, e, t3) {
  return n3.find((i) => {
    const o3 = i.range, { startRow: s2, endRow: l4, startColumn: a4, endColumn: c2, rangeType: d2 } = o3;
    return d2 === ge.ALL || d2 === ge.NORMAL ? false : d2 === t3 && (t3 === ge.COLUMN && a4 <= e && e <= c2 || t3 === ge.ROW && s2 <= e && e <= l4);
  });
}
function u_(n3) {
  const e = Gi3(n3, ue2(n3, { workbookTypes: [Pe3], worksheetTypes: [Le2, An3, kr2], rangeTypes: [Ve4] })), t3 = d_(n3);
  return {
    id: sr4.id,
    icon: "MergeAllIcon",
    tooltip: "toolbar.mergeCell.main",
    type: H12.SUBITEMS,
    // selections: [...MERGE_CHILDREN],
    hidden$: Xi(n3, we.UNIVER_SHEET),
    disabled$: e.pipe(
      combineLatestWith(t3),
      map(([r, i]) => r || i)
    )
  };
}
function h_(n3) {
  return {
    id: vu2.id,
    type: H12.BUTTON,
    title: "merge.all",
    icon: "MergeAllIcon",
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
function g_(n3) {
  return {
    id: Su2.id,
    type: H12.BUTTON,
    title: "merge.vertical",
    icon: "VerticalIntegrationIcon",
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
function m_(n3) {
  return {
    id: Cu2.id,
    type: H12.BUTTON,
    title: "merge.horizontal",
    icon: "HorizontalMergeIcon",
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
function f_(n3) {
  return {
    id: Ic.id,
    type: H12.BUTTON,
    title: "merge.cancel",
    icon: "CancelMergeIcon",
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
function p_(n3) {
  const t3 = n3.get(br).getCurrentTypeOfUnit$(we.UNIVER_SHEET), r = n3.get(Is);
  return combineLatest([t3, r.currentUser$]).pipe(
    switchMap(([i, o3]) => i ? i.activeSheet$.pipe(
      switchMap((s2) => {
        if (!s2)
          return of(true);
        const l4 = n3.get(me), a4 = n3.get(lt3), c2 = n3.get(z);
        return merge(
          c2.selectionMoveEnd$,
          l4.ruleChange$,
          a4.ruleChange$
        ).pipe(
          map(() => {
            const d2 = i.getUnitId(), u2 = s2.getSheetId(), h9 = l4.getSubunitRuleList(d2, u2), m9 = c2.getCurrentSelections(), g9 = m9 == null ? void 0 : m9.map((v6) => v6.range), f4 = h9.map((v6) => v6.ranges).flat();
            if (!g9)
              return false;
            const p3 = a4.getRule(d2, u2);
            return p3 != null && p3.permissionId ? true : g9 == null ? void 0 : g9.some((v6) => f4.some((S) => Cn.intersects(v6, S)));
          })
        );
      })
    ) : of(true))
  );
}
function v_(n3) {
  const e = n3.get(br), t3 = n3.get(me), r = e.getCurrentTypeOfUnit$(we.UNIVER_SHEET), i = n3.get(Is);
  return combineLatest([r, i.currentUser$]).pipe(
    switchMap(([o3, s2]) => o3 ? o3.activeSheet$.pipe(
      switchMap((l4) => {
        if (!l4)
          return of(true);
        const a4 = n3.get(me), c2 = n3.get(lt3), d2 = n3.get(aC), u2 = n3.get(z);
        return merge(
          u2.selectionMoveEnd$,
          a4.ruleChange$,
          c2.ruleChange$
        ).pipe(
          map(() => {
            var E3, M10;
            const h9 = o3.getUnitId(), m9 = l4.getSheetId(), g9 = t3.getSubunitRuleList(h9, m9), f4 = (E3 = u2.getCurrentSelections()) == null ? void 0 : E3.map((T10) => T10.range);
            if (g9.map((T10) => T10.ranges).flat(), !(f4 != null && f4.length) || f4.length > 1)
              return true;
            const p3 = f4[0];
            if ((p3 == null ? void 0 : p3.rangeType) === ge.ALL || (p3 == null ? void 0 : p3.rangeType) === ge.COLUMN || (p3 == null ? void 0 : p3.rangeType) === ge.ROW)
              return true;
            const v6 = c2.getRule(h9, m9);
            if (v6 != null && v6.permissionId)
              return ((M10 = d2.getPermissionPoint(new br4(h9, m9).id)) == null ? void 0 : M10.value) === false;
            if (g9.filter((T10) => T10.ranges.some((P8) => Cn.intersects(P8, p3))).length !== 1)
              return true;
            const { startRow: w6, endRow: C, startColumn: I6, endColumn: R9 } = p3, y6 = n3.get(Wt2);
            for (let T10 = w6; T10 <= C; T10++)
              for (let P8 = I6; P8 <= R9; P8++) {
                const A4 = y6.getCellInfo(h9, m9, T10, P8);
                if (A4)
                  return A4[_.ManageCollaborator] === false;
              }
            return false;
          })
        );
      })
    ) : of(true))
  );
}
function S_(n3) {
  const e = n3.get(br), t3 = n3.get(aC), r = e.getCurrentTypeOfUnit$(we.UNIVER_SHEET), i = n3.get(Is);
  return combineLatest([r, i.currentUser$]).pipe(
    switchMap(([o3, s2]) => o3 ? o3.activeSheet$.pipe(
      switchMap((l4) => {
        var g9;
        if (!l4)
          return of(true);
        const a4 = o3.getUnitId(), c2 = n3.get(z), d2 = n3.get(me), u2 = n3.get(lt3), h9 = (g9 = t3.composePermission$([new Pe3(a4).id]).pipe(map((f4) => f4.every((p3) => p3.value)))) != null ? g9 : of(false), m9 = merge(
          d2.ruleChange$,
          u2.ruleChange$
        ).pipe(
          startWith(null)
        );
        return combineLatest([h9, m9, c2.selectionMoveEnd$]).pipe(
          map(([f4, p3, v6]) => {
            if (!f4)
              return true;
            const S = c2.getCurrentSelections(), w6 = S == null ? void 0 : S.map((C) => C.range);
            return w6 != null && w6.length ? w6.length > 1 : false;
          })
        );
      })
    ) : of(true))
  );
}
function Bf2(n3) {
  var c2;
  const e = n3.get(br), t3 = n3.get(aC), r = e.getCurrentTypeOfUnit$(we.UNIVER_SHEET), i = n3.get(Is), o3 = n3.has(Qe3) ? n3.get(Qe3) : null, l4 = n3.get(Tr).subscribeContextValue$(EE).pipe(
    startWith(false),
    shareReplay(1)
  ), a4 = (c2 = o3 == null ? void 0 : o3.visible$.pipe(
    startWith(null),
    shareReplay(1)
  )) != null ? c2 : of(null);
  return combineLatest([r, i.currentUser$, a4, l4]).pipe(
    switchMap(([d2, u2, h9, m9]) => !d2 || h9 != null && h9.visible && h9.unitId === d2.getUnitId() || m9 ? of(true) : d2.activeSheet$.pipe(
      switchMap((g9) => {
        var E3;
        if (!g9)
          return of(true);
        const p3 = n3.get(Tr).subscribeContextValue$(Y1).pipe(startWith(false)), v6 = d2.getUnitId(), S = g9.getSheetId(), w6 = n3.get(me), C = n3.get(lt3), I6 = n3.get(z), R9 = (E3 = t3.composePermission$([new ar3(v6).id]).pipe(map((M10) => M10.every((T10) => T10.value)))) != null ? E3 : of(false), y6 = merge(
          w6.ruleChange$,
          C.ruleChange$
        ).pipe(
          startWith(null)
        );
        return combineLatest([R9, y6, I6.selectionMoveEnd$, p3]).pipe(
          map(([M10, T10, P8, A4]) => {
            if (!M10 || A4)
              return true;
            const x7 = I6.getCurrentSelections(), H6 = x7 == null ? void 0 : x7.map((F7) => F7.range);
            if (!(H6 != null && H6.length))
              return true;
            const V7 = C.getRule(v6, S);
            if (V7 != null && V7.permissionId)
              return true;
            const D5 = w6.getSubunitRuleList(v6, S);
            return H6 == null ? void 0 : H6.some((F7) => D5.some((z5) => z5.ranges.some((Z9) => Cn.intersects(F7, Z9))));
          })
        );
      })
    ))
  );
}
function C_(n3) {
  const e = n3.get(br), t3 = n3.get(aC), r = e.getCurrentTypeOfUnit$(we.UNIVER_SHEET), i = n3.get(Is);
  return combineLatest([r, i.currentUser$]).pipe(
    switchMap(([o3, s2]) => o3 ? o3.activeSheet$.pipe(
      switchMap((l4) => {
        var g9;
        if (!l4)
          return of(true);
        const a4 = o3.getUnitId(), c2 = l4.getSheetId(), d2 = n3.get(me), u2 = n3.get(lt3), h9 = (g9 = t3.composePermission$([new ar3(a4).id]).pipe(map((f4) => f4.every((p3) => p3.value)))) != null ? g9 : of(false), m9 = merge(
          d2.ruleChange$,
          u2.ruleChange$
        ).pipe(
          startWith(null)
        );
        return combineLatest([h9, m9]).pipe(
          map(([f4, p3]) => {
            var w6;
            if (!f4) return true;
            const v6 = u2.getRule(a4, c2);
            return v6 != null && v6.permissionId ? true : ((w6 = d2.getSubunitRuleList(a4, c2)) == null ? void 0 : w6.filter((C) => C == null ? void 0 : C.permissionId)).length > 0;
          })
        );
      })
    ) : of(true))
  );
}
function w_(n3) {
  const e = n3.get(br), t3 = n3.get(aC), r = e.getCurrentTypeOfUnit$(we.UNIVER_SHEET), i = n3.get(Is);
  return combineLatest([r, i.currentUser$]).pipe(
    switchMap(([o3, s2]) => o3 ? o3.activeSheet$.pipe(
      switchMap((l4) => {
        if (!l4)
          return of(true);
        const a4 = o3.getUnitId(), c2 = l4.getSheetId(), d2 = n3.get(lt3);
        return d2.ruleChange$.pipe(startWith(null)).pipe(
          map(() => {
            var h9;
            return d2.getRule(a4, c2) ? ((h9 = t3.getPermissionPoint(new Sr2(a4, c2).id)) == null ? void 0 : h9.value) === false : true;
          })
        );
      })
    ) : of(true))
  );
}
function b_(n3) {
  const e = n3.get(br), t3 = n3.get(aC), r = e.getCurrentTypeOfUnit$(we.UNIVER_SHEET), i = n3.get(Is);
  return combineLatest([r, i.currentUser$]).pipe(
    switchMap(([o3, s2]) => o3 ? o3.activeSheet$.pipe(
      switchMap((l4) => {
        var g9;
        if (!l4)
          return of(true);
        const a4 = o3.getUnitId(), c2 = n3.get(me), d2 = n3.get(lt3), u2 = (g9 = t3.composePermission$([new ar3(a4).id, new zs(a4).id]).pipe(map((f4) => f4.every((p3) => p3.value)))) != null ? g9 : of(false), h9 = d2.ruleChange$.pipe(startWith(null)), m9 = c2.ruleChange$.pipe(startWith(null));
        return combineLatest([u2, h9, m9]).pipe(
          map(([f4, p3, v6]) => {
            if (!f4)
              return true;
            const S = l4.getSheetId(), w6 = d2.getRule(a4, S), C = c2.getSubunitRuleList(a4, S);
            return !(w6 || C.length);
          })
        );
      })
    ) : of(true))
  );
}
function __(n3) {
  const e = n3.get(br), t3 = n3.get(aC), r = e.getCurrentTypeOfUnit$(we.UNIVER_SHEET), i = n3.get(Is);
  return combineLatest([r, i.currentUser$]).pipe(
    switchMap(([o3, s2]) => o3 ? o3.activeSheet$.pipe(
      switchMap((l4) => {
        if (!l4)
          return of(true);
        const a4 = o3.getUnitId(), c2 = l4.getSheetId(), d2 = n3.get(z), u2 = n3.get(me), h9 = n3.get(lt3), m9 = merge(
          u2.ruleChange$,
          h9.ruleChange$,
          d2.selectionMoveEnd$
        ).pipe(startWith(null));
        return combineLatest([m9]).pipe(
          map(([g9]) => {
            var M10;
            const f4 = n3.get(z).getCurrentSelections(), p3 = f4 == null ? void 0 : f4.map((T10) => T10.range);
            if (!(p3 != null && p3.length) || p3.length > 1)
              return true;
            const v6 = p3[0];
            if ((v6 == null ? void 0 : v6.rangeType) === ge.ALL || (v6 == null ? void 0 : v6.rangeType) === ge.COLUMN || (v6 == null ? void 0 : v6.rangeType) === ge.ROW)
              return true;
            const S = h9.getRule(a4, c2);
            if (S != null && S.permissionId)
              return ((M10 = t3.getPermissionPoint(new Sr2(a4, c2).id)) == null ? void 0 : M10.value) === false;
            if (u2.getSubunitRuleList(a4, c2).filter((T10) => T10.ranges.some((P8) => Cn.intersects(P8, v6))).length !== 1)
              return true;
            const { startRow: C, endRow: I6, startColumn: R9, endColumn: y6 } = v6, E3 = n3.get(Wt2);
            for (let T10 = C; T10 <= I6; T10++)
              for (let P8 = R9; P8 <= y6; P8++) {
                const A4 = E3.getCellInfo(a4, c2, T10, P8);
                if (A4)
                  return A4[_.Delete] === false;
              }
            return false;
          })
        );
      })
    ) : of(true))
  );
}
function Ff(n3) {
  var c2;
  const e = n3.get(br), t3 = n3.get(aC), r = e.getCurrentTypeOfUnit$(we.UNIVER_SHEET), i = n3.get(Is), o3 = n3.has(Qe3) ? n3.get(Qe3) : null, l4 = n3.get(Tr).subscribeContextValue$(EE), a4 = (c2 = o3 == null ? void 0 : o3.visible$) != null ? c2 : of(null);
  return combineLatest([r, i.currentUser$, a4, l4]).pipe(
    switchMap(([d2, u2, h9, m9]) => !d2 || h9 != null && h9.visible && h9.unitId === d2.getUnitId() || m9 ? of(true) : d2.activeSheet$.pipe(
      switchMap((g9) => {
        var v6, S;
        if (!g9)
          return of(true);
        const f4 = d2.getUnitId();
        return ((S = (v6 = t3.getPermissionPoint$(new Pe3(f4).id)) == null ? void 0 : v6.pipe(map((w6) => !!w6.value))) != null ? S : of(false)).pipe(
          map((w6) => !w6)
        );
      })
    ))
  );
}
var Ls3 = "sheet.contextMenu.permission";
function R_(n3) {
  return {
    id: va3.id,
    type: H12.BUTTON,
    icon: Fm,
    tooltip: "permission.toolbarMenu",
    hidden$: Xi(n3, we.UNIVER_SHEET),
    disabled$: Bf2(n3)
  };
}
function ic2(n3) {
  return {
    id: Ls3,
    type: H12.SUBITEMS,
    title: "rightClick.protectRange",
    icon: Um,
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
function oc2(n3) {
  return {
    id: ai2.id,
    type: H12.BUTTON,
    title: "rightClick.turnOnProtectRange",
    hidden$: p_(n3),
    disabled$: Bf2(n3)
  };
}
function sc2(n3) {
  return {
    id: ui2.id,
    type: H12.BUTTON,
    title: "rightClick.editProtectRange",
    disabled$: S_(n3),
    hidden$: v_(n3)
  };
}
function lc2(n3) {
  return {
    id: di2.id,
    type: H12.BUTTON,
    title: "rightClick.removeProtectRange",
    disabled$: __(n3),
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
function ac2(n3) {
  return {
    id: ci2.id,
    type: H12.BUTTON,
    title: "rightClick.viewAllProtectArea",
    disabled$: Ff(n3),
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
function I_(n3) {
  return {
    id: Sa4.id,
    type: H12.BUTTON,
    title: "sheetConfig.addProtectSheet",
    disabled$: C_(n3),
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
function y_(n3) {
  return {
    id: Ta4.id,
    type: H12.BUTTON,
    title: "sheetConfig.removeProtectSheet",
    disabled$: w_(n3),
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
function M_(n3) {
  return {
    id: Pa4.id,
    type: H12.BUTTON,
    title: "sheetConfig.changeSheetPermission",
    disabled$: b_(n3),
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
function E_(n3) {
  return {
    id: Ca4.id,
    type: H12.BUTTON,
    title: "sheetConfig.viewAllProtectArea",
    disabled$: Ff(n3),
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
function T_(n3) {
  const e = n3.get(br), t3 = n3.get(Ds), r = new Observable((o3) => {
    const s2 = t3.onCommandExecuted((l4) => {
      const a4 = l4.id;
      (a4 === Lt2.id || a4 === ln.id || a4 === St2.id) && pl2(e, o3);
    });
    return pl2(e, o3), s2.dispose;
  }), i = Qi3(n3, [Pe3, lr2]);
  return {
    id: ba4.id,
    type: H12.BUTTON,
    title: "sheetConfig.delete",
    disabled$: combineLatest([r, i]).pipe(
      map(([o3, s2]) => o3 || s2)
    ),
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
function P_(n3) {
  return {
    id: gc.id,
    type: H12.BUTTON,
    title: "sheetConfig.copy",
    disabled$: Qi3(n3, [Pe3, ur2]),
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
function x_(n3) {
  return {
    id: Oa3.id,
    type: H12.BUTTON,
    title: "sheetConfig.rename",
    disabled$: Qi3(n3, [Pe3, Ks]),
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
function O_(n3) {
  return {
    id: Qc.id,
    title: "sheetConfig.changeColor",
    type: H12.SELECTOR,
    selections: [
      {
        label: {
          name: _5,
          hoverable: false
        }
      }
    ],
    hidden$: Qi3(n3, [Pe3])
  };
}
function A_(n3) {
  const e = n3.get(br), t3 = n3.get(Ds);
  return {
    id: sd2.id,
    type: H12.BUTTON,
    title: "sheetConfig.hide",
    disabled$: new Observable((r) => {
      const i = t3.onCommandExecuted((o3) => {
        const s2 = o3.id;
        (s2 === Lt2.id || s2 === ln.id || s2 === St2.id) && pl2(e, r);
      });
      return pl2(e, r), i.dispose;
    }).pipe(
      combineLatestWith(Qi3(n3, [Pe3, js2])),
      map(([r, i]) => r || i)
    ),
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
function H_(n3) {
  const e = n3.get(br), t3 = n3.get(Ds);
  return {
    id: Ea4.id,
    type: H12.BUTTON,
    title: "sheetConfig.unhide",
    disabled$: new Observable((r) => {
      function i() {
        const s2 = e.getCurrentUnitForType(we.UNIVER_SHEET).getWorksheets(), l4 = Array.from(s2.values());
        r.next(l4.length === 1);
      }
      const o3 = t3.onCommandExecuted((s2) => {
        const l4 = s2.id;
        (l4 === Lt2.id || l4 === ln.id || l4 === St2.id) && i();
      });
      return i(), o3.dispose;
    }).pipe(
      combineLatestWith(Qi3(n3, [Pe3, js2])),
      map(([r, i]) => r || i)
    ),
    hidden$: Xi(n3, we.UNIVER_SHEET)
  };
}
function pl2(n3, e) {
  const t3 = n3.getCurrentUnitForType(we.UNIVER_SHEET).getWorksheets(), r = Array.from(t3.values()).filter(
    (i) => i.getConfig().hidden === ie.FALSE
  );
  e.next(r.length === 1);
}
var V_ = {
  [_1.START]: {
    [Y12.HISTORY]: {
      [ss2.id]: {
        order: 2,
        menuItemFactory: Wb2
      },
      [Ls2.id]: {
        order: 3,
        menuItemFactory: Is5
      }
    },
    [Y12.FORMAT]: {
      [Eo2.id]: {
        order: 1,
        menuItemFactory: zb2
      },
      [fa2.id]: {
        order: 2,
        menuItemFactory: yb2
      },
      [tu2.id]: {
        order: 2.1,
        menuItemFactory: Mb2
      },
      [nu3.id]: {
        order: 2.2,
        menuItemFactory: Eb
      },
      [zi2.id]: {
        order: 5,
        menuItemFactory: Bb2
      },
      [ji3.id]: {
        order: 6,
        menuItemFactory: Fb2
      },
      [Yi2.id]: {
        order: 7,
        menuItemFactory: Ub
      },
      [Zi2.id]: {
        order: 8,
        menuItemFactory: Xb
      },
      [To2.id]: {
        order: 9,
        menuItemFactory: Yb2,
        [zc2.id]: {
          order: 0,
          menuItemFactory: jb2
        }
      },
      [Gc.id]: {
        order: 10,
        menuItemFactory: Gb,
        [Kc3.id]: {
          order: 0,
          menuItemFactory: Zb
        }
      },
      [Nc.id]: {
        order: 11,
        menuItemFactory: wb2
      }
    },
    [Y12.LAYOUT]: {
      [qc2.id]: {
        order: 0,
        menuItemFactory: qb
      },
      [Jc2.id]: {
        order: 3,
        menuItemFactory: Qb2
      },
      [Yc2.id]: {
        order: 6,
        menuItemFactory: Kb
      },
      [Xc2.id]: {
        order: 7,
        menuItemFactory: Jb
      },
      [ms.id]: {
        order: 8,
        menuItemFactory: u_,
        [Yh.id]: {
          order: 0,
          menuItemFactory: h_
        },
        [Xh.id]: {
          order: 1,
          menuItemFactory: g_
        },
        [Zh.id]: {
          order: 2,
          menuItemFactory: m_
        },
        [Ic.id]: {
          order: 3,
          menuItemFactory: f_
        }
      }
    },
    [Y12.OTHERS]: {
      [va3.id]: {
        order: 0,
        menuItemFactory: R_
      }
    }
  },
  [W1.MAIN_AREA]: {
    [c13.FORMAT]: {
      [dn2.name]: {
        order: 0,
        menuItemFactory: gi3
      },
      // [SheetCutCommand.name]: {
      //     order: 1,
      //     menuItemFactory: CutMenuItemFactory,
      // },
      [un2.name]: {
        order: 2,
        menuItemFactory: Qa3
      },
      [Ds2]: {
        order: 3,
        menuItemFactory: Ka2,
        [po3.id]: {
          order: 0,
          menuItemFactory: Ja3
        },
        [vo3.id]: {
          order: 1,
          menuItemFactory: $a4
        },
        [li2.id]: {
          order: 2,
          menuItemFactory: ec2
        },
        [So4.id]: {
          order: 3,
          menuItemFactory: tc2
        }
      },
      [ks2]: {
        order: 4,
        menuItemFactory: Za4,
        [Ys.id]: {
          order: 0,
          menuItemFactory: Ga2
        },
        [Hs2.id]: {
          order: 1,
          menuItemFactory: qa2
        },
        [Ls2.id]: {
          order: 2,
          menuItemFactory: Is5
        }
      }
    },
    [c13.LAYOUT]: {
      order: 1,
      [kf]: {
        order: 0,
        menuItemFactory: Pb,
        [ol.id]: {
          order: 0,
          menuItemFactory: xb
        },
        [ul.id]: {
          order: 1,
          menuItemFactory: Ob2
        },
        [os2.id]: {
          order: 2,
          menuItemFactory: Ab2
        },
        [bi4.id]: {
          order: 3,
          menuItemFactory: Hb2
        }
      },
      [Vf]: {
        order: 0,
        menuItemFactory: bb2,
        [Oo3.id]: {
          order: 0,
          menuItemFactory: Oh2
        },
        [xo.id]: {
          order: 1,
          menuItemFactory: Ah2
        },
        [is2.id]: {
          order: 2,
          menuItemFactory: _b2
        },
        [wi3.id]: {
          order: 3,
          menuItemFactory: Rb
        }
      },
      [Df]: {
        order: 2,
        menuItemFactory: t_,
        [Jn4.id]: {
          order: 0,
          menuItemFactory: nc2
        },
        [Ia2.id]: {
          order: 1,
          menuItemFactory: n_
        },
        [ya2.id]: {
          order: 2,
          menuItemFactory: r_
        },
        [$c.id]: {
          order: 3,
          menuItemFactory: rc2
        }
      },
      [Ls3]: {
        order: 3,
        menuItemFactory: ic2,
        [ai2.id]: {
          order: 0,
          menuItemFactory: oc2
        },
        [ui2.id]: {
          order: 1,
          menuItemFactory: sc2
        },
        [di2.id]: {
          order: 2,
          menuItemFactory: lc2
        },
        [ci2.id]: {
          order: 3,
          menuItemFactory: ac2
        }
      }
    },
    [c13.DATA]: {
      order: 2
    },
    [c13.OTHERS]: {
      order: 3
    }
  },
  [W1.COL_HEADER]: {
    [c13.FORMAT]: {
      [dn2.name]: {
        order: 0,
        menuItemFactory: gi3
      },
      // [SheetCutCommand.name]: {
      //     order: 1,
      //     menuItemFactory: CutMenuItemFactory,
      // },
      [un2.name]: {
        order: 2,
        menuItemFactory: Qa3
      },
      [Ds2]: {
        order: 3,
        menuItemFactory: Ka2,
        [po3.id]: {
          order: 0,
          menuItemFactory: Ja3
        },
        [vo3.id]: {
          order: 1,
          menuItemFactory: $a4
        },
        [li2.id]: {
          order: 2,
          menuItemFactory: ec2
        },
        [So4.id]: {
          order: 3,
          menuItemFactory: tc2
        }
      },
      [ks2]: {
        order: 4,
        menuItemFactory: Za4,
        [Ys.id]: {
          order: 0,
          menuItemFactory: Ga2
        },
        [Hs2.id]: {
          order: 1,
          menuItemFactory: qa2
        },
        [Ls2.id]: {
          order: 2,
          menuItemFactory: Is5
        }
      }
    },
    [c13.LAYOUT]: {
      order: 1,
      [cl.id]: {
        order: 0,
        menuItemFactory: kb3
      },
      [dl.id]: {
        order: 0,
        menuItemFactory: Db2
      },
      [ma4.id]: {
        order: 1,
        menuItemFactory: o_
      },
      [ei.id]: {
        order: 2,
        menuItemFactory: l_
      },
      [Oo3.id]: {
        order: 2,
        menuItemFactory: Oh2
      },
      [Bn4.id]: {
        order: 3,
        menuItemFactory: c_
      },
      [ls2.id]: {
        order: 4,
        menuItemFactory: e_
      },
      [$c2]: {
        order: 5,
        menuItemFactory: Dh2,
        [Jn4.id]: {
          order: 0,
          menuItemFactory: nc2
        },
        [$c.id]: {
          order: 3,
          menuItemFactory: rc2
        }
      },
      [Ls3]: {
        order: 6,
        menuItemFactory: ic2,
        [ai2.id]: {
          order: 0,
          menuItemFactory: oc2
        },
        [ui2.id]: {
          order: 1,
          menuItemFactory: sc2
        },
        [di2.id]: {
          order: 2,
          menuItemFactory: lc2
        },
        [ci2.id]: {
          order: 3,
          menuItemFactory: ac2
        }
      }
    },
    [c13.DATA]: {
      order: 2
    },
    [c13.OTHERS]: {
      order: 3
    }
  },
  [W1.ROW_HEADER]: {
    [c13.FORMAT]: {
      [dn2.name]: {
        order: 0,
        menuItemFactory: gi3
      },
      // [SheetCutCommand.name]: {
      //     order: 1,
      //     menuItemFactory: CutMenuItemFactory,
      // },
      [un2.name]: {
        order: 2,
        menuItemFactory: Qa3
      },
      [Ds2]: {
        order: 3,
        menuItemFactory: Ka2,
        [po3.id]: {
          order: 0,
          menuItemFactory: Ja3
        },
        [vo3.id]: {
          order: 1,
          menuItemFactory: $a4
        },
        [li2.id]: {
          order: 2,
          menuItemFactory: ec2
        },
        [So4.id]: {
          order: 3,
          menuItemFactory: tc2
        }
      },
      [ks2]: {
        order: 4,
        menuItemFactory: Za4,
        [Ys.id]: {
          order: 0,
          menuItemFactory: Ga2
        },
        [Hs2.id]: {
          order: 1,
          menuItemFactory: qa2
        },
        [Ls2.id]: {
          order: 2,
          menuItemFactory: Is5
        }
      }
    },
    [c13.LAYOUT]: {
      order: 1,
      [il.id]: {
        order: 0,
        menuItemFactory: Nb2
      },
      [al.id]: {
        order: 1,
        menuItemFactory: Vb
      },
      [xo.id]: {
        order: 1,
        menuItemFactory: Ah2
      },
      [ga3.id]: {
        order: 2,
        menuItemFactory: i_
      },
      [oi.id]: {
        order: 2,
        menuItemFactory: s_
      },
      [Kn.id]: {
        order: 3,
        menuItemFactory: a_
      },
      [no.id]: {
        order: 4,
        menuItemFactory: $b2
      },
      [$c2]: {
        order: 5,
        menuItemFactory: Dh2,
        [Jn4.id]: {
          order: 0,
          menuItemFactory: nc2
        },
        [$c.id]: {
          order: 3,
          menuItemFactory: rc2
        }
      },
      [Ls3]: {
        order: 6,
        menuItemFactory: ic2,
        [ai2.id]: {
          order: 0,
          menuItemFactory: oc2
        },
        [ui2.id]: {
          order: 1,
          menuItemFactory: sc2
        },
        [di2.id]: {
          order: 2,
          menuItemFactory: lc2
        },
        [ci2.id]: {
          order: 3,
          menuItemFactory: ac2
        }
      }
    },
    [c13.DATA]: {
      order: 2
    },
    [c13.OTHERS]: {
      order: 3
    }
  },
  [W1.FOOTER_TABS]: {
    [c13.OTHERS]: {
      order: 0,
      [ba4.id]: {
        order: 0,
        menuItemFactory: T_
      },
      [gc.id]: {
        order: 1,
        menuItemFactory: P_
      },
      [Oa3.id]: {
        order: 2,
        menuItemFactory: x_
      },
      [Qc.id]: {
        order: 3,
        menuItemFactory: O_
      },
      [sd2.id]: {
        order: 4,
        menuItemFactory: A_
      },
      // [SetWorksheetShowCommand.id]: {
      //     order: 5,
      //     menuItemFactory: UnHideSheetMenuItemFactory,
      // },
      [Ea4.id]: {
        order: 6,
        menuItemFactory: H_
      },
      [Sa4.id]: {
        order: 7,
        menuItemFactory: I_
      },
      [Ta4.id]: {
        order: 8,
        menuItemFactory: y_
      },
      [Pa4.id]: {
        order: 9,
        menuItemFactory: M_
      },
      [Ca4.id]: {
        order: 10,
        menuItemFactory: E_
      }
    }
  },
  [W1.FOOTER_MENU]: {
    [c13.OTHERS]: {
      [Cd.id]: {
        order: 1,
        menuItemFactory: Tb2
      }
    }
  }
};
var cc2 = "UNIVER_SHEET_PERMISSION_ALERT_DIALOG_ID";
var Uf = "UNIVER_SHEET_PERMISSION_ALERT_DIALOG";
var N_ = Object.getOwnPropertyDescriptor;
var k_ = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? N_(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var Cn3 = (n3, e) => (t3, r) => e(t3, r, n3);
var Ti2 = class extends Ve {
  constructor(e, t3, r, i, o3, s2, l4, a4, c2) {
    super();
    _2(this, "disposableCollection", new ho());
    this._commandService = e, this._univerInstanceService = t3, this._permissionService = r, this._dialogService = i, this._rangeProtectionRuleModel = o3, this._autoFillService = s2, this._localeService = l4, this._contextService = a4, this._sheetPermissionCheckController = c2, this._initialize(), this._initUIEvent();
  }
  _initUIEvent() {
    this.disposeWithMe(
      this._sheetPermissionCheckController.triggerPermissionUIEvent$.subscribe((e) => {
        this._haveNotPermissionHandle(e);
      })
    );
  }
  _haveNotPermissionHandle(e) {
    const t3 = {
      id: cc2,
      title: { title: "permission.dialog.alert" },
      children: {
        label: Uf,
        errorMsg: e
      },
      width: 320,
      destroyOnClose: true,
      showOk: true,
      onClose: () => {
        this._dialogService.close(cc2);
      },
      onOk: () => {
        this._dialogService.close(cc2);
      },
      className: "sheet-permission-user-dialog"
    };
    this._permissionService.getShowComponents() && this._dialogService.open(t3);
  }
  _getPermissionCheck(e, t3) {
    var o3, s2;
    let r = true, i = "";
    switch (e) {
      case va.id:
      case Ta.id:
        if (this._contextService.getContextValue(B1) === true)
          break;
        r = this._sheetPermissionCheckController.permissionCheckWithoutRange({
          workbookTypes: [Pe3],
          rangeTypes: [Ve4],
          worksheetTypes: [An3, Le2]
        }), i = this._localeService.t("permission.dialog.editErr");
        break;
      case tt5.id:
        if (t3.visible === false)
          break;
        r = this._sheetPermissionCheckController.permissionCheckWithoutRange({
          workbookTypes: [Pe3],
          rangeTypes: [Ve4],
          worksheetTypes: [An3, Le2]
        }), i = this._localeService.t("permission.dialog.editErr");
        break;
      case li2.id:
        r = this._sheetPermissionCheckController.permissionCheckWithoutRange({
          workbookTypes: [Pe3],
          rangeTypes: [Ve4],
          worksheetTypes: [Le2, Zt3]
        }), i = this._localeService.t("permission.dialog.pasteErr");
        break;
      case Gc2.id:
        r = this._permissionCheckByPaste(t3), i = this._localeService.t("permission.dialog.pasteErr");
        break;
      case Ra3.id:
        r = this._sheetPermissionCheckController.permissionCheckWithRanges({
          workbookTypes: [Pe3],
          rangeTypes: [Ve4],
          worksheetTypes: [Le2, An3, kr2]
        }), i = this._localeService.t("permission.dialog.commonErr");
        break;
      case Gc.id:
      case zi2.id:
      case ji3.id:
      case Yi2.id:
      case Zi2.id:
        r = this._sheetPermissionCheckController.permissionCheckWithRanges({
          workbookTypes: [Pe3],
          rangeTypes: [Ve4],
          worksheetTypes: [kr2, Le2]
        }), i = this._localeService.t("permission.dialog.setStyleErr");
        break;
      case dn2.id:
        r = this._sheetPermissionCheckController.permissionCheckWithRanges({
          workbookTypes: [ir4],
          rangeTypes: [Bs2],
          worksheetTypes: [Cr]
        }), i = this._localeService.t("permission.dialog.copyErr"), (o3 = this._permissionService.getPermissionPoint(new ir4(this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET).getUnitId()).id)) != null && o3.value || (i = this._localeService.t("permission.dialog.workbookCopyErr"));
        break;
      case Jd3.id:
        r = this._sheetPermissionCheckController.permissionCheckWithRanges({
          workbookTypes: [ir4, Pe3],
          rangeTypes: [Bs2, Ve4],
          worksheetTypes: [Cr, Le2]
        }), i = this._localeService.t("permission.dialog.copyErr"), (s2 = this._permissionService.getPermissionPoint(new ir4(this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET).getUnitId()).id)) != null && s2.value || (i = this._localeService.t("permission.dialog.workbookCopyErr"));
        break;
      case gr5.id:
        r = this._permissionCheckByAutoFillCommand(t3), i = this._localeService.t("permission.dialog.autoFillErr");
        break;
    }
    r || this._sheetPermissionCheckController.blockExecuteWithoutPermission(i);
  }
  _initialize() {
    this._commandExecutedListener();
  }
  _commandExecutedListener() {
    this.disposeWithMe(
      this._commandService.beforeCommandExecuted((e) => {
        this._getPermissionCheck(e.id, e == null ? void 0 : e.params);
      })
    );
  }
  _permissionCheckByPaste(e) {
    return e.value === et4.SPECIAL_PASTE_VALUE || e.value === et4.SPECIAL_PASTE_FORMULA ? this._sheetPermissionCheckController.permissionCheckWithRanges({
      workbookTypes: [Pe3],
      rangeTypes: [Ve4],
      worksheetTypes: [kr2, Le2]
    }) : e.value === et4.SPECIAL_PASTE_FORMAT ? this._sheetPermissionCheckController.permissionCheckWithRanges({
      workbookTypes: [Pe3],
      rangeTypes: [Ve4],
      worksheetTypes: [kr2, Le2]
    }) : this._sheetPermissionCheckController.permissionCheckWithRanges({
      workbookTypes: [Pe3],
      rangeTypes: [Ve4],
      worksheetTypes: [An3, kr2, Le2]
    });
  }
  _permissionCheckByAutoFillCommand(e) {
    if (!e)
      return false;
    const { targetRange: t3 } = e, r = P5(this._univerInstanceService);
    if (!r)
      return false;
    const { worksheet: i, unitId: o3, subUnitId: s2 } = r;
    return !this._rangeProtectionRuleModel.getSubunitRuleList(o3, s2).reduce((c2, d2) => [...c2, ...d2.ranges], []).filter((c2) => Cn.intersects(c2, t3)).some((c2) => {
      var d2, u2;
      for (let h9 = c2.startRow; h9 <= c2.endRow; h9++)
        for (let m9 = c2.startColumn; m9 <= c2.endColumn; m9++) {
          const g9 = (u2 = (d2 = i.getCell(h9, m9)) == null ? void 0 : d2.selectionProtection) == null ? void 0 : u2[0];
          if ((g9 == null ? void 0 : g9[ce3.Edit]) === false)
            return true;
        }
      return false;
    });
  }
};
Ti2 = k_([
  Cn3(0, Ds),
  Cn3(1, br),
  Cn3(2, aC),
  Cn3(3, ct2),
  Cn3(4, Inject(me)),
  Cn3(5, Nr3),
  Cn3(6, Inject(Hn)),
  Cn3(7, Tr),
  Cn3(8, Inject(Yn2))
], Ti2);
var D_ = Object.getOwnPropertyDescriptor;
var L_ = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? D_(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var dr4 = (n3, e) => (t3, r) => e(t3, r, n3);
var W_ = "__SpreadsheetFreezeRowMainName__";
var B_ = "__SpreadsheetFreezeRowHeaderName__";
var F_ = "__SpreadsheetFreezeColumnMainName__";
var U_ = "__SpreadsheetFreezeColumnHeaderName__";
var dc2 = 2;
var X_ = 0.01;
var eo4 = rR("freezePermissionCheck");
var Lo4 = class extends Ve {
  constructor(e, t3, r, i, o3, s2, l4, a4) {
    super();
    _2(this, "_rowFreezeHeaderRect");
    _2(this, "_rowFreezeMainRect");
    _2(this, "_columnFreezeHeaderRect");
    _2(this, "_columnFreezeMainRect");
    _2(this, "_freezeDownSubs");
    _2(this, "_freezePointerEnterSubs");
    _2(this, "_freezePointerLeaveSubs");
    _2(this, "_scenePointerMoveSub");
    _2(this, "_scenePointerUpSub");
    _2(this, "_changeToRow", -1);
    _2(this, "_changeToColumn", -1);
    _2(this, "_changeToOffsetX", 0);
    _2(this, "_changeToOffsetY", 0);
    _2(this, "_activeViewport", null);
    _2(this, "_freezeNormalHeaderColor", "");
    _2(this, "_freezeNormalMainColor", "");
    _2(this, "_freezeActiveColor", "");
    _2(this, "_freezeHoverColor", "");
    _2(this, "_lastFreeze");
    _2(this, "interceptor", new sR({ FREEZE_PERMISSION_CHECK: eo4 }));
    this._context = e, this._sheetSkeletonManagerService = t3, this._commandService = r, this._selectionManagerService = i, this._scrollManagerService = o3, this._themeService = s2, this._sheetInterceptorService = l4, this._injector = a4, this._initialize();
  }
  dispose() {
    super.dispose();
  }
  _initialize() {
    this._skeletonListener(), this._commandExecutedListener(), this._themeChangeListener(), this._interceptorCommands(), this._bindViewportScroll(), this._zoomRefresh();
  }
  // eslint-disable-next-line max-lines-per-function, complexity
  _createFreeze(e = 0, t3) {
    var y6;
    const r = t3 != null ? t3 : this._getFreeze();
    if (r == null) return null;
    const i = (y6 = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : y6.skeleton, { startRow: o3, startColumn: s2 } = r, l4 = this._getPositionByIndex(o3, s2);
    if (l4 == null || i == null) return null;
    const a4 = this._getSheetObject(), c2 = a4.engine, d2 = (c2 == null ? void 0 : c2.width) || 0, u2 = (c2 == null ? void 0 : c2.height) || 0, h9 = a4.scene, { startX: m9, startY: g9 } = l4, { rowTotalHeight: f4, columnTotalWidth: p3, rowHeaderWidthAndMarginLeft: v6, columnHeaderHeightAndMarginTop: S } = i, w6 = d2 > p3 + v6 ? d2 : p3 + S, C = u2 > f4 + S ? u2 : f4 + S;
    this._changeToRow = o3, this._changeToColumn = s2, this._changeToOffsetX = m9, this._changeToOffsetY = g9;
    const I6 = Math.max(h9.scaleX, h9.scaleY);
    let R9 = dc2 / Math.max(1, I6);
    if (e === 0) {
      (o3 === -1 || o3 === 0) && (R9 = R9 * 2);
      const E3 = R9;
      this._rowFreezeHeaderRect = new I1(B_, {
        fill: this._freezeNormalHeaderColor,
        width: v6,
        height: R9,
        left: 0,
        top: g9 - E3,
        zIndex: 3
      });
      let M10 = this._freezeNormalHeaderColor;
      (o3 === -1 || o3 === 0) && (M10 = this._freezeNormalMainColor), this._rowFreezeMainRect = new I1(W_, {
        fill: M10,
        width: w6 * 2 / I6,
        height: R9,
        left: v6,
        top: g9 - E3,
        zIndex: 3
      }), h9.addObjects([this._rowFreezeHeaderRect, this._rowFreezeMainRect], nr5);
    } else {
      (s2 === -1 || s2 === 0) && (R9 = R9 * 2);
      const E3 = R9;
      this._columnFreezeHeaderRect = new I1(U_, {
        fill: this._freezeNormalHeaderColor,
        width: R9,
        height: S,
        left: m9 - E3,
        top: 0,
        zIndex: 3
      });
      let M10 = this._freezeNormalHeaderColor;
      (s2 === -1 || s2 === 0) && (M10 = this._freezeNormalMainColor), this._columnFreezeMainRect = new I1(F_, {
        fill: M10,
        width: R9,
        height: C * 2 / I6,
        left: m9 - E3,
        top: S,
        zIndex: 3
      }), h9.addObjects([this._columnFreezeHeaderRect, this._columnFreezeMainRect], nr5);
    }
    this._eventBinding(e);
  }
  // eslint-disable-next-line max-lines-per-function
  _eventBinding(e = 0) {
    let t3 = this._rowFreezeHeaderRect, r = this._rowFreezeMainRect;
    e === 1 && (t3 = this._columnFreezeHeaderRect, r = this._columnFreezeMainRect);
    const i = this._getSheetObject();
    if (i == null)
      return;
    const { scene: o3 } = i;
    if (this._freezePointerEnterSubs = new Subscription(), this._freezePointerLeaveSubs = new Subscription(), this._freezeDownSubs = new Subscription(), r) {
      const a4 = r.onPointerEnter$.subscribeEvent(() => {
        if (!this.interceptor.fetchThroughInterceptors(eo4)(true, null))
          return false;
        t3 == null || t3.setProps({
          fill: this._freezeHoverColor,
          zIndex: 4
        }), o3.setCursor(v1.GRAB);
      });
      this._freezePointerEnterSubs.add(a4);
      const c2 = r.onPointerLeave$.subscribeEvent(() => {
        t3 == null || t3.setProps({
          fill: this._freezeNormalHeaderColor,
          zIndex: 3
        }), o3.resetCursor();
      });
      this._freezePointerLeaveSubs.add(c2);
    }
    if (t3) {
      const a4 = t3.onPointerEnter$.subscribeEvent(() => {
        if (!this.interceptor.fetchThroughInterceptors(eo4)(true, null))
          return false;
        t3 == null || t3.setProps({
          fill: this._freezeHoverColor,
          zIndex: 4
        }), o3.setCursor(v1.GRAB);
      });
      this._freezePointerEnterSubs.add(a4);
      const c2 = t3.onPointerLeave$.subscribeEvent(() => {
        t3 == null || t3.setProps({
          fill: this._freezeNormalHeaderColor,
          zIndex: 3
        }), o3.resetCursor();
      });
      this._freezePointerLeaveSubs.add(c2);
    }
    const s2 = t3 == null ? void 0 : t3.onPointerDown$.subscribeEvent((a4) => {
      this._freezeDown(a4, t3, r, e);
    });
    s2 && this._freezeDownSubs.add(s2);
    const l4 = r == null ? void 0 : r.onPointerDown$.subscribeEvent((a4) => {
      this._freezeDown(a4, t3, r, e);
    });
    l4 && this._freezeDownSubs.add(l4);
  }
  // eslint-disable-next-line complexity
  _getCurrentLastVisible() {
    var p3, v6, S, w6, C, I6, R9;
    const e = this._getSheetObject();
    if (e == null)
      return;
    const t3 = (p3 = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : p3.skeleton;
    if (t3 == null)
      return;
    const r = e.scene, i = Math.max(r.scaleX, r.scaleY), o3 = this._scrollManagerService.getCurrentScrollState(), s2 = (e.engine.height - t3.columnHeaderHeight) / i, l4 = (e.engine.width - t3.rowHeaderWidth) / i, a4 = (v6 = o3 == null ? void 0 : o3.sheetViewStartRow) != null ? v6 : 0, c2 = a4 === 0 ? -((S = o3 == null ? void 0 : o3.offsetY) != null ? S : 0) : t3.rowHeightAccumulation[a4 - 1] - ((w6 = o3 == null ? void 0 : o3.offsetY) != null ? w6 : 0);
    let d2 = 0, u2 = false;
    for (let y6 = a4, E3 = t3.rowHeightAccumulation.length; y6 < E3; y6++)
      if (t3.rowHeightAccumulation[y6] - c2 > s2) {
        d2 = y6, u2 = true;
        break;
      }
    u2 || (d2 = t3.rowHeightAccumulation.length - 1);
    const h9 = (C = o3 == null ? void 0 : o3.sheetViewStartColumn) != null ? C : 0, m9 = h9 === 0 ? -((I6 = o3 == null ? void 0 : o3.offsetX) != null ? I6 : 0) : t3.columnWidthAccumulation[h9 - 1] - ((R9 = o3 == null ? void 0 : o3.offsetX) != null ? R9 : 0);
    let g9 = 0, f4 = false;
    for (let y6 = h9, E3 = t3.columnWidthAccumulation.length; y6 < E3; y6++)
      if (t3.columnWidthAccumulation[y6] - m9 > l4) {
        g9 = y6, f4 = true;
        break;
      }
    return f4 || (g9 = t3.columnWidthAccumulation.length - 1), { lastRow: d2, lastColumn: g9 };
  }
  _getActiveViewport(e) {
    var r;
    const t3 = (r = this._getSheetObject()) == null ? void 0 : r.scene.getViewports();
    return t3 && t3.find((i) => i.isHit(new U(e.offsetX, e.offsetY))) || null;
  }
  // eslint-disable-next-line max-lines-per-function
  _freezeDown(e, t3, r, i = 0) {
    var m9;
    const o3 = (m9 = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : m9.skeleton;
    if (o3 == null)
      return;
    const s2 = this._getSheetObject();
    if (s2 == null)
      return;
    if (!this.interceptor.fetchThroughInterceptors(eo4)(true, null))
      return false;
    const { scene: a4 } = s2;
    a4.setCursor(v1.GRABBING), a4.disableObjectsEvent();
    const c2 = this._getCurrentLastVisible(), d2 = c2 === void 0 ? Number.POSITIVE_INFINITY : o3.rowHeightAccumulation[c2.lastRow], u2 = c2 === void 0 ? Number.POSITIVE_INFINITY : o3.columnWidthAccumulation[c2.lastColumn - 1] + o3.rowHeaderWidth;
    this._activeViewport = null;
    const h9 = this._getFreeze();
    h9 && (this._changeToColumn = h9.startColumn, this._changeToRow = h9.startRow), this._scenePointerMoveSub = a4.onPointerMove$.subscribeEvent((g9) => {
      var R9, y6, E3, M10;
      const f4 = this._getActiveViewport(g9), { startX: p3, startY: v6, row: S, column: w6 } = An4(
        g9.offsetX,
        g9.offsetY,
        a4,
        o3,
        f4 || void 0,
        true
      );
      if (!this.interceptor.fetchThroughInterceptors(eo4)(true, null))
        return false;
      a4.setCursor(v1.GRABBING);
      const I6 = dc2 / Math.max(a4.scaleX, a4.scaleY);
      i === 0 ? ((R9 = t3.transformByState({
        top: Math.min(v6, d2) - I6 / 2
      })) == null || R9.setProps({
        fill: this._freezeActiveColor
      }), (y6 = r.transformByState({
        top: Math.min(v6, d2) - I6 / 2
      })) == null || y6.setProps({
        fill: this._freezeNormalHeaderColor
      }), this._changeToRow = c2 === void 0 ? S : Math.min(S, c2.lastRow), this._changeToOffsetY = Math.min(v6, d2), this._activeViewport = f4) : ((E3 = t3.transformByState({
        left: Math.min(p3, u2) - I6 / 2
      })) == null || E3.setProps({
        fill: this._freezeActiveColor
      }), (M10 = r.transformByState({
        left: Math.min(p3, u2) - I6 / 2
      })) == null || M10.setProps({
        fill: this._freezeNormalHeaderColor
      }), this._changeToColumn = c2 === void 0 ? w6 : Math.min(w6, c2.lastColumn), this._changeToOffsetX = p3, this._activeViewport = f4);
    }), this._scenePointerUpSub = a4.onPointerUp$.subscribeEvent(() => {
      var T10, P8;
      a4.resetCursor(), a4.enableObjectsEvent(), this._clearObserverEvent();
      const { rowHeaderWidthAndMarginLeft: g9, columnHeaderHeightAndMarginTop: f4 } = o3;
      i === 0 && (this._changeToRow === 0 || this._changeToRow === -1) || i === 1 && (this._changeToColumn === 0 || this._changeToColumn === -1) ? (t3.setProps({
        fill: this._freezeNormalHeaderColor
      }), r.setProps({
        fill: this._freezeNormalMainColor
      })) : (t3 == null || t3.setProps({
        fill: this._freezeNormalHeaderColor
      }), r == null || r.setProps({
        fill: this._freezeNormalHeaderColor
      }));
      const p3 = dc2 / Math.max(a4.scaleX, a4.scaleY);
      i === 0 ? (this._changeToRow === 0 || this._changeToRow === -1) && (t3.transformByState({
        top: f4 - p3
      }), r.transformByState({
        top: f4 - p3
      })) : (this._changeToColumn === 0 || this._changeToColumn === -1) && (t3.transformByState({
        left: g9 - p3
      }), r.transformByState({
        left: g9 - p3
      }));
      const v6 = this._scrollManagerService.getCurrentScrollState() || {
        sheetViewStartRow: 0,
        sheetViewStartColumn: 0
      }, { sheetViewStartRow: S, sheetViewStartColumn: w6 } = v6;
      if (w6 == null || S == null)
        return;
      const C = this._context.unit, I6 = C.getActiveSheet();
      if (!I6) return;
      const R9 = (T10 = I6.getConfig()) == null ? void 0 : T10.freeze;
      let y6 = (R9 == null ? void 0 : R9.xSplit) || 0, E3 = (R9 == null ? void 0 : R9.ySplit) || 0;
      const M10 = (P8 = this._activeViewport) == null ? void 0 : P8.viewportKey;
      i === 0 && (!M10 || M10 === k2.VIEW_LEFT_TOP || M10 === k2.VIEW_MAIN_LEFT_TOP || M10 === k2.VIEW_MAIN_TOP || M10 === k2.VIEW_ROW_TOP ? E3 = this._changeToRow - (R9.startRow - R9.ySplit) : E3 = this._changeToRow - S, E3 = E3 < 0 ? 0 : E3), i === 1 && (!M10 || M10 === k2.VIEW_LEFT_TOP || M10 === k2.VIEW_MAIN_LEFT_TOP || M10 === k2.VIEW_MAIN_LEFT || M10 === k2.VIEW_COLUMN_LEFT ? y6 = this._changeToColumn - (R9.startColumn - R9.xSplit) : y6 = this._changeToColumn - w6, y6 = y6 < 0 ? 0 : y6), this._commandService.executeCommand(xc.id, {
        startRow: E3 === 0 ? -1 : this._changeToRow,
        startColumn: y6 === 0 ? -1 : this._changeToColumn,
        ySplit: E3,
        xSplit: y6,
        unitId: C.getUnitId(),
        subUnitId: I6.getSheetId()
      });
    });
  }
  _getViewports() {
    const e = this._getSheetObject();
    if (e == null)
      return;
    const { scene: t3 } = e, r = t3.getViewport(k2.VIEW_COLUMN_LEFT), i = t3.getViewport(k2.VIEW_COLUMN_RIGHT), o3 = t3.getViewport(k2.VIEW_ROW_TOP), s2 = t3.getViewport(k2.VIEW_ROW_BOTTOM), l4 = t3.getViewport(k2.VIEW_LEFT_TOP), a4 = t3.getViewport(k2.VIEW_MAIN), c2 = t3.getViewport(k2.VIEW_MAIN_LEFT_TOP), d2 = t3.getViewport(k2.VIEW_MAIN_LEFT), u2 = t3.getViewport(k2.VIEW_MAIN_TOP);
    if (!(r == null || i == null || o3 == null || s2 == null || l4 == null || a4 == null || c2 == null || d2 == null || u2 == null))
      return {
        viewMain: a4,
        viewMainLeftTop: c2,
        viewMainLeft: d2,
        viewMainTop: u2,
        viewColumnLeft: r,
        viewColumnRight: i,
        viewRowTop: o3,
        viewRowBottom: s2,
        viewLeftTop: l4
      };
  }
  _bindViewportScroll() {
    const e = this._getViewports();
    if (!e)
      return;
    const { viewRowBottom: t3, viewColumnRight: r, viewMainLeft: i, viewMainTop: o3 } = e;
    this.disposeWithMe(
      this._scrollManagerService.validViewportScrollInfo$.subscribe((s2) => {
        if (!s2) return;
        const { scrollX: l4, scrollY: a4, viewportScrollX: c2, viewportScrollY: d2 } = s2;
        t3.isActive && t3.updateScrollVal({
          scrollY: a4,
          viewportScrollY: d2
        }), r.isActive && r.updateScrollVal({
          scrollX: l4,
          viewportScrollX: c2
        }), i.isActive && i.updateScrollVal({
          scrollY: a4,
          viewportScrollY: d2
        }), o3.isActive && o3.updateScrollVal({
          scrollX: l4,
          viewportScrollX: c2
        });
      })
    );
  }
  // eslint-disable-next-line max-lines-per-function, complexity
  _updateViewport(e = -1, t3 = -1, r = 0, i = 0, o3 = 3) {
    var y6;
    const s2 = (y6 = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : y6.skeleton;
    if (s2 == null)
      return;
    const { rowHeaderWidthAndMarginLeft: l4, columnHeaderHeightAndMarginTop: a4 } = s2, c2 = this._getViewports();
    if (!c2)
      return;
    const {
      viewMain: d2,
      viewMainLeftTop: u2,
      viewMainLeft: h9,
      viewMainTop: m9,
      viewColumnLeft: g9,
      viewColumnRight: f4,
      viewRowTop: p3,
      viewRowBottom: v6,
      viewLeftTop: S
    } = c2;
    f4.resizeWhenFreezeChange({
      left: l4,
      top: 0,
      // ctx.clip by the size of viewport, and selection header border is slightly below column header
      // I think it's a bad design, Should not clip for selection rendering in viewport,
      height: a4 + 1,
      right: 0
    }), v6.resizeWhenFreezeChange({
      left: 0,
      top: a4,
      bottom: 0,
      width: l4 + 1
    }), S.resizeWhenFreezeChange({
      left: 0,
      top: 0,
      width: l4 + 1,
      height: a4
    });
    let w6 = true, C = true;
    u2.enable(), (e === -1 || e === 0) && (w6 = false), (t3 === -1 || t3 === 0) && (C = false);
    const I6 = s2.getNoMergeCellWithCoordByIndex(e - r, t3 - i, false), R9 = s2.getNoMergeCellWithCoordByIndex(e, t3, false);
    if (u2.disable(), m9.disable(), h9.disable(), p3.disable(), g9.disable(), u2.resetPadding(), m9.resetPadding(), h9.resetPadding(), p3.resetPadding(), g9.resetPadding(), w6 === false && C === false)
      d2.resizeWhenFreezeChange({
        left: l4,
        top: a4,
        bottom: 0,
        right: 0
      }), d2.resetPadding(), h9.resizeWhenFreezeChange({
        left: l4,
        top: a4,
        bottom: 0,
        width: 0
      }), m9.resizeWhenFreezeChange({
        left: l4,
        top: a4,
        height: 0,
        right: 0
      }), u2.resizeWhenFreezeChange({
        left: l4,
        top: a4,
        width: 0,
        height: 0
      }), p3.resizeWhenFreezeChange({
        left: 0,
        top: a4,
        width: l4 + 1,
        height: 0
      }), g9.resizeWhenFreezeChange({
        left: 0,
        top: 0,
        height: a4 + 1,
        width: 0
      });
    else if (w6 === true && C === false) {
      const E3 = R9.startY - I6.startY;
      d2.resizeWhenFreezeChange({
        left: l4,
        top: a4 + E3,
        bottom: 0,
        right: 0
      }), d2.setPadding({
        startY: I6.startY,
        endY: R9.startY,
        startX: 0,
        endX: 0
      }), o3 & 2 && this._commandService.executeCommand(hn2.id, {
        sheetViewStartRow: 0,
        offsetY: 0
      }), m9.resizeWhenFreezeChange({
        left: l4,
        top: a4,
        height: E3,
        right: 0
      }), m9.updateScrollVal({
        viewportScrollY: I6.startY,
        rawScrollX: d2.scrollX,
        viewportScrollX: d2.viewportScrollX
      }), p3.resizeWhenFreezeChange({
        left: 0,
        top: a4,
        width: l4 + 1,
        height: E3
      }), p3.updateScrollVal({
        viewportScrollY: I6.startY
      }), v6.resizeWhenFreezeChange({
        left: 0,
        top: a4 + E3,
        bottom: 0,
        width: l4 + 1
      }), m9.enable(), p3.enable();
    } else if (w6 === false && C === true) {
      const E3 = R9.startX - I6.startX;
      d2.resizeWhenFreezeChange({
        left: l4 + E3,
        top: a4,
        bottom: 0,
        right: 0
      }), d2.setPadding({
        startX: I6.startX,
        endX: R9.startX,
        startY: 0,
        endY: 0
      }), o3 & 1 && this._commandService.executeCommand(hn2.id, {
        sheetViewStartColumn: 0,
        offsetX: 0
      }), h9.resizeWhenFreezeChange({
        left: l4,
        top: a4,
        width: E3,
        bottom: 0,
        right: 0
      }), h9.updateScrollVal({
        viewportScrollX: I6.startX,
        rawScrollY: d2.scrollY,
        viewportScrollY: d2.viewportScrollY
      }), g9.resizeWhenFreezeChange({
        left: l4,
        top: 0,
        width: E3,
        height: a4 + 1
      }), g9.updateScrollVal({
        viewportScrollX: I6.startX
      }), f4.resizeWhenFreezeChange({
        left: l4 + E3,
        top: 0,
        height: a4 + 1,
        right: 0
      }), h9.enable(), g9.enable();
    } else {
      const E3 = R9.startX - I6.startX, M10 = R9.startY - I6.startY;
      d2.resizeWhenFreezeChange({
        left: l4 + E3,
        top: a4 + M10,
        bottom: 0,
        right: 0
      }), d2.setPadding({
        startY: I6.startY,
        endY: R9.startY,
        startX: I6.startX,
        endX: R9.startX
      }), o3 && this._commandService.executeCommand(hn2.id, __spreadValues(__spreadValues({}, o3 & 1 ? {
        sheetViewStartColumn: 0,
        offsetX: 0
      } : null), o3 & 2 ? {
        sheetViewStartRow: 0,
        offsetY: 0
      } : null)), h9.resizeWhenFreezeChange({
        left: l4,
        top: a4 + M10,
        width: E3,
        bottom: 0
      }), h9.updateScrollVal({
        viewportScrollX: I6.startX,
        rawScrollY: d2.scrollY,
        viewportScrollY: d2.viewportScrollY
      }), m9.resizeWhenFreezeChange({
        left: l4 + E3,
        top: a4,
        height: M10,
        right: 0
      }), m9.updateScrollVal({
        viewportScrollY: I6.startY,
        rawScrollX: d2.scrollX,
        viewportScrollX: d2.viewportScrollX
      }), u2.resizeWhenFreezeChange({
        left: l4,
        top: a4,
        width: E3,
        height: M10
      }), u2.updateScrollVal({
        viewportScrollX: I6.startX,
        viewportScrollY: I6.startY
      }), p3.resizeWhenFreezeChange({
        left: 0,
        top: a4,
        width: l4 + 1,
        height: M10
      }), p3.updateScrollVal({
        viewportScrollY: I6.startY
      }), v6.resizeWhenFreezeChange({
        left: 0,
        top: a4 + M10,
        bottom: 0,
        width: l4 + 1
      }), g9.resizeWhenFreezeChange({
        left: l4,
        top: 0,
        width: E3,
        height: a4 + 1
      }), g9.updateScrollVal({
        viewportScrollX: I6.startX
      }), f4.resizeWhenFreezeChange({
        left: l4 + E3,
        top: 0,
        height: a4 + 1,
        right: 0
      }), u2.enable(), m9.enable(), h9.enable(), p3.enable(), g9.enable();
    }
  }
  /**
   * When switching sheet tabs, it is necessary to update the frozen state of the current view.
   */
  _skeletonListener() {
    this.disposeWithMe(
      Be(
        this._sheetSkeletonManagerService.currentSkeleton$.subscribe((e) => {
          [
            pn.id,
            Pt4.id,
            rn.id
          ].includes((e == null ? void 0 : e.commandId) || "") && this._refreshCurrent();
        })
      )
    );
  }
  _refreshCurrent() {
    const t3 = this._context.unit.getActiveSheet();
    if (!t3) return;
    const r = t3.getConfig().freeze, { startRow: i = -1, startColumn: o3 = -1, ySplit: s2 = 0, xSplit: l4 = 0 } = r;
    this._refreshFreeze(
      i,
      o3,
      s2,
      l4,
      0
      /* NONE */
    );
  }
  _themeChangeListener() {
    this._themeChange(this._themeService.getCurrentTheme()), this.disposeWithMe(
      this._themeService.currentTheme$.subscribe((e) => {
        this._clearFreeze(), this._themeChange(e), this._refreshCurrent();
      })
    );
  }
  _themeChange(e) {
    this._freezeNormalHeaderColor = yf(e, "gray.300"), this._freezeNormalMainColor = new At(this._freezeNormalHeaderColor).setAlpha(X_).toRgbString(), this._freezeActiveColor = yf(e, "primary.600"), this._freezeHoverColor = yf(e, "gray.500");
  }
  // eslint-disable-next-line max-lines-per-function
  _interceptorCommands() {
    this.disposeWithMe(
      this._sheetInterceptorService.interceptCommand({
        // eslint-disable-next-line complexity, max-lines-per-function
        getMutations: (e) => {
          const t3 = {
            redos: [],
            undos: []
          }, r = this._getFreeze();
          if (!r)
            return t3;
          const i = (o3) => {
            const s2 = this._context.unit, l4 = s2.getUnitId(), a4 = s2.getActiveSheet();
            if (!a4)
              return t3;
            const c2 = a4.getSheetId();
            this._refreshFreeze(
              o3.startRow,
              o3.startColumn,
              o3.ySplit,
              o3.xSplit,
              0
              /* NONE */
            );
            const d2 = __spreadProps(__spreadValues({}, o3), {
              unitId: l4,
              subUnitId: c2,
              resetScroll: false
            }), u2 = si(this._injector, d2);
            return {
              undos: [{ id: st2.id, params: u2 }],
              redos: [{ id: st2.id, params: d2 }]
            };
          };
          if (e.id === Ye3.id) {
            const o3 = e.params, { range: s2, direction: l4 } = o3, a4 = s2.endRow - s2.startRow + 1;
            if (s2.startRow < r.startRow || s2.startRow + 1 === r.startRow && l4 === wm.UP) {
              const c2 = __spreadProps(__spreadValues({}, r), {
                startRow: Math.max(1, r.startRow + a4),
                ySplit: Math.max(1, r.ySplit + a4)
              });
              return i(c2);
            }
          }
          if (e.id === Xe6.id) {
            const o3 = e.params, { range: s2, direction: l4 } = o3, a4 = s2.endColumn - s2.startColumn + 1;
            if (s2.startColumn < r.startColumn || s2.startColumn + 1 === r.startColumn && l4 === wm.LEFT) {
              const c2 = __spreadProps(__spreadValues({}, r), {
                startColumn: Math.max(1, r.startColumn + a4),
                xSplit: Math.max(1, r.xSplit + a4)
              });
              return i(c2);
            }
          }
          if (e.id === un.id) {
            const o3 = this._selectionManagerService.getCurrentSelections(), {
              fromRange: { startColumn: s2 },
              toRange: { startColumn: l4 }
            } = e.params, a4 = o3 == null ? void 0 : o3.filter(
              (p3) => p3.range.rangeType === ge.COLUMN && p3.range.startColumn <= s2 && s2 <= p3.range.endColumn
            );
            if (!(a4 != null && a4.length))
              return t3;
            const c2 = a4[0].range, d2 = __spreadProps(__spreadValues({}, c2), {
              startColumn: l4,
              endColumn: l4 + c2.endColumn - c2.startColumn
            });
            if (!r || r.startColumn <= 0 || // move out of freeze
            c2.startColumn >= r.startColumn && d2.startColumn >= r.startColumn || // not move
            c2.startColumn === d2.startColumn || // move in freeze range
            c2.endColumn < r.startColumn && d2.startColumn < r.startColumn)
              return t3;
            const u2 = c2.endColumn - c2.startColumn + 1, h9 = Math.max(
              Math.min(r.startColumn, c2.endColumn + 1) - c2.startColumn,
              0
            );
            let m9, g9;
            d2.startColumn >= r.startColumn ? (m9 = Math.max(r.startColumn - h9, 1), g9 = Math.max(r.xSplit - h9, 1)) : (m9 = r.startColumn + u2 - h9, g9 = r.xSplit + u2 - h9);
            const f4 = __spreadProps(__spreadValues({}, r), {
              startColumn: m9,
              xSplit: g9
            });
            return i(f4);
          }
          if (e.id === an.id) {
            const o3 = this._selectionManagerService.getCurrentSelections(), {
              fromRange: { startRow: s2 },
              toRange: { startRow: l4 }
            } = e.params, a4 = o3 == null ? void 0 : o3.filter(
              (p3) => p3.range.rangeType === ge.ROW && p3.range.startRow <= s2 && s2 <= p3.range.endRow
            );
            if (!(a4 != null && a4.length))
              return t3;
            const c2 = a4[0].range, d2 = __spreadProps(__spreadValues({}, c2), {
              startRow: l4,
              endRow: l4 + c2.endRow - c2.startRow
            });
            if (!r || r.startRow <= 0 || // move out of freeze
            c2.startRow >= r.startRow && d2.startRow >= r.startRow || // not move
            c2.startRow === d2.startRow || // move in freeze range
            c2.endRow < r.startRow && d2.startRow < r.startRow)
              return t3;
            const u2 = c2.endRow - c2.startRow + 1, h9 = Math.max(
              Math.min(r.startRow, c2.endRow + 1) - c2.startRow,
              0
            );
            let m9, g9;
            d2.startRow >= r.startRow ? (m9 = Math.max(r.startRow - h9, 1), g9 = Math.max(r.ySplit - h9, 1)) : (m9 = r.startRow + u2 - h9, g9 = r.ySplit + u2 - h9);
            const f4 = __spreadProps(__spreadValues({}, r), {
              startRow: m9,
              ySplit: g9
            });
            return i(f4);
          }
          if (e.id === gs.id || e.id === hs.id) {
            const o3 = e.params, s2 = o3.range;
            if (s2.rangeType === ge.COLUMN && s2.startColumn < r.startColumn) {
              const l4 = Math.min(r.startColumn, s2.endColumn + 1) - s2.startColumn, a4 = __spreadProps(__spreadValues({}, r), {
                startColumn: Math.max(1, r.startColumn - l4),
                xSplit: Math.max(1, r.xSplit - l4)
              });
              return i(a4);
            }
            if (o3.range.rangeType === ge.ROW && s2.startRow < r.startRow) {
              const l4 = Math.min(r.startRow, s2.endRow + 1) - s2.startRow, a4 = __spreadProps(__spreadValues({}, r), {
                startRow: Math.max(1, r.startRow - l4),
                ySplit: Math.max(1, r.ySplit - l4)
              });
              return i(a4);
            }
          }
          return t3;
        }
      })
    );
  }
  /**
   * Update freeze line position when some cmds cause sk change.
   */
  // TODO @lumixraku But there is a _zoomRefresh method? Duplicated?
  _commandExecutedListener() {
    this.disposeWithMe(
      // eslint-disable-next-line complexity
      this._commandService.onCommandExecuted((e) => {
        switch (e.id) {
          case st2.id:
          case Ln2.id:
            {
              const t3 = this._lastFreeze, r = this._context.unit, i = r.getActiveSheet(), o3 = e.params, { unitId: s2, subUnitId: l4 } = o3;
              if (!(s2 === r.getUnitId() && l4 === (i == null ? void 0 : i.getSheetId())))
                return;
              const a4 = i.getConfig().freeze;
              if (this._lastFreeze = a4, a4 == null)
                return;
              let c2 = 0;
              const { startRow: d2 = -1, startColumn: u2 = -1, ySplit: h9 = 0, xSplit: m9 = 0 } = a4;
              (!t3 || t3.startRow !== d2 || t3.ySplit !== h9) && (c2 |= 2), (!t3 || t3.startColumn !== u2 || t3.xSplit !== m9) && (c2 |= 1), o3.resetScroll === false && (c2 = 0), this._refreshFreeze(d2, u2, h9, m9, c2);
            }
            break;
          case nt2.id:
            {
              const t3 = this._getFreeze(), r = t3 && e.params.ranges.some((i) => i.startRow < t3.startRow);
              e.params && r && this._refreshCurrent();
            }
            break;
          case mt2.id:
            {
              const t3 = this._getFreeze();
              e.params && t3 && e.params.ranges.some(
                (r) => r.startColumn < t3.startColumn
              ) && this._refreshCurrent();
            }
            break;
          case er2.id:
            {
              const t3 = e.params, r = this._getFreeze();
              if (r && r.startRow > -1 && t3.rowsAutoHeightInfo.some((i) => i.row < r.startRow)) {
                const i = this._sheetSkeletonManagerService.currentSkeleton$.subscribe(() => {
                  this._refreshCurrent(), setTimeout(() => {
                    i.unsubscribe();
                  });
                });
              }
            }
            break;
          case sn.id:
          case on.id:
            {
              const t3 = e.params, r = this._getFreeze(), i = t3.ranges;
              r && r.startColumn > -1 && i.some((o3) => o3.startColumn < r.startColumn) && this._refreshCurrent();
            }
            break;
          case Tt.id:
          case Ut2.id:
            {
              const t3 = e.params, r = this._getFreeze(), i = t3.ranges;
              r && r.startRow > -1 && i.some((o3) => o3.startRow < r.startRow) && this._refreshCurrent();
            }
            break;
          case ca3.id:
          case da.id:
            this._refreshCurrent();
        }
      })
    );
  }
  _zoomRefresh() {
    const e = this._getSheetObject();
    if (e == null)
      return;
    const { scene: t3 } = e;
    this.disposeWithMe(t3.onTransformChange$.subscribeEvent((r) => {
      [x1.scale, x1.all].includes(r.type) && this._refreshCurrent();
    }));
  }
  _clearObserverEvent() {
    var t3, r;
    this._getSheetObject() != null && ((t3 = this._scenePointerMoveSub) == null || t3.unsubscribe(), (r = this._scenePointerUpSub) == null || r.unsubscribe(), this._scenePointerMoveSub = null, this._scenePointerUpSub = null);
  }
  _clearFreeze() {
    var t3, r, i, o3, s2, l4;
    (t3 = this._rowFreezeHeaderRect) == null || t3.dispose(), (r = this._rowFreezeMainRect) == null || r.dispose(), (i = this._columnFreezeHeaderRect) == null || i.dispose(), (o3 = this._columnFreezeMainRect) == null || o3.dispose(), this._getSheetObject() != null && ([this._freezeDownSubs, this._freezePointerEnterSubs, this._freezePointerLeaveSubs].forEach((a4) => {
      a4 == null || a4.unsubscribe();
    }), this._freezeDownSubs = null, this._freezePointerEnterSubs = null, this._freezePointerLeaveSubs = null, (s2 = this._scenePointerMoveSub) == null || s2.unsubscribe(), (l4 = this._scenePointerUpSub) == null || l4.unsubscribe(), this._scenePointerMoveSub = null, this._scenePointerUpSub = null);
  }
  _getPositionByIndex(e, t3) {
    var a4;
    if (this._getSheetObject() == null)
      return;
    const i = (a4 = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : a4.skeleton, o3 = i == null ? void 0 : i.getNoMergeCellWithCoordByIndex(e, t3);
    if (i == null)
      return;
    if (o3 != null && (!isNaN(o3.endX) || !isNaN(o3.endY)))
      return o3;
    const { rowHeaderWidthAndMarginLeft: s2, columnHeaderHeightAndMarginTop: l4 } = i;
    return {
      startX: s2,
      endX: s2,
      startY: l4,
      endY: l4
    };
  }
  _getFreeze() {
    var t3;
    const e = (t3 = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : t3.skeleton.getWorksheetConfig();
    if (e != null)
      return e.freeze;
  }
  _getSheetObject() {
    return $t4(this._context.unit, this._context);
  }
  /**
   * Core function of _refreshCurrent
   * @param startRow
   * @param startColumn
   * @param ySplit
   * @param xSplit
   * @param resetScroll
   */
  _refreshFreeze(e, t3, r, i, o3) {
    var l4;
    const s2 = {
      startRow: e,
      startColumn: t3,
      ySplit: r,
      xSplit: i
    };
    this._clearFreeze(), this._createFreeze(0, s2), this._createFreeze(1, s2), this._updateViewport(e, t3, r, i, o3), (l4 = this._getSheetObject()) == null || l4.spreadsheet.makeForceDirty();
  }
};
Lo4 = L_([
  dr4(1, Inject(he2)),
  dr4(2, Ds),
  dr4(3, Inject(z)),
  dr4(4, Inject(Et3)),
  dr4(5, Inject(Ji)),
  dr4(6, Inject(G)),
  dr4(7, Inject(Injector))
], Lo4);
var z_ = Object.getOwnPropertyDescriptor;
var j_ = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? z_(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var uc3 = (n3, e) => (t3, r) => e(t3, r, n3);
var Y_ = "__SpreadsheetHeaderMoveControllerBackground__";
var Z_ = "__SpreadsheetHeaderMoveControllerShapeLine__";
var G_ = "rgba(0, 0, 0, 0.1)";
var q_ = "rgb(119, 119, 119)";
var Q_ = 4;
var hc2 = rR("headerMovePermissionCheck");
var Wo = class extends Ve {
  constructor(e, t3, r, i) {
    super();
    _2(this, "_startOffsetX", Number.NEGATIVE_INFINITY);
    _2(this, "_startOffsetY", Number.NEGATIVE_INFINITY);
    _2(this, "_moveHelperBackgroundShape");
    _2(this, "_moveHelperLineShape");
    _2(this, "_headerPointerDownSubs");
    _2(this, "_headerPointerMoveSubs");
    _2(this, "_headerPointerLeaveSubs");
    _2(this, "_dragHeaderMoveSub");
    _2(this, "_scenePointerUpSub");
    _2(this, "_scrollTimer");
    _2(this, "_changeFromColumn", -1);
    _2(this, "_changeFromRow", -1);
    _2(this, "_changeToColumn", -1);
    _2(this, "_changeToRow", -1);
    _2(this, "interceptor", new sR({ HEADER_MOVE_PERMISSION_CHECK: hc2 }));
    _2(this, "_workbookSelections");
    this._context = e, this._sheetSkeletonManagerService = r, this._commandService = i, this._workbookSelections = t3.getWorkbookSelections(this._context.unitId), this._init();
  }
  dispose() {
    var e, t3, r, i, o3, s2, l4, a4;
    (e = this._moveHelperBackgroundShape) == null || e.dispose(), (t3 = this._moveHelperLineShape) == null || t3.dispose(), (r = this._headerPointerMoveSubs) == null || r.unsubscribe(), (i = this._headerPointerLeaveSubs) == null || i.unsubscribe(), (o3 = this._headerPointerDownSubs) == null || o3.unsubscribe(), this._headerPointerMoveSubs = null, this._headerPointerLeaveSubs = null, this._headerPointerDownSubs = null, (s2 = this._dragHeaderMoveSub) == null || s2.unsubscribe(), (l4 = this._scenePointerUpSub) == null || l4.unsubscribe(), this._dragHeaderMoveSub = null, this._scenePointerUpSub = null, (a4 = this._scrollTimer) == null || a4.dispose();
  }
  _init() {
    this._initialRowOrColumn(ge.ROW), this._initialRowOrColumn(ge.COLUMN);
  }
  // eslint-disable-next-line max-lines-per-function
  _initialRowOrColumn(e = ge.ROW) {
    const t3 = this._context.components.get(Ge5.COLUMN), r = this._context.components.get(Ge5.ROW), i = this._context.scene, o3 = e === ge.ROW ? r : t3, s2 = (c2) => {
      var v6, S;
      const d2 = (v6 = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : v6.skeleton;
      if (d2 == null)
        return;
      const u2 = (S = this._workbookSelections.getCurrentLastSelection()) == null ? void 0 : S.range;
      if (!u2 || !this.interceptor.fetchThroughInterceptors(hc2)(false, u2))
        return;
      const m9 = this._workbookSelections.getCurrentSelections(), { row: g9, column: f4 } = An4(c2.offsetX, c2.offsetY, i, d2);
      if (!fl3(
        m9,
        e === ge.ROW ? g9 : f4,
        e
      )) {
        i.resetCursor();
        return;
      }
      i.setCursor(v1.GRAB);
    }, l4 = () => {
      var c2, d2;
      (c2 = this._moveHelperBackgroundShape) == null || c2.hide(), (d2 = this._moveHelperLineShape) == null || d2.hide(), i.resetCursor();
    }, a4 = (c2, d2) => {
      var A4, x7;
      if (d2.isStopPropagation) return;
      const u2 = (A4 = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : A4.skeleton;
      if (u2 == null)
        return;
      const h9 = (x7 = this._workbookSelections.getCurrentLastSelection()) == null ? void 0 : x7.range;
      if (!h9 || !this.interceptor.fetchThroughInterceptors(hc2)(false, h9))
        return;
      const { offsetX: g9, offsetY: f4 } = c2, p3 = i.getCoordRelativeToViewport(U.FromArray([g9, f4])), { x: v6, y: S } = p3;
      this._startOffsetX = v6, this._startOffsetY = S;
      const { row: w6, column: C } = An4(c2.offsetX, c2.offsetY, i, u2);
      let I6;
      e === ge.ROW ? (this._changeFromRow = w6, I6 = OE.Y) : (this._changeFromColumn = C, I6 = OE.X);
      const R9 = this._workbookSelections.getCurrentSelections(), y6 = fl3(
        R9,
        e === ge.ROW ? w6 : C,
        e
      );
      if (!y6)
        return;
      const E3 = i.getScrollXYInfoByViewport(
        U.FromArray([this._startOffsetX, this._startOffsetY])
      );
      this._newBackgroundAndLine(), i.setCursor(v1.GRABBING), i.disableObjectsEvent();
      let M10 = false, T10;
      const P8 = () => {
        if (M10)
          return;
        T10 = y0.create(i, I6), this._scrollTimer = T10;
        const H6 = i.getViewport(k2.VIEW_MAIN);
        T10.startScroll(v6, S, H6), M10 = true;
      };
      this._dragHeaderMoveSub = i.onPointerMove$.subscribeEvent((H6) => {
        P8();
        const { offsetX: V7, offsetY: D5 } = H6, { x: B5, y: F7 } = i.getCoordRelativeToViewport(
          U.FromArray([V7, D5])
        );
        this._rowColumnMoving(
          B5,
          F7,
          y6,
          E3,
          e
        ), T10.scrolling(B5, F7, () => {
          this._rowColumnMoving(
            B5,
            F7,
            y6,
            E3,
            e
          );
        });
      }), this._scenePointerUpSub = i.onPointerUp$.subscribeEvent(() => {
        var V7, D5, B5;
        this._disposeBackgroundAndLine(), i.resetCursor(), i.enableObjectsEvent(), this._clearObserverEvent(), (V7 = this._scrollTimer) == null || V7.dispose();
        const H6 = this._workbookSelections.getCurrentSelections();
        if (e === ge.ROW) {
          if (this._changeFromRow !== this._changeToRow && this._changeToRow !== -1) {
            const z5 = (D5 = ((H6 == null ? void 0 : H6.filter(
              (Z9) => Z9.range.rangeType === ge.ROW && Z9.range.startRow <= this._changeFromRow && this._changeFromRow <= Z9.range.endRow
            )) || [])[0]) == null ? void 0 : D5.range;
            z5 && this._commandService.executeCommand(an.id, {
              fromRange: z5,
              toRange: __spreadProps(__spreadValues({}, z5), {
                startRow: this._changeToRow,
                endRow: this._changeToRow + z5.endRow - z5.startRow
              })
            });
          }
          this._changeToRow = this._changeFromRow = -1;
        } else {
          if (this._changeFromColumn !== this._changeToColumn && this._changeToColumn !== -1) {
            const z5 = (B5 = ((H6 == null ? void 0 : H6.filter(
              (Z9) => Z9.range.rangeType === ge.COLUMN && Z9.range.startColumn <= this._changeFromColumn && this._changeFromColumn <= Z9.range.endColumn
            )) || [])[0]) == null ? void 0 : B5.range;
            z5 && this._commandService.executeCommand(un.id, {
              fromRange: z5,
              toRange: __spreadProps(__spreadValues({}, z5), {
                startColumn: this._changeToColumn,
                endColumn: this._changeToColumn + z5.endColumn - z5.startColumn
              })
            });
          }
          this._changeToColumn = this._changeFromColumn = -1;
        }
      });
    };
    this._headerPointerMoveSubs = new Subscription(), this._headerPointerMoveSubs.add(o3.onPointerMove$.subscribeEvent(s2)), this._headerPointerLeaveSubs = new Subscription(), this._headerPointerLeaveSubs.add(o3 == null ? void 0 : o3.onPointerLeave$.subscribeEvent(l4)), this._headerPointerDownSubs = new Subscription(), this._headerPointerDownSubs.add(o3 == null ? void 0 : o3.onPointerDown$.subscribeEvent(a4));
  }
  // eslint-disable-next-line max-lines-per-function
  _rowColumnMoving(e, t3, r, i, o3) {
    var F7, z5, Z9, de3, Re5, we6, ke4;
    const s2 = this._context.scene, l4 = (F7 = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : F7.skeleton;
    if (l4 == null)
      return;
    const { rowHeaderWidth: a4, columnHeaderHeight: c2, rowTotalHeight: d2, columnTotalWidth: u2 } = l4, h9 = s2.getViewportScrollXY(s2.getViewport(k2.VIEW_MAIN)), { scaleX: m9, scaleY: g9 } = s2.getAncestorScale(), f4 = l4.getCellIndexByOffset(
      e,
      t3,
      m9,
      g9,
      h9
    ), { row: p3, column: v6 } = f4, S = l4.getNoMergeCellWithCoordByIndex(p3, v6), { startX: w6, startY: C, endX: I6, endY: R9 } = S, y6 = this._sheetSkeletonManagerService.attachRangeWithCoord(r.range);
    if (y6 == null)
      return;
    const E3 = Math.max(m9, m9), {
      startX: M10,
      endX: T10,
      startY: P8,
      endY: A4,
      startRow: x7,
      startColumn: H6,
      endRow: V7,
      endColumn: D5
    } = y6;
    o3 === ge.ROW ? (z5 = this._moveHelperBackgroundShape) == null || z5.transformByState({
      height: A4 - P8,
      width: u2 + a4,
      left: 0,
      top: P8 + (t3 - this._startOffsetY) / E3 + h9.y - i.y
    }) : (Z9 = this._moveHelperBackgroundShape) == null || Z9.transformByState({
      height: d2 + c2,
      width: T10 - M10,
      left: M10 + (e - this._startOffsetX) / E3 + h9.x - i.x,
      top: 0
    }), (de3 = this._moveHelperBackgroundShape) == null || de3.show();
    const B5 = Q_ / E3;
    if (o3 === ge.ROW) {
      let G5 = 0;
      if (p3 <= x7)
        G5 = C - B5 / 2, this._changeToRow = p3;
      else if (p3 > V7)
        G5 = R9 - B5 / 2, this._changeToRow = p3 + 1;
      else
        return;
      (Re5 = this._moveHelperLineShape) == null || Re5.transformByState({
        height: B5,
        width: u2,
        left: a4,
        top: G5
      });
    } else {
      let G5 = 0;
      if (v6 <= H6)
        G5 = w6 - B5 / 2, this._changeToColumn = v6;
      else if (v6 > D5)
        G5 = I6 - B5 / 2, this._changeToColumn = v6 + 1;
      else
        return;
      (we6 = this._moveHelperLineShape) == null || we6.transformByState({
        height: d2,
        width: B5,
        left: G5,
        top: c2
      });
    }
    (ke4 = this._moveHelperLineShape) == null || ke4.show();
  }
  _clearObserverEvent() {
    var e, t3;
    (e = this._dragHeaderMoveSub) == null || e.unsubscribe(), (t3 = this._scenePointerUpSub) == null || t3.unsubscribe(), this._dragHeaderMoveSub = null, this._scenePointerUpSub = null;
  }
  _newBackgroundAndLine() {
    const e = this._context.scene;
    this._moveHelperBackgroundShape = new I1(Y_, {
      fill: G_,
      evented: false,
      zIndex: 100
    }), this._moveHelperLineShape = new I1(Z_, {
      fill: q_,
      evented: false,
      zIndex: 100
    }), e.addObjects(
      [this._moveHelperBackgroundShape, this._moveHelperLineShape],
      nr5
    );
  }
  _disposeBackgroundAndLine() {
    var e, t3;
    (e = this._moveHelperBackgroundShape) == null || e.dispose(), (t3 = this._moveHelperLineShape) == null || t3.dispose();
  }
};
Wo = j_([
  uc3(1, Inject(z)),
  uc3(2, Inject(he2)),
  uc3(3, Ds)
], Wo);
var ed2 = ((n3) => (n3[n3.VERTICAL = 0] = "VERTICAL", n3[n3.HORIZONTAL = 1] = "HORIZONTAL", n3))(ed2 || {});
var K_ = "rgba(120, 120, 120, 0.01)";
var gc2 = "rgb(68, 71, 70)";
var uo6 = 12;
var J_ = 44;
var td2 = 4;
var Lh2 = class extends x3 {
  constructor(t3, r) {
    super(t3, r);
    _2(this, "_size", uo6);
    _2(this, "_color", gc2);
    _2(this, "_mode", 0);
    this.setShapeProps(r);
  }
  get size() {
    return this._size;
  }
  get mode() {
    return this._mode;
  }
  get color() {
    return this._color;
  }
  _draw(t3) {
    const r = this.getScene();
    if (!r) return;
    const { scaleX: i, scaleY: o3 } = r.getAncestorScale(), s2 = Math.max(i, o3), l4 = uo6 / s2, a4 = td2 / s2;
    let { width: c2, height: d2 } = this, u2 = 0, h9 = 0;
    this.mode === 0 ? (c2 = a4, u2 = l4 - a4) : (d2 = a4, h9 = l4 - a4), I1.drawWith(t3, {
      width: this.width,
      height: this.height,
      left: 0,
      top: 0,
      fill: K_
    }), I1.drawWith(t3, {
      width: c2,
      height: d2,
      fill: gc2,
      radius: a4
    }), t3.save(), t3.transform(1, 0, 0, 1, u2, h9), I1.drawWith(t3, {
      width: c2,
      height: d2,
      fill: gc2,
      radius: a4
    }), t3.restore();
  }
  setShapeProps(t3) {
    return t3 != null && t3.size && (this._size = t3.size), t3 != null && t3.mode && (this._mode = t3.mode), t3 != null && t3.color && (this._color = t3.color), this.mode === 0 ? this.transformByState({
      width: uo6,
      height: this.size
    }) : this.transformByState({
      width: this.size,
      height: uo6
    }), this;
  }
};
var $_ = Object.getOwnPropertyDescriptor;
var eR2 = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? $_(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var mc3 = (n3, e) => (t3, r) => e(t3, r, n3);
var tR2 = "__SpreadsheetHeaderResizeControllerShapeRow__";
var nR3 = "__SpreadsheetHeaderResizeControllerShapeColumn__";
var Wh2 = "__SpreadsheetHeaderResizeControllerShapeHelper__";
var Bh2 = "rgb(199, 199, 199)";
var rR2 = 2;
var fc2 = rR("headerResizePermissionCheck");
var Bo = class extends Ve {
  constructor(e, t3, r, i) {
    super();
    _2(this, "_currentRow", 0);
    _2(this, "_currentColumn", 0);
    _2(this, "_rowResizeRect");
    _2(this, "_columnResizeRect");
    _2(this, "_headerPointerSubs");
    _2(this, "_scenePointerMoveSub");
    _2(this, "_scenePointerUpSub");
    _2(this, "_resizeHelperShape");
    _2(this, "_startOffsetX", Number.POSITIVE_INFINITY);
    _2(this, "_startOffsetY", Number.POSITIVE_INFINITY);
    _2(this, "interceptor", new sR({ HEADER_RESIZE_PERMISSION_CHECK: fc2 }));
    this._context = e, this._sheetSkeletonManagerService = t3, this._selectionManagerService = r, this._commandService = i, this._init();
  }
  dispose() {
    var e, t3, r;
    (e = this._rowResizeRect) == null || e.dispose(), this._rowResizeRect = null, (t3 = this._columnResizeRect) == null || t3.dispose(), this._columnResizeRect = null, (r = this._headerPointerSubs) == null || r.unsubscribe(), this._headerPointerSubs = null;
  }
  _init() {
    const e = this._context.scene;
    this._rowResizeRect = new Lh2(tR2, {
      visible: false,
      mode: ed2.HORIZONTAL,
      zIndex: 100
    }), this._columnResizeRect = new Lh2(nR3, {
      visible: false,
      mode: ed2.VERTICAL,
      zIndex: 100
    }), e.addObjects([this._rowResizeRect, this._columnResizeRect], nr5), this._initialHover(
      0
      /* ROW */
    ), this._initialHover(
      1
      /* COLUMN */
    ), this._initialHoverResize(
      0
      /* ROW */
    ), this._initialHoverResize(
      1
      /* COLUMN */
    );
  }
  _initialHover(e = 0) {
    const t3 = this._context.components.get(Ge5.COLUMN), r = this._context.components.get(Ge5.ROW), i = this._context.scene, o3 = e === 0 ? r : t3, s2 = (a4, c2) => {
      var d2, u2;
      (d2 = this._rowResizeRect) == null || d2.hide(), (u2 = this._columnResizeRect) == null || u2.hide();
    }, l4 = (a4, c2) => {
      var E3;
      const d2 = (E3 = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : E3.skeleton;
      if (d2 == null || this._rowResizeRect == null || this._columnResizeRect == null)
        return;
      const { rowHeaderWidth: u2, columnHeaderHeight: h9 } = d2, { startX: m9, startY: g9, endX: f4, endY: p3, row: v6, column: S } = An4(
        a4.offsetX,
        a4.offsetY,
        i,
        d2
      ), w6 = Vs2(a4.offsetX, a4.offsetY, i), { scaleX: C, scaleY: I6 } = i.getAncestorScale(), R9 = Math.max(C, I6), y6 = uo6 / R9;
      if (e === 0) {
        let M10 = g9 - y6 / 2;
        if (w6.y <= g9 + y6 / 2 && w6.y >= g9)
          this._currentRow = v6 - 1;
        else if (w6.y >= p3 - y6 / 2 && w6.y <= p3)
          this._currentRow = v6, M10 = p3 - y6 / 2;
        else {
          this._rowResizeRect.hide();
          return;
        }
        if (this._currentRow === -1)
          return;
        if (!this.interceptor.fetchThroughInterceptors(fc2)(null, { row: this._currentRow }))
          return false;
        const P8 = Math.min(J_, u2 / 3);
        this._rowResizeRect.transformByState({
          left: u2 / 2 - P8 / 2,
          top: M10
        }), this._rowResizeRect.setShapeProps({
          size: P8
        }), this._rowResizeRect.show();
      } else {
        let M10 = m9 - y6 / 2;
        if (w6.x <= m9 + y6 / 2 && w6.x >= m9)
          this._currentColumn = S - 1;
        else if (w6.x >= f4 - y6 / 2 && w6.x <= f4)
          this._currentColumn = S, M10 = f4 - y6 / 2;
        else {
          this._columnResizeRect.hide();
          return;
        }
        if (this._currentColumn === -1)
          return;
        if (!this.interceptor.fetchThroughInterceptors(fc2)(null, { col: this._currentColumn }))
          return false;
        const P8 = h9 * 0.7;
        this._columnResizeRect.transformByState({
          left: M10,
          top: h9 / 2 - P8 / 2
        }), this._columnResizeRect.setShapeProps({
          size: P8
        }), this._columnResizeRect.show();
      }
    };
    this._headerPointerSubs = new Subscription(), this._headerPointerSubs.add(o3 == null ? void 0 : o3.onPointerMove$.subscribeEvent(l4)), this._headerPointerSubs.add(o3 == null ? void 0 : o3.onPointerLeave$.subscribeEvent(s2));
  }
  _initialHoverResize(e = 0) {
    const t3 = this._context.scene, r = e === 0 ? this._rowResizeRect : this._columnResizeRect;
    r != null && (this.disposeWithMe(
      r.onPointerEnter$.subscribeEvent(() => {
        r != null && (r.show(), t3.setCursor(
          e === 0 ? v1.ROW_RESIZE : v1.COLUMN_RESIZE
        ));
      })
    ), this.disposeWithMe(
      r.onPointerLeave$.subscribeEvent(() => {
        r != null && (r.hide(), t3.resetCursor());
      })
    ), this.disposeWithMe(
      r.onPointerDown$.subscribeEvent((i) => {
        var D5, B5, F7, z5, Z9, de3, Re5;
        const o3 = (D5 = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : D5.skeleton;
        if (o3 == null) return;
        const s2 = this._context.scene, l4 = s2.getEngine(), a4 = (l4 == null ? void 0 : l4.height) || 0, c2 = (l4 == null ? void 0 : l4.width) || 0, d2 = s2.getViewport(k2.VIEW_MAIN), u2 = (((F7 = (B5 = d2 == null ? void 0 : d2.getScrollBar()) == null ? void 0 : B5.horizonScrollTrack) == null ? void 0 : F7.height) || 0) + 10, h9 = (((Z9 = (z5 = d2 == null ? void 0 : d2.getScrollBar()) == null ? void 0 : z5.verticalScrollTrack) == null ? void 0 : Z9.width) || 0) + 10, m9 = Vs2(i.offsetX, i.offsetY, s2), { scaleX: g9, scaleY: f4 } = s2.getAncestorScale();
        this._startOffsetX = m9.x, this._startOffsetY = m9.y;
        const p3 = o3.getOffsetByColumn(this._currentColumn), v6 = o3.getOffsetByRow(this._currentRow), S = o3.getNoMergeCellWithCoordByIndex(this._currentRow, this._currentColumn);
        let w6 = false, C = 0, I6 = 0;
        const { columnTotalWidth: R9, rowHeaderWidth: y6, rowTotalHeight: E3, columnHeaderHeight: M10 } = o3, T10 = c2 > R9 + y6 ? c2 : R9 + y6, P8 = a4 > E3 + M10 ? a4 : E3 + M10, A4 = Math.max(g9, f4), x7 = td2 / A4;
        e === 0 ? this._resizeHelperShape = new I1(Wh2, {
          width: T10,
          height: x7,
          fill: Bh2,
          left: 0,
          top: v6 - x7 / 2
        }) : this._resizeHelperShape = new I1(Wh2, {
          width: x7,
          height: P8,
          fill: Bh2,
          left: p3 - x7 / 2,
          top: 0
        });
        const H6 = ((de3 = this._columnResizeRect) == null ? void 0 : de3.left) || 0, V7 = ((Re5 = this._rowResizeRect) == null ? void 0 : Re5.top) || 0;
        s2.addObject(this._resizeHelperShape, nr5), s2.disableObjectsEvent(), this._scenePointerMoveSub = s2.onPointerMove$.subscribeEvent((we6) => {
          var it5, ot6, vt4, wt4, Wn5, Bn7;
          const ke4 = s2.getCoordRelativeToViewport(
            U.FromArray([this._startOffsetX, this._startOffsetY])
          ), G5 = s2.getScrollXYInfoByViewport(ke4, d2), ee5 = Vs2(we6.offsetX, we6.offsetY, s2), { x: re5, y: fe5 } = ee5, { scaleX: Xe9, scaleY: ge5 } = s2.getAncestorScale(), be4 = Math.max(Xe9, ge5), ae5 = td2 / be4;
          C = re5 - this._startOffsetX - ae5 / 2, I6 = fe5 - this._startOffsetY - ae5 / 2, Math.abs(e === 0 ? I6 : C) >= rR2 && (w6 = true), e === 0 ? (I6 > a4 - u2 + G5.y - S.startY && (I6 = a4 - u2 + G5.y - S.startY), I6 < -(S.endY - S.startY) + 2 && (I6 = -(S.endY - S.startY) + 2), w6 && ((it5 = this._resizeHelperShape) == null || it5.transformByState({
            top: v6 + I6
          }), (ot6 = this._rowResizeRect) == null || ot6.transformByState({
            top: V7 + I6 + ae5 / 2
          }), (vt4 = this._rowResizeRect) == null || vt4.show(), s2.setCursor(v1.ROW_RESIZE))) : (C > c2 - h9 + G5.x - S.startX && (C = c2 - h9 + G5.x - S.startX), C < -(S.endX - S.startX) + 2 && (C = -(S.endX - S.startX) + 2), w6 && ((wt4 = this._resizeHelperShape) == null || wt4.transformByState({
            left: p3 + C
          }), (Wn5 = this._columnResizeRect) == null || Wn5.transformByState({
            left: H6 + C + ae5 / 2
          }), (Bn7 = this._columnResizeRect) == null || Bn7.show(), s2.setCursor(v1.COLUMN_RESIZE)));
        }), this._scenePointerUpSub = s2.onPointerUp$.subscribeEvent((we6) => {
          var G5, ee5, re5;
          const ke4 = this._context.scene;
          this._clearObserverEvent(), (G5 = this._resizeHelperShape) == null || G5.dispose(), this._resizeHelperShape = null, ke4.enableObjectsEvent(), w6 && (ke4.resetCursor(), (ee5 = this._rowResizeRect) == null || ee5.hide(), (re5 = this._columnResizeRect) == null || re5.hide(), e === 0 ? this._commandService.executeCommand(Gn.id, {
            deltaY: I6,
            anchorRow: this._currentRow
          }) : this._commandService.executeCommand(
            Fn4.id,
            {
              deltaX: C,
              anchorCol: this._currentColumn
            }
          ));
        });
      })
    ), this.disposeWithMe(
      r.onDblclick$.subscribeEvent(() => {
        var d2, u2, h9;
        this._context.scene.resetCursor();
        const o3 = (d2 = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : d2.skeleton;
        if (!o3) return;
        const s2 = 0, l4 = 0, a4 = o3.worksheet.getRowCount() - 1 || 0, c2 = o3.worksheet.getColumnCount() - 1 || 0;
        switch (e) {
          case 1: {
            const m9 = this._selectionManagerService.getCurrentSelections(), g9 = [];
            for (let f4 = 0; f4 < m9.length; f4++) {
              const p3 = m9[f4];
              p3.range.rangeType === ge.COLUMN && this._currentColumn <= p3.range.endColumn && this._currentColumn >= p3.range.startColumn && g9.push({
                startColumn: p3.range.startColumn,
                endColumn: p3.range.endColumn,
                startRow: s2,
                endRow: a4
              });
            }
            g9.length === 0 && g9.push({
              startColumn: this._currentColumn,
              endColumn: this._currentColumn,
              startRow: s2,
              endRow: a4
            }), this._commandService.executeCommand(
              ls2.id,
              { ranges: g9 }
            ), (u2 = this._columnResizeRect) == null || u2.hide();
            break;
          }
          case 0:
            this._commandService.executeCommand(
              no.id,
              {
                ranges: [{
                  startRow: this._currentRow,
                  endRow: this._currentRow,
                  startColumn: l4,
                  endColumn: c2
                }]
              }
            ), (h9 = this._rowResizeRect) == null || h9.hide();
            break;
        }
      })
    ));
  }
  _clearObserverEvent() {
    var e, t3;
    (e = this._scenePointerMoveSub) == null || e.unsubscribe(), (t3 = this._scenePointerUpSub) == null || t3.unsubscribe(), this._scenePointerMoveSub = null, this._scenePointerUpSub = null;
  }
};
Bo = eR2([
  mc3(1, Inject(he2)),
  mc3(2, Inject(z)),
  mc3(3, Ds)
], Bo);
var iR = Object.getOwnPropertyDescriptor;
var oR = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? iR(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var to4 = (n3, e) => (t3, r) => e(t3, r, n3);
var sR2 = 60;
var vl2 = class extends ER {
  constructor(e, t3, r, i, o3, s2) {
    super();
    _2(this, "_renderMetric$", new Subject());
    _2(this, "renderMetric$", this._renderMetric$.asObservable());
    _2(this, "_renderFrameTimeMetric", null);
    _2(this, "_renderFrameTags", {});
    _2(this, "_afterRenderMetric$", new Subject());
    this._context = e, this._configService = t3, this._sheetSkeletonManagerService = r, this._sheetRenderService = i, this._commandService = o3, this._telemetryService = s2, this._addNewRender(), this._initRenderMetricSubscriber();
  }
  _addNewRender() {
    const { scene: e, engine: t3, unit: r } = this._context;
    this._addComponent(r), this._initRerenderScheduler(), this._initCommandListener();
    const i = this._context.unit.getActiveSheet();
    if (!i)
      throw new Error("No active sheet found");
    const o3 = i.getSheetId();
    this._sheetSkeletonManagerService.setCurrent({ sheetId: o3 });
    const s2 = () => e.render();
    this.disposeWithMe(this._context.activated$.subscribe((l4) => {
      l4 ? t3.runRenderLoop(s2) : t3.stopRenderLoop(s2);
    }));
  }
  _initRenderMetricSubscriber() {
    const { engine: e } = this._context;
    e.beginFrame$.subscribe(() => {
      this._renderFrameTimeMetric = null, this._renderFrameTags = {};
    }), e.endFrame$.subscribe(() => {
      this._renderFrameTimeMetric && Object.keys(this._renderFrameTimeMetric).filter((i) => i.startsWith(Cb)).length > 0 && this._afterRenderMetric$.next({
        frameTimeMetric: this._renderFrameTimeMetric,
        tags: this._renderFrameTags
      });
    }), e.renderFrameTimeMetric$.subscribe(([r, i]) => {
      this._renderFrameTimeMetric || (this._renderFrameTimeMetric = {}), this._renderFrameTimeMetric[r] || (this._renderFrameTimeMetric[r] = []), this._renderFrameTimeMetric[r].push(Math.round(i * 100) / 100);
    }), e.renderFrameTags$.subscribe(([r, i]) => {
      this._renderFrameTags[r] = i;
    });
    const t3 = [];
    this._afterRenderMetric$.pipe(withLatestFrom(e.endFrame$)).subscribe(([r, i]) => {
      t3.push(__spreadValues(__spreadValues({
        FPS: i.FPS,
        elapsedTime: i.elapsedTime,
        frameTime: Math.round(i.frameTime * 100) / 100
      }, r.frameTimeMetric), r.tags)), t3.length > sR2 && (this._captureRenderMetric(t3), t3.length = 0);
    });
  }
  /**
   * Send render metric to telemetry service
   * @param frameInfoList
   */
  _captureRenderMetric(e) {
    var u2;
    const t3 = e;
    if (t3.length === 0) return;
    const r = (h9) => {
      let m9 = 0;
      const f4 = Object.entries(h9).filter(([v6, S]) => Array.isArray(S)).map(([v6]) => v6).reduce((v6, S) => {
        const w6 = h9[S].reduce((C, I6) => C + I6, 0);
        return v6[S] = w6, v6;
      }, {});
      return Object.keys(h9).filter((v6) => v6.startsWith(Cb)).forEach((v6) => {
        m9 += f4[v6];
      }), __spreadProps(__spreadValues({}, f4), { extensionTotal: m9 });
    }, i = e.map((h9) => __spreadValues(__spreadValues({}, h9), r(h9))), s2 = ((h9) => Object.entries(h9[0]).filter(([f4, p3]) => !["elapsedTime"].includes(f4)).filter(([f4, p3]) => typeof p3 == "number").map(([f4]) => f4).reduce((f4, p3) => {
      const v6 = h9.map((I6) => I6[p3]), S = Math.max(...v6), w6 = Math.min(...v6), C = v6.reduce((I6, R9) => I6 + R9, 0) / v6.length;
      return f4[p3] = {
        max: Math.round(S * 100) / 100,
        min: Math.round(w6 * 100) / 100,
        avg: Math.round(C * 100) / 100
      }, f4;
    }, {}))(i), l4 = t3[t3.length - 1].elapsedTime, a4 = this._context.unit.getActiveSheet().getSheetId(), c2 = this._context.unit.getUnitId(), d2 = __spreadValues({ sheetId: a4, unitId: c2, elapsedTimeToStart: l4 }, s2);
    this._renderMetric$.next(d2), (u2 = this._telemetryService) == null || u2.capture("sheet_render_cost", d2);
  }
  _addComponent(e) {
    const { scene: t3, components: r } = this._context, i = e.getActiveSheet(), o3 = new dA(Ge5.MAIN);
    this._addViewport(i);
    const s2 = new sA(Ge5.ROW), l4 = new qB(Ge5.COLUMN), a4 = new I1(Ge5.LEFT_TOP, {
      zIndex: 2,
      left: -1,
      top: -1,
      fill: "rgb(248, 249, 250)",
      stroke: "rgb(217, 217, 217)",
      strokeWidth: 1
    });
    this._context.mainComponent = o3, r.set(Ge5.MAIN, o3), r.set(Ge5.ROW, s2), r.set(Ge5.COLUMN, l4), r.set(Ge5.LEFT_TOP, a4), t3.addObjects([o3], Zu2), t3.addObjects(
      [s2, l4, a4],
      nr5
    ), t3.enableLayerCache(Zu2, nr5);
  }
  _initViewports(e, t3, r) {
    const s2 = new vA(k2.VIEW_MAIN, e, {
      left: t3.width,
      top: r.height,
      bottom: 0,
      right: 0,
      isWheelPreventDefaultX: true,
      allowCache: true,
      bufferEdgeX: 100,
      bufferEdgeY: 100
    }), l4 = new vA(k2.VIEW_MAIN_LEFT_TOP, e, {
      isWheelPreventDefaultX: true,
      active: false,
      allowCache: true,
      bufferEdgeX: 0,
      bufferEdgeY: 0
    }), a4 = new vA(k2.VIEW_MAIN_LEFT, e, {
      isWheelPreventDefaultX: true,
      active: false,
      allowCache: true,
      bufferEdgeX: 0,
      bufferEdgeY: 100
    }), c2 = new vA(k2.VIEW_MAIN_TOP, e, {
      isWheelPreventDefaultX: true,
      active: false,
      allowCache: true,
      bufferEdgeX: 100,
      bufferEdgeY: 0
    }), d2 = new vA(k2.VIEW_ROW_TOP, e, {
      active: false,
      isWheelPreventDefaultX: true
    }), u2 = new vA(k2.VIEW_ROW_BOTTOM, e, {
      left: 0,
      top: r.height,
      bottom: 0,
      width: t3.width + 1,
      isWheelPreventDefaultX: true
    }), h9 = new vA(k2.VIEW_COLUMN_LEFT, e, {
      active: false,
      isWheelPreventDefaultX: true
    }), m9 = new vA(k2.VIEW_COLUMN_RIGHT, e, {
      left: t3.width,
      top: 0,
      height: r.height + 1,
      right: 0,
      isWheelPreventDefaultX: true
    }), g9 = new vA(k2.VIEW_LEFT_TOP, e, {
      left: 0,
      top: 0,
      width: t3.width,
      height: r.height,
      isWheelPreventDefaultX: true
    });
    return {
      viewMain: s2,
      viewLeftTop: g9,
      viewMainLeftTop: l4,
      viewMainLeft: a4,
      viewMainTop: c2,
      viewColumnLeft: h9,
      viewRowTop: d2,
      viewRowBottom: u2,
      viewColumnRight: m9
    };
  }
  /**
   *
   * initViewport & wheel event
   * +-----------------+--------------------+-------------------+
   * |  VIEW_LEFT_TOP  |  VIEW_COLUMN_LEFT  | VIEW_COLUMN_RIGHT |
   * +-----------------+--------------------+-------------------+
   * |  VIEW_ROW_TOP   | VIEW_MAIN_LEFT_TOP |   VIEW_MAIN_TOP   |
   * +-----------------+--------------------+-------------------+
   * | VIEW_ROW_BOTTOM |   VIEW_MAIN_LEFT   |     VIEW_MAIN     |
   * +-----------------+--------------------+-------------------+
   */
  _addViewport(e) {
    const t3 = this._context.scene, { rowHeader: r, columnHeader: i } = e.getConfig(), { viewMain: o3 } = this._initViewports(t3, r, i), s2 = this._configService.getConfig(Tt2), l4 = s2 == null ? void 0 : s2.scrollConfig;
    return new D8(o3, l4), t3.attachControl(), o3;
  }
  _initRerenderScheduler() {
    this.disposeWithMe(this._sheetSkeletonManagerService.currentSkeleton$.subscribe((e) => {
      if (!e) return null;
      const { skeleton: t3, sheetId: r } = e, i = this._context.unit, o3 = i == null ? void 0 : i.getSheetBySheetId(r);
      if (i == null || o3 == null) return;
      const { mainComponent: s2, components: l4 } = this._context, a4 = s2, c2 = l4.get(Ge5.ROW), d2 = l4.get(Ge5.COLUMN), u2 = l4.get(Ge5.LEFT_TOP), { rowHeaderWidth: h9, columnHeaderHeight: m9 } = t3;
      a4 == null || a4.updateSkeleton(t3), c2 == null || c2.updateSkeleton(t3), d2 == null || d2.updateSkeleton(t3), u2 == null || u2.transformByState({
        width: h9,
        height: m9
      });
    }));
  }
  _initCommandListener() {
    this.disposeWithMe(this._commandService.onCommandExecuted((e) => {
      const { unit: t3 } = this._context, { id: r } = e;
      if (bh2.includes(r) || this._sheetRenderService.checkMutationShouldTriggerRerender(r)) {
        const i = e.params, { unitId: o3, subUnitId: s2 } = i, l4 = t3.getActiveSheet();
        if (!l4) return;
        const a4 = this._context.unitId, c2 = l4.getSheetId();
        if (o3 !== a4 || s2 !== c2)
          return;
        this._sheetSkeletonManagerService.makeDirty({
          sheetId: c2,
          commandId: r
        }, true), this._sheetSkeletonManagerService.setCurrent({
          sheetId: c2,
          commandId: r
        });
      } else Eh2.includes(r) && this._sheetSkeletonManagerService.reCalculate();
      e.type === Ls.MUTATION && this._markUnitDirty(e);
    }));
  }
  _markUnitDirty(e) {
    if (e.id.substring(0, 3) === "doc")
      return;
    const { mainComponent: t3, scene: r } = this._context;
    if (e.id === Sn.id && e.params.stageInfo != null || (t3 && t3.makeDirty(), r.makeDirty(), !e.params)) return;
    const i = e.params, o3 = this._spreadsheetViewports(r);
    if (e.id === ee2.id && i.cellValue) {
      const s2 = this._cellValueToRange(i.cellValue), l4 = this._rangeToBounds([s2]);
      this._markViewportDirty(o3, l4), t3.setDirtyArea(l4);
    }
    if (e.id === wt2.id && i.from && i.to) {
      const s2 = i.fromRange || this._cellValueToRange(i.from.value), l4 = i.toRange || this._cellValueToRange(i.to.value), a4 = this._rangeToBounds([s2, l4]);
      this._markViewportDirty(o3, a4), t3.setDirtyArea(a4);
    }
  }
  /**
   * cellValue data structure:
   * {[row]: { [col]: value}}
   * @param cellValue
   * @returns IRange
   */
  _cellValueToRange(e) {
    let t3 = 0, r = 0, i = 0, o3 = 0;
    for (const [d2, u2] of Object.entries(e)) {
      for (const h9 in u2)
        t3 > Number(h9) && (t3 = Number(h9)), r < Number(h9) && (r = Number(h9));
      i > Number(d2) && (i = Number(d2)), o3 < Number(d2) && (o3 = Number(d2));
    }
    return {
      startRow: i,
      endRow: o3,
      startColumn: t3,
      endColumn: r
    };
  }
  _rangeToBounds(e) {
    const t3 = this._sheetSkeletonManagerService.getCurrentParam().skeleton, { rowHeightAccumulation: r, columnWidthAccumulation: i, rowHeaderWidth: o3, columnHeaderHeight: s2 } = t3, l4 = [];
    for (const a4 of e) {
      const { startRow: c2, endRow: d2, startColumn: u2, endColumn: h9 } = a4, m9 = c2 === 0 ? 0 : r[c2 - 1] + s2, g9 = r[d2] + s2, f4 = u2 === 0 ? 0 : i[u2 - 1] + o3, p3 = i[h9] + o3;
      l4.push({ top: m9, left: f4, bottom: g9, right: p3, width: p3 - f4, height: g9 - m9 });
    }
    return l4;
  }
  _markViewportDirty(e, t3) {
    const r = e.filter((i) => i.isActive && i.cacheBound);
    for (const i of r)
      for (const o3 of t3)
        Cn.hasIntersectionBetweenTwoRect(i.cacheBound, o3) && i.markDirty(true);
  }
  _spreadsheetViewports(e) {
    return e.getViewports().filter((t3) => ["viewMain", "viewMainLeftTop", "viewMainTop", "viewMainLeft"].includes(t3.viewportKey));
  }
};
vl2 = oR([
  to4(1, Inject(xs)),
  to4(2, Inject(he2)),
  to4(3, Inject(rr4)),
  to4(4, Ds),
  to4(5, Optional(t))
], vl2);
var lR = ({ className: n3 }) => (0, import_jsx_runtime.jsxs)("svg", { className: n3, width: "120", height: "2", viewBox: "0 0 120 2", fill: "none", xmlns: "http://www.w3.org/2000/svg", children: [
  (0, import_jsx_runtime.jsx)("path", { d: "M0.98999 1.08218H-0.0100098V0.0821838H0.98999V1.08218Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M5.78992 1.08218H2.78992V0.0821838H5.78992V1.08218Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M7.58984 1.08218H8.58984V0.0821838H7.58984V1.08218Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M14.9152 1.08218H13.9152V0.0821838H14.9152V1.08218Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M16.7151 1.08218H19.7151V0.0821838H16.7151V1.08218Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M22.515 1.08218H21.515V0.0821838H22.515V1.08218Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M27.8405 1.08218H28.8405V0.0821838H27.8405V1.08218Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M33.6404 1.08218H30.6404V0.0821838H33.6404V1.08218Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M35.4403 1.08218H36.4403V0.0821838H35.4403V1.08218Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M42.7657 1.08218H41.7657V0.0821838H42.7657V1.08218Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M44.5657 1.08218H47.5657V0.0821838H44.5657V1.08218Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M50.3656 1.08218H49.3656V0.0821838H50.3656V1.08218Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M55.691 1.08218H56.691V0.0821838H55.691V1.08218Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M61.491 1.08218H58.491V0.0821838H61.491V1.08218Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M63.2909 1.08218H64.2909V0.0821838H63.2909V1.08218Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M70.6163 1.08218H69.6163V0.0821838H70.6163V1.08218Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M72.4163 1.08218H75.4163V0.0821838H72.4163V1.08218Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M78.2162 1.08218H77.2162V0.0821838H78.2162V1.08218Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M83.5416 1.08218H84.5416V0.0821838H83.5416V1.08218Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M89.3416 1.08218H86.3416V0.0821838H89.3416V1.08218Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M91.1415 1.08218H92.1415V0.0821838H91.1415V1.08218Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M98.4669 1.08218H97.4669V0.0821838H98.4669V1.08218Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M100.267 1.08218H103.267V0.0821838H100.267V1.08218Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M106.067 1.08218H105.067V0.0821838H106.067V1.08218Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M111.392 1.08218H112.392V0.0821838H111.392V1.08218Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M117.192 1.08218H114.192V0.0821838H117.192V1.08218Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M118.992 1.08218H119.992V0.0821838H118.992V1.08218Z" })
] });
var aR = ({ className: n3 }) => (0, import_jsx_runtime.jsxs)("svg", { className: n3, width: "120", height: "2", viewBox: "0 0 120 2", fill: "none", xmlns: "http://www.w3.org/2000/svg", children: [
  (0, import_jsx_runtime.jsx)("path", { d: "M-0.0100098 1.15771H0.98999V0.157715H-0.0100098V1.15771Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M2.78992 1.15771H5.78992V0.157715H2.78992V1.15771Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M8.58984 1.15771H7.58984V0.157715H8.58984V1.15771Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M10.3899 1.15771H11.3899V0.157715H10.3899V1.15771Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M19.0903 1.15771H18.0903V0.157715H19.0903V1.15771Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M20.8903 1.15771H23.8903V0.157715H20.8903V1.15771Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M26.6902 1.15771H25.6902V0.157715H26.6902V1.15771Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M28.4902 1.15771H29.4902V0.157715H28.4902V1.15771Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M37.1907 1.15771H36.1907V0.157715H37.1907V1.15771Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M38.9906 1.15771H41.9906V0.157715H38.9906V1.15771Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M44.7905 1.15771H43.7905V0.157715H44.7905V1.15771Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M46.5906 1.15771H47.5906V0.157715H46.5906V1.15771Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M55.291 1.15771H54.291V0.157715H55.291V1.15771Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M57.0909 1.15771H60.0909V0.157715H57.0909V1.15771Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M62.8909 1.15771H61.8909V0.157715H62.8909V1.15771Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M64.6909 1.15771H65.6909V0.157715H64.6909V1.15771Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M73.3914 1.15771H72.3914V0.157715H73.3914V1.15771Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M75.1913 1.15771H78.1913V0.157715H75.1913V1.15771Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M80.9912 1.15771H79.9912V0.157715H80.9912V1.15771Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M82.7913 1.15771H83.7913V0.157715H82.7913V1.15771Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M91.4917 1.15771H90.4917V0.157715H91.4917V1.15771Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M93.2916 1.15771H96.2916V0.157715H93.2916V1.15771Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M99.0916 1.15771H98.0916V0.157715H99.0916V1.15771Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M100.892 1.15771H101.892V0.157715H100.892V1.15771Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M109.592 1.15771H108.592V0.157715H109.592V1.15771Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M111.392 1.15771H114.392V0.157715H111.392V1.15771Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M117.192 1.15771H116.192V0.157715H117.192V1.15771Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M118.992 1.15771H119.992V0.157715H118.992V1.15771Z" })
] });
var cR = ({ className: n3 }) => (0, import_jsx_runtime.jsxs)("svg", { className: n3, width: "120", height: "2", viewBox: "0 0 120 2", fill: "none", xmlns: "http://www.w3.org/2000/svg", children: [
  (0, import_jsx_runtime.jsx)("path", { d: "M-0.00842285 1.22449H2.99158V0.224487H-0.00842285V1.22449Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M6.14941 1.22449H9.14941V0.224487H6.14941V1.22449Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M15.3073 1.22449H12.3073V0.224487H15.3073V1.22449Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M18.4651 1.22449H21.4651V0.224487H18.4651V1.22449Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M27.6229 1.22449H24.6229V0.224487H27.6229V1.22449Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M30.7808 1.22449H33.7808V0.224487H30.7808V1.22449Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M39.9386 1.22449H36.9386V0.224487H39.9386V1.22449Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M43.0964 1.22449H46.0964V0.224487H43.0964V1.22449Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M52.2543 1.22449H49.2543V0.224487H52.2543V1.22449Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M55.4121 1.22449H58.4121V0.224487H55.4121V1.22449Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M64.5699 1.22449H61.5699V0.224487H64.5699V1.22449Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M67.7278 1.22449H70.7278V0.224487H67.7278V1.22449Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M76.8856 1.22449H73.8856V0.224487H76.8856V1.22449Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M80.0435 1.22449H83.0435V0.224487H80.0435V1.22449Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M89.2013 1.22449H86.2013V0.224487H89.2013V1.22449Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M92.3591 1.22449H95.3591V0.224487H92.3591V1.22449Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M101.517 1.22449H98.517V0.224487H101.517V1.22449Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M104.675 1.22449H107.675V0.224487H104.675V1.22449Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M113.833 1.22449H110.833V0.224487H113.833V1.22449Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M116.99 1.22449H119.99V0.224487H116.99V1.22449Z" })
] });
var dR = ({ className: n3 }) => (0, import_jsx_runtime.jsxs)("svg", { className: n3, width: "120", height: "8", viewBox: "0 0 120 8", fill: "none", xmlns: "http://www.w3.org/2000/svg", children: [
  (0, import_jsx_runtime.jsx)(
    "path",
    {
      fillRule: "evenodd",
      clipRule: "evenodd",
      d: "M119.991 2.06215H-0.0090332V0.862152H119.991V1.86215Z"
    }
  ),
  (0, import_jsx_runtime.jsx)(
    "path",
    {
      fillRule: "evenodd",
      clipRule: "evenodd",
      d: "M119.991 6.66215H-0.0090332V5.86215H119.991V6.86215Z"
    }
  )
] });
var uR2 = ({ className: n3 }) => (0, import_jsx_runtime.jsxs)("svg", { className: n3, width: "120", height: "2", viewBox: "0 0 120 2", fill: "none", xmlns: "http://www.w3.org/2000/svg", children: [
  (0, import_jsx_runtime.jsx)("path", { d: "M-0.00976562 1.65707H0.990234V0.657074H-0.00976562V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M2.32361 1.65707H3.32361V0.657074H2.32361V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M5.65698 1.65707H4.65698V0.657074H5.65698V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M6.99036 1.65707H7.99036V0.657074H6.99036V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M10.3237 1.65707H9.32373V0.657074H10.3237V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M11.6571 1.65707H12.6571V0.657074H11.6571V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M14.9905 1.65707H13.9905V0.657074H14.9905V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M16.3239 1.65707H17.3239V0.657074H16.3239V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M19.6572 1.65707H18.6572V0.657074H19.6572V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M20.9906 1.65707H21.9906V0.657074H20.9906V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M24.324 1.65707H23.324V0.657074H24.324V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M25.6573 1.65707H26.6573V0.657074H25.6573V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M28.9907 1.65707H27.9907V0.657074H28.9907V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M30.3241 1.65707H31.3241V0.657074H30.3241V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M33.6575 1.65707H32.6575V0.657074H33.6575V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M34.9908 1.65707H35.9908V0.657074H34.9908V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M38.3242 1.65707H37.3242V0.657074H38.3242V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M39.6576 1.65707H40.6576V0.657074H39.6576V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M42.991 1.65707H41.991V0.657074H42.991V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M44.3243 1.65707H45.3243V0.657074H44.3243V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M47.6577 1.65707H46.6577V0.657074H47.6577V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M48.9911 1.65707H49.9911V0.657074H48.9911V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M52.3245 1.65707H51.3245V0.657074H52.3245V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M53.6578 1.65707H54.6578V0.657074H53.6578V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M56.9912 1.65707H55.9912V0.657074H56.9912V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M58.3246 1.65707H59.3246V0.657074H58.3246V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M61.658 1.65707H60.658V0.657074H61.658V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M62.9913 1.65707H63.9913V0.657074H62.9913V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M66.3247 1.65707H65.3247V0.657074H66.3247V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M67.6581 1.65707H68.6581V0.657074H67.6581V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M70.9915 1.65707H69.9915V0.657074H70.9915V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M72.3248 1.65707H73.3248V0.657074H72.3248V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M75.6582 1.65707H74.6582V0.657074H75.6582V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M76.9916 1.65707H77.9916V0.657074H76.9916V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M80.325 1.65707H79.325V0.657074H80.325V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M81.6583 1.65707H82.6583V0.657074H81.6583V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M84.9917 1.65707H83.9917V0.657074H84.9917V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M86.3251 1.65707H87.3251V0.657074H86.3251V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M89.6584 1.65707H88.6584V0.657074H89.6584V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M90.9918 1.65707H91.9918V0.657074H90.9918V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M94.3252 1.65707H93.3252V0.657074H94.3252V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M95.6586 1.65707H96.6586V0.657074H95.6586V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M98.9919 1.65707H97.9919V0.657074H98.9919V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M100.325 1.65707H101.325V0.657074H100.325V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M103.659 1.65707H102.659V0.657074H103.659V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M104.992 1.65707H105.992V0.657074H104.992V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M108.325 1.65707H107.325V0.657074H108.325V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M109.659 1.65707H110.659V0.657074H109.659V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M112.992 1.65707H111.992V0.657074H112.992V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M114.325 1.65707H115.325V0.657074H114.325V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M117.659 1.65707H116.659V0.657074H117.659V1.65707Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M118.992 1.65707H119.992V0.657074H118.992V1.65707Z" })
] });
var hR2 = ({ className: n3 }) => (0, import_jsx_runtime.jsx)("svg", { className: n3, width: "120", height: "3", viewBox: "0 0 120 3", fill: "none", xmlns: "http://www.w3.org/2000/svg", children: (0, import_jsx_runtime.jsx)(
  "path",
  {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M119.991 2.42035H-0.0090332V0.420349H119.991V2.42035Z"
  }
) });
var gR = ({ className: n3 }) => (0, import_jsx_runtime.jsxs)("svg", { className: n3, width: "120", height: "3", viewBox: "0 0 120 3", fill: "none", xmlns: "http://www.w3.org/2000/svg", children: [
  (0, import_jsx_runtime.jsx)("path", { d: "M-0.0100098 2.47614H1.98999V0.476135H-0.0100098V2.47614Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M3.99014 2.47614H9.99014V0.476135H3.99014V2.47614Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M13.9901 2.47614H11.9901V0.476135H13.9901V2.47614Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M21.1904 2.47614H23.1904V0.476135H21.1904V2.47614Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M31.1906 2.47614H25.1906V0.476135H31.1906V2.47614Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M33.1906 2.47614H35.1906V0.476135H33.1906V2.47614Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M44.3909 2.47614H42.3909V0.476135H44.3909V2.47614Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M46.391 2.47614H52.391V0.476135H46.391V2.47614Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M56.391 2.47614H54.391V0.476135H56.391V2.47614Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M63.5913 2.47614H65.5913V0.476135H63.5913V2.47614Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M73.5915 2.47614H67.5915V0.476135H73.5915V2.47614Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M75.5915 2.47614H77.5915V0.476135H75.5915V2.47614Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M86.7917 2.47614H84.7917V0.476135H86.7917V2.47614Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M88.7919 2.47614H94.7919V0.476135H88.7919V2.47614Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M98.7919 2.47614H96.7919V0.476135H98.7919V2.47614Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M105.992 2.47614H107.992V0.476135H105.992V2.47614Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M115.992 2.47614H109.992V0.476135H115.992V2.47614Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M117.992 2.47614H119.992V0.476135H117.992V2.47614Z" })
] });
var mR2 = ({ className: n3 }) => (0, import_jsx_runtime.jsxs)("svg", { className: n3, width: "120", height: "2", viewBox: "0 0 120 2", fill: "none", xmlns: "http://www.w3.org/2000/svg", children: [
  (0, import_jsx_runtime.jsx)("path", { d: "M-0.0100098 2.00415H1.98999V0.00415039H-0.0100098V2.00415Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M3.99014 2.00415H9.99014V0.00415039H3.99014V2.00415Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M13.9901 2.00415H11.9901V0.00415039H13.9901V2.00415Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M15.9901 2.00415H17.9901V0.00415039H15.9901V2.00415Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M27.4905 2.00415H25.4905V0.00415039H27.4905V2.00415Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M29.4906 2.00415H35.4906V0.00415039H29.4906V2.00415Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M39.4906 2.00415H37.4906V0.00415039H39.4906V2.00415Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M41.4906 2.00415H43.4906V0.00415039H41.4906V2.00415Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M52.991 2.00415H50.991V0.00415039H52.991V2.00415Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M54.9911 2.00415H60.9911V0.00415039H54.9911V2.00415Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M64.9911 2.00415H62.9911V0.00415039H64.9911V2.00415Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M66.9911 2.00415H68.9911V0.00415039H66.9911V2.00415Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M78.4915 2.00415H76.4915V0.00415039H78.4915V2.00415Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M80.4916 2.00415H86.4916V0.00415039H80.4916V2.00415Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M90.4916 2.00415H88.4916V0.00415039H90.4916V2.00415Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M92.4916 2.00415H94.4916V0.00415039H92.4916V2.00415Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M103.992 2.00415H101.992V0.00415039H103.992V2.00415Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M105.992 2.00415H111.992V0.00415039H105.992V2.00415Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M115.992 2.00415H113.992V0.00415039H115.992V2.00415Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M117.992 2.00415H119.992V0.00415039H117.992V2.00415Z" })
] });
var fR2 = ({ className: n3 }) => (0, import_jsx_runtime.jsxs)("svg", { className: n3, width: "118", height: "3", viewBox: "0 0 118 3", fill: "none", xmlns: "http://www.w3.org/2000/svg", children: [
  (0, import_jsx_runtime.jsx)("path", { d: "M-0.00854492 2.94815H1.99146V0.948151H-0.00854492V2.94815Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M6.09668 2.94815H8.09668V0.948151H6.09668V2.94815Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M14.2019 2.94815H12.2019V0.948151H14.2019V2.94815Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M18.3071 2.94815H20.3071V0.948151H18.3071V2.94815Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M26.4124 2.94815H24.4124V0.948151H26.4124V2.94815Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M30.5176 2.94815H32.5176V0.948151H30.5176V2.94815Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M38.6228 2.94815H36.6228V0.948151H38.6228V2.94815Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M42.728 2.94815H44.728V0.948151H42.728V2.94815Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M50.8333 2.94815H48.8333V0.948151H50.8333V2.94815Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M54.9385 2.94815H56.9385V0.948151H54.9385V2.94815Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M63.0437 2.94815H61.0437V0.948151H63.0437V2.94815Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M67.1489 2.94815H69.1489V0.948151H67.1489V2.94815Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M75.2542 2.94815H73.2542V0.948151H75.2542V2.94815Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M79.3594 2.94815H81.3594V0.948151H79.3594V2.94815Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M87.4645 2.94815H85.4645V0.948151H87.4645V2.94815Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M91.5697 2.94815H93.5697V0.948151H91.5697V2.94815Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M99.6749 2.94815H97.6749V0.948151H99.6749V2.94815Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M103.78 2.94815H105.78V0.948151H103.78V2.94815Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M111.885 2.94815H109.885V0.948151H111.885V2.94815Z" }),
  (0, import_jsx_runtime.jsx)("path", { d: "M115.991 2.94815H117.991V0.948151H115.991V2.94815Z" })
] });
var pR = ({ className: n3 }) => (0, import_jsx_runtime.jsx)("svg", { className: n3, width: "120", height: "4", viewBox: "0 0 120 4", fill: "none", xmlns: "http://www.w3.org/2000/svg", children: (0, import_jsx_runtime.jsx)(
  "path",
  {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M119.991 3.86215H-0.0090332V0.862152H119.991V3.86215Z"
  }
) });
var vR2 = ({ className: n3 }) => (0, import_jsx_runtime.jsx)("svg", { className: n3, width: "120", height: "2", viewBox: "0 0 120 2", fill: "none", xmlns: "http://www.w3.org/2000/svg", children: (0, import_jsx_runtime.jsx)(
  "path",
  {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M119.991 1.15668H-0.0090332V0.156677H119.991V1.15668Z"
  }
) });
function Fh2(n3) {
  const { type: e = xe.THIN, className: t3 } = n3;
  switch (e) {
    case xe.DASH_DOT:
      return (0, import_jsx_runtime.jsx)(lR, { className: t3 });
    case xe.DASH_DOT_DOT:
      return (0, import_jsx_runtime.jsx)(aR, { className: t3 });
    case xe.DASHED:
      return (0, import_jsx_runtime.jsx)(cR, { className: t3 });
    case xe.HAIR:
      return (0, import_jsx_runtime.jsx)(uR2, { className: t3 });
    case xe.MEDIUM:
      return (0, import_jsx_runtime.jsx)(hR2, { className: t3 });
    case xe.MEDIUM_DASH_DOT:
      return (0, import_jsx_runtime.jsx)(gR, { className: t3 });
    case xe.MEDIUM_DASH_DOT_DOT:
      return (0, import_jsx_runtime.jsx)(mR2, { className: t3 });
    case xe.MEDIUM_DASHED:
      return (0, import_jsx_runtime.jsx)(fR2, { className: t3 });
    case xe.THICK:
      return (0, import_jsx_runtime.jsx)(pR, { className: t3 });
    case xe.DOUBLE:
      return (0, import_jsx_runtime.jsx)(dR, { className: t3 });
    case xe.THIN:
    default:
      return (0, import_jsx_runtime.jsx)(vR2, { className: t3 });
  }
}
var SR = [
  {
    label: xe.THIN,
    value: xe.THIN
  },
  {
    label: xe.HAIR,
    value: xe.HAIR
  },
  {
    label: xe.DOTTED,
    value: xe.DOTTED
  },
  {
    label: xe.DASHED,
    value: xe.DASHED
  },
  {
    label: xe.DASH_DOT,
    value: xe.DASH_DOT
  },
  {
    label: xe.DASH_DOT_DOT,
    value: xe.DASH_DOT_DOT
  },
  {
    label: xe.MEDIUM,
    value: xe.MEDIUM
  },
  {
    label: xe.MEDIUM_DASHED,
    value: xe.MEDIUM_DASHED
  },
  {
    label: xe.MEDIUM_DASH_DOT,
    value: xe.MEDIUM_DASH_DOT
  },
  {
    label: xe.MEDIUM_DASH_DOT_DOT,
    value: xe.MEDIUM_DASH_DOT_DOT
  },
  {
    label: xe.THICK,
    value: xe.THICK
  },
  {
    label: xe.DOUBLE,
    value: xe.DOUBLE
  }
];
function CR(n3) {
  var e;
  if (n3)
    for (const t3 in n3) {
      const r = n3[t3];
      if ((e = r == null ? void 0 : r.cl) != null && e.rgb) return r.cl.rgb;
    }
}
function wR2(n3) {
  var e;
  if (n3)
    for (const t3 in n3) {
      const r = n3[t3];
      if ((e = r == null ? void 0 : r.cl) != null && e.rgb) return r.s;
    }
}
function Xf2(n3) {
  var h9;
  const e = useDependency(S13), t3 = useDependency(Ht2), r = useDependency(z), { isAllValuesSame: i, value: o3 } = r.getCellStylesProperty("bd"), s2 = i ? CR(o3) : void 0, l4 = i ? wR2(o3) : void 0, { onChange: a4, value: c2 } = n3;
  function d2(m9, g9) {
    a4 == null || a4(__spreadProps(__spreadValues({}, c2), {
      [g9]: m9
    }));
  }
  function u2(m9) {
    const g9 = e.get(m9);
    return g9 && (0, import_jsx_runtime.jsx)(g9, { className: "univer-fill-primary-600" });
  }
  return (0, import_jsx_runtime.jsxs)("section", { className: "univer-box-border univer-grid univer-gap-2 univer-p-1.5", children: [
    (0, import_jsx_runtime.jsx)(
      "div",
      {
        className: "univer-box-border univer-grid univer-grid-cols-5 univer-gap-2 univer-text-gray-600 dark:!univer-text-gray-200",
        children: Of.map((m9) => (0, import_jsx_runtime.jsx)(
          "a",
          {
            className: ie2("univer-flex univer-size-6 univer-cursor-pointer univer-items-center univer-justify-center univer-justify-self-center univer-rounded hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-700", {
              "univer-bg-gray-200 dark:!univer-bg-gray-600": t3.getBorderInfo().type === m9.value
            }),
            onClick: (g9) => {
              g9.stopPropagation(), d2(m9.value, "type");
            },
            children: u2(m9.icon)
          },
          m9.value
        ))
      }
    ),
    (0, import_jsx_runtime.jsx)(XE, {}),
    (0, import_jsx_runtime.jsxs)("div", { className: "univer-flex univer-items-center univer-gap-2", children: [
      (0, import_jsx_runtime.jsx)("div", { children: (0, import_jsx_runtime.jsx)(
        mf,
        {
          overlay: (0, import_jsx_runtime.jsx)("div", { className: "univer-rounded-lg univer-p-4", children: (0, import_jsx_runtime.jsx)(bE, { value: s2, onChange: (m9) => d2(m9, "color") }) }),
          children: (0, import_jsx_runtime.jsxs)(
            "button",
            {
              className: "univer-flex univer-cursor-pointer univer-items-center univer-gap-2 univer-rounded univer-border-none univer-bg-transparent univer-p-1 hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-700",
              type: "button",
              children: [
                (0, import_jsx_runtime.jsx)(
                  cf,
                  {
                    className: "univer-fill-primary-600 dark:!univer-text-white",
                    extend: { colorChannel1: (h9 = c2 == null ? void 0 : c2.color) != null ? h9 : "" }
                  }
                ),
                (0, import_jsx_runtime.jsx)(Mi2, { className: "dark:!univer-text-white" })
              ]
            }
          )
        }
      ) }),
      (0, import_jsx_runtime.jsx)("div", { children: (0, import_jsx_runtime.jsx)(
        mf,
        {
          overlay: (0, import_jsx_runtime.jsx)("section", { className: "univer-rounded-lg univer-p-1.5", children: (0, import_jsx_runtime.jsx)("ul", { className: "univer-m-0 univer-grid univer-list-none univer-gap-1 univer-p-0", children: SR.map((m9) => (0, import_jsx_runtime.jsxs)(
            "li",
            {
              className: "univer-flex univer-cursor-pointer univer-items-center univer-justify-center univer-rounded univer-px-1 univer-py-3 hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-700",
              onClick: () => d2(m9.value, "style"),
              children: [
                m9.value === l4 && (0, import_jsx_runtime.jsx)(
                  Br3,
                  {
                    className: "univer-absolute univer-left-3 univer-text-primary-600"
                  }
                ),
                (0, import_jsx_runtime.jsx)(
                  Fh2,
                  {
                    className: "univer-ml-6 univer-fill-gray-900 dark:!univer-fill-white",
                    type: m9.value
                  }
                )
              ]
            },
            m9.value
          )) }) }),
          children: (0, import_jsx_runtime.jsxs)(
            "button",
            {
              className: "univer-flex univer-cursor-pointer univer-items-center univer-gap-2 univer-rounded univer-border-none univer-bg-transparent univer-p-1 hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-700",
              type: "button",
              children: [
                (0, import_jsx_runtime.jsx)(
                  Fh2,
                  {
                    className: "univer-fill-gray-900 dark:!univer-fill-white",
                    type: l4 != null ? l4 : xe.THIN
                  }
                ),
                (0, import_jsx_runtime.jsx)(Mi2, { className: "dark:!univer-text-white" })
              ]
            }
          )
        }
      ) })
    ] })
  ] });
}
var wu2 = "sheets.component.cell-popup";
var bR = Object.getOwnPropertyDescriptor;
var _R = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? bR(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var ur4 = (n3, e) => (t3, r) => e(t3, r, n3);
var Pi = class extends Ve {
  constructor(e, t3, r, i, o3, s2, l4) {
    super();
    _2(this, "_popupMenuFeatureMap", /* @__PURE__ */ new Map());
    _2(this, "_isSelectionMoving", false);
    this._globalPopupManagerService = e, this._renderManagerService = t3, this._univerInstanceService = r, this._refRangeService = i, this._commandService = o3, this._refSelectionsService = s2, this._selectionManagerService = l4, this._initMoving();
  }
  _initMoving() {
    this.disposeWithMe(
      this._refSelectionsService.selectionMoving$.subscribe(() => {
        this._isSelectionMoving = true;
      })
    ), this.disposeWithMe(
      this._refSelectionsService.selectionMoveEnd$.subscribe(() => {
        this._isSelectionMoving = false;
      })
    ), this.disposeWithMe(
      this._selectionManagerService.selectionMoving$.subscribe(() => {
        this._isSelectionMoving = true;
      })
    ), this.disposeWithMe(
      this._selectionManagerService.selectionMoveEnd$.subscribe(() => {
        this._isSelectionMoving = false;
      })
    );
  }
  /**
   * Register a feature menu callback for a specific drawing type.such as image, chart, etc.
   */
  registerFeatureMenu(e, t3) {
    this._popupMenuFeatureMap.set(e, t3);
  }
  /**
   * Get the feature menu by drawing type, the function should be called when a drawing element need trigger popup menu, so the unitId, subUnitId, drawingId should be provided.
   * @param {string} unitId the unit id
   * @param {string} subUnitId the sub unit id
   * @param {string} drawingId the drawing id
   * @param {DrawingTypeEnum} drawingType the feature type
   * @returns the feature menu if it exists, otherwise return undefined
   */
  getFeatureMenu(e, t3, r, i) {
    const o3 = this._popupMenuFeatureMap.get(i);
    if (o3)
      return o3(e, t3, r, i);
  }
  dispose() {
    super.dispose(), this._popupMenuFeatureMap.clear();
  }
  _createHiddenRectObserver(e) {
    const { row: t3, column: r, worksheet: i, skeleton: o3, currentRender: s2 } = e, l4 = () => {
      var F7, z5;
      const u2 = i.getFreeze(), { startRow: h9, startColumn: m9, xSplit: g9, ySplit: f4 } = u2, p3 = h9 - f4, v6 = m9 - g9, { rowHeightAccumulation: S, columnWidthAccumulation: w6, rowHeaderWidth: C, columnHeaderHeight: I6 } = o3, R9 = C + (v6 === -1 ? 0 : w6[v6 + g9 - 1] - ((F7 = w6[v6 - 1]) != null ? F7 : 0)), y6 = I6 + (p3 === -1 ? 0 : S[p3 + f4 - 1] - ((z5 = S[p3]) != null ? z5 : 0)), E3 = s2.engine.getCanvasElement(), M10 = E3.getBoundingClientRect(), T10 = pc2(E3.style.width), P8 = M10.width / T10, A4 = s2.scene.getAncestorScale().scaleX, x7 = R9 * P8 * A4, H6 = y6 * P8 * A4, V7 = {
        left: -1 / 0,
        top: -1 / 0,
        right: M10.left + x7,
        bottom: M10.top + H6
      }, D5 = {
        left: M10.left + x7,
        top: -1 / 0,
        right: 1 / 0,
        bottom: M10.top + H6
      }, B5 = {
        left: -1 / 0,
        top: M10.top + H6,
        right: M10.left + x7,
        bottom: 1 / 0
      };
      return t3 < h9 && r < m9 ? [] : t3 < h9 ? [V7] : r < m9 ? [V7] : [V7, D5, B5];
    }, a4 = l4(), c2 = new BehaviorSubject(a4), d2 = new ho();
    return d2.add(this._commandService.onCommandExecuted((u2) => {
      u2.id === st2.id && c2.next(l4());
    })), d2.add(k1(s2.engine.onTransformChange$).pipe(throttleTime(16)).subscribe(() => {
      c2.next(l4());
    })), {
      rects$: c2,
      disposable: d2
    };
  }
  // #region attach to object
  // Unlike _createCellPositionObserver, this bind to a certain position.
  _createPositionObserver(e, t3, r, i) {
    const o3 = () => {
      const { scene: c2 } = t3, d2 = Hw(e, c2, r, i), u2 = t3.engine.getCanvasElement(), h9 = u2.getBoundingClientRect(), m9 = pc2(u2.style.width), g9 = h9.width / m9;
      return {
        left: d2.left * g9 + h9.left,
        right: d2.right * g9 + h9.left,
        top: d2.top * g9 + h9.top,
        bottom: d2.bottom * g9 + h9.top
      };
    }, s2 = o3(), l4 = new BehaviorSubject(s2), a4 = new ho();
    return a4.add(this._commandService.onCommandExecuted((c2) => {
      vc2(c2.id) && l4.next(o3());
    })), {
      position: s2,
      position$: l4,
      disposable: a4
    };
  }
  /**
   * attach a popup to canvas object
   * @param targetObject target canvas object
   * @param popup popup item
   * @returns disposable
   */
  attachPopupToObject(e, t3) {
    var S;
    const r = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET), i = r.getActiveSheet();
    if (!i || this._isSelectionMoving && !t3.showOnSelectionMoving)
      return {
        dispose: () => {
        },
        canDispose: () => true
      };
    const o3 = r.getUnitId(), s2 = i.getSheetId(), l4 = (S = this._renderManagerService.getRenderById(o3)) == null ? void 0 : S.with(he2).ensureSkeleton(s2), a4 = this._renderManagerService.getRenderById(o3);
    if (!a4 || !l4)
      return {
        dispose: () => {
        },
        canDispose: () => true
      };
    const { left: c2, top: d2, width: u2, height: h9 } = e, m9 = {
      left: c2,
      right: c2 + u2,
      top: d2,
      bottom: d2 + h9
    }, { position: g9, position$: f4, disposable: p3 } = this._createPositionObserver(m9, a4, l4, i), v6 = this._globalPopupManagerService.addPopup(__spreadProps(__spreadValues({}, t3), {
      unitId: o3,
      subUnitId: s2,
      anchorRect: g9,
      anchorRect$: f4,
      canvasElement: a4.engine.getCanvasElement()
    }));
    return {
      dispose: () => {
        this._globalPopupManagerService.removePopup(v6), f4.complete(), p3.dispose();
      },
      canDispose: () => this._globalPopupManagerService.activePopupId !== v6
    };
  }
  // #endregion
  // #region attach to position
  attachPopupByPosition(e, t3, r) {
    var p3;
    let i = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET), o3 = i.getActiveSheet();
    if (!o3)
      return null;
    const s2 = i.getUnitId(), l4 = o3.getSheetId();
    if (s2 !== r.unitId || r.subUnitId !== l4)
      return null;
    if (this._isSelectionMoving && !t3.showOnSelectionMoving)
      return;
    const a4 = (p3 = this._renderManagerService.getRenderById(s2)) == null ? void 0 : p3.with(he2).getOrCreateSkeleton({
      sheetId: l4
    }), c2 = this._renderManagerService.getRenderById(s2);
    if (!c2 || !a4)
      return null;
    const { position: d2, position$: u2, disposable: h9 } = this._createPositionObserver(e, c2, a4, o3), { rects$: m9, disposable: g9 } = this._createHiddenRectObserver({
      row: r.row,
      column: r.col,
      worksheet: o3,
      skeleton: a4,
      currentRender: c2
    }), f4 = this._globalPopupManagerService.addPopup(__spreadProps(__spreadValues({}, t3), {
      unitId: s2,
      subUnitId: l4,
      anchorRect: d2,
      anchorRect$: u2,
      hiddenRects$: m9,
      canvasElement: c2.engine.getCanvasElement()
    }));
    return {
      dispose: () => {
        this._globalPopupManagerService.removePopup(f4), u2.complete(), h9.dispose(), g9.dispose(), i = null, o3 = null;
      },
      canDispose: () => this._globalPopupManagerService.activePopupId !== f4
    };
  }
  // #endregion
  // #region attach to absolute position
  attachPopupToAbsolutePosition(e, t3, r, i) {
    var m9;
    const o3 = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET), s2 = o3.getActiveSheet();
    if (!s2)
      return null;
    const l4 = o3.getUnitId(), a4 = s2.getSheetId();
    if (r && l4 !== r || i && i !== a4)
      return null;
    const c2 = (m9 = this._renderManagerService.getRenderById(l4)) == null ? void 0 : m9.with(he2).ensureSkeleton(a4), d2 = this._renderManagerService.getRenderById(l4);
    if (!d2 || !c2)
      return null;
    if (this._isSelectionMoving && !t3.showOnSelectionMoving)
      return;
    const u2 = new BehaviorSubject(e), h9 = this._globalPopupManagerService.addPopup(__spreadProps(__spreadValues({}, t3), {
      unitId: l4,
      subUnitId: a4,
      anchorRect: e,
      anchorRect$: u2.asObservable(),
      canvasElement: d2.engine.getCanvasElement()
    }));
    return {
      dispose: () => {
        this._globalPopupManagerService.removePopup(h9), u2.complete();
      },
      canDispose: () => this._globalPopupManagerService.activePopupId !== h9
    };
  }
  // #endregion
  // #region attach to cell
  /**
   * Bind popup to the right part of cell at(row, col).
   * This popup would move with the cell.
   * @param row
   * @param col
   * @param popup
   * @param _unitId
   * @param _subUnitId
   * @param viewport
   * @returns
   */
  attachPopupToCell(e, t3, r, i, o3, s2) {
    let l4 = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET), a4 = l4.getActiveSheet();
    if (!a4)
      return null;
    const c2 = l4.getUnitId(), d2 = a4.getSheetId();
    if (i && c2 !== i || o3 && d2 !== o3)
      return null;
    const u2 = this._renderManagerService.getRenderById(c2), h9 = u2 == null ? void 0 : u2.with(he2).ensureSkeleton(d2), m9 = u2 == null ? void 0 : u2.with(gt);
    if (!u2 || !h9 || !m9)
      return null;
    if (this._isSelectionMoving && !r.showOnSelectionMoving)
      return;
    const g9 = s2 != null ? s2 : Sh2(e, t3, u2.scene, a4);
    if (!g9)
      return null;
    const { position: f4, position$: p3, disposable: v6, updateRowCol: S } = this._createCellPositionObserver(e, t3, u2, h9, g9), { rects$: w6, disposable: C } = this._createHiddenRectObserver({
      row: e,
      column: t3,
      worksheet: a4,
      skeleton: h9,
      currentRender: u2
    }), I6 = this._globalPopupManagerService.addPopup(__spreadProps(__spreadValues({}, r), {
      unitId: c2,
      subUnitId: d2,
      anchorRect: f4,
      anchorRect$: p3,
      canvasElement: u2.engine.getCanvasElement(),
      hiddenRects$: w6
    })), R9 = new ho();
    R9.add(v6), R9.add(Be(() => {
      this._globalPopupManagerService.removePopup(I6), p3.complete();
    })), R9.add(C);
    const y6 = { startRow: e, endRow: e, startColumn: t3, endColumn: t3 };
    return R9.add(this._refRangeService.watchRange(c2, d2, y6, (E3, M10) => {
      M10 ? S(M10.startRow, M10.startColumn) : R9.dispose();
    })), {
      dispose() {
        R9.dispose(), a4 = null, l4 = null;
      },
      canDispose: () => this._globalPopupManagerService.activePopupId !== I6
    };
  }
  /**
   * attach Comp to floatDOM
   * @param range
   * @param popup
   * @param _unitId
   * @param _subUnitId
   * @param viewport
   * @param showOnSelectionMoving
   */
  attachRangePopup(e, t3, r, i, o3, s2 = false) {
    const l4 = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET), a4 = l4.getActiveSheet();
    if (!a4)
      return null;
    const c2 = l4.getUnitId(), d2 = a4.getSheetId();
    if (r && c2 !== r || i && d2 !== i)
      return null;
    const u2 = this._renderManagerService.getRenderById(c2), h9 = u2 == null ? void 0 : u2.with(he2).getOrCreateSkeleton({
      sheetId: d2
    }), m9 = u2 == null ? void 0 : u2.with(gt);
    if (!u2 || !h9 || !m9)
      return null;
    if (m9.selectionMoving && !s2)
      return;
    const g9 = o3 != null ? o3 : Sh2(e.startRow, e.startColumn, u2.scene, a4);
    if (!g9)
      return null;
    const { position: f4, position$: p3, disposable: v6, updateRange: S, topLeftPos$: w6, rightBottomPos$: C } = this._createRangePositionObserver(e, u2, h9, g9), { rects$: I6, disposable: R9 } = this._createHiddenRectObserver({
      row: e.startRow,
      column: e.startColumn,
      worksheet: a4,
      skeleton: h9,
      currentRender: u2
    }), y6 = this._globalPopupManagerService.addPopup(__spreadProps(__spreadValues({}, t3), {
      unitId: c2,
      subUnitId: d2,
      anchorRect: f4,
      anchorRect$: p3,
      canvasElement: u2.engine.getCanvasElement(),
      hiddenRects$: I6
    })), E3 = new ho();
    E3.add(v6), E3.add(Be(() => {
      this._globalPopupManagerService.removePopup(y6), w6.complete(), C.complete();
    })), E3.add(R9);
    const M10 = __spreadValues({}, e);
    return E3.add(this._refRangeService.watchRange(c2, d2, M10, (T10, P8) => {
      P8 ? S(P8) : E3.dispose();
    })), {
      dispose() {
        E3.dispose();
      },
      canDispose: () => this._globalPopupManagerService.activePopupId !== y6
    };
  }
  /**
   *
   * @param initialRow
   * @param initialCol
   * @param currentRender
   * @param skeleton
   * @param activeViewport
   */
  _createCellPositionObserver(e, t3, r, i, o3) {
    let s2 = e, l4 = t3;
    const a4 = this._calcCellPositionByCell(s2, l4, r, i, o3), c2 = new BehaviorSubject(a4), d2 = () => c2.next(this._calcCellPositionByCell(s2, l4, r, i, o3)), u2 = new ho();
    return u2.add(r.engine.clientRect$.subscribe(() => d2())), u2.add(k1(r.engine.onTransformChange$).pipe(throttleTime(16)).subscribe(() => d2())), u2.add(this._commandService.onCommandExecuted((m9) => {
      if (m9.id === er2.id && m9.params.rowsAutoHeightInfo.findIndex((f4) => f4.row === s2) > -1) {
        d2();
        return;
      }
      vc2(m9.id) && d2();
    })), {
      position$: c2,
      disposable: u2,
      position: a4,
      updateRowCol: (m9, g9) => {
        s2 = m9, l4 = g9, d2();
      }
    };
  }
  // TODO @lumixraku to a normal function, not method.
  _calcCellPositionByCell(e, t3, r, i, o3) {
    const { scene: s2, engine: l4 } = r;
    if (i._disposed || s2._disposed)
      return {
        left: 0,
        right: 0,
        top: 0,
        bottom: 0
      };
    const a4 = i.getCellWithCoordByIndex(e, t3), c2 = a4.isMergedMainCell ? a4.mergeInfo : a4, { scaleX: d2, scaleY: u2 } = s2.getAncestorScale(), h9 = {
      x: o3.viewportScrollX,
      y: o3.viewportScrollY
    }, m9 = l4.getCanvasElement();
    if (!m9)
      return {
        left: 0,
        right: 0,
        top: 0,
        bottom: 0
      };
    const g9 = m9.getBoundingClientRect(), f4 = pc2(m9.style.width), { top: p3, left: v6, width: S } = g9, w6 = S / f4;
    return {
      left: (c2.startX - h9.x) * w6 * d2 + v6,
      right: (c2.endX - h9.x) * w6 * d2 + v6,
      top: (c2.startY - h9.y) * w6 * u2 + p3,
      bottom: (c2.endY - h9.y) * w6 * u2 + p3
    };
  }
  // #endregion
  /**
   * Unlike _createCellPositionObserver, this accept a range not a single cell.
   * @param initialRow
   * @param initialCol
   * @param currentRender
   * @param skeleton
   * @param activeViewport
   */
  _createRangePositionObserver(e, t3, r, i) {
    let { startRow: o3, startColumn: s2, endRow: l4, endColumn: a4 } = e;
    const c2 = this._calcCellPositionByCell(o3, s2, t3, r, i), d2 = new BehaviorSubject(c2), u2 = this._calcCellPositionByCell(l4, a4, t3, r, i), h9 = new BehaviorSubject(u2), m9 = () => {
      const S = this._calcCellPositionByCell(o3, s2, t3, r, i), w6 = this._calcCellPositionByCell(l4, a4, t3, r, i);
      d2.next(S), h9.next(w6);
    }, g9 = new ho();
    g9.add(t3.engine.clientRect$.subscribe(() => m9())), g9.add(this._commandService.onCommandExecuted((S) => {
      if (S.id === er2.id && S.params.rowsAutoHeightInfo.findIndex((C) => C.row === o3) > -1) {
        m9();
        return;
      }
      vc2(S.id) && m9();
    }));
    const f4 = (S) => {
      o3 = S.startRow, s2 = S.startColumn, l4 = S.endRow, a4 = S.endColumn, m9();
    }, p3 = d2.pipe(
      map((S) => {
        const w6 = this._calcCellPositionByCell(l4, a4, t3, r, i);
        return {
          top: S.top,
          left: S.left,
          right: w6.right,
          bottom: w6.bottom
        };
      })
    ), v6 = {
      top: c2.top,
      left: c2.left,
      right: u2.right,
      bottom: u2.bottom
    };
    return {
      position$: p3,
      position: v6,
      updateRange: f4,
      topLeftPos$: d2,
      rightBottomPos$: h9,
      disposable: g9
    };
  }
};
Pi = _R([
  ur4(0, Inject(rt2)),
  ur4(1, JE),
  ur4(2, br),
  ur4(3, Inject(At3)),
  ur4(4, Ds),
  ur4(5, Ku),
  ur4(6, Inject(z))
], Pi);
function pc2(n3) {
  return Number.parseInt(n3.replace("px", ""));
}
var RR2 = /* @__PURE__ */ new Set([
  or4.id,
  Ln2.id,
  ie5.id
]);
function vc2(n3) {
  return RR2.has(n3) || bh2.includes(n3);
}
var IR = Object.getOwnPropertyDescriptor;
var yR = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? IR(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var MR = (n3, e) => (t3, r) => e(t3, r, n3);
var Er3 = class extends Ve {
  constructor(e) {
    super();
    _2(this, "_cellPopupMap", /* @__PURE__ */ new Map());
    _2(this, "_change$", new Subject());
    _2(this, "change$", this._change$.asObservable());
    this._sheetCanvasPopManagerService = e;
  }
  _ensureCellPopupMap(e, t3) {
    let r = this._cellPopupMap.get(e);
    r || (r = /* @__PURE__ */ new Map(), this._cellPopupMap.set(e, r));
    let i = r.get(t3);
    return i || (i = new ht(), r.set(t3, i)), i;
  }
  showPopup(e, t3) {
    var u2, h9;
    const { direction: r = "horizontal" } = t3, { unitId: i, subUnitId: o3, row: s2, col: l4 } = e, a4 = this._ensureCellPopupMap(i, o3), c2 = (u2 = a4.getValue(s2, l4)) == null ? void 0 : u2[r];
    t3.id = (h9 = t3.id) != null ? h9 : et();
    const d2 = () => {
      var p3;
      const m9 = a4.getValue(s2, l4);
      if (!m9)
        return;
      const g9 = m9[r];
      if (!g9)
        return;
      const f4 = g9 == null ? void 0 : g9.popups.findIndex((v6) => v6.id === t3.id && v6.componentKey === t3.componentKey);
      g9 == null || g9.popups.splice(f4, 1), g9.popups.length === 0 && ((p3 = g9.disposable) == null || p3.dispose(), m9[r] = void 0), this._change$.next(__spreadProps(__spreadValues({}, e), {
        direction: r
      }));
    };
    if (c2)
      c2.popups.push(t3), c2.popups.sort((m9, g9) => m9.priority - g9.priority);
    else {
      const m9 = this._sheetCanvasPopManagerService.attachPopupToCell(
        s2,
        l4,
        __spreadProps(__spreadValues({}, t3), {
          direction: r,
          componentKey: wu2,
          extraProps: __spreadProps(__spreadValues({}, e), {
            direction: r
          }),
          noPushMinimumGap: true,
          autoRelayout: false,
          zIndex: 90
        }),
        i,
        o3
      );
      a4.setValue(s2, l4, __spreadProps(__spreadValues({}, a4.getValue(s2, l4)), {
        [r]: {
          disposable: m9,
          popups: [t3]
        }
      }));
    }
    return this._change$.next(__spreadProps(__spreadValues({}, e), {
      direction: r
    })), Be(d2);
  }
  getPopups(e, t3, r, i, o3) {
    var l4, a4;
    return ((a4 = (l4 = this._ensureCellPopupMap(e, t3).getValue(r, i)) == null ? void 0 : l4[o3]) == null ? void 0 : a4.popups) || [];
  }
  hidePopup(e, t3, r, i) {
    var l4, a4;
    const o3 = this._ensureCellPopupMap(e, t3), s2 = o3.getValue(r, i);
    s2 && (s2.horizontal && ((l4 = s2.horizontal.disposable) == null || l4.dispose(), s2.horizontal = void 0, this._change$.next({
      unitId: e,
      subUnitId: t3,
      row: r,
      col: i,
      direction: "horizontal"
    })), s2.vertical && ((a4 = s2.vertical.disposable) == null || a4.dispose(), s2.vertical = void 0, this._change$.next({
      unitId: e,
      subUnitId: t3,
      row: r,
      col: i,
      direction: "vertical"
    })), !s2.horizontal && !s2.vertical && o3.realDeleteValue(r, i));
  }
};
Er3 = yR([
  MR(0, Inject(Pi))
], Er3);
var zf2 = (n3) => {
  const { popup: e } = n3, t3 = e.extraProps, { row: r, col: i, direction: o3, unitId: s2, subUnitId: l4 } = t3, a4 = useDependency(Er3);
  useObservable(
    (0, import_react.useMemo)(() => a4.change$.pipe(
      filter((u2) => u2.row === r && u2.col === i && u2.direction === o3)
    ), [a4, r, i, o3])
  );
  const c2 = a4.getPopups(s2, l4, r, i, o3), d2 = useDependency(S13);
  return (0, import_jsx_runtime.jsx)("div", { "data-u-comp": "cell-popup", className: "univer-ml-px univer-flex univer-flex-col", children: c2.map((u2) => {
    var m9;
    const h9 = d2.get(u2.componentKey);
    return h9 ? (0, import_jsx_runtime.jsx)(h9, { popup: u2 }, (m9 = u2.id) != null ? m9 : u2.componentKey) : null;
  }) });
};
var Uh2 = (n3) => {
  const {
    inputId: e,
    state: t3 = false,
    type: r = "range",
    confirm: i,
    cancel: o3,
    name: s2,
    formulaOrRefString: l4,
    comment: a4 = "",
    localSheetId: c2 = mg,
    hidden: d2 = false,
    // æ˜¯å¦å¯¹ç”¨æˆ·éšè—ï¼Œä¸Žexcelå…¼å®¹ï¼Œæš‚æ—¶ç”¨ä¸ä¸Šã€‚
    id: u2
  } = n3, m9 = useDependency(br).getCurrentUnitForType(we.UNIVER_SHEET), g9 = useDependency(Hn), f4 = useDependency(Lr), p3 = useDependency(Xt), v6 = useDependency(Mn), S = useDependency(S13), w6 = (0, import_react.useMemo)(() => S.get(_m2), []), C = (0, import_react.useMemo)(() => S.get(zd2), []);
  if (m9 == null)
    return;
  const I6 = (0, import_react.useMemo)(() => m9.getUnitId(), []), R9 = (0, import_react.useMemo)(() => m9.getActiveSheet().getSheetId(), []), [y6, E3] = (0, import_react.useState)(s2), [M10, T10] = (0, import_react.useState)(l4), [P8, A4] = (0, import_react.useState)(a4), [x7, H6] = (0, import_react.useState)(c2), [V7, D5] = (0, import_react.useState)(""), [B5, F7] = (0, import_react.useState)(r), [z5, Z9] = (0, import_react.useState)(true), de3 = [{
    label: g9.t("definedName.scopeWorkbook"),
    value: mg
  }], Re5 = (ge5) => !xl(ge5);
  (0, import_react.useEffect)(() => {
    Z9(true), E3(s2), A4(a4), H6(c2);
    let ge5 = l4;
    l4.substring(0, 1) === Z6.EQUALS ? F7("formula") : Re5(l4) ? (F7("formula"), ge5 = Z6.EQUALS + l4) : F7("range"), T10(ge5), D5("");
  }, [t3]), m9.getSheetOrders().forEach((ge5) => {
    const be4 = m9.getSheetBySheetId(ge5);
    de3.push({
      label: (be4 == null ? void 0 : be4.getName()) || "",
      value: ge5
    });
  });
  const we6 = (ge5) => {
    T10(ge5);
  }, ke4 = (ge5) => {
    T10(ge5 || "");
  }, G5 = () => {
    if (y6.length === 0) {
      D5(g9.t("definedName.nameEmpty"));
      return;
    }
    if (f4.getValueByName(I6, y6) != null && (u2 == null || u2.length === 0)) {
      D5(g9.t("definedName.nameDuplicate"));
      return;
    }
    if (!Z.isValidParameter(y6) || An2(y6) || !Z.isStartValidPosition(y6) && !r0(y6.substring(0, 1))) {
      D5(g9.t("definedName.nameInvalid"));
      return;
    }
    if (m9.getSheetOrders().map((ae5) => {
      var it5;
      return ((it5 = m9.getSheetBySheetId(ae5)) == null ? void 0 : it5.getName()) || "";
    }).includes(y6)) {
      D5(g9.t("definedName.nameSheetConflict"));
      return;
    }
    if (M10.length === 0) {
      D5(g9.t("definedName.formulaOrRefStringEmpty"));
      return;
    }
    if (!z5) {
      D5(g9.t("definedName.formulaOrRefStringInvalid"));
      return;
    }
    if (p3.hasExecutor(y6.toUpperCase())) {
      D5(g9.t("definedName.nameConflict"));
      return;
    }
    const be4 = m9.getActiveSheet().getName();
    i && i({
      id: u2 || "",
      name: y6,
      formulaOrRefString: v6.convertRefersToAbsolute(M10, ye.ALL, ye.ALL, be4),
      comment: P8,
      localSheetId: x7
    });
  }, ee5 = (ge5) => {
    const be4 = ge5;
    be4 === "formula" ? l4[0] === Z6.EQUALS ? T10(l4) : T10(`${Z6.EQUALS}`) : l4[0] === Z6.EQUALS ? T10("") : T10(l4), F7(be4);
  }, re5 = (0, import_react.useRef)(null), [fe5, Xe9] = (0, import_react.useState)(false);
  return f72((ge5) => {
    var ae5;
    ((ae5 = re5.current) == null ? void 0 : ae5.isClickOutSide(ge5)) && Xe9(false);
  }), (0, import_jsx_runtime.jsxs)(
    "div",
    {
      className: ie2("univer-grid univer-space-y-2 univer-pb-1", fE, {
        "univer-hidden": !t3
      }),
      children: [
        (0, import_jsx_runtime.jsx)("div", { children: (0, import_jsx_runtime.jsx)(
          eC,
          {
            className: "univer-w-full",
            placeholder: g9.t("definedName.inputNamePlaceholder"),
            value: y6,
            allowClear: true,
            onChange: E3
          }
        ) }),
        (0, import_jsx_runtime.jsx)("div", { children: (0, import_jsx_runtime.jsxs)(VE2, { value: B5, onChange: ee5, children: [
          (0, import_jsx_runtime.jsx)(qE, { value: "range", children: g9.t("definedName.ratioRange") }),
          (0, import_jsx_runtime.jsx)(qE, { value: "formula", children: g9.t("definedName.ratioFormula") })
        ] }) }),
        B5 === "range" ? w6 && (0, import_jsx_runtime.jsx)(
          w6,
          {
            unitId: I6,
            subUnitId: R9,
            initialValue: M10,
            onChange: (ge5, be4) => we6(be4),
            supportAcrossSheet: true
          }
        ) : C && (0, import_jsx_runtime.jsx)("div", { className: "univer-relative univer-mt-4 univer-h-full", children: (0, import_jsx_runtime.jsx)("div", { className: "univer-relative univer-h-8 univer-select-none", children: (0, import_jsx_runtime.jsx)(
          C,
          {
            ref: re5,
            className: ie2("univer-box-border univer-h-8 univer-w-full univer-cursor-pointer univer-items-center univer-rounded-lg univer-bg-white univer-pt-2 univer-transition-colors hover:univer-border-primary-600 dark:!univer-bg-gray-700 dark:!univer-text-white [&>div:first-child]:univer-px-2.5 [&>div]:univer-h-5 [&>div]:univer-ring-transparent", kt2),
            initValue: M10,
            unitId: I6,
            subUnitId: R9,
            isFocus: fe5,
            isSupportAcrossSheet: true,
            onChange: (ge5 = "") => {
              ke4(ge5 || "");
            },
            onVerify: (ge5) => {
              Z9(ge5);
            },
            onFocus: () => Xe9(true)
          }
        ) }) }),
        (0, import_jsx_runtime.jsx)("div", { children: (0, import_jsx_runtime.jsx)(
          KE,
          {
            className: "univer-w-full",
            value: x7,
            options: de3,
            onChange: H6
          }
        ) }),
        (0, import_jsx_runtime.jsx)("div", { children: (0, import_jsx_runtime.jsx)(
          eC,
          {
            className: "univer-w-full",
            placeholder: g9.t("definedName.inputCommentPlaceholder"),
            value: P8,
            onChange: A4,
            allowClear: true
          }
        ) }),
        (0, import_jsx_runtime.jsxs)(
          "div",
          {
            className: ie2("univer-items-center univer-gap-1 univer-text-sm univer-text-red-500", {
              "univer-hidden": V7.length === 0,
              "univer-flex": V7.length !== 0
            }),
            children: [
              (0, import_jsx_runtime.jsx)("span", { children: V7 }),
              (0, import_jsx_runtime.jsx)(du2, {})
            ]
          }
        ),
        (0, import_jsx_runtime.jsxs)("div", { className: "univer-flex univer-gap-2", children: [
          (0, import_jsx_runtime.jsx)(
            fr,
            {
              onClick: () => {
                o3 == null || o3();
              },
              children: g9.t("definedName.cancel")
            }
          ),
          (0, import_jsx_runtime.jsx)(
            fr,
            {
              variant: "primary",
              onClick: G5,
              children: g9.t("definedName.confirm")
            }
          )
        ] })
      ]
    }
  );
};
var jf2 = () => {
  const n3 = useDependency(Ds), t3 = useDependency(br).getCurrentUnitOfType(we.UNIVER_SHEET), r = useDependency(Hn), i = useDependency(Lr), o3 = useDependency(z);
  if (t3 == null)
    return;
  const s2 = t3.getUnitId(), l4 = () => {
    const P8 = i.getDefinedNameMap(s2);
    return P8 ? Array.from(Object.values(P8)) : [];
  }, [a4, c2] = (0, import_react.useState)(false), [d2, u2] = (0, import_react.useState)(l4()), [h9, m9] = (0, import_react.useState)(null), [g9, f4] = (0, import_react.useState)();
  (0, import_react.useEffect)(() => {
    const P8 = i.update$.subscribe(() => {
      u2(l4());
    });
    return () => {
      P8.unsubscribe();
    };
  }, []);
  const p3 = (P8) => {
    const { name: A4, formulaOrRefString: x7, comment: H6, localSheetId: V7, hidden: D5 } = P8;
    let B5 = P8.id;
    if (B5 == null || B5.length === 0)
      B5 = et(10), n3.executeCommand(pc.id, { id: B5, unitId: s2, name: A4, formulaOrRefString: x7, comment: H6, localSheetId: V7, hidden: D5 });
    else {
      const F7 = { id: B5, unitId: s2, name: A4, formulaOrRefString: x7, comment: H6, localSheetId: V7, hidden: D5 };
      n3.executeCommand(ni.id, F7);
    }
    c2(false), m9(null);
  }, v6 = (P8) => {
    f4(P8);
  };
  function S() {
    f4(null);
  }
  function w6(P8) {
    const A4 = i.getValueById(s2, P8);
    n3.executeCommand(Qr2.id, __spreadProps(__spreadValues({}, A4), { unitId: s2 })), f4(null);
  }
  const C = (P8) => __async(void 0, null, function* () {
    const { formulaOrRefString: A4, id: x7 } = P8, H6 = i.getWorksheetByRef(s2, A4);
    if (!H6)
      return;
    H6.isSheetHidden() && (yield n3.executeCommand(gi.id, { unitId: s2, subUnitId: H6.getSheetId() })), i.focusRange(s2, x7);
  }), I6 = () => {
    const P8 = d2.length + 1, A4 = r.t("definedName.defaultName") + P8;
    if (i.getValueByName(s2, A4) == null)
      return A4;
    let x7 = P8 + 1;
    for (; ; ) {
      const H6 = r.t("definedName.defaultName") + x7;
      if (i.getValueByName(s2, H6) == null)
        return H6;
      x7++;
    }
  }, R9 = () => {
    var H6;
    const P8 = (H6 = t3.getActiveSheet()) == null ? void 0 : H6.getName();
    if (!P8)
      return "";
    const A4 = o3.getCurrentSelections();
    return A4 == null ? "" : A4.map((V7) => wl(P8, V7.range)).join(",");
  }, y6 = () => {
    c2(false), m9(null);
  }, E3 = () => {
    c2(true), m9(null);
  }, M10 = (P8) => {
    c2(false), m9(P8);
  }, T10 = (P8) => {
    const A4 = t3.getSheetBySheetId(P8);
    return A4 == null ? "" : A4.getName();
  };
  return (0, import_jsx_runtime.jsx)(
    "div",
    {
      "data-u-comp": "defined-name-container",
      className: "univer-relative univer-box-border univer-w-full",
      children: (0, import_jsx_runtime.jsxs)("div", { className: ie2("univer-w-full univer-overflow-hidden univer-overflow-y-auto", vr2), children: [
        (0, import_jsx_runtime.jsxs)("div", { className: "univer-mb-4", children: [
          (0, import_jsx_runtime.jsxs)(
            fr,
            {
              className: ie2(
                "univer-w-full",
                {
                  "univer-hidden": a4
                }
              ),
              onClick: E3,
              children: [
                (0, import_jsx_runtime.jsx)(uu2, {}),
                (0, import_jsx_runtime.jsx)("span", { className: "univer-ml-1", children: r.t("definedName.addButton") })
              ]
            }
          ),
          a4 && (0, import_jsx_runtime.jsx)(
            Uh2,
            {
              confirm: p3,
              cancel: y6,
              state: a4,
              inputId: "insertDefinedName",
              name: I6(),
              formulaOrRefString: R9()
            }
          )
        ] }, "insertDefinedName"),
        d2.map((P8, A4) => (0, import_jsx_runtime.jsxs)(
          "div",
          {
            className: "univer-relative univer-w-full univer-divide-x-0 univer-divide-y univer-divide-solid univer-divide-gray-200 dark:!univer-divide-gray-600",
            children: [
              (0, import_jsx_runtime.jsxs)(
                "div",
                {
                  className: ie2("univer-group univer-relative univer-flex univer-w-full univer-cursor-default univer-select-none univer-items-center univer-justify-between univer-rounded-md univer-p-2 hover:univer-bg-gray-50 dark:hover:!univer-bg-gray-700", {
                    "univer-hidden": P8.id === h9
                  }),
                  onClick: () => {
                    C(P8);
                  },
                  children: [
                    (0, import_jsx_runtime.jsxs)("div", { title: P8.comment, children: [
                      (0, import_jsx_runtime.jsxs)(
                        "div",
                        {
                          className: "univer-my-1 univer-max-h-[100px] univer-max-w-[190px] univer-truncate univer-text-sm univer-font-medium univer-text-gray-900 dark:!univer-text-white",
                          children: [
                            P8.name,
                            (0, import_jsx_runtime.jsx)("span", { className: "univer-text-xxs univer-ml-1 univer-text-gray-400", children: P8.localSheetId === mg || P8.localSheetId == null ? "" : T10(P8.localSheetId) })
                          ]
                        }
                      ),
                      (0, import_jsx_runtime.jsx)(
                        "div",
                        {
                          className: "univer-my-1 univer-max-h-[100px] univer-w-full univer-max-w-[190px] univer-truncate univer-text-xs univer-text-gray-500",
                          title: P8.formulaOrRefString,
                          children: P8.formulaOrRefString
                        }
                      )
                    ] }),
                    (0, import_jsx_runtime.jsxs)(
                      "div",
                      {
                        className: "univer-absolute univer-right-5 univer-top-1/2 univer-hidden -univer-translate-y-1/2 univer-cursor-pointer univer-items-center univer-justify-end univer-gap-7 univer-text-xs univer-text-primary-600 group-hover:univer-flex dark:hover:!univer-bg-gray-600",
                        children: [
                          (0, import_jsx_runtime.jsx)(Np, { title: r.t("definedName.updateButton"), placement: "top", children: (0, import_jsx_runtime.jsx)(
                            "a",
                            {
                              className: "univer-rounded univer-p-1 hover:univer-bg-gray-100",
                              onClick: (x7) => {
                                x7.stopPropagation(), M10(P8.id);
                              },
                              children: (0, import_jsx_runtime.jsx)(of2, {})
                            }
                          ) }),
                          (0, import_jsx_runtime.jsx)(Np, { title: r.t("definedName.deleteButton"), placement: "top", children: (0, import_jsx_runtime.jsx)(
                            "a",
                            {
                              className: "univer-rounded univer-p-1 univer-text-red-600 hover:univer-bg-gray-100",
                              onClick: (x7) => {
                                x7.stopPropagation(), v6(P8.id);
                              },
                              children: (0, import_jsx_runtime.jsx)(Aa3, {})
                            }
                          ) })
                        ]
                      }
                    )
                  ]
                }
              ),
              (0, import_jsx_runtime.jsx)(
                wE,
                {
                  visible: g9 === P8.id,
                  onClose: S,
                  onConfirm: () => {
                    w6(P8.id);
                  },
                  children: r.t("definedName.deleteConfirmText")
                }
              ),
              P8.id === h9 && (0, import_jsx_runtime.jsx)(
                Uh2,
                {
                  confirm: p3,
                  cancel: y6,
                  state: P8.id === h9,
                  id: P8.id,
                  inputId: P8.id + A4,
                  name: P8.name,
                  formulaOrRefString: P8.formulaOrRefString,
                  comment: P8.comment,
                  localSheetId: P8.localSheetId
                }
              )
            ]
          },
          A4
        ))
      ] })
    }
  );
};
var Yf2 = {
  id: Ts3.id,
  // when focusing on any other input tag do not trigger this shortcut
  preconditions: (n3) => Ne2(n3),
  binding: q1.Digit9 | y12.CTRL_COMMAND
};
var Zf2 = {
  id: Us.id,
  // when focusing on any other input tag do not trigger this shortcut
  preconditions: (n3) => Ne2(n3),
  binding: q1.Digit0 | y12.CTRL_COMMAND | y12.SHIFT
};
var Gf2 = {
  id: Ut3.id,
  description: "shortcut.sheet.select-below-cell",
  group: "3_sheet-view",
  binding: q1.ARROW_DOWN,
  priority: 100,
  preconditions: Ne2,
  staticParameters: {
    direction: wm.DOWN
  }
};
var qf2 = {
  id: Ut3.id,
  description: "shortcut.sheet.select-up-cell",
  group: "3_sheet-view",
  binding: q1.ARROW_UP,
  priority: 100,
  preconditions: Ne2,
  staticParameters: {
    direction: wm.UP
  }
};
var Qf = {
  id: Ut3.id,
  description: "shortcut.sheet.select-left-cell",
  group: "3_sheet-view",
  binding: q1.ARROW_LEFT,
  priority: 100,
  preconditions: Tm,
  staticParameters: {
    direction: wm.LEFT
  }
};
var Kf2 = {
  id: Ut3.id,
  description: "shortcut.sheet.select-right-cell",
  group: "3_sheet-view",
  binding: q1.ARROW_RIGHT,
  priority: 100,
  preconditions: Tm,
  staticParameters: {
    direction: wm.RIGHT
  }
};
var Jf = {
  id: Dn3.id,
  description: "shortcut.sheet.select-next-cell",
  group: "3_sheet-view",
  binding: q1.TAB,
  priority: 100,
  preconditions: Ne2,
  staticParameters: {
    direction: wm.RIGHT,
    keycode: q1.TAB
  }
};
var $f = {
  id: Dn3.id,
  description: "shortcut.sheet.select-previous-cell",
  group: "3_sheet-view",
  binding: q1.TAB | y12.SHIFT,
  priority: 100,
  preconditions: Ne2,
  staticParameters: {
    direction: wm.LEFT,
    keycode: q1.TAB
  }
};
var ep = {
  id: Dn3.id,
  description: "shortcut.sheet.select-below-cell",
  group: "3_sheet-view",
  binding: q1.ENTER,
  priority: 100,
  preconditions: Ne2,
  staticParameters: {
    direction: wm.DOWN,
    keycode: q1.ENTER
  }
};
var tp = {
  id: Dn3.id,
  description: "shortcut.sheet.select-up-cell",
  group: "3_sheet-view",
  binding: q1.ENTER | y12.SHIFT,
  priority: 100,
  preconditions: Ne2,
  staticParameters: {
    direction: wm.UP,
    keycode: q1.ENTER
  }
};
var np = {
  id: Ut3.id,
  description: "shortcut.sheet.select-below-value-cell",
  group: "3_sheet-view",
  binding: q1.ARROW_DOWN | y12.CTRL_COMMAND,
  preconditions: Ne2,
  staticParameters: {
    direction: wm.DOWN,
    jumpOver: kn3.moveGap
  }
};
var rp2 = {
  id: Ut3.id,
  description: "shortcut.sheet.select-up-value-cell",
  group: "3_sheet-view",
  binding: q1.ARROW_UP | y12.CTRL_COMMAND,
  preconditions: Ne2,
  staticParameters: {
    direction: wm.UP,
    jumpOver: kn3.moveGap
  }
};
var ip = {
  id: Ut3.id,
  description: "shortcut.sheet.select-left-value-cell",
  group: "3_sheet-view",
  binding: q1.ARROW_LEFT | y12.CTRL_COMMAND,
  preconditions: Ne2,
  staticParameters: {
    direction: wm.LEFT,
    jumpOver: kn3.moveGap
  }
};
var op = {
  id: Ut3.id,
  description: "shortcut.sheet.select-right-value-cell",
  group: "3_sheet-view",
  binding: q1.ARROW_RIGHT | y12.CTRL_COMMAND,
  preconditions: Ne2,
  staticParameters: {
    direction: wm.RIGHT,
    jumpOver: kn3.moveGap
  }
};
var sp = {
  id: Gt3.id,
  description: "shortcut.sheet.expand-selection-down",
  group: "3_sheet-view",
  binding: q1.ARROW_DOWN | y12.SHIFT,
  preconditions: Ne2,
  staticParameters: {
    direction: wm.DOWN
  }
};
var lp = {
  id: Gt3.id,
  description: "shortcut.sheet.expand-selection-up",
  group: "3_sheet-view",
  binding: q1.ARROW_UP | y12.SHIFT,
  preconditions: Ne2,
  staticParameters: {
    direction: wm.UP
  }
};
var ap = {
  id: Gt3.id,
  description: "shortcut.sheet.expand-selection-left",
  group: "3_sheet-view",
  binding: q1.ARROW_LEFT | y12.SHIFT,
  preconditions: Ne2,
  staticParameters: {
    direction: wm.LEFT
  }
};
var cp = {
  id: Gt3.id,
  description: "shortcut.sheet.expand-selection-right",
  group: "3_sheet-view",
  binding: q1.ARROW_RIGHT | y12.SHIFT,
  preconditions: Ne2,
  staticParameters: {
    direction: wm.RIGHT
  }
};
var dp = {
  id: Gt3.id,
  description: "shortcut.sheet.expand-selection-to-below-gap",
  group: "3_sheet-view",
  binding: q1.ARROW_DOWN | y12.SHIFT | y12.CTRL_COMMAND,
  preconditions: Ne2,
  staticParameters: {
    direction: wm.DOWN,
    jumpOver: kn3.moveGap
  }
};
var up = {
  id: Gt3.id,
  description: "shortcut.sheet.expand-selection-to-up-gap",
  group: "3_sheet-view",
  binding: q1.ARROW_UP | y12.SHIFT | y12.CTRL_COMMAND,
  preconditions: Ne2,
  staticParameters: {
    direction: wm.UP,
    jumpOver: kn3.moveGap
  }
};
var hp = {
  id: Gt3.id,
  description: "shortcut.sheet.expand-selection-to-left-gap",
  group: "3_sheet-view",
  binding: q1.ARROW_LEFT | y12.SHIFT | y12.CTRL_COMMAND,
  preconditions: Ne2,
  staticParameters: {
    direction: wm.LEFT,
    jumpOver: kn3.moveGap
  }
};
var gp = {
  id: Gt3.id,
  description: "shortcut.sheet.expand-selection-to-right-gap",
  group: "3_sheet-view",
  binding: q1.ARROW_RIGHT | y12.SHIFT | y12.CTRL_COMMAND,
  preconditions: Ne2,
  staticParameters: {
    direction: wm.RIGHT,
    jumpOver: kn3.moveGap
  }
};
var mp = {
  id: Ma2.id,
  description: "shortcut.sheet.select-all",
  group: "3_sheet-view",
  binding: q1.A | y12.CTRL_COMMAND,
  preconditions: Ne2,
  staticParameters: {
    expandToGapFirst: true,
    loop: true
  }
};
var fp = {
  id: zi2.id,
  description: "shortcut.sheet.set-bold",
  group: "4_sheet-edit",
  preconditions: (n3) => Ne2(n3),
  binding: q1.B | y12.CTRL_COMMAND
};
var pp = {
  id: ji3.id,
  description: "shortcut.sheet.set-italic",
  group: "4_sheet-edit",
  preconditions: (n3) => Ne2(n3),
  binding: q1.I | y12.CTRL_COMMAND
};
var vp = {
  id: Yi2.id,
  description: "shortcut.sheet.set-underline",
  group: "4_sheet-edit",
  preconditions: (n3) => Ne2(n3),
  binding: q1.U | y12.CTRL_COMMAND
};
var Sp = {
  id: Zi2.id,
  description: "shortcut.sheet.set-strike-through",
  group: "4_sheet-edit",
  preconditions: (n3) => Ne2(n3),
  binding: q1.X | y12.SHIFT | y12.CTRL_COMMAND
};
var Cp = {
  id: Ys.id,
  // when focusing on any other input tag do not trigger this shortcut
  preconditions: (n3) => Ne2(n3),
  binding: q1.DELETE,
  mac: q1.BACKSPACE
};
var wp = {
  id: Ys.id,
  // when focusing on any other input tag do not trigger this shortcut
  preconditions: (n3) => Ne2(n3),
  mac: q1.DELETE
};
var bp = {
  id: Ys.id,
  // when focusing on any other input tag do not trigger this shortcut
  preconditions: (n3) => Ne2(n3),
  binding: y12.SHIFT + q1.BACKSPACE
};
var _p = {
  id: Jd3.id,
  // when focusing on any other input tag do not trigger this shortcut
  preconditions: (n3) => Ne2(n3),
  binding: y12.SHIFT + q1.DELETE
};
var Rp = {
  id: as2.id,
  description: "shortcut.sheet.zoom-in",
  binding: q1.EQUAL | y12.CTRL_COMMAND,
  group: "3_sheet-view",
  preconditions: Ne2,
  priority: 1,
  staticParameters: {
    delta: 0.2
  }
};
var Ip = {
  id: Og.id,
  binding: q1.EQUAL | y12.CTRL_COMMAND
};
var yp = {
  id: as2.id,
  description: "shortcut.sheet.zoom-out",
  binding: q1.MINUS | y12.CTRL_COMMAND,
  group: "3_sheet-view",
  preconditions: Ne2,
  priority: 1,
  staticParameters: {
    delta: -0.2
  }
};
var Mp2 = {
  id: Og.id,
  binding: q1.MINUS | y12.CTRL_COMMAND
};
var Ep = {
  id: as2.id,
  description: "shortcut.sheet.reset-zoom",
  binding: q1.Digit0 | y12.CTRL_COMMAND,
  preconditions: Ne2,
  group: "3_sheet-view",
  priority: 1,
  staticParameters: {
    reset: true
  }
};
var Tp = {
  id: Og.id,
  binding: q1.Digit0 | y12.CTRL_COMMAND
};
var ER2 = Object.getOwnPropertyDescriptor;
var TR = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? ER2(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var Fn5 = (n3, e) => (t3, r) => e(t3, r, n3);
var Sl3 = class extends Ve {
  constructor(n3, e, t3, r, i, o3, s2, l4) {
    super(), this._injector = n3, this._componentManager = e, this._layoutService = t3, this._commandService = r, this._shortcutService = i, this._menuManagerService = o3, this._uiPartsService = s2, this._configService = l4, this._init();
  }
  _init() {
    this._initComponents(), this._initCommands(), this._initMenus(), this._initShortcuts(), this._initWorkbenchParts(), this._initFocusHandler();
  }
  _initComponents() {
    const n3 = this._componentManager;
    this.disposeWithMe(n3.register(pn2, Nf)), this.disposeWithMe(n3.register(pu2, Xf2)), this.disposeWithMe(n3.register(Vo3, jf2)), this.disposeWithMe(n3.register(wu2, zf2)), this.disposeWithMe(n3.register("HideGridlinesDoubleIcon", mu2));
  }
  // eslint-disable-next-line max-lines-per-function
  _initCommands() {
    [
      vu2,
      sr4,
      Cu2,
      Su2,
      as2,
      Gt3,
      Ut3,
      Dn3,
      Oa3,
      ba4,
      xo,
      Oo3,
      ga3,
      ma4,
      hn2,
      Xm,
      Ma2,
      su2,
      tg,
      Ii2,
      tt5,
      xa3,
      zi2,
      ji3,
      Yi2,
      Zi2,
      km2,
      Dm,
      fa2,
      tu2,
      nu3,
      Eo2,
      To2,
      ru3,
      ng,
      og,
      ig2,
      ag,
      _a4,
      iu2,
      ss2,
      Ra3,
      or4,
      Ao3,
      Jn4,
      Ia2,
      ya2,
      lu2,
      sg,
      cs3,
      Ln2,
      Ea4,
      wa3,
      bi4,
      wi3,
      os2,
      is2,
      au2,
      gr5,
      yo2,
      // permission
      On3,
      jm,
      va3,
      ai2,
      ci2,
      Sa4,
      Ca4,
      Pa4,
      di2,
      ui2,
      Ta4,
      ls2,
      ca3,
      da
    ].forEach((n3) => {
      this.disposeWithMe(this._commandService.registerCommand(n3));
    });
  }
  _initMenus() {
    this._menuManagerService.mergeMenu(V_);
  }
  _initShortcuts() {
    [
      // selection shortcuts
      Gf2,
      qf2,
      Qf,
      Kf2,
      Jf,
      $f,
      ep,
      tp,
      // MoveBackSelectionShortcutItem,
      np,
      rp2,
      ip,
      op,
      sp,
      lp,
      ap,
      cp,
      dp,
      up,
      hp,
      gp,
      mp,
      // view shortcuts
      Rp,
      yp,
      Ep,
      Tp,
      Ip,
      Mp2,
      // toggle cell style shortcuts
      fp,
      pp,
      vp,
      Sp,
      // cell content editing shortcuts
      Cp,
      wp,
      bp,
      _p,
      ...Sf(),
      wf,
      Cf,
      bf,
      If,
      yf2,
      Mf,
      Tf2,
      _f,
      Rf,
      Ef,
      // operation shortcuts
      Yf2,
      Zf2
    ].forEach((n3) => {
      this.disposeWithMe(this._shortcutService.registerShortcut(n3));
    });
  }
  _initWorkbenchParts() {
    const n3 = this._uiPartsService, e = this._injector;
    this.disposeWithMe(n3.registerComponent(u12.HEADER, () => connectInjector(L0, e))), this.disposeWithMe(n3.registerComponent(u12.FOOTER, () => connectInjector(D0, e))), this.disposeWithMe(n3.registerComponent(u12.CONTENT, () => connectInjector(ff, e)));
  }
  _initFocusHandler() {
    this.disposeWithMe(
      this._layoutService.registerFocusHandler(we.UNIVER_SHEET, (n3) => {
        const e = this._injector.get(JE), t3 = this._injector.get(br), r = eF(we.UNIVER_DOC, t3, e), i = r == null ? void 0 : r.with(Re);
        i == null || i.focus();
      })
    );
  }
};
Sl3 = TR([
  Fn5(0, Inject(Injector)),
  Fn5(1, Inject(S13)),
  Fn5(2, j1),
  Fn5(3, Ds),
  Fn5(4, Le),
  Fn5(5, Z1),
  Fn5(6, N1),
  Fn5(7, xs)
], Sl3);
var PR = Object.getOwnPropertyDescriptor;
var xR = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? PR(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var Gr5 = (n3, e) => (t3, r) => e(t3, r, n3);
var OR = rR("statusBarPermissionCorrect");
var AR = class {
  constructor() {
    _2(this, "_sum", 0);
    _2(this, "_count", 0);
    _2(this, "_countNumber", 0);
    _2(this, "_min", Number.POSITIVE_INFINITY);
    _2(this, "_max", Number.NEGATIVE_INFINITY);
  }
  add(e, t3, r) {
    if (!Z.isDefine(e == null ? void 0 : e.v))
      return;
    const i = e == null ? void 0 : e.t;
    let { v: o3 } = e;
    const s2 = (a4) => {
      this._sum += a4, this._countNumber++, this._min = Math.min(this._min, a4), this._max = Math.max(this._max, a4);
    }, l4 = (a4, c2, d2) => {
      var m9;
      if (!((m9 = a4 == null ? void 0 : a4.n) != null && m9.pattern))
        return;
      const { pattern: u2 } = a4.n;
      d2[u2] || (d2[u2] = a1.getFormatInfo(u2)), d2[u2].isDate && s2(c2);
    };
    if (typeof o3 == "string" && i === mn.NUMBER) {
      const a4 = Number(o3);
      Number.isNaN(a4) || (o3 = a4);
    }
    if (typeof o3 == "number" && i !== mn.STRING)
      s2(o3);
    else if (i === mn.NUMBER && e.s) {
      const a4 = t3.get(e.s);
      l4(a4, o3, r);
    }
    this._count++;
  }
  getResults() {
    return {
      sum: this._sum,
      count: this._countNumber,
      // the countA in formula is the count of all values
      countA: this._count,
      min: this._min,
      max: this._max
    };
  }
};
function HR2(n3) {
  const { sum: e, count: t3, countA: r, min: i, max: o3 } = n3.getResults();
  return [
    {
      func: P2.MAX,
      value: o3
    },
    {
      func: P2.MIN,
      value: i
    },
    {
      func: F.SUM,
      value: e
    },
    {
      func: P2.COUNTA,
      value: r
    },
    {
      func: P2.COUNT,
      value: t3
    },
    {
      func: P2.AVERAGE,
      value: e / t3
    }
  ];
}
var Tr4 = class extends Ve {
  constructor(e, t3, r, i, o3, s2) {
    super();
    _2(this, "interceptor", new sR({ STATUS_BAR_PERMISSION_CORRECT: OR }));
    this._univerInstanceService = e, this._selectionManagerService = t3, this._statusBarService = r, this._commandService = i, this._numfmtService = o3, this._formulaDataModel = s2, this._init();
  }
  _init() {
    this._registerSelectionListener();
  }
  _registerSelectionListener() {
    const e = uR((r) => {
      var o3;
      const i = (o3 = r[r.length - 1]) == null ? void 0 : o3.primary;
      this._calculateSelection(
        r.map((s2) => s2.range),
        i
      );
    }, 100), t3 = uR((r) => {
      var o3;
      const i = (o3 = r[r.length - 1]) == null ? void 0 : o3.primary;
      this._calculateSelection(
        r.map((s2) => s2.range),
        i
      );
    }, 500);
    this.disposeWithMe(
      Be(
        this._selectionManagerService.selectionMoving$.subscribe((r) => {
          r && t3(r);
        })
      )
    ), this.disposeWithMe(
      Be(
        this._selectionManagerService.selectionMoveEnd$.subscribe((r) => {
          r && e(r);
        })
      )
    ), this.disposeWithMe(
      this._commandService.onCommandExecuted((r) => {
        if (r.id === ee2.id) {
          const i = this._selectionManagerService.getCurrentSelections();
          i && e(i);
        }
      })
    );
  }
  _clearResult() {
    this._statusBarService.setState(null);
  }
  getRangeStartEndInfo(e, t3) {
    return e.rangeType === ge.ALL ? {
      startRow: 0,
      startColumn: 0,
      endRow: t3.getRowCount() - 1,
      endColumn: t3.getColumnCount() - 1
    } : e.rangeType === ge.COLUMN ? {
      startRow: 0,
      startColumn: e.startColumn,
      endRow: t3.getRowCount() - 1,
      endColumn: e.endColumn
    } : e.rangeType === ge.ROW ? {
      startRow: e.startRow,
      startColumn: 0,
      endRow: e.endRow,
      endColumn: t3.getColumnCount() - 1
    } : {
      startRow: e.startRow,
      startColumn: e.startColumn,
      endRow: e.endRow,
      endColumn: e.endColumn
    };
  }
  _getCellValue(e, t3, r, i) {
    var l4, a4, c2, d2;
    const o3 = r.getCellRaw(e, t3), s2 = (l4 = i == null ? void 0 : i[e]) == null ? void 0 : l4[t3];
    return s2 ? {
      t: (a4 = s2.t) != null ? a4 : o3 == null ? void 0 : o3.t,
      v: (c2 = s2.v) != null ? c2 : o3 == null ? void 0 : o3.v,
      s: (d2 = s2.s) != null ? d2 : o3 == null ? void 0 : o3.s
    } : o3;
  }
  // eslint-disable-next-line max-lines-per-function
  _calculateSelection(e, t3) {
    var a4, c2;
    const r = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET);
    if (!r)
      return this._clearResult();
    const i = r.getUnitId(), o3 = r.getActiveSheet(), s2 = o3 == null ? void 0 : o3.getSheetId();
    if (!s2)
      return this._clearResult();
    const l4 = {};
    if (this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET).getSheets().forEach((d2) => {
      const u2 = d2.getConfig();
      l4[d2.getSheetId()] = {
        cellData: new ht(u2.cellData),
        rowCount: u2.rowCount,
        columnCount: u2.columnCount,
        rowData: u2.rowData,
        columnData: u2.columnData
      };
    }), e != null && e.length) {
      const d2 = [];
      e.forEach((I6) => {
        const { startRow: R9, endRow: y6 } = I6;
        let E3 = null;
        for (let M10 = R9; M10 <= y6; M10++)
          o3.getRowVisible(M10) ? E3 === null && (E3 = M10) : E3 !== null && (d2.push(__spreadProps(__spreadValues({}, I6), { startRow: E3, endRow: M10 - 1 })), E3 = null);
        E3 !== null && d2.push(__spreadProps(__spreadValues({}, I6), { startRow: E3, endRow: y6 }));
      });
      const u2 = Bu(d2), h9 = new AR(), m9 = r.getStyles(), g9 = {}, f4 = this._formulaDataModel.getArrayFormulaCellData(), p3 = (a4 = f4 == null ? void 0 : f4[i]) == null ? void 0 : a4[s2];
      for (const I6 of u2) {
        const { startRow: R9, startColumn: y6, endColumn: E3, endRow: M10 } = this.getRangeStartEndInfo(I6, o3);
        for (let T10 = R9; T10 <= M10; T10++)
          for (let P8 = y6; P8 <= E3; P8++) {
            const A4 = this._getCellValue(T10, P8, o3, p3);
            h9.add(A4, m9, g9);
          }
      }
      const v6 = HR2(h9);
      if (v6.every((I6) => I6 === void 0))
        return;
      let S = null;
      if (t3) {
        const { actualRow: I6, actualColumn: R9 } = t3;
        S = (c2 = this._numfmtService.getValue(i, s2, I6, R9)) == null ? void 0 : c2.pattern;
      }
      const C = {
        values: v6.filter((I6) => I6 !== void 0),
        pattern: S
      };
      this._statusBarService.setState(C);
    } else
      this._clearResult();
  }
};
Tr4 = xR([
  Gr5(0, br),
  Gr5(1, Inject(z)),
  Gr5(2, Ha3),
  Gr5(3, Ds),
  Gr5(4, Inject($t2)),
  Gr5(5, Inject(yr))
], Tr4);
var VR = (n3 = []) => {
  const e = useDependency(Xi3);
  (0, import_react.useEffect)(() => {
    const t3 = n3.map((r) => e.addShape({
      range: r,
      style: {
        fill: "rgba(73, 184, 17, 0.05)",
        strokeWidth: 1,
        stroke: "#49B811",
        widgets: {}
      },
      primary: null
    }));
    return () => {
      t3.forEach((r) => {
        r && e.removeShape(r);
      });
    };
  }, [n3]);
};
var NR = Object.getOwnPropertyDescriptor;
var kR = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? NR(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var Xh2 = (n3, e) => (t3, r) => e(t3, r, n3);
var xi2 = class extends Ve {
  constructor(e, t3) {
    super();
    _2(this, "_previousSheetIndex", -1);
    this._commandService = e, this._univerInstanceService = t3, this.disposeWithMe(this._commandService.beforeCommandExecuted((r) => {
      if (r.id === Lt2.id)
        return this._beforeAdjustActiveSheetOnRemoveSheet(
          r
        );
    })), this.disposeWithMe(this._commandService.onCommandExecuted((r, i) => {
      if (r.id === Lt2.id)
        return this._adjustActiveSheetOnRemoveSheet(r);
      if (r.id === St2.id && r.params.hidden)
        return this._adjustActiveSheetOnHideSheet(r);
      if (i != null && i.fromCollab) return false;
      if (r.id === ln.id)
        return this._adjustActiveSheetOnInsertSheet(r);
      if (r.id === St2.id && !r.params.hidden)
        return this._adjustActiveSheetOnShowSheet(r);
      if (r.id === ie5.id)
        return this._adjustActiveSheetOnSelection(r);
    }));
  }
  _adjustActiveSheetOnHideSheet(e) {
    var a4;
    const { unitId: t3, subUnitId: r } = e.params, i = this._univerInstanceService.getUniverSheetInstance(t3);
    if (!i || ((a4 = i.getActiveSheet()) == null ? void 0 : a4.getSheetId()) !== r)
      return;
    const s2 = i.getActiveSheetIndex(), l4 = zh2(i, s2);
    this._switchToNextSheet(t3, l4);
  }
  _beforeAdjustActiveSheetOnRemoveSheet(e) {
    const { unitId: t3, subUnitId: r } = e.params, i = this._univerInstanceService.getUniverSheetInstance(t3);
    if (!i)
      return;
    const o3 = i.getSheetBySheetId(r);
    o3 && (this._previousSheetIndex = i.getSheetIndex(o3));
  }
  _adjustActiveSheetOnRemoveSheet(e) {
    if (this._previousSheetIndex === -1)
      return;
    const { unitId: t3 } = e.params, r = this._univerInstanceService.getUniverSheetInstance(t3);
    if (!r)
      return;
    if (r.getActiveSheet().getSheetId() === e.params.subUnitId) {
      const o3 = this._previousSheetIndex, s2 = o3 >= 1 ? o3 - 1 : 0, l4 = zh2(r, s2);
      this._switchToNextSheet(t3, l4);
    }
  }
  _adjustActiveSheetOnInsertSheet(e) {
    const { unitId: t3, sheet: r } = e.params;
    this._switchToNextSheet(t3, r.id);
  }
  _adjustActiveSheetOnShowSheet(e) {
    const { unitId: t3, subUnitId: r } = e.params;
    this._switchToNextSheet(t3, r);
  }
  _adjustActiveSheetOnSelection(e) {
    var i;
    const { unitId: t3, subUnitId: r } = e.params;
    r !== ((i = this._univerInstanceService.getUnit(t3)) == null ? void 0 : i.getActiveSheet().getSheetId()) && this._switchToNextSheet(t3, r);
  }
  _switchToNextSheet(e, t3) {
    this._commandService.executeCommand(pn.id, {
      unitId: e,
      subUnitId: t3
    });
  }
};
xi2 = kR([
  Xh2(0, Ds),
  Xh2(1, br)
], xi2);
function zh2(n3, e) {
  const t3 = n3.getSheetSize();
  for (let r = e; r > -1; r--) {
    const i = n3.getSheetByIndex(r);
    if (!i.getConfig().hidden)
      return i.getSheetId();
  }
  for (let r = e; r < t3; r++) {
    const i = n3.getSheetByIndex(r);
    if (!i.getConfig().hidden)
      return i.getSheetId();
  }
  throw new Error(
    "[ActiveWorksheetController]: could not find the next unhidden sheet! Collaboration error perhaps."
  );
}
var DR = Object.getOwnPropertyDescriptor;
var LR = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? DR(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var jh3 = (n3, e) => (t3, r) => e(t3, r, n3);
var Co2 = ((n3) => (n3[n3.INFO = 0] = "INFO", n3[n3.WARNING = 1] = "WARNING", n3[n3.ERROR = 2] = "ERROR", n3))(Co2 || {});
var Fo3 = class extends Ve {
  constructor(e, t3) {
    super();
    _2(this, "_currentAlert$", new Subject());
    _2(this, "_currentAlert", /* @__PURE__ */ new Map());
    _2(this, "currentAlert$", this._currentAlert$.asObservable());
    this._renderManagerService = e, this._cellPopupManagerService = t3, this.disposeWithMe(() => {
      this._currentAlert$.complete();
    });
  }
  get currentAlert() {
    return this._currentAlert;
  }
  showAlert(e) {
    var d2;
    let t3 = this._currentAlert.get(e.key);
    t3 && t3.dispose.dispose(), t3 ? t3.dispose.dispose() : (t3 = {
      alert: e,
      dispose: {
        dispose() {
        }
      }
    }, this._currentAlert.set(e.key, t3));
    const { location: r } = e, { row: i, col: o3, unitId: s2, subUnitId: l4 } = r;
    if (!this._renderManagerService.getRenderById(s2))
      return;
    const c2 = this._cellPopupManagerService.showPopup(
      {
        unitId: s2,
        subUnitId: l4,
        row: i,
        col: o3
      },
      {
        componentKey: Pp,
        direction: "horizontal",
        extraProps: {
          alert: e
        },
        priority: 1
      }
    );
    c2 && (t3 && ((d2 = t3.dispose) == null || d2.dispose()), t3.dispose = c2), this._currentAlert$.next(Array.from(this._currentAlert.entries()));
  }
  removeAlert(e) {
    const t3 = this._currentAlert.get(e);
    t3 && (this._currentAlert.delete(e), t3 == null || t3.dispose.dispose(), this._currentAlert$.next(Array.from(this._currentAlert.entries())));
  }
  clearAlert() {
    this._currentAlert.forEach((e) => {
      e.dispose.dispose();
    }), this._currentAlert.clear(), this._currentAlert$.next(Array.from(this._currentAlert.entries()));
  }
};
Fo3 = LR([
  jh3(0, JE),
  jh3(1, Inject(Er3))
], Fo3);
function WR2({ popup: n3 }) {
  var s2;
  const e = (s2 = n3.extraProps) == null ? void 0 : s2.alert;
  if (!e)
    return null;
  const { type: t3, title: r, message: i } = e, o3 = {
    [Co2.ERROR]: (0, import_jsx_runtime.jsx)(du2, { className: "univer-mr-1.5 univer-text-red-500" }),
    [Co2.INFO]: (0, import_jsx_runtime.jsx)(rf, { className: "univer-mr-1.5 univer-text-blue-500" }),
    [Co2.WARNING]: (0, import_jsx_runtime.jsx)(lf, { className: "univer-mr-1.5 univer-text-yellow-500" })
  };
  return (0, import_jsx_runtime.jsxs)(
    "div",
    {
      className: "univer-z-[100] univer-box-border univer-w-[156px] univer-rounded-lg univer-bg-white univer-px-2 univer-py-1 univer-text-gray-900 univer-shadow dark:!univer-bg-black dark:!univer-text-white",
      children: [
        (0, import_jsx_runtime.jsxs)(
          "div",
          {
            className: "univer-mb-1.5 univer-flex univer-h-5 univer-flex-row univer-items-center univer-text-sm univer-font-medium",
            children: [
              t3 ? o3[t3] : null,
              r
            ]
          }
        ),
        (0, import_jsx_runtime.jsx)("div", { className: "univer-text-sm", children: i })
      ]
    }
  );
}
var Pp = "univer.sheet.cell-alert";
var BR = Object.getOwnPropertyDescriptor;
var FR2 = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? BR(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var UR = (n3, e) => (t3, r) => e(t3, r, n3);
var Cl2 = class extends Ve {
  constructor(n3, e) {
    super(), this._context = n3, this._componentManager = e, this._initComponent();
  }
  _initComponent() {
    this.disposeWithMe(
      this._componentManager.register(Pp, WR2)
    );
  }
};
Cl2 = FR2([
  UR(1, Inject(S13))
], Cl2);
var XR2 = Object.getOwnPropertyDescriptor;
var zR2 = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? XR2(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var Yh2 = (n3, e) => (t3, r) => e(t3, r, n3);
var wl3 = class extends Ve {
  constructor(n3, e, t3) {
    super(), this._context = n3, this._editorBridgeService = e, this._cellPopupManagerService = t3, this._initEditorVisibleListener();
  }
  _initEditorVisibleListener() {
    this.disposeWithMe(
      this._editorBridgeService.visible$.pipe(
        filter((n3) => n3.visible)
      ).subscribe(() => {
        const n3 = this._editorBridgeService.getEditLocation();
        n3 && this._cellPopupManagerService.hidePopup(
          n3.unitId,
          n3.sheetId,
          n3.row,
          n3.column
        );
      })
    );
  }
};
wl3 = zR2([
  Yh2(1, Qe3),
  Yh2(2, Inject(Er3))
], wl3);
var jR2 = Object.getOwnPropertyDescriptor;
var YR2 = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? jR2(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var ys3 = (n3, e) => (t3, r) => e(t3, r, n3);
var Oi4 = class extends Ve {
  constructor(e, t3, r, i) {
    super();
    _2(this, "_isPointer", false);
    this._hoverManagerService = e, this._instanceService = t3, this._commandService = r, this._renderManagerService = i, this._initPointerEvent(), this._initHover();
  }
  get _mainComponent() {
    var e;
    return (e = eF(we.UNIVER_SHEET, this._instanceService, this._renderManagerService)) == null ? void 0 : e.mainComponent;
  }
  _initHover() {
    this.disposeWithMe(this._hoverManagerService.currentRichText$.subscribe((e) => {
      var t3, r;
      e != null && e.bullet ? (this._isPointer || (t3 = this._mainComponent) == null || t3.setCursor(v1.POINTER), this._isPointer = true) : (this._isPointer && ((r = this._mainComponent) == null || r.setCursor(v1.AUTO)), this._isPointer = false);
    }));
  }
  _initPointerEvent() {
    this.disposeWithMe(this._hoverManagerService.currentClickedCell$.subscribe((e) => {
      const { location: t3, bullet: r } = e;
      r && this._commandService.executeCommand(Rd2.id, {
        unitId: t3.unitId,
        subUnitId: t3.subUnitId,
        row: t3.row,
        col: t3.col,
        paragraphIndex: r.startIndex
      });
    }));
  }
};
Oi4 = YR2([
  ys3(0, Inject(Mr3)),
  ys3(1, br),
  ys3(2, Ds),
  ys3(3, JE)
], Oi4);
var Zh2 = 2;
var ZR2 = [
  { value: "DEFAULT_PASTE", label: "rightClick.paste" },
  { value: "SPECIAL_PASTE_VALUE", label: "rightClick.pasteValue" },
  { value: "SPECIAL_PASTE_FORMAT", label: "rightClick.pasteFormat" },
  { value: "SPECIAL_PASTE_COL_WIDTH", label: "rightClick.pasteColWidth" },
  { value: "SPECIAL_PASTE_BESIDES_BORDER", label: "rightClick.pasteBesidesBorder" },
  { value: "SPECIAL_PASTE_FORMULA", label: "formula.operation.pasteFormula" }
];
var GR = (n3) => {
  var P8, A4, x7, H6, V7;
  const e = useDependency(br), t3 = useDependency(JE), r = Wr4();
  if (!n3 || !r) return null;
  const i = {
    startRow: n3.rows[0],
    startCol: n3.cols[0],
    endRow: n3.rows[n3.rows.length - 1],
    endCol: n3.cols[n3.cols.length - 1]
  };
  if (i.endRow < 0 || i.endCol < 0)
    return null;
  const o3 = t3.getRenderById(r.getUnitId()), s2 = o3 == null ? void 0 : o3.with(he2), l4 = o3 == null ? void 0 : o3.with(gt), a4 = $t4(e, t3);
  if (!a4 || !l4) return null;
  const { scene: c2 } = a4, d2 = s2 == null ? void 0 : s2.getCurrentSkeleton(), u2 = l4.getViewPort(), h9 = c2 == null ? void 0 : c2.scaleX, m9 = c2 == null ? void 0 : c2.scaleY, g9 = c2 == null ? void 0 : c2.getViewportScrollXY(u2), f4 = (P8 = c2.getEngine()) == null ? void 0 : P8.getCanvas();
  if (!h9 || !c2 || !h9 || !m9 || !g9) return null;
  const p3 = d2 == null ? void 0 : d2.getNoMergeCellPositionByIndex(i.endRow, i.endCol), v6 = (A4 = p3 == null ? void 0 : p3.endX) != null ? A4 : 0, S = (x7 = p3 == null ? void 0 : p3.endY) != null ? x7 : 0, w6 = (H6 = aA(v6, h9, g9)) != null ? H6 : -9999, C = (V7 = rA(S, m9, g9)) != null ? V7 : -9999, I6 = f4 == null ? void 0 : f4.getWidth(), R9 = f4 == null ? void 0 : f4.getHeight();
  if (!I6 || !R9) return null;
  const y6 = w6 + 50 <= I6, E3 = C + 50 <= R9;
  let M10 = w6, T10 = C;
  return y6 || (M10 = I6 - 100), E3 || (T10 = R9 - 100), {
    positionX: M10,
    positionY: T10
  };
};
var qR = () => {
  const n3 = useDependency(tn3), e = useObservable(n3.showMenu$, false), t3 = useObservable(n3.pasteOptionsCache$, null), r = useDependency(Hn), i = useDependency(Ds), [o3, s2] = (0, import_react.useState)(false), [l4, a4] = (0, import_react.useState)(false), c2 = t3 == null ? void 0 : t3.target.pastedRange, d2 = GR(c2);
  if (!d2 || !e || d2.positionX < 50 || d2.positionY < 30) return null;
  const u2 = o3 || l4, h9 = (m9) => {
    a4(false), i.executeCommand(Am.id, { type: m9 });
  };
  return (0, import_jsx_runtime.jsx)("div", { className: "univer-absolute univer-inset-0 univer-z-10 univer-size-0", children: (0, import_jsx_runtime.jsx)(
    "div",
    {
      className: "univer-absolute",
      style: {
        left: d2.positionX + Zh2,
        top: d2.positionY + Zh2
      },
      onMouseEnter: () => s2(true),
      onMouseLeave: () => s2(false),
      children: (0, import_jsx_runtime.jsx)(
        rp,
        {
          align: "start",
          items: ZR2.map((m9) => ({
            type: "checkbox",
            value: m9.value,
            label: r.t(m9.label),
            checked: (t3 == null ? void 0 : t3.pasteType) === et4[m9.value],
            onSelect: () => h9(m9.value)
          })),
          open: l4,
          onOpenChange: a4,
          children: (0, import_jsx_runtime.jsxs)(
            "div",
            {
              className: ie2("univer-flex univer-items-center univer-gap-2 univer-rounded univer-p-1 hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-800", kt2, {
                "univer-bg-gray-100 dark:!univer-bg-gray-800": l4,
                "univer-bg-white dark:!univer-bg-gray-900": !l4
              }),
              children: [
                (0, import_jsx_runtime.jsx)(
                  df,
                  {
                    className: "univer-fill-primary-600 univer-text-gray-900 dark:!univer-text-white"
                  }
                ),
                u2 && (0, import_jsx_runtime.jsx)(Mi2, { className: "dark:!univer-text-white" })
              ]
            }
          )
        }
      )
    }
  ) });
};
var QR2 = [
  tt5.id,
  Sn2.id,
  Ln2.id,
  wt2.id,
  Te.id,
  Me.id,
  ke2.id,
  Ue2.id,
  Je3.id,
  qe2.id,
  mt2.id,
  nt2.id,
  ie5.id,
  IC
];
function KR2(n3, e, t3, r, i) {
  const o3 = [], s2 = [];
  if (r.copyType === jn4.CUT) {
    const { undos: l4, redos: a4 } = JR(n3, e, i);
    o3.push(...a4), s2.push(...l4);
  } else {
    const { undos: l4, redos: a4 } = Ap(e, t3, i);
    o3.push(...a4), s2.push(...l4);
    const { undos: c2, redos: d2 } = $R2(e, t3, i);
    o3.push(...d2), s2.push(...c2);
    const { undos: u2, redos: h9 } = xp2(e, n3, t3, i);
    o3.push(...h9), s2.push(...u2);
    const { undos: m9, redos: g9 } = Op(e, n3, t3, i, true);
    o3.push(...g9), s2.push(...m9);
    const { undos: f4, redos: p3 } = nd3(
      e,
      t3,
      i
    );
    o3.push(...p3), s2.push(...f4);
  }
  return {
    undos: s2,
    redos: o3
  };
}
function JR(n3, e, t3) {
  let r = [], i = [];
  const { range: o3, subUnitId: s2, unitId: l4 } = n3, { range: a4, subUnitId: c2 } = e, d2 = a4 ? Cr3(a4) : null, u2 = o3 ? Cr3(o3) : null;
  if (u2 && d2) {
    const h9 = t3.get(br), m9 = t3.get(G), g9 = h9.getUniverSheetInstance(l4), f4 = g9 == null ? void 0 : g9.getSheetBySheetId(s2), p3 = g9 == null ? void 0 : g9.getSheetBySheetId(c2);
    if (f4 && p3) {
      const v6 = new ht(), S = new ht(), w6 = f4.getCellMatrix(), C = p3.getCellMatrix();
      vr.foreach(u2, (F7, z5) => {
        v6.setValue(F7, z5, WE(w6.getValue(F7, z5))), S.setValue(F7, z5, null);
      });
      const I6 = new ht();
      vr.foreach(d2, (F7, z5) => {
        I6.setValue(F7, z5, WE(C.getValue(F7, z5)));
      });
      const R9 = new ht();
      vr.foreach(u2, (F7, z5) => {
        const Z9 = QR(F7, z5), de3 = Cn.getRelativeRange(Z9, u2), Re5 = Cn.getPositionRange(de3, d2);
        R9.setValue(Re5.startRow, Re5.startColumn, w6.getValue(F7, z5));
      });
      const y6 = {
        fromRange: u2,
        toRange: d2,
        from: {
          value: S.getMatrix(),
          subUnitId: s2
        },
        to: {
          value: R9.getMatrix(),
          subUnitId: c2
        },
        unitId: l4
      }, E3 = {
        fromRange: d2,
        toRange: u2,
        from: {
          value: v6.getMatrix(),
          subUnitId: s2
        },
        to: {
          value: I6.getMatrix(),
          subUnitId: c2
        },
        unitId: l4
      }, M10 = m9.onCommandExecute({
        id: yt2.id,
        params: { toRange: d2, fromRange: u2 }
      }), T10 = f4.getMergeData(), P8 = p3.getMergeData(), A4 = T10.filter((F7) => Cn.intersects(F7, u2)), x7 = P8.filter((F7) => Cn.intersects(F7, d2)), H6 = A4.map((F7) => Cn.getRelativeRange(F7, u2)).map((F7) => Cn.getPositionRange(F7, d2)), V7 = Jr3(H6), D5 = [
        {
          id: se2.id,
          params: {
            unitId: l4,
            subUnitId: s2,
            ranges: A4
          }
        },
        {
          id: se2.id,
          params: {
            unitId: l4,
            subUnitId: s2,
            ranges: x7
          }
        },
        {
          id: ne.id,
          params: {
            unitId: l4,
            subUnitId: c2,
            ranges: V7
          }
        }
      ], B5 = [
        {
          id: se2.id,
          params: {
            unitId: l4,
            subUnitId: c2,
            ranges: V7
          }
        },
        {
          id: ne.id,
          params: {
            unitId: l4,
            subUnitId: c2,
            ranges: x7
          }
        },
        {
          id: ne.id,
          params: {
            unitId: l4,
            subUnitId: s2,
            ranges: A4
          }
        }
      ];
      r = [
        { id: wt2.id, params: y6 },
        ...M10.redos,
        ...D5,
        {
          id: ie5.id,
          params: {
            unitId: l4,
            subUnitId: c2,
            selections: [{ range: d2 }],
            type: we3.MOVE_END
          }
        }
      ], i = [
        { id: wt2.id, params: E3 },
        ...M10.undos,
        ...B5,
        {
          id: ie5.id,
          params: {
            unitId: l4,
            subUnitId: s2,
            type: we3.MOVE_END,
            selections: [{ range: u2 }]
          }
        }
      ];
    }
  }
  return {
    undos: i,
    redos: r
  };
}
function xp2(n3, e, t3, r) {
  var g9;
  const { unitId: i, subUnitId: o3, range: s2 } = n3, l4 = (g9 = r.get(br).getUniverSheetInstance(i)) == null ? void 0 : g9.getSheetBySheetId(o3), a4 = [], c2 = [], { mapFunc: d2 } = wr4([s2]), u2 = new ht();
  t3.forValue((f4, p3, v6) => {
    var I6, R9;
    const { row: S, col: w6 } = d2(f4, p3), C = {
      v: v6.v,
      t: v6.t
    };
    if (!v6.p && v6.v && !e) {
      const y6 = l4 == null ? void 0 : l4.getCellStyle(S, w6);
      if (l1((I6 = y6 == null ? void 0 : y6.n) == null ? void 0 : I6.pattern))
        C.t = mn.STRING;
      else {
        const E3 = String(v6.v), M10 = a1.parseValue(E3);
        (M10 == null ? void 0 : M10.v) !== void 0 && typeof M10.v == "number" && (!M10.z && mR(E3) ? C.t = mn.FORCE_STRING : C.v = M10.v);
      }
    }
    if ((R9 = v6.p) != null && R9.body && Jc3(v6.p.body)) {
      const y6 = { p: Ct(v6.p), v: v6.v };
      u2.setValue(S, w6, y6);
    } else
      u2.setValue(S, w6, C && WE(C));
  });
  const h9 = {
    unitId: i,
    subUnitId: o3,
    cellValue: YE(u2.getMatrix())
  };
  a4.push({
    id: ee2.id,
    params: h9
  });
  const m9 = Ae4(
    r,
    h9
  );
  return c2.push({
    id: ee2.id,
    params: m9
  }), {
    undos: c2,
    redos: a4
  };
}
function Op(n3, e, t3, r, i = false) {
  var f4;
  const o3 = [], s2 = [], { unitId: l4, subUnitId: a4, range: c2 } = n3, d2 = (f4 = r.get(br).getUniverSheetInstance(l4)) == null ? void 0 : f4.getSheetBySheetId(a4), u2 = new ht(), { mapFunc: h9 } = wr4([c2]);
  t3.forValue((p3, v6, S) => {
    var E3, M10;
    const w6 = {
      s: Object.assign({}, __spreadProps(__spreadValues({}, rt), {
        pd: h2,
        bg: null,
        cl: null
      }), S.s)
    }, C = w6.s.bd;
    C && (Object.keys(C).length > 0 || (w6.s.bd = {
      b: null,
      l: null,
      r: null,
      t: null
    }));
    const { row: I6, col: R9 } = h9(p3, v6), y6 = d2 == null ? void 0 : d2.getCellStyle(I6, R9);
    if (S.v && !e && l1((E3 = y6 == null ? void 0 : y6.n) == null ? void 0 : E3.pattern))
      w6.s || (w6.s = {}), w6.s.n = y6 == null ? void 0 : y6.n;
    else {
      const T10 = String(S.v), P8 = a1.parseValue(T10);
      P8 != null && P8.z && (w6.s || (w6.s = {}), typeof w6.s == "object" && ((M10 = w6.s) != null && M10.n ? w6.s.n.pattern = P8.z : w6.s.n = { pattern: P8.z }));
    }
    u2.setValue(I6, R9, w6);
  });
  const m9 = {
    unitId: l4,
    subUnitId: a4,
    cellValue: YE(u2.getMatrix())
  };
  o3.push({
    id: ee2.id,
    params: m9
  });
  const g9 = Ae4(
    r,
    m9
  );
  return s2.push({
    id: ee2.id,
    params: g9
  }), {
    undos: s2,
    redos: o3
  };
}
function Ap(n3, e, t3) {
  const r = [], i = [], o3 = new ht(), { unitId: s2, subUnitId: l4, range: a4 } = n3, { mapFunc: c2 } = wr4([a4]);
  if (e.forEach((d2, u2) => {
    Object.keys(u2).forEach((h9) => {
      const m9 = Number(h9), { row: g9, col: f4 } = c2(d2, m9);
      o3.setValue(g9, f4, { s: null });
    });
  }), o3.getLength() > 0) {
    const d2 = {
      subUnitId: l4,
      unitId: s2,
      cellValue: YE(o3.getMatrix())
    };
    r.push({
      id: ee2.id,
      params: d2
    });
    const u2 = Ae4(
      t3,
      d2
    );
    i.push({
      id: ee2.id,
      params: u2
    });
  }
  return { undos: i, redos: r };
}
function $R2(n3, e, t3) {
  const r = [], i = [], o3 = new ht(), { unitId: s2, subUnitId: l4, range: a4 } = n3, { mapFunc: c2 } = wr4([a4]);
  if (e.forValue((d2, u2, h9) => {
    const { row: m9, col: g9 } = c2(d2, u2);
    o3.setValue(m9, g9, { v: null, p: null });
  }), o3.getLength() > 0) {
    const d2 = {
      subUnitId: l4,
      unitId: s2,
      cellValue: YE(o3.getMatrix())
    };
    r.push({
      id: ee2.id,
      params: d2
    });
    const u2 = Ae4(
      t3,
      d2
    );
    i.push({
      id: ee2.id,
      params: u2
    });
  }
  return { undos: i, redos: r };
}
function nd3(n3, e, t3) {
  const r = [], i = [], { unitId: o3, subUnitId: s2, range: l4 } = n3, { startColumn: a4, startRow: c2, endColumn: d2, endRow: u2 } = Cr3(l4), h9 = [];
  e.forValue((S, w6, C) => {
    if (C.rowSpan && C.rowSpan > 1) {
      const I6 = C.colSpan || 1, R9 = {
        startRow: c2 + S,
        endRow: c2 + S + C.rowSpan - 1,
        startColumn: a4 + w6,
        endColumn: a4 + w6 + I6 - 1
      };
      h9.push(R9);
    } else if (C.colSpan && C.colSpan > 1) {
      const I6 = C.rowSpan || 1, R9 = {
        startRow: c2 + S,
        endRow: c2 + S + I6 - 1,
        startColumn: a4 + w6,
        endColumn: a4 + w6 + C.colSpan - 1
      };
      h9.push(R9);
    }
  });
  const g9 = t3.get(br).getUniverSheetInstance(o3), f4 = g9 == null ? void 0 : g9.getSheetBySheetId(s2);
  if (g9 && f4) {
    const w6 = f4.getMergeData().filter(
      (R9) => Cn.intersects({ startRow: c2, startColumn: a4, endRow: u2, endColumn: d2 }, R9)
    ), C = {
      unitId: o3,
      subUnitId: s2,
      ranges: w6
    };
    r.push({
      id: se2.id,
      params: C
    });
    const I6 = ye3(
      t3,
      C
    );
    i.push({
      id: ne.id,
      params: I6
    });
  }
  const p3 = {
    unitId: o3,
    subUnitId: s2,
    ranges: h9
  };
  h9.length > 0 && r.push({
    id: ne.id,
    params: p3
  });
  const v6 = We3(
    t3,
    p3
  );
  return h9.length > 0 && i.push({
    id: se2.id,
    params: v6
  }), { undos: i, redos: r };
}
function eI2(n3) {
  if (!n3.includes("\r") && Z.isLegalUrl(n3)) {
    const r = et(), i = `${n3}`, o3 = {
      startIndex: 0,
      endIndex: i.length - 1,
      rangeId: r,
      rangeType: En.HYPERLINK,
      properties: {
        url: n3
      }
    };
    return {
      dataStream: `${i}\r
`,
      paragraphs: [{
        startIndex: i.length
      }],
      customRanges: [o3]
    };
  }
  let e = n3.replace(/(\r\n|\n)/g, "\r");
  e.endsWith(`\r
`) || (e += `\r
`);
  const t3 = [];
  for (let r = 0; r < e.length; r++)
    e[r] === "\r" && t3.push({ startIndex: r });
  return {
    dataStream: e,
    paragraphs: t3,
    sectionBreaks: [{ startIndex: e.indexOf(`
`) }]
  };
}
var tI = Object.getOwnPropertyDescriptor;
var nI = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? tI(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var nn3 = (n3, e) => (t3, r) => e(t3, r, n3);
var rI2 = [
  Ue2.id,
  ke2.id,
  Me.id,
  Te.id,
  wt2.id,
  Je3.id,
  qe2.id
];
var Pr4 = class extends ER {
  constructor(e, t3, r, i, o3, s2, l4, a4, c2, d2) {
    super();
    _2(this, "_refreshOptionalPaste$", new Subject());
    _2(this, "refreshOptionalPaste$", this._refreshOptionalPaste$.asObservable());
    this._injector = e, this._instanceService = t3, this._renderManagerService = r, this._commandService = i, this._contextService = o3, this._configService = s2, this._sheetClipboardService = l4, this._messageService = a4, this._localService = c2, this._uiPartsService = d2, this._init(), this._initCommandListener(), this._initUIComponents(), this._pasteWithDoc();
  }
  refreshOptionalPaste() {
    this._refreshOptionalPaste$.next(Math.random());
  }
  _pasteWithDoc() {
    var r;
    const e = (i) => {
      i.onPaste$.pipe(takeUntil(this.dispose$)).subscribe((o3) => {
        var d2, u2;
        if (!Ne2(this._contextService))
          return;
        o3.event.preventDefault();
        const s2 = o3.event, l4 = (d2 = s2.clipboardData) == null ? void 0 : d2.getData("text/html"), a4 = (u2 = s2.clipboardData) == null ? void 0 : u2.getData("text/plain"), c2 = this._resolveClipboardFiles(s2.clipboardData);
        this._commandService.executeCommand(Gc2.id, { htmlContent: l4, textContent: a4, files: c2 });
      }), i == null || i.onKeydown$.subscribe((o3) => {
        o3.event.key === "Escape" && this._sheetClipboardService.removeMarkSelection();
      });
    };
    let t3 = (r = this._renderManagerService.getRenderById(Fl)) == null ? void 0 : r.with(Re);
    t3 && e(t3), this._renderManagerService.created$.subscribe((i) => {
      var o3;
      i.unitId === Fl && (t3 = (o3 = this._renderManagerService.getRenderById(Fl)) == null ? void 0 : o3.with(Re), t3 && e(t3));
    });
  }
  _resolveClipboardFiles(e) {
    if (!e)
      return;
    const t3 = Array.from(e.items).map((r) => r.kind === "file" ? r.getAsFile() : void 0).filter(Boolean);
    return t3.length > 0 ? t3 : void 0;
  }
  _init() {
    [dn2, Jd3, un2].forEach(
      (t3) => this.disposeWithMe(this._commandService.registerMultipleCommand(t3))
    ), [
      po3,
      vo3,
      li2,
      So4,
      Gc2,
      Am
    ].forEach((t3) => this.disposeWithMe(this._commandService.registerCommand(t3))), this.disposeWithMe(this._sheetClipboardService.addClipboardHook(this._initCopyingHooks())), this.disposeWithMe(this._sheetClipboardService.addClipboardHook(this._initPastingHook()));
    const e = this._initSpecialPasteHooks().map(
      (t3) => this._sheetClipboardService.addClipboardHook(t3)
    );
    this.disposeWithMe({ dispose: () => e.forEach((t3) => t3.dispose()) });
  }
  // eslint-disable-next-line max-lines-per-function
  _initCopyingHooks() {
    const e = this;
    let t3 = null;
    return {
      id: et4.DEFAULT_COPY,
      isDefaultHook: true,
      onBeforeCopy(r, i) {
        t3 = e._getWorksheet(r, i);
      },
      onCopyCellContent(r, i) {
        var l4, a4, c2, d2;
        const o3 = t3.getCell(r, i);
        return (a4 = (l4 = o3 == null ? void 0 : o3.p) == null ? void 0 : l4.body) != null && a4.paragraphs || (d2 = (c2 = o3 == null ? void 0 : o3.p) == null ? void 0 : c2.body) != null && d2.textRuns ? Vd(o3.p) : o3 ? GE(o3) : "";
      },
      onCopyCellStyle: (r, i, o3, s2) => {
        const l4 = {};
        (o3 || s2) && (l4.rowspan = `${o3 || 1}`, l4.colspan = `${s2 || 1}`);
        const a4 = t3.getMergedCell(r, i), c2 = t3.getComposedCellStyle(r, i);
        let d2 = "";
        if (c2 && (d2 = XR(c2)), a4) {
          const u2 = a4.endRow, h9 = a4.endColumn, g9 = t3.getRange(u2, h9).getTextStyle();
          if (g9) {
            const f4 = XR(g9);
            d2 ? d2 += f4 ? `;${f4}` : "" : d2 = f4;
          }
        }
        return d2 && (l4.style = d2), Object.keys(l4).length ? l4 : null;
      },
      onCopyColumn(r) {
        return {
          width: `${t3.getColumnWidth(r)}`
        };
      },
      onCopyRow(r) {
        return {
          style: `height: ${t3.getRowHeight(r)}px;`
        };
      },
      onAfterCopy() {
        t3 = null;
      },
      getFilteredOutRows(r) {
        var a4;
        const { startRow: i, endRow: o3 } = r, s2 = (a4 = e._instanceService.getCurrentUnitForType(we.UNIVER_SHEET)) == null ? void 0 : a4.getActiveSheet(), l4 = [];
        if (!s2)
          return l4;
        for (let c2 = i; c2 <= o3; c2++)
          s2.getRowFiltered(c2) && l4.push(c2);
        return l4;
      }
    };
  }
  // eslint-disable-next-line max-lines-per-function
  _initPastingHook() {
    const e = this;
    let t3 = null, r = null, i = null;
    return {
      id: et4.DEFAULT_PASTE,
      isDefaultHook: true,
      onBeforePaste({ unitId: o3, subUnitId: s2, range: l4 }) {
        i = e._getWorksheet(o3, s2), t3 = o3, r = s2;
        const a4 = e._configService.getConfig(bd), c2 = l4.rows[l4.rows.length - 1], d2 = l4.cols[l4.cols.length - 1];
        return a4 && c2 * d2 > a4 ? (e._messageService.show({
          type: GC.Error,
          content: e._localService.t("clipboard.paste.exceedMaxCells")
        }), false) : true;
      },
      // eslint-disable-next-line max-lines-per-function
      onPasteRows(o3, s2) {
        const { range: l4 } = o3, a4 = [], c2 = [], d2 = i.getMaxRows(), u2 = d2 - 1, h9 = l4.rows[l4.rows.length - 1] - u2, m9 = s2.length - h9, g9 = i.getRowManager();
        if (h9 > 0) {
          const v6 = {};
          s2.slice(m9).forEach((C, I6) => {
            const { height: R9 } = C || {};
            R9 && (v6[I6] = {
              h: Number.parseFloat(R9),
              hd: ie.FALSE
            });
          });
          const S = {
            startColumn: l4.cols[0],
            endColumn: l4.cols[l4.cols.length - 1],
            endRow: l4.rows[l4.rows.length - 1],
            startRow: d2
          }, w6 = {
            unitId: t3,
            subUnitId: r,
            range: S,
            rowInfo: v6
          };
          a4.push({
            id: ke2.id,
            params: w6
          }), c2.push({
            id: Te.id,
            params: {
              unitId: t3,
              subUnitId: r,
              range: S
            }
          });
        }
        const f4 = {}, p3 = {};
        if (s2.slice(0, m9).forEach((v6, S) => {
          var C, I6;
          const { height: w6 } = v6;
          if (w6) {
            const R9 = g9.getRow(l4.rows[0] + S), y6 = Number.parseFloat(w6);
            if (R9) {
              const { h: E3 = PE, ah: M10 = 0 } = R9, T10 = Math.max(E3, M10);
              y6 > T10 ? (f4[S + l4.rows[0]] = y6, p3[S + l4.rows[0]] = T10) : (f4[S + l4.rows[0]] = T10, p3[S + l4.rows[0]] = T10);
            } else
              f4[S + l4.rows[0]] = y6, p3[S + l4.rows[0]] = (I6 = (C = g9.getRow(l4.rows[0] + S)) == null ? void 0 : C.h) != null ? I6 : PE;
          }
        }), Object.keys(f4).length) {
          const v6 = {
            unitId: t3,
            subUnitId: r,
            ranges: [{
              startRow: l4.rows[0],
              endRow: Math.min(l4.rows[l4.rows.length - 1], d2),
              startColumn: l4.cols[0],
              endColumn: l4.cols[l4.cols.length - 1]
            }],
            rowHeight: f4
          };
          a4.push({
            id: nt2.id,
            params: v6
          }), c2.push({
            id: nt2.id,
            params: __spreadProps(__spreadValues({}, v6), {
              rowHeight: p3
            })
          });
        }
        return {
          redos: a4,
          undos: c2
        };
      },
      // eslint-disable-next-line max-lines-per-function
      onPasteColumns(o3, s2, l4) {
        var w6;
        const { range: a4 } = o3, c2 = [], d2 = [], u2 = i.getMaxColumns(), h9 = u2 - 1, m9 = a4.cols[a4.cols.length - 1] - h9, g9 = s2.length - m9, f4 = (w6 = e._configService.getConfig(J1)) != null ? w6 : kE, p3 = a4.cols, v6 = p3[0];
        if (m9 > 0) {
          const C = {
            startRow: a4.rows[0],
            endRow: a4.rows[a4.rows.length - 1],
            endColumn: a4.cols[a4.cols.length - 1],
            startColumn: u2
          }, I6 = {
            unitId: t3,
            subUnitId: r,
            range: C,
            colInfo: s2.slice(g9).map((R9, y6) => ({
              w: R9.width ? Math.max(+R9.width, i.getColumnWidth(p3[y6])) : f4,
              hd: ie.FALSE
            }))
          };
          c2.push({
            id: Ue2.id,
            params: I6
          }), d2.push({
            id: Me.id,
            params: {
              unitId: t3,
              subUnitId: r,
              range: C
            }
          });
        }
        const S = {
          unitId: t3,
          subUnitId: r,
          ranges: [{
            startRow: a4.rows[0],
            endRow: a4.rows[a4.rows.length - 1],
            startColumn: a4.cols[0],
            endColumn: Math.min(a4.cols[a4.cols.length - 1], u2)
          }]
        };
        if (s2.length > 0) {
          const C = __spreadProps(__spreadValues({}, S), {
            colWidth: s2.slice(0, g9).reduce((R9, y6, E3) => {
              var M10;
              return R9[E3 + v6] = y6.width ? Math.max(+y6.width, (M10 = i.getColumnWidth(p3[E3])) != null ? M10 : f4) : f4, R9;
            }, {})
          }), I6 = __spreadProps(__spreadValues({}, S), {
            colWidth: s2.slice(0, g9).reduce((R9, y6, E3) => {
              var M10;
              return R9[E3 + v6] = (M10 = i.getColumnWidth(p3[E3])) != null ? M10 : f4, R9;
            }, {})
          });
          c2.push({
            id: mt2.id,
            params: C
          }), d2.push({
            id: mt2.id,
            params: I6
          });
        }
        return {
          redos: c2,
          undos: d2
        };
      },
      onPastePlainText(o3, s2, l4) {
        return e._onPastePlainText(o3, s2, l4);
      },
      onPasteCells(o3, s2, l4, a4) {
        return e._onPasteCells(o3, s2, l4, a4);
      },
      onAfterPaste(o3) {
        i = null;
      }
    };
  }
  _generateDocumentDataModelSnapshot(e) {
    var l4, a4;
    const t3 = (l4 = fA(
      we.UNIVER_SHEET,
      he2,
      this._instanceService,
      this._renderManagerService
    )) == null ? void 0 : l4.getCurrentParam();
    if (t3 == null)
      return null;
    const { skeleton: r } = t3, i = (a4 = r.getBlankCellDocumentModel()) == null ? void 0 : a4.documentModel, s2 = __spreadValues(__spreadValues({}, i == null ? void 0 : i.getSnapshot()), e);
    return i == null || i.reset(s2), i == null ? void 0 : i.getSnapshot();
  }
  _onPastePlainText(e, t3, r) {
    const { range: i, unitId: o3, subUnitId: s2 } = e;
    let l4;
    if (/\r|\n/.test(t3) || Z.isLegalUrl(t3)) {
      const c2 = eI2(t3), d2 = this._generateDocumentDataModelSnapshot({ body: c2 });
      l4 = {
        [i.rows[0]]: {
          [i.cols[0]]: {
            p: d2,
            v: null,
            f: null
          }
        }
      };
    } else if (Jg(t3))
      l4 = {
        [i.rows[0]]: {
          [i.cols[0]]: {
            f: t3,
            v: null,
            p: null
          }
        }
      };
    else {
      const c2 = a1.parseNumber(t3);
      c2 != null && c2.z ? l4 = {
        [i.rows[0]]: {
          [i.cols[0]]: {
            v: c2.v,
            s: {
              n: {
                pattern: c2.z
              }
            },
            f: null
          }
        }
      } : l4 = {
        [i.rows[0]]: {
          [i.cols[0]]: {
            v: t3,
            f: null
          }
        }
      };
    }
    const a4 = {
      unitId: o3,
      subUnitId: s2,
      cellValue: l4
    };
    return {
      redos: [
        {
          id: ee2.id,
          params: a4
        }
      ],
      undos: [
        {
          id: ee2.id,
          params: Ae4(this._injector, a4)
        }
      ]
    };
  }
  _onPasteCells(e, t3, r, i) {
    return this._injector.invoke((o3) => KR2(e, t3, r, i, o3));
  }
  // eslint-disable-next-line max-lines-per-function
  _initSpecialPasteHooks() {
    const e = this, t3 = {
      id: et4.SPECIAL_PASTE_VALUE,
      specialPasteInfo: {
        label: "specialPaste.value"
      },
      onPasteCells: (s2, l4, a4) => this._injector.invoke((c2) => xp2(l4, s2, a4, c2))
    }, r = {
      id: et4.SPECIAL_PASTE_FORMAT,
      specialPasteInfo: {
        label: "specialPaste.format"
      },
      onPasteCells: (s2, l4, a4) => {
        const c2 = [], d2 = [], { undos: u2, redos: h9 } = this._injector.invoke((v6) => Ap(l4, a4, v6));
        c2.push(...h9), d2.push(...u2);
        const { undos: m9, redos: g9 } = this._injector.invoke((v6) => nd3(
          l4,
          a4,
          v6
        ));
        c2.push(...g9), d2.push(...m9);
        const { undos: f4, redos: p3 } = this._injector.invoke((v6) => Op(
          l4,
          s2,
          a4,
          v6
        ));
        return c2.push(...p3), d2.push(...f4), {
          undos: d2,
          redos: c2
        };
      }
    }, i = {
      id: et4.SPECIAL_PASTE_COL_WIDTH,
      specialPasteInfo: {
        label: "specialPaste.colWidth"
      },
      onPasteCells() {
        return {
          undos: [],
          redos: []
        };
      },
      onPasteColumns(s2, l4, a4) {
        var E3, M10;
        const c2 = e._instanceService.getCurrentUnitForType(we.UNIVER_SHEET), d2 = c2.getUnitId(), u2 = (E3 = c2.getActiveSheet()) == null ? void 0 : E3.getSheetId();
        if (!d2 || !u2)
          throw new Error("Cannot find unitId or subUnitId");
        const h9 = [], m9 = [], g9 = e._getWorksheet(d2, u2), { range: f4 } = s2, p3 = f4.cols, v6 = p3[0], S = g9.getMaxColumns(), w6 = f4.cols[f4.cols.length - 1] - S, C = l4.length - w6, I6 = (M10 = e._configService.getConfig(J1)) != null ? M10 : kE, R9 = {
          unitId: d2,
          subUnitId: u2,
          ranges: [{
            startRow: f4.rows[0],
            endRow: Math.min(f4.cols[f4.cols.length - 1], S),
            startColumn: f4.cols[0],
            endColumn: f4.cols[f4.cols.length - 1]
          }],
          colWidth: l4.slice(0, C).reduce((T10, P8, A4) => {
            var x7;
            return T10[A4 + v6] = P8.width ? Math.max(+P8.width, (x7 = g9.getColumnWidth(p3[A4])) != null ? x7 : I6) : I6, T10;
          }, {})
        }, y6 = {
          unitId: d2,
          subUnitId: u2,
          ranges: [{
            startRow: f4.rows[0],
            endRow: Math.min(f4.cols[f4.cols.length - 1], S),
            startColumn: f4.cols[0],
            endColumn: f4.cols[f4.cols.length - 1]
          }],
          colWidth: l4.slice(0, C).reduce((T10, P8, A4) => {
            var x7;
            return T10[A4 + v6] = (x7 = g9.getColumnWidth(p3[A4])) != null ? x7 : I6, T10;
          }, {})
        };
        return h9.push({
          id: mt2.id,
          params: R9
        }), m9.push({
          id: mt2.id,
          params: y6
        }), {
          redos: h9,
          undos: m9
        };
      }
    }, o3 = {
      id: et4.SPECIAL_PASTE_BESIDES_BORDER,
      specialPasteInfo: {
        label: "specialPaste.besidesBorder"
      },
      onPasteCells: (s2, l4, a4, c2) => {
        e._instanceService.getCurrentUnitForType(we.UNIVER_SHEET);
        const d2 = [], u2 = [], { range: h9, unitId: m9, subUnitId: g9 } = l4, f4 = new ht();
        a4.forValue((C, I6, R9) => {
          const y6 = R9.s;
          if (typeof y6 == "object") {
            const E3 = Z.deepClone(R9);
            E3.s && (E3.s = __spreadProps(__spreadValues({}, y6), {
              bd: null
            })), f4.setValue(h9.rows[C], h9.cols[I6], E3);
          }
        });
        const p3 = {
          unitId: m9,
          subUnitId: g9,
          cellValue: f4.getData()
        };
        d2.push({
          id: ee2.id,
          params: p3
        });
        const v6 = this._injector.invoke(
          Ae4,
          p3
        );
        u2.push({
          id: ee2.id,
          params: v6
        });
        const { undos: S, redos: w6 } = this._injector.invoke((C) => nd3(l4, a4, C));
        return u2.push(...S), d2.push(...w6), {
          redos: d2,
          undos: u2
        };
      }
    };
    return [t3, r, i, o3];
  }
  _getWorksheet(e, t3) {
    var i;
    const r = (i = this._instanceService.getUniverSheetInstance(e)) == null ? void 0 : i.getSheetBySheetId(t3);
    if (!r)
      throw new Error(
        `[SheetClipboardController]: cannot find a worksheet with unitId ${e} and subUnitId ${t3}.`
      );
    return r;
  }
  _initCommandListener() {
    var t3;
    this.disposeWithMe(
      this._commandService.onCommandExecuted((r) => {
        r.id === sr4.id ? this._sheetClipboardService.removeMarkSelection() : rI2.includes(r.id) && this._sheetClipboardService.removeMarkSelection();
      })
    );
    const e = this._configService.getConfig(Tt2);
    (t3 = e == null ? void 0 : e.clipboardConfig) != null && t3.hidePasteOptions || (this.disposeWithMe(
      this._commandService.onCommandExecuted((r) => {
        QR2.includes(r.id) && this._sheetClipboardService.disposePasteOptionsCache();
      })
    ), this.disposeWithMe(
      this._commandService.onCommandExecuted((r) => {
        if (r.id === or4.id) {
          if (!this._sheetClipboardService.getPasteMenuVisible())
            return;
          const o3 = r.params.unitId, s2 = this._sheetClipboardService.getPasteOptionsCache(), l4 = s2 == null ? void 0 : s2.target.unitId;
          o3 === l4 && this._refreshOptionalPaste$.next(Math.random());
        }
      })
    ));
  }
  _initUIComponents() {
    var t3;
    const e = this._configService.getConfig(Tt2);
    (t3 = e == null ? void 0 : e.clipboardConfig) != null && t3.hidePasteOptions || this.disposeWithMe(
      this._uiPartsService.registerComponent(u12.CONTENT, () => connectInjector(qR, this._injector))
    );
  }
};
Pr4 = nI([
  nn3(0, Inject(Injector)),
  nn3(1, br),
  nn3(2, JE),
  nn3(3, Ds),
  nn3(4, Tr),
  nn3(5, xs),
  nn3(6, tn3),
  nn3(7, et2),
  nn3(8, Inject(Hn)),
  nn3(9, N1)
], Pr4);
var iI2 = Object.getOwnPropertyDescriptor;
var oI = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? iI2(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var no3 = (n3, e) => (t3, r) => e(t3, r, n3);
var Ai2 = class extends Ve {
  constructor(n3, e, t3, r, i) {
    super(), this._selectionManagerService = n3, this._themeService = e, this._instanceSrv = t3, this._cmdSrv = r, this._definedNamesService = i, this._init();
  }
  _init() {
    this.disposeWithMe(merge(
      this._selectionManagerService.selectionMoveStart$,
      this._selectionManagerService.selectionMoving$,
      this._selectionManagerService.selectionMoveEnd$,
      this._selectionManagerService.selectionSet$
    ).pipe(filter((n3) => !!n3)).subscribe((n3) => {
      this._syncDefinedNameRange(n3);
    })), this.disposeWithMe(this._definedNamesService.focusRange$.subscribe((n3) => __async(this, null, function* () {
      if (n3 == null) return;
      const { unitId: e } = n3;
      let { formulaOrRefString: t3 } = n3;
      if (t3.substring(0, 1) === Z6.EQUALS && (t3 = t3.substring(1)), !xl(t3))
        return;
      const i = this._instanceSrv.getUnit(e), o3 = yield this._getSelections(i, e, t3);
      this._selectionManagerService.setSelections(o3), this._cmdSrv.executeCommand(yd.id, {
        unitId: e,
        range: o3[0].range
      });
    })));
  }
  _syncDefinedNameRange(n3) {
    if (n3.length === 0)
      return;
    const e = n3[n3.length - 1], t3 = this._instanceSrv.getCurrentUnitForType(we.UNIVER_SHEET), r = t3 == null ? void 0 : t3.getActiveSheet();
    r && this._definedNamesService.setCurrentRange({
      range: e.range,
      unitId: t3.getUnitId(),
      sheetId: r.getSheetId()
    });
  }
  _getSelections(n3, e, t3) {
    return __async(this, null, function* () {
      const r = t3.split(",");
      let i = n3.getActiveSheet();
      if (!i)
        return [];
      const o3 = [];
      for (let s2 = 0; s2 < r.length; s2++) {
        const l4 = r[s2].trim(), a4 = kr(l4.trim());
        if (s2 === 0) {
          const d2 = n3.getSheetBySheetName(a4.sheetName);
          d2 && i.getSheetId() !== d2.getSheetId() && (i = d2, yield this._cmdSrv.executeCommand(ui.id, {
            subUnitId: i.getSheetId(),
            unitId: e
          }));
        }
        if (i.getName() !== a4.sheetName)
          continue;
        let c2 = null;
        if (s2 === r.length - 1) {
          const d2 = a4.range, { startRow: u2, startColumn: h9, endRow: m9, endColumn: g9 } = d2;
          c2 = _e3({
            startRow: u2,
            startColumn: h9,
            endRow: m9,
            endColumn: g9
          }, i);
        }
        o3.push({
          range: a4.range,
          style: Sr4(this._themeService),
          primary: c2
        });
      }
      return o3;
    });
  }
};
Ai2 = oI([
  no3(0, Inject(z)),
  no3(1, Inject(Ji)),
  no3(2, br),
  no3(3, Ds),
  no3(4, Lr)
], Ai2);
var sI2 = Object.getOwnPropertyDescriptor;
var lI2 = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? sI2(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var Un5 = (n3, e) => (t3, r) => e(t3, r, n3);
var aI2 = {
  pageSize: {
    width: Number.POSITIVE_INFINITY,
    height: Number.POSITIVE_INFINITY
  },
  documentFlavor: fu.UNSPECIFIED,
  marginTop: 5,
  marginBottom: 5,
  marginRight: 0,
  marginLeft: 0,
  paragraphLineGapDefault: 0,
  renderConfig: {
    horizontalAlign: Pt.UNSPECIFIED,
    verticalAlign: Dn.TOP,
    centerAngle: 0,
    vertexAngle: 0,
    wrapStrategy: jn.WRAP,
    isRenderStyle: ie.FALSE
  }
};
var Hi3 = class extends Ve {
  constructor(n3, e, t3, r, i, o3, s2, l4) {
    super(), this._univerInstanceService = n3, this._renderManagerService = e, this._editorBridgeService = t3, this._commandService = r, this._rangeProtectionRuleModel = i, this._worksheetProtectionRuleModel = o3, this._formulaEditorController = s2, this._formulaEditorManagerService = l4, this._initialize();
  }
  _initialize() {
    this._syncFormulaEditorContent(), this._commandExecutedListener();
  }
  _getEditorViewModel(n3) {
    var e;
    return (e = this._renderManagerService.getRenderById(n3)) == null ? void 0 : e.with(D).getViewModel();
  }
  // Sync cell content to formula editor bar when sheet selection changed.
  _syncFormulaEditorContent() {
    this.disposeWithMe(this._editorBridgeService.currentEditCellState$.subscribe((n3) => {
      n3 == null || this._editorBridgeService.isForceKeepVisible() || !this._rangeProtectionRuleModel.getRangeRuleInitState() || !this._worksheetProtectionRuleModel.getSheetRuleInitState() || this._editorSyncHandler(n3);
    }));
  }
  // Sync cell content to formula editor bar when sheet selection changed or visible changed.
  _editorSyncHandler(n3) {
    var i, o3, s2;
    let e = Z.deepClone((i = n3.documentLayoutObject.documentModel) == null ? void 0 : i.getBody());
    const t3 = Z.deepClone((o3 = n3.documentLayoutObject.documentModel) == null ? void 0 : o3.drawings), r = Z.deepClone((s2 = n3.documentLayoutObject.documentModel) == null ? void 0 : s2.getDrawingsOrder());
    (!e || n3.isInArrayFormulaRange === true && this._editorBridgeService.isVisible().eventType === hb.Dblclick) && (e = {
      dataStream: `\r
`,
      paragraphs: [
        {
          startIndex: 0
        }
      ],
      textRuns: []
    }), this._syncContentAndRender(Hl, e, t3, r);
  }
  _commandExecutedListener() {
    const n3 = [Fl, Hl];
    this.disposeWithMe(
      this._commandService.onCommandExecuted((t3) => {
        if (t3.id === M.id) {
          const r = t3.params, { unitId: i, trigger: o3, isSync: s2 } = r;
          if (s2 || o3 === _a.id)
            return;
          if (n3.includes(i)) {
            const l4 = this._univerInstanceService.getUnit(i, we.UNIVER_DOC), a4 = i === Hl ? Fl : Hl;
            this._checkAndSetRenderStyleConfig(l4), this._syncActionsAndRender(a4, r);
          }
        }
      })
    );
    const e = [ee2.id, wt2.id];
    this.disposeWithMe(
      this._commandService.onCommandExecuted((t3) => {
        var r, i, o3, s2, l4, a4, c2;
        if (e.includes(t3.id)) {
          const d2 = this._editorBridgeService.getLatestEditCellState();
          if (d2 == null)
            return;
          let u2 = false;
          const { row: h9, column: m9 } = d2;
          if (t3.id === ee2.id && t3.params ? (i = (r = t3.params.cellValue) == null ? void 0 : r[h9]) != null && i[m9] && (u2 = true) : t3.id === wt2.id && t3.params && (s2 = (o3 = t3.params.to.value) == null ? void 0 : o3[h9]) != null && s2[m9] && (u2 = true), u2) {
            const g9 = Z.deepClone((l4 = d2.documentLayoutObject.documentModel) == null ? void 0 : l4.getBody()), f4 = Z.deepClone((a4 = d2.documentLayoutObject.documentModel) == null ? void 0 : a4.drawings), p3 = Z.deepClone((c2 = d2.documentLayoutObject.documentModel) == null ? void 0 : c2.getDrawingsOrder());
            if (g9 == null)
              return;
            this._syncContentAndRender(Hl, g9, f4, p3);
          }
        }
      })
    );
  }
  // Sync actions between cell editor and formula editor, and make `dataStream` and `paragraph` is the same.
  _syncActionsAndRender(n3, e) {
    var l4;
    const t3 = [Fl, Hl], r = this._renderManagerService.getRenderById(n3);
    if (r == null)
      return;
    const i = r.with(D).getSkeleton(), o3 = this._univerInstanceService.getUnit(n3, we.UNIVER_DOC), s2 = this._getEditorViewModel(n3);
    o3 == null || s2 == null || (this._commandService.syncExecuteCommand(M.id, __spreadProps(__spreadValues({}, e), {
      textRanges: null,
      isSync: true,
      unitId: n3,
      syncer: e.unitId
    })), s2.reset(o3), i.calculate(), t3.includes(n3) && ((l4 = r.mainComponent) == null || l4.makeDirty()));
  }
  _syncContentAndRender(n3, e, t3, r) {
    var c2, d2;
    n3 === Hl && e.paragraphs && (e.paragraphs = this._clearParagraph(e.paragraphs));
    const i = [Fl, Hl], o3 = (c2 = this._renderManagerService.getRenderById(n3)) == null ? void 0 : c2.with(D).getSkeleton(), s2 = this._univerInstanceService.getUnit(n3, we.UNIVER_DOC), l4 = this._getEditorViewModel(n3);
    if (s2 == null || l4 == null || o3 == null)
      return;
    s2.getSnapshot().body = e, s2.getSnapshot().drawings = t3 != null ? t3 : {}, s2.getSnapshot().drawingsOrder = r != null ? r : [], this._checkAndSetRenderStyleConfig(s2), l4.reset(s2);
    const a4 = this._renderManagerService.getRenderById(n3);
    a4 != null && (o3.calculate(), i.includes(n3) && ((d2 = a4.mainComponent) == null || d2.makeDirty()), n3 === Hl && this._formulaEditorController.autoScroll());
  }
  _checkAndSetRenderStyleConfig(n3) {
    var o3;
    const e = n3.getSnapshot(), { body: t3 } = e;
    if (e.id !== Hl)
      return;
    e.documentStyle = aI2;
    let r = e.documentStyle.renderConfig;
    r == null && (r = {}, e.documentStyle.renderConfig = r);
    const i = this._formulaEditorManagerService.getPosition();
    if (i) {
      const s2 = i.width;
      e.documentStyle.pageSize = {
        width: s2,
        height: 1 / 0
      };
    }
    ((o3 = t3 == null ? void 0 : t3.dataStream) != null ? o3 : "").startsWith("=") ? r.isRenderStyle = ie.TRUE : r.isRenderStyle = ie.FALSE;
  }
  _clearParagraph(n3) {
    const e = Z.deepClone(n3);
    for (const t3 of e)
      t3.paragraphStyle && (t3.paragraphStyle.horizontalAlign = Pt.UNSPECIFIED);
    return e;
  }
};
Hi3 = lI2([
  Un5(0, br),
  Un5(1, JE),
  Un5(2, Qe3),
  Un5(3, Ds),
  Un5(4, Inject(me)),
  Un5(5, Inject(lt3)),
  Un5(6, Inject(yr4)),
  Un5(7, us2)
], Hi3);
var cI = Object.getOwnPropertyDescriptor;
var dI = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? cI(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var ro4 = (n3, e) => (t3, r) => e(t3, r, n3);
var Sc2 = "SHEET_FORCE_STRING_ALERT";
var bl2 = class extends Ve {
  constructor(n3, e, t3, r, i, o3) {
    super(), this._context = n3, this._hoverManagerService = e, this._cellAlertManagerService = t3, this._localeService = r, this._zenZoneService = i, this._configService = o3, this._init();
  }
  _init() {
    this._initCellAlertPopup(), this._initZenService();
  }
  _initCellAlertPopup() {
    this.disposeWithMe(this._hoverManagerService.currentCell$.subscribe((n3) => {
      var e, t3;
      if (n3) {
        const r = n3.location, i = this._context.unit, o3 = i.getActiveSheet();
        if (!o3) return this._hideAlert();
        const s2 = o3.getCell(r.row, r.col);
        if (!s2 || s2.v === null || s2.v === void 0) return this._hideAlert();
        let l4;
        if (s2 != null && s2.s) {
          const a4 = i.getStyles().get(s2.s);
          a4 != null && a4.n && (l4 = a4.n);
        }
        if (l1(l4 == null ? void 0 : l4.pattern)) {
          this._hideAlert();
          return;
        }
        if ((s2.t === mn.FORCE_STRING || s2.t === mn.STRING) && (s1(s2.v) || typeof s2.v == "string" && a1.parseNumber(s2.v))) {
          if ((e = this._configService.getConfig(Tt2)) != null && e.disableForceStringAlert)
            return;
          const a4 = this._cellAlertManagerService.currentAlert.get(Sc2), c2 = (t3 = a4 == null ? void 0 : a4.alert) == null ? void 0 : t3.location;
          if (c2 && c2.row === n3.location.row && c2.col === n3.location.col && c2.subUnitId === n3.location.subUnitId && c2.unitId === n3.location.unitId) {
            this._hideAlert();
            return;
          }
          this._cellAlertManagerService.showAlert({
            type: Co2.ERROR,
            title: this._localeService.t("info.error"),
            message: this._localeService.t("info.forceStringInfo"),
            location: r,
            width: 200,
            height: 74,
            key: Sc2
          });
          return;
        }
      }
      this._hideAlert();
    }));
  }
  _initZenService() {
    this.disposeWithMe(this._zenZoneService.visible$.subscribe((n3) => {
      n3 && this._hideAlert();
    }));
  }
  _hideAlert() {
    this._cellAlertManagerService.removeAlert(Sc2);
  }
};
bl2 = dI([
  ro4(1, Inject(Mr3)),
  ro4(2, Inject(Fo3)),
  ro4(3, Inject(Hn)),
  ro4(4, lt),
  ro4(5, xs)
], bl2);
var uI = Object.getOwnPropertyDescriptor;
var hI2 = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? uI(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var Cc2 = (n3, e) => (t3, r) => e(t3, r, n3);
var _l2 = class extends ER {
  constructor(n3, e, t3, r) {
    super(), this._context = n3, this._sheetSkeletonManagerService = e, this._sheetInterceptorService = t3, this._configService = r, this._initViewModelIntercept();
  }
  _initViewModelIntercept() {
    const n3 = {
      tl: {
        size: 6,
        color: "#409f11"
      }
    };
    this.disposeWithMe(
      this._sheetInterceptorService.intercept(
        ht2.CELL_CONTENT,
        {
          priority: 10,
          effect: ir.Style,
          handler: (e, t3, r) => {
            var s2, l4, a4;
            if (!((s2 = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : s2.skeleton))
              return r(e);
            const o3 = t3.rawData;
            if (!o3 || o3.v === null || o3.v === void 0)
              return r(e);
            if (((e == null ? void 0 : e.t) === mn.FORCE_STRING || (e == null ? void 0 : e.t) === mn.STRING) && (s1(o3.v) || typeof o3.v == "string" && a1.parseNumber(o3.v))) {
              const c2 = t3.workbook.getStyles().get(o3.s);
              return l1((l4 = c2 == null ? void 0 : c2.n) == null ? void 0 : l4.pattern) || (a4 = this._configService.getConfig(Tt2)) != null && a4.disableForceStringMark || (e === o3 && (e = __spreadValues({}, o3)), e.markers = __spreadValues(__spreadValues({}, e == null ? void 0 : e.markers), n3)), r(e);
            }
            return r(e);
          }
        }
      )
    );
  }
};
_l2 = hI2([
  Cc2(1, Inject(he2)),
  Cc2(2, Inject(G)),
  Cc2(3, xs)
], _l2);
var gI = Object.getOwnPropertyDescriptor;
var mI = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? gI(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var hr4 = (n3, e) => (t3, r) => e(t3, r, n3);
var Vi3 = class extends Ve {
  constructor(n3, e, t3, r, i, o3, s2) {
    super(), this._commandService = n3, this._formatPainterService = e, this._univerInstanceService = t3, this._renderManagerService = r, this._selectionManagerService = i, this._sheetInterceptorService = o3, this._injector = s2, this._initialize();
  }
  _initialize() {
    this._addDefaultHook();
  }
  _addDefaultHook() {
    const n3 = {
      id: "default-format-painter",
      priority: 0,
      isDefaultHook: true,
      onStatusChange: (e) => {
        if (e !== zt2.OFF) {
          const t3 = this._collectSelectionRangeFormat();
          t3 && this._formatPainterService.setSelectionFormat(t3);
        }
      },
      onApply: (e, t3, r, i) => this._getUndoRedoMutationInfo(e, t3, r, i)
    };
    this._formatPainterService.addHook(n3);
  }
  _collectSelectionRangeFormat() {
    const n3 = this._selectionManagerService.getCurrentLastSelection(), e = n3 == null ? void 0 : n3.range;
    if (!e) return null;
    const { startRow: t3, endRow: r, startColumn: i, endColumn: o3 } = e, s2 = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET), l4 = s2 == null ? void 0 : s2.getActiveSheet();
    if (!l4) return null;
    const a4 = l4.getCellMatrix(), c2 = s2.getStyles(), d2 = new ht(), u2 = [];
    for (let h9 = t3; h9 <= r; h9++)
      for (let m9 = i; m9 <= o3; m9++) {
        const g9 = a4.getValue(h9, m9);
        d2.setValue(h9, m9, c2.getStyleByCell(g9) || {});
        const _a5 = l4.getCellInfoInMergeData(h9, m9), { isMergedMainCell: f4 } = _a5, p3 = __objRest(_a5, ["isMergedMainCell"]);
        f4 && u2.push({
          startRow: p3.startRow,
          startColumn: p3.startColumn,
          endRow: p3.endRow,
          endColumn: p3.endColumn
        });
      }
    return {
      styles: d2,
      merges: u2
    };
  }
  // eslint-disable-next-line max-lines-per-function
  _getUndoRedoMutationInfo(n3, e, t3, r) {
    const i = this._sheetInterceptorService, o3 = this._univerInstanceService, { merges: s2, styles: l4 } = r;
    if (!l4) return { undos: [], redos: [] };
    const { startRow: a4, startColumn: c2, endRow: d2, endColumn: u2 } = l4.getDataRange(), h9 = d2 - a4 + 1, m9 = u2 - c2 + 1, g9 = t3.startRow === t3.endRow && t3.startColumn === t3.endColumn ? {
      startRow: t3.startRow,
      startColumn: t3.startColumn,
      endRow: t3.startRow + h9 - 1,
      endColumn: t3.startColumn + m9 - 1
    } : t3, f4 = Array.from({ length: g9.endRow - g9.startRow + 1 }, () => Array.from({ length: g9.endColumn - g9.startColumn + 1 }, () => ({}))), p3 = [];
    f4.forEach((x7, H6) => {
      x7.forEach((V7, D5) => {
        const B5 = H6 % h9 + a4, F7 = D5 % m9 + c2, z5 = l4.getValue(B5, F7);
        z5 && (f4[H6][D5].s = Object.keys(z5).length > 0 ? z5 : null);
      });
    });
    let v6 = 0, S = 0;
    s2.forEach((x7) => {
      x7.startRow === a4 && x7.startColumn === c2 && (v6 = x7.endRow - x7.startRow, S = x7.endColumn - x7.startColumn);
      const H6 = {
        startRow: x7.startRow - a4,
        startColumn: x7.startColumn - c2,
        endRow: x7.endRow - a4,
        endColumn: x7.endColumn - c2
      }, V7 = Math.max(1, Math.floor((g9.endRow - g9.startRow + 1) / h9)), D5 = Math.max(1, Math.floor((g9.endColumn - g9.startColumn + 1) / m9));
      for (let B5 = 0; B5 < V7; B5++)
        for (let F7 = 0; F7 < D5; F7++)
          p3.push({
            startRow: H6.startRow + B5 * h9 + g9.startRow,
            startColumn: H6.startColumn + F7 * m9 + g9.startColumn,
            endRow: H6.endRow + B5 * h9 + g9.startRow,
            endColumn: H6.endColumn + F7 * m9 + g9.startColumn
          });
    });
    const w6 = [g9], C = new ht(), I6 = new ht();
    if (Z.isArray(f4))
      for (let x7 = 0; x7 < w6.length; x7++) {
        const { startRow: H6, startColumn: V7, endRow: D5, endColumn: B5 } = w6[x7];
        for (let F7 = 0; F7 <= D5 - H6; F7++)
          for (let z5 = 0; z5 <= B5 - V7; z5++)
            C.setValue(F7 + H6, z5 + V7, { s: null }), I6.setValue(F7 + H6, z5 + V7, f4[F7][z5]);
      }
    const R9 = {
      subUnitId: e,
      unitId: n3,
      cellValue: C.getMatrix()
    }, y6 = {
      subUnitId: e,
      unitId: n3,
      cellValue: I6.getMatrix()
    }, E3 = this._injector.invoke(
      Ae4,
      R9
    ), { undos: M10, redos: T10 } = i.onCommandExecute({
      id: Sn2.id,
      params: __spreadProps(__spreadValues({}, y6), { range: w6 })
    }), P8 = [], A4 = [];
    if (p3.length > 0) {
      const x7 = Jr3(p3), H6 = o3.getUnit(n3).getSheetBySheetId(e), V7 = Ym(H6, x7), D5 = {
        unitId: n3,
        subUnitId: e,
        ranges: x7
      }, B5 = {
        unitId: n3,
        subUnitId: e,
        ranges: x7
      };
      P8.push({ id: se2.id, params: D5 }), P8.push({ id: ne.id, params: B5 });
      const F7 = this._injector.invoke(
        ye3,
        D5
      ), z5 = this._injector.invoke(
        We3,
        B5
      );
      if (A4.push({ id: se2.id, params: z5 }), A4.push({ id: ne.id, params: F7 }), V7) {
        const Z9 = this._injector.invoke((de3) => Zm2(de3, n3, H6, x7));
        P8.unshift(...Z9.redos), A4.push(...Z9.undos);
      }
    }
    if (!Cn.equals(g9, t3)) {
      const x7 = {
        actualRow: g9.startRow,
        actualColumn: g9.startColumn,
        rangeType: ge.NORMAL,
        isMerged: v6 > 0 || S > 0,
        isMergedMainCell: false,
        startRow: g9.startRow,
        startColumn: g9.startColumn,
        endRow: g9.startRow + v6,
        endColumn: g9.startColumn + S
      };
      P8.push({
        id: ie5.id,
        params: {
          unitId: n3,
          subUnitId: e,
          type: we3.ONLY_SET,
          selections: [{ range: g9, primary: x7, style: null }]
        }
      }), A4.unshift({
        id: ie5.id,
        params: {
          unitId: n3,
          subUnitId: e,
          type: we3.ONLY_SET,
          selections: [{ range: t3, primary: x7, style: null }]
        }
      });
    }
    return {
      undos: [
        { id: ee2.id, params: R9 },
        { id: ee2.id, params: E3 },
        ...M10,
        ...A4
      ],
      redos: [
        { id: ee2.id, params: R9 },
        { id: ee2.id, params: y6 },
        ...T10,
        ...P8
      ]
    };
  }
};
Vi3 = mI([
  hr4(0, Ds),
  hr4(1, Nn),
  hr4(2, br),
  hr4(3, JE),
  hr4(4, Inject(z)),
  hr4(5, Inject(G)),
  hr4(6, Inject(Injector))
], Vi3);
var fI = Object.getOwnPropertyDescriptor;
var pI = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? fI(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var wc2 = (n3, e) => (t3, r) => e(t3, r, n3);
var Rl2 = class extends Ve {
  constructor(n3, e, t3, r) {
    super(), this._context = n3, this._markSelectionService = e, this._commandService = t3, this._sheetSkeletonManagerService = r, this._initListeners();
  }
  _initListeners() {
    this._addRemoveListener(), this._addRefreshListener();
  }
  _addRemoveListener() {
    const n3 = [tt5.id];
    this.disposeWithMe(
      this._commandService.onCommandExecuted((e) => {
        n3.includes(e.id) ? this._markSelectionService.removeAllShapes() : this._markSelectionService.getShapeMap().forEach((r, i) => {
          r.exits.includes(e.id) && this._markSelectionService.removeShape(i);
        });
      })
    );
  }
  _addRefreshListener() {
    this.disposeWithMe(this._sheetSkeletonManagerService.currentSkeleton$.subscribe((n3) => {
      n3 && this._markSelectionService.refreshShapes();
    }));
  }
};
Rl2 = pI([
  wc2(1, Inject(Xi3)),
  wc2(2, Ds),
  wc2(3, Inject(he2))
], Rl2);
function vI() {
  const n3 = Wr4();
  return n3 ? (0, import_jsx_runtime.jsx)(SI, { workbook: n3 }) : null;
}
function SI(n3) {
  const { workbook: e } = n3, [t3, r] = (0, import_react.useState)([]), [i, o3] = (0, import_react.useState)(""), s2 = (0, import_react.useRef)(/* @__PURE__ */ new Map()), l4 = useDependency(Ds), a4 = (0, import_react.useCallback)(() => {
    const d2 = e.getActiveSheet().getSheetId(), u2 = e.getSheets(), h9 = e.getActiveSheet(), m9 = u2.filter((g9) => !g9.isSheetHidden()).map((g9, f4) => {
      var p3;
      return {
        sheetId: g9.getSheetId(),
        label: g9.getName(),
        index: f4,
        selected: h9 === g9,
        color: (p3 = g9.getTabColor()) != null ? p3 : void 0
      };
    });
    if (r(m9), o3(d2), s2.current.has(d2)) {
      const g9 = s2.current.get(d2);
      g9 && g9.scrollIntoView({ behavior: "smooth", block: "nearest" });
    }
    s2.current.clear();
  }, [e]);
  (0, import_react.useEffect)(() => a4(), [a4]);
  const c2 = (0, import_react.useCallback)((d2) => {
    l4.executeCommand(pn.id, {
      unitId: e.getUnitId(),
      subUnitId: d2
    });
  }, [l4, e]);
  return (0, import_react.useEffect)(() => {
    const d2 = l4.onCommandExecuted((u2) => {
      switch (u2.id) {
        case St2.id:
        case Lt2.id:
        case jn3.id:
        case ln.id:
        case Tn2.id:
        case pn.id:
          a4();
          break;
      }
    });
    return () => d2.dispose();
  }, [l4, a4]), (0, import_jsx_runtime.jsx)(
    "div",
    {
      className: "univer-h-8 univer-w-full univer-overflow-x-scroll univer-bg-gray-100 dark:!univer-bg-gray-900",
      children: (0, import_jsx_runtime.jsx)("div", { className: "univer-flex univer-h-8 univer-flex-nowrap univer-items-center", children: t3.map((d2) => (0, import_jsx_runtime.jsx)(
        "div",
        {
          ref: (u2) => {
            s2.current.set(d2.sheetId, u2);
          },
          className: ie2(
            `
                              univer-box-border univer-h-full univer-min-w-12 univer-max-w-[120px] univer-shrink-0
                              univer-flex-nowrap univer-items-center univer-truncate univer-px-1 univer-py-0.5
                              univer-text-center univer-text-xs univer-leading-7
                            `,
            vE,
            {
              "univer-bg-white univer-text-primary-600 dark:!univer-bg-slate-600": d2.sheetId === i
            }
          ),
          onClick: () => c2(d2.sheetId),
          children: d2.label
        },
        d2.sheetId
      )) })
    }
  );
}
var CI = {
  [W1.MAIN_AREA]: {
    [c13.FORMAT]: {
      [dn2.name]: {
        order: 0,
        menuItemFactory: gi3
      }
    },
    [c13.DATA]: {
      order: 2
    },
    [c13.OTHERS]: {
      order: 3
    }
  },
  [W1.COL_HEADER]: {
    [c13.FORMAT]: {
      [dn2.name]: {
        order: 0,
        menuItemFactory: gi3
      }
    },
    [c13.LAYOUT]: {
      order: 1
    },
    [c13.DATA]: {
      order: 2
    },
    [c13.OTHERS]: {
      order: 3
    }
  },
  [W1.ROW_HEADER]: {
    [c13.FORMAT]: {
      [dn2.name]: {
        order: 0,
        menuItemFactory: gi3
      }
    },
    [c13.LAYOUT]: {
      order: 1
    },
    [c13.DATA]: {
      order: 2
    },
    [c13.OTHERS]: {
      order: 3
    }
  }
};
var wI = Object.getOwnPropertyDescriptor;
var bI = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? wI(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var Xn4 = (n3, e) => (t3, r) => e(t3, r, n3);
var Il2 = class extends Ve {
  constructor(n3, e, t3, r, i, o3, s2, l4) {
    super(), this._injector = n3, this._componentManager = e, this._layoutService = t3, this._commandService = r, this._shortcutService = i, this._menuManagerService = o3, this._uiPartsService = s2, this._configService = l4, this._init();
  }
  _init() {
    this._initComponents(), this._initCommands(), this._initMenus(), this._initShortcuts(), this._initWorkbenchParts(), this._initFocusHandler();
  }
  _initComponents() {
    const n3 = this._componentManager;
    this.disposeWithMe(n3.register(pn2, Nf)), this.disposeWithMe(n3.register(pu2, Xf2)), this.disposeWithMe(n3.register(Vo3, jf2)), this.disposeWithMe(n3.register(wu2, zf2)), this.disposeWithMe(n3.register("HideGridlinesDoubleIcon", mu2));
  }
  _initCommands() {
    [
      vu2,
      sr4,
      Cu2,
      Su2,
      as2,
      Gt3,
      Ut3,
      Dn3,
      Oa3,
      ba4,
      xo,
      Oo3,
      ga3,
      ma4,
      hn2,
      Xm,
      Ma2,
      su2,
      tg,
      Ii2,
      tt5,
      xa3,
      zi2,
      ji3,
      Yi2,
      Zi2,
      km2,
      Dm,
      fa2,
      Eo2,
      To2,
      ru3,
      ng,
      og,
      ig2,
      ag,
      _a4,
      iu2,
      ss2,
      Ra3,
      or4,
      Ao3,
      Jn4,
      Ia2,
      ya2,
      lu2,
      sg,
      cs3,
      Ln2,
      Ea4,
      wa3,
      bi4,
      wi3,
      os2,
      is2,
      au2,
      gr5,
      yo2,
      // permission
      On3,
      jm,
      va3,
      ai2,
      ci2,
      Sa4,
      Ca4,
      Pa4,
      di2,
      ui2,
      Ta4,
      ls2,
      ca3,
      da
    ].forEach((n3) => {
      this.disposeWithMe(this._commandService.registerCommand(n3));
    });
  }
  _initMenus() {
    this._menuManagerService.mergeMenu(CI);
  }
  _initShortcuts() {
    [
      // selection shortcuts
      Gf2,
      qf2,
      Qf,
      Kf2,
      Jf,
      $f,
      ep,
      tp,
      // MoveBackSelectionShortcutItem,
      np,
      rp2,
      ip,
      op,
      sp,
      lp,
      ap,
      cp,
      dp,
      up,
      hp,
      gp,
      mp,
      // view shortcuts
      Rp,
      yp,
      Ep,
      Tp,
      Ip,
      Mp2,
      // toggle cell style shortcuts
      fp,
      pp,
      vp,
      Sp,
      // cell content editing shortcuts
      Cp,
      wp,
      bp,
      _p,
      ...Sf(),
      wf,
      Cf,
      bf,
      If,
      yf2,
      Mf,
      Tf2,
      _f,
      Rf,
      Ef,
      // operation shortcuts
      Yf2,
      Zf2
    ].forEach((n3) => {
      this.disposeWithMe(this._shortcutService.registerShortcut(n3));
    });
  }
  _initWorkbenchParts() {
    const n3 = this._uiPartsService, e = this._injector;
    this.disposeWithMe(n3.registerComponent(u12.HEADER, () => connectInjector(vI, e))), this.disposeWithMe(n3.registerComponent(u12.CONTENT, () => connectInjector(ff, e)));
  }
  _initFocusHandler() {
    this.disposeWithMe(
      this._layoutService.registerFocusHandler(we.UNIVER_SHEET, (n3) => {
        const e = this._injector.get(JE), t3 = this._injector.get(br), r = eF(we.UNIVER_DOC, t3, e), i = r == null ? void 0 : r.with(Re);
        i == null || i.focus();
      })
    );
  }
};
Il2 = bI([
  Xn4(0, Inject(Injector)),
  Xn4(1, Inject(S13)),
  Xn4(2, j1),
  Xn4(3, Ds),
  Xn4(4, Le),
  Xn4(5, Z1),
  Xn4(6, N1),
  Xn4(7, xs)
], Il2);
var _I = Object.getOwnPropertyDescriptor;
var RI = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? _I(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var bc2 = (n3, e) => (t3, r) => e(t3, r, n3);
var yl4 = class extends Ve {
  constructor(e, t3, r, i) {
    super();
    _2(this, "_disposableCollection", new ho());
    _2(this, "_initialize", () => {
      const e4 = this._disposableCollection;
      this.disposeWithMe(
        this._selectionManagerService.selectionMoveEnd$.subscribe(() => {
          e4.dispose(), this._selectionRenderService.getSelectionControls().forEach((r2) => {
            e4.add(
              Be(
                r2.selectionMoveEnd$.subscribe((i2) => {
                  if (!i2)
                    return;
                  const o3 = r2.model.getRange(), s2 = {
                    startRow: o3.startRow,
                    startColumn: o3.startColumn,
                    endRow: o3.endRow,
                    endColumn: o3.endColumn,
                    rangeType: o3.rangeType
                  }, l4 = {
                    startRow: i2.startRow,
                    startColumn: i2.startColumn,
                    endRow: i2.endRow,
                    endColumn: i2.endColumn,
                    // rangeType must equal to fromRange
                    rangeType: o3.rangeType
                  };
                  if (s2.startRow === l4.startRow && s2.startColumn === l4.startColumn || l4.startRow < 0 || l4.startColumn < 0)
                    return;
                  const a4 = {
                    fromRange: s2,
                    toRange: l4
                  };
                  this._commandService.executeCommand(yt2.id, a4);
                })
              )
            );
          });
        })
      );
    });
    this._context = e, this._selectionRenderService = t3, this._selectionManagerService = r, this._commandService = i, this._initialize();
  }
  dispose() {
    var e;
    super.dispose(), (e = this._disposableCollection) == null || e.dispose();
  }
};
yl4 = RI([
  bc2(1, Inject(gt)),
  bc2(2, Inject(z)),
  bc2(3, Inject(Ds))
], yl4);
var II = Object.getOwnPropertyDescriptor;
var yI = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? II(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var MI = (n3, e) => (t3, r) => e(t3, r, n3);
var Ni2 = class extends Ve {
  constructor(n3) {
    super(), this._sheetPermissionInitController = n3, this._initPermission();
  }
  _initPermission() {
    this._sheetPermissionInitController.initPermission();
  }
};
Ni2 = yI([
  MI(0, Inject(Xn3))
], Ni2);
var EI = Object.getOwnPropertyDescriptor;
var TI = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? EI(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var wn2 = (n3, e) => (t3, r) => e(t3, r, n3);
var Ml2 = class extends ER {
  constructor(e, t3, r, i, o3, s2, l4, a4, c2, d2) {
    super();
    _2(this, "disposableCollection", new ho());
    this._context = e, this._univerInstanceService = t3, this._permissionService = r, this._selectionManagerService = i, this._rangeProtectionRuleModel = o3, this._headerMoveRenderController = s2, this._selectionRenderService = l4, this._headerFreezeRenderController = a4, this._rangeProtectionCache = c2, this._headerResizeRenderController = d2, this._initHeaderMovePermissionInterceptor(), this._initHeaderResizePermissionInterceptor(), this._initRangeFillPermissionInterceptor(), this._initRangeMovePermissionInterceptor();
  }
  _initHeaderMovePermissionInterceptor() {
    const e = this._headerMoveRenderController.interceptor.getInterceptPoints().HEADER_MOVE_PERMISSION_CHECK;
    this.disposeWithMe(
      this._headerMoveRenderController.interceptor.intercept(e, {
        handler: (t3, r) => {
          const i = P5(this._univerInstanceService);
          if (!i)
            return false;
          const { unitId: o3, subUnitId: s2 } = i;
          if (!this._permissionService.composePermission([new Pe3(o3).id, new Le2(o3, s2).id]).every((a4) => a4.value))
            return false;
          if (!r)
            return true;
          if (r.rangeType !== ge.ROW && r.rangeType !== ge.COLUMN)
            return t3;
          if (r.rangeType === ge.ROW) {
            for (let a4 = r.startRow; a4 <= r.endRow; a4++)
              if (this._rangeProtectionCache.getRowPermissionInfo(o3, s2, a4, [ce3.Edit]) === false)
                return false;
          } else
            for (let a4 = r.startColumn; a4 <= r.endColumn; a4++)
              if (this._rangeProtectionCache.getColPermissionInfo(o3, s2, a4, [ce3.Edit]) === false)
                return false;
          return true;
        }
      })
    );
  }
  _initHeaderResizePermissionInterceptor() {
    this._headerResizeRenderController && this.disposeWithMe(
      this._headerResizeRenderController.interceptor.intercept(this._headerResizeRenderController.interceptor.getInterceptPoints().HEADER_RESIZE_PERMISSION_CHECK, {
        handler: (e, t3) => {
          var s2, l4, a4, c2;
          const r = P5(this._univerInstanceService);
          if (!r)
            return false;
          const { unitId: i, subUnitId: o3 } = r;
          if (t3.row) {
            if (((l4 = (s2 = this._permissionService.getPermissionPoint(new Qt3(i, o3).id)) == null ? void 0 : s2.value) != null ? l4 : false) === false)
              return false;
          } else if (t3.col && ((c2 = (a4 = this._permissionService.getPermissionPoint(new Zt3(i, o3).id)) == null ? void 0 : a4.value) != null ? c2 : false) === false)
            return false;
          return true;
        }
      })
    );
  }
  _initRangeFillPermissionInterceptor() {
    this.disposeWithMe(
      this._selectionRenderService.interceptor.intercept(this._selectionRenderService.interceptor.getInterceptPoints().RANGE_FILL_PERMISSION_CHECK, {
        handler: (e, t3) => {
          var g9, f4, p3;
          const r = P5(this._univerInstanceService);
          if (!r)
            return false;
          const { worksheet: i, unitId: o3, subUnitId: s2 } = r;
          if (!this._permissionService.composePermission([
            new Pe3(o3).id,
            new Le2(o3, s2).id,
            new An3(o3, s2).id,
            new kr2(o3, s2).id
          ]).every((v6) => v6.value))
            return false;
          const a4 = (g9 = this._selectionManagerService.getCurrentSelections()) == null ? void 0 : g9.map((v6) => v6.range), c2 = a4 == null ? void 0 : a4.find((v6) => {
            const S = Vs2(t3.x, t3.y, t3.scene, t3.skeleton), w6 = t3.skeleton.getCellWithCoordByIndex(v6.endRow, v6.endColumn), C = Math.abs(w6.endX - S.x), I6 = Math.abs(w6.endY - S.y);
            return C <= 5 && I6 <= 5;
          });
          if (!c2)
            return true;
          const { startRow: d2, endRow: u2, startColumn: h9, endColumn: m9 } = c2;
          for (let v6 = d2; v6 <= u2; v6++)
            for (let S = h9; S <= m9; S++) {
              const w6 = (p3 = (f4 = i.getCell(v6, S)) == null ? void 0 : f4.selectionProtection) == null ? void 0 : p3[0];
              if ((w6 == null ? void 0 : w6[ce3.Edit]) === false || (w6 == null ? void 0 : w6[ce3.View]) === false)
                return false;
            }
          return true;
        }
      })
    );
  }
  _initRangeMovePermissionInterceptor() {
    this.disposeWithMe(
      this._selectionRenderService.interceptor.intercept(this._selectionRenderService.interceptor.getInterceptPoints().RANGE_MOVE_PERMISSION_CHECK, {
        handler: (e, t3) => {
          var h9;
          const r = P5(this._univerInstanceService);
          if (!r)
            return false;
          const { worksheet: i, unitId: o3, subUnitId: s2 } = r;
          if (!this._permissionService.composePermission([new Pe3(o3).id, new Le2(o3, s2).id]).every((m9) => m9.value))
            return false;
          const a4 = (h9 = this._selectionManagerService.getCurrentSelections()) == null ? void 0 : h9.map((m9) => m9.range), c2 = this._rangeProtectionRuleModel.getSubunitRuleList(o3, s2).reduce((m9, g9) => [...m9, ...g9.ranges], []), d2 = a4 == null ? void 0 : a4.filter((m9) => c2.some((g9) => Cn.intersects(g9, m9)));
          return !(d2 == null ? void 0 : d2.some((m9) => {
            var S, w6;
            const { startRow: g9, startColumn: f4, endRow: p3, endColumn: v6 } = m9;
            for (let C = g9; C <= p3; C++)
              for (let I6 = f4; I6 <= v6; I6++) {
                const R9 = (w6 = (S = i.getCell(C, I6)) == null ? void 0 : S.selectionProtection) == null ? void 0 : w6[0];
                if ((R9 == null ? void 0 : R9[ce3.Edit]) === false)
                  return true;
              }
            return false;
          }));
        }
      })
    );
  }
  _initFreezePermissionInterceptor() {
    this.disposeWithMe(
      this._headerFreezeRenderController.interceptor.intercept(this._headerFreezeRenderController.interceptor.getInterceptPoints().FREEZE_PERMISSION_CHECK, {
        handler: (e, t3) => {
          var s2, l4;
          const r = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET);
          return !(r == null ? void 0 : r.getActiveSheet()) || !r ? false : (l4 = (s2 = this._permissionService.getPermissionPoint(new Pe3(r.getUnitId()).id)) == null ? void 0 : s2.value) != null ? l4 : false;
        }
      })
    );
  }
};
Ml2 = TI([
  wn2(1, br),
  wn2(2, aC),
  wn2(3, Inject(z)),
  wn2(4, Inject(me)),
  wn2(5, Inject(Wo)),
  wn2(6, gt),
  wn2(7, Inject(Lo4)),
  wn2(8, Inject(Wt2)),
  wn2(9, Optional(Bo))
], Ml2);
var PI = Object.getOwnPropertyDescriptor;
var xI = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? PI(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var io2 = (n3, e) => (t3, r) => e(t3, r, n3);
var OI = "SHEET_PERMISSION_PASTE_PLUGIN";
var ki2 = class extends Ve {
  constructor(e, t3, r, i, o3) {
    super();
    _2(this, "disposableCollection", new ho());
    this._univerInstanceService = e, this._selectionManagerService = t3, this._localService = r, this._sheetClipboardService = i, this._sheetPermissionCheckController = o3, this._initClipboardHook();
  }
  _initClipboardHook() {
    this.disposeWithMe(
      this._sheetClipboardService.addClipboardHook({
        id: OI,
        onBeforePaste: (e) => {
          var h9, m9, g9;
          const [t3] = wr4([e.range]).ranges, r = (h9 = this._selectionManagerService.getCurrentLastSelection()) == null ? void 0 : h9.range;
          if (!r)
            return false;
          const i = {
            startRow: r.startRow + t3.startRow,
            endRow: r.startRow + t3.endRow,
            startColumn: r.startColumn + t3.startColumn,
            endColumn: r.startColumn + t3.endColumn
          }, s2 = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET).getActiveSheet();
          if (!s2)
            return false;
          const { startRow: l4, endRow: a4, startColumn: c2, endColumn: d2 } = i;
          let u2 = true;
          for (let f4 = l4; f4 <= a4; f4++)
            for (let p3 = c2; p3 <= d2; p3++) {
              const v6 = (g9 = (m9 = s2.getCell(f4, p3)) == null ? void 0 : m9.selectionProtection) == null ? void 0 : g9[0];
              if ((v6 == null ? void 0 : v6[ce3.Edit]) === false) {
                u2 = false;
                break;
              }
            }
          return u2 || this._sheetPermissionCheckController.blockExecuteWithoutPermission(this._localService.t("permission.dialog.pasteErr")), u2;
        }
      })
    );
  }
};
ki2 = xI([
  io2(0, br),
  io2(1, Inject(z)),
  io2(2, Inject(Hn)),
  io2(3, Inject(tn3)),
  io2(4, Inject(Yn2))
], ki2);
var AI = Object.getOwnPropertyDescriptor;
var HI = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? AI(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var Ms3 = (n3, e) => (t3, r) => e(t3, r, n3);
var El2 = class extends ER {
  constructor(e, t3, r, i, o3) {
    super();
    _2(this, "disposableCollection", new ho());
    this._context = e, this._univerInstanceService = t3, this._permissionService = r, this._statusBarController = i, this._rangeProtectionCache = o3, this._initStatusBarPermissionInterceptor();
  }
  _initStatusBarPermissionInterceptor() {
    this.disposeWithMe(
      this._statusBarController.interceptor.intercept(this._statusBarController.interceptor.getInterceptPoints().STATUS_BAR_PERMISSION_CORRECT, {
        priority: 100,
        handler: (e, t3) => {
          var a4;
          const r = P5(this._univerInstanceService);
          if (!r)
            return e != null ? e : [];
          const { worksheet: i, unitId: o3, subUnitId: s2 } = r;
          return ((a4 = this._permissionService.getPermissionPoint(new ds(o3, s2).id)) == null ? void 0 : a4.value) === false ? t3.forEach((c2) => {
            const d2 = c2.getArrayValue();
            d2.forEach((u2, h9) => {
              u2.forEach((m9, g9) => {
                d2[h9][g9] = ce.create();
              });
            });
          }) : t3.forEach((c2) => {
            const d2 = c2.getArrayValue(), u2 = c2.getCurrentRow(), h9 = c2.getCurrentColumn();
            d2.forEach((m9, g9) => {
              m9.forEach((f4, p3) => {
                var w6;
                if (((w6 = i.getCellRaw(g9 + u2, p3 + h9)) == null ? void 0 : w6.v) === void 0)
                  return;
                const S = this._rangeProtectionCache.getCellInfo(o3, s2, g9 + u2, p3 + h9);
                (S == null ? void 0 : S[ce3.View]) === false && (d2[g9][p3] = ce.create());
              });
            });
          }), t3;
        }
      })
    );
  }
};
El2 = HI([
  Ms3(1, br),
  Ms3(2, aC),
  Ms3(3, Inject(Tr4)),
  Ms3(4, Inject(Wt2))
], El2);
var Hp = (n3, e, t3, r, i) => {
  const o3 = n3.get(Hn), s2 = n3.get(lt3), l4 = n3.get(me);
  let a4 = "";
  if (e.length === 0)
    a4 = o3.t("permission.panel.emptyRangeError");
  else if (e.length > 1) {
    let c2 = false;
    for (let d2 = 0; d2 < e.length; d2++) {
      for (let u2 = d2 + 1; u2 < e.length; u2++)
        if (Cn.intersects(e[d2], e[u2])) {
          c2 = true;
          break;
        }
      if (c2)
        break;
    }
    c2 && (a4 = o3.t("permission.panel.rangeOverlapError"));
  }
  if (!a4) {
    if (s2.getRule(r, i) && !t3)
      return a4 = o3.t("permission.panel.rangeOverlapOverPermissionError"), a4;
    const d2 = l4.getSubunitRuleList(r, i).filter((h9) => h9.permissionId !== t3).find((h9) => h9.ranges.some((m9) => e.some((g9) => Cn.intersects(m9, g9))));
    (d2 == null ? void 0 : d2.ranges.find((h9) => e.some((m9) => Cn.intersects(h9, m9)))) && (a4 = o3.t("permission.panel.rangeOverlapOverPermissionError"));
  }
  return a4 === "" ? void 0 : a4;
};
var VI = (n3, e) => {
  if (n3.length !== 1)
    return false;
  const t3 = n3[0], r = e.getRowCount(), i = e.getColumnCount(), { startRow: o3, endRow: s2, startColumn: l4, endColumn: a4 } = t3;
  return o3 === 0 && l4 === 0 && s2 === r - 1 && a4 === i - 1;
};
var NI = (n3, e) => {
  var a4, c2;
  const t3 = n3.get(br), r = n3.get(z), i = t3.getCurrentUnitForType(we.UNIVER_SHEET), o3 = i.getActiveSheet();
  let s2 = x4.SelectRange, l4 = (c2 = (a4 = r.getCurrentSelections()) == null ? void 0 : a4.map((d2) => d2.range)) != null ? c2 : [];
  return e && (s2 = x4.Worksheet, l4 = [{
    startRow: 0,
    startColumn: 0,
    endRow: o3.getRowCount() - 1,
    endColumn: o3.getColumnCount() - 1,
    rangeType: ge.ALL
  }]), {
    unitId: i.getUnitId(),
    subUnitId: o3.getSheetId(),
    permissionId: "",
    unitType: s2,
    description: "",
    id: "",
    ranges: l4,
    editState: xu.OnlyMe,
    viewState: Au.OthersCanView
  };
};
var kI = (n3, e) => {
  const i = n3.get(br).getCurrentUnitForType(we.UNIVER_SHEET).getActiveSheet(), { unitType: o3 } = e;
  return o3 === x4.Worksheet ? __spreadProps(__spreadValues({}, e), {
    ranges: [{
      startRow: 0,
      startColumn: 0,
      endRow: i.getRowCount() - 1,
      endColumn: i.getColumnCount() - 1,
      rangeType: ge.ALL
    }]
  }) : e;
};
var DI = (n3) => {
  const { viewState: e, editState: t3, permissionId: r, ranges: i, rangesErrMsg: o3, desc: s2, oldRule: l4, id: a4 } = n3, c2 = useDependency(Rr4), d2 = useDependency(be2), u2 = useDependency(_E), h9 = useDependency(Hn), m9 = useDependency(Ds), g9 = useDependency(Dr4), p3 = useDependency(br).getCurrentUnitForType(we.UNIVER_SHEET), v6 = p3 == null ? void 0 : p3.getActiveSheet();
  if (!p3 || !v6)
    return null;
  const S = p3.getUnitId(), w6 = v6.getSheetId();
  return (0, import_jsx_runtime.jsxs)("div", { className: "univer-mt-auto univer-flex univer-flex-row-reverse univer-gap-2 univer-py-5", children: [
    (0, import_jsx_runtime.jsx)(
      fr,
      {
        variant: "primary",
        onClick: () => __async(void 0, null, function* () {
          if (o3) return;
          const C = {
            unitId: S,
            subUnitId: w6,
            permissionId: r,
            id: a4,
            viewState: e,
            editState: t3,
            unitType: x4.SelectRange,
            ranges: i,
            description: s2
          };
          VI(i, v6) && (C.unitType = x4.Worksheet, C.ranges = []);
          let R9 = g9.selectUserList;
          C.editState === xu.OnlyMe && (R9 = [], g9.setSelectUserList([]));
          const y6 = {
            read: C.viewState === Au.OthersCanView ? rn2.AllCollaborator : rn2.SomeCollaborator,
            edit: C.editState === xu.DesignedUserCanEdit ? rn2.SomeCollaborator : rn2.OneSelf
          };
          if (C.editState === xu.DesignedUserCanEdit && R9.length === 0 && (R9 = [], y6.edit = rn2.OneSelf), C.permissionId) {
            const M10 = Pw(R9.filter((H6) => H6.role === Lt3.Editor), g9.oldCollaboratorList.filter((H6) => H6.role === Lt3.Editor)), T10 = (l4 == null ? void 0 : l4.viewState) === C.viewState, P8 = (l4 == null ? void 0 : l4.editState) === C.editState, A4 = C.unitType === (l4 == null ? void 0 : l4.unitType) && C.description === l4.description && C.ranges === l4.ranges, x7 = !M10 || !T10 || !P8;
            if (A4 && x7)
              yield u2.update({
                objectType: C.unitType,
                objectID: C.permissionId,
                unitID: C.unitId,
                share: void 0,
                name: "",
                strategies: [],
                scope: y6,
                collaborators: {
                  collaborators: R9
                }
              });
            else {
              let H6 = C.permissionId;
              x7 && (C.unitType === x4.Worksheet ? H6 = yield u2.create({
                worksheetObject: {
                  collaborators: R9,
                  unitID: C.unitId,
                  name: "",
                  strategies: [{ role: Lt3.Editor, action: ce3.Edit }, { role: Lt3.Reader, action: ce3.View }],
                  scope: y6
                },
                objectType: x4.Worksheet
              }) : H6 = yield u2.create({
                selectRangeObject: {
                  collaborators: R9,
                  unitID: C.unitId,
                  name: "",
                  scope: y6
                },
                objectType: x4.SelectRange
              })), m9.executeCommand(Vc2.id, {
                rule: __spreadProps(__spreadValues({}, C), {
                  permissionId: H6
                }),
                oldRule: l4
              });
            }
          } else if (C.unitType === x4.Worksheet) {
            const M10 = yield u2.create({
              worksheetObject: {
                collaborators: R9,
                unitID: C.unitId,
                name: "",
                strategies: [{ role: Lt3.Editor, action: ce3.Edit }, { role: Lt3.Reader, action: ce3.View }],
                scope: y6
              },
              objectType: x4.Worksheet
            }), _a5 = C, { ranges: T10 = [] } = _a5, P8 = __objRest(_a5, ["ranges"]);
            P8.permissionId = M10, m9.executeCommand(oc.id, {
              rule: P8,
              unitId: C.unitId
            });
          } else if (C.unitType === x4.SelectRange) {
            const M10 = yield u2.create({
              selectRangeObject: {
                collaborators: R9,
                unitID: C.unitId,
                name: "",
                scope: y6
              },
              objectType: x4.SelectRange
            });
            m9.executeCommand($u.id, {
              rule: C,
              permissionId: M10
            });
          }
          const E3 = {
            header: { title: `${h9.t("permission.panel.title")}` },
            children: {
              label: Po4,
              showDetail: false
            },
            width: 330
          };
          d2.open(E3);
        }),
        children: h9.t("permission.button.confirm")
      }
    ),
    (0, import_jsx_runtime.jsx)(
      fr,
      {
        onClick: () => {
          c2.reset(), g9.reset(), d2.close();
        },
        children: h9.t("permission.button.cancel")
      }
    )
  ] });
};
var LI = (n3) => {
  const { ranges: e, onRangesChange: t3, desc: r, onDescChange: i, rangesErrMsg: o3, permissionId: s2 } = n3, l4 = useDependency(S13), a4 = (0, import_react.useMemo)(() => l4.get(_m2), []), c2 = useDependency(br), d2 = useDependency(Hn), u2 = useDependency(Injector), h9 = c2.getCurrentUnitForType(we.UNIVER_SHEET), m9 = h9 == null ? void 0 : h9.getActiveSheet();
  if (!h9 || !m9)
    return null;
  const g9 = h9.getUnitId(), f4 = m9.getSheetId(), p3 = (v6) => {
    const S = v6.split(",").map(kr).map((M10) => M10.range);
    if (S.some((M10) => !ZR(M10) || M10.endColumn < M10.startColumn || M10.endRow < M10.startRow))
      return;
    const w6 = c2.getCurrentUnitForType(we.UNIVER_SHEET), C = w6 == null ? void 0 : w6.getActiveSheet();
    if (!w6 || !C)
      return;
    const I6 = w6.getUnitId(), R9 = C.getSheetId(), y6 = S.map((M10) => {
      const T10 = C.getRowCount(), P8 = C.getColumnCount();
      return Hh(M10, T10, P8), M10;
    }), E3 = Hp(u2, y6, s2, I6, R9);
    t3(y6, E3);
  };
  return (0, import_jsx_runtime.jsxs)(import_jsx_runtime.Fragment, { children: [
    (0, import_jsx_runtime.jsx)(
      DE,
      {
        className: "univer-font-medium",
        label: d2.t("permission.panel.protectedRange"),
        error: o3,
        children: a4 && (0, import_jsx_runtime.jsx)(
          a4,
          {
            unitId: g9,
            subUnitId: f4,
            initialValue: e == null ? void 0 : e.map((v6) => Yt(v6)).join(","),
            onChange: (v6, S) => p3(S)
          }
        )
      }
    ),
    (0, import_jsx_runtime.jsx)(DE, { className: "univer-font-medium", label: d2.t("permission.panel.permissionDirection"), children: (0, import_jsx_runtime.jsx)(
      eC,
      {
        value: r,
        onChange: (v6) => i(v6),
        placeholder: d2.t("permission.panel.permissionDirectionPlaceholder")
      }
    ) })
  ] });
};
var Vp = "data:image/png;base64,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";
var WI = (n3) => {
  const { editState: e, onEditStateChange: t3, viewState: r, onViewStateChange: i, permissionId: o3 } = n3, s2 = useDependency(Hn), l4 = useDependency(ct2), a4 = useDependency(_E), c2 = useDependency(Dr4), d2 = useDependency(Is), u2 = useDependency(br), h9 = useObservable(c2.selectUserList$, c2.selectUserList), m9 = u2.getCurrentUnitForType(we.UNIVER_SHEET), g9 = m9 == null ? void 0 : m9.getActiveSheet();
  if (!m9 || !g9)
    return null;
  const f4 = m9.getUnitId(), p3 = () => __async(void 0, null, function* () {
    const v6 = yield a4.listCollaborators({
      objectID: f4,
      unitID: f4
    }), S = d2.getCurrentUser();
    c2.setCanEditUserList(v6.filter((w6) => {
      var C;
      return ((C = w6.subject) == null ? void 0 : C.userID) !== S.userID;
    })), l4.open({
      id: sl2,
      title: { title: "" },
      children: { label: Wm },
      width: 280,
      destroyOnClose: true,
      closable: false,
      onClose: () => l4.close(sl2),
      className: "sheet-permission-user-dialog"
    });
  });
  return (0, import_react.useEffect)(() => {
    o3 ? (() => __async(void 0, null, function* () {
      const w6 = (yield a4.listCollaborators({
        objectID: o3,
        unitID: f4
      })).filter((C) => C.role === Lt3.Editor);
      w6.length > 0 && t3(xu.DesignedUserCanEdit), c2.setSelectUserList(w6), c2.setOldCollaboratorList(w6);
    }))() : (c2.setSelectUserList([]), c2.setOldCollaboratorList([]));
  }, []), (0, import_jsx_runtime.jsxs)(import_jsx_runtime.Fragment, { children: [
    (0, import_jsx_runtime.jsx)(DE, { className: "univer-font-medium", label: s2.t("permission.panel.editPermission"), children: (0, import_jsx_runtime.jsxs)(
      VE2,
      {
        value: e,
        onChange: (v6) => t3(v6),
        className: "univer-flex univer-flex-col",
        children: [
          (0, import_jsx_runtime.jsx)(qE, { value: xu.OnlyMe, children: (0, import_jsx_runtime.jsx)("span", { children: s2.t("permission.panel.onlyICanEdit") }) }),
          (0, import_jsx_runtime.jsx)(qE, { value: xu.DesignedUserCanEdit, children: (0, import_jsx_runtime.jsx)("span", { children: s2.t("permission.panel.designedUserCanEdit") }) })
        ]
      }
    ) }),
    e === xu.DesignedUserCanEdit && (0, import_jsx_runtime.jsxs)(
      "div",
      {
        className: ie2("univer-mb-2 univer-flex univer-h-[270px] univer-flex-col univer-overflow-y-auto univer-rounded-lg univer-p-3", kt2),
        children: [
          (0, import_jsx_runtime.jsxs)("div", { className: "univer-flex univer-items-center univer-justify-between univer-text-sm", children: [
            (0, import_jsx_runtime.jsx)("span", { children: s2.t("permission.panel.designedPerson") }),
            (0, import_jsx_runtime.jsx)("span", { className: "univer-cursor-pointer univer-text-primary-600", onClick: p3, children: s2.t("permission.panel.addPerson") })
          ] }),
          (0, import_jsx_runtime.jsx)("div", { className: "univer-my-2 univer-h-px univer-bg-gray-200" }),
          (0, import_jsx_runtime.jsx)("div", { className: "univer-flex-1", children: (h9 == null ? void 0 : h9.length) > 0 ? h9.map((v6) => {
            var S, w6, C;
            return (0, import_jsx_runtime.jsxs)(
              "div",
              {
                className: "univer-mb-3 univer-flex univer-h-7 univer-items-center univer-leading-7 last:univer-mb-0",
                children: [
                  (0, import_jsx_runtime.jsx)(sE, { size: 24, src: (S = v6.subject) == null ? void 0 : S.avatar }),
                  (0, import_jsx_runtime.jsx)(
                    "span",
                    {
                      className: "univer-ml-1.5 univer-w-[130px] univer-truncate univer-text-gray-900 dark:!univer-text-white",
                      children: (w6 = v6.subject) == null ? void 0 : w6.name
                    }
                  ),
                  (0, import_jsx_runtime.jsx)(
                    KE,
                    {
                      className: "!univer-w-[90px] univer-min-w-0 univer-cursor-pointer",
                      borderless: true,
                      value: "edit",
                      options: [
                        { label: `${s2.t("permission.panel.canEdit")}`, value: "edit" },
                        { label: `${s2.t("permission.panel.delete")}`, value: "delete" }
                      ],
                      onChange: (I6) => {
                        I6 === "delete" && c2.setSelectUserList(h9.filter((R9) => {
                          var y6, E3;
                          return ((y6 = R9.subject) == null ? void 0 : y6.userID) !== ((E3 = v6.subject) == null ? void 0 : E3.userID);
                        }));
                      }
                    }
                  )
                ]
              },
              (C = v6.subject) == null ? void 0 : C.userID
            );
          }) : (0, import_jsx_runtime.jsxs)(
            "div",
            {
              className: "univer-flex univer-h-full univer-flex-col univer-items-center univer-justify-center",
              children: [
                (0, import_jsx_runtime.jsx)("img", { width: 240, height: 120, src: Vp, alt: "" }),
                (0, import_jsx_runtime.jsx)(
                  "p",
                  {
                    className: "univer-w-60 univer-break-words univer-text-sm univer-text-gray-400",
                    children: s2.t("permission.dialog.userEmpty")
                  }
                )
              ]
            }
          ) })
        ]
      }
    ),
    (0, import_jsx_runtime.jsx)(DE, { className: "univer-font-medium", label: s2.t("permission.panel.viewPermission"), children: (0, import_jsx_runtime.jsxs)(
      VE2,
      {
        value: r,
        onChange: (v6) => i(v6),
        className: "univer-flex univer-flex-col last:univer-mb-0",
        children: [
          (0, import_jsx_runtime.jsx)(qE, { value: Au.OthersCanView, children: (0, import_jsx_runtime.jsx)("span", { children: s2.t("permission.panel.othersCanView") }) }),
          (0, import_jsx_runtime.jsx)(qE, { value: Au.NoOneElseCanView, children: (0, import_jsx_runtime.jsx)("span", { children: s2.t("permission.panel.noOneElseCanView") }) })
        ]
      }
    ) })
  ] });
};
var BI = (n3) => {
  var w6, C;
  const { fromSheetBar: e, rule: t3, oldRule: r } = n3, i = useDependency(Injector), o3 = useDependency(S13), s2 = t3 ? kI(i, t3) : NI(i, e), [l4, a4] = (0, import_react.useState)(s2.ranges), [c2, d2] = (0, import_react.useState)(() => Hp(i, s2.ranges, s2.permissionId, s2.unitId, s2.subUnitId)), [u2, h9] = (0, import_react.useState)(s2.description), [m9, g9] = (0, import_react.useState)((w6 = s2.editState) != null ? w6 : xu.OnlyMe), [f4, p3] = (0, import_react.useState)((C = s2.viewState) != null ? C : Au.OthersCanView), v6 = o3.get(pa5), S = v6 != null ? v6 : WI;
  return (0, import_react.useEffect)(() => {
    const I6 = i.get(br), R9 = i.get(be2), y6 = I6.getCurrentUnitOfType(we.UNIVER_SHEET);
    if (!y6) return;
    const E3 = y6.getActiveSheet().getSheetId(), M10 = y6.activeSheet$.subscribe((T10) => {
      (T10 == null ? void 0 : T10.getSheetId()) !== E3 && R9.close();
    });
    return () => {
      M10.unsubscribe();
    };
  }, []), (0, import_jsx_runtime.jsxs)(
    "div",
    {
      className: "univer-mt-4 univer-flex univer-h-[calc(100%-16px)] univer-flex-col",
      children: [
        (0, import_jsx_runtime.jsx)(
          LI,
          {
            permissionId: s2.permissionId,
            ranges: l4,
            onRangesChange: (I6, R9) => {
              a4(I6), d2(R9);
            },
            rangesErrMsg: c2,
            desc: u2,
            onDescChange: (I6) => h9(I6)
          }
        ),
        (0, import_jsx_runtime.jsx)(
          S,
          {
            editState: m9,
            onEditStateChange: (I6) => g9(I6),
            viewState: f4,
            onViewStateChange: (I6) => p3(I6),
            permissionId: s2.permissionId
          }
        ),
        (0, import_jsx_runtime.jsx)(
          DI,
          {
            permissionId: s2.permissionId,
            id: s2.id,
            ranges: l4,
            rangesErrMsg: c2,
            desc: u2,
            viewState: f4,
            editState: m9,
            oldRule: r
          }
        )
      ]
    }
  );
};
var FI = "data:image/png;base64,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";
function UI() {
  var x7;
  const [n3, e] = (0, import_react.useState)(true), [t3, r] = (0, import_react.useState)(false), [i, o3] = (0, import_react.useState)([]), s2 = useDependency(Hn), l4 = useDependency(me), a4 = useDependency(lt3), c2 = useDependency(br), d2 = useDependency(Ds), u2 = useDependency(be2), h9 = useDependency(_E), m9 = useDependency(aC), f4 = useDependency(Is).getCurrentUser(), p3 = useDependency(Dr4), v6 = useObservable(a4.ruleRefresh$, ""), S = useObservable(l4.ruleRefresh$, ""), w6 = c2.getCurrentUnitOfType(we.UNIVER_SHEET);
  if (!w6) return null;
  const C = w6.getUnitId(), I6 = (0, import_react.useCallback)((H6) => __async(this, null, function* () {
    var G5;
    const V7 = w6.getActiveSheet(), D5 = w6.getUnitId(), B5 = V7.getSheetId(), F7 = [], z5 = [];
    w6.getSheets().forEach((ee5) => {
      const re5 = ee5.getSheetId();
      l4.getSubunitRuleList(D5, re5).forEach((ge5) => {
        ge5.permissionId && F7.push(ge5.permissionId);
      });
      const Xe9 = a4.getRule(D5, re5);
      Xe9 != null && Xe9.permissionId && z5.push(Xe9.permissionId);
    });
    const Z9 = [...F7, ...z5], de3 = yield h9.list({
      objectIDs: Z9,
      unitID: D5,
      actions: pt2
    }), Re5 = l4.getSubunitRuleList(D5, B5).map((ee5) => ee5.permissionId), we6 = (G5 = a4.getRule(D5, B5)) == null ? void 0 : G5.permissionId;
    we6 && Re5.push(we6);
    const ke4 = de3.filter((ee5) => {
      var re5;
      return Re5.includes(ee5.objectID) || ee5.objectID === ((re5 = a4.getRule(D5, B5)) == null ? void 0 : re5.permissionId);
    });
    return H6 ? ke4 : de3;
  }), []), [R9, y6] = (0, import_react.useState)([]);
  (0, import_react.useEffect)(() => {
    const H6 = merge(
      l4.ruleChange$,
      a4.ruleChange$
    ).subscribe(() => __async(this, null, function* () {
      const V7 = yield I6(n3);
      y6(V7);
    }));
    return () => {
      H6.unsubscribe();
    };
  }, [n3]), (0, import_react.useEffect)(() => {
    const H6 = w6.activeSheet$.pipe(
      distinctUntilChanged((V7, D5) => (V7 == null ? void 0 : V7.getSheetId()) === (D5 == null ? void 0 : D5.getSheetId()))
    ).subscribe(() => __async(this, null, function* () {
      const V7 = yield I6(n3);
      y6(V7);
    }));
    return () => {
      H6.unsubscribe();
    };
  }, [n3]), (0, import_react.useEffect)(() => {
    (() => __async(this, null, function* () {
      if (v6 || S) {
        const V7 = yield I6(true);
        y6(V7);
      }
    }))();
  }, [v6, S]);
  function E3(H6) {
    const { unitId: V7, subUnitId: D5, unitType: B5 } = H6;
    let F7;
    B5 === Rn.Worksheet ? F7 = d2.executeCommand(Rc.id, { unitId: V7, subUnitId: D5, rule: H6 }) : B5 === Rn.SelectRange && (F7 = d2.executeCommand(fc.id, { unitId: V7, subUnitId: D5, rule: H6 })), F7 && (r(!t3), H6.ranges === i && o3([]));
  }
  (0, import_react.useEffect)(() => {
    p3.reset();
  }, []), VR(i);
  const M10 = (0, import_react.useMemo)(() => {
    const H6 = /* @__PURE__ */ new Map();
    return w6.getSheets().forEach((V7) => {
      const D5 = V7.getSheetId();
      l4.getSubunitRuleList(C, D5).forEach((z5) => {
        H6.set(z5.permissionId, z5);
      });
      const F7 = a4.getRule(C, D5);
      F7 && H6.set(F7 == null ? void 0 : F7.permissionId, F7);
    }), H6;
  }, [C, w6, l4, a4]), T10 = (H6) => {
    H6.subUnitId !== w6.getActiveSheet().getSheetId() && d2.executeCommand(pn.id, {
      unitId: H6.unitId,
      subUnitId: H6.subUnitId
    });
    const V7 = {
      header: { title: "permission.panel.title" },
      children: {
        label: Po4,
        showDetail: true,
        rule: Z.deepClone(H6),
        oldRule: Z.deepClone(H6)
      },
      width: 330
    };
    u2.open(V7);
  }, P8 = (H6) => {
    e(H6);
  }, A4 = (x7 = m9.getPermissionPoint(new ar3(C).id)) == null ? void 0 : x7.value;
  return (0, import_jsx_runtime.jsxs)("div", { className: "univer-mt-2 univer-flex univer-h-[calc(100%-8px)] univer-flex-col", children: [
    (0, import_jsx_runtime.jsxs)("div", { className: "univer-flex univer-h-[30px] univer-py-2", children: [
      (0, import_jsx_runtime.jsxs)("div", { className: "univer-mr-5 univer-flex univer-cursor-pointer univer-flex-col univer-items-center", onClick: () => P8(true), children: [
        (0, import_jsx_runtime.jsxs)("div", { className: ie2("univer-h-6 univer-text-base univer-font-medium univer-leading-6", { "univer-text-blue-500": n3 }), children: [
          " ",
          s2.t("permission.panel.currentSheet")
        ] }),
        (0, import_jsx_runtime.jsx)("div", { className: ie2("univer-mt-1 univer-h-0.5 univer-w-6", { "univer-bg-blue-500": n3 }) })
      ] }),
      (0, import_jsx_runtime.jsxs)("div", { className: "univer-mr-5 univer-flex univer-cursor-pointer univer-flex-col univer-items-center", onClick: () => P8(false), children: [
        (0, import_jsx_runtime.jsx)("div", { className: ie2("univer-h-6 univer-text-base univer-font-medium univer-leading-6", { "univer-text-blue-500": !n3 }), children: s2.t("permission.panel.allSheet") }),
        (0, import_jsx_runtime.jsx)("div", { className: ie2("univer-mt-1 univer-h-0.5 univer-w-6", { "univer-bg-blue-500": !n3 }) })
      ] })
    ] }),
    (R9 == null ? void 0 : R9.length) > 0 ? (0, import_jsx_runtime.jsx)("div", { children: R9 == null ? void 0 : R9.map((H6) => {
      var re5, fe5, Xe9, ge5, be4;
      const V7 = M10.get(H6.objectID);
      if (!V7)
        return null;
      const D5 = H6.actions.find((ae5) => ae5.action === ce3.Edit), B5 = D5 == null ? void 0 : D5.allowed, F7 = H6.actions.find((ae5) => ae5.action === ce3.View), z5 = F7 == null ? void 0 : F7.allowed, Z9 = H6.actions.find((ae5) => ae5.action === ce3.ManageCollaborator), de3 = H6.actions.find((ae5) => ae5.action === ce3.Delete), Re5 = (Z9 == null ? void 0 : Z9.allowed) || f4.userID === ((re5 = H6.creator) == null ? void 0 : re5.userID), we6 = (de3 == null ? void 0 : de3.allowed) || f4.userID === ((fe5 = H6.creator) == null ? void 0 : fe5.userID);
      let ke4 = "";
      const G5 = w6.getSheetBySheetId(V7.subUnitId), ee5 = G5 == null ? void 0 : G5.getName();
      if (V7.unitType === Rn.SelectRange) {
        const ae5 = V7.ranges, it5 = ae5 != null && ae5.length ? ae5.map((ot6) => {
          const vt4 = Yt(ot6);
          return vt4 === "NaN" ? "" : vt4;
        }).filter((ot6) => !!ot6).join(",") : "";
        ke4 = `${ee5}(${it5})`;
      } else V7.unitType === Rn.Worksheet && (ke4 = ee5 || "");
      return (0, import_jsx_runtime.jsxs)(
        "div",
        {
          className: ie2("univer-mt-3 univer-rounded-lg univer-p-3 hover:univer-bg-gray-50", kt2),
          onMouseMove: () => {
            const { subUnitId: ae5, unitType: it5 } = V7, ot6 = w6.getActiveSheet();
            if (!ot6)
              return false;
            const vt4 = ot6.getSheetId();
            if (ae5 !== vt4)
              return false;
            if (it5 === Rn.SelectRange) {
              const wt4 = V7.ranges || [];
              wt4 !== i && o3(wt4);
            } else if (it5 === Rn.Worksheet) {
              const wt4 = [{ startRow: 0, endRow: ot6.getRowCount() - 1, startColumn: 0, endColumn: ot6.getColumnCount() - 1 }];
              wt4 !== i && o3(wt4);
            }
          },
          onMouseLeave: () => o3([]),
          children: [
            (0, import_jsx_runtime.jsxs)("div", { className: "univer-flex univer-h-5 univer-justify-between univer-leading-5", children: [
              (0, import_jsx_runtime.jsx)(Np, { title: ke4, children: (0, import_jsx_runtime.jsx)(
                "div",
                {
                  className: "univer-max-w-[200px] univer-truncate univer-text-sm univer-font-medium",
                  children: ke4
                }
              ) }),
              (Re5 || we6) && (0, import_jsx_runtime.jsxs)("div", { className: "univer-flex univer-items-center", children: [
                Re5 && (0, import_jsx_runtime.jsx)(Np, { title: s2.t("permission.panel.edit"), children: (0, import_jsx_runtime.jsx)(
                  "div",
                  {
                    className: "univer-box-border univer-h-6 univer-rounded-sm univer-p-1 hover:univer-bg-gray-200",
                    onClick: () => T10(V7),
                    children: (0, import_jsx_runtime.jsx)(gu2, {})
                  }
                ) }),
                we6 && (0, import_jsx_runtime.jsx)(Np, { title: s2.t("permission.panel.delete"), children: (0, import_jsx_runtime.jsx)(
                  "div",
                  {
                    className: "univer-box-border univer-h-6 univer-rounded-sm univer-p-1 hover:univer-bg-gray-200",
                    onClick: () => E3(V7),
                    children: (0, import_jsx_runtime.jsx)(Aa3, {})
                  }
                ) })
              ] })
            ] }),
            (0, import_jsx_runtime.jsx)("div", { className: "univer-my-2 univer-h-px univer-bg-gray-200" }),
            (0, import_jsx_runtime.jsxs)("div", { children: [
              (0, import_jsx_runtime.jsxs)("div", { className: "univer-flex univer-items-center", children: [
                (0, import_jsx_runtime.jsx)(Np, { title: (ge5 = (Xe9 = H6.creator) == null ? void 0 : Xe9.name) != null ? ge5 : "", children: (0, import_jsx_runtime.jsx)("div", { children: (0, import_jsx_runtime.jsx)(sE, { src: (be4 = H6.creator) == null ? void 0 : be4.avatar, className: "univer-mr-1.5", size: 24 }) }) }),
                (0, import_jsx_runtime.jsx)(
                  "span",
                  {
                    className: "univer-h-4 univer-flex-grow univer-text-xs univer-text-gray-900 dark:!univer-text-white",
                    children: s2.t("permission.panel.created")
                  }
                ),
                (0, import_jsx_runtime.jsx)(
                  "span",
                  {
                    className: "univer-h-4 univer-text-xs univer-text-gray-900 dark:!univer-text-white",
                    children: B5 ? `${s2.t("permission.panel.iCanEdit")}` : `${s2.t("permission.panel.iCanNotEdit")}`
                  }
                )
              ] }),
              (0, import_jsx_runtime.jsxs)("div", { className: "univer-mt-2 univer-flex univer-items-center", children: [
                (0, import_jsx_runtime.jsx)(
                  "span",
                  {
                    className: "univer-h-4 univer-flex-grow univer-text-xs univer-text-gray-900 dark:!univer-text-white",
                    children: s2.t("permission.panel.viewPermission")
                  }
                ),
                (0, import_jsx_runtime.jsx)(
                  "span",
                  {
                    className: "univer-h-4 univer-text-xs univer-text-gray-900 dark:!univer-text-white",
                    children: z5 ? `${s2.t("permission.panel.iCanView")}` : `${s2.t("permission.panel.iCanNotView")}`
                  }
                )
              ] }),
              V7.description && (0, import_jsx_runtime.jsx)(Np, { title: V7.description, children: (0, import_jsx_runtime.jsx)(
                "div",
                {
                  className: "univer-text-3 univer-mt-2 univer-max-w-64 univer-truncate univer-text-sm univer-text-gray-400",
                  children: V7.description
                }
              ) })
            ] })
          ]
        },
        H6.objectID
      );
    }) }) : (0, import_jsx_runtime.jsxs)(
      "div",
      {
        className: "univer-flex univer-flex-1 univer-flex-col univer-items-center univer-justify-center",
        children: [
          (0, import_jsx_runtime.jsx)("img", { width: 240, height: 120, src: FI, alt: "", draggable: false }),
          (0, import_jsx_runtime.jsx)("p", { className: "univer-w-60 univer-break-words univer-text-sm univer-text-gray-400", children: s2.t("permission.dialog.listEmpty") })
        ]
      }
    ),
    A4 && (0, import_jsx_runtime.jsx)("div", { className: "univer-mt-auto univer-py-5", children: (0, import_jsx_runtime.jsxs)(
      fr,
      {
        className: "univer-w-full",
        variant: "primary",
        onClick: () => {
          const H6 = {
            header: { title: `${s2.t("permission.panel.title")}` },
            children: {
              label: Po4,
              showDetail: true
            },
            width: 330
          };
          u2.open(H6);
        },
        children: [
          (0, import_jsx_runtime.jsx)("div", { children: "+ " }),
          s2.t("permission.button.addNewPermission")
        ]
      }
    ) })
  ] });
}
var XI = ({ showDetail: n3, fromSheetBar: e, rule: t3, oldRule: r }) => {
  var u2;
  const i = useDependency(br), o3 = useDependency(z);
  if (!useDependency(Rr4).getVisible()) return null;
  const l4 = P5(i);
  if (!l4) return null;
  const { worksheet: a4 } = l4, d2 = ((u2 = o3.getCurrentSelections()) == null ? void 0 : u2.map((h9) => h9.range)).reduce((h9, m9) => h9 + wl(a4.getName(), m9), "");
  return n3 ? (0, import_jsx_runtime.jsx)(
    BI,
    {
      fromSheetBar: e,
      rule: t3,
      oldRule: r
    },
    e ? "sheet-bar" : "normal"
  ) : (0, import_jsx_runtime.jsx)(UI, {}, d2);
};
var zI = ({ loading: n3, children: e }) => (0, import_jsx_runtime.jsxs)("div", { className: "univer-relative univer-h-full univer-w-full", children: [
  n3 && (0, import_jsx_runtime.jsx)(
    "div",
    {
      className: "univer-absolute -univer-bottom-0.5 -univer-left-0.5 -univer-right-0.5 -univer-top-0.5 univer-z-10 univer-flex univer-items-center univer-justify-center univer-bg-white univer-backdrop-blur dark:!univer-bg-black",
      children: (0, import_jsx_runtime.jsx)(
        "div",
        {
          className: "univer-size-10 univer-animate-spin univer-rounded-full univer-border-4 univer-border-solid univer-border-gray-100 univer-border-t-primary-500"
        }
      )
    }
  ),
  (0, import_jsx_runtime.jsx)("div", { className: n3 ? "univer-pointer-events-none univer-blur-sm" : "", children: e })
] });
var jI = () => {
  const n3 = useDependency(Hn), e = useDependency(br), t3 = useDependency(_E), r = useDependency(vn2), i = useDependency(ct2), o3 = useDependency(aC), s2 = e.getCurrentUnitForType(we.UNIVER_SHEET), l4 = s2.getActiveSheet();
  if (!l4)
    throw new Error("No active sheet found");
  const [a4, c2] = (0, import_react.useState)([]), d2 = useDependency(Ds), [u2, h9] = (0, import_react.useState)(() => !!r.getRule(s2.getUnitId(), l4.getSheetId())), [m9, g9] = (0, import_react.useState)(() => Object.keys(bs4).reduce((p3, v6) => (p3[v6] = {
    text: n3.t(`permission.panel.${bs4[Number(v6)]}`),
    allowed: true
  }, p3), {}));
  (0, import_react.useEffect)(() => {
    (() => __async(void 0, null, function* () {
      const v6 = s2.getUnitId(), S = yield t3.listCollaborators({
        objectID: v6,
        unitID: v6
      });
      c2(S);
    }))();
  }, []), (0, import_react.useEffect)(() => {
    (() => __async(void 0, null, function* () {
      const v6 = s2.getUnitId(), S = r.getRule(v6, l4.getSheetId());
      if (!S)
        return;
      h9(true);
      const C = (yield t3.list({
        unitID: s2.getUnitId(),
        objectIDs: [S.permissionId],
        actions: sw
      }))[0].strategies.reduce((I6, R9) => (bs4[R9.action] && (I6[R9.action] = {
        text: n3.t(`permission.panel.${bs4[R9.action]}`),
        allowed: R9.role !== Lt3.Owner
      }), I6), {});
      g9(C), setTimeout(() => {
        h9(false);
      }, 100);
    }))();
  }, []);
  const f4 = () => __async(void 0, null, function* () {
    const p3 = e.getCurrentUnitForType(we.UNIVER_SHEET), v6 = p3 == null ? void 0 : p3.getActiveSheet();
    if (!v6)
      throw new Error("No active sheet found");
    const S = p3.getUnitId(), w6 = v6.getSheetId(), C = r.getRule(S, w6), I6 = Object.keys(m9).map((y6) => ({
      action: Number(y6),
      role: m9[y6].allowed ? Lt3.Editor : Lt3.Owner
    }));
    let R9 = C == null ? void 0 : C.permissionId;
    R9 ? t3.update({
      objectType: Rn.Worksheet,
      objectID: R9,
      unitID: S,
      strategies: I6,
      share: void 0,
      name: "",
      scope: {
        read: rn2.AllCollaborator,
        edit: rn2.AllCollaborator
      },
      collaborators: void 0
    }).then(() => {
      be3().forEach((y6) => {
        const E3 = new y6(S, w6), M10 = E3.subType, T10 = I6.find((P8) => P8.action === M10);
        T10 && o3.updatePermissionPoint(E3.id, T10.role === Lt3.Editor);
      });
    }) : (R9 = yield t3.create({
      objectType: Rn.Worksheet,
      worksheetObject: {
        unitID: S,
        collaborators: a4,
        name: "",
        strategies: I6,
        scope: {
          read: rn2.AllCollaborator,
          edit: rn2.AllCollaborator
        }
      }
    }), d2.executeCommand(dd.id, {
      rule: {
        permissionId: R9,
        unitId: S,
        subUnitId: w6
      }
    }));
  });
  return (0, import_jsx_runtime.jsx)(zI, { loading: u2, children: (0, import_jsx_runtime.jsxs)("div", { className: ie2("univer-flex univer-flex-col", dE2), children: [
    Object.keys(m9).map((p3) => {
      const v6 = m9[p3], { text: S, allowed: w6 } = v6;
      return (0, import_jsx_runtime.jsxs)(
        "div",
        {
          className: "univer-my-1.5 univer-flex univer-h-5 univer-items-center univer-justify-between univer-leading-5",
          children: [
            (0, import_jsx_runtime.jsx)("div", { children: S }),
            (0, import_jsx_runtime.jsx)(
              ZE,
              {
                defaultChecked: w6,
                onChange: () => {
                  g9(__spreadProps(__spreadValues({}, m9), {
                    [p3]: __spreadProps(__spreadValues({}, v6), {
                      allowed: !w6
                    })
                  }));
                }
              }
            )
          ]
        },
        S
      );
    }),
    (0, import_jsx_runtime.jsxs)(
      "div",
      {
        className: ie2("univer-flex univer-h-9 univer-items-center univer-justify-end univer-gap-2 univer-pt-2", dE2),
        children: [
          (0, import_jsx_runtime.jsx)(
            fr,
            {
              onClick: () => {
                i.close(ll2);
              },
              children: n3.t("permission.button.cancel")
            }
          ),
          (0, import_jsx_runtime.jsx)(
            fr,
            {
              variant: "primary",
              onClick: () => {
                f4(), i.close(ll2);
              },
              children: n3.t("permission.button.confirm")
            }
          )
        ]
      }
    )
  ] }) });
};
var YI = () => {
  var d2;
  const [n3, e] = (0, import_react.useState)(""), t3 = useDependency(Hn), r = useDependency(ct2), i = useDependency(Dr4), o3 = useObservable(i.userList$, i.userList), s2 = (d2 = o3 == null ? void 0 : o3.filter((u2) => {
    var h9;
    return ((h9 = u2.subject) == null ? void 0 : h9.name.toLocaleLowerCase().includes(n3.toLocaleLowerCase())) && u2.role === Lt3.Editor;
  })) != null ? d2 : [], [l4, a4] = (0, import_react.useState)(i.selectUserList), c2 = (u2) => {
    if ((l4 == null ? void 0 : l4.findIndex((m9) => {
      var g9, f4;
      return ((g9 = m9.subject) == null ? void 0 : g9.userID) === ((f4 = u2.subject) == null ? void 0 : f4.userID);
    })) === -1) {
      const m9 = __spreadValues({}, u2);
      a4([...l4, m9]);
    } else {
      const m9 = l4.filter((g9) => {
        var f4, p3;
        return ((f4 = g9.subject) == null ? void 0 : f4.userID) !== ((p3 = u2.subject) == null ? void 0 : p3.userID);
      });
      a4(m9);
    }
  };
  return (0, import_jsx_runtime.jsxs)("div", { children: [
    (0, import_jsx_runtime.jsx)("div", { children: (0, import_jsx_runtime.jsx)(
      eC,
      {
        className: "univer-w-full",
        placeholder: t3.t("permission.dialog.search"),
        value: n3,
        onChange: (u2) => e(u2)
      }
    ) }),
    (0, import_jsx_runtime.jsx)("div", { className: ie2("univer-h-60 univer-overflow-y-auto", vr2), children: (s2 == null ? void 0 : s2.length) > 0 ? s2 == null ? void 0 : s2.map((u2) => {
      var h9, m9, g9;
      return (0, import_jsx_runtime.jsxs)(
        "div",
        {
          className: "univer-my-2 univer-flex univer-items-center univer-rounded-md hover:univer-bg-gray-50",
          onClick: () => c2(u2),
          children: [
            (0, import_jsx_runtime.jsx)(sE, { src: (h9 = u2.subject) == null ? void 0 : h9.avatar, size: 24 }),
            (0, import_jsx_runtime.jsx)("div", { className: "univer-ml-1.5 univer-flex-1", children: (m9 = u2.subject) == null ? void 0 : m9.name }),
            (l4 == null ? void 0 : l4.findIndex((f4) => {
              var p3, v6;
              return ((p3 = f4.subject) == null ? void 0 : p3.userID) === ((v6 = u2.subject) == null ? void 0 : v6.userID);
            })) !== -1 && (0, import_jsx_runtime.jsx)("div", { children: (0, import_jsx_runtime.jsx)(Br3, {}) })
          ]
        },
        (g9 = u2.subject) == null ? void 0 : g9.userID
      );
    }) : (0, import_jsx_runtime.jsxs)("div", { className: "univer-flex univer-h-full univer-flex-col univer-items-center", children: [
      (0, import_jsx_runtime.jsx)(
        "img",
        {
          className: "univer-w-full",
          src: Vp,
          alt: "empty list",
          draggable: false
        }
      ),
      (0, import_jsx_runtime.jsx)("p", { className: "univer-text-sm univer-text-gray-400", children: t3.t("permission.dialog.userEmpty") })
    ] }) }),
    (0, import_jsx_runtime.jsx)("div", { className: "univer-h-px univer-w-full univer-bg-gray-200" }),
    (0, import_jsx_runtime.jsxs)("div", { className: "univer-flex univer-items-center univer-justify-end univer-gap-1 univer-py-2", children: [
      (0, import_jsx_runtime.jsx)(
        fr,
        {
          onClick: () => r.close(sl2),
          children: t3.t("permission.button.cancel")
        }
      ),
      (0, import_jsx_runtime.jsx)(
        fr,
        {
          variant: "primary",
          onClick: () => {
            i.setSelectUserList(l4), r.close(sl2);
          },
          children: t3.t("permission.button.confirm")
        }
      )
    ] })
  ] });
};
var ZI = ({ errorMsg: n3 }) => {
  const e = useDependency(Hn);
  return (0, import_jsx_runtime.jsx)("div", { children: (0, import_jsx_runtime.jsx)("p", { className: "univer-m-0", children: n3 || e.t("permission.dialog.alertContent") }) });
};
var Np2 = "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNCIgaGVpZ2h0PSI0IiB2aWV3Qm94PSIwIDAgNCA0IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8bWFzayBpZD0ibWFzazBfNzU5XzExMDgiIHN0eWxlPSJtYXNrLXR5cGU6YWxwaGEiIG1hc2tVbml0cz0idXNlclNwYWNlT25Vc2UiIHg9IjAiIHk9IjAiIHdpZHRoPSI0IiBoZWlnaHQ9IjQiPgo8cmVjdCB3aWR0aD0iNCIgaGVpZ2h0PSI0IiBmaWxsPSIjRDZEOEQ5Ii8+CjwvbWFzaz4KPGcgbWFzaz0idXJsKCNtYXNrMF83NTlfMTEwOCkiPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTS0zLjY0MDAyIDMuNDQxNDFMMi4wNzM5NyAtMi4yNzI1OEwyLjc4MTA4IC0xLjU2NTQ4TC0yLjkzMjkxIDQuMTQ4NTJMLTMuNjQwMDIgMy40NDE0MVoiIGZpbGw9IiNENkQ4REIiLz4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0tMS41MTg2OCA1LjU2Mjc1TDQuMTk1MzEgLTAuMTUxMjQ1TDQuOTAyNDIgMC41NTU4NjJMLTAuODExNTc1IDYuMjY5ODZMLTEuNTE4NjggNS41NjI3NVoiIGZpbGw9IiNENkQ4REIiLz4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0wLjYwMjY1NiA3LjY4NDAzTDYuMzE2NjUgMS45NzAwM0w3LjAyMzc2IDIuNjc3MTRMMS4zMDk3NiA4LjM5MTEzTDAuNjAyNjU2IDcuNjg0MDNaIiBmaWxsPSIjRDZEOERCIi8+CjwvZz4KPC9zdmc+";
var bu2 = "RANGE_PROTECTION_CAN_VIEW_RENDER_EXTENSION_KEY";
var _u2 = "RANGE_PROTECTION_CAN_NOT_VIEW_RENDER_EXTENSION_KEY";
var GI = 25;
var qI = 80;
var kp = class extends C3 {
  constructor(t3) {
    super();
    _2(this, "_pattern", null);
    _2(this, "_img", new Image());
    _2(this, "renderCache", /* @__PURE__ */ new Set());
    _2(this, "_shadowStrategy", "always");
    this._img.src = Np2, t3 && (this._shadowStrategy = t3);
  }
  clearCache() {
    this.renderCache.clear();
  }
  /**
   * Set the shadow strategy for this extension
   * @param strategy The shadow strategy
   */
  setShadowStrategy(t3) {
    this._shadowStrategy = t3, this.clearCache();
  }
  /**
   * Get the current shadow strategy
   */
  getShadowStrategy() {
    return this._shadowStrategy;
  }
  draw(t3, r, i) {
    const { worksheet: o3 } = i;
    o3 && (t3.save(), this._pattern || (this._pattern = t3.createPattern(this._img, "repeat")), this.renderCache.clear(), vr.foreach(i.rowColumnSegment, (s2, l4) => {
      if (!o3.getRowVisible(s2) || !o3.getColVisible(l4))
        return;
      const { selectionProtection: a4 = [] } = o3.getCell(s2, l4) || {};
      this._pattern && (t3.fillStyle = this._pattern, a4.forEach((c2) => {
        if (c2.ruleId && this.shouldRender(c2)) {
          if (this.renderCache.has(c2.ruleId))
            return;
          this.renderCache.add(c2.ruleId), c2.ranges.forEach((d2) => {
            const u2 = i.getCellWithCoordByIndex(d2.startRow, d2.startColumn, false), h9 = i.getCellWithCoordByIndex(d2.endRow, d2.endColumn, false);
            t3.fillRect(u2.startX, u2.startY, h9.endX - u2.startX, h9.endY - u2.startY);
          });
        }
      }));
    }), t3.restore());
  }
};
var QI = class extends kp {
  constructor(t3) {
    super(t3);
    _2(this, "uKey", bu2);
    _2(this, "Z_INDEX", GI);
  }
  shouldRender(t3) {
    return this._shadowStrategy === "none" ? false : this._shadowStrategy === "non-editable" ? (t3 == null ? void 0 : t3[ce3.View]) !== false && (t3 == null ? void 0 : t3[ce3.Edit]) === false : this._shadowStrategy === "non-viewable" ? (t3 == null ? void 0 : t3[ce3.View]) === false : (t3 == null ? void 0 : t3[ce3.View]) !== false;
  }
};
var KI = class extends kp {
  constructor(t3) {
    super(t3);
    _2(this, "uKey", _u2);
    _2(this, "Z_INDEX", qI);
  }
  shouldRender(t3) {
    return this._shadowStrategy === "none" ? false : (t3 == null ? void 0 : t3[ce3.View]) === false;
  }
};
var Ru2 = "worksheet-protection";
var Gh2 = 25;
var JI = 80;
var $I = class extends C3 {
  constructor(t3) {
    super();
    _2(this, "uKey", Ru2);
    _2(this, "Z_INDEX", Gh2);
    _2(this, "_pattern");
    _2(this, "_img", new Image());
    _2(this, "_shadowStrategy", "always");
    this._img.src = Np2, t3 && (this._shadowStrategy = t3);
  }
  draw(t3, r, i) {
    const { worksheet: o3 } = i;
    if (!o3)
      return false;
    t3.save(), this._pattern || (this._pattern = t3.createPattern(this._img, "repeat"));
    const { startRow: s2, startColumn: l4, endRow: a4, endColumn: c2 } = i.rowColumnSegment, d2 = i.getCellWithCoordByIndex(s2, l4, false), u2 = i.getCellWithCoordByIndex(a4, c2, false), { hasWorksheetRule: h9 = false, selectionProtection: m9 = [] } = o3.getCell(s2, l4) || {};
    if (!this._pattern)
      return;
    if (m9.length > 0) {
      const f4 = m9[0];
      (f4 == null ? void 0 : f4[ce3.View]) ? this.setZIndex(Gh2) : this.setZIndex(JI);
    }
    t3.fillStyle = this._pattern;
    let g9 = h9;
    if (this._shadowStrategy === "none")
      g9 = false;
    else if (h9 && m9.length > 0) {
      const f4 = m9[0];
      this._shadowStrategy === "non-editable" ? g9 = (f4 == null ? void 0 : f4[ce3.Edit]) === false : this._shadowStrategy === "non-viewable" && (g9 = (f4 == null ? void 0 : f4[ce3.View]) === false);
    }
    g9 && t3.fillRect(d2.startX, d2.startY, u2.endX - d2.startX, u2.endY - d2.startY), t3.restore();
  }
  /**
   * Set the shadow strategy for this extension
   * @param strategy The shadow strategy
   */
  setShadowStrategy(t3) {
    this._shadowStrategy = t3;
  }
  /**
   * Get the current shadow strategy
   */
  getShadowStrategy() {
    return this._shadowStrategy;
  }
  setZIndex(t3) {
    this.Z_INDEX = t3;
  }
};
var ey = Object.getOwnPropertyDescriptor;
var Iu2 = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? ey(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var ln2 = (n3, e) => (t3, r) => e(t3, r, n3);
var Di2 = class extends Ve {
  constructor(n3, e) {
    super(), this._injector = n3, this._componentManager = e, this._init();
  }
  _init() {
    this._initComponents(), this._initUiPartComponents();
  }
  _initComponents() {
    [
      [Fm, sf2],
      [lw, Aa3],
      [aw, gu2],
      [cw, Br3],
      [Um, hu2],
      [Po4, XI],
      [Wm, YI],
      [Bm2, jI],
      [Uf, ZI]
    ].forEach(([n3, e]) => {
      this.disposeWithMe(this._componentManager.register(
        n3,
        e
      ));
    });
  }
  _initUiPartComponents() {
    const e = this._injector.get(xs).getConfig(Tt2);
    if (e != null && e.protectedRangeUserSelector) {
      const { component: t3, framework: r } = e.protectedRangeUserSelector;
      this.disposeWithMe(
        this._componentManager.register(pa5, t3, {
          framework: r
        })
      );
    }
  }
};
Di2 = Iu2([
  ln2(0, Inject(Injector)),
  ln2(1, Inject(S13))
], Di2);
var Tl2 = class extends Ve {
  constructor(e, t3, r, i, o3) {
    super();
    _2(this, "_rangeProtectionCanViewRenderExtension");
    _2(this, "_rangeProtectionCanNotViewRenderExtension");
    this._context = e, this._rangeProtectionRuleModel = t3, this._sheetSkeletonManagerService = r, this._permissionService = i, this._configService = o3;
    const s2 = this._configService.getConfig(Tt2), l4 = cu2(s2 == null ? void 0 : s2.protectedRangeShadow);
    this._rangeProtectionCanViewRenderExtension = new QI(l4), this._rangeProtectionCanNotViewRenderExtension = new KI(l4), this._initSkeleton(), this._initRender(), this.disposeWithMe(this._rangeProtectionRuleModel.ruleChange$.subscribe((a4) => {
      var c2, d2;
      ((c2 = a4.oldRule) != null && c2.id && this._rangeProtectionCanViewRenderExtension.renderCache.has(a4.oldRule.id) || this._rangeProtectionCanViewRenderExtension.renderCache.has(a4.rule.id)) && this._rangeProtectionCanViewRenderExtension.clearCache(), ((d2 = a4.oldRule) != null && d2.id && this._rangeProtectionCanNotViewRenderExtension.renderCache.has(a4.oldRule.id) || this._rangeProtectionCanNotViewRenderExtension.renderCache.has(a4.rule.id)) && this._rangeProtectionCanNotViewRenderExtension.clearCache();
    }));
  }
  _initRender() {
    const e = this._context.mainComponent;
    e && (e.getExtensionByKey(bu2) || e.register(this._rangeProtectionCanViewRenderExtension), e.getExtensionByKey(_u2) || e.register(this._rangeProtectionCanNotViewRenderExtension));
  }
  _initSkeleton() {
    const e = () => {
      var t3;
      this._sheetSkeletonManagerService.reCalculate(), (t3 = this._context.mainComponent) == null || t3.makeDirty();
    };
    this.disposeWithMe(merge(
      this._permissionService.permissionPointUpdate$.pipe(throttleTime(300, void 0, { trailing: true })),
      this._rangeProtectionRuleModel.rangeRuleInitStateChange$,
      this._rangeProtectionRuleModel.ruleChange$
    ).pipe().subscribe(e));
  }
};
Tl2 = Iu2([
  ln2(1, Inject(me)),
  ln2(2, Inject(he2)),
  ln2(3, aC),
  ln2(4, xs)
], Tl2);
var Pl2 = class extends Ve {
  constructor(e, t3, r, i, o3) {
    super();
    _2(this, "_worksheetProtectionRenderExtension");
    this._context = e, this._renderManagerService = t3, this._sheetSkeletonManagerService = r, this._worksheetProtectionRuleModel = i, this._configService = o3;
    const s2 = this._configService.getConfig(Tt2), l4 = cu2(s2 == null ? void 0 : s2.protectedRangeShadow);
    this._worksheetProtectionRenderExtension = new $I(l4), this._initSkeleton(), l4 !== "none" && this._initRender();
  }
  _initRender() {
    const e = this._context.unitId, t3 = e && this._renderManagerService.getRenderById(e), r = t3 && t3.mainComponent;
    r && (r.getExtensionByKey(Ru2) || r.register(this._worksheetProtectionRenderExtension));
  }
  _initSkeleton() {
    const e = () => {
      var t3;
      this._sheetSkeletonManagerService.reCalculate(), (t3 = this._context.mainComponent) == null || t3.makeDirty();
    };
    this.disposeWithMe(merge(
      this._worksheetProtectionRuleModel.worksheetRuleInitStateChange$
    ).pipe().subscribe(e));
  }
};
Pl2 = Iu2([
  ln2(1, Inject(JE)),
  ln2(2, Inject(he2)),
  ln2(3, Inject(lt3)),
  ln2(4, Inject(xs))
], Pl2);
var ty = Object.getOwnPropertyDescriptor;
var ny = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? ty(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var _c2 = (n3, e) => (t3, r) => e(t3, r, n3);
var xl3 = class extends Ve {
  constructor(n3, e, t3, r) {
    super(), this._context = n3, this._sheetSkeletonManagerService = e, this._sheetClipboardService = t3, this._sheetClipboardController = r, this._initialize();
  }
  _initialize() {
    this.disposeWithMe(
      Be(this._sheetSkeletonManagerService.currentSkeleton$.subscribe((n3) => {
        if (!(n3 != null && n3.unitId) || !this._sheetClipboardService.getPasteMenuVisible())
          return;
        const e = this._sheetClipboardService.getPasteOptionsCache(), t3 = e == null ? void 0 : e.target.unitId;
        n3.unitId === t3 && this._sheetClipboardController.refreshOptionalPaste();
      }))
    );
  }
};
xl3 = ny([
  _c2(1, Inject(he2)),
  _c2(2, tn3),
  _c2(3, Inject(Pr4))
], xl3);
var ry = Object.getOwnPropertyDescriptor;
var iy = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? ry(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var Rc2 = (n3, e) => (t3, r) => e(t3, r, n3);
var Ol2 = class extends Ve {
  constructor(n3, e, t3, r) {
    super(), this._context = n3, this._formatPainterService = e, this._selectionRenderService = t3, this._commandService = r, this._initialize();
  }
  _initialize() {
    this._bindFormatPainterStatus(), this._commandExecutedListener();
  }
  _commandExecutedListener() {
    this.disposeWithMe(
      this._selectionRenderService.selectionMoveEnd$.subscribe((n3) => {
        var e;
        if (this._formatPainterService.getStatus() !== zt2.OFF) {
          const { rangeWithCoord: t3 } = n3[n3.length - 1];
          this._commandService.executeCommand(Ra3.id, {
            unitId: this._context.unitId,
            subUnitId: ((e = this._context.unit.getActiveSheet()) == null ? void 0 : e.getSheetId()) || "",
            range: {
              startRow: t3.startRow,
              startColumn: t3.startColumn,
              endRow: t3.endRow,
              endColumn: t3.endColumn
            }
          }), this._formatPainterService.getStatus() === zt2.ONCE && this._commandService.executeCommand(ss2.id);
        }
      })
    );
  }
  _bindFormatPainterStatus() {
    this.disposeWithMe(
      Be(this._formatPainterService.status$.subscribe((n3) => {
        const e = this._context.scene;
        e && (n3 !== zt2.OFF ? e.setDefaultCursor(v1.CELL) : e.setDefaultCursor(v1.DEFAULT));
      }))
    );
  }
};
Ol2 = iy([
  Rc2(1, Nn),
  Rc2(2, gt),
  Rc2(3, Ds)
], Ol2);
var rd3 = ((n3) => (n3[n3.NORMAL = 0] = "NORMAL", n3[n3.HIGHLIGHT = 1] = "HIGHLIGHT", n3))(rd3 || {});
var oy = "rgba(0, 0, 0, 0.15)";
var _n3 = "rgb(0, 0, 0)";
var Es2 = "rgb(255, 255, 255, 1)";
var sy = class extends x3 {
  constructor(t3, r) {
    super(t3, r);
    _2(this, "_size", 12);
    _2(this, "_iconRatio", 0.4);
    _2(this, "_mode", 0);
    this.setShapeProps(r);
  }
  setShapeProps(t3) {
    t3 != null && t3.size && (this._size = t3.size), t3 != null && t3.mode && (this._mode = t3.mode), this.transformByState({
      width: this._size,
      height: this._size
    });
  }
  _draw(t3) {
    this._mode === 1 && I1.drawWith(t3, {
      width: this._size,
      height: this._size,
      radius: this._size,
      fill: oy
    });
    const r = this._size * 0.5 * this._iconRatio, i = Math.PI / 180 * 60, o3 = r * Math.sin(i), s2 = r * Math.cos(i);
    O3.drawWith(t3, {
      pointsGroup: [
        [
          { x: -o3 + this._size / 2, y: -s2 + this._size / 2 },
          { x: o3 + this._size / 2, y: -s2 + this._size / 2 },
          { x: this._size / 2, y: r + this._size / 2 }
        ]
      ],
      // left: this.left,
      // top: this.top,
      fill: _n3
    });
  }
};
var ly = Object.getOwnPropertyDescriptor;
var ay = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? ly(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var Ts4 = (n3, e) => (t3, r) => e(t3, r, n3);
var cy = "__SpreadsheetHeaderMenuSHAPEControllerShape__";
var dy = "__SpreadsheetHeaderMenuMAINControllerShape__";
var uy = "rgba(0, 0, 0, 0.1)";
var Al2 = class extends Ve {
  constructor(e, t3, r, i, o3) {
    super();
    _2(this, "_hoverRect");
    _2(this, "_hoverMenu");
    _2(this, "_currentColumn", Number.POSITIVE_INFINITY);
    _2(this, "_headerPointerSubs");
    _2(this, "_colHeaderPointerSubs");
    this._context = e, this._sheetSkeletonManagerService = t3, this._contextMenuService = r, this._commandService = i, this._selectionManagerService = o3, this._initialize();
  }
  dispose() {
    var e, t3, r;
    (e = this._hoverRect) == null || e.dispose(), (t3 = this._hoverMenu) == null || t3.dispose(), (r = this._headerPointerSubs) == null || r.unsubscribe(), this._headerPointerSubs = null;
  }
  _initialize() {
    const e = this._context.scene;
    this._hoverRect = new I1(cy, {
      fill: uy,
      evented: false
    }), this._hoverMenu = new sy(dy, { zIndex: 100, visible: false }), e.addObjects([this._hoverRect, this._hoverMenu], nr5), this._initialHover(
      0
      /* ROW */
    ), this._initialHover(
      1
      /* COLUMN */
    ), this._initialHoverMenu();
  }
  // eslint-disable-next-line max-lines-per-function
  _initialHover(e = 0) {
    var u2, h9, m9;
    const t3 = this._context.components.get(Ge5.COLUMN), r = this._context.components.get(Ge5.ROW), i = e === 0 ? r : t3, o3 = (g9) => {
      var y6, E3, M10;
      const f4 = (y6 = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : y6.skeleton;
      if (f4 == null)
        return;
      const { rowHeaderWidth: p3, columnHeaderHeight: v6 } = f4, { startX: S, startY: w6, endX: C, endY: I6, column: R9 } = An4(
        g9.offsetX,
        g9.offsetY,
        this._context.scene,
        f4
      );
      if (e === 0)
        (E3 = this._hoverRect) == null || E3.transformByState({
          width: p3,
          height: I6 - w6,
          left: 0,
          top: w6
        });
      else {
        if (this._currentColumn = R9, (M10 = this._hoverRect) == null || M10.transformByState({
          width: C - S,
          height: v6,
          left: S,
          top: 0
        }), this._hoverMenu == null)
          return;
        if (C - S < v6 * 2) {
          this._hoverMenu.hide();
          return;
        }
        const T10 = v6 * 0.8;
        this._hoverMenu.transformByState({
          left: C - v6,
          top: v6 / 2 - T10 / 2
        }), this._hoverMenu.setShapeProps({ size: T10 }), this._hoverMenu.show();
      }
    }, s2 = () => {
      var g9;
      (g9 = this._hoverRect) == null || g9.show();
    }, l4 = () => {
      var g9, f4;
      (g9 = this._hoverRect) == null || g9.hide(), (f4 = this._hoverMenu) == null || f4.hide();
    };
    this._headerPointerSubs = new Subscription();
    const a4 = i.onPointerMove$.subscribeEvent(o3), c2 = i.onPointerEnter$.subscribeEvent(s2), d2 = i.onPointerLeave$.subscribeEvent(l4);
    (u2 = this._headerPointerSubs) == null || u2.add(a4), (h9 = this._headerPointerSubs) == null || h9.add(c2), (m9 = this._headerPointerSubs) == null || m9.add(d2);
  }
  _initialHoverMenu() {
    this._hoverMenu != null && (this._hoverMenu.onPointerEnter$.subscribeEvent(() => {
      this._hoverMenu != null && (this._hoverMenu.setProps({
        mode: rd3.HIGHLIGHT,
        visible: true
      }), this._context.scene.setCursor(v1.POINTER));
    }), this._hoverMenu.onPointerLeave$.subscribeEvent(() => {
      this._hoverMenu != null && (this._hoverMenu.setProps({
        mode: rd3.NORMAL,
        visible: false
      }), this._context.scene.resetCursor());
    }), this._hoverMenu.onPointerDown$.subscribeEvent((e) => {
      var o3;
      const t3 = this._currentColumn, r = (o3 = this._selectionManagerService.getCurrentSelections()) == null ? void 0 : o3.map((s2) => s2.range);
      if (!!!(r != null && r.filter((s2) => s2.rangeType === ge.COLUMN).find((s2) => {
        const { startColumn: l4, endColumn: a4 } = s2;
        return t3 >= l4 && t3 <= a4;
      }))) {
        const s2 = this._getSelectionOnColumn(t3);
        this._commandService.syncExecuteCommand(ie5.id, s2);
      }
      e.stopPropagation(), e.preventDefault(), this._contextMenuService.triggerContextMenu(e, W1.COL_HEADER);
    }));
  }
  _getSelectionOnColumn(e) {
    const t3 = this._context.unit, r = t3.getActiveSheet();
    if (!r)
      throw new Error("No active worksheet");
    return {
      unitId: t3.getUnitId(),
      subUnitId: r.getSheetId(),
      selections: [
        {
          range: {
            startRow: 0,
            startColumn: e,
            endRow: r.getRowCount() - 1,
            endColumn: e,
            rangeType: ge.COLUMN
          },
          primary: {
            startRow: 0,
            startColumn: e,
            endRow: 0,
            endColumn: e,
            actualRow: 0,
            actualColumn: e,
            isMerged: false,
            isMergedMainCell: false
          },
          style: null
        }
      ]
    };
  }
};
Al2 = ay([
  Ts4(1, Inject(he2)),
  Ts4(2, l3),
  Ts4(3, Ds),
  Ts4(4, Inject(z))
], Al2);
var id3 = ((n3) => (n3[n3.ROW = 0] = "ROW", n3[n3.COLUMN = 1] = "COLUMN", n3))(id3 || {});
var ho3 = 12;
var hy = 0.4;
var qh2 = class extends x3 {
  constructor(t3, r, i) {
    super(t3, r);
    _2(this, "_size", ho3);
    _2(this, "_iconRatio", hy);
    _2(this, "_hovered", true);
    _2(this, "_hasPrevious", true);
    _2(this, "_hasNext", true);
    _2(this, "_unhideType");
    r && this.setShapeProps(r), this.onPointerEnter$.subscribeEvent(() => this.setShapeProps({ hovered: true })), this.onPointerLeave$.subscribeEvent(() => this.setShapeProps({ hovered: false })), this.onPointerDown$.subscribeEvent(() => i == null ? void 0 : i());
  }
  setShapeProps(t3) {
    t3.type !== void 0 && (this._unhideType = t3.type), t3.hovered !== void 0 && (this._hovered = t3.hovered), t3.hasPrevious !== void 0 && (this._hasPrevious = t3.hasPrevious), t3.hasNext !== void 0 && (this._hasNext = t3.hasNext), this.transformByState({
      width: this._size * (this._unhideType === 1 ? 2 : 1),
      height: this._size * (this._unhideType === 0 ? 2 : 1)
    });
  }
  _draw(t3) {
    this._unhideType === 0 ? this._drawOnRow(t3) : this._drawOnCol(t3);
  }
  _drawOnRow(t3) {
    this._hovered && (!this._hasNext || !this._hasPrevious ? I1.drawWith(t3, {
      width: this._size,
      height: this._size,
      stroke: _n3,
      fill: Es2
    }) : I1.drawWith(t3, {
      width: this._size,
      height: 2 * this._size,
      stroke: _n3,
      fill: Es2
    }));
    const r = this._size * 0.5 * this._iconRatio, i = Math.PI / 3, o3 = r * Math.cos(i), s2 = r * Math.sin(i);
    if (this._hasPrevious && O3.drawWith(t3, {
      pointsGroup: [
        [
          { x: this._size / 2, y: this._size / 2 - s2 },
          { x: this._size / 2 - s2, y: this._size / 2 + o3 },
          { x: this._size / 2 + s2, y: this._size / 2 + o3 }
        ]
      ],
      fill: _n3
    }), this._hasNext) {
      const l4 = this._hasPrevious ? 3 : 1;
      O3.drawWith(t3, {
        pointsGroup: [
          [
            { x: this._size / 2, y: this._size * l4 / 2 + s2 },
            { x: this._size / 2 - s2, y: this._size * l4 / 2 - o3 },
            { x: this._size / 2 + s2, y: this._size * l4 / 2 - o3 }
          ]
        ],
        fill: _n3
      });
    }
  }
  /**
   *
   * @param ctx
   */
  _drawOnCol(t3) {
    this._hovered && (!this._hasNext || !this._hasPrevious ? I1.drawWith(t3, {
      width: this._size,
      height: this._size,
      stroke: _n3,
      fill: Es2
    }) : I1.drawWith(t3, {
      width: 2 * this._size,
      height: this._size,
      stroke: _n3,
      fill: Es2
    }));
    const r = this._size * 0.5 * this._iconRatio, i = Math.PI / 3, o3 = r * Math.cos(i), s2 = r * Math.sin(i);
    if (this._hasPrevious && O3.drawWith(t3, {
      pointsGroup: [
        [
          { x: -o3 + this._size / 2, y: this._size / 2 },
          { x: this._size / 2 + s2, y: this._size / 2 - s2 },
          { x: this._size / 2 + s2, y: this._size / 2 + s2 }
        ]
      ],
      fill: _n3
    }), this._hasNext) {
      const l4 = this._hasPrevious ? 3 : 1;
      O3.drawWith(t3, {
        pointsGroup: [
          [
            { x: o3 + this._size * l4 / 2, y: this._size / 2 },
            { x: -s2 + this._size * l4 / 2, y: this._size / 2 - s2 },
            { x: -s2 + this._size * l4 / 2, y: this._size / 2 + s2 }
          ]
        ],
        fill: _n3
      });
    }
  }
};
var gy = Object.getOwnPropertyDescriptor;
var my = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? gy(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var Qh2 = (n3, e) => (t3, r) => e(t3, r, n3);
var Kh2 = "__SpreadsheetHeaderUnhideSHAPEControllerShape__";
var Hl3 = class extends ER {
  constructor(e, t3, r) {
    super();
    _2(this, "_shapes", { cols: [], rows: [] });
    this._context = e, this._sheetSkeletonManagerService = t3, this._commandService = r, this._init();
  }
  get _workbook() {
    return this._context.unit;
  }
  dispose() {
    super.dispose(), this._clearShapes();
  }
  _init() {
    let e = "";
    this._context.unit.activeSheet$.pipe(takeUntil(this.dispose$)).subscribe((t3) => {
      if (this._clearShapes(), !t3) {
        e = "";
        return;
      }
      e = t3.getSheetId(), this._update(this._workbook, t3);
    }), this.disposeWithMe(
      this._sheetSkeletonManagerService.currentSkeleton$.subscribe((t3) => {
        if (t3) {
          const { unitId: r, sheetId: i } = t3;
          if (r === this._workbook.getUnitId() && i === e) {
            const o3 = this._workbook.getSheetBySheetId(i);
            o3 && this._update(this._workbook, o3);
          }
        }
      })
    );
  }
  _update(e, t3) {
    var h9;
    const r = (h9 = this._sheetSkeletonManagerService.getSkeletonParam(t3.getSheetId())) == null ? void 0 : h9.skeleton;
    if (!r) return;
    const i = t3.getHiddenRows(), o3 = t3.getHiddenCols(), s2 = this._getSheetObject(), { scene: l4 } = s2, a4 = t3.getRowCount(), c2 = i.map((m9) => {
      const { startRow: g9, endRow: f4 } = m9, p3 = ph2(g9, 0, l4, r), v6 = g9 !== 0, S = f4 !== a4 - 1;
      return new qh2(
        Kh2,
        {
          type: id3.ROW,
          hovered: false,
          hasPrevious: v6,
          hasNext: S,
          top: p3.startY - (v6 ? ho3 : 0),
          left: p3.startX - ho3
        },
        () => this._commandService.executeCommand(
          hn.id,
          {
            unitId: e.getUnitId(),
            subUnitId: t3.getSheetId(),
            ranges: [m9]
          }
        )
      );
    }), d2 = t3.getColumnCount(), u2 = o3.map((m9) => {
      const { startColumn: g9, endColumn: f4 } = m9, p3 = ph2(0, g9, l4, r), v6 = g9 !== 0, S = f4 !== d2 - 1;
      return new qh2(
        Kh2,
        {
          type: id3.COLUMN,
          hovered: false,
          hasPrevious: v6,
          hasNext: S,
          top: 20 - ho3,
          left: p3.startX - (v6 ? ho3 : 0)
        },
        () => this._commandService.executeCommand(
          dn.id,
          {
            unitId: e.getUnitId(),
            subUnitId: t3.getSheetId(),
            ranges: [m9]
          }
        )
      );
    });
    l4.addObjects(u2, Gu2), l4.addObjects(c2, Gu2), this._clearShapes(), this._shapes = { cols: u2, rows: c2 };
  }
  _clearShapes() {
    this._shapes.cols.forEach((e) => e.dispose()), this._shapes.rows.forEach((e) => e.dispose()), this._shapes = { cols: [], rows: [] };
  }
  _getSheetObject() {
    return $t4(this._workbook, this._context);
  }
};
Hl3 = my([
  Qh2(1, Inject(he2)),
  Qh2(2, Ds)
], Hl3);
var fy = Object.getOwnPropertyDescriptor;
var py = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? fy(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var qr4 = (n3, e) => (t3, r) => e(t3, r, n3);
var vy = [Ut3.id, Dn3.id];
var od3 = class extends Ve {
  constructor(n3, e, t3, r, i, o3, s2) {
    super(), this._context = n3, this._sheetSkeletonManagerService = e, this._commandService = t3, this._renderManagerService = r, this._selectionManagerService = i, this._scrollManagerService = o3, this._univerInstanceService = s2, this._init();
  }
  scrollToRange(n3) {
    let { endRow: e, endColumn: t3, startColumn: r, startRow: i } = n3;
    const o3 = this._getViewportBounding();
    if (n3.rangeType === ge.ROW ? (r = 0, t3 = 0) : n3.rangeType === ge.COLUMN && (i = 0, e = 0), o3) {
      const s2 = o3.startRow > e ? i : e, l4 = o3.startColumn > t3 ? r : t3;
      return this._scrollToCell(s2, l4);
    } else
      return this._scrollToCell(i, r);
  }
  _init() {
    this._initCommandListener(), this._initScrollEventListener(), this._initPointerScrollEvent(), this._initSkeletonListener();
  }
  _initCommandListener() {
    this.disposeWithMe(
      this._commandService.onCommandExecuted((n3) => {
        if (vy.includes(n3.id))
          this._scrollToSelection();
        else if (n3.id === yd.id) {
          const e = n3.params.range;
          this.scrollToRange(e);
        } else if (n3.id === Gt3.id) {
          const e = n3.params;
          this._scrollToSelectionForExpand(e);
        }
      })
    );
  }
  _scrollToSelectionForExpand(n3) {
    setTimeout(() => {
      const e = this._selectionManagerService.getCurrentLastSelection();
      if (e == null)
        return;
      const { startRow: t3, startColumn: r, endRow: i, endColumn: o3 } = e.range, s2 = this._getViewportBounding();
      if (s2 == null)
        return;
      const { startRow: l4, startColumn: a4, endRow: c2, endColumn: d2 } = s2;
      let u2 = 0, h9 = 0;
      t3 > l4 ? u2 = i : i < c2 ? u2 = t3 : u2 = l4, r > a4 ? h9 = o3 : o3 < d2 ? h9 = r : h9 = a4, n3.direction === wm.DOWN ? u2 = i : n3.direction === wm.UP ? u2 = t3 : n3.direction === wm.RIGHT ? h9 = o3 : n3.direction === wm.LEFT && (h9 = r), this._scrollToCell(u2, h9);
    }, 0);
  }
  _getFreeze() {
    var e;
    const n3 = (e = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : e.skeleton.getWorksheetConfig();
    if (n3 != null)
      return n3.freeze;
  }
  // eslint-disable-next-line max-lines-per-function
  _initScrollEventListener() {
    const { scene: n3 } = this._context;
    if (n3 == null) return;
    const e = n3.getViewport(k2.VIEW_MAIN);
    e && (this.disposeWithMe(
      Be(
        // wheel event --> set-scroll.command('sheet.operation.set-scroll') --> scroll.operation.ts -->
        // scrollManagerService.setScrollInfoAndEmitEvent --->  scrollManagerService.setScrollInfo(raw value, may be negative) &&
        // _notifyCurrentScrollInfo
        this._scrollManagerService.rawScrollInfo$.subscribe((t3) => {
          var h9;
          if (t3 == null) {
            e.scrollToViewportPos({
              viewportScrollX: 0,
              viewportScrollY: 0
            });
            return;
          }
          const r = (h9 = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : h9.skeleton;
          if (!r) return;
          const { sheetViewStartRow: i, sheetViewStartColumn: o3, offsetX: s2, offsetY: l4 } = t3, { startX: a4, startY: c2 } = r.getCellWithCoordByIndex(
            i,
            o3,
            false
          ), d2 = a4 + s2, u2 = c2 + l4;
          e.scrollToViewportPos({ viewportScrollX: d2, viewportScrollY: u2 });
        })
      )
    ), this.disposeWithMe(
      e.onScrollAfter$.subscribeEvent((t3) => {
        var g9;
        if (!t3) return;
        const r = (g9 = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : g9.skeleton;
        if (r == null) return;
        const i = this._getSheetObject();
        if (r == null || i == null) return;
        const { viewportScrollX: o3, viewportScrollY: s2, scrollX: l4, scrollY: a4 } = t3, { row: c2, column: d2, rowOffset: u2, columnOffset: h9 } = r.getOffsetRelativeToRowCol(
          o3,
          s2
        ), m9 = {
          sheetViewStartRow: c2,
          sheetViewStartColumn: d2,
          offsetX: h9,
          offsetY: u2,
          viewportScrollX: o3,
          viewportScrollY: s2,
          scrollX: l4,
          scrollY: a4
        };
        this._scrollManagerService.setValidScrollStateToCurrSheet(m9), this._scrollManagerService.validViewportScrollInfo$.next(__spreadProps(__spreadValues({}, m9), {
          scrollX: l4,
          scrollY: a4,
          viewportScrollX: o3,
          viewportScrollY: s2
        }));
      })
    ), this.disposeWithMe(
      e.onScrollByBar$.subscribeEvent((t3) => {
        var h9;
        const r = (h9 = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : h9.skeleton;
        if (r == null || t3.isTrigger === false)
          return;
        const i = this._getSheetObject();
        if (r == null || i == null)
          return;
        const { viewportScrollX: o3 = 0, viewportScrollY: s2 = 0 } = t3, l4 = this._getFreeze(), { row: a4, column: c2, rowOffset: d2, columnOffset: u2 } = r.getOffsetRelativeToRowCol(
          o3,
          s2
        );
        this._commandService.executeCommand(hn2.id, {
          sheetViewStartRow: a4 + ((l4 == null ? void 0 : l4.ySplit) || 0),
          sheetViewStartColumn: c2 + ((l4 == null ? void 0 : l4.xSplit) || 0),
          offsetX: u2,
          offsetY: d2
        });
      })
    ));
  }
  _initSkeletonListener() {
    this.disposeWithMe(Be(
      this._sheetSkeletonManagerService.currentSkeletonBefore$.subscribe((n3) => {
        if (n3 == null)
          return;
        const e = { unitId: n3.unitId, sheetId: n3.sheetId };
        this._scrollManagerService.setSearchParam(e);
        const t3 = this._getSheetObject();
        if (!t3) return;
        const i = t3.scene.getViewport(k2.VIEW_MAIN), o3 = this._scrollManagerService.getScrollStateByParam(e), { viewportScrollX: s2, viewportScrollY: l4 } = this._scrollManagerService.calcViewportScrollFromRowColOffset(o3);
        i && (o3 ? (i.viewportScrollX = s2, i.viewportScrollY = l4) : (i.viewportScrollX = 0, i.viewportScrollY = 0), this._updateSceneSize(n3));
      })
    ));
  }
  /**
   * for mobile
   */
  // eslint-disable-next-line max-lines-per-function
  _initPointerScrollEvent() {
    const n3 = this._getSheetObject();
    if (!n3) return;
    const e = this._scrollManagerService, t3 = n3.scene, r = n3.spreadsheet, i = t3.getViewport(k2.VIEW_MAIN), o3 = { x: 0, y: 0 };
    let s2 = false;
    const l4 = { x: 0, y: 0 }, a4 = 0.95;
    let c2 = null;
    const d2 = () => {
      if (!i) return;
      l4.x *= a4, l4.y *= a4, o3.x += l4.x, o3.y += l4.y;
      const h9 = l4.x, m9 = l4.y;
      (m9 !== 0 || h9 !== 0) && this._commandService.executeCommand(Ao3.id, { offsetY: m9, offsetX: h9 }), Math.abs(l4.x) > 1 || Math.abs(l4.y) > 1 ? c2 = requestAnimationFrame(d2) : c2 = null;
    }, u2 = () => {
      cancelAnimationFrame(c2), c2 = null;
    };
    r.onPointerDown$.subscribeEvent((h9, m9) => {
      u2(), i && (o3.x = h9.offsetX, o3.y = h9.offsetY, s2 = true, m9.stopPropagation());
    }), r.onPointerMove$.subscribeEvent((h9, m9) => {
      if (!s2 || !i) return;
      const g9 = h9, f4 = -(g9.offsetX - o3.x), p3 = -(g9.offsetY - o3.y);
      l4.x = -(g9.offsetX - o3.x), l4.y = -(g9.offsetY - o3.y);
      const v6 = f4, S = p3;
      (f4 !== 0 || p3 !== 0) && (S !== 0 || v6 !== 0) && this._commandService.executeCommand(Ao3.id, { offsetY: S, offsetX: v6 }), e.getCurrentScrollState(), o3.x = g9.offsetX, o3.y = g9.offsetY, m9.stopPropagation();
    }), r.onPointerUp$.subscribeEvent((h9) => {
      s2 = false, c2 = requestAnimationFrame(d2);
    }), r.onPointerLeave$.subscribeEvent(() => {
      s2 = false;
    }), r.onPointerOut$.subscribeEvent(() => {
      s2 = false;
    }), t3.onPointerOut$.subscribeEvent(() => {
      s2 = false;
    }), t3.onPointerCancel$.subscribeEvent(() => {
      s2 = false;
    });
  }
  _updateSceneSize(n3) {
    var u2;
    if (n3 == null)
      return;
    const { unitId: e } = this._context, { skeleton: t3 } = n3, r = (u2 = this._renderManagerService.getRenderById(e)) == null ? void 0 : u2.scene;
    if (t3 == null || r == null)
      return;
    const { rowTotalHeight: i, columnTotalWidth: o3, rowHeaderWidthAndMarginLeft: s2, columnHeaderHeightAndMarginTop: l4 } = t3, c2 = this._context.unit.getActiveSheet();
    if (!c2) return;
    const d2 = c2.getZoomRatio() || 1;
    r == null || r.setScaleValueOnly(d2, d2), r == null || r.transformByState({
      width: s2 + o3,
      height: l4 + i
    });
  }
  _getSheetObject() {
    return $t4(this._context.unit, this._context);
  }
  _scrollToSelectionByDirection(n3) {
    const e = this._getViewportBounding();
    if (e == null)
      return false;
    const {
      startRow: t3,
      startColumn: r,
      endRow: i,
      endColumn: o3
    } = e;
    let s2 = 0, l4 = 0;
    const { startRow: a4, startColumn: c2, endRow: d2, endColumn: u2 } = n3;
    a4 >= t3 && (s2 = d2), d2 <= i && (s2 = a4), c2 >= r && (l4 = u2), u2 <= o3 && (l4 = c2), this._scrollToCell(s2, l4);
  }
  _scrollToSelection(n3 = true) {
    const e = this._selectionManagerService.getCurrentLastSelection();
    if (e == null)
      return;
    const { startRow: t3, startColumn: r, actualRow: i, actualColumn: o3 } = e.primary, s2 = n3 ? i : t3, l4 = n3 ? o3 : r;
    this._scrollToCell(s2, l4);
  }
  _getViewportBounding() {
    var r, i;
    const n3 = (r = this._getSheetObject()) == null ? void 0 : r.scene;
    if (n3 == null)
      return;
    const e = n3.getViewport(k2.VIEW_MAIN);
    if (e == null)
      return;
    const t3 = (i = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : i.skeleton;
    if (t3 != null)
      return t3.getRangeByViewport(e.calcViewportInfo());
  }
  // eslint-disable-next-line max-lines-per-function, complexity
  _scrollToCell(n3, e) {
    var I6, R9, y6, E3;
    const { rowHeightAccumulation: t3, columnWidthAccumulation: r } = (R9 = (I6 = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : I6.skeleton) != null ? R9 : {};
    if (t3 == null || r == null) return false;
    const i = (y6 = this._getSheetObject()) == null ? void 0 : y6.scene;
    if (i == null) return false;
    const o3 = i.getViewport(k2.VIEW_MAIN);
    if (o3 == null || ((E3 = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : E3.skeleton) == null) return false;
    const l4 = this._context.unit.getActiveSheet();
    if (!l4) return false;
    const {
      startColumn: a4,
      startRow: c2,
      ySplit: d2,
      xSplit: u2
    } = l4.getFreeze(), h9 = this._getViewportBounding();
    if (h9 == null) return false;
    const {
      startRow: m9,
      startColumn: g9,
      endRow: f4,
      endColumn: p3
    } = h9;
    let v6, S;
    if (n3 >= c2 && e >= a4 - u2 && (n3 <= m9 && (v6 = n3), n3 >= f4)) {
      const M10 = t3[n3] - o3.height;
      for (let T10 = m9; T10 <= n3; T10++)
        if (t3[T10] >= M10) {
          v6 = T10 + 1;
          break;
        }
    }
    if (e >= a4 && n3 >= c2 - d2 && (e <= g9 && (S = e), e >= p3)) {
      const M10 = r[e] - o3.width;
      for (let T10 = g9; T10 <= e; T10++)
        if (r[T10] >= M10) {
          S = T10 + 1;
          break;
        }
    }
    if (v6 === void 0 && S === void 0) return false;
    const { offsetX: w6, offsetY: C } = this._scrollManagerService.getCurrentScrollState() || {};
    return this._commandService.syncExecuteCommand(hn2.id, {
      sheetViewStartRow: v6,
      sheetViewStartColumn: S,
      offsetX: S === void 0 ? w6 : 0,
      offsetY: v6 === void 0 ? C : 0
    });
  }
};
od3 = py([
  qr4(1, Inject(he2)),
  qr4(2, Ds),
  qr4(3, JE),
  qr4(4, Inject(z)),
  qr4(5, Inject(Et3)),
  qr4(6, br)
], od3);
var Sy = Object.getOwnPropertyDescriptor;
var Cy = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? Sy(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var Jh2 = (n3, e) => (t3, r) => e(t3, r, n3);
var Vl2 = class extends Ve {
  constructor(n3, e, t3) {
    super(), this._context = n3, this._sheetSkeletonManagerService = e, this._renderManagerService = t3, this.disposeWithMe(this._context.unit.sheetDisposed$.subscribe((r) => {
      this._sheetSkeletonManagerService.disposeSkeleton(r.getSheetId());
    })), this._sheetSkeletonManagerService.currentSkeleton$.subscribe((r) => {
      this._updateSceneSize(r);
    });
  }
  _updateSceneSize(n3) {
    var d2;
    if (n3 == null)
      return;
    const { unitId: e } = this._context, { skeleton: t3 } = n3, r = (d2 = this._renderManagerService.getRenderById(e)) == null ? void 0 : d2.scene;
    if (t3 == null || r == null)
      return;
    const { rowTotalHeight: i, columnTotalWidth: o3, rowHeaderWidthAndMarginLeft: s2, columnHeaderHeightAndMarginTop: l4 } = t3;
    this._context.unit.getActiveSheet() && (r == null || r.transformByState({
      width: s2 + o3,
      height: l4 + i
    }));
  }
};
Vl2 = Cy([
  Jh2(1, Inject(he2)),
  Jh2(2, JE)
], Vl2);
var wy = Object.getOwnPropertyDescriptor;
var by = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? wy(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var $h2 = (n3, e) => (t3, r) => e(t3, r, n3);
createIdentifier("sheets-ui.services.auto-height");
function _y2(n3, e) {
  const t3 = [], r = [...n3];
  let i = e;
  for (; r.length > 0; ) {
    const o3 = r.shift();
    if (!o3)
      break;
    const s2 = o3.endRow - o3.startRow + 1;
    if (s2 > i) {
      t3.push(__spreadProps(__spreadValues({}, o3), {
        startRow: o3.startRow,
        endRow: o3.startRow + i - 1
      })), r.unshift(__spreadProps(__spreadValues({}, o3), {
        startRow: o3.startRow + i
      }));
      break;
    } else
      t3.push(o3), i -= s2;
  }
  return { result: t3, lasts: r };
}
var Ry = 500;
var Nl4 = class extends Ve {
  constructor(e, t3, r) {
    super();
    _2(this, "_autoHeightTasks", []);
    _2(this, "_calculateLoopId", null);
    this._context = e, this._sheetSkeletonManagerService = t3, this._commandService = r, this._initMarkDirty();
  }
  _initMarkDirty() {
    this.disposeWithMe(
      this._commandService.onCommandExecuted((e) => {
        if (e.id === Id.id) {
          const t3 = e.params, { unitId: r, subUnitId: i, ranges: o3, id: s2 } = t3;
          if (r !== this._context.unitId)
            return;
          this.startAutoHeightTask({
            ranges: o3,
            sheetId: i,
            id: s2,
            // 10s timeout
            maxTime: 1e4
          });
        }
        if (e.id === vd.id) {
          const t3 = e.params, { unitId: r, id: i } = t3;
          if (r !== this._context.unitId)
            return;
          this.cancelTask(i);
        }
      })
    );
  }
  _loopTask(e) {
    const t3 = e.skeleton;
    let r = [], i = [];
    if (e.maxTime && e.maxTime + e.startTime <= Date.now())
      r = e.ranges;
    else {
      const l4 = _y2(e.ranges, Ry);
      r = l4.result, i = l4.lasts;
    }
    const s2 = t3.calculateAutoHeightInRange(r).filter((l4) => {
      const { row: a4, autoHeight: c2 } = l4;
      return !(!c2 || t3.getRowHeight(a4) === c2);
    });
    if (i.length && (e.ranges = i, this._autoHeightTasks.unshift(e)), s2.length) {
      const l4 = {
        unitId: this._context.unitId,
        subUnitId: e.sheetId,
        rowsAutoHeightInfo: s2
      };
      this._commandService.syncExecuteCommand(er2.id, l4);
    }
  }
  _calculateLoop(e) {
    for (; this._autoHeightTasks.length && !(e.timeRemaining() <= 0); ) {
      const t3 = this._autoHeightTasks.shift();
      if (!t3) {
        this._calculateLoopId = null;
        return;
      }
      this._loopTask(t3);
    }
    this._calculateLoopId = requestIdleCallback((t3) => {
      this._calculateLoop(t3);
    });
  }
  _initialCalculateLoop() {
    this._calculateLoopId === null && (this._calculateLoopId = requestIdleCallback((e) => {
      this._calculateLoop(e);
    }));
  }
  startAutoHeightTask(e) {
    const t3 = this._sheetSkeletonManagerService.getSkeleton(e.sheetId);
    if (!t3)
      return;
    e.ranges = Cn.mergeRanges(e.ranges.map((i) => __spreadProps(__spreadValues({}, i), {
      startColumn: 0,
      endColumn: 0
    })));
    const r = Cn.subtractMulti(
      e.ranges,
      this._autoHeightTasks.filter((i) => i.sheetId === e.sheetId).map((i) => i.ranges).flat()
    );
    r.length && (this._autoHeightTasks.push(__spreadProps(__spreadValues({}, e), {
      startTime: Date.now(),
      skeleton: t3,
      ranges: r
    })), this._initialCalculateLoop());
  }
  cancelTask(e) {
    const t3 = this._autoHeightTasks.findIndex((r) => r.id === e);
    t3 !== -1 && this._autoHeightTasks.splice(t3, 1);
  }
};
Nl4 = by([
  $h2(1, Inject(he2)),
  $h2(2, Ds)
], Nl4);
function Dp(n3) {
  const { popup: e } = n3, { extraProps: t3 } = e, { options: r, defaultValue: i, onChange: o3 } = t3, [s2, l4] = (0, import_react.useState)(i != null ? i : []);
  return (0, import_jsx_runtime.jsx)(
    mE,
    {
      options: r,
      value: s2,
      onChange: o3
    }
  );
}
Dp.componentKey = "sheets.dropdown.cascader";
function Lp(n3) {
  const { popup: e } = n3, { extraProps: t3 } = e, { defaultValue: r, onChange: i } = t3;
  return (0, import_jsx_runtime.jsx)(
    bE,
    {
      value: r,
      onChange: i
    }
  );
}
Lp.componentKey = "sheets.dropdown.color";
function Wp(n3) {
  const { popup: e } = n3, { extraProps: t3 } = e, { hideFn: r, patternType: i, defaultValue: o3, onChange: s2, showTime: l4 } = t3, [a4, c2] = (0, import_react.useState)(o3), d2 = (0, import_react.useMemo)(() => i !== "time" ? nn() : nn("1900-01-01 00:00:00"), []), u2 = a4 && a4.isValid() ? a4 : d2, h9 = useDependency(Hn), m9 = () => __async(this, null, function* () {
    if (!u2) return;
    (yield s2 == null ? void 0 : s2(u2)) && r();
  });
  return (0, import_jsx_runtime.jsxs)(
    "div",
    {
      className: "univer-rounded univer-bg-white univer-p-2 univer-shadow-lg dark:!univer-bg-black",
      children: [
        i === "time" ? (0, import_jsx_runtime.jsx)(
          nm,
          {
            value: u2.toDate(),
            onValueChange: (g9) => {
              c2(nn(g9));
            }
          }
        ) : (0, import_jsx_runtime.jsx)(
          Za,
          {
            value: u2.toDate(),
            showTime: l4 != null ? l4 : i === "datetime",
            onValueChange: (g9) => {
              c2(nn(g9));
            }
          }
        ),
        (0, import_jsx_runtime.jsx)(
          "footer",
          {
            className: ie2("univer-mt-2 univer-flex univer-justify-end univer-pt-2", dE2),
            children: (0, import_jsx_runtime.jsx)(fr, { size: "small", variant: "primary", onClick: m9, disabled: !u2 || !u2.isValid(), children: h9.t("dataValidation.alert.ok") })
          }
        )
      ]
    }
  );
}
Wp.componentKey = "sheets.dropdown.date";
function Iy(n3) {
  return n3.filter(Boolean).join(",");
}
function yy(n3) {
  return n3.split(",").filter(Boolean);
}
function My(n3) {
  const { value: e, onChange: t3, multiple: r, options: i, title: o3, onEdit: s2, filter: l4, style: a4, location: c2, showEdit: d2 } = n3, u2 = useDependency(Hn), h9 = l4 == null ? void 0 : l4.toLowerCase(), { row: m9, col: g9, unitId: f4, subUnitId: p3 } = c2, v6 = i.filter((C) => h9 ? C.label.toLowerCase().includes(h9) : true), S = useDependency(Yn2), w6 = (0, import_react.useMemo)(() => S.permissionCheckWithRanges(
    {
      workbookTypes: [Pe3],
      rangeTypes: [Ve4],
      worksheetTypes: [Le2]
    },
    [{ startColumn: g9, startRow: m9, endColumn: g9, endRow: m9 }],
    f4,
    p3
  ), [S, g9, m9, f4, p3]);
  return (0, import_jsx_runtime.jsxs)(
    "div",
    {
      "data-u-comp": "sheets-dropdown-list",
      className: ie2("univer-box-border univer-rounded-lg univer-bg-white univer-py-1 univer-text-gray-900 univer-shadow dark:!univer-bg-black dark:!univer-text-white", kt2),
      style: a4,
      children: [
        (0, import_jsx_runtime.jsx)("div", { className: "univer-px-3.5 univer-py-1 univer-pt-2 univer-text-xs", children: o3 }),
        (0, import_jsx_runtime.jsx)(
          "div",
          {
            className: ie2("univer-flex univer-max-h-52 univer-flex-col univer-gap-1 univer-overflow-y-auto univer-px-2 univer-py-1", vr2),
            children: v6.map((C, I6) => {
              const R9 = e.indexOf(C.value) > -1, y6 = () => {
                let T10;
                R9 ? T10 = new Set(e.filter((A4) => A4 !== C.value)) : T10 = new Set(r ? [...e, C.value] : [C.value]);
                const P8 = [];
                i.forEach((A4) => {
                  T10.has(A4.value) && P8.push(A4.value);
                }), t3(P8);
              }, E3 = C.label.toLocaleLowerCase().indexOf(h9), M10 = new At(C.color).isDark();
              return (0, import_jsx_runtime.jsxs)(
                "div",
                {
                  className: "univer-flex univer-cursor-pointer univer-flex-row univer-items-center univer-justify-between univer-rounded-md univer-px-1.5 univer-py-1 hover:univer-bg-gray-50 dark:hover:!univer-bg-gray-700",
                  onClick: y6,
                  children: [
                    (0, import_jsx_runtime.jsx)(
                      "div",
                      {
                        className: ie2("univer-inline-flex univer-h-4 univer-w-fit univer-items-center univer-truncate univer-rounded-full univer-px-1.5 univer-text-xs", {
                          "univer-text-gray-900": !M10,
                          "univer-text-white": M10
                        }),
                        style: { background: C.color },
                        children: h9 && C.label.toLowerCase().includes(h9) ? (0, import_jsx_runtime.jsxs)(import_jsx_runtime.Fragment, { children: [
                          (0, import_jsx_runtime.jsx)("span", { children: C.label.substring(0, E3) }),
                          (0, import_jsx_runtime.jsx)("span", { className: "univer-font-semibold", children: C.label.substring(E3, E3 + h9.length) }),
                          (0, import_jsx_runtime.jsx)("span", { children: C.label.substring(E3 + h9.length) })
                        ] }) : C.label
                      }
                    ),
                    (0, import_jsx_runtime.jsx)(
                      "div",
                      {
                        className: "univer-ml-3 univer-h-4 univer-w-4 univer-flex-shrink-0 univer-flex-grow-0 univer-text-base univer-text-primary-500",
                        children: R9 && (0, import_jsx_runtime.jsx)(Br3, { className: "univer-text-primary-600" })
                      }
                    )
                  ]
                },
                I6
              );
            })
          },
          l4
        ),
        d2 && w6 && (0, import_jsx_runtime.jsx)("div", { className: ie2("univer-box-border univer-px-2 univer-pt-1", dE2), children: (0, import_jsx_runtime.jsx)(
          "a",
          {
            className: "univer-block univer-cursor-pointer univer-rounded univer-px-1.5 univer-py-1 univer-text-xs hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-800",
            onClick: s2,
            children: u2.t("dataValidation.list.edit")
          }
        ) })
      ]
    }
  );
}
function Bp(n3) {
  var I6, R9, y6, E3;
  const { popup: { extraProps: e } } = n3, { location: t3, hideFn: r, onChange: i, onEdit: o3, options: s2, defaultValue: l4, multiple: a4, showEdit: c2 } = e, { worksheet: d2 } = t3, [u2, h9] = (0, import_react.useState)(""), m9 = useDependency(Ds), g9 = useDependency(Hn), [f4, p3] = (0, import_react.useState)(l4), v6 = useDependency(Qe3), S = useDependency(br), w6 = ot.useContext(), C = ((R9 = (I6 = w6.current) == null ? void 0 : I6.right) != null ? R9 : 0) - ((E3 = (y6 = w6.current) == null ? void 0 : y6.left) != null ? E3 : 0);
  return (0, import_react.useEffect)(() => {
    const M10 = m9.onCommandExecuted((T10) => {
      var P8, A4;
      if (T10.id === M.id) {
        const x7 = T10.params, { unitId: H6 } = x7, V7 = S.getUnit(H6, we.UNIVER_DOC);
        if (!V7 || !v6.isVisible().visible) return;
        const D5 = Ze.transform.getPlainText((A4 = (P8 = V7.getSnapshot().body) == null ? void 0 : P8.dataStream) != null ? A4 : "");
        h9(D5);
      }
    });
    return () => {
      M10.dispose();
    };
  }, [m9, v6, S]), d2 ? (0, import_jsx_runtime.jsx)(
    My,
    {
      style: { minWidth: C, maxWidth: Math.max(C, 200) },
      title: a4 ? g9.t("dataValidation.listMultiple.dropdown") : g9.t("dataValidation.list.dropdown"),
      value: yy(f4 != null ? f4 : ""),
      multiple: a4,
      onChange: (M10) => __async(this, null, function* () {
        const T10 = Iy(M10);
        p3(T10), (yield i == null ? void 0 : i(M10)) !== false && r();
      }),
      options: s2,
      onEdit: o3,
      filter: u2,
      location: t3,
      showEdit: c2
    }
  ) : null;
}
Bp.componentKey = "sheets.dropdown.list";
var eg2 = {
  datepicker: Wp,
  list: Bp,
  color: Lp,
  cascader: Dp
};
var Ey = Object.getOwnPropertyDescriptor;
var Ty = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? Ey(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var Ps2 = (n3, e) => (t3, r) => e(t3, r, n3);
var Fp = createIdentifier("ICellDropdownManagerService");
var kl3 = class extends Ve {
  constructor(n3, e, t3, r) {
    super(), this._canvasPopupManagerService = n3, this._zenZoneService = e, this._renderManagerService = t3, this._componentManager = r, Object.values(eg2).forEach((i) => {
      this.disposeWithMe(this._componentManager.register(i.componentKey, i));
    });
  }
  showDropdown(n3) {
    const { location: e, onHide: t3, closeOnOutSide: r = true } = n3, { row: i, col: o3, unitId: s2, subUnitId: l4 } = e;
    if (this._zenZoneService.visible)
      throw new Error("[SheetCellDropdownManagerService]: cannot show dropdown when zen mode is visible");
    const a4 = eg2[n3.type], c2 = this._renderManagerService.getRenderById(Hl), d2 = new ho(), u2 = this._canvasPopupManagerService.attachPopupToCell(
      i,
      o3,
      {
        componentKey: a4.componentKey,
        onClickOutside: () => {
          r && d2.dispose();
        },
        offset: [0, 3],
        excludeOutside: [c2 == null ? void 0 : c2.engine.getCanvasElement()].filter(Boolean),
        extraProps: __spreadProps(__spreadValues(__spreadValues({}, n3), n3.props), {
          hideFn: () => {
            d2.dispose();
          }
        })
      },
      s2,
      l4
    );
    if (!u2)
      throw new Error("[SheetCellDropdownManagerService]: cannot show dropdown");
    return d2.add(u2), d2.add({
      dispose: () => {
        t3 == null || t3();
      }
    }), d2;
  }
};
kl3 = Ty([
  Ps2(0, Inject(Pi)),
  Ps2(1, lt),
  Ps2(2, JE),
  Ps2(3, Inject(S13))
], kl3);
var Py = rR("PRINTING_RANGE");
var xy = rR("PRINTING_COMPONENT_COLLECT");
var Oy = rR("PRINTING_DOM_COLLECT");
var Up = class extends Ve {
  constructor() {
    super();
    _2(this, "_printComponentMap", /* @__PURE__ */ new Map());
    _2(this, "interceptor", new sR({
      PRINTING_RANGE: Py,
      PRINTING_COMPONENT_COLLECT: xy,
      PRINTING_DOM_COLLECT: Oy
    }));
    this.disposeWithMe(this.interceptor.intercept(this.interceptor.getInterceptPoints().PRINTING_RANGE, {
      priority: -1,
      handler: (t3) => t3
    })), this.disposeWithMe(this.interceptor.intercept(this.interceptor.getInterceptPoints().PRINTING_COMPONENT_COLLECT, {
      priority: -1,
      handler: (t3) => t3
    })), this.disposeWithMe(this.interceptor.intercept(this.interceptor.getInterceptPoints().PRINTING_DOM_COLLECT, {
      priority: -1,
      handler: (t3) => t3
    }));
  }
  registerPrintComponent(t3, r) {
    this._printComponentMap.set(t3, r);
  }
  getPrintComponent(t3) {
    return this._printComponentMap.get(t3);
  }
};
var Ay = class extends jd2 {
  constructor(t3, r, i, o3) {
    super(t3, r, i, o3);
    _2(this, "_fillControlTopLeft");
    _2(this, "_fillControlBottomRight");
    _2(this, "_rangeType", ge.NORMAL);
    this._scene = t3, this._zIndex = r, this._themeService = i, this._rangeType = (o3 == null ? void 0 : o3.rangeType) || ge.NORMAL, this.initControlPoints();
  }
  initControlPoints() {
    const t3 = this.currentStyle, r = t3.expandCornerSize || 0, i = (t3.expandCornerSize || 0) / 4, o3 = t3.autofillStrokeWidth || 0, s2 = t3.stroke, l4 = t3.autofillStroke, a4 = this.zIndex;
    this._fillControlTopLeft = new I1(Yc3.fillTopLeft + a4, {
      zIndex: a4 + 2,
      width: r,
      height: r,
      radius: r / 2,
      visualWidth: i,
      visualHeight: i,
      strokeWidth: o3
    }), this._fillControlBottomRight = new I1(Yc3.fillBottomRight + a4, {
      zIndex: a4 + 2,
      width: r,
      height: r,
      radius: r / 2,
      visualHeight: i,
      visualWidth: i,
      strokeWidth: o3
    });
    const c2 = {
      fill: s2,
      stroke: l4,
      strokeScaleEnabled: false
    };
    this._fillControlTopLeft.setProps(__spreadValues({}, c2)), this._fillControlBottomRight.setProps(__spreadValues({}, c2));
    const d2 = [
      this._fillControlTopLeft,
      this._fillControlBottomRight
    ];
    switch (this._rangeType) {
      case ge.ROW:
        this.rowHeaderGroup.addObjects(...d2);
        break;
      case ge.COLUMN:
        this.columnHeaderGroup.addObjects(...d2);
        break;
      case ge.NORMAL:
        this.selectionShapeGroup.addObjects(...d2);
    }
    this.getScene().addObjects(d2, Js3);
  }
  get fillControlTopLeft() {
    return this._fillControlTopLeft;
  }
  set fillControlTopLeft(t3) {
    this._fillControlTopLeft = t3;
  }
  get fillControlBottomRight() {
    return this._fillControlBottomRight;
  }
  set fillControlBottomRight(t3) {
    this._fillControlBottomRight = t3;
  }
  get rangeType() {
    return this._rangeType;
  }
  set rangeType(t3) {
    this._rangeType = t3;
  }
  dispose() {
    var t3, r;
    (t3 = this._fillControlBottomRight) == null || t3.dispose(), (r = this._fillControlTopLeft) == null || r.dispose(), super.dispose();
  }
  _updateLayoutOfSelectionControl(t3) {
    var o3, s2;
    super._updateLayoutOfSelectionControl(t3);
    const r = this.currentStyle;
    t3 == null && (t3 = r);
    const {
      widgets: i = r.widgets
    } = t3;
    if (this.currentStyle = t3, this._enableAutoFill === true && !super._hasWidgets(i)) {
      const { viewportScrollX: l4, viewportScrollY: a4 } = this.getViewportMainScrollInfo(), { endX: c2, endY: d2 } = this.selectionModel;
      this.transformControlPoint(l4, a4, c2, d2), this.fillControlTopLeft.show(), this.fillControlBottomRight.show();
    } else
      (o3 = this.fillControlTopLeft) == null || o3.hide(), (s2 = this.fillControlBottomRight) == null || s2.hide();
  }
  getViewportMainScrollInfo() {
    const t3 = this.getScene().getViewport(k2.VIEW_MAIN);
    return {
      viewportScrollX: (t3 == null ? void 0 : t3.viewportScrollX) || 0,
      viewportScrollY: (t3 == null ? void 0 : t3.viewportScrollY) || 0,
      width: (t3 == null ? void 0 : t3.width) || 0,
      height: (t3 == null ? void 0 : t3.height) || 0
    };
  }
  /**
   * Mainly for row & col selection control point position. update control point position by when scrolling.
   * @param viewportScrollX viewportScrollX
   * @param viewportScrollY
   * @param sheetContentWidth
   * @param sheetContentHeight max sheet content height, for very short sheet, control pointer shoud not out of sheet
   */
  transformControlPoint(t3 = 0, r = 0, i = 0, o3 = 0) {
    const s2 = this.currentStyle, l4 = this.selectionModel.rangeType, a4 = s2.expandCornerSize, { startX: c2, startY: d2, endX: u2, endY: h9 } = this.selectionModel, m9 = this.getViewportMainScrollInfo(), g9 = m9.width, f4 = m9.height;
    switch (l4) {
      case ge.NORMAL:
        this.fillControlTopLeft.transformByState({
          left: -a4 / 2,
          top: -a4 / 2
        }), this.fillControlBottomRight.transformByState({
          left: u2 - c2 - a4 / 2,
          top: h9 - d2 - a4 / 2
        });
        break;
      case ge.ROW:
        {
          const p3 = Math.min(g9 / 2 + t3, i), v6 = -a4 / 2 + p3;
          this.fillControlTopLeft.transformByState({
            left: v6,
            top: -a4 / 2
          }), this.fillControlBottomRight.transformByState({
            left: v6,
            top: -a4 / 2 + h9 - d2
          });
        }
        break;
      case ge.COLUMN:
        {
          const p3 = Math.min(+f4 / 2 + r, o3), v6 = -a4 / 2 + p3;
          this.fillControlTopLeft.transformByState({
            left: -a4 / 2,
            top: v6
          }), this.fillControlBottomRight.transformByState({
            left: -a4 / 2 + u2 - c2,
            top: v6
          });
        }
        break;
      default:
        console.error("unknown range type");
    }
  }
};
var Hy = Object.getOwnPropertyDescriptor;
var Vy = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? Hy(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var bn3 = (n3, e) => (t3, r) => e(t3, r, n3);
var sd3 = class extends Im2 {
  constructor(e, t3, r, i, o3, s2, l4, a4, c2, d2) {
    super(
      t3,
      r,
      i,
      s2,
      c2
    );
    _2(this, "_workbookSelections");
    _2(this, "_renderDisposable", null);
    _2(this, "_expandingSelection", false);
    _2(this, "_selectionControls", []);
    _2(this, "expandingControlMode", "bottom-right");
    this._context = e, this._logService = l4, this._commandService = a4, this._contextService = c2, this._scrollManagerService = d2, this._workbookSelections = o3.getWorkbookSelections(this._context.unitId), this._init();
  }
  _init() {
    const e = this._getSheetObject();
    this._initEventListeners(e), this._initSelectionChangeListener(), this._initSkeletonChangeListener(), this._initUserActionSyncListener(), this._updateControlPointWhenScrolling();
  }
  _initSkeletonChangeListener() {
    this.disposeWithMe(this._sheetSkeletonManagerService.currentSkeleton$.subscribe((e) => {
      if (e == null) {
        this._logService.error("[SelectionRenderService]: should not receive null!");
        return;
      }
      const t3 = this._context.unitId, { sheetId: r, skeleton: i } = e, { scene: o3 } = this._context, s2 = o3.getViewport(k2.VIEW_MAIN);
      this._changeRuntime(i, o3, s2), this._workbookSelections.getCurrentLastSelection() || this._commandService.syncExecuteCommand(ie5.id, {
        unitId: t3,
        subUnitId: r,
        selections: [Yd2(i)]
      });
    }));
  }
  _initSelectionChangeListener() {
  }
  _initEventListeners(e) {
    const { spreadsheetRowHeader: t3, spreadsheetColumnHeader: r, spreadsheet: i, spreadsheetLeftTopPlaceholder: o3 } = e, { scene: s2 } = this._context;
    this._initSpreadsheetEvent(e), this.disposeWithMe(
      t3 == null ? void 0 : t3.onPointerUp$.subscribeEvent((l4, a4) => {
        if (this._normalSelectionDisabled()) return;
        const c2 = this._sheetSkeletonManagerService.getCurrentParam().skeleton, { row: d2 } = An4(l4.offsetX, l4.offsetY, s2, c2);
        Lf(this._workbookSelections.getCurrentSelections(), d2) || (this.createNewSelection(l4, (i.zIndex || 1) + 1, ge.ROW, this._getActiveViewport(l4)), this._selectionMoveEnd$.next(this.getSelectionDataWithStyle()));
      })
    ), this.disposeWithMe(
      r == null ? void 0 : r.onPointerUp$.subscribeEvent((l4, a4) => {
        if (this._normalSelectionDisabled()) return;
        const c2 = this._sheetSkeletonManagerService.getCurrentParam().skeleton, { column: d2 } = An4(l4.offsetX, l4.offsetY, s2, c2);
        Wf(this._workbookSelections.getCurrentSelections(), d2) || (this.createNewSelection(l4, (i.zIndex || 1) + 1, ge.COLUMN, this._getActiveViewport(l4)), this._selectionMoveEnd$.next(this.getSelectionDataWithStyle()));
      })
    ), this.disposeWithMe(o3 == null ? void 0 : o3.onPointerUp$.subscribeEvent((l4, a4) => {
      if (this._normalSelectionDisabled()) return;
      this._reset();
      const c2 = this._sheetSkeletonManagerService.getCurrentParam().skeleton, d2 = ym(c2);
      this._addSelectionControlByModelData(d2), this.refreshSelectionMoveStart(), a4.stopPropagation(), this._selectionMoveEnd$.next(this.getSelectionDataWithStyle());
    }));
  }
  _initSpreadsheetEvent(e) {
    const { spreadsheet: t3 } = e;
    let r;
    const i = 500, o3 = { x: 0, y: 0 }, s2 = () => {
      clearTimeout(r);
    }, l4 = (d2, u2) => {
      this.createNewSelection(
        d2,
        t3.zIndex + 1,
        ge.NORMAL,
        this._getActiveViewport(d2)
      ), u2 && this._selectionMoveEnd$.next(this.getSelectionDataWithStyle());
    };
    t3 == null || t3.onPointerMove$.subscribeEvent((d2, u2) => {
      (Math.abs(d2.offsetX - o3.x) > 10 || Math.abs(d2.offsetY - o3.y) > 10) && s2();
    });
    const a4 = t3 == null ? void 0 : t3.onPointerDown$.subscribeEvent((d2, u2) => {
      o3.x = d2.offsetX, o3.y = d2.offsetY, r = setTimeout(() => {
        l4(d2, true);
      }, i), u2.stopPropagation();
    }), c2 = t3 == null ? void 0 : t3.onPointerUp$.subscribeEvent((d2, u2) => {
      if (this._normalSelectionDisabled()) return;
      clearTimeout(r);
      const h9 = 10;
      Math.abs(d2.offsetX - o3.x) > h9 || Math.abs(d2.offsetY - o3.y) > h9 || (l4(d2, false), u2.stopPropagation());
    });
    this.disposeWithMe(Be(a4)), this.disposeWithMe(Be(c2));
  }
  _initUserActionSyncListener() {
    this.disposeWithMe(this.selectionMoveStart$.subscribe((e) => this._updateSelections(e, we3.MOVE_START))), this.disposeWithMe(this.selectionMoving$.subscribe((e) => this._updateSelections(e, we3.MOVING))), this.disposeWithMe(this._contextService.subscribeContextValue$(Fu).pipe(startWith(false), distinctUntilChanged()).subscribe((e) => {
      var t3;
      e ? ((t3 = this._renderDisposable) == null || t3.dispose(), this._renderDisposable = null, this._reset()) : this._renderDisposable = Be(
        this.selectionMoveEnd$.subscribe((r) => this._updateSelections(r, we3.MOVE_END))
      );
    }));
  }
  _updateSelections(e, t3) {
    const r = this._context.unit, i = r.getUnitId(), o3 = r.getActiveSheet().getSheetId();
    e.length !== 0 && this._commandService.executeCommand(ie5.id, {
      unitId: i,
      subUnitId: o3,
      type: t3,
      selections: e.map(
        (s2) => Dh(s2)
      )
    });
  }
  /**
   * invoked when pointerup or long press on spreadsheet, or pointerdown on row&col
   * then move curr selection to cell at cursor
   * Main purpose to create a new selection, or update curr selection to a new range.
   * @param evt
   * @param _zIndex
   * @param rangeType
   * @param viewport
   */
  createNewSelection(e, t3 = 0, r = ge.NORMAL, i) {
    this._rangeType = r;
    const o3 = this._skeleton, s2 = this._scene;
    if (!s2 || !o3)
      return;
    i && (this._activeViewport = i);
    const { offsetX: l4, offsetY: a4 } = e, c2 = s2.getCoordRelativeToViewport(U.FromArray([l4, a4])), { x: d2, y: u2 } = c2;
    this._startViewportPosX = d2, this._startViewportPosY = u2;
    const h9 = s2.getScrollXYInfoByViewport(c2), { scaleX: m9, scaleY: g9 } = s2.getAncestorScale(), f4 = this._skeleton.getCellByOffset(d2, u2, m9, g9, h9);
    if (!f4) return;
    switch (r) {
      case ge.NORMAL:
        break;
      case ge.ROW:
        f4.startColumn = 0, f4.endColumn = this._skeleton.getColumnCount() - 1;
        break;
      case ge.COLUMN:
        f4.startRow = 0, f4.endRow = this._skeleton.getRowCount() - 1;
        break;
      case ge.ALL:
        f4.startRow = 0, f4.startColumn = 0, f4.endRow = this._skeleton.getRowCount() - 1, f4.endColumn = this._skeleton.getColumnCount() - 1;
    }
    const p3 = { range: f4, primary: f4, style: null };
    p3.range.rangeType = r;
    const v6 = Wt3(p3, this._skeleton);
    this._startRangeWhenPointerDown = __spreadValues({}, v6.rangeWithCoord);
    let S = this.getActiveSelectionControl();
    const w6 = __spreadValues({}, v6.rangeWithCoord);
    for (const C of this.getSelectionControls())
      if (C.model.isEqual(w6)) {
        S = C;
        break;
      }
    (S == null ? void 0 : S.model.rangeType) !== r ? (this._clearAllSelectionControls(), S = this.newSelectionControl(s2, o3, p3)) : S.updateRangeBySelectionWithCoord(v6), this._selectionMoveStart$.next(this.getSelectionDataWithStyle()), this._clearUpdatingListeners(), this._expandingSelection = false;
  }
  /**
   * Not same as PC version,
   * new selection control for mobile do one more thing: bind event for two control points.
   * @param scene
   * @param rangeType
   */
  newSelectionControl(e, t3, r) {
    const i = this.getSelectionControls(), { rowHeaderWidth: o3, columnHeaderHeight: s2 } = t3, l4 = r.range.rangeType, a4 = new Ay(e, i.length, this._themeService, {
      highlightHeader: this._highlightHeader,
      rowHeaderWidth: o3,
      columnHeaderHeight: s2,
      rangeType: l4
    }), c2 = Wt3(r, t3);
    a4.updateRangeBySelectionWithCoord(c2), this._selectionControls.push(a4);
    const { expandingModeForTopLeft: d2, expandingModeForBottomRight: u2 } = (() => {
      switch (l4) {
        case ge.NORMAL:
          return {
            expandingModeForTopLeft: "top-left",
            expandingModeForBottomRight: "bottom-right"
            /* BOTTOM_RIGHT */
          };
        case ge.ROW:
          return {
            expandingModeForTopLeft: "top",
            expandingModeForBottomRight: "bottom"
            /* BOTTOM */
          };
        case ge.COLUMN:
          return {
            expandingModeForTopLeft: "left",
            expandingModeForBottomRight: "right"
            /* RIGHT */
          };
        case ge.ALL:
          return {
            expandingModeForTopLeft: "top-left",
            expandingModeForBottomRight: "bottom-right"
            /* BOTTOM_RIGHT */
          };
        default:
          return {
            expandingModeForTopLeft: "top-left",
            expandingModeForBottomRight: "bottom-right"
            /* BOTTOM_RIGHT */
          };
      }
    })();
    return a4.fillControlTopLeft.onPointerDown$.subscribeEvent((h9) => {
      this._expandingSelection = true, this.expandingControlMode = d2, this._selectionMoveStart$.next(this.getSelectionDataWithStyle()), this._fillControlPointerDownHandler(
        h9,
        l4,
        this._activeViewport
      );
    }), a4.fillControlBottomRight.onPointerDown$.subscribeEvent((h9) => {
      this._expandingSelection = true, this.expandingControlMode = u2, this._selectionMoveStart$.next(this.getSelectionDataWithStyle()), this._fillControlPointerDownHandler(
        h9,
        l4,
        this._activeViewport
      );
    }), (l4 === ge.ROW || l4 === ge.COLUMN) && !e.getViewport(k2.VIEW_MAIN), a4;
  }
  // same as PC
  _getActiveViewport(e) {
    const t3 = this._getSheetObject();
    return t3 == null ? void 0 : t3.scene.getActiveViewportByCoord(U.FromArray([e.offsetX, e.offsetY]));
  }
  // same as PC
  _getSheetObject() {
    return $t4(this._context.unit, this._context);
  }
  // same as PC
  _normalSelectionDisabled() {
    return this._contextService.getContextValue(Fu);
  }
  getSelectionControls() {
    return this._selectionControls;
  }
  _fillControlPointerDownHandler(e, t3 = ge.NORMAL, r, i = OE.ALL) {
    var u2, h9, m9;
    const o3 = this._skeleton, s2 = this._scene;
    if (!s2 || !o3)
      return;
    r && (this._activeViewport = r);
    const l4 = s2.getViewport(k2.VIEW_MAIN), a4 = this.getActiveSelectionControl();
    if (!a4) return;
    this._changeCurrCellWhenControlPointerDown(), this._selectionMoveStart$.next(this.getSelectionDataWithStyle()), this._clearUpdatingListeners(), this._addEndingListeners(), this._scrollTimer = y0.create(this._scene, i), this._scrollTimer.startScroll((u2 = l4 == null ? void 0 : l4.left) != null ? u2 : 0, (h9 = l4 == null ? void 0 : l4.top) != null ? h9 : 0, l4), (m9 = s2.getTransformer()) == null || m9.clearSelectedObjects();
    const c2 = s2.getCoordRelativeToViewport(U.FromArray([e.offsetX, e.offsetY]));
    this._setupPointerMoveListener(l4, a4, t3, i, c2.x, c2.y);
    const d2 = this._shortcutService.forceEscape();
    this._scenePointerUpSub = s2.onPointerUp$.subscribeEvent((g9) => {
      this.endSelection(), this._expandingSelection = false, this.expandingControlMode = "bottom-right", this._selectionMoveEnd$.next(this.getSelectionDataWithStyle()), d2.dispose();
    });
  }
  _changeCurrCellWhenControlPointerDown() {
    const e = this.getActiveSelectionControl(), t3 = this._skeleton;
    let r;
    const { startRow: i, startColumn: o3, endRow: s2, endColumn: l4 } = e.model;
    switch (this.expandingControlMode) {
      case "top-left":
        r = t3.getCellWithCoordByIndex(s2, l4);
        break;
      case "bottom-right":
        r = t3.getCellWithCoordByIndex(i, o3);
        break;
      case "left":
        r = t3.getCellWithCoordByIndex(i, l4), r.isMerged = false, r.isMergedMainCell = false;
        break;
      case "right":
        r = t3.getCellWithCoordByIndex(i, o3), r.isMerged = false, r.isMergedMainCell = false;
        break;
      case "top":
        r = t3.getCellWithCoordByIndex(s2, o3), r.isMerged = false, r.isMergedMainCell = false;
        break;
      case "bottom":
        r = t3.getCellWithCoordByIndex(i, o3), r.isMerged = false, r.isMergedMainCell = false;
        break;
      default:
        r = t3.getCellWithCoordByIndex(i, o3);
    }
    return e.updateCurrCell(r), r;
  }
  /**
   * Not same as _moving in PC (base selection render service)
   * The diff is
   * In base version, new selection is determined by the cursor cell and _startRangeWhenPointerDown
   *
   * In Mobile version, new selection is determined by cursor cell and current of activeSelectionControl.model
   */
  _movingHandler(e, t3, r, i) {
    var E3, M10, T10, P8, A4, x7, H6, V7, D5, B5, F7, z5, Z9;
    this._rangeType = i;
    const o3 = this._skeleton, s2 = this._scene, l4 = {
      startRow: r.model.startRow,
      endRow: r.model.endRow,
      startColumn: r.model.startColumn,
      endColumn: r.model.endColumn
    }, a4 = s2.getViewport(k2.VIEW_MAIN), c2 = (E3 = this._getViewportByCell(l4.endRow, l4.endColumn)) != null ? E3 : a4, d2 = s2.getScrollXYInfoByViewport(
      U.FromArray([this._startViewportPosX, this._startViewportPosY]),
      c2
    ), { scaleX: u2, scaleY: h9 } = s2.getAncestorScale();
    i === ge.ROW ? e = Number.POSITIVE_INFINITY : i === ge.COLUMN && (t3 = Number.POSITIVE_INFINITY);
    const m9 = this._getSelectionWithCoordByOffset(e, t3, u2, h9, d2);
    if (!m9)
      return false;
    const { rangeWithCoord: g9 } = m9, f4 = r.model.currentCell, p3 = (M10 = f4 == null ? void 0 : f4.mergeInfo.startRow) != null ? M10 : -1, v6 = (T10 = f4 == null ? void 0 : f4.mergeInfo.endRow) != null ? T10 : -1, S = (P8 = f4 == null ? void 0 : f4.mergeInfo.startColumn) != null ? P8 : -1, w6 = (A4 = f4 == null ? void 0 : f4.mergeInfo.endColumn) != null ? A4 : -1;
    let C = {
      startRow: Math.min(g9.startRow, p3),
      startColumn: Math.min(g9.startColumn, S),
      endRow: Math.max(g9.endRow, v6),
      endColumn: Math.max(g9.endColumn, w6)
    };
    if (i === ge.NORMAL ? C = o3.expandRangeByMerge(C) : i === ge.COLUMN ? C = {
      startRow: Math.min(g9.startRow, (x7 = f4 == null ? void 0 : f4.actualRow) != null ? x7 : -1),
      startColumn: Math.min(g9.startColumn, (H6 = f4 == null ? void 0 : f4.actualColumn) != null ? H6 : -1),
      endRow: Math.max(g9.endRow, (V7 = f4 == null ? void 0 : f4.actualRow) != null ? V7 : -1),
      endColumn: Math.max(g9.endColumn, (D5 = f4 == null ? void 0 : f4.actualColumn) != null ? D5 : -1)
    } : i === ge.ROW && (C = {
      startRow: Math.min(g9.startRow, (B5 = f4 == null ? void 0 : f4.actualRow) != null ? B5 : -1),
      startColumn: Math.min(g9.startColumn, (F7 = f4 == null ? void 0 : f4.actualColumn) != null ? F7 : -1),
      endRow: Math.max(g9.endRow, (z5 = f4 == null ? void 0 : f4.actualRow) != null ? z5 : -1),
      endColumn: Math.max(g9.endColumn, (Z9 = f4 == null ? void 0 : f4.actualColumn) != null ? Z9 : -1)
    }), !C)
      return false;
    const R9 = Wt3({ range: C, style: null, primary: null }, o3);
    (l4.startRow !== C.startRow || l4.startColumn !== C.startColumn || l4.endRow !== C.endRow || l4.endColumn !== C.endColumn) && r && (r.updateRangeBySelectionWithCoord(R9), this._selectionMoving$.next(this.getSelectionDataWithStyle()));
  }
  _updateControlPointWhenScrolling() {
    const { scene: e } = this._context;
    if (!e.getViewport(k2.VIEW_MAIN)) return;
    const r = this._scrollManagerService.validViewportScrollInfo$.subscribe((i) => {
      var h9;
      if (i == null)
        return;
      const { viewportScrollX: o3, viewportScrollY: s2 } = i, l4 = this.getActiveSelectionControl();
      if (l4 == null)
        return;
      const a4 = (h9 = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : h9.skeleton, c2 = a4 == null ? void 0 : a4.rowTotalHeight, d2 = a4 == null ? void 0 : a4.columnTotalWidth, u2 = l4.rangeType;
      u2 === ge.COLUMN ? l4.transformControlPoint(0, s2, d2, c2) : u2 === ge.ROW && l4.transformControlPoint(o3, 0, d2, c2);
    });
    this.disposeWithMe(Be(r));
  }
};
sd3 = Vy([
  bn3(1, Inject(Injector)),
  bn3(2, Inject(Ji)),
  bn3(3, Le),
  bn3(4, Inject(z)),
  bn3(5, Inject(he2)),
  bn3(6, Nt),
  bn3(7, Ds),
  bn3(8, Tr),
  bn3(9, Inject(Et3))
], sd3);
var Ny = Object.defineProperty;
var ky = Object.getOwnPropertyDescriptor;
var Dy2 = (n3, e, t3) => e in n3 ? Ny(n3, e, { enumerable: true, configurable: true, writable: true, value: t3 }) : n3[e] = t3;
var Ly = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? ky(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var oo3 = (n3, e) => (t3, r) => e(t3, r, n3);
var Xp = (n3, e, t3) => Dy2(n3, typeof e != "symbol" ? e + "" : e, t3);
var Dl2 = class extends yl {
  /** @ignore */
  constructor(n3 = hl2, e, t3, r, i, o3) {
    super(), this._config = n3, this._injector = e, this._renderManagerService = t3, this._configService = r, this._univerInstanceService = i, this._componentManager = o3;
    const _a5 = co(
      {},
      hl2,
      this._config
    ), { menu: s2 } = _a5, l4 = __objRest(_a5, ["menu"]);
    if (l4.protectedRangeUserSelector) {
      const { component: a4, framework: c2 } = l4.protectedRangeUserSelector;
      this.disposeWithMe(
        this._componentManager.register(
          pa5,
          a4,
          {
            framework: c2
          }
        )
      );
    }
    s2 && this._configService.setConfig("menu", s2, { merge: true }), this._configService.setConfig(Tt2, __spreadValues({}, l4));
  }
  onStarting() {
    eR(this._injector, uC([
      [_i2],
      [Qe3, { useClass: cl2 }],
      [tn3, { useClass: ol2 }],
      [Lr4, { useClass: zm }],
      [Nn, { useClass: al2 }],
      [ds2, { useClass: Qm }],
      [us2, { useClass: hf }],
      [Ku, { useClass: Co }],
      [Nr3, { useClass: nl2 }],
      [Up],
      [Ha3, { useClass: gf }],
      [Xi3, { useClass: rl2 }],
      [Mr3],
      [No3],
      [Pi],
      [Er3],
      [Fo3],
      [ou2],
      [Fp, { useClass: kl3 }],
      [ko4],
      // controllers
      [xi2],
      [pi2],
      [Ir4],
      [yr4],
      [rr4],
      [Il2],
      [Tr4],
      [yi3],
      [Vi3],
      [Ai2],
      [Hi3],
      [Oi4],
      [Ei2],
      // permission
      [Rr4],
      [Ni2],
      [Dr4],
      [ki2],
      [Ti2],
      [Di2]
    ], this._config.override));
  }
  onReady() {
    this._config.disableAutoFocus || this._initAutoFocus(), eR(this._injector, [
      [Pr4]
    ]), this._registerRenderBasics(), Kc(this._injector, [
      [Il2],
      [rr4],
      [xi2],
      [Ti2],
      [Ni2]
    ]);
  }
  onRendered() {
    this._registerRenderModules(), Kc(this._injector, [
      [Di2],
      [Rr4],
      [Pr4],
      [yr4],
      [Ai2],
      [Tr4],
      [pi2],
      [Ir4],
      [Hi3],
      [Oi4],
      [Ei2]
    ]);
  }
  onSteady() {
    Kc(this._injector, [
      [Vi3],
      [yi3],
      [ki2]
    ]);
  }
  _registerRenderBasics() {
    [
      [he2],
      [Vl2],
      [vl2],
      [gt, { useClass: sd3 }],
      [Et3],
      [Nl4]
    ].forEach((n3) => {
      this.disposeWithMe(this._renderManagerService.registerRenderModule(we.UNIVER_SHEET, n3));
    });
  }
  // We have to let render basics get bootstrapped before. Because some render controllers relies on
  // a correct skeleton when they get loaded.
  _registerRenderModules() {
    var r;
    const n3 = [
      [Wo],
      [Hl3],
      [Bo],
      // TODO: Should not register these two Controllers at the same time
      [Ri3],
      [od3],
      [Lo4],
      [Ho2],
      [Ol2],
      [xl3],
      [Cl2],
      [wl3],
      [bl2],
      [Rl2],
      [ml2],
      [ul2],
      [_l2],
      [dl2],
      // [SheetContextMenuMobileRenderController],
      [yl4],
      // editor
      [Do3],
      // permission
      [Ml2],
      [El2],
      [Tl2],
      [Pl2]
    ], e = this._configService.getConfig(ae);
    ((r = e == null ? void 0 : e.contextMenu) != null ? r : true) && n3.push([Al2]), n3.forEach((i) => {
      this.disposeWithMe(this._renderManagerService.registerRenderModule(we.UNIVER_SHEET, i));
    });
  }
  _initAutoFocus() {
    const n3 = this._univerInstanceService;
    this.disposeWithMe(n3.getCurrentTypeOfUnit$(we.UNIVER_SHEET).pipe(filter((e) => !!e)).subscribe((e) => n3.focusUnit(e.getUnitId())));
  }
};
Xp(Dl2, "pluginName", "SHEET_UI_PLUGIN");
Xp(Dl2, "type", we.UNIVER_SHEET);
Dl2 = Ly([
  sI(rs2, P32),
  oo3(1, Inject(Injector)),
  oo3(2, JE),
  oo3(3, xs),
  oo3(4, br),
  oo3(5, Inject(S13))
], Dl2);
var Wy = Object.getOwnPropertyDescriptor;
var By = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? Wy(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var Ic2 = (n3, e) => (t3, r) => e(t3, r, n3);
var ld2 = class extends Ve {
  constructor(n3, e, t3, r) {
    super(), this._context = n3, this._contextMenuService = e, this._selectionManagerService = t3, this._selectionRenderService = r, this._init();
  }
  _init() {
    var l4, a4;
    const e = ((a4 = (l4 = this._context) == null ? void 0 : l4.mainComponent) == null ? void 0 : a4.onPointerDown$).subscribeEvent((c2) => {
      if (c2.button === 2) {
        const d2 = this._selectionManagerService.getCurrentSelections(), u2 = d2 == null ? void 0 : d2[0];
        if (!u2)
          return;
        const h9 = u2.range.rangeType, m9 = this._selectionRenderService.getSkeleton(), f4 = Wt3(u2, m9).rangeWithCoord, p3 = () => {
          if (!f4)
            return false;
          const S = c2.offsetX, w6 = c2.offsetY;
          switch (h9) {
            case ge.ROW:
              return f4.startY <= w6 && f4.endY >= w6;
            case ge.COLUMN:
              return f4.startX <= S && f4.endX >= S;
            default:
              return f4.startX <= S && f4.endX >= S && f4.startY <= w6 && f4.endY >= w6;
          }
        }, v6 = (S) => {
          this._contextMenuService.triggerContextMenu(c2, S);
        };
        p3() ? h9 === ge.COLUMN ? v6(W1.COL_HEADER) : h9 === ge.ROW ? v6(W1.ROW_HEADER) : v6(W1.MAIN_AREA) : v6(W1.MAIN_AREA);
      }
    });
    this.disposeWithMe(e);
    const t3 = this._context.components.get(Ge5.COLUMN), i = this._context.components.get(Ge5.ROW).onPointerDown$.subscribeEvent((c2) => {
      c2.button === 2 && this._contextMenuService.triggerContextMenu(c2, W1.ROW_HEADER);
    });
    this.disposeWithMe(i);
    const s2 = t3.onPointerDown$.subscribeEvent((c2) => {
      c2.button === 2 && this._contextMenuService.triggerContextMenu(c2, W1.COL_HEADER);
    });
    this.disposeWithMe(s2);
  }
};
ld2 = By([
  Ic2(1, l3),
  Ic2(2, Inject(z)),
  Ic2(3, gt)
], ld2);
var Fy = Object.getOwnPropertyDescriptor;
var Uy = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? Fy(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var tg2 = (n3, e) => (t3, r) => e(t3, r, n3);
function Xy(n3) {
  return typeof n3.setShadowStrategy == "function";
}
var ad3 = class extends Ve {
  constructor(e, t3) {
    super();
    _2(this, "_currentStrategy");
    _2(this, "_strategySubject");
    this._configService = e, this._renderManagerService = t3;
    const r = this._configService.getConfig(Tt2);
    this._currentStrategy = cu2(r == null ? void 0 : r.protectedRangeShadow), this._strategySubject = new BehaviorSubject(this._currentStrategy), this.disposeWithMe({
      dispose: () => {
        this._strategySubject.complete();
      }
    });
  }
  _updateAllWorkbooks(e) {
    this._renderManagerService.getRenderAll().forEach((r) => {
      const i = r.mainComponent;
      if (!i)
        return;
      const o3 = [
        { key: bu2 },
        { key: _u2 },
        { key: Ru2 }
      ];
      let s2 = false;
      for (const { key: l4 } of o3) {
        const a4 = i.getExtensionByKey(l4);
        a4 && Xy(a4) && (a4.setShadowStrategy(e), s2 = true);
      }
      s2 && i.makeDirty(true);
    });
  }
  setProtectedRangeShadowStrategy(e) {
    this._currentStrategy = e, this._strategySubject.next(e), this._updateAllWorkbooks(e);
  }
  getProtectedRangeShadowStrategy() {
    return this._currentStrategy;
  }
  getProtectedRangeShadowStrategy$() {
    return this._strategySubject.asObservable();
  }
  dispose() {
    super.dispose(), this._strategySubject.complete();
  }
};
ad3 = Uy([
  tg2(0, xs),
  tg2(1, JE)
], ad3);
var zy = Object.getOwnPropertyDescriptor;
var jy = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? zy(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var zn3 = (n3, e) => (t3, r) => e(t3, r, n3);
var cd3 = class extends Im2 {
  constructor(e, t3, r, i, o3, s2, l4, a4, c2) {
    super(
      t3,
      r,
      i,
      s2,
      c2
    );
    _2(this, "_workbookSelections");
    _2(this, "_renderDisposable", null);
    this._context = e, this._logService = l4, this._commandService = a4, this._contextService = c2, this._workbookSelections = o3.getWorkbookSelections(this._context.unitId), this._init();
  }
  _init() {
    const e = this._getSheetObject();
    this._contextService.setContextValue(Vh, true), this._initEventListeners(e), this._initSelectionModelChangeListener(), this._initThemeChangeListener(), this._initSkeletonChangeListener(), this._initUserActionSyncListener();
  }
  dispose() {
    var e;
    super.dispose(), (e = this._renderDisposable) == null || e.dispose();
  }
  _initEventListeners(e) {
    const { spreadsheetRowHeader: t3, spreadsheetColumnHeader: r, spreadsheet: i, spreadsheetLeftTopPlaceholder: o3 } = e, { scene: s2 } = this._context;
    this.disposeWithMe(i == null ? void 0 : i.onPointerDown$.subscribeEvent((l4, a4) => {
      this.isSelectionDisabled() || this.inRefSelectionMode() || (this._onPointerDown(l4, i.zIndex + 1, ge.NORMAL, this._getActiveViewport(l4)), l4.button !== 2 && a4.stopPropagation());
    })), this.disposeWithMe(
      t3 == null ? void 0 : t3.onPointerDown$.subscribeEvent((l4, a4) => {
        if (this.isSelectionDisabled() || this.inRefSelectionMode()) return;
        const c2 = this._sheetSkeletonManagerService.getCurrentParam().skeleton, { row: d2 } = An4(l4.offsetX, l4.offsetY, s2, c2);
        Lf(this._workbookSelections.getCurrentSelections(), d2) || (this._onPointerDown(l4, (i.zIndex || 1) + 1, ge.ROW, this._getActiveViewport(l4), OE.Y), l4.button !== 2 && a4.stopPropagation());
      })
    ), this.disposeWithMe(r == null ? void 0 : r.onPointerDown$.subscribeEvent((l4, a4) => {
      if (this.isSelectionDisabled() || this.inRefSelectionMode()) return;
      const c2 = this._sheetSkeletonManagerService.getCurrentParam().skeleton, { column: d2 } = An4(l4.offsetX, l4.offsetY, s2, c2);
      Wf(this._workbookSelections.getCurrentSelections(), d2) || (this._onPointerDown(l4, (i.zIndex || 1) + 1, ge.COLUMN, this._getActiveViewport(l4), OE.X), l4.button !== 2 && a4.stopPropagation());
    })), this.disposeWithMe(o3 == null ? void 0 : o3.onPointerDown$.subscribeEvent((l4, a4) => {
      if (this.isSelectionDisabled() || this.inRefSelectionMode()) return;
      this._reset();
      const c2 = this._sheetSkeletonManagerService.getCurrentParam().skeleton, d2 = ym(c2);
      this._addSelectionControlByModelData(d2), this.refreshSelectionMoveEnd(), l4.button !== 2 && a4.stopPropagation();
    }));
  }
  _initThemeChangeListener() {
    this.disposeWithMe(this._themeService.currentTheme$.subscribe(() => {
      this._initSelectionThemeFromThemeService();
      const e = this._workbookSelections.getCurrentSelections();
      e && this.resetSelectionsByModelData(e);
    }));
  }
  /**
   * Response for selection model changing.
   */
  _initSelectionModelChangeListener() {
    this.disposeWithMe(merge(
      this._workbookSelections.selectionMoveEnd$,
      // triggered by keyboard(e.g. arrow key tab enter)
      this._workbookSelections.selectionSet$
      // shift + arrow key
    ).subscribe((e) => {
      this.resetSelectionsByModelData(e);
    }));
  }
  disableSelection() {
    this._contextService.setContextValue(Vh, false);
  }
  enableSelection() {
    this._contextService.setContextValue(Vh, true);
  }
  transparentSelection() {
    const e = this._themeService.getCurrentTheme(), t3 = hR(e, "primary.600", "transparent");
    this.setSelectionTheme(t3);
    const r = this._workbookSelections.getCurrentSelections();
    for (let i = 0; i < r.length; i++) {
      const o3 = r[i];
      o3.style = Sr4(this._selectionTheme);
    }
    this.resetSelectionsByModelData(r);
  }
  showSelection() {
    const e = this._themeService.getCurrentTheme();
    this.setSelectionTheme(e);
    const t3 = this._workbookSelections.getCurrentSelections();
    for (let r = 0; r < t3.length; r++) {
      const i = t3[r];
      i.style && (i.style = Sr4(this._selectionTheme));
    }
    this.resetSelectionsByModelData(t3);
  }
  /**
   * Handle events in spreadsheet. (e.g. drag and move to make a selection)
   */
  _initUserActionSyncListener() {
    this.disposeWithMe(this.selectionMoveStart$.subscribe((e) => this._updateSelections(e, we3.MOVE_START))), this.disposeWithMe(this.selectionMoving$.subscribe((e) => this._updateSelections(e, we3.MOVING))), this.disposeWithMe(this._contextService.subscribeContextValue$(Fu).pipe(startWith(false), distinctUntilChanged()).subscribe((e) => {
      e && this._reset();
    })), this.disposeWithMe(this._contextService.subscribeContextValue$(Vh).pipe(startWith(true), distinctUntilChanged()).subscribe((e) => {
      var t3;
      e ? this._renderDisposable = Be(
        this.selectionMoveEnd$.subscribe((r) => {
          this._updateSelections(r, we3.MOVE_END);
        })
      ) : ((t3 = this._renderDisposable) == null || t3.dispose(), this._renderDisposable = null, this._reset());
    }));
  }
  /**
   * Update selectionData to selectionDataModel (WorkBookSelections) by SetSelectionsOperation.
   *
   * Unlike baseSelectionRenderService@resetSelectionsByModelData, this method is for update WorkbookSelectionModel.
   *
   *
   * @param selectionDataWithStyleList
   * @param type
   */
  _updateSelections(e, t3) {
    const r = this._context.unit, i = r.getUnitId(), o3 = r.getActiveSheet().getSheetId();
    if (e.length === 0)
      return;
    const s2 = e.map(
      (l4) => Dh(l4)
    );
    this._commandService.executeCommand(ie5.id, {
      unitId: i,
      subUnitId: o3,
      type: t3,
      selections: s2
    });
  }
  _initSkeletonChangeListener() {
    this.disposeWithMe(this._sheetSkeletonManagerService.currentSkeleton$.subscribe((e) => {
      var c2, d2;
      if (e == null) {
        this._logService.error("[SelectionRenderService]: should not receive null!");
        return;
      }
      const t3 = this._context.unitId, { sheetId: r, skeleton: i } = e, { scene: o3 } = this._context, s2 = o3.getViewport(k2.VIEW_MAIN), l4 = (d2 = (c2 = this._skeleton) == null ? void 0 : c2.worksheet) == null ? void 0 : d2.getSheetId();
      if (this._changeRuntime(i, o3, s2), l4 !== i.worksheet.getSheetId()) {
        const u2 = this._workbookSelections.getCurrentSelections();
        this._commandService.syncExecuteCommand(ie5.id, {
          unitId: t3,
          subUnitId: r,
          selections: u2.length !== 0 ? u2 : [Yd2(i)]
        });
      }
      const a4 = this._workbookSelections.getCurrentSelections();
      a4 != null && this.resetSelectionsByModelData(a4);
    }));
  }
  _getActiveViewport(e) {
    const t3 = this._getSheetObject();
    return t3 == null ? void 0 : t3.scene.getActiveViewportByCoord(U.FromArray([e.offsetX, e.offsetY]));
  }
  _getSheetObject() {
    return $t4(this._context.unit, this._context);
  }
  /**
   * Handle pointer down event, bind pointermove & pointerup handler.
   * then trigger selectionMoveStart$.
   *
   * @param evt
   * @param _zIndex
   * @param rangeType
   * @param viewport
   * @param scrollTimerType
   */
  // eslint-disable-next-line complexity, max-lines-per-function
  _onPointerDown(e, t3 = 0, r = ge.NORMAL, i, o3 = OE.ALL) {
    var T10, P8;
    this._rangeType = r;
    const s2 = this._skeleton, l4 = this._scene;
    if (!l4 || !s2)
      return;
    i && (this._activeViewport = i);
    const { offsetX: a4, offsetY: c2 } = e, d2 = l4.getViewport(k2.VIEW_MAIN);
    if (!d2) return;
    const u2 = l4.getCoordRelativeToViewport(U.FromArray([a4, c2])), { x: h9, y: m9 } = u2;
    this._startViewportPosX = h9, this._startViewportPosY = m9;
    const g9 = l4.getScrollXYInfoByViewport(u2), { scaleX: f4, scaleY: p3 } = l4.getAncestorScale(), v6 = this._skeleton.getCellByOffset(h9, m9, f4, p3, g9);
    if (!v6) return;
    switch (r) {
      case ge.NORMAL:
        break;
      case ge.ROW:
        v6.startColumn = 0, v6.endColumn = this._skeleton.getColumnCount() - 1, v6.startRow = v6.actualRow, v6.endRow = v6.actualRow;
        break;
      case ge.COLUMN:
        v6.startRow = 0, v6.endRow = this._skeleton.getRowCount() - 1, v6.startColumn = v6.actualColumn, v6.endColumn = v6.actualColumn;
        break;
      case ge.ALL:
        v6.startRow = 0, v6.startColumn = 0, v6.endRow = this._skeleton.getRowCount() - 1, v6.endColumn = this._skeleton.getColumnCount() - 1;
    }
    const S = { range: v6, primary: v6, style: null };
    S.range.rangeType = r;
    const w6 = Wt3(S, this._skeleton);
    this._startRangeWhenPointerDown = __spreadValues({}, w6.rangeWithCoord);
    let C = this.getActiveSelectionControl();
    const I6 = __spreadProps(__spreadValues({}, w6.rangeWithCoord), { rangeType: r }), R9 = this.getSelectionControls();
    for (const A4 of R9)
      if (e.button === 2 && Cn.contains(A4.model, I6)) {
        C = A4;
        return;
      }
    this._checkClearPreviousControls(e);
    const y6 = C == null ? void 0 : C.model.currentCell, E3 = e.shiftKey && y6, M10 = this._remainLastEnabled && !e.ctrlKey && !e.shiftKey && !this._skipLastEnabled && !this._singleSelectionEnabled;
    E3 ? this._makeSelectionByTwoCells(
      y6,
      I6,
      s2,
      r,
      C
      // Get updated in this method
    ) : M10 && C ? C.updateRangeBySelectionWithCoord(w6) : C = this.newSelectionControl(l4, s2, S);
    for (let A4 = 0; A4 < this.getSelectionControls().length - 1; A4++)
      this.getSelectionControls()[A4].clearHighlight();
    l4.disableObjectsEvent(), this._clearUpdatingListeners(), this._addEndingListeners(), (T10 = l4.getTransformer()) == null || T10.clearSelectedObjects(), this._setupPointerMoveListener(d2, C, r, o3, h9, m9), this._escapeShortcutDisposable = this._shortcutService.forceEscape(), this._selectionMoveStart$.next(this.getSelectionDataWithStyle()), this._scenePointerUpSub = l4.onPointerUp$.subscribeEvent(() => {
      var A4;
      this._clearUpdatingListeners(), this._selectionMoveEnd$.next(this.getSelectionDataWithStyle()), (A4 = this._escapeShortcutDisposable) == null || A4.dispose(), this._escapeShortcutDisposable = null;
    }), (P8 = this._scene.getEngine()) == null || P8.setCapture();
  }
};
cd3 = jy([
  zn3(1, Inject(Injector)),
  zn3(2, Inject(Ji)),
  zn3(3, Le),
  zn3(4, Inject(z)),
  zn3(5, Inject(he2)),
  zn3(6, Nt),
  zn3(7, Ds),
  zn3(8, Tr)
], cd3);
var Yy = Object.defineProperty;
var Zy = Object.getOwnPropertyDescriptor;
var Gy = (n3, e, t3) => e in n3 ? Yy(n3, e, { enumerable: true, configurable: true, writable: true, value: t3 }) : n3[e] = t3;
var qy = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? Zy(e, t3) : e, o3 = n3.length - 1, s2; o3 >= 0; o3--)
    (s2 = n3[o3]) && (i = s2(i) || i);
  return i;
};
var so3 = (n3, e) => (t3, r) => e(t3, r, n3);
var zp = (n3, e, t3) => Gy(n3, typeof e != "symbol" ? e + "" : e, t3);
var Ll3 = class extends yl {
  /** @ignore */
  constructor(n3 = hl2, e, t3, r, i, o3) {
    super(), this._config = n3, this._injector = e, this._renderManagerService = t3, this._configService = r, this._univerInstanceService = i, this._componentManager = o3;
    const _a5 = co(
      {},
      hl2,
      this._config
    ), { menu: s2 } = _a5, l4 = __objRest(_a5, ["menu"]);
    if (l4.protectedRangeUserSelector) {
      const { component: a4, framework: c2 } = l4.protectedRangeUserSelector;
      this.disposeWithMe(
        this._componentManager.register(
          pa5,
          a4,
          {
            framework: c2
          }
        )
      );
    }
    s2 && this._configService.setConfig("menu", s2, { merge: true }), this._configService.setConfig(Tt2, __spreadValues({}, l4));
  }
  onStarting() {
    eR(this._injector, uC([
      [_i2],
      [Qe3, { useClass: cl2 }],
      [tn3, { useClass: ol2 }],
      [Lr4, { useClass: zm }],
      [Nn, { useClass: al2 }],
      [ds2, { useClass: Qm }],
      [us2, { useClass: hf }],
      [Ku, { useClass: Co }],
      [Nr3, { useClass: nl2 }],
      [Up],
      [Ha3, { useClass: gf }],
      [Xi3, { useClass: rl2 }],
      [Mr3],
      [No3],
      [Pi],
      [Er3],
      [Fo3],
      [ou2],
      [Fp, { useClass: kl3 }],
      [ko4],
      // controllers
      [xi2],
      [pi2],
      [Ir4],
      [yr4],
      [rr4],
      [Sl3],
      [Tr4],
      [yi3],
      [Vi3],
      [Ai2],
      [Hi3],
      [Oi4],
      [Ei2],
      // permission
      [Rr4],
      [Ni2],
      [Dr4],
      [ad3],
      [ki2],
      [Ti2],
      [Di2]
    ], this._config.override));
  }
  onReady() {
    this._config.disableAutoFocus || this._initAutoFocus(), eR(this._injector, [
      [Pr4]
    ]), this._registerRenderBasics(), Kc(this._injector, [
      [Sl3],
      [rr4],
      [xi2],
      [Ti2],
      [Ni2]
    ]);
  }
  onRendered() {
    this._registerRenderModules(), Kc(this._injector, [
      [Di2],
      [Rr4],
      [Pr4],
      [yr4],
      [Ai2],
      [Tr4],
      [pi2],
      [Ir4],
      [Hi3],
      [Oi4],
      [Ei2]
    ]);
  }
  onSteady() {
    Kc(this._injector, [
      [Vi3],
      [yi3],
      [ki2]
    ]);
  }
  _registerRenderBasics() {
    [
      [he2],
      [Vl2],
      [vl2],
      [gt, { useClass: cd3 }],
      [Nl4]
    ].forEach((n3) => {
      this.disposeWithMe(this._renderManagerService.registerRenderModule(we.UNIVER_SHEET, n3));
    });
  }
  // We have to let render basics get bootstrapped before. Because some render controllers relies on
  // a correct skeleton when they get loaded.
  _registerRenderModules() {
    var r;
    const n3 = [
      [Wo],
      [Hl3],
      [Bo],
      // Caution: ScrollRenderController should placed before ZoomRenderController.
      [Et3],
      [Ri3],
      [Lo4],
      [Ho2],
      [Ol2],
      [xl3],
      [Cl2],
      [wl3],
      [bl2],
      [Rl2],
      [ml2],
      [ul2],
      [_l2],
      [dl2],
      [ld2],
      [yl4],
      // editor
      [Do3],
      // permission
      [Ml2],
      [El2],
      [Tl2],
      [Pl2]
    ], e = this._configService.getConfig(ae);
    ((r = e == null ? void 0 : e.contextMenu) != null ? r : true) && n3.push([Al2]), n3.forEach((i) => {
      this.disposeWithMe(this._renderManagerService.registerRenderModule(we.UNIVER_SHEET, i));
    });
  }
  _initAutoFocus() {
    const n3 = this._univerInstanceService;
    this.disposeWithMe(n3.getCurrentTypeOfUnit$(we.UNIVER_SHEET).pipe(filter((e) => !!e)).subscribe((e) => n3.focusUnit(e.getUnitId())));
  }
};
zp(Ll3, "pluginName", "SHEET_UI_PLUGIN");
zp(Ll3, "type", we.UNIVER_SHEET);
Ll3 = qy([
  sI(rs2),
  so3(1, Inject(Injector)),
  so3(2, JE),
  so3(3, xs),
  so3(4, br),
  so3(5, Inject(S13))
], Ll3);
function wM(n3, e, t3, r) {
  const { from: i, to: o3 } = t3, { column: s2, columnOffset: l4, row: a4, rowOffset: c2 } = i, { column: d2, columnOffset: u2, row: h9, rowOffset: m9 } = o3, g9 = r.ensureSkeleton(e);
  if (g9 == null)
    throw new Error("No current skeleton");
  const f4 = Io3(g9, {
    startColumn: s2,
    endColumn: s2,
    startRow: a4,
    endRow: a4
  }), p3 = Io3(g9, {
    startColumn: d2,
    endColumn: d2,
    startRow: h9,
    endRow: h9
  }), { startX: v6, startY: S } = f4, { startX: w6, startY: C } = p3, I6 = de(v6 + l4, 1), R9 = de(S + c2, 1);
  let y6 = de(w6 + u2 - I6, 1), E3 = de(C + m9 - R9, 1);
  return f4.startX === p3.endX && (y6 = 0), f4.startY === p3.endY && (E3 = 0), {
    unitId: n3,
    subUnitId: e,
    left: I6,
    top: R9,
    width: y6,
    height: E3
  };
}
function bM(n3, e, t3, r, i, o3, s2) {
  const { column: l4, columnOffset: a4, row: c2, rowOffset: d2 } = t3, u2 = s2.ensureSkeleton(e);
  if (u2 == null)
    throw new Error("No current skeleton");
  const h9 = Io3(u2, {
    startColumn: l4,
    endColumn: l4,
    startRow: c2,
    endRow: c2
  }), { startX: m9, startY: g9 } = h9, f4 = de(m9 + a4, 1), p3 = de(g9 + d2, 1), v6 = o3.getCellWithCoordByOffset(f4 + r, p3 + i, u2);
  if (v6 == null)
    throw new Error("No end selection cell");
  const S = {
    column: v6.actualColumn,
    columnOffset: de(f4 + r - v6.startX, 1),
    row: v6.actualRow,
    rowOffset: de(p3 + i - v6.startY, 1)
  };
  return {
    unitId: n3,
    subUnitId: e,
    sheetTransform: {
      from: {
        column: l4,
        columnOffset: a4,
        row: c2,
        rowOffset: d2
      },
      to: S
    },
    transform: {
      left: f4,
      top: p3,
      width: r,
      height: i
    }
  };
}

// node_modules/@univerjs/sheets-formula-ui/lib/es/index.js
var import_jsx_runtime2 = __toESM(require_jsx_runtime());
var import_react2 = __toESM(require_react());
var Zr5 = Object.defineProperty;
var zr4 = (e, t3, n3) => t3 in e ? Zr5(e, t3, { enumerable: true, configurable: true, writable: true, value: n3 }) : e[t3] = n3;
var j2 = (e, t3, n3) => zr4(e, typeof t3 != "symbol" ? t3 + "" : t3, n3);
var _n4 = {
  id: "sheet.command.paste-formula",
  type: Ls.COMMAND,
  handler: (e) => __async(void 0, null, function* () {
    return e.get(Ds).executeCommand(un2.id, {
      value: et4.SPECIAL_PASTE_FORMULA
    });
  })
};
var gt2 = {
  id: "formula-ui.operation.select-editor-formula",
  type: Ls.OPERATION,
  handler: (e, t3) => true
};
var Ms4 = Object.getOwnPropertyDescriptor;
var ws3 = (e, t3, n3, o3) => {
  for (var r = o3 > 1 ? void 0 : o3 ? Ms4(t3, n3) : t3, s2 = e.length - 1, i; s2 >= 0; s2--)
    (i = e[s2]) && (r = i(r) || r);
  return r;
};
var ks3 = (e, t3) => (n3, o3) => t3(n3, o3, e);
var As = "FORMULA_PROMPT_ACTIVATED";
var zt3 = createIdentifier("formula-ui.prompt-service");
var sn2 = class {
  constructor(e) {
    j2(this, "_search$", new Subject());
    j2(this, "_help$", new Subject());
    j2(this, "_navigate$", new Subject());
    j2(this, "_accept$", new Subject());
    j2(this, "_acceptFormulaName$", new Subject());
    j2(this, "search$", this._search$.asObservable());
    j2(this, "help$", this._help$.asObservable());
    j2(this, "navigate$", this._navigate$.asObservable());
    j2(this, "accept$", this._accept$.asObservable());
    j2(this, "acceptFormulaName$", this._acceptFormulaName$.asObservable());
    j2(this, "_searching", false);
    j2(this, "_helping", false);
    j2(this, "_sequenceNodes", []);
    j2(this, "_isLockedOnSelectionChangeRefString", false);
    j2(this, "_isLockedOnSelectionInsertRefString", false);
    this._contextService = e;
  }
  dispose() {
    this._search$.complete(), this._help$.complete(), this._navigate$.complete(), this._accept$.complete(), this._acceptFormulaName$.complete(), this._sequenceNodes = [];
  }
  search(e) {
    this._contextService.setContextValue(As, e.visible), this._searching = e.visible, this._search$.next(e);
  }
  isSearching() {
    return this._searching;
  }
  help(e) {
    this._helping = e.visible, this._help$.next(e);
  }
  isHelping() {
    return this._helping;
  }
  navigate(e) {
    this._navigate$.next(e);
  }
  accept(e) {
    this._accept$.next(e);
  }
  acceptFormulaName(e) {
    this._acceptFormulaName$.next(e);
  }
  getSequenceNodes() {
    return [...this._sequenceNodes];
  }
  setSequenceNodes(e) {
    this._sequenceNodes = e;
  }
  clearSequenceNodes() {
    this._sequenceNodes = [];
  }
  getCurrentSequenceNode(e) {
    return this._sequenceNodes[this.getCurrentSequenceNodeIndex(e)];
  }
  getCurrentSequenceNodeByIndex(e) {
    return this._sequenceNodes[e];
  }
  /**
   * Query the text coordinates in the sequenceNodes and determine the actual insertion index.
   * @param strIndex
   */
  getCurrentSequenceNodeIndex(e) {
    let t3 = 0;
    const n3 = this._sequenceNodes[0];
    for (let o3 = 0, r = this._sequenceNodes.length; o3 < r; o3++) {
      const s2 = this._sequenceNodes[o3];
      if (typeof s2 == "string")
        t3++;
      else {
        const { endIndex: i } = s2;
        t3 = i;
      }
      if (e <= t3)
        return typeof n3 == "string" && e !== 0 ? o3 + 1 : o3;
    }
    return this._sequenceNodes.length;
  }
  /**
   * Synchronize the reference text based on the changes of the selection.
   * @param nodeIndex
   * @param refString
   */
  updateSequenceRef(e, t3) {
    const n3 = this._sequenceNodes[e];
    if (typeof n3 == "string" || n3.nodeType !== He.REFERENCE)
      return;
    const o3 = t3.length - n3.token.length, r = __spreadValues({}, n3);
    r.token = t3, r.endIndex += o3, this._sequenceNodes[e] = r;
    for (let s2 = e + 1, i = this._sequenceNodes.length; s2 < i; s2++) {
      const c2 = this._sequenceNodes[s2];
      if (typeof c2 == "string")
        continue;
      const l4 = __spreadValues({}, c2);
      l4.startIndex += o3, l4.endIndex += o3, this._sequenceNodes[s2] = l4;
    }
  }
  /**
   * When the cursor is on the right side of a formula token,
   * you can add reference text to the formula by drawing a selection.
   * @param index
   * @param refString
   */
  insertSequenceRef(e, t3) {
    const n3 = t3.length, o3 = this.getCurrentSequenceNodeIndex(e);
    this._sequenceNodes.splice(o3, 0, {
      token: t3,
      startIndex: e,
      endIndex: e + n3 - 1,
      nodeType: He.REFERENCE
    });
    for (let r = o3 + 1, s2 = this._sequenceNodes.length; r < s2; r++) {
      const i = this._sequenceNodes[r];
      if (typeof i == "string")
        continue;
      const c2 = __spreadValues({}, i);
      c2.startIndex += n3, c2.endIndex += n3, this._sequenceNodes[r] = c2;
    }
  }
  /**
   * Insert a string at the cursor position in the text corresponding to the sequenceNodes.
   * @param index
   * @param content
   */
  insertSequenceString(e, t3) {
    const n3 = this.getCurrentSequenceNodeIndex(e), o3 = t3.split("");
    this._sequenceNodes.splice(n3, 0, ...o3);
    const r = o3.length;
    for (let s2 = n3 + r, i = this._sequenceNodes.length; s2 < i; s2++) {
      const c2 = this._sequenceNodes[s2];
      if (typeof c2 == "string")
        continue;
      const l4 = __spreadValues({}, c2);
      l4.startIndex += r, l4.endIndex += r, this._sequenceNodes[s2] = l4;
    }
  }
  enableLockedSelectionChange() {
    this._isLockedOnSelectionChangeRefString = true;
  }
  disableLockedSelectionChange() {
    this._isLockedOnSelectionChangeRefString = false;
  }
  isLockedSelectionChange() {
    return this._isLockedOnSelectionChangeRefString;
  }
  enableLockedSelectionInsert() {
    this._isLockedOnSelectionInsertRefString = true;
  }
  disableLockedSelectionInsert() {
    this._isLockedOnSelectionInsertRefString = false;
  }
  isLockedSelectionInsert() {
    return this._isLockedOnSelectionInsertRefString;
  }
};
sn2 = ws3([
  ks3(0, Tr)
], sn2);
var Fs3 = {
  id: "formula-ui.operation.help-function",
  type: Ls.OPERATION,
  handler: (e, t3) => __async(void 0, null, function* () {
    return e.get(zt3).help(t3), true;
  })
};
var pe2 = {
  id: "formula-ui.operation.insert-function",
  type: Ls.OPERATION,
  // eslint-disable-next-line
  handler: (e, t3) => __async(void 0, null, function* () {
    var C, _3;
    const n3 = e.get(z), o3 = e.get(Ge3), r = n3.getCurrentSelections();
    if (!r || !r.length)
      return false;
    const s2 = P5(e.get(br));
    if (!s2) return false;
    const { worksheet: i, unitId: c2, subUnitId: l4 } = s2, m9 = i.getCellMatrix(), { value: h9 } = t3, f4 = e.get(Ds);
    e.get(Qe3);
    const d2 = [], u2 = [];
    let a4 = null, v6 = 0, p3 = 0, S = "";
    if (r.length === 1 && (Ls4(r[0].range) || Ps3(r[0].range) && Zn2(m9, r[0].range))) {
      const { range: E3, primary: g9 } = r[0], b4 = (C = g9 == null ? void 0 : g9.actualRow) != null ? C : E3.startRow, y6 = (_3 = g9 == null ? void 0 : g9.actualColumn) != null ? _3 : E3.startColumn;
      a4 = E3, v6 = b4, p3 = y6;
      const A4 = Gn3(m9, b4, y6);
      A4 && (S = Yt(A4));
    } else
      r.some((E3) => {
        var y6, A4;
        const { range: g9, primary: b4 } = E3;
        if (Zn2(m9, g9)) {
          const F7 = (y6 = b4 == null ? void 0 : b4.actualRow) != null ? y6 : g9.startRow, N6 = (A4 = b4 == null ? void 0 : b4.actualColumn) != null ? A4 : g9.startColumn, O9 = Gn3(m9, F7, N6);
          if (!O9)
            return a4 = g9, v6 = F7, p3 = N6, true;
          const k6 = Yt(O9), I6 = `=${h9}(${k6})`;
          d2.push({
            range: g9,
            primary: {
              row: F7,
              column: N6
            },
            formula: I6
          });
        } else {
          const { startRow: F7, startColumn: N6, endRow: O9, endColumn: k6 } = g9;
          if (F7 === O9) {
            const I6 = Us2(m9, F7, k6, i.getColumnCount() - 1), x7 = I6 === k6 ? k6 - 1 : k6, R9 = Yt({
              startRow: F7,
              endRow: O9,
              startColumn: N6,
              endColumn: x7
            }), w6 = `=${h9}(${R9})`;
            u2.push({
              range: g9,
              primary: {
                row: F7,
                column: I6
              },
              formula: w6
            });
          } else {
            let I6 = -1;
            for (let R9 = N6; R9 <= k6; R9++) {
              const w6 = Vs3(m9, R9, O9, i.getRowCount() - 1);
              I6 = Math.max(I6, w6);
            }
            const x7 = I6 === O9 ? O9 - 1 : O9;
            for (let R9 = N6; R9 <= k6; R9++) {
              const w6 = Yt({
                startRow: F7,
                endRow: x7,
                startColumn: R9,
                endColumn: R9
              }), D5 = `=${h9}(${w6})`;
              u2.push({
                range: g9,
                primary: {
                  row: I6,
                  column: R9
                },
                formula: D5
              });
            }
          }
        }
        return false;
      });
    if (a4) {
      const E3 = Lh(v6, p3, i), g9 = {
        range: Cn.clone(a4),
        primary: {
          startRow: E3.startRow,
          startColumn: E3.startColumn,
          endRow: E3.endRow,
          endColumn: E3.endColumn,
          actualRow: v6,
          actualColumn: p3,
          isMerged: E3.isMerged,
          isMergedMainCell: E3.startRow === v6 && E3.startColumn === p3
        }
      }, b4 = {
        unitId: c2,
        subUnitId: l4,
        selections: [g9]
      };
      yield f4.executeCommand(ie5.id, b4);
      const y6 = o3.getEditor(Fl), A4 = o3.getEditor(Hl);
      f4.syncExecuteCommand(tt5.id, {
        visible: true,
        unitId: c2,
        eventType: hb.Dblclick
      });
      const F7 = `=${h9}(${S}`;
      y6 == null || y6.replaceText(F7), A4 == null || A4.replaceText(F7, false);
    }
    return d2.length === 0 && u2.length === 0 ? false : f4.executeCommand(Ri2.id, {
      list: d2,
      listOfRangeHasNumber: u2
    });
  })
};
function Gn3(e, t3, n3) {
  const o3 = Ds3(e, t3, n3);
  if (o3 !== t3)
    return {
      startRow: o3,
      endRow: t3 - 1,
      startColumn: n3,
      endColumn: n3
    };
  const r = $s3(e, t3, n3);
  return r !== n3 ? {
    startRow: t3,
    endRow: t3,
    startColumn: r,
    endColumn: n3 - 1
  } : null;
}
function Ds3(e, t3, n3) {
  let o3 = false;
  if (t3 === 0) return t3;
  for (let r = t3 - 1; r >= 0; r--) {
    const s2 = e.getValue(r, n3);
    if (_t4(s2) && !o3) {
      if (r === 0) return 0;
      o3 = true;
    } else {
      if (o3 && !_t4(s2))
        return r + 1;
      if (o3 && r === 0)
        return 0;
    }
  }
  return t3;
}
function $s3(e, t3, n3) {
  let o3 = false;
  if (n3 === 0) return n3;
  for (let r = n3 - 1; r >= 0; r--) {
    const s2 = e.getValue(t3, r);
    if (_t4(s2) && !o3) {
      if (r === 0) return 0;
      o3 = true;
    } else {
      if (o3 && !_t4(s2))
        return r + 1;
      if (o3 && r === 0)
        return 0;
    }
  }
  return n3;
}
function _t4(e) {
  if (e != null && e.p) {
    const t3 = e == null ? void 0 : e.p.body;
    if (t3 == null)
      return false;
    const n3 = t3.dataStream, r = n3.substring(n3.length - 2, n3.length) === Yc ? n3.substring(0, n3.length - 2) : n3;
    return s1(r);
  }
  return e && (e.t === mn.NUMBER || FR(e) === mn.NUMBER);
}
function Ls4(e) {
  return e.startRow === e.endRow && e.startColumn === e.endColumn;
}
function Ps3(e) {
  return e.startRow !== e.endRow && e.startColumn !== e.endColumn;
}
function Zn2(e, t3) {
  for (let n3 = t3.startRow; n3 <= t3.endRow; n3++)
    for (let o3 = t3.startColumn; o3 <= t3.endColumn; o3++)
      if (_t4(e.getValue(n3, o3)))
        return false;
  return true;
}
function Us2(e, t3, n3, o3) {
  for (let r = n3; r <= o3; r++)
    if (!e.getValue(t3, r))
      return r;
  return o3;
}
function Vs3(e, t3, n3, o3) {
  for (let r = n3; r <= o3; r++)
    if (!e.getValue(r, t3))
      return r;
  return o3;
}
var br7 = "SHEET_FORMULA_UI_PLUGIN";
var yr5 = `${br7}_MORE_FUNCTIONS_COMPONENT`;
var Rn2 = {
  id: "formula-ui.operation.more-functions",
  type: Ls.OPERATION,
  handler: (e) => __async(void 0, null, function* () {
    return e.get(be2).open({
      header: { title: "formula.insert.tooltip" },
      children: { label: yr5 }
    }), true;
  })
};
var Tr5 = {
  id: "formula-ui.operation.change-ref-to-absolute",
  type: Ls.OPERATION,
  handler: (e) => __async(void 0, null, function* () {
    return true;
  })
};
var Ws2 = {
  id: "formula-ui.operation.search-function",
  type: Ls.OPERATION,
  handler: (e, t3) => __async(void 0, null, function* () {
    return e.get(zt3).search(t3), true;
  })
};
var Hs3 = Object.getOwnPropertyDescriptor;
var Bs3 = (e, t3, n3, o3) => {
  for (var r = o3 > 1 ? void 0 : o3 ? Hs3(t3, n3) : t3, s2 = e.length - 1, i; s2 >= 0; s2--)
    (i = e[s2]) && (r = i(r) || r);
  return r;
};
var kt4 = (e, t3) => (n3, o3) => t3(n3, o3, e);
var Pt5 = class extends Ve {
  constructor(e, t3, n3, o3) {
    super(), this._sheetInterceptorService = e, this._univerInstanceService = t3, this._formulaDataModel = n3, this._lexerTreeBuilder = o3, this._initialize();
  }
  _initialize() {
    this.disposeWithMe(this._sheetInterceptorService.interceptCommand({
      getMutations: (e) => e.id === ks.id ? this._reorderFormula(e.params) : {
        redos: [],
        undos: []
      }
    }));
  }
  _reorderFormula(e) {
    const t3 = [], n3 = [], { unitId: o3, subUnitId: r, range: s2, order: i } = e, c2 = this._univerInstanceService.getUniverSheetInstance(o3), l4 = c2 == null ? void 0 : c2.getSheetBySheetId(r);
    if (!l4)
      return {
        redos: t3,
        undos: n3
      };
    const m9 = l4.getCellMatrix(), h9 = new ht(), f4 = new ht();
    let d2 = false;
    return vr.foreach(s2, (u2, a4) => {
      let v6 = u2;
      i.hasOwnProperty(u2) && (v6 = i[u2]);
      const p3 = m9.getValue(v6, a4);
      if (p3 != null && p3.f || p3 != null && p3.si) {
        d2 = true;
        const S = this._formulaDataModel.getFormulaStringByCell(v6, a4, r, o3), C = this._lexerTreeBuilder.moveFormulaRefOffset(
          S,
          0,
          u2 - v6
        ), _3 = Z.deepClone(p3);
        _3.f = C, _3.si = null, h9.setValue(u2, a4, _3);
      } else
        h9.setValue(u2, a4, p3);
      f4.setValue(u2, a4, m9.getValue(u2, a4));
    }), d2 ? (t3.push({
      id: ee2.id,
      params: {
        unitId: o3,
        subUnitId: r,
        cellValue: h9.getMatrix()
      }
    }), n3.push({
      id: ee2.id,
      params: {
        unitId: o3,
        subUnitId: r,
        cellValue: f4.getMatrix()
      }
    }), {
      redos: t3,
      undos: n3
    }) : {
      redos: t3,
      undos: n3
    };
  }
};
Pt5 = Bs3([
  kt4(0, Inject(G)),
  kt4(1, Inject(br)),
  kt4(2, Inject(yr)),
  kt4(3, Inject(Mn))
], Pt5);
var Nr4 = "sheets-formula-ui.base.config";
var zn4 = {};
var qs2 = Object.getOwnPropertyDescriptor;
var js3 = (e, t3, n3, o3) => {
  for (var r = o3 > 1 ? void 0 : o3 ? qs2(t3, n3) : t3, s2 = e.length - 1, i; s2 >= 0; s2--)
    (i = e[s2]) && (r = i(r) || r);
  return r;
};
var pt4 = (e, t3) => (n3, o3) => t3(n3, o3, e);
var en2 = "SHEET_FORMULA_ALERT";
var Ks2 = {
  [h.DIV_BY_ZERO]: "divByZero",
  [h.NAME]: "name",
  [h.VALUE]: "value",
  [h.NUM]: "num",
  [h.NA]: "na",
  [h.CYCLE]: "cycle",
  [h.REF]: "ref",
  [h.SPILL]: "spill",
  [h.CALC]: "calc",
  [h.ERROR]: "error",
  [h.CONNECT]: "connect",
  [h.NULL]: "null"
};
var cn2 = class extends Ve {
  constructor(e, t3, n3, o3, r, s2) {
    super(), this._context = e, this._hoverManagerService = t3, this._cellAlertManagerService = n3, this._localeService = o3, this._formulaDataModel = r, this._zenZoneService = s2, this._init();
  }
  _init() {
    this._initCellAlertPopup(), this._initZenService();
  }
  _initCellAlertPopup() {
    this.disposeWithMe(this._hoverManagerService.currentCell$.pipe(debounceTime(100)).subscribe((e) => {
      var t3, n3, o3, r, s2;
      if (e) {
        const c2 = this._context.unit.getActiveSheet();
        if (!c2) return this._hideAlert();
        const l4 = c2.getCell(e.location.row, e.location.col), m9 = (r = (o3 = (n3 = (t3 = this._formulaDataModel.getArrayFormulaCellData()) == null ? void 0 : t3[e.location.unitId]) == null ? void 0 : n3[e.location.subUnitId]) == null ? void 0 : o3[e.location.row]) == null ? void 0 : r[e.location.col];
        if (Wg(l4)) {
          const h9 = $b(l4, !!m9);
          if (!h9) {
            this._hideAlert();
            return;
          }
          const f4 = this._cellAlertManagerService.currentAlert.get(en2), d2 = (s2 = f4 == null ? void 0 : f4.alert) == null ? void 0 : s2.location;
          if (d2 && d2.row === e.location.row && d2.col === e.location.col && d2.subUnitId === e.location.subUnitId && d2.unitId === e.location.unitId) {
            this._hideAlert();
            return;
          }
          this._cellAlertManagerService.showAlert({
            type: Co2.ERROR,
            title: this._localeService.t("formula.error.title"),
            message: this._localeService.t(`formula.error.${Ks2[h9]}`),
            location: e.location,
            width: 200,
            height: 74,
            key: en2
          });
          return;
        }
      }
      this._hideAlert();
    }));
  }
  _initZenService() {
    this.disposeWithMe(this._zenZoneService.visible$.subscribe((e) => {
      e && this._hideAlert();
    }));
  }
  _hideAlert() {
    this._cellAlertManagerService.removeAlert(en2);
  }
};
cn2 = js3([
  pt4(1, Inject(Mr3)),
  pt4(2, Inject(Fo3)),
  pt4(3, Inject(Hn)),
  pt4(4, Inject(yr)),
  pt4(5, lt)
], cn2);
var Ys2 = Object.getOwnPropertyDescriptor;
var Gs2 = (e, t3, n3, o3) => {
  for (var r = o3 > 1 ? void 0 : o3 ? Ys2(t3, n3) : t3, s2 = e.length - 1, i; s2 >= 0; s2--)
    (i = e[s2]) && (r = i(r) || r);
  return r;
};
var Xn5 = (e, t3) => (n3, o3) => t3(n3, o3, e);
var Ut4 = class extends Ve {
  constructor(e, t3) {
    super(), this._autoFillService = e, this._lexerTreeBuilder = t3, this._registerAutoFill();
  }
  _registerAutoFill() {
    const e = {
      type: mt4.FORMULA,
      priority: 1001,
      match: (t3) => Jg(t3 == null ? void 0 : t3.f) || KR(t3 == null ? void 0 : t3.si),
      isContinue: (t3, n3) => t3.type === mt4.FORMULA,
      applyFunctions: {
        [Le4.COPY]: (t3, n3, o3, r, s2) => {
          const { data: i, index: c2 } = t3;
          return this._fillCopyFormula(i, n3, o3, c2, r, s2);
        }
      }
    };
    this._autoFillService.registerRule(e);
  }
  _fillCopyFormula(e, t3, n3, o3, r, s2) {
    var m9, h9;
    const i = zs2(r), c2 = [], l4 = /* @__PURE__ */ new Map();
    for (let f4 = 1; f4 <= t3; f4++) {
      const d2 = (f4 - 1) % e.length, u2 = o3[d2], a4 = Z.deepClone(e[d2]);
      if (a4) {
        const v6 = ((m9 = e[d2]) == null ? void 0 : m9.f) || "", p3 = ((h9 = e[d2]) == null ? void 0 : h9.si) || "", S = Jg(v6);
        if (KR(p3))
          a4.si = p3, a4.f = null, a4.v = null, a4.p = null, a4.t = null, c2.push(a4);
        else if (S) {
          let _3 = l4.get(d2);
          if (_3)
            a4.si = _3, a4.f = null, a4.v = null, a4.p = null, a4.t = null;
          else {
            _3 = et(6), l4.set(d2, _3);
            const { offsetX: E3, offsetY: g9 } = Zs2(i, t3, n3, s2, u2), b4 = this._lexerTreeBuilder.moveFormulaRefOffset(
              v6,
              E3,
              g9
            );
            a4.si = _3, a4.f = b4, a4.v = null, a4.p = null, a4.t = null;
          }
          c2.push(a4);
        }
      }
    }
    return c2;
  }
};
Ut4 = Gs2([
  Xn5(0, Nr3),
  Xn5(1, Inject(Mn))
], Ut4);
function Zs2(e, t3, n3, o3, r) {
  const { source: s2, target: i } = o3, { rows: c2 } = i, { rows: l4 } = s2;
  let m9 = 0, h9 = 0;
  switch (n3) {
    case wm.UP:
      h9 = c2[r] - l4[r];
      break;
    case wm.RIGHT:
      m9 = e;
      break;
    case wm.DOWN:
      h9 = c2[r] - l4[r];
      break;
    case wm.LEFT:
      m9 = -e * t3;
      break;
  }
  return { offsetX: m9, offsetY: h9 };
}
function zs2(e) {
  let t3 = 0;
  for (const n3 in e)
    e[n3].forEach((o3) => {
      t3 += o3.data.length;
    });
  return t3;
}
var Xs2 = Object.getOwnPropertyDescriptor;
var Qs2 = (e, t3, n3, o3) => {
  for (var r = o3 > 1 ? void 0 : o3 ? Xs2(t3, n3) : t3, s2 = e.length - 1, i; s2 >= 0; s2--)
    (i = e[s2]) && (r = i(r) || r);
  return r;
};
var St3 = (e, t3) => (n3, o3) => t3(n3, o3, e);
var Js4 = "default-paste-formula";
var Vt2 = class extends Ve {
  constructor(e, t3, n3, o3, r) {
    super(), this._currentUniverSheet = e, this._lexerTreeBuilder = t3, this._sheetClipboardService = n3, this._injector = o3, this._formulaDataModel = r, this._initialize();
  }
  _initialize() {
    this._registerClipboardHook();
  }
  _registerClipboardHook() {
    this.disposeWithMe(this._sheetClipboardService.addClipboardHook(this._pasteFormulaHook())), this.disposeWithMe(this._sheetClipboardService.addClipboardHook(this._pasteWithFormulaHook()));
  }
  _pasteFormulaHook() {
    return {
      id: et4.SPECIAL_PASTE_FORMULA,
      priority: 10,
      specialPasteInfo: { label: "specialPaste.formula" },
      onPasteCells: (e, t3, n3, o3) => this._onPasteCells(e, t3, n3, o3, true)
    };
  }
  _pasteWithFormulaHook() {
    return {
      id: Js4,
      priority: 10,
      onPasteCells: (e, t3, n3, o3) => this._onPasteCells(e, t3, n3, o3, false)
    };
  }
  _onPasteCells(e, t3, n3, o3, r) {
    var d2;
    if ([
      et4.SPECIAL_PASTE_FORMAT,
      et4.SPECIAL_PASTE_COL_WIDTH
    ].includes(o3.pasteType))
      return {
        undos: [],
        redos: []
      };
    const i = this._currentUniverSheet.getCurrentUnitForType(we.UNIVER_SHEET), c2 = t3.unitId || i.getUnitId(), l4 = t3.subUnitId || ((d2 = i.getActiveSheet()) == null ? void 0 : d2.getSheetId());
    if (!c2 || !l4)
      return {
        undos: [],
        redos: []
      };
    const m9 = t3.range, h9 = n3, f4 = {
      copyType: o3.copyType || jn4.COPY,
      copyRange: e == null ? void 0 : e.range,
      pasteType: o3.pasteType
    };
    return this._injector.invoke((u2) => ei2(
      c2,
      l4,
      m9,
      h9,
      u2,
      f4,
      this._lexerTreeBuilder,
      this._formulaDataModel,
      r,
      e
    ));
  }
};
Vt2 = Qs2([
  St3(0, br),
  St3(1, Inject(Mn)),
  St3(2, tn3),
  St3(3, Inject(Injector)),
  St3(4, Inject(yr))
], Vt2);
function ei2(e, t3, n3, o3, r, s2, i, c2, l4 = false, m9) {
  const h9 = [], f4 = [], d2 = ti4(e, t3, n3, o3, s2, i, c2, m9);
  if (!d2.hasValue())
    return {
      undos: [],
      redos: []
    };
  const u2 = {
    unitId: e,
    subUnitId: t3,
    cellValue: d2.getData()
  };
  h9.push({
    id: ee2.id,
    params: u2
  });
  const a4 = Ae4(
    r,
    u2
  );
  return f4.push({
    id: ee2.id,
    params: a4
  }), {
    undos: f4,
    redos: h9
  };
}
function ti4(e, t3, n3, o3, r, s2, i, c2) {
  return c2 ? r.pasteType === et4.SPECIAL_PASTE_VALUE ? ri2(e, t3, n3, o3, i, c2) : r.pasteType === et4.SPECIAL_PASTE_FORMULA ? oi2(e, t3, n3, o3, s2, i, c2) : si2(e, t3, n3, o3, r.copyType, s2, i, c2) : ni4(e, t3, n3, o3, i);
}
function ni4(e, t3, n3, o3, r) {
  const s2 = new ht(), i = r.getSheetFormulaData(e, t3);
  return o3.forValue((c2, l4, m9) => {
    var u2;
    const h9 = n3.rows[c2], f4 = n3.cols[l4], d2 = {};
    Jg(m9.v) ? (d2.v = null, d2.f = `${m9.v}`, d2.si = null, d2.p = null, s2.setValue(h9, f4, d2)) : (u2 = i == null ? void 0 : i[h9]) != null && u2[f4] && (d2.v = m9.v, d2.f = null, d2.si = null, d2.p = null, s2.setValue(h9, f4, d2));
  }), s2;
}
function ri2(e, t3, n3, o3, r, s2) {
  var m9, h9;
  const i = new ht(), c2 = (h9 = (m9 = r.getArrayFormulaCellData()) == null ? void 0 : m9[s2.unitId]) == null ? void 0 : h9[s2.subUnitId], l4 = r.getSheetFormulaData(e, t3);
  return o3.forValue((f4, d2, u2) => {
    var _3, E3;
    const a4 = s2.range.rows[f4 % s2.range.rows.length], v6 = s2.range.cols[d2 % s2.range.cols.length], p3 = n3.rows[f4], S = n3.cols[d2], C = {};
    if (Jg(u2.f) || KR(u2.si))
      C.v = u2.v, C.f = null, C.si = null, C.p = null, i.setValue(p3, S, C);
    else if ((_3 = c2 == null ? void 0 : c2[a4]) != null && _3[v6]) {
      const g9 = c2[a4][v6];
      C.v = g9.v, C.f = null, C.si = null, C.p = null, i.setValue(p3, S, C);
    } else if ((E3 = l4 == null ? void 0 : l4[p3]) != null && E3[S]) {
      if (C.v = u2.v, C.f = null, C.si = null, C.p = null, u2.p) {
        const g9 = Or3(u2);
        g9 && (C.v = g9);
      }
      i.setValue(p3, S, C);
    }
  }), i;
}
function oi2(e, t3, n3, o3, r, s2, i) {
  const c2 = new ht(), l4 = /* @__PURE__ */ new Map();
  return o3.forValue((m9, h9, f4) => {
    const d2 = n3.rows[m9], u2 = n3.cols[h9], a4 = {};
    if (KR(f4.si)) {
      if (i.unitId !== e || i.subUnitId !== t3) {
        const v6 = s2.getFormulaStringByCell(
          i.range.rows[m9 % i.range.rows.length],
          i.range.cols[h9 % i.range.cols.length],
          i.subUnitId,
          i.unitId
        ), p3 = n3.cols[h9] - i.range.cols[h9 % i.range.cols.length], S = n3.rows[m9] - i.range.rows[m9 % i.range.rows.length], C = r.moveFormulaRefOffset(v6 || "", p3, S);
        a4.si = null, a4.f = C;
      } else
        a4.si = f4.si, a4.f = null;
      a4.v = null, a4.p = null, c2.setValue(d2, u2, a4);
    } else if (Jg(f4.f)) {
      const v6 = `${m9 % i.range.rows.length}_${h9 % i.range.cols.length}`;
      let p3 = l4.get(v6);
      if (p3)
        a4.si = p3, a4.f = null;
      else {
        p3 = et(6), l4.set(v6, p3);
        const S = n3.cols[h9] - i.range.cols[h9 % i.range.cols.length], C = n3.rows[m9] - i.range.rows[m9 % i.range.rows.length], _3 = r.moveFormulaRefOffset(f4.f || "", S, C);
        a4.si = p3, a4.f = _3;
      }
      a4.v = null, a4.p = null, c2.setValue(d2, u2, a4);
    } else {
      if (a4.v = f4.v, a4.f = null, a4.si = null, a4.p = null, f4.p) {
        const v6 = Or3(f4);
        v6 && (a4.v = v6);
      }
      c2.setValue(d2, u2, a4);
    }
  }), c2;
}
function si2(e, t3, n3, o3, r, s2, i, c2) {
  const l4 = new ht(), m9 = /* @__PURE__ */ new Map(), h9 = i.getSheetFormulaData(e, t3), f4 = [];
  return r === jn4.CUT ? o3.forValue((d2, u2, a4) => {
    const v6 = n3.rows[d2], p3 = n3.cols[u2], S = {};
    if (KR(a4.si)) {
      if (Jg(a4.f))
        f4.push(a4.si), S.f = a4.f, S.si = a4.si;
      else if (f4.includes(a4.si))
        S.f = null, S.si = a4.si;
      else {
        const C = i.getFormulaStringByCell(
          c2.range.rows[d2 % c2.range.rows.length],
          c2.range.cols[u2 % c2.range.cols.length],
          c2.subUnitId,
          c2.unitId
        );
        S.f = C, S.si = null;
      }
      S.v = null, S.p = null, l4.setValue(v6, p3, S);
    } else Jg(a4.f) && (S.f = a4.f, S.si = null, S.v = null, S.p = null, l4.setValue(v6, p3, S));
  }) : o3.forValue((d2, u2, a4) => {
    var C;
    const v6 = n3.rows[d2], p3 = n3.cols[u2], S = {};
    if (KR(a4.si)) {
      if (c2.unitId !== e || c2.subUnitId !== t3) {
        const _3 = i.getFormulaStringByCell(
          c2.range.rows[d2 % c2.range.rows.length],
          c2.range.cols[u2 % c2.range.cols.length],
          c2.subUnitId,
          c2.unitId
        ), E3 = n3.cols[u2] - c2.range.cols[u2 % c2.range.cols.length], g9 = n3.rows[d2] - c2.range.rows[d2 % c2.range.rows.length], b4 = s2.moveFormulaRefOffset(_3 || "", E3, g9);
        S.si = null, S.f = b4;
      } else
        S.si = a4.si, S.f = null;
      S.v = null, S.p = null, l4.setValue(v6, p3, S);
    } else if (Jg(a4.f)) {
      const _3 = `${d2 % c2.range.rows.length}_${u2 % c2.range.cols.length}`;
      let E3 = m9.get(_3);
      if (E3)
        S.si = E3, S.f = null;
      else {
        E3 = et(6), m9.set(_3, E3);
        const g9 = n3.cols[u2] - c2.range.cols[u2 % c2.range.cols.length], b4 = n3.rows[d2] - c2.range.rows[d2 % c2.range.rows.length], y6 = s2.moveFormulaRefOffset(a4.f || "", g9, b4);
        S.si = E3, S.f = y6;
      }
      S.v = null, S.p = null, l4.setValue(v6, p3, S);
    } else (C = h9 == null ? void 0 : h9[v6]) != null && C[p3] && (S.v = a4.v, S.f = null, S.si = null, S.p = a4.p, l4.setValue(v6, p3, S));
  }), f4.length > 0 && new ht(h9).forValue((d2, u2, a4) => {
    if (!(c2.range.rows.includes(d2) && c2.range.cols.includes(u2)) && !(n3.rows.includes(d2) && n3.cols.includes(u2)) && f4.includes(a4 == null ? void 0 : a4.si)) {
      const v6 = i.getFormulaStringByCell(
        d2,
        u2,
        c2.subUnitId,
        c2.unitId
      );
      l4.setValue(d2, u2, {
        f: v6,
        si: null,
        v: null,
        p: null
      });
    }
  }), l4;
}
function Or3(e) {
  if (e != null && e.p) {
    const t3 = e == null ? void 0 : e.p.body;
    if (t3 == null)
      return;
    const n3 = t3.dataStream;
    return n3.substring(n3.length - 2, n3.length) === Yc ? n3.substring(0, n3.length - 2) : n3;
  }
}
var ii2 = Object.getOwnPropertyDescriptor;
var ci3 = (e, t3, n3, o3) => {
  for (var r = o3 > 1 ? void 0 : o3 ? ii2(t3, n3) : t3, s2 = e.length - 1, i; s2 >= 0; s2--)
    (i = e[s2]) && (r = i(r) || r);
  return r;
};
var He4 = (e, t3) => (n3, o3) => t3(n3, o3, e);
var Wt4 = class extends Ve {
  constructor(t3, n3, o3, r, s2, i, c2, l4) {
    super();
    j2(this, "_previousShape");
    j2(this, "_skeleton");
    this._context = t3, this._sheetInterceptorService = n3, this._formulaDataModel = o3, this._themeService = r, this._renderManagerService = s2, this._sheetSkeletonManagerService = i, this._commandService = c2, this._logService = l4, this._initSkeletonChangeListener(), this._initInterceptorEditorStart(), this._commandExecutedListener();
  }
  _initSkeletonChangeListener() {
    this.disposeWithMe(
      this._sheetSkeletonManagerService.currentSkeleton$.subscribe((t3) => {
        var n3, o3;
        if (t3 == null)
          this._logService.debug("[FormulaEditorShowController]: should not receive currentSkeleton$ as null!");
        else {
          const { skeleton: r } = t3, s2 = (o3 = (n3 = this._skeleton) == null ? void 0 : n3.worksheet) == null ? void 0 : o3.getSheetId();
          if (this._changeRuntime(r), s2 !== r.worksheet.getSheetId())
            this._removeArrayFormulaRangeShape();
          else {
            const { unitId: i, sheetId: c2 } = t3;
            this._updateArrayFormulaRangeShape(i, c2);
          }
        }
      })
    );
  }
  _changeRuntime(t3) {
    this._skeleton = t3;
  }
  _initInterceptorEditorStart() {
    this.disposeWithMe(
      Be(
        this._sheetInterceptorService.writeCellInterceptor.intercept(co3, {
          handler: (t3, n3, o3) => {
            var a4, v6, p3, S;
            const { row: r, col: s2, unitId: i, subUnitId: c2, worksheet: l4 } = n3, m9 = this._formulaDataModel.getArrayFormulaRange(), h9 = this._formulaDataModel.getArrayFormulaCellData();
            if (this._removeArrayFormulaRangeShape(), t3 == null)
              return o3(t3);
            let f4 = null;
            const d2 = this._formulaDataModel.getFormulaStringByCell(r, s2, c2, i);
            if (d2 !== null && (f4 = { f: d2 }), t3.v != null && t3.v !== "" && ((p3 = (v6 = (a4 = h9[i]) == null ? void 0 : a4[c2]) == null ? void 0 : v6[r]) == null ? void 0 : p3[s2]) == null)
              return f4 ? __spreadValues(__spreadValues({}, t3), f4) : o3(t3);
            const u2 = (S = m9 == null ? void 0 : m9[i]) == null ? void 0 : S[c2];
            return u2 != null && (f4 = this._displayArrayFormulaRangeShape(u2, r, s2, i, c2, l4, f4)), f4 ? __spreadValues(__spreadValues({}, t3), f4) : o3(t3);
          }
        })
      )
    );
  }
  _commandExecutedListener() {
    this.disposeWithMe(this._commandService.onCommandExecuted((t3, n3) => {
      (t3.id === Mo2.id || t3.id === vs2.id && n3 && n3.remove) && this._removeArrayFormulaRangeShape();
    })), this.disposeWithMe(
      this._commandService.beforeCommandExecuted((t3) => {
        er2.id === t3.id && requestIdleCallback(() => {
          const n3 = t3.params, { unitId: o3, subUnitId: r, rowsAutoHeightInfo: s2 } = n3;
          this._refreshArrayFormulaRangeShapeByRow(o3, r, s2);
        });
      })
    );
  }
  _displayArrayFormulaRangeShape(t3, n3, o3, r, s2, i, c2) {
    return new ht(t3).forValue((l4, m9, h9) => {
      if (h9 == null)
        return true;
      const { startRow: f4, startColumn: d2, endRow: u2, endColumn: a4 } = h9;
      if (l4 === n3 && m9 === o3)
        return this._createArrayFormulaRangeShape(h9, r), false;
      if (n3 >= f4 && n3 <= u2 && o3 >= d2 && o3 <= a4) {
        const v6 = i.getCell(f4, d2);
        return (v6 == null ? void 0 : v6.v) === h.SPILL || (v6 == null ? void 0 : v6.f) == null ? void 0 : (c2 == null && (c2 = {
          f: v6.f,
          isInArrayFormulaRange: true
        }), this._createArrayFormulaRangeShape(h9, r), false);
      }
    }), c2;
  }
  _createArrayFormulaRangeShape(t3, n3) {
    const o3 = this._renderManagerService.getRenderById(n3), r = this._sheetSkeletonManagerService.getCurrentSkeleton();
    if (!o3 || !r) return;
    const { scene: s2 } = o3;
    if (!s2) return;
    const i = {
      range: t3,
      primary: null,
      style: {
        strokeWidth: 1,
        stroke: this._themeService.getColorFromTheme("primary.600"),
        fill: new At(this._themeService.getColorFromTheme("white")).setAlpha(0).toString(),
        widgets: {}
      }
    }, c2 = Wt3(i, r), { rowHeaderWidth: l4, columnHeaderHeight: m9 } = r, h9 = new jd2(s2, Rm.FORMULA_EDITOR_SHOW, this._themeService, {
      highlightHeader: false,
      rowHeaderWidth: l4,
      columnHeaderHeight: m9
    });
    h9.updateRangeBySelectionWithCoord(c2), h9.setEvent(false), this._previousShape = h9;
  }
  _removeArrayFormulaRangeShape() {
    this._previousShape != null && (this._previousShape.dispose(), this._previousShape = null);
  }
  _refreshArrayFormulaRangeShape(t3, n3) {
    if (this._previousShape) {
      const { startRow: o3, endRow: r, startColumn: s2, endColumn: i } = this._previousShape.getRange(), c2 = { startRow: o3, endRow: r, startColumn: s2, endColumn: i };
      this._removeArrayFormulaRangeShape(), this._createArrayFormulaRangeShape(c2, t3);
    }
  }
  _checkCurrentSheet(t3, n3) {
    const o3 = this._sheetSkeletonManagerService.getCurrentSkeleton();
    if (!o3) return false;
    const r = o3.worksheet;
    return r ? r.unitId === t3 && r.getSheetId() === n3 : false;
  }
  _updateArrayFormulaRangeShape(t3, n3) {
    this._checkCurrentSheet(t3, n3) && this._previousShape && this._refreshArrayFormulaRangeShape(t3);
  }
  _refreshArrayFormulaRangeShapeByRow(t3, n3, o3) {
    if (!this._checkCurrentSheet(t3, n3) || !this._previousShape) return;
    const { startRow: r, endRow: s2, startColumn: i, endColumn: c2 } = this._previousShape.getRange();
    for (let l4 = 0; l4 < o3.length; l4++) {
      const { row: m9 } = o3[l4];
      if (r >= m9) {
        const h9 = {
          startRow: r,
          endRow: s2,
          startColumn: i,
          endColumn: c2
        };
        this._refreshArrayFormulaRangeShape(t3, h9);
        break;
      }
    }
  }
};
Wt4 = ci3([
  He4(1, Inject(G)),
  He4(2, Inject(yr)),
  He4(3, Inject(Ji)),
  He4(4, JE),
  He4(5, Inject(he2)),
  He4(6, Ds),
  He4(7, Nt)
], Wt4);
var ai3 = Object.getOwnPropertyDescriptor;
var li3 = (e, t3, n3, o3) => {
  for (var r = o3 > 1 ? void 0 : o3 ? ai3(t3, n3) : t3, s2 = e.length - 1, i; s2 >= 0; s2--)
    (i = e[s2]) && (r = i(r) || r);
  return r;
};
var Qn2 = (e, t3) => (n3, o3) => t3(n3, o3, e);
var ui3 = {
  tl: {
    size: 6,
    color: "#409f11"
  }
};
var Ht4 = class extends ER {
  constructor(e, t3) {
    super(), this._sheetInterceptorService = e, this._formulaDataModel = t3, this.disposeWithMe(this._sheetInterceptorService.intercept(
      ht2.CELL_CONTENT,
      {
        effect: ir.Style,
        handler: (n3, o3, r) => {
          var c2, l4, m9, h9;
          const s2 = (h9 = (m9 = (l4 = (c2 = this._formulaDataModel.getArrayFormulaCellData()) == null ? void 0 : c2[o3.unitId]) == null ? void 0 : l4[o3.subUnitId]) == null ? void 0 : m9[o3.row]) == null ? void 0 : h9[o3.col];
          return !$b(n3, !!s2) || !n3 || (n3 === o3.rawData && (n3 = __spreadValues({}, o3.rawData)), n3.markers = __spreadValues(__spreadValues({}, n3 == null ? void 0 : n3.markers), ui3)), r(n3);
        },
        priority: 10
      }
    ));
  }
};
Ht4 = li3([
  Qn2(0, Inject(G)),
  Qn2(1, Inject(yr))
], Ht4);
function di3() {
  const e = useDependency(ge4), t3 = useDependency(Ds), n3 = useObservable(e.progress$), o3 = (0, import_react2.useCallback)(() => {
    t3.executeCommand(So2.id);
  }, [t3]), r = (0, import_react2.useCallback)(() => {
    e.clearProgress();
  }, [e]);
  return (0, import_jsx_runtime2.jsx)(i7, { progress: n3, onTerminate: o3, onClearProgress: r });
}
function hi4(e, t3) {
  return Object.keys(e).filter((n3) => isNaN(Number(n3)) && n3 !== "DefinedName" && n3 !== "Table").map((n3) => ({
    label: t3.t(`formula.functionType.${n3.toLocaleLowerCase()}`),
    value: `${e[n3]}`
  }));
}
function xr3(e) {
  if (!e.require && !e.repeat)
    return `[${e.name}]`;
  if (e.require && !e.repeat)
    return e.name;
  if (!e.require && e.repeat)
    return `[${e.name},...]`;
  if (e.require && e.repeat)
    return `${e.name},...`;
}
function Mr4(e) {
  const { prefix: t3, value: n3 } = e;
  return (0, import_jsx_runtime2.jsxs)("div", { children: [
    (0, import_jsx_runtime2.jsxs)("span", { children: [
      t3,
      "("
    ] }),
    n3 && n3.map((o3, r) => (0, import_jsx_runtime2.jsxs)("span", { children: [
      (0, import_jsx_runtime2.jsx)("span", { children: xr3(o3) }),
      r === n3.length - 1 ? "" : ","
    ] }, r)),
    ")"
  ] });
}
function vt3(e) {
  const { className: t3, value: n3, title: o3 } = e;
  return (0, import_jsx_runtime2.jsxs)("div", { className: "univer-mb-2 univer-text-xs", children: [
    (0, import_jsx_runtime2.jsx)(
      "div",
      {
        className: ie2("univer-mb-2 univer-font-medium univer-text-gray-500 dark:!univer-text-gray-300", t3),
        children: o3
      }
    ),
    (0, import_jsx_runtime2.jsx)(
      "div",
      {
        className: "univer-break-all univer-text-gray-900 dark:!univer-text-white",
        children: n3
      }
    )
  ] });
}
function fi3(e) {
  const { functionInfo: t3, onChange: n3 } = e;
  if (!t3) return null;
  const [o3, r] = (0, import_react2.useState)([]), [s2, i] = (0, import_react2.useState)(t3.functionParameter), [c2, l4] = (0, import_react2.useState)(-1);
  return (0, import_jsx_runtime2.jsxs)("div", { children: [
    (0, import_jsx_runtime2.jsx)("div", { className: ie2("univer-h-[364px] univer-overflow-y-auto", vr2), children: s2.map((m9, h9) => (0, import_jsx_runtime2.jsxs)("div", { children: [
      (0, import_jsx_runtime2.jsx)("div", { className: "univer-text-sm", children: m9.name }),
      (0, import_jsx_runtime2.jsx)("div", { className: "univer-mb-2 univer-mt-1" })
    ] }, h9)) }),
    (0, import_jsx_runtime2.jsx)("div", { className: ie2("univer-flex-1 univer-p-3", tm), children: (0, import_jsx_runtime2.jsx)(
      vt3,
      {
        title: c2 === -1 ? (0, import_jsx_runtime2.jsx)(Mr4, { prefix: t3.functionName, value: s2 }) : s2[c2].name,
        value: c2 === -1 ? t3.description : s2[c2].detail
      }
    ) })
  ] });
}
function tt6(_a5) {
  var _b3 = _a5, { ref: e } = _b3, t3 = __objRest(_b3, ["ref"]);
  const _a6 = t3, { icon: n3, id: o3, className: r, extend: s2 } = _a6, i = __objRest(_a6, ["icon", "id", "className", "extend"]), c2 = `univerjs-icon univerjs-icon-${o3} ${r || ""}`.trim(), l4 = (0, import_react2.useRef)(`_${pi3()}`);
  return wr5(n3, `${o3}`, {
    defIds: n3.defIds,
    idSuffix: l4.current
  }, __spreadValues({
    ref: e,
    className: c2
  }, i), s2);
}
function wr5(e, t3, n3, o3, r) {
  return (0, import_react2.createElement)(e.tag, __spreadValues(__spreadValues({
    key: t3
  }, gi4(e, n3, r)), o3), (mi2(e, n3).children || []).map((s2, i) => wr5(s2, `${t3}-${e.tag}-${i}`, n3, void 0, r)));
}
function gi4(e, t3, n3) {
  const o3 = __spreadValues({}, e.attrs);
  n3 != null && n3.colorChannel1 && o3.fill === "colorChannel1" && (o3.fill = n3.colorChannel1), e.tag === "mask" && o3.id && (o3.id = o3.id + t3.idSuffix), Object.entries(o3).forEach(([s2, i]) => {
    s2 === "mask" && typeof i == "string" && (o3[s2] = i.replace(/url\(#(.*)\)/, `url(#$1${t3.idSuffix})`));
  });
  const { defIds: r } = t3;
  return !r || r.length === 0 || (e.tag === "use" && o3["xlink:href"] && (o3["xlink:href"] = o3["xlink:href"] + t3.idSuffix), Object.entries(o3).forEach(([s2, i]) => {
    typeof i == "string" && (o3[s2] = i.replace(/url\(#(.*)\)/, `url(#$1${t3.idSuffix})`));
  })), o3;
}
function mi2(e, t3) {
  var o3;
  const { defIds: n3 } = t3;
  return !n3 || n3.length === 0 ? e : e.tag === "defs" && ((o3 = e.children) != null && o3.length) ? __spreadProps(__spreadValues({}, e), {
    children: e.children.map((r) => typeof r.attrs.id == "string" && n3 && n3.includes(r.attrs.id) ? __spreadProps(__spreadValues({}, r), {
      attrs: __spreadProps(__spreadValues({}, r.attrs), {
        id: r.attrs.id + t3.idSuffix
      })
    }) : r)
  }) : e;
}
function pi3() {
  return Math.random().toString(36).substring(2, 8);
}
tt6.displayName = "UniverIcon";
var Si4 = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M14.1544 3.75557C14.3887 3.98988 14.3887 4.36978 14.1544 4.6041L6.51409 12.2444C6.40157 12.3569 6.24896 12.4201 6.08983 12.4201C5.9307 12.4201 5.77808 12.3569 5.66556 12.2444L1.84541 8.42425C1.6111 8.18993 1.6111 7.81003 1.84541 7.57572C2.07973 7.34141 2.45963 7.34141 2.69394 7.57572L6.08983 10.9716L13.3059 3.75557C13.5402 3.52126 13.9201 3.52126 14.1544 3.75557Z",
      fillRule: "evenodd",
      clipRule: "evenodd"
    }
  }]
};
var kr5 = (0, import_react2.forwardRef)(function(t3, n3) {
  return (0, import_react2.createElement)(tt6, Object.assign({}, t3, {
    id: "check-mark-icon",
    ref: n3,
    icon: Si4
  }));
});
kr5.displayName = "CheckMarkIcon";
var vi5 = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M3.71274 2.86421C3.47843 2.6299 3.09853 2.6299 2.86421 2.86421C2.6299 3.09853 2.6299 3.47843 2.86421 3.71274L7.15154 8.00007L2.86421 12.2874C2.6299 12.5217 2.6299 12.9016 2.86421 13.1359C3.09853 13.3702 3.47843 13.3702 3.71274 13.1359L8.00007 8.84859L12.2874 13.1359C12.5217 13.3702 12.9016 13.3702 13.1359 13.1359C13.3702 12.9016 13.3702 12.5217 13.1359 12.2874L8.84859 8.00007L13.1359 3.71274C13.3702 3.47843 13.3702 3.09853 13.1359 2.86421C12.9016 2.6299 12.5217 2.6299 12.2874 2.86421L8.00007 7.15154L3.71274 2.86421Z"
    }
  }]
};
var Ar3 = (0, import_react2.forwardRef)(function(t3, n3) {
  return (0, import_react2.createElement)(tt6, Object.assign({}, t3, {
    id: "close-icon",
    ref: n3,
    icon: vi5
  }));
});
Ar3.displayName = "CloseIcon";
var Ci5 = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M5.3313 1.4667C5.3313 1.13533 5.59993 0.866699 5.9313 0.866699H10.069C10.4004 0.866699 10.669 1.13533 10.669 1.4667C10.669 1.79807 10.4004 2.0667 10.069 2.0667H5.9313C5.59993 2.0667 5.3313 1.79807 5.3313 1.4667Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M1.09985 3.64443C1.09985 3.31306 1.36848 3.04443 1.69985 3.04443H14.2999C14.6312 3.04443 14.8999 3.31306 14.8999 3.64443C14.8999 3.9758 14.6312 4.24443 14.2999 4.24443H1.69985C1.36848 4.24443 1.09985 3.9758 1.09985 3.64443Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M6.12398 8.30171C6.35829 8.0674 6.73819 8.0674 6.97251 8.30171L8.00007 9.32928L9.02764 8.30171C9.26195 8.0674 9.64185 8.0674 9.87617 8.30171C10.1105 8.53603 10.1105 8.91593 9.87617 9.15024L8.8486 10.1778L9.87617 11.2054C10.1105 11.4397 10.1105 11.8196 9.87617 12.0539C9.64185 12.2882 9.26195 12.2882 9.02764 12.0539L8.00007 11.0263L6.97251 12.0539C6.73819 12.2882 6.35829 12.2882 6.12398 12.0539C5.88966 11.8196 5.88966 11.4397 6.12398 11.2054L7.15154 10.1778L6.12398 9.15024C5.88966 8.91593 5.88966 8.53603 6.12398 8.30171Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M4.75332 5.22217C3.86966 5.22217 3.15332 5.93851 3.15332 6.82217V12.5331C3.15332 13.9691 4.31738 15.1332 5.75332 15.1332H10.2465C11.6825 15.1332 12.8465 13.9691 12.8465 12.5331V6.82217C12.8465 5.93851 12.1302 5.22217 11.2465 5.22217H4.75332ZM4.35332 6.82217C4.35332 6.60125 4.53241 6.42217 4.75332 6.42217H11.2465C11.4674 6.42217 11.6465 6.60125 11.6465 6.82217V12.5331C11.6465 13.3063 11.0197 13.9332 10.2465 13.9332H5.75332C4.98012 13.9332 4.35332 13.3063 4.35332 12.5331V6.82217Z",
        fillRule: "evenodd",
        clipRule: "evenodd"
      }
    }
  ]
};
var Fr4 = (0, import_react2.forwardRef)(function(t3, n3) {
  return (0, import_react2.createElement)(tt6, Object.assign({}, t3, {
    id: "delete-icon",
    ref: n3,
    icon: Ci5
  }));
});
Fr4.displayName = "DeleteIcon";
var _i3 = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M8.6 1.99991C8.60001 1.66854 8.33138 1.39991 8.00001 1.3999C7.66864 1.3999 7.40001 1.66853 7.4 1.9999L7.39996 7.3999H1.9999C1.66853 7.3999 1.3999 7.66853 1.3999 7.9999C1.3999 8.33127 1.66853 8.5999 1.9999 8.5999H7.39995L7.3999 13.9999C7.3999 14.3313 7.66853 14.5999 7.9999 14.5999C8.33127 14.5999 8.5999 14.3313 8.5999 13.9999L8.59995 8.5999H13.9999C14.3313 8.5999 14.5999 8.33127 14.5999 7.9999C14.5999 7.66853 14.3313 7.3999 13.9999 7.3999H8.59996L8.6 1.99991Z"
    }
  }]
};
var Dr5 = (0, import_react2.forwardRef)(function(t3, n3) {
  return (0, import_react2.createElement)(tt6, Object.assign({}, t3, {
    id: "increase-icon",
    ref: n3,
    icon: _i3
  }));
});
Dr5.displayName = "IncreaseIcon";
var Ri4 = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M5.90913 3.57564C6.14345 3.34132 6.52335 3.34132 6.75766 3.57564L10.7577 7.57564C10.992 7.80995 10.992 8.18985 10.7577 8.42417L6.75766 12.4242C6.52335 12.6585 6.14345 12.6585 5.90913 12.4242C5.67482 12.1899 5.67482 11.81 5.90913 11.5756L9.48487 7.9999L5.90913 4.42417C5.67482 4.18985 5.67482 3.80995 5.90913 3.57564Z",
      fillRule: "evenodd",
      clipRule: "evenodd"
    }
  }]
};
var $r4 = (0, import_react2.forwardRef)(function(t3, n3) {
  return (0, import_react2.createElement)(tt6, Object.assign({}, t3, {
    id: "more-icon",
    ref: n3,
    icon: Ri4
  }));
});
$r4.displayName = "MoreIcon";
var Ii3 = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M12.6185 12.4423C12.5907 12.2749 12.7773 12.15 12.9343 12.2308L15.4242 13.5126C15.6102 13.6084 15.5544 13.8745 15.3439 13.8955L14.2456 14.184L13.4521 15.1286C13.3495 15.2939 13.085 15.2463 13.0534 15.0568L12.6185 12.4423Z"
    }
  }, {
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M1 3.6C1 2.16406 2.16406 1 3.6 1H12.3C13.7359 1 14.9 2.16406 14.9 3.6V5.81156C14.9003 5.81881 14.9004 5.82609 14.9004 5.8334C14.9004 5.84071 14.9003 5.84799 14.9 5.85524V10.045C14.9003 10.0522 14.9004 10.0595 14.9004 10.0668C14.9004 10.3982 14.6318 10.6668 14.3004 10.6668H11.1668C10.8907 10.6668 10.6668 10.8907 10.6668 11.1668V14.3C10.6668 14.6314 10.3982 14.9 10.0668 14.9L10.05 14.8998L3.6 14.9C2.16406 14.9 1 13.7359 1 12.3V3.6ZM13.2 5.2334C13.4761 5.2334 13.7 5.00954 13.7 4.7334V3.6C13.7 2.8268 13.0732 2.2 12.3 2.2H11.1668C10.8907 2.2 10.6668 2.42386 10.6668 2.7V4.7334C10.6668 5.00954 10.8907 5.2334 11.1668 5.2334H13.2ZM10.6668 6.9334C10.6668 6.65726 10.8907 6.4334 11.1668 6.4334H13.2C13.4761 6.4334 13.7 6.65726 13.7 6.9334V8.9668C13.7 9.24294 13.4761 9.4668 13.2 9.4668H11.1668C10.8907 9.4668 10.6668 9.24294 10.6668 8.9668V6.9334ZM8.9668 5.2334C9.24294 5.2334 9.4668 5.00954 9.4668 4.7334V2.7C9.4668 2.42386 9.24294 2.2 8.9668 2.2H6.9334C6.65726 2.2 6.4334 2.42386 6.4334 2.7V4.7334C6.4334 5.00954 6.65726 5.2334 6.9334 5.2334L8.9668 5.2334ZM6.4334 6.9334C6.4334 6.65726 6.65726 6.4334 6.9334 6.4334L8.9668 6.4334C9.24294 6.4334 9.4668 6.65726 9.4668 6.9334V8.9668C9.4668 9.24294 9.24294 9.4668 8.9668 9.4668L6.9334 9.4668C6.65726 9.4668 6.4334 9.24294 6.4334 8.9668V6.9334ZM4.7334 5.2334C5.00954 5.2334 5.2334 5.00954 5.2334 4.7334V2.7C5.2334 2.42386 5.00954 2.2 4.7334 2.2H3.6C2.8268 2.2 2.2 2.8268 2.2 3.6V4.7334C2.2 5.00954 2.42386 5.2334 2.7 5.2334H4.7334ZM2.2 6.9334C2.2 6.65726 2.42386 6.4334 2.7 6.4334H4.7334C5.00954 6.4334 5.2334 6.65725 5.2334 6.9334V8.9668C5.2334 9.24294 5.00954 9.4668 4.7334 9.4668H2.7C2.42386 9.4668 2.2 9.24294 2.2 8.9668V6.9334ZM5.2334 11.1668C5.2334 10.8907 5.00954 10.6668 4.7334 10.6668H2.7C2.42386 10.6668 2.2 10.8907 2.2 11.1668V12.3C2.2 13.0732 2.8268 13.7 3.6 13.7H4.7334C5.00954 13.7 5.2334 13.4761 5.2334 13.2V11.1668ZM9.4668 11.1668C9.4668 10.8907 9.24294 10.6668 8.9668 10.6668H6.9334C6.65726 10.6668 6.4334 10.8907 6.4334 11.1668V13.2C6.4334 13.4761 6.65726 13.7 6.9334 13.7H8.9668C9.24294 13.7 9.4668 13.4761 9.4668 13.2V11.1668Z",
      fillRule: "evenodd",
      clipRule: "evenodd"
    }
  }]
};
var Lr5 = (0, import_react2.forwardRef)(function(t3, n3) {
  return (0, import_react2.createElement)(tt6, Object.assign({}, t3, {
    id: "select-range-icon",
    ref: n3,
    icon: Ii3
  }));
});
Lr5.displayName = "SelectRangeIcon";
function Ei3(e) {
  const { onChange: t3 } = e, n3 = "-1", [o3, r] = (0, import_react2.useState)(""), [s2, i] = (0, import_react2.useState)([]), [c2, l4] = (0, import_react2.useState)(0), [m9, h9] = (0, import_react2.useState)(n3), [f4, d2] = (0, import_react2.useState)(0), [u2, a4] = (0, import_react2.useState)(null), v6 = useDependency(Et2), p3 = useDependency(Hn), S = useDependency(be2), C = useObservable(S.sidebarOptions$), _3 = hi4(Kc2, p3);
  _3.unshift({
    label: p3.t("formula.moreFunctions.allFunctions"),
    value: n3
  });
  const E3 = p3.t("formula.prompt.required"), g9 = p3.t("formula.prompt.optional");
  (0, import_react2.useEffect)(() => {
    A4(n3);
  }, []), (0, import_react2.useEffect)(() => {
    y6(0);
  }, [s2]), (0, import_react2.useEffect)(() => {
    C != null && C.visible && (r(""), i([]), l4(0), h9(n3), d2(0), a4(null), A4(n3));
  }, [C]);
  const b4 = (I6) => {
    if (o3.trim() === "") return I6;
    const x7 = new RegExp(`(${o3.toLocaleUpperCase()})`);
    return I6.split(x7).filter(Boolean).map((w6, D5) => w6.match(x7) ? (0, import_jsx_runtime2.jsx)("span", { className: "univer-text-red-500", children: w6 }, D5) : w6);
  }, y6 = (I6) => {
    if (s2.length === 0) {
      a4(null);
      return;
    }
    d2(I6);
    const x7 = v6.getFunctionInfo(s2[I6].name);
    if (!x7) {
      a4(null);
      return;
    }
    a4(x7), t3(x7);
  };
  function A4(I6) {
    h9(I6);
    const x7 = v6.getSearchListByType(+I6);
    i(x7);
  }
  function F7(I6) {
    r(I6);
    const x7 = v6.getSearchListByName(I6);
    i(x7);
  }
  function N6(I6) {
    if (I6.stopPropagation(), I6.key === "ArrowDown") {
      const x7 = c2 + 1;
      l4(x7 === s2.length ? 0 : x7);
    } else if (I6.key === "ArrowUp") {
      const x7 = c2 - 1;
      l4(x7 === -1 ? s2.length - 1 : x7);
    } else I6.key === "Enter" && y6(c2);
  }
  const O9 = (I6) => {
    l4(I6);
  }, k6 = () => {
    l4(-1);
  };
  return (0, import_jsx_runtime2.jsxs)("div", { children: [
    (0, import_jsx_runtime2.jsxs)("div", { className: "univer-flex univer-items-center univer-justify-between univer-gap-2", children: [
      (0, import_jsx_runtime2.jsx)(KE, { value: m9, options: _3, onChange: A4 }),
      (0, import_jsx_runtime2.jsx)(
        eC,
        {
          placeholder: p3.t("formula.moreFunctions.searchFunctionPlaceholder"),
          onKeyDown: N6,
          value: o3,
          onChange: F7,
          size: "small",
          allowClear: true
        }
      )
    ] }),
    s2.length > 0 && (0, import_jsx_runtime2.jsx)(
      "ul",
      {
        className: ie2("univer-mb-0 univer-mt-2 univer-box-border univer-max-h-72 univer-w-full univer-select-none univer-list-none univer-overflow-y-auto univer-rounded univer-p-3 univer-outline-none", kt2, vr2),
        onKeyDown: N6,
        tabIndex: -1,
        children: s2.map(({ name: I6 }, x7) => (0, import_jsx_runtime2.jsxs)(
          "li",
          {
            className: ie2("univer-relative univer-box-border univer-cursor-pointer univer-rounded univer-px-7 univer-py-1 univer-text-sm univer-text-gray-900 univer-transition-colors dark:!univer-text-white", {
              "univer-bg-gray-200 dark:!univer-bg-gray-600": c2 === x7
            }),
            onMouseEnter: () => O9(x7),
            onMouseLeave: k6,
            onClick: () => y6(x7),
            children: [
              f4 === x7 && (0, import_jsx_runtime2.jsx)(
                kr5,
                {
                  className: "univer-absolute univer-left-1.5 univer-top-1/2 univer-inline-flex -univer-translate-y-1/2 univer-text-base univer-text-primary-600"
                }
              ),
              (0, import_jsx_runtime2.jsx)("span", { className: "univer-block", children: b4(I6) })
            ]
          },
          x7
        ))
      }
    ),
    u2 && (0, import_jsx_runtime2.jsxs)("div", { className: ie2("univer-mx-0 univer-my-2 univer-overflow-y-auto", vr2), children: [
      (0, import_jsx_runtime2.jsx)(vt3, { title: u2.functionName, value: u2.description }),
      (0, import_jsx_runtime2.jsx)(
        vt3,
        {
          title: p3.t("formula.moreFunctions.syntax"),
          value: (0, import_jsx_runtime2.jsx)(Mr4, { prefix: u2.functionName, value: u2.functionParameter })
        }
      ),
      (0, import_jsx_runtime2.jsx)(
        vt3,
        {
          title: p3.t("formula.prompt.helpExample"),
          value: `${u2.functionName}(${u2.functionParameter.map((I6) => I6.example).join(",")})`
        }
      ),
      u2.functionParameter && u2.functionParameter.map((I6) => (0, import_jsx_runtime2.jsx)(
        vt3,
        {
          title: I6.name,
          value: `${I6.require ? E3 : g9} ${I6.detail}`
        },
        I6.name
      ))
    ] })
  ] });
}
function bi5() {
  const e = Wr4(), [t3, n3] = (0, import_react2.useState)(true), [o3, r] = (0, import_react2.useState)(false), [s2, i] = (0, import_react2.useState)(null);
  useDependency(Qe3);
  const c2 = useDependency(Hn), l4 = useDependency(Ge3), m9 = useDependency(br), h9 = useDependency(Ds);
  function f4() {
    n3(!t3), r(!o3);
  }
  function d2() {
    const u2 = P5(m9);
    if (!u2) return;
    h9.executeCommand(tt5.id, {
      visible: true,
      unitId: u2.unitId,
      eventType: hb.Dblclick
    });
    const a4 = l4.getEditor(Fl), v6 = l4.getEditor(Hl), p3 = `=${s2 == null ? void 0 : s2.functionName}(`;
    a4 == null || a4.replaceText(p3), v6 == null || v6.replaceText(p3, false);
  }
  return (0, import_jsx_runtime2.jsxs)(
    "div",
    {
      "data-u-comp": "sheets-formula-functions-panel",
      className: "univer-box-border univer-flex univer-h-full univer-flex-col univer-justify-between univer-py-2",
      children: [
        t3 && (0, import_jsx_runtime2.jsx)(Ei3, { onChange: i }),
        o3 && (0, import_jsx_runtime2.jsx)(fi3, { functionInfo: s2, onChange: () => {
        } }),
        (0, import_jsx_runtime2.jsxs)("div", { className: "univer-flex univer-justify-end", children: [
          o3 && (0, import_jsx_runtime2.jsx)(
            fr,
            {
              variant: "primary",
              onClick: f4,
              className: "univer-mb-5 univer-ml-4 univer-mr-0 univer-mt-0",
              children: c2.t("formula.moreFunctions.next")
            }
          ),
          o3 && (0, import_jsx_runtime2.jsx)(fr, { onClick: f4, className: "univer-mb-5 univer-ml-4 univer-mr-0 univer-mt-0", children: c2.t("formula.moreFunctions.prev") }),
          t3 && !!e && (0, import_jsx_runtime2.jsx)(
            fr,
            {
              variant: "primary",
              onClick: d2,
              className: "univer-mb-5 univer-ml-4 univer-mr-0 univer-mt-0",
              children: c2.t("formula.moreFunctions.confirm")
            }
          )
        ] })
      ]
    }
  );
}
function yi4(e) {
  return {
    id: pe2.id,
    title: "SUM",
    icon: "SumIcon",
    type: H12.BUTTON,
    params: {
      value: "SUM"
    },
    hidden$: Xi(e, we.UNIVER_SHEET),
    disabled$: ue2(e, {
      workbookTypes: [Pe3],
      worksheetTypes: [Le2, An3],
      rangeTypes: [Ve4]
    })
  };
}
function Ti3(e) {
  return {
    id: pe2.id,
    title: "COUNT",
    icon: "CntIcon",
    type: H12.BUTTON,
    params: {
      value: "COUNT"
    },
    hidden$: Xi(e, we.UNIVER_SHEET),
    disabled$: ue2(e, {
      workbookTypes: [Pe3],
      worksheetTypes: [Le2, An3],
      rangeTypes: [Ve4]
    })
  };
}
function Ni3(e) {
  return {
    id: pe2.id,
    title: "AVERAGE",
    icon: "AvgIcon",
    type: H12.BUTTON,
    params: {
      value: "AVERAGE"
    },
    hidden$: Xi(e, we.UNIVER_SHEET),
    disabled$: ue2(e, {
      workbookTypes: [Pe3],
      worksheetTypes: [Le2, An3],
      rangeTypes: [Ve4]
    })
  };
}
function Oi5(e) {
  return {
    id: pe2.id,
    title: "MAX",
    icon: "MaxIcon",
    type: H12.BUTTON,
    params: {
      value: "MAX"
    },
    hidden$: Xi(e, we.UNIVER_SHEET),
    disabled$: ue2(e, {
      workbookTypes: [Pe3],
      worksheetTypes: [Le2, An3],
      rangeTypes: [Ve4]
    })
  };
}
function xi3(e) {
  return {
    id: pe2.id,
    title: "MIN",
    icon: "MinIcon",
    type: H12.BUTTON,
    params: {
      value: "MIN"
    },
    hidden$: Xi(e, we.UNIVER_SHEET),
    disabled$: ue2(e, {
      workbookTypes: [Pe3],
      worksheetTypes: [Le2, An3],
      rangeTypes: [Ve4]
    })
  };
}
function Mi3(e) {
  return {
    id: Rn2.id,
    title: "formula.insert.more",
    tooltip: "formula.insert.tooltip",
    type: H12.BUTTON,
    hidden$: Xi(e, we.UNIVER_SHEET),
    disabled$: ue2(e, {
      workbookTypes: [Pe3],
      worksheetTypes: [Le2, An3],
      rangeTypes: [Ve4]
    })
  };
}
function wi4(e) {
  return e.get(br).getCurrentTypeOfUnit$(we.UNIVER_SHEET).pipe(
    switchMap((o3) => o3 ? e.get(ar2) ? new Observable((s2) => s2.next(!e.get(ar2).supportClipboard)) : of(true) : of(true))
  );
}
function ki3(e) {
  return {
    id: _n4.id,
    type: H12.BUTTON,
    title: "formula.operation.pasteFormula",
    disabled$: wi4(e).pipe(
      combineLatestWith(ue2(e, {
        workbookTypes: [Pe3],
        rangeTypes: [Ve4],
        worksheetTypes: [An3, Le2]
      })),
      map(([t3, n3]) => t3 || n3)
    )
  };
}
var Ai3 = {
  [Z3.BASIC]: {
    [`${pe2.id}.sum`]: {
      order: 0,
      menuItemFactory: yi4
    },
    [`${pe2.id}.count`]: {
      order: 1,
      menuItemFactory: Ti3
    },
    [`${pe2.id}.average`]: {
      order: 2,
      menuItemFactory: Ni3
    },
    [`${pe2.id}.max`]: {
      order: 3,
      menuItemFactory: Oi5
    },
    [`${pe2.id}.min`]: {
      order: 4,
      menuItemFactory: xi3
    }
  },
  [Z3.OTHERS]: {
    [Rn2.id]: {
      order: 0,
      menuItemFactory: Mi3
    }
  },
  [Ds2]: {
    [_n4.id]: {
      order: 4,
      menuItemFactory: ki3
    }
  }
};
var Fi2 = "meta_key_ctrl_And_Shift";
function Di3(e) {
  return e.getContextValue(Jr) && e.getContextValue($1);
}
var Xt4 = [
  q1.ARROW_DOWN,
  q1.ARROW_UP,
  q1.ARROW_LEFT,
  q1.ARROW_RIGHT
];
var $i3 = [...Xt4, q1.ENTER, q1.TAB, q1.ESC];
function Li() {
  const e = [];
  for (const t3 of $i3)
    e.push({
      id: gt2.id,
      binding: t3,
      preconditions: (n3) => uM(n3),
      staticParameters: {
        eventType: hb.Keyboard,
        keycode: t3
      }
    });
  return e;
}
function Pi2() {
  const e = [];
  for (const t3 of Xt4)
    e.push({
      id: gt2.id,
      binding: t3 | y12.SHIFT,
      preconditions: (n3) => uM(n3),
      staticParameters: {
        eventType: hb.Keyboard,
        keycode: t3,
        metaKey: y12.SHIFT
      }
    });
  return e;
}
function Ui2() {
  const e = [];
  for (const t3 of Xt4)
    e.push({
      id: gt2.id,
      binding: t3 | y12.CTRL_COMMAND,
      preconditions: (n3) => uM(n3),
      staticParameters: {
        eventType: hb.Keyboard,
        keycode: t3,
        metaKey: y12.CTRL_COMMAND
      }
    });
  return e;
}
function Vi4() {
  const e = [];
  for (const t3 of Xt4)
    e.push({
      id: gt2.id,
      binding: t3 | y12.SHIFT | y12.CTRL_COMMAND,
      preconditions: (n3) => uM(n3),
      staticParameters: {
        eventType: hb.Keyboard,
        keycode: t3,
        metaKey: Fi2
      }
    });
  return e;
}
var Wi2 = {
  id: Tr5.id,
  binding: q1.F4,
  preconditions: (e) => uM(e)
};
function Hi4() {
  const e = [];
  for (const t3 of [q1.ENTER, q1.TAB, q1.ARROW_DOWN, q1.ARROW_UP])
    e.push({
      id: gt2.id,
      binding: t3,
      preconditions: (n3) => Di3(n3),
      staticParameters: {
        eventType: hb.Keyboard,
        keycode: t3,
        isSingleEditor: true
      }
    });
  return e;
}
var Bi3 = {
  id: Si2.id,
  binding: y12.ALT | q1.EQUAL,
  preconditions: Ne2,
  mac: y12.CTRL_COMMAND | y12.ALT | q1.EQUAL,
  description: "shortcut.sheets-formula-ui.quick-sum",
  group: "4_sheet-edit"
};
var qi4 = Object.getOwnPropertyDescriptor;
var ji4 = (e, t3, n3, o3) => {
  for (var r = o3 > 1 ? void 0 : o3 ? qi4(t3, n3) : t3, s2 = e.length - 1, i; s2 >= 0; s2--)
    (i = e[s2]) && (r = i(r) || r);
  return r;
};
var Be4 = (e, t3) => (n3, o3) => t3(n3, o3, e);
var Bt2 = class extends Ve {
  constructor(e, t3, n3, o3, r, s2, i) {
    super(), this._injector = e, this._menuManagerService = t3, this._commandService = n3, this._shortcutService = o3, this._uiPartsService = r, this._renderManagerService = s2, this._componentManager = i, this._initialize();
  }
  _initialize() {
    this._registerCommands(), this._registerMenus(), this._registerShortcuts(), this._registerComponents(), this._registerRenderModules();
  }
  _registerMenus() {
    this._menuManagerService.mergeMenu(Ai3);
  }
  _registerCommands() {
    [
      _n4,
      pe2,
      Rn2,
      Ws2,
      Fs3,
      gt2,
      Tr5
    ].forEach((e) => this.disposeWithMe(this._commandService.registerCommand(e)));
  }
  _registerShortcuts() {
    [
      ...Li(),
      ...Pi2(),
      ...Ui2(),
      ...Vi4(),
      ...Hi4(),
      Bi3,
      Wi2
    ].forEach((e) => {
      this.disposeWithMe(this._shortcutService.registerShortcut(e));
    });
  }
  _registerComponents() {
    this.disposeWithMe(this._uiPartsService.registerComponent(qm.FORMULA_AUX, () => connectInjector(di3, this._injector))), this._componentManager.register(yr5, bi5);
  }
  _registerRenderModules() {
    this.disposeWithMe(this._renderManagerService.registerRenderModule(we.UNIVER_SHEET, [Wt4]));
  }
};
Bt2 = ji4([
  Be4(0, Inject(Injector)),
  Be4(1, Z1),
  Be4(2, Ds),
  Be4(3, Le),
  Be4(4, N1),
  Be4(5, JE),
  Be4(6, Inject(S13))
], Bt2);
var Ki4 = Object.getOwnPropertyDescriptor;
var Yi3 = (e, t3, n3, o3) => {
  for (var r = o3 > 1 ? void 0 : o3 ? Ki4(t3, n3) : t3, s2 = e.length - 1, i; s2 >= 0; s2--)
    (i = e[s2]) && (r = i(r) || r);
  return r;
};
var tn4 = (e, t3) => (n3, o3) => t3(n3, o3, e);
var qt2 = class extends Ve {
  constructor(e, t3, n3) {
    super(), this._imageFormulaCellInterceptorController = e, this._renderManagerService = t3, this._univerInstanceService = n3, this._imageFormulaCellInterceptorController.registerRefreshRenderFunction(() => {
      const o3 = this._univerInstanceService.getCurrentUnitOfType(we.UNIVER_SHEET);
      if (!o3) return;
      const r = this._renderManagerService.getRenderById(o3.getUnitId());
      if (!r) return;
      r.with(he2).reCalculate();
      const s2 = r.mainComponent;
      s2 && s2.makeDirty();
    });
  }
};
qt2 = Yi3([
  tn4(0, Inject(Je4)),
  tn4(1, JE),
  tn4(2, br)
], qt2);
var Pr5 = class {
  constructor() {
    j2(this, "_currentSelector$", new BehaviorSubject(null));
    j2(this, "currentSelector$", this._currentSelector$.asObservable());
  }
  showRangeSelectorDialog(t3) {
    const n3 = t3.callback, o3 = new Promise((r) => {
      t3.callback = (s2) => {
        r(s2), n3(s2);
      };
    });
    return this._currentSelector$.next(t3), o3;
  }
};
var Gi4 = Object.getOwnPropertyDescriptor;
var Zi3 = (e, t3, n3, o3) => {
  for (var r = o3 > 1 ? void 0 : o3 ? Gi4(t3, n3) : t3, s2 = e.length - 1, i; s2 >= 0; s2--)
    (i = e[s2]) && (r = i(r) || r);
  return r;
};
var it2 = (e, t3) => (n3, o3) => t3(n3, o3, e);
var De = class extends Im2 {
  constructor(t3, n3, o3, r, s2, i, c2) {
    super(
      n3,
      o3,
      r,
      s2,
      i
    );
    j2(this, "_workbookSelections");
    j2(this, "_eventDisposables");
    this._context = t3, this._contextService = i, this._refSelectionsService = c2, this._workbookSelections = this._refSelectionsService.getWorkbookSelections(this._context.unitId), this._initSelectionChangeListener(), this._initSkeletonChangeListener(), this._initUserActionSyncListener(), this._setSelectionStyle(zi3(this._themeService)), this._remainLastEnabled = true, this._highlightHeader = false;
  }
  getLocation() {
    return this._skeleton.getLocation();
  }
  setRemainLastEnabled(t3) {
    this._remainLastEnabled = t3;
  }
  /**
   * This is set to true when you need to add a new selection.
   * @param {boolean} enabled
   * @memberof RefSelectionsRenderService
   */
  setSkipLastEnabled(t3) {
    this._skipLastEnabled = t3;
  }
  clearLastSelection() {
    const t3 = this._selectionControls[this._selectionControls.length - 1];
    t3 && (t3.dispose(), this._selectionControls.pop());
  }
  /**
   * Call this method and user will be able to select on the canvas to update selections.
   */
  enableSelectionChanging() {
    return this._disableSelectionChanging(), this._eventDisposables = this._initCanvasEventListeners(), Be(() => this._disableSelectionChanging());
  }
  _disableSelectionChanging() {
    var t3;
    (t3 = this._eventDisposables) == null || t3.dispose(), this._eventDisposables = null;
  }
  disableSelectionChanging() {
    this._disableSelectionChanging();
  }
  _initCanvasEventListeners() {
    const t3 = this._getSheetObject(), { spreadsheetRowHeader: n3, spreadsheetColumnHeader: o3, spreadsheet: r, spreadsheetLeftTopPlaceholder: s2 } = t3, { scene: i } = this._context, c2 = new ho();
    return c2.add(r == null ? void 0 : r.onPointerDown$.subscribeEvent((l4, m9) => {
      this.inRefSelectionMode() && (this._onPointerDown(l4, r.zIndex + 1, ge.NORMAL, this._getActiveViewport(l4)), l4.button !== 2 && m9.stopPropagation());
    })), c2.add(
      n3 == null ? void 0 : n3.onPointerDown$.subscribeEvent((l4, m9) => {
        if (!this.inRefSelectionMode()) return;
        const h9 = this._sheetSkeletonManagerService.getCurrent().skeleton, { row: f4 } = An4(l4.offsetX, l4.offsetY, i, h9);
        fl3(this._workbookSelections.getCurrentSelections(), f4, ge.ROW) || (this._onPointerDown(l4, (r.zIndex || 1) + 1, ge.ROW, this._getActiveViewport(l4), OE.Y), l4.button !== 2 && m9.stopPropagation());
      })
    ), c2.add(o3 == null ? void 0 : o3.onPointerDown$.subscribeEvent((l4, m9) => {
      if (!this.inRefSelectionMode()) return;
      const h9 = this._sheetSkeletonManagerService.getCurrent().skeleton, { column: f4 } = An4(l4.offsetX, l4.offsetY, i, h9);
      fl3(this._workbookSelections.getCurrentSelections(), f4, ge.COLUMN) || (this._onPointerDown(l4, (r.zIndex || 1) + 1, ge.COLUMN, this._getActiveViewport(l4), OE.X), l4.button !== 2 && m9.stopPropagation());
    })), c2.add(s2 == null ? void 0 : s2.onPointerDown$.subscribeEvent((l4, m9) => {
      if (this._reset(), !this.inRefSelectionMode()) return;
      const h9 = this._sheetSkeletonManagerService.getCurrent().skeleton, f4 = ym(h9);
      this._addSelectionControlByModelData(f4), this._selectionMoveStart$.next(this.getSelectionDataWithStyle());
      const d2 = i.onPointerUp$.subscribeEvent(() => {
        d2.unsubscribe(), this._selectionMoveEnd$.next(this.getSelectionDataWithStyle());
      });
      l4.button !== 2 && m9.stopPropagation();
    })), c2;
  }
  /**
   * Add a selection in spreadsheet, create a new SelectionControl and then update this control by range derives from selection.
   * For ref selection, create selectionShapeExtension to handle user action.
   * @param {ISelectionWithCoord} selectionWithStyle
   */
  _addSelectionControlByModelData(t3) {
    var i;
    const n3 = this._skeleton, o3 = (i = t3.style) != null ? i : Sr4(this._themeService), r = this._scene;
    return t3.style = o3, this.newSelectionControl(r, n3, t3);
  }
  _initSelectionChangeListener() {
    this.disposeWithMe(this._refSelectionsService.selectionSet$.subscribe((t3) => {
      this._reset(), this._skeleton && this.resetSelectionsByModelData(t3 || []);
    }));
  }
  /**
   * Update selectionModel in this._workbookSelections by user action in spreadsheet area.
   */
  _initUserActionSyncListener() {
    this.disposeWithMe(this.selectionMoveStart$.subscribe((t3) => {
      this._updateSelections(t3, we3.MOVE_START);
    })), this.disposeWithMe(this.selectionMoving$.subscribe((t3) => {
      this._updateSelections(t3, we3.MOVING);
    })), this.disposeWithMe(this.selectionMoveEnd$.subscribe((t3) => {
      this._updateSelections(t3, we3.MOVE_END);
    }));
  }
  _updateSelections(t3, n3) {
    const r = this._context.unit.getActiveSheet().getSheetId();
    t3.length !== 0 && this._workbookSelections.setSelections(
      r,
      t3.map((s2) => Dh(s2)),
      n3
    );
  }
  _initSkeletonChangeListener() {
    this.disposeWithMe(this._sheetSkeletonManagerService.currentSkeleton$.subscribe((t3) => {
      var i;
      if (!t3)
        return;
      const { skeleton: n3 } = t3, { scene: o3 } = this._context, r = o3.getViewport(k2.VIEW_MAIN);
      this._skeleton && ((i = this._skeleton.worksheet) == null ? void 0 : i.getSheetId()) !== n3.worksheet.getSheetId() && this._reset(), this._changeRuntime(n3, o3, r);
      const s2 = this._workbookSelections.getCurrentSelections();
      this.resetSelectionsByModelData(s2);
    }));
  }
  _getActiveViewport(t3) {
    const n3 = this._getSheetObject();
    return n3 == null ? void 0 : n3.scene.getActiveViewportByCoord(U.FromArray([t3.offsetX, t3.offsetY]));
  }
  _getSheetObject() {
    return $t4(this._context.unit, this._context);
  }
  /**
   * Handle pointer down event, bind pointermove & pointerup handler.
   * then trigger selectionMoveStart$.
   *
   * @param evt
   * @param _zIndex
   * @param rangeType
   * @param viewport
   * @param scrollTimerType
   */
  // eslint-disable-next-line complexity, max-lines-per-function
  _onPointerDown(t3, n3 = 0, o3 = ge.NORMAL, r, s2 = OE.ALL) {
    var N6;
    this._rangeType = o3;
    const i = this._skeleton, c2 = this._scene;
    if (!c2 || !i)
      return;
    r && (this._activeViewport = r);
    const { offsetX: l4, offsetY: m9 } = t3, h9 = c2.getViewport(k2.VIEW_MAIN);
    if (!h9) return;
    const f4 = c2.getCoordRelativeToViewport(U.FromArray([l4, m9])), { x: d2, y: u2 } = f4;
    this._startViewportPosX = d2, this._startViewportPosY = u2;
    const a4 = c2.getScrollXYInfoByViewport(f4), { scaleX: v6, scaleY: p3 } = c2.getAncestorScale(), S = this._skeleton.getCellByOffset(d2, u2, v6, p3, a4);
    if (!S) return;
    switch (o3) {
      case ge.NORMAL:
        break;
      case ge.ROW:
        S.startColumn = 0, S.endColumn = this._skeleton.getColumnCount() - 1;
        break;
      case ge.COLUMN:
        S.startRow = 0, S.endRow = this._skeleton.getRowCount() - 1;
        break;
      case ge.ALL:
        S.startRow = 0, S.startColumn = 0, S.endRow = this._skeleton.getRowCount() - 1, S.endColumn = this._skeleton.getColumnCount() - 1;
    }
    const C = { range: S, primary: S, style: null };
    C.range.rangeType = o3;
    const _3 = Wt3(C, this._skeleton);
    this._startRangeWhenPointerDown = __spreadValues({}, _3.rangeWithCoord);
    const E3 = __spreadProps(__spreadValues({}, _3.rangeWithCoord), { rangeType: o3 });
    let g9 = this.getActiveSelectionControl();
    const b4 = this.getSelectionControls();
    for (const O9 of b4) {
      if (t3.button === 2 && Cn.contains(O9.model, E3)) {
        g9 = O9;
        return;
      }
      if (O9.model.isEqual(E3)) {
        g9 = O9;
        break;
      }
    }
    this._checkClearPreviousControls(t3);
    const y6 = g9 == null ? void 0 : g9.model.currentCell, A4 = t3.shiftKey && y6, F7 = this._remainLastEnabled && !t3.ctrlKey && !t3.shiftKey && !this._skipLastEnabled && !this._singleSelectionEnabled;
    A4 && y6 ? this._makeSelectionByTwoCells(
      y6,
      E3,
      i,
      o3,
      g9
      // Get updated in this method
    ) : F7 && g9 ? g9.updateRangeBySelectionWithCoord(_3) : g9 = this.newSelectionControl(c2, i, C);
    for (let O9 = 0; O9 < this.getSelectionControls().length - 1; O9++)
      this.getSelectionControls()[O9].clearHighlight();
    this._selectionMoveStart$.next(this.getSelectionDataWithStyle()), c2.disableObjectsEvent(), this._clearUpdatingListeners(), this._addEndingListeners(), (N6 = c2.getTransformer()) == null || N6.clearSelectedObjects(), this._setupPointerMoveListener(h9, g9, o3, s2, d2, u2), this._escapeShortcutDisposable = this._shortcutService.forceEscape(), this._scenePointerUpSub = c2.onPointerUp$.subscribeEvent(() => {
      var O9;
      this._clearUpdatingListeners(), this._selectionMoveEnd$.next(this.getSelectionDataWithStyle()), (O9 = this._escapeShortcutDisposable) == null || O9.dispose(), this._escapeShortcutDisposable = null;
    });
  }
  /**
   * Diff between normal selection, no highlightHeader for ref selections.
   * @param scene
   * @param skeleton
   * @param selectionWithCoord
   * @returns {SelectionControl} selectionControl just created
   */
  newSelectionControl(t3, n3, o3) {
    const r = this.getSelectionControls().length, { rowHeaderWidth: s2, columnHeaderHeight: i } = n3, c2 = new jd2(t3, r, this._themeService, {
      highlightHeader: this._highlightHeader,
      enableAutoFill: false,
      rowHeaderWidth: s2,
      columnHeaderHeight: i
    }), l4 = Wt3(o3, n3);
    return c2.updateRangeBySelectionWithCoord(l4), this._selectionControls.push(c2), c2.setControlExtension({
      skeleton: n3,
      scene: t3,
      themeService: this._themeService,
      injector: this._injector,
      selectionHooks: {
        selectionMoveEnd: () => {
          this._selectionMoveEnd$.next(this.getSelectionDataWithStyle());
        }
      }
    }), c2;
  }
};
De = Zi3([
  it2(1, Inject(Injector)),
  it2(2, Inject(Ji)),
  it2(3, Le),
  it2(4, Inject(he2)),
  it2(5, Tr),
  it2(6, Ku)
], De);
function zi3(e) {
  const t3 = Sr4(e);
  return t3.widgets = { tl: true, tc: true, tr: true, ml: true, mr: true, bl: true, bc: true, br: true }, t3;
}
var In4 = (e, t3, n3 = true) => {
  let o3 = -1;
  return e.reduce((r, s2, i) => {
    if (r.isFinish)
      return r;
    const c2 = r.currentIndex;
    if (typeof s2 != "string")
      r.currentIndex += s2.token.length;
    else {
      const l4 = s2.length;
      r.currentIndex += l4;
    }
    return (n3 ? r.currentIndex === t3 : t3 > c2 && t3 <= r.currentIndex) && (o3 = i, r.isFinish = true), r;
  }, { currentIndex: 0, isFinish: false }), o3;
};
var Ur4 = (e, t3) => {
  const n3 = e[t3];
  let o3 = -1;
  if (!n3 || typeof n3 == "string" || n3.nodeType !== He.REFERENCE) return -1;
  for (let r = 0; r <= t3; r++) {
    const s2 = e[r];
    typeof s2 != "string" && s2.nodeType === He.REFERENCE && o3++;
  }
  return o3;
};
var Xi4 = (e, t3 = 100) => {
  (0, import_react2.useEffect)(() => {
    let n3 = null;
    const o3 = () => {
      n3 === null && (n3 = window.setTimeout(() => {
        e(), n3 = null;
      }, t3));
    };
    return window.addEventListener("scroll", o3), window.addEventListener("resize", o3), () => {
      n3 !== null && clearTimeout(n3), window.removeEventListener("scroll", o3), window.removeEventListener("resize", o3);
    };
  }, [e, t3]);
};
function Vr4(e, t3, n3) {
  const o3 = useDependency(Ge3), r = (0, import_react2.useMemo)(() => new BehaviorSubject({ left: -999, top: -999, right: -999, bottom: -999 }), []), s2 = useDependency(be2), i = useDependency(br), c2 = re2(() => {
    var _3;
    const l4 = o3.getEditor(e);
    if (!l4)
      return;
    const m9 = l4.getBoundingClientRect(), { marginTop: h9 = 0, marginBottom: f4 = 0 } = l4.getDocumentData().documentStyle, d2 = l4.getSkeleton();
    if (!d2) return;
    const u2 = (_3 = d2.getSkeletonData()) == null ? void 0 : _3.pages[0].height;
    let { left: a4, top: v6, right: p3, bottom: S } = m9;
    v6 = v6 + h9, S = u2 ? v6 + u2 : S - f4;
    const C = r.getValue();
    if (!(C.left === a4 && C.top === v6 && C.right === p3 && C.bottom === S))
      return r.next({ left: a4 - 1, right: p3 + 1, top: v6 - 1, bottom: S + 1 }), m9;
  });
  return (0, import_react2.useEffect)(() => {
    t3 && c2();
  }, [e, o3, i.unitAdded$, c2, t3, ...n3 != null ? n3 : []]), Xi4(c2), (0, import_react2.useEffect)(() => {
    const l4 = s2.scrollEvent$.pipe(throttleTime(100)).subscribe(c2);
    return () => {
      l4.unsubscribe();
    };
  }, []), [r, c2];
}
var nt4 = (e) => {
  const t3 = (0, import_react2.useRef)(e);
  return t3.current = e, t3;
};
var Qi4 = (e, t3, n3) => {
  const o3 = useDependency(zt3), r = useDependency(Et2), s2 = useDependency(Mn), [i, c2] = (0, import_react2.useState)(), [l4, m9] = (0, import_react2.useState)(-1), [h9, f4] = (0, import_react2.useState)(true), d2 = nt4(h9), u2 = (0, import_react2.useRef)(t3);
  u2.current = t3;
  const a4 = () => {
    c2(void 0), m9(-1), f4(false);
  };
  return (0, import_react2.useEffect)(() => {
    const v6 = s2.sequenceNodesBuilder(t3.slice(1));
    o3.setSequenceNodes(v6 != null ? v6 : []);
  }, [t3]), (0, import_react2.useEffect)(() => {
    if (n3 && e) {
      const v6 = n3.selectionChange$.pipe(debounceTime(50)).subscribe((S) => {
        if (S.textRanges.length === 1) {
          const [C] = S.textRanges;
          if (C.collapsed && d2.current) {
            const { startOffset: _3 } = C, E3 = o3.getCurrentSequenceNodeIndex(_3 - 2), g9 = o3.getCurrentSequenceNodeByIndex(E3), b4 = o3.getCurrentSequenceNodeByIndex(E3 + 1);
            if (g9)
              if (typeof g9 != "string" && g9.nodeType === 3 && !r.hasDefinedNameDescription(g9.token.trim()) && b4 === X4.OPEN_BRACKET) {
                const y6 = r.getFunctionInfo(g9.token);
                c2(y6), m9(-1);
                return;
              } else {
                const y6 = s2.getFunctionAndParameter(`${u2.current}A`, _3 - 1);
                if (y6) {
                  const { functionName: A4, paramIndex: F7 } = y6, N6 = r.getFunctionInfo(A4);
                  c2(N6), m9(F7);
                  return;
                }
              }
          }
        }
        c2(void 0), m9(-1);
      }), p3 = n3.selectionChange$.pipe(
        filter((S) => S.textRanges.length === 1),
        map((S) => S.textRanges[0].startOffset),
        distinctUntilChanged()
      ).subscribe(() => {
        f4(true);
      });
      return () => {
        v6.unsubscribe(), p3.unsubscribe();
      };
    }
  }, [n3, e]), (0, import_react2.useEffect)(() => {
    e || a4();
  }, [e]), {
    functionInfo: i,
    paramIndex: l4,
    reset: a4
  };
};
var Ji5 = ({ onClick: e }) => (0, import_jsx_runtime2.jsx)(
  "div",
  {
    className: "univer-z-[15] univer-box-border univer-h-[18px] univer-cursor-pointer univer-overflow-visible univer-whitespace-nowrap univer-rounded-l univer-border univer-border-r-0 univer-border-gray-600 univer-bg-primary-600 univer-p-0.5 univer-text-xs univer-font-bold univer-leading-[13px] univer-text-white",
    onClick: e,
    children: "?"
  }
);
var nn4 = ({ className: e, title: t3, value: n3 }) => (0, import_jsx_runtime2.jsxs)("div", { className: "univer-my-2", children: [
  (0, import_jsx_runtime2.jsx)(
    "div",
    {
      className: ie2("univer-mb-2 univer-text-sm univer-font-medium univer-text-gray-900 dark:!univer-text-white", e),
      children: t3
    }
  ),
  (0, import_jsx_runtime2.jsx)(
    "div",
    {
      className: "univer-whitespace-pre-wrap univer-break-words univer-text-xs univer-text-gray-500",
      children: n3
    }
  )
] });
var ec3 = (e) => {
  const { prefix: t3, value: n3, active: o3, onClick: r } = e;
  return (0, import_jsx_runtime2.jsxs)("div", { children: [
    (0, import_jsx_runtime2.jsxs)("span", { children: [
      t3,
      "("
    ] }),
    n3 && n3.map((s2, i) => (0, import_jsx_runtime2.jsxs)("span", { children: [
      (0, import_jsx_runtime2.jsx)(
        "span",
        {
          className: o3 === i ? "univer-text-primary-500" : "",
          onClick: () => r(i),
          children: xr3(s2)
        }
      ),
      i === n3.length - 1 ? "" : ","
    ] }, s2.name)),
    ")"
  ] });
};
var Jn5 = () => {
};
function tc3(e) {
  const { onParamsSwitch: t3 = Jn5, onClose: n3 = Jn5, isFocus: o3, editor: r, formulaText: s2 } = e, { functionInfo: i, paramIndex: c2, reset: l4 } = Qi4(o3, s2, r), m9 = useDependency(Qe3), h9 = !useObservable(m9.helpFunctionVisible$), [f4, d2] = (0, import_react2.useState)(true), u2 = useDependency(Hn), a4 = u2.t("formula.prompt.required"), v6 = u2.t("formula.prompt.optional"), p3 = r.getEditorId(), [S] = Vr4(p3, !!i, [i, c2]);
  function C(g9) {
    t3 && t3(g9);
  }
  const _3 = re2((g9) => {
    m9.helpFunctionVisible$.next(!g9);
  }), E3 = () => {
    _3(true), n3();
  };
  return i ? h9 ? (0, import_jsx_runtime2.jsx)(ot, { portal: true, anchorRect$: S, direction: "left-center", children: (0, import_jsx_runtime2.jsx)(Ji5, { onClick: () => _3(false) }) }, "hidden") : (0, import_jsx_runtime2.jsx)(ot, { portal: true, onClickOutside: () => l4(), anchorRect$: S, direction: "vertical", children: (0, import_jsx_runtime2.jsxs)(
    "div",
    {
      className: ie2("univer-m-0 univer-box-border univer-w-[250px] univer-select-none univer-list-none univer-rounded-lg univer-bg-white univer-leading-5 univer-shadow-md univer-outline-none dark:!univer-bg-gray-900", kt2),
      children: [
        (0, import_jsx_runtime2.jsxs)(
          "div",
          {
            className: ie2("univer-wrap-anywhere univer-box-border univer-flex univer-items-center univer-justify-between univer-px-4 univer-py-3 univer-text-xs univer-font-medium univer-text-gray-900 dark:!univer-text-white", dE2),
            children: [
              (0, import_jsx_runtime2.jsx)(
                ec3,
                {
                  prefix: i.functionName,
                  value: i.functionParameter,
                  active: c2,
                  onClick: C
                }
              ),
              (0, import_jsx_runtime2.jsxs)("div", { className: "univer-flex", children: [
                (0, import_jsx_runtime2.jsx)(
                  "div",
                  {
                    className: "univer-ml-2 univer-flex univer-h-6 univer-w-6 univer-cursor-pointer univer-items-center univer-justify-center univer-rounded univer-bg-transparent univer-p-0 univer-text-xs univer-text-gray-500 univer-outline-none univer-transition-colors hover:univer-bg-gray-200 dark:hover:!univer-bg-gray-600",
                    style: { transform: f4 ? "rotateZ(-90deg)" : "rotateZ(90deg)" },
                    onClick: () => d2(!f4),
                    children: (0, import_jsx_runtime2.jsx)($r4, {})
                  }
                ),
                (0, import_jsx_runtime2.jsx)(
                  "div",
                  {
                    className: "univer-ml-2 univer-flex univer-h-6 univer-w-6 univer-cursor-pointer univer-items-center univer-justify-center univer-rounded univer-bg-transparent univer-p-0 univer-text-xs univer-text-gray-600 univer-outline-none univer-transition-colors hover:univer-bg-gray-300 dark:!univer-text-gray-200 dark:hover:!univer-bg-gray-600",
                    onClick: E3,
                    children: (0, import_jsx_runtime2.jsx)(Ar3, {})
                  }
                )
              ] })
            ]
          }
        ),
        (0, import_jsx_runtime2.jsx)(
          "div",
          {
            className: ie2("univer-box-border univer-max-h-[350px] univer-overflow-y-auto univer-px-4 univer-pb-3 univer-pt-0", vr2),
            style: {
              height: f4 ? "unset" : 0,
              padding: f4 ? "revert-layer" : 0
            },
            children: (0, import_jsx_runtime2.jsxs)("div", { className: "univer-mt-3", children: [
              (0, import_jsx_runtime2.jsx)(
                nn4,
                {
                  title: u2.t("formula.prompt.helpExample"),
                  value: `${i.functionName}(${i.functionParameter.map((g9) => g9.example).join(",")})`
                }
              ),
              (0, import_jsx_runtime2.jsx)(
                nn4,
                {
                  title: u2.t("formula.prompt.helpAbstract"),
                  value: i.description
                }
              ),
              i && i.functionParameter && i.functionParameter.map((g9, b4) => (0, import_jsx_runtime2.jsx)(
                nn4,
                {
                  className: c2 === b4 ? "univer-text-primary-500" : "",
                  title: g9.name,
                  value: `${g9.require ? a4 : v6} ${g9.detail}`
                },
                b4
              ))
            ] })
          }
        )
      ]
    }
  ) }, "show") : null;
}
var nc3 = (e) => {
  const t3 = useDependency(Ge3);
  return re2((o3) => {
    var r, s2;
    if (e) {
      t3.focus(e.getEditorId());
      const i = [...e.getSelectionRanges()];
      if (Z.isDefine(o3))
        e.setSelectionRanges([{ startOffset: o3, endOffset: o3 }]);
      else if (!i.length && !e.docSelectionRenderService.isOnPointerEvent) {
        const c2 = (s2 = (r = e.getDocumentData().body) == null ? void 0 : r.dataStream) != null ? s2 : `\r
`, l4 = Math.max(c2.length - 2, 0);
        e.setSelectionRanges([{ startOffset: l4, endOffset: l4 }]);
      } else
        e.setSelectionRanges(i);
    }
  });
};
function rc3(e) {
  var r, s2;
  const n3 = e.get(br).getCurrentUniverDocInstance();
  return n3 != null && n3.getBody() ? { dataStream: (s2 = (r = n3.getBody()) == null ? void 0 : r.dataStream) != null ? s2 : "", offset: 0 } : void 0;
}
var Ne3 = ((e) => (e[e.NOT_SELECT = 0] = "NOT_SELECT", e[e.NEED_ADD = 1] = "NEED_ADD", e[e.CAN_EDIT = 2] = "CAN_EDIT", e[e.EDIT_OTHER_SHEET_REFERENCE = 3] = "EDIT_OTHER_SHEET_REFERENCE", e[e.EDIT_OTHER_WORKBOOK_REFERENCE = 4] = "EDIT_OTHER_WORKBOOK_REFERENCE", e))(Ne3 || {});
function oc3(e) {
  var y6;
  const { editorId: t3, isFocus: n3, disableOnClick: o3, unitId: r, subUnitId: s2 } = e, i = useDependency(JE), c2 = useDependency(br), l4 = i.getRenderById(r), m9 = i.getRenderById(t3), h9 = m9 == null ? void 0 : m9.with(Re), f4 = useDependency(m), d2 = useDependency(Injector), [u2, a4] = (0, import_react2.useState)(
    0
    /* NOT_SELECT */
  ), v6 = useDependency(Mn), p3 = (0, import_react2.useRef)(true), S = l4 == null ? void 0 : l4.with(De), C = nt4(u2), _3 = c2.getUnit(r, we.UNIVER_SHEET), E3 = _3 == null ? void 0 : _3.getSheetBySheetId(s2), g9 = re2((A4) => {
    S && S.setSkipLastEnabled(
      A4 === 1 || A4 === 3 || A4 === 4
      /* EDIT_OTHER_WORKBOOK_REFERENCE */
    ), C.current = A4, a4(A4);
  }), b4 = re2(() => {
    var ce5, ae5, he4;
    const A4 = c2.getCurrentUnitOfType(we.UNIVER_SHEET);
    if (!A4) return;
    const F7 = A4.getActiveSheet(), N6 = h9 == null ? void 0 : h9.getActiveTextRange(), O9 = N6 != null && N6.collapsed ? N6.startOffset : -1, k6 = rc3(d2);
    if (!k6) return;
    const I6 = (ce5 = k6 == null ? void 0 : k6.dataStream) == null ? void 0 : ce5.slice(0, -2), x7 = ((ae5 = v6.sequenceNodesBuilder(I6)) != null ? ae5 : []).map((K5) => typeof K5 == "object" ? K5.nodeType === He.REFERENCE ? __spreadProps(__spreadValues({}, K5), {
      range: br3(K5.token)
    }) : __spreadProps(__spreadValues({}, K5), {
      range: void 0
    }) : K5), R9 = I6[O9 - 1], w6 = I6[O9], D5 = x7.find((K5) => typeof K5 == "object" && K5.nodeType === He.REFERENCE && O9 === K5.endIndex + 2), U3 = R9 && Tb(R9) && (!w6 || Cn2(w6) && w6 !== X4.OPEN_BRACKET), B5 = !!D5;
    if ((I6 == null ? void 0 : I6.substring(0, 1)) === "=" && (U3 || B5))
      if (B5) {
        if (p3.current)
          return;
        const { sheetName: K5, unitId: J6 } = D5.range, rt6 = (he4 = c2.getCurrentUnitOfType(we.UNIVER_SHEET)) == null ? void 0 : he4.getUnitId();
        J6 && J6 !== rt6 ? g9(
          4
          /* EDIT_OTHER_WORKBOOK_REFERENCE */
        ) : !K5 && F7.getSheetId() === (E3 == null ? void 0 : E3.getSheetId()) || K5 === F7.getName() ? g9(
          2
          /* CAN_EDIT */
        ) : g9(
          3
          /* EDIT_OTHER_SHEET_REFERENCE */
        );
      } else
        p3.current = false, g9(
          1
          /* NEED_ADD */
        );
    else
      g9(
        0
        /* NOT_SELECT */
      );
  });
  return (0, import_react2.useEffect)(() => {
    const A4 = f4.textSelection$.pipe(filter((F7) => F7.unitId === t3)).subscribe(() => {
      b4();
    });
    return () => A4.unsubscribe();
  }, [b4, f4.textSelection$, t3]), (0, import_react2.useEffect)(() => {
    n3 || (g9(
      0
      /* NOT_SELECT */
    ), p3.current = true);
  }, [n3, g9]), (0, import_react2.useEffect)(() => {
    var F7;
    if (!o3) return;
    const A4 = (F7 = m9 == null ? void 0 : m9.mainComponent) == null ? void 0 : F7.onPointerDown$.subscribeEvent(() => {
      g9(
        0
        /* NOT_SELECT */
      ), p3.current = true;
    });
    return () => A4 == null ? void 0 : A4.unsubscribe();
  }, [o3, (y6 = m9 == null ? void 0 : m9.mainComponent) == null ? void 0 : y6.onPointerDown$, g9]), (0, import_react2.useEffect)(() => {
    if (!n3) return;
    const A4 = _3 == null ? void 0 : _3.activeSheet$.subscribe(() => {
      b4();
    }), F7 = c2.getCurrentTypeOfUnit$(we.UNIVER_SHEET).subscribe(() => {
      b4();
    });
    return () => {
      A4 == null || A4.unsubscribe(), F7 == null || F7.unsubscribe();
    };
  }, [b4, n3, _3 == null ? void 0 : _3.activeSheet$, c2.getCurrentTypeOfUnit$]), { isSelecting: u2, isSelectingRef: C };
}
var sc3 = () => {
  const e = useDependency(Mn);
  return (0, import_react2.useCallback)((n3) => e.sequenceNodesBuilder(n3) || [], [e]);
};
function ic3(e, t3, n3) {
  const o3 = new At(t3).setAlpha(0.05).toRgbString();
  return {
    id: n3,
    strokeWidth: 1,
    stroke: t3,
    fill: o3,
    widgets: { tl: true, tc: true, tr: true, ml: true, mr: true, bl: true, bc: true, br: true },
    widgetSize: 6,
    widgetStrokeWidth: 1,
    widgetStroke: e.getColorFromTheme("white")
  };
}
function Wr5(e) {
  var _3, E3, g9;
  const {
    unitId: t3,
    subUnitId: n3,
    currentWorkbook: o3,
    refSelections: r,
    editor: s2,
    refSelectionsService: i,
    refSelectionsRenderService: c2,
    sheetSkeletonManagerService: l4,
    themeService: m9,
    univerInstanceService: h9
  } = e, f4 = o3.getUnitId(), d2 = h9.getUnit(t3, we.UNIVER_SHEET), u2 = d2 == null ? void 0 : d2.getActiveSheet(), a4 = [];
  if (!d2 || !u2) {
    i.setSelections(a4);
    return;
  }
  const v6 = u2.getSheetId(), p3 = (b4) => {
    var y6;
    return (y6 = d2 == null ? void 0 : d2.getSheetBySheetName(b4)) == null ? void 0 : y6.getSheetId();
  };
  if (!((_3 = l4 == null ? void 0 : l4.getWorksheetSkeleton(v6)) == null ? void 0 : _3.skeleton)) return;
  const C = [];
  for (let b4 = 0, y6 = r.length; b4 < y6; b4++) {
    const A4 = r[b4], { themeColor: F7, token: N6, refIndex: O9, endIndex: k6 } = A4, I6 = kr(N6), { unitId: x7, sheetName: R9, range: w6 } = I6, D5 = p3(R9);
    if (!D5 && R9 || f4 !== t3 && x7 !== f4 || x7 && x7 !== f4 || D5 && D5 !== v6 || !D5 && v6 !== n3)
      continue;
    const U3 = Hh(w6, u2.getRowCount(), u2.getColumnCount());
    U3.unitId = t3, U3.sheetId = v6, a4.push({
      range: U3,
      primary: null,
      style: ic3(m9, F7, O9.toString())
    }), C.push(k6);
  }
  if (s2) {
    const b4 = (g9 = (E3 = s2.getSelectionRanges()) == null ? void 0 : E3[0]) == null ? void 0 : g9.startOffset, y6 = C.findIndex((A4) => A4 + 2 === b4);
    y6 !== -1 ? c2 == null || c2.setActiveSelectionIndex(y6) : c2 == null || c2.resetActiveSelectionIndex();
  }
  return a4;
}
function cc3(e, t3) {
  const n3 = useDependency(br), o3 = useDependency(Ji), r = useDependency(Ku), s2 = useDependency(JE), i = useObservable((0, import_react2.useMemo)(() => n3.getCurrentTypeOfUnit$(we.UNIVER_SHEET), [n3])), c2 = i ? s2.getRenderById(i.getUnitId()) : null, l4 = c2 == null ? void 0 : c2.with(De), m9 = c2 == null ? void 0 : c2.with(he2), h9 = re2((f4, d2) => {
    const u2 = n3.getCurrentUnitOfType(we.UNIVER_SHEET);
    if (!u2 || l4 != null && l4.selectionMoving) return;
    const a4 = Wr5({
      unitId: e,
      subUnitId: t3,
      currentWorkbook: u2,
      refSelections: f4,
      editor: d2,
      refSelectionsService: r,
      refSelectionsRenderService: l4,
      sheetSkeletonManagerService: m9,
      themeService: o3,
      univerInstanceService: n3
    });
    if (!a4) return;
    ((l4 == null ? void 0 : l4.getSelectionControls()) || []).length === a4.length ? l4 == null || l4.resetSelectionsByModelData(a4) : r.setSelections(a4);
  });
  return (0, import_react2.useEffect)(() => () => {
    l4 == null || l4.resetActiveSelectionIndex();
  }, [l4]), h9;
}
function Hr3(e = "") {
  const t3 = useDependency(Et2), n3 = ac3(), o3 = useDependency(Ds), r = (0, import_react2.useMemo)(() => e.length, [e]);
  return re2((i, c2, l4 = true, m9) => {
    const h9 = i.getDocumentData(), f4 = i.getEditorId();
    if (!h9)
      return [];
    const d2 = h9.body;
    if (!d2)
      return [];
    const u2 = d2.dataStream.slice(0, d2.dataStream.length - 2), a4 = __spreadValues({ dataStream: "" }, h9.body);
    if (!u2.startsWith(e)) return [];
    if (c2 == null || c2.length === 0)
      return a4.textRuns = [], o3.syncExecuteCommand(Zd.id, {
        unitId: f4,
        body: kt(a4, 0, a4.dataStream.length - 2)
      }), [];
    {
      const { textRuns: v6, refSelections: p3 } = lc3(t3, n3, c2);
      r && v6.forEach((_3) => {
        _3.ed = _3.ed + r, _3.st = _3.st + r;
      }), a4.textRuns = [{ st: 0, ed: 1, ts: { fs: 11 } }, ...v6];
      const S = c2.reduce((_3, E3) => typeof E3 == "string" ? `${_3}${E3}` : `${_3}${E3.token}`, "");
      a4.dataStream = `${e}${S}\r
`;
      let C;
      if (l4) {
        C = i.getSelectionRanges();
        const _3 = a4.dataStream.length - 2 + r;
        C.forEach((E3) => {
          E3.startOffset = Math.max(0, Math.min(E3.startOffset, _3)), E3.endOffset = Math.max(0, Math.min(E3.endOffset, _3));
        });
      }
      return o3.syncExecuteCommand(Zd.id, {
        unitId: f4,
        body: kt(a4, 0, a4.dataStream.length - 2),
        textRanges: m9 != null ? m9 : C
      }), p3;
    }
  });
}
function ac3() {
  const e = useDependency(Ji), t3 = e.getCurrentTheme();
  return (0, import_react2.useMemo)(() => {
    const o3 = [
      e.getColorFromTheme("loop-color.1"),
      e.getColorFromTheme("loop-color.2"),
      e.getColorFromTheme("loop-color.3"),
      e.getColorFromTheme("loop-color.4"),
      e.getColorFromTheme("loop-color.5"),
      e.getColorFromTheme("loop-color.6"),
      e.getColorFromTheme("loop-color.7"),
      e.getColorFromTheme("loop-color.8"),
      e.getColorFromTheme("loop-color.9"),
      e.getColorFromTheme("loop-color.10"),
      e.getColorFromTheme("loop-color.11"),
      e.getColorFromTheme("loop-color.12")
    ].map((c2) => e.isValidThemeColor(c2) ? e.getColorFromTheme(c2) : c2), r = e.getColorFromTheme("blue.700"), s2 = e.getColorFromTheme("jiqing.800"), i = e.getColorFromTheme("black");
    return { formulaRefColors: o3, numberColor: r, stringColor: s2, plainTextColor: i };
  }, [t3]);
}
function lc3(e, t3, n3) {
  const { formulaRefColors: o3, numberColor: r, stringColor: s2, plainTextColor: i } = t3, c2 = [], l4 = [], m9 = /* @__PURE__ */ new Map();
  let h9 = 0;
  for (let f4 = 0, d2 = n3.length; f4 < d2; f4++) {
    const u2 = n3[f4];
    if (typeof u2 == "string") {
      const _3 = c2[c2.length - 1], E3 = _3 ? _3.ed : 0, g9 = E3 + u2.length;
      c2.push({
        st: E3,
        ed: g9,
        ts: {
          cl: {
            rgb: i
          },
          fs: 11
        }
      });
      continue;
    }
    if (e.hasDefinedNameDescription(u2.token.trim())) {
      c2.push({
        st: u2.startIndex,
        ed: u2.endIndex + 1,
        ts: {
          cl: {
            rgb: i
          },
          fs: 11
        }
      });
      continue;
    }
    const { startIndex: a4, endIndex: v6, nodeType: p3, token: S } = u2;
    let C = "";
    if (p3 === He.REFERENCE) {
      if (m9.has(S))
        C = m9.get(S);
      else {
        const _3 = h9 % o3.length;
        C = o3[_3], m9.set(S, C), h9++;
      }
      l4.push({
        refIndex: f4,
        themeColor: C,
        token: S,
        startIndex: u2.startIndex,
        endIndex: u2.endIndex,
        index: l4.length
      });
    } else p3 === He.NUMBER ? C = r : (p3 === He.STRING || p3 === He.ARRAY) && (C = s2);
    C && C.length > 0 ? c2.push({
      st: a4,
      ed: v6 + 1,
      ts: {
        cl: {
          rgb: C
        },
        fs: 11
      }
    }) : c2.push({
      st: a4,
      ed: v6 + 1,
      ts: {
        cl: {
          rgb: i
        },
        fs: 11
      }
    });
  }
  return { textRuns: c2, refSelections: l4 };
}
var uc4 = (e, t3, n3, o3) => {
  const r = useDependency(Ds), s2 = useDependency(Le), i = (0, import_react2.useRef)(t3);
  i.current = t3;
  const c2 = (0, import_react2.useRef)(o3);
  c2.current = o3, (0, import_react2.useEffect)(() => {
    if (!n3 || !e)
      return;
    const m9 = `sheet.formula-embedding-editor.${n3.getEditorId()}`, h9 = new ho(), f4 = (a4, v6) => {
      if (c2.current) {
        c2.current(a4, v6);
        return;
      }
      let p3 = wm.LEFT;
      a4 === q1.ARROW_DOWN ? p3 = wm.DOWN : a4 === q1.ARROW_UP ? p3 = wm.UP : a4 === q1.ARROW_RIGHT && (p3 = wm.RIGHT), v6 === y12.SHIFT ? r.executeCommand(vt.id, {
        direction: p3
      }) : r.executeCommand(St.id, {
        direction: p3
      });
    }, d2 = (a4, v6) => {
      let p3 = wm.DOWN;
      a4 === q1.ARROW_DOWN ? p3 = wm.DOWN : a4 === q1.ARROW_UP ? p3 = wm.UP : a4 === q1.ARROW_LEFT ? p3 = wm.LEFT : a4 === q1.ARROW_RIGHT && (p3 = wm.RIGHT), i.current ? v6 === y12.CTRL_COMMAND ? r.executeCommand(Ut3.id, {
        direction: p3,
        jumpOver: kn3.moveGap,
        extra: "formula-editor",
        fromCurrentSelection: i.current === Ne3.NEED_ADD || i.current === Ne3.EDIT_OTHER_SHEET_REFERENCE
      }) : v6 === y12.SHIFT ? r.executeCommand(Gt3.id, {
        direction: p3,
        extra: "formula-editor"
      }) : v6 === (y12.CTRL_COMMAND | y12.SHIFT) ? r.executeCommand(Gt3.id, {
        direction: p3,
        jumpOver: kn3.moveGap,
        extra: "formula-editor"
      }) : r.executeCommand(Ut3.id, {
        direction: p3,
        extra: "formula-editor",
        fromCurrentSelection: i.current === Ne3.NEED_ADD || i.current === Ne3.EDIT_OTHER_SHEET_REFERENCE
      }) : f4(a4, v6);
    };
    return h9.add(r.registerCommand({
      id: m9,
      type: Ls.OPERATION,
      handler(a4, v6) {
        const { keyCode: p3, metaKey: S } = v6;
        d2(p3, S);
      }
    })), [
      { keyCode: q1.ARROW_DOWN },
      { keyCode: q1.ARROW_LEFT },
      { keyCode: q1.ARROW_RIGHT },
      { keyCode: q1.ARROW_UP },
      { keyCode: q1.ARROW_DOWN, metaKey: y12.SHIFT },
      { keyCode: q1.ARROW_LEFT, metaKey: y12.SHIFT },
      { keyCode: q1.ARROW_RIGHT, metaKey: y12.SHIFT },
      { keyCode: q1.ARROW_UP, metaKey: y12.SHIFT },
      { keyCode: q1.ARROW_DOWN, metaKey: y12.CTRL_COMMAND },
      { keyCode: q1.ARROW_LEFT, metaKey: y12.CTRL_COMMAND },
      { keyCode: q1.ARROW_RIGHT, metaKey: y12.CTRL_COMMAND },
      { keyCode: q1.ARROW_UP, metaKey: y12.CTRL_COMMAND },
      { keyCode: q1.ARROW_DOWN, metaKey: y12.CTRL_COMMAND | y12.SHIFT },
      { keyCode: q1.ARROW_LEFT, metaKey: y12.CTRL_COMMAND | y12.SHIFT },
      { keyCode: q1.ARROW_RIGHT, metaKey: y12.CTRL_COMMAND | y12.SHIFT },
      { keyCode: q1.ARROW_UP, metaKey: y12.CTRL_COMMAND | y12.SHIFT }
    ].map(({ keyCode: a4, metaKey: v6 }) => ({
      id: m9,
      binding: v6 ? a4 | v6 : a4,
      preconditions: () => true,
      priority: 900,
      staticParameters: {
        eventType: hb.Keyboard,
        keyCode: a4,
        metaKey: v6
      }
    })).forEach((a4) => {
      h9.add(s2.registerShortcut(a4));
    }), () => {
      h9.dispose();
    };
  }, [r, n3, e, s2]);
};
var dc3 = (e, t3, n3, o3, r = true) => {
  var u2;
  const s2 = useDependency(JE), i = useDependency(Tr), c2 = useDependency(l3), l4 = useDependency(Ku), m9 = useDependency(br), h9 = useObservable((0, import_react2.useMemo)(() => m9.getCurrentTypeOfUnit$(we.UNIVER_SHEET), [m9])), f4 = s2.getRenderById((u2 = h9 == null ? void 0 : h9.getUnitId()) != null ? u2 : ""), d2 = f4 == null ? void 0 : f4.with(De);
  (0, import_react2.useLayoutEffect)(() => {
    if (e)
      return i.setContextValue(pE, true), r && c2.disable(), () => {
        const a4 = m9.getCurrentUnitOfType(we.UNIVER_DOC);
        (a4 == null ? void 0 : a4.getUnitId()) === o3 && i.setContextValue(pE, false), r && c2.enable(), l4.clear();
      };
  }, [i, e, l4, r, o3]), (0, import_react2.useLayoutEffect)(() => {
    if (e && t3) {
      const a4 = d2 == null ? void 0 : d2.enableSelectionChanging();
      return i.setContextValue(Fu, true), () => {
        i.setContextValue(Fu, false), a4 == null || a4.dispose();
      };
    }
  }, [i, e, d2, t3]), (0, import_react2.useEffect)(() => {
    e && (d2 == null || d2.setSkipLastEnabled(false));
  }, [e, d2]);
};
var hc3 = (e, t3, n3) => {
  const o3 = useDependency(br), r = useDependency(z);
  return (0, import_react2.useCallback)(() => {
    if (e) {
      const i = [...r.getWorkbookSelections(t3).getSelectionsOfWorksheet(n3)], c2 = o3.getCurrentUnitForType(we.UNIVER_SHEET), l4 = c2 == null ? void 0 : c2.getActiveSheet();
      (c2 == null ? void 0 : c2.getUnitId()) !== t3 && o3.setCurrentUnitForType(t3), l4 && l4.getSheetId() === n3 && r.setSelections(i);
    }
  }, [e, r, n3, t3, o3]);
};
var fc3 = (e) => e.reduce((t3, n3) => typeof n3 == "string" ? t3 + n3.length : t3 + n3.token.length, 0);
var an2 = (e) => e.map((t3) => typeof t3 == "string" ? t3 : t3.token).join("");
var At4 = (e, t3 = false, n3 = "", o3 = false) => !t3 && !o3 ? e.map((r) => Yt(r.range)) : e.map((r) => o3 ? Ts2(r) : r.sheetName !== "" && r.sheetName !== n3 ? wl(r.sheetName, r.range) : Yt(r.range));
var gc3 = (e) => {
  var h9, f4, d2;
  const { editor: t3, lexerTreeBuilder: n3 } = e, o3 = t3 == null ? void 0 : t3.getSelectionRanges();
  if ((o3 == null ? void 0 : o3.length) !== 1)
    return;
  const s2 = o3[0].startOffset - 1, i = ((f4 = (h9 = t3 == null ? void 0 : t3.getDocumentData().body) == null ? void 0 : h9.dataStream) != null ? f4 : `\r
`).slice(0, -2), c2 = (d2 = n3.sequenceNodesBuilder(i.slice(1))) != null ? d2 : [], l4 = In4(c2, s2, false), m9 = Ur4(c2, l4);
  return {
    nodeIndex: l4,
    updatingRefIndex: m9,
    sequenceNodes: c2,
    offset: s2
  };
};
var mc4 = () => {
};
var pc3 = (e, t3, n3, o3, r, s2, i, c2, l4, m9 = mc4) => {
  var O9;
  const h9 = useDependency(JE), f4 = useDependency(br), d2 = useDependency(Ds), u2 = useDependency(m), a4 = useDependency(Ji), v6 = useDependency(Mn), p3 = f4.getUnit(o3), S = re2((k6, I6) => {
    var x7, R9, w6;
    return (w6 = (R9 = (x7 = f4.getUnit(k6)) == null ? void 0 : x7.getSheetBySheetId(I6)) == null ? void 0 : R9.getName()) != null ? w6 : "";
  }), C = (0, import_react2.useMemo)(() => S(o3, r), [S, r, o3]), _3 = useObservable(p3 == null ? void 0 : p3.activeSheet$), E3 = nt4({ activeSheet: _3, sheetName: C }), g9 = useObservable((0, import_react2.useMemo)(() => f4.getCurrentTypeOfUnit$(we.UNIVER_SHEET), [f4])), b4 = h9.getRenderById((O9 = g9 == null ? void 0 : g9.getUnitId()) != null ? O9 : ""), y6 = b4 == null ? void 0 : b4.with(De), A4 = b4 == null ? void 0 : b4.with(he2), F7 = useDependency(Ku), N6 = re2((k6, I6) => {
    var B5, ce5, ae5, he4, K5, J6, rt6, ot6, Tt3, Ie;
    const x7 = gc3({ editor: l4, lexerTreeBuilder: v6 });
    if (!x7) return;
    const { nodeIndex: R9, updatingRefIndex: w6, sequenceNodes: D5, offset: U3 } = x7;
    if (n3.current === Ne3.NEED_ADD)
      if (U3 !== 0) {
        if (R9 === -1 && D5.length)
          return;
        const Y7 = k6[k6.length - 1], X9 = D5.splice(R9 + 1), Ee7 = (B5 = Y7.sheetId) != null ? B5 : r, fe5 = {
          range: Y7,
          unitId: (ce5 = Y7.unitId) != null ? ce5 : g9.getUnitId(),
          sheetName: S((ae5 = Y7.unitId) != null ? ae5 : g9.getUnitId(), Ee7)
        }, ee5 = Ee7 !== r, le3 = (g9 == null ? void 0 : g9.getUnitId()) !== o3, be4 = At4([fe5], i && (ee5 || le3), C, le3);
        D5.push({ token: be4[0], nodeType: He.REFERENCE });
        const Le7 = [...D5, ...X9], Me2 = an2(Le7);
        m9(Me2, fc3(D5), I6);
      } else {
        const Y7 = k6[k6.length - 1], X9 = (he4 = Y7.sheetId) != null ? he4 : r, Ee7 = {
          range: Y7,
          unitId: (K5 = Y7.unitId) != null ? K5 : g9.getUnitId(),
          sheetName: S((J6 = Y7.unitId) != null ? J6 : g9.getUnitId(), X9)
        }, fe5 = X9 !== r, ee5 = (g9 == null ? void 0 : g9.getUnitId()) !== o3, le3 = At4([Ee7], i && (fe5 || ee5), C, ee5);
        D5.unshift({ token: le3[0], nodeType: He.REFERENCE });
        const be4 = an2(D5);
        m9(be4, le3[0].length, I6);
      }
    else if (n3.current === Ne3.EDIT_OTHER_SHEET_REFERENCE || n3.current === Ne3.EDIT_OTHER_WORKBOOK_REFERENCE) {
      const Y7 = k6.pop();
      if (!Y7) return;
      const X9 = D5[R9];
      if (typeof X9 == "object" && X9.nodeType === He.REFERENCE) {
        const Ee7 = X9.token;
        (g9 == null ? void 0 : g9.getUnitId()) !== o3 ? X9.token = Ll((rt6 = g9 == null ? void 0 : g9.getUnitId()) != null ? rt6 : "", C, Y7) : X9.token = C === (_3 == null ? void 0 : _3.getName()) ? Yt(Y7) : wl(_3.getName(), Y7);
        const ee5 = U3 + (X9.token.length - Ee7.length);
        m9(yi(D5), ee5, I6);
      }
    } else {
      const Y7 = [...k6];
      if (w6 !== -1) {
        const G5 = Y7.pop();
        G5 && Y7.splice(w6, 0, G5);
      }
      let X9 = 0;
      const Ee7 = D5.map((G5) => {
        var ge5, st6, Pe5, Ue4;
        if (typeof G5 == "string")
          return G5;
        if (G5.nodeType === He.REFERENCE) {
          const Ve6 = kr(G5.token);
          if (Ve6.sheetName || (Ve6.sheetName = C), (Ve6.unitId || o3) !== (g9 == null ? void 0 : g9.getUnitId()) || i && ((ge5 = E3.current.activeSheet) == null ? void 0 : ge5.getName()) !== Ve6.sheetName)
            return G5.token;
          const oe5 = Y7[X9];
          if (X9++, !oe5)
            return "";
          const ye6 = (st6 = oe5.sheetId) != null ? st6 : r, Nt5 = {
            range: oe5,
            unitId: (Pe5 = oe5.unitId) != null ? Pe5 : g9.getUnitId(),
            sheetName: S((Ue4 = oe5.unitId) != null ? Ue4 : g9.getUnitId(), ye6)
          }, Ot3 = (g9 == null ? void 0 : g9.getUnitId()) !== o3;
          return At4([Nt5], i && (ye6 !== r || Ot3), C, Ot3)[0];
        }
        return G5.token;
      });
      let fe5 = "", ee5;
      Ee7.forEach((G5, ge5) => {
        fe5 += G5, ge5 === R9 && (ee5 = fe5.length);
      });
      const le3 = [];
      for (let G5 = X9; G5 <= k6.length - 1; G5++) {
        const ge5 = k6[G5], st6 = (ot6 = ge5.sheetId) != null ? ot6 : r, Pe5 = {
          range: ge5,
          unitId: (Tt3 = ge5.unitId) != null ? Tt3 : g9.getUnitId(),
          sheetName: S((Ie = ge5.unitId) != null ? Ie : g9.getUnitId(), st6)
        }, Ue4 = (g9 == null ? void 0 : g9.getUnitId()) !== o3, oe5 = At4([Pe5], i && (st6 !== r || Ue4), C, Ue4);
        le3.push(oe5[0]);
      }
      const be4 = D5[D5.length - 1], Le7 = be4 && (typeof be4 == "string" ? false : be4.nodeType === He.REFERENCE), Me2 = `${fe5}${le3.length && Le7 ? "," : ""}${le3.join(",")}`;
      m9(Me2, !le3.length && ee5 ? ee5 : Me2.length, I6);
    }
  });
  (0, import_react2.useEffect)(() => {
    if (y6 && e) {
      let k6 = true;
      const I6 = (R9, w6) => {
        if (k6) {
          k6 = false;
          return;
        }
        N6(R9.map((D5) => D5.rangeWithCoord), w6);
      }, x7 = new ho();
      return x7.add(y6.selectionMoving$.subscribe((R9) => {
        I6(R9, false);
      })), x7.add(y6.selectionMoveEnd$.subscribe((R9) => {
        I6(R9, true);
      })), () => {
        x7.dispose();
      };
    }
  }, [e, N6, y6]), (0, import_react2.useEffect)(() => {
    if (t3 && y6 && l4) {
      const k6 = new ho(), I6 = () => {
        k6.dispose(), y6.getSelectionControls().forEach((w6, D5) => {
          k6.add(
            w6.selectionScaling$.subscribe((U3) => {
              const B5 = y6.getSelectionDataWithStyle().map((ae5) => ae5.rangeWithCoord), ce5 = B5[D5];
              U3.sheetId = ce5.sheetId, U3.unitId = ce5.unitId, B5[D5] = U3, N6(B5, false);
            })
          ), k6.add(
            w6.selectionMoving$.subscribe((U3) => {
              const B5 = y6.getSelectionDataWithStyle().map((ae5) => ae5.rangeWithCoord), ce5 = B5[D5];
              U3.sheetId = ce5.sheetId, U3.unitId = ce5.unitId, B5[D5] = U3, N6(B5, true);
            })
          );
        });
      }, x7 = merge(
        l4.input$,
        F7.selectionSet$,
        y6.selectionMoveEnd$
      ).pipe(
        debounceTime(50)
      ).subscribe(() => {
        I6();
      });
      return () => {
        x7.unsubscribe(), k6.dispose();
      };
    }
  }, [l4, t3, N6, y6, F7.selectionSet$]), y6 == null || y6.getSelectionDataWithStyle(), (0, import_react2.useEffect)(() => {
    if (c2) {
      const k6 = d2.onCommandExecuted((I6) => {
        var R9;
        if (I6.id !== ie5.id)
          return;
        const x7 = I6.params;
        if (x7.extra === "formula-editor" && x7.selections.length) {
          const w6 = x7.selections[x7.selections.length - 1];
          if (w6) {
            const D5 = n3.current === Ne3.NEED_ADD, U3 = ((R9 = y6 == null ? void 0 : y6.getSelectionDataWithStyle()) != null ? R9 : []).map((B5) => B5.rangeWithCoord);
            D5 ? U3.push(w6.range) : U3[U3.length - 1] = w6.range, N6(U3, true);
          }
        }
      });
      return () => {
        k6.dispose();
      };
    }
  }, [d2, l4, n3, v6, c2, N6, y6]), (0, import_react2.useEffect)(() => {
    if (!l4)
      return;
    const k6 = u2.textSelection$.subscribe((I6) => {
      I6.unitId === l4.getEditorId() && Wr5({
        unitId: o3,
        subUnitId: r,
        refSelections: s2.current,
        editor: l4,
        refSelectionsService: F7,
        refSelectionsRenderService: y6,
        sheetSkeletonManagerService: A4,
        themeService: a4,
        univerInstanceService: f4,
        currentWorkbook: g9
      });
    });
    return () => k6.unsubscribe();
  }, [u2.textSelection$, l4, s2, y6, F7, A4, r, a4, o3, f4]);
};
var Sc3 = (e, t3, n3, o3, r, s2) => {
  const i = useDependency(Ds), c2 = useDependency(Ge3), m9 = useDependency(JE).getRenderById(t3), h9 = useDependency(br), f4 = m9 == null ? void 0 : m9.with(De);
  (0, import_react2.useEffect)(() => {
    if (e && f4)
      if (n3) {
        const d2 = () => {
          const v6 = f4.getSelectionControls().length;
          for (let p3 = 1; p3 <= v6; p3++)
            f4.clearLastSelection();
          return setTimeout(() => {
            s2();
          }, 30);
        }, u2 = i.onCommandExecuted((v6) => {
          v6.id === pn.id && d2();
        }), a4 = h9.getCurrentTypeOfUnit$(we.UNIVER_SHEET).subscribe((v6) => {
          d2();
        });
        return () => {
          u2.dispose(), a4.unsubscribe();
        };
      } else {
        const d2 = i.beforeCommandExecuted((u2) => {
          if (u2.id === pn.id) {
            o3(false), r(), s2();
            const a4 = c2.getEditor(Fl);
            a4 == null || a4.focus();
          }
        });
        return () => {
          d2.dispose();
        };
      }
  }, [e, f4]);
};
var vc3 = (e, t3, n3) => {
  const o3 = useDependency(Mn), r = (0, import_react2.useRef)(true);
  (0, import_react2.useEffect)(() => {
    if (e) {
      const s2 = setTimeout(() => {
        r.current = false;
      }, 500);
      return () => {
        clearTimeout(s2);
      };
    }
  }, [e]), (0, import_react2.useEffect)(() => {
    if (!r.current && t3) {
      const s2 = o3.checkIfAddBracket(n3);
      t3(s2 === 0 && n3.startsWith(Z6.EQUALS), `${n3}`);
    }
  }, [n3, t3]);
};
var Cc3 = (e, t3 = [], n3) => {
  const o3 = useDependency(Et2), [r, s2] = (0, import_react2.useState)([]), [i, c2] = (0, import_react2.useState)(""), l4 = (0, import_react2.useRef)(-1), m9 = nt4({ nodes: t3 }), h9 = () => {
    s2([]), c2(""), l4.current = -1;
  };
  return (0, import_react2.useEffect)(() => {
    if (n3 && e) {
      const d2 = n3.input$.pipe(debounceTime(300)).subscribe(() => {
        const u2 = n3.getSelectionRanges();
        if (u2.length === 1) {
          const a4 = m9.current.nodes, v6 = u2[0];
          if (v6.collapsed) {
            const p3 = In4(a4, v6.startOffset - 1, false);
            l4.current = p3;
            const S = a4[p3];
            if (S && typeof S != "string" && S.nodeType === He.FUNCTION) {
              l4.current = p3;
              const C = S.token, _3 = o3.getSearchListByNameFirstLetter(C);
              s2(_3), c2(C);
              return;
            }
          }
        }
        l4.current = -1, c2(""), s2((a4) => a4 != null && a4.length ? [] : a4);
      });
      return () => {
        d2.unsubscribe();
      };
    }
  }, [n3, e]), (0, import_react2.useEffect)(() => {
    e || h9();
  }, [e]), {
    searchList: r,
    searchText: i,
    handlerFormulaReplace: (d2, u2) => {
      const a4 = [...m9.current.nodes];
      if (l4.current !== -1) {
        const v6 = a4.splice(l4.current + 1), p3 = a4.pop() || "";
        let S = (typeof p3 == "string" ? p3.length : p3.token.length) - d2.length;
        return a4.push(d2), v6[0] !== X4.OPEN_BRACKET && u2 !== Kc2.DefinedName && (a4.push(X4.OPEN_BRACKET), S--), { text: an2([...a4, ...v6]), offset: S };
      }
    },
    reset: h9
  };
};
var _c3 = () => {
};
var Rc3 = (0, import_react2.forwardRef)(Ic3);
function Ic3(e, t3) {
  const { isFocus: n3, sequenceNodes: o3, onSelect: r, editor: s2, onClose: i = _c3 } = e, c2 = s2.getEditorId(), l4 = useDependency(Le), m9 = useDependency(Ds), { searchList: h9, searchText: f4, handlerFormulaReplace: d2, reset: u2 } = Cc3(n3, o3, s2), a4 = (0, import_react2.useMemo)(() => !!h9.length, [h9]), v6 = (0, import_react2.useRef)(void 0), [p3, S] = (0, import_react2.useState)(0), C = (0, import_react2.useRef)(false), [_3] = Vr4(c2, a4, [f4, h9]), E3 = nt4({ searchList: h9, active: p3 }), g9 = (N6, O9) => {
    const k6 = d2(N6, O9);
    k6 && (u2(), r(k6));
  };
  function b4(N6) {
    C.current && S(N6);
  }
  function y6() {
    C.current && S(-1);
  }
  (0, import_react2.useEffect)(() => {
    if (!h9.length)
      return;
    const N6 = `sheet.formula-embedding-editor.search_function.${c2}`, O9 = new ho(), k6 = (I6) => {
      const { searchList: x7, active: R9 } = E3.current;
      switch (I6) {
        case q1.ARROW_UP: {
          S((w6) => {
            const D5 = Math.max(0, w6 - 1);
            return A4(D5), D5;
          });
          break;
        }
        case q1.ARROW_DOWN: {
          S((w6) => {
            const D5 = Math.min(x7.length - 1, w6 + 1);
            return A4(D5), D5;
          });
          break;
        }
        case q1.TAB:
        case q1.ENTER: {
          const w6 = x7[R9];
          g9(w6.name, w6.functionType);
          break;
        }
        case q1.ESC: {
          u2(), i();
          break;
        }
      }
    };
    return O9.add(m9.registerCommand({
      id: N6,
      type: Ls.OPERATION,
      handler(I6, x7) {
        const { keyCode: R9 } = x7;
        k6(R9);
      }
    })), [q1.ARROW_UP, q1.ARROW_DOWN, q1.ENTER, q1.ESC, q1.TAB].map((I6) => ({
      id: N6,
      binding: I6,
      preconditions: () => true,
      priority: 1e3,
      staticParameters: {
        eventType: hb.Keyboard,
        keyCode: I6
      }
    })).forEach((I6) => {
      O9.add(l4.registerShortcut(I6));
    }), () => {
      O9.dispose();
    };
  }, [h9]);
  function A4(N6) {
    const O9 = v6.current;
    if (!O9) return;
    const k6 = O9.children[N6];
    if (!k6) return;
    const x7 = O9.getBoundingClientRect().top, R9 = O9.offsetHeight, w6 = k6.getBoundingClientRect(), D5 = w6.top, U3 = w6.height;
    if (D5 >= 0 && D5 > x7 && D5 - x7 + U3 <= R9)
      return;
    const B5 = k6.offsetTop - (R9 - U3) / 2;
    O9.scrollTo({
      top: B5,
      behavior: "smooth"
    });
  }
  const F7 = (0, import_react2.useMemo)(() => {
    let N6 = "";
    return () => {
      clearTimeout(N6), C.current = true, N6 = setTimeout(() => {
        C.current = false;
      }, 300);
    };
  }, []);
  return h9.length > 0 && a4 && (0, import_jsx_runtime2.jsx)(ot, { portal: true, anchorRect$: _3, direction: "vertical", children: (0, import_jsx_runtime2.jsx)(
    "ul",
    {
      ref: (N6) => {
        v6.current = N6, t3 && (t3.current = N6);
      },
      "data-u-comp": "sheets-formula-editor",
      className: ie2("univer-m-0 univer-box-border univer-max-h-[400px] univer-w-[250px] univer-list-none univer-overflow-y-auto univer-rounded-lg univer-bg-white univer-p-2 univer-leading-5 univer-shadow-md univer-outline-none dark:!univer-bg-gray-900", kt2, vr2),
      children: h9.map((N6, O9) => (0, import_jsx_runtime2.jsxs)(
        "li",
        {
          className: ie2("univer-box-border univer-cursor-pointer univer-rounded univer-px-2 univer-py-1 univer-text-gray-900 univer-transition-colors dark:!univer-text-white", {
            "univer-bg-gray-200 dark:!univer-bg-gray-600": p3 === O9
          }),
          onMouseEnter: () => b4(O9),
          onMouseLeave: y6,
          onMouseMove: F7,
          onClick: () => {
            g9(N6.name, N6.functionType), s2 && s2.focus();
          },
          children: [
            (0, import_jsx_runtime2.jsxs)("span", { className: "univer-block univer-truncate univer-text-xs", children: [
              (0, import_jsx_runtime2.jsx)("span", { className: "univer-text-red-500", children: N6.name.substring(0, f4.length) }),
              (0, import_jsx_runtime2.jsx)("span", { children: N6.name.slice(f4.length) })
            ] }),
            (0, import_jsx_runtime2.jsx)(
              "span",
              {
                className: "univer-block univer-text-xs univer-text-gray-400",
                children: N6.desc
              }
            )
          ]
        },
        N6.name
      ))
    }
  ) });
}
var Ec2 = (e) => e.startsWith(Z6.EQUALS) ? e.slice(1) : "";
var er4 = () => {
};
var bc3 = (0, import_react2.forwardRef)((e, t3) => {
  var yn4, Tn5, Nn4, On6;
  const {
    errorText: n3,
    initValue: o3,
    unitId: r,
    subUnitId: s2,
    isFocus: i = true,
    isSupportAcrossSheet: c2 = false,
    onFocus: l4 = er4,
    onBlur: m9 = er4,
    onChange: h9,
    onVerify: f4,
    className: d2,
    editorId: u2,
    moveCursor: a4 = true,
    onFormulaSelectingChange: v6,
    keyboardEventConfig: p3,
    onMoveInEditor: S,
    resetSelectionOnBlur: C = true,
    autoScrollbar: _3 = true,
    isSingle: E3 = true,
    disableSelectionOnClick: g9 = false,
    autofocus: b4 = true,
    disableContextMenu: y6,
    style: A4
  } = e, F7 = useDependency(Ge3), N6 = (0, import_react2.useRef)(null), O9 = re2(h9);
  (0, import_react2.useImperativeHandle)(t3, () => ({
    isClickOutSide: (Z9) => N6.current ? !N6.current.contains(Z9.target) : false
  }));
  const k6 = re2(v6), I6 = (0, import_react2.useRef)(null), x7 = (0, import_react2.useRef)(void 0), R9 = x7.current, [w6, D5] = (0, import_react2.useState)(i), U3 = (0, import_react2.useRef)(null), B5 = (0, import_react2.useMemo)(() => u2 != null ? u2 : QC(`${cb2}-${et(4)}`), []), ce5 = (0, import_react2.useMemo)(() => n3 !== void 0, [n3]), ae5 = useDependency(br), he4 = ae5.getUnit(B5);
  useObservable(he4 == null ? void 0 : he4.change$);
  const K5 = sc3(), J6 = Ze.transform.getPlainText((Tn5 = (yn4 = he4 == null ? void 0 : he4.getBody()) == null ? void 0 : yn4.dataStream) != null ? Tn5 : ""), rt6 = nt4(J6), ot6 = (0, import_react2.useMemo)(() => Ec2(J6), [J6]), Tt3 = (0, import_react2.useMemo)(() => K5(ot6), [ot6, K5]), { isSelecting: Ie, isSelectingRef: Y7 } = oc3({ unitId: r, subUnitId: s2, editorId: B5, isFocus: w6, disableOnClick: g9 }), X9 = (0, import_react2.useRef)(""), fe5 = useDependency(JE).getRenderById(B5), ee5 = fe5 == null ? void 0 : fe5.with(Re), le3 = ee5 == null ? void 0 : ee5.isFocusing, be4 = (0, import_react2.useMemo)(() => ae5.getCurrentTypeOfUnit$(we.UNIVER_DOC), [ae5]), Le7 = useObservable(be4), Me2 = (Le7 == null ? void 0 : Le7.getUnitId()) === B5, G5 = (0, import_react2.useRef)([]), ge5 = Ie, Pe5 = (On6 = (Nn4 = useDependency(xs).getConfig(Nr4)) == null ? void 0 : Nn4.functionScreenTips) != null ? On6 : true;
  e7(() => {
    O9(J6);
  }, [J6, O9]);
  const Ue4 = Hr3("="), Ve6 = cc3(r, s2), oe5 = re2((Z9, se4 = true, we6, Te5) => {
    if (!x7.current) return;
    X9.current = Z9;
    const xt4 = Z9[0] === "=" ? Z9.slice(1) : "", ke4 = K5(xt4), Kr4 = ke4.reduce((We7, wt4) => typeof wt4 == "object" ? `${We7}${wt4.token}` : `${We7}${wt4}`, ""), Mt5 = Ue4(
      x7.current,
      Kr4 === xt4 ? ke4 : [],
      se4,
      Te5
    );
    if (G5.current = Mt5, we6) {
      const We7 = Te5 != null ? Te5 : R9 == null ? void 0 : R9.getSelectionRanges();
      if ((We7 == null ? void 0 : We7.length) !== 1)
        return;
      const Yr4 = We7[0].startOffset - 1, Gr6 = In4(ke4, Yr4, false), xn7 = Ur4(ke4, Gr6);
      if (xn7 >= 0) {
        const Mn5 = Mt5.splice(xn7, 1)[0];
        Mn5 && Mt5.push(Mn5);
      }
      Ve6(w6 ? Mt5 : [], x7.current);
    }
  });
  (0, import_react2.useEffect)(() => {
    w6 && oe5(J6, false, true);
  }, [w6]), (0, import_react2.useEffect)(() => {
    if (w6) {
      if (X9.current === J6) return;
      oe5(J6, false, true);
    }
  }, [J6]), vc3(w6, f4, J6);
  const ye6 = nc3(R9), Nt5 = hc3(w6, r, s2);
  (0, import_react2.useEffect)(() => {
    var Z9;
    k6(Ie, (Z9 = ee5 == null ? void 0 : ee5.isFocusing) != null ? Z9 : true);
  }, [k6, Ie]), Tf(w6, p3, R9), (0, import_react2.useLayoutEffect)(() => {
    let Z9;
    if (U3.current) {
      Z9 = F7.register({
        autofocus: b4,
        editorUnitId: B5,
        initialSnapshot: {
          id: B5,
          body: {
            dataStream: `${o3}\r
`,
            textRuns: [],
            customBlocks: [],
            customDecorations: [],
            customRanges: []
          },
          documentStyle: {}
        }
      }, U3.current);
      const se4 = F7.getEditor(B5);
      x7.current = se4, oe5(o3, false, true);
    }
    return () => {
      Z9 == null || Z9.dispose();
    };
  }, []), (0, import_react2.useLayoutEffect)(() => {
    i ? (D5(i), ye6()) : (C && (R9 == null || R9.blur(), Nt5()), D5(i));
  }, [i, R9, ye6, Nt5, C]);
  const { checkScrollBar: Ot3 } = Bf(R9, E3, _3);
  dc3(w6, !!(Ie && Me2), r, B5, y6), uc4(!!(w6 && le3 && a4), ge5, R9, S);
  const En5 = re2((Z9, se4, we6) => {
    if (!le3)
      return;
    const Te5 = se4 !== -1 ? [{ startOffset: se4 + 1, endOffset: se4 + 1, collapsed: true }] : void 0;
    oe5(`=${Z9}`, true, we6, Te5), we6 && (ye6(), se4 !== -1 && setTimeout(() => {
      const xt4 = { startOffset: se4 + 1, endOffset: se4 + 1 }, ke4 = R9 == null ? void 0 : R9.render.with(uo2);
      ke4 == null || ke4.scrollToRange(__spreadProps(__spreadValues({}, xt4), { collapsed: true }));
    }, 50), Ot3());
  });
  pc3(
    w6 && !!(Ie && Me2),
    w6,
    Y7,
    r,
    s2,
    G5,
    c2,
    !!ge5,
    R9,
    En5
  ), Sc3(w6 && !!(Ie && Me2), r, c2, D5, m9, () => {
    oe5(rt6.current, false, true);
  });
  const bn5 = (Z9) => {
    if (Z9) {
      const se4 = R9 == null ? void 0 : R9.getSelectionRanges();
      if (se4 && se4.length === 1) {
        const we6 = se4[0];
        if (we6.collapsed) {
          const Te5 = Z9.offset;
          setTimeout(() => {
            R9 == null || R9.setSelectionRanges([{ startOffset: we6.startOffset - Te5, endOffset: we6.endOffset - Te5 }]);
          }, 30);
        }
      }
      ye6(), oe5(`=${Z9.text}`);
    }
  }, jr5 = () => {
    D5(true), l4(), ye6();
  };
  return (0, import_jsx_runtime2.jsxs)("div", { className: d2, children: [
    (0, import_jsx_runtime2.jsx)(
      "div",
      {
        ref: N6,
        className: ie2("univer-relative univer-box-border univer-flex univer-h-full univer-w-full univer-items-center univer-justify-around univer-gap-2 univer-rounded-none univer-p-0 univer-ring-1", {
          "univer-ring-primary-500": w6,
          "univer-ring-red-500": ce5
        }),
        children: (0, import_jsx_runtime2.jsx)(
          "div",
          {
            ref: U3,
            className: "univer-relative univer-h-full univer-w-full",
            onMouseUp: jr5
          }
        )
      }
    ),
    n3 !== void 0 && (0, import_jsx_runtime2.jsx)("div", { className: "univer-my-1 univer-text-xs univer-text-red-500", children: n3 }),
    Pe5 && R9 && ot6 !== "" && (0, import_jsx_runtime2.jsx)(
      tc3,
      {
        editor: R9,
        isFocus: w6,
        formulaText: J6,
        onClose: () => ye6()
      }
    ),
    Pe5 && !!R9 && (0, import_jsx_runtime2.jsx)(
      Rc3,
      {
        isFocus: w6,
        sequenceNodes: Tt3,
        onSelect: bn5,
        ref: I6,
        editor: R9
      }
    )
  ] });
});
function yc3(e, t3, n3, o3) {
  const r = useDependency(Mn), s2 = Hr3(""), i = useObservable(e == null ? void 0 : e.getDocumentDataModel().change$), [c2, l4] = (0, import_react2.useState)([]), m9 = useDependency(Xi3), h9 = (0, import_react2.useRef)(""), f4 = useDependency(br);
  return (0, import_react2.useEffect)(() => {
    if (!e) return;
    const d2 = e.getDocumentDataModel().getPlainText();
    if (h9.current === d2)
      return;
    h9.current = d2;
    const u2 = r.sequenceNodesBuilder(d2);
    l4(u2 != null ? u2 : []);
  }, [i, e, r]), (0, import_react2.useEffect)(() => {
    var a4, v6;
    if (!e) return;
    if (!t3) {
      const p3 = e.getDocumentData();
      e.setDocumentData(__spreadProps(__spreadValues({}, p3), {
        body: __spreadProps(__spreadValues({}, p3.body), {
          dataStream: (v6 = (a4 = p3.body) == null ? void 0 : a4.dataStream) != null ? v6 : "",
          textRuns: []
        })
      }));
      return;
    }
    const d2 = s2(e, c2, false), u2 = new ho();
    return d2.forEach((p3) => {
      const S = kr(p3.token), C = f4.getCurrentUnitForType(we.UNIVER_SHEET), _3 = C == null ? void 0 : C.getActiveSheet();
      if (!S.sheetName && o3 !== (_3 == null ? void 0 : _3.getSheetId()) || S.sheetName && (_3 == null ? void 0 : _3.getName()) !== S.sheetName)
        return;
      const E3 = new At(p3.themeColor).toRgb(), g9 = m9.addShape({
        range: S.range,
        style: {
          stroke: p3.themeColor,
          fill: `rgba(${E3.r}, ${E3.g}, ${E3.b}, 0.1)`,
          strokeDash: 12
        },
        primary: null
      });
      g9 && u2.add(() => m9.removeShape(g9));
    }), () => {
      u2.dispose();
    };
  }, [e, t3, s2, m9, c2]), { sequenceNodes: c2 };
}
function Tc2(e) {
  const t3 = useDependency(z), { supportAcrossSheet: n3 = false, keepSheetReference: o3 = false, unitId: r, subUnitId: s2, onChange: i } = e, l4 = useDependency(br).getUnit(r, we.UNIVER_SHEET), m9 = re2(i), h9 = re2((f4, d2) => {
    const u2 = l4 == null ? void 0 : l4.getActiveSheet();
    if (!u2 || !n3 && u2.getSheetId() !== s2 || !(f4 != null && f4.length)) return;
    const a4 = o3 ? u2.getName() : u2.getSheetId() === s2 ? "" : u2.getName(), v6 = f4.map((p3) => ({
      range: p3.range,
      unitId: r,
      sheetName: a4
    }));
    m9(v6, d2);
  });
  (0, import_react2.useEffect)(() => {
    const f4 = new ho();
    return f4.add(t3.selectionMoveStart$.subscribe((d2) => {
      h9(d2, true);
    })), f4.add(t3.selectionMoving$.subscribe((d2) => {
      h9(d2, false);
    })), f4.add(t3.selectionMoveEnd$.subscribe((d2) => {
      h9(d2, false);
    })), () => {
      f4.dispose();
    };
  }, [h9, t3.selectionMoveEnd$, t3.selectionMoveStart$, t3.selectionMoving$]);
}
var tr3 = (e) => !e.some((n3) => {
  if (typeof n3 == "string") {
    if (n3 !== X4.COMMA)
      return true;
  } else if (n3.nodeType !== He.REFERENCE)
    return true;
  return false;
});
var Nc2 = (e) => {
  if (e.endColumn < e.startColumn) {
    const t3 = e.endColumn;
    e.endColumn = e.startColumn, e.startColumn = t3;
  }
  if (e.endRow < e.startRow) {
    const t3 = e.endRow;
    e.endRow = e.startRow, e.startRow = t3;
  }
  return e;
};
function Oc2(e) {
  const {
    visible: t3,
    initialValue: n3,
    unitId: o3,
    subUnitId: r,
    maxRangeCount: s2 = 1 / 0,
    supportAcrossSheet: i,
    keepSheetReference: c2,
    onConfirm: l4,
    onClose: m9,
    onShowBySelection: h9
  } = e, f4 = useDependency(Hn), d2 = useDependency(Mn), [u2, a4] = (0, import_react2.useState)([]), [v6, p3] = (0, import_react2.useState)(0), S = (0, import_react2.useRef)(null);
  (0, import_react2.useEffect)(() => {
    if (t3 && n3.length) {
      const g9 = n3.map((b4) => b4.sheetName ? wl(b4.sheetName, b4.range) : Yt(b4.range));
      a4(g9), p3(g9.length - 1);
    } else
      a4([""]), p3(0);
  }, [t3]);
  const C = (g9, b4) => {
    const y6 = [...u2];
    y6[g9] = b4, a4(y6);
  }, _3 = () => {
    a4([...u2, ""]), p3(u2.length);
  }, E3 = (g9) => {
    u2.splice(g9, 1), a4([...u2]);
  };
  return Tc2({
    unitId: o3,
    subUnitId: r,
    supportAcrossSheet: i,
    keepSheetReference: c2,
    onChange: (g9, b4) => {
      if (!t3 && h9 != null && h9(g9))
        return;
      const y6 = new Set(u2), A4 = g9.map((O9) => O9.sheetName ? wl(O9.sheetName, O9.range) : Yt(O9.range)), F7 = A4.filter((O9) => !y6.has(O9));
      if (!F7.length) return;
      const N6 = [...u2];
      if (A4.length > 1) {
        b4 || N6.splice(v6, 1), N6.push(...F7);
        const O9 = N6.slice(0, s2);
        a4(O9), p3(O9.length - 1), requestAnimationFrame(() => {
          var k6;
          (k6 = S.current) == null || k6.scrollTo({ top: S.current.scrollHeight });
        });
      } else {
        N6.splice(v6, 1, ...F7);
        const O9 = N6.slice(0, s2);
        a4(O9), p3(v6 + F7.length - 1);
      }
    }
  }), (0, import_jsx_runtime2.jsx)(
    Ad,
    {
      width: "328px",
      open: t3,
      title: f4.t("rangeSelector.title"),
      draggable: true,
      mask: false,
      maskClosable: false,
      footer: (0, import_jsx_runtime2.jsxs)("footer", { className: "univer-flex univer-gap-2", children: [
        (0, import_jsx_runtime2.jsx)(fr, { onClick: m9, children: f4.t("rangeSelector.cancel") }),
        (0, import_jsx_runtime2.jsx)(
          fr,
          {
            variant: "primary",
            onClick: () => {
              l4(
                u2.filter((g9) => {
                  const b4 = d2.sequenceNodesBuilder(g9);
                  return b4 && b4.length === 1 && typeof b4[0] != "string" && b4[0].nodeType === He.REFERENCE;
                }).map((g9) => kr(g9)).map((g9) => __spreadProps(__spreadValues({}, g9), { range: Nc2(g9.range) }))
              );
            },
            children: f4.t("rangeSelector.confirm")
          }
        )
      ] }),
      onClose: m9,
      children: (0, import_jsx_runtime2.jsxs)(
        "div",
        {
          ref: S,
          className: ie2("-univer-mx-6 univer-max-h-60 univer-overflow-y-auto univer-px-6", vr2),
          children: [
            u2.map((g9, b4) => (0, import_jsx_runtime2.jsxs)(
              "div",
              {
                className: "univer-mb-2 univer-flex univer-items-center univer-gap-4",
                children: [
                  (0, import_jsx_runtime2.jsx)(
                    eC,
                    {
                      className: ie2("univer-w-full", {
                        "univer-border-primary-600": v6 === b4
                      }),
                      placeholder: f4.t("rangeSelector.placeHolder"),
                      onFocus: () => p3(b4),
                      value: g9,
                      onChange: (y6) => C(b4, y6)
                    }
                  ),
                  u2.length > 1 && (0, import_jsx_runtime2.jsx)(
                    Fr4,
                    {
                      className: "univer-cursor-pointer",
                      onClick: () => E3(b4)
                    }
                  )
                ]
              },
              b4
            )),
            u2.length < s2 && (0, import_jsx_runtime2.jsx)("div", { children: (0, import_jsx_runtime2.jsxs)(fr, { variant: "link", onClick: _3, children: [
              (0, import_jsx_runtime2.jsx)(Dr5, {}),
              (0, import_jsx_runtime2.jsx)("span", { children: f4.t("rangeSelector.addAnotherRange") })
            ] }) })
          ]
        }
      )
    }
  );
}
function xc2(e) {
  return e.split(X4.COMMA).filter((t3) => !!t3).map((t3) => kr(t3));
}
function Mc2(e) {
  return e.map((t3) => t3.sheetName ? wl(t3.sheetName, t3.range) : Yt(t3.range)).join(X4.COMMA);
}
function Br4(e) {
  const [t3, n3] = (0, import_react2.useState)(null), {
    onVerify: o3,
    selectorRef: r,
    unitId: s2,
    subUnitId: i,
    maxRangeCount: c2,
    supportAcrossSheet: l4,
    keepSheetReference: m9,
    autoFocus: h9,
    onChange: f4,
    onRangeSelectorDialogVisibleChange: d2,
    onClickOutside: u2,
    onFocusChange: a4,
    forceShowDialogWhenSelectionChanged: v6,
    hideEditor: p3,
    resetRange: S
  } = e, [C, _3] = (0, import_react2.useState)(h9 != null ? h9 : false), [E3, g9] = (0, import_react2.useState)(false), [b4, y6] = (0, import_react2.useState)([]), A4 = useDependency(Hn), F7 = useDependency(Ge3), { sequenceNodes: N6 } = yc3(t3, C, s2, i), O9 = nt4(N6), k6 = useDependency(Ds), I6 = re2(() => {
    t3 == null || t3.setSelectionRanges([]), t3 == null || t3.blur(), F7.blur();
  }), x7 = re2(() => {
    var R9;
    I6(), y6(xc2((R9 = t3 == null ? void 0 : t3.getDocumentDataModel().getPlainText()) != null ? R9 : "")), g9(true);
  });
  return (0, import_react2.useEffect)(() => {
    r && (r.current = {
      get editor() {
        return t3;
      },
      focus() {
        F7.focus(t3.getEditorId());
      },
      blur: I6,
      verify: () => tr3(O9.current),
      showDialog: (R9) => {
        I6(), y6(R9), g9(true);
      },
      hideDialog: () => {
        y6([]), g9(false);
      },
      getValue: () => {
        var R9;
        return (R9 = t3 == null ? void 0 : t3.getDocumentDataModel().getPlainText()) != null ? R9 : "";
      }
    });
  }, [I6, t3, F7, r, O9]), (0, import_react2.useEffect)(() => {
    var R9;
    o3 == null || o3(tr3(N6), (R9 = t3 == null ? void 0 : t3.getDocumentDataModel().getPlainText()) != null ? R9 : "");
  }, [N6]), (0, import_react2.useEffect)(() => {
    d2 == null || d2(E3);
  }, [E3]), (0, import_react2.useEffect)(() => {
    if (E3 && S)
      return () => {
        const R9 = {
          unitId: s2,
          subUnitId: i,
          selections: S
        };
        k6.executeCommand(ie5.id, R9);
      };
  }, [E3]), (0, import_jsx_runtime2.jsxs)(import_jsx_runtime2.Fragment, { children: [
    p3 ? null : (0, import_jsx_runtime2.jsx)(
      Zf,
      __spreadProps(__spreadValues({
        isSingle: true
      }, e), {
        onFocusChange: (R9, w6) => {
          _3(R9), a4 == null || a4(R9, w6);
        },
        editorRef: n3,
        onClickOutside: () => {
          _3(false), I6(), u2 == null || u2();
        },
        icon: (0, import_jsx_runtime2.jsx)(Np, { title: A4.t("rangeSelector.buttonTooltip"), placement: "bottom", children: (0, import_jsx_runtime2.jsx)(
          Lr5,
          {
            className: "univer-cursor-pointer dark:!univer-text-gray-300",
            onClick: x7
          }
        ) })
      })
    ),
    (0, import_jsx_runtime2.jsx)(
      Oc2,
      {
        initialValue: b4,
        unitId: s2,
        subUnitId: i,
        visible: E3,
        maxRangeCount: c2,
        onConfirm: (R9) => {
          const w6 = Mc2(R9), D5 = Fn.newEmptyData();
          D5.body.dataStream = w6, t3 == null || t3.replaceText(w6, false), f4 == null || f4(D5, w6), g9(false), y6([]), requestAnimationFrame(() => {
            I6();
          });
        },
        onClose: () => {
          g9(false), y6([]);
        },
        supportAcrossSheet: l4,
        keepSheetReference: m9,
        onShowBySelection: (R9) => C || v6 ? (y6(R9), g9(true), false) : true
      }
    )
  ] });
}
var wc3 = () => {
  var o3, r;
  const e = useDependency(Pr5), t3 = useObservable(e.currentSelector$), n3 = (0, import_react2.useRef)(null);
  return (0, import_react2.useEffect)(() => {
    var s2, i;
    if (t3)
      return (i = n3.current) == null || i.showDialog((s2 = t3.initialValue) != null ? s2 : []), () => {
        var c2;
        (c2 = n3.current) == null || c2.hideDialog();
      };
  }, [t3]), (0, import_jsx_runtime2.jsx)(
    Br4,
    {
      unitId: (o3 = t3 == null ? void 0 : t3.unitId) != null ? o3 : "",
      subUnitId: (r = t3 == null ? void 0 : t3.subUnitId) != null ? r : "",
      hideEditor: true,
      selectorRef: n3,
      onChange: (s2, i) => {
        var c2;
        t3 == null || t3.callback((c2 = i == null ? void 0 : i.split(",").map((l4) => kr(l4))) != null ? c2 : []);
      }
    }
  );
};
var kc2 = Object.defineProperty;
var Ac2 = Object.getOwnPropertyDescriptor;
var Fc2 = (e, t3, n3) => t3 in e ? kc2(e, t3, { enumerable: true, configurable: true, writable: true, value: n3 }) : e[t3] = n3;
var Dc2 = (e, t3, n3, o3) => {
  for (var r = o3 > 1 ? void 0 : o3 ? Ac2(t3, n3) : t3, s2 = e.length - 1, i; s2 >= 0; s2--)
    (i = e[s2]) && (r = i(r) || r);
  return r;
};
var Ft5 = (e, t3) => (n3, o3) => t3(n3, o3, e);
var qr5 = (e, t3, n3) => Fc2(e, typeof t3 != "symbol" ? t3 + "" : t3, n3);
var jt = class extends yl {
  constructor(e = zn4, t3, n3, o3, r) {
    super(), this._config = e, this._injector = t3, this._renderManagerService = n3, this._configService = o3, this._uiPartsService = r;
    const _a5 = co(
      zn4,
      this._config
    ), { menu: s2 } = _a5, i = __objRest(_a5, ["menu"]);
    s2 && this._configService.setConfig("menu", s2, { merge: true }), this._configService.setConfig(Nr4, i, { merge: true });
  }
  onStarting() {
    eR(this._injector, [
      [zt3, { useClass: sn2 }],
      [Pr5],
      [Bt2],
      [Ut4],
      [Vt2],
      [Wt4],
      [Ht4],
      [Pt5],
      [qt2]
    ]), this._initUIPart();
  }
  onReady() {
    [
      [De]
    ].forEach((e) => {
      this.disposeWithMe(this._renderManagerService.registerRenderModule(we.UNIVER_SHEET, e));
    });
  }
  onRendered() {
    [
      [cn2]
    ].forEach((e) => {
      this.disposeWithMe(this._renderManagerService.registerRenderModule(we.UNIVER_SHEET, e));
    }), Kc(this._injector, [
      [Bt2],
      // FormulaProgressBar relies on TriggerCalculationController, but it is necessary to ensure that the formula calculation is done after rendered.
      [Vt2],
      [Ht4],
      [qt2]
    ]);
  }
  onSteady() {
    this._injector.get(Ut4), this._injector.get(Pt5);
  }
  _initUIPart() {
    const e = this._injector.get(S13);
    this.disposeWithMe(e.register(_m2, Br4)), this.disposeWithMe(e.register(zd2, bc3)), this.disposeWithMe(this._uiPartsService.registerComponent(u12.GLOBAL, () => connectInjector(wc3, this._injector)));
  }
};
qr5(jt, "pluginName", br7);
qr5(jt, "type", we.UNIVER_SHEET);
jt = Dc2([
  sI(uo3, lt4),
  Ft5(1, Inject(Injector)),
  Ft5(2, JE),
  Ft5(3, xs),
  Ft5(4, N1)
], jt);

// node_modules/@univerjs/sheets-numfmt/lib/es/index.js
var ae2 = Object.defineProperty;
var ie7 = (e, r, t3) => r in e ? ae2(e, r, { enumerable: true, configurable: true, writable: true, value: t3 }) : e[r] = t3;
var L4 = (e, r, t3) => ie7(e, typeof r != "symbol" ? r + "" : r, t3);
var ne3 = [
  "$",
  "Â£",
  "Â¥",
  "Â¤",
  "Ö",
  "Ø‹",
  "à§³",
  "à¸¿",
  "áŸ›",
  "â‚¡",
  "â‚¦",
  "â‚©",
  "â‚ª",
  "â‚«",
  "â‚¬",
  "â‚­",
  "â‚®",
  "â‚±",
  "â‚²",
  "â‚´",
  "â‚¸",
  "â‚¹",
  "â‚º",
  "â‚¼",
  "â‚½",
  "â‚¾",
  "â‚¿",
  "ï·¼"
];
var w2 = /* @__PURE__ */ new Map([
  [Ts.EN_US, "$"],
  [Ts.RU_RU, "â‚½"],
  [Ts.VI_VN, "â‚«"],
  [Ts.ZH_CN, "Â¥"],
  [Ts.ZH_TW, "NT$"],
  [Ts.FR_FR, "â‚¬"],
  [Ts.FA_IR, "ï·¼"],
  [Ts.KO_KR, "â‚©"],
  [Ts.ES_ES, "â‚¬"],
  [Ts.CA_ES, "â‚¬"]
]);
function xe4(e) {
  switch (e) {
    case Ts.CA_ES:
    case Ts.ES_ES:
    case Ts.FR_FR:
      return {
        icon: "EuroIcon",
        symbol: w2.get(e) || "â‚¬",
        locale: e
      };
    case Ts.RU_RU:
      return {
        icon: "RoubleIcon",
        symbol: w2.get(e) || "â‚½",
        locale: e
      };
    case Ts.ZH_CN:
      return {
        icon: "RmbIcon",
        symbol: w2.get(e) || "Â¥",
        locale: e
      };
    case Ts.EN_US:
    default:
      return {
        icon: "DollarIcon",
        symbol: "$",
        locale: Ts.EN_US
      };
  }
}
function Y4(e) {
  return w2.get(e) || "$";
}
function Pe4(e, r = 2) {
  let t3 = r;
  r > 127 && (t3 = 127);
  let n3 = "";
  return t3 > 0 && (n3 = `.${"0".repeat(t3)}`), `"${Y4(e)}"#,##0${n3}_);[Red]("${Y4(e)}"#,##0${n3})`;
}
var Fe4 = [
  {
    label: "1930-08-05",
    suffix: "yyyy-MM-dd"
  },
  {
    label: "1930/08/05",
    suffix: "yyyy/MM/dd"
  },
  {
    label: "1930å¹´08æœˆ05æ—¥",
    suffix: 'yyyy"å¹´"MM"æœˆ"dd"æ—¥"'
  },
  {
    label: "08-05",
    suffix: "MM-dd"
  },
  {
    label: "8æœˆ5æ—¥",
    suffix: 'M"æœˆ"d"æ—¥"'
  },
  {
    label: "13:30:30",
    suffix: "h:mm:ss"
  },
  {
    label: "13:30",
    suffix: "h:mm"
  },
  {
    label: "ä¸‹åˆ01:30",
    suffix: "A/P hh:mm"
  },
  {
    label: "ä¸‹åˆ1:30",
    suffix: "A/P h:mm"
  },
  {
    label: "ä¸‹åˆ1:30:30",
    suffix: "A/P h:mm:ss"
  },
  {
    label: "08-05 ä¸‹åˆ 01:30",
    suffix: "MM-dd A/P hh:mm"
  }
];
var De2 = [
  {
    label: "(1,235)",
    suffix: "#,##0_);(#,##0)"
  },
  {
    label: "(1,235) ",
    suffix: "#,##0_);[Red](#,##0)",
    color: "red"
  },
  {
    label: "1,234.56",
    suffix: "#,##0.00_);#,##0.00"
  },
  {
    label: "1,234.56",
    suffix: "#,##0.00_);[Red]#,##0.00",
    color: "red"
  },
  {
    label: "-1,234.56",
    suffix: "#,##0.00_);-#,##0.00"
  },
  {
    label: "-1,234.56",
    suffix: "#,##0.00_);[Red]-#,##0.00",
    color: "red"
  }
];
var Ae6 = [
  {
    label: (e) => `${e}1,235`,
    suffix: (e) => `"${e}"#,##0.00_);"${e}"#,##0.00`
  },
  {
    label: (e) => `${e}1,235`,
    suffix: (e) => `"${e}"#,##0.00_);[Red]"${e}"#,##0.00`,
    color: "red"
  },
  {
    label: (e) => `(${e}1,235)`,
    suffix: (e) => `"${e}"#,##0.00_);("${e}"#,##0.00)`
  },
  {
    label: (e) => `(${e}1,235)`,
    suffix: (e) => `"${e}"#,##0.00_);[Red]("${e}"#,##0.00)`,
    color: "red"
  },
  {
    label: (e) => `-${e}1,235`,
    suffix: (e) => `"${e}"#,##0.00_);-"${e}"#,##0.00`
  },
  {
    label: (e) => `-${e}1,235`,
    suffix: (e) => `"${e}"#,##0.00_);[Red]-"${e}"#,##0.00`,
    color: "red"
  }
];
var P6 = (e, r = 0) => {
  var n3;
  return e && (n3 = a1.getFormatInfo(e).maxDecimals) != null ? n3 : r;
};
var q7 = (e) => new Array(Math.min(Math.max(0, Number(e)), 30)).fill(0).join("");
var F2 = (e, r) => e.split(";").map((n3) => /\.0?/.test(n3) ? n3.replace(
  /\.0*/g,
  `${r > 0 ? "." : ""}${q7(Number(r || 0))}`
) : /0([^0]?)|0$/.test(n3) ? n3.replace(
  /0([^0]+)|0$/,
  `0${r > 0 ? "." : ""}${q7(Number(r || 0))}$1`
) : n3).join(";");
var nt5 = (e) => /\.0?/.test(e) || /0([^0]?)|0$/.test(e);
var O4 = {
  id: "sheet.command.numfmt.set.numfmt",
  type: Ls.COMMAND,
  // eslint-disable-next-line max-lines-per-function
  handler: (e, r) => {
    if (!r)
      return false;
    const t3 = e.get(Ds), n3 = e.get(br), s2 = e.get(ra), a4 = P5(n3, r);
    if (!a4) return false;
    const { unitId: l4, subUnitId: o3, worksheet: h9 } = a4, u2 = r.values.filter((i) => !!i.pattern), C = r.values.filter((i) => !i.pattern), y6 = Ps(l4, o3, u2), p3 = {
      unitId: l4,
      subUnitId: o3,
      ranges: C.map((i) => ({
        startColumn: i.col,
        startRow: i.row,
        endColumn: i.col,
        endRow: i.row
      }))
    }, b4 = [], _3 = [];
    if (u2.length) {
      const i = u2.reduce((d2, c2) => {
        l1(c2.pattern) && d2.setValue(c2.row, c2.col, { t: mn.STRING });
        const S = h9.getCellRaw(c2.row, c2.col);
        if (S) {
          const T10 = uo4(S.v);
          T10 !== S.t && d2.setValue(c2.row, c2.col, { t: T10 });
        }
        return d2;
      }, new ht()).getMatrix(), g9 = new ht();
      new ht(i).forValue((d2, c2) => {
        const S = h9.getCellRaw(d2, c2);
        S ? g9.setValue(d2, c2, { t: S.t }) : g9.setValue(d2, c2, { t: void 0 });
      }), Object.keys(y6.values).forEach((d2) => {
        const c2 = y6.values[d2];
        c2.ranges = nr3(c2.ranges);
      }), b4.push({
        id: so2.id,
        params: y6
      });
      const v6 = cg(e, y6);
      _3.push(...v6);
    }
    if (C.length) {
      p3.ranges = nr3(p3.ranges);
      const i = C.reduce((d2, c2) => {
        const S = h9.getCellRaw(c2.row, c2.col);
        if (S) {
          const T10 = uo4(S.v);
          T10 !== S.t && d2.setValue(c2.row, c2.col, { t: T10 });
        }
        return d2;
      }, new ht()).getMatrix(), g9 = new ht();
      new ht(i).forValue((d2, c2) => {
        const S = h9.getCellRaw(d2, c2);
        S ? g9.setValue(d2, c2, { t: S.t }) : g9.setValue(d2, c2, { t: void 0 });
      }), b4.push({
        id: mi.id,
        params: p3
      }, {
        id: ee2.id,
        params: {
          unitId: l4,
          subUnitId: o3,
          cellValue: i
        }
      });
      const v6 = dg2(e, p3);
      _3.push({
        id: ee2.id,
        params: {
          unitId: l4,
          subUnitId: o3,
          cellValue: g9.getMatrix()
        }
      }, ...v6);
    }
    const m9 = po(b4, t3).result;
    return m9 && s2.pushUndoRedo({
      unitID: l4,
      undoMutations: _3,
      redoMutations: b4
    }), m9;
  }
};
var Ve5 = {
  id: "sheet.command.numfmt.add.decimal.command",
  type: Ls.COMMAND,
  handler: (e) => __async(void 0, null, function* () {
    const r = e.get(Ds), t3 = e.get(z), n3 = e.get($t2), s2 = e.get(br), a4 = t3.getCurrentSelections();
    if (!a4 || !a4.length)
      return false;
    const l4 = P5(s2);
    if (!l4) return false;
    const { unitId: o3, subUnitId: h9 } = l4;
    let u2 = 0;
    a4.forEach((b4) => {
      vr.foreach(b4.range, (_3, m9) => {
        const i = n3.getValue(o3, h9, _3, m9);
        if (!i) {
          const v6 = l4.worksheet.getCellRaw(_3, m9);
          if (!u2 && v6 && v6.t === mn.NUMBER && v6.v) {
            const d2 = /\.(\d*)$/.exec(String(v6.v));
            if (d2) {
              const c2 = d2[1].length;
              if (!c2)
                return;
              u2 = Math.max(u2, c2);
            }
          }
          return;
        }
        const g9 = P6(i.pattern);
        u2 = g9 > u2 ? g9 : u2;
      });
    });
    const C = u2 + 1, y6 = F2(`0${C > 0 ? ".0" : ""}`, C), p3 = [];
    return a4.forEach((b4) => {
      vr.foreach(b4.range, (_3, m9) => {
        const i = n3.getValue(o3, h9, _3, m9);
        if (u1(i == null ? void 0 : i.pattern))
          p3.push({
            row: _3,
            col: m9,
            pattern: y6
          });
        else {
          const g9 = P6(i.pattern), v6 = F2(i.pattern, g9 + 1);
          v6 !== i.pattern && p3.push({
            row: _3,
            col: m9,
            pattern: v6
          });
        }
      });
    }), p3.length ? yield r.executeCommand(O4.id, { values: p3 }) : false;
  })
};
var je2 = {
  id: "sheet.command.numfmt.set.currency",
  type: Ls.COMMAND,
  handler: (e) => __async(void 0, null, function* () {
    const r = e.get(Ds), t3 = e.get(z), n3 = e.get(Hn), s2 = t3.getCurrentSelections();
    if (!s2 || !s2.length)
      return false;
    const a4 = [], l4 = xe4(n3.getCurrentLocale()), o3 = Pe4(l4.locale);
    return s2.forEach((u2) => {
      vr.foreach(u2.range, (C, y6) => {
        a4.push({ row: C, col: y6, pattern: o3, type: "currency" });
      });
    }), yield r.executeCommand(O4.id, { values: a4 });
  })
};
var Le5 = {
  id: "sheet.command.numfmt.set.percent",
  type: Ls.COMMAND,
  handler: (e) => __async(void 0, null, function* () {
    const r = e.get(Ds), n3 = e.get(z).getCurrentSelections();
    if (!n3 || !n3.length)
      return false;
    const s2 = [], a4 = "0%";
    return n3.forEach((o3) => {
      vr.foreach(o3.range, (h9, u2) => {
        s2.push({ row: h9, col: u2, pattern: a4, type: "percent" });
      });
    }), yield r.executeCommand(O4.id, { values: s2 });
  })
};
var Be5 = {
  id: "sheet.command.numfmt.subtract.decimal.command",
  type: Ls.COMMAND,
  handler: (e) => __async(void 0, null, function* () {
    const r = e.get(Ds), t3 = e.get(z), n3 = e.get($t2), s2 = e.get(br), a4 = t3.getCurrentSelections();
    if (!a4 || !a4.length)
      return false;
    const l4 = P5(s2);
    if (!l4) return false;
    const { unitId: o3, subUnitId: h9 } = l4;
    let u2 = 0;
    a4.forEach((_3) => {
      vr.foreach(_3.range, (m9, i) => {
        const g9 = n3.getValue(o3, h9, m9, i);
        if (!g9) {
          const d2 = l4.worksheet.getCellRaw(m9, i);
          if (!u2 && d2 && d2.t === mn.NUMBER && d2.v) {
            const c2 = /\.(\d*)$/.exec(String(d2.v));
            if (c2) {
              const S = c2[1].length;
              if (!S)
                return;
              u2 = Math.max(u2, S);
            }
          }
          return;
        }
        const v6 = P6(g9.pattern);
        u2 = v6 > u2 ? v6 : u2;
      });
    });
    const C = u2 - 1, y6 = F2(`0${C > 0 ? ".0" : "."}`, C), p3 = [];
    return a4.forEach((_3) => {
      vr.foreach(_3.range, (m9, i) => {
        const g9 = n3.getValue(o3, h9, m9, i);
        if (u1(g9 == null ? void 0 : g9.pattern))
          p3.push({
            row: m9,
            col: i,
            pattern: y6
          });
        else {
          const v6 = P6(g9.pattern);
          p3.push({
            row: m9,
            col: i,
            pattern: F2(g9.pattern, v6 - 1)
          });
        }
      });
    }), yield r.executeCommand(O4.id, { values: p3 });
  })
};
var se3 = "sheets-numfmt.config";
var X5 = {};
var st4 = (e) => a1.getFormatInfo(e).type || "unknown";
var He5 = (e, r, t3 = "en") => {
  try {
    const n3 = a1.formatColor(e, r), s2 = n3 ? String(n3) : void 0, a4 = a1.format(e, r, { locale: t3, throws: false });
    return r < 0 ? {
      result: a4,
      color: s2
    } : {
      result: a4
    };
  } catch (n3) {
    console.warn("getPatternPreview error:", e, n3);
  }
  return {
    result: String(r)
  };
};
var Ge6 = (e, r, t3) => e === xp ? {
  result: String(Sa2(r))
  // In Excel, the default General format also needs to handle numeric precision.
} : He5(e, r, t3);
var We5 = Object.getOwnPropertyDescriptor;
var Ke5 = (e, r, t3, n3) => {
  for (var s2 = n3 > 1 ? void 0 : n3 ? We5(r, t3) : r, a4 = e.length - 1, l4; a4 >= 0; a4--)
    (l4 = e[a4]) && (s2 = l4(s2) || s2);
  return s2;
};
var E2 = (e, r) => (t3, n3) => r(t3, n3, e);
var Ze2 = {
  tl: {
    size: 6,
    color: "#409f11"
  }
};
var D3 = class extends Ve {
  constructor(r, t3, n3, s2, a4, l4, o3) {
    super();
    L4(this, "_locale$", new BehaviorSubject("en"));
    L4(this, "locale$", this._locale$.asObservable());
    this._instanceService = r, this._sheetInterceptorService = t3, this._themeService = n3, this._commandService = s2, this._numfmtService = a4, this._localeService = l4, this._configService = o3, this._initInterceptorCellContent();
  }
  get locale() {
    const r = this._locale$.getValue();
    if (r)
      return r;
    switch (this._localeService.getCurrentLocale()) {
      case Ts.FR_FR:
        return "fr";
      case Ts.RU_RU:
        return "ru";
      case Ts.VI_VN:
        return "vi";
      case Ts.ZH_CN:
        return "zh-CN";
      case Ts.KO_KR:
        return "ko";
      case Ts.ZH_TW:
        return "zh-TW";
      case Ts.ES_ES:
      case Ts.CA_ES:
        return "es";
      case Ts.EN_US:
      case Ts.FA_IR:
      default:
        return "en";
    }
  }
  // eslint-disable-next-line max-lines-per-function
  _initInterceptorCellContent() {
    const r = new ht();
    this.disposeWithMe(merge(this._locale$, this._localeService.currentLocale$).subscribe(() => {
      r.reset();
    })), this.disposeWithMe(this._sheetInterceptorService.intercept(ht2.CELL_CONTENT, {
      effect: ir.Value | ir.Style,
      // eslint-disable-next-line max-lines-per-function, complexity
      handler: (t3, n3, s2) => {
        var b4, _3;
        if (!t3 || t3.v === void 0 || t3.v === null || t3.t === mn.BOOLEAN || t3.t === mn.FORCE_STRING)
          return s2(t3);
        const a4 = n3.unitId, l4 = n3.subUnitId;
        let o3;
        if (t3 != null && t3.s) {
          const m9 = n3.workbook.getStyles().get(t3.s);
          m9 != null && m9.n && (o3 = m9.n);
        }
        if (o3 || (o3 = this._numfmtService.getValue(a4, l4, n3.row, n3.col)), u1(o3 == null ? void 0 : o3.pattern) || t3.t !== mn.NUMBER && uo4(t3.v, t3.t) !== mn.NUMBER)
          return s2(t3);
        const h9 = t3;
        if ((!t3 || t3 === n3.rawData) && (t3 = __spreadValues({}, n3.rawData)), l1(o3 == null ? void 0 : o3.pattern))
          return (b4 = this._configService.getConfig(se3)) != null && b4.disableTextFormatMark ? (t3.t = mn.STRING, s2(t3)) : (t3.t = mn.STRING, t3.markers = __spreadValues(__spreadValues({}, t3 == null ? void 0 : t3.markers), Ze2), s2(t3));
        let u2 = "";
        const C = r.getValue(n3.row, n3.col);
        if (C && C.parameters === `${h9.v}_${o3 == null ? void 0 : o3.pattern}`)
          return s2(__spreadValues(__spreadValues({}, t3), C.result));
        const y6 = Ge6(o3 == null ? void 0 : o3.pattern, Number(h9.v), this.locale);
        if (u2 = y6.result, !u2)
          return s2(t3);
        const p3 = { v: u2, t: mn.NUMBER };
        if (y6.color) {
          const m9 = (_3 = this._themeService.getColorFromTheme(`${y6.color}.500`)) != null ? _3 : y6.color;
          m9 && (p3.interceptorStyle = { cl: { rgb: m9 } });
        }
        return r.setValue(n3.row, n3.col, {
          result: p3,
          parameters: `${h9.v}_${o3 == null ? void 0 : o3.pattern}`
        }), Object.assign(t3, p3), s2(t3);
      },
      priority: Ca3.NUMFMT
    })), this.disposeWithMe(this._commandService.onCommandExecuted((t3) => {
      if (t3.id === so2.id) {
        const n3 = t3.params;
        Object.keys(n3.values).forEach((s2) => {
          n3.values[s2].ranges.forEach((l4) => {
            vr.foreach(l4, (o3, h9) => {
              r.realDeleteValue(o3, h9);
            });
          });
        });
      } else if (t3.id === ee2.id) {
        const n3 = t3.params;
        new ht(n3.cellValue).forValue((s2, a4) => {
          r.realDeleteValue(s2, a4);
        });
      }
    })), this.disposeWithMe(
      this._instanceService.getCurrentTypeOfUnit$(we.UNIVER_SHEET).pipe(
        switchMap((t3) => {
          var n3;
          return (n3 = t3 == null ? void 0 : t3.activeSheet$) != null ? n3 : of(null);
        }),
        skip(1)
      ).subscribe(() => r.reset())
    );
  }
  setNumfmtLocal(r) {
    this._locale$.next(r);
  }
};
D3 = Ke5([
  E2(0, br),
  E2(1, Inject(G)),
  E2(2, Inject(Ji)),
  E2(3, Inject(Ds)),
  E2(4, Inject($t2)),
  E2(5, Inject(Hn)),
  E2(6, xs)
], D3);
var ze6 = "SHEET_NUMFMT_PLUGIN";
var ke3 = Object.defineProperty;
var Ye5 = Object.getOwnPropertyDescriptor;
var qe3 = (e, r, t3) => r in e ? ke3(e, r, { enumerable: true, configurable: true, writable: true, value: t3 }) : e[r] = t3;
var Xe8 = (e, r, t3, n3) => {
  for (var s2 = n3 > 1 ? void 0 : n3 ? Ye5(r, t3) : r, a4 = e.length - 1, l4; a4 >= 0; a4--)
    (l4 = e[a4]) && (s2 = l4(s2) || s2);
  return s2;
};
var B2 = (e, r) => (t3, n3) => r(t3, n3, e);
var oe2 = (e, r, t3) => qe3(e, typeof r != "symbol" ? r + "" : r, t3);
var A = class extends yl {
  constructor(e = X5, r, t3, n3) {
    super(), this._config = e, this._injector = r, this._configService = t3, this._commandService = n3;
    const s2 = __objRest(co(
      {},
      X5,
      this._config
    ), []);
    this._configService.setConfig(se3, s2);
  }
  onStarting() {
    eR(this._injector, [
      [D3]
    ]), Kc(this._injector, [
      [D3]
    ]);
  }
  onRendered() {
    [
      Ve5,
      Be5,
      je2,
      Le5,
      O4
    ].forEach((e) => {
      this.disposeWithMe(this._commandService.registerCommand(e));
    });
  }
};
oe2(A, "pluginName", ze6);
oe2(A, "type", we.UNIVER_SHEET);
A = Xe8([
  sI(rs2),
  B2(1, Inject(Injector)),
  B2(2, xs),
  B2(3, Ds)
], A);
var ot4 = (e) => ne3.find((t3) => e.includes(t3));
var at3 = () => ne3.map((e) => ({ label: e, value: e }));
var it3 = (e) => Ae6.map((r) => ({
  label: r.label(e),
  value: r.suffix(e),
  color: r.color
}));
var ct7 = () => Fe4.map((e) => ({ label: e.label, value: e.suffix }));
var lt5 = () => De2.map((e) => ({ label: e.label, value: e.suffix, color: e.color }));

// node_modules/@univerjs/sheets-numfmt-ui/lib/es/index.js
var import_jsx_runtime3 = __toESM(require_jsx_runtime());
var import_react3 = __toESM(require_react());
var ut5 = Object.defineProperty;
var mt5 = (e, t3, r) => t3 in e ? ut5(e, t3, { enumerable: true, configurable: true, writable: true, value: r }) : e[t3] = r;
var X6 = (e, t3, r) => mt5(e, typeof t3 != "symbol" ? t3 + "" : t3, r);
var xe5 = {};
var _n5 = Object.getOwnPropertyDescriptor;
var Sn4 = (e, t3, r, n3) => {
  for (var i = n3 > 1 ? void 0 : n3 ? _n5(t3, r) : t3, s2 = e.length - 1, o3; s2 >= 0; s2--)
    (o3 = e[s2]) && (i = o3(i) || i);
  return i;
};
var k3 = (e, t3) => (r, n3) => t3(r, n3, e);
var oe3 = "SHEET_NUMFMT_ALERT";
var de2 = class extends Ve {
  constructor(e, t3, r, n3, i, s2, o3) {
    super(), this._context = e, this._hoverManagerService = t3, this._cellAlertManagerService = r, this._localeService = n3, this._zenZoneService = i, this._numfmtService = s2, this._configService = o3, this._init();
  }
  _init() {
    this._initCellAlertPopup(), this._initZenService();
  }
  _initCellAlertPopup() {
    this.disposeWithMe(this._hoverManagerService.currentCell$.pipe(debounceTime(100)).subscribe((e) => {
      var t3, r;
      if (e) {
        const n3 = e.location, i = this._context.unit, s2 = i.getActiveSheet();
        if (!s2) return this._hideAlert();
        const o3 = n3.unitId, m9 = n3.subUnitId;
        let c2;
        const a4 = s2.getCell(n3.row, n3.col);
        if (a4 != null && a4.s) {
          const u2 = i.getStyles().get(a4.s);
          u2 != null && u2.n && (c2 = u2.n);
        }
        if (c2 || (c2 = this._numfmtService.getValue(o3, m9, n3.row, n3.col)), !c2) {
          this._hideAlert();
          return;
        }
        if (l1(c2.pattern) && Z.isDefine(a4 == null ? void 0 : a4.v) && s1(a4.v)) {
          if ((t3 = this._configService.getConfig(se3)) != null && t3.disableTextFormatAlert)
            return;
          const u2 = this._cellAlertManagerService.currentAlert.get(oe3), l4 = (r = u2 == null ? void 0 : u2.alert) == null ? void 0 : r.location;
          if (l4 && l4.row === n3.row && l4.col === n3.col && l4.subUnitId === n3.subUnitId && l4.unitId === n3.unitId) {
            this._hideAlert();
            return;
          }
          this._cellAlertManagerService.showAlert({
            type: Co2.ERROR,
            title: this._localeService.t("info.error"),
            message: this._localeService.t("info.forceStringInfo"),
            location: n3,
            width: 200,
            height: 74,
            key: oe3
          });
          return;
        }
      }
      this._hideAlert();
    }));
  }
  _initZenService() {
    this.disposeWithMe(this._zenZoneService.visible$.subscribe((e) => {
      e && this._hideAlert();
    }));
  }
  _hideAlert() {
    this._cellAlertManagerService.removeAlert(oe3);
  }
};
de2 = Sn4([
  k3(1, Inject(Mr3)),
  k3(2, Inject(Fo3)),
  k3(3, Inject(Hn)),
  k3(4, lt),
  k3(5, Inject($t2)),
  k3(6, xs)
], de2);
var ce4 = {
  id: "sheet.operation.close.numfmt.panel",
  type: Ls.OPERATION,
  handler: () => (
    // do nothing, just notify panel is closed
    true
  )
};
var A2 = {
  id: "sheet.operation.open.numfmt.panel",
  type: Ls.OPERATION,
  handler: (e) => (e.get(j4).openPanel(), true)
};
var Cn4 = Object.getOwnPropertyDescriptor;
var yn3 = (e, t3, r, n3) => {
  for (var i = n3 > 1 ? void 0 : n3 ? Cn4(t3, r) : t3, s2 = e.length - 1, o3; s2 >= 0; s2--)
    (o3 = e[s2]) && (i = o3(i) || i);
  return i;
};
var bn4 = (e, t3) => (r, n3) => t3(r, n3, e);
var Ee6 = (0, import_react3.createContext)([]);
var H2 = class {
  constructor(e) {
    this._localStorageService = e;
  }
  _getKey(e) {
    return `userHabitController_${e}`;
  }
  addHabit(e, t3) {
    return __async(this, null, function* () {
      const r = this._getKey(e);
      return this._localStorageService.getItem(r).then((n3) => {
        n3 || this._localStorageService.setItem(r, t3);
      });
    });
  }
  markHabit(e, t3) {
    const r = this._getKey(e);
    this._localStorageService.getItem(r).then((n3) => {
      if (n3) {
        const i = n3.findIndex((s2) => s2 === t3);
        i > -1 && n3.splice(i, 1), n3.unshift(t3), this._localStorageService.setItem(r, n3);
      }
    });
  }
  getHabit(e, t3) {
    return __async(this, null, function* () {
      const r = this._getKey(e), n3 = yield this._localStorageService.getItem(r);
      if (t3 && n3) {
        const i = n3.map((s2, o3, m9) => {
          const c2 = m9.length;
          return {
            value: s2,
            priority: c2 - o3
          };
        });
        return t3.sort((s2, o3) => {
          var a4, u2;
          const m9 = ((a4 = i.find((l4) => l4.value === s2)) == null ? void 0 : a4.priority) || -1;
          return (((u2 = i.find((l4) => l4.value === o3)) == null ? void 0 : u2.priority) || -1) - m9;
        });
      }
      return n3 || [];
    });
  }
  deleteHabit(e) {
    this._localStorageService.removeItem(e);
  }
};
H2 = yn3([
  bn4(0, Inject(rI))
], H2);
var Re3 = "numfmtCurrency";
var In5 = (e) => {
  const t3 = useDependency(H2), [r, n3] = (0, import_react3.useState)(ne3);
  return (0, import_react3.useEffect)(() => {
    t3.addHabit("numfmtCurrency", []).then(() => {
      t3.getHabit(Re3, [...ne3]).then((s2) => {
        n3(s2), e && e(s2);
      });
    });
  }, []), { userHabitCurrency: r, mark: (s2) => {
    t3.markHabit(Re3, s2);
  } };
};
var Nn2 = () => {
  const e = (0, import_react3.useRef)([]), [t3, r] = (0, import_react3.useState)({});
  return (0, import_react3.useEffect)(() => {
    e.current.forEach((i) => {
      i();
    }), e.current = [];
  }, [t3]), (i) => {
    e.current.push(i), r({});
  };
};
var En3 = (e) => !!ot4(e) && e.startsWith("_(");
var Tn3 = (e) => {
  const { defaultPattern: t3, action: r, onChange: n3 } = e, [i, s2] = (0, import_react3.useState)(() => P6(t3 || "", 2)), o3 = (0, import_react3.useContext)(Ee6), [m9, c2] = (0, import_react3.useState)(() => ot4(t3) || o3[0]), a4 = (0, import_react3.useMemo)(() => o3.map((p3) => ({ label: p3, value: p3 })), []), l4 = useDependency(Hn).t;
  r.current = () => F2(`_("${m9}"* #,##0${i > 0 ? ".0" : ""}_)`, i);
  const v6 = (p3) => {
    c2(p3), n3(F2(`_("${p3}"* #,##0${i > 0 ? ".0" : ""}_)`, i));
  }, f4 = (p3) => {
    const d2 = p3 || 0;
    s2(d2), n3(F2(`_("${m9}"* #,##0${d2 > 0 ? ".0" : ""}_)`, d2));
  };
  return (0, import_jsx_runtime3.jsxs)("div", { children: [
    (0, import_jsx_runtime3.jsxs)("div", { className: "univer-mt-4 univer-flex univer-justify-between", children: [
      (0, import_jsx_runtime3.jsxs)("div", { className: "option", children: [
        (0, import_jsx_runtime3.jsx)("div", { className: "univer-text-sm univer-text-gray-400", children: l4("sheet.numfmt.decimalLength") }),
        (0, import_jsx_runtime3.jsx)("div", { className: "univer-mt-2 univer-w-32", children: (0, import_jsx_runtime3.jsx)(
          TE,
          {
            value: i,
            step: 1,
            precision: 0,
            max: 20,
            min: 0,
            onChange: f4
          }
        ) })
      ] }),
      (0, import_jsx_runtime3.jsxs)("div", { className: "option", children: [
        (0, import_jsx_runtime3.jsx)("div", { className: "univer-text-sm univer-text-gray-400", children: l4("sheet.numfmt.currencyType") }),
        (0, import_jsx_runtime3.jsx)("div", { className: "univer-mt-2 univer-w-36", children: (0, import_jsx_runtime3.jsx)(
          KE,
          {
            options: a4,
            value: m9,
            onChange: v6
          }
        ) })
      ] })
    ] }),
    (0, import_jsx_runtime3.jsx)("div", { className: "univer-mt-4 univer-text-sm univer-text-gray-400", children: l4("sheet.numfmt.accountingDes") })
  ] });
};
var Mn3 = (e) => !!ot4(e) && !e.startsWith("_(");
var wn3 = (e) => {
  const r = useDependency(Hn).t, n3 = (0, import_react3.useContext)(Ee6), [i, s2] = (0, import_react3.useState)(() => ot4(e.defaultPattern) || n3[0]), [o3, m9] = (0, import_react3.useState)(() => P6(e.defaultPattern || "", 2)), [c2, a4] = (0, import_react3.useState)(() => {
    var g9;
    const d2 = it3(i);
    return ((g9 = d2.find((I6) => c1(I6.value, e.defaultPattern))) == null ? void 0 : g9.value) || d2[0].value;
  }), u2 = (0, import_react3.useMemo)(() => it3(i), [i]), l4 = (0, import_react3.useMemo)(() => n3.map((d2) => ({ label: d2, value: d2 })), [n3]);
  e.action.current = () => F2(c2, o3);
  const v6 = (d2) => {
    if (d2 === void 0)
      return;
    s2(d2);
    const S = it3(d2)[0].value;
    a4(S), e.onChange(F2(S, o3));
  }, f4 = (d2) => {
    d2 !== void 0 && (a4(d2), e.onChange(F2(d2, o3)));
  }, p3 = (d2) => {
    m9(d2 || 0), e.onChange(F2(c2, d2 || 0));
  };
  return (0, import_jsx_runtime3.jsxs)("div", { children: [
    (0, import_jsx_runtime3.jsxs)("div", { className: "univer-mt-4 univer-flex univer-justify-between", children: [
      (0, import_jsx_runtime3.jsxs)("div", { className: "option", children: [
        (0, import_jsx_runtime3.jsx)("div", { className: "univer-text-sm univer-text-gray-400", children: r("sheet.numfmt.decimalLength") }),
        (0, import_jsx_runtime3.jsx)("div", { className: "univer-mt-2 univer-w-32", children: (0, import_jsx_runtime3.jsx)(
          TE,
          {
            value: o3,
            max: 20,
            min: 0,
            onChange: p3
          }
        ) })
      ] }),
      (0, import_jsx_runtime3.jsxs)("div", { className: "option", children: [
        (0, import_jsx_runtime3.jsx)("div", { className: "univer-text-sm univer-text-gray-400", children: r("sheet.numfmt.currencyType") }),
        (0, import_jsx_runtime3.jsx)("div", { className: "univer-mt-2 univer-w-36", children: (0, import_jsx_runtime3.jsx)(
          KE,
          {
            value: i,
            options: l4,
            onChange: v6
          }
        ) })
      ] })
    ] }),
    (0, import_jsx_runtime3.jsx)("div", { className: "label univer-mt-4", children: r("sheet.numfmt.negType") }),
    (0, import_jsx_runtime3.jsx)("div", { className: "univer-mt-2", children: (0, import_jsx_runtime3.jsx)(GE3, { value: c2, options: u2, onChange: f4 }) }),
    (0, import_jsx_runtime3.jsx)("div", { className: "univer-mt-4 univer-text-sm univer-text-gray-400", children: r("sheet.numfmt.currencyDes") })
  ] });
};
function tt7(_a5) {
  var _b3 = _a5, { ref: e } = _b3, t3 = __objRest(_b3, ["ref"]);
  const _a6 = t3, { icon: r, id: n3, className: i, extend: s2 } = _a6, o3 = __objRest(_a6, ["icon", "id", "className", "extend"]), m9 = `univerjs-icon univerjs-icon-${n3} ${i || ""}`.trim(), c2 = (0, import_react3.useRef)(`_${Rn3()}`);
  return nt6(r, `${n3}`, {
    defIds: r.defIds,
    idSuffix: c2.current
  }, __spreadValues({
    ref: e,
    className: m9
  }, o3), s2);
}
function nt6(e, t3, r, n3, i) {
  return (0, import_react3.createElement)(e.tag, __spreadValues(__spreadValues({
    key: t3
  }, Pn(e, r, i)), n3), (xn5(e, r).children || []).map((s2, o3) => nt6(s2, `${t3}-${e.tag}-${o3}`, r, void 0, i)));
}
function Pn(e, t3, r) {
  const n3 = __spreadValues({}, e.attrs);
  r != null && r.colorChannel1 && n3.fill === "colorChannel1" && (n3.fill = r.colorChannel1), e.tag === "mask" && n3.id && (n3.id = n3.id + t3.idSuffix), Object.entries(n3).forEach(([s2, o3]) => {
    s2 === "mask" && typeof o3 == "string" && (n3[s2] = o3.replace(/url\(#(.*)\)/, `url(#$1${t3.idSuffix})`));
  });
  const { defIds: i } = t3;
  return !i || i.length === 0 || (e.tag === "use" && n3["xlink:href"] && (n3["xlink:href"] = n3["xlink:href"] + t3.idSuffix), Object.entries(n3).forEach(([s2, o3]) => {
    typeof o3 == "string" && (n3[s2] = o3.replace(/url\(#(.*)\)/, `url(#$1${t3.idSuffix})`));
  })), n3;
}
function xn5(e, t3) {
  var n3;
  const { defIds: r } = t3;
  return !r || r.length === 0 ? e : e.tag === "defs" && ((n3 = e.children) != null && n3.length) ? __spreadProps(__spreadValues({}, e), {
    children: e.children.map((i) => typeof i.attrs.id == "string" && r && r.includes(i.attrs.id) ? __spreadProps(__spreadValues({}, i), {
      attrs: __spreadProps(__spreadValues({}, i.attrs), {
        id: i.attrs.id + t3.idSuffix
      })
    }) : i)
  }) : e;
}
function Rn3() {
  return Math.random().toString(36).substring(2, 8);
}
tt7.displayName = "UniverIcon";
var $n3 = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M14.1544 3.75557C14.3887 3.98988 14.3887 4.36978 14.1544 4.6041L6.51409 12.2444C6.40157 12.3569 6.24896 12.4201 6.08983 12.4201C5.9307 12.4201 5.77808 12.3569 5.66556 12.2444L1.84541 8.42425C1.6111 8.18993 1.6111 7.81003 1.84541 7.57572C2.07973 7.34141 2.45963 7.34141 2.69394 7.57572L6.08983 10.9716L13.3059 3.75557C13.5402 3.52126 13.9201 3.52126 14.1544 3.75557Z",
      fillRule: "evenodd",
      clipRule: "evenodd"
    }
  }]
};
var rt5 = (0, import_react3.forwardRef)(function(t3, r) {
  return (0, import_react3.createElement)(tt7, Object.assign({}, t3, {
    id: "check-mark-icon",
    ref: r,
    icon: $n3
  }));
});
rt5.displayName = "CheckMarkIcon";
var ae3 = "customFormat";
var le2 = "numfmt_custom_pattern";
function On4(e) {
  const { defaultPattern: t3, action: r, onChange: n3 } = e, i = useDependency(H2), s2 = useDependency(rI), o3 = useDependency(Hn), [m9, c2] = (0, import_react3.useState)(t3);
  r.current = () => (i.markHabit(ae3, m9), s2.getItem(le2).then((f4 = []) => {
    const p3 = [.../* @__PURE__ */ new Set([m9, ...f4 || []])].splice(0, 10).filter((d2) => !!d2);
    s2.setItem(le2, p3);
  }), m9);
  const [a4, u2] = (0, import_react3.useState)([]);
  (0, import_react3.useEffect)(() => {
    s2.getItem(le2).then((f4) => {
      const p3 = [
        ...Ae6.map((d2) => d2.suffix("$")),
        ...Fe4.map((d2) => d2.suffix),
        ...De2.map((d2) => d2.suffix)
      ];
      p3.push(...f4 || []), i.addHabit(ae3, []).finally(() => {
        i.getHabit(ae3, p3).then((d2) => {
          u2([...new Set(d2)]);
        });
      });
    });
  }, []);
  const l4 = (f4) => {
    c2(f4), n3(f4);
  }, v6 = () => {
    n3(m9);
  };
  return (0, import_jsx_runtime3.jsxs)("div", { children: [
    (0, import_jsx_runtime3.jsx)("div", { className: "univer-mt-4 univer-text-sm univer-text-gray-400", children: o3.t("sheet.numfmt.customFormat") }),
    (0, import_jsx_runtime3.jsx)(
      eC,
      {
        placeholder: o3.t("sheet.numfmt.customFormat"),
        onBlur: v6,
        value: m9,
        onChange: c2,
        className: "univer-mt-2 univer-w-full"
      }
    ),
    (0, import_jsx_runtime3.jsx)(
      "div",
      {
        className: ie2("univer-mt-2 univer-max-h-[400px] univer-overflow-auto univer-rounded-lg univer-p-2", kt2),
        children: a4.map((f4) => (0, import_jsx_runtime3.jsxs)(
          "div",
          {
            onClick: () => l4(f4),
            className: "univer-flex univer-cursor-pointer univer-items-center univer-gap-1.5 univer-py-1.5 univer-text-sm",
            children: [
              (0, import_jsx_runtime3.jsx)("div", { className: "univer-flex univer-w-4 univer-items-center univer-text-primary-600", children: m9 === f4 && (0, import_jsx_runtime3.jsx)(rt5, {}) }),
              (0, import_jsx_runtime3.jsx)("div", { children: f4 })
            ]
          },
          f4
        ))
      }
    ),
    (0, import_jsx_runtime3.jsx)(
      "div",
      {
        className: "univer-mt-3 univer-text-sm univer-text-gray-600 dark:!univer-text-gray-200",
        children: o3.t("sheet.numfmt.customFormatDes")
      }
    )
  ] });
}
var Un6 = (e) => {
  const t3 = a1.getFormatInfo(e);
  return ct7().map((r) => r.value).includes(e) || ["date", "datetime", "time"].includes(t3.type);
};
function kn4(e) {
  const { onChange: t3, defaultPattern: r } = e, n3 = (0, import_react3.useMemo)(ct7, []), i = useDependency(Hn), [s2, o3] = (0, import_react3.useState)(() => {
    if (r) {
      const c2 = n3.find((a4) => a4.value === r);
      if (c2)
        return c2.value;
    }
    return n3[0].value;
  });
  e.action.current = () => s2;
  const m9 = (c2) => {
    c2 !== void 0 && (o3(c2), t3(c2));
  };
  return (0, import_jsx_runtime3.jsxs)("div", { children: [
    (0, import_jsx_runtime3.jsx)("div", { className: "univer-mt-4 univer-text-sm univer-text-gray-400", children: i.t("sheet.numfmt.dateType") }),
    (0, import_jsx_runtime3.jsx)("div", { className: "univer-mt-2", children: (0, import_jsx_runtime3.jsx)(GE3, { value: s2, options: n3, onChange: m9 }) }),
    (0, import_jsx_runtime3.jsx)(
      "div",
      {
        className: "univer-mt-3.5 univer-text-sm/5 univer-text-gray-600 dark:!univer-text-gray-200",
        children: i.t("sheet.numfmt.dateDes")
      }
    )
  ] });
}
var Dn4 = (e) => !e;
var Fn6 = (e) => {
  const r = useDependency(Hn).t;
  return e.action.current = () => "", (0, import_jsx_runtime3.jsx)("div", { children: (0, import_jsx_runtime3.jsx)(
    "div",
    {
      className: "univer-mt-3.5 univer-text-sm/5 univer-text-gray-600 dark:!univer-text-gray-200",
      children: r("sheet.numfmt.generalDes")
    }
  ) });
};
var Ln3 = (e) => lt5().some((t3) => c1(t3.value, e));
function An5(e) {
  const t3 = useDependency(Hn), r = (0, import_react3.useMemo)(lt5, []), [n3, i] = (0, import_react3.useState)(() => P6(e.defaultPattern || "", 0)), [s2, o3] = (0, import_react3.useState)(() => {
    const l4 = r.find((v6) => c1(v6.value, e.defaultPattern || ""));
    return (l4 == null ? void 0 : l4.value) || r[0].value;
  }), m9 = (0, import_react3.useMemo)(() => F2(s2, Number(n3 || 0)), [s2, n3]), c2 = (0, import_react3.useMemo)(() => !nt5(s2), [s2]), a4 = (l4) => {
    i(l4 || 0), e.onChange(F2(s2, Number(l4 || 0)));
  }, u2 = (l4) => {
    l4 !== void 0 && (i(P6(l4, 0)), o3(l4), e.onChange(l4));
  };
  return e.action.current = () => m9, (0, import_jsx_runtime3.jsxs)("div", { children: [
    (0, import_jsx_runtime3.jsx)("div", { className: "univer-mt-4 univer-text-sm univer-text-gray-400", children: t3.t("sheet.numfmt.decimalLength") }),
    (0, import_jsx_runtime3.jsx)("div", { className: "univer-mt-2", children: (0, import_jsx_runtime3.jsx)(
      TE,
      {
        disabled: c2,
        value: n3,
        max: 20,
        min: 0,
        onChange: a4
      }
    ) }),
    (0, import_jsx_runtime3.jsxs)("div", { className: "univer-mt-4 univer-text-sm univer-text-gray-400", children: [
      " ",
      t3.t("sheet.numfmt.negType")
    ] }),
    (0, import_jsx_runtime3.jsx)("div", { className: "univer-mt-2", children: (0, import_jsx_runtime3.jsx)(GE3, { onChange: u2, options: r, value: s2 }) }),
    (0, import_jsx_runtime3.jsx)(
      "div",
      {
        className: "univer-mt-3.5 univer-text-sm/5 univer-text-gray-600 dark:!univer-text-gray-200",
        children: t3.t("sheet.numfmt.thousandthPercentileDes")
      }
    )
  ] });
}
var Hn4 = (e) => {
  const { defaultValue: t3, defaultPattern: r, row: n3, col: i } = e.value, s2 = useDependency(Hn), o3 = (0, import_react3.useRef)(() => ""), m9 = s2.t, c2 = Nn2(), a4 = (0, import_react3.useMemo)(
    () => [
      { label: "sheet.numfmt.general", component: Fn6 },
      { label: "sheet.numfmt.accounting", component: Tn3 },
      { label: "sheet.numfmt.currency", component: wn3 },
      { label: "sheet.numfmt.date", component: kn4 },
      { label: "sheet.numfmt.thousandthPercentile", component: An5 },
      { label: "sheet.numfmt.customFormat", component: On4 }
    ].map((_3) => __spreadProps(__spreadValues({}, _3), { label: m9(_3.label) })),
    []
  ), [u2, l4] = (0, import_react3.useState)(g9), [v6, f4] = (0, import_react3.useState)(() => `${n3}_${i}`), { mark: p3, userHabitCurrency: d2 } = In5(() => f4(`${n3}_${i}_userCurrency'`)), S = (0, import_react3.useMemo)(() => {
    var _3;
    return (_3 = a4.find((U3) => U3.label === u2)) == null ? void 0 : _3.component;
  }, [u2]);
  function g9() {
    return [Dn4, En3, Mn3, Un6, Ln3].reduce((U3, at4, lt7) => U3 || (at4(r) ? a4[lt7].label : ""), "") || a4[0].label;
  }
  const I6 = a4.map((_3) => ({
    label: _3.label,
    value: _3.label
  })), w6 = (_3) => {
    l4(_3), c2(() => e.onChange({ type: "change", value: o3.current() || "" }));
  }, R9 = (0, import_react3.useCallback)((_3) => {
    e.onChange({ type: "change", value: _3 });
  }, []), O9 = () => {
    const _3 = o3.current() || "", U3 = ot4(_3);
    U3 && p3(U3), e.onChange({ type: "confirm", value: _3 });
  }, D5 = () => {
    e.onChange({ type: "cancel", value: "" });
  }, ie8 = {
    onChange: R9,
    defaultValue: t3,
    defaultPattern: r,
    action: o3
  };
  return (0, import_react3.useEffect)(() => {
    l4(g9()), f4(`${n3}_${i}`);
  }, [n3, i]), (0, import_jsx_runtime3.jsxs)(
    "div",
    {
      className: ie2("univer-flex univer-h-full univer-flex-col univer-justify-between univer-overflow-y-auto univer-pb-5", vr2),
      children: [
        (0, import_jsx_runtime3.jsxs)("div", { children: [
          (0, import_jsx_runtime3.jsx)("div", { className: "univer-mt-3.5 univer-text-sm univer-text-gray-400", children: m9("sheet.numfmt.numfmtType") }),
          (0, import_jsx_runtime3.jsx)("div", { className: "univer-mt-2", children: (0, import_jsx_runtime3.jsx)(KE, { className: "univer-w-full", value: u2, options: I6, onChange: w6 }) }),
          (0, import_jsx_runtime3.jsx)("div", { children: S && (0, import_jsx_runtime3.jsx)(Ee6.Provider, { value: d2, children: (0, import_react3.createElement)(S, __spreadProps(__spreadValues({}, ie8), { key: v6 })) }) })
        ] }),
        (0, import_jsx_runtime3.jsxs)("div", { className: "univer-mb-5 univer-mt-3.5 univer-flex univer-justify-end", children: [
          (0, import_jsx_runtime3.jsx)(fr, { onClick: D5, className: "univer-mr-3", children: m9("sheet.numfmt.cancel") }),
          (0, import_jsx_runtime3.jsx)(fr, { variant: "primary", onClick: O9, children: m9("sheet.numfmt.confirm") })
        ] })
      ]
    }
  );
};
var jn5 = Object.getOwnPropertyDescriptor;
var Bn5 = (e, t3, r, n3) => {
  for (var i = n3 > 1 ? void 0 : n3 ? jn5(t3, r) : t3, s2 = e.length - 1, o3; s2 >= 0; s2--)
    (o3 = e[s2]) && (i = o3(i) || i);
  return i;
};
var M6 = (e, t3) => (r, n3) => t3(r, n3, e);
var $e6 = "SHEET_NUMFMT_PANEL";
var j4 = class extends Ve {
  constructor(t3, r, n3, i, s2, o3, m9, c2, a4, u2, l4) {
    super();
    X6(this, "_previewPattern", "");
    X6(this, "_sidebarDisposable", null);
    this._sheetInterceptorService = t3, this._themeService = r, this._univerInstanceService = n3, this._commandService = i, this._selectionManagerService = s2, this._renderManagerService = o3, this._numfmtService = m9, this._componentManager = c2, this._sidebarService = a4, this._localeService = u2, this._sheetsNumfmtCellContentController = l4, this._initRealTimeRenderingInterceptor(), this._initPanel(), this._initCommands(), this._initCloseListener(), this._commandExecutedListener(), this._initNumfmtLocalChange();
  }
  _initNumfmtLocalChange() {
    this.disposeWithMe(merge(this._sheetsNumfmtCellContentController.locale$, this._localeService.currentLocale$).subscribe(() => {
      this._forceUpdate();
    }));
  }
  openPanel() {
    var S;
    const t3 = this._sidebarService, r = this._selectionManagerService, n3 = this._commandService, i = this._univerInstanceService, s2 = this._numfmtService, o3 = this._localeService, c2 = (((S = r.getCurrentSelections()) == null ? void 0 : S.map((g9) => g9.range)) || [])[0];
    if (!c2)
      return false;
    const a4 = i.getCurrentUnitForType(we.UNIVER_SHEET), u2 = a4.getActiveSheet();
    if (!u2)
      return false;
    const l4 = u2.getCellRaw(c2.startRow, c2.startColumn), v6 = s2.getValue(
      a4.getUnitId(),
      u2.getSheetId(),
      c2.startRow,
      c2.startColumn
    );
    let f4 = "";
    v6 && (f4 = v6.pattern);
    const p3 = (l4 == null ? void 0 : l4.t) === mn.NUMBER ? l4.v : 12345678, d2 = {
      onChange: (g9) => {
        var I6;
        if (g9.type === "change")
          this._previewPattern = g9.value, this._forceUpdate();
        else if (g9.type === "confirm") {
          const w6 = ((I6 = r.getCurrentSelections()) == null ? void 0 : I6.map((D5) => D5.range)) || [], R9 = { values: [] }, O9 = st4(g9.value);
          w6.forEach((D5) => {
            vr.foreach(D5, (ie8, _3) => {
              R9.values.push({
                row: ie8,
                col: _3,
                pattern: g9.value,
                type: O9
              });
            });
          }), n3.executeCommand(O4.id, R9), t3.close();
        } else g9.type === "cancel" && t3.close();
      },
      value: { defaultPattern: f4, defaultValue: p3, row: c2.startRow, col: c2.startColumn }
    };
    return this._sidebarDisposable = t3.open({
      header: { title: o3.t("sheet.numfmt.title") },
      children: __spreadValues({
        label: $e6
      }, d2),
      onClose: () => {
        this._forceUpdate(), n3.executeCommand(ce4.id);
      }
    }), true;
  }
  _forceUpdate(t3) {
    var n3;
    const r = this._renderManagerService.getRenderById(
      t3 != null ? t3 : this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET).getUnitId()
    );
    r == null || r.with(he2).reCalculate(), (n3 = r == null ? void 0 : r.mainComponent) == null || n3.makeDirty();
  }
  _initCommands() {
    [
      A2,
      ce4
    ].forEach((t3) => {
      this.disposeWithMe(this._commandService.registerCommand(t3));
    });
  }
  _initPanel() {
    this.disposeWithMe(
      this._componentManager.register($e6, Hn4)
    );
  }
  // eslint-disable-next-line max-lines-per-function
  _initRealTimeRenderingInterceptor() {
    const t3 = new Observable((n3) => {
      this._commandService.onCommandExecuted((i) => {
        i.id === A2.id && n3.next(true), i.id === ce4.id && n3.next(false);
      });
    }), r = combineLatest([
      t3,
      this._selectionManagerService.selectionMoveEnd$.pipe(
        map((n3) => n3 ? n3.map((i) => i.range) : [])
      )
    ]);
    this.disposeWithMe(
      Be(
        r.pipe(
          switchMap(
            ([n3, i]) => new Observable((s2) => {
              const o3 = new ho();
              return n3 && i.length && s2.next({ selectionRanges: i, disposableCollection: o3 }), () => {
                o3.dispose();
              };
            })
          ),
          tap(() => {
            this._previewPattern = null;
          })
        ).subscribe(({ disposableCollection: n3, selectionRanges: i }) => {
          var o3, m9;
          const s2 = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET);
          this.openPanel(), n3.add(
            this._sheetInterceptorService.intercept(ht2.CELL_CONTENT, {
              priority: 99,
              effect: ir.Value | ir.Style,
              handler: (c2, a4, u2) => {
                var p3;
                const { row: l4, col: v6 } = a4, f4 = u2(c2) || {};
                if (i.find(
                  (d2) => d2.startColumn <= v6 && d2.endColumn >= v6 && d2.startRow <= l4 && d2.endRow >= l4
                )) {
                  const d2 = a4.worksheet.getCellRaw(l4, v6), S = d2 == null ? void 0 : d2.v, g9 = d2 == null ? void 0 : d2.t;
                  if (S == null || g9 !== mn.NUMBER || this._previewPattern === null)
                    return f4;
                  const I6 = Ge6(this._previewPattern, S, this._sheetsNumfmtCellContentController.locale);
                  if (I6.color) {
                    const w6 = (p3 = this._themeService.getColorFromTheme(`${I6.color}.500`)) != null ? p3 : I6.color;
                    return __spreadProps(__spreadValues({}, f4), {
                      v: I6.result,
                      t: mn.STRING,
                      s: { cl: { rgb: w6 } }
                    });
                  }
                  return __spreadProps(__spreadValues({}, f4), {
                    v: I6.result,
                    t: mn.STRING
                  });
                }
                return f4;
              }
            })
          ), (m9 = (o3 = this._renderManagerService.getRenderById(s2.getUnitId())) == null ? void 0 : o3.mainComponent) == null || m9.makeDirty();
        })
      )
    );
  }
  _commandExecutedListener() {
    const t3 = [mi.id, so2.id];
    this.disposeWithMe(
      new Observable((r) => {
        const n3 = this._commandService.onCommandExecuted((i) => {
          if (t3.includes(i.id)) {
            const s2 = i.params;
            r.next(s2.unitId);
          }
        });
        return () => n3.dispose();
      }).pipe(debounceTime(16)).subscribe((r) => this._forceUpdate(r))
    );
  }
  _initCloseListener() {
    this._univerInstanceService.getCurrentTypeOfUnit$(we.UNIVER_SHEET).subscribe((t3) => {
      var r;
      t3 || ((r = this._sidebarDisposable) == null || r.dispose(), this._sidebarDisposable = null);
    });
  }
};
j4 = Bn5([
  M6(0, Inject(G)),
  M6(1, Inject(Ji)),
  M6(2, br),
  M6(3, Ds),
  M6(4, Inject(z)),
  M6(5, JE),
  M6(6, $t2),
  M6(7, Inject(S13)),
  M6(8, be2),
  M6(9, Inject(Hn)),
  M6(10, Inject(D3))
], j4);
var Vn2 = Object.getOwnPropertyDescriptor;
var Wn3 = (e, t3, r, n3) => {
  for (var i = n3 > 1 ? void 0 : n3 ? Vn2(t3, r) : t3, s2 = e.length - 1, o3; s2 >= 0; s2--)
    (o3 = e[s2]) && (i = o3(i) || i);
  return i;
};
var F4 = (e, t3) => (r, n3) => t3(r, n3, e);
var Gn4 = () => {
  let e = [];
  return {
    add: (i, s2, o3, m9, c2) => e.push({ unitId: i, subUnitId: s2, row: o3, col: m9, value: c2 }),
    getEffects: () => e,
    clean: () => {
      e = [];
    }
  };
};
var J3 = class extends Ve {
  constructor(t3, r, n3, i, s2) {
    super();
    X6(this, "_collectEffectMutation", Gn4());
    this._sheetInterceptorService = t3, this._numfmtService = r, this._univerInstanceService = n3, this._injector = i, this._editorBridgeService = s2, this._initInterceptorEditorStart(), this._initInterceptorEditorEnd(), this._initInterceptorCommands();
  }
  _initInterceptorEditorStart() {
    this._editorBridgeService && this.disposeWithMe(
      Be(
        this._sheetInterceptorService.writeCellInterceptor.intercept(co3, {
          handler: (t3, r, n3) => {
            const i = r.row, s2 = r.col, o3 = this._numfmtService.getValue(
              r.unitId,
              r.subUnitId,
              i,
              s2
            );
            if (o3)
              switch (st4(o3.pattern)) {
                case "scientific":
                case "currency":
                case "grouped":
                case "number": {
                  const c2 = r.worksheet.getCellRaw(i, s2);
                  return (c2 == null ? void 0 : c2.t) === mn.NUMBER && (c2 == null ? void 0 : c2.v) !== void 0 && c2.v !== null && s1(c2.v) && (c2.v = Sa2(Number(c2.v))), n3 && n3(c2);
                }
                case "percent":
                case "date":
                case "time":
                case "datetime":
                default:
                  return n3 && n3(t3);
              }
            return n3(t3);
          }
        })
      )
    );
  }
  /**
   * Process the  values after  edit
   * @private
   * @memberof NumfmtService
   */
  // eslint-disable-next-line max-lines-per-function
  _initInterceptorEditorEnd() {
    this.disposeWithMe(
      Be(
        this._sheetInterceptorService.writeCellInterceptor.intercept(Cs, {
          // eslint-disable-next-line complexity
          handler: (t3, r, n3) => {
            var a4, u2, l4;
            if (!(t3 != null && t3.v) && !(t3 != null && t3.p))
              return n3(t3);
            this._collectEffectMutation.clean();
            const i = this._numfmtService.getValue(
              r.unitId,
              r.subUnitId,
              r.row,
              r.col
            ), s2 = r.worksheet.getCellRaw(r.row, r.col);
            if (l1(i == null ? void 0 : i.pattern) || t3.t === mn.FORCE_STRING)
              return n3(t3);
            const o3 = (a4 = t3.p) == null ? void 0 : a4.body, m9 = (l4 = (u2 = t3 == null ? void 0 : t3.p) == null ? void 0 : u2.body) != null && l4.dataStream ? t3.p.body.dataStream.replace(/\r\n$/, "") : String(t3.v), c2 = h1(m9);
            if (o3)
              if (Kn2(o3)) {
                const { dataStream: v6 } = o3, f4 = v6.replace(/\r\n$/, ""), p3 = Number(f4);
                if (Number.isNaN(p3) && !c2)
                  return n3(t3);
              } else
                return n3(t3);
            if (c2) {
              if (!c2.z && !(i != null && i.pattern) && (s2 == null ? void 0 : s2.t) !== mn.STRING && (s2 == null ? void 0 : s2.t) !== mn.FORCE_STRING && mR(m9))
                return n3(__spreadProps(__spreadValues({}, t3), {
                  p: void 0,
                  v: m9,
                  t: mn.FORCE_STRING
                }));
              c2.z && this._collectEffectMutation.add(
                r.unitId,
                r.subUnitId,
                r.row,
                r.col,
                {
                  pattern: c2.z
                }
              );
              const v6 = Number(c2.v);
              return n3(__spreadProps(__spreadValues({}, t3), { p: void 0, v: v6, t: mn.NUMBER }));
            }
            return n3(t3);
          }
        })
      )
    );
  }
  _initInterceptorCommands() {
    const t3 = this;
    this.disposeWithMe(
      this._sheetInterceptorService.interceptCommand({
        getMutations(r) {
          var n3;
          switch (r.id) {
            case Sn2.id: {
              const i = t3._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET), s2 = i.getUnitId(), o3 = (n3 = i.getActiveSheet()) == null ? void 0 : n3.getSheetId();
              if (!o3)
                return {
                  redos: [],
                  undos: []
                };
              const m9 = t3._collectEffectMutation.getEffects();
              if (t3._collectEffectMutation.clean(), !m9.length)
                return {
                  redos: [],
                  undos: []
                };
              const c2 = m9.filter((v6) => {
                var f4;
                return !!((f4 = v6.value) != null && f4.pattern);
              }).map((v6) => ({
                row: v6.row,
                col: v6.col,
                pattern: v6.value.pattern
              })), a4 = m9.filter((v6) => {
                var f4;
                return !((f4 = v6.value) != null && f4.pattern);
              }).map((v6) => ({
                startRow: v6.row,
                endColumn: v6.col,
                startColumn: v6.col,
                endRow: v6.row
              })), u2 = [], l4 = [];
              if (c2.length) {
                const v6 = {
                  id: so2.id,
                  params: Ps(s2, o3, c2)
                };
                u2.push(v6), l4.push(...cg(t3._injector, v6.params));
              }
              if (a4.length) {
                const v6 = {
                  id: mi.id,
                  params: {
                    unitId: s2,
                    subUnitId: o3,
                    ranges: a4
                  }
                };
                u2.push(v6), l4.push(...dg2(t3._injector, v6.params));
              }
              return {
                redos: u2,
                undos: l4.reverse()
              };
            }
          }
          return {
            redos: [],
            undos: []
          };
        }
      })
    );
  }
  dispose() {
    super.dispose(), this._collectEffectMutation.clean();
  }
};
J3 = Wn3([
  F4(0, Inject(G)),
  F4(1, Inject($t2)),
  F4(2, Inject(br)),
  F4(3, Inject(Injector)),
  F4(4, Optional(Qe3))
], J3);
function Kn2(e) {
  const { textRuns: t3 = [], paragraphs: r = [], customRanges: n3, customBlocks: i = [] } = e, s2 = ["va"];
  return !(t3.some((o3) => !!(o3.ts && Object.keys(o3.ts).some((c2) => s2.includes(c2)))) || r.some((o3) => o3.bullet) || r.length >= 2 || n3 != null && n3.length || i.length > 0);
}
var it4 = (e) => [
  {
    label: "sheet.numfmt.general",
    pattern: null
  },
  {
    label: "sheet.numfmt.text",
    pattern: Mp
  },
  "|",
  {
    label: "sheet.numfmt.number",
    pattern: "0"
  },
  {
    label: "sheet.numfmt.percent",
    pattern: "0.00%"
  },
  {
    label: "sheet.numfmt.scientific",
    pattern: "0.00E+00"
  },
  "|",
  {
    label: "sheet.numfmt.accounting",
    pattern: `"${e}" #,##0.00_);[Red]("${e}"#,##0.00)`
  },
  {
    label: "sheet.numfmt.financialValue",
    pattern: "#,##0.00;[Red]#,##0.00"
  },
  {
    label: "sheet.numfmt.currency",
    pattern: `"${e}"#,##0.00_);[Red]("${e}"#,##0.00)`
  },
  {
    label: "sheet.numfmt.roundingCurrency",
    pattern: `"${e}"#,##0;[Red]"${e}"#,##0`
  },
  "|",
  {
    label: "sheet.numfmt.date",
    pattern: "yyyy-mm-dd;@"
  },
  {
    label: "sheet.numfmt.time",
    pattern: 'am/pm h":"mm":"ss'
  },
  {
    label: "sheet.numfmt.dateTime",
    pattern: "yyyy-m-d am/pm h:mm"
  },
  {
    label: "sheet.numfmt.timeDuration",
    pattern: "h:mm:ss"
  },
  "|",
  {
    label: "sheet.numfmt.moreFmt",
    pattern: ""
  }
];
var Yn3 = (e) => ({
  icon: new Observable((t3) => {
    const r = e.get(Hn);
    return t3.next(xe4(r.getCurrentLocale()).icon), r.localeChanged$.subscribe(() => {
      t3.next(xe4(r.getCurrentLocale()).icon);
    });
  }),
  id: je2.id,
  title: "sheet.numfmt.currency",
  tooltip: "sheet.numfmt.currency",
  type: H12.BUTTON,
  hidden$: Xi(e, we.UNIVER_SHEET),
  disabled$: ue2(e, { workbookTypes: [Pe3], worksheetTypes: [Le2, kr2], rangeTypes: [Ve4] })
});
var Zn3 = (e) => ({
  icon: "AddDigitsIcon",
  id: Ve5.id,
  title: "sheet.numfmt.addDecimal",
  tooltip: "sheet.numfmt.addDecimal",
  type: H12.BUTTON,
  hidden$: Xi(e, we.UNIVER_SHEET),
  disabled$: ue2(e, { workbookTypes: [Pe3], worksheetTypes: [Le2, kr2], rangeTypes: [Ve4] })
});
var zn5 = (e) => ({
  icon: "ReduceDigitsIcon",
  id: Be5.id,
  title: "sheet.numfmt.subtractDecimal",
  tooltip: "sheet.numfmt.subtractDecimal",
  type: H12.BUTTON,
  hidden$: Xi(e, we.UNIVER_SHEET),
  disabled$: ue2(e, { workbookTypes: [Pe3], worksheetTypes: [Le2, kr2], rangeTypes: [Ve4] })
});
var Xn6 = (e) => ({
  icon: "PercentIcon",
  id: Le5.id,
  title: "sheet.numfmt.percent",
  tooltip: "sheet.numfmt.percent",
  type: H12.BUTTON,
  hidden$: Xi(e, we.UNIVER_SHEET),
  disabled$: ue2(e, { workbookTypes: [Pe3], worksheetTypes: [Le2, kr2], rangeTypes: [Ve4] })
});
var qn4 = (e) => {
  const t3 = e.get(br), r = e.get(Ds), n3 = e.get(Hn), i = e.get(z), s2 = [mi.id, so2.id], o3 = pt3(
    t3,
    "",
    ({ workbook: m9, worksheet: c2 }) => new Observable(
      (a4) => merge(
        i.selectionMoveEnd$,
        bg(r.onCommandExecuted.bind(r)).pipe(
          filter(([u2]) => s2.includes(u2.id))
        )
      ).subscribe(() => {
        var l4, v6;
        const u2 = i.getCurrentSelections();
        if (u2 && u2[0]) {
          const f4 = u2[0].range, p3 = f4.startRow, d2 = f4.startColumn, S = (v6 = m9.getStyles().get((l4 = c2.getCell(p3, d2)) == null ? void 0 : l4.s)) == null ? void 0 : v6.n, g9 = S == null ? void 0 : S.pattern, I6 = Y4(n3.getCurrentLocale());
          let w6 = n3.t("sheet.numfmt.general");
          if (u1(g9)) {
            a4.next(w6);
            return;
          }
          if (g9) {
            const R9 = it4(I6).filter((O9) => typeof O9 == "object" && O9.pattern).find(
              (O9) => c1(g9, O9.pattern)
            );
            R9 && typeof R9 == "object" && R9.pattern ? w6 = n3.t(R9.label) : w6 = n3.t("sheet.numfmt.moreFmt");
          }
          a4.next(w6);
        }
      })
    )
  );
  return {
    label: st5,
    id: A2.id,
    tooltip: "sheet.numfmt.title",
    type: H12.SELECTOR,
    slot: true,
    selections: [{
      label: {
        name: ot5,
        hoverable: false,
        selectable: false
      }
    }],
    value$: o3,
    hidden$: Xi(e, we.UNIVER_SHEET),
    disabled$: ue2(e, { workbookTypes: [Pe3], worksheetTypes: [kr2, Le2], rangeTypes: [Ve4] })
  };
};
var st5 = "sheet.numfmt.moreNumfmtType";
var ot5 = "sheet.numfmt.moreNumfmtType.options";
function Jn6(e) {
  const { value: t3 } = e, r = useDependency(Hn), n3 = t3 != null ? t3 : r.t("sheet.numfmt.general");
  return (0, import_jsx_runtime3.jsx)("span", { className: "univer-text-sm", children: n3 });
}
function Qn3() {
  const e = useDependency(Ds), t3 = useDependency(Hn), r = useDependency(j1), n3 = useDependency(D3), i = useDependency(z), s2 = (a4) => {
    const u2 = i.getCurrentLastSelection();
    if (!u2)
      return;
    const l4 = u2.range, v6 = [];
    vr.foreach(l4, (f4, p3) => {
      a4 ? v6.push({ row: f4, col: p3, pattern: a4, type: st4(a4) }) : v6.push({ row: f4, col: p3 });
    }), e.executeCommand(O4.id, { values: v6 }), r.focus();
  }, o3 = (0, import_react3.useMemo)(() => {
    const a4 = w2.get(t3.getCurrentLocale());
    return it4(a4);
  }, [t3]), m9 = (a4) => {
    if (a4 === 0)
      s2(null);
    else if (a4 === o3.length - 1)
      e.executeCommand(A2.id), r.focus();
    else {
      const u2 = o3[a4];
      u2.pattern && s2(u2.pattern);
    }
  }, c2 = 1220;
  return (0, import_jsx_runtime3.jsx)("div", { className: "univer-grid univer-gap-1 univer-p-1.5", children: o3.map((a4, u2) => a4 === "|" ? (0, import_jsx_runtime3.jsx)(XE, {}, u2) : (0, import_jsx_runtime3.jsxs)(
    "div",
    {
      className: "univer-flex univer-h-7 univer-items-center univer-justify-between univer-gap-6 univer-rounded univer-px-2 univer-text-sm hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-700",
      onClick: () => m9(u2),
      children: [
        (0, import_jsx_runtime3.jsx)("span", { children: t3.t(a4.label) }),
        (0, import_jsx_runtime3.jsx)("span", { className: "univer-text-xs univer-text-gray-500", children: a4.pattern ? He5(a4.pattern || "", c2, n3.locale).result.trim() : "" })
      ]
    },
    u2
  )) });
}
var er5 = {
  [Y12.LAYOUT]: {
    [A2.id]: {
      order: 9,
      menuItemFactory: qn4
    },
    [Le5.id]: {
      order: 9.1,
      menuItemFactory: Xn6
    },
    [je2.id]: {
      order: 9.2,
      menuItemFactory: Yn3
    },
    [Ve5.id]: {
      order: 9.3,
      menuItemFactory: Zn3
    },
    [Be5.id]: {
      order: 9.4,
      menuItemFactory: zn5
    }
  }
};
var tr4 = Object.getOwnPropertyDescriptor;
var nr6 = (e, t3, r, n3) => {
  for (var i = n3 > 1 ? void 0 : n3 ? tr4(t3, r) : t3, s2 = e.length - 1, o3; s2 >= 0; s2--)
    (o3 = e[s2]) && (i = o3(i) || i);
  return i;
};
var Oe2 = (e, t3) => (r, n3) => t3(r, n3, e);
var Q5 = class extends Ve {
  constructor(e, t3) {
    super(), this._componentManager = e, this._menuManagerService = t3, this._initMenu();
  }
  _initMenu() {
    this._menuManagerService.mergeMenu(er5), [
      [st5, Jn6],
      [ot5, Qn3]
    ].forEach(([e, t3]) => {
      this.disposeWithMe(
        this._componentManager.register(e, t3)
      );
    });
  }
};
Q5 = nr6([
  Oe2(0, Inject(S13)),
  Oe2(1, Z1)
], Q5);
var rr5 = Object.defineProperty;
var ir6 = Object.getOwnPropertyDescriptor;
var sr5 = (e, t3, r) => t3 in e ? rr5(e, t3, { enumerable: true, configurable: true, writable: true, value: r }) : e[t3] = r;
var or5 = (e, t3, r, n3) => {
  for (var i = n3 > 1 ? void 0 : n3 ? ir6(t3, r) : t3, s2 = e.length - 1, o3; s2 >= 0; s2--)
    (o3 = e[s2]) && (i = o3(i) || i);
  return i;
};
var ue3 = (e, t3) => (r, n3) => t3(r, n3, e);
var ct8 = (e, t3, r) => sr5(e, typeof t3 != "symbol" ? t3 + "" : t3, r);
var cr5 = "SHEET_NUMFMT_UI_PLUGIN";
var ee3 = class extends yl {
  constructor(e = xe5, t3, r, n3) {
    super(), this._config = e, this._injector = t3, this._configService = r, this._renderManagerService = n3;
    const _a5 = co(
      {},
      xe5,
      this._config
    ), { menu: i } = _a5, s2 = __objRest(_a5, ["menu"]);
    i && this._configService.setConfig("menu", i, { merge: true }), this._configService.setConfig("sheets-numfmt-ui.config", s2);
  }
  onStarting() {
    eR(this._injector, [
      [j4],
      [J3],
      [H2],
      [Q5]
    ]);
  }
  onRendered() {
    this._registerRenderModules(), Kc(this._injector, [
      [j4],
      [J3],
      [Q5]
    ]);
  }
  _registerRenderModules() {
    [
      [de2]
    ].forEach((t3) => {
      this.disposeWithMe(this._renderManagerService.registerRenderModule(we.UNIVER_SHEET, t3));
    });
  }
};
ct8(ee3, "pluginName", cr5);
ct8(ee3, "type", we.UNIVER_SHEET);
ee3 = or5([
  sI(Ll3, A),
  ue3(1, Inject(Injector)),
  ue3(2, xs),
  ue3(3, JE)
], ee3);

// node_modules/@univerjs/network/lib/es/facade.js
var w4 = Object.getOwnPropertyDescriptor;
var l = (t3, e, c2, r) => {
  for (var i = r > 1 ? void 0 : r ? w4(e, c2) : e, s2 = t3.length - 1, o3; s2 >= 0; s2--)
    (o3 = t3[s2]) && (i = o3(i) || i);
  return i;
};
var a = (t3, e) => (c2, r) => e(c2, r, t3);
var n = class extends $ {
  constructor(t3, e) {
    super(), this._injector = t3, this._httpService = e;
  }
  /**
   * Send a GET request to the server.
   * @param {string} url - The requested URL.
   * @param {IRequestParams} [params] - Query parameters.
   * @returns {Promise<HTTPResponse>} Network response.
   */
  get(t3, e) {
    return this._httpService.get(t3, e);
  }
  /**
   * Send a POST request to the server.
   * @param {string} url - The requested URL.
   * @param {IPostRequestParams} [params] - Query parameters.
   * @returns {Promise<HTTPResponse>} Network response.
   */
  post(t3, e) {
    return this._httpService.post(t3, e);
  }
  /**
   * Send a PUT request to the server.
   * @param {string} url - The requested URL
   * @param {IPostRequestParams} [params] - Query parameters
   * @returns {Promise<HTTPResponse>} Network response
   */
  put(t3, e) {
    return this._httpService.put(t3, e);
  }
  /**
   * Send DELETE request to the server.
   * @param {string} url - The requested URL
   * @param {IRequestParams} [params] - Query parameters
   * @returns {Promise<HTTPResponse>} Network response
   */
  delete(t3, e) {
    return this._httpService.delete(t3, e);
  }
  /**
   * Send PATCH request to the server.
   * @param {string} url - The requested URL
   * @param {IPostRequestParams} [params] - Query parameters
   * @returns {Promise<HTTPResponse>} Network response
   */
  patch(t3, e) {
    return this._httpService.patch(t3, e);
  }
  /**
   * Request for a stream of server-sent events. Instead of a single response, the server sends a stream of responses,
   * Univer wraps the stream in an [`Observable`](https://rxjs.dev/guide/observable) which you can call `subscribe` on.
   * @param {HTTPRequestMethod} method - HTTP request method
   * @param {string} url - The requested URL
   * @param {IPostRequestParams} [params] - params Query parameters
   * @returns {Observable<HTTPEvent>} An observable that emits the network response.
   */
  getSSE(t3, e, c2) {
    return this._httpService.getSSE(t3, e, c2);
  }
};
n = l([
  a(0, Inject(Injector)),
  a(1, Inject(x))
], n);
var f2 = class extends I2 {
  getNetwork() {
    return this._injector.createInstance(n);
  }
  createSocket(e) {
    const r = this._injector.createInstance(Ye).createSocket(e);
    if (!r)
      throw new Error("[WebSocketService]: failed to create socket!");
    return r;
  }
};
I2.extend(f2);

// node_modules/@univerjs/sheets/lib/es/facade.js
var Wt5 = Object.defineProperty;
var Nt4 = (n3, e, t3) => e in n3 ? Wt5(n3, e, { enumerable: true, configurable: true, writable: true, value: t3 }) : n3[e] = t3;
var g6 = (n3, e, t3) => Nt4(n3, typeof e != "symbol" ? e + "" : e, t3);
var En4 = Object.getOwnPropertyDescriptor;
var Un7 = (n3, e, t3, s2) => {
  for (var r = s2 > 1 ? void 0 : s2 ? En4(e, t3) : e, i = n3.length - 1, o3; i >= 0; i--)
    (o3 = n3[i]) && (r = o3(r) || r);
  return r;
};
var M8 = (n3, e) => (t3, s2) => e(t3, s2, n3);
function xn6(n3, e, t3) {
  const s2 = t3.getDefinedNameMap(n3);
  if (s2 == null)
    return e.t("definedName.defaultName") + 1;
  const i = Array.from(Object.values(s2)).length + 1, o3 = e.t("definedName.defaultName") + i;
  if (t3.getValueByName(n3, o3) == null)
    return o3;
  let a4 = i + 1;
  for (; ; ) {
    const h9 = e.t("definedName.defaultName") + a4;
    if (t3.getValueByName(n3, h9) == null)
      return h9;
    a4++;
  }
}
var Se4 = class {
  constructor() {
    g6(this, "_definedNameParam");
    this._definedNameParam = {
      id: et(10),
      unitId: "",
      name: "",
      formulaOrRefString: "",
      localSheetId: mg
    };
  }
  /**
   * Sets the name of the defined name builder.
   * @param {string} name The name of the defined name.
   * @returns {FDefinedNameBuilder} The instance of `FDefinedNameBuilder` for method chaining.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const definedNameBuilder = univerAPI.newDefinedName()
   *   .setName('MyDefinedName')
   *   .setRef('Sheet1!$A$1')
   *   .build();
   * fWorkbook.insertDefinedNameBuilder(definedNameBuilder);
   * ```
   */
  setName(e) {
    return this._definedNameParam.name = e, this;
  }
  /**
   * Sets the formula of the defined name builder.
   * @param {string }formula The formula of the defined name.
   * @returns {FDefinedNameBuilder} The instance of `FDefinedNameBuilder` for method chaining.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const definedNameBuilder = univerAPI.newDefinedName()
   *   .setName('MyDefinedName')
   *   .setFormula('SUM(Sheet1!$A$1)')
   *   .build();
   * fWorkbook.insertDefinedNameBuilder(definedNameBuilder);
   * ```
   */
  setFormula(e) {
    return this._definedNameParam.formulaOrRefString = `=${e}`, this;
  }
  /**
   * Sets the reference of the defined name builder.
   * @param {string} a1Notation The reference of the defined name.
   * @returns {FDefinedNameBuilder} The instance of `FDefinedNameBuilder` for method chaining.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const definedNameBuilder = univerAPI.newDefinedName()
   *   .setName('MyDefinedName')
   *   .setRef('Sheet1!$A$1')
   *   .build();
   * fWorkbook.insertDefinedNameBuilder(definedNameBuilder);
   * ```
   */
  setRef(e) {
    return this._definedNameParam.formulaOrRefString = e, this;
  }
  /**
   * Sets the reference of the defined name builder by range .
   * @param {number} row The start row index of the range. index start at 0.
   * @param {number} column The start column index of the range. index start at 0.
   * @param {number} numRows The number of rows in the range.
   * @param {number} numColumns The number of columns in the range.
   * @returns {FDefinedNameBuilder} The instance of `FDefinedNameBuilder` for method chaining.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const definedNameBuilder = univerAPI.newDefinedName()
   *   .setName('MyDefinedName')
   *   .setRefByRange(1, 3, 2, 5) // D2:H3
   *   .build();
   * fWorkbook.insertDefinedNameBuilder(definedNameBuilder);
   * ```
   */
  setRefByRange(e, t3, s2, r) {
    return this._definedNameParam.formulaOrRefString = Yt({
      startRow: e,
      endRow: e + (s2 != null ? s2 : 1) - 1,
      startColumn: t3,
      endColumn: t3 + (r != null ? r : 1) - 1
    }), this;
  }
  /**
   * Sets the comment of the defined name builder.
   * @param {string} comment The comment of the defined name.
   * @returns {FDefinedNameBuilder} The instance of `FDefinedNameBuilder` for method chaining.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const definedNameBuilder = univerAPI.newDefinedName()
   *   .setName('MyDefinedName')
   *   .setRef('Sheet1!$A$1')
   *   .setComment('A reference to A1 cell in Sheet1')
   *   .build();
   * fWorkbook.insertDefinedNameBuilder(definedNameBuilder);
   * ```
   */
  setComment(e) {
    return this._definedNameParam.comment = e, this;
  }
  /**
   * Sets the scope of the defined name to the worksheet.
   * @param {FWorksheet} worksheet The worksheet to set the scope to.
   * @returns {FDefinedNameBuilder} The instance of `FDefinedNameBuilder` for method chaining.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const sheets = fWorkbook.getSheets();
   *
   * // Create a defined name and make it available only in the second worksheet
   * const definedNameBuilder = univerAPI.newDefinedName()
   *   .setName('MyDefinedName')
   *   .setRef('Sheet1!$A$1')
   *   .setScopeToWorksheet(sheets[1])
   *   .build();
   * fWorkbook.insertDefinedNameBuilder(definedNameBuilder);
   * ```
   */
  setScopeToWorksheet(e) {
    return this._definedNameParam.localSheetId = e.getSheetId(), this;
  }
  /**
   * Sets the scope of the defined name to the workbook.
   * @returns {FDefinedNameBuilder} The instance of `FDefinedNameBuilder` for method chaining.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   *
   * // Create a defined name and make it available in the entire workbook
   * const definedNameBuilder = univerAPI.newDefinedName()
   *   .setName('MyDefinedName')
   *   .setRef('Sheet1!$A$1')
   *   .setScopeToWorkbook()
   *   .build();
   * fWorkbook.insertDefinedNameBuilder(definedNameBuilder);
   * ```
   */
  setScopeToWorkbook() {
    return this._definedNameParam.localSheetId = mg, this;
  }
  /**
   * Sets the hidden status of the defined name builder.
   * @param {boolean} hidden The hidden status of the defined name.
   * @returns {FDefinedNameBuilder} The instance of `FDefinedNameBuilder` for method chaining.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const definedNameBuilder = univerAPI.newDefinedName()
   *   .setName('MyDefinedName')
   *   .setRef('Sheet1!$A$1')
   *   .setHidden(true)
   *   .build();
   * fWorkbook.insertDefinedNameBuilder(definedNameBuilder);
   * ```
   */
  setHidden(e) {
    return this._definedNameParam.hidden = e, this;
  }
  /**
   * Builds the defined name parameter.
   * @returns {ISetDefinedNameMutationParam} The defined name mutation parameter.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const definedNameBuilder = univerAPI.newDefinedName()
   *   .setName('MyDefinedName')
   *   .setRef('Sheet1!$A$1')
   *   .setComment('A reference to A1 cell in Sheet1')
   *   .build();
   * fWorkbook.insertDefinedNameBuilder(definedNameBuilder);
   * ```
   */
  build() {
    return this._definedNameParam;
  }
  /**
   * Loads the defined name mutation parameter.
   * @param {ISetDefinedNameMutationParam} param - defined name mutation parameter
   * @returns {FDefinedNameBuilder} The instance of `FDefinedNameBuilder` for method chaining.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const definedNameParam = {
   *   id: '4TMPceoqg8',
   *   unitId: fWorkbook.getId(),
   *   name: 'MyDefinedName',
   *   formulaOrRefString: 'Sheet1!$A$1',
   * }
   * const definedNameBuilder = univerAPI.newDefinedName()
   *   .load(definedNameParam)
   *   .build();
   * fWorkbook.insertDefinedNameBuilder(definedNameBuilder);
   * ```
   */
  load(e) {
    return this._definedNameParam = e, this;
  }
};
var _e5 = class extends $ {
  constructor(n3, e, t3, s2, r, i, o3, a4, h9, c2) {
    super(), this._definedNameParam = n3, this._injector = e, this._commandService = t3, this._permissionService = s2, this._worksheetProtectionRuleModel = r, this._rangeProtectionRuleModel = i, this._worksheetProtectionPointRuleModel = o3, this._authzIoService = a4, this._localeService = h9, this._definedNamesService = c2;
  }
  _apply() {
    this._definedNameParam.name === "" && (this._definedNameParam.name = xn6(this._definedNameParam.unitId, this._localeService, this._definedNamesService)), this._commandService.syncExecuteCommand(ni.id, this._definedNameParam);
  }
  /**
   * Gets the name of the defined name.
   * @returns {string} The name of the defined name.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const definedName = fWorkbook.getDefinedNames()[0];
   * console.log(definedName?.getName());
   * ```
   */
  getName() {
    return this._definedNameParam.name;
  }
  /**
   * Sets the name of the defined name.
   * @param {string} name The name of the defined name.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const definedName = fWorkbook.getDefinedNames()[0];
   * definedName?.setName('NewDefinedName');
   * ```
   */
  setName(n3) {
    this._definedNameParam.name = n3, this._apply();
  }
  /**
   * Sets the formula of the defined name.
   * @param {string} formula The formula of the defined name.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const definedName = fWorkbook.getDefinedNames()[0];
   * definedName?.setFormula('SUM(Sheet1!$A$1)');
   * ```
   */
  setFormula(n3) {
    this._definedNameParam.formulaOrRefString = `=${n3}`, this._apply();
  }
  /**
   * Sets the reference of the defined name.
   * @param {string} refString The reference of the defined name.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const definedName = fWorkbook.getDefinedNames()[0];
   * definedName?.setRef('Sheet1!$A$1');
   * ```
   */
  setRef(n3) {
    this._definedNameParam.formulaOrRefString = n3, this._apply();
  }
  /**
   * Gets the formula or reference string of the defined name.
   * @returns {string} The formula or reference string of the defined name.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const definedName = fWorkbook.getDefinedNames()[0];
   * console.log(definedName?.getFormulaOrRefString());
   * ```
   */
  getFormulaOrRefString() {
    return this._definedNameParam.formulaOrRefString;
  }
  /**
   * Sets the reference of the defined name by range.
   * @param {number} row The start row of the range.
   * @param {number} column The start column of the range.
   * @param {number} numRows The number of rows in the range.
   * @param {number} numColumns The number of columns in the range.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const definedName = fWorkbook.getDefinedNames()[0];
   * definedName?.setRefByRange(1, 3, 2, 5); // D2:H3
   * ```
   */
  setRefByRange(n3, e, t3, s2) {
    this._definedNameParam.formulaOrRefString = Yt({
      startRow: n3,
      endRow: n3 + (t3 != null ? t3 : 1) - 1,
      startColumn: e,
      endColumn: e + (s2 != null ? s2 : 1) - 1
    }), this._apply();
  }
  /**
   * Gets the comment of the defined name.
   * @returns {string | undefined} The comment of the defined name.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const definedName = fWorkbook.getDefinedNames()[0];
   * console.log(definedName?.getComment());
   * ```
   */
  getComment() {
    return this._definedNameParam.comment;
  }
  /**
   * Sets the comment of the defined name.
   * @param {string} comment The comment of the defined name.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const definedName = fWorkbook.getDefinedNames()[0];
   * definedName?.setComment('This is a comment');
   * ```
   */
  setComment(n3) {
    this._definedNameParam.comment = n3, this._apply();
  }
  /**
   * Sets the scope of the defined name to the worksheet.
   * @param {FWorksheet} worksheet The worksheet to set the scope to.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const sheets = fWorkbook.getSheets();
   *
   * // Get the first defined name and make it available only in the second worksheet
   * const definedName = fWorkbook.getDefinedNames()[0];
   * definedName?.setScopeToWorksheet(sheets[1]);
   * ```
   */
  setScopeToWorksheet(n3) {
    this._definedNameParam.localSheetId = n3.getSheetId(), this._apply();
  }
  /**
   * Sets the scope of the defined name to the workbook.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const definedName = fWorkbook.getDefinedNames()[0];
   * definedName?.setScopeToWorkbook();
   * ```
   */
  setScopeToWorkbook() {
    this._definedNameParam.localSheetId = mg, this._apply();
  }
  /**
   * Sets the hidden status of the defined name.
   * @param {boolean} hidden The hidden status of the defined name.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const definedName = fWorkbook.getDefinedNames()[0];
   * definedName?.setHidden(true);
   * ```
   */
  setHidden(n3) {
    this._definedNameParam.hidden = n3, this._apply();
  }
  /**
   * Deletes the defined name.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const definedName = fWorkbook.getDefinedNames()[0];
   * definedName?.delete();
   * ```
   */
  delete() {
    this._commandService.syncExecuteCommand(Qr2.id, this._definedNameParam);
  }
  /**
   * Gets the local sheet id of the defined name.
   * @returns {string | undefined} The local sheet id of the defined name.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const definedName = fWorkbook.getDefinedNames()[0];
   * console.log(definedName?.getLocalSheetId());
   * ```
   */
  getLocalSheetId() {
    return this._definedNameParam.localSheetId;
  }
  /**
   * Checks if the defined name is in the workbook scope.
   * @returns {boolean} True if the defined name is in the workbook scope, false otherwise.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const definedName = fWorkbook.getDefinedNames()[0];
   * console.log(definedName?.isWorkbookScope());
   * ```
   */
  isWorkbookScope() {
    return this._definedNameParam.localSheetId === mg;
  }
  /**
   * Converts the defined name to a defined name builder.
   * @returns {FDefinedNameBuilder} The defined name builder.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const definedName = fWorkbook.getDefinedNames()[0];
   * if (!definedName) return;
   * const definedNameBuilder = definedName
   *   .toBuilder()
   *   .setName('NewDefinedName')
   *   .setFormula('SUM(Sheet1!$A$1)')
   *   .build();
   * fWorkbook.updateDefinedNameBuilder(definedNameBuilder);
   * ```
   */
  toBuilder() {
    const n3 = this._injector.createInstance(Se4);
    return n3.load(this._definedNameParam), n3;
  }
};
_e5 = Un7([
  M8(1, Inject(Injector)),
  M8(2, Ds),
  M8(3, aC),
  M8(4, Inject(lt3)),
  M8(5, Inject(me)),
  M8(6, Inject(vn2)),
  M8(7, Inject(_E)),
  M8(8, Inject(Hn)),
  M8(9, Lr)
], _e5);
var te3 = ((n3) => (n3[n3.Reader = 0] = "Reader", n3[n3.Editor = 1] = "Editor", n3[n3.Owner = 2] = "Owner", n3))(te3 || {});
var u = ((n3) => (n3.Edit = "WorkbookEdit", n3.View = "WorkbookView", n3.Print = "WorkbookPrint", n3.Export = "WorkbookExport", n3.Share = "WorkbookShare", n3.CopyContent = "WorkbookCopy", n3.DuplicateFile = "WorkbookDuplicate", n3.Comment = "WorkbookComment", n3.ManageCollaborator = "WorkbookManageCollaborator", n3.CreateSheet = "WorkbookCreateSheet", n3.DeleteSheet = "WorkbookDeleteSheet", n3.RenameSheet = "WorkbookRenameSheet", n3.MoveSheet = "WorkbookMoveSheet", n3.HideSheet = "WorkbookHideSheet", n3.ViewHistory = "WorkbookViewHistory", n3.ManageHistory = "WorkbookHistory", n3.RecoverHistory = "WorkbookRecoverHistory", n3.CreateProtection = "WorkbookCreateProtect", n3.InsertRow = "WorkbookInsertRow", n3.InsertColumn = "WorkbookInsertColumn", n3.DeleteRow = "WorkbookDeleteRow", n3.DeleteColumn = "WorkbookDeleteColumn", n3.CopySheet = "WorkbookCopySheet", n3))(u || {});
var m3 = ((n3) => (n3.Edit = "WorksheetEdit", n3.View = "WorksheetView", n3.Copy = "WorksheetCopy", n3.SetCellValue = "WorksheetSetCellValue", n3.SetCellStyle = "WorksheetSetCellStyle", n3.SetRowStyle = "WorksheetSetRowStyle", n3.SetColumnStyle = "WorksheetSetColumnStyle", n3.InsertRow = "WorksheetInsertRow", n3.InsertColumn = "WorksheetInsertColumn", n3.DeleteRow = "WorksheetDeleteRow", n3.DeleteColumn = "WorksheetDeleteColumn", n3.Sort = "WorksheetSort", n3.Filter = "WorksheetFilter", n3.PivotTable = "WorksheetPivotTable", n3.InsertHyperlink = "WorksheetInsertHyperlink", n3.EditExtraObject = "WorksheetEditExtraObject", n3.ManageCollaborator = "WorksheetManageCollaborator", n3.DeleteProtection = "WorksheetDeleteProtection", n3.SelectProtectedCells = "WorksheetSelectProtectedCells", n3.SelectUnProtectedCells = "WorksheetSelectUnProtectedCells", n3))(m3 || {});
var k5 = ((n3) => (n3.Edit = "RangeEdit", n3.View = "RangeView", n3.ManageCollaborator = "RangeManageCollaborator", n3.Delete = "RangeDeleteProtection", n3))(k5 || {});
var Dn5 = Object.getOwnPropertyDescriptor;
var Mn4 = (n3, e, t3, s2) => {
  for (var r = s2 > 1 ? void 0 : s2 ? Dn5(e, t3) : e, i = n3.length - 1, o3; i >= 0; i--)
    (o3 = n3[i]) && (r = o3(r) || r);
  return r;
};
var T4 = (n3, e) => (t3, s2) => e(t3, s2, n3);
var H3 = class extends $ {
  constructor(e, t3, s2, r, i, o3, a4, h9) {
    super();
    g6(this, "permissionPointsDefinition", fg);
    g6(this, "rangeRuleChangedAfterAuth$");
    g6(this, "sheetRuleChangedAfterAuth$");
    g6(this, "unitPermissionInitStateChange$");
    this._injector = e, this._commandService = t3, this._permissionService = s2, this._worksheetProtectionRuleModel = r, this._rangeProtectionRuleModel = i, this._worksheetProtectionPointRuleModel = o3, this._workbookPermissionService = a4, this._authzIoService = h9, this.rangeRuleChangedAfterAuth$ = this._rangeProtectionRuleModel.ruleRefresh$, this.sheetRuleChangedAfterAuth$ = this._worksheetProtectionRuleModel.ruleRefresh$, this.unitPermissionInitStateChange$ = this._workbookPermissionService.unitPermissionInitStateChange$;
  }
  /**
   * Configures a specific permission point for a workbook.
   * This function sets or updates a permission point for a workbook identified by `unitId`.
   * It creates a new permission point if it does not already exist, and updates the point with the provided value.
   * @param {string} unitId - The unique identifier of the workbook for which the permission is being set.
   * @param {WorkbookPermissionPointConstructor} FPointClass - The constructor function for creating a permission point instance. Other point constructors can See the [permission-point documentation](https://github.com/dream-num/univer/tree/dev/packages/sheets/src/services/permission/permission-point) for more details.
   * @param {boolean} value - The boolean value to determine whether the permission point is enabled or disabled.
   *
   * @example
   * ```typescript
   * const workbook = univerAPI.getActiveWorkbook();
   * const permission = workbook.getPermission();
   * const unitId = workbook.getId();
   * permission.setWorkbookPermissionPoint(unitId, permission.permissionPointsDefinition.WorkbookEditablePermission, false)
   * ```
   */
  setWorkbookPermissionPoint(e, t3, s2) {
    const r = new t3(e);
    this._permissionService.getPermissionPoint(r.id) || this._permissionService.addPermissionPoint(r), this._permissionService.updatePermissionPoint(r.id, s2);
  }
  /**
   * Check if a specific permission point is enabled for a workbook.
   * @param unitId - The unique identifier of the workbook.
   * @param FPointClass - The constructor for the permission point class.
   *    See the [permission-point documentation](https://github.com/dream-num/univer/tree/dev/packages/sheets/src/services/permission/permission-point) for more details.
   * @example
   * ```typescript
   * const workbook = univerAPI.getActiveWorkbook();
   * const permission = workbook.getPermission();
   * const unitId = workbook.getId();
   * // Check if the workbook is editable
   * const isEditable = permission.checkWorkbookPermissionPoint(unitId, permission.permissionPointsDefinition.WorkbookEditablePermission);
   * console.log('Workbook is editable:', isEditable);
   * ```
   */
  checkWorkbookPermissionPoint(e, t3) {
    const s2 = new t3(e), r = this._permissionService.getPermissionPoint(s2.id);
    if (r)
      return r.value;
  }
  /**
   * This function is used to set whether the workbook can be edited
   * @param {string} unitId - The unique identifier of the workbook for which the permission is being set.
   * @param {boolean} value - A value that controls whether the workbook can be edited
   *
   * @example
   * ```typescript
   * const workbook = univerAPI.getActiveWorkbook();
   * const permission = workbook.getPermission();
   * const unitId = workbook.getId();
   * permission.setWorkbookEditPermission(unitId, false);
   * ```
   */
  setWorkbookEditPermission(e, t3) {
    this.setWorkbookPermissionPoint(e, Pe3, t3);
  }
  /**
   * This function is used to add a base permission for a worksheet.
   * Note that after adding, only the background mask of the permission module will be rendered. If you want to modify the function permissions,
   * you need to modify the permission points with the permissionId returned by this function.
   * @param {string} unitId - The unique identifier of the workbook for which the permission is being set.
   * @param {string} subUnitId - The unique identifier of the worksheet for which the permission is being set.
   * @param {IWorksheetProtectionOptions} options - Optional protection options including allowed users and name.
   * @returns {Promise<string | undefined>} - Returns the `permissionId` if the permission is successfully added. If the operation fails or no result is returned, it resolves to `undefined`.
   *
   * @example
   * ```typescript
   * const workbook = univerAPI.getActiveWorkbook();
   * const permission = workbook.getPermission();
   * const unitId = workbook.getId();
   * const worksheet = workbook.getActiveSheet();
   * const subUnitId = worksheet.getSheetId();
   * // Note that there will be no permission changes after this step is completed. It only returns an ID for subsequent permission changes.
   * // For details, please see the example of the **`setWorksheetPermissionPoint`** API.
   * const permissionId = await permission.addWorksheetBasePermission(unitId, subUnitId, {
   *   allowedUsers: ['user1', 'user2'],
   *   name: 'My Protection'
   * })
   * // Can still edit and read it.
   * console.log('debugger', permissionId)
   * ```
   */
  addWorksheetBasePermission(e, t3, s2) {
    return __async(this, null, function* () {
      let r = [];
      s2 != null && s2.allowedUsers && (r = s2.allowedUsers.map((a4) => ({ id: a4, role: te3.Editor, subject: void 0 })));
      const i = yield this._authzIoService.create({
        objectType: x4.Worksheet,
        worksheetObject: {
          collaborators: r,
          unitID: e,
          strategies: [],
          name: (s2 == null ? void 0 : s2.name) || "",
          scope: void 0
        }
      });
      if (this._commandService.syncExecuteCommand(Mt2.id, {
        unitId: e,
        subUnitId: t3,
        rule: {
          permissionId: i,
          unitType: x4.Worksheet,
          unitId: e,
          subUnitId: t3
        }
      }))
        return i;
    });
  }
  /**
   * Delete the entire table protection set for the worksheet and reset the point permissions of the worksheet to true
   * @param {string} unitId - The unique identifier of the workbook for which the permission is being set.
   * @param {string} subUnitId - The unique identifier of the worksheet for which the permission is being set.
   *
   * @example
   * ```typescript
   * const workbook = univerAPI.getActiveWorkbook();
   * const permission = workbook.getPermission();
   * const unitId = workbook.getId();
   * const worksheet = workbook.getActiveSheet();
   * const subUnitId = worksheet.getSheetId();
   * permission.removeWorksheetPermission(unitId, subUnitId);
   * ```
   */
  removeWorksheetPermission(e, t3) {
    this._commandService.syncExecuteCommand(xt.id, {
      unitId: e,
      subUnitId: t3
    }), [...be3(), ...He2()].forEach((s2) => {
      const r = new s2(e, t3);
      this._permissionService.updatePermissionPoint(r.id, true);
    }), this._worksheetProtectionPointRuleModel.deleteRule(e, t3);
  }
  /**
   * Sets the worksheet permission point by updating or adding the permission point for the worksheet.
   * If the worksheet doesn't have a base permission, it creates one to used render
   * @param {string} unitId - The unique identifier of the workbook.
   * @param {string} subUnitId - The unique identifier of the worksheet.
   * @param {WorkSheetPermissionPointConstructor} FPointClass - The constructor for the permission point class.
   *    See the [permission-point documentation](https://github.com/dream-num/univer/tree/dev/packages/sheets/src/services/permission/permission-point) for more details.
   * @param {boolean} value - The new permission value to be set for the worksheet.
   * @returns {Promise<string | undefined>} - Returns the `permissionId` if the permission point is successfully set or created. If no permission is set, it resolves to `undefined`.
   *
   * @example
   * ```typescript
   * const workbook = univerAPI.getActiveWorkbook();
   * const permission = workbook.getPermission();
   * const unitId = workbook.getId();
   * const worksheet = workbook.getActiveSheet();
   * const subUnitId = worksheet.getSheetId();
   * const permissionId = await permission.addWorksheetBasePermission(unitId, subUnitId)
   * // After this line of code , the worksheet will no longer be editable
   * permission.setWorksheetPermissionPoint(unitId, subUnitId, permission.permissionPointsDefinition.WorksheetEditPermission, false);
   * ```
   */
  setWorksheetPermissionPoint(e, t3, s2, r) {
    return __async(this, null, function* () {
      const i = this._worksheetProtectionRuleModel.getRule(e, t3);
      let o3;
      if (s2 === Le2 || s2 === ds)
        i ? o3 = i.permissionId : o3 = yield this.addWorksheetBasePermission(e, t3);
      else {
        const d2 = this._worksheetProtectionPointRuleModel.getRule(e, t3);
        d2 ? o3 = d2.permissionId : (o3 = yield this._authzIoService.create({
          objectType: x4.Worksheet,
          worksheetObject: {
            collaborators: [],
            unitID: e,
            strategies: [],
            name: "",
            scope: void 0
          }
        }), this._commandService.syncExecuteCommand(to2.id, { unitId: e, subUnitId: t3, rule: { unitId: e, subUnitId: t3, permissionId: o3 } }));
      }
      const h9 = new s2(e, t3);
      return this._permissionService.getPermissionPoint(h9.id) || this._permissionService.addPermissionPoint(h9), this._permissionService.updatePermissionPoint(h9.id, r), o3;
    });
  }
  /**
   * Check if a specific permission point is enabled for a worksheet.
   * @param unitId - The unique identifier of the workbook.
   * @param subUnitId - The unique identifier of the worksheet.
   * @param FPointClass - The constructor for the permission point class.
   *    See the [permission-point documentation](https://github.com/dream-num/univer/tree/dev/packages/sheets/src/services/permission/permission-point) for more details.
   * @returns {boolean | undefined} - Returns true if the permission point is enabled, false if it is disabled, or undefined if the permission point does not exist.
   * @example
   * ```typescript
   * const workbook = univerAPI.getActiveWorkbook();
   * const permission = workbook.getPermission();
   * const unitId = workbook.getId();
   * const worksheet = workbook.getActiveSheet();
   * const subUnitId = worksheet.getSheetId();
   * // Check if the worksheet is editable
   * const isEditable = permission.checkWorksheetPermissionPoint(unitId, subUnitId, permission.permissionPointsDefinition.WorksheetEditPermission);
   * console.log('Worksheet is editable:', isEditable);
   * ```
   */
  checkWorksheetPermissionPoint(e, t3, s2) {
    const r = new s2(e, t3), i = this._permissionService.getPermissionPoint(r.id);
    if (i)
      return i.value;
  }
  /**
   * Adds a range protection to the worksheet.
   * Note that after adding, only the background mask of the permission module will be rendered. If you want to modify the function permissions,
   * you need to modify the permission points with the permissionId returned by this function.
   * @deprecated Use `worksheet.getWorksheetPermission().protectRanges()` instead
   * @param {string} unitId - The unique identifier of the workbook.
   * @param {string} subUnitId - The unique identifier of the worksheet.
   * @param {FRange[]} ranges - The ranges to be protected.
   * @param {IRangeProtectionOptions} options - Optional protection options including allowed users and name.
   * @returns {Promise<{ permissionId: string, ruleId: string } | undefined>} - Returns an object containing the `permissionId` and `ruleId` if the range protection is successfully added. If the operation fails or no result is returned, it resolves to `undefined`. permissionId is used to stitch permission point IDï¼ŒruleId is used to store permission rules
   *
   * @example
   * ```typescript
   * // Old API
   * const workbook = univerAPI.getActiveWorkbook();
   * const permission = workbook.getPermission();
   * const unitId = workbook.getId();
   * const worksheet = workbook.getActiveSheet();
   * const subUnitId = worksheet.getSheetId();
   * const range = worksheet.getRange('A1:B2');
   * const ranges = [];
   * ranges.push(range);
   * const res = await permission.addRangeBaseProtection(unitId, subUnitId, ranges, {
   *   name: 'Protected Area',
   *   allowEdit: false
   * });
   * const {permissionId, ruleId} = res;
   * console.log('debugger', permissionId, ruleId);
   *
   * // New API (recommended)
   * const worksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * const permission = worksheet.getWorksheetPermission();
   * const range = worksheet.getRange('A1:B2');
   * await permission.protectRanges([{
   *   ranges: [range],
   *   options: { name: 'Protected Area', allowEdit: false }
   * }]);
   * ```
   */
  addRangeBaseProtection(e, t3, s2, r) {
    return __async(this, null, function* () {
      var y6, P8;
      const i = yield this._authzIoService.create({
        objectType: x4.SelectRange,
        selectRangeObject: {
          collaborators: (P8 = (y6 = r == null ? void 0 : r.allowedUsers) == null ? void 0 : y6.map((C) => ({ id: C, role: te3.Editor, subject: void 0 }))) != null ? P8 : [],
          unitID: e,
          name: (r == null ? void 0 : r.name) || "",
          scope: void 0
        }
      }), o3 = `ruleId_${et(6)}`;
      if (this._rangeProtectionRuleModel.getSubunitRuleList(e, t3).some((C) => C.ranges.some((Dt3) => s2.some((Mt5) => Cn.intersects(Mt5.getRange(), Dt3)))))
        throw new Error("range protection cannot intersect");
      const c2 = this._determineRangeViewState(r), d2 = this._determineRangeEditState(r), w6 = {
        unitId: e,
        subUnitId: t3,
        rules: [{
          permissionId: i,
          unitType: x4.SelectRange,
          unitId: e,
          subUnitId: t3,
          ranges: s2.map((C) => C.getRange()),
          id: o3,
          description: r == null ? void 0 : r.name,
          viewState: c2,
          editState: d2
        }]
      };
      if (this._commandService.syncExecuteCommand(Be3.id, w6))
        return {
          permissionId: i,
          ruleId: o3
        };
    });
  }
  /**
   * Determine view state from range protection options
   * @private
   */
  _determineRangeViewState(e) {
    return (e == null ? void 0 : e.allowViewByOthers) === false ? Au.NoOneElseCanView : Au.OthersCanView;
  }
  /**
   * Determine edit state from range protection options
   * @private
   */
  _determineRangeEditState(e) {
    var t3;
    return (e == null ? void 0 : e.allowEdit) === true && ((t3 = e == null ? void 0 : e.allowedUsers) != null && t3.length) ? xu.DesignedUserCanEdit : xu.OnlyMe;
  }
  /**
   * Removes the range protection from the worksheet.
   * @deprecated Use `worksheet.getWorksheetPermission().unprotectRules()` instead
   * @param {string} unitId - The unique identifier of the workbook.
   * @param {string} subUnitId - The unique identifier of the worksheet.
   * @param {string[]} ruleIds - The rule IDs of the range protection to be removed.
   *
   * @example
   * ```typescript
   * // Old API
   * const workbook = univerAPI.getActiveWorkbook();
   * const permission = workbook.getPermission();
   * const unitId = workbook.getId();
   * const worksheet = workbook.getActiveSheet();
   * const subUnitId = worksheet.getSheetId();
   * const range = worksheet.getRange('A1:B2');
   * const ranges = [];
   * ranges.push(range);
   * const res = await permission.addRangeBaseProtection(unitId, subUnitId, ranges);
   * const ruleId = res.ruleId;
   * permission.removeRangeProtection(unitId, subUnitId, [ruleId]);
   *
   * // New API (recommended)
   * const worksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * const permission = worksheet.getWorksheetPermission();
   * await permission.unprotectRules([ruleId]);
   * ```
   */
  removeRangeProtection(e, t3, s2) {
    this._commandService.syncExecuteCommand(ot2.id, {
      unitId: e,
      subUnitId: t3,
      ruleIds: s2
    }) && this._rangeProtectionRuleModel.getSubunitRuleList(e, t3).length === 0 && (this._worksheetProtectionPointRuleModel.deleteRule(e, t3), [...He2()].forEach((o3) => {
      const a4 = new o3(e, t3);
      this._permissionService.updatePermissionPoint(a4.id, a4.value);
    }));
  }
  /**
   * Modify the permission points of a custom area
   * @param {string} unitId - The unique identifier of the workbook.
   * @param {string} subUnitId - The unique identifier of the worksheet within the workbook.
   * @param {string} permissionId - The unique identifier of the permission that controls access to the range.
   * @param {RangePermissionPointConstructor} FPointClass - The constructor for the range permission point class.
   *    See the [permission-point documentation](https://github.com/dream-num/univer/tree/dev/packages/sheets/src/services/permission/permission-point) for more details.
   * @param {boolean} value - The new permission value to be set for the range (e.g., true for allowing access, false for restricting access).
   *
   * @example
   * ```typescript
   * const workbook = univerAPI.getActiveWorkbook();
   * const permission = workbook.getPermission();
   * const unitId = workbook.getId();
   * const worksheet = workbook.getActiveSheet();
   * const subUnitId = worksheet.getSheetId();
   * const range = worksheet.getRange('A1:B2');
   * const ranges = [];
   * ranges.push(range);
   * // Note that there will be no permission changes after this step is completed. It only returns an ID for subsequent permission changes.
   * // For details, please see the example of the **`setRangeProtectionPermissionPoint`** API.
   * const res = await permission.addRangeBaseProtection(unitId, subUnitId, ranges);
   * const {permissionId, ruleId} = res;
   * // After passing the following line of code, the range set above will become uneditable
   * permission.setRangeProtectionPermissionPoint(unitId,subUnitId,permissionId, permission.permissionPointsDefinition.RangeProtectionPermissionEditPoint, false);
   * ```
   */
  setRangeProtectionPermissionPoint(e, t3, s2, r, i) {
    const o3 = new r(e, t3, s2);
    this._permissionService.getPermissionPoint(o3.id) || this._permissionService.addPermissionPoint(o3), this._permissionService.updatePermissionPoint(o3.id, i);
  }
  /**
   * Sets the ranges for range protection in a worksheet.
   *
   * This method finds the rule by unitId, subUnitId, and ruleId, and updates the rule with the provided ranges.
   * It checks for overlaps with existing ranges in the same subunit and shows an error message if any overlap is detected.
   * If no overlap is found, it executes the command to update the range protection with the new ranges.
   * @param {string} unitId - The unique identifier of the workbook.
   * @param {string} subUnitId - The unique identifier of the worksheet within the workbook.
   * @param {string} ruleId - The ruleId of the range protection rule that is being updated.
   * @param {FRange[]} ranges - The array of new ranges to be set for the range protection rule.
   *
   * @example
   * ```typescript
   * const workbook = univerAPI.getActiveWorkbook();
   * const permission = workbook.getPermission();
   * const unitId = workbook.getId();
   * const worksheet = workbook.getActiveSheet();
   * const subUnitId = worksheet.getSheetId();
   * const range = worksheet.getRange('A1:B2');
   * const ranges = [];
   * ranges.push(range);
   * const res = await permission.addRangeBaseProtection(unitId, subUnitId, ranges);
   * const {permissionId, ruleId} = res;
   * const newRange = worksheet.getRange('C1:D2');
   * permission.setRangeProtectionRanges(unitId, subUnitId, ruleId, [newRange]);
   * ```
   */
  setRangeProtectionRanges(e, t3, s2, r) {
    const i = this._rangeProtectionRuleModel.getRule(e, t3, s2);
    if (i) {
      if (this._rangeProtectionRuleModel.getSubunitRuleList(e, t3).filter((h9) => h9.id !== s2).some((h9) => h9.ranges.some((c2) => r.some((d2) => Cn.intersects(d2.getRange(), c2)))))
        throw new Error("range protection cannot intersect");
      this._commandService.syncExecuteCommand(fe3.id, {
        unitId: e,
        subUnitId: t3,
        ruleId: s2,
        rule: __spreadProps(__spreadValues({}, i), {
          ranges: r.map((h9) => h9.getRange())
        })
      });
    }
  }
  /**
   * Get the permission information for a specific cell in a worksheet.
   * @param {string} unitId - The unique identifier of the workbook.
   * @param {string} subUnitId - The unique identifier of the worksheet within the workbook.
   * @param {number} row - The row index of the cell.
   * @param {number} column - The column index of the cell.
   * @returns {{ permissionId: string, ruleId: string } | undefined} - Returns an object containing the `permissionId` and `ruleId` if the cell is protected by a range protection rule. If no protection is found, it returns `undefined`.
   *
   * @example
   * ```typescript
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const permission = fWorkbook.getPermission();
   * const unitId = fWorkbook.getId();
   * const subUnitId = fWorksheet.getSheetId();
   *
   * // Get the permission information for cell C3
   * const cell = fWorksheet.getRange('C3');
   * const permissionInfo = permission.getPermissionInfoWithCell(
   *   unitId,
   *   subUnitId,
   *   cell.getRow(),
   *   cell.getColumn()
   * );
   * console.log(permissionInfo);
   *
   * // If the cell is protected, you can remove the protection like this:
   * if (permissionInfo) {
   *   const { ruleId } = permissionInfo;
   *
   *   // After 2 seconds, remove the protection for the cell
   *   setTimeout(() => {
   *     permission.removeRangeProtection(unitId, subUnitId, [ruleId]);
   *   }, 2000);
   * }
   * ```
   */
  getPermissionInfoWithCell(e, t3, s2, r) {
    const i = QR(s2, r), o3 = this._rangeProtectionRuleModel.getSubunitRuleList(e, t3).find((a4) => a4.ranges.some((c2) => Cn.intersects(i, c2)));
    if (o3)
      return {
        permissionId: o3.permissionId,
        ruleId: o3.id
      };
  }
};
H3 = Mn4([
  T4(0, Inject(Injector)),
  T4(1, Ds),
  T4(2, aC),
  T4(3, Inject(lt3)),
  T4(4, Inject(me)),
  T4(5, Inject(vn2)),
  T4(6, Inject(mn2)),
  T4(7, Inject(_E))
], H3);
var Wn4 = Object.getOwnPropertyDescriptor;
var Nn3 = (n3, e, t3, s2) => {
  for (var r = s2 > 1 ? void 0 : s2 ? Wn4(e, t3) : e, i = n3.length - 1, o3; i >= 0; i--)
    (o3 = n3[i]) && (r = o3(r) || r);
  return r;
};
var jn6 = (n3, e) => (t3, s2) => e(t3, s2, n3);
var we5 = class {
  constructor(n3, e, t3, s2) {
    this._workbook = n3, this._worksheet = e, this._selections = t3, this._injector = s2;
  }
  /**
   * Represents the active selection in the sheet. Which means the selection contains the active cell.
   * @returns {FRange | null} The active selection.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A10:B11');
   * fRange.activate();
   * const fSelection = fWorksheet.getSelection();
   * console.log(fSelection.getActiveRange().getA1Notation()); // A10:B11
   * ```
   */
  getActiveRange() {
    const n3 = this._selections.find((e) => !!e.primary);
    return n3 ? this._injector.createInstance(f3, this._workbook, this._worksheet, n3.range) : null;
  }
  /**
   * Represents the active selection list in the sheet.
   * @returns {FRange[]} The active selection list.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fSelection = fWorksheet.getSelection();
   * const activeRangeList = fSelection.getActiveRangeList();
   * activeRangeList.forEach((range) => {
   *   console.log(range.getA1Notation());
   * });
   * ```
   */
  getActiveRangeList() {
    return this._selections.map((n3) => this._injector.createInstance(f3, this._workbook, this._worksheet, n3.range));
  }
  /**
   * Represents the current select cell in the sheet.
   * @returns {ISelectionCell} The current select cell info.Pay attention to the type of the return value.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A10:B11');
   * fRange.activate();
   * const fSelection = fWorksheet.getSelection();
   * const currentCell = fSelection.getCurrentCell();
   * const { actualRow, actualColumn } = currentCell;
   * console.log(currentCell);
   * console.log(`actualRow: ${actualRow}, actualColumn: ${actualColumn}`); // actualRow: 9, actualColumn: 0
   * ```
   */
  getCurrentCell() {
    const n3 = this._selections.find((e) => !!e.primary);
    return n3 ? n3.primary : null;
  }
  /**
   * Returns the active sheet in the spreadsheet.
   * @returns {FWorksheet} The active sheet in the spreadsheet.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fSelection = fWorksheet.getSelection();
   * const activeSheet = fSelection.getActiveSheet();
   * console.log(activeSheet.equalTo(fWorksheet)); // true
   * ```
   */
  getActiveSheet() {
    const n3 = this._injector.createInstance(R2, this._workbook);
    return this._injector.createInstance(I5, n3, this._workbook, this._worksheet);
  }
  /**
   * Update the primary cell in the selection. if the primary cell not exists in selections, add it to the selections and clear the old selections.
   * @param {FRange} cell The new primary cell to update.
   * @returns {FSelection} The new selection after updating the primary cell.Because the selection is immutable, the return value is a new selection.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A10:B11');
   * fRange.activate();
   * const cell = fWorksheet.getRange('B11');
   *
   * let fSelection = fWorksheet.getSelection();
   * fSelection = fSelection.updatePrimaryCell(cell);
   *
   * const currentCell = fSelection.getCurrentCell();
   * const { actualRow, actualColumn } = currentCell;
   * console.log(currentCell);
   * console.log(`actualRow: ${actualRow}, actualColumn: ${actualColumn}`); // actualRow: 10, actualColumn: 1
   * ```
   */
  updatePrimaryCell(n3) {
    const e = this._injector.get(Ds);
    let t3 = [], s2 = false;
    for (const { range: i, style: o3 } of this._selections)
      Cn.contains(i, n3.getRange()) ? (t3.push({
        range: i,
        primary: _e3(n3.getRange(), this._worksheet),
        style: o3
      }), s2 = true) : t3.push({
        range: i,
        primary: null,
        style: o3
      });
    s2 || (t3 = [
      {
        range: n3.getRange(),
        primary: _e3(n3.getRange(), this._worksheet)
      }
    ]);
    const r = {
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId(),
      selections: t3
    };
    return e.syncExecuteCommand(ie5.id, r), new we5(this._workbook, this._worksheet, t3, this._injector);
  }
  /**
   * Get the next primary cell in the specified direction. If the primary cell not exists in selections, return null.
   * The next primary cell in the specified direction is the next cell only within the current selection range.
   * For example, if the current selection is A1:B2, and the primary cell is B1, the next cell in the right direction is A2 instead of C1.
   * @param {Direction} direction The direction to move the primary cell.The enum value is maybe one of the following: UP(0),RIGHT(1), DOWN(2), LEFT(3).
   * @returns {FRange | null} The next primary cell in the specified direction.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * // make sure the active cell is A1 and selection is A1:B2
   * const fRange = fWorksheet.getRange('A1:B2');
   * fRange.activate();
   *
   * // get the next cell in the right direction, and update the primary cell to the next cell, now the active cell is B1
   * let fSelection = fWorksheet.getSelection();
   * const nextCell = fSelection.getNextDataRange(univerAPI.Enum.Direction.RIGHT);
   * console.log(nextCell?.getA1Notation()); // B1
   * fSelection = fSelection.updatePrimaryCell(nextCell);
   *
   * // get the next cell in the right direction, the next cell is A2
   * const nextCell2 = fSelection.getNextDataRange(univerAPI.Enum.Direction.RIGHT);
   * console.log(nextCell2?.getA1Notation()); // A2
   * ```
   */
  getNextDataRange(n3) {
    if (!this._selections.find((s2) => !!s2.primary))
      return null;
    const t3 = Cg2(this._selections.concat(), n3, this._worksheet);
    return t3 ? this._injector.createInstance(f3, this._workbook, this._worksheet, t3) : null;
  }
};
we5 = Nn3([
  jn6(3, Inject(Injector))
], we5);
var Le6 = ((n3) => (n3[n3.Reader = 0] = "Reader", n3[n3.Editor = 1] = "Editor", n3[n3.Owner = 2] = "Owner", n3[n3.UNRECOGNIZED = -1] = "UNRECOGNIZED", n3))(Le6 || {});
var On5 = Object.getOwnPropertyDescriptor;
var Tn4 = (n3, e, t3, s2) => {
  for (var r = s2 > 1 ? void 0 : s2 ? On5(e, t3) : e, i = n3.length - 1, o3; i >= 0; i--)
    (o3 = n3[i]) && (r = o3(r) || r);
  return r;
};
var fe4 = (n3, e) => (t3, s2) => e(t3, s2, n3);
var j5 = class {
  constructor(n3, e, t3, s2, r, i, o3, a4, h9) {
    this._unitId = n3, this._subUnitId = e, this._ruleId = t3, this._permissionId = s2, this._ranges = r, this._options = i, this._injector = o3, this._commandService = a4, this._rangeProtectionRuleModel = h9;
  }
  /**
   * Get the rule ID.
   * @returns {string} The unique identifier of this protection rule.
   * @example
   * ```ts
   * const worksheet = univerAPI.getActiveWorkbook()?.getActiveSheet();
   * const permission = worksheet?.getWorksheetPermission();
   * const rules = await permission?.listRangeProtectionRules();
   * const ruleId = rules?.[0]?.id;
   * console.log(ruleId);
   * ```
   */
  get id() {
    return this._ruleId;
  }
  /**
   * Get the protected ranges.
   * @returns {FRange[]} Array of protected ranges.
   * @example
   * ```ts
   * const worksheet = univerAPI.getActiveWorkbook()?.getActiveSheet();
   * const permission = worksheet?.getWorksheetPermission();
   * const rules = await permission?.listRangeProtectionRules();
   * const ranges = rules?.[0]?.ranges;
   * console.log(ranges);
   * ```
   */
  get ranges() {
    return this._ranges;
  }
  /**
   * Get the protection options.
   * @returns {IRangeProtectionOptions} Copy of the protection options.
   * @example
   * ```ts
   * const worksheet = univerAPI.getActiveWorkbook()?.getActiveSheet();
   * const permission = worksheet?.getWorksheetPermission();
   * const rules = await permission?.listRangeProtectionRules();
   * const options = rules?.[0]?.options;
   * console.log(options);
   * ```
   */
  get options() {
    return __spreadValues({}, this._options);
  }
  /**
   * Update the protected ranges.
   * @param {FRange[]} ranges New ranges to protect.
   * @returns {Promise<void>} A promise that resolves when the ranges are updated.
   * @example
   * ```ts
   * const worksheet = univerAPI.getActiveWorkbook()?.getActiveSheet();
   * const permission = worksheet?.getWorksheetPermission();
   * const rules = await permission?.listRangeProtectionRules();
   * const rule = rules?.[0];
   * await rule?.updateRanges([worksheet.getRange('A1:C3')]);
   * ```
   */
  updateRanges(n3) {
    return __async(this, null, function* () {
      if (!n3 || n3.length === 0)
        throw new Error("Ranges cannot be empty");
      const e = this._rangeProtectionRuleModel.getRule(this._unitId, this._subUnitId, this._ruleId);
      if (!e)
        throw new Error(`Rule ${this._ruleId} not found`);
      if (this._rangeProtectionRuleModel.getSubunitRuleList(this._unitId, this._subUnitId).filter((r) => r.id !== this._ruleId).some(
        (r) => r.ranges.some(
          (i) => n3.some((o3) => {
            const a4 = o3.getRange();
            return this._rangesIntersect(a4, i);
          })
        )
      ))
        throw new Error("Range protection cannot intersect with other protection rules");
      yield this._commandService.executeCommand(fe3.id, {
        unitId: this._unitId,
        subUnitId: this._subUnitId,
        ruleId: this._ruleId,
        rule: __spreadProps(__spreadValues({}, e), {
          ranges: n3.map((r) => r.getRange())
        })
      }), this._ranges.length = 0, this._ranges.push(...n3);
    });
  }
  /**
   * Delete the current protection rule.
   * @returns {Promise<void>} A promise that resolves when the rule is removed.
   * @example
   * ```ts
   * const worksheet = univerAPI.getActiveWorkbook()?.getActiveSheet();
   * const permission = worksheet?.getWorksheetPermission();
   * const rules = await permission?.listRangeProtectionRules();
   * const rule = rules?.[0];
   * await rule?.remove();
   * ```
   */
  remove() {
    return __async(this, null, function* () {
      yield this._commandService.executeCommand(ot2.id, {
        unitId: this._unitId,
        subUnitId: this._subUnitId,
        ruleIds: [this._ruleId]
      });
    });
  }
  /**
   * Check if two ranges intersect
   * @returns true if ranges intersect, false otherwise
   * @private
   */
  _rangesIntersect(n3, e) {
    return !(n3.endRow < e.startRow || n3.startRow > e.endRow || n3.endColumn < e.startColumn || n3.startColumn > e.endColumn);
  }
};
j5 = Tn4([
  fe4(6, Inject(Injector)),
  fe4(7, Inject(Ds)),
  fe4(8, Inject(me))
], j5);
var oe4 = {
  [u.Edit]: Pe3,
  [u.View]: fr4,
  [u.Print]: hr2,
  [u.Export]: dr2,
  [u.Share]: mr2,
  [u.CopyContent]: ir4,
  [u.DuplicateFile]: cr2,
  [u.Comment]: rr2,
  [u.ManageCollaborator]: zs,
  [u.CreateSheet]: ur2,
  [u.DeleteSheet]: lr2,
  [u.RenameSheet]: Ks,
  [u.MoveSheet]: Gs,
  [u.HideSheet]: js2,
  [u.ViewHistory]: Rr2,
  [u.ManageHistory]: el,
  [u.RecoverHistory]: gr3,
  [u.CreateProtection]: ar3,
  [u.InsertRow]: nl,
  [u.InsertColumn]: tl,
  [u.DeleteRow]: Qu,
  [u.DeleteColumn]: Zu,
  [u.CopySheet]: Xu
};
var ae4 = {
  [m3.Edit]: Le2,
  [m3.View]: ds,
  [m3.Copy]: Cr,
  [m3.SetCellValue]: An3,
  [m3.SetCellStyle]: kr2,
  [m3.SetRowStyle]: Qt3,
  [m3.SetColumnStyle]: Zt3,
  [m3.InsertRow]: yr2,
  [m3.InsertColumn]: Mr,
  [m3.DeleteRow]: wr2,
  [m3.DeleteColumn]: pr2,
  [m3.Sort]: Ur,
  [m3.Filter]: vr3,
  [m3.PivotTable]: Er,
  [m3.InsertHyperlink]: _r2,
  [m3.EditExtraObject]: Ir2,
  [m3.ManageCollaborator]: br4,
  [m3.DeleteProtection]: Sr2,
  [m3.SelectProtectedCells]: Bh,
  [m3.SelectUnProtectedCells]: jh2
};
var X7 = {
  [k5.Edit]: Ve4,
  [k5.View]: Bs2,
  [k5.ManageCollaborator]: hi,
  [k5.Delete]: di
};
var Vn3 = Object.getOwnPropertyDescriptor;
var An6 = (n3, e, t3, s2) => {
  for (var r = s2 > 1 ? void 0 : s2 ? Vn3(e, t3) : e, i = n3.length - 1, o3; i >= 0; i--)
    (o3 = n3[i]) && (r = o3(r) || r);
  return r;
};
var V4 = (n3, e) => (t3, s2) => e(t3, s2, n3);
var je3 = class {
  constructor(n3, e, t3, s2, r, i, o3, a4) {
    g6(this, "_permissionSubject");
    g6(this, "_rangeRulesSubject");
    g6(this, "permission$");
    g6(this, "pointChange$");
    g6(this, "rangeProtectionChange$");
    g6(this, "rangeProtectionRules$");
    g6(this, "_unitId");
    g6(this, "_subUnitId");
    g6(this, "_subscriptions", []);
    g6(this, "_fPermission");
    this._worksheet = n3, this._injector = e, this._permissionService = t3, this._authzIoService = s2, this._commandService = r, this._rangeProtectionRuleModel = i, this._worksheetProtectionPointModel = o3, this._worksheetProtectionRuleModel = a4, this._unitId = this._worksheet.getWorkbook().getUnitId(), this._subUnitId = this._worksheet.getSheetId(), this._fPermission = this._injector.createInstance(H3), this._permissionSubject = new BehaviorSubject(this._buildSnapshot()), this._rangeRulesSubject = new BehaviorSubject(this._buildRangeProtectionRules()), this.permission$ = this._createPermissionStream(), this.pointChange$ = this._createPointChangeStream(), this.rangeProtectionChange$ = this._createRangeProtectionChangeStream(), this.rangeProtectionRules$ = this._createRangeProtectionRulesStream();
  }
  /**
   * Create permission snapshot stream from IPermissionService
   * @private
   */
  _createPermissionStream() {
    const n3 = this._permissionService.permissionPointUpdate$.pipe(
      filter((e) => e.id.includes(this._unitId) && e.id.includes(this._subUnitId))
    ).subscribe(() => {
      this._permissionSubject.next(this._buildSnapshot());
    });
    return this._subscriptions.push(n3), this._permissionSubject.asObservable().pipe(
      distinctUntilChanged((e, t3) => JSON.stringify(e) === JSON.stringify(t3)),
      shareReplay({ bufferSize: 1, refCount: true })
    );
  }
  /**
   * Create point change stream from IPermissionService
   * @private
   */
  _createPointChangeStream() {
    return this._permissionService.permissionPointUpdate$.pipe(
      filter((n3) => n3.id.includes(this._unitId) && n3.id.includes(this._subUnitId)),
      map((n3) => {
        var t3, s2;
        const e = this._extractWorksheetPointType(n3.id);
        return e ? {
          point: e,
          value: (t3 = n3.value) != null ? t3 : false,
          oldValue: !((s2 = n3.value) != null && s2)
        } : null;
      }),
      filter((n3) => n3 !== null),
      shareReplay({ bufferSize: 1, refCount: true })
    );
  }
  /**
   * Create range protection change stream from RangeProtectionRuleModel
   * @private
   */
  _createRangeProtectionChangeStream() {
    return this._rangeProtectionRuleModel.ruleChange$.pipe(
      filter((n3) => n3.unitId === this._unitId && n3.subUnitId === this._subUnitId),
      map((n3) => {
        const e = this._buildRangeProtectionRules();
        return { type: n3.type === "delete" ? "delete" : n3.type === "set" ? "update" : "add", rules: e };
      }),
      shareReplay({ bufferSize: 1, refCount: true })
    );
  }
  /**
   * Create range protection rules list stream from RangeProtectionRuleModel
   * @private
   */
  _createRangeProtectionRulesStream() {
    const n3 = this._rangeProtectionRuleModel.ruleChange$.pipe(
      filter((e) => e.unitId === this._unitId && e.subUnitId === this._subUnitId)
    ).subscribe(() => {
      this._rangeRulesSubject.next(this._buildRangeProtectionRules());
    });
    return this._subscriptions.push(n3), this._rangeRulesSubject.asObservable().pipe(
      distinctUntilChanged((e, t3) => e.length !== t3.length ? false : e.every((s2, r) => s2.id === t3[r].id)),
      shareReplay({ bufferSize: 1, refCount: true })
    );
  }
  /**
   * Extract WorksheetPermissionPoint type from permission point ID
   * @private
   */
  _extractWorksheetPointType(n3) {
    for (const [e, t3] of Object.entries(ae4))
      if (new t3(this._unitId, this._subUnitId).id === n3)
        return e;
    return null;
  }
  /**
   * Read the actual edit permission from a rule's permissionId
   */
  _getRuleEditPermission(n3) {
    var r;
    const e = X7[k5.Edit];
    if (!e)
      return false;
    const t3 = new e(
      this._unitId,
      this._subUnitId,
      n3.permissionId
    ), s2 = this._permissionService.getPermissionPoint(t3.id);
    return (r = s2 == null ? void 0 : s2.value) != null ? r : false;
  }
  /**
   * Build permission snapshot
   */
  _buildSnapshot() {
    const n3 = {};
    for (const e in m3) {
      const t3 = m3[e];
      n3[t3] = this.getPoint(t3);
    }
    return n3;
  }
  /**
   * Build range protection rules list
   */
  _buildRangeProtectionRules() {
    return this._rangeProtectionRuleModel.getSubunitRuleList(this._unitId, this._subUnitId).map((e) => {
      const t3 = e.ranges.map(
        (s2) => this._worksheet.getRange(
          s2.startRow,
          s2.startColumn,
          s2.endRow - s2.startRow + 1,
          s2.endColumn - s2.startColumn + 1
        )
      );
      return this._injector.createInstance(
        j5,
        this._unitId,
        this._subUnitId,
        e.id,
        e.permissionId,
        t3,
        {
          name: e.description || "",
          allowEdit: this._getRuleEditPermission(e)
        }
      );
    });
  }
  /**
   * Build Facade objects for all protection rules
   */
  _buildProtectionRule(n3) {
    const e = n3.ranges.map(
      (s2) => this._worksheet.getRange(s2)
    ), t3 = {
      name: n3.description || "",
      allowViewByOthers: n3.viewState !== Au.NoOneElseCanView
    };
    return n3.editState === xu.DesignedUserCanEdit ? t3.allowEdit = true : t3.allowEdit = false, this._injector.createInstance(
      j5,
      this._unitId,
      this._subUnitId,
      n3.id,
      n3.permissionId,
      e,
      t3
    );
  }
  /**
   * Debug cell permission information.
   * @param {number} row Row index.
   * @param {number} col Column index.
   * @returns {ICellPermissionDebugInfo | null} Debug information about which rules affect this cell, or null if no rules apply.
   * @example
   * ```ts
   * const worksheet = univerAPI.getActiveWorkbook()?.getActiveSheet();
   * const permission = worksheet?.getWorksheetPermission();
   * const debugInfo = permission?.debugCellPermission(0, 0);
   * console.log(debugInfo);
   * ```
   */
  debugCellPermission(n3, e) {
    const t3 = this._fPermission.getPermissionInfoWithCell(this._unitId, this._subUnitId, n3, e);
    if (!t3)
      return;
    const { ruleId: s2 } = t3, r = this._rangeProtectionRuleModel.getRule(this._unitId, this._subUnitId, s2);
    if (r)
      return this._buildProtectionRule(r);
  }
  /**
   * Create worksheet protection with collaborators support.
   * This must be called before setting permission points for collaboration to work.
   * @param {IWorksheetProtectionOptions} options Protection options including allowed users.
   * @returns {Promise<string>} The permissionId for the created protection.
   * @example
   * ```ts
   * const worksheet = univerAPI.getActiveWorkbook()?.getActiveSheet();
   * const permission = worksheet?.getWorksheetPermission();
   *
   * // Create worksheet protection with collaborators
   * const permissionId = await permission?.protect({
   *   allowedUsers: ['user1', 'user2'],
   *   name: 'My Worksheet Protection'
   * });
   *
   * // Now set permission points
   * await permission?.setMode('readOnly');
   * ```
   */
  protect(n3) {
    return __async(this, null, function* () {
      if (this.isProtected())
        throw new Error("Worksheet is already protected. Call unprotect() first.");
      const e = yield this._fPermission.addWorksheetBasePermission(this._unitId, this._subUnitId, n3);
      if (!e)
        throw new Error("Failed to create worksheet protection");
      return e;
    });
  }
  /**
   * Remove worksheet protection.
   * This deletes the protection rule and resets all permission points to allowed.
   * @returns {Promise<void>} A promise that resolves when protection is removed.
   * @example
   * ```ts
   * const worksheet = univerAPI.getActiveWorkbook()?.getActiveSheet();
   * const permission = worksheet?.getWorksheetPermission();
   * await permission?.unprotect();
   * ```
   */
  unprotect() {
    return __async(this, null, function* () {
      if (!this.isProtected())
        return;
      this._fPermission.removeWorksheetPermission(this._unitId, this._subUnitId);
      const n3 = this._buildSnapshot();
      this._permissionSubject.next(n3);
    });
  }
  /**
   * Check if worksheet is currently protected.
   * @returns {boolean} true if protected, false otherwise.
   * @example
   * ```ts
   * const worksheet = univerAPI.getActiveWorkbook()?.getActiveSheet();
   * const permission = worksheet?.getWorksheetPermission();
   * if (permission?.isProtected()) {
   *   console.log('Worksheet is protected');
   * }
   * ```
   */
  isProtected() {
    return !!this._worksheetProtectionRuleModel.getRule(this._unitId, this._subUnitId);
  }
  /**
   * Set permission mode for the worksheet.
   * Automatically creates worksheet protection if not already protected.
   * @param {WorksheetMode} mode The permission mode to set ('editable' | 'readOnly' | 'filterOnly' | 'commentOnly').
   * @returns {Promise<void>} A promise that resolves when the mode is set.
   * @example
   * ```ts
   * const worksheet = univerAPI.getActiveWorkbook()?.getActiveSheet();
   * const permission = worksheet?.getWorksheetPermission();
   * await permission?.setMode('readOnly');
   * ```
   */
  setMode(n3) {
    return __async(this, null, function* () {
      const e = this._getModePermissions(n3);
      yield this._batchSetPermissionPoints(e);
    });
  }
  /**
   * Get permission configuration for a specific mode
   * @private
   */
  _getModePermissions(n3) {
    const e = {};
    switch (Object.values(m3).forEach((t3) => {
      e[t3] = false;
    }), n3) {
      case "editable":
        Object.values(m3).forEach((t3) => {
          e[t3] = true;
        });
        break;
      case "readOnly":
        e[m3.View] = true;
        break;
      case "filterOnly":
        e[m3.View] = true, e[m3.Sort] = true, e[m3.Filter] = true;
        break;
    }
    return e;
  }
  /**
   * Batch set multiple permission points efficiently
   * @private
   */
  _batchSetPermissionPoints(n3) {
    return __async(this, null, function* () {
      const e = [];
      for (const [t3, s2] of Object.entries(n3)) {
        const r = t3, i = ae4[r];
        if (!i)
          throw new Error(`Unknown worksheet permission point: ${r}`);
        const o3 = this.getPoint(r);
        o3 !== s2 && (yield this._fPermission.setWorksheetPermissionPoint(this._unitId, this._subUnitId, i, s2), e.push({ point: r, value: s2, oldValue: o3 }));
      }
      if (e.length > 0) {
        const t3 = this._buildSnapshot();
        this._permissionSubject.next(t3);
      }
    });
  }
  /**
   * Set the worksheet to read-only mode.
   * @returns {Promise<void>} A promise that resolves when the mode is set.
   * @example
   * ```ts
   * const worksheet = univerAPI.getActiveWorkbook()?.getActiveSheet();
   * const permission = worksheet?.getWorksheetPermission();
   * await permission?.setReadOnly();
   * ```
   */
  setReadOnly() {
    return __async(this, null, function* () {
      yield this.setMode("readOnly");
    });
  }
  /**
   * Set the worksheet to editable mode.
   * @returns {Promise<void>} A promise that resolves when the mode is set.
   * @example
   * ```ts
   * const worksheet = univerAPI.getActiveWorkbook()?.getActiveSheet();
   * const permission = worksheet?.getWorksheetPermission();
   * await permission?.setEditable();
   * ```
   */
  setEditable() {
    return __async(this, null, function* () {
      yield this.setMode("editable");
    });
  }
  /**
   * Check if the worksheet is editable.
   * @returns {boolean} true if the worksheet can be edited, false otherwise.
   * @example
   * ```ts
   * const worksheet = univerAPI.getActiveWorkbook()?.getActiveSheet();
   * const permission = worksheet?.getWorksheetPermission();
   * if (permission?.canEdit()) {
   *   console.log('Worksheet is editable');
   * }
   * ```
   */
  canEdit() {
    return this.getPoint(m3.Edit);
  }
  /**
   * Check if a specific cell can be edited.
   * @param {number} row Row index.
   * @param {number} col Column index.
   * @returns {boolean} true if the cell can be edited, false otherwise.
   * @example
   * ```ts
   * const worksheet = univerAPI.getActiveWorkbook()?.getActiveSheet();
   * const permission = worksheet?.getWorksheetPermission();
   * const canEdit = permission?.canEditCell(0, 0);
   * console.log(canEdit);
   * ```
   */
  canEditCell(n3, e) {
    if (!this.canEdit())
      return false;
    const t3 = this._rangeProtectionRuleModel.getSubunitRuleList(this._unitId, this._subUnitId);
    for (const s2 of t3)
      for (const r of s2.ranges)
        if (n3 >= r.startRow && n3 <= r.endRow && e >= r.startColumn && e <= r.endColumn)
          return this._getRuleEditPermission(s2);
    return true;
  }
  /**
   * Check if a specific cell can be viewed.
   * @param {number} _row Row index (unused, for API consistency).
   * @param {number} _col Column index (unused, for API consistency).
   * @returns {boolean} true if the cell can be viewed, false otherwise.
   * @example
   * ```ts
   * const worksheet = univerAPI.getActiveWorkbook()?.getActiveSheet();
   * const permission = worksheet?.getWorksheetPermission();
   * const canView = permission?.canViewCell(0, 0);
   * console.log(canView);
   * ```
   */
  canViewCell(n3, e) {
    return this.getPoint(m3.View);
  }
  /**
   * Set a specific permission point for the worksheet.
   * Automatically creates worksheet protection if not already protected.
   * @param {WorksheetPermissionPoint} point The permission point to set.
   * @param {boolean} value The value to set (true = allowed, false = denied).
   * @returns {Promise<void>} A promise that resolves when the point is set.
   * @example
   * ```ts
   * const worksheet = univerAPI.getActiveWorkbook()?.getActiveSheet();
   * const permission = worksheet?.getWorksheetPermission();
   * await permission?.setPoint(univerAPI.Enum.WorksheetPermissionPoint.InsertRow, false);
   * ```
   */
  setPoint(n3, e) {
    return __async(this, null, function* () {
      const t3 = ae4[n3];
      if (!t3)
        throw new Error(`Unknown worksheet permission point: ${n3}`);
      if (this.getPoint(n3) === e)
        return;
      yield this._fPermission.setWorksheetPermissionPoint(this._unitId, this._subUnitId, t3, e);
      const r = this._buildSnapshot();
      this._permissionSubject.next(r);
    });
  }
  /**
   * Get the value of a specific permission point.
   * @param {WorksheetPermissionPoint} point The permission point to query.
   * @returns {boolean} true if allowed, false if denied.
   * @example
   * ```ts
   * const worksheet = univerAPI.getActiveWorkbook()?.getActiveSheet();
   * const permission = worksheet?.getWorksheetPermission();
   * const canInsertRow = permission?.getPoint(univerAPI.Enum.WorksheetPermissionPoint.InsertRow);
   * console.log(canInsertRow);
   * ```
   */
  getPoint(n3) {
    var r;
    const e = ae4[n3];
    if (!e)
      throw new Error(`Unknown worksheet permission point: ${n3}`);
    const t3 = new e(this._unitId, this._subUnitId), s2 = this._permissionService.getPermissionPoint(t3.id);
    return (r = s2 == null ? void 0 : s2.value) != null ? r : true;
  }
  /**
   * Get a snapshot of all permission points.
   * @returns {WorksheetPermissionSnapshot} An object containing all permission point values.
   * @example
   * ```ts
   * const worksheet = univerAPI.getActiveWorkbook()?.getActiveSheet();
   * const permission = worksheet?.getWorksheetPermission();
   * const snapshot = permission?.getSnapshot();
   * console.log(snapshot);
   * ```
   */
  getSnapshot() {
    return this._buildSnapshot();
  }
  /**
   * Apply a permission configuration to the worksheet.
   * @param {IWorksheetPermissionConfig} config The configuration to apply.
   * @returns {Promise<void>} A promise that resolves when the configuration is applied.
   * @example
   * ```ts
   * const worksheet = univerAPI.getActiveWorkbook()?.getActiveSheet();
   * const permission = worksheet?.getWorksheetPermission();
   * await permission?.applyConfig({
   *   mode: 'readOnly',
   *   points: {
   *     [univerAPI.Enum.WorksheetPermissionPoint.View]: true,
   *     [univerAPI.Enum.WorksheetPermissionPoint.Edit]: false
   *   }
   * });
   * ```
   */
  applyConfig(n3) {
    return __async(this, null, function* () {
      if (n3.mode && (yield this.setMode(n3.mode)), n3.points)
        for (const [e, t3] of Object.entries(n3.points))
          typeof t3 == "boolean" && (yield this.setPoint(e, t3));
      if (n3.rangeProtections && n3.rangeProtections.length > 0) {
        const e = n3.rangeProtections.map((t3) => ({
          ranges: t3.rangeRefs.map((s2) => this._worksheet.getRange(s2)),
          options: t3.options
        }));
        yield this.protectRanges(e);
      }
    });
  }
  /**
   * Protect multiple ranges at once (batch operation).
   * @param {Array<{ ranges: FRange[]; options?: IRangeProtectionOptions }>} configs Array of protection configurations.
   * @returns {Promise<FRangeProtectionRule[]>} Array of created protection rules.
   * @example
   * ```ts
   * const worksheet = univerAPI.getActiveWorkbook()?.getActiveSheet();
   * const permission = worksheet?.getWorksheetPermission();
   * const rules = await permission?.protectRanges([
   *   {
   *     ranges: [worksheet.getRange('A1:B2')],
   *     options: { name: 'Protected Area 1', allowEdit: false, allowViewByOthers: true }
   *   },
   *   {
   *     ranges: [worksheet.getRange('C3:D4')],
   *     options: { name: 'Protected Area 2', allowEdit: true, allowViewByOthers: false }
   *   }
   * ]);
   * console.log(rules);
   * ```
   */
  protectRanges(n3) {
    return __async(this, null, function* () {
      if (!n3 || n3.length === 0)
        throw new Error("Configs cannot be empty");
      const e = yield Promise.all(
        n3.map(
          (i) => {
            var o3, a4, h9, c2;
            return this._authzIoService.create({
              objectType: x4.SelectRange,
              selectRangeObject: {
                collaborators: (h9 = (a4 = (o3 = i.options) == null ? void 0 : o3.allowedUsers) == null ? void 0 : a4.map((d2) => ({ id: d2, role: Le6.Editor, subject: void 0 }))) != null ? h9 : [],
                unitID: this._unitId,
                name: ((c2 = i.options) == null ? void 0 : c2.name) || "",
                scope: void 0
              }
            });
          }
        )
      ), t3 = n3.map((i, o3) => {
        var c2;
        const a4 = this._determineViewState(i.options), h9 = this._determineEditState(i.options);
        return {
          permissionId: e[o3],
          unitType: x4.SelectRange,
          unitId: this._unitId,
          subUnitId: this._subUnitId,
          ranges: i.ranges.map((d2) => d2.getRange()),
          id: this._rangeProtectionRuleModel.createRuleId(this._unitId, this._subUnitId),
          description: ((c2 = i.options) == null ? void 0 : c2.name) || "",
          viewState: a4,
          editState: h9
        };
      });
      if (!(yield this._commandService.executeCommand(Be3.id, {
        unitId: this._unitId,
        subUnitId: this._subUnitId,
        rules: t3
      })))
        throw new Error("Failed to create range protection rules");
      return yield Promise.all(
        n3.map((i, o3) => this._setPermissionPoints(e[o3], i.options))
      ), t3.map(
        (i, o3) => this._injector.createInstance(
          j5,
          this._unitId,
          this._subUnitId,
          i.id,
          i.permissionId,
          n3[o3].ranges,
          n3[o3].options || {}
        )
      );
    });
  }
  /**
   * Determine view state from options
   * @private
   */
  _determineViewState(n3) {
    return (n3 == null ? void 0 : n3.allowViewByOthers) === false ? Au.NoOneElseCanView : Au.OthersCanView;
  }
  /**
   * Determine edit state from options
   * @private
   */
  _determineEditState(n3) {
    var e;
    return (n3 == null ? void 0 : n3.allowEdit) === true && ((e = n3 == null ? void 0 : n3.allowedUsers) != null && e.length) ? xu.DesignedUserCanEdit : xu.OnlyMe;
  }
  /**
   * Set permission points based on options (for local runtime control)
   * @private
   */
  _setPermissionPoints(n3, e) {
    return __async(this, null, function* () {
      if (!e)
        return;
      const t3 = (s2, r) => s2 === void 0 ? r : typeof s2 == "boolean" ? s2 : true;
      yield this._setPermissionPoint(n3, k5.Edit, t3(e.allowEdit, false)), yield this._setPermissionPoint(n3, k5.View, t3(e.allowViewByOthers, true));
    });
  }
  /**
   * Set a single permission point
   * @private
   */
  _setPermissionPoint(n3, e, t3) {
    return __async(this, null, function* () {
      const s2 = X7[e];
      s2 && this._fPermission.setRangeProtectionPermissionPoint(this._unitId, this._subUnitId, n3, s2, t3);
    });
  }
  /**
   * Remove multiple protection rules at once.
   * @param {string[]} ruleIds Array of rule IDs to remove.
   * @returns {Promise<void>} A promise that resolves when the rules are removed.
   * @example
   * ```ts
   * const worksheet = univerAPI.getActiveWorkbook()?.getActiveSheet();
   * const permission = worksheet?.getWorksheetPermission();
   * await permission?.unprotectRules(['rule1', 'rule2']);
   * ```
   */
  unprotectRules(n3) {
    return __async(this, null, function* () {
      !n3 || n3.length === 0 || this._fPermission.removeRangeProtection(this._unitId, this._subUnitId, n3);
    });
  }
  /**
   * List all range protection rules for the worksheet.
   * @returns {Promise<FRangeProtectionRule[]>} Array of protection rules.
   * @example
   * ```ts
   * const worksheet = univerAPI.getActiveWorkbook()?.getActiveSheet();
   * const permission = worksheet?.getWorksheetPermission();
   * const rules = await permission?.listRangeProtectionRules();
   * console.log(rules);
   * ```
   */
  listRangeProtectionRules() {
    return __async(this, null, function* () {
      return this._buildRangeProtectionRules();
    });
  }
  /**
   * Subscribe to permission changes (simplified interface for users not familiar with RxJS).
   * @param {Function} listener Callback function to be called when permissions change.
   * @returns {UnsubscribeFn} Unsubscribe function.
   * @example
   * ```ts
   * const worksheet = univerAPI.getActiveWorkbook()?.getActiveSheet();
   * const permission = worksheet?.getWorksheetPermission();
   * const unsubscribe = permission?.subscribe((snapshot) => {
   *   console.log('Permission changed:', snapshot);
   * });
   * // Later, to stop listening:
   * unsubscribe?.();
   * ```
   */
  subscribe(n3) {
    const e = this.permission$.subscribe(n3);
    return () => e.unsubscribe();
  }
  /**
   * Clean up resources
   */
  dispose() {
    this._subscriptions.forEach((n3) => n3.unsubscribe()), this._permissionSubject.complete(), this._rangeRulesSubject.complete();
  }
};
je3 = An6([
  V4(1, Inject(Injector)),
  V4(2, aC),
  V4(3, _E),
  V4(4, Ds),
  V4(5, Inject(me)),
  V4(6, Inject(vn2)),
  V4(7, Inject(lt3))
], je3);
function Bn6(n3) {
  switch (n3) {
    case "left":
      return Pt.LEFT;
    case "center":
      return Pt.CENTER;
    case "normal":
      return Pt.RIGHT;
    default:
      throw new Error(`Invalid horizontal alignment: ${n3}`);
  }
}
function lt6(n3) {
  switch (n3) {
    case Pt.LEFT:
      return "left";
    case Pt.CENTER:
      return "center";
    case Pt.RIGHT:
      return "normal";
    default:
      return "general";
  }
}
function Fn7(n3) {
  switch (n3) {
    case "top":
      return Dn.TOP;
    case "middle":
      return Dn.MIDDLE;
    case "bottom":
      return Dn.BOTTOM;
    default:
      throw new Error(`Invalid vertical alignment: ${n3}`);
  }
}
function mt6(n3) {
  switch (n3) {
    case Dn.TOP:
      return "top";
    case Dn.MIDDLE:
      return "middle";
    case Dn.BOTTOM:
      return "bottom";
    default:
      return "general";
  }
}
function ve3(n3, e) {
  return {
    startRow: n3.startRow,
    endRow: n3.endRow,
    startColumn: 0,
    endColumn: e.getColumnCount() - 1,
    rangeType: ge.ROW
  };
}
function Re4(n3, e) {
  return {
    startRow: 0,
    endRow: e.getRowCount() - 1,
    startColumn: n3.startColumn,
    endColumn: n3.endColumn,
    rangeType: ge.COLUMN
  };
}
var Hn5 = Object.getOwnPropertyDescriptor;
var $n4 = (n3, e, t3, s2) => {
  for (var r = s2 > 1 ? void 0 : s2 ? Hn5(e, t3) : e, i = n3.length - 1, o3; i >= 0; i--)
    (o3 = n3[i]) && (r = o3(r) || r);
  return r;
};
var he3 = (n3, e) => (t3, s2) => e(t3, s2, n3);
var I5 = class extends $e {
  /**
   * Creates a new worksheet facade instance
   * @param {FWorkbook} _fWorkbook - The facade workbook instance
   * @param {Workbook} _workbook - The workbook instance
   * @param {Worksheet} _worksheet - The worksheet instance
   * @param {Injector} _injector - The injector instance
   * @param {SheetsSelectionsService} _selectionManagerService - The selection manager service
   * @param {ILogService} _logService - The log service
   * @param {ICommandService} _commandService - The command service
   */
  constructor(e, t3, s2, r, i, o3, a4) {
    super(r);
    g6(this, "setActiveSelection", this.setActiveRange);
    this._fWorkbook = e, this._workbook = t3, this._worksheet = s2, this._injector = r, this._selectionManagerService = i, this._logService = o3, this._commandService = a4;
  }
  dispose() {
    super.dispose(), delete this._fWorkbook, delete this._workbook, delete this._worksheet;
  }
  /**
   * Get the worksheet instance.
   * @returns {Worksheet} The worksheet instance.
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * const sheet = fWorksheet.getSheet();
   * console.log(sheet);
   * ```
   */
  getSheet() {
    return this._worksheet;
  }
  /**
   * Get the injector instance.
   * @returns {Injector} The injector instance.
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * const injector = fWorksheet.getInject();
   * console.log(injector);
   * ```
   */
  getInject() {
    return this._injector;
  }
  /**
   * Get the workbook instance.
   * @returns {Workbook} The workbook instance.
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * const workbook = fWorksheet.getWorkbook();
   * console.log(workbook);
   * ```
   */
  getWorkbook() {
    return this._workbook;
  }
  /**
   * Get the worksheet id.
   * @returns {string} The id of the worksheet.
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * const sheetId = fWorksheet.getSheetId();
   * console.log(sheetId);
   * ```
   */
  getSheetId() {
    return this._worksheet.getSheetId();
  }
  /**
   * Get the worksheet name.
   * @returns {string} The name of the worksheet.
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * const sheetName = fWorksheet.getSheetName();
   * console.log(sheetName);
   * ```
   */
  getSheetName() {
    return this._worksheet.getName();
  }
  /**
   * Get the current selection of the worksheet.
   * @returns {FSelection} return the current selections of the worksheet or null if there is no selection.
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * const selection = fWorksheet.getSelection();
   * console.log(selection);
   * ```
   */
  getSelection() {
    const e = this._selectionManagerService.getCurrentSelections();
    return e ? this._injector.createInstance(we5, this._workbook, this._worksheet, e) : null;
  }
  // #region rows
  // #region default style
  /**
   * Get the default style of the worksheet.
   * @returns {IStyleData} Default style of the worksheet.
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * const defaultStyle = fWorksheet.getDefaultStyle();
   * console.log(defaultStyle);
   * ```
   */
  getDefaultStyle() {
    return this._worksheet.getDefaultCellStyle();
  }
  /**
   * Get the default style of the worksheet row
   * @param {number} index - The row index
   * @param {boolean} [keepRaw] - If true, return the raw style data maybe the style name or style data, otherwise return the data from row manager
   * @returns {(Nullable<IStyleData> | string)} The default style of the worksheet row name or style data
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // Get default style for row 0 (1)
   * const rowStyle = fWorksheet.getRowDefaultStyle(0);
   * console.log(rowStyle);
   * // Get raw style data for row 0
   * const rawRowStyle = fWorksheet.getRowDefaultStyle(0, true);
   * console.log(rawRowStyle);
   * ```
   */
  getRowDefaultStyle(e, t3 = false) {
    return t3 ? this._worksheet.getRowStyle(e, t3) : this._worksheet.getRowStyle(e);
  }
  /**
   * Get the default style of the worksheet column
   * @param {number} index - The column index
   * @param {boolean} [keepRaw] - If true, return the raw style data maybe the style name or style data, otherwise return the data from col manager
   * @returns {(Nullable<IStyleData> | string)} The default style of the worksheet column name or style data
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // Get default style for column 0 (A)
   * const colStyle = fWorksheet.getColumnDefaultStyle(0);
   * console.log(colStyle);
   * // Get raw style data for column 0
   * const rawColStyle = fWorksheet.getColumnDefaultStyle(0, true);
   * console.log(rawColStyle);
   * ```
   */
  getColumnDefaultStyle(e, t3 = false) {
    return t3 ? this._worksheet.getColumnStyle(e, t3) : this._worksheet.getColumnStyle(e);
  }
  /**
   * Set the default style of the worksheet
   * @param {string} style - The style to set
   * @returns {FWorksheet} This worksheet instance for chaining
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * fWorksheet.setDefaultStyle('default');
   * // or
   * // fWorksheet.setDefaultStyle({fs: 12, ff: 'Arial'});
   * ```
   */
  setDefaultStyle(e) {
    const t3 = this._workbook.getUnitId(), s2 = this._worksheet.getSheetId();
    return this._commandService.syncExecuteCommand(qt.id, {
      unitId: t3,
      subUnitId: s2,
      defaultStyle: e
    }), this._worksheet.setDefaultCellStyle(e), this;
  }
  /**
   * Set the default style of the worksheet row
   * @param {number} index - The row index
   * @param {string | Nullable<IStyleData>} style - The style name or style data
   * @returns {FWorksheet} This sheet, for chaining.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * fWorksheet.setColumnDefaultStyle(0, 'default');
   * // or
   * // fWorksheet.setColumnDefaultStyle(0, {fs: 12, ff: 'Arial'});
   * ```
   */
  setColumnDefaultStyle(e, t3) {
    const s2 = this._workbook.getUnitId(), r = this._worksheet.getSheetId(), i = {
      unitId: s2,
      subUnitId: r,
      columnData: {
        [e]: {
          s: t3
        }
      }
    };
    return this._commandService.syncExecuteCommand(Oc.id, i), this;
  }
  /**
   * Set the default style of the worksheet column
   * @param {number} index - The column index
   * @param {string | Nullable<IStyleData>} style - The style name or style data
   * @returns {FWorksheet} This sheet, for chaining.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * fWorksheet.setRowDefaultStyle(0, 'default');
   * // or
   * // fWorksheet.setRowDefaultStyle(0, {fs: 12, ff: 'Arial'});
   * ```
   */
  setRowDefaultStyle(e, t3) {
    const s2 = this._workbook.getUnitId(), r = this._worksheet.getSheetId(), i = {
      unitId: s2,
      subUnitId: r,
      rowData: {
        [e]: {
          s: t3
        }
      }
    };
    return this._commandService.syncExecuteCommand(Lc.id, i), this;
  }
  getRange(e, t3, s2, r) {
    let i, o3;
    if (typeof e == "object")
      i = e, o3 = this._worksheet;
    else if (typeof e == "string") {
      const { range: a4, sheetName: h9 } = kr(e), c2 = h9 ? this._workbook.getSheetBySheetName(h9) : this._worksheet;
      if (!c2)
        throw new Error("Range not found");
      o3 = c2, i = __spreadProps(__spreadValues({}, a4), {
        unitId: this._workbook.getUnitId(),
        sheetId: o3.getSheetId(),
        // Use the current range instead of the future actual range to match Apps Script behavior.
        // Users can create the latest range in real time when needed.
        rangeType: ge.NORMAL,
        startRow: a4.rangeType === ge.COLUMN ? 0 : a4.startRow,
        endRow: a4.rangeType === ge.COLUMN ? o3.getMaxRows() - 1 : a4.endRow,
        startColumn: a4.rangeType === ge.ROW ? 0 : a4.startColumn,
        endColumn: a4.rangeType === ge.ROW ? o3.getMaxColumns() - 1 : a4.endColumn
      });
    } else if (typeof e == "number" && t3 !== void 0)
      o3 = this._worksheet, i = {
        startRow: e,
        endRow: e + (s2 != null ? s2 : 1) - 1,
        startColumn: t3,
        endColumn: t3 + (r != null ? r : 1) - 1,
        unitId: this._workbook.getUnitId(),
        sheetId: this._worksheet.getSheetId()
      };
    else
      throw new Error("Invalid range specification");
    return this._injector.createInstance(f3, this._workbook, o3, i);
  }
  /**
   * Returns the current number of columns in the sheet, regardless of content.
   * @returns {number} The maximum columns count of the sheet
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * const totalColumns = fWorksheet.getMaxColumns();
   * console.log(`Sheet has ${totalColumns} columns`);
   * ```
   */
  getMaxColumns() {
    return this._worksheet.getMaxColumns();
  }
  /**
   * Returns the current number of rows in the sheet, regardless of content.
   * @returns {number}The maximum rows count of the sheet
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * const totalRows = fWorksheet.getMaxRows();
   * console.log(`Sheet has ${totalRows} rows`);
   * ```
   */
  getMaxRows() {
    return this._worksheet.getMaxRows();
  }
  /**
   * Inserts a row after the given row position.
   * @param {number} afterPosition - The row after which the new row should be added, starting at 0 for the first row.
   * @returns {FWorksheet} This sheet, for chaining.
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // Insert a row after the third row
   * fWorksheet.insertRowAfter(2);
   * // Insert a row after the first row
   * fWorksheet.insertRowAfter(0);
   * ```
   */
  insertRowAfter(e) {
    return this.insertRowsAfter(e, 1);
  }
  /**
   * Inserts a row before the given row position.
   * @param {number} beforePosition - The row before which the new row should be added, starting at 0 for the first row.
   * @returns {FWorksheet} This sheet, for chaining.
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // Insert a row before the third row
   * fWorksheet.insertRowBefore(2);
   * // Insert a row before the first row
   * fWorksheet.insertRowBefore(0);
   * ```
   */
  insertRowBefore(e) {
    return this.insertRowsBefore(e, 1);
  }
  /**
   * Inserts one or more consecutive blank rows in a sheet starting at the specified location.
   * @param {number} rowIndex - The index indicating where to insert a row, starting at 0 for the first row.
   * @param {number} numRows - The number of rows to insert.
   * @returns {FWorksheet} This sheet, for chaining.
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // Insert 3 rows before the third row
   * fWorksheet.insertRows(2, 3);
   * // Insert 1 row before the first row
   * fWorksheet.insertRows(0);
   * ```
   */
  insertRows(e, t3 = 1) {
    return this.insertRowsBefore(e, t3);
  }
  /**
   * Inserts a number of rows after the given row position.
   * @param {number} afterPosition - The row after which the new rows should be added, starting at 0 for the first row.
   * @param {number} howMany - The number of rows to insert.
   * @returns {FWorksheet} This sheet, for chaining.
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // Insert 3 rows after the third row
   * fWorksheet.insertRowsAfter(2, 3);
   * // Insert 1 row after the first row
   * fWorksheet.insertRowsAfter(0, 1);
   * ```
   */
  insertRowsAfter(e, t3) {
    const s2 = this._workbook.getUnitId(), r = this._worksheet.getSheetId(), i = wm.DOWN, o3 = e + 1, a4 = e + t3, h9 = 0, c2 = this._worksheet.getColumnCount() - 1, d2 = Ct2(this._worksheet, o3, a4, h9, c2, true, e);
    return this._commandService.syncExecuteCommand(Ar.id, {
      unitId: s2,
      subUnitId: r,
      direction: i,
      range: {
        startRow: o3,
        endRow: a4,
        startColumn: h9,
        endColumn: c2
      },
      cellValue: d2
    }), this;
  }
  /**
   * Inserts a number of rows before the given row position.
   * @param {number} beforePosition - The row before which the new rows should be added, starting at 0 for the first row.
   * @param {number} howMany - The number of rows to insert.
   * @returns {FWorksheet} This sheet, for chaining.
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // Insert 3 rows before the third row
   * fWorksheet.insertRowsBefore(2, 3);
   * // Insert 1 row before the first row
   * fWorksheet.insertRowsBefore(0, 1);
   * ```
   */
  insertRowsBefore(e, t3) {
    const s2 = this._workbook.getUnitId(), r = this._worksheet.getSheetId(), i = wm.UP, o3 = e, a4 = e + t3 - 1, h9 = 0, c2 = this._worksheet.getColumnCount() - 1, d2 = Ct2(this._worksheet, o3, a4, h9, c2, true, e - 1);
    return this._commandService.syncExecuteCommand(Ar.id, {
      unitId: s2,
      subUnitId: r,
      direction: i,
      range: {
        startRow: o3,
        endRow: a4,
        startColumn: h9,
        endColumn: c2
      },
      cellValue: d2
    }), this;
  }
  /**
   * Deletes the row at the given row position.
   * @param {number} rowPosition - The position of the row, starting at 0 for the first row.
   * @returns {FWorksheet} This sheet, for chaining.
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // Delete the third row
   * fWorksheet.deleteRow(2);
   * // Delete the first row
   * fWorksheet.deleteRow(0);
   * ```
   */
  deleteRow(e) {
    return this.deleteRows(e, 1);
  }
  /**
   * Deletes a number of rows starting at the given row position.
   * @param {number} rowPosition - The position of the first row to delete, starting at 0 for the first row.
   * @param {number} howMany - The number of rows to delete.
   * @returns {FWorksheet} This sheet, for chaining.
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // Delete 3 rows at row index 2 (rows 3-5)
   * fWorksheet.deleteRows(2, 3);
   * // Delete 1 row at row index 0 (first row)
   * fWorksheet.deleteRows(0, 1);
   * ```
   */
  deleteRows(e, t3) {
    const s2 = {
      startRow: e,
      endRow: e + t3 - 1,
      startColumn: 0,
      endColumn: this._worksheet.getColumnCount() - 1
    };
    return this._commandService.syncExecuteCommand(Wr2.id, {
      range: s2,
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId()
    }), this;
  }
  /**
   * Moves the rows selected by the given range to the position indicated by the destinationIndex. The rowSpec itself does not have to exactly represent an entire row or group of rows to moveâ€”it selects all rows that the range spans.
   * @param {FRange} rowSpec - A range spanning the rows that should be moved.
   * @param {number} destinationIndex - The index that the rows should be moved to. Note that this index is based on the coordinates before the rows are moved. Existing data is shifted down to make room for the moved rows while the source rows are removed from the grid. Therefore, the data may end up at a different index than originally specified. Use 0-index for this method.
   * @returns {FWorksheet} This sheet, for chaining.
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // Move 3 rows at row index 2 (rows 3-5) to row index 0
   * const rowSpec1 = fWorksheet.getRange('3:5');
   * fWorksheet.moveRows(rowSpec1, 0);
   * // Move 1 row at row index 0 (first row) to row index 2
   * const rowSpec2 = fWorksheet.getRange('1:1');
   * fWorksheet.moveRows(rowSpec2, 2);
   * ```
   */
  moveRows(e, t3) {
    const s2 = this._workbook.getUnitId(), r = this._worksheet.getSheetId(), i = ve3(e.getRange(), this._worksheet), o3 = i, a4 = {
      startRow: t3,
      endRow: t3,
      startColumn: i.startColumn,
      endColumn: i.endColumn
    };
    return this._commandService.syncExecuteCommand(an.id, {
      unitId: s2,
      subUnitId: r,
      range: i,
      fromRange: o3,
      toRange: a4
    }), this;
  }
  /**
   * Hides the rows in the given range.
   * @param {FRange} row - The row range to hide.
   * @returns {FWorksheet} This sheet, for chaining.
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // Hide 3 rows starting from row index 1 (rows 2-4)
   * const row1 = fWorksheet.getRange('2:4');
   * fWorksheet.hideRow(row1);
   * // Hide single row at index 0 (first row)
   * const row2 = fWorksheet.getRange('1:1');
   * fWorksheet.hideRow(row2);
   * ```
   */
  hideRow(e) {
    const t3 = this._workbook.getUnitId(), s2 = this._worksheet.getSheetId(), r = ve3(e.getRange(), this._worksheet);
    return this._commandService.syncExecuteCommand(Ts3.id, {
      unitId: t3,
      subUnitId: s2,
      ranges: [r]
    }), this;
  }
  /**
   * Hides one or more consecutive rows starting at the given index. Use 0-index for this method
   * @param {number} rowIndex - The starting index of the rows to hide
   * @param {number} numRow - The number of rows to hide
   * @returns {FWorksheet} This sheet, for chaining.
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // Hide 3 rows starting from row index 1 (rows 2-4)
   * fWorksheet.hideRows(1, 3);
   * // Hide single row at index 0 (first row)
   * fWorksheet.hideRows(0);
   * ```
   */
  hideRows(e, t3 = 1) {
    const s2 = this._workbook.getUnitId(), r = this._worksheet.getSheetId(), i = {
      startRow: e,
      endRow: e + t3 - 1,
      startColumn: 0,
      endColumn: this._worksheet.getColumnCount() - 1,
      rangeType: ge.ROW
    };
    return this._commandService.syncExecuteCommand(Ts3.id, {
      unitId: s2,
      subUnitId: r,
      ranges: [i]
    }), this;
  }
  /**
   * Make the row in the given range visible.
   * @param {FRange} row - The range to unhide, if hidden.
   * @returns {FWorksheet} This sheet, for chaining.
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // Unhide 3 rows starting from row index 1 (rows 2-4)
   * const row1 = fWorksheet.getRange('2:4');
   * fWorksheet.unhideRow(row1);
   * // Unhide single row at index 0 (first row)
   * const row2 = fWorksheet.getRange('1:1');
   * fWorksheet.unhideRow(row2);
   * ```
   */
  unhideRow(e) {
    const t3 = this._workbook.getUnitId(), s2 = this._worksheet.getSheetId(), r = ve3(e.getRange(), this._worksheet);
    return this._commandService.syncExecuteCommand(hn.id, {
      unitId: t3,
      subUnitId: s2,
      ranges: [r]
    }), this;
  }
  /**
   * Scrolling sheet to make specific rows visible.
   * @param {number} rowIndex - The starting index of the rows
   * @param {number} numRows - The number of rows
   * @returns {FWorksheet} This worksheet instance for chaining
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // Show 3 rows starting from row index 1 (rows 2-4)
   * fWorksheet.showRows(1, 3);
   * // Show single row at index 0 (first row)
   * fWorksheet.showRows(0);
   * ```
   */
  showRows(e, t3 = 1) {
    const s2 = this._workbook.getUnitId(), r = this._worksheet.getSheetId(), i = {
      startRow: e,
      endRow: e + t3 - 1,
      startColumn: 0,
      endColumn: this._worksheet.getColumnCount() - 1,
      rangeType: ge.ROW
    };
    return this._commandService.syncExecuteCommand(hn.id, {
      unitId: s2,
      subUnitId: r,
      ranges: [i]
    }), this;
  }
  /**
   * Sets the row height of the given row in pixels. By default, rows grow to fit cell contents. If you want to force rows to a specified height, use setRowHeightsForced(startRow, numRows, height).
   * @param {number} rowPosition - The row position to change.
   * @param {number} height - The height in pixels to set it to.
   * @returns {FWorksheet} This worksheet instance for chaining
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // Set the height of the second row to 30 pixels
   * fWorksheet.setRowHeight(1, 30);
   * // Set the height of the first row to 20 pixels
   * fWorksheet.setRowHeight(0, 20);
   * ```
   */
  setRowHeight(e, t3) {
    return this.setRowHeights(e, 1, t3);
  }
  /**
   * Make certain row wrap and auto height.
   * @param {number} rowPosition - The row position to change.
   * @param {BooleanNumber} auto - Whether to auto fit the row height.
   * @returns {FWorksheet} This worksheet instance for chaining
   * @example
   * ```ts
   * const fWorkSheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * fWorkSheet.autoFitRow(24);
   * ```
   */
  autoFitRow(e, t3 = ie.TRUE) {
    const s2 = this._workbook.getUnitId(), r = this._worksheet.getSheetId(), i = [{
      startRow: e,
      endRow: e,
      startColumn: 0,
      endColumn: this._worksheet.getColumnCount() - 1
    }];
    return this._commandService.syncExecuteCommand(Yc2.id, {
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId(),
      range: i[0],
      value: jn.WRAP
    }), this._commandService.syncExecuteCommand(Fe3.id, {
      unitId: s2,
      subUnitId: r,
      ranges: i,
      autoHeightInfo: t3
    }), this;
  }
  /**
   * Sets the height of the given rows in pixels.
   * By default, rows grow to fit cell contents. If you want to force rows to a specified height, use setRowHeightsForced(startRow, numRows, height).
   * @param {number} startRow - The starting row position to change
   * @param {number} numRows - The number of rows to change
   * @param {number} height - The height in pixels to set it to
   * @returns {FWorksheet} This worksheet instance for chaining
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * fWorksheet.setRowHeights(1, 10, 30);
   * ```
   */
  setRowHeights(e, t3, s2) {
    var c2;
    const r = this._workbook.getUnitId(), i = this._worksheet.getSheetId(), o3 = this._worksheet.getRowManager(), a4 = [], h9 = [];
    for (let d2 = e; d2 < e + t3; d2++) {
      const w6 = ((c2 = o3.getRow(d2)) == null ? void 0 : c2.ah) || this._worksheet.getConfig().defaultRowHeight, _3 = {
        startRow: d2,
        endRow: d2,
        startColumn: 0,
        endColumn: this._worksheet.getColumnCount() - 1
      };
      s2 <= w6 ? a4.push(_3) : h9.push(_3);
    }
    return h9.length > 0 && this._commandService.syncExecuteCommand(Kn.id, {
      unitId: r,
      subUnitId: i,
      ranges: h9,
      value: s2
    }), a4.length > 0 && this._commandService.syncExecuteCommand(no.id, {
      unitId: r,
      subUnitId: i,
      ranges: a4
    }), this;
  }
  /**
   * Gets the height in pixels of the given row.
   * @param {number} rowPosition - The position of the row to examine. index starts at 0.
   * @returns {number} The height in pixels of the given row.
   * @example
   * ```typescript
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   *
   * // Set the value of the cell A1 to 'Hello, Univer!', set the font size to 30 and font weight to bold
   * const fRange = fWorksheet.getRange('A1');
   * fRange.setValue('Hello, Univer!').setFontSize(30).setFontWeight('bold');
   *
   * // Get the height of the first row
   * console.log(fWorksheet.getRowHeight(0));
   * ```
   */
  getRowHeight(e) {
    return this._worksheet.getRowHeight(e);
  }
  /**
   * Sets the height of the given rows to auto.
   * @param {number} startRow - The starting row position to change
   * @param {number} numRows - The number of rows to change
   * @returns {FWorksheet} This worksheet instance for chaining
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * fWorksheet.setRowAutoHeight(1, 10);
   * ```
   */
  setRowAutoHeight(e, t3) {
    const s2 = this._workbook.getUnitId(), r = this._worksheet.getSheetId(), i = [
      {
        startRow: e,
        endRow: e + t3 - 1,
        startColumn: 0,
        endColumn: this._worksheet.getColumnCount() - 1
      }
    ];
    return this._commandService.syncExecuteCommand(no.id, {
      unitId: s2,
      subUnitId: r,
      ranges: i
    }), this;
  }
  /**
   * Sets the height of the given ranges to auto.
   * @param {IRange[]} ranges - The ranges to change
   * @returns {FWorksheet} This worksheet instance for chaining
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * const ranges = [
   * { startRow: 1, endRow: 10, startColumn: 0, endColumn: 10 },
   * { startRow: 11, endRow: 20, startColumn: 0, endColumn: 10 },
   * ]
   * fWorksheet.setRangesAutoHeight(ranges);
   * ```
   */
  setRangesAutoHeight(e) {
    const t3 = this._workbook.getUnitId(), s2 = this._worksheet.getSheetId();
    return this._commandService.syncExecuteCommand(no.id, {
      unitId: t3,
      subUnitId: s2,
      ranges: e
    }), this;
  }
  /**
   * Sets the height of the given rows in pixels. By default, rows grow to fit cell contents. When you use setRowHeightsForced, rows are forced to the specified height even if the cell contents are taller than the row height.
   * @param {number} startRow - The starting row position to change
   * @param {number} numRows - The number of rows to change
   * @param {number} height - The height in pixels to set it to
   * @returns {FWorksheet} This worksheet instance for chaining
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * fWorksheet.setRowHeightsForced(1, 10, 30);
   * ```
   */
  setRowHeightsForced(e, t3, s2) {
    const r = this._workbook.getUnitId(), i = this._worksheet.getSheetId(), o3 = [
      {
        startRow: e,
        endRow: e + t3 - 1,
        startColumn: 0,
        endColumn: this._worksheet.getColumnCount() - 1
      }
    ];
    return this._commandService.syncExecuteCommand(Kn.id, {
      unitId: r,
      subUnitId: i,
      ranges: o3,
      value: s2
    }), this;
  }
  // #endregion
  /**
   * Set custom properties for given rows.
   * @param {IObjectArrayPrimitiveType<CustomData>} custom - The custom properties to set
   * @returns {FWorksheet} This worksheet instance for chaining
   * @example
   * ```typescript
   * const fWorkSheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * fWorkSheet.setRowCustom({ 0: { key: 'value' } });
   * ```
   */
  setRowCustom(e) {
    const t3 = this._workbook.getUnitId(), s2 = this._worksheet.getSheetId(), r = {};
    for (const [o3, a4] of Object.entries(e))
      r[Number(o3)] = {
        custom: a4
      };
    const i = {
      unitId: t3,
      subUnitId: s2,
      rowData: r
    };
    return this._commandService.syncExecuteCommand(Lc.id, i), this;
  }
  // #region Column
  /**
   * Inserts a column after the given column position.
   * @param {number} afterPosition - The column after which the new column should be added, starting at 0 for the first column
   * @returns {FWorksheet} This worksheet instance for chaining
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // Insert a column after column C
   * fWorksheet.insertColumnAfter(2);
   * // Insert a column after column A
   * fWorksheet.insertColumnAfter(0);
   * ```
   */
  insertColumnAfter(e) {
    return this.insertColumnsAfter(e, 1);
  }
  /**
   * Inserts a column before the given column position.
   * @param {number} beforePosition - The column before which the new column should be added, starting at 0 for the first column
   * @returns {FWorksheet} This worksheet instance for chaining
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // Insert a column before column C
   * fWorksheet.insertColumnBefore(2);
   * // Insert a column before column A
   * fWorksheet.insertColumnBefore(0);
   * ```
   */
  insertColumnBefore(e) {
    return this.insertColumnsBefore(e, 1);
  }
  /**
   * Inserts one or more consecutive blank columns in a sheet starting at the specified location.
   * @param {number} columnIndex - The index indicating where to insert a column, starting at 0 for the first column
   * @param {number} numColumns - The number of columns to insert
   * @returns {FWorksheet} This sheet, for chaining
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // Insert 3 columns before column C
   * fWorksheet.insertColumns(2, 3);
   * // Insert 1 column before column A
   * fWorksheet.insertColumns(0);
   * ```
   */
  insertColumns(e, t3 = 1) {
    return this.insertColumnsBefore(e, t3);
  }
  /**
   * Inserts a given number of columns after the given column position.
   * @param {number} afterPosition - The column after which the new columns should be added, starting at 0 for the first column
   * @param {number} howMany - The number of columns to insert
   * @returns {FWorksheet} This sheet, for chaining
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // Insert 3 columns after column C
   * fWorksheet.insertColumnsAfter(2, 3);
   * // Insert 1 column after column A
   * fWorksheet.insertColumnsAfter(0, 1);
   * ```
   */
  insertColumnsAfter(e, t3) {
    const s2 = this._workbook.getUnitId(), r = this._worksheet.getSheetId(), i = wm.RIGHT, o3 = 0, a4 = this._worksheet.getRowCount() - 1, h9 = e + 1, c2 = e + t3, d2 = Ct2(this._worksheet, o3, a4, h9, c2, false, e);
    return this._commandService.syncExecuteCommand($r2.id, {
      unitId: s2,
      subUnitId: r,
      direction: i,
      range: {
        startRow: o3,
        endRow: a4,
        startColumn: h9,
        endColumn: c2
      },
      cellValue: d2
    }), this;
  }
  /**
   * Inserts a number of columns before the given column position.
   * @param {number} beforePosition - The column before which the new columns should be added, starting at 0 for the first column
   * @param {number} howMany - The number of columns to insert
   * @returns {FWorksheet} This sheet, for chaining
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // Insert 3 columns before column C
   * fWorksheet.insertColumnsBefore(2, 3);
   * // Insert 1 column before column A
   * fWorksheet.insertColumnsBefore(0, 1);
   * ```
   */
  insertColumnsBefore(e, t3) {
    const s2 = this._workbook.getUnitId(), r = this._worksheet.getSheetId(), i = wm.LEFT, o3 = 0, a4 = this._worksheet.getRowCount() - 1, h9 = e, c2 = e + t3 - 1, d2 = Ct2(this._worksheet, o3, a4, h9, c2, false, e - 1);
    return this._commandService.syncExecuteCommand($r2.id, {
      unitId: s2,
      subUnitId: r,
      direction: i,
      range: {
        startRow: o3,
        endRow: a4,
        startColumn: h9,
        endColumn: c2
      },
      cellValue: d2
    }), this;
  }
  /**
   * Deletes the column at the given column position.
   * @param {number} columnPosition - The position of the column, starting at 0 for the first column
   * @returns {FWorksheet} This sheet, for chaining
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // Delete column C
   * fWorksheet.deleteColumn(2);
   * // Delete column A
   * fWorksheet.deleteColumn(0);
   * ```
   */
  deleteColumn(e) {
    return this.deleteColumns(e, 1);
  }
  /**
   * Deletes a number of columns starting at the given column position.
   * @param {number} columnPosition - The position of the first column to delete, starting at 0 for the first column
   * @param {number} howMany - The number of columns to delete
   * @returns {FWorksheet} This sheet, for chaining
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // Delete 3 columns at column index 2 (columns C, D, E)
   * fWorksheet.deleteColumns(2, 3);
   * // Delete 1 column at column index 0 (column A)
   * fWorksheet.deleteColumns(0, 1);
   * ```
   */
  deleteColumns(e, t3) {
    const s2 = {
      startRow: 0,
      endRow: this._worksheet.getRowCount() - 1,
      startColumn: e,
      endColumn: e + t3 - 1
    };
    return this._commandService.syncExecuteCommand(Vr2.id, {
      range: s2,
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId()
    }), this;
  }
  /**
   * Moves the columns selected by the given range to the position indicated by the destinationIndex. The columnSpec itself does not have to exactly represent an entire column or group of columns to moveâ€”it selects all columns that the range spans.
   * @param {FRange} columnSpec - A range spanning the columns that should be moved
   * @param {number} destinationIndex - The index that the columns should be moved to. Note that this index is based on the coordinates before the columns are moved. Existing data is shifted right to make room for the moved columns while the source columns are removed from the grid. Therefore, the data may end up at a different index than originally specified. Use 0-index for this method
   * @returns {FWorksheet} This sheet, for chaining
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // Move columns C, D, E to column index 2 (columns B, C, D)
   * const columnSpec1 = fWorksheet.getRange('C:E');
   * fWorksheet.moveColumns(columnSpec1, 1);
   * // Move column F to column index 0 (column A)
   * const columnSpec2 = fWorksheet.getRange('F:F');
   * fWorksheet.moveColumns(columnSpec2, 0);
   * ```
   */
  moveColumns(e, t3) {
    const s2 = this._workbook.getUnitId(), r = this._worksheet.getSheetId(), i = Re4(e.getRange(), this._worksheet), o3 = i, a4 = {
      startRow: 0,
      endRow: this._worksheet.getRowCount() - 1,
      startColumn: t3,
      endColumn: t3
    };
    return this._commandService.syncExecuteCommand(un.id, {
      unitId: s2,
      subUnitId: r,
      range: i,
      fromRange: o3,
      toRange: a4
    }), this;
  }
  /**
   * Hides the column or columns in the given range.
   * @param {FRange} column - The column range to hide
   * @returns {FWorksheet} This sheet, for chaining
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // Hide columns C, D, E
   * const column1 = fWorksheet.getRange('C:E');
   * fWorksheet.hideColumn(column1);
   * // Hide column A
   * const column2 = fWorksheet.getRange('A:A');
   * fWorksheet.hideColumn(column2);
   * ```
   */
  hideColumn(e) {
    const t3 = this._workbook.getUnitId(), s2 = this._worksheet.getSheetId(), r = Re4(e.getRange(), this._worksheet);
    return this._commandService.syncExecuteCommand(Us.id, {
      unitId: t3,
      subUnitId: s2,
      ranges: [r]
    }), this;
  }
  /**
   * Hides one or more consecutive columns starting at the given index. Use 0-index for this method
   * @param {number} columnIndex - The starting index of the columns to hide
   * @param {number} numColumn - The number of columns to hide
   * @returns {FWorksheet} This sheet, for chaining
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // Hide columns C, D, E
   * fWorksheet.hideColumns(2, 3);
   * // Hide column A
   * fWorksheet.hideColumns(0, 1);
   * ```
   */
  hideColumns(e, t3 = 1) {
    const s2 = this._workbook.getUnitId(), r = this._worksheet.getSheetId(), i = {
      startRow: 0,
      endRow: this._worksheet.getRowCount() - 1,
      startColumn: e,
      endColumn: e + t3 - 1,
      rangeType: ge.COLUMN
    };
    return this._commandService.syncExecuteCommand(Us.id, {
      unitId: s2,
      subUnitId: r,
      ranges: [i]
    }), this;
  }
  /**
   * Show the column in the given range.
   * @param {FRange} column - The range to unhide, if hidden
   * @returns {FWorksheet} This sheet, for chaining
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // Unhide columns C, D, E
   * const column1 = fWorksheet.getRange('C:E');
   * fWorksheet.unhideColumn(column1);
   * // Unhide column A
   * const column2 = fWorksheet.getRange('A:A');
   * fWorksheet.unhideColumn(column2);
   * ```
   */
  unhideColumn(e) {
    const t3 = this._workbook.getUnitId(), s2 = this._worksheet.getSheetId(), r = Re4(e.getRange(), this._worksheet);
    return this._commandService.syncExecuteCommand(dn.id, {
      unitId: t3,
      subUnitId: s2,
      ranges: [r]
    }), this;
  }
  /**
   * Show one or more consecutive columns starting at the given index. Use 0-index for this method
   * @param {number} columnIndex - The starting index of the columns to unhide
   * @param {number} numColumns - The number of columns to unhide
   * @returns {FWorksheet} This sheet, for chaining
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // Unhide columns C, D, E
   * fWorksheet.showColumns(2, 3);
   * // Unhide column A
   * fWorksheet.showColumns(0, 1);
   * ```
   */
  showColumns(e, t3 = 1) {
    const s2 = this._workbook.getUnitId(), r = this._worksheet.getSheetId(), i = {
      startRow: 0,
      endRow: this._worksheet.getRowCount() - 1,
      startColumn: e,
      endColumn: e + t3 - 1,
      rangeType: ge.COLUMN
    };
    return this._commandService.syncExecuteCommand(dn.id, {
      unitId: s2,
      subUnitId: r,
      ranges: [i]
    }), this;
  }
  /**
   * Sets the width of the given column in pixels.
   * @param {number} columnPosition - The position of the given column to set
   * @param {number} width - The width in pixels to set it to
   * @returns {FWorksheet} This sheet, for chaining
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // Set width of column B to 100 pixels
   * fWorksheet.setColumnWidth(1, 100);
   * ```
   */
  setColumnWidth(e, t3) {
    return this.setColumnWidths(e, 1, t3);
  }
  /**
   * Sets the width of the given columns in pixels.
   * @param {number} startColumn - The starting column position to change
   * @param {number} numColumn - The number of columns to change
   * @param {number} width - The width in pixels to set it to
   * @returns {FWorksheet} This sheet, for chaining
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // Set width of columns B-D (index 1-3) to 100 pixels
   * fWorksheet.setColumnWidths(1, 3, 100);
   * ```
   */
  setColumnWidths(e, t3, s2) {
    const r = this._workbook.getUnitId(), i = this._worksheet.getSheetId(), o3 = [
      {
        startColumn: e,
        endColumn: e + t3 - 1,
        startRow: 0,
        endRow: this._worksheet.getRowCount() - 1
      }
    ];
    return this._commandService.syncExecuteCommand(Bn4.id, {
      unitId: r,
      subUnitId: i,
      ranges: o3,
      value: s2
    }), this;
  }
  /**
   * Gets the width in pixels of the given column.
   * @param {number} columnPosition - The position of the column to examine. index starts at 0.
   * @returns {number} The width of the column in pixels
   * @example
   * ```typescript
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   *
   * // Set the long text value in cell A1
   * const fRange = fWorksheet.getRange('A1');
   * fRange.setValue('Whenever it is a damp, drizzly November in my soul...');
   *
   * // Set the column A to a width which fits the text
   * fWorksheet.autoResizeColumn(0);
   *
   * // Get the width of the column A
   * console.log(fWorksheet.getColumnWidth(0));
   * ```
   */
  getColumnWidth(e) {
    return this._worksheet.getColumnWidth(e);
  }
  // #endregion
  /**
   * Set custom properties for given columns.
   * @param {IObjectArrayPrimitiveType<CustomData>} custom - The custom properties to set
   * @returns {FWorksheet} This worksheet instance for chaining
   * @example
   * ```ts
   * const fWorkSheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * fWorkSheet.setColumnCustom({ 0: { key: 'value' } });
   * ```
   */
  setColumnCustom(e) {
    const t3 = this._workbook.getUnitId(), s2 = this._worksheet.getSheetId(), r = {};
    for (const [o3, a4] of Object.entries(e))
      r[Number(o3)] = {
        custom: a4
      };
    const i = {
      unitId: t3,
      subUnitId: s2,
      columnData: r
    };
    return this._commandService.syncExecuteCommand(Oc.id, i), this;
  }
  // #region merge cells
  /**
   * Get all merged cells in the current worksheet
   * @returns {FRange[]} All the merged cells in the worksheet
   * @example
   * ```ts
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // Get all merged ranges in the sheet
   * const mergedData = fWorksheet.getMergeData();
   * // Process each merged range
   * mergedData.forEach(range => {
   *   console.log(range.getA1Notation());
   * });
   * ```
   */
  getMergeData() {
    return this._worksheet.getMergeData().map((e) => this._injector.createInstance(f3, this._workbook, this._worksheet, e));
  }
  /**
   * Get all merged cells in the current sheet
   * @returns {FRange[]} all merged cells
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // Get all merged ranges in the sheet
   * const mergedRanges = fWorksheet.getMergedRanges();
   * // Process each merged range
   * mergedRanges.forEach(range => {
   *   console.log(range.getA1Notation());
   * });
   * ```
   */
  getMergedRanges() {
    return this._worksheet.getSnapshot().mergeData.map((t3) => this._injector.createInstance(f3, this._workbook, this._worksheet, t3));
  }
  /**
   * Get the merged cell data of the specified row and column.
   * @param {number} row - The row index
   * @param {number} column - The column index
   * @returns {FRange|undefined} The merged cell data, or undefined if the cell is not merged
   * @example
   * ```ts
   * const fWorkSheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * const merge = fWorkSheet.getCellMergeData(0, 0);
   * if (merge) {
   *   console.log('Merged range:', merge.getA1Notation());
   * }
   * ```
   */
  getCellMergeData(e, t3) {
    const r = this._worksheet.getMergedCell(e, t3);
    if (r)
      return this._injector.createInstance(f3, this._workbook, this._worksheet, r);
  }
  // #endregion
  /**
   * Returns the selected range in the active sheet, or null if there is no active range.
   * @returns {FRange | null} the active range
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // Get the currently active range
   * const activeRange = fWorksheet.getActiveRange();
   * if (activeRange) {
   *   console.log('Active range:', activeRange.getA1Notation());
   * }
   * ```
   */
  getActiveRange() {
    return this._fWorkbook.getActiveRange();
  }
  /**
   * Sets the active selection region for this sheet.
   * @param {FRange} range - The range to set as the active selection
   * @returns {FWorksheet} This sheet, for chaining
   * @example
   * ```ts
   * const fWorkSheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * fWorkSheet.setActiveRange(fWorkSheet.getRange('A10:B10'));
   * ```
   */
  setActiveRange(e) {
    const { unitId: t3, sheetId: s2 } = e.getRange();
    if (t3 !== this._workbook.getUnitId() || s2 !== this._worksheet.getSheetId())
      throw new Error("Specified range must be part of the sheet.");
    return this._fWorkbook.setActiveRange(e), this;
  }
  /**
   * Returns the active cell in this sheet.
   * @returns {FRange | null} The active cell
   * @example
   * ```typescript
   * const fWorkSheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * console.log(fWorkSheet.getActiveCell().getA1Notation());
   * ```
   */
  getActiveCell() {
    return this._fWorkbook.getActiveCell();
  }
  /**
   * Sets the frozen state of the current sheet.
   * @param {IFreeze} freeze - the scrolling viewport start range and count of freezed rows and columns.
   * that means if you want to freeze the first 3 rows and 2 columns, you should set freeze as { startRow: 3, startColumn: 2, xSplit: 2, ySplit: 3 }
   * @deprecated use `setFrozenRows` and `setFrozenColumns` instead.
   * @returns {FWorksheet} This worksheet instance for chaining
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // Freeze first 3 rows and 2 columns
   * fWorksheet.setFreeze({
   *   startRow: 3,
   *   startColumn: 2,
   *   xSplit: 2,
   *   ySplit: 3
   * });
   * ```
   */
  setFreeze(e) {
    return this._logService.warn("setFreeze is deprecated, use setFrozenRows and setFrozenColumns instead"), this._commandService.syncExecuteCommand(xc.id, __spreadProps(__spreadValues({}, e), {
      unitId: this._workbook.getUnitId(),
      subUnitId: this.getSheetId()
    })), this;
  }
  /**
   * Cancels the frozen state of the current sheet.
   * @returns {FWorksheet} This worksheet instance for chaining
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // Cancel freeze
   * fWorksheet.cancelFreeze();
   * ```
   */
  cancelFreeze() {
    return this._commandService.syncExecuteCommand($c.id, {
      unitId: this._workbook.getUnitId(),
      subUnitId: this.getSheetId()
    }), this;
  }
  /**
   * Get the freeze state of the current sheet.
   * @returns {IFreeze} The freeze state of the current sheet
   * @example
   * ```typescript
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // Get the freeze state of the current sheet
   * const freeze = fWorksheet.getFreeze();
   * console.log(freeze);
   * ```
   */
  getFreeze() {
    return this._worksheet.getFreeze();
  }
  setFrozenColumns(...e) {
    const t3 = this.getFreeze();
    if (arguments.length === 1) {
      const s2 = e[0];
      this.setFreeze(__spreadProps(__spreadValues({}, t3), {
        startColumn: s2 > 0 ? s2 : -1,
        xSplit: s2
      }));
    } else if (arguments.length === 2) {
      let [s2 = 0, r = 0] = e;
      s2 > r && ([s2, r] = [r, s2]), this._commandService.syncExecuteCommand(xc.id, {
        startColumn: r + 1,
        xSplit: r - s2 + 1,
        startRow: t3.startRow,
        ySplit: t3.ySplit,
        unitId: this._workbook.getUnitId(),
        subUnitId: this.getSheetId()
      });
    }
    return this;
  }
  setFrozenRows(...e) {
    const t3 = this.getFreeze();
    if (arguments.length === 1) {
      const s2 = e[0];
      this.setFreeze(__spreadProps(__spreadValues({}, t3), {
        startRow: s2 > 0 ? s2 : -1,
        ySplit: s2
      }));
    } else if (arguments.length === 2) {
      let [s2 = 0, r = 0] = e;
      s2 > r && ([s2, r] = [r, s2]), this._commandService.syncExecuteCommand(xc.id, {
        startRow: r + 1,
        ySplit: r - s2 + 1,
        startColumn: t3.startColumn,
        xSplit: t3.xSplit,
        unitId: this._workbook.getUnitId(),
        subUnitId: this.getSheetId()
      });
    }
    return this;
  }
  /**
   * Get the number of frozen columns.
   * @returns {number} The number of frozen columns, returns 0 if no columns are frozen.
   * @example
   * ```typescript
   * const fWorkSheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // Get the number of frozen columns
   * const frozenColumns = fWorkSheet.getFrozenColumns();
   * console.log(frozenColumns);
   * ```
   */
  getFrozenColumns() {
    const e = this.getFreeze();
    return e.startColumn === -1 ? 0 : e.startColumn;
  }
  /**
   * Get the number of frozen rows.
   * @returns {number} The number of frozen rows. returns 0 if no rows are frozen.
   * @example
   * ```typescript
   * const fWorkSheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // Get the number of frozen rows
   * const frozenRows = fWorkSheet.getFrozenRows();
   * console.log(frozenRows);
   * ```
   */
  getFrozenRows() {
    const e = this.getFreeze();
    return e.startRow === -1 ? 0 : e.startRow;
  }
  /**
   * Get freezed rows.
   * @returns {IRowRange} The range of the frozen rows.
   * @example
   * ```ts
   * const fWorkSheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // Get the range of the frozen rows
   * const frozenRows = fWorkSheet.getFrozenRowRange();
   * console.log(frozenRows);
   * ```
   */
  getFrozenRowRange() {
    const e = this._worksheet.getFreeze();
    return {
      startRow: e.startRow - e.ySplit,
      endRow: e.startRow - 1
    };
  }
  /**
   * Get freezed columns
   * @returns {IColumnRange} The range of the frozen columns.
   * @example
   * ```ts
   * const fWorkSheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // Get the range of the frozen columns
   * const frozenColumns = fWorkSheet.getFrozenColumnRange();
   * console.log(frozenColumns);
   * ```
   */
  getFrozenColumnRange() {
    const e = this._worksheet.getFreeze();
    return {
      startColumn: e.startColumn - e.xSplit,
      endColumn: e.startColumn - 1
    };
  }
  /**
   * Returns true if the sheet's gridlines are hidden; otherwise returns false. Gridlines are visible by default.
   * @returns {boolean} True if the sheet's gridlines are hidden; otherwise false.
   * @example
   * ```ts
   * const fWorkSheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // check if the gridlines are hidden
   * if (fWorkSheet.hasHiddenGridLines()) {
   *    console.log('Gridlines are hidden');
   * }
   * ```
   */
  hasHiddenGridLines() {
    return this._worksheet.getConfig().showGridlines === ie.FALSE;
  }
  /**
   * Hides or reveals the sheet gridlines.
   * @param {boolean} hidden - If `true`, hide gridlines in this sheet; otherwise show the gridlines.
   * @returns {FWorksheet} Returns the current worksheet instance for method chaining
   * @example
   * ``` ts
   * const fWorkSheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // hide the gridlines
   * fWorkSheet.setHiddenGridlines(true);
   * ```
   */
  setHiddenGridlines(e) {
    return this._commandService.syncExecuteCommand(Cd.id, {
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId(),
      showGridlines: e ? ie.FALSE : ie.TRUE
    }), this;
  }
  /**
   * Set the color of the gridlines in the sheet.
   * @param {string|undefined} color - The color to set for the gridlines.Undefined or null to reset to the default color.
   * @returns {FWorksheet} Returns the current worksheet instance for method chaining
   * @example
   * ```ts
   * const fWorkSheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * // set the gridlines color to red
   * fWorkSheet.setGridLinesColor('#ff0000');
   * ```
   */
  setGridLinesColor(e) {
    return this._commandService.syncExecuteCommand(Wc.id, {
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId(),
      color: e
    }), this;
  }
  /**
   * Get the color of the gridlines in the sheet.
   * @returns {string | undefined} The color of the gridlines in the sheet or undefined. The default color is 'rgb(214, 216, 219)'.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorkSheet = fWorkbook.getActiveSheet();
   * // get the gridlines color of the sheet
   * console.log(fWorkSheet.getGridLinesColor());
   * ```
   */
  getGridLinesColor() {
    return this._worksheet.getGridlinesColor();
  }
  /**
   * Sets the sheet tab color.
   * @param {string|null|undefined} color - A color code in CSS notation (like '#ffffff' or 'white'), or null to reset the tab color.
   * @returns {FWorksheet} Returns the current worksheet instance for method chaining
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorkSheet = fWorkbook.getActiveSheet();
   * // set the tab color to red
   * fWorkSheet.setTabColor('#ff0000');
   * ```
   */
  setTabColor(e) {
    return this._commandService.syncExecuteCommand(Qc.id, {
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId(),
      value: e
    }), this;
  }
  /**
   * Get the tab color of the sheet.
   * @returns {string} The tab color of the sheet or undefined.
   * The default color is css style property 'unset'.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorkSheet = fWorkbook.getActiveSheet();
   * // get the tab color of the sheet
   * console.log(fWorkSheet.getTabColor());
   * ```
   */
  getTabColor() {
    return this._worksheet.getTabColor();
  }
  /**
   * @deprecated use `univerAPI.addEvent(univerAPI.Event.SheetValueChanged, (params) => {})` instead
   */
  onCellDataChange(e) {
    return this._injector.get(Ds).onCommandExecuted((s2) => {
      if (s2.id === ee2.id) {
        const r = s2.params;
        r.unitId === this._workbook.getUnitId() && r.subUnitId === this._worksheet.getSheetId() && r.cellValue && e(new ht(r.cellValue));
      }
    });
  }
  /**
   * @deprecated use `univerAPI.addEvent(univerAPI.Event.BeforeSheetEditEnd, (params) => {})` instead
   */
  onBeforeCellDataChange(e) {
    return this._injector.get(Ds).beforeCommandExecuted((s2) => {
      if (s2.id === ee2.id) {
        const r = s2.params;
        r.unitId === this._workbook.getUnitId() && r.subUnitId === this._worksheet.getSheetId() && r.cellValue && e(new ht(r.cellValue));
      }
    });
  }
  /**
   * Hides this sheet. Has no effect if the sheet is already hidden. If this method is called on the only visible sheet, it throws an exception.
   * @returns {FWorksheet} Returns the current worksheet instance for method chaining
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorkSheet = fWorkbook.getActiveSheet();
   * // hide the active sheet
   * fWorkSheet.hideSheet();
   * ```
   */
  hideSheet() {
    const e = this._injector.get(Ds);
    if (this._workbook.getSheets().filter((i) => i.isSheetHidden() !== ie.TRUE).length <= 1)
      throw new Error("Cannot hide the only visible sheet");
    return e.syncExecuteCommand(sd2.id, {
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId()
    }), this;
  }
  /**
   * Shows this sheet. Has no effect if the sheet is already visible.
   * @returns {FWorksheet} Returns the current worksheet instance for method chaining
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorkSheets = fWorkbook.getSheets();
   * // show the last sheet
   * fWorkSheets[fWorkSheets.length - 1].showSheet();
   * ```
   */
  showSheet() {
    return this._injector.get(Ds).syncExecuteCommand(gi.id, {
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId()
    }), this;
  }
  /**
   * Returns true if the sheet is currently hidden.
   * @returns {boolean} True if the sheet is hidden; otherwise, false.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorkSheets = fWorkbook.getSheets();
   * // check if the last sheet is hidden
   * console.log(fWorkSheets[fWorkSheets.length - 1].isSheetHidden());
   * ```
   */
  isSheetHidden() {
    return this._worksheet.isSheetHidden() === ie.TRUE;
  }
  /**
   * Sets the sheet name.
   * @param {string} name - The new name for the sheet.
   * @returns {FWorksheet} Returns the current worksheet instance for method chaining
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorkSheet = fWorkbook.getActiveSheet();
   * // set the sheet name to 'Sheet1'
   * fWorkSheet.setName('NewSheet1');
   * ```
   */
  setName(e) {
    return this._commandService.syncExecuteCommand(eo2.id, {
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId(),
      name: e
    }), this;
  }
  /**
   * Activates this sheet. Does not alter the sheet itself, only the parent's notion of the active sheet.
   * @returns {FWorksheet} Current sheet, for chaining.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorkSheets = fWorkbook.getSheets();
   * // activate the last sheet
   * fWorkSheets[fWorkSheets.length - 1].activate();
   * ```
   */
  activate() {
    return this._fWorkbook.setActiveSheet(this), this;
  }
  /**
   * Gets the position of the sheet in its parent spreadsheet. Starts at 0.
   * @returns {number} The position of the sheet in its parent spreadsheet.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorkSheet = fWorkbook.getActiveSheet();
   * // get the position of the active sheet
   * const position = fWorkSheet.getIndex();
   * console.log(position);
   * ```
   */
  getIndex() {
    return this._workbook.getSheetIndex(this._worksheet);
  }
  /**
   * Clears the sheet of content and formatting information.Or Optionally clears only the contents or only the formatting.
   * @param {IFacadeClearOptions} [options] - Options for clearing the sheet. If not provided, the contents and formatting are cleared both.
   * @param {boolean} [options.contentsOnly] - If true, the contents of the sheet are cleared. If false, the contents and formatting are cleared. Default is false.
   * @param {boolean} [options.formatOnly] - If true, the formatting of the sheet is cleared. If false, the contents and formatting are cleared. Default is false.
   * @returns {FWorksheet} Returns the current worksheet instance for method chaining
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorkSheet = fWorkbook.getActiveSheet();
   * // clear the sheet of content and formatting information
   * fWorkSheet.clear();
   * // clear the sheet of content only
   * fWorkSheet.clear({ contentsOnly: true });
   * ```
   */
  clear(e) {
    if (e && e.contentsOnly && !e.formatOnly)
      return this.clearContents();
    if (e && e.formatOnly && !e.contentsOnly)
      return this.clearFormats();
    const t3 = this._workbook.getUnitId(), s2 = this._worksheet.getSheetId(), r = this._injector.get(Ds), i = {
      startRow: 0,
      endRow: this._worksheet.getRowCount() - 1,
      startColumn: 0,
      endColumn: this._worksheet.getColumnCount() - 1
    };
    return r.syncExecuteCommand(Ls2.id, {
      unitId: t3,
      subUnitId: s2,
      ranges: [i],
      options: e
    }), this;
  }
  /**
   * Clears the sheet of contents, while preserving formatting information.
   * @returns {FWorksheet} Returns the current worksheet instance for method chaining
   * @example
   * ```typescript
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorkSheet = fWorkbook.getActiveSheet();
   * // clear the sheet of content only
   * fWorkSheet.clearContents();
   * ```
   */
  clearContents() {
    const e = this._workbook.getUnitId(), t3 = this._worksheet.getSheetId(), s2 = this._injector.get(Ds), r = {
      startRow: 0,
      endRow: this._worksheet.getRowCount() - 1,
      startColumn: 0,
      endColumn: this._worksheet.getColumnCount() - 1
    };
    return s2.syncExecuteCommand(Ys.id, {
      unitId: e,
      subUnitId: t3,
      ranges: [r]
    }), this;
  }
  /**
   * Clears the sheet of formatting, while preserving contents.
   * @returns {FWorksheet} Returns the current worksheet instance for method chaining
   * @example
   * ```typescript
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorkSheet = fWorkbook.getActiveSheet();
   * // clear the sheet of formatting only
   * fWorkSheet.clearFormats();
   * ```
   */
  clearFormats() {
    const e = this._workbook.getUnitId(), t3 = this._worksheet.getSheetId(), s2 = this._injector.get(Ds), r = {
      startRow: 0,
      endRow: this._worksheet.getRowCount() - 1,
      startColumn: 0,
      endColumn: this._worksheet.getColumnCount() - 1
    };
    return s2.syncExecuteCommand(Hs2.id, {
      unitId: e,
      subUnitId: t3,
      ranges: [r]
    }), this;
  }
  /**
   * Returns a Range corresponding to the dimensions in which data is present.
   * This is functionally equivalent to creating a Range bounded by A1 and (Sheet.getLastColumn(), Sheet.getLastRow()).
   * @returns {FRange} The range of the data in the sheet.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorkSheet = fWorkbook.getActiveSheet();
   * // Assume the sheet is a empty sheet
   * const cellRange = fWorkSheet.getRange('J50');
   * cellRange.setValue('Hello World');
   * console.log(fWorkSheet.getDataRange().getA1Notation()); // A1:J50
   * ```
   */
  getDataRange() {
    const { startRow: e, endRow: t3, startColumn: s2, endColumn: r } = this._worksheet.getDataRealRange();
    return this.getRange(e, s2, t3 - e + 1, r - s2 + 1);
  }
  /**
   * @deprecated use `getLastColumn` instead.
   * Returns the column index of the last column that contains content.
   * @returns {number} the column index of the last column that contains content.
   */
  getLastColumns() {
    return this._worksheet.getLastColumnWithContent();
  }
  /**
   * Returns the column index of the last column that contains content.
   * @returns {number} the column index of the last column that contains content.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorkSheet = fWorkbook.getActiveSheet();
   * // Assume the sheet is a empty sheet
   * const cellRange = fWorkSheet.getRange('J50');
   * cellRange.setValue('Hello World');
   * console.log(fWorkSheet.getLastColumn()); // 9
   * ```
   */
  getLastColumn() {
    return this._worksheet.getLastColumnWithContent();
  }
  /**
   * @deprecated use `getLastRow` instead.
   * Returns the row index of the last row that contains content.
   * @returns {number} the row index of the last row that contains content.
   */
  getLastRows() {
    return this._worksheet.getLastRowWithContent();
  }
  /**
   * Returns the row index of the last row that contains content.
   * @returns {number} the row index of the last row that contains content.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorkSheet = fWorkbook.getActiveSheet();
   * // Assume the sheet is a empty sheet
   * const cellRange = fWorkSheet.getRange('J50');
   * cellRange.setValue('Hello World');
   * console.log(fWorkSheet.getLastRow()); // 49
   * ```
   */
  getLastRow() {
    return this._worksheet.getLastRowWithContent();
  }
  /**
   * Judge whether provided FWorksheet is equal to current.
   * @param {FWorksheet} other - the FWorksheet to compare with.
   * @returns {boolean} true if the FWorksheet is equal to the current FWorksheet, false otherwise.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const sheets = fWorkbook.getSheets();
   * const fWorkSheet = fWorkbook.getActiveSheet();
   * console.log(fWorkSheet.equalTo(sheets[0])); // true, if the active sheet is the first sheet.
   * ```
   */
  equalTo(e) {
    return e instanceof I5 ? this._worksheet.getSheetId() === e.getSheetId() && this._workbook.getUnitId() === e.getWorkbook().getUnitId() : false;
  }
  /**
   * Insert a defined name for worksheet.
   * @param {string} name - The name of the defined name to insert
   * @param {string} formulaOrRefString - The formula(=sum(A2:b10)) or reference(A1) string of the defined name to insert
   * @example
   * ```ts
   * // The code below inserts a defined name
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * fWorksheet.insertDefinedName('MyDefinedName', 'Sheet1!$A$1');
   * ```
   */
  insertDefinedName(e, t3) {
    const r = this._injector.createInstance(Se4).setName(e).setRef(t3).build();
    r.localSheetId = this.getSheetId(), this._fWorkbook.insertDefinedNameBuilder(r);
  }
  /**
   * Get all the defined names in the worksheet.
   * @returns {FDefinedName[]} All the defined names in the worksheet
   * @example
   * ```ts
   * // The code below gets all the defined names in the worksheet
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * const definedNames = fWorksheet.getDefinedNames();
   * console.log(definedNames, definedNames[0]?.getFormulaOrRefString());
   * ```
   */
  getDefinedNames() {
    return this._fWorkbook.getDefinedNames().filter((t3) => t3.getLocalSheetId() === this.getSheetId());
  }
  /**
   * Set custom metadata of worksheet
   * @param {CustomData | undefined} custom - custom metadata
   * @returns {FWorksheet} Current worksheet, for chaining.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorkSheet = fWorkbook.getActiveSheet();
   * fWorkSheet.setCustomMetadata({ key: 'value' });
   * ```
   */
  setCustomMetadata(e) {
    return this._worksheet.setCustomMetadata(e), this;
  }
  /**
   * Get custom metadata of worksheet
   * @returns {CustomData | undefined} custom metadata
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorkSheet = fWorkbook.getActiveSheet();
   * const custom = fWorkSheet.getCustomMetadata();
   * console.log(custom);
   * ```
   */
  getCustomMetadata() {
    return this._worksheet.getCustomMetadata();
  }
  /**
   * Set custom metadata of row
   * @param {number} index - row index
   * @param {CustomData | undefined} custom - custom metadata
   * @returns {FWorksheet} Current worksheet, for chaining.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorkSheet = fWorkbook.getActiveSheet();
   * fWorkSheet.setRowCustomMetadata(0, { key: 'value' });
   * ```
   */
  setRowCustomMetadata(e, t3) {
    return this._worksheet.getRowManager().setCustomMetadata(e, t3), this;
  }
  /**
   * Set custom metadata of column
   * @param {number} index - column index
   * @param {CustomData | undefined} custom - custom metadata
   * @returns {FWorksheet} Current worksheet, for chaining.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorkSheet = fWorkbook.getActiveSheet();
   * fWorkSheet.setColumnCustomMetadata(0, { key: 'value' });
   * ```
   */
  setColumnCustomMetadata(e, t3) {
    return this._worksheet.getColumnManager().setCustomMetadata(e, t3), this;
  }
  /**
   * Get custom metadata of row
   * @param {number} index - row index
   * @returns {CustomData | undefined} custom metadata
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorkSheet = fWorkbook.getActiveSheet();
   * const custom = fWorkSheet.getRowCustomMetadata(0);
   * console.log(custom);
   * ```
   */
  getRowCustomMetadata(e) {
    return this._worksheet.getRowManager().getCustomMetadata(e);
  }
  /**
   * Get custom metadata of column
   * @param {number} index - column index
   * @returns {CustomData | undefined} custom metadata
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorkSheet = fWorkbook.getActiveSheet();
   * const custom = fWorkSheet.getColumnCustomMetadata(0);
   * console.log(custom);
   * ```
   */
  getColumnCustomMetadata(e) {
    return this._worksheet.getColumnManager().getCustomMetadata(e);
  }
  /**
   * Appends a row to the bottom of the current data region in the sheet. If a cell's content begins with =, it's interpreted as a formula.
   * @param {CellValue[]} rowContents - An array of values for the new row.
   * @returns {FWorksheet} Returns the current worksheet instance for method chaining.
   * @example
   * ```ts
   * // Appends a new row with 4 columns to the bottom of the current
   * // data region in the sheet containing the values in the array.
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorkSheet = fWorkbook.getActiveSheet();
   * fWorkSheet.appendRow([1, 'Hello Univer', true, '=A1']);
   * ```
   */
  appendRow(e) {
    const t3 = this._worksheet.getCellMatrix().hasValue(), s2 = this._worksheet.getLastRowWithContent(), r = this._worksheet.getRowCount(), i = this._worksheet.getColumnCount(), o3 = t3 ? s2 + 1 : s2, a4 = new ht();
    for (let h9 = 0; h9 < e.length; h9++)
      a4.setValue(o3, h9, ja(e[h9]));
    return this._commandService.syncExecuteCommand(ac.id, {
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId(),
      cellValue: a4.getMatrix(),
      insertRowNums: o3 > r - 1 ? 1 : 0,
      insertColumnNums: e.length > i ? e.length - i : 0,
      maxRows: r,
      maxColumns: i
    }), this;
  }
  /**
   * Sets the number of rows in the worksheet.
   * @param {number} rowCount - The number of rows to set.
   * @returns {FWorksheet} Returns the current worksheet instance for method chaining.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorkSheet = fWorkbook.getActiveSheet();
   *
   * // Set the number of rows in the worksheet to 40
   * fWorkSheet.setRowCount(40);
   * ```
   */
  setRowCount(e) {
    return this._commandService.syncExecuteCommand(md.id, {
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId(),
      rowCount: e
    }), this;
  }
  /**
   * Sets the number of columns in the worksheet.
   * @param {number} columnCount - The number of columns to set.
   * @returns {FWorksheet} Returns the current worksheet instance for method chaining.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorkSheet = fWorkbook.getActiveSheet();
   *
   * // Set the number of columns in the worksheet to 10
   * fWorkSheet.setColumnCount(10);
   * ```
   */
  setColumnCount(e) {
    return this._commandService.syncExecuteCommand(td.id, {
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId(),
      columnCount: e
    }), this;
  }
  /**
   * Get the WorksheetPermission instance for managing worksheet-level permissions.
   * This is the new permission API that provides worksheet-specific permission control.
   * @returns {FWorksheetPermission} - The WorksheetPermission instance.
   * @example
   * ```ts
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * const permission = fWorksheet.getWorksheetPermission();
   *
   * // Set worksheet to read-only mode
   * await permission.setMode('readOnly');
   *
   * // Check if a specific cell can be edited
   * const canEdit = permission.canEditCell(0, 0);
   *
   * // Protect multiple ranges at once
   * const range1 = fWorksheet.getRange('A1:B10');
   * const range2 = fWorksheet.getRange('D1:E10');
   * await permission.protectRanges([
   *   { ranges: [range1], options: { name: 'Range 1', allowEdit: false } },
   *   { ranges: [range2], options: { name: 'Range 2', allowEdit: false } }
   * ]);
   *
   * // Subscribe to permission changes
   * permission.permission$.subscribe(snapshot => {
   *   console.log('Worksheet permissions changed:', snapshot);
   * });
   * ```
   */
  getWorksheetPermission() {
    return this._injector.createInstance(
      je3,
      this
    );
  }
};
I5 = $n4([
  he3(3, Inject(Injector)),
  he3(4, Inject(z)),
  he3(5, Inject(Nt)),
  he3(6, Ds)
], I5);
var zn6 = Object.getOwnPropertyDescriptor;
var Ln4 = (n3, e, t3, s2) => {
  for (var r = s2 > 1 ? void 0 : s2 ? zn6(e, t3) : e, i = n3.length - 1, o3; i >= 0; i--)
    (o3 = n3[i]) && (r = o3(r) || r);
  return r;
};
var Z7 = (n3, e) => (t3, s2) => e(t3, s2, n3);
var Oe3 = class {
  constructor(n3, e, t3, s2, r, i, o3, a4, h9) {
    g6(this, "_permissionSubject");
    g6(this, "_subscriptions", []);
    g6(this, "_fPermission");
    g6(this, "permission$");
    g6(this, "protectionChange$");
    this._unitId = n3, this._subUnitId = e, this._range = t3, this._worksheet = s2, this._injector = r, this._permissionService = i, this._authzIoService = o3, this._commandService = a4, this._rangeProtectionRuleModel = h9, this._fPermission = this._injector.createInstance(H3), this._permissionSubject = new BehaviorSubject(this._buildSnapshot()), this.permission$ = this._createPermissionStream(), this.protectionChange$ = this._createProtectionChangeStream();
  }
  /**
   * Create permission snapshot stream from IPermissionService
   * @private
   */
  _createPermissionStream() {
    const n3 = this._permissionService.permissionPointUpdate$.pipe(
      filter((e) => {
        const t3 = e.id;
        return t3.includes(this._unitId) && t3.includes(this._subUnitId);
      })
    ).subscribe(() => {
      this._permissionSubject.next(this._buildSnapshot());
    });
    return this._subscriptions.push(n3), this._permissionSubject.asObservable().pipe(
      distinctUntilChanged((e, t3) => JSON.stringify(e) === JSON.stringify(t3)),
      shareReplay({ bufferSize: 1, refCount: true })
    );
  }
  /**
   * Create protection change stream from RangeProtectionRuleModel
   * @private
   */
  _createProtectionChangeStream() {
    return this._rangeProtectionRuleModel.ruleChange$.pipe(
      filter((n3) => n3.unitId !== this._unitId || n3.subUnitId !== this._subUnitId ? false : n3.type === "delete" ? this._rangeMatches(n3.rule) : n3.type === "add" ? this._rangeMatches(n3.rule) : false),
      map((n3) => (this._permissionSubject.next(this._buildSnapshot()), n3.type === "delete" ? {
        type: "unprotected",
        ruleId: n3.rule.id
      } : {
        type: "protected",
        rule: this._createFacadeRule(n3.rule)
      })),
      shareReplay({ bufferSize: 1, refCount: true })
    );
  }
  /**
   * Check if a protection rule matches this range
   */
  _rangeMatches(n3) {
    const e = this._range.getRange();
    return n3.ranges.some(
      (t3) => e.startRow === t3.startRow && e.startColumn === t3.startColumn && e.endRow === t3.endRow && e.endColumn === t3.endColumn
    );
  }
  /**
   * Create a Facade rule from internal rule
   */
  _createFacadeRule(n3) {
    const e = n3.ranges.map(
      (s2) => this._worksheet.getRange(
        s2.startRow,
        s2.startColumn,
        s2.endRow - s2.startRow + 1,
        s2.endColumn - s2.startColumn + 1
      )
    ), t3 = {
      name: n3.description || "",
      allowViewByOthers: n3.viewState !== Au.NoOneElseCanView,
      allowEdit: n3.editState === xu.DesignedUserCanEdit
    };
    return this._injector.createInstance(
      j5,
      this._unitId,
      this._subUnitId,
      n3.id,
      n3.permissionId,
      e,
      t3
    );
  }
  /**
   * Get the value of a specific permission point.
   * @param {RangePermissionPoint} point The permission point to query.
   * @returns {boolean} true if allowed, false if denied.
   * @example
   * ```ts
   * const range = univerAPI.getActiveWorkbook()?.getActiveSheet()?.getRange('A1:B2');
   * const permission = range?.getRangePermission();
   * const canEdit = permission?.getPoint(univerAPI.Enum.RangePermissionPoint.Edit);
   * console.log(canEdit);
   * ```
   */
  getPoint(n3) {
    const e = X7[n3];
    if (!e)
      return console.warn(`Unknown permission point: ${n3}`), false;
    const t3 = this._getProtectionRule();
    if (t3) {
      const s2 = new e(this._unitId, this._subUnitId, t3.permissionId), r = this._permissionService.getPermissionPoint(s2.id);
      if (r)
        return r.value;
    }
    return true;
  }
  /**
   * Get the current permission snapshot.
   * @returns {RangePermissionSnapshot} Snapshot of all permission points.
   * @example
   * ```ts
   * const range = univerAPI.getActiveWorkbook()?.getActiveSheet()?.getRange('A1:B2');
   * const permission = range?.getRangePermission();
   * const snapshot = permission?.getSnapshot();
   * console.log(snapshot);
   * ```
   */
  getSnapshot() {
    return this._buildSnapshot();
  }
  /**
   * Check if the current range is protected.
   * @returns {boolean} true if protected, false otherwise.
   * @example
   * ```ts
   * const range = univerAPI.getActiveWorkbook()?.getActiveSheet()?.getRange('A1:B2');
   * const permission = range?.getRangePermission();
   * const isProtected = permission?.isProtected();
   * console.log(isProtected);
   * ```
   */
  isProtected() {
    return this._getProtectionRule() !== null;
  }
  /**
   * Check if the current user can edit this range.
   * @returns {boolean} true if editable, false otherwise.
   * @example
   * ```ts
   * const range = univerAPI.getActiveWorkbook()?.getActiveSheet()?.getRange('A1:B2');
   * const permission = range?.getRangePermission();
   * if (permission?.canEdit()) {
   *   console.log('You can edit this range');
   * }
   * ```
   */
  canEdit() {
    return this.getPoint(k5.Edit);
  }
  /**
   * Check if the current user can view this range.
   * @returns {boolean} true if viewable, false otherwise.
   * @example
   * ```ts
   * const range = univerAPI.getActiveWorkbook()?.getActiveSheet()?.getRange('A1:B2');
   * const permission = range?.getRangePermission();
   * if (permission?.canView()) {
   *   console.log('You can view this range');
   * }
   * ```
   */
  canView() {
    return this.getPoint(k5.View);
  }
  /**
   * Check if the current user can manage collaborators for this range.
   * @returns {boolean} true if can manage collaborators, false otherwise.
   * @example
   * ```ts
   * const range = univerAPI.getActiveWorkbook()?.getActiveSheet()?.getRange('A1:B2');
   * const permission = range?.getRangePermission();
   * if (permission?.canManageCollaborator()) {
   *   console.log('You can manage collaborators for this range');
   * }
   * ```
   */
  canManageCollaborator() {
    return this.getPoint(k5.ManageCollaborator);
  }
  /**
   * Check if the current user can delete this protection rule.
   * @returns {boolean} true if can delete rule, false otherwise.
   * @example
   * ```ts
   * const range = univerAPI.getActiveWorkbook()?.getActiveSheet()?.getRange('A1:B2');
   * const permission = range?.getRangePermission();
   * if (permission?.canDelete()) {
   *   console.log('You can delete this protection rule');
   * }
   * ```
   */
  canDelete() {
    return this.getPoint(k5.Delete);
  }
  /**
   * Set a specific permission point for the range (low-level API).
   *
   * **Important:** This method only updates the permission point value for an existing protection rule.
   * It does NOT create permission checks that will block actual editing operations.
   * You must call `protect()` first to create a protection rule before using this method.
   *
   * This method is useful for:
   * - Fine-tuning permissions after creating a protection rule with `protect()`
   * - Dynamically adjusting permissions based on runtime conditions
   * - Advanced permission management scenarios
   *
   * @param {RangePermissionPoint} point The permission point to set.
   * @param {boolean} value The value to set (true = allowed, false = denied).
   * @returns {Promise<void>} A promise that resolves when the point is set.
   * @throws {Error} If no protection rule exists for this range.
   *
   * @example
   * ```ts
   * const range = univerAPI.getActiveWorkbook()?.getActiveSheet()?.getRange('A1:B2');
   * const permission = range?.getRangePermission();
   *
   * // First, create a protection rule
   * await permission?.protect({ name: 'My Range', allowEdit: true });
   *
   * // Then you can dynamically update permission points
   * await permission?.setPoint(univerAPI.Enum.RangePermissionPoint.Edit, false); // Now disable edit
   * await permission?.setPoint(univerAPI.Enum.RangePermissionPoint.View, true);  // Ensure view is enabled
   * ```
   */
  setPoint(n3, e) {
    return __async(this, null, function* () {
      const t3 = X7[n3];
      if (!t3)
        throw new Error(`Unknown permission point: ${n3}`);
      const s2 = this._getProtectionRule();
      if (!s2)
        throw new Error("Cannot set permission point: No protection rule exists for this range. Call protect() first.");
      if (this.getPoint(n3) === e)
        return;
      const i = s2.permissionId;
      this._fPermission.setRangeProtectionPermissionPoint(this._unitId, this._subUnitId, i, t3, e), this._permissionSubject.next(this._buildSnapshot());
    });
  }
  /**
   * Protect the current range.
   * @param {IRangeProtectionOptions} options Protection options.
   * @returns {Promise<FRangeProtectionRule>} The created protection rule.
   * @example
   * ```ts
   * const range = univerAPI.getActiveWorkbook()?.getActiveSheet()?.getRange('A1:B2');
   * const permission = range?.getRangePermission();
   * const rule = await permission?.protect({
   *   name: 'My protected range',
   *   allowEdit: true,
   *   allowedUsers: ['user1', 'user2'],
   *   allowViewByOthers: false,
   * });
   * console.log(rule);
   * ```
   */
  protect(n3) {
    return __async(this, null, function* () {
      if (this.isProtected())
        throw new Error("Range is already protected");
      const e = yield this._fPermission.addRangeBaseProtection(
        this._unitId,
        this._subUnitId,
        [this._range],
        n3
      );
      if (!e)
        throw new Error("Failed to create range protection");
      const { permissionId: t3, ruleId: s2 } = e;
      return yield this._setPermissionPoints(t3, n3), this._injector.createInstance(
        j5,
        this._unitId,
        this._subUnitId,
        s2,
        t3,
        [this._range],
        n3 || {}
      );
    });
  }
  /**
   * Determine view state from options
   * @private
   */
  _determineViewState(n3) {
    return (n3 == null ? void 0 : n3.allowViewByOthers) === false ? Au.NoOneElseCanView : Au.OthersCanView;
  }
  /**
   * Determine edit state from options
   * @private
   */
  _determineEditState(n3) {
    var e;
    return (n3 == null ? void 0 : n3.allowEdit) === true && ((e = n3 == null ? void 0 : n3.allowedUsers) != null && e.length) ? xu.DesignedUserCanEdit : xu.OnlyMe;
  }
  /**
   * Set permission points based on options (for local runtime control)
   * @private
   */
  _setPermissionPoints(n3, e) {
    return __async(this, null, function* () {
      if (!e)
        return;
      const t3 = (s2, r) => s2 === void 0 ? r : typeof s2 == "boolean" ? s2 : true;
      yield this._setPermissionPoint(n3, k5.Edit, t3(e.allowEdit, false)), yield this._setPermissionPoint(n3, k5.View, t3(e.allowViewByOthers, true));
    });
  }
  /**
   * Set a single permission point
   * @private
   */
  _setPermissionPoint(n3, e, t3) {
    return __async(this, null, function* () {
      const s2 = X7[e];
      s2 && this._fPermission.setRangeProtectionPermissionPoint(this._unitId, this._subUnitId, n3, s2, t3);
    });
  }
  /**
   * Unprotect the current range.
   * @returns {Promise<void>} A promise that resolves when the range is unprotected.
   * @example
   * ```ts
   * const range = univerAPI.getActiveWorkbook()?.getActiveSheet()?.getRange('A1:B2');
   * const permission = range?.getRangePermission();
   * await permission?.unprotect();
   * ```
   */
  unprotect() {
    return __async(this, null, function* () {
      const n3 = this._getProtectionRule();
      if (!n3)
        return;
      const e = n3.id;
      this._fPermission.removeRangeProtection(this._unitId, this._subUnitId, [e]);
    });
  }
  /**
   * List all protection rules.
   * @returns {Promise<FRangeProtectionRule[]>} Array of protection rules.
   * @example
   * ```ts
   * const range = univerAPI.getActiveWorkbook()?.getActiveSheet()?.getRange('A1:B2');
   * const permission = range?.getRangePermission();
   * const rules = await permission?.listRules();
   * console.log(rules);
   * ```
   */
  listRules() {
    return __async(this, null, function* () {
      return yield this._buildProtectionRulesAsync();
    });
  }
  /**
   * Subscribe to permission changes (simplified interface).
   * @param {Function} listener Callback function to be called when permissions change.
   * @returns {Function} Unsubscribe function.
   * @example
   * ```ts
   * const range = univerAPI.getActiveWorkbook()?.getActiveSheet()?.getRange('A1:B2');
   * const permission = range?.getRangePermission();
   * const unsubscribe = permission?.subscribe((snapshot) => {
   *   console.log('Permission changed:', snapshot);
   * });
   * // Later, to stop listening:
   * unsubscribe?.();
   * ```
   */
  subscribe(n3) {
    const e = this.permission$.subscribe(n3);
    return () => e.unsubscribe();
  }
  /**
   * Get the protection rule for the current range
   */
  _getProtectionRule() {
    const n3 = this._rangeProtectionRuleModel.getSubunitRuleList(this._unitId, this._subUnitId), e = this._range.getRange();
    for (const t3 of n3)
      for (const s2 of t3.ranges)
        if (e.startRow === s2.startRow && e.startColumn === s2.startColumn && e.endRow === s2.endRow && e.endColumn === s2.endColumn)
          return t3;
    return null;
  }
  /**
   * Build Facade objects for all protection rules
   */
  _buildProtectionRules() {
    return this._rangeProtectionRuleModel.getSubunitRuleList(this._unitId, this._subUnitId).map((e) => {
      const t3 = e.ranges.map(
        (r) => this._worksheet.getRange(
          r.startRow,
          r.startColumn,
          r.endRow - r.startRow + 1,
          r.endColumn - r.startColumn + 1
        )
      ), s2 = {
        name: e.description || "",
        allowViewByOthers: e.viewState !== Au.NoOneElseCanView
      };
      return e.editState === xu.DesignedUserCanEdit ? s2.allowEdit = true : s2.allowEdit = false, this._injector.createInstance(
        j5,
        this._unitId,
        this._subUnitId,
        e.id,
        e.permissionId,
        t3,
        s2
      );
    });
  }
  /**
   * Build Facade objects for all protection rules (async version with collaborator data)
   * @private
   */
  _buildProtectionRulesAsync() {
    return __async(this, null, function* () {
      const n3 = this._rangeProtectionRuleModel.getSubunitRuleList(this._unitId, this._subUnitId);
      return (yield Promise.all(
        n3.map((t3) => __async(this, null, function* () {
          const s2 = t3.ranges.map(
            (i) => this._worksheet.getRange(
              i.startRow,
              i.startColumn,
              i.endRow - i.startRow + 1,
              i.endColumn - i.startColumn + 1
            )
          ), r = {
            name: t3.description || "",
            allowViewByOthers: t3.viewState !== Au.NoOneElseCanView
          };
          if (t3.editState === xu.DesignedUserCanEdit)
            try {
              const o3 = (yield this._authzIoService.listCollaborators({
                objectID: t3.permissionId,
                unitID: this._unitId
              })).filter((a4) => a4.role === Le6.Editor).map((a4) => {
                var h9;
                return ((h9 = a4.subject) == null ? void 0 : h9.userID) || a4.id;
              });
              r.allowEdit = o3.length > 0;
            } catch (i) {
              console.warn(`Failed to fetch collaborators for rule ${t3.id}:`, i), r.allowEdit = false;
            }
          else
            r.allowEdit = false;
          return {
            rule: t3,
            ranges: s2,
            options: r
          };
        }))
      )).map(
        ({ rule: t3, ranges: s2, options: r }) => this._injector.createInstance(
          j5,
          this._unitId,
          this._subUnitId,
          t3.id,
          t3.permissionId,
          s2,
          r
        )
      );
    });
  }
  /**
   * Build permission snapshot
   */
  _buildSnapshot() {
    const n3 = {};
    return Object.values(k5).forEach((e) => {
      n3[e] = this.getPoint(e);
    }), n3;
  }
  /**
   * Clean up resources
   */
  dispose() {
    this._subscriptions.forEach((n3) => n3.unsubscribe()), this._permissionSubject.complete();
  }
};
Oe3 = Ln4([
  Z7(4, Inject(Injector)),
  Z7(5, Inject(aC)),
  Z7(6, Inject(_E)),
  Z7(7, Inject(Ds)),
  Z7(8, Inject(me))
], Oe3);
var Gn5 = Object.getOwnPropertyDescriptor;
var Kn3 = (n3, e, t3, s2) => {
  for (var r = s2 > 1 ? void 0 : s2 ? Gn5(e, t3) : e, i = n3.length - 1, o3; i >= 0; i--)
    (o3 = n3[i]) && (r = o3(r) || r);
  return r;
};
var pe3 = (n3, e) => (t3, s2) => e(t3, s2, n3);
var K4;
var f3 = (K4 = class extends $e {
  constructor(e, t3, s2, r, i, o3) {
    super(r), this._workbook = e, this._worksheet = t3, this._range = s2, this._injector = r, this._commandService = i, this._formulaDataModel = o3, this._runInitializers(
      this._injector,
      this._workbook,
      this._worksheet,
      this._range,
      this._commandService,
      this._formulaDataModel
    );
  }
  /**
   * Get the unit ID of the current workbook
   * @returns {string} The unit ID of the workbook
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * console.log(fRange.getUnitId());
   * ```
   */
  getUnitId() {
    return this._workbook.getUnitId();
  }
  /**
   * Gets the name of the worksheet
   * @returns {string} The name of the worksheet
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * console.log(fRange.getSheetName());
   * ```
   */
  getSheetName() {
    return this._worksheet.getName();
  }
  /**
   * Gets the ID of the worksheet
   * @returns {string} The ID of the worksheet
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * console.log(fRange.getSheetId());
   * ```
   */
  getSheetId() {
    return this._worksheet.getSheetId();
  }
  /**
   * Gets the area where the statement is applied
   * @returns {IRange} The area where the statement is applied
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * const range = fRange.getRange();
   * const { startRow, startColumn, endRow, endColumn } = range;
   * console.log(range);
   * ```
   */
  getRange() {
    return this._range;
  }
  /**
   * Gets the starting row index of the range. index starts at 0.
   * @returns {number} The starting row index of the range.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * console.log(fRange.getRow()); // 0
   * ```
   */
  getRow() {
    return this._range.startRow;
  }
  /**
   * Gets the ending row index of the range. index starts at 0.
   * @returns {number} The ending row index of the range.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * console.log(fRange.getLastRow()); // 1
   * ```
   */
  getLastRow() {
    return this._range.endRow;
  }
  /**
   * Gets the starting column index of the range. index starts at 0.
   * @returns {number} The starting column index of the range.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * console.log(fRange.getColumn()); // 0
   * ```
   */
  getColumn() {
    return this._range.startColumn;
  }
  /**
   * Gets the ending column index of the range. index starts at 0.
   * @returns {number} The ending column index of the range.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * console.log(fRange.getLastColumn()); // 1
   * ```
   */
  getLastColumn() {
    return this._range.endColumn;
  }
  /**
   * Gets the width of the applied area
   * @returns {number} The width of the area
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * console.log(fRange.getWidth());
   * ```
   */
  getWidth() {
    return this._range.endColumn - this._range.startColumn + 1;
  }
  /**
   * Gets the height of the applied area
   * @returns {number} The height of the area
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * console.log(fRange.getHeight());
   * ```
   */
  getHeight() {
    return this._range.endRow - this._range.startRow + 1;
  }
  /**
   * Return range whether this range is merged
   * @returns {boolean} if true is merged
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * console.log(fRange.isMerged());
   * // merge cells A1:B2
   * fRange.merge();
   * console.log(fRange.isMerged());
   * ```
   */
  isMerged() {
    const { startColumn: e, startRow: t3, endColumn: s2, endRow: r } = this._range;
    return this._worksheet.getMergedCellRange(t3, e, r, s2).some((o3) => Cn.equals(o3, this._range));
  }
  /**
   * Return first cell style data in this range. Please note that if there are row styles, col styles and (or)
   * worksheet style, they will be merged into the cell style. You can use `type` to specify the type of the style to get.
   *
   * @param {GetStyleType} type - The type of the style to get. 'row' means get the composed style of row, col and
   * default worksheet style. 'col' means get the composed style of col, row and default worksheet style.
   * 'cell' means get the style of cell without merging row style, col style and default worksheet style.
   * Default is 'row'.
   *
   * @returns {IStyleData | null} The cell style data
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * console.log(fRange.getCellStyleData());
   * ```
   */
  getCellStyleData(e = "row") {
    return e !== "cell" ? this._worksheet.getComposedCellStyle(this._range.startRow, this._range.startColumn, e === "row") : this._worksheet.getCellStyle(this._range.startRow, this._range.startColumn);
  }
  /**
   * Get the font family of the cell.
   *
   * @param {GetStyleType} type - The type of the style to get. 'row' means get the composed style of row, col and
   * default worksheet style. 'col' means get the composed style of col, row and default worksheet style.
   * 'cell' means get the style of cell without merging row style, col style and default worksheet style.
   * Default is 'row'.
   *
   * @returns {string | null} The font family of the cell
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * console.log(fRange.getFontFamily());
   * ```
   */
  getFontFamily(e = "row") {
    var t3, s2;
    return (s2 = (t3 = this.getCellStyleData(e)) == null ? void 0 : t3.ff) != null ? s2 : null;
  }
  /**
   * Get the font size of the cell.
   *
   * @param {GetStyleType} type - The type of the style to get. 'row' means get the composed style of row, col and
   * default worksheet style. 'col' means get the composed style of col, row and default worksheet style.
   * 'cell' means get the style of cell without merging row style, col style and default worksheet style.
   * Default is 'row'.
   *
   * @returns {number | null} The font size of the cell
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * console.log(fRange.getFontSize());
   * ```
   */
  getFontSize(e = "row") {
    var t3, s2;
    return (s2 = (t3 = this.getCellStyleData(e)) == null ? void 0 : t3.fs) != null ? s2 : null;
  }
  /**
   * Return first cell style in this range.
   *
   * @param {GetStyleType} type - The type of the style to get. 'row' means get the composed style of row, col and
   * default worksheet style. 'col' means get the composed style of col, row and default worksheet style.
   * 'cell' means get the style of cell without merging row style, col style and default worksheet style.
   * Default is 'row'.
   *
   * @returns {TextStyleValue | null} The cell style
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * console.log(fRange.getCellStyle());
   * ```
   */
  getCellStyle(e = "row") {
    const t3 = this.getCellStyleData(e);
    return t3 ? js.create(t3) : null;
  }
  /**
   * Returns the cell styles for the cells in the range.
   *
   * @param {GetStyleType} type - The type of the style to get. 'row' means get the composed style of row, col and
   * default worksheet style. 'col' means get the composed style of col, row and default worksheet style.
   * 'cell' means get the style of cell without merging row style, col style and default worksheet style.
   * Default is 'row'.
   *
   * @returns {Array<Array<TextStyleValue | null>>} A two-dimensional array of cell styles.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * console.log(fRange.getCellStyles());
   * ```
   */
  getCellStyles(e = "row") {
    return this.getCellDatas().map((s2, r) => s2.map((i, o3) => {
      if (!i) return null;
      const a4 = e !== "cell" ? this._worksheet.getComposedCellStyle(r + this._range.startRow, o3 + this._range.startColumn, e === "row") : this._worksheet.getCellStyle(r + this._range.startRow, o3 + this._range.startColumn);
      return a4 ? js.create(a4) : null;
    }));
  }
  getValue(e) {
    var t3, s2;
    return e ? this.getValueAndRichTextValue() : (s2 = (t3 = this._worksheet.getCell(this._range.startRow, this._range.startColumn)) == null ? void 0 : t3.v) != null ? s2 : null;
  }
  /**
   * Returns the raw value of the top-left cell in the range. Empty cells return `null`.
   * @returns {Nullable<CellValue>} The raw value of the cell. Returns `null` if the cell is empty.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * fRange.setValueForCell({
   *   v: 0.2,
   *   s: {
   *     n: {
   *       pattern: '0%',
   *     },
   *   },
   * });
   * console.log(fRange.getRawValue()); // 0.2
   * ```
   */
  getRawValue() {
    var t3, s2;
    const e = this._worksheet.getCellMatrix().getValue(this._range.startRow, this._range.startColumn);
    return e != null && e.p && ((t3 = e.p.body) != null && t3.dataStream) ? e.p.body.dataStream : (s2 = e == null ? void 0 : e.v) != null ? s2 : null;
  }
  /**
   * Returns the displayed value of the top-left cell in the range. The value is a String. Empty cells return an empty string.
   * @returns {string} The displayed value of the cell. Returns an empty string if the cell is empty.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * fRange.setValueForCell({
   *   v: 0.2,
   *   s: {
   *     n: {
   *       pattern: '0%',
   *     },
   *   },
   * });
   * console.log(fRange.getDisplayValue()); // 20%
   * ```
   */
  getDisplayValue() {
    var t3, s2, r;
    const e = this._worksheet.getCell(this._range.startRow, this._range.startColumn);
    return e != null && e.p && ((t3 = e.p.body) != null && t3.dataStream) ? e.p.body.dataStream : (r = (s2 = e == null ? void 0 : e.v) == null ? void 0 : s2.toString()) != null ? r : "";
  }
  getValues(e) {
    var a4, h9;
    if (e)
      return this.getValueAndRichTextValues();
    const { startRow: t3, endRow: s2, startColumn: r, endColumn: i } = this._range, o3 = [];
    for (let c2 = t3; c2 <= s2; c2++) {
      const d2 = [];
      for (let w6 = r; w6 <= i; w6++)
        d2.push((h9 = (a4 = this._worksheet.getCell(c2, w6)) == null ? void 0 : a4.v) != null ? h9 : null);
      o3.push(d2);
    }
    return o3;
  }
  /**
   * Returns a two-dimensional array of the range raw values. Empty cells return `null`.
   * @returns {Array<Array<Nullable<CellValue>>>} The raw value of the cell. Returns `null` if the cell is empty.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * fRange.setValues([
   *   [
   *     {
   *       v: 0.2,
   *       s: {
   *         n: {
   *           pattern: '0%',
   *         },
   *       },
   *     },
   *     {
   *       v: 45658,
   *       s: {
   *         n: {
   *           pattern: 'yyyy-mm-dd',
   *         },
   *       },
   *     }
   *   ],
   *   [
   *     {
   *       v: 1234.567,
   *       s: {
   *         n: {
   *           pattern: '#,##0.00',
   *         }
   *       }
   *     },
   *     null,
   *   ],
   * ]);
   * console.log(fRange.getRawValues()); // [[0.2, 45658], [1234.567, null]]
   * ```
   */
  getRawValues() {
    var a4, h9;
    const e = this._worksheet.getCellMatrix(), { startRow: t3, endRow: s2, startColumn: r, endColumn: i } = this._range, o3 = [];
    for (let c2 = t3; c2 <= s2; c2++) {
      const d2 = [];
      for (let w6 = r; w6 <= i; w6++) {
        const _3 = e.getValue(c2, w6);
        _3 != null && _3.p && ((a4 = _3.p.body) != null && a4.dataStream) ? d2.push(_3.p.body.dataStream) : d2.push((h9 = _3 == null ? void 0 : _3.v) != null ? h9 : null);
      }
      o3.push(d2);
    }
    return o3;
  }
  /**
   * Returns a two-dimensional array of the range displayed values. Empty cells return an empty string.
   * @returns {string[][]} A two-dimensional array of values.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * fRange.setValues([
   *   [
   *     {
   *       v: 0.2,
   *       s: {
   *         n: {
   *           pattern: '0%',
   *         },
   *       },
   *     },
   *     {
   *       v: 45658,
   *       s: {
   *         n: {
   *           pattern: 'yyyy-mm-dd',
   *         },
   *       },
   *     }
   *   ],
   *   [
   *     {
   *       v: 1234.567,
   *       s: {
   *         n: {
   *           pattern: '#,##0.00',
   *         }
   *       }
   *     },
   *     null,
   *   ],
   * ]);
   * console.log(fRange.getDisplayValues()); // [['20%', '2025-01-01'], ['1,234.57', '']]
   * ```
   */
  getDisplayValues() {
    var o3, a4, h9;
    const { startRow: e, endRow: t3, startColumn: s2, endColumn: r } = this._range, i = [];
    for (let c2 = e; c2 <= t3; c2++) {
      const d2 = [];
      for (let w6 = s2; w6 <= r; w6++) {
        const _3 = this._worksheet.getCell(c2, w6);
        _3 != null && _3.p && ((o3 = _3.p.body) != null && o3.dataStream) ? d2.push(_3.p.body.dataStream) : d2.push((h9 = (a4 = _3 == null ? void 0 : _3.v) == null ? void 0 : a4.toString()) != null ? h9 : "");
      }
      i.push(d2);
    }
    return i;
  }
  /**
   * Return first cell model data in this range
   * @returns {ICellData | null} The cell model data
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * console.log(fRange.getCellData());
   * ```
   */
  getCellData() {
    var e;
    return (e = this._worksheet.getCell(this._range.startRow, this._range.startColumn)) != null ? e : null;
  }
  /**
   * Alias for getCellDataGrid.
   * @returns {Nullable<ICellData>[][]} A two-dimensional array of cell data.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * console.log(fRange.getCellDatas());
   * ```
   */
  getCellDatas() {
    return this.getCellDataGrid();
  }
  /**
   * Returns the cell data for the cells in the range.
   * @returns {Nullable<ICellData>[][]} A two-dimensional array of cell data.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * console.log(fRange.getCellDataGrid());
   * ```
   */
  getCellDataGrid() {
    const { startRow: e, endRow: t3, startColumn: s2, endColumn: r } = this._range, i = [];
    for (let o3 = e; o3 <= t3; o3++) {
      const a4 = [];
      for (let h9 = s2; h9 <= r; h9++)
        a4.push(this._worksheet.getCellRaw(o3, h9));
      i.push(a4);
    }
    return i;
  }
  /**
   * Returns the rich text value for the cell at the start of this range.
   * @returns {Nullable<RichTextValue>} The rich text value
   * @internal
   * @beta
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * console.log(fRange.getRichTextValue());
   * ```
   */
  getRichTextValue() {
    const e = this.getCellData();
    return e != null && e.p ? new fn(e.p) : null;
  }
  /**
   * Returns the rich text value for the cells in the range.
   * @returns {Nullable<RichTextValue>[][]} A two-dimensional array of RichTextValue objects.
   * @internal
   * @beta
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * console.log(fRange.getRichTextValues());
   * ```
   */
  getRichTextValues() {
    return this.getCellDataGrid().map((t3) => t3.map((s2) => s2 != null && s2.p ? new fn(s2.p) : null));
  }
  /**
   * Returns the value and rich text value for the cell at the start of this range.
   * @returns {Nullable<CellValue | RichTextValue>} The value and rich text value
   * @internal
   * @beta
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * console.log(fRange.getValueAndRichTextValue());
   * ```
   */
  getValueAndRichTextValue() {
    const e = this.getCellData();
    return e != null && e.p ? new fn(e.p) : e == null ? void 0 : e.v;
  }
  /**
   * Returns the value and rich text value for the cells in the range.
   * @returns {Nullable<CellValue | RichTextValue>[][]} A two-dimensional array of value and rich text value
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * console.log(fRange.getValueAndRichTextValues());
   * ```
   */
  getValueAndRichTextValues() {
    return this.getCellDatas().map((t3) => t3.map((s2) => s2 != null && s2.p ? new fn(s2.p) : s2 == null ? void 0 : s2.v));
  }
  /**
   * Returns the formula (A1 notation) of the top-left cell in the range, or an empty string if the cell is empty or doesn't contain a formula.
   * @returns {string} The formula for the cell.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * console.log(fRange.getFormula());
   * ```
   */
  getFormula() {
    var e;
    return (e = this._formulaDataModel.getFormulaStringByCell(
      this._range.startRow,
      this._range.startColumn,
      this._worksheet.getSheetId(),
      this._workbook.getUnitId()
    )) != null ? e : "";
  }
  /**
   * Returns the formulas (A1 notation) for the cells in the range. Entries in the 2D array are empty strings for cells with no formula.
   * @returns {string[][]} A two-dimensional array of formulas in string format.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * console.log(fRange.getFormulas());
   * ```
   */
  getFormulas() {
    const e = [], { startRow: t3, endRow: s2, startColumn: r, endColumn: i } = this._range, o3 = this._worksheet.getSheetId(), a4 = this._workbook.getUnitId();
    for (let h9 = t3; h9 <= s2; h9++) {
      const c2 = [];
      for (let d2 = r; d2 <= i; d2++) {
        const w6 = this._formulaDataModel.getFormulaStringByCell(h9, d2, o3, a4);
        c2.push(w6 || "");
      }
      e.push(c2);
    }
    return e;
  }
  /**
   * Gets whether text wrapping is enabled for top-left cell in the range.
   * @returns {boolean} whether text wrapping is enabled for the cell.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * console.log(fRange.getWrap());
   * ```
   */
  getWrap() {
    return this._worksheet.getRange(this._range).getWrap() === ie.TRUE;
  }
  /**
   * Gets whether text wrapping is enabled for cells in the range.
   * @returns {boolean[][]} A two-dimensional array of whether text wrapping is enabled for each cell in the range.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * console.log(fRange.getWraps());
   */
  getWraps() {
    const e = this.getCellDatas(), t3 = this._workbook.getStyles();
    return e.map((s2) => s2.map((r) => {
      var i;
      return ((i = t3.getStyleByCell(r)) == null ? void 0 : i.tb) === jn.WRAP;
    }));
  }
  /**
   * Returns the text wrapping strategy for the top left cell of the range.
   * @returns {WrapStrategy} The text wrapping strategy
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * console.log(fRange.getWrapStrategy());
   * ```
   */
  getWrapStrategy() {
    return this._worksheet.getRange(this._range).getWrapStrategy();
  }
  /**
   * Returns the horizontal alignment of the text (left/center/right) of the top-left cell in the range.
   * @returns {string} The horizontal alignment of the text in the cell.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * console.log(fRange.getHorizontalAlignment());
   * ```
   */
  getHorizontalAlignment() {
    const e = this._worksheet.getRange(this._range).getHorizontalAlignment();
    return lt6(e);
  }
  /**
   * Returns the horizontal alignments of the cells in the range.
   * @returns {string[][]} A two-dimensional array of horizontal alignments of text associated with cells in the range.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * console.log(fRange.getHorizontalAlignments());
   * ```
   */
  getHorizontalAlignments() {
    return this._worksheet.getRange(this._range).getHorizontalAlignments().map((t3) => t3.map((s2) => lt6(s2)));
  }
  /**
   * Returns the vertical alignment (top/middle/bottom) of the top-left cell in the range.
   * @returns {string} The vertical alignment of the text in the cell.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * console.log(fRange.getVerticalAlignment());
   * ```
   */
  getVerticalAlignment() {
    return mt6(this._worksheet.getRange(this._range).getVerticalAlignment());
  }
  /**
   * Returns the vertical alignments of the cells in the range.
   * @returns {string[][]} A two-dimensional array of vertical alignments of text associated with cells in the range.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * console.log(fRange.getVerticalAlignments());
   * ```
   */
  getVerticalAlignments() {
    return this._worksheet.getRange(this._range).getVerticalAlignments().map((t3) => t3.map((s2) => mt6(s2)));
  }
  /**
   * Set custom meta data for first cell in current range.
   * @param {CustomData} data The custom meta data
   * @returns {FRange} This range, for chaining
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * fRange.setCustomMetaData({ key: 'value' });
   * console.log(fRange.getCustomMetaData());
   * ```
   */
  setCustomMetaData(e) {
    return this.setValue({
      custom: e
    });
  }
  /**
   * Set custom meta data for current range.
   * @param {CustomData[][]} datas The custom meta data
   * @returns {FRange} This range, for chaining
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * fRange.setCustomMetaDatas([
   *   [{ key: 'value' }, { key: 'value2' }],
   *   [{ key: 'value3' }, { key: 'value4' }],
   * ]);
   * console.log(fRange.getCustomMetaDatas());
   * ```
   */
  setCustomMetaDatas(e) {
    return this.setValues(e.map((t3) => t3.map((s2) => ({ custom: s2 }))));
  }
  /**
   * Returns the custom meta data for the cell at the start of this range.
   * @returns {CustomData | null} The custom meta data
   * @example
   * ```
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * console.log(fRange.getCustomMetaData());
   * ```
   */
  getCustomMetaData() {
    var t3;
    const e = this.getCellData();
    return (t3 = e == null ? void 0 : e.custom) != null ? t3 : null;
  }
  /**
   * Returns the custom meta data for the cells in the range.
   * @returns {CustomData[][]} A two-dimensional array of custom meta data
   * @example
   * ```
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * console.log(fRange.getCustomMetaDatas());
   * ```
   */
  getCustomMetaDatas() {
    return this.getCellDataGrid().map((t3) => t3.map((s2) => {
      var r;
      return (r = s2 == null ? void 0 : s2.custom) != null ? r : null;
    }));
  }
  /**
   * Sets basic border properties for the current range.
   * @param {BorderType} type The type of border to apply
   * @param {BorderStyleTypes} style The border style
   * @param {string} [color] Optional border color in CSS notation
   * @returns {FRange} This range, for chaining
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * fRange.setBorder(univerAPI.Enum.BorderType.ALL, univerAPI.Enum.BorderStyleTypes.THIN, '#ff0000');
   * ```
   */
  setBorder(e, t3, s2) {
    return this._commandService.syncExecuteCommand(Nc.id, {
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId(),
      ranges: [this._range],
      value: {
        type: e,
        style: t3,
        color: s2
      }
    }), this;
  }
  // #region editing
  /**
   * Returns the background color of the top-left cell in the range.
   * @returns {string} The color code of the background.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * console.log(fRange.getBackground());
   * ```
   */
  getBackground() {
    var t3, s2;
    const e = this.getCellStyle();
    return (s2 = (t3 = e == null ? void 0 : e.background) == null ? void 0 : t3.rgb) != null ? s2 : rt.bg.rgb;
  }
  /**
   * Returns the background colors of the cells in the range.
   * @returns {string[][]} A two-dimensional array of color codes of the backgrounds.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * console.log(fRange.getBackgrounds());
   * ```
   */
  getBackgrounds() {
    return this.getCellStyles().map((t3) => t3.map((s2) => {
      var r, i;
      return (i = (r = s2 == null ? void 0 : s2.background) == null ? void 0 : r.rgb) != null ? i : rt.bg.rgb;
    }));
  }
  /**
   * Set background color for current range.
   * @param {string} color The background color
   * @returns {FRange} This range, for chaining
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * fRange.setBackgroundColor('red');
   * ```
   */
  setBackgroundColor(e) {
    return this._commandService.syncExecuteCommand(Ce.id, {
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId(),
      range: this._range,
      style: {
        type: "bg",
        value: {
          rgb: e
        }
      }
    }), this;
  }
  /**
   * Set background color for current range.
   * @param {string} color The background color
   * @returns {FRange} This range, for chaining
   * @example
   * ```typescript
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * fRange.setBackground('red');
   * ```
   */
  setBackground(e) {
    return this.setBackgroundColor(e), this;
  }
  /**
   * Set rotation for text in current range.
   * @param {number} rotation - The rotation angle in degrees
   * @returns This range, for chaining
   * @example
   * ```typescript
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * fRange.setTextRotation(45);
   * ```
   */
  setTextRotation(e) {
    return this._commandService.syncExecuteCommand(Xc2.id, {
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId(),
      range: this._range,
      value: e
    }), this;
  }
  /**
   * Sets the value of the range.
   * @param {CellValue | ICellData} value The value can be a number, string, boolean, or standard cell format. If it begins with `=`, it is interpreted as a formula. The value is tiled to all cells in the range.
   * @returns {FRange} This range, for chaining
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('B2');
   * fRange.setValue(123);
   *
   * // or
   * fRange.setValue({ v: 234, s: { bg: { rgb: '#ff0000' } } });
   * ```
   */
  setValue(e) {
    const t3 = ja(e);
    if (!t3)
      throw new Error("Invalid value");
    return this._commandService.syncExecuteCommand(Sn2.id, {
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId(),
      range: this._range,
      value: t3
    }), this;
  }
  /**
   * Set new value for current cell, first cell in this range.
   * @param {CellValue | ICellData} value  The value can be a number, string, boolean, or standard cell format. If it begins with `=`, it is interpreted as a formula. The value is tiled to all cells in the range.
   * @returns {FRange} This range, for chaining
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * fRange.setValueForCell(123);
   *
   * // or
   * fRange.setValueForCell({ v: 234, s: { bg: { rgb: '#ff0000' } } });
   * ```
   */
  setValueForCell(e) {
    const t3 = ja(e);
    if (!t3)
      throw new Error("Invalid value");
    return this._commandService.syncExecuteCommand(Sn2.id, {
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId(),
      range: {
        startColumn: this._range.startColumn,
        startRow: this._range.startRow,
        endColumn: this._range.startColumn,
        endRow: this._range.startRow
      },
      value: t3
    }), this;
  }
  /**
   * Set the rich text value for the cell at the start of this range.
   * @param {RichTextValue | IDocumentData} value The rich text value
   * @returns {FRange} The range
   * @example
   * ```
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * console.log(fRange.getValue(true));
   *
   * // Set A1 cell value to rich text
   * const richText = univerAPI.newRichText()
   *   .insertText('Hello World')
   *   .setStyle(0, 1, { bl: 1, cl: { rgb: '#c81e1e' } })
   *   .setStyle(6, 7, { bl: 1, cl: { rgb: '#c81e1e' } });
   * fRange.setRichTextValueForCell(richText);
   * console.log(fRange.getValue(true).toPlainText()); // Hello World
   * ```
   */
  setRichTextValueForCell(e) {
    const t3 = e instanceof fn ? e.getData() : e, s2 = {
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId(),
      range: {
        startColumn: this._range.startColumn,
        startRow: this._range.startRow,
        endColumn: this._range.startColumn,
        endRow: this._range.startRow
      },
      value: { p: t3 }
    };
    return this._commandService.syncExecuteCommand(Sn2.id, s2), this;
  }
  /**
   * Set the rich text value for the cells in the range.
   * @param {RichTextValue[][]} values The rich text value
   * @returns {FRange} The range
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * console.log(fRange.getValue(true));
   *
   * // Set A1:B2 cell value to rich text
   * const richText = univerAPI.newRichText()
   *   .insertText('Hello World')
   *   .setStyle(0, 1, { bl: 1, cl: { rgb: '#c81e1e' } })
   *   .setStyle(6, 7, { bl: 1, cl: { rgb: '#c81e1e' } });
   * fRange.setRichTextValues([
   *   [richText, richText],
   *   [null, null]
   * ]);
   * console.log(fRange.getValue(true).toPlainText()); // Hello World
   * ```
   */
  setRichTextValues(e) {
    const t3 = e.map((i) => i.map((o3) => o3 && { p: o3 instanceof fn ? o3.getData() : o3 })), s2 = e1(t3, this._range), r = {
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId(),
      range: this._range,
      value: s2
    };
    return this._commandService.syncExecuteCommand(Sn2.id, r), this;
  }
  /**
   * Set the cell wrap of the given range.
   * Cells with wrap enabled (the default) resize to display their full content. Cells with wrap disabled display as much as possible in the cell without resizing or running to multiple lines.
   * @param {boolean} isWrapEnabled Whether to enable wrap
   * @returns {FRange} this range, for chaining
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * fRange.setWrap(true);
   * console.log(fRange.getWrap());
   * ```
   */
  setWrap(e) {
    return this._commandService.syncExecuteCommand(Yc2.id, {
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId(),
      range: this._range,
      value: e ? jn.WRAP : jn.UNSPECIFIED
    }), this;
  }
  /**
   * Sets the text wrapping strategy for the cells in the range.
   * @param {WrapStrategy} strategy The text wrapping strategy
   * @returns {FRange} this range, for chaining
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * fRange.setWrapStrategy(univerAPI.Enum.WrapStrategy.WRAP);
   * console.log(fRange.getWrapStrategy());
   * ```
   */
  setWrapStrategy(e) {
    return this._commandService.syncExecuteCommand(Yc2.id, {
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId(),
      range: this._range,
      value: e
    }), this;
  }
  /**
   * Set the vertical (top to bottom) alignment for the given range (top/middle/bottom).
   * @param {"top" | "middle" | "bottom"} alignment The vertical alignment
   * @returns {FRange} this range, for chaining
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * fRange.setVerticalAlignment('top');
   * ```
   */
  setVerticalAlignment(e) {
    return this._commandService.syncExecuteCommand(Jc2.id, {
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId(),
      range: this._range,
      value: Fn7(e)
    }), this;
  }
  /**
   * Set the horizontal (left to right) alignment for the given range (left/center/right).
   * @param {"left" | "center" | "normal"} alignment The horizontal alignment
   * @returns {FRange} this range, for chaining
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * fRange.setHorizontalAlignment('left');
   * ```
   */
  setHorizontalAlignment(e) {
    return this._commandService.syncExecuteCommand(qc2.id, {
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId(),
      range: this._range,
      value: Bn6(e)
    }), this;
  }
  /**
   * Sets a different value for each cell in the range. The value can be a two-dimensional array or a standard range matrix (must match the dimensions of this range), consisting of numbers, strings, Boolean values or Composed of standard cell formats. If a value begins with `=`, it is interpreted as a formula.
   * @param {CellValue[][] | IObjectMatrixPrimitiveType<CellValue> | ICellData[][] | IObjectMatrixPrimitiveType<ICellData>} value The value can be a two-dimensional array or a standard range matrix (must match the dimensions of this range), consisting of numbers, strings, Boolean values or Composed of standard cell formats.
   * @returns {FRange} This range, for chaining
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * fRange.setValues([
   *   [1, { v: 2, s: { bg: { rgb: '#ff0000' } } }],
   *   [3, 4]
   * ]);
   * ```
   */
  setValues(e) {
    const t3 = e1(e, this._range);
    return this._commandService.syncExecuteCommand(Sn2.id, {
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId(),
      range: this._range,
      value: t3
    }), this;
  }
  /**
   * Sets the font weight for the given range (normal/bold),
   * @param {FontWeight|null} fontWeight The font weight, either 'normal' or 'bold'; a null value resets the font weight.
   * @returns {FRange} This range, for chaining
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * fRange.setFontWeight('bold');
   * ```
   */
  setFontWeight(e) {
    let t3;
    if (e === "bold")
      t3 = ie.TRUE;
    else if (e === "normal")
      t3 = ie.FALSE;
    else if (e === null)
      t3 = null;
    else
      throw new Error("Invalid fontWeight");
    const s2 = {
      type: "bl",
      value: t3
    }, r = {
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId(),
      range: this._range,
      style: s2
    };
    return this._commandService.syncExecuteCommand(Ce.id, r), this;
  }
  /**
   * Sets the font style for the given range ('italic' or 'normal').
   * @param {FontStyle|null} fontStyle The font style, either 'italic' or 'normal'; a null value resets the font style.
   * @returns {FRange} This range, for chaining
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * fRange.setFontStyle('italic');
   * ```
   */
  setFontStyle(e) {
    let t3;
    if (e === "italic")
      t3 = ie.TRUE;
    else if (e === "normal")
      t3 = ie.FALSE;
    else if (e === null)
      t3 = null;
    else
      throw new Error("Invalid fontStyle");
    const s2 = {
      type: "it",
      value: t3
    }, r = {
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId(),
      range: this._range,
      style: s2
    };
    return this._commandService.syncExecuteCommand(Ce.id, r), this;
  }
  /**
   * Sets the font line style of the given range ('underline', 'line-through', or 'none').
   * @param {FontLine|null} fontLine The font line style, either 'underline', 'line-through', or 'none'; a null value resets the font line style.
   * @returns {FRange} This range, for chaining
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * fRange.setFontLine('underline');
   * ```
   */
  setFontLine(e) {
    if (e === "underline")
      this._setFontUnderline({
        s: ie.TRUE
      });
    else if (e === "line-through")
      this._setFontStrikethrough({
        s: ie.TRUE
      });
    else if (e === "none")
      this._setFontUnderline({
        s: ie.FALSE
      }), this._setFontStrikethrough({
        s: ie.FALSE
      });
    else if (e === null)
      this._setFontUnderline(null), this._setFontStrikethrough(null);
    else
      throw new Error("Invalid fontLine");
    return this;
  }
  /**
   * Sets the font underline style of the given ITextDecoration
   * @param {ITextDecoration|null} value The font underline style of the given ITextDecoration; a null value resets the font underline style
   * @returns {void}
   */
  _setFontUnderline(e) {
    const t3 = {
      type: "ul",
      value: e
    }, s2 = {
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId(),
      range: this._range,
      style: t3
    };
    this._commandService.syncExecuteCommand(Ce.id, s2);
  }
  /**
   * Sets the font strikethrough style of the given ITextDecoration
   * @param {ITextDecoration|null} value The font strikethrough style of the given ITextDecoration; a null value resets the font strikethrough style
   * @returns {void}
   */
  _setFontStrikethrough(e) {
    const t3 = {
      type: "st",
      value: e
    }, s2 = {
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId(),
      range: this._range,
      style: t3
    };
    this._commandService.syncExecuteCommand(Ce.id, s2);
  }
  /**
   * Sets the font family, such as "Arial" or "Helvetica".
   * @param {string|null} fontFamily The font family to set; a null value resets the font family.
   * @returns {FRange} This range, for chaining
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * fRange.setFontFamily('Arial');
   * ```
   */
  setFontFamily(e) {
    const t3 = {
      type: "ff",
      value: e
    }, s2 = {
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId(),
      range: this._range,
      style: t3
    };
    return this._commandService.syncExecuteCommand(Ce.id, s2), this;
  }
  /**
   * Sets the font size, with the size being the point size to use.
   * @param {number|null} size A font size in point size. A null value resets the font size.
   * @returns {FRange} This range, for chaining
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * fRange.setFontSize(24);
   * ```
   */
  setFontSize(e) {
    const t3 = {
      type: "fs",
      value: e
    }, s2 = {
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId(),
      range: this._range,
      style: t3
    };
    return this._commandService.syncExecuteCommand(Ce.id, s2), this;
  }
  /**
   * Sets the font color in CSS notation (such as '#ffffff' or 'white').
   * @param {string|null} color The font color in CSS notation (such as '#ffffff' or 'white'); a null value resets the color.
   * @returns {FRange} This range, for chaining
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * fRange.setFontColor('#ff0000');
   * ```
   */
  setFontColor(e) {
    const s2 = {
      type: "cl",
      value: e === null ? null : { rgb: e }
    }, r = {
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId(),
      range: this._range,
      style: s2
    };
    return this._commandService.syncExecuteCommand(Ce.id, r), this;
  }
  // #endregion editing
  //#region Merge cell
  /**
   * Merge cells in a range into one merged cell
   * @param {boolean} [defaultMerge] - If true, only the value in the upper left cell is retained.
   * @returns {FRange} This range, for chaining
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * fRange.merge();
   * console.log(fRange.isMerged());
   * ```
   */
  merge(e = true) {
    const t3 = this._workbook.getUnitId(), s2 = this._worksheet.getSheetId();
    return Qh(this._injector, t3, s2, [this._range], e), this;
  }
  /**
   * Merges cells in a range horizontally.
   * @param {boolean} [defaultMerge] - If true, only the value in the upper left cell is retained.
   * @returns {FRange} This range, for chaining
   * @example
   * ```ts
   * // Assume the active sheet is a new sheet with no merged cells.
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * fRange.mergeAcross();
   * // There will be two merged cells. A1:B1 and A2:B2.
   * const mergeData = fWorksheet.getMergeData();
   * mergeData.forEach((item) => {
   *   console.log(item.getA1Notation());
   * });
   * ```
   */
  mergeAcross(e = true) {
    const t3 = Jr3([this._range], Im.ROWS), s2 = this._workbook.getUnitId(), r = this._worksheet.getSheetId();
    return Qh(this._injector, s2, r, t3, e), this;
  }
  /**
   * Merges cells in a range vertically.
   * @param {boolean} [defaultMerge] - If true, only the value in the upper left cell is retained.
   * @returns {FRange} This range, for chaining
   * @example
   * ```ts
   * // Assume the active sheet is a new sheet with no merged cells.
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * fRange.mergeVertically();
   * // There will be two merged cells. A1:A2 and B1:B2.
   * const mergeData = fWorksheet.getMergeData();
   * mergeData.forEach((item) => {
   *   console.log(item.getA1Notation());
   * });
   * ```
   */
  mergeVertically(e = true) {
    const t3 = Jr3([this._range], Im.COLUMNS), s2 = this._workbook.getUnitId(), r = this._worksheet.getSheetId();
    return Qh(this._injector, s2, r, t3, e), this;
  }
  /**
   * Returns true if cells in the current range overlap a merged cell.
   * @returns {boolean} is overlap with a merged cell
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * fRange.merge();
   * const anchor = fWorksheet.getRange('A1');
   * console.log(anchor.isPartOfMerge()); // true
   * ```
   */
  isPartOfMerge() {
    const { startRow: e, startColumn: t3, endRow: s2, endColumn: r } = this._range;
    return this._worksheet.getMergedCellRange(e, t3, s2, r).length > 0;
  }
  /**
   * Break all horizontally- or vertically-merged cells contained within the range list into individual cells again.
   * @returns {FRange} This range, for chaining
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * fRange.merge();
   * const anchor = fWorksheet.getRange('A1');
   * console.log(anchor.isPartOfMerge()); // true
   * fRange.breakApart();
   * console.log(anchor.isPartOfMerge()); // false
   * ```
   */
  breakApart() {
    return this._commandService.syncExecuteCommand(Ic.id, { ranges: [this._range] }), this;
  }
  //#endregion
  /**
   * Iterate cells in this range. Merged cells will be respected.
   * @param {Function} callback the callback function to be called for each cell in the range
   * @param {number} callback.row the row number of the cell
   * @param {number} callback.col the column number of the cell
   * @param {ICellData} callback.cell the cell data
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * fRange.forEach((row, col, cell) => {
   *   console.log(row, col, cell);
   * });
   * ```
   */
  forEach(e) {
    const { startColumn: t3, startRow: s2, endColumn: r, endRow: i } = this._range;
    this._worksheet.getMatrixWithMergedCells(s2, t3, i, r).forValue((o3, a4, h9) => {
      e(o3, a4, h9);
    });
  }
  /**
   * Returns a string description of the range, in A1 notation.
   * @param {boolean} [withSheet] - If true, the sheet name is included in the A1 notation.
   * @param {AbsoluteRefType} [startAbsoluteRefType] - The absolute reference type for the start cell.
   * @param {AbsoluteRefType} [endAbsoluteRefType] - The absolute reference type for the end cell.
   * @returns {string} The A1 notation of the range.
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   *
   * // By default, the A1 notation is returned without the sheet name and without absolute reference types.
   * const fRange = fWorksheet.getRange('A1:B2');
   * console.log(fRange.getA1Notation()); // A1:B2
   *
   * // By setting withSheet to true, the sheet name is included in the A1 notation.
   * fWorksheet.setName('Sheet1');
   * console.log(fRange.getA1Notation(true)); // Sheet1!A1:B2
   *
   * // By setting startAbsoluteRefType, the absolute reference type for the start cell is included in the A1 notation.
   * console.log(fRange.getA1Notation(false, univerAPI.Enum.AbsoluteRefType.ROW)); // A$1:B2
   * console.log(fRange.getA1Notation(false, univerAPI.Enum.AbsoluteRefType.COLUMN)); // $A1:B2
   * console.log(fRange.getA1Notation(false, univerAPI.Enum.AbsoluteRefType.ALL)); // $A$1:B2
   *
   * // By setting endAbsoluteRefType, the absolute reference type for the end cell is included in the A1 notation.
   * console.log(fRange.getA1Notation(false, null, univerAPI.Enum.AbsoluteRefType.ROW)); // A1:B$2
   * console.log(fRange.getA1Notation(false, null, univerAPI.Enum.AbsoluteRefType.COLUMN)); // A1:$B2
   * console.log(fRange.getA1Notation(false, null, univerAPI.Enum.AbsoluteRefType.ALL)); // A1:$B$2
   *
   * // By setting all parameters example
   * console.log(fRange.getA1Notation(true, univerAPI.Enum.AbsoluteRefType.ALL, univerAPI.Enum.AbsoluteRefType.ALL)); // Sheet1!$A$1:$B$2
   * ```
   */
  getA1Notation(e, t3, s2) {
    const r = __spreadProps(__spreadValues({}, this._range), {
      startAbsoluteRefType: t3,
      endAbsoluteRefType: s2
    });
    return e ? wl(this._worksheet.getName(), r) : Yt(r);
  }
  /**
   * Sets the specified range as the active range, with the top left cell in the range as the current cell.
   * @returns {FRange}  This range, for chaining.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * fRange.activate(); // the active cell will be A1
   * ```
   */
  activate() {
    return this._injector.createInstance(R2, this._workbook).setActiveRange(this), this;
  }
  /**
   * Sets the specified cell as the current cell.
   * If the specified cell is present in an existing range, then that range becomes the active range with the cell as the current cell.
   * If the specified cell is not part of an existing range, then a new range is created with the cell as the active range and the current cell.
   * @returns {FRange}  This range, for chaining.
   * @description If the range is not a single cell, an error will be thrown.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   *
   * // Set the range A1:B2 as the active range, default active cell is A1
   * const fRange = fWorksheet.getRange('A1:B2');
   * fRange.activate();
   * console.log(fWorksheet.getActiveRange().getA1Notation()); // A1:B2
   * console.log(fWorksheet.getActiveCell().getA1Notation()); // A1
   *
   * // Set the cell B2 as the active cell
   * // Because B2 is in the active range A1:B2, the active range will not change, and the active cell will be changed to B2
   * const cell = fWorksheet.getRange('B2');
   * cell.activateAsCurrentCell();
   * console.log(fWorksheet.getActiveRange().getA1Notation()); // A1:B2
   * console.log(fWorksheet.getActiveCell().getA1Notation()); // B2
   *
   * // Set the cell C3 as the active cell
   * // Because C3 is not in the active range A1:B2, a new active range C3:C3 will be created, and the active cell will be changed to C3
   * const cell2 = fWorksheet.getRange('C3');
   * cell2.activateAsCurrentCell();
   * console.log(fWorksheet.getActiveRange().getA1Notation()); // C3:C3
   * console.log(fWorksheet.getActiveCell().getA1Notation()); // C3
   * ```
   */
  activateAsCurrentCell() {
    const e = this._worksheet.getMergedCell(this._range.startRow, this._range.startColumn);
    if (e && Cn.equals(e, this._range) || !e && this._range.startRow === this._range.endRow && this._range.startColumn === this._range.endColumn) {
      const r = this._injector.createInstance(R2, this._workbook).getActiveRange();
      if (!r || r.getUnitId() !== this.getUnitId() || r.getSheetId() !== this.getSheetId())
        return this.activate();
      if (Cn.contains(r.getRange(), this._range)) {
        const i = {
          unitId: this.getUnitId(),
          subUnitId: this.getSheetId(),
          selections: [
            {
              range: r.getRange(),
              primary: _e3(this.getRange(), this._worksheet),
              style: null
            }
          ]
        };
        return this._commandService.syncExecuteCommand(ie5.id, i), this;
      }
      return this.activate();
    } else
      throw new Error("The range is not a single cell");
  }
  /**
   * Splits a column of text into multiple columns based on a custom specified delimiter.
   * @param {boolean} [treatMultipleDelimitersAsOne] Whether to treat multiple continuous delimiters as one. The default value is false.
   * @param {SplitDelimiterEnum} [delimiter] The delimiter to use to split the text. The default delimiter is Tab(1)ã€Comma(2)ã€Semicolon(4)ã€Space(8)ã€Custom(16).A delimiter like 6 (SplitDelimiterEnum.Comma|SplitDelimiterEnum.Semicolon) means using Comma and Semicolon to split the text.
   * @param {string} [customDelimiter] The custom delimiter to split the text. An error will be thrown if custom delimiter is set but the customDelimiter is not a character.
   * @example Show how to split text to columns with custom delimiter
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   *
   * // A1:A3 has following values:
   * //     A   |
   * //  1#2#3  |
   * //  4##5#6 |
   * const fRange = fWorksheet.getRange('A1:A3');
   * fRange.setValues([
   *   ['A'],
   *   ['1#2#3'],
   *   ['4##5#6']
   * ]);
   *
   * // After calling splitTextToColumns(false, univerAPI.Enum.SplitDelimiterType.Custom, '#'), the range will be:
   * //  A |   |   |
   * //  1 | 2 | 3 |
   * //  4 |   | 5 | 6
   * fRange.splitTextToColumns(false, univerAPI.Enum.SplitDelimiterType.Custom, '#');
   *
   * // After calling splitTextToColumns(true, univerAPI.Enum.SplitDelimiterType.Custom, '#'), the range will be:
   * //  A |   |
   * //  1 | 2 | 3
   * //  4 | 5 | 6
   * fRange.splitTextToColumns(true, univerAPI.Enum.SplitDelimiterType.Custom, '#');
   * ```
   */
  splitTextToColumns(e, t3, s2) {
    this._commandService.syncExecuteCommand(fd.id, {
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId(),
      range: this._range,
      delimiter: t3,
      customDelimiter: s2,
      treatMultipleDelimitersAsOne: e
    });
  }
  /**
   * Set the theme style for the range.
   * @param {string|undefined} themeName The name of the theme style to apply.If a undefined value is passed, the theme style will be removed if it exist.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:E20');
   * fRange.useThemeStyle('default');
   * ```
   */
  useThemeStyle(e) {
    if (e == null) {
      const t3 = this.getUsedThemeStyle();
      t3 && this.removeThemeStyle(t3);
    } else
      this._commandService.syncExecuteCommand(rc.id, {
        unitId: this._workbook.getUnitId(),
        subUnitId: this._worksheet.getSheetId(),
        range: this._range,
        themeName: e
      });
  }
  /**
   * Remove the theme style for the range.
   * @param {string} themeName The name of the theme style to remove.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:E20');
   * fRange.removeThemeStyle('default');
   * ```
   */
  removeThemeStyle(e) {
    this._commandService.syncExecuteCommand(Cc.id, {
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId(),
      range: this._range,
      themeName: e
    });
  }
  /**
   * Gets the theme style applied to the range.
   * @returns {string | undefined} The name of the theme style applied to the range or not exist.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:E20');
   * console.log(fRange.getUsedThemeStyle()); // undefined
   * fRange.useThemeStyle('default');
   * console.log(fRange.getUsedThemeStyle()); // 'default'
   * ```
   */
  getUsedThemeStyle() {
    return this._injector.get(Os2).getAppliedRangeThemeStyle({
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId(),
      range: this._range
    });
  }
  /**
   * Clears content and formatting information of the range. Or Optionally clears only the contents or only the formatting.
   * @param {IFacadeClearOptions} [options] - Options for clearing the range. If not provided, the contents and formatting are cleared both.
   * @param {boolean} [options.contentsOnly] - If true, the contents of the range are cleared. If false, the contents and formatting are cleared. Default is false.
   * @param {boolean} [options.formatOnly] - If true, the formatting of the range is cleared. If false, the contents and formatting are cleared. Default is false.
   * @returns {FWorksheet} Returns the current worksheet instance for method chaining
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorkSheet = fWorkbook.getActiveSheet();
   * const fRange = fWorkSheet.getRange('A1:D10');
   *
   * // clear the content and format of the range A1:D10
   * fRange.clear();
   *
   * // clear the content only of the range A1:D10
   * fRange.clear({ contentsOnly: true });
   * ```
   */
  clear(e) {
    return e && e.contentsOnly && !e.formatOnly ? this.clearContent() : e && e.formatOnly && !e.contentsOnly ? this.clearFormat() : (this._commandService.syncExecuteCommand(Ls2.id, {
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId(),
      ranges: [this._range],
      options: e
    }), this);
  }
  /**
   * Clears content of the range, while preserving formatting information.
   * @returns {FWorksheet} Returns the current worksheet instance for method chaining
   * @example
   * ```typescript
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorkSheet = fWorkbook.getActiveSheet();
   * const fRange = fWorkSheet.getRange('A1:D10');
   *
   * // clear the content only of the range A1:D10
   * fRange.clearContent();
   * ```
   */
  clearContent() {
    return this._commandService.syncExecuteCommand(Ys.id, {
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId(),
      ranges: [this._range]
    }), this;
  }
  /**
   * Clears formatting information of the range, while preserving contents.
   * @returns {FWorksheet} Returns the current worksheet instance for method chaining
   * @example
   * ```typescript
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorkSheet = fWorkbook.getActiveSheet();
   * const fRange = fWorkSheet.getRange('A1:D10');
   * // clear the format only of the range A1:D10
   * fRange.clearFormat();
   * ```
   */
  clearFormat() {
    return this._commandService.syncExecuteCommand(Hs2.id, {
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId(),
      ranges: [this._range]
    }), this;
  }
  /**
   * Inserts empty cells into this range. Existing data in the sheet along the provided dimension is shifted away from the inserted range.
   * @param {Dimension} shiftDimension - The dimension along which to shift existing data.
   * @example
   * ```ts
   * // Assume the active sheet empty sheet.
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const values = [
   *   [1, 2, 3, 4],
   *   [2, 3, 4, 5],
   *   [3, 4, 5, 6],
   *   [4, 5, 6, 7],
   *   [5, 6, 7, 8],
   * ];
   *
   * // Set the range A1:D5 with some values, the range A1:D5 will be:
   * // 1 | 2 | 3 | 4
   * // 2 | 3 | 4 | 5
   * // 3 | 4 | 5 | 6
   * // 4 | 5 | 6 | 7
   * // 5 | 6 | 7 | 8
   * const fRange = fWorksheet.getRange('A1:D5');
   * fRange.setValues(values);
   * console.log(fWorksheet.getRange('A1:D5').getValues()); // [[1, 2, 3, 4], [2, 3, 4, 5], [3, 4, 5, 6], [4, 5, 6, 7], [5, 6, 7, 8]]
   *
   * // Insert the empty cells into the range A1:B2 along the columns dimension, the range A1:D5 will be:
   * //   |   | 1 | 2
   * //   |   | 2 | 3
   * // 3 | 4 | 5 | 6
   * // 4 | 5 | 6 | 7
   * // 5 | 6 | 7 | 8
   * const fRange2 = fWorksheet.getRange('A1:B2');
   * fRange2.insertCells(univerAPI.Enum.Dimension.COLUMNS);
   * console.log(fWorksheet.getRange('A1:D5').getValues()); // [[null, null, 1, 2], [null, null, 2, 3], [3, 4, 5, 6], [4, 5, 6, 7], [5, 6, 7, 8]]
   *
   * // Set the range A1:D5 values again, the range A1:D5 will be:
   * // 1 | 2 | 3 | 4
   * // 2 | 3 | 4 | 5
   * // 3 | 4 | 5 | 6
   * // 4 | 5 | 6 | 7
   * // 5 | 6 | 7 | 8
   * fRange.setValues(values);
   *
   * // Insert the empty cells into the range A1:B2 along the rows dimension, the range A1:D5 will be:
   * //   |   | 3 | 4
   * //   |   | 4 | 5
   * // 1 | 2 | 5 | 6
   * // 2 | 3 | 6 | 7
   * // 3 | 4 | 7 | 8
   * const fRange3 = fWorksheet.getRange('A1:B2');
   * fRange3.insertCells(univerAPI.Enum.Dimension.ROWS);
   * console.log(fWorksheet.getRange('A1:D5').getValues()); // [[null, null, 3, 4], [null, null, 4, 5], [1, 2, 5, 6], [2, 3, 6, 7], [3, 4, 7, 8]]
   * ```
   */
  insertCells(e) {
    e === Im.ROWS ? this._commandService.executeCommand(Pt4.id, {
      range: this._range
    }) : this._commandService.executeCommand(rn.id, {
      range: this._range
    });
  }
  /**
   * Deletes this range of cells. Existing data in the sheet along the provided dimension is shifted towards the deleted range.
   * @param {Dimension} shiftDimension - The dimension along which to shift existing data.
   * @example
   * ```ts
   * // Assume the active sheet empty sheet.
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const values = [
   *   [1, 2, 3, 4],
   *   [2, 3, 4, 5],
   *   [3, 4, 5, 6],
   *   [4, 5, 6, 7],
   *   [5, 6, 7, 8],
   * ];
   *
   * // Set the range A1:D5 with some values, the range A1:D5 will be:
   * // 1 | 2 | 3 | 4
   * // 2 | 3 | 4 | 5
   * // 3 | 4 | 5 | 6
   * // 4 | 5 | 6 | 7
   * // 5 | 6 | 7 | 8
   * const fRange = fWorksheet.getRange('A1:D5');
   * fRange.setValues(values);
   * console.log(fWorksheet.getRange('A1:D5').getValues()); // [[1, 2, 3, 4], [2, 3, 4, 5], [3, 4, 5, 6], [4, 5, 6, 7], [5, 6, 7, 8]]
   *
   * // Delete the range A1:B2 along the columns dimension, the range A1:D5 will be:
   * // 3 | 4 |   |
   * // 4 | 5 |   |
   * // 3 | 4 | 5 | 6
   * // 4 | 5 | 6 | 7
   * // 5 | 6 | 7 | 8
   * const fRange2 = fWorksheet.getRange('A1:B2');
   * fRange2.deleteCells(univerAPI.Enum.Dimension.COLUMNS);
   * console.log(fWorksheet.getRange('A1:D5').getValues()); // [[3, 4, null, null], [4, 5, null, null], [3, 4, 5, 6], [4, 5, 6, 7], [5, 6, 7, 8]]
   *
   * // Set the range A1:D5 values again, the range A1:D5 will be:
   * // 1 | 2 | 3 | 4
   * // 2 | 3 | 4 | 5
   * // 3 | 4 | 5 | 6
   * // 4 | 5 | 6 | 7
   * // 5 | 6 | 7 | 8
   * fRange.setValues(values);
   *
   * // Delete the range A1:B2 along the rows dimension, the range A1:D5 will be:
   * // 3 | 4 | 3 | 4
   * // 4 | 5 | 4 | 5
   * // 5 | 6 | 5 | 6
   * //   |   | 6 | 7
   * //   |   | 7 | 8
   * const fRange3 = fWorksheet.getRange('A1:B2');
   * fRange3.deleteCells(univerAPI.Enum.Dimension.ROWS);
   * console.log(fWorksheet.getRange('A1:D5').getValues()); // [[3, 4, 3, 4], [4, 5, 4, 5], [5, 6, 5, 6], [null, null, 6, 7], [null, null, 7, 8]]
   * ```
   */
  deleteCells(e) {
    e === Im.ROWS ? this._commandService.executeCommand(vt2.id, {
      range: this._range
    }) : this._commandService.executeCommand(It2.id, {
      range: this._range
    });
  }
  /**
   * Returns a copy of the range expanded `Direction.UP` and `Direction.DOWN` if the specified dimension is `Dimension.ROWS`, or `Direction.NEXT` and `Direction.PREVIOUS` if the dimension is `Dimension.COLUMNS`.
   * The expansion of the range is based on detecting data next to the range that is organized like a table.
   * The expanded range covers all adjacent cells with data in them along the specified dimension including the table boundaries.
   * If the original range is surrounded by empty cells along the specified dimension, the range itself is returned.
   * @param {Dimension} [dimension] - The dimension along which to expand the range. If not provided, the range will be expanded in both dimensions.
   * @returns {FRange} The range's data region or a range covering each column or each row spanned by the original range.
   * @example
   * ```ts
   * // Assume the active sheet is a new sheet with no data.
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   *
   * // Set the range A1:D4 with some values, the range A1:D4 will be:
   * //  |     |     |
   * //  |     | 100 |
   * //  | 100 |     | 100
   * //  |     | 100 |
   * fWorksheet.getRange('C2').setValue(100);
   * fWorksheet.getRange('B3').setValue(100);
   * fWorksheet.getRange('D3').setValue(100);
   * fWorksheet.getRange('C4').setValue(100);
   *
   * // Get C3 data region along the rows dimension, the range will be C2:D4
   * const range = fWorksheet.getRange('C3').getDataRegion(univerAPI.Enum.Dimension.ROWS);
   * console.log(range.getA1Notation()); // C2:C4
   *
   * // Get C3 data region along the columns dimension, the range will be B3:D3
   * const range2 = fWorksheet.getRange('C3').getDataRegion(univerAPI.Enum.Dimension.COLUMNS);
   * console.log(range2.getA1Notation()); // B3:D3
   *
   * // Get C3 data region along the both dimension, the range will be B2:D4
   * const range3 = fWorksheet.getRange('C3').getDataRegion();
   * console.log(range3.getA1Notation()); // B2:D4
   * ```
   */
  // eslint-disable-next-line complexity
  getDataRegion(e) {
    const { startRow: t3, startColumn: s2, endRow: r, endColumn: i } = this._range, o3 = this._worksheet.getMaxRows(), a4 = this._worksheet.getMaxColumns(), h9 = this._worksheet.getCellMatrix();
    let c2 = t3, d2 = s2, w6 = r, _3 = i;
    if (e !== Im.COLUMNS) {
      let y6 = false, P8 = false;
      for (let C = s2; C <= i && (t3 > 0 && !HR(h9.getValue(t3 - 1, C)) && (y6 = true), r < o3 - 1 && !HR(h9.getValue(r + 1, C)) && (P8 = true), !(y6 && P8)); C++)
        ;
      y6 && (c2 = t3 - 1), P8 && (w6 = r + 1);
    }
    if (e !== Im.ROWS) {
      let y6 = false, P8 = false;
      for (let C = t3; C <= r && (s2 > 0 && !HR(h9.getValue(C, s2 - 1)) && (y6 = true), i < a4 - 1 && !HR(h9.getValue(C, i + 1)) && (P8 = true), !(y6 && P8)); C++)
        ;
      y6 && (d2 = s2 - 1), P8 && (_3 = i + 1);
    }
    return this._injector.createInstance(f3, this._workbook, this._worksheet, {
      startRow: c2,
      startColumn: d2,
      endRow: w6,
      endColumn: _3
    });
  }
  /**
   * Returns true if the range is totally blank.
   * @returns {boolean} true if the range is blank; false otherwise.
   * @example
   * ```ts
   * // Assume the active sheet is a new sheet with no data.
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * console.log(fRange.isBlank()); // true
   *
   * // Set the range A1:B2 with some values
   * fRange.setValueForCell(123);
   * console.log(fRange.isBlank()); // false
   * ```
   */
  isBlank() {
    const e = this._worksheet.getCellMatrix(), { startRow: t3, startColumn: s2, endRow: r, endColumn: i } = this._range;
    let o3 = true;
    for (let a4 = t3; a4 <= r; a4++) {
      for (let h9 = s2; h9 <= i; h9++)
        if (!HR(e.getValue(a4, h9))) {
          o3 = false;
          break;
        }
      if (!o3)
        break;
    }
    return o3;
  }
  /**
   * Returns a new range that is relative to the current range, whose upper left point is offset from the current range by the given rows and columns, and with the given height and width in cells.
   * @param {number} rowOffset - The number of rows down from the range's top-left cell; negative values represent rows up from the range's top-left cell.
   * @param {number} columnOffset - The number of columns right from the range's top-left cell; negative values represent columns left from the range's top-left cell.
   * @param {number} numRows - The height in rows of the new range.
   * @param {number} numColumns - The width in columns of the new range.
   * @returns {FRange} The new range.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * console.log(fRange.getA1Notation()); // A1:B2
   *
   * // Offset the range by 1 row and 1 column, and set the height of the new range to 3 and the width to 3
   * const newRange = fRange.offset(1, 1, 3, 3);
   * console.log(newRange.getA1Notation()); // B2:D4
   * ```
   */
  offset(e, t3, s2, r) {
    const { startRow: i, startColumn: o3, endRow: a4, endColumn: h9 } = this._range, c2 = i + e, d2 = o3 + t3, w6 = s2 ? c2 + s2 - 1 : a4 + e, _3 = r ? d2 + r - 1 : h9 + t3;
    if (c2 < 0 || d2 < 0 || w6 < 0 || _3 < 0)
      throw new Error("The row or column index is out of range");
    return this._injector.createInstance(f3, this._workbook, this._worksheet, {
      startRow: c2,
      startColumn: d2,
      endRow: w6,
      endColumn: _3
    });
  }
  /**
   * Updates the formula for this range. The given formula must be in A1 notation.
   * @param {string} formula - A string representing the formula to set for the cell.
   * @returns {FRange} This range instance for chaining.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1');
   * fRange.setFormula('=SUM(A2:A5)');
   * console.log(fRange.getFormula()); // '=SUM(A2:A5)'
   * ```
   */
  setFormula(e) {
    return this.setValue({
      f: e
    });
  }
  /**
   * Sets a rectangular grid of formulas (must match dimensions of this range). The given formulas must be in A1 notation.
   * @param {string[][]} formulas - A two-dimensional string array of formulas.
   * @returns {FRange} This range instance for chaining.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * fRange.setFormulas([
   *   ['=SUM(A2:A5)', '=SUM(B2:B5)'],
   *   ['=SUM(A6:A9)', '=SUM(B6:B9)'],
   * ]);
   * console.log(fRange.getFormulas()); // [['=SUM(A2:A5)', '=SUM(B2:B5)'], ['=SUM(A6:A9)', '=SUM(B6:B9)']]
   * ```
   */
  setFormulas(e) {
    return this.setValues(e.map((t3) => t3.map((s2) => ({ f: s2 }))));
  }
  /**
   * Get the RangePermission instance for managing range-level permissions.
   * This is the new permission API that provides range-specific permission control.
   * @returns {FRangePermission} - The RangePermission instance.
   * @example
   * ```ts
   * const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B10');
   * const permission = fRange.getRangePermission();
   *
   * // Protect the range
   * await permission.protect({ name: 'Protected Area', allowEdit: false });
   *
   * // Check if range is protected
   * const isProtected = permission.isProtected();
   *
   * // Check if current user can edit
   * const canEdit = permission.canEdit();
   *
   * // Unprotect the range
   * await permission.unprotect();
   *
   * // Subscribe to protection changes
   * permission.protectionChange$.subscribe(change => {
   *   console.log('Protection changed:', change);
   * });
   * ```
   */
  getRangePermission() {
    const e = this._injector.createInstance(I5, this._injector.createInstance(R2, this._workbook), this._workbook, this._worksheet);
    return this._injector.createInstance(
      Oe3,
      this._workbook.getUnitId(),
      this._worksheet.getSheetId(),
      this,
      e
    );
  }
}, K4._enableManualInit(), K4);
f3 = Kn3([
  pe3(3, Inject(Injector)),
  pe3(4, Ds),
  pe3(5, Inject(yr))
], f3);
var Jn7 = Object.getOwnPropertyDescriptor;
var qn5 = (n3, e, t3, s2) => {
  for (var r = s2 > 1 ? void 0 : s2 ? Jn7(e, t3) : e, i = n3.length - 1, o3; i >= 0; i--)
    (o3 = n3[i]) && (r = o3(r) || r);
  return r;
};
var ye5 = (n3, e) => (t3, s2) => e(t3, s2, n3);
var Te3 = class {
  constructor(n3, e, t3, s2) {
    g6(this, "_permissionSubject");
    g6(this, "_collaboratorChangeSubject", new Subject());
    g6(this, "permission$");
    g6(this, "pointChange$");
    g6(this, "collaboratorChange$");
    g6(this, "_subscriptions", []);
    g6(this, "_fPermission");
    this._unitId = n3, this._injector = e, this._permissionService = t3, this._authzIoService = s2, this._fPermission = this._injector.createInstance(H3), this._permissionSubject = new BehaviorSubject(this._buildSnapshot()), this.permission$ = this._createPermissionStream(), this.pointChange$ = this._createPointChangeStream(), this.collaboratorChange$ = this._collaboratorChangeSubject.asObservable().pipe(
      shareReplay({ bufferSize: 1, refCount: true })
    );
  }
  /**
   * Create permission snapshot stream from IPermissionService
   * @private
   */
  _createPermissionStream() {
    const n3 = this._permissionService.permissionPointUpdate$.pipe(
      filter((e) => e.id.includes(this._unitId))
    ).subscribe(() => {
      this._permissionSubject.next(this._buildSnapshot());
    });
    return this._subscriptions.push(n3), this._permissionSubject.asObservable().pipe(
      distinctUntilChanged((e, t3) => JSON.stringify(e) === JSON.stringify(t3)),
      shareReplay({ bufferSize: 1, refCount: true })
    );
  }
  /**
   * Create point change stream from IPermissionService
   * @private
   */
  _createPointChangeStream() {
    const n3 = /* @__PURE__ */ new Map();
    for (const e in u) {
      const t3 = u[e];
      n3.set(t3, this.getPoint(t3));
    }
    return this._permissionService.permissionPointUpdate$.pipe(
      filter((e) => e.id.includes(this._unitId)),
      map((e) => {
        const t3 = this._extractWorkbookPointType(e.id);
        if (!t3) return null;
        const s2 = !!e.value, r = n3.get(t3);
        return n3.set(t3, s2), r === s2 ? null : { point: t3, value: s2, oldValue: r };
      }),
      filter((e) => e !== null),
      shareReplay({ bufferSize: 1, refCount: true })
    );
  }
  /**
   * Extract WorkbookPermissionPoint type from permission point ID
   * @private
   */
  _extractWorkbookPointType(n3) {
    for (const e in u) {
      const t3 = u[e], s2 = oe4[t3];
      if (!s2) continue;
      if (new s2(this._unitId).id === n3)
        return t3;
    }
    return null;
  }
  /**
   * Build permission snapshot
   */
  _buildSnapshot() {
    const n3 = {};
    for (const e in u) {
      const t3 = u[e];
      n3[t3] = this.getPoint(t3);
    }
    return n3;
  }
  /**
   * Listen to permission point changes
  /**
   * Set permission mode for the workbook.
   * @param {WorkbookMode} mode The permission mode to set ('owner' | 'editor' | 'viewer' | 'commenter').
   * @returns {Promise<void>} A promise that resolves when the mode is set.
   * @example
   * ```ts
   * const workbook = univerAPI.getActiveWorkbook();
   * const permission = workbook?.getWorkbookPermission();
   * await permission?.setMode('editor');
   * ```
   */
  setMode(n3) {
    return __async(this, null, function* () {
      const e = this._getModePermissions(n3);
      yield this._batchSetPermissionPoints(e);
    });
  }
  /**
   * Get permission configuration for a specific mode
   * @private
   */
  _getModePermissions(n3) {
    const e = {};
    switch (Object.values(u).forEach((t3) => {
      e[t3] = false;
    }), n3) {
      case "owner":
        Object.values(u).forEach((t3) => {
          e[t3] = true;
        });
        break;
      case "editor":
        e[u.Edit] = true, e[u.View] = true, e[u.Print] = true, e[u.Export] = true, e[u.CopyContent] = true, e[u.Comment] = true, e[u.CreateSheet] = true, e[u.DeleteSheet] = true, e[u.RenameSheet] = true, e[u.MoveSheet] = true, e[u.HideSheet] = true, e[u.InsertRow] = true, e[u.InsertColumn] = true, e[u.DeleteRow] = true, e[u.DeleteColumn] = true, e[u.CopySheet] = true, e[u.CreateProtection] = true;
        break;
      case "viewer":
        e[u.View] = true, e[u.Print] = true;
        break;
      case "commenter":
        e[u.View] = true, e[u.Comment] = true, e[u.Print] = true;
        break;
    }
    return e;
  }
  /**
   * Batch set multiple permission points efficiently
   * @private
   */
  _batchSetPermissionPoints(n3) {
    return __async(this, null, function* () {
      const e = [];
      for (const [t3, s2] of Object.entries(n3)) {
        const r = t3, i = oe4[r];
        if (!i)
          throw new Error(`Unknown workbook permission point: ${r}`);
        const o3 = this.getPoint(r);
        o3 !== s2 && (this._fPermission.setWorkbookPermissionPoint(this._unitId, i, s2), e.push({ point: r, value: s2, oldValue: o3 }));
      }
      if (e.length > 0) {
        const t3 = this._buildSnapshot();
        this._permissionSubject.next(t3);
      }
    });
  }
  /**
   * Set the workbook to read-only mode (viewer mode).
   * @returns {Promise<void>} A promise that resolves when the mode is set.
   * @example
   * ```ts
   * const workbook = univerAPI.getActiveWorkbook();
   * const permission = workbook?.getWorkbookPermission();
   * await permission?.setReadOnly();
   * ```
   */
  setReadOnly() {
    return __async(this, null, function* () {
      yield this.setMode("viewer");
    });
  }
  /**
   * Set the workbook to editable mode (editor mode).
   * @returns {Promise<void>} A promise that resolves when the mode is set.
   * @example
   * ```ts
   * const workbook = univerAPI.getActiveWorkbook();
   * const permission = workbook?.getWorkbookPermission();
   * await permission?.setEditable();
   * ```
   */
  setEditable() {
    return __async(this, null, function* () {
      yield this.setMode("editor");
    });
  }
  /**
   * Check if the workbook is editable.
   * @returns {boolean} true if the workbook can be edited, false otherwise.
   * @example
   * ```ts
   * const workbook = univerAPI.getActiveWorkbook();
   * const permission = workbook?.getWorkbookPermission();
   * if (permission?.canEdit()) {
   *   console.log('Workbook is editable');
   * }
   * ```
   */
  canEdit() {
    return this.getPoint(u.Edit);
  }
  /**
   * Set a specific permission point.
   * @param {WorkbookPermissionPoint} point The permission point to set.
   * @param {boolean} value The value to set (true = allowed, false = denied).
   * @returns {Promise<void>} A promise that resolves when the point is set.
   * @example
   * ```ts
   * const workbook = univerAPI.getActiveWorkbook();
   * const permission = workbook?.getWorkbookPermission();
   * await permission?.setPoint(univerAPI.Enum.WorkbookPermissionPoint.Print, false);
   * ```
   */
  setPoint(n3, e) {
    return __async(this, null, function* () {
      const t3 = oe4[n3];
      if (!t3)
        throw new Error(`Unknown workbook permission point: ${n3}`);
      if (this.getPoint(n3) === e)
        return;
      this._fPermission.setWorkbookPermissionPoint(this._unitId, t3, e);
      const r = this._buildSnapshot();
      this._permissionSubject.next(r);
    });
  }
  /**
   * Get the value of a specific permission point.
   * @param {WorkbookPermissionPoint} point The permission point to query.
   * @returns {boolean} true if allowed, false if denied.
   * @example
   * ```ts
   * const workbook = univerAPI.getActiveWorkbook();
   * const permission = workbook?.getWorkbookPermission();
   * const canPrint = permission?.getPoint(univerAPI.Enum.WorkbookPermissionPoint.Print);
   * console.log(canPrint);
   * ```
   */
  getPoint(n3) {
    var r;
    const e = oe4[n3];
    if (!e)
      throw new Error(`Unknown workbook permission point: ${n3}`);
    const t3 = new e(this._unitId), s2 = this._permissionService.getPermissionPoint(t3.id);
    return (r = s2 == null ? void 0 : s2.value) != null ? r : true;
  }
  /**
   * Get a snapshot of all permission points.
   * @returns {WorkbookPermissionSnapshot} An object containing all permission point values.
   * @example
   * ```ts
   * const workbook = univerAPI.getActiveWorkbook();
   * const permission = workbook?.getWorkbookPermission();
   * const snapshot = permission?.getSnapshot();
   * console.log(snapshot);
   * ```
   */
  getSnapshot() {
    return this._buildSnapshot();
  }
  /**
   * Set multiple collaborators at once (replaces existing collaborators).
   * @param {Array<{ user: IUser; role: UnitRole }>} collaborators Array of collaborators with user information and role.
   * @returns {Promise<void>} A promise that resolves when the collaborators are set.
   * @example
   * ```ts
   * const workbook = univerAPI.getActiveWorkbook();
   * const permission = workbook?.getWorkbookPermission();
   * await permission?.setCollaborators([
   *   {
   *     user: { userID: 'user1', name: 'John Doe', avatar: 'https://...' },
   *     role: univerAPI.Enum.UnitRole.Editor
   *   },
   *   {
   *     user: { userID: 'user2', name: 'Jane Smith', avatar: '' },
   *     role: univerAPI.Enum.UnitRole.Reader
   *   }
   * ]);
   * ```
   */
  setCollaborators(n3) {
    return __async(this, null, function* () {
      const e = n3.map((t3) => ({
        id: t3.user.userID,
        subject: t3.user,
        role: t3.role
      }));
      yield this._authzIoService.putCollaborators({
        objectID: this._unitId,
        unitID: this._unitId,
        collaborators: e
      }), n3.forEach((t3) => {
        this._collaboratorChangeSubject.next({
          type: "add",
          collaborator: {
            user: { id: t3.user.userID },
            role: t3.role
          }
        });
      });
    });
  }
  /**
   * Add a single collaborator.
   * @param {IUser} user The user information (userID, name, avatar).
   * @param {UnitRole} role The role to assign.
   * @returns {Promise<void>} A promise that resolves when the collaborator is added.
   * @example
   * ```ts
   * const workbook = univerAPI.getActiveWorkbook();
   * const permission = workbook?.getWorkbookPermission();
   * await permission?.addCollaborator(
   *   { userID: 'user1', name: 'John Doe', avatar: 'https://...' },
   *   univerAPI.Enum.UnitRole.Editor
   * );
   * ```
   */
  addCollaborator(n3, e) {
    return __async(this, null, function* () {
      yield this._authzIoService.createCollaborator({
        objectID: this._unitId,
        unitID: this._unitId,
        collaborators: [{
          id: n3.userID,
          subject: n3,
          role: e
        }]
      }), this._collaboratorChangeSubject.next({
        type: "add",
        collaborator: {
          user: { id: n3.userID },
          role: e
        }
      });
    });
  }
  /**
   * Update an existing collaborator's role and information.
   * @param {IUser} user The updated user information (userID, name, avatar).
   * @param {UnitRole} role The new role to assign.
   * @returns {Promise<void>} A promise that resolves when the collaborator is updated.
   * @example
   * ```ts
   * const workbook = univerAPI.getActiveWorkbook();
   * const permission = workbook?.getWorkbookPermission();
   * await permission?.updateCollaborator(
   *   { userID: 'user1', name: 'John Doe Updated', avatar: 'https://...' },
   *   univerAPI.Enum.UnitRole.Reader
   * );
   * ```
   */
  updateCollaborator(n3, e) {
    return __async(this, null, function* () {
      yield this._authzIoService.updateCollaborator({
        objectID: this._unitId,
        unitID: this._unitId,
        collaborator: {
          id: n3.userID,
          subject: n3,
          role: e
        }
      }), this._collaboratorChangeSubject.next({
        type: "update",
        collaborator: {
          user: { id: n3.userID },
          role: e
        }
      });
    });
  }
  /**
   * Remove a collaborator from the workbook.
   * @param {string} userId The user ID to remove.
   * @returns {Promise<void>} A promise that resolves when the collaborator is removed.
   * @example
   * ```ts
   * const workbook = univerAPI.getActiveWorkbook();
   * const permission = workbook?.getWorkbookPermission();
   * await permission?.removeCollaborator('user1');
   * ```
   */
  removeCollaborator(n3) {
    return __async(this, null, function* () {
      yield this._authzIoService.deleteCollaborator({
        objectID: this._unitId,
        unitID: this._unitId,
        collaboratorID: n3
      }), this._collaboratorChangeSubject.next({
        type: "delete",
        collaborator: {
          user: { id: n3 },
          role: te3.Reader
          // Placeholder value
        }
      });
    });
  }
  /**
   * Remove multiple collaborators at once.
   * @param {string[]} userIds Array of user IDs to remove.
   * @returns {Promise<void>} A promise that resolves when the collaborators are removed.
   * @example
   * ```ts
   * const workbook = univerAPI.getActiveWorkbook();
   * const permission = workbook?.getWorkbookPermission();
   * await permission?.removeCollaborators(['user1', 'user2']);
   * ```
   */
  removeCollaborators(n3) {
    return __async(this, null, function* () {
      for (const e of n3)
        yield this.removeCollaborator(e);
    });
  }
  /**
   * List all collaborators of the workbook.
   * @returns {Promise<ICollaborator[]>} Array of collaborators with their roles.
   * @example
   * ```ts
   * const workbook = univerAPI.getActiveWorkbook();
   * const permission = workbook?.getWorkbookPermission();
   * const collaborators = await permission?.listCollaborators();
   * console.log(collaborators);
   * ```
   */
  listCollaborators() {
    return __async(this, null, function* () {
      return (yield this._authzIoService.listCollaborators({
        objectID: this._unitId,
        unitID: this._unitId
      })).map((e) => {
        var t3, s2;
        return {
          user: {
            id: ((t3 = e.subject) == null ? void 0 : t3.userID) || e.id,
            displayName: ((s2 = e.subject) == null ? void 0 : s2.name) || ""
          },
          role: e.role
          // Type conversion: protocol UnitRole to our UnitRole
        };
      });
    });
  }
  /**
   * Subscribe to permission changes (simplified interface for users not familiar with RxJS).
   * @param {Function} listener Callback function to be called when permissions change.
   * @returns {UnsubscribeFn} Unsubscribe function.
   * @example
   * ```ts
   * const workbook = univerAPI.getActiveWorkbook();
   * const permission = workbook?.getWorkbookPermission();
   * const unsubscribe = permission?.subscribe((snapshot) => {
   *   console.log('Permission changed:', snapshot);
   * });
   * // Later, to stop listening:
   * unsubscribe?.();
   * ```
   */
  subscribe(n3) {
    const e = this.permission$.subscribe(n3);
    return () => e.unsubscribe();
  }
  /**
   * Clean up resources
   */
  dispose() {
    this._subscriptions.forEach((n3) => n3.unsubscribe()), this._permissionSubject.complete(), this._collaboratorChangeSubject.complete();
  }
};
Te3 = qn5([
  ye5(1, Inject(Injector)),
  ye5(2, aC),
  ye5(3, _E)
], Te3);
var Yn4 = Object.getOwnPropertyDescriptor;
var Zn4 = (n3, e, t3, s2) => {
  for (var r = s2 > 1 ? void 0 : s2 ? Yn4(e, t3) : e, i = n3.length - 1, o3; i >= 0; i--)
    (o3 = n3[i]) && (r = o3(r) || r);
  return r;
};
var W3 = (n3, e) => (t3, s2) => e(t3, s2, n3);
var R2 = class extends $e {
  constructor(e, t3, s2, r, i, o3, a4, h9, c2, d2) {
    super(t3);
    g6(this, "id");
    this._workbook = e, this._injector = t3, this._resourceLoaderService = s2, this._selectionManagerService = r, this._univerInstanceService = i, this._commandService = o3, this._permissionService = a4, this._logService = h9, this._localeService = c2, this._definedNamesService = d2, this.id = this._workbook.getUnitId();
  }
  /**
   * Get the Workbook instance.
   * @returns {Workbook} The Workbook instance.
   * @example
   * ```ts
   * // The code below gets the Workbook instance
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const workbook = fWorkbook.getWorkbook();
   * console.log(workbook);
   * ```
   */
  getWorkbook() {
    return this._workbook;
  }
  dispose() {
    super.dispose(), this._workbook = null;
  }
  /**
   * Get the id of the workbook.
   * @returns {string} The id of the workbook.
   * @example
   * ```ts
   * // The code below gets the id of the workbook
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const unitId = fWorkbook.getId();
   * console.log(unitId);
   * ```
   */
  getId() {
    return this.id;
  }
  /**
   * Get the name of the workbook.
   * @returns {string} The name of the workbook.
   * @example
   * ```ts
   * // The code below gets the name of the workbook
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const name = fWorkbook.getName();
   * console.log(name);
   * ```
   */
  getName() {
    return this._workbook.name;
  }
  /**
   * Set the name of the workbook.
   * @param {string} name The new name of the workbook.
   * @example
   * ```ts
   * // The code below sets the name of the workbook
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * fWorkbook.setName('MyWorkbook');
   * ```
   */
  setName(e) {
    return this._commandService.syncExecuteCommand(ai.id, {
      unitId: this._workbook.getUnitId(),
      name: e
    }), this;
  }
  /**
   * Save workbook snapshot data, including conditional formatting, data validation, and other plugin data.
   * @returns {IWorkbookData} Workbook snapshot data
   * @example
   * ```ts
   * // The code below saves the workbook snapshot data
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const snapshot = fWorkbook.save();
   * console.log(snapshot);
   * ```
   */
  save() {
    return this._resourceLoaderService.saveUnit(this._workbook.getUnitId());
  }
  /**
   * @deprecated use 'save' instead.
   * @returns {IWorkbookData} Workbook snapshot data
   * @memberof FWorkbook
   * @example
   * ```ts
   * // The code below saves the workbook snapshot data
   * const activeSpreadsheet = univerAPI.getActiveWorkbook();
   * const snapshot = activeSpreadsheet.getSnapshot();
   * ```
   */
  getSnapshot() {
    return this._logService.warn("use 'save' instead of 'getSnapshot'"), this.save();
  }
  /**
   * Get the active sheet of the workbook.
   * @returns {FWorksheet} The active sheet of the workbook
   * @example
   * ```ts
   * // The code below gets the active sheet of the workbook
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * console.log(fWorksheet);
   * ```
   */
  getActiveSheet() {
    const e = this._workbook.getActiveSheet();
    return this._injector.createInstance(I5, this, this._workbook, e);
  }
  /**
   * Gets all the worksheets in this workbook
   * @returns {FWorksheet[]} An array of all the worksheets in the workbook
   * @example
   * ```ts
   * // The code below gets all the worksheets in the workbook
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const sheets = fWorkbook.getSheets();
   * console.log(sheets);
   * ```
   */
  getSheets() {
    return this._workbook.getSheets().map((e) => this._injector.createInstance(I5, this, this._workbook, e));
  }
  /**
   * Create a new worksheet and returns a handle to it.
   * @param {string} name Name of the new sheet
   * @param {number} rows How many rows would the new sheet have
   * @param {number} columns How many columns would the new sheet have
   * @param {Pick<IInsertSheetCommandParams, 'index' | 'sheet'>} [options] The options for the new sheet
   * @param {number} [options.index] The position index where the new sheet is to be inserted
   * @param {Partial<IWorksheetData>} [options.sheet] The data configuration for the new sheet
   * @returns {FWorksheet} The new created sheet
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   *
   * // Create a new sheet named 'MyNewSheet' with 10 rows and 10 columns
   * const newSheet = fWorkbook.create('MyNewSheet', 10, 10);
   * console.log(newSheet);
   *
   * // Create a new sheet named 'MyNewSheetWithData' with 10 rows and 10 columns and some data, and set it as the first sheet
   * const sheetData = {
   *   // ... Omit other properties
   *   cellData: {
   *     0: {
   *       0: {
   *         v: 'Hello Univer!',
   *       }
   *     }
   *   },
   *   // ... Omit other properties
   * };
   * const newSheetWithData = fWorkbook.create('MyNewSheetWithData', 10, 10, {
   *   index: 0,
   *   sheet: sheetData,
   * });
   * console.log(newSheetWithData);
   * ```
   */
  create(e, t3, s2, r) {
    var h9, c2, d2;
    const i = $E(Z.deepClone((h9 = r == null ? void 0 : r.sheet) != null ? h9 : {}));
    i.name = e, i.rowCount = t3, i.columnCount = s2, i.id = (c2 = r == null ? void 0 : r.sheet) == null ? void 0 : c2.id;
    const o3 = (d2 = r == null ? void 0 : r.index) != null ? d2 : this._workbook.getSheets().length;
    this._commandService.syncExecuteCommand(Sc.id, {
      unitId: this.id,
      index: o3,
      sheet: i
    }), this._commandService.syncExecuteCommand(pn.id, {
      unitId: this.id,
      subUnitId: this._workbook.getSheets()[o3].getSheetId()
    });
    const a4 = this._workbook.getActiveSheet();
    if (!a4)
      throw new Error("No active sheet found");
    return this._injector.createInstance(I5, this, this._workbook, a4);
  }
  /**
   * Get a worksheet by sheet id.
   * @param {string} sheetId The id of the sheet to get.
   * @returns {FWorksheet | null} The worksheet with given sheet id
   * @example
   * ```ts
   * // The code below gets a worksheet by sheet id
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const sheet = fWorkbook.getSheetBySheetId('sheetId');
   * console.log(sheet);
   * ```
   */
  getSheetBySheetId(e) {
    const t3 = this._workbook.getSheetBySheetId(e);
    return t3 ? this._injector.createInstance(I5, this, this._workbook, t3) : null;
  }
  /**
   * Get a worksheet by sheet name.
   * @param {string} name The name of the sheet to get.
   * @returns {FWorksheet | null} The worksheet with given sheet name
   * @example
   * ```ts
   * // The code below gets a worksheet by sheet name
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const sheet = fWorkbook.getSheetByName('Sheet1');
   * console.log(sheet);
   * ```
   */
  getSheetByName(e) {
    const t3 = this._workbook.getSheetBySheetName(e);
    return t3 ? this._injector.createInstance(I5, this, this._workbook, t3) : null;
  }
  /**
   * Sets the given worksheet to be the active worksheet in the workbook.
   * @param {FWorksheet | string} sheet The instance or id of the worksheet to set as active.
   * @returns {FWorksheet} The active worksheet
   * @example
   * ```ts
   * // The code below sets the given worksheet to be the active worksheet
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const sheet = fWorkbook.getSheets()[1];
   * fWorkbook.setActiveSheet(sheet);
   * ```
   */
  setActiveSheet(e) {
    return this._commandService.syncExecuteCommand(pn.id, {
      unitId: this.id,
      subUnitId: typeof e == "string" ? e : e.getSheetId()
    }), typeof e == "string" ? this.getSheetBySheetId(e) : e;
  }
  /**
   * Inserts a new worksheet into the workbook.
   * Using a default sheet name. The new sheet becomes the active sheet
   * @param {string} [sheetName] The name of the new sheet
   * @param {Pick<IInsertSheetCommandParams, 'index' | 'sheet'>} [options] The options for the new sheet
   * @param {number} [options.index] The position index where the new sheet is to be inserted
   * @param {Partial<IWorksheetData>} [options.sheet] The data configuration for the new sheet
   * @returns {FWorksheet} The new sheet
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   *
   * // Create a new sheet with default configuration
   * const newSheet = fWorkbook.insertSheet();
   * console.log(newSheet);
   *
   * // Create a new sheet with custom name and default configuration
   * const newSheetWithName = fWorkbook.insertSheet('MyNewSheet');
   * console.log(newSheetWithName);
   *
   * // Create a new sheet with custom name and custom configuration
   * const sheetData = {
   *   // ... Omit other properties
   *   cellData: {
   *     0: {
   *       0: {
   *         v: 'Hello Univer!',
   *       }
   *     }
   *   },
   *   // ... Omit other properties
   * };
   * const newSheetWithData = fWorkbook.insertSheet('MyNewSheetWithData', {
   *   index: 0,
   *   sheet: sheetData,
   * });
   * console.log(newSheetWithData);
   * ```
   */
  insertSheet(e, t3) {
    var o3, a4, h9;
    const s2 = $E(Z.deepClone((o3 = t3 == null ? void 0 : t3.sheet) != null ? o3 : {}));
    s2.name = e, s2.id = (a4 = t3 == null ? void 0 : t3.sheet) == null ? void 0 : a4.id;
    const r = (h9 = t3 == null ? void 0 : t3.index) != null ? h9 : this._workbook.getSheets().length;
    this._commandService.syncExecuteCommand(Sc.id, {
      unitId: this.id,
      index: r,
      sheet: s2
    }), this._commandService.syncExecuteCommand(pn.id, {
      unitId: this.id,
      subUnitId: this._workbook.getSheets()[r].getSheetId()
    });
    const i = this._workbook.getActiveSheet();
    if (!i)
      throw new Error("No active sheet found");
    return this._injector.createInstance(I5, this, this._workbook, i);
  }
  /**
   * Deletes the specified worksheet.
   * @param {FWorksheet | string} sheet The instance or id of the worksheet to delete.
   * @returns {boolean} True if the worksheet was deleted, false otherwise.
   * @example
   * ```ts
   * // The code below deletes the specified worksheet
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const sheet = fWorkbook.getSheets()[1];
   * fWorkbook.deleteSheet(sheet);
   *
   * // The code below deletes the specified worksheet by id
   * // fWorkbook.deleteSheet(sheet.getSheetId());
   * ```
   */
  deleteSheet(e) {
    const t3 = this.id, s2 = typeof e == "string" ? e : e.getSheetId();
    return this._commandService.syncExecuteCommand(Zs.id, {
      unitId: t3,
      subUnitId: s2
    });
  }
  // #region editing
  /**
   * Undo the last action.
   * @returns {FWorkbook} A promise that resolves to true if the undo was successful, false otherwise.
   * @example
   * ```ts
   * // The code below undoes the last action
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * fWorkbook.undo();
   * ```
   */
  undo() {
    return this._univerInstanceService.focusUnit(this.id), this._commandService.syncExecuteCommand(wC.id), this;
  }
  /**
   * Redo the last undone action.
   * @returns {FWorkbook} A promise that resolves to true if the redo was successful, false otherwise.
   * @example
   * ```ts
   * // The code below redoes the last undone action
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * fWorkbook.redo();
   * ```
   */
  redo() {
    return this._univerInstanceService.focusUnit(this.id), this._commandService.syncExecuteCommand(SC.id), this;
  }
  /**
   * Callback for command execution.
   * @callback onBeforeCommandExecuteCallback
   * @param {ICommandInfo<ISheetCommandSharedParams>} command The command that was executed.
   */
  /**
   * Register a callback that will be triggered before invoking a command targeting the Univer sheet.
   * @param {onBeforeCommandExecuteCallback} callback the callback.
   * @returns {IDisposable} A function to dispose the listening.
   * @example
   * ```ts
   * // The code below registers a callback that will be triggered before invoking a command targeting the Univer sheet
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * fWorkbook.onBeforeCommandExecute((command) => {
   *   console.log('Before command execute:', command);
   * });
   * ```
   */
  onBeforeCommandExecute(e) {
    return this._commandService.beforeCommandExecuted((t3) => {
      var s2;
      ((s2 = t3.params) == null ? void 0 : s2.unitId) === this.id && e(t3);
    });
  }
  /**
   * Callback for command execution.
   * @callback onCommandExecutedCallback
   * @param {ICommandInfo<ISheetCommandSharedParams>} command The command that was executed
   */
  /**
   * Register a callback that will be triggered when a command is invoked targeting the Univer sheet.
   * @param {onCommandExecutedCallback} callback the callback.
   * @returns {IDisposable} A function to dispose the listening.
   * @example
   * ```ts
   * // The code below registers a callback that will be triggered when a command is invoked targeting the Univer sheet
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * fWorkbook.onCommandExecuted((command) => {
   *   console.log('Command executed:', command);
   * });
   * ```
   */
  onCommandExecuted(e) {
    return this._commandService.onCommandExecuted((t3) => {
      var s2;
      ((s2 = t3.params) == null ? void 0 : s2.unitId) === this.id && e(t3);
    });
  }
  /**
   * Callback for selection changes.
   * @callback onSelectionChangeCallback
   * @param {IRange[]} selections The new selection.
   */
  /**
   * Register a callback that will be triggered when the selection changes.
   * @param {onSelectionChangeCallback} callback The callback.
   * @returns {IDisposable} A function to dispose the listening
   * @example
   * ```ts
   * // The code below registers a callback that will be triggered when the selection changes
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * fWorkbook.onSelectionChange((selections) => {
   *   console.log('Selection changed:', selections);
   * });
   * ```
   */
  onSelectionChange(e) {
    return Be(
      this._selectionManagerService.selectionMoveEnd$.subscribe((t3) => {
        this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET).getUnitId() === this.id && (t3 != null && t3.length ? e(t3.map((s2) => s2.range)) : e([]));
      })
    );
  }
  /**
   * Used to modify the editing permissions of the workbook. When the value is false, editing is not allowed.
   * @param {boolean} value  editable value want to set
   * @returns {FWorkbook} FWorkbook instance
   * @example
   * ```ts
   * // The code below sets the editing permissions of the workbook
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * fWorkbook.setEditable(false);
   * ```
   */
  setEditable(e) {
    const t3 = new Pe3(this._workbook.getUnitId());
    return this._permissionService.getPermissionPoint(t3.id) || this._permissionService.addPermissionPoint(t3), this._permissionService.updatePermissionPoint(t3.id, e), this;
  }
  /**
   * Sets the selection region for active sheet.
   * @param {FRange} range The range to set as the active selection.
   * @returns {FWorkbook} FWorkbook instance
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const range = fWorkbook.getActiveSheet().getRange('A10:B10');
   * fWorkbook.setActiveRange(range);
   * ```
   */
  setActiveRange(e) {
    const t3 = this.getActiveSheet(), s2 = e.getRange().sheetId || t3.getSheetId(), r = s2 ? this._workbook.getSheetBySheetId(s2) : this._workbook.getActiveSheet(true);
    if (!r)
      throw new Error("No active sheet found");
    r.getSheetId() !== t3.getSheetId() && this.setActiveSheet(this._injector.createInstance(I5, this, this._workbook, r));
    const i = {
      unitId: this.getId(),
      subUnitId: s2,
      selections: [e].map((o3) => ({ range: o3.getRange(), primary: _e3(o3.getRange(), r), style: null }))
    };
    return this._commandService.syncExecuteCommand(ie5.id, i), this;
  }
  /**
   * Returns the selected range in the active sheet, or null if there is no active range.
   * @returns {FRange | null} The active range
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const activeRange = fWorkbook.getActiveRange();
   * console.log(activeRange);
   * ```
   */
  // could sheet have no active range ?
  getActiveRange() {
    const e = this._workbook.getActiveSheet(), s2 = this._selectionManagerService.getCurrentSelections().find((r) => !!r.primary);
    return s2 ? this._injector.createInstance(f3, this._workbook, e, s2.range) : null;
  }
  /**
   * Returns the active cell in this spreadsheet.
   * @returns {FRange | null} The active cell
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * console.log(fWorkbook.getActiveCell().getA1Notation());
   * ```
   */
  getActiveCell() {
    const e = this._workbook.getActiveSheet(), s2 = this._selectionManagerService.getCurrentSelections().find((i) => !!i.primary);
    if (!s2)
      return null;
    const r = __spreadProps(__spreadValues({}, s2.primary), {
      rangeType: ge.NORMAL
    });
    return this._injector.createInstance(f3, this._workbook, e, r);
  }
  /**
   * Deletes the currently active sheet.
   * @returns {boolean} true if the sheet was deleted, false otherwise
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * fWorkbook.deleteActiveSheet();
   * ```
   */
  deleteActiveSheet() {
    const e = this.getActiveSheet();
    return this.deleteSheet(e);
  }
  /**
   * Duplicates the given worksheet.
   * @param {FWorksheet} sheet The worksheet to duplicate.
   * @returns {FWorksheet} The duplicated worksheet
   * @example
   * ```ts
   * // The code below duplicates the given worksheet
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const activeSheet = fWorkbook.getActiveSheet();
   * const duplicatedSheet = fWorkbook.duplicateSheet(activeSheet);
   * console.log(duplicatedSheet);
   * ```
   */
  duplicateSheet(e) {
    return this._commandService.syncExecuteCommand(gc.id, {
      unitId: e.getWorkbook().getUnitId(),
      subUnitId: e.getSheetId()
    }), this._injector.createInstance(I5, this, this._workbook, this._workbook.getActiveSheet());
  }
  /**
   * Duplicates the active sheet.
   * @returns {FWorksheet} The duplicated worksheet
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const duplicatedSheet = fWorkbook.duplicateActiveSheet();
   * console.log(duplicatedSheet);
   * ```
   */
  duplicateActiveSheet() {
    const e = this.getActiveSheet();
    return this.duplicateSheet(e);
  }
  /**
   * Get the number of sheets in the workbook.
   * @returns {number} The number of sheets in the workbook
   * @example
   * ```ts
   * // The code below gets the number of sheets in the workbook
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * console.log(fWorkbook.getNumSheets());
   * ```
   */
  getNumSheets() {
    return this._workbook.getSheets().length;
  }
  /**
   * Get the locale of the workbook.
   * @returns {LocaleType} The locale of the workbook
   * @example
   * ```ts
   * // The code below gets the locale of the workbook
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * console.log(fWorkbook.getLocale());
   * ```
   */
  getLocale() {
    return this._localeService.getCurrentLocale();
  }
  /**
   * @deprecated use `setSpreadsheetLocale` instead.
   * @param {LocaleType} locale - The locale to set
   */
  setLocale(e) {
    this._localeService.setLocale(e);
  }
  /**
   * Set the locale of the workbook.
   * @param {LocaleType} locale The locale to set
   * @returns {FWorkbook} This workbook, for chaining
   * @example
   * ```ts
   * // The code below sets the locale of the workbook
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * fWorkbook.setSpreadsheetLocale(univerAPI.Enum.LocaleType.EN_US);
   * console.log(fWorkbook.getLocale());
   * ```
   */
  setSpreadsheetLocale(e) {
    return this._localeService.setLocale(e), this;
  }
  /**
   * Get the URL of the workbook.
   * @returns {string} The URL of the workbook
   * @example
   * ```ts
   * // The code below gets the URL of the workbook
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const url = fWorkbook.getUrl();
   * console.log(url);
   * ```
   */
  getUrl() {
    return location.href;
  }
  /**
   * Move the sheet to the specified index.
   * @param {FWorksheet} sheet The sheet to move
   * @param {number} index The index to move the sheet to
   * @returns {FWorkbook} This workbook, for chaining
   * @example
   * ```ts
   * // The code below moves the sheet to the specified index
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const sheet = fWorkbook.getActiveSheet();
   * fWorkbook.moveSheet(sheet, 1);
   * ```
   */
  moveSheet(e, t3) {
    let s2 = t3;
    return s2 < 0 ? s2 = 0 : s2 > this._workbook.getSheets().length - 1 && (s2 = this._workbook.getSheets().length - 1), this._commandService.syncExecuteCommand(ci.id, {
      unitId: e.getWorkbook().getUnitId(),
      order: s2,
      subUnitId: e.getSheetId()
    }), this;
  }
  /**
   * Move the active sheet to the specified index.
   * @param {number} index The index to move the active sheet to
   * @returns {FWorkbook} This workbook, for chaining
   * @example
   * ```ts
   * // The code below moves the active sheet to the specified index
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * fWorkbook.moveActiveSheet(1);
   * ```
   */
  moveActiveSheet(e) {
    const t3 = this.getActiveSheet();
    return this.moveSheet(t3, e);
  }
  /**
   * Get the PermissionInstance.
   * @returns {FPermission} - The PermissionInstance.
   * @deprecated Use `getWorkbookPermission()` instead for the new permission API
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const permission = fWorkbook.getPermission();
   * console.log(permission);
   * ```
   */
  getPermission() {
    return this._injector.createInstance(H3);
  }
  /**
   * Get the WorkbookPermission instance for managing workbook-level permissions.
   * This is the new permission API that provides a more intuitive and type-safe interface.
   * @returns {FWorkbookPermission} - The WorkbookPermission instance.
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const permission = fWorkbook.getWorkbookPermission();
   *
   * // Set workbook to read-only mode
   * await permission.setMode('viewer');
   *
   * // Add a collaborator
   * await permission.addCollaborator({
   *   userId: 'user123',
   *   name: 'John Doe',
   *   role: 'editor'
   * });
   *
   * // Subscribe to permission changes
   * permission.permission$.subscribe(snapshot => {
   *   console.log('Permissions changed:', snapshot);
   * });
   * ```
   */
  getWorkbookPermission() {
    return this._injector.createInstance(Te3, this._workbook.getUnitId());
  }
  /**
   * Get the defined name by name.
   * @param {string} name The name of the defined name to get
   * @returns {FDefinedName | null} The defined name with the given name
   * @example
   * ```ts
   * // The code below gets the defined name by name
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const definedName = fWorkbook.getDefinedName('MyDefinedName');
   * console.log(definedName?.getFormulaOrRefString());
   *
   * if (definedName) {
   *   definedName.setName('NewDefinedName');
   * }
   * ```
   */
  getDefinedName(e) {
    const t3 = this._definedNamesService.getValueByName(this.id, e);
    return t3 ? this._injector.createInstance(_e5, __spreadProps(__spreadValues({}, t3), { unitId: this.id })) : null;
  }
  /**
   * Get all the defined names in the workbook.
   * @returns {FDefinedName[]} All the defined names in the workbook
   * @example
   * ```ts
   * // The code below gets all the defined names in the workbook
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const definedNames = fWorkbook.getDefinedNames();
   * console.log(definedNames, definedNames[0]?.getFormulaOrRefString());
   * ```
   */
  getDefinedNames() {
    const e = this._definedNamesService.getDefinedNameMap(this.id);
    return e ? Object.values(e).map((t3) => this._injector.createInstance(_e5, __spreadProps(__spreadValues({}, t3), { unitId: this.id }))) : [];
  }
  /**
   * Insert a defined name.
   * @param {string} name The name of the defined name to insert
   * @param {string} formulaOrRefString The formula(=sum(A2:b10)) or reference(A1) string of the defined name to insert
   * @returns {FWorkbook} The current FWorkbook instance
   * @example
   * ```ts
   * // The code below inserts a defined name
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * fWorkbook.insertDefinedName('MyDefinedName', 'Sheet1!$A$1');
   * ```
   */
  insertDefinedName(e, t3) {
    const r = this._injector.createInstance(Se4).setName(e).setRef(t3).build();
    return r.localSheetId = mg, this.insertDefinedNameBuilder(r), this;
  }
  /**
   * Delete the defined name with the given name.
   * @param {string} name The name of the defined name to delete
   * @returns {boolean} true if the defined name was deleted, false otherwise
   * @example
   * ```ts
   * // The code below deletes the defined name with the given name
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * fWorkbook.deleteDefinedName('MyDefinedName');
   * ```
   */
  deleteDefinedName(e) {
    const t3 = this.getDefinedName(e);
    return t3 ? (t3.delete(), true) : false;
  }
  /**
   * Insert a defined name by builder param.
   * @param {ISetDefinedNameMutationParam} param The param to insert the defined name
   * @returns {void}
   * @example
   * ```ts
   * // The code below inserts a defined name by builder param
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const definedNameBuilder = univerAPI.newDefinedName()
   *   .setRef('Sheet1!$A$1')
   *   .setName('MyDefinedName')
   *   .setComment('This is a comment')
   *   .build();
   * fWorkbook.insertDefinedNameBuilder(definedNameBuilder);
   * ```
   */
  insertDefinedNameBuilder(e) {
    e.unitId = this.getId(), this._commandService.syncExecuteCommand(ni.id, e);
  }
  /**
   * Update the defined name with the given name.
   * @param {ISetDefinedNameMutationParam} param The param to insert the defined name
   * @returns {void}
   * @example
   * ```ts
   * // The code below updates the defined name with the given name
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const definedName = fWorkbook.getDefinedName('MyDefinedName');
   * console.log(definedName?.getFormulaOrRefString());
   *
   * // Update the defined name
   * if (definedName) {
   *   const newDefinedNameParam = definedName.toBuilder()
   *     .setName('NewDefinedName')
   *     .setRef('Sheet1!$A$2')
   *     .build();
   *   fWorkbook.updateDefinedNameBuilder(newDefinedNameParam);
   * }
   * ```
   */
  updateDefinedNameBuilder(e) {
    this._commandService.syncExecuteCommand(ni.id, e);
  }
  /**
   * Gets the registered range themes.
   * @returns {string[]} The name list of registered range themes.
   * @example
   * ```ts
   * // The code below gets the registered range themes
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const themes = fWorkbook.getRegisteredRangeThemes();
   * console.log(themes);
   * ```
   */
  getRegisteredRangeThemes() {
    return this._injector.get(Os2).getRegisteredRangeThemes();
  }
  /**
   * Register a custom range theme style.
   * @param {RangeThemeStyle} rangeThemeStyle The range theme style to register
   * @returns {void}
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const rangeThemeStyle = fWorkbook.createRangeThemeStyle('MyTheme', {
   *   secondRowStyle: {
   *     bg: {
   *       rgb: 'rgb(214,231,241)',
   *     },
   *   },
   * });
   * fWorkbook.registerRangeTheme(rangeThemeStyle);
   * ```
   */
  registerRangeTheme(e) {
    this._commandService.syncExecuteCommand(wc.id, {
      unitId: this.getId(),
      rangeThemeStyle: e
    });
  }
  /**
   * Unregister a custom range theme style.
   * @param {string} themeName The name of the theme to unregister
   * @returns {void}
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * fWorkbook.unregisterRangeTheme('MyTheme');
   * ```
   */
  unregisterRangeTheme(e) {
    this._commandService.syncExecuteCommand(pd.id, {
      unitId: this.getId(),
      themeName: e
    });
  }
  /**
   * Create a range theme style.
   * @param {string} themeName - The name of the theme to register
   * @param {Omit<IRangeThemeStyleJSON, 'name'>} themeStyleJson - The theme style json to register
   * @returns {RangeThemeStyle} - The created range theme style
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const rangeThemeStyle = fWorkbook.createRangeThemeStyle('MyTheme', {
   *   secondRowStyle: {
   *     bg: {
   *       rgb: 'rgb(214,231,241)',
   *     },
   *   },
   * });
   * console.log(rangeThemeStyle);
   * ```
   */
  createRangeThemeStyle(e, t3) {
    return new Rt(e, t3);
  }
  /**
   * Set custom metadata of workbook
   * @param {CustomData | undefined} custom custom metadata
   * @returns {FWorkbook} FWorkbook
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * fWorkbook.setCustomMetadata({ key: 'value' });
   * ```
   */
  setCustomMetadata(e) {
    return this._workbook.setCustomMetadata(e), this;
  }
  /**
   * Get custom metadata of workbook
   * @returns {CustomData | undefined} custom metadata
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const custom = fWorkbook.getCustomMetadata();
   * console.log(custom);
   * ```
   */
  getCustomMetadata() {
    return this._workbook.getCustomMetadata();
  }
  /**
   * Add styles to the workbook styles.
   * @param {Record<string, IStyleData>} styles Styles to add
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   *
   * // Add styles to the workbook styles
   * const styles = {
   *   'custom-style-1': {
   *     bg: {
   *       rgb: 'rgb(255, 0, 0)',
   *     }
   *   },
   *   'custom-style-2': {
   *     fs: 20,
   *     n: {
   *       pattern: '@'
   *     }
   *   }
   * };
   * fWorkbook.addStyles(styles);
   *
   * // Set values with the new styles
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * fRange.setValues([
   *   [{ v: 'Hello', s: 'custom-style-1' }, { v: 'Univer', s: 'custom-style-1' }],
   *   [{ v: 'To', s: 'custom-style-1' }, { v: '0001', s: 'custom-style-2' }],
   * ]);
   * ```
   */
  addStyles(e) {
    this._workbook.addStyles(e);
  }
  /**
   * Remove styles from the workbook styles.
   * @param {string[]} styleKeys Style keys to remove
   * @example
   * ```ts
   * const fWorkbook = univerAPI.getActiveWorkbook();
   *
   * // Add styles to the workbook styles
   * const styles = {
   *   'custom-style-1': {
   *     bg: {
   *       rgb: 'rgb(255, 0, 0)',
   *     }
   *   },
   *   'custom-style-2': {
   *     fs: 20,
   *     n: {
   *       pattern: '@'
   *     }
   *   }
   * };
   * fWorkbook.addStyles(styles);
   *
   * // Set values with the new styles
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1:B2');
   * fRange.setValues([
   *   [{ v: 'Hello', s: 'custom-style-1' }, { v: 'Univer', s: 'custom-style-1' }],
   *   [{ v: 'To', s: 'custom-style-1' }, { v: '0001', s: 'custom-style-2' }],
   * ]);
   *
   * // Remove the style `custom-style-1` after 2 seconds
   * setTimeout(() => {
   *   fWorkbook.removeStyles(['custom-style-1']);
   *   fWorksheet.refreshCanvas();
   * }, 2000);
   * ```
   */
  removeStyles(e) {
    this._workbook.removeStyles(e);
  }
};
R2 = Zn4([
  W3(1, Inject(Injector)),
  W3(2, Inject(Nl)),
  W3(3, Inject(z)),
  W3(4, br),
  W3(5, Ds),
  W3(6, aC),
  W3(7, Nt),
  W3(8, Inject(Hn)),
  W3(9, Lr)
], R2);
var Qn4 = class extends I2 {
  getCommandSheetTarget(e) {
    var i;
    const t3 = e.params;
    if (!t3) return this.getActiveSheet();
    const s2 = t3.unitId ? this.getUniverSheet(t3.unitId) : (i = this.getActiveWorkbook) == null ? void 0 : i.call(this);
    if (!s2)
      return;
    const r = s2.getSheetBySheetId(t3.subUnitId || t3.sheetId) || s2.getActiveSheet();
    if (r)
      return { workbook: s2, worksheet: r };
  }
  getSheetTarget(e, t3) {
    const s2 = this.getUniverSheet(e);
    if (!s2)
      return;
    const r = s2.getSheetBySheetId(t3);
    if (r)
      return { workbook: s2, worksheet: r };
  }
  _initWorkbookEvent(e) {
    const t3 = e.get(br);
    this.registerEventHandler(
      this.Event.WorkbookDisposed,
      () => t3.unitDisposed$.subscribe((s2) => {
        s2.type === we.UNIVER_SHEET && this.fireEvent(this.Event.WorkbookDisposed, {
          unitId: s2.getUnitId(),
          unitType: s2.type,
          snapshot: s2.getSnapshot()
        });
      })
    ), this.registerEventHandler(
      this.Event.WorkbookCreated,
      () => t3.unitAdded$.subscribe((s2) => {
        if (s2.type === we.UNIVER_SHEET) {
          const r = s2, i = e.createInstance(R2, r);
          this.fireEvent(this.Event.WorkbookCreated, {
            unitId: s2.getUnitId(),
            type: s2.type,
            workbook: i,
            unit: i
          });
        }
      })
    );
  }
  /**
   * @ignore
   */
  // eslint-disable-next-line max-lines-per-function
  _initialize(e) {
    const t3 = e.get(Ds);
    this.registerEventHandler(
      this.Event.BeforeSheetCreate,
      () => t3.beforeCommandExecuted((s2) => {
        var r;
        if (s2.id === Sc.id) {
          const i = s2.params, { unitId: o3, index: a4, sheet: h9 } = i || {}, c2 = o3 ? this.getUniverSheet(o3) : (r = this.getActiveWorkbook) == null ? void 0 : r.call(this);
          if (!c2)
            return;
          const d2 = {
            workbook: c2,
            index: a4,
            sheet: h9
          };
          if (this.fireEvent(this.Event.BeforeSheetCreate, d2), d2.cancel)
            throw new tR();
        }
      })
    ), this.registerEventHandler(
      this.Event.BeforeActiveSheetChange,
      () => t3.beforeCommandExecuted((s2) => {
        var r;
        if (s2.id === pn.id) {
          const { subUnitId: i, unitId: o3 } = s2.params, a4 = o3 ? this.getUniverSheet(o3) : (r = this.getActiveWorkbook) == null ? void 0 : r.call(this);
          if (!a4 || !i) return;
          const h9 = a4.getSheetBySheetId(i), c2 = a4.getActiveSheet();
          if (!h9 || !c2) return;
          const d2 = {
            workbook: a4,
            activeSheet: h9,
            oldActiveSheet: c2
          };
          if (this.fireEvent(this.Event.BeforeActiveSheetChange, d2), d2.cancel)
            throw new tR();
        }
      })
    ), this.registerEventHandler(
      this.Event.BeforeSheetDelete,
      () => t3.beforeCommandExecuted((s2) => {
        if (s2.id === Zs.id) {
          const r = this.getCommandSheetTarget(s2);
          if (!r) return;
          const { workbook: i, worksheet: o3 } = r, a4 = {
            workbook: i,
            worksheet: o3
          };
          if (this.fireEvent(this.Event.BeforeSheetDelete, a4), a4.cancel)
            throw new tR();
        }
      })
    ), this.registerEventHandler(
      this.Event.BeforeSheetMove,
      () => t3.beforeCommandExecuted((s2) => {
        if (s2.id === Tn2.id) {
          const { fromOrder: r, toOrder: i } = s2.params, o3 = this.getCommandSheetTarget(s2);
          if (!o3) return;
          const a4 = {
            workbook: o3.workbook,
            worksheet: o3.worksheet,
            newIndex: i,
            oldIndex: r
          };
          if (this.fireEvent(this.Event.BeforeSheetMove, a4), a4.cancel)
            throw new tR();
        }
      })
    ), this.registerEventHandler(
      this.Event.BeforeSheetNameChange,
      () => t3.beforeCommandExecuted((s2) => {
        if (s2.id === eo2.id) {
          const { name: r } = s2.params, i = this.getCommandSheetTarget(s2);
          if (!i) return;
          const o3 = {
            workbook: i.workbook,
            worksheet: i.worksheet,
            newName: r,
            oldName: i.worksheet.getSheetName()
          };
          if (this.fireEvent(this.Event.BeforeSheetNameChange, o3), o3.cancel)
            throw new tR();
        }
      })
    ), this.registerEventHandler(
      this.Event.BeforeSheetTabColorChange,
      () => t3.beforeCommandExecuted((s2) => {
        if (s2.id === Un4.id) {
          const { color: r } = s2.params, i = this.getCommandSheetTarget(s2);
          if (!i) return;
          const o3 = {
            workbook: i.workbook,
            worksheet: i.worksheet,
            newColor: r,
            oldColor: i.worksheet.getTabColor()
          };
          if (this.fireEvent(this.Event.BeforeSheetTabColorChange, o3), o3.cancel)
            throw new tR();
        }
      })
    ), this.registerEventHandler(
      this.Event.BeforeSheetHideChange,
      () => t3.beforeCommandExecuted((s2) => {
        if (s2.id === St2.id) {
          const { hidden: r } = s2.params, i = this.getCommandSheetTarget(s2);
          if (!i) return;
          const o3 = {
            workbook: i.workbook,
            worksheet: i.worksheet,
            hidden: !!r
          };
          if (this.fireEvent(this.Event.BeforeSheetHideChange, o3), o3.cancel)
            throw new tR();
        }
      })
    ), this.registerEventHandler(
      this.Event.BeforeGridlineColorChange,
      () => t3.beforeCommandExecuted((s2) => {
        var r;
        if (s2.id === Wc.id) {
          const i = this.getCommandSheetTarget(s2);
          if (!i) return;
          const o3 = __spreadProps(__spreadValues({}, i), {
            color: (r = s2.params) == null ? void 0 : r.color
          });
          if (this.fireEvent(this.Event.BeforeGridlineColorChange, o3), o3.cancel)
            throw new tR();
        }
      })
    ), this.registerEventHandler(
      this.Event.BeforeGridlineEnableChange,
      () => t3.beforeCommandExecuted((s2) => {
        var r;
        if (s2.id === Cd.id) {
          const i = this.getCommandSheetTarget(s2);
          if (!i) return;
          const o3 = __spreadProps(__spreadValues({}, i), {
            enabled: !!((r = s2.params) != null && r.showGridlines)
          });
          if (this.fireEvent(this.Event.BeforeGridlineEnableChange, o3), o3.cancel)
            throw new tR();
        }
      })
    ), this.registerEventHandler(
      this.Event.SheetValueChanged,
      () => t3.onCommandExecuted((s2) => {
        if (Eh2.indexOf(s2.id) > -1) {
          if (!this.getActiveSheet()) return;
          const i = kh(s2).map(
            (o3) => {
              var a4, h9;
              return (h9 = (a4 = this.getWorkbook(o3.unitId)) == null ? void 0 : a4.getSheetBySheetId(o3.subUnitId)) == null ? void 0 : h9.getRange(o3.range);
            }
          ).filter(Boolean);
          if (!i.length) return;
          this.fireEvent(this.Event.SheetValueChanged, {
            payload: s2,
            effectedRanges: i
          });
        }
      })
    ), this.registerEventHandler(
      this.Event.SheetCreated,
      () => t3.onCommandExecuted((s2) => {
        var r;
        if (s2.id === Sc.id) {
          const i = s2.params, { unitId: o3 } = i || {}, a4 = o3 ? this.getUniverSheet(o3) : (r = this.getActiveWorkbook) == null ? void 0 : r.call(this);
          if (!a4)
            return;
          const h9 = a4.getActiveSheet();
          if (!h9)
            return;
          const c2 = {
            workbook: a4,
            worksheet: h9
          };
          this.fireEvent(
            this.Event.SheetCreated,
            c2
          );
        }
      })
    ), this.registerEventHandler(
      this.Event.ActiveSheetChanged,
      () => t3.onCommandExecuted((s2) => {
        if (s2.id === pn.id) {
          const r = this.getActiveSheet();
          if (!r) return;
          const { workbook: i, worksheet: o3 } = r;
          this._fireActiveSheetChanged(i, o3);
        }
      })
    ), this.registerEventHandler(
      this.Event.SheetDeleted,
      () => t3.onCommandExecuted((s2) => {
        var r;
        if (s2.id === Zs.id) {
          const { subUnitId: i, unitId: o3 } = s2.params, a4 = o3 ? this.getUniverSheet(o3) : (r = this.getActiveWorkbook) == null ? void 0 : r.call(this);
          if (!a4 || !i) return;
          this._fireSheetDeleted(a4, i);
        }
      })
    ), this.registerEventHandler(
      this.Event.SheetMoved,
      () => t3.onCommandExecuted((s2) => {
        if (s2.id === Tn2.id) {
          const { toOrder: r } = s2.params, i = this.getCommandSheetTarget(s2);
          if (!i) return;
          this._fireSheetMoved(i.workbook, i.worksheet, r);
        }
      })
    ), this.registerEventHandler(
      this.Event.SheetNameChanged,
      () => t3.onCommandExecuted((s2) => {
        if (s2.id === eo2.id) {
          const { name: r } = s2.params, i = this.getCommandSheetTarget(s2);
          if (!i) return;
          this._fireSheetNameChanged(i.workbook, i.worksheet, r);
        }
      })
    ), this.registerEventHandler(
      this.Event.SheetTabColorChanged,
      () => t3.onCommandExecuted((s2) => {
        if (s2.id === Un4.id) {
          const { color: r } = s2.params, i = this.getCommandSheetTarget(s2);
          if (!i) return;
          this._fireSheetTabColorChanged(i.workbook, i.worksheet, r);
        }
      })
    ), this.registerEventHandler(
      this.Event.SheetHideChanged,
      () => t3.onCommandExecuted((s2) => {
        if (s2.id === St2.id) {
          const { hidden: r } = s2.params, i = this.getCommandSheetTarget(s2);
          if (!i) return;
          this._fireSheetHideChanged(i.workbook, i.worksheet, !!r);
        }
      })
    ), this.registerEventHandler(
      this.Event.GridlineChanged,
      () => t3.onCommandExecuted((s2) => {
        if (s2.id === Wc.id || s2.id === Cd.id) {
          const r = this.getCommandSheetTarget(s2);
          if (!r) return;
          this.fireEvent(this.Event.GridlineChanged, __spreadProps(__spreadValues({}, r), {
            enabled: !r.worksheet.hasHiddenGridLines(),
            color: r.worksheet.getGridLinesColor()
          }));
        }
      })
    ), this._initWorkbookEvent(e);
  }
  createUniverSheet(e, t3) {
    const r = this._injector.get(br).createUnit(we.UNIVER_SHEET, e, t3);
    return this._injector.createInstance(R2, r);
  }
  createWorkbook(e, t3) {
    return this.createUniverSheet(e, t3);
  }
  getActiveWorkbook() {
    const e = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET);
    return e ? this._injector.createInstance(R2, e) : null;
  }
  getActiveUniverSheet() {
    return this.getActiveWorkbook();
  }
  getUniverSheet(e) {
    const t3 = this._univerInstanceService.getUnit(e, we.UNIVER_SHEET);
    return t3 ? this._injector.createInstance(R2, t3) : null;
  }
  getWorkbook(e) {
    return this.getUniverSheet(e);
  }
  getPermission() {
    return this._injector.createInstance(H3);
  }
  onUniverSheetCreated(e) {
    const t3 = this._univerInstanceService.getTypeOfUnitAdded$(we.UNIVER_SHEET).subscribe((s2) => {
      const r = this._injector.createInstance(R2, s2);
      e(r);
    });
    return Be(t3);
  }
  newDefinedName() {
    return this._injector.createInstance(Se4);
  }
  getActiveSheet() {
    const e = this.getActiveWorkbook();
    if (!e)
      return null;
    const t3 = e.getActiveSheet();
    return t3 ? { workbook: e, worksheet: t3 } : null;
  }
  setFreezeSync(e) {
    this._injector.get(qn3).setEnabled(e);
  }
  _fireActiveSheetChanged(e, t3) {
    this.fireEvent(this.Event.ActiveSheetChanged, {
      workbook: e,
      activeSheet: t3
    });
  }
  _fireSheetDeleted(e, t3) {
    this.fireEvent(this.Event.SheetDeleted, {
      workbook: e,
      sheetId: t3
    });
  }
  _fireSheetMoved(e, t3, s2) {
    this.fireEvent(this.Event.SheetMoved, {
      workbook: e,
      worksheet: t3,
      newIndex: s2
    });
  }
  _fireSheetNameChanged(e, t3, s2) {
    this.fireEvent(this.Event.SheetNameChanged, {
      workbook: e,
      worksheet: t3,
      newName: s2
    });
  }
  _fireSheetTabColorChanged(e, t3, s2) {
    this.fireEvent(this.Event.SheetTabColorChanged, {
      workbook: e,
      worksheet: t3,
      newColor: s2
    });
  }
  _fireSheetHideChanged(e, t3, s2) {
    this.fireEvent(this.Event.SheetHideChanged, {
      workbook: e,
      worksheet: t3,
      hidden: s2
    });
  }
};
I2.extend(Qn4);
var Xn7 = class {
  get SheetValueChangeType() {
    return hu;
  }
  get SheetSkeletonChangeType() {
    return du;
  }
  get SplitDelimiterType() {
    return vu;
  }
  get UnitRole() {
    return te3;
  }
  get WorkbookPermissionPoint() {
    return u;
  }
  get WorksheetPermissionPoint() {
    return m3;
  }
  get RangePermissionPoint() {
    return k5;
  }
};
O.extend(Xn7);
var er6 = class {
  get SheetCreated() {
    return "SheetCreated";
  }
  get BeforeSheetCreate() {
    return "BeforeSheetCreate";
  }
  get WorkbookCreated() {
    return "WorkbookCreated";
  }
  get WorkbookDisposed() {
    return "WorkbookDisposed";
  }
  get GridlineChanged() {
    return "GridlineChanged";
  }
  get BeforeGridlineEnableChange() {
    return "BeforeGridlineEnableChange";
  }
  get BeforeGridlineColorChange() {
    return "BeforeGridlineColorChange";
  }
  get BeforeActiveSheetChange() {
    return "BeforeActiveSheetChange";
  }
  get ActiveSheetChanged() {
    return "ActiveSheetChanged";
  }
  get SheetDeleted() {
    return "SheetDeleted";
  }
  get BeforeSheetDelete() {
    return "BeforeSheetDelete";
  }
  get SheetMoved() {
    return "SheetMoved";
  }
  get BeforeSheetMove() {
    return "BeforeSheetMove";
  }
  get SheetNameChanged() {
    return "SheetNameChanged";
  }
  get BeforeSheetNameChange() {
    return "BeforeSheetNameChange";
  }
  get SheetTabColorChanged() {
    return "SheetTabColorChanged";
  }
  get BeforeSheetTabColorChange() {
    return "BeforeSheetTabColorChange";
  }
  get SheetHideChanged() {
    return "SheetHideChanged";
  }
  get BeforeSheetHideChange() {
    return "BeforeSheetHideChange";
  }
  get SheetValueChanged() {
    return "SheetValueChanged";
  }
};
j.extend(er6);
var tr5 = Object.getOwnPropertyDescriptor;
var sr6 = (n3, e, t3, s2) => {
  for (var r = s2 > 1 ? void 0 : s2 ? tr5(e, t3) : e, i = n3.length - 1, o3; i >= 0; i--)
    (o3 = n3[i]) && (r = o3(r) || r);
  return r;
};
var nr7 = (n3, e) => (t3, s2) => e(t3, s2, n3);
var gt3 = class extends $ {
  constructor(n3) {
    super(), this._injector = n3;
  }
};
gt3 = sr6([
  nr7(0, Inject(Injector))
], gt3);

// node_modules/@univerjs/ui/lib/es/facade.js
var B3 = Object.defineProperty;
var R4 = (n3, e, t3) => e in n3 ? B3(n3, e, { enumerable: true, configurable: true, writable: true, value: t3 }) : n3[e] = t3;
var o = (n3, e, t3) => R4(n3, typeof e != "symbol" ? e + "" : e, t3);
var Q6 = Object.getOwnPropertyDescriptor;
var x6 = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? Q6(e, t3) : e, s2 = n3.length - 1, c2; s2 >= 0; s2--)
    (c2 = n3[s2]) && (i = c2(i) || i);
  return i;
};
var d = (n3, e) => (t3, r) => e(t3, r, n3);
var D4 = class extends $ {
  /**
   * Append the menu to any menu position on Univer UI.
   * @param {string | string[]} path - Some predefined path to append the menu. The paths can be an array,
   * or an array joined by `|` separator. Since lots of submenus reuse the same name,
   * you may need to specify their parent menus as well.
   *
   * @example
   * ```typescript
   * // This menu item will appear on every `contextMenu.others` section.
   * univerAPI.createMenu({
   *   id: 'custom-menu-id-1',
   *   title: 'Custom Menu 1',
   *   action: () => {
   *     console.log('Custom Menu 1 clicked');
   *   },
   * }).appendTo('contextMenu.others');
   *
   * // This menu item will only appear on the `contextMenu.others` section on the main area.
   * univerAPI.createMenu({
   *   id: 'custom-menu-id-2',
   *   title: 'Custom Menu 2',
   *   action: () => {
   *     console.log('Custom Menu 2 clicked');
   *   },
   * }).appendTo(['contextMenu.mainArea', 'contextMenu.others']);
   * ```
   */
  appendTo(e) {
    const t3 = typeof e == "string" ? e.split("|") : e, r = t3.length, i = {};
    let s2 = i;
    const c2 = this.__getSchema();
    t3.forEach((S, F7) => {
      F7 === r - 1 ? s2[S] = c2 : s2[S] = {}, s2 = s2[S];
    }), this._menuManagerService.mergeMenu(i);
  }
};
var a2;
var p = (a2 = class extends D4 {
  constructor(e, t3, r, i) {
    super();
    o(this, "_commandToRegister", /* @__PURE__ */ new Map());
    o(this, "_buildingSchema");
    this._item = e, this._injector = t3, this._commandService = r, this._menuManagerService = i;
    const s2 = typeof e.action == "string" ? e.action : et(12);
    s2 !== e.action && this._commandToRegister.set(s2, e.action), this._buildingSchema = {
      // eslint-disable-next-line ts/explicit-function-return-type
      menuItemFactory: () => ({
        id: e.id,
        type: H12.BUTTON,
        // we only support button for now
        icon: e.icon,
        title: e.title,
        tooltip: e.tooltip,
        commandId: s2
      })
    }, typeof e.order < "u" && (this._buildingSchema.order = e.order);
  }
  /**
   * @ignore
   */
  __getSchema() {
    return this._commandToRegister.forEach((e, t3) => {
      this._commandService.hasCommand(t3) || this._commandService.registerCommand({
        id: t3,
        type: Ls.COMMAND,
        handler: e
      });
    }), { [this._item.id]: this._buildingSchema };
  }
}, o(a2, "RibbonStartGroup", Y12), o(a2, "RibbonPosition", _1), o(a2, "MenuManagerPosition", Fe2), a2);
p = x6([
  d(1, Inject(Injector)),
  d(2, Ds),
  d(3, Z1)
], p);
var l2 = class extends D4 {
  constructor(e, t3, r) {
    super();
    o(this, "_menuByGroups", []);
    o(this, "_submenus", []);
    o(this, "_buildingSchema");
    this._item = e, this._injector = t3, this._menuManagerService = r, this._buildingSchema = {
      // eslint-disable-next-line ts/explicit-function-return-type
      menuItemFactory: () => ({
        id: e.id,
        type: H12.SUBITEMS,
        icon: e.icon,
        title: e.title,
        tooltip: e.tooltip
      })
    }, typeof e.order < "u" && (this._buildingSchema.order = e.order);
  }
  /**
   * Add a menu to the submenu. It can be a {@link FMenu} or a {@link FSubmenu}.
   * @param {FMenu | FSubmenu} submenu - Menu to add to the submenu.
   * @returns {FSubmenu} The FSubmenu itself for chaining calls.
   * @example
   * ```typescript
   * // Create two leaf menus.
   * const menu1 = univerAPI.createMenu({
   *   id: 'submenu-nested-1',
   *   title: 'Item 1',
   *   action: () => {
   *     console.log('Item 1 clicked');
   *   }
   * });
   * const menu2 = univerAPI.createMenu({
   *   id: 'submenu-nested-2',
   *   title: 'Item 2',
   *   action: () => {
   *     console.log('Item 2 clicked');
   *   }
   * });
   *
   * // Add the leaf menus to a submenu.
   * const submenu = univerAPI.createSubmenu({ id: 'submenu-nested', title: 'Nested Submenu' })
   *   .addSubmenu(menu1)
   *   .addSeparator()
   *   .addSubmenu(menu2);
   *
   * // Create a root submenu append to the `contextMenu.others` section.
   * univerAPI.createSubmenu({ id: 'custom-submenu', title: 'Custom Submenu' })
   *   .addSubmenu(submenu)
   *   .appendTo('contextMenu.others');
   * ```
   */
  addSubmenu(e) {
    return this._submenus.push(e), this;
  }
  /**
   * Add a separator to the submenu.
   * @returns {FSubmenu} The FSubmenu itself for chaining calls.
   * @example
   * ```typescript
   * // Create two leaf menus.
   * const menu1 = univerAPI.createMenu({
   *   id: 'submenu-nested-1',
   *   title: 'Item 1',
   *   action: () => {
   *     console.log('Item 1 clicked');
   *   }
   * });
   * const menu2 = univerAPI.createMenu({
   *   id: 'submenu-nested-2',
   *   title: 'Item 2',
   *   action: () => {
   *     console.log('Item 2 clicked');
   *   }
   * });
   *
   * // Add the leaf menus to a submenu and add a separator between them.
   * // Append the submenu to the `contextMenu.others` section.
   * univerAPI.createSubmenu({ id: 'submenu-nested', title: 'Nested Submenu' })
   *   .addSubmenu(menu1)
   *   .addSeparator()
   *   .addSubmenu(menu2)
   *   .appendTo('contextMenu.others');
   * ```
   */
  addSeparator() {
    return this._menuByGroups.push(this._submenus), this._submenus = [], this;
  }
  /**
   * @ignore
   */
  __getSchema() {
    const e = {};
    return this.addSeparator(), this._menuByGroups.forEach((t3, r) => {
      const i = {};
      t3.forEach((s2) => {
        Object.assign(i, s2.__getSchema());
      }), e[`${this._item.id}-group-${r}`] = i;
    }), { [this._item.id]: Object.assign(this._buildingSchema, e) };
  }
};
l2 = x6([
  d(1, Inject(Injector)),
  d(2, Z1)
], l2);
var X8 = Object.getOwnPropertyDescriptor;
var Y6 = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? X8(e, t3) : e, s2 = n3.length - 1, c2; s2 >= 0; s2--)
    (c2 = n3[s2]) && (i = c2(i) || i);
  return i;
};
var h6 = (n3, e) => (t3, r) => e(t3, r, n3);
var b2 = class extends $ {
  constructor(e, t3, r, i) {
    super();
    o(this, "_forceDisableDisposable", null);
    this._injector = e, this._renderManagerService = t3, this._univerInstanceService = r, this._shortcutService = i;
  }
  /**
   * Enable shortcuts of Univer.
   * @returns {FShortcut} The Facade API instance itself for chaining.
   *
   * @example
   * ```typescript
   * fShortcut.enableShortcut(); // Use the FShortcut instance used by disableShortcut before, do not create a new instance
   * ```
   */
  enableShortcut() {
    var e;
    return (e = this._forceDisableDisposable) == null || e.dispose(), this._forceDisableDisposable = null, this;
  }
  /**
   * Disable shortcuts of Univer.
   * @returns {FShortcut} The Facade API instance itself for chaining.
   *
   * @example
   * ```typescript
   * const fShortcut = univerAPI.getShortcut();
   * fShortcut.disableShortcut();
   * ```
   */
  disableShortcut() {
    return this._forceDisableDisposable || (this._forceDisableDisposable = this._shortcutService.forceDisable()), this;
  }
  /**
   * Trigger shortcut of Univer by a KeyboardEvent and return the matched shortcut item.
   * @param {KeyboardEvent} e - The KeyboardEvent to trigger.
   * @returns {IShortcutItem<object> | undefined} The matched shortcut item.
   *
   * @example
   * ```typescript
   * // Assum the current sheet is empty sheet.
   * const fWorkbook = univerAPI.getActiveWorkbook();
   * const fWorksheet = fWorkbook.getActiveSheet();
   * const fRange = fWorksheet.getRange('A1');
   *
   * // Set A1 cell active and set value to 'Hello Univer'.
   * fRange.activate();
   * fRange.setValue('Hello Univer');
   * console.log(fRange.getCellStyle().bold); // false
   *
   * // Set A1 cell bold by shortcut.
   * const fShortcut = univerAPI.getShortcut();
   * const pseudoEvent = new KeyboardEvent('keydown', {
   *   key: 'b',
   *   ctrlKey: true,
   *   keyCode: univerAPI.Enum.KeyCode.B
   * });
   * const ifShortcutItem = fShortcut.triggerShortcut(pseudoEvent);
   * if (ifShortcutItem) {
   *   const commandId = ifShortcutItem.id;
   *   console.log(fRange.getCellStyle().bold); // true
   * }
   * ```
   */
  triggerShortcut(e) {
    const t3 = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET);
    if (!t3)
      return;
    const r = this._renderManagerService.getRenderById(t3.getUnitId());
    return r ? (r.engine.getCanvasElement().dispatchEvent(e), this._shortcutService.dispatch(e)) : void 0;
  }
  /**
   * Dispatch a KeyboardEvent to the shortcut service and return the matched shortcut item.
   * @param {KeyboardEvent} e - The KeyboardEvent to dispatch.
   * @returns {IShortcutItem<object> | undefined} The matched shortcut item.
   *
   * @example
   * ```typescript
   * const fShortcut = univerAPI.getShortcut();
   * const pseudoEvent = new KeyboardEvent('keydown', { key: 's', ctrlKey: true });
   * const ifShortcutItem = fShortcut.dispatchShortcutEvent(pseudoEvent);
   * if (ifShortcutItem) {
   *   const commandId = ifShortcutItem.id;
   *   // Do something with the commandId.
   * }
   * ```
   */
  dispatchShortcutEvent(e) {
    return this._shortcutService.dispatch(e);
  }
};
b2 = Y6([
  h6(0, Inject(Injector)),
  h6(1, Inject(JE)),
  h6(2, br),
  h6(3, Le)
], b2);
var Z8 = class extends I2 {
  getURL() {
    return new URL(window.location.href);
  }
  getShortcut() {
    return this._injector.createInstance(b2);
  }
  copy() {
    return this._commandService.executeCommand(jn2.id);
  }
  paste() {
    return this._commandService.executeCommand(zn.id);
  }
  createMenu(e) {
    return this._injector.createInstance(p, e);
  }
  createSubmenu(e) {
    return this._injector.createInstance(l2, e);
  }
  openSiderbar(e) {
    return this._injector.get(be2).open(e);
  }
  openSidebar(e) {
    return this.openSiderbar(e);
  }
  openDialog(e) {
    const r = this._injector.get(ct2).open(__spreadProps(__spreadValues({}, e), {
      onClose: () => {
        r.dispose();
      }
    }));
    return r;
  }
  getComponentManager() {
    return this._injector.get(S13);
  }
  showMessage(e) {
    return this._injector.get(et2).show(e), this;
  }
  setUIVisible(e, t3) {
    return this._injector.get(N1).setUIVisible(e, t3), this;
  }
  isUIVisible(e) {
    return this._injector.get(N1).isUIVisible(e);
  }
  registerUIPart(e, t3) {
    return this._injector.get(N1).registerComponent(e, () => connectInjector(t3, this._injector));
  }
  registerComponent(e, t3, r) {
    const i = this._injector.get(S13);
    return this.disposeWithMe(i.register(e, t3, r));
  }
  setCurrent(e) {
    if (!this._injector.get(JE).getRenderById(e))
      throw new Error("Unit not found");
    this._univerInstanceService.setCurrentUnitForType(e);
  }
  addFonts(e) {
    const t3 = this._injector.get(An);
    e.forEach((r) => {
      t3.addFont(__spreadProps(__spreadValues({}, r), {
        isCustom: true
      }));
    });
  }
};
I2.extend(Z8);
var ee4 = class extends P {
  onBeforeCopy(e) {
    return this._injector.get(Ds).beforeCommandExecuted((r) => {
      r.id === jn2.id && e();
    });
  }
  onCopy(e) {
    return this._injector.get(Ds).onCommandExecuted((r) => {
      r.id === jn2.id && e();
    });
  }
  onBeforePaste(e) {
    return this._injector.get(Ds).beforeCommandExecuted((r) => {
      r.id === zn.id && e();
    });
  }
  onPaste(e) {
    return this._injector.get(Ds).onCommandExecuted((r) => {
      (r.id === zn.id || r.id === l7) && e();
    });
  }
};
P.extend(ee4);
var te4 = class extends O {
  get BuiltInUIPart() {
    return u12;
  }
  get KeyCode() {
    return q1;
  }
};
O.extend(te4);

// node_modules/@univerjs/docs-ui/lib/es/facade.js
var h8 = Object.defineProperty;
var v5 = (n3, e, t3) => e in n3 ? h8(n3, e, { enumerable: true, configurable: true, writable: true, value: t3 }) : n3[e] = t3;
var m8 = (n3, e, t3) => v5(n3, typeof e != "symbol" ? e + "" : e, t3);
var M9 = Object.getOwnPropertyDescriptor;
var R8 = (n3, e, t3, r) => {
  for (var i = r > 1 ? void 0 : r ? M9(e, t3) : e, s2 = n3.length - 1, d2; s2 >= 0; s2--)
    (d2 = n3[s2]) && (i = d2(i) || i);
  return i;
};
var c = (n3, e) => (t3, r) => e(t3, r, n3);
var o2 = class {
  constructor(n3, e, t3, r, i, s2) {
    m8(this, "id");
    this._documentDataModel = n3, this._injector = e, this._univerInstanceService = t3, this._commandService = r, this._resourceManagerService = i, this._renderManagerService = s2, this.id = this._documentDataModel.getUnitId();
  }
  getId() {
    return this._documentDataModel.getUnitId();
  }
  getName() {
    return this.getSnapshot().title || "";
  }
  getSnapshot() {
    const n3 = this._resourceManagerService.getResourcesByType(this.id, we.UNIVER_DOC), e = this._documentDataModel.getSnapshot();
    return e.resources = n3, e;
  }
  undo() {
    return this._univerInstanceService.focusUnit(this.id), this._commandService.executeCommand(wC.id);
  }
  redo() {
    return this._univerInstanceService.focusUnit(this.id), this._commandService.executeCommand(SC.id);
  }
  /**
   * Adds the specified text to the end of this text region.
   * @param text - The text to be added to the end of this text region.
   */
  appendText(n3) {
    const e = this.id, { body: t3 } = this.getSnapshot();
    if (!t3)
      throw new Error("The document body is empty");
    const r = t3.dataStream.length - 2, i = {
      startOffset: r,
      endOffset: r,
      collapsed: true,
      segmentId: ""
    }, { segmentId: s2 } = i;
    return this._commandService.executeCommand(va.id, {
      unitId: e,
      body: {
        dataStream: n3
      },
      range: i,
      segmentId: s2
    });
  }
  /**
   * Sets the selection to a specified text range in the document.
   * @param startOffset - The starting offset of the selection in the document.
   * @param endOffset - The ending offset of the selection in the document.
   * @example
   * ```typescript
   * document.setSelection(10, 20);
   * ```
   */
  setSelection(n3, e) {
    var r;
    const t3 = (r = this._renderManagerService.getRenderById(this.getId())) == null ? void 0 : r.with(Re);
    t3 == null || t3.removeAllRanges(), t3 == null || t3.addDocRanges(
      [
        {
          startOffset: n3,
          endOffset: e,
          rangeType: Vg.TEXT
        }
      ],
      true
    );
  }
};
o2 = R8([
  c(1, Inject(Injector)),
  c(2, br),
  c(3, Ds),
  c(4, na),
  c(5, JE)
], o2);
var O6 = class extends I2 {
  createUniverDoc(e) {
    const t3 = this._univerInstanceService.createUnit(we.UNIVER_DOC, e);
    return this._injector.createInstance(o2, t3);
  }
  getActiveDocument() {
    const e = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_DOC);
    return e ? this._injector.createInstance(o2, e) : null;
  }
  getUniverDoc(e) {
    const t3 = this._univerInstanceService.getUniverDocInstance(e);
    return t3 ? this._injector.createInstance(o2, t3) : null;
  }
};
I2.extend(O6);

// node_modules/@univerjs/sheets-ui/lib/es/facade.js
var Te4 = class extends I2 {
  // eslint-disable-next-line max-lines-per-function
  _initSheetUIEvent(e) {
    const r = e.get(Ds);
    this.registerEventHandler(
      this.Event.BeforeSheetEditStart,
      () => r.beforeCommandExecuted((t3) => {
        if (t3.id !== tt5.id) return;
        const i = this.getActiveSheet();
        if (!i) return;
        const { workbook: o3, worksheet: s2 } = i, d2 = e.get(Qe3), h9 = t3.params, { visible: g9, keycode: l4, eventType: a4 } = h9, n3 = d2.getEditLocation();
        if (g9) {
          const c2 = {
            row: n3.row,
            column: n3.column,
            eventType: a4,
            keycode: l4,
            workbook: o3,
            worksheet: s2,
            isZenEditor: false
          };
          if (this.fireEvent(this.Event.BeforeSheetEditStart, c2), c2.cancel)
            throw new tR();
        }
      })
    ), this.registerEventHandler(
      this.Event.BeforeSheetEditEnd,
      () => r.beforeCommandExecuted((t3) => {
        if (t3.id !== tt5.id) return;
        const i = this.getActiveSheet();
        if (!i) return;
        const { workbook: o3, worksheet: s2 } = i, d2 = e.get(Qe3), h9 = e.get(br), g9 = t3.params, { visible: l4, keycode: a4, eventType: n3 } = g9, c2 = d2.getEditLocation();
        if (!l4) {
          const P8 = {
            row: c2.row,
            column: c2.column,
            eventType: n3,
            keycode: a4,
            workbook: o3,
            worksheet: s2,
            isZenEditor: false,
            value: fn.create(h9.getUnit(Fl).getSnapshot()),
            isConfirm: a4 !== q1.ESC
          };
          if (this.fireEvent(this.Event.BeforeSheetEditEnd, P8), P8.cancel)
            throw new tR();
        }
      })
    ), this.registerEventHandler(
      this.Event.SheetEditStarted,
      () => r.onCommandExecuted((t3) => {
        if (t3.id !== tt5.id) return;
        const i = this.getCommandSheetTarget(t3);
        if (!i) return;
        const { workbook: o3, worksheet: s2 } = i, d2 = e.get(Qe3), h9 = t3.params, { visible: g9, keycode: l4, eventType: a4 } = h9, n3 = d2.getEditLocation();
        if (g9) {
          const c2 = {
            row: n3.row,
            column: n3.column,
            eventType: a4,
            keycode: l4,
            workbook: o3,
            worksheet: s2,
            isZenEditor: false
          };
          this.fireEvent(this.Event.SheetEditStarted, c2);
        }
      })
    ), this.registerEventHandler(
      this.Event.SheetEditEnded,
      () => r.onCommandExecuted((t3) => {
        if (t3.id !== tt5.id) return;
        const i = this.getCommandSheetTarget(t3);
        if (!i) return;
        const { workbook: o3, worksheet: s2 } = i, d2 = e.get(Qe3), h9 = t3.params, { visible: g9, keycode: l4, eventType: a4 } = h9, n3 = d2.getEditLocation();
        if (!g9) {
          const c2 = {
            row: n3.row,
            column: n3.column,
            eventType: a4,
            keycode: l4,
            workbook: o3,
            worksheet: s2,
            isZenEditor: false,
            isConfirm: l4 !== q1.ESC
          };
          this.fireEvent(this.Event.SheetEditEnded, c2);
        }
      })
    ), this.registerEventHandler(
      this.Event.SheetEditChanging,
      () => r.onCommandExecuted((t3) => {
        if (t3.id !== M.id) return;
        const i = this.getActiveSheet();
        if (!i) return;
        const { workbook: o3, worksheet: s2 } = i, d2 = e.get(Qe3), h9 = e.get(br), g9 = t3.params;
        if (!d2.isVisible().visible) return;
        const { unitId: l4 } = g9;
        if (l4 === Fl) {
          const { row: a4, column: n3 } = d2.getEditLocation(), c2 = {
            workbook: o3,
            worksheet: s2,
            row: a4,
            column: n3,
            value: fn.create(h9.getUnit(Fl).getSnapshot()),
            isZenEditor: false
          };
          this.fireEvent(this.Event.SheetEditChanging, c2);
        }
      })
    ), this.registerEventHandler(
      this.Event.BeforeSheetZoomChange,
      () => r.beforeCommandExecuted((t3) => {
        if (t3.id !== cs3.id) return;
        const i = this.getCommandSheetTarget(t3);
        if (!i) return;
        const { workbook: o3, worksheet: s2 } = i, d2 = {
          zoom: t3.params.zoomRatio,
          workbook: o3,
          worksheet: s2
        };
        if (this.fireEvent(this.Event.BeforeSheetZoomChange, d2), d2.cancel)
          throw new tR();
      })
    ), this.registerEventHandler(
      this.Event.SheetZoomChanged,
      () => r.onCommandExecuted((t3) => {
        if (t3.id !== cs3.id) return;
        const i = this.getCommandSheetTarget(t3);
        if (!i) return;
        const { workbook: o3, worksheet: s2 } = i;
        this.fireEvent(this.Event.SheetZoomChanged, {
          zoom: s2.getZoom(),
          workbook: o3,
          worksheet: s2
        });
      })
    );
  }
  // eslint-disable-next-line max-lines-per-function
  _initObserverListener(e) {
    const r = e.get(JE), t3 = e.get(Yn), i = new ho();
    this.disposeWithMe(t3.lifecycle$.subscribe((h9) => {
      if (h9 !== Pe.Rendered) return;
      i.dispose();
      const g9 = e.get(Mr3), l4 = e.get(No3);
      g9 && (this.registerEventHandler(
        this.Event.CellClicked,
        () => {
          var a4;
          return (a4 = g9.currentClickedCell$) == null ? void 0 : a4.pipe(filter((n3) => !!n3)).subscribe((n3) => {
            const c2 = this.getSheetTarget(n3.location.unitId, n3.location.subUnitId);
            c2 && this.fireEvent(this.Event.CellClicked, __spreadProps(__spreadValues(__spreadValues({}, c2), n3), {
              row: n3.location.row,
              column: n3.location.col
            }));
          });
        }
      ), this.registerEventHandler(
        this.Event.CellHover,
        () => {
          var a4;
          return (a4 = g9.currentRichText$) == null ? void 0 : a4.pipe(filter((n3) => !!n3)).subscribe((n3) => {
            const c2 = this.getSheetTarget(n3.unitId, n3.subUnitId);
            c2 && this.fireEvent(this.Event.CellHover, __spreadProps(__spreadValues(__spreadValues({}, c2), n3), {
              row: n3.row,
              column: n3.col
            }));
          });
        }
      ), this.registerEventHandler(
        this.Event.CellPointerDown,
        () => {
          var a4;
          return (a4 = g9.currentPointerDownCell$) == null ? void 0 : a4.pipe(filter((n3) => !!n3)).subscribe((n3) => {
            const c2 = this.getSheetTarget(n3.unitId, n3.subUnitId);
            c2 && this.fireEvent(this.Event.CellPointerDown, __spreadProps(__spreadValues(__spreadValues({}, c2), n3), {
              row: n3.row,
              column: n3.col
            }));
          });
        }
      ), this.registerEventHandler(
        this.Event.CellPointerUp,
        () => {
          var a4;
          return (a4 = g9.currentPointerUpCell$) == null ? void 0 : a4.pipe(filter((n3) => !!n3)).subscribe((n3) => {
            const c2 = this.getSheetTarget(n3.unitId, n3.subUnitId);
            c2 && this.fireEvent(this.Event.CellPointerUp, __spreadProps(__spreadValues(__spreadValues({}, c2), n3), {
              row: n3.row,
              column: n3.col
            }));
          });
        }
      ), this.registerEventHandler(
        this.Event.CellPointerMove,
        () => {
          var a4;
          return (a4 = g9.currentCellPosWithEvent$) == null ? void 0 : a4.pipe(filter((n3) => !!n3)).subscribe((n3) => {
            const c2 = this.getSheetTarget(n3.unitId, n3.subUnitId);
            c2 && this.fireEvent(this.Event.CellPointerMove, __spreadProps(__spreadValues(__spreadValues({}, c2), n3), {
              row: n3.row,
              column: n3.col
            }));
          });
        }
      ), this.registerEventHandler(
        this.Event.DragOver,
        () => {
          var a4;
          return (a4 = l4.currentCell$) == null ? void 0 : a4.pipe(filter((n3) => !!n3)).subscribe((n3) => {
            const c2 = this.getSheetTarget(n3.location.unitId, n3.location.subUnitId);
            c2 && this.fireEvent(this.Event.DragOver, __spreadProps(__spreadValues(__spreadValues({}, c2), n3), {
              row: n3.location.row,
              column: n3.location.col
            }));
          });
        }
      ), this.registerEventHandler(
        this.Event.Drop,
        () => {
          var a4;
          return (a4 = l4.endCell$) == null ? void 0 : a4.pipe(filter((n3) => !!n3)).subscribe((n3) => {
            const c2 = this.getSheetTarget(n3.location.unitId, n3.location.subUnitId);
            c2 && this.fireEvent(this.Event.Drop, __spreadProps(__spreadValues(__spreadValues({}, c2), n3), {
              row: n3.location.row,
              column: n3.location.col
            }));
          });
        }
      ), this.registerEventHandler(
        this.Event.RowHeaderClick,
        () => {
          var a4;
          return (a4 = g9.currentRowHeaderClick$) == null ? void 0 : a4.pipe(filter((n3) => !!n3)).subscribe((n3) => {
            const c2 = this.getSheetTarget(n3.unitId, n3.subUnitId);
            c2 && this.fireEvent(this.Event.RowHeaderClick, __spreadProps(__spreadValues({}, c2), {
              row: n3.index
            }));
          });
        }
      ), this.registerEventHandler(
        this.Event.RowHeaderPointerDown,
        () => {
          var a4;
          return (a4 = g9.currentRowHeaderPointerDown$) == null ? void 0 : a4.pipe(filter((n3) => !!n3)).subscribe((n3) => {
            const c2 = this.getSheetTarget(n3.unitId, n3.subUnitId);
            c2 && this.fireEvent(this.Event.RowHeaderPointerDown, __spreadProps(__spreadValues({}, c2), {
              row: n3.index
            }));
          });
        }
      ), this.registerEventHandler(
        this.Event.RowHeaderPointerUp,
        () => {
          var a4;
          return (a4 = g9.currentRowHeaderPointerUp$) == null ? void 0 : a4.pipe(filter((n3) => !!n3)).subscribe((n3) => {
            const c2 = this.getSheetTarget(n3.unitId, n3.subUnitId);
            c2 && this.fireEvent(this.Event.RowHeaderPointerUp, __spreadProps(__spreadValues({}, c2), {
              row: n3.index
            }));
          });
        }
      ), this.registerEventHandler(
        this.Event.RowHeaderHover,
        () => {
          var a4;
          return (a4 = g9.currentHoveredRowHeader$) == null ? void 0 : a4.pipe(filter((n3) => !!n3)).subscribe((n3) => {
            const c2 = this.getSheetTarget(n3.unitId, n3.subUnitId);
            c2 && this.fireEvent(this.Event.RowHeaderHover, __spreadProps(__spreadValues({}, c2), {
              row: n3.index
            }));
          });
        }
      ), this.registerEventHandler(
        this.Event.ColumnHeaderClick,
        () => {
          var a4;
          return (a4 = g9.currentColHeaderClick$) == null ? void 0 : a4.pipe(filter((n3) => !!n3)).subscribe((n3) => {
            const c2 = this.getSheetTarget(n3.unitId, n3.subUnitId);
            c2 && this.fireEvent(this.Event.ColumnHeaderClick, __spreadProps(__spreadValues({}, c2), {
              column: n3.index
            }));
          });
        }
      ), this.registerEventHandler(
        this.Event.ColumnHeaderPointerDown,
        () => {
          var a4;
          return (a4 = g9.currentColHeaderPointerDown$) == null ? void 0 : a4.pipe(filter((n3) => !!n3)).subscribe((n3) => {
            const c2 = this.getSheetTarget(n3.unitId, n3.subUnitId);
            c2 && this.fireEvent(this.Event.ColumnHeaderPointerDown, __spreadProps(__spreadValues({}, c2), {
              column: n3.index
            }));
          });
        }
      ), this.registerEventHandler(
        this.Event.ColumnHeaderPointerUp,
        () => {
          var a4;
          return (a4 = g9.currentColHeaderPointerUp$) == null ? void 0 : a4.pipe(filter((n3) => !!n3)).subscribe((n3) => {
            const c2 = this.getSheetTarget(n3.unitId, n3.subUnitId);
            c2 && this.fireEvent(this.Event.ColumnHeaderPointerUp, __spreadProps(__spreadValues({}, c2), {
              column: n3.index
            }));
          });
        }
      ), this.registerEventHandler(
        this.Event.ColumnHeaderHover,
        () => {
          var a4;
          return (a4 = g9.currentHoveredColHeader$) == null ? void 0 : a4.pipe(filter((n3) => !!n3)).subscribe((n3) => {
            const c2 = this.getSheetTarget(n3.unitId, n3.subUnitId);
            c2 && this.fireEvent(this.Event.ColumnHeaderHover, __spreadProps(__spreadValues({}, c2), {
              column: n3.index
            }));
          });
        }
      ));
    })), this.disposeWithMe(i);
    const o3 = /* @__PURE__ */ new Map();
    let s2;
    const d2 = combineLatest([
      r.created$,
      t3.lifecycle$
    ]);
    this.disposeWithMe(d2.subscribe(([h9, g9]) => {
      var P8;
      if (h9.type === we.UNIVER_SHEET && (s2 = h9), g9 <= Pe.Rendered || !s2) return;
      const l4 = new ho(), a4 = this.getWorkbook(s2.unitId);
      if (!a4) return;
      o3.get(s2.unitId) && ((P8 = o3.get(s2.unitId)) == null || P8.dispose()), o3.set(s2.unitId, l4);
      const n3 = s2.with(Et3), c2 = s2.with(z);
      l4.add(this.registerEventHandler(
        this.Event.Scroll,
        () => n3.validViewportScrollInfo$.subscribe((S) => {
          S && this.fireEvent(this.Event.Scroll, __spreadValues({
            workbook: a4,
            worksheet: a4.getActiveSheet()
          }, S));
        })
      )), l4.add(this.registerEventHandler(
        this.Event.SelectionMoveStart,
        () => c2.selectionMoveStart$.subscribe((S) => {
          var C;
          this.fireEvent(this.Event.SelectionMoveStart, {
            workbook: a4,
            worksheet: a4.getActiveSheet(),
            selections: (C = S == null ? void 0 : S.map((I6) => I6.range)) != null ? C : []
          });
        })
      )), l4.add(this.registerEventHandler(
        this.Event.SelectionMoving,
        () => c2.selectionMoving$.subscribe((S) => {
          var C;
          this.fireEvent(this.Event.SelectionMoving, {
            workbook: a4,
            worksheet: a4.getActiveSheet(),
            selections: (C = S == null ? void 0 : S.map((I6) => I6.range)) != null ? C : []
          });
        })
      )), l4.add(this.registerEventHandler(
        this.Event.SelectionMoveEnd,
        () => c2.selectionMoveEnd$.subscribe((S) => {
          var C;
          this.fireEvent(this.Event.SelectionMoveEnd, {
            workbook: a4,
            worksheet: a4.getActiveSheet(),
            selections: (C = S == null ? void 0 : S.map((I6) => I6.range)) != null ? C : []
          });
        })
      )), l4.add(this.registerEventHandler(
        this.Event.SelectionChanged,
        () => c2.selectionChanged$.subscribe((S) => {
          var C;
          this.fireEvent(this.Event.SelectionChanged, {
            workbook: a4,
            worksheet: a4.getActiveSheet(),
            selections: (C = S == null ? void 0 : S.map((I6) => I6.range)) != null ? C : []
          });
        })
      )), s2 = null, this.disposeWithMe(l4);
    })), this.disposeWithMe(r.disposed$.subscribe((h9) => {
      var g9;
      (g9 = o3.get(h9)) == null || g9.dispose(), o3.delete(h9);
    })), this.disposeWithMe(() => {
      o3.forEach((h9) => {
        h9.dispose();
      });
    });
  }
  /**
   * @ignore
   */
  _initialize(e) {
    this._initSheetUIEvent(e), this._initObserverListener(e);
    const r = e.get(Ds);
    this.registerEventHandler(
      this.Event.BeforeClipboardChange,
      () => r.beforeCommandExecuted((t3) => {
        switch (t3.id) {
          case jn2.id:
          case Un.id:
            this._beforeClipboardChange();
            break;
        }
      })
    ), this.registerEventHandler(
      this.Event.ClipboardChanged,
      () => r.onCommandExecuted((t3) => {
        switch (t3.id) {
          case jn2.id:
          case Un.id:
            this._clipboardChanged();
            break;
        }
      })
    ), this.registerEventHandler(
      this.Event.BeforeClipboardPaste,
      () => r.beforeCommandExecuted((t3) => {
        switch (t3.id) {
          case Gc2.id:
            this._beforeClipboardPaste(t3.params);
            break;
          case zn.id:
            this._beforeClipboardPasteAsync();
            break;
        }
      })
    ), this.registerEventHandler(
      this.Event.ClipboardPasted,
      () => r.onCommandExecuted((t3) => {
        switch (t3.id) {
          case Gc2.id:
            this._clipboardPaste(t3.params);
            break;
          case zn.id:
            this._clipboardPasteAsync();
            break;
        }
      })
    ), this.registerEventHandler(
      this.Event.SheetSkeletonChanged,
      () => r.onCommandExecuted((t3) => {
        if (bh2.indexOf(t3.id) > -1) {
          const i = this.getActiveSheet();
          if (!i) return;
          const o3 = Uh(t3, i.worksheet.getMaxColumns()).map((s2) => {
            var d2, h9;
            return (h9 = (d2 = this.getWorkbook(s2.unitId)) == null ? void 0 : d2.getSheetBySheetId(s2.subUnitId)) == null ? void 0 : h9.getRange(s2.range);
          }).filter(Boolean);
          if (!o3.length) return;
          this.fireEvent(this.Event.SheetSkeletonChanged, {
            workbook: i.workbook,
            worksheet: i.worksheet,
            payload: t3,
            skeleton: i.worksheet.getSkeleton(),
            effectedRanges: o3
          });
        }
      })
    );
  }
  _generateClipboardCopyParam() {
    const e = this.getActiveWorkbook(), r = e == null ? void 0 : e.getActiveSheet(), t3 = e == null ? void 0 : e.getActiveRange();
    if (!e || !r || !t3)
      return;
    const o3 = this._injector.get(tn3).generateCopyContent(e.getId(), r.getSheetId(), t3.getRange());
    if (!o3)
      return;
    const { html: s2, plain: d2 } = o3;
    return {
      workbook: e,
      worksheet: r,
      text: d2,
      html: s2,
      fromSheet: r,
      fromRange: t3
    };
  }
  _beforeClipboardChange() {
    const e = this._generateClipboardCopyParam();
    if (e && (this.fireEvent(this.Event.BeforeClipboardChange, e), e.cancel))
      throw new tR();
  }
  _clipboardChanged() {
    const e = this._generateClipboardCopyParam();
    e && this.fireEvent(this.Event.ClipboardChanged, e);
  }
  _generateClipboardPasteParam(e) {
    if (!e)
      return;
    const { htmlContent: r, textContent: t3 } = e, i = this.getActiveWorkbook(), o3 = i == null ? void 0 : i.getActiveSheet();
    return !i || !o3 ? void 0 : {
      workbook: i,
      worksheet: o3,
      text: t3,
      html: r
    };
  }
  _generateClipboardPasteParamAsync() {
    return __async(this, null, function* () {
      const e = this.getActiveWorkbook(), r = e == null ? void 0 : e.getActiveSheet();
      if (!e || !r)
        return;
      const o3 = (yield this._injector.get(ar2).read())[0];
      let s2;
      if (o3) {
        const d2 = o3.types, h9 = d2.indexOf(Kt) !== -1 ? yield o3.getType(Kt).then((l4) => l4 && l4.text()) : "", g9 = d2.indexOf(e9) !== -1 ? yield o3.getType(e9).then((l4) => l4 && l4.text()) : "";
        s2 = {
          workbook: e,
          worksheet: r,
          text: h9,
          html: g9
        };
      }
      return s2;
    });
  }
  _beforeClipboardPaste(e) {
    const r = this._generateClipboardPasteParam(e);
    if (r && (this.fireEvent(this.Event.BeforeClipboardPaste, r), r.cancel))
      throw new tR();
  }
  _clipboardPaste(e) {
    const r = this._generateClipboardPasteParam(e);
    if (r && (this.fireEvent(this.Event.ClipboardPasted, r), r.cancel))
      throw new tR();
  }
  _beforeClipboardPasteAsync() {
    return __async(this, null, function* () {
      if (!Ao()) {
        this._injector.get(Nt).warn("[Facade]: The navigator object only supports the browser environment");
        return;
      }
      const e = yield this._generateClipboardPasteParamAsync();
      if (e && (this.fireEvent(this.Event.BeforeClipboardPaste, e), e.cancel))
        throw new tR();
    });
  }
  _clipboardPasteAsync() {
    return __async(this, null, function* () {
      if (!Ao()) {
        this._injector.get(Nt).warn("[Facade]: The navigator object only supports the browser environment");
        return;
      }
      const e = yield this._generateClipboardPasteParamAsync();
      if (e && (this.fireEvent(this.Event.ClipboardPasted, e), e.cancel))
        throw new tR();
    });
  }
  customizeColumnHeader(e) {
    var g9, l4;
    const r = this.getActiveWorkbook();
    if (!r) {
      console.error("WorkBook not exist");
      return;
    }
    const t3 = r == null ? void 0 : r.getId(), i = this._injector.get(JE), o3 = r.getActiveSheet(), s2 = o3.getSheetId(), d2 = i.getRenderById(t3);
    d2 && ((g9 = e.headerStyle) != null && g9.size) && (d2.with(he2).setColumnHeaderSize(d2, s2, (l4 = e.headerStyle) == null ? void 0 : l4.size), o3 == null || o3.refreshCanvas()), this._getSheetRenderComponent(t3, Ge5.COLUMN).setCustomHeader(e), o3 == null || o3.refreshCanvas();
  }
  customizeRowHeader(e) {
    const r = this.getActiveWorkbook();
    if (!r) {
      console.error("WorkBook not exist");
      return;
    }
    const t3 = r == null ? void 0 : r.getId();
    this._getSheetRenderComponent(t3, Ge5.ROW).setCustomHeader(e);
  }
  registerSheetRowHeaderExtension(e, ...r) {
    const t3 = this._getSheetRenderComponent(e, Ge5.ROW), i = t3.register(...r);
    return Be(() => {
      i.dispose(), t3.makeDirty(true);
    });
  }
  registerSheetColumnHeaderExtension(e, ...r) {
    const t3 = this._getSheetRenderComponent(e, Ge5.COLUMN), i = t3.register(...r);
    return Be(() => {
      i.dispose(), t3.makeDirty(true);
    });
  }
  registerSheetMainExtension(e, ...r) {
    const t3 = this._getSheetRenderComponent(e, Ge5.MAIN), i = t3.register(...r);
    return Be(() => {
      i.dispose(), t3.makeDirty(true);
    });
  }
  /**
   * Get sheet render component from render by unitId and view key.
   * @private
   * @param {string} unitId The unit id of the spreadsheet.
   * @param {SHEET_VIEW_KEY} viewKey The view key of the spreadsheet.
   * @returns {Nullable<RenderComponentType>} The render component.
   */
  _getSheetRenderComponent(e, r) {
    const i = this._injector.get(JE).getRenderById(e);
    if (!i)
      throw new Error(`Render Unit with unitId ${e} not found`);
    const { components: o3 } = i, s2 = o3.get(r);
    if (!s2)
      throw new Error("Render component not found");
    return s2;
  }
  /**
   * Get sheet hooks.
   * @returns {FSheetHooks} FSheetHooks instance
   */
  getSheetHooks() {
    return this._injector.createInstance(gt3);
  }
  pasteIntoSheet(e, r, t3) {
    return this._commandService.executeCommand(Gc2.id, { htmlContent: e, textContent: r, files: t3 });
  }
  setProtectedRangeShadowStrategy(e) {
    this._injector.get(ad3).setProtectedRangeShadowStrategy(e);
  }
  getProtectedRangeShadowStrategy() {
    return this._injector.get(ad3).getProtectedRangeShadowStrategy();
  }
  getProtectedRangeShadowStrategy$() {
    return this._injector.get(ad3).getProtectedRangeShadowStrategy$();
  }
  setPermissionDialogVisible(e) {
    this._injector.get(aC).setShowComponents(e);
  }
};
I2.extend(Te4);
var Ae7 = class extends R2 {
  openSiderbar(e) {
    return this._logDeprecation("openSiderbar"), this._injector.get(be2).open(e);
  }
  openDialog(e) {
    this._logDeprecation("openDialog");
    const t3 = this._injector.get(ct2).open(__spreadProps(__spreadValues({}, e), {
      onClose: () => {
        t3.dispose();
      }
    }));
    return t3;
  }
  customizeColumnHeader(e) {
    const r = this._workbook.getUnitId();
    this._getSheetRenderComponent(r, Ge5.COLUMN).setCustomHeader(e);
  }
  customizeRowHeader(e) {
    const r = this._workbook.getUnitId();
    this._getSheetRenderComponent(r, Ge5.ROW).setCustomHeader(e);
  }
  /**
   * Get sheet render component from render by unitId and view key.
   * @private
   * @param {string} unitId The unit id of the spreadsheet.
   * @param {SHEET_VIEW_KEY} viewKey The view key of the spreadsheet.
   * @returns {Nullable<RenderComponentType>} The render component.
   */
  _getSheetRenderComponent(e, r) {
    const i = this._injector.get(JE).getRenderById(e);
    if (!i)
      throw new Error(`Render Unit with unitId ${e} not found`);
    const { components: o3 } = i, s2 = o3.get(r);
    if (!s2)
      throw new Error("Render component not found");
    return s2;
  }
  _logDeprecation(e) {
    this._injector.get(Nt).warn("[FWorkbook]", `${e} is deprecated. Please use the function of the same name on "FUniver".`);
  }
  generateCellParams(e) {
    const r = this.getActiveSheet();
    return {
      row: e.row,
      column: e.col,
      workbook: this,
      worksheet: r
    };
  }
  onCellClick(e) {
    const r = this._injector.get(Mr3);
    return Be(
      r.currentClickedCell$.pipe(filter((t3) => !!t3)).subscribe((t3) => {
        e(t3);
      })
    );
  }
  onCellHover(e) {
    const r = this._injector.get(Mr3);
    return Be(
      r.currentRichText$.pipe(filter((t3) => !!t3)).subscribe(e)
    );
  }
  onCellPointerDown(e) {
    const r = this._injector.get(Mr3);
    return Be(
      r.currentPointerDownCell$.subscribe(e)
    );
  }
  onCellPointerUp(e) {
    const r = this._injector.get(Mr3);
    return Be(
      r.currentPointerUpCell$.subscribe(e)
    );
  }
  onCellPointerMove(e) {
    const r = this._injector.get(Mr3);
    return Be(
      r.currentCellPosWithEvent$.pipe(filter((t3) => !!t3)).subscribe((t3) => {
        e(t3, t3.event);
      })
    );
  }
  onDragOver(e) {
    const r = this._injector.get(No3);
    return Be(
      r.currentCell$.pipe(filter((t3) => !!t3)).subscribe((t3) => {
        e(t3);
      })
    );
  }
  onDrop(e) {
    const r = this._injector.get(No3);
    return Be(
      r.endCell$.pipe(filter((t3) => !!t3)).subscribe((t3) => {
        e(t3);
      })
    );
  }
  startEditing() {
    const e = this._injector.get(Ds);
    return this._injector.get(Qe3).isVisible().visible ? true : e.syncExecuteCommand(tt5.id, {
      eventType: hb.Dblclick,
      unitId: this._workbook.getUnitId(),
      visible: true
    });
  }
  endEditing(e) {
    return __async(this, null, function* () {
      const r = this._injector.get(Ds);
      return this._injector.get(Qe3).isVisible().visible && r.syncExecuteCommand(tt5.id, {
        eventType: hb.Keyboard,
        keycode: e ? q1.ENTER : q1.ESC,
        visible: false,
        unitId: this._workbook.getUnitId()
      }), yield lI(0), true;
    });
  }
  endEditingAsync(e = true) {
    return this.endEditing(e);
  }
  abortEditingAsync() {
    return this.endEditingAsync(false);
  }
  isCellEditing() {
    return this._injector.get(Qe3).isVisible().visible;
  }
  /**
   * Get scroll state of specified sheet.
   * @param {string} sheetId - sheet id
   * @returns {IScrollState} scroll state
   * @example
   * ``` ts
   * univerAPI.getActiveWorkbook().getScrollStateBySheetId($sheetId)
   * ```
   */
  getScrollStateBySheetId(e) {
    const r = this._workbook.getUnitId(), i = this._injector.get(JE).getRenderById(r);
    return i ? i.with(Et3).getScrollStateByParam({ unitId: r, sheetId: e }) : null;
  }
  disableSelection() {
    const e = this._workbook.getUnitId(), t3 = this._injector.get(JE).getRenderById(e);
    return t3 && t3.with(gt).disableSelection(), this;
  }
  enableSelection() {
    const e = this._workbook.getUnitId(), t3 = this._injector.get(JE).getRenderById(e);
    return t3 && t3.with(gt).enableSelection(), this;
  }
  transparentSelection() {
    const e = this._workbook.getUnitId(), t3 = this._injector.get(JE).getRenderById(e);
    return t3 && t3.with(gt).transparentSelection(), this;
  }
  showSelection() {
    const e = this._workbook.getUnitId(), t3 = this._injector.get(JE).getRenderById(e);
    return t3 && t3.with(gt).showSelection(), this;
  }
};
R2.extend(Ae7);
var je4 = class extends I5 {
  refreshCanvas() {
    const e = this._injector.get(JE), r = this._fWorkbook.id, t3 = e.getRenderById(r);
    if (!t3)
      throw new Error(`Render Unit with unitId ${r} not found`);
    t3.with(he2).reCalculate();
    const i = t3.mainComponent;
    if (!i)
      throw new Error("Main component not found");
    return i.makeDirty(), this;
  }
  highlightRanges(e, r, t3) {
    const i = this._injector.get(Xi3), o3 = [];
    for (const s2 of e) {
      const d2 = s2.getRange(), h9 = i.addShapeWithNoFresh({ range: d2, style: r, primary: t3 });
      h9 && o3.push(h9);
    }
    if (i.refreshShapes(), o3.length === 0)
      throw new Error("Failed to highlight current range");
    return Be(() => {
      o3.forEach((s2) => {
        i.removeShape(s2);
      });
    });
  }
  zoom(e) {
    const r = this._injector.get(Ds), t3 = Math.min(Math.max(e, 0.1), 4);
    return r.executeCommand(cs3.id, {
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId(),
      zoomRatio: t3
    }), this;
  }
  getZoom() {
    return this._worksheet.getZoomRatio();
  }
  getVisibleRange() {
    const e = this._workbook.getUnitId(), t3 = this._injector.get(JE).getRenderById(e);
    let i = {
      startColumn: 0,
      startRow: 0,
      endColumn: 0,
      endRow: 0
    };
    if (!t3) return i;
    const s2 = t3.with(he2).getCurrentSkeleton();
    if (!s2) return i;
    const d2 = s2 == null ? void 0 : s2.getVisibleRanges();
    if (!d2) return i;
    i = s2.getVisibleRangeByViewport(k2.VIEW_MAIN);
    for (const [h9, g9] of d2)
      Db.indexOf(h9) !== -1 && (i.startColumn = Math.min(i.startColumn, g9.startColumn), i.startRow = Math.min(i.startRow, g9.startRow), i.endColumn = Math.max(i.endColumn, g9.endColumn), i.endRow = Math.max(i.endRow, g9.endRow));
    return i;
  }
  scrollToCell(e, r, t3) {
    const i = this._workbook.getUnitId(), s2 = this._injector.get(JE).getRenderById(i);
    return s2 && (s2 == null ? void 0 : s2.with(Ri3)).scrollToCell(e, r, t3), this;
  }
  getScrollState() {
    const e = {
      offsetX: 0,
      offsetY: 0,
      sheetViewStartColumn: 0,
      sheetViewStartRow: 0
    }, r = this._workbook.getUnitId(), t3 = this._worksheet.getSheetId(), o3 = this._injector.get(JE).getRenderById(r);
    return o3 && o3.with(Et3).getScrollStateByParam({ unitId: r, sheetId: t3 }) || e;
  }
  onScroll(e) {
    var o3;
    const r = this._workbook.getUnitId(), i = (o3 = this._injector.get(JE).getRenderById(r)) == null ? void 0 : o3.with(Et3);
    if (i) {
      const s2 = i.validViewportScrollInfo$.subscribe((d2) => {
        e(d2);
      });
      return Be(s2);
    }
    return Be(() => {
    });
  }
  getSkeleton() {
    var r, t3;
    const e = (r = this._injector.get(JE).getRenderById(this._workbook.getUnitId())) == null ? void 0 : r.with(he2);
    return (t3 = e == null ? void 0 : e.getWorksheetSkeleton(this._worksheet.getSheetId())) == null ? void 0 : t3.skeleton;
  }
  autoResizeColumn(e) {
    return this.autoResizeColumns(e, 1);
  }
  autoResizeColumns(e, r) {
    const t3 = this._workbook.getUnitId(), i = this._worksheet.getSheetId(), o3 = [
      {
        startColumn: e,
        endColumn: e + r - 1,
        startRow: 0,
        endRow: this._worksheet.getRowCount() - 1
      }
    ];
    return this._commandService.syncExecuteCommand(ls2.id, {
      unitId: t3,
      subUnitId: i,
      ranges: o3
    }), this;
  }
  setColumnAutoWidth(e, r) {
    return this.autoResizeColumns(e, r);
  }
  autoResizeRows(e, r) {
    const t3 = this._workbook.getUnitId(), i = this._worksheet.getSheetId(), o3 = [
      {
        startRow: e,
        endRow: e + r - 1,
        startColumn: 0,
        endColumn: this._worksheet.getColumnCount() - 1
      }
    ];
    return this._commandService.syncExecuteCommand(no.id, {
      unitId: t3,
      subUnitId: i,
      ranges: o3
    }), this;
  }
  customizeColumnHeader(e) {
    var d2, h9;
    const r = this._workbook.getUnitId(), t3 = this._worksheet.getSheetId(), o3 = this._injector.get(JE).getRenderById(r);
    o3 && ((d2 = e.headerStyle) != null && d2.size) && o3.with(he2).setColumnHeaderSize(o3, t3, (h9 = e.headerStyle) == null ? void 0 : h9.size), this._getSheetRenderComponent(r, Ge5.COLUMN).setCustomHeader(e, t3);
  }
  customizeRowHeader(e) {
    var d2, h9;
    const r = this._workbook.getUnitId(), t3 = this._worksheet.getSheetId(), o3 = this._injector.get(JE).getRenderById(r);
    o3 && ((d2 = e.headerStyle) != null && d2.size) && o3.with(he2).setRowHeaderSize(o3, t3, (h9 = e.headerStyle) == null ? void 0 : h9.size), this._getSheetRenderComponent(r, Ge5.ROW).setCustomHeader(e, t3);
  }
  setColumnHeaderHeight(e) {
    const r = this._workbook.getUnitId(), t3 = this._worksheet.getSheetId();
    return this._commandService.executeCommand(da.id, {
      unitId: r,
      subUnitId: t3,
      size: e
    }), this;
  }
  setRowHeaderWidth(e) {
    const r = this._workbook.getUnitId(), t3 = this._worksheet.getSheetId();
    return this._commandService.executeCommand(ca3.id, {
      unitId: r,
      subUnitId: t3,
      size: e
    }), this;
  }
  /**
   * Get sheet render component from render by unitId and view key.
   * @private
   * @param {string} unitId The unit id of the spreadsheet.
   * @param {SHEET_VIEW_KEY} viewKey The view key of the spreadsheet.
   * @returns {Nullable<RenderComponentType>} The render component.
   */
  _getSheetRenderComponent(e, r) {
    const i = this._injector.get(JE).getRenderById(e);
    if (!i)
      throw new Error(`Render Unit with unitId ${e} not found`);
    const { components: o3 } = i, s2 = o3.get(r);
    if (!s2)
      throw new Error("Render component not found");
    return s2;
  }
};
I5.extend(je4);
var $e7 = class extends H3 {
  setPermissionDialogVisible(e) {
    this._permissionService.setShowComponents(e);
  }
};
H3.extend($e7);
var We6 = class extends gt3 {
  onCellPointerMove(e) {
    return Be(this._injector.get(Mr3).currentPosition$.subscribe(e));
  }
  onCellPointerOver(e) {
    return Be(this._injector.get(Mr3).currentCell$.subscribe(e));
  }
  onCellDragOver(e) {
    return Be(this._injector.get(No3).currentCell$.subscribe(e));
  }
  onCellDrop(e) {
    return Be(this._injector.get(No3).endCell$.subscribe(e));
  }
  onCellRender(e, r = ir.Style, t3 = Ca3.DATA_VALIDATION) {
    return this._injector.get(G).intercept(ht2.CELL_CONTENT, {
      effect: r,
      handler: (i, o3, s2) => (i && !i.customRender && e && (i.customRender = [...e]), s2(i)),
      priority: t3
    });
  }
  onBeforeCellEdit(e) {
    return this._injector.get(Ds).beforeCommandExecuted((r) => {
      const t3 = r.params;
      r.id === tt5.id && t3.visible && e(t3);
    });
  }
  onAfterCellEdit(e) {
    return this._injector.get(Ds).onCommandExecuted((r) => {
      const t3 = r.params;
      r.id === tt5.id && !t3.visible && e(t3);
    });
  }
};
gt3.extend(We6);
var H5 = {
  CellClicked: "CellClicked",
  CellPointerDown: "CellPointerDown",
  CellPointerUp: "CellPointerUp",
  CellPointerMove: "CellPointerMove",
  CellHover: "CellHover"
};
var Oe4 = class {
  get BeforeClipboardChange() {
    return "BeforeClipboardChange";
  }
  get ClipboardChanged() {
    return "ClipboardChanged";
  }
  get BeforeClipboardPaste() {
    return "BeforeClipboardPaste";
  }
  get ClipboardPasted() {
    return "ClipboardPasted";
  }
  get BeforeSheetEditStart() {
    return "BeforeSheetEditStart";
  }
  get SheetEditStarted() {
    return "SheetEditStarted";
  }
  get SheetEditChanging() {
    return "SheetEditChanging";
  }
  get BeforeSheetEditEnd() {
    return "BeforeSheetEditEnd";
  }
  get SheetEditEnded() {
    return "SheetEditEnded";
  }
  get CellClicked() {
    return H5.CellClicked;
  }
  get CellHover() {
    return H5.CellHover;
  }
  get CellPointerDown() {
    return H5.CellPointerDown;
  }
  get CellPointerUp() {
    return H5.CellPointerUp;
  }
  get CellPointerMove() {
    return H5.CellPointerMove;
  }
  get DragOver() {
    return "DragOver";
  }
  get Drop() {
    return "Drop";
  }
  get Scroll() {
    return "Scroll";
  }
  get SelectionMoveStart() {
    return "SelectionMoveStart";
  }
  get SelectionChanged() {
    return "SelectionChanged";
  }
  get SelectionMoving() {
    return "SelectionMoving";
  }
  get SelectionMoveEnd() {
    return "SelectionMoveEnd";
  }
  get RowHeaderClick() {
    return "RowHeaderClick";
  }
  get RowHeaderPointerDown() {
    return "RowHeaderPointerDown";
  }
  get RowHeaderPointerUp() {
    return "RowHeaderPointerUp";
  }
  get RowHeaderHover() {
    return "RowHeaderHover";
  }
  get ColumnHeaderClick() {
    return "ColumnHeaderClick";
  }
  get ColumnHeaderPointerDown() {
    return "ColumnHeaderPointerDown";
  }
  get ColumnHeaderPointerUp() {
    return "ColumnHeaderPointerUp";
  }
  get ColumnHeaderHover() {
    return "ColumnHeaderHover";
  }
  get SheetSkeletonChanged() {
    return "SheetSkeletonChanged";
  }
  get BeforeSheetZoomChange() {
    return "BeforeSheetZoomChange";
  }
  get SheetZoomChanged() {
    return "SheetZoomChanged";
  }
};
j.extend(Oe4);
var Fe5 = class extends f3 {
  getCell() {
    var d2;
    const e = this._injector.get(JE), r = this._injector.get(Nt), t3 = this._workbook.getUnitId(), i = this._worksheet.getSheetId(), o3 = e.getRenderById(t3), s2 = (d2 = o3 == null ? void 0 : o3.with(he2).getSkeletonParam(i)) == null ? void 0 : d2.skeleton;
    if (!s2)
      throw r.error("[Facade]: `FRange.getCell` can only be called in current worksheet"), new Error("`FRange.getCell` can only be called in current worksheet");
    return s2.getCellWithCoordByIndex(this._range.startRow, this._range.startColumn);
  }
  getCellRect() {
    const { startX: e, startY: r, endX: t3, endY: i } = this.getCell(), o3 = { x: e, y: r, width: t3 - e, height: i - r, top: r, left: e, bottom: i, right: t3 };
    return __spreadProps(__spreadValues({}, o3), { toJSON: () => JSON.stringify(o3) });
  }
  generateHTML() {
    var t3;
    const r = this._injector.get(tn3).generateCopyContent(
      this._workbook.getUnitId(),
      this._worksheet.getSheetId(),
      this._range
    );
    return (t3 = r == null ? void 0 : r.html) != null ? t3 : "";
  }
  attachPopup(e) {
    var s2, d2, h9;
    e.direction = (s2 = e.direction) != null ? s2 : "horizontal", e.extraProps = (d2 = e.extraProps) != null ? d2 : {}, e.offset = (h9 = e.offset) != null ? h9 : [0, 0];
    const { key: r, disposableCollection: t3 } = q8(e, this._injector.get(S13)), o3 = this._injector.get(Pi).attachPopupToCell(
      this._range.startRow,
      this._range.startColumn,
      __spreadProps(__spreadValues({}, e), { componentKey: r }),
      this.getUnitId(),
      this._worksheet.getSheetId()
    );
    return o3 ? (t3.add(o3), t3) : (t3.dispose(), null);
  }
  attachAlertPopup(e) {
    const r = this._injector.get(Fo3), t3 = {
      workbook: this._workbook,
      worksheet: this._worksheet,
      row: this._range.startRow,
      col: this._range.startColumn,
      unitId: this.getUnitId(),
      subUnitId: this._worksheet.getSheetId()
    };
    return r.showAlert(__spreadProps(__spreadValues({}, e), {
      location: t3
    })), {
      dispose: () => {
        r.removeAlert(e.key);
      }
    };
  }
  /**
   * attachDOMPopup
   * @param popup
   * @returns {IDisposable} disposable
      let sheet = univerAPI.getActiveWorkbook().getActiveSheet();
      let range = sheet.getRange(2, 2, 3, 3);
      univerAPI.getActiveWorkbook().setActiveRange(range);
      let disposable = range.attachDOMPopup({
      componentKey: 'univer.sheet.single-dom-popup',
      extraProps: { alert: { type: 0, title: 'This is an Info', message: 'This is an info message' } },
      });
   */
  attachRangePopup(e) {
    var s2, d2, h9;
    e.direction = (s2 = e.direction) != null ? s2 : "top-center", e.extraProps = (d2 = e.extraProps) != null ? d2 : {}, e.offset = (h9 = e.offset) != null ? h9 : [0, 0];
    const { key: r, disposableCollection: t3 } = q8(e, this._injector.get(S13)), o3 = this._injector.get(Pi).attachRangePopup(
      this._range,
      __spreadProps(__spreadValues({}, e), { componentKey: r }),
      this.getUnitId(),
      this._worksheet.getSheetId()
    );
    return o3 ? (t3.add(o3), t3) : (t3.dispose(), null);
  }
  highlight(e, r) {
    const t3 = this._injector.get(Xi3), i = t3.addShape({ range: this._range, style: e, primary: r });
    if (!i)
      throw new Error("Failed to highlight current range");
    return Be(() => {
      t3.removeShape(i);
    });
  }
  showDropdown(e) {
    return this._injector.get(Fp).showDropdown(e);
  }
  autoFill(e, r) {
    return __async(this, null, function* () {
      const t3 = this.getRange(), i = e.getRange();
      if (!Cn.contains(i, t3))
        throw new Error("AutoFill target range must contain source range");
      const { startRow: o3, startColumn: s2, endRow: d2, endColumn: h9 } = t3, { startRow: g9, startColumn: l4, endRow: a4, endColumn: n3 } = i;
      if (d2 - o3 !== a4 - g9 && h9 - s2 !== n3 - l4)
        throw new Error("AutoFill can only fill in one direction");
      if (d2 - o3 === a4 - g9 && s2 !== l4 && h9 !== n3)
        throw new Error("AutoFill can only fill in one direction");
      if (h9 - s2 === n3 - l4 && o3 !== g9 && d2 !== a4)
        throw new Error("AutoFill can only fill in one direction");
      return this._commandService.executeCommand(gr5.id, {
        sourceRange: t3,
        targetRange: i,
        unitId: this.getUnitId(),
        subUnitId: this.getSheetId(),
        applyType: r
      });
    });
  }
};
f3.extend(Fe5);
function q8(E3, e) {
  const { componentKey: r, isVue3: t3 } = E3;
  let i;
  const o3 = new ho();
  return typeof r == "string" ? i = r : (i = `External_${et(6)}`, o3.add(e.register(i, r, { framework: t3 ? "vue3" : "react" }))), {
    key: i,
    disposableCollection: o3
  };
}

// node_modules/@univerjs/engine-formula/lib/es/facade.js
var T5 = Object.getOwnPropertyDescriptor;
var N5 = (e, t3, r, i) => {
  for (var o3 = i > 1 ? void 0 : i ? T5(t3, r) : t3, a4 = e.length - 1, u2; a4 >= 0; a4--)
    (u2 = e[a4]) && (o3 = u2(o3) || o3);
  return o3;
};
var n2 = (e, t3) => (r, i) => t3(r, i, e);
var s = class extends $ {
  constructor(e, t3, r, i) {
    super(), this._commandService = e, this._injector = t3, this._lexerTreeBuilder = r, this._configService = i, this._initialize();
  }
  /**
   * @ignore
   */
  _initialize() {
  }
  /**
   * The tree builder for formula string.
   * @type {LexerTreeBuilder}
   */
  get lexerTreeBuilder() {
    return this._lexerTreeBuilder;
  }
  /**
   * Offsets the formula
   * @param {string} formulaString - The formula string to offset
   * @param {number} refOffsetX - The offset column
   * @param {number} refOffsetY - The offset row
   * @param {boolean} [ignoreAbsolute] - Whether to ignore the absolute reference
   * @returns {string} The offset formula string
   *
   * @example
   * ```ts
   * const formulaEngine = univerAPI.getFormula();
   * const result = formulaEngine.moveFormulaRefOffset('=SUM(A1,B2)', 1, 1);
   * console.log(result);
   * ```
   */
  moveFormulaRefOffset(e, t3, r, i) {
    return this._lexerTreeBuilder.moveFormulaRefOffset(e, t3, r, i);
  }
  /**
   * Resolves the formula string to a 'node' node
   * @param {string} formulaString - The formula string to resolve
   * @returns {Array<ISequenceNode | string>} The nodes of the formula string
   *
   * @example
   * ```ts
   * const formulaEngine = univerAPI.getFormula();
   * const nodes = formulaEngine.sequenceNodesBuilder('=SUM(A1,B2)');
   * console.log(nodes);
   * ```
   */
  sequenceNodesBuilder(e) {
    return this._lexerTreeBuilder.sequenceNodesBuilder(e) || [];
  }
  /**
   * Start the calculation of the formula.
   *
   * @example
   * ```ts
   * const formulaEngine = univerAPI.getFormula();
   * formulaEngine.executeCalculation();
   * ```
   */
  executeCalculation() {
    this._commandService.executeCommand(Oo.id, { commands: [], forceCalculation: true }, { onlyLocal: true });
  }
  /**
   * Stop the calculation of the formula.
   *
   * @example
   * ```ts
   * const formulaEngine = univerAPI.getFormula();
   * formulaEngine.stopCalculation();
   * ```
   */
  stopCalculation() {
    this._commandService.executeCommand(So2.id, {});
  }
  /**
   * Listening calculation starts.
   * @param {Function} callback - The callback function to be called when the formula calculation starts.
   * @returns {IDisposable} The disposable instance.
   *
   * @example
   * ```ts
   * const formulaEngine = univerAPI.getFormula();
   * formulaEngine.calculationStart((forceCalculation) => {
   *   console.log('Calculation start', forceCalculation);
   * });
   * ```
   */
  calculationStart(e) {
    return this._commandService.onCommandExecuted((t3) => {
      if (t3.id === Oo.id) {
        const r = t3.params;
        e(r.forceCalculation);
      }
    });
  }
  /**
   * Listening calculation ends.
   * @param {Function} callback - The callback function to be called when the formula calculation ends.
   * @returns {IDisposable} The disposable instance.
   *
   * @example
   * ```ts
   * const formulaEngine = univerAPI.getFormula();
   * formulaEngine.calculationEnd((functionsExecutedState) => {
   *   console.log('Calculation end', functionsExecutedState);
   * });
   * ```
   */
  calculationEnd(e) {
    return this._commandService.onCommandExecuted((t3) => {
      if (t3.id !== Sn.id)
        return;
      const r = t3.params;
      r.functionsExecutedState !== void 0 && e(r.functionsExecutedState);
    });
  }
  /**
   * Wait for computing in the Univer instance to complete. Please note that this does not only include formula calculation,
   * but also other computing tasks, e.g. pivot table calculation.
   * @param {number} [timeout] The maximum time to wait for the computing to complete, in milliseconds. The default
   * value is 30,000 milliseconds.
   * @returns {Promise<boolean>} This method returns `true` if the computing is complete. If the timeout is reached, this
   * method returns `false`.
   *
   * @example
   * ```ts
   * const formulaEngine = univerAPI.getFormula();
   * formulaEngine.whenComputingCompleteAsync(3000).then((isComplete) => {
   *   console.log('Computing complete:', isComplete);
   * });
   * ```
   */
  whenComputingCompleteAsync(e) {
    const t3 = this._injector.get(yc);
    return t3.computingStatus ? Promise.resolve(true) : firstValueFrom(race(
      t3.computingStatus$.pipe(filter((r) => r)),
      timer(e != null ? e : 3e4).pipe(map(() => false))
    ));
  }
  /**
   * @deprecated Use `whenComputingCompleteAsync` instead.
   * @returns {Promise<void>} This method returns a promise that resolves when the calculation is complete.
   */
  onCalculationEnd() {
    return new Promise((e, t3) => {
      const r = setTimeout(() => {
        t3(new Error("Calculation end timeout"));
      }, 3e4), i = this.calculationEnd(() => {
        clearTimeout(r), i.dispose(), e();
      });
    });
  }
  /**
   * Listening calculation processing.
   * @param {Function} callback - The callback function to be called when the formula calculation is in progress.
   * @returns {IDisposable} The disposable instance.
   *
   * @example
   * ```ts
   * const formulaEngine = univerAPI.getFormula();
   * formulaEngine.calculationProcessing((stageInfo) => {
   *   console.log('Calculation processing', stageInfo);
   * });
   * ```
   */
  calculationProcessing(e) {
    return this._commandService.onCommandExecuted((t3) => {
      if (t3.id !== Sn.id)
        return;
      const r = t3.params;
      r.stageInfo !== void 0 && e(r.stageInfo);
    });
  }
  /**
   * When a formula contains a circular reference, set the maximum number of iterations for the formula calculation.
   * @param {number} maxIteration The maximum number of iterations. The default value is 1.
   *
   * @example
   * ```ts
   * // Set the maximum number of iterations for the formula calculation to 5.
   * // The default value is 1.
   * const formulaEngine = univerAPI.getFormula();
   * formulaEngine.setMaxIteration(5);
   * ```
   */
  setMaxIteration(e) {
    this._configService.setConfig(kb2, e);
  }
};
s = N5([
  n2(0, Inject(Ds)),
  n2(1, Inject(Injector)),
  n2(2, Inject(Mn)),
  n2(3, xs)
], s);
var O8 = class extends I2 {
  getFormula() {
    return this._injector.createInstance(s);
  }
};
I2.extend(O8);

// node_modules/@univerjs/sheets-formula/lib/es/facade.js
var z4 = class extends I2 {
  /**
   * Initialize the FUniver instance.
   * @ignore
   */
  _initialize() {
    this._debouncedFormulaCalculation = uR(() => {
      this._commandService.executeCommand(
        Oo.id,
        {
          commands: [],
          forceCalculation: true
        },
        {
          onlyLocal: true
        }
      );
    }, 10);
  }
  registerFunction(t3) {
    let r = this._injector.get(ro3);
    r || (this._injector.add([ro3, { useClass: wt3 }]), r = this._injector.get(ro3));
    const e = r.registerFunctions(t3);
    return this._debouncedFormulaCalculation(), e;
  }
};
I2.extend(z4);
var B4 = class extends s {
  /**
   * Initialize the FUniver instance.
   * @ignore
   */
  _initialize() {
    this._debouncedFormulaCalculation = uR(() => {
      this._commandService.executeCommand(
        Oo.id,
        {
          commands: [],
          forceCalculation: true
        },
        {
          onlyLocal: true
        }
      );
    }, 10);
  }
  setInitialFormulaComputing(t3) {
    const e = this._injector.get(Yn).stage, o3 = this._injector.get(Nt), n3 = this._injector.get(xs);
    e > Pe.Starting && o3.warn("[FFormula]", "CalculationMode is called after the Starting lifecycle and will take effect the next time the Univer Sheet is constructed. If you want it to take effect when the Univer Sheet is initialized this time, consider calling it before the Ready lifecycle or using configuration.");
    const i = n3.getConfig(Ue3);
    if (!i) {
      n3.setConfig(Ue3, { initialFormulaComputing: t3 });
      return;
    }
    i.initialFormulaComputing = t3;
  }
  registerFunction(t3, r, e) {
    var c2;
    let o3 = this._injector.get(ro3);
    o3 || (this._injector.add([ro3, { useClass: wt3 }]), o3 = this._injector.get(ro3));
    const n3 = {
      name: t3,
      func: r,
      description: typeof e == "string" ? e : (c2 = e == null ? void 0 : e.description) != null ? c2 : "",
      locales: typeof e == "object" ? e.locales : void 0
    }, i = o3.registerFunction(n3);
    return this._debouncedFormulaCalculation(), i;
  }
  registerAsyncFunction(t3, r, e) {
    var c2;
    let o3 = this._injector.get(ro3);
    o3 || (this._injector.add([ro3, { useClass: wt3 }]), o3 = this._injector.get(ro3));
    const n3 = {
      name: t3,
      func: r,
      description: typeof e == "string" ? e : (c2 = e == null ? void 0 : e.description) != null ? c2 : "",
      locales: typeof e == "object" ? e.locales : void 0
    }, i = o3.registerAsyncFunction(n3);
    return this._debouncedFormulaCalculation(), i;
  }
};
s.extend(B4);
var G2 = class {
  get CalculationMode() {
    return Te2;
  }
};
O.extend(G2);
var T9 = class extends R2 {
  getAllFormulaError() {
    const t3 = [], r = this._workbook, e = r.getUnitId(), o3 = r.getSheets(), n3 = this._injector.get(yr).getArrayFormulaCellData();
    return o3.forEach((i) => {
      var h9;
      const c2 = i.getName(), _3 = i.getSheetId(), C = i.getCellMatrix(), m9 = ((h9 = n3 == null ? void 0 : n3[e]) == null ? void 0 : h9[_3]) || {};
      C.forValue((F7, d2, u2) => {
        var g9;
        if (!u2) return;
        const l4 = (g9 = m9 == null ? void 0 : m9[F7]) == null ? void 0 : g9[d2], a4 = $b(u2, !!l4);
        a4 && t3.push({
          sheetName: c2,
          row: F7,
          column: d2,
          formula: u2.f || "",
          errorType: a4
        });
      });
    }), t3;
  }
};
R2.extend(T9);
var V6 = class extends f3 {
  getFormulaError() {
    var d2, u2;
    const t3 = [], r = this._workbook.getUnitId(), e = this._worksheet.getSheetId(), o3 = this._worksheet.getName(), n3 = this._workbook.getSheetBySheetId(e);
    if (!n3) return t3;
    const i = this._injector.get(yr).getArrayFormulaCellData(), c2 = ((d2 = i == null ? void 0 : i[r]) == null ? void 0 : d2[e]) || {}, _3 = n3.getCellMatrix(), { startRow: C, endRow: m9, startColumn: h9, endColumn: F7 } = this._range;
    for (let l4 = C; l4 <= m9; l4++)
      for (let a4 = h9; a4 <= F7; a4++) {
        const g9 = _3.getValue(l4, a4);
        if (!g9) continue;
        const E3 = (u2 = c2 == null ? void 0 : c2[l4]) == null ? void 0 : u2[a4], x7 = $b(g9, !!E3);
        x7 && t3.push({
          sheetName: o3,
          row: l4,
          column: a4,
          formula: g9.f || "",
          errorType: x7
        });
      }
    return t3;
  }
};
f3.extend(V6);

// node_modules/@univerjs/sheets-numfmt/lib/es/facade.js
var g8 = class extends f3 {
  setNumberFormat(o3) {
    const t3 = [], { startColumn: e, startRow: s2, endColumn: r, endRow: u2 } = this._range;
    for (let m9 = s2; m9 <= u2; m9++)
      for (let n3 = e; n3 <= r; n3++)
        t3.push({ row: m9, col: n3, pattern: o3 });
    return this._commandService.syncExecuteCommand(O4.id, {
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId(),
      values: t3
    }), this;
  }
  setNumberFormats(o3) {
    var m9;
    const t3 = [], { startColumn: e, startRow: s2, endColumn: r, endRow: u2 } = this._range;
    for (let n3 = s2; n3 <= u2; n3++)
      for (let a4 = e; a4 <= r; a4++) {
        const c2 = (m9 = o3[n3 - s2]) == null ? void 0 : m9[a4 - e];
        t3.push({ row: n3, col: a4, pattern: c2 });
      }
    return this._commandService.syncExecuteCommand(O4.id, {
      unitId: this._workbook.getUnitId(),
      subUnitId: this._worksheet.getSheetId(),
      values: t3
    }), this;
  }
  getNumberFormat() {
    var t3, e;
    const o3 = this.getCellStyle();
    return (e = (t3 = o3 == null ? void 0 : o3.numberFormat) == null ? void 0 : t3.pattern) != null ? e : "";
  }
  getNumberFormats() {
    return this.getCellStyles().map((t3) => t3.map((e) => {
      var s2, r;
      return (r = (s2 = e == null ? void 0 : e.numberFormat) == null ? void 0 : s2.pattern) != null ? r : "";
    }));
  }
};
f3.extend(g8);
var b3 = class extends R2 {
  setNumfmtLocal(o3) {
    return this._injector.get(D3).setNumfmtLocal(o3), this;
  }
};
R2.extend(b3);

// node_modules/@univerjs/sheets-formula-ui/lib/es/facade.js
var t2 = class extends I2 {
  showRangeSelectorDialog(o3) {
    return this._injector.get(Pr5).showRangeSelectorDialog(o3);
  }
};
I2.extend(t2);

// node_modules/@univerjs/preset-sheets-core/lib/es/index.js
function or6(m9 = {}) {
  var n3;
  const {
    container: l4 = "app",
    workerURL: t3,
    header: p3,
    footer: u2,
    toolbar: a4,
    ribbonType: c2,
    formulaBar: g9,
    menu: f4,
    contextMenu: S,
    disableAutoFocus: d2,
    customFontFamily: U3,
    docs: i,
    sheets: r,
    formula: o3,
    disableTextFormatAlert: x7,
    disableTextFormatMark: F7
  } = m9, e = !!t3;
  return {
    plugins: [
      V2,
      [q, {
        hasScroll: i == null ? void 0 : i.hasScroll
      }],
      o7,
      [F3, {
        container: l4,
        header: p3,
        toolbar: a4,
        ribbonType: c2,
        menu: f4,
        contextMenu: S,
        disableAutoFocus: d2,
        customFontFamily: U3
      }],
      wr,
      e ? [N2, { workerURL: t3 }] : null,
      [uo3, {
        notExecuteFormula: e,
        function: o3 == null ? void 0 : o3.function
      }],
      [rs2, {
        notExecuteFormula: e,
        onlyRegisterFormulaRelatedMutations: false,
        isRowStylePrecedeColumnStyle: r == null ? void 0 : r.isRowStylePrecedeColumnStyle,
        autoHeightForMergedCells: r == null ? void 0 : r.autoHeightForMergedCells,
        freezeSync: r == null ? void 0 : r.freezeSync
      }],
      [Ll3, {
        formulaBar: g9,
        footer: u2,
        maxAutoHeightCount: r == null ? void 0 : r.maxAutoHeightCount,
        clipboardConfig: r == null ? void 0 : r.clipboardConfig,
        scrollConfig: r == null ? void 0 : r.scrollConfig,
        protectedRangeShadow: (n3 = r == null ? void 0 : r.protectedRangeShadow) != null ? n3 : true,
        protectedRangeUserSelector: r == null ? void 0 : r.protectedRangeUserSelector,
        disableForceStringAlert: r == null ? void 0 : r.disableForceStringAlert,
        disableForceStringMark: r == null ? void 0 : r.disableForceStringMark
      }],
      [A, {
        disableTextFormatAlert: x7,
        disableTextFormatMark: F7
      }],
      ee3,
      [lt4, {
        notExecuteFormula: e,
        description: o3 == null ? void 0 : o3.description,
        initialFormulaComputing: o3 == null ? void 0 : o3.initialFormulaComputing
      }],
      [jt, {
        functionScreenTips: o3 == null ? void 0 : o3.functionScreenTips
      }]
    ].filter((P8) => !!P8)
  };
}
export {
  QC2 as AFFECT_LAYOUT_STYLES,
  Cs as AFTER_CELL_EDIT,
  Le4 as APPLY_TYPE,
  Sb2 as ActiveDirtyManagerService,
  Ve5 as AddDecimalCommand,
  hg as AddMergeRedoSelectionsOperationFactory,
  We3 as AddMergeUndoMutationFactory,
  gg2 as AddMergeUndoSelectionsOperationFactory,
  $u as AddRangeProtectionCommand,
  ai2 as AddRangeProtectionFromContextMenuCommand,
  Sa4 as AddRangeProtectionFromSheetBarCommand,
  va3 as AddRangeProtectionFromToolbarCommand,
  Be3 as AddRangeProtectionMutation,
  Sd as AddRangeThemeMutation,
  Yh as AddWorksheetMergeAllCommand,
  ms as AddWorksheetMergeCommand,
  Zh as AddWorksheetMergeHorizontalCommand,
  ne as AddWorksheetMergeMutation,
  Xh as AddWorksheetMergeVerticalCommand,
  oc as AddWorksheetProtectionCommand,
  Mt2 as AddWorksheetProtectionMutation,
  Mo as AfterSpaceCommand,
  Uo2 as AlignCenterCommand,
  Ho as AlignJustifyCommand,
  Qo as AlignLeftCommand,
  lt2 as AlignOperationCommand,
  Fo2 as AlignRightCommand,
  ac as AppendRowCommand,
  Ra3 as ApplyFormatPainterCommand,
  K3 as ArrayValueObject,
  Ko as AstRootNodeFactory,
  Gr2 as AstTreeBuilder,
  Om as AsyncArrayObject,
  Hb as AsyncCustomFunction,
  Vm as AsyncObject,
  Xe2 as AuthInterceptorFactory,
  yo2 as AutoClearContentCommand,
  gr5 as AutoFillCommand,
  yi3 as AutoFillController,
  nl2 as AutoFillService,
  pi2 as AutoHeightController,
  Ir4 as AutoWidthController,
  T7 as BASE_OBJECT_ARRAY,
  co3 as BEFORE_CELL_EDIT,
  YB as BG_Z_INDEX,
  X as BORDER_TYPE,
  WB as BORDER_Z_INDEX,
  Sb as Background,
  N3 as BaseFunction,
  a3 as BaseObject,
  jr as BaseReferenceObject,
  Im2 as BaseSelectionRenderService,
  Qt2 as BaseValueObject,
  ir3 as BooleanValue,
  T as BooleanValueObject,
  Ab as Border,
  Ht2 as BorderStyleManagerService,
  Gr as BreakLineCommand,
  ge2 as BreakType,
  We as BrowserClipboardService,
  u12 as BuiltInUIPart,
  xn as BulletListCommand,
  Yx as CHECK_OBJECT_ARRAY,
  Xx as CIRCLE_OBJECT_ARRAY,
  z3 as COLOR_BLACK_RGB,
  _5 as COLOR_PICKER_COMPONENT,
  bh2 as COMMAND_LISTENER_SKELETON_CHANGE,
  Eh2 as COMMAND_LISTENER_VALUE_CHANGE,
  m5 as COMMON_LABEL_COMPONENT,
  jn4 as COPY_TYPE,
  Ae6 as CURRENCYFORMAT,
  v1 as CURSOR_TYPE,
  $n as CalculateController,
  ua as CalculateFormulaService,
  Te2 as CalculationMode,
  $c as CancelFrozenCommand,
  vd as CancelMarkDirtyRowAutoHeightMutation,
  ye2 as Canvas,
  I4 as CanvasColorService,
  nt as CanvasFloatDomService,
  er as CanvasPopup,
  Jn as CanvasPopupService,
  k4 as CanvasRenderMode,
  Fo3 as CellAlertManagerService,
  Co2 as CellAlertType,
  dl2 as CellCustomRenderController,
  Qm as CellEditorManagerService,
  Er3 as CellPopupManagerService,
  gr as ChangeListNestingLevelCommand,
  qn2 as ChangeListNestingLevelType,
  Lo2 as ChangeListTypeCommand,
  Pa4 as ChangeSheetProtectionFromSheetBarCommand,
  as2 as ChangeZoomRatioCommand,
  _e2 as ChannelClient,
  ue as ChannelServer,
  K as ChannelService,
  so as CheckListCommand,
  m6 as CheckboxShape,
  z8 as Circle,
  Ls2 as ClearSelectionAllCommand,
  Ys as ClearSelectionContentCommand,
  Hs2 as ClearSelectionFormatCommand,
  Ob as ColumnHeaderLayout,
  p5 as CommonLabel,
  x12 as ComponentContainer,
  L7 as ComponentExtension,
  S13 as ComponentManager,
  Lo as ContextMenu,
  c13 as ContextMenuGroup,
  W1 as ContextMenuPosition,
  nr as ContextMenuService,
  nA as Control,
  jn2 as CopyCommand,
  gc as CopySheetCommand,
  eo as CopyShortcutItem,
  Yr as CopyWorksheetEndMutation,
  qd as CoverContentCommand,
  Wa as CreateDocTableCommand,
  Nb as Custom,
  _g as CustomFunction,
  M1 as CustomLabel,
  mA as CustomObject,
  Un as CutCommand,
  $t as CutContentCommand,
  to as CutShortcutItem,
  mt4 as DATA_TYPE,
  Fe4 as DATEFMTLISG,
  ha as DEFAULT_DOCUMENT_FONTSIZE,
  G3 as DEFAULT_FONTFACE_PLANE,
  NB as DEFAULT_FRAME_LIST_SIZE,
  pb as DEFAULT_FRAME_SAMPLE_SIZE,
  Sh as DEFAULT_INTERVAL_COUNT,
  Iv as DEFAULT_MEASURE_TEXT,
  ca as DEFAULT_OFFSET_SPACING,
  h2 as DEFAULT_PADDING_DATA,
  sB as DEFAULT_SKELETON_FOOTER,
  rB as DEFAULT_SKELETON_HEADER,
  Fr as DEFAULT_TOKEN_LAMBDA_FUNCTION_NAME,
  Nl2 as DEFAULT_TOKEN_LET_FUNCTION_NAME,
  Rr as DEFAULT_TOKEN_TYPE_LAMBDA_PARAMETER,
  At2 as DEFAULT_TOKEN_TYPE_PARAMETER,
  Ft3 as DEFAULT_TOKEN_TYPE_ROOT,
  Oi as DISABLE_AUTO_FOCUS_KEY,
  Wh as DISABLE_NORMAL_SELECTIONS,
  sd as DOCS_COMPONENT_BACKGROUND_LAYER_INDEX,
  Js as DOCS_COMPONENT_DEFAULT_Z_INDEX,
  id as DOCS_COMPONENT_HEADER_LAYER_INDEX,
  zo as DOCS_COMPONENT_MAIN_LAYER_INDEX,
  $e3 as DOCS_VIEW_KEY,
  ka as DOCUMENT_CONTEXT_CLIP_TYPE,
  E as DOC_INTERCEPTOR_POINT,
  rd as DOC_UI_PLUGIN_NAME,
  Oi2 as DOC_VERTICAL_PADDING,
  iB as DRAWING_OBJECT_LAYER_INDEX,
  nB as DRAWING_OBJECT_LOWER_LAYER_INDEX,
  oB as DRAWING_OBJECT_UPPER_LAYER_INDEX,
  _8 as DashedRect,
  T2 as DataStreamTreeNode,
  y as DataSyncPrimaryController,
  f as DataSyncReplicaController,
  od as DefaultDocContainerConfig,
  nd as DefaultToolbarConfig,
  Jn3 as DefinedNameDataController,
  Fs as DefinedNamesService,
  yn as DeleteCommand,
  Zr as DeleteCustomBlockCommand,
  Do as DeleteLeftCommand,
  It2 as DeleteRangeMoveLeftCommand,
  is2 as DeleteRangeMoveLeftConfirmCommand,
  vt2 as DeleteRangeMoveUpCommand,
  wi3 as DeleteRangeMoveUpConfirmCommand,
  fc as DeleteRangeProtectionCommand,
  di2 as DeleteRangeProtectionFromContextMenuCommand,
  ot2 as DeleteRangeProtectionMutation,
  ba as DeleteRightCommand,
  Rc as DeleteWorksheetProtectionCommand,
  Ta4 as DeleteWorksheetProtectionFormSheetBarCommand,
  xt as DeleteWorksheetProtectionMutation,
  Cc as DeleteWorksheetRangeThemeStyleCommand,
  nn2 as DeleteWorksheetRangeThemeStyleMutation,
  Va2 as DeleteWorksheetRangeThemeStyleMutationFactory,
  Fn4 as DeltaColumnWidthCommand,
  Gn as DeltaRowHeightCommand,
  Eh as DependencyManagerBaseService,
  Rh as DependencyManagerService,
  Gt2 as DescriptionService,
  ze4 as DesktopBeforeCloseService,
  Ye2 as DesktopConfirmService,
  Ge2 as DesktopDialogService,
  Xe3 as DesktopGalleryService,
  qe as DesktopGlobalZoneService,
  Pe2 as DesktopLayoutService,
  cr as DesktopLocalFileService,
  dr as DesktopLocalStorageService,
  F5 as DesktopMenu,
  Je2 as DesktopMessageService,
  Qe as DesktopNotificationService,
  fr2 as DesktopSidebarService,
  A32 as DesktopUIController,
  Ke2 as DesktopZenZoneService,
  hb as DeviceInputEventType,
  g2 as DeviceType,
  wt as DocAutoFormatService,
  uo2 as DocBackScrollRenderController,
  w8 as DocBackground,
  Bn2 as DocCanvasPopManagerService,
  ro2 as DocCopyCommand,
  Os as DocCreateTableOperation,
  rs as DocCutCommand,
  Pt2 as DocEventManagerService,
  No as DocIMEInputManagerService,
  J as DocInterceptorService,
  is as DocPasteCommand,
  sf as DocPrintInterceptorService,
  br2 as DocRenderController,
  Oa as DocSelectAllCommand,
  m as DocSelectionManagerService,
  Re as DocSelectionRenderService,
  v4 as DocSimpleSkeleton,
  D as DocSkeletonManagerService,
  Io as DocStateChangeManagerService,
  te as DocStateEmitService,
  Ss2 as DocTableDeleteColumnsCommand,
  Is2 as DocTableDeleteRowsCommand,
  Hn2 as DocTableDeleteTableCommand,
  IA as DocTableInsertColumnCommand,
  ys as DocTableInsertColumnLeftCommand,
  xs2 as DocTableInsertColumnRightCommand,
  Rs as DocTableInsertRowAboveCommand,
  bs as DocTableInsertRowBellowCommand,
  ja2 as DocTableInsertRowCommand,
  za as DocTableTabCommand,
  Ao2 as DocUIController,
  So as DocsRenderService,
  ug as DocsUIMenuSchema,
  d3 as DocumentEditArea,
  v3 as DocumentSkeleton,
  c12 as DocumentSkeletonPageType,
  e3 as DocumentViewModel,
  ve as Documents,
  ze as DocumentsSpanAndLineExtensionRegistry,
  No3 as DragManagerService,
  ul2 as DragRenderController,
  iA as Drawing,
  pA as DumbCanvasColorService,
  cb2 as EMBEDDING_FORMULA_EDITOR,
  zd2 as EMBEDDING_FORMULA_EDITOR_COMPONENT_KEY,
  c4 as EMOJI_REG,
  kb2 as ENGINE_FORMULA_CYCLE_REFERENCE_COUNT,
  pa3 as ENGINE_FORMULA_PLUGIN_CONFIG_KEY,
  fr3 as ERROR_TYPE_SET,
  s0 as EXPAND_SIZE_FOR_RENDER_OVERFLOW,
  xu as EditStateEnum,
  Ei2 as EditingRenderController,
  HA as Editor,
  cl2 as EditorBridgeService,
  Md as EditorInsertTextCommandId,
  Sr as EditorService,
  W2 as EffectRefRangId,
  wd as EmptyMutation,
  be as Engine,
  bn as EnterCommand,
  oe as ErrorController,
  h as ErrorType,
  g4 as ErrorValueObject,
  $0 as EventConstants,
  nh as ExclusiveRangeService,
  Gt3 as ExpandSelectionCommand,
  Fo as FILE_PNG_CLIPBOARD_MIME_TYPE,
  a7 as FILE_SVG_XML_CLIPBOARD_MIME_TYPE,
  jo as FILE__BMP_CLIPBOARD_MIME_TYPE,
  ko as FILE__JPEG_CLIPBOARD_MIME_TYPE,
  Uo as FILE__WEBP_CLIPBOARD_MIME_TYPE,
  p2 as FIX_ONE_PIXEL_BLUR_OFFSET,
  _b as FONT_EXTENSION_Z_INDEX,
  R5 as FONT_FAMILY_COMPONENT,
  V5 as FONT_FAMILY_ITEM_COMPONENT,
  $5 as FONT_SIZE_COMPONENT,
  Qi as FONT_SIZE_LIST,
  As as FORMULA_PROMPT_ACTIVATED,
  ca2 as FUNCTION_NAMES_ARRAY,
  fe2 as FUNCTION_NAMES_COMPATIBILITY,
  Cg as FUNCTION_NAMES_CUBE,
  Xe5 as FUNCTION_NAMES_DATABASE,
  Ae3 as FUNCTION_NAMES_DATE,
  Q3 as FUNCTION_NAMES_ENGINEERING,
  ee as FUNCTION_NAMES_FINANCIAL,
  Ve3 as FUNCTION_NAMES_INFORMATION,
  Ee3 as FUNCTION_NAMES_LOGICAL,
  re3 as FUNCTION_NAMES_LOOKUP,
  F as FUNCTION_NAMES_MATH,
  P2 as FUNCTION_NAMES_STATISTICAL,
  J2 as FUNCTION_NAMES_TEXT,
  mb2 as FUNCTION_NAMES_UNIVER,
  ti as FUNCTION_NAMES_WEB,
  $h as FactoryAddRangeProtectionMutation,
  xh as FactoryDeleteRangeProtectionMutation,
  eg as FactorySetRangeProtectionMutation,
  bh as FeatureCalculationManagerService,
  N as FetchHTTPImplementation,
  qn as FloatDom,
  co2 as FloatDomSingle,
  Rx as Font,
  S12 as FontCache,
  M5 as FontFamily,
  S5 as FontFamilyItem,
  O5 as FontSize,
  zt2 as FormatPainterStatus,
  w0 as FormulaBar,
  Hs as FormulaCurrentConfigService,
  yr as FormulaDataModel,
  ia as FormulaDependencyGenerator,
  Ms as FormulaDependencyTree,
  sa as FormulaDependencyTreeType,
  Hi as FormulaDependencyTreeVirtual,
  bc3 as FormulaEditor,
  yr4 as FormulaEditorController,
  tt3 as FormulaExecuteStageType,
  Ir as FormulaExecutedStateType,
  Ht3 as FormulaRefRangeService,
  Pt5 as FormulaReorderController,
  ra2 as FormulaRuntimeService,
  vn as FunctionNodeFactory,
  km as FunctionService,
  Kc2 as FunctionType,
  yc as GlobalComputingStatusService,
  Pr5 as GlobalRangeSelectorService,
  rr as GlobalZone,
  e2 as GlyphType,
  s7 as Group,
  L5 as HEADING_ITEM_COMPONENT,
  Ki as HEADING_LIST,
  e9 as HTML_CLIPBOARD_MIME_TYPE,
  Q as HTTPEventType,
  I as HTTPHeaders,
  _e as HTTPProgress,
  X3 as HTTPRequest,
  q2 as HTTPResponse,
  v as HTTPResponseError,
  x as HTTPService,
  L as HTTPStatusCode,
  Lo4 as HeaderFreezeRenderController,
  Wo as HeaderMoveRenderController,
  Bo as HeaderResizeRenderController,
  b5 as HeadingItem,
  Fs3 as HelpFunctionOperation,
  ma4 as HideColConfirmCommand,
  ga3 as HideRowConfirmCommand,
  GB as HitCanvas,
  Po as HorizontalLineCommand,
  Mr3 as HoverManagerService,
  ml2 as HoverRenderController,
  ta as HyperlinkEngineFormulaService,
  Mb as IActiveDirtyManagerService,
  Nr3 as IAutoFillService,
  lr as IBeforeCloseService,
  oa as ICalculateFormulaService,
  T8 as ICanvasColorService,
  rt2 as ICanvasPopupService,
  ds2 as ICellEditorManagerService,
  ar2 as IClipboardInterfaceService,
  at as IConfirmService,
  l3 as IContextMenuService,
  Lr as IDefinedNamesService,
  cs as IDependencyManagerService,
  Et2 as IDescriptionService,
  ct2 as IDialogService,
  Lt as IDocClipboardService,
  Qe3 as IEditorBridgeService,
  Ge3 as IEditorService,
  To as IExclusiveRangeService,
  Wr as IFeatureCalculationManagerService,
  An as IFontService,
  Nn as IFormatPainterService,
  Wt as IFormulaCurrentConfigService,
  aa as IFormulaDependencyGenerator,
  us2 as IFormulaEditorManagerService,
  Nt2 as IFormulaRuntimeService,
  Xt as IFunctionService,
  ut as IGalleryService,
  st as IGlobalZoneService,
  Y as IHTTPImplementation,
  Xo as IHyperlinkEngineFormulaService,
  j1 as ILayoutService,
  Gi as ILeftSidebarService,
  ur as ILocalFileService,
  Ta as IMEInputCommand,
  Xi3 as IMarkSelectionService,
  Z1 as IMenuManagerService,
  et2 as IMessageService,
  N0 as INITIAL_MATRIX,
  kb as INITIAL_Path2,
  ht2 as INTERCEPTOR_POINT,
  a32 as INotificationService,
  $t2 as INumfmtService,
  ja3 as IOtherFormulaManagerService,
  tt as IPlatformService,
  I3 as IRPCChannelService,
  Ku as IRefSelectionsService,
  ro3 as IRegisterFunctionService,
  g as IRemoteInstanceService,
  Za3 as IRemoteRegisterFunctionService,
  m2 as IRemoteSyncService,
  JE as IRenderManagerService,
  sF as IRenderingEngine,
  Fp as ISheetCellDropdownManagerService,
  tn3 as ISheetClipboardService,
  jo2 as ISheetRowFilteredService,
  gt as ISheetSelectionRenderService,
  Le as IShortcutService,
  be2 as ISidebarService,
  ze3 as ISocketService,
  Ha3 as IStatusBarService,
  Pr as ISuperTableService,
  Ue as IUIController,
  N1 as IUIPartsService,
  le as IWatermarkTypeEnum,
  lt as IZenZoneService,
  oA as Image,
  Je4 as ImageFormulaCellInterceptorController,
  Sa as InnerPasteCommand,
  ll as InsertColAfterCommand,
  ul as InsertColBeforeCommand,
  $r2 as InsertColByRangeCommand,
  Xe6 as InsertColCommand,
  Ue2 as InsertColMutation,
  as as InsertColMutationUndoFactory,
  va as InsertCommand,
  Jd as InsertCustomRangeCommand,
  pc as InsertDefinedNameCommand,
  Ri2 as InsertFunctionCommand,
  pe2 as InsertFunctionOperation,
  cl as InsertMultiColsLeftCommand,
  dl as InsertMultiColsRightCommand,
  il as InsertMultiRowsAboveCommand,
  al as InsertMultiRowsAfterCommand,
  Pt4 as InsertRangeMoveDownCommand,
  bi4 as InsertRangeMoveDownConfirmCommand,
  rn as InsertRangeMoveRightCommand,
  os2 as InsertRangeMoveRightConfirmCommand,
  rl as InsertRowAfterCommand,
  ol as InsertRowBeforeCommand,
  Ar as InsertRowByRangeCommand,
  Ye3 as InsertRowCommand,
  ke2 as InsertRowMutation,
  Ws as InsertRowMutationUndoFactory,
  Sc as InsertSheetCommand,
  ln as InsertSheetMutation,
  Xr2 as InsertSheetUndoMutationFactory,
  Ca3 as InterceptCellContentPriority,
  Vr as Interpreter,
  Gv as IsSafari,
  kn3 as JumpOver,
  q1 as KeyCode,
  ga as LINK_VIEW_PORT_TYPE,
  Tn as LambdaNodeFactory,
  ru as LambdaParameterNodeFactory,
  xa as LambdaValueObjectObject,
  j8 as Layer,
  pr as Lexer,
  ie4 as LexerNode,
  Mn as LexerTreeBuilder,
  P3 as LineType,
  J4 as Liquid,
  Fn2 as ListOperationCommand,
  HE as MAIN_VIEW_PORT_KEY,
  j6 as MAXIMUM_COL_WIDTH,
  ma as MAXIMUM_ROW_HEIGHT,
  bd as MAX_CELL_PER_SHEET_KEY,
  m4 as MEASURE_EXTENT,
  R6 as MEASURE_EXTENT_FOR_PARAGRAPH,
  Ql as MERGE_CELL_INTERCEPTOR_CHECK,
  L3 as MIDDLE_CELL_POS_MAGIC_NUMBER,
  pa as MIN_COL_WIDTH,
  Id as MarkDirtyRowAutoHeightMutation,
  rl2 as MarkSelectionService,
  Lx as Marker,
  H12 as MenuItemType,
  Fe2 as MenuManagerPosition,
  ke as MenuManagerService,
  Vn as MergeCellController,
  Ve2 as MergeInterceptorFactory,
  Jr2 as MergeTwoParagraphCommand,
  y12 as MetaKeys,
  Vo as MobileContextMenu,
  vI as MobileSheetBar,
  d7 as MockMessageService,
  Rn2 as MoreFunctionsOperation,
  un as MoveColsCommand,
  qe2 as MoveColsMutation,
  Ha2 as MoveColsMutationUndoFactory,
  St as MoveCursorOperation,
  yt2 as MoveRangeCommand,
  wt2 as MoveRangeMutation,
  an as MoveRowsCommand,
  Je3 as MoveRowsMutation,
  La as MoveRowsMutationUndoFactory,
  Ut3 as MoveSelectionCommand,
  Dn3 as MoveSelectionEnterAndTabCommand,
  vt as MoveSelectionOperation,
  Wb as NEW_EXCEL_FUNCTIONS,
  jf as NORMAL_TEXT_SELECTION_PLUGIN_NAME,
  $B as NORMAL_TEXT_SELECTION_PLUGIN_STYLE,
  De2 as NUMBERFORMAT,
  It as NodePositionConvertToCursor,
  ka2 as NodePositionConvertToRectRange,
  ce as NullValueObject,
  y2 as NumberValueObject,
  Ns as NumfmtService,
  Mt as OPERATOR_TOKEN_SET,
  t0 as ORIENTATION_TYPE,
  w3 as ObjectType,
  In as OperatorNodeFactory,
  Q4 as OperatorType,
  On as OrderListCommand,
  yh as OtherFormulaManagerService,
  _e4 as OtherFormulaMarkDirty,
  Ds2 as PASTE_SPECIAL_MENU_ID,
  Kx as PATH_OBJECT_ARRAY,
  Kt as PLAIN_TEXT_CLIPBOARD_MIME_TYPE,
  Ue3 as PLUGIN_CONFIG_KEY_BASE,
  et4 as PREDEFINED_HOOK_NAME,
  XB as PRINTING_BG_Z_INDEX,
  Q2 as PageLayoutType,
  zn as PasteCommand,
  Qd as PastePluginLark,
  Ud as PastePluginUniver,
  Fd as PastePluginWord,
  V1 as Path,
  mb as Path2,
  fb as PerformanceMonitor,
  fg as PermissionPointsDefinitions,
  Wn as PlatformService,
  e12 as PointerInput,
  Un3 as PrefixNodeFactory,
  b7 as PrintFloatDomSingle,
  i7 as ProgressBar,
  Na as QuickListCommand,
  Si2 as QuickSumCommand,
  _m2 as RANGE_SELECTOR_COMPONENT_KEY,
  tb2 as RANGE_SELECTOR_SYMBOLS,
  Vx as RECT_OBJECT_ARRAY,
  Fu as REF_SELECTIONS_ENABLED,
  Zx as REGULAR_POLYGON_OBJECT_ARRAY,
  V as RENDER_CLASS_TYPE,
  Sx as RENDER_RAW_FORMULA_KEY,
  J5 as RICHTEXT_OBJECT_ARRAY,
  Ph as RangeMergeUtil,
  Wt2 as RangeProtectionCache,
  di as RangeProtectionPermissionDeleteProtectionPoint,
  Ve4 as RangeProtectionPermissionEditPoint,
  hi as RangeProtectionPermissionManageCollaPoint,
  Bs2 as RangeProtectionPermissionViewPoint,
  ss as RangeProtectionRefRangeService,
  fn2 as RangeProtectionRenderModel,
  me as RangeProtectionRuleModel,
  os as RangeProtectionService,
  xn2 as RangeReferenceObject,
  Br4 as RangeSelector,
  Rt as RangeThemeStyle,
  I1 as Rect,
  ot as RectPopup,
  Va as RectRange,
  RediConsumer,
  RediContext,
  RediProvider,
  oo as RedoShortcutItem,
  At3 as RefRangeService,
  De as RefSelectionsRenderService,
  Co as RefSelectionsService,
  Tr5 as ReferenceAbsoluteOperation,
  Bn3 as ReferenceNodeFactory,
  wa3 as RefillCommand,
  Sl as RegisterFunctionMutation,
  wt3 as RegisterFunctionService,
  et3 as RegisterOtherFormulaService,
  wc as RegisterWorksheetRangeThemeStyleCommand,
  cn as RegisterWorksheetRangeThemeStyleMutation,
  O3 as RegularPolygon,
  $2 as RemoteInstanceServiceName,
  mt3 as RemoteRegisterFunctionService,
  M2 as RemoteSyncPrimaryService,
  W as RemoteSyncServiceName,
  Vr2 as RemoveColByRangeCommand,
  gs as RemoveColCommand,
  Oo3 as RemoveColConfirmCommand,
  Me as RemoveColMutation,
  Qr2 as RemoveDefinedNameCommand,
  Vo2 as RemoveDefinedNameMutation,
  Ea as RemoveFeatureCalculationMutation,
  ye3 as RemoveMergeUndoMutationFactory,
  mi as RemoveNumfmtMutation,
  ba2 as RemoveOtherFormulaMutation,
  Md2 as RemoveRangeThemeMutation,
  Wr2 as RemoveRowByRangeCommand,
  hs as RemoveRowCommand,
  xo as RemoveRowConfirmCommand,
  Te as RemoveRowMutation,
  Zs as RemoveSheetCommand,
  ba4 as RemoveSheetConfirmCommand,
  Lt2 as RemoveSheetMutation,
  hl as RemoveSheetUndoMutationFactory,
  $l as RemoveSuperTableMutation,
  Ic as RemoveWorksheetMergeCommand,
  se2 as RemoveWorksheetMergeMutation,
  Oa3 as RenameSheetOperation,
  I7 as RenderComponent,
  P4 as RenderManagerService,
  ff as RenderSheetContent,
  D0 as RenderSheetFooter,
  L0 as RenderSheetHeader,
  z0 as RenderUnit,
  ks as ReorderRangeCommand,
  On2 as ReorderRangeMutation,
  ja4 as ReorderRangeUndoMutationFactory,
  Kd as ReplaceContentCommand,
  wa as ReplaceSelectionCommand,
  _a as ReplaceSnapshotCommand,
  Zd as ReplaceTextRunsCommand,
  Kc3 as ResetBackgroundColorCommand,
  Un2 as ResetInlineFormatTextBackgroundColorCommand,
  ru3 as ResetRangeTextColorCommand,
  gM as ResetScrollCommand,
  zc2 as ResetTextColorCommand,
  Ee as ResponseHeader,
  Je as RetryInterceptorFactory,
  bo as Ribbon,
  fe as RibbonDataGroup,
  Z3 as RibbonFormulasGroup,
  $e2 as RibbonInsertGroup,
  Bn as RibbonOthersGroup,
  _1 as RibbonPosition,
  Y12 as RibbonStartGroup,
  Ee2 as RibbonViewGroup,
  uA as RichText,
  M as RichTextEditingMutation,
  Zf as RichTextEditor,
  vb as RollingAverage,
  $x as RowHeaderLayout,
  mg as SCOPE_WORKBOOK_VALUE_DEFINED_NAME,
  Vh as SELECTIONS_ENABLED,
  Oh as SELECTION_CONTROL_BORDER_BUFFER_COLOR,
  Nh as SELECTION_CONTROL_BORDER_BUFFER_WIDTH,
  Rm as SELECTION_SHAPE_DEPTH,
  _y as SHAPE_OBJECT_ARRAY,
  f7 as SHAPE_TYPE,
  se3 as SHEETS_NUMFMT_PLUGIN_CONFIG_KEY,
  fs as SHEETS_PLUGIN_CONFIG_KEY,
  Cb as SHEET_EXTENSION_PREFIX,
  wb as SHEET_EXTENSION_TYPE,
  pM as SHEET_UI_PLUGIN_NAME,
  k2 as SHEET_VIEWPORT_KEY,
  Ge5 as SHEET_VIEW_KEY,
  gE as SLIDE_NAVIGATION_KEY,
  Rs2 as SUFFIX_TOKEN_SET,
  GE2 as Scene,
  HB as SceneCanvas,
  dE as SceneViewer,
  D8 as ScrollBar,
  hn2 as ScrollCommand,
  y0 as ScrollTimer,
  OE as ScrollTimerType,
  Xm as ScrollToCellCommand,
  yd as ScrollToCellOperation,
  lu2 as ScrollToRangeOperation,
  Ws2 as SearchFunctionOperation,
  Ma2 as SelectAllCommand,
  gt2 as SelectEditorFormulaOperation,
  qu as SelectRangeCommand,
  jd2 as SelectionControl,
  we3 as SelectionMoveType,
  jd2 as SelectionShape,
  XC as SelectionShapeExtension,
  su2 as SetActivateCellEditOperation,
  vs2 as SetArrayFormulaDataMutation,
  Gc as SetBackgroundColorCommand,
  tg as SetBoldCommand,
  Nc as SetBorderBasicCommand,
  Pc as SetBorderColorCommand,
  In2 as SetBorderCommand,
  Uc as SetBorderPositionCommand,
  Tc as SetBorderStyleCommand,
  Ii2 as SetCellEditVisibleArrowOperation,
  tt5 as SetCellEditVisibleOperation,
  xa3 as SetCellEditVisibleWithF2Operation,
  Oc as SetColDataCommand,
  zt as SetColDataMutation,
  Ka as SetColDataMutationFactory,
  Us as SetColHiddenCommand,
  sn as SetColHiddenMutation,
  on as SetColVisibleMutation,
  Bn4 as SetColWidthCommand,
  ya2 as SetColumnFrozenCommand,
  da as SetColumnHeaderHeightCommand,
  je2 as SetCurrencyCommand,
  ni as SetDefinedNameCommand,
  _a2 as SetDefinedNameMutation,
  Fb as SetDefinedNameMutationFactory,
  Xn2 as SetDocZoomRatioCommand,
  tt2 as SetDocZoomRatioOperation,
  Aa as SetFeatureCalculationMutation,
  ig2 as SetFontFamilyCommand,
  ag as SetFontSizeCommand,
  _a4 as SetFormatPainterOperation,
  Sn as SetFormulaCalculationNotificationMutation,
  Mo2 as SetFormulaCalculationResultMutation,
  Oo as SetFormulaCalculationStartMutation,
  So2 as SetFormulaCalculationStopMutation,
  Do2 as SetFormulaDataMutation,
  xc as SetFrozenCommand,
  st2 as SetFrozenMutation,
  si as SetFrozenMutationFactory,
  Wc as SetGridlinesColorCommand,
  Gt as SetGridlinesColorMutation,
  qc2 as SetHorizontalTextAlignCommand,
  wo as SetImageFormulaDataMutation,
  iu2 as SetInfiniteFormatPainterCommand,
  Qt as SetInlineFormatBoldCommand,
  yt as SetInlineFormatCommand,
  _t as SetInlineFormatFontFamilyCommand,
  ct3 as SetInlineFormatFontSizeCommand,
  Ut as SetInlineFormatItalicCommand,
  Ht as SetInlineFormatStrikethroughCommand,
  bt as SetInlineFormatSubscriptCommand,
  kt3 as SetInlineFormatSuperscriptCommand,
  Et as SetInlineFormatTextBackgroundColorCommand,
  mt as SetInlineFormatTextColorCommand,
  Ft2 as SetInlineFormatUnderlineCommand,
  ng as SetItalicCommand,
  O4 as SetNumfmtCommand,
  so2 as SetNumfmtMutation,
  ss2 as SetOnceFormatPainterCommand,
  Ra as SetOtherFormulaMutation,
  rg as SetOverlineCommand,
  Xe4 as SetParagraphNamedStyleCommand,
  Le5 as SetPercentCommand,
  Vc2 as SetProtectionCommand,
  zi2 as SetRangeBoldCommand,
  nu3 as SetRangeFontDecreaseCommand,
  Eo2 as SetRangeFontFamilyCommand,
  tu2 as SetRangeFontIncreaseCommand,
  fa2 as SetRangeFontSizeCommand,
  ji3 as SetRangeItalicCommand,
  ui2 as SetRangeProtectionFromContextMenuCommand,
  fe3 as SetRangeProtectionMutation,
  Zi2 as SetRangeStrickThroughCommand,
  km2 as SetRangeSubscriptCommand,
  Dm as SetRangeSuperscriptCommand,
  To2 as SetRangeTextColorCommand,
  _d as SetRangeThemeMutation,
  Yi2 as SetRangeUnderlineCommand,
  Sn2 as SetRangeValuesCommand,
  ee2 as SetRangeValuesMutation,
  Ae4 as SetRangeValuesUndoMutationFactory,
  Lc as SetRowDataCommand,
  Kt2 as SetRowDataMutation,
  ru2 as SetRowDataMutationFactory,
  Ia2 as SetRowFrozenCommand,
  ca3 as SetRowHeaderWidthCommand,
  Kn as SetRowHeightCommand,
  Ts3 as SetRowHiddenCommand,
  Tt as SetRowHiddenMutation,
  Ut2 as SetRowVisibleMutation,
  or4 as SetScrollOperation,
  Ao3 as SetScrollRelativeCommand,
  ei as SetSelectedColsVisibleCommand,
  oi as SetSelectedRowsVisibleCommand,
  Jn4 as SetSelectionFrozenCommand,
  ie5 as SetSelectionsOperation,
  dn as SetSpecificColsVisibleCommand,
  hn as SetSpecificRowsVisibleCommand,
  og as SetStrikeThroughCommand,
  Ce as SetStyleCommand,
  kl as SetSuperTableMutation,
  Lo3 as SetSuperTableOptionMutation,
  Qc as SetTabColorCommand,
  Un4 as SetTabColorMutation,
  jc as SetTextColorCommand,
  Xc2 as SetTextRotationCommand,
  k as SetTextSelectionsOperation,
  Yc2 as SetTextWrapCommand,
  sg as SetUnderlineCommand,
  Jc2 as SetVerticalTextAlignCommand,
  ai as SetWorkbookNameCommand,
  ii as SetWorkbookNameMutation,
  ui as SetWorksheetActivateCommand,
  pn as SetWorksheetActiveOperation,
  ls2 as SetWorksheetColAutoWidthCommand,
  mt2 as SetWorksheetColWidthMutation,
  Zo as SetWorksheetColWidthMutationFactory,
  td as SetWorksheetColumnCountCommand,
  Jt2 as SetWorksheetColumnCountMutation,
  uu as SetWorksheetColumnCountUndoMutationFactory,
  nd2 as SetWorksheetDefaultStyleCommand,
  qt as SetWorksheetDefaultStyleMutation,
  lu as SetWorksheetDefaultStyleMutationFactory,
  sd2 as SetWorksheetHideCommand,
  St2 as SetWorksheetHideMutation,
  eo2 as SetWorksheetNameCommand,
  jn3 as SetWorksheetNameMutation,
  ci as SetWorksheetOrderCommand,
  Tn2 as SetWorksheetOrderMutation,
  dd as SetWorksheetPermissionPointsCommand,
  to2 as SetWorksheetPermissionPointsMutation,
  hd as SetWorksheetProtectionCommand,
  bt2 as SetWorksheetProtectionMutation,
  rc as SetWorksheetRangeThemeStyleCommand,
  tn as SetWorksheetRangeThemeStyleMutation,
  Wa2 as SetWorksheetRangeThemeStyleMutationFactory,
  lg as SetWorksheetRightToLeftCommand,
  Is4 as SetWorksheetRightToLeftMutation,
  er2 as SetWorksheetRowAutoHeightMutation,
  yh2 as SetWorksheetRowAutoHeightMutationFactory,
  md as SetWorksheetRowCountCommand,
  Yt2 as SetWorksheetRowCountMutation,
  cu as SetWorksheetRowCountUndoMutationFactory,
  nt2 as SetWorksheetRowHeightMutation,
  no as SetWorksheetRowIsAutoHeightCommand,
  Fe3 as SetWorksheetRowIsAutoHeightMutation,
  gi as SetWorksheetShowCommand,
  cs3 as SetZoomRatioCommand,
  Ln2 as SetZoomRatioOperation,
  x3 as Shape,
  ie3 as SharedController,
  T0 as SheetBar,
  Pi as SheetCanvasPopManagerService,
  kl3 as SheetCellDropdownManagerService,
  ko4 as SheetCellEditorResizeService,
  ol2 as SheetClipboardService,
  N7 as SheetColumnHeaderExtensionRegistry,
  $7 as SheetComponent,
  dn2 as SheetCopyCommand,
  Jd3 as SheetCutCommand,
  C3 as SheetExtension,
  G as SheetInterceptorService,
  Ln as SheetLazyExecuteScheduleService,
  Lb as SheetMenuPosition,
  _n4 as SheetOnlyPasteFormulaCommand,
  So4 as SheetPasteBesidesBorderCommand,
  li2 as SheetPasteColWidthCommand,
  un2 as SheetPasteCommand,
  vo3 as SheetPasteFormatCommand,
  Gc2 as SheetPasteShortKeyCommand,
  l7 as SheetPasteShortKeyCommandName,
  po3 as SheetPasteValueCommand,
  Yn2 as SheetPermissionCheckController,
  Ti2 as SheetPermissionCheckUIController,
  Xn3 as SheetPermissionInitController,
  jm as SheetPermissionOpenDialogOperation,
  On3 as SheetPermissionOpenPanelOperation,
  ad3 as SheetPermissionRenderManagerService,
  Dr4 as SheetPermissionUserManagerService,
  Up as SheetPrintInterceptorService,
  ve2 as SheetRangeThemeModel,
  Os2 as SheetRangeThemeService,
  vl2 as SheetRenderController,
  Kl as SheetRowFilteredService,
  P7 as SheetRowHeaderExtensionRegistry,
  Et3 as SheetScrollManagerService,
  cd3 as SheetSelectionRenderService,
  du as SheetSkeletonChangeType,
  he2 as SheetSkeletonManagerService,
  rt3 as SheetSkeletonService,
  Sl3 as SheetUIController,
  hu as SheetValueChangeType,
  qn3 as SheetsFreezeSyncController,
  D3 as SheetsNumfmtCellContentController,
  rr4 as SheetsRenderService,
  Ri3 as SheetsScrollRenderController,
  z as SheetsSelectionsService,
  V_ as SheetsUIMenuSchema,
  qm as SheetsUIPart,
  se as ShortcutPanelController,
  G32 as ShortcutPanelService,
  je as ShortcutService,
  zb as ShowGridlinesState,
  Ea4 as ShowMenuListCommand,
  or as Sidebar,
  au2 as SidebarDefinedNameOperation,
  uo as SingleCanvasPopup,
  sr as SingleUnitUIController,
  rb as SkeletonType,
  kA as Slide,
  Ji2 as Slider,
  vu as SplitDelimiterEnum,
  fd as SplitTextToColumnsCommand,
  dA as Spreadsheet,
  qB as SpreadsheetColumnHeader,
  q3 as SpreadsheetExtensionRegistry,
  U7 as SpreadsheetHeader,
  sA as SpreadsheetRowHeader,
  Z5 as SpreadsheetSkeleton,
  Tr4 as StatusBarController,
  gf as StatusBarService,
  U2 as StringValueObject,
  Be5 as SubtractDecimalCommand,
  Fn3 as SuffixNodeFactory,
  Fl2 as SuperTableService,
  ko2 as SwitchDocModeCommand,
  Dy as TEXT_OBJECT_ARRAY,
  mr as TEXT_RANGE_LAYER_INDEX,
  x1 as TRANSFORM_CHANGE_OBSERVABLE_TYPE,
  Jt as TabCommand,
  u7 as TestConfirmService,
  Z4 as Text,
  Zt2 as TextRange,
  s3 as ThemeSwitcherService,
  Ke as ThresholdInterceptorFactory,
  Rd2 as ToggleCellCheckboxCommand,
  Pa as ToggleCheckListCommand,
  Cd as ToggleGridlinesCommand,
  Xt2 as ToggleGridlinesMutation,
  i3 as ToggleShortcutPanelOperation,
  vo as ToolbarButton,
  Se as ToolbarItem,
  B12 as Transform,
  ge4 as TriggerCalculationController,
  F5 as UIMenu,
  Y5 as UIMenuSchema,
  Xn as UIPartsService,
  ae as UI_PLUGIN_CONFIG_KEY,
  pa5 as UNIVER_SHEET_PERMISSION_USER_PART,
  Vi as UNIVER_UI_PLUGIN_NAME,
  hA as UNIVER_WATERMARK_LAYER_INDEX,
  cA as UNIVER_WATERMARK_STORAGE_KEY,
  s72 as UNI_DISABLE_CHANGING_FOCUS_KEY,
  ro as UndoShortcutItem,
  kn as UnionNodeFactory,
  _ as UnitAction,
  x4 as UnitObject,
  q as UniverDocsPlugin,
  wr as UniverDocsUIPlugin,
  uo3 as UniverFormulaEnginePlugin,
  P32 as UniverMobileUIPlugin,
  V2 as UniverNetworkPlugin,
  yb as UniverPrintingContext,
  N2 as UniverRPCMainThreadPlugin,
  x2 as UniverRPCWorkerThreadPlugin,
  ct5 as UniverRemoteSheetsFormulaPlugin,
  o7 as UniverRenderEnginePlugin,
  bb as UniverRenderingContext,
  O7 as UniverRenderingContext2D,
  or6 as UniverSheetsCorePreset,
  lt4 as UniverSheetsFormulaPlugin,
  jt as UniverSheetsFormulaUIPlugin,
  Dl2 as UniverSheetsMobileUIPlugin,
  A as UniverSheetsNumfmtPlugin,
  ee3 as UniverSheetsNumfmtUIPlugin,
  rs2 as UniverSheetsPlugin,
  Ll3 as UniverSheetsUIPlugin,
  F3 as UniverUIPlugin,
  pd as UnregisterWorksheetRangeThemeStyleCommand,
  Xs as UnregisterWorksheetRangeThemeStyleMutation,
  Ca as UpdateCommand,
  tt4 as UpdateDefinedNameController,
  at2 as UpdateFormulaController,
  ps as VALIDATE_CELL,
  J12 as VERTICAL_ROTATE_ANGLE,
  We2 as VIEWPORT_KEY,
  nu as ValueNodeFactory,
  Pt3 as ValueObjectFactory,
  U as Vector2,
  ci2 as ViewSheetPermissionFromContextMenuCommand,
  Ca4 as ViewSheetPermissionFromSheetBarCommand,
  Au as ViewStateEnum,
  vA as Viewport,
  gA as WatermarkLayer,
  Ye as WebSocketService,
  q5 as WebWorkerRemoteInstanceService,
  WithDependency,
  rr2 as WorkbookCommentPermission,
  ir4 as WorkbookCopyPermission,
  Xu as WorkbookCopySheetPermission,
  ar3 as WorkbookCreateProtectPermission,
  ur2 as WorkbookCreateSheetPermission,
  Zu as WorkbookDeleteColumnPermission,
  Qu as WorkbookDeleteRowPermission,
  lr2 as WorkbookDeleteSheetPermission,
  cr2 as WorkbookDuplicatePermission,
  Pe3 as WorkbookEditablePermission,
  dr2 as WorkbookExportPermission,
  js2 as WorkbookHideSheetPermission,
  el as WorkbookHistoryPermission,
  tl as WorkbookInsertColumnPermission,
  nl as WorkbookInsertRowPermission,
  zs as WorkbookManageCollaboratorPermission,
  Gs as WorkbookMoveSheetPermission,
  mn2 as WorkbookPermissionService,
  hr2 as WorkbookPrintPermission,
  gr3 as WorkbookRecoverHistoryPermission,
  Ks as WorkbookRenameSheetPermission,
  Wu as WorkbookSelectionModel,
  mr2 as WorkbookSharePermission,
  Rr2 as WorkbookViewHistoryPermission,
  fr4 as WorkbookViewPermission,
  Cr as WorksheetCopyPermission,
  pr2 as WorksheetDeleteColumnPermission,
  Sr2 as WorksheetDeleteProtectionPermission,
  wr2 as WorksheetDeleteRowPermission,
  Ir2 as WorksheetEditExtraObjectPermission,
  Le2 as WorksheetEditPermission,
  vr3 as WorksheetFilterPermission,
  Mr as WorksheetInsertColumnPermission,
  _r2 as WorksheetInsertHyperlinkPermission,
  yr2 as WorksheetInsertRowPermission,
  br4 as WorksheetManageCollaboratorPermission,
  zn2 as WorksheetPermissionService,
  Er as WorksheetPivotTablePermission,
  vn2 as WorksheetProtectionPointModel,
  lt3 as WorksheetProtectionRuleModel,
  Bh as WorksheetSelectProtectedCellsPermission,
  jh2 as WorksheetSelectUnProtectedCellsPermission,
  kr2 as WorksheetSetCellStylePermission,
  An3 as WorksheetSetCellValuePermission,
  Zt3 as WorksheetSetColumnStylePermission,
  Qt3 as WorksheetSetRowStylePermission,
  Ur as WorksheetSortPermission,
  ds as WorksheetViewPermission,
  D2 as XHRHTTPImplementation,
  Ae as ZIndexManager,
  Zn as ZebraCrossingCacheController,
  ir2 as ZenZone,
  Gf as addCustomDecorationBySelectionFactory,
  cd as addCustomDecorationFactory,
  Ge as addCustomRangeBySelectionFactory,
  Xe as addCustomRangeFactory,
  Qh as addMergeCellsUtil,
  Hl2 as adjustRangeOnMutation,
  cs2 as alignToMergedCellsBorders,
  $s2 as attachPrimaryWithCoord,
  Io3 as attachRangeWithCoord,
  Wt3 as attachSelectionWithCoord,
  pt2 as baseProtectionActions,
  nr2 as calcDocRangePositions,
  gb3 as calculateDocSkeletonRects,
  Po3 as calculateFormula,
  v2 as calculateRectRotate,
  Hv as cancelRequestFrame,
  uo4 as checkCellValueType,
  fl3 as checkInHeaderRanges,
  Rg as checkRangesEditablePermission,
  EB as checkStyle,
  ab as clampRange,
  LB as clearLineByBorderType,
  Y3 as compareToken,
  connectDependencies,
  connectInjector,
  Vd as convertBodyToHtml,
  bM as convertPositionCellToSheetOverGrid,
  wM as convertPositionSheetOverGridToAbsolute,
  Jo as convertPositionsToRectRanges,
  Iu as convertPrimaryWithCoordToPrimary,
  Dh as convertSelectionDataToRange,
  A3 as convertTextRotation,
  aA as convertTransformToOffsetX,
  rA as convertTransformToOffsetY,
  yl2 as convertUnitDataToRuntime,
  Ct2 as copyRangeStyles,
  Sl2 as countCells,
  _7 as createCanvasElement,
  lB as createImageElement,
  Su as createTopMatrixFromMatrix,
  pu as createTopMatrixFromRanges,
  ne3 as currencySymbols,
  qr2 as defaultLargeSheetOperationConfig,
  id2 as defaultWorkbookPermissionPoints,
  ws as defaultWorksheetPermissionPoint,
  Q1 as degToRad,
  Yf as deleteCustomDecorationFactory,
  ze2 as deleteCustomRangeFactory,
  pt3 as deriveStateFromActiveSheet$,
  wh as deserializeRangeForR1C1,
  kr as deserializeRangeWithSheet,
  br3 as deserializeRangeWithSheetWithCache,
  Cr3 as discreteRangeToRange,
  qf as docDrawingPositionToTransform,
  ob as drawDiagonalineByBorderType,
  X2 as drawLineByBorderType,
  SB as expandRangeIfIntersects,
  Th as expandToContinuousRange,
  $b as extractFormulaError,
  dg2 as factoryRemoveNumfmtUndoMutation,
  cg as factorySetNumfmtUndoMutation,
  tr as findAllRectangle,
  Ah as findFirstNonEmptyCell,
  Z2 as fixLineWidthByScale,
  ut2 as followSelectionOperation,
  Y2 as fromModule,
  jh as functionArray,
  gg as functionCompatibility,
  dg as functionCube,
  wg as functionDatabase,
  g1 as functionDate,
  ja6 as functionDisplayNames,
  Ad2 as functionEngineering,
  p0 as functionFinancial,
  Q0 as functionInformation,
  hC as functionLogical,
  ZC2 as functionLookup,
  SA as functionMath,
  jA as functionMeta,
  nR2 as functionStatistical,
  lb2 as functionText,
  fb2 as functionUniver,
  gb2 as functionWeb,
  Sr4 as genNormalSelectionStyle,
  jC as genSelectionByRange,
  ma2 as genTableSource,
  Ti as generateAstNode,
  Bi as generateExecuteAstNodeData,
  sr2 as generateNullCell,
  Nu as generateNullCellValue,
  pa2 as generateParagraphs,
  gr2 as generateRandomDependencyTreeId,
  Wv as generateRandomKey,
  yi as generateStringWithSequence,
  Ib as getAbsoluteRefTypeWitString,
  _n as getAbsoluteRefTypeWithSingleString,
  Jr3 as getAddMergeMutationRangeByType,
  Ee4 as getAllRangePermissionPoint,
  ym as getAllSelection,
  gn2 as getAllWorkbookPermissionPoint,
  be3 as getAllWorksheetPermissionPoint,
  He2 as getAllWorksheetPermissionPointByPointPanel,
  Jn2 as getAnchorBounding,
  dM as getAutoFillRepeatRange,
  dA2 as getCanvasOffsetByEngine,
  Lh as getCellAtRowCol,
  DB as getCellByIndexWithMergeInfo,
  Qv as getCellPositionByIndex,
  Vw as getCellRealRange,
  l0 as getCharSpaceApply,
  O2 as getColor,
  Ke3 as getCommandSkeleton,
  ph2 as getCoordByCell,
  An4 as getCoordByOffset,
  Pe4 as getCurrencyFormat,
  it3 as getCurrencyFormatOptions,
  at3 as getCurrencyOptions,
  Y4 as getCurrencySymbolByLocale,
  xe4 as getCurrencySymbolIconByLocale,
  ot4 as getCurrencyType,
  Cb2 as getCurrentExclusiveRangeInterest$,
  ue2 as getCurrentRangeDisable$,
  Be2 as getCurrentScrollXY,
  eF as getCurrentTypeOfRenderer,
  $r as getCursorWhenDelete,
  Rd as getCustomBlockIdsInSelections,
  SM as getCustomRangePosition,
  Bd as getCutActionsFromDocRanges,
  E0 as getDPI,
  ct7 as getDateFormatOptions,
  P6 as getDecimalFromPattern,
  q7 as getDecimalString,
  ug2 as getDefaultRangePermission,
  B7 as getDevicePixelRatio,
  ad as getDocObject,
  zf as getDocObjectById,
  re as getDocsSkeletonPageSize,
  CM as getEditingCustomRangePosition,
  Xd2 as getEditorObject,
  Kr as getEmptyTableCell,
  qr as getEmptyTableRow,
  g3 as getFontStyleString,
  gb as getGroupState,
  qi as getHeaderFooterMenuHiddenObservable,
  Tr2 as getInsertRangeMutations,
  eA as getLastColumn,
  dz as getLastLine,
  Es as getLineBounding,
  lb as getLineOffset,
  R7 as getLineWidth,
  ub as getLineWith,
  q12 as getMatrixPlainText,
  Xi as getMenuHiddenObservable,
  Fs2 as getMoveRangeUndoRedoMutations,
  Cg2 as getNextPrimaryCell,
  lt5 as getNumberFormatOptions,
  M3 as getNumberUnitValue,
  Qb as getObjectValue,
  Gi3 as getObservableWithExclusiveRange$,
  UB as getOffsetRectForDom,
  fi as getOneTextSelectionRange,
  xz as getPageFromPath,
  sb as getParagraphByGlyph,
  He5 as getPatternPreview,
  Ge6 as getPatternPreviewIgnoreGeneral,
  st4 as getPatternType,
  F6 as getPointerPrefix,
  _e3 as getPrimaryForRange,
  Bb as getRangeWithRefsString,
  Pr2 as getRemoveRangeMutations,
  hM as getRepeatRange,
  Ae2 as getRichTextEditPath,
  M7 as getRotateOffsetAndFarthestHypotenuse,
  db as getRotateOrientation,
  E7 as getScale,
  Ju as getSelectionsService,
  qh as getSeparateEffectedRangesOnCommand,
  P5 as getSheetCommandTarget,
  Yo as getSheetCommandTargetWorkbook,
  Qe2 as getSheetMutationTarget,
  $t4 as getSheetObject,
  tb as getSizeForDom,
  Uh as getSkeletonChangedEffectedRange,
  TB as getSystemHighlightColor,
  Xr as getTableColumn,
  QB as getTableIdAndSliceIndex,
  Yd2 as getTopLeftSelectionOfCurrSheet,
  Vs2 as getTransformCoord,
  PB as getTranslateInSpreadContextWithPixelRatio,
  kh as getValueChangedEffectedRange,
  j3 as getValueType,
  ls as getVisibleRanges,
  tA as glyphIterator,
  m7 as handelExcelToJson,
  v7 as handelTableToJson,
  Ot as handleBaseInsertRange,
  Wn2 as handleBaseMoveRowsCols,
  Nt3 as handleBaseRemoveRange,
  So3 as handleCommonDefaultRangeChangeWithEffectRefCommands,
  Jh as handleCommonRangeChangeWithEffectRefCommandsSkipNoInterests,
  po2 as handleDefaultRangeChangeWithEffectRefCommands,
  Kh as handleDefaultRangeChangeWithEffectRefCommandsSkipNoInterests,
  Dl as handleDeleteRangeMoveLeft,
  xl2 as handleDeleteRangeMoveUp,
  Gh as handleDeleteRangeMutation,
  hr as handleDomToJson,
  Gr3 as handleIRemoveCol,
  yl3 as handleIRemoveRow,
  Ul as handleInsertCol,
  Tl as handleInsertRangeMoveDown,
  Nl3 as handleInsertRangeMoveRight,
  zh as handleInsertRangeMutation,
  kl2 as handleInsertRow,
  zr as handleMoveCols,
  Ml as handleMoveRange,
  jr2 as handleMoveRows,
  Yb as handleNumfmtInCell,
  g7 as handlePlainToJson,
  Ca2 as handleRefStringInfo,
  dt as handleStringToStyle,
  h7 as handleTableColgroup,
  p7 as handleTableMergeData,
  C72 as handleTableRowGroup,
  kB as hasAllLatin,
  j7 as hasArabic,
  mB as hasBasicLatin,
  x0 as hasCJK,
  T6 as hasCJKPunctuation,
  r0 as hasCJKText,
  fB as hasLatinExtendedA,
  vB as hasLatinExtendedB,
  pB as hasLatinOneSupplement,
  BB as hasListGlyph,
  Kf as hasParagraphInTable,
  Zv as hasSpace,
  w7 as hasTibetan,
  jB as hasUnMergedCellInRow,
  c7 as imageMimeTypeSet,
  S7 as inViewRanges,
  Jc as includeFormulaLexerToken,
  Ni as initSheetFormulaData,
  xB as injectStyle,
  gB as isArray,
  C7 as isCjkCenterAlignedPunctuation,
  G4 as isCjkLeftAlignedPunctuation,
  q4 as isCjkRightAlignedPunctuation,
  uB as isDate,
  vM as isEmbeddingFormulaEditor,
  MB as isFirstGlyph,
  Cn2 as isFormulaLexerToken,
  H4 as isFunction,
  Xc as isInDirtyRange,
  Fa as isInSameTableCell,
  AB as isIndentByGlyph,
  RB as isLastGlyph,
  cB as isNumber,
  hB as isObject,
  nt5 as isPatternHasDecimal,
  OB as isPlaceholderOrSpace,
  nb as isRangeSelector,
  CB as isRectIntersect,
  bo2 as isReferenceString,
  An2 as isReferenceStringWithEffectiveColumn,
  xl as isReferenceStrings,
  dB as isRegExp,
  IB as isSameLine,
  Fh as isSingleCellSelection,
  S6 as isString,
  tA2 as isValidRectRange,
  d0 as lineIterator,
  w2 as localeCurrencySymbolMap,
  Tb as matchRefDrawToken,
  X4 as matchToken,
  wB as mergeInfoOffset,
  h5 as mergeMenuConfigs,
  uh2 as mergeSetRangeValues,
  Is3 as needsQuoting,
  pt as neoGetDocObject,
  vb2 as normalizeSheetName,
  Z6 as operatorToken,
  G6 as parseDataStreamToTree,
  FB as pixelToPt,
  de as precisionTo,
  we2 as prefixToken,
  zB as ptToMM,
  c3 as ptToPixel,
  bB as ptToPx,
  _B as pxToInch,
  T3 as pxToNum,
  yB as pxToPt,
  Bs as quoteSheetName,
  D7 as radToDeg,
  nr3 as rangeMerge,
  Du as rangeToDiscreteRange,
  uE as renderImageWatermark,
  lE as renderTextWatermark,
  oE as renderUserInfoWatermark,
  iE as renderWatermark,
  Fe as replaceSelectionFactory,
  a0 as requestNewFrame,
  Oe as rotateRange,
  Dt as runRefRangeMutations,
  He as sequenceNodeType,
  Yt as serializeRange,
  Ts2 as serializeRangeToRefString,
  wl as serializeRangeWithSheet,
  Ll as serializeRangeWithSpreadsheet,
  Hh as setEndForRange,
  A7 as setLineType,
  F2 as setPatternDecimal,
  Db as sheetContentViewportKeys,
  jb as sheetHeaderViewportKeys,
  bs2 as singleReferenceToGrid,
  ku as splitRangeText,
  Ei as splitSpanText,
  h4 as startWithEmoji,
  ji as strip,
  Sa2 as stripErrorMargin,
  Ao as supportClipboardAPI,
  o72 as t,
  R3 as textTrim,
  B as toModule,
  K2 as toPx,
  Ps as transformCellsToRange,
  cb as transformObjectOutOfGroup,
  Xf as transformToDocDrawingPosition,
  bi2 as unquoteSheetName,
  Wr4 as useActiveWorkbook,
  mM as useActiveWorksheet,
  t7 as useClickOutSide,
  I12 as useComponentsOfPart,
  y5 as useConfigValue,
  n7 as useDebounceFn,
  useDependency,
  re2 as useEvent,
  VR as useHighlightRange,
  useInjector,
  uf as useKeyEventConfig,
  Tf as useKeyboardEvent,
  useObservable,
  g5 as useObservableRef,
  Bf as useResize,
  w5 as useScrollYOverContainer,
  f72 as useSidebarClick,
  go as useToolbarItemStatus,
  useUpdateBinder,
  e7 as useUpdateEffect,
  r7 as useVirtualList,
  fM as useWorkbooks,
  wr4 as virtualizeDiscreteRanges,
  Se2 as whenDocAndEditorFocused,
  uM as whenFormulaEditorActivated,
  Ne2 as whenSheetEditorFocused,
  fA as withCurrentTypeOfRenderer
};
//# sourceMappingURL=@univerjs_presets_preset-sheets-core.js.map

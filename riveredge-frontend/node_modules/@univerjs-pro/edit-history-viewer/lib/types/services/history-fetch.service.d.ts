import { ILogContext, CompressMutationService, ISnapshotServerService } from '@univerjs-pro/collaboration';
import { Nullable, Disposable, ICommandService, IConfigService, IUniverInstanceService } from '@univerjs/core';
import { HTTPService } from '@univerjs/network';
import { UniverType } from '@univerjs/protocol';
import { SheetPermissionInitController } from '@univerjs/sheets';
export interface IHistoryVersion {
    unitId: string;
    id: string;
    startRev: number;
    endRev: number;
    time?: number;
    user: string;
    recoverTime?: number;
    commands: string[];
    isAnonymous: boolean;
}
export interface IServiceVersionsData {
    hasMore: boolean;
    lastLabel: string;
    entities: {
        datas: Record<string, IVersionItem>;
        users: Record<string, IUser>;
    };
    historyIds: string[];
}
export interface IVersionItem {
    unitId: string;
    userId: string;
    command: string[];
    createTime: number;
    startRevision: number;
    endRevision: number;
    recoverTime?: string;
}
export interface IUser {
    userID: string;
    name: string;
    avatar: string;
    anonymous: boolean;
    canBindAnonymous: boolean;
}
export interface IChangeset {
    /** unitID of the Univer document */
    unitID: string;
    type: UniverType;
    baseRev: number;
    revision: number;
    userID: string;
    mutations: any[];
    memberID: string;
}
export declare class HistoryFetchService extends Disposable {
    private readonly _snapshotServerService;
    private readonly _univerInstanceService;
    private readonly _commandService;
    private readonly _configService;
    private readonly _httpService;
    private _compressMutationService;
    private _sheetPermissionInitController;
    private _workbookDataCache;
    constructor(_snapshotServerService: ISnapshotServerService, _univerInstanceService: IUniverInstanceService, _commandService: ICommandService, _configService: IConfigService, _httpService: HTTPService, _compressMutationService: CompressMutationService, _sheetPermissionInitController: SheetPermissionInitController);
    dispose(): void;
    getVersions(unitID: string, lastLabel?: string): Promise<Nullable<{
        hasMore: boolean;
        lastLabel: string;
        versions: IHistoryVersion[];
        members: Record<string, IUser>;
    }>>;
    private _getAPIPrefix;
    loadSheet(unitID: string, rev: number, context?: ILogContext): Promise<unknown>;
    private _createUnit;
}
export declare function convertEntitiesToVersions(data: IServiceVersionsData): IHistoryVersion[];

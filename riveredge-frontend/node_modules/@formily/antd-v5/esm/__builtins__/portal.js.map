{"version":3,"file":"portal.js","sourceRoot":"lib/","sources":["__builtins__/portal.tsx"],"names":[],"mappings":"AAAA,OAAO,EAAE,QAAQ,EAAW,MAAM,gBAAgB,CAAA;AAClD,OAAO,EAAE,UAAU,EAAE,MAAM,mBAAmB,CAAA;AAC9C,OAAO,KAAK,EAAE,EAAE,QAAQ,EAAE,MAAM,OAAO,CAAA;AACvC,OAAO,EAAE,YAAY,EAAE,MAAM,WAAW,CAAA;AACxC,OAAO,EAAE,MAAM,IAAI,WAAW,EAAE,OAAO,IAAI,YAAY,EAAE,MAAM,UAAU,CAAA;AAKzE,IAAM,SAAS,GAAG,UAAU,CAAC,IAAI,GAAG,EAAoC,CAAC,CAAA;AAEzE,MAAM,CAAC,IAAM,oBAAoB,GAAG,UAAC,EAAmB;IACtD,IAAM,MAAM,GAA0B,UAAC,KAAK;;QAC1C,IAAM,QAAQ,GAAG,MAAA,KAAK,CAAC,EAAE,mCAAI,EAAE,CAAA;QAC/B,IAAI,QAAQ,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,QAAQ,CAAC,EAAE;YACxC,SAAS,CAAC,GAAG,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAA;SAC9B;QAED,OAAO,CACL,oBAAC,QAAQ;YACN,KAAK,CAAC,QAAQ;YACf,oBAAC,QAAQ,QACN;gBACC,IAAI,QAAS;oBAAE,OAAO,yCAAK,CAAA;gBAC3B,IAAM,MAAM,GAAG,SAAS,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAA;gBACtC,IAAI,MAAM;oBAAE,OAAO,YAAY,CAAC,MAAM,EAAE,QAAQ,CAAC,IAAI,CAAC,CAAA;gBACtD,OAAO,yCAAK,CAAA;YACd,CAAC,CACQ,CACF,CACZ,CAAA;IACH,CAAC,CAAA;IAED,OAAO,MAAM,CAAA;AACf,CAAC,CAAA;AAED,MAAM,UAAU,gBAAgB,CAC9B,IAAiB,EACjB,EAAU;IAEV,SAAS,MAAM,CAAC,QAAkB;QAChC,IAAI,SAAS,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE;YACrB,SAAS,CAAC,GAAG,CAAC,EAAE,EAAE,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,EAAI,CAAC,CAAA;SAChC;aAAM,IAAI,IAAI,EAAE;YACf,WAAW,CAAC,oBAAC,QAAQ,QAAE,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,EAAI,CAAY,EAAE,IAAI,CAAC,CAAA;SACvD;IACH,CAAC;IAED,SAAS,OAAO;;QACd,IAAI,SAAS,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE;YACrB,SAAS,CAAC,GAAG,CAAC,EAAE,EAAE,IAAI,CAAC,CAAA;SACxB;QACD,IAAI,IAAI,EAAE;YACR,IAAM,aAAa,GAAG,YAAY,CAAC,IAAI,CAAC,CAAA;YACxC,IAAI,aAAa,IAAI,IAAI,CAAC,UAAU,EAAE;gBACpC,MAAA,IAAI,CAAC,UAAU,0CAAE,WAAW,CAAC,IAAI,CAAC,CAAA;aACnC;SACF;IACH,CAAC;IAED,OAAO;QACL,MAAM,QAAA;QACN,OAAO,SAAA;KACR,CAAA;AACH,CAAC","sourcesContent":["import { Observer, ReactFC } from '@formily/react'\nimport { observable } from '@formily/reactive'\nimport React, { Fragment } from 'react'\nimport { createPortal } from 'react-dom'\nimport { render as reactRender, unmount as reactUnmount } from './render'\nexport interface IPortalProps {\n  id?: string | symbol\n}\n\nconst PortalMap = observable(new Map<string | symbol, React.ReactNode>())\n\nexport const createPortalProvider = (id: string | symbol) => {\n  const Portal: ReactFC<IPortalProps> = (props) => {\n    const portalId = props.id ?? id\n    if (portalId && !PortalMap.has(portalId)) {\n      PortalMap.set(portalId, null)\n    }\n\n    return (\n      <Fragment>\n        {props.children}\n        <Observer>\n          {() => {\n            if (portalId!) return <></>\n            const portal = PortalMap.get(portalId)\n            if (portal) return createPortal(portal, document.body)\n            return <></>\n          }}\n        </Observer>\n      </Fragment>\n    )\n  }\n\n  return Portal\n}\n\nexport function createPortalRoot<T extends React.ReactNode>(\n  host: HTMLElement,\n  id: string\n) {\n  function render(renderer?: () => T) {\n    if (PortalMap.has(id)) {\n      PortalMap.set(id, renderer?.())\n    } else if (host) {\n      reactRender(<Fragment>{renderer?.()}</Fragment>, host)\n    }\n  }\n\n  function unmount() {\n    if (PortalMap.has(id)) {\n      PortalMap.set(id, null)\n    }\n    if (host) {\n      const unmountResult = reactUnmount(host)\n      if (unmountResult && host.parentNode) {\n        host.parentNode?.removeChild(host)\n      }\n    }\n  }\n\n  return {\n    render,\n    unmount,\n  }\n}\n"]}
{"version":3,"file":"index.js","sourceRoot":"lib/","sources":["array-cards/index.tsx"],"names":[],"mappings":"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","sourcesContent":["import { ArrayField } from '@formily/core'\nimport { ISchema } from '@formily/json-schema'\nimport {\n  observer,\n  ReactFC,\n  RecursionField,\n  useField,\n  useFieldSchema,\n} from '@formily/react'\nimport { Card, CardProps, Empty } from 'antd'\nimport cls from 'classnames'\nimport React from 'react'\nimport { ArrayBase } from '../array-base'\nimport { usePrefixCls } from '../__builtins__'\nimport useStyle from './style'\n\nconst isAdditionComponent = (schema: ISchema) => {\n  return schema['x-component']?.indexOf('Addition') > -1\n}\n\nconst isIndexComponent = (schema: ISchema) => {\n  return schema['x-component']?.indexOf?.('Index') > -1\n}\n\nconst isRemoveComponent = (schema: ISchema) => {\n  return schema['x-component']?.indexOf?.('Remove') > -1\n}\n\nconst isCopyComponent = (schema: ISchema) => {\n  return schema['x-component']?.indexOf?.('Copy') > -1\n}\n\nconst isMoveUpComponent = (schema: ISchema) => {\n  return schema['x-component']?.indexOf?.('MoveUp') > -1\n}\n\nconst isMoveDownComponent = (schema: ISchema) => {\n  return schema['x-component']?.indexOf?.('MoveDown') > -1\n}\n\nconst isOperationComponent = (schema: ISchema) => {\n  return (\n    isAdditionComponent(schema) ||\n    isRemoveComponent(schema) ||\n    isCopyComponent(schema) ||\n    isMoveDownComponent(schema) ||\n    isMoveUpComponent(schema)\n  )\n}\n\nexport const InternalArrayCards: ReactFC<CardProps> = observer((props) => {\n  const field = useField<ArrayField>()\n  const schema = useFieldSchema()\n  const dataSource = Array.isArray(field.value) ? field.value : []\n  const prefixCls = usePrefixCls('formily-array-cards', props)\n  const [wrapSSR, hashId] = useStyle(prefixCls)\n\n  if (!schema) throw new Error('can not found schema object')\n\n  const renderItems = () => {\n    return dataSource?.map((item, index) => {\n      const items = Array.isArray(schema.items)\n        ? schema.items[index] || schema.items[0]\n        : schema.items\n      const title = (\n        <span>\n          {items ? (\n            <RecursionField\n              schema={items}\n              name={index}\n              filterProperties={(schema) => {\n                if (!isIndexComponent(schema)) return false\n                return true\n              }}\n              onlyRenderProperties\n            />\n          ) : null}\n          {props.title || field.title}\n        </span>\n      )\n      const extra = (\n        <span>\n          {items ? (\n            <RecursionField\n              schema={items}\n              name={index}\n              filterProperties={(schema) => {\n                if (!isOperationComponent(schema)) return false\n                return true\n              }}\n              onlyRenderProperties\n            />\n          ) : null}\n          {props.extra}\n        </span>\n      )\n      const content = items ? (\n        <RecursionField\n          schema={items}\n          name={index}\n          filterProperties={(schema) => {\n            if (isIndexComponent(schema)) return false\n            if (isOperationComponent(schema)) return false\n            return true\n          }}\n        />\n      ) : null\n      return (\n        <ArrayBase.Item\n          key={index}\n          index={index}\n          record={() => field.value?.[index]}\n        >\n          <Card\n            {...props}\n            onChange={() => {}}\n            className={cls(`${prefixCls}-item`, hashId, props.className)}\n            title={title}\n            extra={extra}\n          >\n            {content}\n          </Card>\n        </ArrayBase.Item>\n      )\n    })\n  }\n\n  const renderAddition = () => {\n    return schema.reduceProperties((addition, schema, key) => {\n      if (isAdditionComponent(schema)) {\n        return <RecursionField schema={schema} name={key} />\n      }\n      return addition\n    }, null)\n  }\n\n  const renderEmpty = () => {\n    if (dataSource?.length) return\n    return (\n      <Card\n        {...props}\n        onChange={() => {}}\n        className={cls(`${prefixCls}-item`, hashId, props.className)}\n        title={props.title || field.title}\n      >\n        <Empty />\n      </Card>\n    )\n  }\n\n  return wrapSSR(\n    <ArrayBase>\n      {renderEmpty()}\n      {renderItems()}\n      {renderAddition()}\n    </ArrayBase>\n  )\n})\n\nexport const ArrayCards = ArrayBase.mixin(InternalArrayCards)\n\nArrayCards.displayName = 'ArrayCards'\n\nexport default ArrayCards\n"]}
{"version":3,"file":"index.js","sourceRoot":"lib/","sources":["form-grid/index.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Grid, IGridOptions } from '@formily/grid'\nimport { observer } from '@formily/react'\nimport { markRaw } from '@formily/reactive'\nimport cls from 'classnames'\nimport React, { useContext, useLayoutEffect, useMemo, useRef } from 'react'\nimport { useFormLayout } from '../form-layout'\nimport { pickDataProps, usePrefixCls } from '../__builtins__'\n\nimport useStyle from './style'\n\nconst FormGridContext = React.createContext<Grid<HTMLElement>>(null as any)\n\nexport interface IFormGridProps extends IGridOptions {\n  grid?: Grid<HTMLElement>\n  prefixCls?: string\n  className?: string\n  style?: React.CSSProperties\n}\n\nexport interface IGridColumnProps {\n  gridSpan?: number\n  style?: React.CSSProperties\n  className?: string\n}\n\nexport const createFormGrid = (props: IFormGridProps) => {\n  return markRaw(new Grid(props))\n}\n\nexport const useFormGrid = () => useContext(FormGridContext)\n\nconst InternalFormGrid = observer(\n  ({\n    children,\n    className,\n    style,\n    ...props\n  }: React.PropsWithChildren<IFormGridProps>) => {\n    const layout = useFormLayout()\n    const options = {\n      columnGap: layout?.gridColumnGap ?? 8,\n      rowGap: layout?.gridRowGap ?? 4,\n      ...props,\n    }\n    const grid = useMemo(\n      () => markRaw(options?.grid ? options.grid : new Grid(options)),\n      [Grid.id(options)]\n    )\n    const ref = useRef<HTMLDivElement>(null)\n    const prefixCls = usePrefixCls('formily-grid', props)\n\n    const [wrapSSR, hashId] = useStyle(prefixCls)\n    const dataProps = pickDataProps(props)\n    useLayoutEffect(() => {\n      if (ref.current) {\n        return grid.connect(ref.current)\n      }\n    }, [grid])\n    return (\n      <FormGridContext.Provider value={grid}>\n        {wrapSSR(\n          <div\n            {...dataProps}\n            className={cls(`${prefixCls}-layout`, hashId, className)}\n            style={{\n              ...style,\n              gridTemplateColumns: grid.templateColumns,\n              gap: grid.gap,\n            }}\n            ref={ref}\n          >\n            {children}\n          </div>\n        )}\n      </FormGridContext.Provider>\n    )\n  },\n  {\n    forwardRef: true,\n  }\n)\n\nexport const GridColumn: React.FC<React.PropsWithChildren<IGridColumnProps>> =\n  observer(({ gridSpan = 1, children, ...props }) => {\n    return (\n      <div {...props} style={props.style} data-grid-span={gridSpan}>\n        {children}\n      </div>\n    )\n  })\n\nexport const FormGrid = Object.assign(InternalFormGrid, {\n  createFormGrid,\n  useFormGrid,\n  GridColumn,\n})\n\nexport default FormGrid\n"]}
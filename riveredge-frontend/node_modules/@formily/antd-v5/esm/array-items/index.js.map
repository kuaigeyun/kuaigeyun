{"version":3,"file":"index.js","sourceRoot":"lib/","sources":["array-items/index.tsx"],"names":[],"mappings":"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","sourcesContent":["import { ArrayField } from '@formily/core'\nimport { ISchema } from '@formily/json-schema'\nimport {\n  observer,\n  ReactFC,\n  RecursionField,\n  useField,\n  useFieldSchema,\n} from '@formily/react'\nimport cls from 'classnames'\nimport React from 'react'\nimport { ArrayBase } from '../array-base'\nimport {\n  SortableContainer,\n  SortableElement,\n  usePrefixCls,\n} from '../__builtins__'\nimport useStyle from './style'\n\nconst SortableItem = SortableElement((props) => {\n  const prefixCls = usePrefixCls('formily-array-items')\n  const [wrapSSR, hashId] = useStyle(prefixCls)\n\n  return wrapSSR(\n    <div\n      {...props}\n      className={cls(`${prefixCls}-item`, hashId, props.className)}\n    >\n      {props.children}\n    </div>\n  )\n})\n\nconst SortableList = SortableContainer((props) => {\n  const prefixCls = usePrefixCls('formily-array-items')\n  const [wrapSSR, hashId] = useStyle(prefixCls)\n  return wrapSSR(\n    <div\n      {...props}\n      className={cls(`${prefixCls}-list`, hashId, props.className)}\n    >\n      {props.children}\n    </div>\n  )\n})\n\nconst isAdditionComponent = (schema: ISchema) => {\n  return schema['x-component']?.indexOf('Addition') > -1\n}\n\nconst useAddition = () => {\n  const schema = useFieldSchema()\n  return schema.reduceProperties((addition, schema, key) => {\n    if (isAdditionComponent(schema)) {\n      return <RecursionField schema={schema} name={key} />\n    }\n    return addition\n  }, null)\n}\n\nconst InternalArrayItems: ReactFC<React.HTMLAttributes<HTMLDivElement>> =\n  observer((props) => {\n    const field = useField<ArrayField>()\n    const prefixCls = usePrefixCls('formily-array-items')\n    const [wrapSSR, hashId] = useStyle(prefixCls)\n    const schema = useFieldSchema()\n    const addition = useAddition()\n    const dataSource = Array.isArray(field.value) ? field.value : []\n    if (!schema) throw new Error('can not found schema object')\n    return wrapSSR(\n      <ArrayBase>\n        <div\n          {...props}\n          onChange={() => {}}\n          className={cls(prefixCls, hashId, props.className)}\n        >\n          <SortableList\n            list={dataSource.slice()}\n            className={`${prefixCls}-sort-helper`}\n            onSortEnd={(event) => {\n              const { oldIndex, newIndex } = event\n              field.move(oldIndex, newIndex)\n            }}\n          >\n            {dataSource?.map((item, index) => {\n              const items = Array.isArray(schema.items)\n                ? schema.items[index] || schema.items[0]\n                : schema.items\n              return (\n                <ArrayBase.Item\n                  key={index}\n                  index={index}\n                  record={() => field.value?.[index]}\n                >\n                  <SortableItem\n                    key={`item-${index}`}\n                    lockAxis=\"y\"\n                    index={index}\n                  >\n                    <div className={`${prefixCls}-item-inner`}>\n                      {items ? (\n                        <RecursionField schema={items} name={index} />\n                      ) : null}\n                    </div>\n                  </SortableItem>\n                </ArrayBase.Item>\n              )\n            })}\n          </SortableList>\n          {addition}\n        </div>\n      </ArrayBase>\n    )\n  })\n\nconst Item: ReactFC<\n  React.HTMLAttributes<HTMLDivElement> & {\n    type?: 'card' | 'divide'\n  }\n> = (props) => {\n  const prefixCls = usePrefixCls('formily-array-items')\n  const [wrapSSR, hashId] = useStyle(prefixCls)\n  return wrapSSR(\n    <div\n      {...props}\n      onChange={() => {}}\n      className={cls(\n        `${prefixCls}-${props.type || 'card'}`,\n        hashId,\n        props.className\n      )}\n    >\n      {props.children}\n    </div>\n  )\n}\n\nexport const ArrayItems = Object.assign(ArrayBase.mixin(InternalArrayItems), {\n  Item,\n})\n\nArrayItems.displayName = 'ArrayItems'\n\nexport default ArrayItems\n"]}
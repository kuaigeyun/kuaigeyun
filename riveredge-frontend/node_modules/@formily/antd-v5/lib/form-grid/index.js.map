{"version":3,"file":"index.js","sourceRoot":"lib/","sources":["form-grid/index.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Grid, IGridOptions } from '@formily/grid'\nimport { observer } from '@formily/react'\nimport { markRaw } from '@formily/reactive'\nimport cls from 'classnames'\nimport React, { useContext, useLayoutEffect, useMemo, useRef } from 'react'\nimport { useFormLayout } from '../form-layout'\nimport { pickDataProps, usePrefixCls } from '../__builtins__'\n\nimport useStyle from './style'\n\nconst FormGridContext = React.createContext<Grid<HTMLElement>>(null as any)\n\nexport interface IFormGridProps extends IGridOptions {\n  grid?: Grid<HTMLElement>\n  prefixCls?: string\n  className?: string\n  style?: React.CSSProperties\n}\n\nexport interface IGridColumnProps {\n  gridSpan?: number\n  style?: React.CSSProperties\n  className?: string\n}\n\nexport const createFormGrid = (props: IFormGridProps) => {\n  return markRaw(new Grid(props))\n}\n\nexport const useFormGrid = () => useContext(FormGridContext)\n\nconst InternalFormGrid = observer(\n  ({\n    children,\n    className,\n    style,\n    ...props\n  }: React.PropsWithChildren<IFormGridProps>) => {\n    const layout = useFormLayout()\n    const options = {\n      columnGap: layout?.gridColumnGap ?? 8,\n      rowGap: layout?.gridRowGap ?? 4,\n      ...props,\n    }\n    const grid = useMemo(\n      () => markRaw(options?.grid ? options.grid : new Grid(options)),\n      [Grid.id(options)]\n    )\n    const ref = useRef<HTMLDivElement>(null)\n    const prefixCls = usePrefixCls('formily-grid', props)\n\n    const [wrapSSR, hashId] = useStyle(prefixCls)\n    const dataProps = pickDataProps(props)\n    useLayoutEffect(() => {\n      if (ref.current) {\n        return grid.connect(ref.current)\n      }\n    }, [grid])\n    return (\n      <FormGridContext.Provider value={grid}>\n        {wrapSSR(\n          <div\n            {...dataProps}\n            className={cls(`${prefixCls}-layout`, hashId, className)}\n            style={{\n              ...style,\n              gridTemplateColumns: grid.templateColumns,\n              gap: grid.gap,\n            }}\n            ref={ref}\n          >\n            {children}\n          </div>\n        )}\n      </FormGridContext.Provider>\n    )\n  },\n  {\n    forwardRef: true,\n  }\n)\n\nexport const GridColumn: React.FC<React.PropsWithChildren<IGridColumnProps>> =\n  observer(({ gridSpan = 1, children, ...props }) => {\n    return (\n      <div {...props} style={props.style} data-grid-span={gridSpan}>\n        {children}\n      </div>\n    )\n  })\n\nexport const FormGrid = Object.assign(InternalFormGrid, {\n  createFormGrid,\n  useFormGrid,\n  GridColumn,\n})\n\nexport default FormGrid\n"]}
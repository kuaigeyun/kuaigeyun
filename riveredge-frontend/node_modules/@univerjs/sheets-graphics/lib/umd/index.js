(function(n,t){typeof exports=="object"&&typeof module<"u"?t(exports,require("@univerjs/core"),require("@univerjs/sheets-ui"),require("@univerjs/engine-render")):typeof define=="function"&&define.amd?define(["exports","@univerjs/core","@univerjs/sheets-ui","@univerjs/engine-render"],t):(n=typeof globalThis<"u"?globalThis:n||self,t(n.UniverSheetsGraphics={},n.UniverCore,n.UniverSheetsUi,n.UniverEngineRender))})(this,(function(n,t,o,v){"use strict";var T=Object.defineProperty;var x=(n,t,o)=>t in n?T(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o;var p=(n,t,o)=>x(n,typeof t!="symbol"?t+"":t,o);var d;const f="SheetGraphicsExtension";class _ extends v.SheetExtension{constructor(){super(...arguments);p(this,"uKey",f);p(this,"Z_INDEX",35);p(this,"_graphicsRenderMap",new Map)}registerRenderer(e,r){this._graphicsRenderMap.set(e,r)}draw(e,r,i,c,{viewRanges:a}){const U=Array.from(this._graphicsRenderMap.keys());a.forEach(y=>{t.Range.foreach(y,(M,j)=>{const I=i.getCellByIndexWithNoHeader(M,j);I&&U.forEach(O=>{const u=this._graphicsRenderMap.get(O);u==null||u(e,i,I)})})})}dispose(){this._graphicsRenderMap.clear()}copy(){const e=new _;return this._graphicsRenderMap.forEach((r,i)=>{e.registerRenderer(i,r)}),e}}var E=Object.getOwnPropertyDescriptor,S=(h,s,e,r)=>{for(var i=r>1?void 0:r?E(s,e):s,c=h.length-1,a;c>=0;c--)(a=h[c])&&(i=a(i)||i);return i},P=(h,s)=>(e,r)=>s(e,r,h);n.SheetGraphicsRenderController=class extends t.Disposable{constructor(e,r){super();p(this,"_graphicsExtensionInstance",null);this._context=e,this._sheetPrintInterceptorService=r,this._initRender(),this._initPrinting()}_initRender(){const e=this._context.mainComponent;e&&!e.getExtensionByKey(f)&&(this._graphicsExtensionInstance=new _,e.register(this._graphicsExtensionInstance))}_initPrinting(){this.disposeWithMe(this._sheetPrintInterceptorService.interceptor.intercept(this._sheetPrintInterceptorService.interceptor.getInterceptPoints().PRINTING_COMPONENT_COLLECT,{handler:(e,r,i)=>{const{spreadsheet:c}=r;return this._graphicsExtensionInstance&&c.register(this._graphicsExtensionInstance.copy()),i(e)}}))}registerRenderer(e,r){var i;(i=this._graphicsExtensionInstance)==null||i.registerRenderer(e,r)}},n.SheetGraphicsRenderController=S([P(1,t.Inject(o.SheetPrintInterceptorService))],n.SheetGraphicsRenderController);const R="graphics.config",l={};var N=Object.getOwnPropertyDescriptor,G=(h,s,e,r)=>{for(var i=r>1?void 0:r?N(s,e):s,c=h.length-1,a;c>=0;c--)(a=h[c])&&(i=a(i)||i);return i},g=(h,s)=>(e,r)=>s(e,r,h);const C="UNIVER_SHEET_DRAWING_PLUGIN";n.UniverSheetsGraphicsPlugin=(d=class extends t.Plugin{constructor(s=l,e,r,i){super(),this._config=s,this._injector=e,this._configService=r,this._renderManagerService=i;const{...c}=t.merge({},l,this._config);this._configService.setConfig(R,c)}onRendered(){[[n.SheetGraphicsRenderController]].forEach(s=>{this._renderManagerService.registerRenderModule(t.UniverInstanceType.UNIVER_SHEET,s)})}},p(d,"pluginName",C),d),n.UniverSheetsGraphicsPlugin=G([g(1,t.Inject(t.Injector)),g(2,t.IConfigService),g(3,v.IRenderManagerService)],n.UniverSheetsGraphicsPlugin),Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})}));

"use strict";var f=Object.defineProperty;var N=(i,r,e)=>r in i?f(i,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[r]=e;var a=(i,r,e)=>N(i,typeof r!="symbol"?r+"":r,e);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const c=require("@univerjs/core"),G=require("@univerjs/sheets-ui"),I=require("@univerjs/engine-render"),u="SheetGraphicsExtension",C=35;class _ extends I.SheetExtension{constructor(){super(...arguments);a(this,"uKey",u);a(this,"Z_INDEX",C);a(this,"_graphicsRenderMap",new Map)}registerRenderer(e,t){this._graphicsRenderMap.set(e,t)}draw(e,t,n,s,{viewRanges:o}){const E=Array.from(this._graphicsRenderMap.keys());o.forEach(S=>{c.Range.foreach(S,(v,P)=>{const d=n.getCellByIndexWithNoHeader(v,P);d&&E.forEach(R=>{const h=this._graphicsRenderMap.get(R);h==null||h(e,n,d)})})})}dispose(){this._graphicsRenderMap.clear()}copy(){const e=new _;return this._graphicsRenderMap.forEach((t,n)=>{e.registerRenderer(n,t)}),e}}var x=Object.getOwnPropertyDescriptor,M=(i,r,e,t)=>{for(var n=t>1?void 0:t?x(r,e):r,s=i.length-1,o;s>=0;s--)(o=i[s])&&(n=o(n)||n);return n},y=(i,r)=>(e,t)=>r(e,t,i);exports.SheetGraphicsRenderController=class extends c.Disposable{constructor(e,t){super();a(this,"_graphicsExtensionInstance",null);this._context=e,this._sheetPrintInterceptorService=t,this._initRender(),this._initPrinting()}_initRender(){const e=this._context.mainComponent;e&&!e.getExtensionByKey(u)&&(this._graphicsExtensionInstance=new _,e.register(this._graphicsExtensionInstance))}_initPrinting(){this.disposeWithMe(this._sheetPrintInterceptorService.interceptor.intercept(this._sheetPrintInterceptorService.interceptor.getInterceptPoints().PRINTING_COMPONENT_COLLECT,{handler:(e,t,n)=>{const{spreadsheet:s}=t;return this._graphicsExtensionInstance&&s.register(this._graphicsExtensionInstance.copy()),n(e)}}))}registerRenderer(e,t){var n;(n=this._graphicsExtensionInstance)==null||n.registerRenderer(e,t)}};exports.SheetGraphicsRenderController=M([y(1,c.Inject(G.SheetPrintInterceptorService))],exports.SheetGraphicsRenderController);const U="graphics.config",l={};var O=Object.getOwnPropertyDescriptor,w=(i,r,e,t)=>{for(var n=t>1?void 0:t?O(r,e):r,s=i.length-1,o;s>=0;s--)(o=i[s])&&(n=o(n)||n);return n},p=(i,r)=>(e,t)=>r(e,t,i);const T="UNIVER_SHEET_DRAWING_PLUGIN";var g;exports.UniverSheetsGraphicsPlugin=(g=class extends c.Plugin{constructor(r=l,e,t,n){super(),this._config=r,this._injector=e,this._configService=t,this._renderManagerService=n;const{...s}=c.merge({},l,this._config);this._configService.setConfig(U,s)}onRendered(){[[exports.SheetGraphicsRenderController]].forEach(r=>{this._renderManagerService.registerRenderModule(c.UniverInstanceType.UNIVER_SHEET,r)})}},a(g,"pluginName",T),g);exports.UniverSheetsGraphicsPlugin=w([p(1,c.Inject(c.Injector)),p(2,c.IConfigService),p(3,I.IRenderManagerService)],exports.UniverSheetsGraphicsPlugin);

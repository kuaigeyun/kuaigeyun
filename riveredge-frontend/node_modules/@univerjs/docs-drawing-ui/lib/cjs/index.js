"use strict";var Tt=Object.defineProperty;var yt=(o,e,t)=>e in o?Tt(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var ce=(o,e,t)=>yt(o,typeof e!="symbol"?e+"":e,t);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const i=require("@univerjs/core"),me=require("@univerjs/docs-drawing"),B=require("@univerjs/docs"),W=require("@univerjs/docs-ui"),j=require("@univerjs/engine-render"),X=require("@univerjs/design"),V=require("@univerjs/drawing"),L=require("@univerjs/ui"),J=require("rxjs"),he=require("@univerjs/drawing-ui"),S=require("react/jsx-runtime"),K=require("react"),We={id:"doc.command.remove-doc-image",type:i.CommandType.COMMAND,handler:(o,e)=>{var C,b,P,k;const t=o.get(i.ICommandService),n=o.get(i.IUniverInstanceService),r=o.get(j.IRenderManagerService),s=n.getCurrentUniverDocInstance();if(e==null||s==null)return!1;const a=r.getRenderById(e.unitId).with(W.DocSelectionRenderService),{drawings:d}=e,g=(C=a.getSegment())!=null?C:"",c=new i.TextX,l=i.JSONX.getInstance(),p=(P=(b=s.getSelfOrHeaderFooterModel(g).getBody())==null?void 0:b.customBlocks)!=null?P:[],u=d.map(E=>p.find(w=>w.blockId===E.drawingId)).filter(E=>!!E).sort((E,w)=>E.startIndex>w.startIndex?1:-1),m=d[0].unitId,h=new i.MemoryCursor;h.reset();const v=u[0].startIndex,I=[{startOffset:v,endOffset:v}],f={id:B.RichTextEditingMutation.id,params:{unitId:m,actions:[],textRanges:I}},T=[];for(const E of u){const{startIndex:w}=E;w>h.cursor&&c.push({t:i.TextXActionType.RETAIN,len:w-h.cursor}),c.push({t:i.TextXActionType.DELETE,len:1}),h.moveCursorTo(w+1)}const y=W.getRichTextEditPath(s,g);T.push(l.editOp(c.serialize(),y));for(const E of u){const{blockId:w}=E,U=((k=s.getDrawings())!=null?k:{})[w],N=s.getDrawingsOrder().indexOf(w),z=l.removeOp(["drawings",w],U),_=l.removeOp(["drawingsOrder",N],w);T.push(z),T.push(_)}return f.params.actions=T.reduce((E,w)=>i.JSONX.compose(E,w),null),!!t.syncExecuteCommand(f.id,f.params)}},Ke={id:"doc.command.delete-drawing",type:i.CommandType.COMMAND,handler:o=>{const e=o.get(i.ICommandService),n=o.get(me.IDocDrawingService).getFocusDrawings();if(n.length===0)return!1;const{unitId:r}=n[0],s=n.map(a=>{const{unitId:d,subUnitId:g,drawingId:c,drawingType:l}=a;return{unitId:d,subUnitId:g,drawingId:c,drawingType:l}});return e.executeCommand(We.id,{unitId:r,drawings:s})}},Ye={id:"doc.command.group-doc-image",type:i.CommandType.COMMAND,handler:(o,e)=>{o.get(i.ICommandService),o.get(i.IUndoRedoService);const t=o.get(me.IDocDrawingService);if(!e)return!1;const n=[];e.forEach(({parent:l,children:p})=>{n.push(l.unitId),p.forEach(u=>{n.push(u.unitId)})});const r=t.getGroupDrawingOp(e),{unitId:s,subUnitId:a,undo:d,redo:g,objects:c}=r;return!1}},He={id:"doc.command.insert-doc-image",type:i.CommandType.COMMAND,handler:(o,e)=>{var b,P,k,E;if(e==null)return!1;const t=o.get(i.ICommandService),n=o.get(B.DocSelectionManagerService),r=o.get(i.IUniverInstanceService),s=n.getActiveTextRange(),a=r.getCurrentUniverDocInstance();if(s==null||a==null)return!1;const d=a.getUnitId(),{drawings:g}=e,{collapsed:c,startOffset:l,segmentId:p}=s,u=a.getSelfOrHeaderFooterModel(p).getBody();if(u==null)return!1;const m=new i.TextX,h=i.JSONX.getInstance(),v=[],I=(P=(b=a.getSnapshot().drawingsOrder)==null?void 0:b.length)!=null?P:0;let f=0;if(c)l>0&&m.push({t:i.TextXActionType.RETAIN,len:l});else{const w=i.BuildTextUtils.selection.delete([s],u,0,null,!1);m.push(...w);const U=W.getCustomBlockIdsInSelections(u,[s]),$=(k=a.getDrawings())!=null?k:{},N=(E=a.getDrawingsOrder())!=null?E:[],z=U.sort((_,D)=>N.indexOf(_)>N.indexOf(D)?-1:N.indexOf(_)<N.indexOf(D)?1:0);if(z.length>0)for(const _ of z){const D=$[_],x=N.indexOf(_);if(D==null||x<0)continue;const M=h.removeOp(["drawings",_],D),F=h.removeOp(["drawingsOrder",x],_);v.push(M),v.push(F),f++}}m.push({t:i.TextXActionType.INSERT,body:{dataStream:"\b".repeat(g.length),customBlocks:g.map((w,U)=>({startIndex:U,blockId:w.drawingId}))},len:g.length});const T=W.getRichTextEditPath(a,p),y=h.editOp(m.serialize(),T);v.push(y);for(const w of g){const{drawingId:U}=w,$=h.insertOp(["drawings",U],w),N=h.insertOp(["drawingsOrder",I-f],U);v.push($),v.push(N)}const O={id:B.RichTextEditingMutation.id,params:{unitId:d,actions:[],textRanges:[]}};return O.params.actions=v.reduce((w,U)=>i.JSONX.compose(w,U),null),!!t.syncExecuteCommand(O.id,O.params)}},Je={id:"doc.command.set-drawing-arrange",type:i.CommandType.COMMAND,handler:(o,e)=>{const t=o.get(i.ICommandService),n=o.get(me.IDocDrawingService);if(e==null)return!1;const{unitId:r,subUnitId:s,drawingIds:a,arrangeType:d}=e,g={unitId:r,subUnitId:s,drawingIds:a};let c;if(d===i.ArrangeTypeEnum.forward?c=n.getForwardDrawingsOp(g):d===i.ArrangeTypeEnum.backward?c=n.getBackwardDrawingOp(g):d===i.ArrangeTypeEnum.front?c=n.getFrontDrawingsOp(g):d===i.ArrangeTypeEnum.back&&(c=n.getBackDrawingsOp(g)),c==null)return!1;const{redo:l}=c;if(l==null)return!1;const p=[];let u=i.Tools.deepClone(l);u=u.slice(3),u.unshift("drawingsOrder"),p.push(u);const m={id:B.RichTextEditingMutation.id,params:{unitId:r,actions:[],textRanges:null}};return m.params.actions=p.reduce((v,I)=>i.JSONX.compose(v,I),null),!!t.syncExecuteCommand(m.id,m.params)}},Ze={id:"doc.command.ungroup-doc-image",type:i.CommandType.COMMAND,handler:(o,e)=>{o.get(i.ICommandService),o.get(i.IUndoRedoService);const t=o.get(me.IDocDrawingService);if(!e)return!1;const n=[];e.forEach(({parent:l,children:p})=>{n.push(l.unitId),p.forEach(u=>{n.push(u.unitId)})});const r=t.getUngroupDrawingOp(e),{unitId:s,subUnitId:a,undo:d,redo:g,objects:c}=r;return!1}};class Ge{constructor(){ce(this,"_refreshDrawings$",new J.BehaviorSubject(null));ce(this,"refreshDrawings$",this._refreshDrawings$.asObservable())}refreshDrawings(e){this._refreshDrawings$.next(e)}}var Ot=Object.getOwnPropertyDescriptor,Mt=(o,e,t,n)=>{for(var r=n>1?void 0:n?Ot(e,t):e,s=o.length-1,a;s>=0;s--)(a=o[s])&&(r=a(r)||r);return r},oe=(o,e)=>(t,n)=>e(t,n,o);let je=class extends i.Disposable{constructor(o,e,t,n,r,s,a,d,g,c,l,p,u){super(),this._context=o,this._commandService=e,this._docSelectionManagerService=t,this._renderManagerSrv=n,this._imageIoService=r,this._docDrawingService=s,this._drawingManagerService=a,this._contextService=d,this._messageService=g,this._localeService=c,this._docSelectionRenderService=l,this._docRefreshDrawingsService=p,this._fileOpenerService=u,this._updateOrderListener(),this._groupDrawingListener(),this._focusDrawingListener(),this._transformDrawingListener(),this._editAreaChangeListener()}dispose(){super.dispose(),delete this._context}async insertDocImage(){const o=await this._fileOpenerService.openFile({multiple:!0,accept:V.DRAWING_IMAGE_ALLOW_IMAGE_LIST.map(t=>`.${t.replace("image/","")}`).join(",")}),e=o.length;return e>V.DRAWING_IMAGE_COUNT_LIMIT?(this._messageService.show({type:X.MessageType.Error,content:this._localeService.t("update-status.exceedMaxCount",String(V.DRAWING_IMAGE_COUNT_LIMIT))}),!1):e===0?!1:(await this._insertFloatImages(o),!0)}async _insertFloatImages(o){let e=[];try{e=await Promise.all(o.map(r=>this._imageIoService.saveImage(r)))}catch(r){const s=r.message;let a="";switch(s){case V.ImageUploadStatusType.ERROR_EXCEED_SIZE:a=this._localeService.t("update-status.exceedMaxSize",String(V.DRAWING_IMAGE_ALLOW_SIZE/(1024*1024)));break;case V.ImageUploadStatusType.ERROR_IMAGE_TYPE:a=this._localeService.t("update-status.invalidImageType");break;case V.ImageUploadStatusType.ERROR_IMAGE:a=this._localeService.t("update-status.invalidImage");break}this._messageService.show({type:X.MessageType.Error,content:a})}if(e.length===0)return;const{unitId:t}=this._context,n=[];for(const r of e){if(r==null)continue;const{imageId:s,imageSourceType:a,source:d,base64Cache:g}=r,{width:c,height:l,image:p}=await V.getImageSize(g||"");this._imageIoService.addImageSourceCache(s,a,p);let u=1;if(c>V.DRAWING_IMAGE_WIDTH_LIMIT||l>V.DRAWING_IMAGE_HEIGHT_LIMIT){const I=V.DRAWING_IMAGE_WIDTH_LIMIT/c,f=V.DRAWING_IMAGE_HEIGHT_LIMIT/l;u=Math.min(I,f)}const m=this._getImagePosition(c*u,l*u);if(m==null)return;const h={unitId:t,subUnitId:t,drawingId:s,drawingType:i.DrawingTypeEnum.DRAWING_IMAGE,imageSourceType:a,source:d,transform:W.docDrawingPositionToTransform(m),docTransform:m,behindDoc:i.BooleanNumber.FALSE,title:"",description:"",layoutType:i.PositionedObjectLayoutType.INLINE,wrapText:i.WrapTextType.BOTH_SIDES,distB:0,distL:0,distR:0,distT:0};this._isInsertInHeaderFooter()&&(h.isMultiTransform=i.BooleanNumber.TRUE,h.transforms=h.transform?[h.transform]:null),n.push(h)}this._commandService.executeCommand(He.id,{unitId:t,drawings:n})}_isInsertInHeaderFooter(){var n;const{unitId:o}=this._context,e=(n=this._renderManagerSrv.getRenderById(o))==null?void 0:n.with(B.DocSkeletonManagerService).getViewModel(),t=e==null?void 0:e.getEditArea();return t===j.DocumentEditArea.HEADER||t===j.DocumentEditArea.FOOTER}_getImagePosition(o,e){const t=this._docSelectionRenderService.getActiveTextRange(),n=(t==null?void 0:t.getAbsolutePosition())||{left:0};return{size:{width:o,height:e},positionH:{relativeFrom:i.ObjectRelativeFromH.PAGE,posOffset:n.left},positionV:{relativeFrom:i.ObjectRelativeFromV.PARAGRAPH,posOffset:0},angle:0}}_updateOrderListener(){this.disposeWithMe(this._drawingManagerService.featurePluginOrderUpdate$.subscribe(o=>{const{unitId:e,subUnitId:t,drawingIds:n,arrangeType:r}=o;this._commandService.executeCommand(Je.id,{unitId:e,subUnitId:t,drawingIds:n,arrangeType:r})}))}_groupDrawingListener(){this.disposeWithMe(this._drawingManagerService.featurePluginGroupUpdate$.subscribe(o=>{this._commandService.executeCommand(Ye.id,o)})),this.disposeWithMe(this._drawingManagerService.featurePluginUngroupUpdate$.subscribe(o=>{this._commandService.executeCommand(Ze.id,o)}))}_getCurrentSceneAndTransformer(){const{scene:o,mainComponent:e}=this._context;if(o==null||e==null)return;const t=o.getTransformerByCreate(),{docsLeft:n,docsTop:r}=e.getOffsetConfig();return{scene:o,transformer:t,docsLeft:n,docsTop:r}}_transformDrawingListener(){const o=this._getCurrentSceneAndTransformer();if(o&&o.transformer)this.disposeWithMe(o.transformer.changeEnd$.pipe(J.debounceTime(30)).subscribe(e=>{this._docSelectionManagerService.refreshSelection()}));else throw new Error("transformer is not init")}_focusDrawingListener(){this.disposeWithMe(this._drawingManagerService.focus$.subscribe(o=>{var r;const{transformer:e,docsLeft:t,docsTop:n}=(r=this._getCurrentSceneAndTransformer())!=null?r:{};if(o==null||o.length===0)this._contextService.setContextValue(i.FOCUSING_COMMON_DRAWINGS,!1),this._docDrawingService.focusDrawing([]),e&&e.resetProps({zeroTop:0,zeroLeft:0});else{this._contextService.setContextValue(i.FOCUSING_COMMON_DRAWINGS,!0),this._docDrawingService.focusDrawing(o),this._setDrawingSelections(o);const s=this._docSelectionRenderService.getSegment(),a=this._findSegmentIdByDrawingId(o[0].drawingId);s!==a&&this._docSelectionRenderService.setSegment(a),e&&e.resetProps({zeroTop:n,zeroLeft:t})}}))}_findSegmentIdByDrawingId(o){var a,d,g;const{unit:e}=this._context,{body:t,headers:n={},footers:r={}}=e.getSnapshot();if(((a=t==null?void 0:t.customBlocks)!=null?a:[]).some(c=>c.blockId===o))return"";for(const c of Object.keys(n))if((d=n[c].body.customBlocks)!=null&&d.some(l=>l.blockId===o))return c;for(const c of Object.keys(r))if((g=r[c].body.customBlocks)!=null&&g.some(l=>l.blockId===o))return c;return""}_updateDrawingsEditStatus(){var d;const{unit:o,scene:e,unitId:t}=this._context,n=(d=this._renderManagerSrv.getRenderById(t))==null?void 0:d.with(B.DocSkeletonManagerService).getViewModel();if(n==null||o==null)return;const r=o.getSnapshot(),{drawings:s={}}=r,a=n.getEditArea()===j.DocumentEditArea.BODY;for(const g of Object.keys(s)){const c=s[g],l=V.getDrawingShapeKeyByDrawingSearch({unitId:t,drawingId:c.drawingId,subUnitId:t}),p=e.fuzzyMathObjects(l,!0);if(p.length)for(const u of p){e.detachTransformerFrom(u);try{u.setOpacity(.5)}catch{}if(a&&c.isMultiTransform!==i.BooleanNumber.TRUE||!a&&c.isMultiTransform===i.BooleanNumber.TRUE){c.allowTransform!==!1&&e.attachTransformerTo(u);try{u.setOpacity(1)}catch{}}}}}_editAreaChangeListener(){var t;const{unitId:o}=this._context,e=(t=this._renderManagerSrv.getRenderById(o))==null?void 0:t.with(B.DocSkeletonManagerService).getViewModel();e!=null&&(this._updateDrawingsEditStatus(),this.disposeWithMe(e.editAreaChange$.subscribe(()=>{this._updateDrawingsEditStatus()})),this.disposeWithMe(this._docRefreshDrawingsService.refreshDrawings$.subscribe(n=>{n!=null&&queueMicrotask(()=>{this._updateDrawingsEditStatus()})})),this.disposeWithMe(this._commandService.onCommandExecuted(async n=>{n.id===B.RichTextEditingMutation.id&&queueMicrotask(()=>{this._updateDrawingsEditStatus()})})))}_setDrawingSelections(o){var r,s;const{unit:e}=this._context,t=(s=(r=e.getSnapshot().body)==null?void 0:r.customBlocks)!=null?s:[],n=o.map(a=>{const d=a.drawingId,g=t.find(c=>c.blockId===d);return g?g.startIndex:null}).filter(a=>a!==null).map(a=>({startOffset:a,endOffset:a+1}));this._docSelectionManagerService.replaceDocRanges(n)}};je=Mt([oe(1,i.ICommandService),oe(2,i.Inject(B.DocSelectionManagerService)),oe(3,j.IRenderManagerService),oe(4,V.IImageIoService),oe(5,me.IDocDrawingService),oe(6,V.IDrawingManagerService),oe(7,i.IContextService),oe(8,L.IMessageService),oe(9,i.Inject(i.LocaleService)),oe(10,i.Inject(W.DocSelectionRenderService)),oe(11,i.Inject(Ge)),oe(12,L.ILocalFileService)],je);const Qe={id:"doc.command.insert-float-image",type:i.CommandType.COMMAND,handler:o=>{var n,r;const e=o.get(i.IUniverInstanceService),t=o.get(j.IRenderManagerService);return(r=(n=j.getCurrentTypeOfRenderer(i.UniverInstanceType.UNIVER_DOC,e,t))==null?void 0:n.with(je).insertDocImage())!=null?r:!1}};var se=(o=>(o.INLINE="inline",o.BEHIND_TEXT="behindText",o.IN_FRONT_OF_TEXT="inFrontOfText",o.WRAP_SQUARE="wrapSquare",o.WRAP_TOP_AND_BOTTOM="wrapTopAndBottom",o))(se||{});const bt={inline:i.PositionedObjectLayoutType.INLINE,wrapSquare:i.PositionedObjectLayoutType.WRAP_SQUARE,wrapTopAndBottom:i.PositionedObjectLayoutType.WRAP_TOP_AND_BOTTOM,inFrontOfText:i.PositionedObjectLayoutType.WRAP_NONE,behindText:i.PositionedObjectLayoutType.WRAP_NONE};function dt(o,e,t,n,r,s,a){var m,h;const d=new i.TextX,g=i.JSONX.getInstance(),c=[],l=s.getSelfOrHeaderFooterModel(e).getBody(),p=s.getSelfOrHeaderFooterModel(o).getBody();if(l==null||p==null)return;const u=(h=(m=l.customBlocks)==null?void 0:m.find(v=>v.blockId===r))==null?void 0:h.startIndex;if(u!=null){if(n=Math.min(p.dataStream.length-2,n),o===e){if(n<u?(n>0&&d.push({t:i.TextXActionType.RETAIN,len:n}),d.push({t:i.TextXActionType.INSERT,body:{dataStream:"\b",customBlocks:[{startIndex:0,blockId:r}]},len:1}),d.push({t:i.TextXActionType.RETAIN,len:u-n}),d.push({t:i.TextXActionType.DELETE,len:1})):(u>0&&d.push({t:i.TextXActionType.RETAIN,len:u}),d.push({t:i.TextXActionType.DELETE,len:1}),n-u-1>0&&d.push({t:i.TextXActionType.RETAIN,len:n-u-1}),d.push({t:i.TextXActionType.INSERT,body:{dataStream:"\b",customBlocks:[{startIndex:0,blockId:r}]},len:1})),n!==u){const v=W.getRichTextEditPath(s,e),I=g.editOp(d.serialize(),v);c.push(I)}}else{u>0&&d.push({t:i.TextXActionType.RETAIN,len:u}),d.push({t:i.TextXActionType.DELETE,len:1});let v=W.getRichTextEditPath(s,e),I=g.editOp(d.serialize(),v);c.push(I),d.empty(),n>0&&d.push({t:i.TextXActionType.RETAIN,len:n}),d.push({t:i.TextXActionType.INSERT,body:{dataStream:"\b",customBlocks:[{startIndex:0,blockId:r}]},len:1}),v=W.getRichTextEditPath(s,o),I=g.editOp(d.serialize(),v),c.push(I),a.setSegment(o),a.setSegmentPage(t)}return c}}const gt={id:"doc.command.update-doc-drawing-wrapping-style",type:i.CommandType.COMMAND,handler:(o,e)=>{var P,k;if(e==null)return!1;const{drawings:t,wrappingStyle:n,unitId:r}=e,s=o.get(i.ICommandService),a=o.get(i.IUniverInstanceService),g=o.get(j.IRenderManagerService).getRenderById(r),c=g==null?void 0:g.with(B.DocSkeletonManagerService).getSkeleton().getSkeletonData(),l=g==null?void 0:g.with(B.DocSkeletonManagerService).getViewModel(),p=g==null?void 0:g.scene,u=a.getCurrentUniverDocInstance();if(u==null||c==null||p==null||l==null)return!1;const m=l.getEditArea(),h=p.getTransformerByCreate(),{pages:v,skeHeaders:I,skeFooters:f}=c,T=i.JSONX.getInstance(),y=[],{drawings:O={}}=u.getSnapshot();for(const E of t){const{drawingId:w}=E,U=O[w].layoutType,$=bt[n];if(U!==$){const D=T.replaceOp(["drawings",w,"layoutType"],U,$);y.push(D)}if(n==="behindText"||n==="inFrontOfText"){const D=O[w].behindDoc,x=n==="behindText"?i.BooleanNumber.TRUE:i.BooleanNumber.FALSE;if(D!==x){const M=T.replaceOp(["drawings",w,"behindDoc"],D,x);y.push(M)}}if(n==="inline")continue;let N=null,z=0,_=0;for(const D of v){const{headerId:x,footerId:M,marginTop:F,marginLeft:H,marginBottom:R,pageWidth:A,pageHeight:q}=D;switch(m){case j.DocumentEditArea.HEADER:{const G=(P=I.get(x))==null?void 0:P.get(A);G!=null&&G.skeDrawings.has(w)&&(N=G.skeDrawings.get(w),z=G.marginTop,_=H);break}case j.DocumentEditArea.FOOTER:{const G=(k=f.get(M))==null?void 0:k.get(A);G!=null&&G.skeDrawings.has(w)&&(N=G.skeDrawings.get(w),z=q-R+G.marginTop,_=H);break}case j.DocumentEditArea.BODY:{D.skeDrawings.has(w)&&(N=D.skeDrawings.get(w),z=F,_=H);break}}if(N!=null)break}if(N!=null){const{aTop:D,aLeft:x}=N,M=O[w].docTransform.positionH;let F=x;M.relativeFrom===i.ObjectRelativeFromH.MARGIN?F-=_:M.relativeFrom===i.ObjectRelativeFromH.COLUMN&&(F-=N.columnLeft);const H={relativeFrom:M.relativeFrom,posOffset:F};if(M.posOffset!==H.posOffset){const G=T.replaceOp(["drawings",w,"docTransform","positionH"],M,H);y.push(G)}const R=O[w].docTransform.positionV;let A=D;R.relativeFrom===i.ObjectRelativeFromV.PAGE?A+=z:R.relativeFrom===i.ObjectRelativeFromV.LINE?A-=N.lineTop:R.relativeFrom===i.ObjectRelativeFromV.PARAGRAPH&&(A-=N.blockAnchorTop);const q={relativeFrom:R.relativeFrom,posOffset:A};if(R.posOffset!==q.posOffset){const G=T.replaceOp(["drawings",w,"docTransform","positionV"],R,q);y.push(G)}}}const C={id:B.RichTextEditingMutation.id,params:{unitId:r,actions:[],textRanges:null}};C.params.actions=y.reduce((E,w)=>i.JSONX.compose(E,w),null);const b=s.syncExecuteCommand(C.id,C.params);return h.refreshControls(),!!b}},lt={id:"doc.command.update-doc-drawing-distance",type:i.CommandType.COMMAND,handler:(o,e)=>{if(e==null)return!1;const t=o.get(i.ICommandService),r=o.get(i.IUniverInstanceService).getCurrentUniverDocInstance();if(r==null)return!1;const{drawings:s,dist:a,unitId:d}=e,g=i.JSONX.getInstance(),c=[],{drawings:l={}}=r.getSnapshot();for(const m of s){const{drawingId:h}=m;for(const[v,I]of Object.entries(a)){const f=l[h][v];if(f!==I){const T=g.replaceOp(["drawings",h,v],f,I);c.push(T)}}}const p={id:B.RichTextEditingMutation.id,params:{unitId:d,actions:[],textRanges:null}};return p.params.actions=c.reduce((m,h)=>i.JSONX.compose(m,h),null),!!t.syncExecuteCommand(p.id,p.params)}},ut={id:"doc.command.update-doc-drawing-wrap-text",type:i.CommandType.COMMAND,handler:(o,e)=>{if(e==null)return!1;const t=o.get(i.ICommandService),r=o.get(i.IUniverInstanceService).getCurrentUniverDocInstance();if(r==null)return!1;const{drawings:s,wrapText:a,unitId:d}=e,g=i.JSONX.getInstance(),c=[],{drawings:l={}}=r.getSnapshot();for(const m of s){const{drawingId:h}=m,v=l[h].wrapText;if(v!==a){const I=g.replaceOp(["drawings",h,"wrapText"],v,a);c.push(I)}}const p={id:B.RichTextEditingMutation.id,params:{unitId:d,actions:[],textRanges:null}};return p.params.actions=c.reduce((m,h)=>i.JSONX.compose(m,h),null),!!t.syncExecuteCommand(p.id,p.params)}},Ce={id:"doc.command.update-drawing-doc-transform",type:i.CommandType.COMMAND,handler:(o,e)=>{if(e==null)return!1;const t=o.get(i.ICommandService),n=o.get(i.IUniverInstanceService),s=o.get(j.IRenderManagerService).getRenderById(e.unitId),a=s==null?void 0:s.scene;if(a==null)return!1;const d=a.getTransformerByCreate(),g=n.getCurrentUniverDocInstance();if(g==null)return!1;const{drawings:c,unitId:l}=e,p=i.JSONX.getInstance(),u=[],{drawings:m={}}=g.getSnapshot();for(const I of c){const{drawingId:f,key:T,value:y}=I,O=m[f].docTransform[T];if(!i.Tools.diffValue(O,y)){const C=p.replaceOp(["drawings",f,"docTransform",T],O,y);u.push(C)}}const h={id:B.RichTextEditingMutation.id,params:{unitId:l,actions:[],textRanges:null,debounce:!0}};h.params.actions=u.reduce((I,f)=>i.JSONX.compose(I,f),null);const v=t.syncExecuteCommand(h.id,h.params);return d.refreshControls(),!!v}},pt={id:"doc.command.move-inline-drawing",type:i.CommandType.COMMAND,handler:(o,e)=>{var k,E;if(e==null)return!1;const t=o.get(j.IRenderManagerService),n=(k=t.getRenderById(e.unitId))==null?void 0:k.with(W.DocSelectionRenderService),r=o.get(Ge),s=t.getRenderById(e.unitId),a=s==null?void 0:s.scene,d=s==null?void 0:s.with(B.DocSkeletonManagerService).getSkeleton();if(a==null||n==null)return!1;const g=a.getTransformerByCreate(),c=o.get(i.ICommandService),p=o.get(i.IUniverInstanceService).getCurrentUniverDocInstance();if(p==null)return!1;const{drawing:u,unitId:m,offset:h,segmentId:v,segmentPage:I,needRefreshDrawings:f}=e;if(f)return r.refreshDrawings(d),g.refreshControls(),!0;const T=[],{drawingId:y}=u,O=(E=n.getSegment())!=null?E:"",C=dt(v,O,I,h,y,p,n);if(C==null||C.length===0)return r.refreshDrawings(d),g.refreshControls(),!1;T.push(...C);const b={id:B.RichTextEditingMutation.id,params:{unitId:m,actions:[],textRanges:null}};b.params.actions=T.reduce((w,U)=>i.JSONX.compose(w,U),null);const P=c.syncExecuteCommand(b.id,b.params);return g.refreshControls(),!!P}},ht={id:"doc.command.transform-non-inline-drawing",type:i.CommandType.COMMAND,handler:(o,e)=>{var N,z;if(e==null)return!1;const t=o.get(j.IRenderManagerService),n=(N=t.getRenderById(e.unitId))==null?void 0:N.with(W.DocSelectionRenderService),r=t.getRenderById(e.unitId),s=r==null?void 0:r.scene;if(s==null||n==null)return!1;const a=s.getTransformerByCreate(),d=o.get(i.ICommandService),c=o.get(i.IUniverInstanceService).getCurrentUniverDocInstance();if(c==null)return!1;const{drawing:l,unitId:p,offset:u,docTransform:m,segmentId:h,segmentPage:v}=e,I=[],{drawingId:f}=l,T=(z=n.getSegment())!=null?z:"",y=dt(h,T,v,u,f,c,n);if(y==null)return!1;y.length>0&&I.push(...y);const O=i.JSONX.getInstance(),{drawings:C={}}=c.getSnapshot(),b=C[f].docTransform,{positionH:P,positionV:k,size:E,angle:w}=b;if(!i.Tools.diffValue(P,m.positionH)){const _=O.replaceOp(["drawings",f,"docTransform","positionH"],P,m.positionH);I.push(_)}if(!i.Tools.diffValue(k,m.positionV)){const _=O.replaceOp(["drawings",f,"docTransform","positionV"],k,m.positionV);I.push(_)}if(!i.Tools.diffValue(E,m.size)){const _=O.replaceOp(["drawings",f,"docTransform","size"],E,m.size);I.push(_)}if(!i.Tools.diffValue(w,m.angle)){const _=O.replaceOp(["drawings",f,"docTransform","angle"],w,m.angle);I.push(_)}const U={id:B.RichTextEditingMutation.id,params:{unitId:p,actions:[],textRanges:null,debounce:!0}};U.params.actions=I.reduce((_,D)=>i.JSONX.compose(_,D),null);const $=d.syncExecuteCommand(U.id,U.params);return a.refreshControls(),!!$}},Te={id:"doc.command.move-drawing",type:i.CommandType.COMMAND,handler:(o,e)=>{const t=o.get(i.ICommandService),n=o.get(me.IDocDrawingService),r=o.get(i.IUniverInstanceService),s=o.get(j.IRenderManagerService),{direction:a}=e,d=n.getFocusDrawings();if(d.length===0)return!1;const g=d[0].unitId,c=s.getRenderById(g),l=c==null?void 0:c.scene;if(l==null)return!1;const p=l.getTransformerByCreate(),u=r.getUniverDocInstance(g),m=d.map(v=>{var b,P,k,E,w;const{drawingId:I}=v,f=(b=u==null?void 0:u.getSnapshot().drawings)==null?void 0:b[I];if(f==null||f.layoutType===i.PositionedObjectLayoutType.INLINE)return null;const{positionH:T,positionV:y}=f.docTransform,O={...T},C={...y};return a===i.Direction.UP?C.posOffset=((P=C.posOffset)!=null?P:0)-2:a===i.Direction.DOWN?C.posOffset=((k=C.posOffset)!=null?k:0)+2:a===i.Direction.LEFT?O.posOffset=((E=O.posOffset)!=null?E:0)-2:a===i.Direction.RIGHT&&(O.posOffset=((w=O.posOffset)!=null?w:0)+2),{drawingId:I,key:a===i.Direction.UP||a===i.Direction.DOWN?"positionV":"positionH",value:a===i.Direction.UP||a===i.Direction.DOWN?C:O}}).filter(v=>v!=null);if(m.length===0)return!1;const h=t.syncExecuteCommand(Ce.id,{unitId:g,subUnitId:g,drawings:m});return p.refreshControls(),!!h}},mt={id:"doc.operation.clear-drawing-transformer",type:i.CommandType.MUTATION,handler:(o,e)=>{const t=o.get(j.IRenderManagerService);return e.forEach(n=>{var r,s;(s=(r=t.getRenderById(n))==null?void 0:r.scene.getTransformer())==null||s.debounceRefreshControls()}),!0}},ft="COMPONENT_DOC_DRAWING_PANEL",et={id:"sidebar.operation.doc-image",type:i.CommandType.COMMAND,handler:async(o,e)=>{const t=o.get(L.ISidebarService),n=o.get(i.LocaleService),r=o.get(V.IDrawingManagerService);switch(e.value){case"open":t.open({header:{title:n.t("docImage.panel.title")},children:{label:ft},onClose:()=>{r.focusDrawing(null)},width:360});break;case"close":default:t.close();break}return!0}},tt={id:"doc.operation.edit-doc-image",type:i.CommandType.OPERATION,handler:(o,e)=>{const t=o.get(V.IDrawingManagerService),n=o.get(i.ICommandService);return e==null?!1:(t.focusDrawing([e]),n.executeCommand(et.id,{value:"open"}),!0)}};var Rt=Object.getOwnPropertyDescriptor,Ct=(o,e,t,n)=>{for(var r=n>1?void 0:n?Rt(e,t):e,s=o.length-1,a;s>=0;s--)(a=o[s])&&(r=a(r)||r);return r},De=(o,e)=>(t,n)=>e(t,n,o);function vt(o,e,t=1,n=0){const{top:r,left:s,bottom:a,right:d}=o,g=d-s,c=a-r,l=e.getViewport(W.VIEWPORT_KEY.VIEW_MAIN),{viewportScrollX:p,viewportScrollY:u}=l,{scaleX:m,scaleY:h}=e.getAncestorScale();return{startX:(s-p)*m,startY:(r-u)*h,endX:(s+g-p)*m,endY:(r+c-u)*h,width:g*m,height:c*h,rotate:n,absolute:{left:!1,top:!1},opacity:t!=null?t:1}}function $e(o,e){const{top:t,left:n,width:r,height:s,angle:a,opacity:d}=o;return vt({top:t,left:n,bottom:t+s,right:n+r},e.scene,d,a)}exports.DocFloatDomController=class extends i.Disposable{constructor(t,n,r,s,a,d){super();ce(this,"_domLayerInfoMap",new Map);this._renderManagerService=t,this._drawingManagerService=n,this._drawingRenderService=r,this._canvasFloatDomService=s,this._univerInstanceService=a,this._commandService=d,this._initialize()}dispose(){super.dispose()}_initialize(){this._drawingAddRemoveListener(),this._initScrollAndZoomEvent()}_getSceneAndTransformerByDrawingSearch(t){if(t==null)return;const n=this._renderManagerService.getRenderById(t);if(n==null)return null;const r=n.scene,s=r.getTransformerByCreate();return{scene:r,transformer:s,renderUnit:n,canvas:n.engine.getCanvasElement()}}_drawingAddRemoveListener(){this.disposeWithMe(this._drawingManagerService.add$.subscribe(t=>{this._insertRects(t)})),this.disposeWithMe(this._drawingManagerService.remove$.subscribe(t=>{t.forEach(n=>{this._removeDom(n.drawingId)})}))}_insertRects(t){t.forEach(async n=>{const{unitId:r}=n;if(!this._univerInstanceService.getUnit(r,i.UniverInstanceType.UNIVER_DOC))return;const a=this._getSceneAndTransformerByDrawingSearch(r);if(a==null)return;const d=this._drawingManagerService.getDrawingByParam(n);if(d==null)return;const g=await this._drawingRenderService.renderFloatDom(d,a.scene);if(!(g==null||g.length===0))for(const c of g){this._addHoverForRect(c);const l=new i.DisposableCollection,p=$e(c,a.renderUnit),u=new J.BehaviorSubject(p),m=a.canvas,h=d.data,v={dispose:l,rect:c,position$:u,unitId:r};this._canvasFloatDomService.addFloatDom({position$:u,id:d.drawingId,componentKey:d.componentKey,onPointerDown:f=>{m.dispatchEvent(new PointerEvent(f.type,f))},onPointerMove:f=>{m.dispatchEvent(new PointerEvent(f.type,f))},onPointerUp:f=>{m.dispatchEvent(new PointerEvent(f.type,f))},onWheel:f=>{m.dispatchEvent(new WheelEvent(f.type,f))},data:h,unitId:r});const I=c.onTransformChange$.subscribeEvent(()=>{const f=$e(c,a.renderUnit);u.next(f)});l.add(()=>{this._canvasFloatDomService.removeFloatDom(d.drawingId)}),I&&l.add(I),this._domLayerInfoMap.set(d.drawingId,v)}})}_addHoverForRect(t){this.disposeWithMe(i.toDisposable(t.onPointerEnter$.subscribeEvent(()=>{t.cursor=j.CURSOR_TYPE.GRAB}))),this.disposeWithMe(i.toDisposable(t.onPointerLeave$.subscribeEvent(()=>{t.cursor=j.CURSOR_TYPE.DEFAULT})))}_removeDom(t){const n=this._domLayerInfoMap.get(t);if(!n)return;const{unitId:r}=n;this._domLayerInfoMap.delete(t),n.dispose.dispose();const s=this._getSceneAndTransformerByDrawingSearch(r);s&&s.scene.removeObject(n.rect)}_initScrollAndZoomEvent(){const t=n=>{const r=this._getSceneAndTransformerByDrawingSearch(n);r&&this._domLayerInfoMap.forEach(s=>{if(s.unitId!==n)return;const a=$e(s.rect,r.renderUnit);s.position$.next(a)})};this.disposeWithMe(this._univerInstanceService.getCurrentTypeOfUnit$(i.UniverInstanceType.UNIVER_DOC).pipe(J.map(n=>{if(!n)return null;const r=n.getUnitId(),s=this._renderManagerService.getRenderById(r);return s?{render:s,unitId:r}:null}),J.switchMap(n=>n?i.fromEventSubject(n.render.scene.getViewport(W.VIEWPORT_KEY.VIEW_MAIN).onScrollAfter$).pipe(J.map(()=>({unitId:n.unitId}))):J.of(null))).subscribe(n=>{if(!n)return;const{unitId:r}=n;t(r)})),this.disposeWithMe(this._commandService.onCommandExecuted(n=>{if(n.id===W.SetDocZoomRatioOperation.id){const r=n.params,{unitId:s}=r;t(s)}}))}insertFloatDom(t,n){var I,f,T;const r=this._univerInstanceService.getCurrentUnitOfType(i.UniverInstanceType.UNIVER_DOC);if(!r)return!1;const s=this._getSceneAndTransformerByDrawingSearch(r.getUnitId());if(!s)return!1;const g=(I=s.renderUnit.with(B.DocSkeletonManagerService).getSkeleton().getSkeletonData())==null?void 0:I.pages[0];if(!g)return!1;const{pageWidth:c,marginLeft:l,marginRight:p}=g,u=c-l-p,m={size:{width:(f=n.width)!=null?f:u,height:n.height},positionH:{relativeFrom:i.ObjectRelativeFromH.PAGE,posOffset:0},positionV:{relativeFrom:i.ObjectRelativeFromV.PAGE,posOffset:0},angle:0},h=(T=n.drawingId)!=null?T:i.generateRandomId(),v={unitId:r.getUnitId(),drawings:[{drawingId:h,drawingType:i.DrawingTypeEnum.DRAWING_DOM,subUnitId:r.getUnitId(),unitId:r.getUnitId(),...t,title:"",description:"",docTransform:m,layoutType:i.PositionedObjectLayoutType.INLINE,transform:W.docDrawingPositionToTransform(m)}]};return this._commandService.syncExecuteCommand(He.id,v),h}};exports.DocFloatDomController=Ct([De(0,j.IRenderManagerService),De(1,V.IDrawingManagerService),De(2,i.Inject(he.DrawingRenderService)),De(3,i.Inject(L.CanvasFloatDomService)),De(4,i.IUniverInstanceService),De(5,i.ICommandService)],exports.DocFloatDomController);const xt="docs-drawing-ui.config",ot={},st=-1e3,at=1e3,Et=o=>{const e=L.useDependency(i.ICommandService),t=L.useDependency(i.LocaleService),n=L.useDependency(V.IDrawingManagerService),r=L.useDependency(j.IRenderManagerService),s=L.useDependency(i.IUniverInstanceService),{drawings:a}=o,d=a[0];if(d==null)return;const{unitId:g}=d,c=s.getUniverDocInstance(g),l=c==null?void 0:c.getSnapshot().documentStyle.documentFlavor,p=r.getRenderById(g),u=p==null?void 0:p.scene;if(u==null)return;const m=u.getTransformerByCreate(),h=[{label:t.t("image-position.column"),value:String(i.ObjectRelativeFromH.COLUMN)},{label:t.t("image-position.page"),value:String(i.ObjectRelativeFromH.PAGE)},{label:t.t("image-position.margin"),value:String(i.ObjectRelativeFromH.MARGIN)}],v=[{label:t.t("image-position.line"),value:String(i.ObjectRelativeFromV.LINE),disabled:l===i.DocumentFlavor.MODERN},{label:t.t("image-position.page"),value:String(i.ObjectRelativeFromV.PAGE),disabled:l===i.DocumentFlavor.MODERN},{label:t.t("image-position.margin"),value:String(i.ObjectRelativeFromV.MARGIN),disabled:l===i.DocumentFlavor.MODERN},{label:t.t("image-position.paragraph"),value:String(i.ObjectRelativeFromV.PARAGRAPH)}],[I,f]=K.useState(!0),[T,y]=K.useState({relativeFrom:i.ObjectRelativeFromH.PAGE,posOffset:0}),[O,C]=K.useState({relativeFrom:i.ObjectRelativeFromV.PAGE,posOffset:0}),[b,P]=K.useState(!0),[k,E]=K.useState(!0);function w(D,x){var R;D==="positionH"?y(x):C(x);const M=n.getFocusDrawings();if(M.length===0)return;const F=M.map(A=>({unitId:A.unitId,subUnitId:A.subUnitId,drawingId:A.drawingId}));e.executeCommand(Ce.id,{unitId:M[0].unitId,subUnitId:M[0].unitId,drawings:F.map(A=>({drawingId:A.drawingId,key:D,value:x}))});const H=(R=r.getRenderById(g))==null?void 0:R.with(W.DocSelectionRenderService);H&&H.blur(),m.refreshControls()}function U(D){var Q,de,ge;const x=T.relativeFrom,M=T.posOffset,F=Number(D);if(x===F)return;const H=n.getFocusDrawings();if(H.length===0)return;const R=H[0].drawingId,A=H[0].unitId;let q=null,G=0;const Y=(Q=r.getRenderById(A))==null?void 0:Q.with(B.DocSkeletonManagerService).getSkeleton(),ee=Y==null?void 0:Y.getSkeletonData();if(ee==null)return;const{pages:_e,skeHeaders:fe,skeFooters:ye}=ee;for(const ne of _e){const{marginLeft:le,skeDrawings:ue,headerId:ve,footerId:Ie,pageWidth:pe}=ne;if(ue.has(R)){q=ue.get(R),G=le;break}const ie=(de=fe.get(ve))==null?void 0:de.get(pe);if(ie!=null&&ie.skeDrawings.has(R)){q=ie==null?void 0:ie.skeDrawings.get(R),G=le;break}const re=(ge=ye.get(Ie))==null?void 0:ge.get(pe);if(re!=null&&re.skeDrawings.has(R)){q=re==null?void 0:re.skeDrawings.get(R),G=le;break}}if(q==null)return;let te=0;x===i.ObjectRelativeFromH.COLUMN?te-=q.columnLeft:x===i.ObjectRelativeFromH.MARGIN&&(te-=G),F===i.ObjectRelativeFromH.COLUMN?te+=q.columnLeft:F===i.ObjectRelativeFromH.MARGIN?te+=G:i.ObjectRelativeFromH.PAGE;const Z={relativeFrom:F,posOffset:(M!=null?M:0)-te};w("positionH",Z)}function $(D){var ue,ve,Ie,pe,ie,re;const x=O.relativeFrom,M=O.posOffset,F=Number(D);if(x===F)return;const H=n.getFocusDrawings();if(H.length===0)return;const{drawingId:R,unitId:A}=H[0],q=s.getUniverDocInstance(A),G=(ue=r.getRenderById(A))==null?void 0:ue.with(B.DocSkeletonManagerService).getSkeleton(),Y=(ve=r.getRenderById(A))==null?void 0:ve.with(W.DocSelectionRenderService),ee=Y==null?void 0:Y.getSegment(),_e=Y==null?void 0:Y.getSegmentPage(),fe=(pe=(Ie=q==null?void 0:q.getSelfOrHeaderFooterModel(ee).getBody())==null?void 0:Ie.customBlocks)==null?void 0:pe.find(we=>we.blockId===R);if(fe==null||G==null||Y==null)return;const{startIndex:ye}=fe,te=G.findNodeByCharIndex(ye,ee,_e),Z=(ie=te==null?void 0:te.parent)==null?void 0:ie.parent,Q=Z==null?void 0:Z.parent,de=Q==null?void 0:Q.lines.find(we=>we.paragraphIndex===(Z==null?void 0:Z.paragraphIndex)&&we.paragraphStart),ge=(re=Q==null?void 0:Q.parent)==null?void 0:re.parent;if(te==null||Z==null||de==null||Q==null||ge==null)return;let ne=0;x===i.ObjectRelativeFromV.PARAGRAPH?ne-=de.top:x===i.ObjectRelativeFromV.LINE?ne-=Z.top:x===i.ObjectRelativeFromV.PAGE&&(ne+=ge.marginTop),F===i.ObjectRelativeFromV.PARAGRAPH?ne+=de.top:F===i.ObjectRelativeFromV.LINE?ne+=Z.top:F===i.ObjectRelativeFromV.PAGE&&(ne-=ge.marginTop);const le={relativeFrom:F,posOffset:(M!=null?M:0)-ne};w("positionV",le)}function N(D){var A;const x=c==null?void 0:c.getSnapshot(),M=(A=x==null?void 0:x.drawings)==null?void 0:A[D.drawingId];if(M==null)return;const{layoutType:F}=M,{positionH:H,positionV:R}=M.docTransform;y(H),C(R),f(F===i.PositionedObjectLayoutType.INLINE),P(R.relativeFrom===i.ObjectRelativeFromV.PARAGRAPH||R.relativeFrom===i.ObjectRelativeFromV.LINE)}function z(){const D=n.getFocusDrawings();D.length!==0&&N(D[0])}function _(D){P(D),$(String(D?i.ObjectRelativeFromV.PARAGRAPH:i.ObjectRelativeFromV.PAGE))}return K.useEffect(()=>{z();const D=n.focus$.subscribe(M=>{if(M.length===0){E(!1);return}E(!0),N(M[0])}),x=e.onCommandExecuted(async M=>{M.id===B.RichTextEditingMutation.id&&z()});return()=>{D.unsubscribe(),x.dispose()}},[]),S.jsxs("div",{className:X.clsx("univer-grid univer-gap-2 univer-py-2 univer-text-gray-400",{"univer-hidden":!k}),children:[S.jsx("header",{className:"univer-text-gray-600 dark:!univer-text-gray-200",children:S.jsx("div",{children:t.t("image-position.title")})}),S.jsx("div",{className:"univer-text-gray-600 dark:!univer-text-gray-200",children:S.jsx("div",{children:t.t("image-position.horizontal")})}),S.jsxs("div",{className:"univer-grid univer-grid-cols-2 univer-gap-2 [&>div]:univer-grid [&>div]:univer-gap-2",children:[S.jsxs("div",{children:[S.jsx("span",{children:t.t("image-position.absolutePosition")}),S.jsx(X.InputNumber,{min:st,max:at,precision:1,disabled:I,value:T.posOffset,onChange:D=>{w("positionH",{relativeFrom:T.relativeFrom,posOffset:D})}})]}),S.jsxs("div",{children:[S.jsx("span",{children:t.t("image-position.toTheRightOf")}),S.jsx(X.Select,{value:String(T.relativeFrom),disabled:I,options:h,onChange:U})]})]}),S.jsx("div",{className:"univer-text-gray-600 dark:!univer-text-gray-200",children:S.jsx("div",{children:t.t("image-position.vertical")})}),S.jsxs("div",{className:"univer-grid univer-grid-cols-2 univer-gap-2 [&>div]:univer-grid [&>div]:univer-gap-2",children:[S.jsxs("div",{children:[S.jsx("span",{children:t.t("image-position.absolutePosition")}),S.jsx(X.InputNumber,{min:st,max:at,precision:1,disabled:I,value:O.posOffset,onChange:D=>{w("positionV",{relativeFrom:O.relativeFrom,posOffset:D})}})]}),S.jsxs("div",{children:[S.jsx("span",{children:t.t("image-position.bellow")}),S.jsx(X.Select,{disabled:I,value:String(O.relativeFrom),options:v,onChange:$})]})]}),S.jsx("div",{className:"univer-text-gray-600 dark:!univer-text-gray-200",children:S.jsx("div",{children:t.t("image-position.options")})}),S.jsx("div",{children:S.jsx(X.Checkbox,{disabled:I,checked:b,onChange:_,children:t.t("image-position.moveObjectWithText")})})]})},Ee=0,Pe=100,Pt=o=>{const e=L.useDependency(i.ICommandService),t=L.useDependency(i.LocaleService),n=L.useDependency(V.IDrawingManagerService),r=L.useDependency(j.IRenderManagerService),s=L.useDependency(i.IUniverInstanceService),{drawings:a}=o,d=a[0];if(d==null)return null;const{unitId:g}=d,c=s.getUniverDocInstance(g),l=r.getRenderById(g);if((l==null?void 0:l.scene)==null)return null;const[u,m]=K.useState(!0),[h,v]=K.useState(!0),[I,f]=K.useState(!0),[T,y]=K.useState(se.INLINE),[O,C]=K.useState(""),[b,P]=K.useState({distT:0,distL:0,distB:0,distR:0}),[k,E]=K.useState(!0);function w(_){y(_);const D=n.getFocusDrawings();if(D.length===0)return;const{unitId:x,subUnitId:M}=D[0],F=D.map(({unitId:H,subUnitId:R,drawingId:A})=>({unitId:H,subUnitId:R,drawingId:A}));e.executeCommand(gt.id,{unitId:x,subUnitId:M,drawings:F,wrappingStyle:_})}function U(_){C(_);const D=n.getFocusDrawings();if(D.length===0)return;const x=D.map(M=>({unitId:M.unitId,subUnitId:M.subUnitId,drawingId:M.drawingId}));e.executeCommand(ut.id,{unitId:D[0].unitId,subUnitId:D[0].unitId,drawings:x,wrapText:_})}function $(_,D){if(_==null)return;const x={...b,[D]:_};P(x);const M=n.getFocusDrawings();if(M.length===0)return;const F=M.map(H=>({unitId:H.unitId,subUnitId:H.subUnitId,drawingId:H.drawingId}));e.executeCommand(lt.id,{unitId:M[0].unitId,subUnitId:M[0].unitId,drawings:F,dist:{[D]:_}})}function N(){const _=n.getFocusDrawings();_.length!==0&&z(_[0])}function z(_){var Y,ee;const D=(ee=(Y=c==null?void 0:c.getSnapshot())==null?void 0:Y.drawings)==null?void 0:ee[_.drawingId];if(D==null)return;const{distT:x=0,distL:M=0,distB:F=0,distR:H=0,layoutType:R=i.PositionedObjectLayoutType.INLINE,behindDoc:A=i.BooleanNumber.FALSE,wrapText:q=i.WrapTextType.BOTH_SIDES}=D;if(P({distT:x,distL:M,distB:F,distR:H}),C(q),m(R!==i.PositionedObjectLayoutType.WRAP_SQUARE),R===i.PositionedObjectLayoutType.WRAP_NONE||R===i.PositionedObjectLayoutType.INLINE?v(!0):v(!1),R===i.PositionedObjectLayoutType.WRAP_NONE||R===i.PositionedObjectLayoutType.INLINE||R===i.PositionedObjectLayoutType.WRAP_TOP_AND_BOTTOM?f(!0):f(!1),R===i.PositionedObjectLayoutType.WRAP_NONE)A===i.BooleanNumber.TRUE?y(se.BEHIND_TEXT):y(se.IN_FRONT_OF_TEXT);else switch(R){case i.PositionedObjectLayoutType.INLINE:y(se.INLINE);break;case i.PositionedObjectLayoutType.WRAP_SQUARE:y(se.WRAP_SQUARE);break;case i.PositionedObjectLayoutType.WRAP_TOP_AND_BOTTOM:y(se.WRAP_TOP_AND_BOTTOM);break;default:throw new Error(`Unsupported layout type: ${R}`)}}return K.useEffect(()=>{N();const _=n.focus$.subscribe(x=>{if(x.length===0){E(!1);return}E(!0),z(x[0])}),D=e.onCommandExecuted(async x=>{x.id===B.RichTextEditingMutation.id&&N()});return()=>{_.unsubscribe(),D.dispose()}},[]),S.jsxs("div",{className:X.clsx("univer-grid univer-gap-2 univer-py-2 univer-text-gray-400",{"univer-hidden":!k}),children:[S.jsx("header",{className:"univer-text-gray-600 dark:!univer-text-gray-200",children:S.jsx("div",{children:t.t("image-text-wrap.title")})}),S.jsx("div",{className:"univer-text-gray-600 dark:!univer-text-gray-200",children:S.jsx("div",{children:t.t("image-text-wrap.wrappingStyle")})}),S.jsx("div",{children:S.jsxs(X.RadioGroup,{value:T,onChange:w,direction:"vertical",children:[S.jsx(X.Radio,{value:se.INLINE,children:t.t("image-text-wrap.inline")}),S.jsx(X.Radio,{value:se.WRAP_SQUARE,children:t.t("image-text-wrap.square")}),S.jsx(X.Radio,{value:se.WRAP_TOP_AND_BOTTOM,children:t.t("image-text-wrap.topAndBottom")}),S.jsx(X.Radio,{value:se.BEHIND_TEXT,children:t.t("image-text-wrap.behindText")}),S.jsx(X.Radio,{value:se.IN_FRONT_OF_TEXT,children:t.t("image-text-wrap.inFrontText")})]})}),S.jsx("div",{className:"univer-text-gray-600 dark:!univer-text-gray-200",children:S.jsx("div",{children:t.t("image-text-wrap.wrapText")})}),S.jsx("div",{children:S.jsxs(X.RadioGroup,{disabled:u,value:O,onChange:U,direction:"horizontal",children:[S.jsx(X.Radio,{value:i.WrapTextType.BOTH_SIDES,children:t.t("image-text-wrap.bothSide")}),S.jsx(X.Radio,{value:i.WrapTextType.LEFT,children:t.t("image-text-wrap.leftOnly")}),S.jsx(X.Radio,{value:i.WrapTextType.RIGHT,children:t.t("image-text-wrap.rightOnly")})]})}),S.jsx("div",{className:"univer-text-gray-600 dark:!univer-text-gray-200",children:S.jsx("div",{children:t.t("image-text-wrap.distanceFromText")})}),S.jsxs("div",{className:"univer-grid univer-grid-cols-2 univer-gap-2 [&>div]:univer-grid [&>div]:univer-gap-2",children:[S.jsxs("div",{children:[S.jsx("span",{children:t.t("image-text-wrap.top")}),S.jsx(X.InputNumber,{min:Ee,max:Pe,disabled:h,precision:1,value:b.distT,onChange:_=>{$(_,"distT")}})]}),S.jsxs("div",{children:[S.jsx("span",{children:t.t("image-text-wrap.left")}),S.jsx(X.InputNumber,{min:Ee,max:Pe,disabled:I,precision:1,value:b.distL,onChange:_=>{$(_,"distL")}})]})]}),S.jsxs("div",{className:"univer-grid univer-grid-cols-2 univer-gap-2 [&>div]:univer-grid [&>div]:univer-gap-2",children:[S.jsxs("div",{children:[S.jsx("span",{children:t.t("image-text-wrap.bottom")}),S.jsx(X.InputNumber,{min:Ee,max:Pe,disabled:h,precision:1,value:b.distB,onChange:_=>{$(_,"distB")}})]}),S.jsxs("div",{children:[S.jsx("span",{children:t.t("image-text-wrap.right")}),S.jsx(X.InputNumber,{min:Ee,max:Pe,disabled:I,precision:1,value:b.distR,onChange:_=>{$(_,"distR")}})]})]})]})},At=()=>{const o=L.useDependency(V.IDrawingManagerService),e=o.getFocusDrawings(),[t,n]=K.useState(e);return K.useEffect(()=>{const r=o.focus$.subscribe(s=>{n(s)});return()=>{r.unsubscribe()}},[]),!!(t!=null&&t.length)&&S.jsxs("div",{className:"univer-text-sm",children:[S.jsx(he.DrawingCommonPanel,{drawings:t,hasAlign:!1,hasCropper:!1,hasGroup:!1,hasTransform:!1}),S.jsx(Pt,{drawings:t}),S.jsx(Et,{drawings:t})]})},nt="doc.menu.image",It=Qe.id,Nt=o=>{const e=o.get(B.DocSelectionManagerService),t=o.get(i.IUniverInstanceService);return new J.Observable(n=>{const r=e.textSelection$.subscribe(()=>{var a;const s=e.getActiveTextRange();if(s){const{segmentId:d,startOffset:g,endOffset:c}=s,l=t.getCurrentUniverDocInstance(),p=(a=l==null?void 0:l.getSelfOrHeaderFooterModel(d).getBody())==null?void 0:a.tables;if(p&&p.length&&p.some(u=>{const{startIndex:m,endIndex:h}=u;return g>=m&&g<h||c>=m&&c<h})){n.next(!0);return}}else{n.next(!0);return}n.next(!1)});return()=>r.unsubscribe()})};function jt(o){return{id:nt,type:L.MenuItemType.SUBITEMS,icon:"AddImageIcon",tooltip:"docImage.title",disabled$:Nt(o),hidden$:L.getMenuHiddenObservable(o,i.UniverInstanceType.UNIVER_DOC,void 0,i.DOCS_ZEN_EDITOR_UNIT_ID_KEY)}}function Ut(o){return{id:It,title:"docImage.upload.float",type:L.MenuItemType.BUTTON,hidden$:L.getMenuHiddenObservable(o,i.UniverInstanceType.UNIVER_DOC,void 0,i.DOCS_ZEN_EDITOR_UNIT_ID_KEY)}}const Ft={[L.RibbonInsertGroup.MEDIA]:{[nt]:{order:0,menuItemFactory:jt,[It]:{order:0,menuItemFactory:Ut}}}};function xe(o){return o.getContextValue(i.FOCUSING_UNIVER_EDITOR)&&o.getContextValue(i.FOCUSING_COMMON_DRAWINGS)}const Lt={id:Te.id,description:"shortcut.drawing-move-down",group:"4_drawing-view",binding:L.KeyCode.ARROW_DOWN,priority:100,preconditions:xe,staticParameters:{direction:i.Direction.DOWN}},Bt={id:Te.id,description:"shortcut.drawing-move-up",group:"4_drawing-view",binding:L.KeyCode.ARROW_UP,priority:100,preconditions:xe,staticParameters:{direction:i.Direction.UP}},kt={id:Te.id,description:"shortcut.drawing-move-left",group:"4_drawing-view",binding:L.KeyCode.ARROW_LEFT,priority:100,preconditions:xe,staticParameters:{direction:i.Direction.LEFT}},Wt={id:Te.id,description:"shortcut.drawing-move-right",group:"4_drawing-view",binding:L.KeyCode.ARROW_RIGHT,priority:100,preconditions:xe,staticParameters:{direction:i.Direction.RIGHT}},Ht={id:Ke.id,description:"shortcut.drawing-delete",group:"4_drawing-view",preconditions:xe,binding:L.KeyCode.DELETE,mac:L.KeyCode.BACKSPACE};var Gt=Object.getOwnPropertyDescriptor,Vt=(o,e,t,n)=>{for(var r=n>1?void 0:n?Gt(e,t):e,s=o.length-1,a;s>=0;s--)(a=o[s])&&(r=a(r)||r);return r},Ae=(o,e)=>(t,n)=>e(t,n,o);let Ue=class extends i.Disposable{constructor(o,e,t,n){super(),this._componentManager=o,this._menuManagerService=e,this._commandService=t,this._shortcutService=n,this._init()}_initCustomComponents(){const o=this._componentManager;this.disposeWithMe(o.register(ft,At))}_initMenus(){this._menuManagerService.mergeMenu(Ft)}_initCommands(){[Qe,He,gt,lt,ut,Ce,pt,ht,We,et,mt,tt,Ye,Ze,Te,Ke,Je].forEach(o=>this.disposeWithMe(this._commandService.registerCommand(o)))}_initShortcuts(){[Lt,Bt,kt,Wt,Ht].forEach(o=>{this.disposeWithMe(this._shortcutService.registerShortcut(o))})}_init(){this._initCommands(),this._initCustomComponents(),this._initMenus(),this._initShortcuts()}};Ue=Vt([Ae(0,i.Inject(L.ComponentManager)),Ae(1,L.IMenuManagerService),Ae(2,i.ICommandService),Ae(3,L.IShortcutService)],Ue);var Xt=Object.getOwnPropertyDescriptor,$t=(o,e,t,n)=>{for(var r=n>1?void 0:n?Xt(e,t):e,s=o.length-1,a;s>=0;s--)(a=o[s])&&(r=a(r)||r);return r},Me=(o,e)=>(t,n)=>e(t,n,o);function zt(o){var n,r,s,a;if(i.JSONX.isNoop(o)||!Array.isArray(o))return null;const e=o.find(d=>Array.isArray(d)&&(d==null?void 0:d[0])==="drawings");if(e==null||!Array.isArray(e)||e.length<3||typeof e[1]=="string"&&typeof e[2]!="object"||Array.isArray(e[1])&&typeof e[1][1]!="object")return null;const t=[];if(Array.isArray(e==null?void 0:e[1]))for(const d of e)Array.isArray(d)&&t.push({type:(n=d==null?void 0:d[1])!=null&&n.i?"add":"remove",drawingId:d==null?void 0:d[0],drawing:(r=d==null?void 0:d[1])==null?void 0:r.i});else t.push({type:(s=e[2])!=null&&s.i?"add":"remove",drawingId:e[1],drawing:(a=e[2])==null?void 0:a.i});return t}function qt(o){if(!Array.isArray(o)||o.length<3||o[0]!=="drawingsOrder")return[];const e=[];for(let t=1;t<o.length;t++){const n=o[t];if(Array.isArray(n)&&typeof n[0]=="number"&&typeof n[1]=="object")e.push(n[0]);else{e.length=0;break}}return e}let Fe=class extends i.Disposable{constructor(o,e,t,n,r){super(),this._univerInstanceService=o,this._commandService=e,this._drawingManagerService=t,this._docDrawingService=n,this._renderManagerService=r,this._initialize()}_initialize(){this._commandExecutedListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.beforeCommandExecuted(o=>{if(o.id!==B.RichTextEditingMutation.id)return;const e=o.params,{unitId:t,actions:n}=e,r=zt(n);if(r!=null)for(const{type:s,drawingId:a,drawing:d}of r)s==="add"?this._addDrawings(t,[d]):this._removeDrawings(t,[a])})),this.disposeWithMe(this._commandService.onCommandExecuted(o=>{if(o.id!==B.RichTextEditingMutation.id)return;const e=o.params,{unitId:t,actions:n}=e;qt(n).length>0&&this._updateDrawingsOrder(t)})),this.disposeWithMe(this._commandService.onCommandExecuted(o=>{var a;if(o.id!==i.UndoCommand.id&&o.id!==i.RedoCommand.id)return;const e=(a=this._univerInstanceService.getCurrentUniverDocInstance())==null?void 0:a.getUnitId(),t=this._drawingManagerService.getFocusDrawings();if(e==null||t.length===0)return;const n=this._renderManagerService.getRenderById(e),r=n==null?void 0:n.scene;if(r==null)return!1;r.getTransformerByCreate().refreshControls()}))}_addDrawings(o,e){const t=this._drawingManagerService,n=this._docDrawingService,r=this._docDrawingService.getBatchAddOp(e),{subUnitId:s,redo:a,objects:d}=r;t.applyJson1(o,s,a),n.applyJson1(o,s,a),t.addNotification(d),n.addNotification(d)}_removeDrawings(o,e){const t=this._drawingManagerService,n=this._docDrawingService,r=this._docDrawingService.getBatchRemoveOp(e.map(g=>({unitId:o,subUnitId:o,drawingId:g}))),{subUnitId:s,redo:a,objects:d}=r;t.applyJson1(o,s,a),n.applyJson1(o,s,a),t.removeNotification(d),n.removeNotification(d)}_updateDrawingsOrder(o){const e=this._univerInstanceService.getUniverDocInstance(o);if(e==null)return;const t=e.getSnapshot().drawingsOrder;if(t==null)return;const n=this._drawingManagerService,r=this._docDrawingService;n.setDrawingOrder(o,o,t),r.setDrawingOrder(o,o,t);const s={unitId:o,subUnitId:o,drawingIds:t};n.orderNotification(s),r.orderNotification(s)}};Fe=$t([Me(0,i.IUniverInstanceService),Me(1,i.ICommandService),Me(2,V.IDrawingManagerService),Me(3,me.IDocDrawingService),Me(4,j.IRenderManagerService)],Fe);const Kt=o=>{const{floatDomInfos:e,scene:t,offset:n,bound:r}=o,s=r.right-r.left,a=r.bottom-r.top,d=K.useMemo(()=>e.map(g=>{const{width:c=0,height:l=0,left:p=0,top:u=0}=g.transform,h=vt({left:p,right:p+c,top:u,bottom:u+l},t),v={position$:new J.BehaviorSubject(h),position:h,id:g.drawingId,componentKey:g.componentKey,onPointerMove:()=>{},onPointerDown:()=>{},onPointerUp:()=>{},onWheel:()=>{},unitId:g.unitId,data:g.data};return[g.drawingId,v]}).filter(([g,c])=>!(c.position.endX<0||c.position.endY<0||c.position.startX>s||c.position.startY>a)),[e,t,n,s,a]);return S.jsx("div",{className:"univer-absolute univer-left-0 univer-top-0",children:d.map(([g,c])=>S.jsx(L.PrintFloatDomSingle,{layer:c,id:g,position:c.position},g))})};var Yt=Object.getOwnPropertyDescriptor,Jt=(o,e,t,n)=>{for(var r=n>1?void 0:n?Yt(e,t):e,s=o.length-1,a;s>=0;s--)(a=o[s])&&(r=a(r)||r);return r},be=(o,e)=>(t,n)=>e(t,n,o);let Le=class extends i.Disposable{constructor(o,e,t,n,r){super(),this._docPrintInterceptorService=o,this._drawingRenderService=e,this._drawingManagerService=t,this._componetManager=n,this._injector=r,this._initPrinting(),this._initPrintingDom()}_initPrinting(){this.disposeWithMe(this._docPrintInterceptorService.interceptor.intercept(this._docPrintInterceptorService.interceptor.getInterceptPoints().PRINTING_COMPONENT_COLLECT,{handler:(o,e,t)=>{const{unitId:n,scene:r}=e,s=this._drawingManagerService.getDrawingDataForUnit(n),a=s==null?void 0:s[n];return a&&a.order.forEach(d=>{const g=a.data[d];g.drawingType!==i.DrawingTypeEnum.DRAWING_CHART&&g.drawingType!==i.DrawingTypeEnum.DRAWING_DOM&&this._drawingRenderService.renderDrawing(g,r)}),t()}}))}_initPrintingDom(){this.disposeWithMe(this._docPrintInterceptorService.interceptor.intercept(this._docPrintInterceptorService.interceptor.getInterceptPoints().PRINTING_DOM_COLLECT,{handler:(o,e,t)=>{const{unitId:n}=e,r=this._drawingManagerService.getDrawingDataForUnit(n),s=r==null?void 0:r[n];if(s){const a=s.order.map(g=>{const c=s.data[g];if(c.drawingType===i.DrawingTypeEnum.DRAWING_CHART)return{...c,componentKey:this._componetManager.get(i.DOC_DRAWING_PRINTING_COMPONENT_KEY)};if(c.drawingType===i.DrawingTypeEnum.DRAWING_DOM){const l=this._docPrintInterceptorService.getPrintComponent(c.componentKey);return{...c,componentKey:this._componetManager.get(l||c.componentKey)}}return null}).filter(Boolean),d=L.connectInjector(Kt,this._injector);return X.render(S.jsx(d,{unitId:n,floatDomInfos:a,scene:e.scene,skeleton:e.skeleton,offset:e.offset,bound:e.bound}),e.root),o==null||o.add(()=>{X.unmount(e.root)}),t(o)}}}))}};Le=Jt([be(0,i.Inject(W.DocPrintInterceptorService)),be(1,i.Inject(he.DrawingRenderService)),be(2,V.IDrawingManagerService),be(3,i.Inject(L.ComponentManager)),be(4,i.Inject(i.Injector))],Le);var Zt=Object.getOwnPropertyDescriptor,Qt=(o,e,t,n)=>{for(var r=n>1?void 0:n?Zt(e,t):e,s=o.length-1,a;s>=0;s--)(a=o[s])&&(r=a(r)||r);return r},Ne=(o,e)=>(t,n)=>e(t,n,o);const en="__InlineDrawingAnchor__";function ct(o){const{path:e}=o;return e.some(t=>t==="cells")}let Be=class extends i.Disposable{constructor(e,t,n,r){super();ce(this,"_liquid",new j.Liquid);ce(this,"_listenerOnImageMap",new Set);ce(this,"_transformerCache",new Map);ce(this,"_anchorShape");this._commandService=e,this._univerInstanceService=t,this._drawingManagerService=n,this._renderManagerService=r,this._init()}_init(){this._listenDrawingFocus()}_listenDrawingFocus(){this.disposeWithMe(this._drawingManagerService.add$.subscribe(e=>{if(e.length!==0)for(const t of e){const{unitId:n}=t;this._listenerOnImageMap.has(n)||(this._listenTransformerChange(n),this._listenerOnImageMap.add(n))}}))}_listenTransformerChange(e){var r;const t=(r=this._getSceneAndTransformerByDrawingSearch(e))==null?void 0:r.transformer;if(t==null)return;this.disposeWithMe(i.toDisposable(t.changeStart$.subscribe(s=>{var d;this._transformerCache.clear();const{objects:a}=s;for(const g of a.values()){const{oKey:c,width:l,height:p,left:u,top:m,angle:h}=g,v=this._drawingManagerService.getDrawingOKey(c);if(v==null)continue;const I=this._univerInstanceService.getUniverDocInstance(v.unitId),f=(d=I==null?void 0:I.getSnapshot().drawings)==null?void 0:d[v.drawingId];if((f==null?void 0:f.layoutType)===i.PositionedObjectLayoutType.INLINE)try{g.setOpacity(.2)}catch{}f!=null&&this._transformerCache.set(v.drawingId,{drawing:f,top:m,left:u,width:l,height:p,angle:h})}})));const n=i.throttle(this._updateMultipleDrawingDocTransform.bind(this),50);i.throttle(this._nonInlineDrawingTransform.bind(this),50),this.disposeWithMe(i.toDisposable(t.changing$.subscribe(s=>{const{objects:a,offsetX:d,offsetY:g}=s;if(a.size>1)n(a);else if(a.size===1){const c=this._transformerCache.values().next().value,l=a.values().next().value,{width:p,height:u,top:m,left:h,angle:v}=l;if(c&&p===c.width&&u===c.height&&m===c.top&&h===c.left&&v===c.angle)return;c&&(c.drawing.layoutType,i.PositionedObjectLayoutType.INLINE),c&&c.drawing.layoutType===i.PositionedObjectLayoutType.INLINE&&d!=null&&g!=null&&this._updateInlineDrawingAnchor(c.drawing,d,g)}}))),this.disposeWithMe(i.toDisposable(t.changeEnd$.subscribe(s=>{const{objects:a,offsetX:d,offsetY:g}=s;for(const c of a.values()){const l=this._drawingManagerService.getDrawingOKey(c.oKey);if(l==null)continue;const p=this._transformerCache.get(l==null?void 0:l.drawingId);if((p==null?void 0:p.drawing.layoutType)===i.PositionedObjectLayoutType.INLINE)try{c.setOpacity(1)}catch{}}if(this._anchorShape&&this._anchorShape.hide(),a.size>1)this._updateMultipleDrawingDocTransform(a);else if(a.size===1){const c=this._transformerCache.values().next().value,l=a.values().next().value,{width:p,height:u,top:m,left:h,angle:v}=l;if(c&&p===c.width&&u===c.height&&m===c.top&&h===c.left&&v===c.angle)return;c&&c.drawing.layoutType===i.PositionedObjectLayoutType.INLINE?p!==c.width||u!==c.height||v!==c.angle?this._updateDrawingSize(c,l):d!=null&&g!=null&&this._moveInlineDrawing(c.drawing,d,g):c&&this._nonInlineDrawingTransform(c.drawing,l)}this._transformerCache.clear()})))}_updateMultipleDrawingDocTransform(e){if(e.size<1)return;const t=[];let n,r;for(const s of e.values()){const{oKey:a,left:d,top:g,angle:c}=s;let{width:l,height:p}=s;const u=this._drawingManagerService.getDrawingOKey(a);if(u==null)continue;n==null&&(n=u.unitId),r==null&&(r=u.subUnitId);const m=this._transformerCache.get(u.drawingId);if(m==null)continue;const{drawing:h,top:v,left:I,width:f,height:T,angle:y}=m,{width:O,height:C}=this._getPageContentSize(h);if(l=Math.min(l,O),p=Math.min(p,C),(f!==l||T!==p)&&t.push({drawingId:u.drawingId,key:"size",value:{width:l,height:p}}),y!==c&&t.push({drawingId:u.drawingId,key:"angle",value:c}),v!==g||I!==d){const b=g-v,P=d-I;b!==0&&t.push({drawingId:u.drawingId,key:"positionV",value:{relativeFrom:h.docTransform.positionV.relativeFrom,posOffset:h.docTransform.positionV.posOffset+b}}),P!==0&&t.push({drawingId:u.drawingId,key:"positionH",value:{relativeFrom:h.docTransform.positionH.relativeFrom,posOffset:h.docTransform.positionH.posOffset+P}})}}t.length>0&&n&&r&&this._commandService.executeCommand(Ce.id,{unitId:n,subUnitId:r,drawings:t})}_updateDrawingAnchor(e){if(this._transformerCache.size!==1)return;const t=this._transformerCache.values().next().value,n=e.values().next().value;this._getDrawingAnchor(t.drawing,n)}_updateInlineDrawingAnchor(e,t,n){var s;if(this._transformerCache.size!==1)return;const{contentBoxPointGroup:r}=(s=this._getInlineDrawingAnchor(e,t,n))!=null?s:{};r!=null&&this._createOrUpdateInlineAnchor(e.unitId,r)}_getInlineDrawingAnchor(e,t,n){var N,z;const r=this._renderManagerService.getRenderById(e.unitId),s=r==null?void 0:r.with(B.DocSkeletonManagerService).getSkeleton();if(r==null)return;const{mainComponent:a,scene:d}=r,g=a,c=d.getViewports()[0],{pageLayoutType:l=j.PageLayoutType.VERTICAL,pageMarginLeft:p,pageMarginTop:u}=g.getOffsetConfig();let m=null,h=!1,v=-1,I="";const f=.5,T=this._getTransformCoordForDocumentOffset(g,c,t,n);if(T==null)return;const y=(N=this._renderManagerService.getRenderById(e.unitId))==null?void 0:N.with(W.DocSelectionRenderService);if(y==null)return;const O=s==null?void 0:s.findNodeByCoord(T,l,p,u,{strict:!1,segmentId:y.getSegment(),segmentPage:y.getSegmentPage()});if(O){const{node:_,ratioX:D,segmentPage:x,segmentId:M}=O;h=D<f,m=_,v=x,I=M}if(m==null)return;const C=s==null?void 0:s.findPositionByGlyph(m,v),b=this._getDocObject();if(C==null||s==null||b==null||ct(C))return;const P={...C,isBack:h},k=b.document.getOffsetConfig(),E=new W.NodePositionConvertToCursor(k,s),{cursorList:w,contentBoxPointGroup:U}=E.getRangePointData(P,P),{startOffset:$}=(z=W.getOneTextSelectionRange(w))!=null?z:{};if($!=null)return{offset:$,contentBoxPointGroup:U,segmentId:I,segmentPage:v}}_getDrawingAnchor(e,t){var de,ge,ne,le,ue,ve,Ie,pe,ie,re,we;const n=this._renderManagerService.getRenderById(e.unitId),r=n==null?void 0:n.with(B.DocSkeletonManagerService).getSkeleton(),s=r==null?void 0:r.getSkeletonData();if(s==null||n==null)return;const{pages:a,skeHeaders:d,skeFooters:g}=s,{mainComponent:c,scene:l}=n,p=c,u=l.getViewports()[0],{pageLayoutType:m=j.PageLayoutType.VERTICAL,pageMarginLeft:h,pageMarginTop:v,docsLeft:I,docsTop:f}=p.getOffsetConfig(),{left:T,top:y,angle:O}=t;let{width:C,height:b}=t;const{positionV:P,positionH:k}=e.docTransform,{width:E,height:w}=this._getPageContentSize(e);C=Math.min(C,E),b=Math.min(b,w);let U=null,$="",N=-1;const z=!1,_={...e.docTransform,size:{width:C,height:b},angle:O},{x:D,y:x}=l.getViewportScrollXY(u),M=this._getTransformCoordForDocumentOffset(p,u,T-D,y-x);if(M==null)return;const F=(de=this._renderManagerService.getRenderById(e.unitId))==null?void 0:de.with(W.DocSelectionRenderService);if(F==null)return;const H=r==null?void 0:r.findNodeByCoord(M,m,h,v,{strict:!1,segmentId:F.getSegment(),segmentPage:F.getSegmentPage()});if(H){const{node:ae,segmentPage:Ve,segmentId:Xe}=H;U=ae,N=Ve,$=Xe}if(U==null)return;const R=(ge=U.parent)==null?void 0:ge.parent,A=R==null?void 0:R.parent,q=(ne=A==null?void 0:A.lines.find(ae=>ae.paragraphIndex===(R==null?void 0:R.paragraphIndex)&&ae.paragraphStart))!=null?ne:A==null?void 0:A.lines[0],G=(le=A==null?void 0:A.parent)==null?void 0:le.parent;if(R==null||A==null||q==null||G==null)return;this._liquid.reset();const Y=G.type;for(const ae of a){const{headerId:Ve,footerId:Xe,pageHeight:St,pageWidth:it,marginLeft:rt,marginBottom:_t}=ae,Dt=a.indexOf(ae);if(N>-1&&Dt===N){switch(Y){case j.DocumentSkeletonPageType.HEADER:{const Oe=(ue=d.get(Ve))==null?void 0:ue.get(it);if(Oe)this._liquid.translatePagePadding({marginTop:Oe.marginTop,marginLeft:rt});else throw new Error("header skeleton not found");break}case j.DocumentSkeletonPageType.FOOTER:{const Oe=(ve=g.get(Xe))==null?void 0:ve.get(it);if(Oe)this._liquid.translatePagePadding({marginTop:St-_t+Oe.marginTop,marginLeft:rt});else throw new Error("footer skeleton not found");break}}break}if(this._liquid.translatePagePadding(ae),ae===G)break;this._liquid.restorePagePadding(ae),this._liquid.translatePage(ae,m,h,v)}switch(P.relativeFrom===i.ObjectRelativeFromV.LINE?U=R.divides[0].glyphGroup[0]:U=(re=(ie=(pe=(Ie=q.divides)==null?void 0:Ie[0])==null?void 0:pe.glyphGroup)==null?void 0:ie[0])!=null?re:U,_.positionH={relativeFrom:k.relativeFrom,posOffset:T-this._liquid.x-I},k.relativeFrom){case i.ObjectRelativeFromH.MARGIN:{_.positionH.posOffset=T-this._liquid.x-I-G.marginLeft;break}case i.ObjectRelativeFromH.COLUMN:{_.positionH.posOffset=T-this._liquid.x-I-A.left;break}}switch(_.positionV={relativeFrom:P.relativeFrom,posOffset:y-this._liquid.y-f},P.relativeFrom){case i.ObjectRelativeFromV.PAGE:{_.positionV.posOffset=y-this._liquid.y-f-G.marginTop;break}case i.ObjectRelativeFromV.LINE:{_.positionV.posOffset=y-this._liquid.y-f-R.top;break}case i.ObjectRelativeFromV.PARAGRAPH:{_.positionV.posOffset=y-this._liquid.y-f-q.top;break}}if(U==null)return;const ee=r==null?void 0:r.findPositionByGlyph(U,N),_e=this._getDocObject();if(ee==null||r==null||_e==null||ct(ee))return;const fe={...ee,isBack:z},ye=_e.document.getOffsetConfig(),te=new W.NodePositionConvertToCursor(ye,r),{cursorList:Z}=te.getRangePointData(fe,fe),{startOffset:Q}=(we=W.getOneTextSelectionRange(Z))!=null?we:{};if(Q!=null)return{offset:Q,docTransform:_,segmentId:$,segmentPage:N}}_updateDrawingSize(e,t){const n=[],{drawing:r,width:s,height:a,angle:d}=e,{unitId:g,subUnitId:c}=r;let{width:l,height:p,angle:u}=t;const{width:m,height:h}=this._getPageContentSize(r);l=Math.min(m,l),p=Math.min(h,p),(l!==s||p!==a)&&n.push({drawingId:r.drawingId,key:"size",value:{width:l,height:p}}),u!==d&&n.push({drawingId:r.drawingId,key:"angle",value:u}),n.length>0&&g&&c&&this._commandService.executeCommand(Ce.id,{unitId:g,subUnitId:c,drawings:n})}_moveInlineDrawing(e,t,n){const r=this._getInlineDrawingAnchor(e,t,n),{offset:s,segmentId:a,segmentPage:d}=r!=null?r:{};return this._commandService.executeCommand(pt.id,{unitId:e.unitId,subUnitId:e.unitId,drawing:e,offset:s,segmentId:a,segmentPage:d,needRefreshDrawings:s==null})}_limitDrawingInPage(e,t){const n=this._renderManagerService.getRenderById(e.unitId),{left:r,top:s,width:a,height:d,angle:g}=t,c=n==null?void 0:n.with(B.DocSkeletonManagerService).getSkeleton(),l=c==null?void 0:c.getSkeletonData(),{pages:p}=l!=null?l:{};if(l==null||n==null||p==null)return{left:r,top:s,width:a,height:d,angle:g};const{mainComponent:u}=n,m=u,{top:h,pageLayoutType:v,pageMarginLeft:I,pageMarginTop:f}=m;let T=s;this._liquid.reset();for(const y of p){const{marginBottom:O,pageHeight:C}=y,b=p.indexOf(y),P=p[b+1];if(P==null)continue;if(i.Tools.hasIntersectionBetweenTwoRanges(s,s+d,this._liquid.y+h+C-O,this._liquid.y+h+C+f+P.marginTop)){const E=s+d/2,w=this._liquid.y+h+C+f/2;E<w?T=Math.min(s,this._liquid.y+h+C-O-d):T=Math.max(s,this._liquid.y+h+C+f+P.marginTop)}this._liquid.translatePage(y,v,I,f)}return{left:r,top:T,width:a,height:d,angle:g}}_nonInlineDrawingTransform(e,t,n=!1){const r=e.isMultiTransform===i.BooleanNumber.TRUE?t:this._limitDrawingInPage(e,t);if(n&&r.top!==t.top)return;const s=this._getDrawingAnchor(e,r),{offset:a,docTransform:d,segmentId:g,segmentPage:c}=s!=null?s:{};return a==null||d==null?this._updateMultipleDrawingDocTransform(new Map([[e.drawingId,t]])):this._commandService.executeCommand(ht.id,{unitId:e.unitId,subUnitId:e.unitId,drawing:e,offset:a,docTransform:d,segmentId:g,segmentPage:c})}_getSceneAndTransformerByDrawingSearch(e){if(e==null)return;const t=this._renderManagerService.getRenderById(e),n=t==null?void 0:t.scene;if(n==null)return;const r=n.getTransformerByCreate();return{scene:n,transformer:r}}_getTransformCoordForDocumentOffset(e,t,n,r){const{documentTransform:s}=e.getOffsetConfig(),a=t.transformVector2SceneCoord(j.Vector2.FromArray([n,r]));if(a)return s.clone().invert().applyPoint(a)}_createOrUpdateInlineAnchor(e,t){const n=this._renderManagerService.getRenderById(e);if(n==null)return;const{mainComponent:r,scene:s}=n,a=r,{docsLeft:d,docsTop:g}=a.getOffsetConfig(),c=W.getAnchorBounding(t),{left:l,top:p,height:u}=c,m=l+d,h=p+g;if(this._anchorShape){this._anchorShape.transformByState({left:m,top:h,height:u}),this._anchorShape.show();return}const v=6,I=new j.Rect(en+i.generateRandomId(v),{left:m,top:h,height:u,strokeWidth:2,stroke:j.getColor(i.COLORS.darkGray,1),evented:!1});this._anchorShape=I,s.addObject(I,W.TEXT_RANGE_LAYER_INDEX)}_getDocObject(){return W.getDocObject(this._univerInstanceService,this._renderManagerService)}_getPageContentSize(e){const t=this._renderManagerService.getRenderById(e.unitId),n=t==null?void 0:t.with(B.DocSkeletonManagerService).getSkeleton(),r=500,s=500,a=n==null?void 0:n.getSkeletonData();if(a==null||t==null)return{width:r,height:s};const{pages:d}=a;let g=null;for(const c of d){const{skeDrawings:l}=c;if(l.has(e.drawingId)){g=c;break}}if(g){const{pageWidth:c,pageHeight:l,marginLeft:p,marginBottom:u,marginRight:m,marginTop:h}=g;return{width:Math.max(r,c-p-m),height:Math.max(s,l-h-u)}}else return{width:r,height:s}}};Be=Qt([Ne(0,i.ICommandService),Ne(1,i.IUniverInstanceService),Ne(2,V.IDrawingManagerService),Ne(3,j.IRenderManagerService)],Be);var tn=Object.getOwnPropertyDescriptor,nn=(o,e,t,n)=>{for(var r=n>1?void 0:n?tn(e,t):e,s=o.length-1,a;s>=0;s--)(a=o[s])&&(r=a(r)||r);return r},Re=(o,e)=>(t,n)=>e(t,n,o);let ke=class extends i.RxDisposable{constructor(e,t,n,r,s){super();ce(this,"_initImagePopupMenu",new Set);ce(this,"_disposePopups",[]);this._drawingManagerService=e,this._canvasPopManagerService=t,this._renderManagerService=n,this._univerInstanceService=r,this._contextService=s,this._init()}_init(){this.disposeWithMe(this._univerInstanceService.getCurrentTypeOfUnit$(i.UniverInstanceType.UNIVER_DOC).pipe(J.takeUntil(this.dispose$)).subscribe(e=>this._create(e))),this.disposeWithMe(this._univerInstanceService.getTypeOfUnitDisposed$(i.UniverInstanceType.UNIVER_DOC).pipe(J.takeUntil(this.dispose$)).subscribe(e=>this._dispose(e))),this._univerInstanceService.getAllUnitsForType(i.UniverInstanceType.UNIVER_DOC).forEach(e=>this._create(e))}_dispose(e){const t=e.getUnitId();this._disposePopups.length&&(this._disposePopups.forEach(n=>n.dispose()),this._disposePopups.length=0),this._renderManagerService.removeRender(t)}_create(e){if(!e)return;const t=e.getUnitId();this._renderManagerService.has(t)&&!this._initImagePopupMenu.has(t)&&(this._popupMenuListener(t),this._initImagePopupMenu.add(t))}_hasCropObject(e){const t=e.getAllObjects();for(const n of t)if(n instanceof he.ImageCropperObject)return!0;return!1}_popupMenuListener(e){var s;const t=(s=this._renderManagerService.getRenderById(e))==null?void 0:s.scene;if(!t)return;const n=t.getTransformerByCreate();if(!n)return;const r=this._disposePopups;this.disposeWithMe(n.createControl$.subscribe(()=>{if(this._hasCropObject(t))return;const a=n.getSelectedObjectMap();if(r.forEach(f=>f.dispose()),r.length=0,a.size>1)return;const d=a.values().next().value;if(!d)return;const g=d.oKey,c=this._drawingManagerService.getDrawingOKey(g);if(!c||c.drawingType===i.DrawingTypeEnum.DRAWING_DOM)return;const{unitId:l,subUnitId:p,drawingId:u,drawingType:m}=c,h=this._canvasPopManagerService.attachPopupToObject(d,{componentKey:he.COMPONENT_IMAGE_POPUP_MENU,direction:"horizontal",offset:[2,0],extraProps:{menuItems:this._getImageMenuItems(l,p,u,m)}},l);r.push(this.disposeWithMe(h)),!this._drawingManagerService.getFocusDrawings().find(f=>f.unitId===l&&f.subUnitId===p&&f.drawingId===u)&&this._drawingManagerService.focusDrawing([{unitId:l,subUnitId:p,drawingId:u}])})),this.disposeWithMe(n.clearControl$.subscribe(()=>{r.forEach(a=>a.dispose()),r.length=0,this._contextService.setContextValue(i.FOCUSING_COMMON_DRAWINGS,!1),this._drawingManagerService.focusDrawing(null)})),this.disposeWithMe(n.changing$.subscribe(()=>{r.forEach(a=>a.dispose()),r.length=0})),this.disposeWithMe(n.changeStart$.subscribe(()=>{r.forEach(a=>a.dispose()),r.length=0}))}_getImageMenuItems(e,t,n,r){return[{label:"image-popup.edit",index:0,commandId:tt.id,commandParams:{unitId:e,subUnitId:t,drawingId:n},disable:!0},{label:"image-popup.delete",index:1,commandId:We.id,commandParams:{unitId:e,drawings:[{unitId:e,subUnitId:t,drawingId:n}]},disable:!1},{label:"image-popup.crop",index:2,commandId:he.OpenImageCropOperation.id,commandParams:{unitId:e,subUnitId:t,drawingId:n},disable:!0},{label:"image-popup.reset",index:3,commandId:he.ImageResetSizeOperation.id,commandParams:[{unitId:e,subUnitId:t,drawingId:n}],disable:!0}]}};ke=nn([Re(0,V.IDrawingManagerService),Re(1,i.Inject(W.DocCanvasPopManagerService)),Re(2,j.IRenderManagerService),Re(3,i.IUniverInstanceService),Re(4,i.IContextService)],ke);var rn=Object.getOwnPropertyDescriptor,on=(o,e,t,n)=>{for(var r=n>1?void 0:n?rn(e,t):e,s=o.length-1,a;s>=0;s--)(a=o[s])&&(r=a(r)||r);return r},Se=(o,e)=>(t,n)=>e(t,n,o);let qe=class extends i.Disposable{constructor(e,t,n,r,s,a,d,g){super();ce(this,"_liquid",new j.Liquid);this._context=e,this._docSkeletonManagerService=t,this._commandService=n,this._editorService=r,this._drawingManagerService=s,this._docRefreshDrawingsService=a,this._univerInstanceService=d,this._lifecycleService=g,this._initialize(),this._commandExecutedListener()}_initialize(){this._initialRenderRefresh(),this._drawingInitializeListener(),this._initResize()}_initialRenderRefresh(){this.disposeWithMe(this._docSkeletonManagerService.currentSkeleton$.subscribe(e=>{e!=null&&this._refreshDrawing(e)})),this.disposeWithMe(this._docRefreshDrawingsService.refreshDrawings$.subscribe(e=>{e!=null&&this._refreshDrawing(e)}))}_commandExecutedListener(){const e=[B.RichTextEditingMutation.id,W.SetDocZoomRatioOperation.id];this.disposeWithMe(this._commandService.onCommandExecuted(t=>{if(e.includes(t.id)){const n=t.params,{unitId:r}=n,{unitId:s,mainComponent:a}=this._context;if(r!==s)return;const d=this._docSkeletonManagerService.getSkeleton();if(d==null)return;if(this._editorService.isEditor(s)&&s!==i.DOCS_ZEN_EDITOR_UNIT_ID_KEY){a==null||a.makeDirty();return}this._refreshDrawing(d)}}))}_initResize(){this.disposeWithMe(i.fromEventSubject(this._context.engine.onTransformChange$).pipe(J.filter(e=>e.type===j.TRANSFORM_CHANGE_OBSERVABLE_TYPE.resize),J.debounceTime(16)).subscribe(()=>{var n;const e=this._docSkeletonManagerService.getSkeleton(),{scene:t}=this._context;(n=t.getTransformer())==null||n.refreshControls(),this._refreshDrawing(e)}))}_refreshDrawing(e){var T,y;const t=e==null?void 0:e.getSkeletonData(),{mainComponent:n,unitId:r}=this._context,s=n;if(!t)return;const{left:a,top:d,pageLayoutType:g,pageMarginLeft:c,pageMarginTop:l}=s,{pages:p,skeHeaders:u,skeFooters:m}=t,h={};this._liquid.reset();for(let O=0,C=p.length;O<C;O++){const b=p[O],{headerId:P,footerId:k,pageWidth:E}=b;if(P){const w=(T=u.get(P))==null?void 0:T.get(E);w&&this._calculateDrawingPosition(r,w,a,d,h,w.marginTop,b.marginLeft)}if(k){const w=(y=m.get(k))==null?void 0:y.get(E);w&&this._calculateDrawingPosition(r,w,a,d,h,b.pageHeight-b.marginBottom+w.marginTop,b.marginLeft)}this._calculateDrawingPosition(r,b,a,d,h,b.marginTop,b.marginLeft),this._liquid.translatePage(b,g,c,l)}const v=Object.values(h),I=v.filter(O=>!O.isMultiTransform),f=v.filter(O=>O.isMultiTransform);I.length>0&&this._drawingManagerService.refreshTransform(I),this._handleMultiDrawingsTransform(f)}_handleMultiDrawingsTransform(e){const{scene:t,unitId:n}=this._context,r=t.getTransformerByCreate();e.forEach(g=>{const c=this._drawingManagerService.getDrawingByParam(g);c!=null&&(c.transform=g.transform,c.transforms=g.transforms,c.isMultiTransform=g.isMultiTransform)});const a=[...r.getSelectedObjectMap().keys()],d=Object.values(this._drawingManagerService.getDrawingData(n,n)).filter(g=>g.isMultiTransform===i.BooleanNumber.TRUE);this._drawingManagerService.removeNotification(d),e.length>0&&this._drawingManagerService.addNotification(e);for(const g of a){const c=t.getObject(g);c&&r.setSelectedControl(c)}}_calculateDrawingPosition(e,t,n,r,s,a,d){const{skeDrawings:g}=t;this._liquid.translatePagePadding({marginTop:a,marginLeft:d}),g.forEach(c=>{const{aLeft:l,aTop:p,height:u,width:m,angle:h,drawingId:v,drawingOrigin:I}=c,f=I.layoutType===i.PositionedObjectLayoutType.WRAP_NONE&&I.behindDoc===i.BooleanNumber.TRUE,{isMultiTransform:T=i.BooleanNumber.FALSE}=I,y={left:l+n+this._liquid.x,top:p+r+this._liquid.y,width:m,height:u,angle:h};s[v]==null?s[v]={unitId:e,subUnitId:e,drawingId:v,behindText:f,transform:y,transforms:[y],isMultiTransform:T}:T===i.BooleanNumber.TRUE&&s[v].transforms.push(y)}),this._liquid.restorePagePadding({marginTop:a,marginLeft:d})}_drawingInitializeListener(){const e=()=>{const t=this._docSkeletonManagerService.getSkeleton();t!=null&&(this._refreshDrawing(t),this._drawingManagerService.initializeNotification(this._context.unitId))};this._lifecycleService.stage>=i.LifecycleStages.Rendered?this._docSkeletonManagerService.getSkeleton()?e():setTimeout(e,500):this.disposeWithMe(this._lifecycleService.lifecycle$.pipe(J.filter(t=>t===i.LifecycleStages.Rendered)).subscribe(e))}};qe=on([Se(1,i.Inject(B.DocSkeletonManagerService)),Se(2,i.ICommandService),Se(3,W.IEditorService),Se(4,V.IDrawingManagerService),Se(5,i.Inject(Ge)),Se(6,i.IUniverInstanceService),Se(7,i.Inject(i.LifecycleService))],qe);var sn=Object.defineProperty,an=Object.getOwnPropertyDescriptor,cn=(o,e,t)=>e in o?sn(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,dn=(o,e,t,n)=>{for(var r=n>1?void 0:n?an(e,t):e,s=o.length-1,a;s>=0;s--)(a=o[s])&&(r=a(r)||r);return r},ze=(o,e)=>(t,n)=>e(t,n,o),wt=(o,e,t)=>cn(o,typeof e!="symbol"?e+"":e,t);const gn="DOC_DRAWING_UI_PLUGIN";exports.UniverDocsDrawingUIPlugin=class extends i.Plugin{constructor(e=ot,t,n,r){super(),this._config=e,this._injector=t,this._renderManagerSrv=n,this._configService=r;const{...s}=i.merge({},ot,this._config);this._configService.setConfig(xt,s)}onStarting(){[[Ue],[ke],[Be],[Fe],[Ge],[exports.DocFloatDomController],[Le]].forEach(t=>this._injector.add(t))}onReady(){[[je],[qe]].forEach(e=>this._renderManagerSrv.registerRenderModule(i.UniverInstanceType.UNIVER_DOC,e)),this._injector.get(Fe),this._injector.get(Ue),this._injector.get(Be),this._injector.get(Le)}onRendered(){this._injector.get(ke),this._injector.get(exports.DocFloatDomController)}};wt(exports.UniverDocsDrawingUIPlugin,"type",i.UniverInstanceType.UNIVER_DOC);wt(exports.UniverDocsDrawingUIPlugin,"pluginName",gn);exports.UniverDocsDrawingUIPlugin=dn([i.DependentOn(he.UniverDrawingUIPlugin,V.UniverDrawingPlugin,me.UniverDocsDrawingPlugin,L.UniverUIPlugin),ze(1,i.Inject(i.Injector)),ze(2,j.IRenderManagerService),ze(3,i.IConfigService)],exports.UniverDocsDrawingUIPlugin);exports.ClearDocDrawingTransformerOperation=mt;exports.DOCS_IMAGE_MENU_ID=nt;exports.DeleteDocDrawingsCommand=Ke;exports.EditDocDrawingOperation=tt;exports.GroupDocDrawingCommand=Ye;exports.InsertDocDrawingCommand=He;exports.InsertDocImageCommand=Qe;exports.MoveDocDrawingsCommand=Te;exports.RemoveDocDrawingCommand=We;exports.SetDocDrawingArrangeCommand=Je;exports.SidebarDocDrawingOperation=et;exports.UngroupDocDrawingCommand=Ze;

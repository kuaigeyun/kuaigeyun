(function(E,i){typeof exports=="object"&&typeof module<"u"?i(exports,require("@univerjs/core"),require("@univerjs/docs-drawing"),require("@univerjs/docs"),require("@univerjs/docs-ui"),require("@univerjs/engine-render"),require("@univerjs/design"),require("@univerjs/drawing"),require("@univerjs/ui"),require("rxjs"),require("@univerjs/drawing-ui"),require("react/jsx-runtime"),require("react")):typeof define=="function"&&define.amd?define(["exports","@univerjs/core","@univerjs/docs-drawing","@univerjs/docs","@univerjs/docs-ui","@univerjs/engine-render","@univerjs/design","@univerjs/drawing","@univerjs/ui","rxjs","@univerjs/drawing-ui","react/jsx-runtime","react"],i):(E=typeof globalThis<"u"?globalThis:E||self,i(E.UniverDocsDrawingUi={},E.UniverCore,E.UniverDocsDrawing,E.UniverDocs,E.UniverDocsUi,E.UniverEngineRender,E.UniverDesign,E.UniverDrawing,E.UniverUi,E.rxjs,E.UniverDrawingUi,E.React,E.React))})(this,(function(E,i,Q,k,W,L,$,X,B,Z,he,S,Y){"use strict";var ln=Object.defineProperty;var gn=(E,i,Q)=>i in E?ln(E,i,{enumerable:!0,configurable:!0,writable:!0,value:Q}):E[i]=Q;var le=(E,i,Q)=>gn(E,typeof i!="symbol"?i+"":i,Q);const Re={id:"doc.command.remove-doc-image",type:i.CommandType.COMMAND,handler:(s,e)=>{var P,b,N,H;const t=s.get(i.ICommandService),n=s.get(i.IUniverInstanceService),r=s.get(L.IRenderManagerService),o=n.getCurrentUniverDocInstance();if(e==null||o==null)return!1;const a=r.getRenderById(e.unitId).with(W.DocSelectionRenderService),{drawings:d}=e,l=(P=a.getSegment())!=null?P:"",c=new i.TextX,g=i.JSONX.getInstance(),h=(N=(b=o.getSelfOrHeaderFooterModel(l).getBody())==null?void 0:b.customBlocks)!=null?N:[],u=d.map(R=>h.find(w=>w.blockId===R.drawingId)).filter(R=>!!R).sort((R,w)=>R.startIndex>w.startIndex?1:-1),f=d[0].unitId,p=new i.MemoryCursor;p.reset();const v=u[0].startIndex,I=[{startOffset:v,endOffset:v}],m={id:k.RichTextEditingMutation.id,params:{unitId:f,actions:[],textRanges:I}},T=[];for(const R of u){const{startIndex:w}=R;w>p.cursor&&c.push({t:i.TextXActionType.RETAIN,len:w-p.cursor}),c.push({t:i.TextXActionType.DELETE,len:1}),p.moveCursorTo(w+1)}const y=W.getRichTextEditPath(o,l);T.push(g.editOp(c.serialize(),y));for(const R of u){const{blockId:w}=R,U=((H=o.getDrawings())!=null?H:{})[w],F=o.getDrawingsOrder().indexOf(w),q=g.removeOp(["drawings",w],U),_=g.removeOp(["drawingsOrder",F],w);T.push(q),T.push(_)}return m.params.actions=T.reduce((R,w)=>i.JSONX.compose(R,w),null),!!t.syncExecuteCommand(m.id,m.params)}},Xe={id:"doc.command.delete-drawing",type:i.CommandType.COMMAND,handler:s=>{const e=s.get(i.ICommandService),n=s.get(Q.IDocDrawingService).getFocusDrawings();if(n.length===0)return!1;const{unitId:r}=n[0],o=n.map(a=>{const{unitId:d,subUnitId:l,drawingId:c,drawingType:g}=a;return{unitId:d,subUnitId:l,drawingId:c,drawingType:g}});return e.executeCommand(Re.id,{unitId:r,drawings:o})}},$e={id:"doc.command.group-doc-image",type:i.CommandType.COMMAND,handler:(s,e)=>{s.get(i.ICommandService),s.get(i.IUndoRedoService);const t=s.get(Q.IDocDrawingService);if(!e)return!1;const n=[];e.forEach(({parent:g,children:h})=>{n.push(g.unitId),h.forEach(u=>{n.push(u.unitId)})});const r=t.getGroupDrawingOp(e),{unitId:o,subUnitId:a,undo:d,redo:l,objects:c}=r;return!1}},Ne={id:"doc.command.insert-doc-image",type:i.CommandType.COMMAND,handler:(s,e)=>{var b,N,H,R;if(e==null)return!1;const t=s.get(i.ICommandService),n=s.get(k.DocSelectionManagerService),r=s.get(i.IUniverInstanceService),o=n.getActiveTextRange(),a=r.getCurrentUniverDocInstance();if(o==null||a==null)return!1;const d=a.getUnitId(),{drawings:l}=e,{collapsed:c,startOffset:g,segmentId:h}=o,u=a.getSelfOrHeaderFooterModel(h).getBody();if(u==null)return!1;const f=new i.TextX,p=i.JSONX.getInstance(),v=[],I=(N=(b=a.getSnapshot().drawingsOrder)==null?void 0:b.length)!=null?N:0;let m=0;if(c)g>0&&f.push({t:i.TextXActionType.RETAIN,len:g});else{const w=i.BuildTextUtils.selection.delete([o],u,0,null,!1);f.push(...w);const U=W.getCustomBlockIdsInSelections(u,[o]),z=(H=a.getDrawings())!=null?H:{},F=(R=a.getDrawingsOrder())!=null?R:[],q=U.sort((_,D)=>F.indexOf(_)>F.indexOf(D)?-1:F.indexOf(_)<F.indexOf(D)?1:0);if(q.length>0)for(const _ of q){const D=z[_],A=F.indexOf(_);if(D==null||A<0)continue;const M=p.removeOp(["drawings",_],D),j=p.removeOp(["drawingsOrder",A],_);v.push(M),v.push(j),m++}}f.push({t:i.TextXActionType.INSERT,body:{dataStream:"\b".repeat(l.length),customBlocks:l.map((w,U)=>({startIndex:U,blockId:w.drawingId}))},len:l.length});const T=W.getRichTextEditPath(a,h),y=p.editOp(f.serialize(),T);v.push(y);for(const w of l){const{drawingId:U}=w,z=p.insertOp(["drawings",U],w),F=p.insertOp(["drawingsOrder",I-m],U);v.push(z),v.push(F)}const O={id:k.RichTextEditingMutation.id,params:{unitId:d,actions:[],textRanges:[]}};return O.params.actions=v.reduce((w,U)=>i.JSONX.compose(w,U),null),!!t.syncExecuteCommand(O.id,O.params)}},ze={id:"doc.command.set-drawing-arrange",type:i.CommandType.COMMAND,handler:(s,e)=>{const t=s.get(i.ICommandService),n=s.get(Q.IDocDrawingService);if(e==null)return!1;const{unitId:r,subUnitId:o,drawingIds:a,arrangeType:d}=e,l={unitId:r,subUnitId:o,drawingIds:a};let c;if(d===i.ArrangeTypeEnum.forward?c=n.getForwardDrawingsOp(l):d===i.ArrangeTypeEnum.backward?c=n.getBackwardDrawingOp(l):d===i.ArrangeTypeEnum.front?c=n.getFrontDrawingsOp(l):d===i.ArrangeTypeEnum.back&&(c=n.getBackDrawingsOp(l)),c==null)return!1;const{redo:g}=c;if(g==null)return!1;const h=[];let u=i.Tools.deepClone(g);u=u.slice(3),u.unshift("drawingsOrder"),h.push(u);const f={id:k.RichTextEditingMutation.id,params:{unitId:r,actions:[],textRanges:null}};return f.params.actions=h.reduce((v,I)=>i.JSONX.compose(v,I),null),!!t.syncExecuteCommand(f.id,f.params)}},qe={id:"doc.command.ungroup-doc-image",type:i.CommandType.COMMAND,handler:(s,e)=>{s.get(i.ICommandService),s.get(i.IUndoRedoService);const t=s.get(Q.IDocDrawingService);if(!e)return!1;const n=[];e.forEach(({parent:g,children:h})=>{n.push(g.unitId),h.forEach(u=>{n.push(u.unitId)})});const r=t.getUngroupDrawingOp(e),{unitId:o,subUnitId:a,undo:d,redo:l,objects:c}=r;return!1}};class xe{constructor(){le(this,"_refreshDrawings$",new Z.BehaviorSubject(null));le(this,"refreshDrawings$",this._refreshDrawings$.asObservable())}refreshDrawings(e){this._refreshDrawings$.next(e)}}var _t=Object.getOwnPropertyDescriptor,Dt=(s,e,t,n)=>{for(var r=n>1?void 0:n?_t(e,t):e,o=s.length-1,a;o>=0;o--)(a=s[o])&&(r=a(r)||r);return r},ne=(s,e)=>(t,n)=>e(t,n,s);let Fe=class extends i.Disposable{constructor(s,e,t,n,r,o,a,d,l,c,g,h,u){super(),this._context=s,this._commandService=e,this._docSelectionManagerService=t,this._renderManagerSrv=n,this._imageIoService=r,this._docDrawingService=o,this._drawingManagerService=a,this._contextService=d,this._messageService=l,this._localeService=c,this._docSelectionRenderService=g,this._docRefreshDrawingsService=h,this._fileOpenerService=u,this._updateOrderListener(),this._groupDrawingListener(),this._focusDrawingListener(),this._transformDrawingListener(),this._editAreaChangeListener()}dispose(){super.dispose(),delete this._context}async insertDocImage(){const s=await this._fileOpenerService.openFile({multiple:!0,accept:X.DRAWING_IMAGE_ALLOW_IMAGE_LIST.map(t=>`.${t.replace("image/","")}`).join(",")}),e=s.length;return e>X.DRAWING_IMAGE_COUNT_LIMIT?(this._messageService.show({type:$.MessageType.Error,content:this._localeService.t("update-status.exceedMaxCount",String(X.DRAWING_IMAGE_COUNT_LIMIT))}),!1):e===0?!1:(await this._insertFloatImages(s),!0)}async _insertFloatImages(s){let e=[];try{e=await Promise.all(s.map(r=>this._imageIoService.saveImage(r)))}catch(r){const o=r.message;let a="";switch(o){case X.ImageUploadStatusType.ERROR_EXCEED_SIZE:a=this._localeService.t("update-status.exceedMaxSize",String(X.DRAWING_IMAGE_ALLOW_SIZE/(1024*1024)));break;case X.ImageUploadStatusType.ERROR_IMAGE_TYPE:a=this._localeService.t("update-status.invalidImageType");break;case X.ImageUploadStatusType.ERROR_IMAGE:a=this._localeService.t("update-status.invalidImage");break}this._messageService.show({type:$.MessageType.Error,content:a})}if(e.length===0)return;const{unitId:t}=this._context,n=[];for(const r of e){if(r==null)continue;const{imageId:o,imageSourceType:a,source:d,base64Cache:l}=r,{width:c,height:g,image:h}=await X.getImageSize(l||"");this._imageIoService.addImageSourceCache(o,a,h);let u=1;if(c>X.DRAWING_IMAGE_WIDTH_LIMIT||g>X.DRAWING_IMAGE_HEIGHT_LIMIT){const I=X.DRAWING_IMAGE_WIDTH_LIMIT/c,m=X.DRAWING_IMAGE_HEIGHT_LIMIT/g;u=Math.min(I,m)}const f=this._getImagePosition(c*u,g*u);if(f==null)return;const p={unitId:t,subUnitId:t,drawingId:o,drawingType:i.DrawingTypeEnum.DRAWING_IMAGE,imageSourceType:a,source:d,transform:W.docDrawingPositionToTransform(f),docTransform:f,behindDoc:i.BooleanNumber.FALSE,title:"",description:"",layoutType:i.PositionedObjectLayoutType.INLINE,wrapText:i.WrapTextType.BOTH_SIDES,distB:0,distL:0,distR:0,distT:0};this._isInsertInHeaderFooter()&&(p.isMultiTransform=i.BooleanNumber.TRUE,p.transforms=p.transform?[p.transform]:null),n.push(p)}this._commandService.executeCommand(Ne.id,{unitId:t,drawings:n})}_isInsertInHeaderFooter(){var n;const{unitId:s}=this._context,e=(n=this._renderManagerSrv.getRenderById(s))==null?void 0:n.with(k.DocSkeletonManagerService).getViewModel(),t=e==null?void 0:e.getEditArea();return t===L.DocumentEditArea.HEADER||t===L.DocumentEditArea.FOOTER}_getImagePosition(s,e){const t=this._docSelectionRenderService.getActiveTextRange(),n=(t==null?void 0:t.getAbsolutePosition())||{left:0};return{size:{width:s,height:e},positionH:{relativeFrom:i.ObjectRelativeFromH.PAGE,posOffset:n.left},positionV:{relativeFrom:i.ObjectRelativeFromV.PARAGRAPH,posOffset:0},angle:0}}_updateOrderListener(){this.disposeWithMe(this._drawingManagerService.featurePluginOrderUpdate$.subscribe(s=>{const{unitId:e,subUnitId:t,drawingIds:n,arrangeType:r}=s;this._commandService.executeCommand(ze.id,{unitId:e,subUnitId:t,drawingIds:n,arrangeType:r})}))}_groupDrawingListener(){this.disposeWithMe(this._drawingManagerService.featurePluginGroupUpdate$.subscribe(s=>{this._commandService.executeCommand($e.id,s)})),this.disposeWithMe(this._drawingManagerService.featurePluginUngroupUpdate$.subscribe(s=>{this._commandService.executeCommand(qe.id,s)}))}_getCurrentSceneAndTransformer(){const{scene:s,mainComponent:e}=this._context;if(s==null||e==null)return;const t=s.getTransformerByCreate(),{docsLeft:n,docsTop:r}=e.getOffsetConfig();return{scene:s,transformer:t,docsLeft:n,docsTop:r}}_transformDrawingListener(){const s=this._getCurrentSceneAndTransformer();if(s&&s.transformer)this.disposeWithMe(s.transformer.changeEnd$.pipe(Z.debounceTime(30)).subscribe(e=>{this._docSelectionManagerService.refreshSelection()}));else throw new Error("transformer is not init")}_focusDrawingListener(){this.disposeWithMe(this._drawingManagerService.focus$.subscribe(s=>{var r;const{transformer:e,docsLeft:t,docsTop:n}=(r=this._getCurrentSceneAndTransformer())!=null?r:{};if(s==null||s.length===0)this._contextService.setContextValue(i.FOCUSING_COMMON_DRAWINGS,!1),this._docDrawingService.focusDrawing([]),e&&e.resetProps({zeroTop:0,zeroLeft:0});else{this._contextService.setContextValue(i.FOCUSING_COMMON_DRAWINGS,!0),this._docDrawingService.focusDrawing(s),this._setDrawingSelections(s);const o=this._docSelectionRenderService.getSegment(),a=this._findSegmentIdByDrawingId(s[0].drawingId);o!==a&&this._docSelectionRenderService.setSegment(a),e&&e.resetProps({zeroTop:n,zeroLeft:t})}}))}_findSegmentIdByDrawingId(s){var a,d,l;const{unit:e}=this._context,{body:t,headers:n={},footers:r={}}=e.getSnapshot();if(((a=t==null?void 0:t.customBlocks)!=null?a:[]).some(c=>c.blockId===s))return"";for(const c of Object.keys(n))if((d=n[c].body.customBlocks)!=null&&d.some(g=>g.blockId===s))return c;for(const c of Object.keys(r))if((l=r[c].body.customBlocks)!=null&&l.some(g=>g.blockId===s))return c;return""}_updateDrawingsEditStatus(){var d;const{unit:s,scene:e,unitId:t}=this._context,n=(d=this._renderManagerSrv.getRenderById(t))==null?void 0:d.with(k.DocSkeletonManagerService).getViewModel();if(n==null||s==null)return;const r=s.getSnapshot(),{drawings:o={}}=r,a=n.getEditArea()===L.DocumentEditArea.BODY;for(const l of Object.keys(o)){const c=o[l],g=X.getDrawingShapeKeyByDrawingSearch({unitId:t,drawingId:c.drawingId,subUnitId:t}),h=e.fuzzyMathObjects(g,!0);if(h.length)for(const u of h){e.detachTransformerFrom(u);try{u.setOpacity(.5)}catch{}if(a&&c.isMultiTransform!==i.BooleanNumber.TRUE||!a&&c.isMultiTransform===i.BooleanNumber.TRUE){c.allowTransform!==!1&&e.attachTransformerTo(u);try{u.setOpacity(1)}catch{}}}}}_editAreaChangeListener(){var t;const{unitId:s}=this._context,e=(t=this._renderManagerSrv.getRenderById(s))==null?void 0:t.with(k.DocSkeletonManagerService).getViewModel();e!=null&&(this._updateDrawingsEditStatus(),this.disposeWithMe(e.editAreaChange$.subscribe(()=>{this._updateDrawingsEditStatus()})),this.disposeWithMe(this._docRefreshDrawingsService.refreshDrawings$.subscribe(n=>{n!=null&&queueMicrotask(()=>{this._updateDrawingsEditStatus()})})),this.disposeWithMe(this._commandService.onCommandExecuted(async n=>{n.id===k.RichTextEditingMutation.id&&queueMicrotask(()=>{this._updateDrawingsEditStatus()})})))}_setDrawingSelections(s){var r,o;const{unit:e}=this._context,t=(o=(r=e.getSnapshot().body)==null?void 0:r.customBlocks)!=null?o:[],n=s.map(a=>{const d=a.drawingId,l=t.find(c=>c.blockId===d);return l?l.startIndex:null}).filter(a=>a!==null).map(a=>({startOffset:a,endOffset:a+1}));this._docSelectionManagerService.replaceDocRanges(n)}};Fe=Dt([ne(1,i.ICommandService),ne(2,i.Inject(k.DocSelectionManagerService)),ne(3,L.IRenderManagerService),ne(4,X.IImageIoService),ne(5,Q.IDocDrawingService),ne(6,X.IDrawingManagerService),ne(7,i.IContextService),ne(8,B.IMessageService),ne(9,i.Inject(i.LocaleService)),ne(10,i.Inject(W.DocSelectionRenderService)),ne(11,i.Inject(xe)),ne(12,B.ILocalFileService)],Fe);const Ke={id:"doc.command.insert-float-image",type:i.CommandType.COMMAND,handler:s=>{var n,r;const e=s.get(i.IUniverInstanceService),t=s.get(L.IRenderManagerService);return(r=(n=L.getCurrentTypeOfRenderer(i.UniverInstanceType.UNIVER_DOC,e,t))==null?void 0:n.with(Fe).insertDocImage())!=null?r:!1}};var ie=(s=>(s.INLINE="inline",s.BEHIND_TEXT="behindText",s.IN_FRONT_OF_TEXT="inFrontOfText",s.WRAP_SQUARE="wrapSquare",s.WRAP_TOP_AND_BOTTOM="wrapTopAndBottom",s))(ie||{});const Tt={inline:i.PositionedObjectLayoutType.INLINE,wrapSquare:i.PositionedObjectLayoutType.WRAP_SQUARE,wrapTopAndBottom:i.PositionedObjectLayoutType.WRAP_TOP_AND_BOTTOM,inFrontOfText:i.PositionedObjectLayoutType.WRAP_NONE,behindText:i.PositionedObjectLayoutType.WRAP_NONE};function rt(s,e,t,n,r,o,a){var f,p;const d=new i.TextX,l=i.JSONX.getInstance(),c=[],g=o.getSelfOrHeaderFooterModel(e).getBody(),h=o.getSelfOrHeaderFooterModel(s).getBody();if(g==null||h==null)return;const u=(p=(f=g.customBlocks)==null?void 0:f.find(v=>v.blockId===r))==null?void 0:p.startIndex;if(u!=null){if(n=Math.min(h.dataStream.length-2,n),s===e){if(n<u?(n>0&&d.push({t:i.TextXActionType.RETAIN,len:n}),d.push({t:i.TextXActionType.INSERT,body:{dataStream:"\b",customBlocks:[{startIndex:0,blockId:r}]},len:1}),d.push({t:i.TextXActionType.RETAIN,len:u-n}),d.push({t:i.TextXActionType.DELETE,len:1})):(u>0&&d.push({t:i.TextXActionType.RETAIN,len:u}),d.push({t:i.TextXActionType.DELETE,len:1}),n-u-1>0&&d.push({t:i.TextXActionType.RETAIN,len:n-u-1}),d.push({t:i.TextXActionType.INSERT,body:{dataStream:"\b",customBlocks:[{startIndex:0,blockId:r}]},len:1})),n!==u){const v=W.getRichTextEditPath(o,e),I=l.editOp(d.serialize(),v);c.push(I)}}else{u>0&&d.push({t:i.TextXActionType.RETAIN,len:u}),d.push({t:i.TextXActionType.DELETE,len:1});let v=W.getRichTextEditPath(o,e),I=l.editOp(d.serialize(),v);c.push(I),d.empty(),n>0&&d.push({t:i.TextXActionType.RETAIN,len:n}),d.push({t:i.TextXActionType.INSERT,body:{dataStream:"\b",customBlocks:[{startIndex:0,blockId:r}]},len:1}),v=W.getRichTextEditPath(o,s),I=l.editOp(d.serialize(),v),c.push(I),a.setSegment(s),a.setSegmentPage(t)}return c}}const st={id:"doc.command.update-doc-drawing-wrapping-style",type:i.CommandType.COMMAND,handler:(s,e)=>{var N,H;if(e==null)return!1;const{drawings:t,wrappingStyle:n,unitId:r}=e,o=s.get(i.ICommandService),a=s.get(i.IUniverInstanceService),l=s.get(L.IRenderManagerService).getRenderById(r),c=l==null?void 0:l.with(k.DocSkeletonManagerService).getSkeleton().getSkeletonData(),g=l==null?void 0:l.with(k.DocSkeletonManagerService).getViewModel(),h=l==null?void 0:l.scene,u=a.getCurrentUniverDocInstance();if(u==null||c==null||h==null||g==null)return!1;const f=g.getEditArea(),p=h.getTransformerByCreate(),{pages:v,skeHeaders:I,skeFooters:m}=c,T=i.JSONX.getInstance(),y=[],{drawings:O={}}=u.getSnapshot();for(const R of t){const{drawingId:w}=R,U=O[w].layoutType,z=Tt[n];if(U!==z){const D=T.replaceOp(["drawings",w,"layoutType"],U,z);y.push(D)}if(n==="behindText"||n==="inFrontOfText"){const D=O[w].behindDoc,A=n==="behindText"?i.BooleanNumber.TRUE:i.BooleanNumber.FALSE;if(D!==A){const M=T.replaceOp(["drawings",w,"behindDoc"],D,A);y.push(M)}}if(n==="inline")continue;let F=null,q=0,_=0;for(const D of v){const{headerId:A,footerId:M,marginTop:j,marginLeft:G,marginBottom:C,pageWidth:x,pageHeight:K}=D;switch(f){case L.DocumentEditArea.HEADER:{const V=(N=I.get(A))==null?void 0:N.get(x);V!=null&&V.skeDrawings.has(w)&&(F=V.skeDrawings.get(w),q=V.marginTop,_=G);break}case L.DocumentEditArea.FOOTER:{const V=(H=m.get(M))==null?void 0:H.get(x);V!=null&&V.skeDrawings.has(w)&&(F=V.skeDrawings.get(w),q=K-C+V.marginTop,_=G);break}case L.DocumentEditArea.BODY:{D.skeDrawings.has(w)&&(F=D.skeDrawings.get(w),q=j,_=G);break}}if(F!=null)break}if(F!=null){const{aTop:D,aLeft:A}=F,M=O[w].docTransform.positionH;let j=A;M.relativeFrom===i.ObjectRelativeFromH.MARGIN?j-=_:M.relativeFrom===i.ObjectRelativeFromH.COLUMN&&(j-=F.columnLeft);const G={relativeFrom:M.relativeFrom,posOffset:j};if(M.posOffset!==G.posOffset){const V=T.replaceOp(["drawings",w,"docTransform","positionH"],M,G);y.push(V)}const C=O[w].docTransform.positionV;let x=D;C.relativeFrom===i.ObjectRelativeFromV.PAGE?x+=q:C.relativeFrom===i.ObjectRelativeFromV.LINE?x-=F.lineTop:C.relativeFrom===i.ObjectRelativeFromV.PARAGRAPH&&(x-=F.blockAnchorTop);const K={relativeFrom:C.relativeFrom,posOffset:x};if(C.posOffset!==K.posOffset){const V=T.replaceOp(["drawings",w,"docTransform","positionV"],C,K);y.push(V)}}}const P={id:k.RichTextEditingMutation.id,params:{unitId:r,actions:[],textRanges:null}};P.params.actions=y.reduce((R,w)=>i.JSONX.compose(R,w),null);const b=o.syncExecuteCommand(P.id,P.params);return p.refreshControls(),!!b}},ot={id:"doc.command.update-doc-drawing-distance",type:i.CommandType.COMMAND,handler:(s,e)=>{if(e==null)return!1;const t=s.get(i.ICommandService),r=s.get(i.IUniverInstanceService).getCurrentUniverDocInstance();if(r==null)return!1;const{drawings:o,dist:a,unitId:d}=e,l=i.JSONX.getInstance(),c=[],{drawings:g={}}=r.getSnapshot();for(const f of o){const{drawingId:p}=f;for(const[v,I]of Object.entries(a)){const m=g[p][v];if(m!==I){const T=l.replaceOp(["drawings",p,v],m,I);c.push(T)}}}const h={id:k.RichTextEditingMutation.id,params:{unitId:d,actions:[],textRanges:null}};return h.params.actions=c.reduce((f,p)=>i.JSONX.compose(f,p),null),!!t.syncExecuteCommand(h.id,h.params)}},at={id:"doc.command.update-doc-drawing-wrap-text",type:i.CommandType.COMMAND,handler:(s,e)=>{if(e==null)return!1;const t=s.get(i.ICommandService),r=s.get(i.IUniverInstanceService).getCurrentUniverDocInstance();if(r==null)return!1;const{drawings:o,wrapText:a,unitId:d}=e,l=i.JSONX.getInstance(),c=[],{drawings:g={}}=r.getSnapshot();for(const f of o){const{drawingId:p}=f,v=g[p].wrapText;if(v!==a){const I=l.replaceOp(["drawings",p,"wrapText"],v,a);c.push(I)}}const h={id:k.RichTextEditingMutation.id,params:{unitId:d,actions:[],textRanges:null}};return h.params.actions=c.reduce((f,p)=>i.JSONX.compose(f,p),null),!!t.syncExecuteCommand(h.id,h.params)}},Oe={id:"doc.command.update-drawing-doc-transform",type:i.CommandType.COMMAND,handler:(s,e)=>{if(e==null)return!1;const t=s.get(i.ICommandService),n=s.get(i.IUniverInstanceService),o=s.get(L.IRenderManagerService).getRenderById(e.unitId),a=o==null?void 0:o.scene;if(a==null)return!1;const d=a.getTransformerByCreate(),l=n.getCurrentUniverDocInstance();if(l==null)return!1;const{drawings:c,unitId:g}=e,h=i.JSONX.getInstance(),u=[],{drawings:f={}}=l.getSnapshot();for(const I of c){const{drawingId:m,key:T,value:y}=I,O=f[m].docTransform[T];if(!i.Tools.diffValue(O,y)){const P=h.replaceOp(["drawings",m,"docTransform",T],O,y);u.push(P)}}const p={id:k.RichTextEditingMutation.id,params:{unitId:g,actions:[],textRanges:null,debounce:!0}};p.params.actions=u.reduce((I,m)=>i.JSONX.compose(I,m),null);const v=t.syncExecuteCommand(p.id,p.params);return d.refreshControls(),!!v}},ct={id:"doc.command.move-inline-drawing",type:i.CommandType.COMMAND,handler:(s,e)=>{var H,R;if(e==null)return!1;const t=s.get(L.IRenderManagerService),n=(H=t.getRenderById(e.unitId))==null?void 0:H.with(W.DocSelectionRenderService),r=s.get(xe),o=t.getRenderById(e.unitId),a=o==null?void 0:o.scene,d=o==null?void 0:o.with(k.DocSkeletonManagerService).getSkeleton();if(a==null||n==null)return!1;const l=a.getTransformerByCreate(),c=s.get(i.ICommandService),h=s.get(i.IUniverInstanceService).getCurrentUniverDocInstance();if(h==null)return!1;const{drawing:u,unitId:f,offset:p,segmentId:v,segmentPage:I,needRefreshDrawings:m}=e;if(m)return r.refreshDrawings(d),l.refreshControls(),!0;const T=[],{drawingId:y}=u,O=(R=n.getSegment())!=null?R:"",P=rt(v,O,I,p,y,h,n);if(P==null||P.length===0)return r.refreshDrawings(d),l.refreshControls(),!1;T.push(...P);const b={id:k.RichTextEditingMutation.id,params:{unitId:f,actions:[],textRanges:null}};b.params.actions=T.reduce((w,U)=>i.JSONX.compose(w,U),null);const N=c.syncExecuteCommand(b.id,b.params);return l.refreshControls(),!!N}},dt={id:"doc.command.transform-non-inline-drawing",type:i.CommandType.COMMAND,handler:(s,e)=>{var F,q;if(e==null)return!1;const t=s.get(L.IRenderManagerService),n=(F=t.getRenderById(e.unitId))==null?void 0:F.with(W.DocSelectionRenderService),r=t.getRenderById(e.unitId),o=r==null?void 0:r.scene;if(o==null||n==null)return!1;const a=o.getTransformerByCreate(),d=s.get(i.ICommandService),c=s.get(i.IUniverInstanceService).getCurrentUniverDocInstance();if(c==null)return!1;const{drawing:g,unitId:h,offset:u,docTransform:f,segmentId:p,segmentPage:v}=e,I=[],{drawingId:m}=g,T=(q=n.getSegment())!=null?q:"",y=rt(p,T,v,u,m,c,n);if(y==null)return!1;y.length>0&&I.push(...y);const O=i.JSONX.getInstance(),{drawings:P={}}=c.getSnapshot(),b=P[m].docTransform,{positionH:N,positionV:H,size:R,angle:w}=b;if(!i.Tools.diffValue(N,f.positionH)){const _=O.replaceOp(["drawings",m,"docTransform","positionH"],N,f.positionH);I.push(_)}if(!i.Tools.diffValue(H,f.positionV)){const _=O.replaceOp(["drawings",m,"docTransform","positionV"],H,f.positionV);I.push(_)}if(!i.Tools.diffValue(R,f.size)){const _=O.replaceOp(["drawings",m,"docTransform","size"],R,f.size);I.push(_)}if(!i.Tools.diffValue(w,f.angle)){const _=O.replaceOp(["drawings",m,"docTransform","angle"],w,f.angle);I.push(_)}const U={id:k.RichTextEditingMutation.id,params:{unitId:h,actions:[],textRanges:null,debounce:!0}};U.params.actions=I.reduce((_,D)=>i.JSONX.compose(_,D),null);const z=d.syncExecuteCommand(U.id,U.params);return a.refreshControls(),!!z}},De={id:"doc.command.move-drawing",type:i.CommandType.COMMAND,handler:(s,e)=>{const t=s.get(i.ICommandService),n=s.get(Q.IDocDrawingService),r=s.get(i.IUniverInstanceService),o=s.get(L.IRenderManagerService),{direction:a}=e,d=n.getFocusDrawings();if(d.length===0)return!1;const l=d[0].unitId,c=o.getRenderById(l),g=c==null?void 0:c.scene;if(g==null)return!1;const h=g.getTransformerByCreate(),u=r.getUniverDocInstance(l),f=d.map(v=>{var b,N,H,R,w;const{drawingId:I}=v,m=(b=u==null?void 0:u.getSnapshot().drawings)==null?void 0:b[I];if(m==null||m.layoutType===i.PositionedObjectLayoutType.INLINE)return null;const{positionH:T,positionV:y}=m.docTransform,O={...T},P={...y};return a===i.Direction.UP?P.posOffset=((N=P.posOffset)!=null?N:0)-2:a===i.Direction.DOWN?P.posOffset=((H=P.posOffset)!=null?H:0)+2:a===i.Direction.LEFT?O.posOffset=((R=O.posOffset)!=null?R:0)-2:a===i.Direction.RIGHT&&(O.posOffset=((w=O.posOffset)!=null?w:0)+2),{drawingId:I,key:a===i.Direction.UP||a===i.Direction.DOWN?"positionV":"positionH",value:a===i.Direction.UP||a===i.Direction.DOWN?P:O}}).filter(v=>v!=null);if(f.length===0)return!1;const p=t.syncExecuteCommand(Oe.id,{unitId:l,subUnitId:l,drawings:f});return h.refreshControls(),!!p}},lt={id:"doc.operation.clear-drawing-transformer",type:i.CommandType.MUTATION,handler:(s,e)=>{const t=s.get(L.IRenderManagerService);return e.forEach(n=>{var r,o;(o=(r=t.getRenderById(n))==null?void 0:r.scene.getTransformer())==null||o.debounceRefreshControls()}),!0}},gt="COMPONENT_DOC_DRAWING_PANEL",Ye={id:"sidebar.operation.doc-image",type:i.CommandType.COMMAND,handler:async(s,e)=>{const t=s.get(B.ISidebarService),n=s.get(i.LocaleService),r=s.get(X.IDrawingManagerService);switch(e.value){case"open":t.open({header:{title:n.t("docImage.panel.title")},children:{label:gt},onClose:()=>{r.focusDrawing(null)},width:360});break;case"close":default:t.close();break}return!0}},Je={id:"doc.operation.edit-doc-image",type:i.CommandType.OPERATION,handler:(s,e)=>{const t=s.get(X.IDrawingManagerService),n=s.get(i.ICommandService);return e==null?!1:(t.focusDrawing([e]),n.executeCommand(Ye.id,{value:"open"}),!0)}};var yt=Object.getOwnPropertyDescriptor,Ot=(s,e,t,n)=>{for(var r=n>1?void 0:n?yt(e,t):e,o=s.length-1,a;o>=0;o--)(a=s[o])&&(r=a(r)||r);return r},Te=(s,e)=>(t,n)=>e(t,n,s);function ut(s,e,t=1,n=0){const{top:r,left:o,bottom:a,right:d}=s,l=d-o,c=a-r,g=e.getViewport(W.VIEWPORT_KEY.VIEW_MAIN),{viewportScrollX:h,viewportScrollY:u}=g,{scaleX:f,scaleY:p}=e.getAncestorScale();return{startX:(o-h)*f,startY:(r-u)*p,endX:(o+l-h)*f,endY:(r+c-u)*p,width:l*f,height:c*p,rotate:n,absolute:{left:!1,top:!1},opacity:t!=null?t:1}}function Ze(s,e){const{top:t,left:n,width:r,height:o,angle:a,opacity:d}=s;return ut({top:t,left:n,bottom:t+o,right:n+r},e.scene,d,a)}E.DocFloatDomController=class extends i.Disposable{constructor(t,n,r,o,a,d){super();le(this,"_domLayerInfoMap",new Map);this._renderManagerService=t,this._drawingManagerService=n,this._drawingRenderService=r,this._canvasFloatDomService=o,this._univerInstanceService=a,this._commandService=d,this._initialize()}dispose(){super.dispose()}_initialize(){this._drawingAddRemoveListener(),this._initScrollAndZoomEvent()}_getSceneAndTransformerByDrawingSearch(t){if(t==null)return;const n=this._renderManagerService.getRenderById(t);if(n==null)return null;const r=n.scene,o=r.getTransformerByCreate();return{scene:r,transformer:o,renderUnit:n,canvas:n.engine.getCanvasElement()}}_drawingAddRemoveListener(){this.disposeWithMe(this._drawingManagerService.add$.subscribe(t=>{this._insertRects(t)})),this.disposeWithMe(this._drawingManagerService.remove$.subscribe(t=>{t.forEach(n=>{this._removeDom(n.drawingId)})}))}_insertRects(t){t.forEach(async n=>{const{unitId:r}=n;if(!this._univerInstanceService.getUnit(r,i.UniverInstanceType.UNIVER_DOC))return;const a=this._getSceneAndTransformerByDrawingSearch(r);if(a==null)return;const d=this._drawingManagerService.getDrawingByParam(n);if(d==null)return;const l=await this._drawingRenderService.renderFloatDom(d,a.scene);if(!(l==null||l.length===0))for(const c of l){this._addHoverForRect(c);const g=new i.DisposableCollection,h=Ze(c,a.renderUnit),u=new Z.BehaviorSubject(h),f=a.canvas,p=d.data,v={dispose:g,rect:c,position$:u,unitId:r};this._canvasFloatDomService.addFloatDom({position$:u,id:d.drawingId,componentKey:d.componentKey,onPointerDown:m=>{f.dispatchEvent(new PointerEvent(m.type,m))},onPointerMove:m=>{f.dispatchEvent(new PointerEvent(m.type,m))},onPointerUp:m=>{f.dispatchEvent(new PointerEvent(m.type,m))},onWheel:m=>{f.dispatchEvent(new WheelEvent(m.type,m))},data:p,unitId:r});const I=c.onTransformChange$.subscribeEvent(()=>{const m=Ze(c,a.renderUnit);u.next(m)});g.add(()=>{this._canvasFloatDomService.removeFloatDom(d.drawingId)}),I&&g.add(I),this._domLayerInfoMap.set(d.drawingId,v)}})}_addHoverForRect(t){this.disposeWithMe(i.toDisposable(t.onPointerEnter$.subscribeEvent(()=>{t.cursor=L.CURSOR_TYPE.GRAB}))),this.disposeWithMe(i.toDisposable(t.onPointerLeave$.subscribeEvent(()=>{t.cursor=L.CURSOR_TYPE.DEFAULT})))}_removeDom(t){const n=this._domLayerInfoMap.get(t);if(!n)return;const{unitId:r}=n;this._domLayerInfoMap.delete(t),n.dispose.dispose();const o=this._getSceneAndTransformerByDrawingSearch(r);o&&o.scene.removeObject(n.rect)}_initScrollAndZoomEvent(){const t=n=>{const r=this._getSceneAndTransformerByDrawingSearch(n);r&&this._domLayerInfoMap.forEach(o=>{if(o.unitId!==n)return;const a=Ze(o.rect,r.renderUnit);o.position$.next(a)})};this.disposeWithMe(this._univerInstanceService.getCurrentTypeOfUnit$(i.UniverInstanceType.UNIVER_DOC).pipe(Z.map(n=>{if(!n)return null;const r=n.getUnitId(),o=this._renderManagerService.getRenderById(r);return o?{render:o,unitId:r}:null}),Z.switchMap(n=>n?i.fromEventSubject(n.render.scene.getViewport(W.VIEWPORT_KEY.VIEW_MAIN).onScrollAfter$).pipe(Z.map(()=>({unitId:n.unitId}))):Z.of(null))).subscribe(n=>{if(!n)return;const{unitId:r}=n;t(r)})),this.disposeWithMe(this._commandService.onCommandExecuted(n=>{if(n.id===W.SetDocZoomRatioOperation.id){const r=n.params,{unitId:o}=r;t(o)}}))}insertFloatDom(t,n){var I,m,T;const r=this._univerInstanceService.getCurrentUnitOfType(i.UniverInstanceType.UNIVER_DOC);if(!r)return!1;const o=this._getSceneAndTransformerByDrawingSearch(r.getUnitId());if(!o)return!1;const l=(I=o.renderUnit.with(k.DocSkeletonManagerService).getSkeleton().getSkeletonData())==null?void 0:I.pages[0];if(!l)return!1;const{pageWidth:c,marginLeft:g,marginRight:h}=l,u=c-g-h,f={size:{width:(m=n.width)!=null?m:u,height:n.height},positionH:{relativeFrom:i.ObjectRelativeFromH.PAGE,posOffset:0},positionV:{relativeFrom:i.ObjectRelativeFromV.PAGE,posOffset:0},angle:0},p=(T=n.drawingId)!=null?T:i.generateRandomId(),v={unitId:r.getUnitId(),drawings:[{drawingId:p,drawingType:i.DrawingTypeEnum.DRAWING_DOM,subUnitId:r.getUnitId(),unitId:r.getUnitId(),...t,title:"",description:"",docTransform:f,layoutType:i.PositionedObjectLayoutType.INLINE,transform:W.docDrawingPositionToTransform(f)}]};return this._commandService.syncExecuteCommand(Ne.id,v),p}},E.DocFloatDomController=Ot([Te(0,L.IRenderManagerService),Te(1,X.IDrawingManagerService),Te(2,i.Inject(he.DrawingRenderService)),Te(3,i.Inject(B.CanvasFloatDomService)),Te(4,i.IUniverInstanceService),Te(5,i.ICommandService)],E.DocFloatDomController);const Mt="docs-drawing-ui.config",ht={},pt=-1e3,ft=1e3,bt=s=>{const e=B.useDependency(i.ICommandService),t=B.useDependency(i.LocaleService),n=B.useDependency(X.IDrawingManagerService),r=B.useDependency(L.IRenderManagerService),o=B.useDependency(i.IUniverInstanceService),{drawings:a}=s,d=a[0];if(d==null)return;const{unitId:l}=d,c=o.getUniverDocInstance(l),g=c==null?void 0:c.getSnapshot().documentStyle.documentFlavor,h=r.getRenderById(l),u=h==null?void 0:h.scene;if(u==null)return;const f=u.getTransformerByCreate(),p=[{label:t.t("image-position.column"),value:String(i.ObjectRelativeFromH.COLUMN)},{label:t.t("image-position.page"),value:String(i.ObjectRelativeFromH.PAGE)},{label:t.t("image-position.margin"),value:String(i.ObjectRelativeFromH.MARGIN)}],v=[{label:t.t("image-position.line"),value:String(i.ObjectRelativeFromV.LINE),disabled:g===i.DocumentFlavor.MODERN},{label:t.t("image-position.page"),value:String(i.ObjectRelativeFromV.PAGE),disabled:g===i.DocumentFlavor.MODERN},{label:t.t("image-position.margin"),value:String(i.ObjectRelativeFromV.MARGIN),disabled:g===i.DocumentFlavor.MODERN},{label:t.t("image-position.paragraph"),value:String(i.ObjectRelativeFromV.PARAGRAPH)}],[I,m]=Y.useState(!0),[T,y]=Y.useState({relativeFrom:i.ObjectRelativeFromH.PAGE,posOffset:0}),[O,P]=Y.useState({relativeFrom:i.ObjectRelativeFromV.PAGE,posOffset:0}),[b,N]=Y.useState(!0),[H,R]=Y.useState(!0);function w(D,A){var C;D==="positionH"?y(A):P(A);const M=n.getFocusDrawings();if(M.length===0)return;const j=M.map(x=>({unitId:x.unitId,subUnitId:x.subUnitId,drawingId:x.drawingId}));e.executeCommand(Oe.id,{unitId:M[0].unitId,subUnitId:M[0].unitId,drawings:j.map(x=>({drawingId:x.drawingId,key:D,value:A}))});const G=(C=r.getRenderById(l))==null?void 0:C.with(W.DocSelectionRenderService);G&&G.blur(),f.refreshControls()}function U(D){var te,ge,ue;const A=T.relativeFrom,M=T.posOffset,j=Number(D);if(A===j)return;const G=n.getFocusDrawings();if(G.length===0)return;const C=G[0].drawingId,x=G[0].unitId;let K=null,V=0;const J=(te=r.getRenderById(x))==null?void 0:te.with(k.DocSkeletonManagerService).getSkeleton(),re=J==null?void 0:J.getSkeletonData();if(re==null)return;const{pages:ye,skeHeaders:Ie,skeFooters:Pe}=re;for(const oe of ye){const{marginLeft:pe,skeDrawings:fe,headerId:we,footerId:Se,pageWidth:me}=oe;if(fe.has(C)){K=fe.get(C),V=pe;break}const ae=(ge=Ie.get(we))==null?void 0:ge.get(me);if(ae!=null&&ae.skeDrawings.has(C)){K=ae==null?void 0:ae.skeDrawings.get(C),V=pe;break}const ce=(ue=Pe.get(Se))==null?void 0:ue.get(me);if(ce!=null&&ce.skeDrawings.has(C)){K=ce==null?void 0:ce.skeDrawings.get(C),V=pe;break}}if(K==null)return;let se=0;A===i.ObjectRelativeFromH.COLUMN?se-=K.columnLeft:A===i.ObjectRelativeFromH.MARGIN&&(se-=V),j===i.ObjectRelativeFromH.COLUMN?se+=K.columnLeft:j===i.ObjectRelativeFromH.MARGIN?se+=V:i.ObjectRelativeFromH.PAGE;const ee={relativeFrom:j,posOffset:(M!=null?M:0)-se};w("positionH",ee)}function z(D){var fe,we,Se,me,ae,ce;const A=O.relativeFrom,M=O.posOffset,j=Number(D);if(A===j)return;const G=n.getFocusDrawings();if(G.length===0)return;const{drawingId:C,unitId:x}=G[0],K=o.getUniverDocInstance(x),V=(fe=r.getRenderById(x))==null?void 0:fe.with(k.DocSkeletonManagerService).getSkeleton(),J=(we=r.getRenderById(x))==null?void 0:we.with(W.DocSelectionRenderService),re=J==null?void 0:J.getSegment(),ye=J==null?void 0:J.getSegmentPage(),Ie=(me=(Se=K==null?void 0:K.getSelfOrHeaderFooterModel(re).getBody())==null?void 0:Se.customBlocks)==null?void 0:me.find(_e=>_e.blockId===C);if(Ie==null||V==null||J==null)return;const{startIndex:Pe}=Ie,se=V.findNodeByCharIndex(Pe,re,ye),ee=(ae=se==null?void 0:se.parent)==null?void 0:ae.parent,te=ee==null?void 0:ee.parent,ge=te==null?void 0:te.lines.find(_e=>_e.paragraphIndex===(ee==null?void 0:ee.paragraphIndex)&&_e.paragraphStart),ue=(ce=te==null?void 0:te.parent)==null?void 0:ce.parent;if(se==null||ee==null||ge==null||te==null||ue==null)return;let oe=0;A===i.ObjectRelativeFromV.PARAGRAPH?oe-=ge.top:A===i.ObjectRelativeFromV.LINE?oe-=ee.top:A===i.ObjectRelativeFromV.PAGE&&(oe+=ue.marginTop),j===i.ObjectRelativeFromV.PARAGRAPH?oe+=ge.top:j===i.ObjectRelativeFromV.LINE?oe+=ee.top:j===i.ObjectRelativeFromV.PAGE&&(oe-=ue.marginTop);const pe={relativeFrom:j,posOffset:(M!=null?M:0)-oe};w("positionV",pe)}function F(D){var x;const A=c==null?void 0:c.getSnapshot(),M=(x=A==null?void 0:A.drawings)==null?void 0:x[D.drawingId];if(M==null)return;const{layoutType:j}=M,{positionH:G,positionV:C}=M.docTransform;y(G),P(C),m(j===i.PositionedObjectLayoutType.INLINE),N(C.relativeFrom===i.ObjectRelativeFromV.PARAGRAPH||C.relativeFrom===i.ObjectRelativeFromV.LINE)}function q(){const D=n.getFocusDrawings();D.length!==0&&F(D[0])}function _(D){N(D),z(String(D?i.ObjectRelativeFromV.PARAGRAPH:i.ObjectRelativeFromV.PAGE))}return Y.useEffect(()=>{q();const D=n.focus$.subscribe(M=>{if(M.length===0){R(!1);return}R(!0),F(M[0])}),A=e.onCommandExecuted(async M=>{M.id===k.RichTextEditingMutation.id&&q()});return()=>{D.unsubscribe(),A.dispose()}},[]),S.jsxs("div",{className:$.clsx("univer-grid univer-gap-2 univer-py-2 univer-text-gray-400",{"univer-hidden":!H}),children:[S.jsx("header",{className:"univer-text-gray-600 dark:!univer-text-gray-200",children:S.jsx("div",{children:t.t("image-position.title")})}),S.jsx("div",{className:"univer-text-gray-600 dark:!univer-text-gray-200",children:S.jsx("div",{children:t.t("image-position.horizontal")})}),S.jsxs("div",{className:"univer-grid univer-grid-cols-2 univer-gap-2 [&>div]:univer-grid [&>div]:univer-gap-2",children:[S.jsxs("div",{children:[S.jsx("span",{children:t.t("image-position.absolutePosition")}),S.jsx($.InputNumber,{min:pt,max:ft,precision:1,disabled:I,value:T.posOffset,onChange:D=>{w("positionH",{relativeFrom:T.relativeFrom,posOffset:D})}})]}),S.jsxs("div",{children:[S.jsx("span",{children:t.t("image-position.toTheRightOf")}),S.jsx($.Select,{value:String(T.relativeFrom),disabled:I,options:p,onChange:U})]})]}),S.jsx("div",{className:"univer-text-gray-600 dark:!univer-text-gray-200",children:S.jsx("div",{children:t.t("image-position.vertical")})}),S.jsxs("div",{className:"univer-grid univer-grid-cols-2 univer-gap-2 [&>div]:univer-grid [&>div]:univer-gap-2",children:[S.jsxs("div",{children:[S.jsx("span",{children:t.t("image-position.absolutePosition")}),S.jsx($.InputNumber,{min:pt,max:ft,precision:1,disabled:I,value:O.posOffset,onChange:D=>{w("positionV",{relativeFrom:O.relativeFrom,posOffset:D})}})]}),S.jsxs("div",{children:[S.jsx("span",{children:t.t("image-position.bellow")}),S.jsx($.Select,{disabled:I,value:String(O.relativeFrom),options:v,onChange:z})]})]}),S.jsx("div",{className:"univer-text-gray-600 dark:!univer-text-gray-200",children:S.jsx("div",{children:t.t("image-position.options")})}),S.jsx("div",{children:S.jsx($.Checkbox,{disabled:I,checked:b,onChange:_,children:t.t("image-position.moveObjectWithText")})})]})},Le=0,Ue=100,Ct=s=>{const e=B.useDependency(i.ICommandService),t=B.useDependency(i.LocaleService),n=B.useDependency(X.IDrawingManagerService),r=B.useDependency(L.IRenderManagerService),o=B.useDependency(i.IUniverInstanceService),{drawings:a}=s,d=a[0];if(d==null)return null;const{unitId:l}=d,c=o.getUniverDocInstance(l),g=r.getRenderById(l);if((g==null?void 0:g.scene)==null)return null;const[u,f]=Y.useState(!0),[p,v]=Y.useState(!0),[I,m]=Y.useState(!0),[T,y]=Y.useState(ie.INLINE),[O,P]=Y.useState(""),[b,N]=Y.useState({distT:0,distL:0,distB:0,distR:0}),[H,R]=Y.useState(!0);function w(_){y(_);const D=n.getFocusDrawings();if(D.length===0)return;const{unitId:A,subUnitId:M}=D[0],j=D.map(({unitId:G,subUnitId:C,drawingId:x})=>({unitId:G,subUnitId:C,drawingId:x}));e.executeCommand(st.id,{unitId:A,subUnitId:M,drawings:j,wrappingStyle:_})}function U(_){P(_);const D=n.getFocusDrawings();if(D.length===0)return;const A=D.map(M=>({unitId:M.unitId,subUnitId:M.subUnitId,drawingId:M.drawingId}));e.executeCommand(at.id,{unitId:D[0].unitId,subUnitId:D[0].unitId,drawings:A,wrapText:_})}function z(_,D){if(_==null)return;const A={...b,[D]:_};N(A);const M=n.getFocusDrawings();if(M.length===0)return;const j=M.map(G=>({unitId:G.unitId,subUnitId:G.subUnitId,drawingId:G.drawingId}));e.executeCommand(ot.id,{unitId:M[0].unitId,subUnitId:M[0].unitId,drawings:j,dist:{[D]:_}})}function F(){const _=n.getFocusDrawings();_.length!==0&&q(_[0])}function q(_){var J,re;const D=(re=(J=c==null?void 0:c.getSnapshot())==null?void 0:J.drawings)==null?void 0:re[_.drawingId];if(D==null)return;const{distT:A=0,distL:M=0,distB:j=0,distR:G=0,layoutType:C=i.PositionedObjectLayoutType.INLINE,behindDoc:x=i.BooleanNumber.FALSE,wrapText:K=i.WrapTextType.BOTH_SIDES}=D;if(N({distT:A,distL:M,distB:j,distR:G}),P(K),f(C!==i.PositionedObjectLayoutType.WRAP_SQUARE),C===i.PositionedObjectLayoutType.WRAP_NONE||C===i.PositionedObjectLayoutType.INLINE?v(!0):v(!1),C===i.PositionedObjectLayoutType.WRAP_NONE||C===i.PositionedObjectLayoutType.INLINE||C===i.PositionedObjectLayoutType.WRAP_TOP_AND_BOTTOM?m(!0):m(!1),C===i.PositionedObjectLayoutType.WRAP_NONE)x===i.BooleanNumber.TRUE?y(ie.BEHIND_TEXT):y(ie.IN_FRONT_OF_TEXT);else switch(C){case i.PositionedObjectLayoutType.INLINE:y(ie.INLINE);break;case i.PositionedObjectLayoutType.WRAP_SQUARE:y(ie.WRAP_SQUARE);break;case i.PositionedObjectLayoutType.WRAP_TOP_AND_BOTTOM:y(ie.WRAP_TOP_AND_BOTTOM);break;default:throw new Error(`Unsupported layout type: ${C}`)}}return Y.useEffect(()=>{F();const _=n.focus$.subscribe(A=>{if(A.length===0){R(!1);return}R(!0),q(A[0])}),D=e.onCommandExecuted(async A=>{A.id===k.RichTextEditingMutation.id&&F()});return()=>{_.unsubscribe(),D.dispose()}},[]),S.jsxs("div",{className:$.clsx("univer-grid univer-gap-2 univer-py-2 univer-text-gray-400",{"univer-hidden":!H}),children:[S.jsx("header",{className:"univer-text-gray-600 dark:!univer-text-gray-200",children:S.jsx("div",{children:t.t("image-text-wrap.title")})}),S.jsx("div",{className:"univer-text-gray-600 dark:!univer-text-gray-200",children:S.jsx("div",{children:t.t("image-text-wrap.wrappingStyle")})}),S.jsx("div",{children:S.jsxs($.RadioGroup,{value:T,onChange:w,direction:"vertical",children:[S.jsx($.Radio,{value:ie.INLINE,children:t.t("image-text-wrap.inline")}),S.jsx($.Radio,{value:ie.WRAP_SQUARE,children:t.t("image-text-wrap.square")}),S.jsx($.Radio,{value:ie.WRAP_TOP_AND_BOTTOM,children:t.t("image-text-wrap.topAndBottom")}),S.jsx($.Radio,{value:ie.BEHIND_TEXT,children:t.t("image-text-wrap.behindText")}),S.jsx($.Radio,{value:ie.IN_FRONT_OF_TEXT,children:t.t("image-text-wrap.inFrontText")})]})}),S.jsx("div",{className:"univer-text-gray-600 dark:!univer-text-gray-200",children:S.jsx("div",{children:t.t("image-text-wrap.wrapText")})}),S.jsx("div",{children:S.jsxs($.RadioGroup,{disabled:u,value:O,onChange:U,direction:"horizontal",children:[S.jsx($.Radio,{value:i.WrapTextType.BOTH_SIDES,children:t.t("image-text-wrap.bothSide")}),S.jsx($.Radio,{value:i.WrapTextType.LEFT,children:t.t("image-text-wrap.leftOnly")}),S.jsx($.Radio,{value:i.WrapTextType.RIGHT,children:t.t("image-text-wrap.rightOnly")})]})}),S.jsx("div",{className:"univer-text-gray-600 dark:!univer-text-gray-200",children:S.jsx("div",{children:t.t("image-text-wrap.distanceFromText")})}),S.jsxs("div",{className:"univer-grid univer-grid-cols-2 univer-gap-2 [&>div]:univer-grid [&>div]:univer-gap-2",children:[S.jsxs("div",{children:[S.jsx("span",{children:t.t("image-text-wrap.top")}),S.jsx($.InputNumber,{min:Le,max:Ue,disabled:p,precision:1,value:b.distT,onChange:_=>{z(_,"distT")}})]}),S.jsxs("div",{children:[S.jsx("span",{children:t.t("image-text-wrap.left")}),S.jsx($.InputNumber,{min:Le,max:Ue,disabled:I,precision:1,value:b.distL,onChange:_=>{z(_,"distL")}})]})]}),S.jsxs("div",{className:"univer-grid univer-grid-cols-2 univer-gap-2 [&>div]:univer-grid [&>div]:univer-gap-2",children:[S.jsxs("div",{children:[S.jsx("span",{children:t.t("image-text-wrap.bottom")}),S.jsx($.InputNumber,{min:Le,max:Ue,disabled:p,precision:1,value:b.distB,onChange:_=>{z(_,"distB")}})]}),S.jsxs("div",{children:[S.jsx("span",{children:t.t("image-text-wrap.right")}),S.jsx($.InputNumber,{min:Le,max:Ue,disabled:I,precision:1,value:b.distR,onChange:_=>{z(_,"distR")}})]})]})]})},Et=()=>{const s=B.useDependency(X.IDrawingManagerService),e=s.getFocusDrawings(),[t,n]=Y.useState(e);return Y.useEffect(()=>{const r=s.focus$.subscribe(o=>{n(o)});return()=>{r.unsubscribe()}},[]),!!(t!=null&&t.length)&&S.jsxs("div",{className:"univer-text-sm",children:[S.jsx(he.DrawingCommonPanel,{drawings:t,hasAlign:!1,hasCropper:!1,hasGroup:!1,hasTransform:!1}),S.jsx(Ct,{drawings:t}),S.jsx(bt,{drawings:t})]})},Qe="doc.menu.image",mt=Ke.id,Pt=s=>{const e=s.get(k.DocSelectionManagerService),t=s.get(i.IUniverInstanceService);return new Z.Observable(n=>{const r=e.textSelection$.subscribe(()=>{var a;const o=e.getActiveTextRange();if(o){const{segmentId:d,startOffset:l,endOffset:c}=o,g=t.getCurrentUniverDocInstance(),h=(a=g==null?void 0:g.getSelfOrHeaderFooterModel(d).getBody())==null?void 0:a.tables;if(h&&h.length&&h.some(u=>{const{startIndex:f,endIndex:p}=u;return l>=f&&l<p||c>=f&&c<p})){n.next(!0);return}}else{n.next(!0);return}n.next(!1)});return()=>r.unsubscribe()})};function At(s){return{id:Qe,type:B.MenuItemType.SUBITEMS,icon:"AddImageIcon",tooltip:"docImage.title",disabled$:Pt(s),hidden$:B.getMenuHiddenObservable(s,i.UniverInstanceType.UNIVER_DOC,void 0,i.DOCS_ZEN_EDITOR_UNIT_ID_KEY)}}function Rt(s){return{id:mt,title:"docImage.upload.float",type:B.MenuItemType.BUTTON,hidden$:B.getMenuHiddenObservable(s,i.UniverInstanceType.UNIVER_DOC,void 0,i.DOCS_ZEN_EDITOR_UNIT_ID_KEY)}}const Nt={[B.RibbonInsertGroup.MEDIA]:{[Qe]:{order:0,menuItemFactory:At,[mt]:{order:0,menuItemFactory:Rt}}}};function Me(s){return s.getContextValue(i.FOCUSING_UNIVER_EDITOR)&&s.getContextValue(i.FOCUSING_COMMON_DRAWINGS)}const xt={id:De.id,description:"shortcut.drawing-move-down",group:"4_drawing-view",binding:B.KeyCode.ARROW_DOWN,priority:100,preconditions:Me,staticParameters:{direction:i.Direction.DOWN}},Ft={id:De.id,description:"shortcut.drawing-move-up",group:"4_drawing-view",binding:B.KeyCode.ARROW_UP,priority:100,preconditions:Me,staticParameters:{direction:i.Direction.UP}},Lt={id:De.id,description:"shortcut.drawing-move-left",group:"4_drawing-view",binding:B.KeyCode.ARROW_LEFT,priority:100,preconditions:Me,staticParameters:{direction:i.Direction.LEFT}},Ut={id:De.id,description:"shortcut.drawing-move-right",group:"4_drawing-view",binding:B.KeyCode.ARROW_RIGHT,priority:100,preconditions:Me,staticParameters:{direction:i.Direction.RIGHT}},Bt={id:Xe.id,description:"shortcut.drawing-delete",group:"4_drawing-view",preconditions:Me,binding:B.KeyCode.DELETE,mac:B.KeyCode.BACKSPACE};var jt=Object.getOwnPropertyDescriptor,kt=(s,e,t,n)=>{for(var r=n>1?void 0:n?jt(e,t):e,o=s.length-1,a;o>=0;o--)(a=s[o])&&(r=a(r)||r);return r},Be=(s,e)=>(t,n)=>e(t,n,s);let je=class extends i.Disposable{constructor(s,e,t,n){super(),this._componentManager=s,this._menuManagerService=e,this._commandService=t,this._shortcutService=n,this._init()}_initCustomComponents(){const s=this._componentManager;this.disposeWithMe(s.register(gt,Et))}_initMenus(){this._menuManagerService.mergeMenu(Nt)}_initCommands(){[Ke,Ne,st,ot,at,Oe,ct,dt,Re,Ye,lt,Je,$e,qe,De,Xe,ze].forEach(s=>this.disposeWithMe(this._commandService.registerCommand(s)))}_initShortcuts(){[xt,Ft,Lt,Ut,Bt].forEach(s=>{this.disposeWithMe(this._shortcutService.registerShortcut(s))})}_init(){this._initCommands(),this._initCustomComponents(),this._initMenus(),this._initShortcuts()}};je=kt([Be(0,i.Inject(B.ComponentManager)),Be(1,B.IMenuManagerService),Be(2,i.ICommandService),Be(3,B.IShortcutService)],je);var Wt=Object.getOwnPropertyDescriptor,Ht=(s,e,t,n)=>{for(var r=n>1?void 0:n?Wt(e,t):e,o=s.length-1,a;o>=0;o--)(a=s[o])&&(r=a(r)||r);return r},be=(s,e)=>(t,n)=>e(t,n,s);function Gt(s){var n,r,o,a;if(i.JSONX.isNoop(s)||!Array.isArray(s))return null;const e=s.find(d=>Array.isArray(d)&&(d==null?void 0:d[0])==="drawings");if(e==null||!Array.isArray(e)||e.length<3||typeof e[1]=="string"&&typeof e[2]!="object"||Array.isArray(e[1])&&typeof e[1][1]!="object")return null;const t=[];if(Array.isArray(e==null?void 0:e[1]))for(const d of e)Array.isArray(d)&&t.push({type:(n=d==null?void 0:d[1])!=null&&n.i?"add":"remove",drawingId:d==null?void 0:d[0],drawing:(r=d==null?void 0:d[1])==null?void 0:r.i});else t.push({type:(o=e[2])!=null&&o.i?"add":"remove",drawingId:e[1],drawing:(a=e[2])==null?void 0:a.i});return t}function Vt(s){if(!Array.isArray(s)||s.length<3||s[0]!=="drawingsOrder")return[];const e=[];for(let t=1;t<s.length;t++){const n=s[t];if(Array.isArray(n)&&typeof n[0]=="number"&&typeof n[1]=="object")e.push(n[0]);else{e.length=0;break}}return e}let ke=class extends i.Disposable{constructor(s,e,t,n,r){super(),this._univerInstanceService=s,this._commandService=e,this._drawingManagerService=t,this._docDrawingService=n,this._renderManagerService=r,this._initialize()}_initialize(){this._commandExecutedListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.beforeCommandExecuted(s=>{if(s.id!==k.RichTextEditingMutation.id)return;const e=s.params,{unitId:t,actions:n}=e,r=Gt(n);if(r!=null)for(const{type:o,drawingId:a,drawing:d}of r)o==="add"?this._addDrawings(t,[d]):this._removeDrawings(t,[a])})),this.disposeWithMe(this._commandService.onCommandExecuted(s=>{if(s.id!==k.RichTextEditingMutation.id)return;const e=s.params,{unitId:t,actions:n}=e;Vt(n).length>0&&this._updateDrawingsOrder(t)})),this.disposeWithMe(this._commandService.onCommandExecuted(s=>{var a;if(s.id!==i.UndoCommand.id&&s.id!==i.RedoCommand.id)return;const e=(a=this._univerInstanceService.getCurrentUniverDocInstance())==null?void 0:a.getUnitId(),t=this._drawingManagerService.getFocusDrawings();if(e==null||t.length===0)return;const n=this._renderManagerService.getRenderById(e),r=n==null?void 0:n.scene;if(r==null)return!1;r.getTransformerByCreate().refreshControls()}))}_addDrawings(s,e){const t=this._drawingManagerService,n=this._docDrawingService,r=this._docDrawingService.getBatchAddOp(e),{subUnitId:o,redo:a,objects:d}=r;t.applyJson1(s,o,a),n.applyJson1(s,o,a),t.addNotification(d),n.addNotification(d)}_removeDrawings(s,e){const t=this._drawingManagerService,n=this._docDrawingService,r=this._docDrawingService.getBatchRemoveOp(e.map(l=>({unitId:s,subUnitId:s,drawingId:l}))),{subUnitId:o,redo:a,objects:d}=r;t.applyJson1(s,o,a),n.applyJson1(s,o,a),t.removeNotification(d),n.removeNotification(d)}_updateDrawingsOrder(s){const e=this._univerInstanceService.getUniverDocInstance(s);if(e==null)return;const t=e.getSnapshot().drawingsOrder;if(t==null)return;const n=this._drawingManagerService,r=this._docDrawingService;n.setDrawingOrder(s,s,t),r.setDrawingOrder(s,s,t);const o={unitId:s,subUnitId:s,drawingIds:t};n.orderNotification(o),r.orderNotification(o)}};ke=Ht([be(0,i.IUniverInstanceService),be(1,i.ICommandService),be(2,X.IDrawingManagerService),be(3,Q.IDocDrawingService),be(4,L.IRenderManagerService)],ke);const Xt=s=>{const{floatDomInfos:e,scene:t,offset:n,bound:r}=s,o=r.right-r.left,a=r.bottom-r.top,d=Y.useMemo(()=>e.map(l=>{const{width:c=0,height:g=0,left:h=0,top:u=0}=l.transform,p=ut({left:h,right:h+c,top:u,bottom:u+g},t),v={position$:new Z.BehaviorSubject(p),position:p,id:l.drawingId,componentKey:l.componentKey,onPointerMove:()=>{},onPointerDown:()=>{},onPointerUp:()=>{},onWheel:()=>{},unitId:l.unitId,data:l.data};return[l.drawingId,v]}).filter(([l,c])=>!(c.position.endX<0||c.position.endY<0||c.position.startX>o||c.position.startY>a)),[e,t,n,o,a]);return S.jsx("div",{className:"univer-absolute univer-left-0 univer-top-0",children:d.map(([l,c])=>S.jsx(B.PrintFloatDomSingle,{layer:c,id:l,position:c.position},l))})};var $t=Object.getOwnPropertyDescriptor,zt=(s,e,t,n)=>{for(var r=n>1?void 0:n?$t(e,t):e,o=s.length-1,a;o>=0;o--)(a=s[o])&&(r=a(r)||r);return r},Ce=(s,e)=>(t,n)=>e(t,n,s);let We=class extends i.Disposable{constructor(s,e,t,n,r){super(),this._docPrintInterceptorService=s,this._drawingRenderService=e,this._drawingManagerService=t,this._componetManager=n,this._injector=r,this._initPrinting(),this._initPrintingDom()}_initPrinting(){this.disposeWithMe(this._docPrintInterceptorService.interceptor.intercept(this._docPrintInterceptorService.interceptor.getInterceptPoints().PRINTING_COMPONENT_COLLECT,{handler:(s,e,t)=>{const{unitId:n,scene:r}=e,o=this._drawingManagerService.getDrawingDataForUnit(n),a=o==null?void 0:o[n];return a&&a.order.forEach(d=>{const l=a.data[d];l.drawingType!==i.DrawingTypeEnum.DRAWING_CHART&&l.drawingType!==i.DrawingTypeEnum.DRAWING_DOM&&this._drawingRenderService.renderDrawing(l,r)}),t()}}))}_initPrintingDom(){this.disposeWithMe(this._docPrintInterceptorService.interceptor.intercept(this._docPrintInterceptorService.interceptor.getInterceptPoints().PRINTING_DOM_COLLECT,{handler:(s,e,t)=>{const{unitId:n}=e,r=this._drawingManagerService.getDrawingDataForUnit(n),o=r==null?void 0:r[n];if(o){const a=o.order.map(l=>{const c=o.data[l];if(c.drawingType===i.DrawingTypeEnum.DRAWING_CHART)return{...c,componentKey:this._componetManager.get(i.DOC_DRAWING_PRINTING_COMPONENT_KEY)};if(c.drawingType===i.DrawingTypeEnum.DRAWING_DOM){const g=this._docPrintInterceptorService.getPrintComponent(c.componentKey);return{...c,componentKey:this._componetManager.get(g||c.componentKey)}}return null}).filter(Boolean),d=B.connectInjector(Xt,this._injector);return $.render(S.jsx(d,{unitId:n,floatDomInfos:a,scene:e.scene,skeleton:e.skeleton,offset:e.offset,bound:e.bound}),e.root),s==null||s.add(()=>{$.unmount(e.root)}),t(s)}}}))}};We=zt([Ce(0,i.Inject(W.DocPrintInterceptorService)),Ce(1,i.Inject(he.DrawingRenderService)),Ce(2,X.IDrawingManagerService),Ce(3,i.Inject(B.ComponentManager)),Ce(4,i.Inject(i.Injector))],We);var qt=Object.getOwnPropertyDescriptor,Kt=(s,e,t,n)=>{for(var r=n>1?void 0:n?qt(e,t):e,o=s.length-1,a;o>=0;o--)(a=s[o])&&(r=a(r)||r);return r},He=(s,e)=>(t,n)=>e(t,n,s);const Yt="__InlineDrawingAnchor__";function vt(s){const{path:e}=s;return e.some(t=>t==="cells")}let Ge=class extends i.Disposable{constructor(e,t,n,r){super();le(this,"_liquid",new L.Liquid);le(this,"_listenerOnImageMap",new Set);le(this,"_transformerCache",new Map);le(this,"_anchorShape");this._commandService=e,this._univerInstanceService=t,this._drawingManagerService=n,this._renderManagerService=r,this._init()}_init(){this._listenDrawingFocus()}_listenDrawingFocus(){this.disposeWithMe(this._drawingManagerService.add$.subscribe(e=>{if(e.length!==0)for(const t of e){const{unitId:n}=t;this._listenerOnImageMap.has(n)||(this._listenTransformerChange(n),this._listenerOnImageMap.add(n))}}))}_listenTransformerChange(e){var r;const t=(r=this._getSceneAndTransformerByDrawingSearch(e))==null?void 0:r.transformer;if(t==null)return;this.disposeWithMe(i.toDisposable(t.changeStart$.subscribe(o=>{var d;this._transformerCache.clear();const{objects:a}=o;for(const l of a.values()){const{oKey:c,width:g,height:h,left:u,top:f,angle:p}=l,v=this._drawingManagerService.getDrawingOKey(c);if(v==null)continue;const I=this._univerInstanceService.getUniverDocInstance(v.unitId),m=(d=I==null?void 0:I.getSnapshot().drawings)==null?void 0:d[v.drawingId];if((m==null?void 0:m.layoutType)===i.PositionedObjectLayoutType.INLINE)try{l.setOpacity(.2)}catch{}m!=null&&this._transformerCache.set(v.drawingId,{drawing:m,top:f,left:u,width:g,height:h,angle:p})}})));const n=i.throttle(this._updateMultipleDrawingDocTransform.bind(this),50);i.throttle(this._nonInlineDrawingTransform.bind(this),50),this.disposeWithMe(i.toDisposable(t.changing$.subscribe(o=>{const{objects:a,offsetX:d,offsetY:l}=o;if(a.size>1)n(a);else if(a.size===1){const c=this._transformerCache.values().next().value,g=a.values().next().value,{width:h,height:u,top:f,left:p,angle:v}=g;if(c&&h===c.width&&u===c.height&&f===c.top&&p===c.left&&v===c.angle)return;c&&(c.drawing.layoutType,i.PositionedObjectLayoutType.INLINE),c&&c.drawing.layoutType===i.PositionedObjectLayoutType.INLINE&&d!=null&&l!=null&&this._updateInlineDrawingAnchor(c.drawing,d,l)}}))),this.disposeWithMe(i.toDisposable(t.changeEnd$.subscribe(o=>{const{objects:a,offsetX:d,offsetY:l}=o;for(const c of a.values()){const g=this._drawingManagerService.getDrawingOKey(c.oKey);if(g==null)continue;const h=this._transformerCache.get(g==null?void 0:g.drawingId);if((h==null?void 0:h.drawing.layoutType)===i.PositionedObjectLayoutType.INLINE)try{c.setOpacity(1)}catch{}}if(this._anchorShape&&this._anchorShape.hide(),a.size>1)this._updateMultipleDrawingDocTransform(a);else if(a.size===1){const c=this._transformerCache.values().next().value,g=a.values().next().value,{width:h,height:u,top:f,left:p,angle:v}=g;if(c&&h===c.width&&u===c.height&&f===c.top&&p===c.left&&v===c.angle)return;c&&c.drawing.layoutType===i.PositionedObjectLayoutType.INLINE?h!==c.width||u!==c.height||v!==c.angle?this._updateDrawingSize(c,g):d!=null&&l!=null&&this._moveInlineDrawing(c.drawing,d,l):c&&this._nonInlineDrawingTransform(c.drawing,g)}this._transformerCache.clear()})))}_updateMultipleDrawingDocTransform(e){if(e.size<1)return;const t=[];let n,r;for(const o of e.values()){const{oKey:a,left:d,top:l,angle:c}=o;let{width:g,height:h}=o;const u=this._drawingManagerService.getDrawingOKey(a);if(u==null)continue;n==null&&(n=u.unitId),r==null&&(r=u.subUnitId);const f=this._transformerCache.get(u.drawingId);if(f==null)continue;const{drawing:p,top:v,left:I,width:m,height:T,angle:y}=f,{width:O,height:P}=this._getPageContentSize(p);if(g=Math.min(g,O),h=Math.min(h,P),(m!==g||T!==h)&&t.push({drawingId:u.drawingId,key:"size",value:{width:g,height:h}}),y!==c&&t.push({drawingId:u.drawingId,key:"angle",value:c}),v!==l||I!==d){const b=l-v,N=d-I;b!==0&&t.push({drawingId:u.drawingId,key:"positionV",value:{relativeFrom:p.docTransform.positionV.relativeFrom,posOffset:p.docTransform.positionV.posOffset+b}}),N!==0&&t.push({drawingId:u.drawingId,key:"positionH",value:{relativeFrom:p.docTransform.positionH.relativeFrom,posOffset:p.docTransform.positionH.posOffset+N}})}}t.length>0&&n&&r&&this._commandService.executeCommand(Oe.id,{unitId:n,subUnitId:r,drawings:t})}_updateDrawingAnchor(e){if(this._transformerCache.size!==1)return;const t=this._transformerCache.values().next().value,n=e.values().next().value;this._getDrawingAnchor(t.drawing,n)}_updateInlineDrawingAnchor(e,t,n){var o;if(this._transformerCache.size!==1)return;const{contentBoxPointGroup:r}=(o=this._getInlineDrawingAnchor(e,t,n))!=null?o:{};r!=null&&this._createOrUpdateInlineAnchor(e.unitId,r)}_getInlineDrawingAnchor(e,t,n){var F,q;const r=this._renderManagerService.getRenderById(e.unitId),o=r==null?void 0:r.with(k.DocSkeletonManagerService).getSkeleton();if(r==null)return;const{mainComponent:a,scene:d}=r,l=a,c=d.getViewports()[0],{pageLayoutType:g=L.PageLayoutType.VERTICAL,pageMarginLeft:h,pageMarginTop:u}=l.getOffsetConfig();let f=null,p=!1,v=-1,I="";const m=.5,T=this._getTransformCoordForDocumentOffset(l,c,t,n);if(T==null)return;const y=(F=this._renderManagerService.getRenderById(e.unitId))==null?void 0:F.with(W.DocSelectionRenderService);if(y==null)return;const O=o==null?void 0:o.findNodeByCoord(T,g,h,u,{strict:!1,segmentId:y.getSegment(),segmentPage:y.getSegmentPage()});if(O){const{node:_,ratioX:D,segmentPage:A,segmentId:M}=O;p=D<m,f=_,v=A,I=M}if(f==null)return;const P=o==null?void 0:o.findPositionByGlyph(f,v),b=this._getDocObject();if(P==null||o==null||b==null||vt(P))return;const N={...P,isBack:p},H=b.document.getOffsetConfig(),R=new W.NodePositionConvertToCursor(H,o),{cursorList:w,contentBoxPointGroup:U}=R.getRangePointData(N,N),{startOffset:z}=(q=W.getOneTextSelectionRange(w))!=null?q:{};if(z!=null)return{offset:z,contentBoxPointGroup:U,segmentId:I,segmentPage:v}}_getDrawingAnchor(e,t){var ge,ue,oe,pe,fe,we,Se,me,ae,ce,_e;const n=this._renderManagerService.getRenderById(e.unitId),r=n==null?void 0:n.with(k.DocSkeletonManagerService).getSkeleton(),o=r==null?void 0:r.getSkeletonData();if(o==null||n==null)return;const{pages:a,skeHeaders:d,skeFooters:l}=o,{mainComponent:c,scene:g}=n,h=c,u=g.getViewports()[0],{pageLayoutType:f=L.PageLayoutType.VERTICAL,pageMarginLeft:p,pageMarginTop:v,docsLeft:I,docsTop:m}=h.getOffsetConfig(),{left:T,top:y,angle:O}=t;let{width:P,height:b}=t;const{positionV:N,positionH:H}=e.docTransform,{width:R,height:w}=this._getPageContentSize(e);P=Math.min(P,R),b=Math.min(b,w);let U=null,z="",F=-1;const q=!1,_={...e.docTransform,size:{width:P,height:b},angle:O},{x:D,y:A}=g.getViewportScrollXY(u),M=this._getTransformCoordForDocumentOffset(h,u,T-D,y-A);if(M==null)return;const j=(ge=this._renderManagerService.getRenderById(e.unitId))==null?void 0:ge.with(W.DocSelectionRenderService);if(j==null)return;const G=r==null?void 0:r.findNodeByCoord(M,f,p,v,{strict:!1,segmentId:j.getSegment(),segmentPage:j.getSegmentPage()});if(G){const{node:de,segmentPage:nt,segmentId:it}=G;U=de,F=nt,z=it}if(U==null)return;const C=(ue=U.parent)==null?void 0:ue.parent,x=C==null?void 0:C.parent,K=(oe=x==null?void 0:x.lines.find(de=>de.paragraphIndex===(C==null?void 0:C.paragraphIndex)&&de.paragraphStart))!=null?oe:x==null?void 0:x.lines[0],V=(pe=x==null?void 0:x.parent)==null?void 0:pe.parent;if(C==null||x==null||K==null||V==null)return;this._liquid.reset();const J=V.type;for(const de of a){const{headerId:nt,footerId:it,pageHeight:an,pageWidth:wt,marginLeft:St,marginBottom:cn}=de,dn=a.indexOf(de);if(F>-1&&dn===F){switch(J){case L.DocumentSkeletonPageType.HEADER:{const Ae=(fe=d.get(nt))==null?void 0:fe.get(wt);if(Ae)this._liquid.translatePagePadding({marginTop:Ae.marginTop,marginLeft:St});else throw new Error("header skeleton not found");break}case L.DocumentSkeletonPageType.FOOTER:{const Ae=(we=l.get(it))==null?void 0:we.get(wt);if(Ae)this._liquid.translatePagePadding({marginTop:an-cn+Ae.marginTop,marginLeft:St});else throw new Error("footer skeleton not found");break}}break}if(this._liquid.translatePagePadding(de),de===V)break;this._liquid.restorePagePadding(de),this._liquid.translatePage(de,f,p,v)}switch(N.relativeFrom===i.ObjectRelativeFromV.LINE?U=C.divides[0].glyphGroup[0]:U=(ce=(ae=(me=(Se=K.divides)==null?void 0:Se[0])==null?void 0:me.glyphGroup)==null?void 0:ae[0])!=null?ce:U,_.positionH={relativeFrom:H.relativeFrom,posOffset:T-this._liquid.x-I},H.relativeFrom){case i.ObjectRelativeFromH.MARGIN:{_.positionH.posOffset=T-this._liquid.x-I-V.marginLeft;break}case i.ObjectRelativeFromH.COLUMN:{_.positionH.posOffset=T-this._liquid.x-I-x.left;break}}switch(_.positionV={relativeFrom:N.relativeFrom,posOffset:y-this._liquid.y-m},N.relativeFrom){case i.ObjectRelativeFromV.PAGE:{_.positionV.posOffset=y-this._liquid.y-m-V.marginTop;break}case i.ObjectRelativeFromV.LINE:{_.positionV.posOffset=y-this._liquid.y-m-C.top;break}case i.ObjectRelativeFromV.PARAGRAPH:{_.positionV.posOffset=y-this._liquid.y-m-K.top;break}}if(U==null)return;const re=r==null?void 0:r.findPositionByGlyph(U,F),ye=this._getDocObject();if(re==null||r==null||ye==null||vt(re))return;const Ie={...re,isBack:q},Pe=ye.document.getOffsetConfig(),se=new W.NodePositionConvertToCursor(Pe,r),{cursorList:ee}=se.getRangePointData(Ie,Ie),{startOffset:te}=(_e=W.getOneTextSelectionRange(ee))!=null?_e:{};if(te!=null)return{offset:te,docTransform:_,segmentId:z,segmentPage:F}}_updateDrawingSize(e,t){const n=[],{drawing:r,width:o,height:a,angle:d}=e,{unitId:l,subUnitId:c}=r;let{width:g,height:h,angle:u}=t;const{width:f,height:p}=this._getPageContentSize(r);g=Math.min(f,g),h=Math.min(p,h),(g!==o||h!==a)&&n.push({drawingId:r.drawingId,key:"size",value:{width:g,height:h}}),u!==d&&n.push({drawingId:r.drawingId,key:"angle",value:u}),n.length>0&&l&&c&&this._commandService.executeCommand(Oe.id,{unitId:l,subUnitId:c,drawings:n})}_moveInlineDrawing(e,t,n){const r=this._getInlineDrawingAnchor(e,t,n),{offset:o,segmentId:a,segmentPage:d}=r!=null?r:{};return this._commandService.executeCommand(ct.id,{unitId:e.unitId,subUnitId:e.unitId,drawing:e,offset:o,segmentId:a,segmentPage:d,needRefreshDrawings:o==null})}_limitDrawingInPage(e,t){const n=this._renderManagerService.getRenderById(e.unitId),{left:r,top:o,width:a,height:d,angle:l}=t,c=n==null?void 0:n.with(k.DocSkeletonManagerService).getSkeleton(),g=c==null?void 0:c.getSkeletonData(),{pages:h}=g!=null?g:{};if(g==null||n==null||h==null)return{left:r,top:o,width:a,height:d,angle:l};const{mainComponent:u}=n,f=u,{top:p,pageLayoutType:v,pageMarginLeft:I,pageMarginTop:m}=f;let T=o;this._liquid.reset();for(const y of h){const{marginBottom:O,pageHeight:P}=y,b=h.indexOf(y),N=h[b+1];if(N==null)continue;if(i.Tools.hasIntersectionBetweenTwoRanges(o,o+d,this._liquid.y+p+P-O,this._liquid.y+p+P+m+N.marginTop)){const R=o+d/2,w=this._liquid.y+p+P+m/2;R<w?T=Math.min(o,this._liquid.y+p+P-O-d):T=Math.max(o,this._liquid.y+p+P+m+N.marginTop)}this._liquid.translatePage(y,v,I,m)}return{left:r,top:T,width:a,height:d,angle:l}}_nonInlineDrawingTransform(e,t,n=!1){const r=e.isMultiTransform===i.BooleanNumber.TRUE?t:this._limitDrawingInPage(e,t);if(n&&r.top!==t.top)return;const o=this._getDrawingAnchor(e,r),{offset:a,docTransform:d,segmentId:l,segmentPage:c}=o!=null?o:{};return a==null||d==null?this._updateMultipleDrawingDocTransform(new Map([[e.drawingId,t]])):this._commandService.executeCommand(dt.id,{unitId:e.unitId,subUnitId:e.unitId,drawing:e,offset:a,docTransform:d,segmentId:l,segmentPage:c})}_getSceneAndTransformerByDrawingSearch(e){if(e==null)return;const t=this._renderManagerService.getRenderById(e),n=t==null?void 0:t.scene;if(n==null)return;const r=n.getTransformerByCreate();return{scene:n,transformer:r}}_getTransformCoordForDocumentOffset(e,t,n,r){const{documentTransform:o}=e.getOffsetConfig(),a=t.transformVector2SceneCoord(L.Vector2.FromArray([n,r]));if(a)return o.clone().invert().applyPoint(a)}_createOrUpdateInlineAnchor(e,t){const n=this._renderManagerService.getRenderById(e);if(n==null)return;const{mainComponent:r,scene:o}=n,a=r,{docsLeft:d,docsTop:l}=a.getOffsetConfig(),c=W.getAnchorBounding(t),{left:g,top:h,height:u}=c,f=g+d,p=h+l;if(this._anchorShape){this._anchorShape.transformByState({left:f,top:p,height:u}),this._anchorShape.show();return}const v=6,I=new L.Rect(Yt+i.generateRandomId(v),{left:f,top:p,height:u,strokeWidth:2,stroke:L.getColor(i.COLORS.darkGray,1),evented:!1});this._anchorShape=I,o.addObject(I,W.TEXT_RANGE_LAYER_INDEX)}_getDocObject(){return W.getDocObject(this._univerInstanceService,this._renderManagerService)}_getPageContentSize(e){const t=this._renderManagerService.getRenderById(e.unitId),n=t==null?void 0:t.with(k.DocSkeletonManagerService).getSkeleton(),r=500,o=500,a=n==null?void 0:n.getSkeletonData();if(a==null||t==null)return{width:r,height:o};const{pages:d}=a;let l=null;for(const c of d){const{skeDrawings:g}=c;if(g.has(e.drawingId)){l=c;break}}if(l){const{pageWidth:c,pageHeight:g,marginLeft:h,marginBottom:u,marginRight:f,marginTop:p}=l;return{width:Math.max(r,c-h-f),height:Math.max(o,g-p-u)}}else return{width:r,height:o}}};Ge=Kt([He(0,i.ICommandService),He(1,i.IUniverInstanceService),He(2,X.IDrawingManagerService),He(3,L.IRenderManagerService)],Ge);var Jt=Object.getOwnPropertyDescriptor,Zt=(s,e,t,n)=>{for(var r=n>1?void 0:n?Jt(e,t):e,o=s.length-1,a;o>=0;o--)(a=s[o])&&(r=a(r)||r);return r},Ee=(s,e)=>(t,n)=>e(t,n,s);let Ve=class extends i.RxDisposable{constructor(e,t,n,r,o){super();le(this,"_initImagePopupMenu",new Set);le(this,"_disposePopups",[]);this._drawingManagerService=e,this._canvasPopManagerService=t,this._renderManagerService=n,this._univerInstanceService=r,this._contextService=o,this._init()}_init(){this.disposeWithMe(this._univerInstanceService.getCurrentTypeOfUnit$(i.UniverInstanceType.UNIVER_DOC).pipe(Z.takeUntil(this.dispose$)).subscribe(e=>this._create(e))),this.disposeWithMe(this._univerInstanceService.getTypeOfUnitDisposed$(i.UniverInstanceType.UNIVER_DOC).pipe(Z.takeUntil(this.dispose$)).subscribe(e=>this._dispose(e))),this._univerInstanceService.getAllUnitsForType(i.UniverInstanceType.UNIVER_DOC).forEach(e=>this._create(e))}_dispose(e){const t=e.getUnitId();this._disposePopups.length&&(this._disposePopups.forEach(n=>n.dispose()),this._disposePopups.length=0),this._renderManagerService.removeRender(t)}_create(e){if(!e)return;const t=e.getUnitId();this._renderManagerService.has(t)&&!this._initImagePopupMenu.has(t)&&(this._popupMenuListener(t),this._initImagePopupMenu.add(t))}_hasCropObject(e){const t=e.getAllObjects();for(const n of t)if(n instanceof he.ImageCropperObject)return!0;return!1}_popupMenuListener(e){var o;const t=(o=this._renderManagerService.getRenderById(e))==null?void 0:o.scene;if(!t)return;const n=t.getTransformerByCreate();if(!n)return;const r=this._disposePopups;this.disposeWithMe(n.createControl$.subscribe(()=>{if(this._hasCropObject(t))return;const a=n.getSelectedObjectMap();if(r.forEach(m=>m.dispose()),r.length=0,a.size>1)return;const d=a.values().next().value;if(!d)return;const l=d.oKey,c=this._drawingManagerService.getDrawingOKey(l);if(!c||c.drawingType===i.DrawingTypeEnum.DRAWING_DOM)return;const{unitId:g,subUnitId:h,drawingId:u,drawingType:f}=c,p=this._canvasPopManagerService.attachPopupToObject(d,{componentKey:he.COMPONENT_IMAGE_POPUP_MENU,direction:"horizontal",offset:[2,0],extraProps:{menuItems:this._getImageMenuItems(g,h,u,f)}},g);r.push(this.disposeWithMe(p)),!this._drawingManagerService.getFocusDrawings().find(m=>m.unitId===g&&m.subUnitId===h&&m.drawingId===u)&&this._drawingManagerService.focusDrawing([{unitId:g,subUnitId:h,drawingId:u}])})),this.disposeWithMe(n.clearControl$.subscribe(()=>{r.forEach(a=>a.dispose()),r.length=0,this._contextService.setContextValue(i.FOCUSING_COMMON_DRAWINGS,!1),this._drawingManagerService.focusDrawing(null)})),this.disposeWithMe(n.changing$.subscribe(()=>{r.forEach(a=>a.dispose()),r.length=0})),this.disposeWithMe(n.changeStart$.subscribe(()=>{r.forEach(a=>a.dispose()),r.length=0}))}_getImageMenuItems(e,t,n,r){return[{label:"image-popup.edit",index:0,commandId:Je.id,commandParams:{unitId:e,subUnitId:t,drawingId:n},disable:!0},{label:"image-popup.delete",index:1,commandId:Re.id,commandParams:{unitId:e,drawings:[{unitId:e,subUnitId:t,drawingId:n}]},disable:!1},{label:"image-popup.crop",index:2,commandId:he.OpenImageCropOperation.id,commandParams:{unitId:e,subUnitId:t,drawingId:n},disable:!0},{label:"image-popup.reset",index:3,commandId:he.ImageResetSizeOperation.id,commandParams:[{unitId:e,subUnitId:t,drawingId:n}],disable:!0}]}};Ve=Zt([Ee(0,X.IDrawingManagerService),Ee(1,i.Inject(W.DocCanvasPopManagerService)),Ee(2,L.IRenderManagerService),Ee(3,i.IUniverInstanceService),Ee(4,i.IContextService)],Ve);var Qt=Object.getOwnPropertyDescriptor,en=(s,e,t,n)=>{for(var r=n>1?void 0:n?Qt(e,t):e,o=s.length-1,a;o>=0;o--)(a=s[o])&&(r=a(r)||r);return r},ve=(s,e)=>(t,n)=>e(t,n,s);let et=class extends i.Disposable{constructor(e,t,n,r,o,a,d,l){super();le(this,"_liquid",new L.Liquid);this._context=e,this._docSkeletonManagerService=t,this._commandService=n,this._editorService=r,this._drawingManagerService=o,this._docRefreshDrawingsService=a,this._univerInstanceService=d,this._lifecycleService=l,this._initialize(),this._commandExecutedListener()}_initialize(){this._initialRenderRefresh(),this._drawingInitializeListener(),this._initResize()}_initialRenderRefresh(){this.disposeWithMe(this._docSkeletonManagerService.currentSkeleton$.subscribe(e=>{e!=null&&this._refreshDrawing(e)})),this.disposeWithMe(this._docRefreshDrawingsService.refreshDrawings$.subscribe(e=>{e!=null&&this._refreshDrawing(e)}))}_commandExecutedListener(){const e=[k.RichTextEditingMutation.id,W.SetDocZoomRatioOperation.id];this.disposeWithMe(this._commandService.onCommandExecuted(t=>{if(e.includes(t.id)){const n=t.params,{unitId:r}=n,{unitId:o,mainComponent:a}=this._context;if(r!==o)return;const d=this._docSkeletonManagerService.getSkeleton();if(d==null)return;if(this._editorService.isEditor(o)&&o!==i.DOCS_ZEN_EDITOR_UNIT_ID_KEY){a==null||a.makeDirty();return}this._refreshDrawing(d)}}))}_initResize(){this.disposeWithMe(i.fromEventSubject(this._context.engine.onTransformChange$).pipe(Z.filter(e=>e.type===L.TRANSFORM_CHANGE_OBSERVABLE_TYPE.resize),Z.debounceTime(16)).subscribe(()=>{var n;const e=this._docSkeletonManagerService.getSkeleton(),{scene:t}=this._context;(n=t.getTransformer())==null||n.refreshControls(),this._refreshDrawing(e)}))}_refreshDrawing(e){var T,y;const t=e==null?void 0:e.getSkeletonData(),{mainComponent:n,unitId:r}=this._context,o=n;if(!t)return;const{left:a,top:d,pageLayoutType:l,pageMarginLeft:c,pageMarginTop:g}=o,{pages:h,skeHeaders:u,skeFooters:f}=t,p={};this._liquid.reset();for(let O=0,P=h.length;O<P;O++){const b=h[O],{headerId:N,footerId:H,pageWidth:R}=b;if(N){const w=(T=u.get(N))==null?void 0:T.get(R);w&&this._calculateDrawingPosition(r,w,a,d,p,w.marginTop,b.marginLeft)}if(H){const w=(y=f.get(H))==null?void 0:y.get(R);w&&this._calculateDrawingPosition(r,w,a,d,p,b.pageHeight-b.marginBottom+w.marginTop,b.marginLeft)}this._calculateDrawingPosition(r,b,a,d,p,b.marginTop,b.marginLeft),this._liquid.translatePage(b,l,c,g)}const v=Object.values(p),I=v.filter(O=>!O.isMultiTransform),m=v.filter(O=>O.isMultiTransform);I.length>0&&this._drawingManagerService.refreshTransform(I),this._handleMultiDrawingsTransform(m)}_handleMultiDrawingsTransform(e){const{scene:t,unitId:n}=this._context,r=t.getTransformerByCreate();e.forEach(l=>{const c=this._drawingManagerService.getDrawingByParam(l);c!=null&&(c.transform=l.transform,c.transforms=l.transforms,c.isMultiTransform=l.isMultiTransform)});const a=[...r.getSelectedObjectMap().keys()],d=Object.values(this._drawingManagerService.getDrawingData(n,n)).filter(l=>l.isMultiTransform===i.BooleanNumber.TRUE);this._drawingManagerService.removeNotification(d),e.length>0&&this._drawingManagerService.addNotification(e);for(const l of a){const c=t.getObject(l);c&&r.setSelectedControl(c)}}_calculateDrawingPosition(e,t,n,r,o,a,d){const{skeDrawings:l}=t;this._liquid.translatePagePadding({marginTop:a,marginLeft:d}),l.forEach(c=>{const{aLeft:g,aTop:h,height:u,width:f,angle:p,drawingId:v,drawingOrigin:I}=c,m=I.layoutType===i.PositionedObjectLayoutType.WRAP_NONE&&I.behindDoc===i.BooleanNumber.TRUE,{isMultiTransform:T=i.BooleanNumber.FALSE}=I,y={left:g+n+this._liquid.x,top:h+r+this._liquid.y,width:f,height:u,angle:p};o[v]==null?o[v]={unitId:e,subUnitId:e,drawingId:v,behindText:m,transform:y,transforms:[y],isMultiTransform:T}:T===i.BooleanNumber.TRUE&&o[v].transforms.push(y)}),this._liquid.restorePagePadding({marginTop:a,marginLeft:d})}_drawingInitializeListener(){const e=()=>{const t=this._docSkeletonManagerService.getSkeleton();t!=null&&(this._refreshDrawing(t),this._drawingManagerService.initializeNotification(this._context.unitId))};this._lifecycleService.stage>=i.LifecycleStages.Rendered?this._docSkeletonManagerService.getSkeleton()?e():setTimeout(e,500):this.disposeWithMe(this._lifecycleService.lifecycle$.pipe(Z.filter(t=>t===i.LifecycleStages.Rendered)).subscribe(e))}};et=en([ve(1,i.Inject(k.DocSkeletonManagerService)),ve(2,i.ICommandService),ve(3,W.IEditorService),ve(4,X.IDrawingManagerService),ve(5,i.Inject(xe)),ve(6,i.IUniverInstanceService),ve(7,i.Inject(i.LifecycleService))],et);var tn=Object.defineProperty,nn=Object.getOwnPropertyDescriptor,rn=(s,e,t)=>e in s?tn(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,sn=(s,e,t,n)=>{for(var r=n>1?void 0:n?nn(e,t):e,o=s.length-1,a;o>=0;o--)(a=s[o])&&(r=a(r)||r);return r},tt=(s,e)=>(t,n)=>e(t,n,s),It=(s,e,t)=>rn(s,typeof e!="symbol"?e+"":e,t);const on="DOC_DRAWING_UI_PLUGIN";E.UniverDocsDrawingUIPlugin=class extends i.Plugin{constructor(e=ht,t,n,r){super(),this._config=e,this._injector=t,this._renderManagerSrv=n,this._configService=r;const{...o}=i.merge({},ht,this._config);this._configService.setConfig(Mt,o)}onStarting(){[[je],[Ve],[Ge],[ke],[xe],[E.DocFloatDomController],[We]].forEach(t=>this._injector.add(t))}onReady(){[[Fe],[et]].forEach(e=>this._renderManagerSrv.registerRenderModule(i.UniverInstanceType.UNIVER_DOC,e)),this._injector.get(ke),this._injector.get(je),this._injector.get(Ge),this._injector.get(We)}onRendered(){this._injector.get(Ve),this._injector.get(E.DocFloatDomController)}},It(E.UniverDocsDrawingUIPlugin,"type",i.UniverInstanceType.UNIVER_DOC),It(E.UniverDocsDrawingUIPlugin,"pluginName",on),E.UniverDocsDrawingUIPlugin=sn([i.DependentOn(he.UniverDrawingUIPlugin,X.UniverDrawingPlugin,Q.UniverDocsDrawingPlugin,B.UniverUIPlugin),tt(1,i.Inject(i.Injector)),tt(2,L.IRenderManagerService),tt(3,i.IConfigService)],E.UniverDocsDrawingUIPlugin),E.ClearDocDrawingTransformerOperation=lt,E.DOCS_IMAGE_MENU_ID=Qe,E.DeleteDocDrawingsCommand=Xe,E.EditDocDrawingOperation=Je,E.GroupDocDrawingCommand=$e,E.InsertDocDrawingCommand=Ne,E.InsertDocImageCommand=Ke,E.MoveDocDrawingsCommand=De,E.RemoveDocDrawingCommand=Re,E.SetDocDrawingArrangeCommand=ze,E.SidebarDocDrawingOperation=Ye,E.UngroupDocDrawingCommand=qe,Object.defineProperty(E,Symbol.toStringTag,{value:"Module"})}));

(function(i,a){typeof exports=="object"&&typeof module<"u"?a(exports,require("@univerjs/core"),require("@univerjs/sheets-filter"),require("@univerjs/sheets/facade"),require("@univerjs/core/facade")):typeof define=="function"&&define.amd?define(["exports","@univerjs/core","@univerjs/sheets-filter","@univerjs/sheets/facade","@univerjs/core/facade"],a):(i=typeof globalThis<"u"?globalThis:i||self,a(i.UniverSheetsFilterFacade={},i.UniverCore,i.UniverSheetsFilter,i.UniverSheetsFacade,i.UniverCoreFacade))})(this,(function(i,a,n,h,l){"use strict";var m=Object.getOwnPropertyDescriptor,F=(s,e,t,r)=>{for(var o=r>1?void 0:r?m(e,t):e,d=s.length-1,u;d>=0;d--)(u=s[d])&&(o=u(o)||o);return o},c=(s,e)=>(t,r)=>e(t,r,s);i.FFilter=class{constructor(e,t,r,o,d){this._workbook=e,this._worksheet=t,this._filterModel=r,this._injector=o,this._commandSrv=d}getFilteredOutRows(){return Array.from(this._filterModel.filteredOutRows).sort()}getColumnFilterCriteria(e){var t;return(t=this._filterModel.getFilterColumn(e))==null?void 0:t.getColumnData()}removeColumnFilterCriteria(e){return this._commandSrv.syncExecuteCommand(n.SetSheetsFilterCriteriaCommand.id,{unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),col:e,criteria:null}),this}setColumnFilterCriteria(e,t){return this._commandSrv.syncExecuteCommand(n.SetSheetsFilterCriteriaCommand.id,{unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),col:e,criteria:t}),this}getRange(){const e=this._filterModel.getRange();return this._injector.createInstance(h.FRange,this._workbook,this._worksheet,e)}removeFilterCriteria(){return this._commandSrv.syncExecuteCommand(n.ClearSheetsFilterCriteriaCommand.id),this}remove(){return this._commandSrv.syncExecuteCommand(n.RemoveSheetFilterCommand.id,{unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId()})}},i.FFilter=F([c(3,a.Inject(a.Injector)),c(4,a.ICommandService)],i.FFilter);class g extends h.FRange{createFilter(){return this._getFilterModel()||!this._commandService.syncExecuteCommand(n.SetSheetFilterRangeCommand.id,{unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),range:this._range})?null:this.getFilter()}getFilter(){const e=this._getFilterModel();return e?this._injector.createInstance(i.FFilter,this._workbook,this._worksheet,e):null}_getFilterModel(){return this._injector.get(n.SheetsFilterService).getFilterModel(this._workbook.getUnitId(),this._worksheet.getSheetId())}}h.FRange.extend(g);class v extends h.FWorksheet{getFilter(){const e=this._getFilterModel();return e?this._injector.createInstance(i.FFilter,this._workbook,this._worksheet,e):null}_getFilterModel(){return this._injector.get(n.SheetsFilterService).getFilterModel(this._workbook.getUnitId(),this._worksheet.getSheetId())}}h.FWorksheet.extend(v);class S{get CustomFilterOperator(){return n.CustomFilterOperator}}l.FEnum.extend(S);class C extends l.FEventName{get SheetBeforeRangeFilter(){return"SheetBeforeRangeFilter"}get SheetRangeFiltered(){return"SheetRangeFiltered"}get SheetRangeFilterCleared(){return"SheetRangeFilterCleared"}get SheetBeforeRangeFilterClear(){return"SheetBeforeRangeFilterClear"}}l.FEventName.extend(C),l.FEventName.extend(h.FSheetEventName);class _ extends l.FUniver{_initialize(e){const t=e.get(a.ICommandService);this.registerEventHandler(this.Event.SheetBeforeRangeFilter,()=>t.beforeCommandExecuted(r=>{r.id===n.SetSheetsFilterCriteriaCommand.id&&this._beforeRangeFilter(r)})),this.registerEventHandler(this.Event.SheetBeforeRangeFilterClear,()=>t.beforeCommandExecuted(r=>{r.id===n.ClearSheetsFilterCriteriaCommand.id&&this._beforeRangeFilterClear()})),this.registerEventHandler(this.Event.SheetRangeFiltered,()=>t.onCommandExecuted(r=>{r.id===n.SetSheetsFilterCriteriaCommand.id&&this._onRangeFiltered(r)})),this.registerEventHandler(this.Event.SheetRangeFilterCleared,()=>t.onCommandExecuted(r=>{r.id===n.ClearSheetsFilterCriteriaCommand.id&&this._onRangeFilterCleared()}))}_beforeRangeFilter(e){const t=e.params,r=this.getUniverSheet(t.unitId),o={workbook:r,worksheet:r.getSheetBySheetId(t.subUnitId),col:t.col,criteria:t.criteria};if(this.fireEvent(this.Event.SheetBeforeRangeFilter,o),o.cancel)throw new Error("SetSheetsFilterCriteriaCommand canceled.")}_onRangeFiltered(e){const t=e.params,r=this.getUniverSheet(t.unitId),o={workbook:r,worksheet:r.getSheetBySheetId(t.subUnitId),col:t.col,criteria:t.criteria};this.fireEvent(this.Event.SheetRangeFiltered,o)}_beforeRangeFilterClear(){const e=this.getActiveWorkbook();if(!e)return;const t={workbook:e,worksheet:e.getActiveSheet()};if(this.fireEvent(this.Event.SheetBeforeRangeFilterClear,t),t.cancel)throw new Error("SetSheetsFilterCriteriaCommand canceled.")}_onRangeFilterCleared(){const e=this.getActiveWorkbook();if(!e)return;const t={workbook:e,worksheet:e.getActiveSheet()};this.fireEvent(this.Event.SheetRangeFilterCleared,t)}}l.FUniver.extend(_),Object.defineProperty(i,Symbol.toStringTag,{value:"Module"})}));

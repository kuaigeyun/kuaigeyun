(function(w,M){typeof exports=="object"&&typeof module<"u"?M(exports,require("@univerjs/core"),require("rxjs"),require("@univerjs/rpc")):typeof define=="function"&&define.amd?define(["exports","@univerjs/core","rxjs","@univerjs/rpc"],M):(w=typeof globalThis<"u"?globalThis:w||self,M(w.UniverEngineFormula={},w.UniverCore,w.rxjs,w.UniverRpc))})(this,(function(w,M,we,bc){"use strict";var DR=Object.defineProperty;var wR=(w,M,we)=>M in w?DR(w,M,{enumerable:!0,configurable:!0,writable:!0,value:we}):w[M]=we;var A=(w,M,we)=>wR(w,typeof M!="symbol"?M+"":M,we);var Ba;var St=(i=>(i.FALSE="FALSE",i.TRUE="TRUE",i))(St||{}),Mt=(i=>(i[i.SUCCESS=0]="SUCCESS",i[i.ERROR=1]="ERROR",i))(Mt||{}),Se=(i=>(i.ALL="#All",i.DATA="#Data",i.HEADERS="#Headers",i.TOTALS="#Totals",i.THIS_ROW="#This Row",i))(Se||{}),rt=(i=>(i[i.FRONT=0]="FRONT",i[i.BACK=1]="BACK",i))(rt||{});function $a(i,o,e,t,r){for(let n=0,s=i.length;n<s;n++){const a=i[n];if(o!==a.unitId||e!==a.sheetId)continue;const{startRow:u,startColumn:c,endRow:l,endColumn:f}=a.range;if(t>=u&&t<=l&&r>=c&&r<=f)return!0}return!1}var h=(i=>(i.DIV_BY_ZERO="#DIV/0!",i.NAME="#NAME?",i.VALUE="#VALUE!",i.NUM="#NUM!",i.NA="#N/A",i.CYCLE="#CYCLE!",i.REF="#REF!",i.SPILL="#SPILL!",i.CALC="#CALC!",i.ERROR="#ERROR!",i.CONNECT="#GETTING_DATA",i.NULL="#NULL!",i))(h||{});const Dt=new Set(Object.values(h)),Ya=[...new Set(Object.values(h).map(i=>i.length))];var Ha=(i=>(i[i.Financial=0]="Financial",i[i.Date=1]="Date",i[i.Math=2]="Math",i[i.Statistical=3]="Statistical",i[i.Lookup=4]="Lookup",i[i.Database=5]="Database",i[i.Text=6]="Text",i[i.Logical=7]="Logical",i[i.Information=8]="Information",i[i.Engineering=9]="Engineering",i[i.Cube=10]="Cube",i[i.Compatibility=11]="Compatibility",i[i.Web=12]="Web",i[i.Array=13]="Array",i[i.Univer=14]="Univer",i[i.User=15]="User",i[i.DefinedName=16]="DefinedName",i[i.Table=17]="Table",i))(Ha||{}),z=(i=>(i.PLUS="+",i.MINUS="-",i.MULTIPLY="*",i.DIVIDED="/",i.CONCATENATE="&",i.POWER="^",i.EQUALS="=",i.NOT_EQUAL="<>",i.GREATER_THAN=">",i.GREATER_THAN_OR_EQUAL=">=",i.LESS_THAN="<",i.LESS_THAN_OR_EQUAL="<=",i))(z||{}),H=(i=>(i.EQUALS="=",i.NOT_EQUAL="<>",i.GREATER_THAN=">",i.GREATER_THAN_OR_EQUAL=">=",i.LESS_THAN="<",i.LESS_THAN_OR_EQUAL="<=",i))(H||{});const Qr=new Map([["<>",4],["<",4],[">=",4],["=",4],[">",4],["<=",4],["&",3],["+",2],["-",2],["/",1],["*",1],["^",0]]),lt=new Set(Qr.keys()),yc=new Set(["=","<>",">",">=","<","<="]);var K=(i=>(i.OPEN_BRACKET="(",i.CLOSE_BRACKET=")",i.COMMA=",",i.SINGLE_QUOTATION="'",i.DOUBLE_QUOTATION='"',i.OPEN_BRACES="{",i.CLOSE_BRACES="}",i.COLON=":",i.OPEN_SQUARE_BRACKET="[",i.CLOSE_SQUARE_BRACKET="]",i))(K||{}),Ke=(i=>(i.PERCENTAGE="%",i.POUND="#",i))(Ke||{});const qr=new Set(["%","#"]);var Me=(i=>(i.AT="@",i.MINUS="-",i.PLUS="+",i))(Me||{});const Nc=" ",Ga=[...Object.values(H),...Object.values(z),...Object.values(K),...Object.values(Ke),...Object.values(Me)];function yr(i){return Ga.includes(i)}function Wa(i){for(const o of Ga)if(i.indexOf(o)>-1)return!0;return!1}function pc(i){return i[0]==="'"&&i[i.length-1]==="'"?i.substring(1,i.length-1):i}function Vc(i){return yr(i)&&i!==K.CLOSE_BRACES&&i!==K.CLOSE_BRACKET&&i!==K.SINGLE_QUOTATION&&i!==K.DOUBLE_QUOTATION||i===" "}const Oc=new Set([z.PLUS,z.MINUS,z.MULTIPLY,z.DIVIDED,z.CONCATENATE,z.POWER,z.EQUALS,z.NOT_EQUAL,z.GREATER_THAN,z.GREATER_THAN_OR_EQUAL,z.LESS_THAN,z.LESS_THAN_OR_EQUAL,K.OPEN_BRACKET,K.COMMA,K.COLON,K.OPEN_BRACES,K.OPEN_SQUARE_BRACKET]);function Sc(i){return Oc.has(i)}const Mc=new Set([z.PLUS,z.MINUS,z.MULTIPLY,z.DIVIDED,z.CONCATENATE,z.POWER,z.EQUALS,z.NOT_EQUAL,z.GREATER_THAN,z.GREATER_THAN_OR_EQUAL,z.LESS_THAN,z.LESS_THAN_OR_EQUAL,K.OPEN_BRACKET,K.COMMA,K.COLON,K.OPEN_BRACES,K.OPEN_SQUARE_BRACKET,Ke.PERCENTAGE,Ke.POUND]);function Dc(i){return Mc.has(i)}const ar='\\[([^\\[\\]\\/?:"<>|*\\\\]+)\\]',Qa=new RegExp(ar),wc="((?![\\[\\]\\/?*\\\\]).)*!",wt="$",Xr="\\s*?:\\s*?",Kr="[A-Za-z]+",Zr="[1-9][0-9]*",ir=`'?(${ar})?(${wc})?'?`,hs=`\\${wt}?${Kr}\\${wt}?${Zr}`,Lc=`^(${Me.AT})?${ir}${hs}${Xr}${hs}$`,qa=new RegExp(Lc),Pc=`^${ir}\\s*?${hs}(${Ke.POUND})?$`,Xa=new RegExp(Pc),jc=`^${ir}\\${wt}?${Zr}${Xr}\\${wt}?${Zr}$`,Ka=new RegExp(jc),xc=`^${ir}\\${wt}?${Kr}${Xr}\\${wt}?${Kr}$`,Za=new RegExp(xc),Uc=`^${ir}\\s*?\\${wt}?${Zr}$`,za=new RegExp(Uc),Tc=`^${ir}\\s*?\\${wt}?${Kr}$`,Ja=new RegExp(Tc),Nr="((?![~!@#$%^&*()_+<>?:,./;’，。、‘：“《》？~！@#￥%……（）【】\\[\\]\\/\\\\]).)+",ei="\\[#.+\\]\\s*?,\\s*?",zr="\\[((?<!#).)*\\]",ti=`${zr}${Xr}${zr}`,vc=`^(${ar})?${Nr}$`,Ic=`^(${ar})?${Nr}(${zr}|\\[${ei}${zr}\\])+$`,Fc=`^(${ar})?${Nr}(\\[${ti}\\])?$|^${Nr}(\\[${ei}${ti}\\])?$`,Bc=`^(${ar})?${Nr}\\[\\s*#([^\\]]+)\\s*\\]$`,ri=new RegExp(vc),ni=new RegExp(Ic),si=new RegExp(Fc),ai=new RegExp(Bc),kc="{.*?}",ii=new RegExp(kc,"g");function pr(i){return Xa.lastIndex=0,Xa.test(i)}function $c(i){return qa.lastIndex=0,qa.test(i)}function oi(i){return Ka.lastIndex=0,Ka.test(i)}function ui(i){return Za.lastIndex=0,Za.test(i)}function ci(i){return za.lastIndex=0,za.test(i)}function li(i){return Ja.lastIndex=0,Ja.test(i)}function Yc(i){return ri.lastIndex=0,ri.test(i)}function Hc(i){return ni.lastIndex=0,ni.test(i)}function Gc(i){return si.lastIndex=0,si.test(i)}function Wc(i){return ai.lastIndex=0,ai.test(i)}function Qc(i){return ii.lastIndex=0,ii.test(i)}function gs(i){return pr(i)||$c(i)||oi(i)||ui(i)}function fi(i){const o={};return Object.keys(i).forEach(e=>{const t=i[e];if(t==null)return!0;o[e]==null&&(o[e]={}),Object.keys(t).forEach(r=>{const n=t[r];o[e][r]=new M.ObjectMatrix(n)})}),o}function qc(i){const o={};for(const e in i){const t=i[e];if(t!=null){o[e]==null&&(o[e]={});for(const r in t){const n=t[r],s={};n.forValue((a,u,c)=>{s[a]===void 0&&(s[a]={}),s[a][u]=c}),o[e][r]=s}}}return o}const nt="P_1",Rt="R_1",Bt="L_1",Vr="LR_1",mi="LO_1",hi="LET",or="LAMBDA",Xc="CUBE",Kc=new Set(["RAND","RANDBETWEEN","NOW","TODAY"]),gi={id:"formula.mutation.register-function",type:M.CommandType.MUTATION,handler:()=>!0},Jr={id:"formula.mutation.set-array-formula-data",type:M.CommandType.MUTATION,handler:(i,o)=>!0},Zc=/[^0-9]/g,zc=/[^A-Za-z]/g;function Or(i){let o=i[0]==="$";const e=i.substring(1);let t=e.indexOf("$")>-1;return M.Tools.isStringNumber(e)&&o&&!t&&(o=!1,t=!0),o&&t?M.AbsoluteRefType.ALL:o?M.AbsoluteRefType.COLUMN:t?M.AbsoluteRefType.ROW:M.AbsoluteRefType.NONE}function Jc(i){const o=i.split("!");o.length>1&&(i=o[o.length-1]);const e=i.split(":");return e.length>1?{startAbsoluteRefType:Or(e[0]),endAbsoluteRefType:Or(e[1])}:{startAbsoluteRefType:Or(e[0])}}function di(i=M.AbsoluteRefType.NONE){let o="",e="";return i===M.AbsoluteRefType.ROW?o="$":i===M.AbsoluteRefType.COLUMN?e="$":i===M.AbsoluteRefType.ALL&&(o="$",e="$"),{rowAbsoluteString:o,columnAbsoluteString:e}}function bt(i){const{startColumn:o,startRow:e,endColumn:t,endRow:r,startAbsoluteRefType:n,endAbsoluteRefType:s,rangeType:a=M.RANGE_TYPE.NORMAL}=i,u=di(n),c=di(s);if(a===M.RANGE_TYPE.ROW||a===M.RANGE_TYPE.ALL){const m=`${u.rowAbsoluteString}${e+1}`,d=`${c.rowAbsoluteString}${r+1}`;return`${m}:${d}`}if(a===M.RANGE_TYPE.COLUMN){const m=`${u.columnAbsoluteString}${M.Tools.chatAtABC(o)}`,d=`${c.columnAbsoluteString}${M.Tools.chatAtABC(t)}`;return`${m}:${d}`}const l=`${u.columnAbsoluteString}${M.Tools.chatAtABC(o)}${u.rowAbsoluteString}${e+1}`,f=`${c.columnAbsoluteString}${M.Tools.chatAtABC(t)}${c.rowAbsoluteString}${r+1}`;return l===f?l:`${l}:${f}`}function Ci(i,o){return`${Ri(i)}!${bt(o)}`}function _i(i,o,e){return nn(i)||nn(o)?`'[${sn(i)}]${sn(o)}'!${bt(e)}`:`[${i}]${o}!${bt(e)}`}function en(i){const{unitId:o,sheetName:e,range:t}=i;return o!=null&&o.length>0&&e!=null&&e.length>0?_i(o,e,t):e!=null&&e.length>0?Ci(e,t):bt(t)}function tn(i){const o=Number.parseInt(i.replace(Zc,""))-1,e=M.Tools.ABCatNum(i.replace(zc,"")),t=Or(i);return{row:o,column:e,absoluteRefType:t}}function rn(i){const o=Qa.exec(i);let e="";o!=null&&(e=o[0].trim(),e=ds(e.slice(1,e.length-1)),i=i.replace(Qa,""));const t=i.indexOf("!");let r="",n="";return t>-1?(r=i.substring(0,t),r[0]==="'"&&r[r.length-1]==="'"&&(r=r.substring(1,r.length-1)),r=ds(r),n=i.substring(t+1)):n=i,{refBody:n,sheetName:r,unitId:e}}function ur(i){const{refBody:o,sheetName:e,unitId:t}=rn(i),r=o.indexOf(":");if(r===-1){const C=tn(o),_=C.row,E=C.column,R=C.absoluteRefType;return{unitId:t,sheetName:e,range:{startRow:_,startColumn:E,endRow:_,endColumn:E,startAbsoluteRefType:R,endAbsoluteRefType:R}}}const n=o.substring(0,r),s=o.substring(r+1),a=tn(n),u=tn(s),c=a.row>u.row?u.row:a.row,l=a.column>u.column?u.column:a.column,f=a.row>u.row?a.row:u.row,m=a.column>u.column?a.column:u.column;let d=M.RANGE_TYPE.NORMAL;return Number.isNaN(c)&&Number.isNaN(f)?d=M.RANGE_TYPE.COLUMN:Number.isNaN(l)&&Number.isNaN(m)&&(d=M.RANGE_TYPE.ROW),{unitId:t,sheetName:e,range:{startRow:c,startColumn:l,endRow:f,endColumn:m,startAbsoluteRefType:a.absoluteRefType,endAbsoluteRefType:u.absoluteRefType,rangeType:d}}}const el=["LOG10"];function Sr(i){const o=Ai(i);if(!gs(o)||el.includes(o.toUpperCase().trim()))return!1;const{range:e}=ur(o);return!(e.endColumn>=16384)}function Ai(i){const o=[];let e=!1;for(let t=0,r=i.length;t<r;t++){const n=i[t];if(n===Nc&&!e)o.push(n);else{if(!e&&(n===Me.AT||n===Me.MINUS||n===Me.PLUS))continue;o.push(n),e=!0}}return o.join("")}function tl(i,o){const e=(i==null?void 0:i.split(","))||[];return i===""||e.length===0?[]:Ei(i)?e.map(n=>{const s=ur(n);return{unitId:s.unitId,sheetId:o(s.sheetName),range:s.range,sheetName:s.sheetName}}):[]}function Ei(i){return((i==null?void 0:i.split(","))||[]).every(e=>Sr(e.trim()))}function nn(i){return i.length===0?!1:!!(Wa(i)||rl(i)||nl(i)||sl(i)||/[\s!$%^&*()+\-=\[\]{};':"\\|,.<>\/?（）]/.test(i))}function Ri(i){return nn(i)?`'${sn(i)}'`:i}function sn(i){return i.replace(/'/g,"''")}function ds(i){return i.replace(/''/g,"'")}function rl(i){const o=i.match(/[1-9][0-9]{0,6}/);return/^[A-Z]+[1-9][0-9]{0,6}$/.test(i)&&o!==null}function nl(i){return/^(R(-?[0-9]+)?C(-?[0-9]+)?|C(-?[0-9]+)?|R(-?[0-9]+)?)$/.test(i)}function sl(i){return!new RegExp("^\\p{Letter}","u").test(i.charAt(0))}var al=Object.getOwnPropertyDescriptor,il=(i,o,e,t)=>{for(var r=t>1?void 0:t?al(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},ol=(i,o)=>(e,t)=>o(e,t,i);w.DefinedNamesService=class extends M.Disposable{constructor(e){super();A(this,"_definedNameMap",{});A(this,"_nameCacheMap",{});A(this,"_update$",new we.Subject);A(this,"update$",this._update$.asObservable());A(this,"_currentRange",{unitId:"",sheetId:"",range:{startRow:0,endRow:0,startColumn:0,endColumn:0}});A(this,"_currentRange$",new we.Subject);A(this,"currentRange$",this._currentRange$.asObservable());A(this,"_focusRange$",new we.Subject);A(this,"focusRange$",this._focusRange$.asObservable());this._univerInstanceService=e}dispose(){super.dispose(),this._definedNameMap={},this._nameCacheMap={},this._update$.complete(),this._currentRange$.complete(),this._focusRange$.complete()}getWorksheetByRef(e,t){var n;const{sheetName:r}=rn(t);return(n=this._univerInstanceService.getUnit(e))==null?void 0:n.getSheetBySheetName(r)}focusRange(e,t){const r=this.getValueById(e,t);r!==void 0&&this._focusRange$.next({...r,unitId:e})}setCurrentRange(e){this._currentRange=e,this._currentRange$.next(e)}getCurrentRange(){return this._currentRange}getCurrentRangeForString(){return bt(this._currentRange.range)}registerDefinedNames(e,t){this._definedNameMap[e]=t,this._updateCache(e),this._update()}registerDefinedName(e,t){this._definedNameMap[e]===void 0&&(this._definedNameMap[e]={}),this._definedNameMap[e][t.id]=t,this._updateCache(e),this._update()}removeDefinedName(e,t){var r;(r=this._definedNameMap[e])==null||delete r[t],this._updateCache(e),this._update()}removeUnitDefinedName(e){delete this._definedNameMap[e],this._updateCache(e),this._update()}getDefinedNameMap(e){return this._definedNameMap[e]}getValueByName(e,t){const r=this._nameCacheMap[e];if(r)return r[t]||null;const n=this._definedNameMap[e];if(n===void 0)return null;let s=null;for(const a of Object.values(n))if(a.name===t){s=a;break}return s&&(this._nameCacheMap[e]=this._nameCacheMap[e]||{},this._nameCacheMap[e][t]=s),s}getValueById(e,t){var r;return(r=this._definedNameMap[e])==null?void 0:r[t]}hasDefinedName(e){return this._definedNameMap[e]===void 0?!1:(Array.from(Object.values(this._definedNameMap[e])).length||0)!==0}getAllDefinedNames(){return this._definedNameMap}_update(){this._update$.next(null)}_updateCache(e){const t=this._definedNameMap[e];if(t===void 0){delete this._nameCacheMap[e];return}this._nameCacheMap[e]={};for(const r of Object.values(t))this._nameCacheMap[e][r.name]=r}},w.DefinedNamesService=il([ol(0,M.IUniverInstanceService)],w.DefinedNamesService);const kt=M.createIdentifier("univer.formula.defined-names.service"),ul=(i,o)=>{const{unitId:e,id:t}=o;return{...i.get(kt).getValueById(e,t),unitId:e}},an={id:"formula.mutation.set-defined-name",type:M.CommandType.MUTATION,handler:(i,o)=>{if(o==null)return!1;const e=i.get(kt),{id:t,unitId:r,name:n,formulaOrRefString:s,comment:a,hidden:u,localSheetId:c,formulaOrRefStringWithPrefix:l}=o;return e.registerDefinedName(r,{id:t,name:n.trim(),formulaOrRefString:s.trim(),comment:a==null?void 0:a.trim(),hidden:u,localSheetId:c,formulaOrRefStringWithPrefix:l}),!0}},Cs={id:"formula.mutation.remove-defined-name",type:M.CommandType.MUTATION,handler:(i,o)=>{if(o==null)return!1;const e=i.get(kt),{unitId:t,id:r}=o;return e.removeDefinedName(t,r),!0}},on={id:"formula.mutation.set-feature-calculation",type:M.CommandType.MUTATION,handler:()=>!0},un={id:"formula.mutation.remove-feature-calculation",type:M.CommandType.MUTATION,handler:()=>!0},_s={id:"formula.mutation.set-formula-calculation-start",type:M.CommandType.MUTATION,handler:()=>!0},As={id:"formula.mutation.set-formula-calculation-stop",type:M.CommandType.MUTATION,handler:()=>!0},Mr={id:"formula.mutation.set-formula-calculation-notification",type:M.CommandType.MUTATION,handler:()=>!0},Es={id:"formula.mutation.set-formula-calculation-result",type:M.CommandType.MUTATION,handler:()=>!0},Rs={id:"formula.mutation.set-formula-data",type:M.CommandType.MUTATION,handler:(i,o)=>!0},bs={id:"formula.mutation.set-image-formula-data",type:M.CommandType.MUTATION,handler:(i,o)=>!0},cn={id:"formula.mutation.set-other-formula",type:M.CommandType.MUTATION,handler:()=>!0},ln={id:"formula.mutation.remove-other-formula",type:M.CommandType.MUTATION,handler:()=>!0};class bi extends M.Disposable{constructor(){super();A(this,"_tableMap",new Map);A(this,"_tableOptionMap",new Map);A(this,"_update$",new we.Subject);A(this,"update$",this._update$.asObservable());this.registerTableOptionMap(Se.ALL,Se.ALL),this.registerTableOptionMap(Se.DATA,Se.DATA),this.registerTableOptionMap(Se.HEADERS,Se.HEADERS),this.registerTableOptionMap(Se.TOTALS,Se.TOTALS),this.registerTableOptionMap(Se.THIS_ROW,Se.THIS_ROW)}dispose(){super.dispose(),this._update$.complete(),this._tableMap.clear(),this._tableOptionMap.clear()}remove(e,t){var r;(r=this._tableMap.get(e))==null||r.delete(t),this._update()}getTableMap(e){return this._tableMap.get(e)}getTableOptionMap(){return this._tableOptionMap}registerTable(e,t,r){var n;this._tableMap.get(e)==null&&this._tableMap.set(e,new Map),(n=this._tableMap.get(e))==null||n.set(t,r),this._update()}registerTableOptionMap(e,t){this._tableOptionMap.set(e,t)}_update(){this._update$.next(null)}}const $t=M.createIdentifier("univer.formula.super-table.service"),yi={id:"formula.mutation.set-super-table",type:M.CommandType.MUTATION,handler:(i,o)=>{const{unitId:e,tableName:t,reference:r}=o;return i.get($t).registerTable(e,t,r),!0}},Ni={id:"formula.mutation.remove-super-table",type:M.CommandType.MUTATION,handler:(i,o)=>{const{unitId:e,tableName:t}=o;return i.get($t).remove(e,t),!0}},ys={id:"formula.mutation.set-super-table-option",type:M.CommandType.MUTATION,handler:(i,o)=>{const{tableOption:e,tableOptionType:t}=o;return i.get($t).registerTableOptionMap(e,t),!0}};class yt{constructor(o){A(this,"_cache");this._cache=new M.LRUMap(o)}set(o,e){const t=this._hash(o);this._cache.set(t,e)}get(o){const e=this._hash(o);return this._cache.get(e)}clear(){this._cache.clear()}delete(o){this._cache.delete(this._hash(o))}forEach(o,e){this._cache.forEach(o,e)}_hash(o){return o.length<=64?o:M.hashAlgorithm(o).toString()}}const Ns=new yt(1e5);function Yt(i){const o=Ns.get(i);if(o)return o;const e=ur(i);return Ns.set(i,e),ur(i)}function cl(){Ns.clear()}var Te=(i=>(i[i.NORMAL=0]="NORMAL",i[i.NUMBER=1]="NUMBER",i[i.STRING=2]="STRING",i[i.FUNCTION=3]="FUNCTION",i[i.REFERENCE=4]="REFERENCE",i[i.ARRAY=5]="ARRAY",i[i.DEFINED_NAME=6]="DEFINED_NAME",i))(Te||{});function ps(i){let o="";for(const e of i)typeof e=="string"?o+=e:o+=e.token;return o}class oe{constructor(){A(this,"_parent");A(this,"_token",Rt);A(this,"_children",[]);A(this,"_lambdaId");A(this,"_functionDefinitionPrivacyVar");A(this,"_lambdaParameter","");A(this,"_startIndex",-1);A(this,"_endIndex",-1);A(this,"_definedNames",[])}dispose(){var o;this._children.forEach(e=>{typeof e!="string"&&e.dispose()}),(o=this._functionDefinitionPrivacyVar)==null||o.clear(),this._functionDefinitionPrivacyVar=null,this._children=[],this._parent=null,this._definedNames=[]}getDefinedNames(){return this._definedNames}getStartIndex(){return this._startIndex}getLambdaId(){return this._lambdaId}setLambdaId(o){this._lambdaId=o}getFunctionDefinitionPrivacyVar(){return this._functionDefinitionPrivacyVar}setLambdaPrivacyVar(o){this._functionDefinitionPrivacyVar=o}getLambdaParameter(){return this._lambdaParameter}setLambdaParameter(o){this._lambdaParameter=o}getParent(){return this._parent}setParent(o){this._parent=o}getChildren(){return this._children}setChildren(o){this._children=o}addChildren(o){this._children.push(o)}addChildrenFirst(o){this._children.unshift(o)}getToken(){return this._token}setToken(o){this._token=o}setIndex(o,e){this._startIndex=o,this._endIndex=e}setDefinedNames(o){this._definedNames=o}hasDefinedNames(){return this._definedNames.length>0}replaceChild(o,e){const t=this._getIndexInParent(o);t!=null&&(this.getChildren().splice(t,1,e),e.setParent(this))}changeToParent(o){const e=this.getParent();e&&e.removeChild(this),this.setParent(o),o.getChildren().push(this)}removeChild(o){const e=this._getIndexInParent(o);e!=null&&this.getChildren().splice(e,1)}serialize(){const o=this.getToken(),e=this.getChildren(),t=[],r=e.length;for(let n=0;n<r;n++){const s=e[n];s instanceof oe?t.push(s.serialize()):t.push(s)}return{token:o,st:this._startIndex,ed:this._endIndex,children:t}}_getIndexInParent(o){const e=this.getChildren(),t=e.length;for(let r=0;r<t;r++)if(e[r]===o)return r}}const pi=2e3,Vs=new yt(pi),Os=new yt(pi);class Dr extends M.Disposable{constructor(){super(...arguments);A(this,"_currentLexerNode",new oe);A(this,"_upLevel",0);A(this,"_segment","");A(this,"_bracketState",[]);A(this,"_squareBracketState",0);A(this,"_bracesState",0);A(this,"_singleQuotationState",0);A(this,"_doubleQuotationState",0);A(this,"_lambdaState",!1);A(this,"_colonState",!1);A(this,"_formulaErrorCount",0);A(this,"_tableBracketState",!1)}dispose(){this._resetTemp(),this._currentLexerNode.dispose(),Vs.clear(),Os.clear()}getUpLevel(){return this._upLevel}isColonClose(){return this._colonState===!1}isColonOpen(){return this._colonState===!0}isDoubleQuotationClose(){return this._doubleQuotationState===0}isLambdaOpen(){return this._lambdaState===!0}isLambdaClose(){return this._lambdaState===!1}isSingleQuotationClose(){return this._singleQuotationState===0}isBracesClose(){return this._bracesState===0}isBracketClose(){return this._bracketState.length===0}isSquareBracketClose(){return this._squareBracketState===0}getCurrentLexerNode(){return this._currentLexerNode}getFunctionAndParameter(e,t){const r=this._getCurrentParamIndex(e,t);if(r==null||r===h.VALUE)return;const n=r[0];if(typeof n=="string")return;let s=n.getParent(),a=n;for(;s;){const u=s.getToken();if(u!==nt&&!yr(u)&&s.getStartIndex()!==-1){const c=s.getChildren().indexOf(a);return{functionName:u,paramIndex:c}}a=s,s=s.getParent()}}checkIfAddBracket(e){let t=0,r=e.length-1,n=e[r];for(;(n===K.CLOSE_BRACKET||n===" ")&&r>=0;)n===K.CLOSE_BRACKET&&t++,n=e[--r];const s=this._getCurrentParamIndex(e,e.length-2);if(s==null||s===h.VALUE)return 0;const a=s[0];if(typeof a=="string")return 0;let u=a.getParent(),c=0;for(s[1]===K.OPEN_BRACKET&&c++;u;){const l=u.getToken();l!==nt&&l!==K.COLON&&u.getStartIndex()!==-1&&l.toUpperCase()!==or&&(t===0?c+=1:t--),u=u.getParent()}return c}sequenceNodesBuilder(e){const t=Os.get(e);if(t)return[...t];const r=this._getSequenceArray(e);if(r.length===0)return;const n=this.getSequenceNode(r);return Os.set(e,[...n]),n}convertRefersToAbsolute(e,t,r,n=""){const s=this.sequenceNodesBuilder(e);if(s==null)return e;let a="";e.substring(0,1)===z.EQUALS&&(a=z.EQUALS);for(let u=0,c=s.length;u<c;u++){const l=s[u];if(typeof l!="string"&&l.nodeType===Te.REFERENCE){const{token:f,endIndex:m}=l,d=Yt(f);if(d==null)continue;const{range:C,sheetName:_,unitId:E}=d,R={...C,startAbsoluteRefType:t,endAbsoluteRefType:r},b=en({range:R,unitId:E,sheetName:_||n}),N=b.length-f.length;s[u]={...l,token:b,endIndex:m+N};for(let V=u+1;V<c;V++){const S=s[V];typeof S!="string"&&(S.startIndex+=N,S.endIndex+=N)}}}return`${a}${ps(s)}`}moveFormulaRefOffset(e,t,r,n=!1){const s=this.sequenceNodesBuilder(e);if(s==null)return e;const a=[];for(let u=0,c=s.length;u<c;u++){const l=s[u];if(typeof l=="string"||l.nodeType!==Te.REFERENCE){a.push(l);continue}const{token:f}=l,m=Yt(f),{sheetName:d,unitId:C}=m;let _=m.range;if(!n&&_.startAbsoluteRefType===M.AbsoluteRefType.ALL&&_.endAbsoluteRefType===M.AbsoluteRefType.ALL){a.push(l);continue}else _=M.moveRangeByOffset(_,t,r,n);let E="";M.isValidRange(_)?E=en({range:_,unitId:C,sheetName:d}):E=h.REF,a.push({...l,token:E})}return`=${ps(a)}`}_formulaSpellCheck(){if(this._currentLexerNode.getChildren().length===0)return!0;const e=this._currentLexerNode.getChildren()[0];return e instanceof oe?!0:!!(this._passArrayOperator(e)||lt.has(e)||qr.has(e)||e===Me.AT||e===K.COMMA||e===K.COLON||e===K.OPEN_BRACKET)}_passArrayOperator(e){if(e.length===0||!(e[0]==="{"&&e[e.length-1]==="}"))return!1;const t=this._currentLexerNode.getChildren(),r=t[t.length-1];return r instanceof oe?!1:!!lt.has(r)}getSequenceNode(e){const t=[];let r=!1;for(let n=0,s=e.length;n<s;n++){const a=e[n],u=e[n-1],{segment:c,currentString:l}=a;if(l===K.DOUBLE_QUOTATION&&(r=!0),(c!==""||n===0)&&n!==s-1){t.push(l);continue}let f=(u==null?void 0:u.segment)||"";const m=n-f.length;let d=n-1;const C=n-1;if(n===s-1&&this._isLastMergeString(l)&&(f+=l,d+=1),f===""||Qr.has(f)){t.push(l);continue}const _=f.trim(),E=Ai(_);r===!0&&_[_.length-1]===K.DOUBLE_QUOTATION&&_[0]!==K.OPEN_BRACES?(r=!1,this._processPushSequenceNode(t,Te.STRING,f,m,d,C)):pr(E)&&Sr(E)?this._processPushSequenceNode(t,Te.REFERENCE,f,m,d,C):M.Tools.isStringNumber(_)?this._processPushSequenceNode(t,Te.NUMBER,f,m,d,C):_.length>0&&this._processPushSequenceNode(t,Te.FUNCTION,f,m,d,C),(n!==s-1||!this._isLastMergeString(l))&&t.push(l)}return this._mergeSequenceNodeReference(t)}_processPushSequenceNode(e,t,r,n,s,a){this._pushSequenceNode(e,{nodeType:t,token:r,startIndex:n,endIndex:s},a)}_getCurrentParamIndex(e,t){return this._nodeMaker(e,void 0,t)}_isLastMergeString(e){return e===K.DOUBLE_QUOTATION||M.Tools.isStringNumber(e)||!yr(e)}_mergeSequenceNodeReference(e){const t=[],r=e.length;let n=0;for(;n<r;){const s=e[n];if(typeof s=="string"){const a=e[n-1];if(s.trim()===K.CLOSE_BRACES&&a!=null&&typeof a!="string"&&a.nodeType===Te.FUNCTION&&a.token.trim().substring(0,1)===K.OPEN_BRACES){a.nodeType=Te.ARRAY,a.token+=s,a.endIndex+=s.length,n++;continue}t.push(s)}else{const a=e[n+1],u=e[n+2];a===K.COLON&&typeof s!="string"&&u!=null&&typeof u!="string"&&Sr((s.token+a+u.token).trim())&&(s.nodeType=Te.REFERENCE,s.token+=a+u.token,s.endIndex=u.endIndex,n+=2),t.push(s)}n++}return this._minusSplitSequenceNode(t)}_minusSplitSequenceNode(e){const t=[];for(const r of e){if(typeof r!="string"){const s=r.token.match(/^(\s*([-@+]\s*)+)(.*)$/);if(s){const a=s[1],u=s[3];if(Sr(u.trim())){const c=a.length,l=r.startIndex,f=r.startIndex+c-1,m={nodeType:Te.NORMAL,token:a,startIndex:l,endIndex:f},d={nodeType:Te.REFERENCE,token:u,startIndex:f+1,endIndex:r.endIndex};t.push(m),t.push(d);continue}}}t.push(r)}return t}_pushSequenceNode(e,t,r){const n=r-t.startIndex+1;e.splice(e.length-n,n,t)}nodeMakerTest(e){return this._nodeMaker(e)}treeBuilder(e,t=!0,r){var f;if(t===!0){const m=Vs.get(e),d=r&&((f=this._simpleCheckDefinedName)==null?void 0:f.call(this,e,r));if(m&&!d)return m}this._resetCurrentLexerNode(),this._currentLexerNode.setToken(Rt);const n=[];let s=this._nodeMaker(e,n);if(s===h.VALUE||n.length===0)return s;let a=!1,u="",c=[];if(r){const{hasDefinedName:m,sequenceString:d,definedNames:C}=this._handleDefinedName(n,r);a=m,u=d,c=C}if(a&&(this._resetCurrentLexerNode(),this._currentLexerNode.setToken(Rt),s=this._nodeMaker(`=${u}`),s===h.VALUE))return s;const l=this._getTopNode(this._currentLexerNode);if(l&&(this._currentLexerNode=l),t){if(!this._suffixExpressionHandler(this._currentLexerNode))return h.VALUE;Vs.set(e,this._currentLexerNode)}return a&&this._currentLexerNode.setDefinedNames(c),this._currentLexerNode}_handleDefinedName(e,t){const{unitId:r,getValueByName:n,getSheetName:s}=t;if(r==null)return{sequenceString:"",hasDefinedName:!1,definedNames:[]};const a=this.getSequenceNode(e);let u="",c=!1;const l=[];for(let f=0,m=a.length;f<m;f++){const d=a[f];if(typeof d=="string"){u+=d;continue}const{nodeType:C,token:_}=d;let E=_;if(C===Te.REFERENCE||C===Te.FUNCTION){C===Te.FUNCTION&&(E=this._getHasSheetNameDefinedName(_,r,t));const R=n(r,E);if(R){const b=R.formulaOrRefString,N=this._handleNestedDefinedName(b,t);if(N==null||typeof N!="object")u+=N||h.NAME,c=!0,l.push(E);else if(typeof N=="object"){const{sequenceString:V,definedNames:S}=N;u+=V,S.forEach(D=>{l.push(D)}),c=!0}}else this._checkDefinedNameDirty(E,t)?(u+=h.NAME,c=!0,l.push(E)):u+=E}else u+=E}return{sequenceString:u,hasDefinedName:c,definedNames:l}}_getHasSheetNameDefinedName(e,t,r){if(!e.includes("!"))return e;const n=e.split("!");if(n.length!==2)return e;const s=n[0],a=n[1].trim(),u=r.getValueByName(t,a);if(!u)return e;const c=u.localSheetId;if(c!==void 0){if(c==="AllDefaultWorkbook")return a;const l=r.getSheetName(t,c);if(s===l)return a}else return a;return e}_handleNestedDefinedName(e,t){const r=[],n=this._nodeMaker(e,r);return n===h.VALUE||r.length===0?n:this._handleDefinedName(r,t)}_simpleCheckDefinedName(e,t){const{getDirtyDefinedNameMap:r,unitId:n}=t,s=r(),a=n;if(a!=null&&s[a]!=null){const u=Object.keys(s[a]);for(let c=0,l=u.length;c<l;c++){const f=u[c];if(e.indexOf(f)>-1)return!0}}return!1}_checkDefinedNameDirty(e,t){const{getDirtyDefinedNameMap:r,unitId:n}=t,s=r(),a=n;if(a!=null&&s[a]!=null){const u=Object.keys(s[a]);for(let c=0,l=u.length;c<l;c++)if(u[c]===e)return!0}return!1}_suffixExpressionHandler(e){var u;const t=e.getChildren();if(!t)return!1;const r=t.length,n=[],s=[];let a=!0;for(let c=0;c<r;c++){const l=t[c];if(l instanceof oe)a=this._suffixExpressionHandler(l),n.push(l);else{const f=l.trim();if(f==="")continue;if(lt.has(f)){if(f===z.PLUS&&this._deletePlusForPreNode(t[c-1]))continue;if(f!==z.PLUS&&f!==z.MINUS&&this._deletePlusForPreNode(t[c-1]))return!1;for(;s.length>0;){const m=(u=s[s.length-1])==null?void 0:u.trim();if(!m||m===K.OPEN_BRACKET)break;const d=Qr.get(m),C=Qr.get(f);if(d===void 0||C===void 0)break;if(C>=d)n.push(s.pop());else break}s.push(l)}else if(f===K.OPEN_BRACKET)s.push(l);else if(f===K.CLOSE_BRACKET)this._processSuffixExpressionCloseBracket(n,s,t,c);else{if(this._checkCloseBracket(t[c-1]))return!1;n.push(l)}}}return a?this._processSuffixExpressionRemain(n,s,e):!1}_processSuffixExpressionRemain(e,t,r){const n=e.length,s=e[n-1];for(;t.length>0;){const a=t.pop();if(!(s instanceof oe)&&(a===K.OPEN_BRACKET||a===K.CLOSE_BRACKET))return!1;e.push(a)}return r.setChildren(e),!0}_processSuffixExpressionCloseBracket(e,t,r,n){var s;if(this._checkOpenBracket(r[n-1])||this._checkOperator(r[n-1]))return!1;for(;t.length>0;){const a=(s=t[t.length-1])==null?void 0:s.trim();if(!a)break;if(a===K.OPEN_BRACKET){t.pop();break}e.push(t.pop())}}_checkCloseBracket(e){return e===K.CLOSE_BRACKET||e instanceof oe}_checkOpenBracket(e){return e===K.OPEN_BRACKET}_checkOperator(e){return e==null||e instanceof oe?!1:lt.has(e)}_deletePlusForPreNode(e){if(e==null)return!0;if(!(e instanceof oe)){const t=e.trim();if(lt.has(t)||t===K.OPEN_BRACKET)return!0}return!1}_resetCurrentLexerNode(){this._currentLexerNode=new oe}_resetSegment(){this._segment=""}_openBracket(e=0){this._bracketState.push(e)}_closeBracket(){this._bracketState.pop()}_openSquareBracket(){this._squareBracketState+=1}_closeSquareBracket(){this._squareBracketState-=1}_getCurrentBracket(){const e=this._bracketState;return e[e.length-1]}_changeCurrentBracket(e){const t=this._bracketState;t[t.length-1]=e}_openBraces(){this._bracesState+=1}_closeBraces(){this._bracesState-=1}_openSingleQuotation(){this._singleQuotationState+=1}_closeSingleQuotation(){this._singleQuotationState-=1}_openDoubleQuotation(){this._doubleQuotationState+=1}_closeDoubleQuotation(){this._doubleQuotationState-=1}_openLambda(){this._lambdaState=!0}_closeLambda(){this._lambdaState=!1}_openColon(e){this._upLevel=e,this._colonState=!0}_closeColon(){this._upLevel=0,this._colonState=!1}_isTableBracket(){return this._tableBracketState}_openTableBracket(){this._tableBracketState=!0}_closeTableBracket(){this._tableBracketState=!1}_formalErrorOccurred(){this._formulaErrorCount+=1}_hasFormalError(){return this._formulaErrorCount>0}_getLastChildCurrentLexerNode(){const e=this._currentLexerNode.getChildren();if(e&&e.length>0){const t=e[e.length-1];if(t instanceof oe)return t}return!1}_getLastChildCurrent(){const e=this._currentLexerNode.getChildren();return e&&e.length>0?e[e.length-1]:!1}_setParentCurrentLexerNode(){const e=this._currentLexerNode.getParent();return e?(this._currentLexerNode=e,!0):!1}_setAncestorCurrentLexerNode(){var r,n,s,a,u,c;const e=(r=this._currentLexerNode)==null?void 0:r.getParent();let t=!1;if(e&&e.getToken()===Bt){if((n=e==null?void 0:e.getParent())!=null&&n.getParent()){const l=(a=(s=this._currentLexerNode.getParent())==null?void 0:s.getParent())==null?void 0:a.getParent();l&&(this._currentLexerNode=l),t=!0}}else if(e!=null&&e.getParent()){const l=(u=this._currentLexerNode.getParent())==null?void 0:u.getParent();l&&(this._currentLexerNode=l),t=!0}for(let l=0;l<this._upLevel;l++){const f=(c=this._currentLexerNode)==null?void 0:c.getParent();f&&(this._currentLexerNode=f),this._currentLexerNode?t=!0:t=!1}return t}_segmentCount(){return this._segment.trim().length}_pushSegment(e){this._segment+=e}_pushNodeToChildren(e,t=!1){let r=e;if(r!==""){const n=this._currentLexerNode.getChildren();if(!(r instanceof oe)&&this.isColonOpen()){const s=new oe;s.setToken(r),s.setParent(this._currentLexerNode),r=s}t?n.unshift(r):n.push(r)}this.isColonOpen()&&(this._setAncestorCurrentLexerNode(),this._closeColon())}_setCurrentLexerNode(e,t=!1){this._pushNodeToChildren(e,t),e.setParent(this._currentLexerNode),this._currentLexerNode=e}_newAndPushCurrentLexerNode(e,t,r=!1){const n=new oe;n.setToken(e),n.setIndex(t-e.length,t-1),this._setCurrentLexerNode(n,r)}_getTopNode(e){let t=e;for(;t!=null&&t.getParent();)t=t.getParent();return t}_removeLastChild(){this._currentLexerNode.getChildren().splice(-1)}_formulaErrorLastTokenCheck(e,t){const r=this._findPreviousToken(e,t)||"",n=e.length-1===t;if(!n&&this._isOperatorToken(r)||n&&Sc(r))return!0;if(qr.has(r)){const s=this._findSecondLastNonSpaceToken(e,t);if(s==null||Dc(s))return!0}return!1}_findPreviousToken(e,t){let r=t;for(;r>=0;){const n=e[r];if(n!==" ")return n;r--}}_findSecondLastNonSpaceToken(e,t){let r=t,n=0;for(;r>=0;){const s=e[r];if(s!==" "&&(n++,n===2))return s;r--}return null}_findNextToken(e,t){let r=t;for(;r>=0;){const n=e[r];if(n!==" ")return n;r++}}_unexpectedEndingTokenExcludeOperator(e){return e===K.OPEN_BRACKET||e===K.COMMA||e===z.EQUALS||e===""}_unexpectedEndingToken(e){return!!(this._isOperatorToken(e)||this._unexpectedEndingTokenExcludeOperator(e))}_isOperatorToken(e){return!!lt.has(e)}_getSequenceArray(e){const t=[];return this._nodeMaker(e,t),t}_resetTemp(){this._currentLexerNode=new oe,this._upLevel=0,this._segment="",this._bracketState=[],this._bracesState=0,this._singleQuotationState=0,this._doubleQuotationState=0,this._lambdaState=!1,this._colonState=!1,this._formulaErrorCount=0}_checkErrorState(){return!!(this._bracketState.length>0||this._bracesState>0||this._singleQuotationState>0||this._doubleQuotationState>0||this._hasFormalError())}_checkSimilarErrorToken(e,t,r){let n=t;if(e!==Ke.POUND)return!0;let s=r[++n];for(;s===" ";)s=r[++n];return!!yr(s)}_checkIfErrorObject(e,t){return!!this._findErrorObject(e,t)}_findErrorObject(e,t){for(let r=0;r<Ya.length;r++){const n=Ya[r],s=t.slice(e,e+n).join("").toUpperCase();if(Dt.has(s))return s}}_nodeMaker(e,t,r){let n=e.replace(/\r\n$|\r|\n/g," ");n.substring(0,1)===z.EQUALS&&(n=n.substring(1));const s=n.split(""),a=s.length;this._resetTemp(),this._formulaErrorLastTokenCheck(s,a-1)&&this._formalErrorOccurred();let u=0;for(;u<a;){const c=s[u];if(r===u)return[this._currentLexerNode,c];if(c===Ke.POUND&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isBracesClose()&&this.isSquareBracketClose()&&this._checkIfErrorObject(u,s)){const l=this._findErrorObject(u,s);if(l==null)return h.VALUE;this._pushNodeToChildren(l);for(let f=0;f<l.length;f++){const m=s[u];this._pushSegment(m),this._addSequenceArray(t,m,u),u++}this._resetSegment();continue}else if(c===K.OPEN_BRACKET&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose())if(this._segmentCount()>0||this.isLambdaOpen()){this.isLambdaClose()&&(this._newAndPushCurrentLexerNode(this._segment,u),this._resetSegment()),this._openBracket(1),this._closeLambda();const l=s[u+1];if(l&&l===K.CLOSE_BRACKET){if(!this._setParentCurrentLexerNode()&&u!==a-1)return h.VALUE;this._addSequenceArray(t,c,u),u++,this._addSequenceArray(t,l,u),u++,this._closeBracket();continue}else l&&this._newAndPushCurrentLexerNode(nt,u)}else this._pushNodeToChildren(c),this._openBracket(0),this._resetSegment();else if(c===K.CLOSE_BRACKET&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()){this._formulaErrorLastTokenCheck(s,u-1)&&this._formalErrorOccurred(),this._pushNodeToChildren(this._segment),this._resetSegment();const l=this._getCurrentBracket();if(l===0)this._pushNodeToChildren(c);else if(l===1){const f=s[u+1];if(f&&f===K.OPEN_BRACKET){if(!this._setParentCurrentLexerNode()&&u!==a-1)return h.VALUE;this._newAndPushCurrentLexerNode(Bt,u,!0),this._openLambda()}else if(!this._setAncestorCurrentLexerNode()&&u!==a-1)return h.VALUE}else return h.VALUE;this._closeBracket()}else if(c===K.OPEN_BRACES&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()){if(this._pushSegment(c),this._openBraces(),!this._formulaSpellCheck())return h.VALUE}else if(c===K.CLOSE_BRACES&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose())this._pushSegment(c),this._pushNodeToChildren(this._segment),this._resetSegment(),this._closeBraces();else if(c===K.OPEN_SQUARE_BRACKET&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose())this._segment.length>0&&this._openTableBracket(),this._pushSegment(c),this._openSquareBracket();else if(c===K.CLOSE_SQUARE_BRACKET&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose())this._closeSquareBracket(),this.isSquareBracketClose()?(this._pushSegment(c),this._isTableBracket()&&(this._pushNodeToChildren(this._segment),this._resetSegment()),this._closeTableBracket()):this._pushSegment(c);else if(c===K.DOUBLE_QUOTATION&&this.isSingleQuotationClose()&&this.isSquareBracketClose()){if(this.isDoubleQuotationClose())this._openDoubleQuotation();else{const l=s[u+1];l&&l===K.DOUBLE_QUOTATION?u++:this._closeDoubleQuotation()}this._pushSegment(c)}else if(c===K.SINGLE_QUOTATION&&this.isDoubleQuotationClose()){if(this.isSingleQuotationClose())this._openSingleQuotation(),this._segmentCount()===0&&this._resetSegment();else{const l=s[u+1];if(l&&l===K.SINGLE_QUOTATION){this._pushSegment(c),this._addSequenceArray(t,c,u),u++,this._pushSegment(l),this._addSequenceArray(t,l,u),u++;continue}else this._closeSingleQuotation()}this._pushSegment(c)}else if(c===K.COMMA&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isBracesClose()&&this.isSquareBracketClose()){this._formulaErrorLastTokenCheck(s,u-1)&&this._formalErrorOccurred();const l=this._getCurrentBracket();if(l===1||l==null){if(this._pushNodeToChildren(this._segment),this._resetSegment(),!this._setParentCurrentLexerNode()&&u!==a-1&&l!=null)return h.VALUE;this._newAndPushCurrentLexerNode(nt,u)}else{const f=new oe;f.setToken(Xc);const m=new oe;m.setToken(nt),m.changeToParent(f);const d=this._currentLexerNode.getParent();if(d&&d.getToken()===K.COLON){const C=d.getParent();if(!C)return h.VALUE;d.changeToParent(m),C.setChildren([]),f.changeToParent(C)}else return h.VALUE;this._changeCurrentBracket(1),this._pushNodeToChildren(this._segment),this._resetSegment(),this._currentLexerNode=f,this._newAndPushCurrentLexerNode(nt,u)}}else if(c===K.COLON&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isBracesClose()&&this.isSquareBracketClose()){const l=new oe;l.setToken(c);const f=new oe;f.setToken(nt),f.setParent(l);const m=new oe;m.setToken(nt),m.setParent(l),l.getChildren().push(f,m);let d=l,C=0;if(this._segmentCount()>0){let _,E,R=0;const b=this._segment.trim(),N=b[0],V=b[1];if(N===Me.MINUS&&(_=new oe,_.setToken(Me.MINUS),R++),(N===Me.AT||V===Me.AT)&&(E=new oe,E.setToken(Me.AT),_&&(_.addChildren(E),E.setParent(_)),R++),R>0&&(this._segment=b.slice(R)),C=R,E)if(E.addChildren(l),l.setParent(E),E.getParent()){const D=E.getParent();D&&(d=D)}else d=E;else _&&(d=_,_.addChildren(l),l.setParent(_));const S=new oe;S.setToken(this._segment),S.setParent(f),f.getChildren().push(S),this._resetSegment()}else{const _=this._getLastChildCurrentLexerNode();_&&_.changeToParent(f)}this._setCurrentLexerNode(d),this._currentLexerNode=m,this._openColon(C)}else if(qr.has(c)&&this._checkSimilarErrorToken(c,u,s)&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isSquareBracketClose()&&this.isBracesClose()){this._pushNodeToChildren(this._segment);const l=new oe;l.setToken(c);const f=this._getLastChildCurrent();f instanceof oe?f.changeToParent(l):f!==!1&&(l.getChildren().push(f),this._removeLastChild()),this._pushNodeToChildren(l),l.setParent(this._currentLexerNode),this._resetSegment()}else if(lt.has(c)&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isSquareBracketClose()&&this.isBracesClose()){let l=this._segment.trim();if(c===z.MINUS&&l===""){const f=this._findPreviousToken(s,u-1)||"",m=this._findNextToken(s,u+1)||"";if(this._unexpectedEndingTokenExcludeOperator(f)&&this._isOperatorToken(m)){this._pushNodeToChildren("0"),this._pushNodeToChildren(z.MINUS),this._addSequenceArray(t,c,u),this._resetSegment(),u++;continue}else if(this._unexpectedEndingToken(f))if(m===z.PLUS){this._pushSegment(z.MINUS),this._addSequenceArray(t,c,u),this._addSequenceArray(t,z.PLUS,u+1),u+=2;continue}else{this._pushSegment(z.MINUS),this._addSequenceArray(t,c,u),u++;continue}}else if(this._segment.length>0&&this._isScientificNotation(s,u,c)){this._pushSegment(c),this._addSequenceArray(t,c,u),u++;continue}else this._segment.length>0&&l===""?l=this._segment:(this._pushNodeToChildren(this._segment),l="");if(c===z.LESS_THAN||c===z.GREATER_THAN){const f=s[u+1];if(f&&lt.has(c+f)){this._pushNodeToChildren(l+c+f),this._resetSegment(),this._addSequenceArray(t,c,u),u++,this._addSequenceArray(t,f,u),u++;continue}else this._pushNodeToChildren(l+c)}else this._pushNodeToChildren(l+c);this._resetSegment()}else(this._segment!==""||c!==" ")&&this._pushSegment(c);this._addSequenceArray(t,c,u),u++}if(this._pushNodeToChildren(this._segment),this._checkErrorState())return h.VALUE}_isScientificNotation(e,t,r){const n=e[t-2];if(n&&Number.isNaN(Number(n))||!(r===z.MINUS||r===z.PLUS))return!1;const s=e[t+1];if(s&&Number.isNaN(Number(s)))return!1;const a=e[t-1];return a&&a.toUpperCase()==="E"}_addSequenceArray(e,t,r){e==null||e.push({segment:this._segment,currentString:t,cur:r,currentLexerNode:this._currentLexerNode})}getNewFormulaWithPrefix(e,t){return null}}function ll(i,o,e,t,r,n,s){const a=(s==null?void 0:s.f)||"",u=(s==null?void 0:s.si)||"",c=M.isFormulaString(a),l=M.isFormulaId(u),f=i.getValue(r,n),m=(f==null?void 0:f.f)||"",d=(f==null?void 0:f.si)||"";function C(){var _;if(M.isFormulaString(m)&&M.isFormulaId(d)){const E=(_=e==null?void 0:e[d])==null?void 0:_.f;E?t.set(d,E):t.set(d,m)}}c&&l?(d!==u&&C(),i.setValue(r,n,{f:a,si:u}),e[u]={f:a,r,c:n},o.setValue(r,n,{f:a,si:u})):c&&!l?(m!==a&&C(),i.setValue(r,n,{f:a}),o.setValue(r,n,{f:a})):!c&&l?(d!==u&&C(),i.setValue(r,n,{f:"",si:u})):!c&&!l&&i.getValue(r,n)&&(C(),i.realDeleteValue(r,n),o.setValue(r,n,null))}function fl(i,o,e,t){const r=i==null?void 0:i.getValue(e,t);if(r==null)return!0;const n=[];i.forValue((l,f,m)=>{l===e&&f===t||M.Rectangle.intersects(m,r)&&n.push(m)});const{startRow:s,startColumn:a,endRow:u,endColumn:c}=r;for(let l=s;l<=u;l++)for(let f=a;f<=c;f++){let m=!1;const d=M.cellToRange(l,f);n.some(C=>M.Rectangle.contains(C,d)?(m=!0,!0):!1),m||o.realDeleteValue(l,f)}}var ml=Object.getOwnPropertyDescriptor,hl=(i,o,e,t)=>{for(var r=t>1?void 0:t?ml(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},Vi=(i,o)=>(e,t)=>o(e,t,i);w.FormulaDataModel=class extends M.Disposable{constructor(e,t){super();A(this,"_arrayFormulaRange",{});A(this,"_arrayFormulaCellData",{});A(this,"_unitImageFormulaData",{});this._univerInstanceService=e,this._lexerTreeBuilder=t}dispose(){super.dispose(),this._arrayFormulaRange={},this._arrayFormulaCellData={},this._unitImageFormulaData={}}clearPreviousArrayFormulaCellData(e){Object.keys(e).forEach(t=>{const r=e[t];if(r==null)return!0;Object.keys(r).forEach(n=>{var l,f,m,d;const s=r[n],a=(f=(l=this._arrayFormulaRange)==null?void 0:l[t])==null?void 0:f[n];if(a==null)return!0;const u=new M.ObjectMatrix(a);let c=new M.ObjectMatrix;((m=this._arrayFormulaCellData[t])==null?void 0:m[n])!=null&&(c=new M.ObjectMatrix((d=this._arrayFormulaCellData[t])==null?void 0:d[n])),s.forValue((C,_)=>{const E=u.getValue(C,_);if(E==null)return!0;const{startRow:R,startColumn:b,endRow:N,endColumn:V}=E;for(let S=R;S<=N;S++)for(let D=b;D<=V;D++)c.setValue(S,D,null);u.realDeleteValue(C,_)}),this._arrayFormulaCellData[t]&&(this._arrayFormulaCellData[t][n]=c.getData())})})}mergeArrayFormulaCellData(e){Object.keys(e).forEach(t=>{const r=e[t];if(r==null)return!0;this._arrayFormulaRange[t]==null&&(this._arrayFormulaRange[t]={}),this._arrayFormulaCellData[t]==null&&(this._arrayFormulaCellData[t]={}),Object.keys(r).forEach(n=>{var c,l;const s=r[n],a=new M.ObjectMatrix((c=this._arrayFormulaRange[t])==null?void 0:c[n]),u=new M.ObjectMatrix((l=this._arrayFormulaCellData[t])==null?void 0:l[n]);s.forValue((f,m)=>{const d=a==null?void 0:a.getValue(f,m);if(d==null)return!0;const{startRow:C,startColumn:_,endRow:E,endColumn:R}=d;for(let b=C;b<=E;b++)for(let N=_;N<=R;N++)u.setValue(b,N,null)}),s.forValue((f,m,d)=>{u.setValue(f,m,d)}),this._arrayFormulaCellData[t]&&(this._arrayFormulaCellData[t][n]=u.getData())})})}getFormulaData(){const e={},t=this._univerInstanceService.getAllUnitsForType(M.UniverInstanceType.UNIVER_SHEET);return t.length===0||t.forEach(r=>{const n=r.getUnitId();e[n]={},r.getSheets().forEach(a=>{const u=a.getCellMatrix(),c=a.getSheetId();Ss(e,n,c,u)})}),e}getSheetFormulaData(e,t){const r={},n=this._univerInstanceService.getUnit(e);if(n==null)return{};r[e]={};const s=n.getSheetBySheetId(t);if(s==null)return{};const a=s.getCellMatrix();return Ss(r,e,t,a),r[e][t]}getArrayFormulaRange(){return this._arrayFormulaRange}setArrayFormulaRange(e){this._arrayFormulaRange=e}getArrayFormulaCellData(){return this._arrayFormulaCellData}setArrayFormulaCellData(e){this._arrayFormulaCellData=e}getUnitImageFormulaData(){return this._unitImageFormulaData}setUnitImageFormulaData(e){this._unitImageFormulaData=e}mergeArrayFormulaRange(e){Object.keys(e).forEach(t=>{const r=e[t];if(r==null)return!0;this._arrayFormulaRange[t]||(this._arrayFormulaRange[t]={}),Object.keys(r).forEach(n=>{var u;const s=new M.ObjectMatrix(r[n]),a=new M.ObjectMatrix((u=this._arrayFormulaRange[t])==null?void 0:u[n]);s.forValue((c,l,f)=>{a.setValue(c,l,f)}),this._arrayFormulaRange[t]&&(this._arrayFormulaRange[t][n]=a.getData())})})}mergeUnitImageFormulaData(e){const t=Object.keys(e);for(let r=0;r<t.length;r++){const n=t[r],s=e[n];if(!s)continue;this._unitImageFormulaData[n]||(this._unitImageFormulaData[n]={});const a=Object.keys(s);for(let u=0;u<a.length;u++){const c=a[u],l=s[c];l&&(this._unitImageFormulaData[n][c]||(this._unitImageFormulaData[n][c]=new M.ObjectMatrix),l.forValue((f,m,d)=>{this._unitImageFormulaData[n][c].setValue(f,m,d)}))}}}deleteArrayFormulaRange(e,t,r,n){var u;const s=(u=this._arrayFormulaRange[e])==null?void 0:u[t];if(s==null)return;const a=new M.ObjectMatrix(s);a.getValue(r,n)&&(a.realDeleteValue(r,n),this._arrayFormulaRange[e]&&(this._arrayFormulaRange[e][t]=a.getData()))}getCalculateData(){const e=this._univerInstanceService.getAllUnitsForType(M.UniverInstanceType.UNIVER_SHEET),t={},r={},n={};for(const s of e){const a=s.getUnitId(),u=s.getSheets(),c={},l={};for(const f of u){const m=f.getSheetId(),d=f.getConfig();c[m]={cellData:new M.ObjectMatrix(d.cellData),rowCount:d.rowCount,columnCount:d.columnCount,rowData:d.rowData,columnData:d.columnData,defaultRowHeight:d.defaultRowHeight,defaultColumnWidth:d.defaultColumnWidth},l[f.getName()]=f.getSheetId()}t[a]=c,r[a]=s.getStyles(),n[a]=l}return{allUnitData:t,unitStylesData:r,unitSheetNameMap:n}}getHiddenRowsFiltered(){const e=this._univerInstanceService.getAllUnitsForType(M.UniverInstanceType.UNIVER_SHEET),t={};for(const r of e){const n=r.getUnitId(),s=r.getSheets();t[n]={};for(const a of s){const u=a.getSheetId();t[n][u]={};const c=0,l=a.getRowCount()-1,f={};for(let m=c;m<=l;m++)a.getRowVisible(m)||(f[m]={hd:M.BooleanNumber.TRUE});t[n][u]=f}}return t}updateFormulaData(e,t,r){const n=new M.ObjectMatrix(r),s=this._getSheetFormulaIdMap(e,t),a=new Map,u=this.getFormulaData();u[e]==null&&(u[e]={});const c=u[e];c[t]==null&&(c[t]={});const l=new M.ObjectMatrix(c[t]||{}),f=new M.ObjectMatrix;return n.forValue((m,d,C)=>{ll(l,f,s,a,m,d,C)}),l.forValue((m,d,C)=>{const _=(C==null?void 0:C.f)||"",E=(C==null?void 0:C.si)||"";if(M.isFormulaId(E)){const R=s==null?void 0:s[E],b=a.get(E);if(R&&!M.isFormulaString(_)){const N=R.f,V=d-R.c,S=m-R.r;l.setValue(m,d,{f:N,si:E,x:V,y:S}),f.setValue(m,d,{f:N,si:E,x:V,y:S})}else if(typeof b=="string"){const N=(C==null?void 0:C.x)||0,V=(C==null?void 0:C.y)||0,S=this._lexerTreeBuilder.moveFormulaRefOffset(b,N,V);a.set(E,{r:m,c:d,f:S}),l.setValue(m,d,{f:S,si:E}),f.setValue(m,d,{f:S,si:E})}else if(typeof b=="object"){const N=d-b.c,V=m-b.r;l.setValue(m,d,{f:b.f,si:E,x:N,y:V}),f.setValue(m,d,{f:b.f,si:E,x:N,y:V})}}}),f.getMatrix()}updateArrayFormulaRange(e,t,r){var u;const n=(u=this._arrayFormulaRange[e])==null?void 0:u[t];if(!n)return;const s=new M.ObjectMatrix(n);new M.ObjectMatrix(r).forValue((c,l,f)=>{s.realDeleteValue(c,l)})}updateArrayFormulaCellData(e,t,r){var l,f;const n=(l=this._arrayFormulaRange[e])==null?void 0:l[t];if(!n)return;const s=new M.ObjectMatrix(n),a=(f=this._arrayFormulaCellData[e])==null?void 0:f[t];if(!a)return;const u=new M.ObjectMatrix(a);new M.ObjectMatrix(r).forValue((m,d,C)=>{fl(s,u,m,d)})}updateImageFormulaData(e,t,r){var a;const n=(a=this._unitImageFormulaData[e])==null?void 0:a[t];if(!n)return;new M.ObjectMatrix(r).forValue((u,c)=>{n.realDeleteValue(u,c)})}getFormulaStringByCell(e,t,r,n){const s=this._univerInstanceService.getUnit(n);if(s==null)return null;const a=s.getSheetBySheetId(r);if(a==null)return null;const u=a.getCellMatrix(),c=u.getValue(e,t);if(c==null)return null;const{f:l,si:f}=c;if(M.isFormulaString(l))return l;if(M.isFormulaId(f)){let m=null;return u.forValue((d,C,_)=>{if(_==null)return!0;const{f:E,si:R}=_;if(M.isFormulaString(E)&&f===R)return m=this._lexerTreeBuilder.moveFormulaRefOffset(E,t-C,e-d),!1}),m}return null}getFormulaDirtyRanges(){const e=this.getFormulaData(),t=[];for(const r in e){const n=e[r];if(!n)continue;const s=this._univerInstanceService.getUnit(r);if(s)for(const a in n){const u=n[a];if(!u)continue;const c=s.getSheetBySheetId(a);if(!c)continue;const l={};for(const f of Object.keys(u)){const m=Number(f);for(const d in u[m]){const C=Number(d),_=c.getCellRaw(m,C),E=M.isFormulaString(_==null?void 0:_.f)||M.isFormulaId(_==null?void 0:_.si),R=(_==null?void 0:_.v)===void 0;if(!(E&&R))continue;l[C]||(l[C]=[]);const b=l[C].slice(-1)[0];b&&b.endRow===m-1?b.endRow=m:l[C].push({startRow:m,endRow:m})}}for(const f in l){const m=l[f];for(let d=0;d<m.length;d++){const C=m[d];t.push({unitId:r,sheetId:a,range:{rangeType:M.RANGE_TYPE.NORMAL,startRow:C.startRow,endRow:C.endRow,startColumn:Number(f),endColumn:Number(f)}})}}}}return t}_getSheetFormulaIdMap(e,t){const r={},n=this._univerInstanceService.getUnit(e);if(n==null)return r;const s=n.getSheetBySheetId(t);return s==null||s.getCellMatrix().forValue((u,c,l)=>{if(l==null)return!0;const{f,si:m}=l;M.isFormulaString(f)&&M.isFormulaId(m)&&(r[m]={f,r:u,c})}),r}},w.FormulaDataModel=hl([Vi(0,M.IUniverInstanceService),Vi(1,M.Inject(Dr))],w.FormulaDataModel);function Ss(i,o,e,t){i[o]||(i[o]={}),i[o][e]||(i[o][e]={});const r=new Map,n=new M.ObjectMatrix(i[o][e]);t.forValue((a,u,c)=>{const l=(c==null?void 0:c.f)||"",f=(c==null?void 0:c.si)||"",m=M.isFormulaString(l),d=M.isFormulaId(f);m&&d?(n.setValue(a,u,{f:l,si:f}),r.set(f,{f:l,r:a,c:u})):m&&!d?n.setValue(a,u,{f:l}):!m&&d&&n.setValue(a,u,{f:"",si:f})}),n.forValue((a,u,c)=>{const l=(c==null?void 0:c.f)||"",f=(c==null?void 0:c.si)||"";if(M.isFormulaId(f)&&!M.isFormulaString(l)){const m=r.get(f);if(m){const d=m.f,C=u-m.c,_=a-m.r;n.setValue(a,u,{f:d,si:f,x:C,y:_})}else n.realDeleteValue(a,u)}});const s=n.getMatrix();return{[o]:{[e]:s}}}const gl=class ka{constructor(o,e){this.low=o,this.high=e}clone(){return new ka(this.low,this.high)}get max(){return this.clone()}less_than(o){return this.low<o.low||this.low===o.low&&this.high<o.high}equal_to(o){return this.low===o.low&&this.high===o.high}intersect(o){return!this.not_intersect(o)}not_intersect(o){return this.high<o.low||o.high<this.low}merge(o){return new ka(this.low===void 0?o.low:this.low<o.low?this.low:o.low,this.high===void 0?o.high:this.high>o.high?this.high:o.high)}output(){return[this.low,this.high]}static comparable_max(o,e){return o.merge(e)}static comparable_less_than(o,e){return o<e}},xe=0,Re=1;class Ht{constructor(o=void 0,e=void 0,t=null,r=null,n=null,s=Re){if(this.left=t,this.right=r,this.parent=n,this.color=s,this.item={key:o,value:e},o&&o instanceof Array&&o.length===2&&!Number.isNaN(o[0])&&!Number.isNaN(o[1])){let[a,u]=o;a>u&&([a,u]=[u,a]),this.item.key=new gl(a,u)}this.max=this.item.key?this.item.key.max:void 0}isNil(){return this.item.key===void 0&&this.item.value===void 0&&this.left===null&&this.right===null&&this.color===Re}_value_less_than(o){return this.item.value&&o.item.value&&this.item.value.less_than?this.item.value.less_than(o.item.value):this.item.value<o.item.value}less_than(o){return this.item.value===this.item.key&&o.item.value===o.item.key?this.item.key.less_than(o.item.key):this.item.key.less_than(o.item.key)||this.item.key.equal_to(o.item.key)&&this._value_less_than(o)}_value_equal(o){return this.item.value&&o.item.value&&this.item.value.equal_to?this.item.value.equal_to(o.item.value):this.item.value===o.item.value}equal_to(o){return this.item.value===this.item.key&&o.item.value===o.item.key?this.item.key.equal_to(o.item.key):this.item.key.equal_to(o.item.key)&&this._value_equal(o)}intersect(o){return this.item.key.intersect(o.item.key)}copy_data(o){this.item.key=o.item.key,this.item.value=o.item.value}update_max(){if(this.max=this.item.key?this.item.key.max:void 0,this.right&&this.right.max){const o=this.item.key.constructor.comparable_max;this.max=o(this.max,this.right.max)}if(this.left&&this.left.max){const o=this.item.key.constructor.comparable_max;this.max=o(this.max,this.left.max)}}not_intersect_left_subtree(o){const e=this.item.key.constructor.comparable_less_than;let t=this.left.max.high!==void 0?this.left.max.high:this.left.max;return e(t,o.item.key.low)}not_intersect_right_subtree(o){const e=this.item.key.constructor.comparable_less_than;let t=this.right.max.low!==void 0?this.right.max.low:this.right.item.key.low;return e(o.item.key.high,t)}}class Ms{constructor(){this.root=null,this.nil_node=new Ht}get size(){let o=0;return this.tree_walk(this.root,()=>o++),o}get keys(){let o=[];return this.tree_walk(this.root,e=>o.push(e.item.key.output?e.item.key.output():e.item.key)),o}get values(){let o=[];return this.tree_walk(this.root,e=>o.push(e.item.value)),o}get items(){let o=[];return this.tree_walk(this.root,e=>o.push({key:e.item.key.output?e.item.key.output():e.item.key,value:e.item.value})),o}isEmpty(){return this.root==null||this.root===this.nil_node}clear(){this.root=null}insert(o,e=o){if(o===void 0)return;let t=new Ht(o,e,this.nil_node,this.nil_node,null,xe);return this.tree_insert(t),this.recalc_max(t),t}exist(o,e=o){let t=new Ht(o,e);return!!this.tree_search(this.root,t)}remove(o,e=o){let t=new Ht(o,e),r=this.tree_search(this.root,t);return r&&this.tree_delete(r),r}search(o,e=(t,r)=>t===r?r.output():t){let t=new Ht(o),r=[];return this.tree_search_interval(this.root,t,r),r.map(n=>e(n.item.value,n.item.key))}intersect_any(o){let e=new Ht(o);return this.tree_find_any_interval(this.root,e)}forEach(o){this.tree_walk(this.root,e=>o(e.item.key,e.item.value))}map(o){const e=new Ms;return this.tree_walk(this.root,t=>e.insert(t.item.key,o(t.item.value,t.item.key))),e}*iterate(o,e=(t,r)=>t===r?r.output():t){let t;for(o?t=this.tree_search_nearest_forward(this.root,new Ht(o)):this.root&&(t=this.local_minimum(this.root));t;)yield e(t.item.value,t.item.key),t=this.tree_successor(t)}recalc_max(o){let e=o;for(;e.parent!=null;)e.parent.update_max(),e=e.parent}tree_insert(o){let e=this.root,t=null;if(this.root==null||this.root===this.nil_node)this.root=o;else{for(;e!==this.nil_node;)t=e,o.less_than(e)?e=e.left:e=e.right;o.parent=t,o.less_than(t)?t.left=o:t.right=o}this.insert_fixup(o)}insert_fixup(o){let e,t;for(e=o;e!==this.root&&e.parent.color===xe;)e.parent===e.parent.parent.left?(t=e.parent.parent.right,t.color===xe?(e.parent.color=Re,t.color=Re,e.parent.parent.color=xe,e=e.parent.parent):(e===e.parent.right&&(e=e.parent,this.rotate_left(e)),e.parent.color=Re,e.parent.parent.color=xe,this.rotate_right(e.parent.parent))):(t=e.parent.parent.left,t.color===xe?(e.parent.color=Re,t.color=Re,e.parent.parent.color=xe,e=e.parent.parent):(e===e.parent.left&&(e=e.parent,this.rotate_right(e)),e.parent.color=Re,e.parent.parent.color=xe,this.rotate_left(e.parent.parent)));this.root.color=Re}tree_delete(o){let e,t;o.left===this.nil_node||o.right===this.nil_node?e=o:e=this.tree_successor(o),e.left!==this.nil_node?t=e.left:t=e.right,t.parent=e.parent,e===this.root?this.root=t:(e===e.parent.left?e.parent.left=t:e.parent.right=t,e.parent.update_max()),this.recalc_max(t),e!==o&&(o.copy_data(e),o.update_max(),this.recalc_max(o)),e.color===Re&&this.delete_fixup(t)}delete_fixup(o){let e=o,t;for(;e!==this.root&&e.parent!=null&&e.color===Re;)e===e.parent.left?(t=e.parent.right,t.color===xe&&(t.color=Re,e.parent.color=xe,this.rotate_left(e.parent),t=e.parent.right),t.left.color===Re&&t.right.color===Re?(t.color=xe,e=e.parent):(t.right.color===Re&&(t.color=xe,t.left.color=Re,this.rotate_right(t),t=e.parent.right),t.color=e.parent.color,e.parent.color=Re,t.right.color=Re,this.rotate_left(e.parent),e=this.root)):(t=e.parent.left,t.color===xe&&(t.color=Re,e.parent.color=xe,this.rotate_right(e.parent),t=e.parent.left),t.left.color===Re&&t.right.color===Re?(t.color=xe,e=e.parent):(t.left.color===Re&&(t.color=xe,t.right.color=Re,this.rotate_left(t),t=e.parent.left),t.color=e.parent.color,e.parent.color=Re,t.left.color=Re,this.rotate_right(e.parent),e=this.root));e.color=Re}tree_search(o,e){if(!(o==null||o===this.nil_node))return e.equal_to(o)?o:e.less_than(o)?this.tree_search(o.left,e):this.tree_search(o.right,e)}tree_search_nearest_forward(o,e){let t,r=o;for(;r&&r!==this.nil_node;)r.less_than(e)?r.intersect(e)?(t=r,r=r.left):r=r.right:((!t||r.less_than(t))&&(t=r),r=r.left);return t||null}tree_search_interval(o,e,t){o!=null&&o!==this.nil_node&&(o.left!==this.nil_node&&!o.not_intersect_left_subtree(e)&&this.tree_search_interval(o.left,e,t),o.intersect(e)&&t.push(o),o.right!==this.nil_node&&!o.not_intersect_right_subtree(e)&&this.tree_search_interval(o.right,e,t))}tree_find_any_interval(o,e){let t=!1;return o!=null&&o!==this.nil_node&&(o.left!==this.nil_node&&!o.not_intersect_left_subtree(e)&&(t=this.tree_find_any_interval(o.left,e)),t||(t=o.intersect(e)),!t&&o.right!==this.nil_node&&!o.not_intersect_right_subtree(e)&&(t=this.tree_find_any_interval(o.right,e))),t}local_minimum(o){let e=o;for(;e.left!=null&&e.left!==this.nil_node;)e=e.left;return e}local_maximum(o){let e=o;for(;e.right!=null&&e.right!==this.nil_node;)e=e.right;return e}tree_successor(o){let e,t,r;if(o.right!==this.nil_node)e=this.local_minimum(o.right);else{for(t=o,r=o.parent;r!=null&&r.right===t;)t=r,r=r.parent;e=r}return e}rotate_left(o){let e=o.right;o.right=e.left,e.left!==this.nil_node&&(e.left.parent=o),e.parent=o.parent,o===this.root?this.root=e:o===o.parent.left?o.parent.left=e:o.parent.right=e,e.left=o,o.parent=e,o!=null&&o!==this.nil_node&&o.update_max(),e=o.parent,e!=null&&e!==this.nil_node&&e.update_max()}rotate_right(o){let e=o.left;o.left=e.right,e.right!==this.nil_node&&(e.right.parent=o),e.parent=o.parent,o===this.root?this.root=e:o===o.parent.left?o.parent.left=e:o.parent.right=e,e.right=o,o.parent=e,o!==null&&o!==this.nil_node&&o.update_max(),e=o.parent,e!=null&&e!==this.nil_node&&e.update_max()}tree_walk(o,e){o!=null&&o!==this.nil_node&&(this.tree_walk(o.left,e),e(o),this.tree_walk(o.right,e))}testRedBlackProperty(){let o=!0;return this.tree_walk(this.root,function(e){e.color===xe&&(e.left.color===Re&&e.right.color===Re||(o=!1))}),o}testBlackHeightProperty(o){let e=0,t=0,r=0;if(o.color===Re&&e++,o.left!==this.nil_node?t=this.testBlackHeightProperty(o.left):t=1,o.right!==this.nil_node?r=this.testBlackHeightProperty(o.right):r=1,t!==r)throw new Error("Red-black height property violated");return e+=t,e}}const Ds=Symbol("EMPTY_CELL");class dl{constructor(){A(this,"_cache",new Map);A(this,"_continueBuildingCache",new Map)}set(o,e,t,r,n,s=!1){if(!this.shouldContinueBuildingCache(o,e,t,n)&&!s)return;let a=this._cache.get(o);a==null&&(a=new Map,this._cache.set(o,a));let u=a.get(e);u==null&&(u=new Map,a.set(e,u));let c=u.get(t);if(c==null&&(c=new Map,u.set(t,c)),s){for(const[m,d]of c)if(d.has(n)){d.delete(n);break}}let l=typeof r=="string"?r.toLowerCase():r;(l===""||l===null)&&(l=Ds);let f=c.get(l);f==null&&(f=new Set,c.set(l,f)),f.add(n)}getCellValuePositions(o,e,t){var r,n;return(n=(r=this._cache.get(o))==null?void 0:r.get(e))==null?void 0:n.get(t)}getCellPositions(o,e,t,r,n){var u,c,l;let s=typeof r=="string"?r.toLowerCase():r;(s===""||s===null)&&(s=Ds);const a=(l=(c=(u=this._cache.get(o))==null?void 0:u.get(e))==null?void 0:c.get(t))==null?void 0:l.get(s);return a&&[...a].filter(f=>n.some(([m,d])=>f>=m&&f<=d))}setContinueBuildingCache(o,e,t,r,n){if(t===-1||r===-1||n===-1)return;let s=this._continueBuildingCache.get(o);s==null&&(s=new Map,this._continueBuildingCache.set(o,s));let a=s.get(e);a==null&&(a=new Map,s.set(e,a));let u=a.get(t);if(u==null){u=new Ms,u.insert([r,n]),a.set(t,u);return}this._handleNewInterval(u,r,n)}shouldContinueBuildingCache(o,e,t,r){var a,u;if(t===-1||r===-1)return!1;const n=(u=(a=this._continueBuildingCache.get(o))==null?void 0:a.get(e))==null?void 0:u.get(t);return n?n.search([r,r]).length===0:!0}canUseCache(o,e,t,r,n){var f,m;const s=(m=(f=this._continueBuildingCache.get(o))==null?void 0:f.get(e))==null?void 0:m.get(t);if(t===-1||r===-1||n===-1||!s)return{rowsInCache:[],rowsNotInCache:[]};const a=s.search([r,n]);if(a.length===0)return{rowsInCache:[],rowsNotInCache:[]};a.sort((d,C)=>d[0]-C[0]);const u=[],c=[];let l=r;for(let d=0;d<a.length;d++){const[C,_]=a[d];if(l>=C){if(n<=_){u.push([l,n]);break}u.push([l,_]),l=_+1,d===a.length-1&&l<=n&&c.push([l,n])}else{if(n>_){u.push([C,_]),c.push([l,C-1]),l=_+1,d===a.length-1&&l<=n&&c.push([l,n]);continue}u.push([C,n]),c.push([l,C-1])}}return{rowsInCache:u,rowsNotInCache:c}}clear(){this._cache.clear(),this._continueBuildingCache.clear()}_handleNewInterval(o,e,t){let r=o.search([e,t]);if(r.length===0){const a=[e-1<0?0:e-1,t+1];if(r=o.search(a),r.length===0){o.insert([e,t]);return}}let n=e,s=t;for(const a of r)n=Math.min(n,a[0]),s=Math.max(s,a[1]),o.remove(a);o.insert([n,s])}}const Ge=new dl,fn="engine-formula.config",Oi=1,Cl="CYCLE_REFERENCE_COUNT",Si={};class Mi extends M.Disposable{constructor(){super(...arguments);A(this,"_getRowFilteredCallback")}register(e){this._getRowFilteredCallback=e}getRowFiltered(e,t,r){var n;return this._getRowFilteredCallback&&(n=this._getRowFilteredCallback(e,t,r))!=null?n:!1}}const ws=M.createIdentifier("univer.formula.sheet-row-filtered.service");var _l=Object.getOwnPropertyDescriptor,Al=(i,o,e,t)=>{for(var r=t>1?void 0:t?_l(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},mn=(i,o)=>(e,t)=>o(e,t,i);w.FormulaCurrentConfigService=class extends M.Disposable{constructor(e,t,r,n){super();A(this,"_unitData",{});A(this,"_unitStylesData",{});A(this,"_arrayFormulaCellData",{});A(this,"_arrayFormulaRange",{});A(this,"_formulaData",{});A(this,"_sheetNameMap",{});A(this,"_forceCalculate",!1);A(this,"_clearDependencyTreeCache",{});A(this,"_dirtyRanges",[]);A(this,"_dirtyNameMap",{});A(this,"_dirtyDefinedNameMap",{});A(this,"_dirtyUnitFeatureMap",{});A(this,"_dirtyUnitOtherFormulaMap",{});A(this,"_excludedCell");A(this,"_sheetIdToNameMap",{});A(this,"_executeUnitId","");A(this,"_executeSubUnitId","");this._univerInstanceService=e,this._localeService=t,this._formulaDataModel=r,this._sheetRowFilteredService=n}dispose(){super.dispose(),this._unitData={},this._unitStylesData={},this._arrayFormulaCellData={},this._arrayFormulaRange={},this._formulaData={},this._sheetNameMap={},this._clearDependencyTreeCache={},this._dirtyRanges=[],this._dirtyNameMap={},this._dirtyDefinedNameMap={},this._dirtyUnitFeatureMap={},this._dirtyUnitOtherFormulaMap={},this._excludedCell={},this._sheetIdToNameMap={}}getExecuteUnitId(){return this._executeUnitId}getExecuteSubUnitId(){return this._executeSubUnitId}setExecuteUnitId(e){this._executeUnitId=e}setExecuteSubUnitId(e){this._executeSubUnitId=e}getExcludedRange(){return this._excludedCell}getUnitData(){return this._unitData}getUnitStylesData(){return this._unitStylesData}getFormulaData(){return this._formulaData}getArrayFormulaCellData(){return this._arrayFormulaCellData}getArrayFormulaRange(){return this._arrayFormulaRange}getSheetNameMap(){return this._sheetNameMap}isForceCalculate(){return this._forceCalculate}getDirtyRanges(){return this._dirtyRanges}getDirtyNameMap(){return this._dirtyNameMap}getDirtyDefinedNameMap(){return this._dirtyDefinedNameMap}getDirtyUnitFeatureMap(){return this._dirtyUnitFeatureMap}getDirtyUnitOtherFormulaMap(){return this._dirtyUnitOtherFormulaMap}getSheetName(e,t){return this._sheetIdToNameMap[e]==null?"":this._sheetIdToNameMap[e][t]||""}setSheetNameMap(e){this._sheetIdToNameMap=e}getClearDependencyTreeCache(){return this._clearDependencyTreeCache}getLocale(){return this._localeService.getCurrentLocale()}getSheetsInfo(){const e=this._univerInstanceService.getCurrentUnitForType(M.UniverInstanceType.UNIVER_SHEET),{id:t,sheetOrder:r}=e.getSnapshot();return{sheetOrder:r,sheetNameMap:this._sheetIdToNameMap[t]}}getSheetRowColumnCount(e,t){const r=this._univerInstanceService.getUnit(e),n=r==null?void 0:r.getSheetBySheetId(t),s=n==null?void 0:n.getSnapshot();if(!s)return{rowCount:0,columnCount:0};const{rowCount:a,columnCount:u}=s;return{rowCount:a,columnCount:u}}getFilteredOutRows(e,t,r,n){const s=[];for(let a=r;a<=n;a++)this._sheetRowFilteredService.getRowFiltered(e,t,a)&&s.push(a);return s}load(e){if(e.allUnitData&&e.unitSheetNameMap&&e.unitStylesData)this._unitData=e.allUnitData,this._unitStylesData=e.unitStylesData,this._sheetNameMap=e.unitSheetNameMap;else{const{allUnitData:t,unitSheetNameMap:r,unitStylesData:n}=this._loadSheetData();this._unitData=t,this._unitStylesData=n,this._sheetNameMap=r}e.rowData&&this._applyUnitRowData(e.rowData),this._formulaData=e.formulaData,this._arrayFormulaCellData=fi(e.arrayFormulaCellData),this._arrayFormulaRange=e.arrayFormulaRange,this._forceCalculate=e.forceCalculate,this._clearDependencyTreeCache=e.clearDependencyTreeCache||{},this._dirtyRanges=e.dirtyRanges,this._dirtyNameMap=e.dirtyNameMap,this._dirtyDefinedNameMap=e.dirtyDefinedNameMap,this._dirtyUnitFeatureMap=e.dirtyUnitFeatureMap,this._dirtyUnitOtherFormulaMap=e.dirtyUnitOtherFormulaMap,this._excludedCell=e.excludedCell,this._mergeNameMap(this._sheetNameMap,this._dirtyNameMap)}getDirtyData(){return{forceCalculation:this._forceCalculate,dirtyRanges:this._dirtyRanges,dirtyNameMap:this._dirtyNameMap,dirtyDefinedNameMap:this._dirtyDefinedNameMap,dirtyUnitFeatureMap:this._dirtyUnitFeatureMap,dirtyUnitOtherFormulaMap:this._dirtyUnitOtherFormulaMap,clearDependencyTreeCache:this._clearDependencyTreeCache}}loadDirtyRangesAndExcludedCell(e,t){this._dirtyRanges=e,this._excludedCell=t,this._dirtyNameMap={}}registerUnitData(e){this._unitData=e}registerFormulaData(e){this._formulaData=e}registerSheetNameMap(e){this._sheetNameMap=e}_mergeNameMap(e,t){Object.keys(t).forEach(r=>{t[r]&&Object.keys(t[r]).forEach(n=>{e[r]==null&&(e[r]={}),e[r][t[r][n]]=n})}),this._sheetIdToNameMap={},Object.keys(e).forEach(r=>{Object.keys(e[r]).forEach(n=>{this._sheetIdToNameMap[r]==null&&(this._sheetIdToNameMap[r]={}),this._sheetIdToNameMap[r][e[r][n]]=n})})}_loadSheetData(){const e=this._univerInstanceService.getCurrentUnitForType(M.UniverInstanceType.UNIVER_SHEET),t=e==null?void 0:e.getActiveSheet();return this._executeUnitId=e==null?void 0:e.getUnitId(),this._executeSubUnitId=t==null?void 0:t.getSheetId(),this._formulaDataModel.getCalculateData()}_applyUnitRowData(e){for(const t in e)if(e[t]!=null)for(const r in e[t])e[t][r]!=null&&(this._unitData[t]==null&&(this._unitData[t]={}),this._unitData[t][r]==null&&(this._unitData[t][r]={cellData:new M.ObjectMatrix({}),rowCount:0,columnCount:0,rowData:{},columnData:{}}),this._unitData[t][r].rowData=e[t][r])}},w.FormulaCurrentConfigService=Al([mn(0,M.IUniverInstanceService),mn(1,M.Inject(M.LocaleService)),mn(2,M.Inject(w.FormulaDataModel)),mn(3,M.Inject(ws))],w.FormulaCurrentConfigService);const Nt=M.createIdentifier("univer.formula.current-data.service");var El=Object.getOwnPropertyDescriptor,Rl=(i,o,e,t)=>{for(var r=t>1?void 0:t?El(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},Ls=(i,o)=>(e,t)=>o(e,t,i);w.Lexer=class extends M.Disposable{constructor(o,e,t){super(),this._definedNamesService=o,this._lexerTreeBuilder=e,this._formulaCurrentConfigService=t}treeBuilder(o,e=!0){const t=this._definedNamesService.getAllDefinedNames();return this._isDeepDefinedNameMapEmpty(t)?this._lexerTreeBuilder.treeBuilder(o,e):this._lexerTreeBuilder.treeBuilder(o,e,{unitId:this._formulaCurrentConfigService.getExecuteUnitId(),getValueByName:this._definedNamesService.getValueByName.bind(this._definedNamesService),getDirtyDefinedNameMap:this._formulaCurrentConfigService.getDirtyDefinedNameMap.bind(this._formulaCurrentConfigService),getSheetName:this._formulaCurrentConfigService.getSheetName.bind(this._formulaCurrentConfigService)})}_isDeepDefinedNameMapEmpty(o){for(const e in o)if(Object.keys(o[e]).length>0)return!1;return!0}},w.Lexer=Rl([Ls(0,kt),Ls(1,M.Inject(Dr)),Ls(2,Nt)],w.Lexer);function hn(i){if(i==null)return!0;const{v:o,f:e,si:t,p:r}=i;return!(!(o==null||typeof o=="string"&&o.length===0)||e!=null&&e.length>0||t!=null&&t.length>0||r!=null)}class gn{constructor(){A(this,"pattern","")}dispose(){}getPattern(){return this.pattern}setPattern(o){this.pattern=o}isError(){return!1}isAsyncObject(){return!1}isAsyncArrayObject(){return!1}isReferenceObject(){return!1}isArray(){return!1}isValueObject(){return!1}isEqualType(o){return!1}}function bl(i){var o;if(i===null)return 0;if(i!=null&&i.p){const e=i==null?void 0:i.p.body;if(e==null)return 0;const t=e.dataStream;return M.BuildTextUtils.transform.getPlainText(t)}return(o=i==null?void 0:i.v)!=null?o:0}function yl(i,o=!1){return!o&&!(M.isFormulaString(i==null?void 0:i.f)||M.isFormulaId(i==null?void 0:i.si))?null:typeof(i==null?void 0:i.v)=="string"&&Dt.has(i.v)?i.v:null}function Di(i,o,e,t,r){var s;const n=Object.keys(r);for(const a of n){const u=r[a],c=(s=u==null?void 0:u[t])==null?void 0:s[e];if(c==null)continue;const l=c.getValue(i,o);if(l!=null)return l}}var Gt=(i=>(i[i.MIN=0]="MIN",i[i.MAX=1]="MAX",i))(Gt||{}),Le=(i=>(i[i.NORMAL=0]="NORMAL",i[i.MIN=1]="MIN",i[i.MAX=2]="MAX",i))(Le||{});function dn(){return Intl&&Intl.Collator?new Intl.Collator(void 0,{numeric:!1}).compare:(i,o)=>i.localeCompare(o)}function wi(i){return i.indexOf("*")>-1||i.indexOf("?")>-1}function Ps(i,o){const e=pl(o).replace(/~?[*?]/g,r=>r.startsWith("~")?`\\${r.substring(1)}`:r==="*"?".*":r==="?"?".":r);return new RegExp(`^${e}$`).test(i)}function Li(i){return i.replace(/~?[*?]/g,o=>o.startsWith("~")?o.substring(1):" ")}function Nl(i,o,e){let t=!1;switch(e){case H.EQUALS:t=Ps(i,o);break;case H.NOT_EQUAL:t=!Ps(i,o);break;case H.GREATER_THAN:case H.GREATER_THAN_OR_EQUAL:t=Ps(i,o)||i>Li(o);break;case H.LESS_THAN:case H.LESS_THAN_OR_EQUAL:t=i<Li(o);break}return t}function pl(i){return i.replace(/[.+^${}()|[\]\\]/g,"\\$&")}function js(i){switch(i){case 1:return 2;case 0:return 0;case-1:return 1;default:return 0}}function xs(i){return i===-2?1:0}const Vl=["$","£","¥","¤","֏","؋","৳","฿","៛","₡","₦","₩","₪","₫","€","₭","₮","₱","₲","₴","₸","₹","₺","₼","₽","₾","₿"],Ol={currency:2,date:4,datetime:5,error:11,fraction:7,general:0,grouped:11,number:1,percent:6,scientific:8,text:9,time:5,unknown:11};function Sl(i,o,e){var u,c;if(i==null||o==null)return o;const t=(e==null?void 0:e.getStyleByCell(i))||i.s,r=(e==null?void 0:e.getStyleByCell(o))||o.s;if(t==null||r==null||typeof t!="object"||typeof r!="object")return o;const n=(u=t==null?void 0:t.n)==null?void 0:u.pattern,s=(c=r==null?void 0:r.n)==null?void 0:c.pattern;if(n==null||s==null)return o;const a=n||s;return r.n.pattern=a,o}const Us=new yt(1e5);function Pi(i){const o=Us.get(i);if(o!==void 0)return o;const e=Dl(i);return Us.set(i,e),e}function Ml(){Us.clear()}function Dl(i){if(wl(i))return 3;const o=M.numfmt.getFormatInfo(i).type||"unknown";return Ol[o]}function wl(i){return!!Vl.find(o=>i.includes(o))&&i.startsWith("_(")}function Cn(i,o,e){if(i==="")return o;if(o==="")return i;const t=Pi(i),r=Pi(o);return e===z.PLUS||e===z.MINUS?t===4&&r===4||t===11&&r===11?"":o:e===z.MULTIPLY||e===z.DIVIDED?t===6&&r===6||t===7&&r===7||t===8&&r===8||t===9&&r===9?o:"":i||o}const Ll=new Map([[M.LocaleType.EN_US,"$"],[M.LocaleType.RU_RU,"₽"],[M.LocaleType.VI_VN,"₫"],[M.LocaleType.ZH_CN,"¥"],[M.LocaleType.ZH_TW,"NT$"],[M.LocaleType.FR_FR,"€"],[M.LocaleType.FA_IR,"﷼"],[M.LocaleType.KO_KR,"₩"],[M.LocaleType.ES_ES,"€"],[M.LocaleType.CA_ES,"€"]]);function ji(i){return Ll.get(i)||"$"}function We(i,o=2){let e=o;o>127&&(e=127);let t="";return e>0&&(t=`.${"0".repeat(e)}`),`"${ji(i)}"#,##0${t}_);[Red]("${ji(i)}"#,##0${t})`}function Pl(i,o,e=2){return M.numfmt.format(We(i,e),o)}const Ts=new yt(1e5);function jl(i){let o=i;o.startsWith('"')&&o.endsWith('"')&&(o=o.slice(1,-1));const e=Ts.get(o);if(e)return{isNumberPattern:!0,value:e.value,pattern:e.pattern};const t=M.numfmt.parseNumber(o);if(t&&t.z)return vs(o,t.v,t.z);const r=M.numfmt.parseDate(o);if(r&&r.z)return vs(o,r.v,r.z);const n=M.numfmt.parseTime(o);return n&&n.z?vs(o,n.v,n.z):{isNumberPattern:!1}}function vs(i,o,e){return Ts.set(i,{value:o,pattern:e}),{isNumberPattern:!0,value:o,pattern:e}}function xl(){Ts.clear()}class pt extends gn{constructor(e){super();A(this,"_customData");this._rawValue=e}isValueObject(){return!0}toUnitRange(){return{range:{startColumn:-1,startRow:-1,endRow:-1,endColumn:-1},sheetId:"",unitId:""}}getValue(){return 0}getArrayValue(){return[]}setValue(e){}setArrayValue(e){}withCustomData(e){return this._customData=e,this}getCustomData(){return this._customData}isCube(){return!1}isString(){return!1}isNumber(){return!1}isBoolean(){return!1}isLambda(){return!1}isDateFormat(){return!1}isError(){return!1}isNull(){return!1}isHyperlink(){return!1}isImage(){return!1}sum(){return g.create(h.VALUE)}max(){return g.create(h.VALUE)}min(){return g.create(h.VALUE)}count(){return g.create(h.VALUE)}countA(){return g.create(h.VALUE)}countBlank(){return g.create(h.VALUE)}getNegative(){return g.create(h.VALUE)}getReciprocal(){return g.create(h.VALUE)}plus(e){return g.create(h.VALUE)}minus(e){return g.create(h.VALUE)}multiply(e){return g.create(h.VALUE)}divided(e){return g.create(h.VALUE)}mod(e){return g.create(h.VALUE)}map(e){return g.create(h.NAME)}mapValue(e){return g.create(h.NAME)}compare(e,t,r=!1){return g.create(h.NAME)}isEqual(e){return this.compare(e,H.EQUALS)}isNotEqual(e){return this.compare(e,H.NOT_EQUAL)}isGreaterThanOrEqual(e){return this.compare(e,H.GREATER_THAN_OR_EQUAL)}isLessThanOrEqual(e){return this.compare(e,H.LESS_THAN_OR_EQUAL)}isLessThan(e){return this.compare(e,H.LESS_THAN)}isGreaterThan(e){return this.compare(e,H.GREATER_THAN)}concatenateFront(e){return g.create(h.NAME)}concatenateBack(e){return g.create(h.NAME)}plusBy(e){return g.create(h.VALUE)}minusBy(e){return g.create(h.VALUE)}multiplyBy(e){return g.create(h.VALUE)}dividedBy(e){return g.create(h.VALUE)}modInverse(e){return g.create(h.VALUE)}compareBy(e,t,r=!1){return g.create(h.NAME)}concatenate(e,t=rt.FRONT){let r=this.getValue().toString();if(typeof e=="string")t===rt.FRONT?r=e+r:r+=e;else if(typeof e=="number")t===rt.FRONT?r=e.toString()+r:r+=e.toString();else if(typeof e=="boolean"){const n=e?"TRUE":"FALSE";t===rt.FRONT?r=n+r:r+=n}return r}pow(e){return g.create(h.VALUE)}powInverse(e){return g.create(h.VALUE)}sqrt(){return g.create(h.VALUE)}cbrt(){return g.create(h.VALUE)}cos(){return g.create(h.VALUE)}cosh(){return g.create(h.VALUE)}acos(){return g.create(h.VALUE)}acosh(){return g.create(h.VALUE)}sin(){return g.create(h.VALUE)}sinh(){return g.create(h.VALUE)}asin(){return g.create(h.VALUE)}asinh(){return g.create(h.VALUE)}tan(){return g.create(h.VALUE)}tanh(){return g.create(h.VALUE)}atan(){return g.create(h.VALUE)}atan2(e){return g.create(h.VALUE)}atan2Inverse(e){return g.create(h.VALUE)}atanh(){return g.create(h.VALUE)}mean(){return this}median(){return this}var(){return this}std(){return this}log(){return g.create(h.VALUE)}log10(){return g.create(h.VALUE)}exp(){return g.create(h.VALUE)}abs(){return g.create(h.VALUE)}round(e){return g.create(h.VALUE)}roundInverse(e){return g.create(h.VALUE)}floor(e){return g.create(h.VALUE)}floorInverse(e){return g.create(h.VALUE)}ceil(e){return g.create(h.VALUE)}ceilInverse(e){return g.create(h.VALUE)}convertToNumberObjectValue(){return g.create(h.VALUE)}convertToBooleanObjectValue(){return g.create(h.VALUE)}}const Ul=1e3,Is=new yt(Ul);class g extends pt{constructor(o,e=""){super(o),this._errorType=o,this._errorContent=e}static create(o,e=""){const t=`${o}-${e}`,r=Is.get(t);if(r)return r;const n=new g(o,e);return Is.set(t,n),n}getValue(){return this._errorType}getErrorType(){return this._errorType}getErrorContent(){return this._errorContent}isEqualType(o){return o.getErrorType()===this.getErrorType()}isError(){return!0}}function Fs(i){let o;switch(i){case H.EQUALS:o=H.EQUALS;break;case H.GREATER_THAN:o=H.LESS_THAN;break;case H.GREATER_THAN_OR_EQUAL:o=H.LESS_THAN_OR_EQUAL;break;case H.LESS_THAN:o=H.GREATER_THAN;break;case H.LESS_THAN_OR_EQUAL:o=H.GREATER_THAN_OR_EQUAL;break;case H.NOT_EQUAL:o=H.NOT_EQUAL;break}return o}var cr=9e15,Lt=1e9,Bs="0123456789abcdef",_n="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",An="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",ks={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-cr,maxE:cr,crypto:!1},xi,Vt,ce=!0,En="[DecimalError] ",Pt=En+"Invalid argument: ",Ui=En+"Precision limit exceeded",Ti=En+"crypto unavailable",vi="[object Decimal]",ve=Math.floor,Pe=Math.pow,Tl=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,vl=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Il=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Ii=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,st=1e7,ae=7,Fl=9007199254740991,Bl=_n.length-1,$s=An.length-1,k={toStringTag:vi};k.absoluteValue=k.abs=function(){var i=new this.constructor(this);return i.s<0&&(i.s=1),re(i)},k.ceil=function(){return re(new this.constructor(this),this.e+1,2)},k.clampedTo=k.clamp=function(i,o){var e,t=this,r=t.constructor;if(i=new r(i),o=new r(o),!i.s||!o.s)return new r(NaN);if(i.gt(o))throw Error(Pt+o);return e=t.cmp(i),e<0?i:t.cmp(o)>0?o:new r(t)},k.comparedTo=k.cmp=function(i){var o,e,t,r,n=this,s=n.d,a=(i=new n.constructor(i)).d,u=n.s,c=i.s;if(!s||!a)return!u||!c?NaN:u!==c?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-c:0;if(u!==c)return u;if(n.e!==i.e)return n.e>i.e^u<0?1:-1;for(t=s.length,r=a.length,o=0,e=t<r?t:r;o<e;++o)if(s[o]!==a[o])return s[o]>a[o]^u<0?1:-1;return t===r?0:t>r^u<0?1:-1},k.cosine=k.cos=function(){var i,o,e=this,t=e.constructor;return e.d?e.d[0]?(i=t.precision,o=t.rounding,t.precision=i+Math.max(e.e,e.sd())+ae,t.rounding=1,e=kl(t,Hi(t,e)),t.precision=i,t.rounding=o,re(Vt==2||Vt==3?e.neg():e,i,o,!0)):new t(1):new t(NaN)},k.cubeRoot=k.cbrt=function(){var i,o,e,t,r,n,s,a,u,c,l=this,f=l.constructor;if(!l.isFinite()||l.isZero())return new f(l);for(ce=!1,n=l.s*Pe(l.s*l,1/3),!n||Math.abs(n)==1/0?(e=Ue(l.d),i=l.e,(n=(i-e.length+1)%3)&&(e+=n==1||n==-2?"0":"00"),n=Pe(e,1/3),i=ve((i+1)/3)-(i%3==(i<0?-1:2)),n==1/0?e="5e"+i:(e=n.toExponential(),e=e.slice(0,e.indexOf("e")+1)+i),t=new f(e),t.s=l.s):t=new f(n.toString()),s=(i=f.precision)+3;;)if(a=t,u=a.times(a).times(a),c=u.plus(l),t=pe(c.plus(l).times(a),c.plus(u),s+2,1),Ue(a.d).slice(0,s)===(e=Ue(t.d)).slice(0,s))if(e=e.slice(s-3,s+1),e=="9999"||!r&&e=="4999"){if(!r&&(re(a,i+1,0),a.times(a).times(a).eq(l))){t=a;break}s+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(re(t,i+1,1),o=!t.times(t).times(t).eq(l));break}return ce=!0,re(t,i,f.rounding,o)},k.decimalPlaces=k.dp=function(){var i,o=this.d,e=NaN;if(o){if(i=o.length-1,e=(i-ve(this.e/ae))*ae,i=o[i],i)for(;i%10==0;i/=10)e--;e<0&&(e=0)}return e},k.dividedBy=k.div=function(i){return pe(this,new this.constructor(i))},k.dividedToIntegerBy=k.divToInt=function(i){var o=this,e=o.constructor;return re(pe(o,new e(i),0,1,1),e.precision,e.rounding)},k.equals=k.eq=function(i){return this.cmp(i)===0},k.floor=function(){return re(new this.constructor(this),this.e+1,3)},k.greaterThan=k.gt=function(i){return this.cmp(i)>0},k.greaterThanOrEqualTo=k.gte=function(i){var o=this.cmp(i);return o==1||o===0},k.hyperbolicCosine=k.cosh=function(){var i,o,e,t,r,n=this,s=n.constructor,a=new s(1);if(!n.isFinite())return new s(n.s?1/0:NaN);if(n.isZero())return a;e=s.precision,t=s.rounding,s.precision=e+Math.max(n.e,n.sd())+4,s.rounding=1,r=n.d.length,r<32?(i=Math.ceil(r/3),o=(1/pn(4,i)).toString()):(i=16,o="2.3283064365386962890625e-10"),n=lr(s,1,n.times(o),new s(1),!0);for(var u,c=i,l=new s(8);c--;)u=n.times(n),n=a.minus(u.times(l.minus(u.times(l))));return re(n,s.precision=e,s.rounding=t,!0)},k.hyperbolicSine=k.sinh=function(){var i,o,e,t,r=this,n=r.constructor;if(!r.isFinite()||r.isZero())return new n(r);if(o=n.precision,e=n.rounding,n.precision=o+Math.max(r.e,r.sd())+4,n.rounding=1,t=r.d.length,t<3)r=lr(n,2,r,r,!0);else{i=1.4*Math.sqrt(t),i=i>16?16:i|0,r=r.times(1/pn(5,i)),r=lr(n,2,r,r,!0);for(var s,a=new n(5),u=new n(16),c=new n(20);i--;)s=r.times(r),r=r.times(a.plus(s.times(u.times(s).plus(c))))}return n.precision=o,n.rounding=e,re(r,o,e,!0)},k.hyperbolicTangent=k.tanh=function(){var i,o,e=this,t=e.constructor;return e.isFinite()?e.isZero()?new t(e):(i=t.precision,o=t.rounding,t.precision=i+7,t.rounding=1,pe(e.sinh(),e.cosh(),t.precision=i,t.rounding=o)):new t(e.s)},k.inverseCosine=k.acos=function(){var i=this,o=i.constructor,e=i.abs().cmp(1),t=o.precision,r=o.rounding;return e!==-1?e===0?i.isNeg()?mt(o,t,r):new o(0):new o(NaN):i.isZero()?mt(o,t+4,r).times(.5):(o.precision=t+6,o.rounding=1,i=new o(1).minus(i).div(i.plus(1)).sqrt().atan(),o.precision=t,o.rounding=r,i.times(2))},k.inverseHyperbolicCosine=k.acosh=function(){var i,o,e=this,t=e.constructor;return e.lte(1)?new t(e.eq(1)?0:NaN):e.isFinite()?(i=t.precision,o=t.rounding,t.precision=i+Math.max(Math.abs(e.e),e.sd())+4,t.rounding=1,ce=!1,e=e.times(e).minus(1).sqrt().plus(e),ce=!0,t.precision=i,t.rounding=o,e.ln()):new t(e)},k.inverseHyperbolicSine=k.asinh=function(){var i,o,e=this,t=e.constructor;return!e.isFinite()||e.isZero()?new t(e):(i=t.precision,o=t.rounding,t.precision=i+2*Math.max(Math.abs(e.e),e.sd())+6,t.rounding=1,ce=!1,e=e.times(e).plus(1).sqrt().plus(e),ce=!0,t.precision=i,t.rounding=o,e.ln())},k.inverseHyperbolicTangent=k.atanh=function(){var i,o,e,t,r=this,n=r.constructor;return r.isFinite()?r.e>=0?new n(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(i=n.precision,o=n.rounding,t=r.sd(),Math.max(t,i)<2*-r.e-1?re(new n(r),i,o,!0):(n.precision=e=t-r.e,r=pe(r.plus(1),new n(1).minus(r),e+i,1),n.precision=i+4,n.rounding=1,r=r.ln(),n.precision=i,n.rounding=o,r.times(.5))):new n(NaN)},k.inverseSine=k.asin=function(){var i,o,e,t,r=this,n=r.constructor;return r.isZero()?new n(r):(o=r.abs().cmp(1),e=n.precision,t=n.rounding,o!==-1?o===0?(i=mt(n,e+4,t).times(.5),i.s=r.s,i):new n(NaN):(n.precision=e+6,n.rounding=1,r=r.div(new n(1).minus(r.times(r)).sqrt().plus(1)).atan(),n.precision=e,n.rounding=t,r.times(2)))},k.inverseTangent=k.atan=function(){var i,o,e,t,r,n,s,a,u,c=this,l=c.constructor,f=l.precision,m=l.rounding;if(c.isFinite()){if(c.isZero())return new l(c);if(c.abs().eq(1)&&f+4<=$s)return s=mt(l,f+4,m).times(.25),s.s=c.s,s}else{if(!c.s)return new l(NaN);if(f+4<=$s)return s=mt(l,f+4,m).times(.5),s.s=c.s,s}for(l.precision=a=f+10,l.rounding=1,e=Math.min(28,a/ae+2|0),i=e;i;--i)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(ce=!1,o=Math.ceil(a/ae),t=1,u=c.times(c),s=new l(c),r=c;i!==-1;)if(r=r.times(u),n=s.minus(r.div(t+=2)),r=r.times(u),s=n.plus(r.div(t+=2)),s.d[o]!==void 0)for(i=o;s.d[i]===n.d[i]&&i--;);return e&&(s=s.times(2<<e-1)),ce=!0,re(s,l.precision=f,l.rounding=m,!0)},k.isFinite=function(){return!!this.d},k.isInteger=k.isInt=function(){return!!this.d&&ve(this.e/ae)>this.d.length-2},k.isNaN=function(){return!this.s},k.isNegative=k.isNeg=function(){return this.s<0},k.isPositive=k.isPos=function(){return this.s>0},k.isZero=function(){return!!this.d&&this.d[0]===0},k.lessThan=k.lt=function(i){return this.cmp(i)<0},k.lessThanOrEqualTo=k.lte=function(i){return this.cmp(i)<1},k.logarithm=k.log=function(i){var o,e,t,r,n,s,a,u,c=this,l=c.constructor,f=l.precision,m=l.rounding,d=5;if(i==null)i=new l(10),o=!0;else{if(i=new l(i),e=i.d,i.s<0||!e||!e[0]||i.eq(1))return new l(NaN);o=i.eq(10)}if(e=c.d,c.s<0||!e||!e[0]||c.eq(1))return new l(e&&!e[0]?-1/0:c.s!=1?NaN:e?0:1/0);if(o)if(e.length>1)n=!0;else{for(r=e[0];r%10===0;)r/=10;n=r!==1}if(ce=!1,a=f+d,s=xt(c,a),t=o?yn(l,a+10):xt(i,a),u=pe(s,t,a,1),wr(u.d,r=f,m))do if(a+=10,s=xt(c,a),t=o?yn(l,a+10):xt(i,a),u=pe(s,t,a,1),!n){+Ue(u.d).slice(r+1,r+15)+1==1e14&&(u=re(u,f+1,0));break}while(wr(u.d,r+=10,m));return ce=!0,re(u,f,m)},k.minus=k.sub=function(i){var o,e,t,r,n,s,a,u,c,l,f,m,d=this,C=d.constructor;if(i=new C(i),!d.d||!i.d)return!d.s||!i.s?i=new C(NaN):d.d?i.s=-i.s:i=new C(i.d||d.s!==i.s?d:NaN),i;if(d.s!=i.s)return i.s=-i.s,d.plus(i);if(c=d.d,m=i.d,a=C.precision,u=C.rounding,!c[0]||!m[0]){if(m[0])i.s=-i.s;else if(c[0])i=new C(d);else return new C(u===3?-0:0);return ce?re(i,a,u):i}if(e=ve(i.e/ae),l=ve(d.e/ae),c=c.slice(),n=l-e,n){for(f=n<0,f?(o=c,n=-n,s=m.length):(o=m,e=l,s=c.length),t=Math.max(Math.ceil(a/ae),s)+2,n>t&&(n=t,o.length=1),o.reverse(),t=n;t--;)o.push(0);o.reverse()}else{for(t=c.length,s=m.length,f=t<s,f&&(s=t),t=0;t<s;t++)if(c[t]!=m[t]){f=c[t]<m[t];break}n=0}for(f&&(o=c,c=m,m=o,i.s=-i.s),s=c.length,t=m.length-s;t>0;--t)c[s++]=0;for(t=m.length;t>n;){if(c[--t]<m[t]){for(r=t;r&&c[--r]===0;)c[r]=st-1;--c[r],c[t]+=st}c[t]-=m[t]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--e;return c[0]?(i.d=c,i.e=bn(c,e),ce?re(i,a,u):i):new C(u===3?-0:0)},k.modulo=k.mod=function(i){var o,e=this,t=e.constructor;return i=new t(i),!e.d||!i.s||i.d&&!i.d[0]?new t(NaN):!i.d||e.d&&!e.d[0]?re(new t(e),t.precision,t.rounding):(ce=!1,t.modulo==9?(o=pe(e,i.abs(),0,3,1),o.s*=i.s):o=pe(e,i,0,t.modulo,1),o=o.times(i),ce=!0,e.minus(o))},k.naturalExponential=k.exp=function(){return Ys(this)},k.naturalLogarithm=k.ln=function(){return xt(this)},k.negated=k.neg=function(){var i=new this.constructor(this);return i.s=-i.s,re(i)},k.plus=k.add=function(i){var o,e,t,r,n,s,a,u,c,l,f=this,m=f.constructor;if(i=new m(i),!f.d||!i.d)return!f.s||!i.s?i=new m(NaN):f.d||(i=new m(i.d||f.s===i.s?f:NaN)),i;if(f.s!=i.s)return i.s=-i.s,f.minus(i);if(c=f.d,l=i.d,a=m.precision,u=m.rounding,!c[0]||!l[0])return l[0]||(i=new m(f)),ce?re(i,a,u):i;if(n=ve(f.e/ae),t=ve(i.e/ae),c=c.slice(),r=n-t,r){for(r<0?(e=c,r=-r,s=l.length):(e=l,t=n,s=c.length),n=Math.ceil(a/ae),s=n>s?n+1:s+1,r>s&&(r=s,e.length=1),e.reverse();r--;)e.push(0);e.reverse()}for(s=c.length,r=l.length,s-r<0&&(r=s,e=l,l=c,c=e),o=0;r;)o=(c[--r]=c[r]+l[r]+o)/st|0,c[r]%=st;for(o&&(c.unshift(o),++t),s=c.length;c[--s]==0;)c.pop();return i.d=c,i.e=bn(c,t),ce?re(i,a,u):i},k.precision=k.sd=function(i){var o,e=this;if(i!==void 0&&i!==!!i&&i!==1&&i!==0)throw Error(Pt+i);return e.d?(o=Fi(e.d),i&&e.e+1>o&&(o=e.e+1)):o=NaN,o},k.round=function(){var i=this,o=i.constructor;return re(new o(i),i.e+1,o.rounding)},k.sine=k.sin=function(){var i,o,e=this,t=e.constructor;return e.isFinite()?e.isZero()?new t(e):(i=t.precision,o=t.rounding,t.precision=i+Math.max(e.e,e.sd())+ae,t.rounding=1,e=Yl(t,Hi(t,e)),t.precision=i,t.rounding=o,re(Vt>2?e.neg():e,i,o,!0)):new t(NaN)},k.squareRoot=k.sqrt=function(){var i,o,e,t,r,n,s=this,a=s.d,u=s.e,c=s.s,l=s.constructor;if(c!==1||!a||!a[0])return new l(!c||c<0&&(!a||a[0])?NaN:a?s:1/0);for(ce=!1,c=Math.sqrt(+s),c==0||c==1/0?(o=Ue(a),(o.length+u)%2==0&&(o+="0"),c=Math.sqrt(o),u=ve((u+1)/2)-(u<0||u%2),c==1/0?o="5e"+u:(o=c.toExponential(),o=o.slice(0,o.indexOf("e")+1)+u),t=new l(o)):t=new l(c.toString()),e=(u=l.precision)+3;;)if(n=t,t=n.plus(pe(s,n,e+2,1)).times(.5),Ue(n.d).slice(0,e)===(o=Ue(t.d)).slice(0,e))if(o=o.slice(e-3,e+1),o=="9999"||!r&&o=="4999"){if(!r&&(re(n,u+1,0),n.times(n).eq(s))){t=n;break}e+=4,r=1}else{(!+o||!+o.slice(1)&&o.charAt(0)=="5")&&(re(t,u+1,1),i=!t.times(t).eq(s));break}return ce=!0,re(t,u,l.rounding,i)},k.tangent=k.tan=function(){var i,o,e=this,t=e.constructor;return e.isFinite()?e.isZero()?new t(e):(i=t.precision,o=t.rounding,t.precision=i+10,t.rounding=1,e=e.sin(),e.s=1,e=pe(e,new t(1).minus(e.times(e)).sqrt(),i+10,0),t.precision=i,t.rounding=o,re(Vt==2||Vt==4?e.neg():e,i,o,!0)):new t(NaN)},k.times=k.mul=function(i){var o,e,t,r,n,s,a,u,c,l=this,f=l.constructor,m=l.d,d=(i=new f(i)).d;if(i.s*=l.s,!m||!m[0]||!d||!d[0])return new f(!i.s||m&&!m[0]&&!d||d&&!d[0]&&!m?NaN:!m||!d?i.s/0:i.s*0);for(e=ve(l.e/ae)+ve(i.e/ae),u=m.length,c=d.length,u<c&&(n=m,m=d,d=n,s=u,u=c,c=s),n=[],s=u+c,t=s;t--;)n.push(0);for(t=c;--t>=0;){for(o=0,r=u+t;r>t;)a=n[r]+d[t]*m[r-t-1]+o,n[r--]=a%st|0,o=a/st|0;n[r]=(n[r]+o)%st|0}for(;!n[--s];)n.pop();return o?++e:n.shift(),i.d=n,i.e=bn(n,e),ce?re(i,f.precision,f.rounding):i},k.toBinary=function(i,o){return Hs(this,2,i,o)},k.toDecimalPlaces=k.toDP=function(i,o){var e=this,t=e.constructor;return e=new t(e),i===void 0?e:(ke(i,0,Lt),o===void 0?o=t.rounding:ke(o,0,8),re(e,i+e.e+1,o))},k.toExponential=function(i,o){var e,t=this,r=t.constructor;return i===void 0?e=ft(t,!0):(ke(i,0,Lt),o===void 0?o=r.rounding:ke(o,0,8),t=re(new r(t),i+1,o),e=ft(t,!0,i+1)),t.isNeg()&&!t.isZero()?"-"+e:e},k.toFixed=function(i,o){var e,t,r=this,n=r.constructor;return i===void 0?e=ft(r):(ke(i,0,Lt),o===void 0?o=n.rounding:ke(o,0,8),t=re(new n(r),i+r.e+1,o),e=ft(t,!1,i+t.e+1)),r.isNeg()&&!r.isZero()?"-"+e:e},k.toFraction=function(i){var o,e,t,r,n,s,a,u,c,l,f,m,d=this,C=d.d,_=d.constructor;if(!C)return new _(d);if(c=e=new _(1),t=u=new _(0),o=new _(t),n=o.e=Fi(C)-d.e-1,s=n%ae,o.d[0]=Pe(10,s<0?ae+s:s),i==null)i=n>0?o:c;else{if(a=new _(i),!a.isInt()||a.lt(c))throw Error(Pt+a);i=a.gt(o)?n>0?o:c:a}for(ce=!1,a=new _(Ue(C)),l=_.precision,_.precision=n=C.length*ae*2;f=pe(a,o,0,1,1),r=e.plus(f.times(t)),r.cmp(i)!=1;)e=t,t=r,r=c,c=u.plus(f.times(r)),u=r,r=o,o=a.minus(f.times(r)),a=r;return r=pe(i.minus(e),t,0,1,1),u=u.plus(r.times(c)),e=e.plus(r.times(t)),u.s=c.s=d.s,m=pe(c,t,n,1).minus(d).abs().cmp(pe(u,e,n,1).minus(d).abs())<1?[c,t]:[u,e],_.precision=l,ce=!0,m},k.toHexadecimal=k.toHex=function(i,o){return Hs(this,16,i,o)},k.toNearest=function(i,o){var e=this,t=e.constructor;if(e=new t(e),i==null){if(!e.d)return e;i=new t(1),o=t.rounding}else{if(i=new t(i),o===void 0?o=t.rounding:ke(o,0,8),!e.d)return i.s?e:i;if(!i.d)return i.s&&(i.s=e.s),i}return i.d[0]?(ce=!1,e=pe(e,i,0,o,1).times(i),ce=!0,re(e)):(i.s=e.s,e=i),e},k.toNumber=function(){return+this},k.toOctal=function(i,o){return Hs(this,8,i,o)},k.toPower=k.pow=function(i){var o,e,t,r,n,s,a=this,u=a.constructor,c=+(i=new u(i));if(!a.d||!i.d||!a.d[0]||!i.d[0])return new u(Pe(+a,c));if(a=new u(a),a.eq(1))return a;if(t=u.precision,n=u.rounding,i.eq(1))return re(a,t,n);if(o=ve(i.e/ae),o>=i.d.length-1&&(e=c<0?-c:c)<=Fl)return r=Bi(u,a,e,t),i.s<0?new u(1).div(r):re(r,t,n);if(s=a.s,s<0){if(o<i.d.length-1)return new u(NaN);if((i.d[o]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return e=Pe(+a,c),o=e==0||!isFinite(e)?ve(c*(Math.log("0."+Ue(a.d))/Math.LN10+a.e+1)):new u(e+"").e,o>u.maxE+1||o<u.minE-1?new u(o>0?s/0:0):(ce=!1,u.rounding=a.s=1,e=Math.min(12,(o+"").length),r=Ys(i.times(xt(a,t+e)),t),r.d&&(r=re(r,t+5,1),wr(r.d,t,n)&&(o=t+10,r=re(Ys(i.times(xt(a,o+e)),o),o+5,1),+Ue(r.d).slice(t+1,t+15)+1==1e14&&(r=re(r,t+1,0)))),r.s=s,ce=!0,u.rounding=n,re(r,t,n))},k.toPrecision=function(i,o){var e,t=this,r=t.constructor;return i===void 0?e=ft(t,t.e<=r.toExpNeg||t.e>=r.toExpPos):(ke(i,1,Lt),o===void 0?o=r.rounding:ke(o,0,8),t=re(new r(t),i,o),e=ft(t,i<=t.e||t.e<=r.toExpNeg,i)),t.isNeg()&&!t.isZero()?"-"+e:e},k.toSignificantDigits=k.toSD=function(i,o){var e=this,t=e.constructor;return i===void 0?(i=t.precision,o=t.rounding):(ke(i,1,Lt),o===void 0?o=t.rounding:ke(o,0,8)),re(new t(e),i,o)},k.toString=function(){var i=this,o=i.constructor,e=ft(i,i.e<=o.toExpNeg||i.e>=o.toExpPos);return i.isNeg()&&!i.isZero()?"-"+e:e},k.truncated=k.trunc=function(){return re(new this.constructor(this),this.e+1,1)},k.valueOf=k.toJSON=function(){var i=this,o=i.constructor,e=ft(i,i.e<=o.toExpNeg||i.e>=o.toExpPos);return i.isNeg()?"-"+e:e};function Ue(i){var o,e,t,r=i.length-1,n="",s=i[0];if(r>0){for(n+=s,o=1;o<r;o++)t=i[o]+"",e=ae-t.length,e&&(n+=jt(e)),n+=t;s=i[o],t=s+"",e=ae-t.length,e&&(n+=jt(e))}else if(s===0)return"0";for(;s%10===0;)s/=10;return n+s}function ke(i,o,e){if(i!==~~i||i<o||i>e)throw Error(Pt+i)}function wr(i,o,e,t){var r,n,s,a;for(n=i[0];n>=10;n/=10)--o;return--o<0?(o+=ae,r=0):(r=Math.ceil((o+1)/ae),o%=ae),n=Pe(10,ae-o),a=i[r]%n|0,t==null?o<3?(o==0?a=a/100|0:o==1&&(a=a/10|0),s=e<4&&a==99999||e>3&&a==49999||a==5e4||a==0):s=(e<4&&a+1==n||e>3&&a+1==n/2)&&(i[r+1]/n/100|0)==Pe(10,o-2)-1||(a==n/2||a==0)&&(i[r+1]/n/100|0)==0:o<4?(o==0?a=a/1e3|0:o==1?a=a/100|0:o==2&&(a=a/10|0),s=(t||e<4)&&a==9999||!t&&e>3&&a==4999):s=((t||e<4)&&a+1==n||!t&&e>3&&a+1==n/2)&&(i[r+1]/n/1e3|0)==Pe(10,o-3)-1,s}function Rn(i,o,e){for(var t,r=[0],n,s=0,a=i.length;s<a;){for(n=r.length;n--;)r[n]*=o;for(r[0]+=Bs.indexOf(i.charAt(s++)),t=0;t<r.length;t++)r[t]>e-1&&(r[t+1]===void 0&&(r[t+1]=0),r[t+1]+=r[t]/e|0,r[t]%=e)}return r.reverse()}function kl(i,o){var e,t,r;if(o.isZero())return o;t=o.d.length,t<32?(e=Math.ceil(t/3),r=(1/pn(4,e)).toString()):(e=16,r="2.3283064365386962890625e-10"),i.precision+=e,o=lr(i,1,o.times(r),new i(1));for(var n=e;n--;){var s=o.times(o);o=s.times(s).minus(s).times(8).plus(1)}return i.precision-=e,o}var pe=(function(){function i(t,r,n){var s,a=0,u=t.length;for(t=t.slice();u--;)s=t[u]*r+a,t[u]=s%n|0,a=s/n|0;return a&&t.unshift(a),t}function o(t,r,n,s){var a,u;if(n!=s)u=n>s?1:-1;else for(a=u=0;a<n;a++)if(t[a]!=r[a]){u=t[a]>r[a]?1:-1;break}return u}function e(t,r,n,s){for(var a=0;n--;)t[n]-=a,a=t[n]<r[n]?1:0,t[n]=a*s+t[n]-r[n];for(;!t[0]&&t.length>1;)t.shift()}return function(t,r,n,s,a,u){var c,l,f,m,d,C,_,E,R,b,N,V,S,D,L,P,j,I,v,Y,Q=t.constructor,se=t.s==r.s?1:-1,te=t.d,W=r.d;if(!te||!te[0]||!W||!W[0])return new Q(!t.s||!r.s||(te?W&&te[0]==W[0]:!W)?NaN:te&&te[0]==0||!W?se*0:se/0);for(u?(d=1,l=t.e-r.e):(u=st,d=ae,l=ve(t.e/d)-ve(r.e/d)),v=W.length,j=te.length,R=new Q(se),b=R.d=[],f=0;W[f]==(te[f]||0);f++);if(W[f]>(te[f]||0)&&l--,n==null?(D=n=Q.precision,s=Q.rounding):a?D=n+(t.e-r.e)+1:D=n,D<0)b.push(1),C=!0;else{if(D=D/d+2|0,f=0,v==1){for(m=0,W=W[0],D++;(f<j||m)&&D--;f++)L=m*u+(te[f]||0),b[f]=L/W|0,m=L%W|0;C=m||f<j}else{for(m=u/(W[0]+1)|0,m>1&&(W=i(W,m,u),te=i(te,m,u),v=W.length,j=te.length),P=v,N=te.slice(0,v),V=N.length;V<v;)N[V++]=0;Y=W.slice(),Y.unshift(0),I=W[0],W[1]>=u/2&&++I;do m=0,c=o(W,N,v,V),c<0?(S=N[0],v!=V&&(S=S*u+(N[1]||0)),m=S/I|0,m>1?(m>=u&&(m=u-1),_=i(W,m,u),E=_.length,V=N.length,c=o(_,N,E,V),c==1&&(m--,e(_,v<E?Y:W,E,u))):(m==0&&(c=m=1),_=W.slice()),E=_.length,E<V&&_.unshift(0),e(N,_,V,u),c==-1&&(V=N.length,c=o(W,N,v,V),c<1&&(m++,e(N,v<V?Y:W,V,u))),V=N.length):c===0&&(m++,N=[0]),b[f++]=m,c&&N[0]?N[V++]=te[P]||0:(N=[te[P]],V=1);while((P++<j||N[0]!==void 0)&&D--);C=N[0]!==void 0}b[0]||b.shift()}if(d==1)R.e=l,xi=C;else{for(f=1,m=b[0];m>=10;m/=10)f++;R.e=f+l*d-1,re(R,a?n+R.e+1:n,s,C)}return R}})();function re(i,o,e,t){var r,n,s,a,u,c,l,f,m,d=i.constructor;e:if(o!=null){if(f=i.d,!f)return i;for(r=1,a=f[0];a>=10;a/=10)r++;if(n=o-r,n<0)n+=ae,s=o,l=f[m=0],u=l/Pe(10,r-s-1)%10|0;else if(m=Math.ceil((n+1)/ae),a=f.length,m>=a)if(t){for(;a++<=m;)f.push(0);l=u=0,r=1,n%=ae,s=n-ae+1}else break e;else{for(l=a=f[m],r=1;a>=10;a/=10)r++;n%=ae,s=n-ae+r,u=s<0?0:l/Pe(10,r-s-1)%10|0}if(t=t||o<0||f[m+1]!==void 0||(s<0?l:l%Pe(10,r-s-1)),c=e<4?(u||t)&&(e==0||e==(i.s<0?3:2)):u>5||u==5&&(e==4||t||e==6&&(n>0?s>0?l/Pe(10,r-s):0:f[m-1])%10&1||e==(i.s<0?8:7)),o<1||!f[0])return f.length=0,c?(o-=i.e+1,f[0]=Pe(10,(ae-o%ae)%ae),i.e=-o||0):f[0]=i.e=0,i;if(n==0?(f.length=m,a=1,m--):(f.length=m+1,a=Pe(10,ae-n),f[m]=s>0?(l/Pe(10,r-s)%Pe(10,s)|0)*a:0),c)for(;;)if(m==0){for(n=1,s=f[0];s>=10;s/=10)n++;for(s=f[0]+=a,a=1;s>=10;s/=10)a++;n!=a&&(i.e++,f[0]==st&&(f[0]=1));break}else{if(f[m]+=a,f[m]!=st)break;f[m--]=0,a=1}for(n=f.length;f[--n]===0;)f.pop()}return ce&&(i.e>d.maxE?(i.d=null,i.e=NaN):i.e<d.minE&&(i.e=0,i.d=[0])),i}function ft(i,o,e){if(!i.isFinite())return Yi(i);var t,r=i.e,n=Ue(i.d),s=n.length;return o?(e&&(t=e-s)>0?n=n.charAt(0)+"."+n.slice(1)+jt(t):s>1&&(n=n.charAt(0)+"."+n.slice(1)),n=n+(i.e<0?"e":"e+")+i.e):r<0?(n="0."+jt(-r-1)+n,e&&(t=e-s)>0&&(n+=jt(t))):r>=s?(n+=jt(r+1-s),e&&(t=e-r-1)>0&&(n=n+"."+jt(t))):((t=r+1)<s&&(n=n.slice(0,t)+"."+n.slice(t)),e&&(t=e-s)>0&&(r+1===s&&(n+="."),n+=jt(t))),n}function bn(i,o){var e=i[0];for(o*=ae;e>=10;e/=10)o++;return o}function yn(i,o,e){if(o>Bl)throw ce=!0,e&&(i.precision=e),Error(Ui);return re(new i(_n),o,1,!0)}function mt(i,o,e){if(o>$s)throw Error(Ui);return re(new i(An),o,e,!0)}function Fi(i){var o=i.length-1,e=o*ae+1;if(o=i[o],o){for(;o%10==0;o/=10)e--;for(o=i[0];o>=10;o/=10)e++}return e}function jt(i){for(var o="";i--;)o+="0";return o}function Bi(i,o,e,t){var r,n=new i(1),s=Math.ceil(t/ae+4);for(ce=!1;;){if(e%2&&(n=n.times(o),Gi(n.d,s)&&(r=!0)),e=ve(e/2),e===0){e=n.d.length-1,r&&n.d[e]===0&&++n.d[e];break}o=o.times(o),Gi(o.d,s)}return ce=!0,n}function ki(i){return i.d[i.d.length-1]&1}function $i(i,o,e){for(var t,r,n=new i(o[0]),s=0;++s<o.length;){if(r=new i(o[s]),!r.s){n=r;break}t=n.cmp(r),(t===e||t===0&&n.s===e)&&(n=r)}return n}function Ys(i,o){var e,t,r,n,s,a,u,c=0,l=0,f=0,m=i.constructor,d=m.rounding,C=m.precision;if(!i.d||!i.d[0]||i.e>17)return new m(i.d?i.d[0]?i.s<0?0:1/0:1:i.s?i.s<0?0:i:NaN);for(o==null?(ce=!1,u=C):u=o,a=new m(.03125);i.e>-2;)i=i.times(a),f+=5;for(t=Math.log(Pe(2,f))/Math.LN10*2+5|0,u+=t,e=n=s=new m(1),m.precision=u;;){if(n=re(n.times(i),u,1),e=e.times(++l),a=s.plus(pe(n,e,u,1)),Ue(a.d).slice(0,u)===Ue(s.d).slice(0,u)){for(r=f;r--;)s=re(s.times(s),u,1);if(o==null)if(c<3&&wr(s.d,u-t,d,c))m.precision=u+=10,e=n=a=new m(1),l=0,c++;else return re(s,m.precision=C,d,ce=!0);else return m.precision=C,s}s=a}}function xt(i,o){var e,t,r,n,s,a,u,c,l,f,m,d=1,C=10,_=i,E=_.d,R=_.constructor,b=R.rounding,N=R.precision;if(_.s<0||!E||!E[0]||!_.e&&E[0]==1&&E.length==1)return new R(E&&!E[0]?-1/0:_.s!=1?NaN:E?0:_);if(o==null?(ce=!1,l=N):l=o,R.precision=l+=C,e=Ue(E),t=e.charAt(0),Math.abs(n=_.e)<15e14){for(;t<7&&t!=1||t==1&&e.charAt(1)>3;)_=_.times(i),e=Ue(_.d),t=e.charAt(0),d++;n=_.e,t>1?(_=new R("0."+e),n++):_=new R(t+"."+e.slice(1))}else return c=yn(R,l+2,N).times(n+""),_=xt(new R(t+"."+e.slice(1)),l-C).plus(c),R.precision=N,o==null?re(_,N,b,ce=!0):_;for(f=_,u=s=_=pe(_.minus(1),_.plus(1),l,1),m=re(_.times(_),l,1),r=3;;){if(s=re(s.times(m),l,1),c=u.plus(pe(s,new R(r),l,1)),Ue(c.d).slice(0,l)===Ue(u.d).slice(0,l))if(u=u.times(2),n!==0&&(u=u.plus(yn(R,l+2,N).times(n+""))),u=pe(u,new R(d),l,1),o==null)if(wr(u.d,l-C,b,a))R.precision=l+=C,c=s=_=pe(f.minus(1),f.plus(1),l,1),m=re(_.times(_),l,1),r=a=1;else return re(u,R.precision=N,b,ce=!0);else return R.precision=N,u;u=c,r+=2}}function Yi(i){return String(i.s*i.s/0)}function Nn(i,o){var e,t,r;for((e=o.indexOf("."))>-1&&(o=o.replace(".","")),(t=o.search(/e/i))>0?(e<0&&(e=t),e+=+o.slice(t+1),o=o.substring(0,t)):e<0&&(e=o.length),t=0;o.charCodeAt(t)===48;t++);for(r=o.length;o.charCodeAt(r-1)===48;--r);if(o=o.slice(t,r),o){if(r-=t,i.e=e=e-t-1,i.d=[],t=(e+1)%ae,e<0&&(t+=ae),t<r){for(t&&i.d.push(+o.slice(0,t)),r-=ae;t<r;)i.d.push(+o.slice(t,t+=ae));o=o.slice(t),t=ae-o.length}else t-=r;for(;t--;)o+="0";i.d.push(+o),ce&&(i.e>i.constructor.maxE?(i.d=null,i.e=NaN):i.e<i.constructor.minE&&(i.e=0,i.d=[0]))}else i.e=0,i.d=[0];return i}function $l(i,o){var e,t,r,n,s,a,u,c,l;if(o.indexOf("_")>-1){if(o=o.replace(/(\d)_(?=\d)/g,"$1"),Ii.test(o))return Nn(i,o)}else if(o==="Infinity"||o==="NaN")return+o||(i.s=NaN),i.e=NaN,i.d=null,i;if(vl.test(o))e=16,o=o.toLowerCase();else if(Tl.test(o))e=2;else if(Il.test(o))e=8;else throw Error(Pt+o);for(n=o.search(/p/i),n>0?(u=+o.slice(n+1),o=o.substring(2,n)):o=o.slice(2),n=o.indexOf("."),s=n>=0,t=i.constructor,s&&(o=o.replace(".",""),a=o.length,n=a-n,r=Bi(t,new t(e),n,n*2)),c=Rn(o,e,st),l=c.length-1,n=l;c[n]===0;--n)c.pop();return n<0?new t(i.s*0):(i.e=bn(c,l),i.d=c,ce=!1,s&&(i=pe(i,r,a*4)),u&&(i=i.times(Math.abs(u)<54?Pe(2,u):U.pow(2,u))),ce=!0,i)}function Yl(i,o){var e,t=o.d.length;if(t<3)return o.isZero()?o:lr(i,2,o,o);e=1.4*Math.sqrt(t),e=e>16?16:e|0,o=o.times(1/pn(5,e)),o=lr(i,2,o,o);for(var r,n=new i(5),s=new i(16),a=new i(20);e--;)r=o.times(o),o=o.times(n.plus(r.times(s.times(r).minus(a))));return o}function lr(i,o,e,t,r){var n,s,a,u,c=i.precision,l=Math.ceil(c/ae);for(ce=!1,u=e.times(e),a=new i(t);;){if(s=pe(a.times(u),new i(o++*o++),c,1),a=r?t.plus(s):t.minus(s),t=pe(s.times(u),new i(o++*o++),c,1),s=a.plus(t),s.d[l]!==void 0){for(n=l;s.d[n]===a.d[n]&&n--;);if(n==-1)break}n=a,a=t,t=s,s=n}return ce=!0,s.d.length=l+1,s}function pn(i,o){for(var e=i;--o;)e*=i;return e}function Hi(i,o){var e,t=o.s<0,r=mt(i,i.precision,1),n=r.times(.5);if(o=o.abs(),o.lte(n))return Vt=t?4:1,o;if(e=o.divToInt(r),e.isZero())Vt=t?3:2;else{if(o=o.minus(e.times(r)),o.lte(n))return Vt=ki(e)?t?2:3:t?4:1,o;Vt=ki(e)?t?1:4:t?3:2}return o.minus(r).abs()}function Hs(i,o,e,t){var r,n,s,a,u,c,l,f,m,d=i.constructor,C=e!==void 0;if(C?(ke(e,1,Lt),t===void 0?t=d.rounding:ke(t,0,8)):(e=d.precision,t=d.rounding),!i.isFinite())l=Yi(i);else{for(l=ft(i),s=l.indexOf("."),C?(r=2,o==16?e=e*4-3:o==8&&(e=e*3-2)):r=o,s>=0&&(l=l.replace(".",""),m=new d(1),m.e=l.length-s,m.d=Rn(ft(m),10,r),m.e=m.d.length),f=Rn(l,10,r),n=u=f.length;f[--u]==0;)f.pop();if(!f[0])l=C?"0p+0":"0";else{if(s<0?n--:(i=new d(i),i.d=f,i.e=n,i=pe(i,m,e,t,0,r),f=i.d,n=i.e,c=xi),s=f[e],a=r/2,c=c||f[e+1]!==void 0,c=t<4?(s!==void 0||c)&&(t===0||t===(i.s<0?3:2)):s>a||s===a&&(t===4||c||t===6&&f[e-1]&1||t===(i.s<0?8:7)),f.length=e,c)for(;++f[--e]>r-1;)f[e]=0,e||(++n,f.unshift(1));for(u=f.length;!f[u-1];--u);for(s=0,l="";s<u;s++)l+=Bs.charAt(f[s]);if(C){if(u>1)if(o==16||o==8){for(s=o==16?4:3,--u;u%s;u++)l+="0";for(f=Rn(l,r,o),u=f.length;!f[u-1];--u);for(s=1,l="1.";s<u;s++)l+=Bs.charAt(f[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(n<0?"p":"p+")+n}else if(n<0){for(;++n;)l="0"+l;l="0."+l}else if(++n>u)for(n-=u;n--;)l+="0";else n<u&&(l=l.slice(0,n)+"."+l.slice(n))}l=(o==16?"0x":o==2?"0b":o==8?"0o":"")+l}return i.s<0?"-"+l:l}function Gi(i,o){if(i.length>o)return i.length=o,!0}function Hl(i){return new this(i).abs()}function Gl(i){return new this(i).acos()}function Wl(i){return new this(i).acosh()}function Ql(i,o){return new this(i).plus(o)}function ql(i){return new this(i).asin()}function Xl(i){return new this(i).asinh()}function Kl(i){return new this(i).atan()}function Zl(i){return new this(i).atanh()}function zl(i,o){i=new this(i),o=new this(o);var e,t=this.precision,r=this.rounding,n=t+4;return!i.s||!o.s?e=new this(NaN):!i.d&&!o.d?(e=mt(this,n,1).times(o.s>0?.25:.75),e.s=i.s):!o.d||i.isZero()?(e=o.s<0?mt(this,t,r):new this(0),e.s=i.s):!i.d||o.isZero()?(e=mt(this,n,1).times(.5),e.s=i.s):o.s<0?(this.precision=n,this.rounding=1,e=this.atan(pe(i,o,n,1)),o=mt(this,n,1),this.precision=t,this.rounding=r,e=i.s<0?e.minus(o):e.plus(o)):e=this.atan(pe(i,o,n,1)),e}function Jl(i){return new this(i).cbrt()}function ef(i){return re(i=new this(i),i.e+1,2)}function tf(i,o,e){return new this(i).clamp(o,e)}function rf(i){if(!i||typeof i!="object")throw Error(En+"Object expected");var o,e,t,r=i.defaults===!0,n=["precision",1,Lt,"rounding",0,8,"toExpNeg",-cr,0,"toExpPos",0,cr,"maxE",0,cr,"minE",-cr,0,"modulo",0,9];for(o=0;o<n.length;o+=3)if(e=n[o],r&&(this[e]=ks[e]),(t=i[e])!==void 0)if(ve(t)===t&&t>=n[o+1]&&t<=n[o+2])this[e]=t;else throw Error(Pt+e+": "+t);if(e="crypto",r&&(this[e]=ks[e]),(t=i[e])!==void 0)if(t===!0||t===!1||t===0||t===1)if(t)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[e]=!0;else throw Error(Ti);else this[e]=!1;else throw Error(Pt+e+": "+t);return this}function nf(i){return new this(i).cos()}function sf(i){return new this(i).cosh()}function Wi(i){var o,e,t;function r(n){var s,a,u,c=this;if(!(c instanceof r))return new r(n);if(c.constructor=r,Qi(n)){c.s=n.s,ce?!n.d||n.e>r.maxE?(c.e=NaN,c.d=null):n.e<r.minE?(c.e=0,c.d=[0]):(c.e=n.e,c.d=n.d.slice()):(c.e=n.e,c.d=n.d?n.d.slice():n.d);return}if(u=typeof n,u==="number"){if(n===0){c.s=1/n<0?-1:1,c.e=0,c.d=[0];return}if(n<0?(n=-n,c.s=-1):c.s=1,n===~~n&&n<1e7){for(s=0,a=n;a>=10;a/=10)s++;ce?s>r.maxE?(c.e=NaN,c.d=null):s<r.minE?(c.e=0,c.d=[0]):(c.e=s,c.d=[n]):(c.e=s,c.d=[n]);return}if(n*0!==0){n||(c.s=NaN),c.e=NaN,c.d=null;return}return Nn(c,n.toString())}if(u==="string")return(a=n.charCodeAt(0))===45?(n=n.slice(1),c.s=-1):(a===43&&(n=n.slice(1)),c.s=1),Ii.test(n)?Nn(c,n):$l(c,n);if(u==="bigint")return n<0?(n=-n,c.s=-1):c.s=1,Nn(c,n.toString());throw Error(Pt+n)}if(r.prototype=k,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=rf,r.clone=Wi,r.isDecimal=Qi,r.abs=Hl,r.acos=Gl,r.acosh=Wl,r.add=Ql,r.asin=ql,r.asinh=Xl,r.atan=Kl,r.atanh=Zl,r.atan2=zl,r.cbrt=Jl,r.ceil=ef,r.clamp=tf,r.cos=nf,r.cosh=sf,r.div=af,r.exp=of,r.floor=uf,r.hypot=cf,r.ln=lf,r.log=ff,r.log10=hf,r.log2=mf,r.max=gf,r.min=df,r.mod=Cf,r.mul=_f,r.pow=Af,r.random=Ef,r.round=Rf,r.sign=bf,r.sin=yf,r.sinh=Nf,r.sqrt=pf,r.sub=Vf,r.sum=Of,r.tan=Sf,r.tanh=Mf,r.trunc=Df,i===void 0&&(i={}),i&&i.defaults!==!0)for(t=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],o=0;o<t.length;)i.hasOwnProperty(e=t[o++])||(i[e]=this[e]);return r.config(i),r}function af(i,o){return new this(i).div(o)}function of(i){return new this(i).exp()}function uf(i){return re(i=new this(i),i.e+1,3)}function cf(){var i,o,e=new this(0);for(ce=!1,i=0;i<arguments.length;)if(o=new this(arguments[i++]),o.d)e.d&&(e=e.plus(o.times(o)));else{if(o.s)return ce=!0,new this(1/0);e=o}return ce=!0,e.sqrt()}function Qi(i){return i instanceof U||i&&i.toStringTag===vi||!1}function lf(i){return new this(i).ln()}function ff(i,o){return new this(i).log(o)}function mf(i){return new this(i).log(2)}function hf(i){return new this(i).log(10)}function gf(){return $i(this,arguments,-1)}function df(){return $i(this,arguments,1)}function Cf(i,o){return new this(i).mod(o)}function _f(i,o){return new this(i).mul(o)}function Af(i,o){return new this(i).pow(o)}function Ef(i){var o,e,t,r,n=0,s=new this(1),a=[];if(i===void 0?i=this.precision:ke(i,1,Lt),t=Math.ceil(i/ae),this.crypto)if(crypto.getRandomValues)for(o=crypto.getRandomValues(new Uint32Array(t));n<t;)r=o[n],r>=429e7?o[n]=crypto.getRandomValues(new Uint32Array(1))[0]:a[n++]=r%1e7;else if(crypto.randomBytes){for(o=crypto.randomBytes(t*=4);n<t;)r=o[n]+(o[n+1]<<8)+(o[n+2]<<16)+((o[n+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(o,n):(a.push(r%1e7),n+=4);n=t/4}else throw Error(Ti);else for(;n<t;)a[n++]=Math.random()*1e7|0;for(t=a[--n],i%=ae,t&&i&&(r=Pe(10,ae-i),a[n]=(t/r|0)*r);a[n]===0;n--)a.pop();if(n<0)e=0,a=[0];else{for(e=-1;a[0]===0;e-=ae)a.shift();for(t=1,r=a[0];r>=10;r/=10)t++;t<ae&&(e-=ae-t)}return s.e=e,s.d=a,s}function Rf(i){return re(i=new this(i),i.e+1,this.rounding)}function bf(i){return i=new this(i),i.d?i.d[0]?i.s:0*i.s:i.s||NaN}function yf(i){return new this(i).sin()}function Nf(i){return new this(i).sinh()}function pf(i){return new this(i).sqrt()}function Vf(i,o){return new this(i).sub(o)}function Of(){var i=0,o=arguments,e=new this(o[i]);for(ce=!1;e.s&&++i<o.length;)e=e.plus(o[i]);return ce=!0,re(e,this.precision,this.rounding)}function Sf(i){return new this(i).tan()}function Mf(i){return new this(i).tanh()}function Df(i){return re(i=new this(i),i.e+1,1)}k[Symbol.for("nodejs.util.inspect.custom")]=k.toString,k[Symbol.toStringTag]="Decimal";var U=k.constructor=Wi(ks);_n=new U(_n),An=new U(An);function wf(i,o){const e=i+o;return Number.isSafeInteger(e)?e:new U(i).add(o).toNumber()}function Lf(i,o){const e=i-o;return Number.isSafeInteger(e)?e:new U(i).sub(o).toNumber()}function fr(i,o){const e=i*o;return Number.isSafeInteger(e)?e:new U(i).mul(o).toNumber()}function Pf(i,o){const e=i/o;return Number.isSafeInteger(e)?e:new U(i).div(o).toNumber()}function Ut(i,o){const e=10**Math.trunc(o),t=Vn(i,e);return Math.round(fr(i,e)+t)/e}function Qe(i,o){const e=10**Math.trunc(o),t=Vn(i,e);return Math.floor(fr(i,e)+t)/e}function $e(i,o){const e=10**Math.trunc(o),t=Vn(i,e);return Math.ceil(fr(i,e)-t)/e}function Vn(i,o){return Number.EPSILON*Math.max(1,Math.abs(fr(i,o)))}function qi(i,o){return i-o*Math.floor(i/o)}function jf(i,o){return i**o}function xf(i){return Math.sqrt(i)}function Xi(i,o){return i===o}function Uf(i,o){return i>o}function Tf(i,o){return i>=o}function vf(i,o){return i<o}function If(i,o){return i<=o}function Gs(i,o=15){return Math.floor(Math.abs(i)).toString().length>=o?i:Number.parseFloat(i.toPrecision(o))}function Ff(i,o,e=Number.EPSILON){return Math.abs(i-o)<e}function On(i,o=12,e=1e-10){const t=Gs(i,o);return Ff(i,t,e)?t:Gs(i)}function Bf(i){return i-Math.trunc(i)}const ms=class ms extends pt{static create(){return this._instance=this._instance||new ms(0),this._instance}isNull(){return!0}plus(o){return y.create(0).plus(o)}minus(o){return y.create(0).minus(o)}multiply(o){return y.create(0).multiply(o)}divided(o){return y.create(0).divided(o)}mod(o){return y.create(0).mod(o)}compare(o,e){return o.isString()?T.create("").compare(o,e):o.isBoolean()?F.create(!1).compare(o,e):y.create(0).compare(o,e)}concatenateFront(o){return o.isArray()?o.concatenateBack(T.create("")):T.create(this.concatenate(o.getValue(),rt.FRONT))}concatenateBack(o){return o.isArray()?o.concatenateFront(T.create("")):T.create(this.concatenate(o.getValue(),rt.BACK))}plusBy(o){return y.create(0).plusBy(o)}minusBy(o){return y.create(0).minusBy(o)}multiplyBy(o){return y.create(0).multiplyBy(o)}dividedBy(o){return y.create(0).dividedBy(o)}compareBy(o,e){return typeof o=="string"?T.create("").compareBy(o,e):typeof o=="boolean"?F.create(!1).compareBy(o,e):y.create(0).compareBy(o,e)}pow(o){return y.create(0).pow(o)}sqrt(){return y.create(0).sqrt()}cbrt(){return y.create(0).cbrt()}cos(){return y.create(0).cos()}cosh(){return y.create(0).cosh()}acos(){return y.create(0).acos()}acosh(){return y.create(0).acosh()}sin(){return y.create(0).sin()}sinh(){return y.create(0).sinh()}asin(){return y.create(0).asin()}asinh(){return y.create(0).asinh()}tan(){return y.create(0).tan()}tanh(){return y.create(0).tanh()}atan(){return y.create(0).atan()}atan2(o){return y.create(0).atan2(o)}atanh(){return y.create(0).atanh()}log(){return g.create(h.NUM)}log10(){return g.create(h.NUM)}exp(){return y.create(0).exp()}abs(){return y.create(0).abs()}round(o){return y.create(0).round(o)}floor(o){return y.create(0).floor(o)}ceil(o){return y.create(0).ceil(o)}convertToNumberObjectValue(){return y.create(0)}convertToBooleanObjectValue(){return F.create(!1)}};A(ms,"_instance");let le=ms;const sr=class sr extends pt{constructor(e){super(e);A(this,"_value",!1);this._value=e}static create(e){return e?(this._instanceTrue=this._instanceTrue||new sr(!0),this._instanceTrue):(this._instanceFalse=this._instanceFalse||new sr(!1),this._instanceFalse)}getValue(){return this._value}isBoolean(){return!0}getNegative(){const e=this.getValue();let t=0;return e&&(t=1),y.create(-t)}getReciprocal(){return this.getValue()?y.create(1):g.create(h.DIV_BY_ZERO)}plus(e){return this._convertToNumber().plus(e)}minus(e){return this._convertToNumber().minus(e)}multiply(e){return this._convertToNumber().multiply(e)}divided(e){return this._convertToNumber().divided(e)}mod(e){return this._convertToNumber().mod(e)}compare(e,t){return e.isArray()?e.compare(this,Fs(t)):e.isNull()?this._convertToNumber().compare(e,t):this.compareBy(e.getValue(),t)}compareBy(e,t){let r=!1;if(typeof e=="string"||typeof e=="number")r=this._compareString(t);else if(typeof e=="boolean"){const n=y.create(e?1:0);return this._convertToNumber().compare(n,t)}return sr.create(r)}_compareString(e){switch(e){case H.GREATER_THAN:case H.GREATER_THAN_OR_EQUAL:return!0;case H.EQUALS:case H.LESS_THAN:case H.LESS_THAN_OR_EQUAL:case H.NOT_EQUAL:return!1}}concatenateFront(e){return this._convertToNumber().concatenateFront(e)}concatenateBack(e){return this._convertToNumber().concatenateBack(e)}_convertToNumber(){const e=this.getValue();let t=0;return e&&(t=1),y.create(t)}pow(e){return this._convertToNumber().pow(e)}sqrt(){return this._convertToNumber().sqrt()}cbrt(){return this._convertToNumber().cbrt()}cos(){return this._convertToNumber().cos()}cosh(){return this._convertToNumber().cosh()}acos(){return this._convertToNumber().acos()}acosh(){return this._convertToNumber().acosh()}sin(){return this._convertToNumber().sin()}sinh(){return this._convertToNumber().sinh()}asin(){return this._convertToNumber().asin()}asinh(){return this._convertToNumber().asinh()}tan(){return this._convertToNumber().tan()}tanh(){return this._convertToNumber().tanh()}atan(){return this._convertToNumber().atan()}atan2(e){return this._convertToNumber().atan2(e)}atanh(){return this._convertToNumber().atanh()}log(){return this._convertToNumber().log()}log10(){return this._convertToNumber().log10()}exp(){return this._convertToNumber().exp()}abs(){return this._convertToNumber().abs()}round(e){return this._convertToNumber().round(e)}floor(e){return this._convertToNumber().floor(e)}ceil(e){return this._convertToNumber().ceil(e)}convertToNumberObjectValue(){return Lr(this.getValue())}convertToBooleanObjectValue(){return this}};A(sr,"_instanceTrue"),A(sr,"_instanceFalse");let F=sr;class y extends pt{constructor(e){super(e);A(this,"_value",0);this._value=Number(e)}static create(e,t=""){const r=new y(e);return t&&r.setPattern(t),r}getValue(){return this._value}setValue(e){this._value=e}isNumber(){return!0}getNegative(){return y.create(0).minus(this)}getReciprocal(){return y.create(1).divided(this)}plus(e){if(e.isArray())return e.plus(this);let t=e;e.isNumber()||(t=e.convertToNumberObjectValue());let r=this.plusBy(t.getValue());if(r.isError())return r;const n=Cn(this.getPattern(),t.getPattern(),z.PLUS);return r=y.create(Number(r.getValue()),n),r}equalZero(){return this._value===0}minus(e){if(e.isArray()){const s=e.getNegative();return s.isError()?s:s.plus(this)}let t=e;e.isNumber()||(t=e.convertToNumberObjectValue());let r=this.minusBy(t.getValue());if(r.isError())return r;const n=Cn(this.getPattern(),t.getPattern(),z.MINUS);return r=y.create(Number(r.getValue()),n),r}multiply(e){if(e.isArray())return e.multiply(this);let t=e;e.isNumber()||(t=e.convertToNumberObjectValue());let r=this.multiplyBy(t.getValue());if(r.isError())return r;const n=Cn(this.getPattern(),t.getPattern(),z.MULTIPLY);return r=y.create(Number(r.getValue()),n),r}divided(e){if(e.isArray()){const s=e.getReciprocal();return s.isError()?s:s.multiply(this)}let t=e;e.isNumber()||(t=e.convertToNumberObjectValue());let r=this.dividedBy(t.getValue());if(r.isError())return r;const n=Cn(this.getPattern(),t.getPattern(),z.DIVIDED);return r=y.create(Number(r.getValue()),n),r}mod(e){if(e.isArray())return e.modInverse(this);const t=this.getValue(),r=e.getValue();if(e.isNull())return g.create(h.DIV_BY_ZERO);if(typeof r=="string")return g.create(h.VALUE);if(typeof r=="number"){if(r===0)return g.create(h.DIV_BY_ZERO);if(!Number.isFinite(t)||!Number.isFinite(r)||Math.abs(r)*11259e8<=Math.abs(t))return g.create(h.NUM);const n=qi(t,r);return Number.isFinite(n)?y.create(n):g.create(h.NUM)}if(typeof r=="boolean"){const n=r?1:0;return n===0?g.create(h.DIV_BY_ZERO):y.create(qi(t,n))}return this}concatenateFront(e){return e.isArray()?e.concatenateBack(this):T.create(this.concatenate(e.getValue(),rt.FRONT))}concatenateBack(e){return e.isArray()?e.concatenateFront(this):T.create(this.concatenate(e.getValue(),rt.BACK))}isDateFormat(){const e=this.getPattern();return M.numfmt.isDateFormat(e)}compare(e,t){if(e.isArray())return e.compare(this,Fs(t));let r=!1;return e.isDateFormat()&&this.isDateFormat()&&(r=!0),this.compareBy(e.getValue(),t,r)}plusBy(e){if(typeof e=="string"&&e.trim()==="")return g.create(h.VALUE);const t=+this.getValue(),r=+e;if(Number.isNaN(t)||Number.isNaN(r))return g.create(h.VALUE);if(!Number.isFinite(t)||!Number.isFinite(r))return g.create(h.NUM);const n=wf(t,r);return Number.isFinite(n)?y.create(n):g.create(h.NUM)}minusBy(e){if(typeof e=="string"&&e.trim()==="")return g.create(h.VALUE);const t=+this.getValue(),r=+e;if(Number.isNaN(t)||Number.isNaN(r))return g.create(h.VALUE);if(!Number.isFinite(t)||!Number.isFinite(r))return g.create(h.NUM);const n=Lf(t,r);return Number.isFinite(n)?y.create(n):g.create(h.NUM)}multiplyBy(e){if(typeof e=="string"&&e.trim()==="")return g.create(h.VALUE);const t=+this.getValue(),r=+e;if(Number.isNaN(t)||Number.isNaN(r))return g.create(h.VALUE);if(!Number.isFinite(t)||!Number.isFinite(r))return g.create(h.NUM);const n=fr(t,r);return Number.isFinite(n)?y.create(n):g.create(h.NUM)}dividedBy(e){if(typeof e=="string"&&e.trim()==="")return g.create(h.VALUE);const t=+this.getValue(),r=+e;if(Number.isNaN(t)||Number.isNaN(r))return g.create(h.VALUE);if(!Number.isFinite(t)||!Number.isFinite(r))return g.create(h.NUM);if(r===0)return g.create(h.DIV_BY_ZERO);const n=Pf(t,r);return Number.isFinite(n)?y.create(n):g.create(h.NUM)}compareBy(e,t,r=!1){const n=this.getValue();let s=!1,a=n,u=e;return r&&(a=Math.round(n*1e8)/1e8,u=Math.round(e*1e8)/1e8),typeof u=="string"?s=this._compareString(t):typeof u=="number"?s=this._compareNumber(a,u,t):typeof u=="boolean"&&(s=this._compareBoolean(t)),F.create(s)}_compareString(e){switch(e){case H.EQUALS:case H.GREATER_THAN:case H.GREATER_THAN_OR_EQUAL:return!1;case H.LESS_THAN:case H.LESS_THAN_OR_EQUAL:case H.NOT_EQUAL:return!0}}_compareNumber(e,t,r){return!Number.isFinite(e)||!Number.isFinite(t)?this._compareInfinity(e,t,r):this._compareFiniteNumber(e,t,r)}_compareFiniteNumber(e,t,r){switch(r){case H.EQUALS:return Xi(e,t);case H.GREATER_THAN:return Uf(e,t);case H.GREATER_THAN_OR_EQUAL:return Tf(e,t);case H.LESS_THAN:return vf(e,t);case H.LESS_THAN_OR_EQUAL:return If(e,t);case H.NOT_EQUAL:return!Xi(e,t)}}_compareBoolean(e){switch(e){case H.EQUALS:case H.GREATER_THAN:case H.GREATER_THAN_OR_EQUAL:return!1;case H.LESS_THAN:case H.LESS_THAN_OR_EQUAL:case H.NOT_EQUAL:return!0}}pow(e){if(e.isArray())return e.powInverse(this);if(this.isError())return this;const t=this.getValue();let r=e;if(e.isString()&&(r=e.convertToNumberObjectValue()),r.isError())return r;const n=+r.getValue();if(Number.isNaN(n))return g.create(h.VALUE);if(!Number.isFinite(t)||!Number.isFinite(n))return g.create(h.NUM);if(t===0)return n<0?g.create(h.DIV_BY_ZERO):n===0?g.create(h.NUM):y.create(0);const s=jf(t,n);return Number.isFinite(s)?y.create(s):g.create(h.NUM)}sqrt(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=xf(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}cbrt(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.cbrt(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}cos(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.cos(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}cosh(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.cosh(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}acos(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.acos(e);return Number.isNaN(t)?g.create(h.NUM):y.create(t)}acosh(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.acosh(e);return Number.isNaN(t)?g.create(h.NUM):y.create(t)}sin(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.sin(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}sinh(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.sinh(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}asin(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.asin(e);return Number.isNaN(t)?g.create(h.NUM):y.create(t)}asinh(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.asinh(e);return Number.isNaN(t)?g.create(h.NUM):y.create(t)}tan(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.tan(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}tanh(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.tanh(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}atan(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.atan(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}atan2(e){if(e.isArray())return e.atan2Inverse(this);const t=this.getValue(),r=e.getValue();if(typeof r=="string")return g.create(h.VALUE);if(typeof r=="number"){if(!Number.isFinite(t)||!Number.isFinite(r))return g.create(h.NUM);if(t===0&&r===0)return g.create(h.DIV_BY_ZERO);const n=Math.atan2(t,r);return Number.isFinite(n)?y.create(n):g.create(h.NUM)}return typeof r=="boolean"?y.create(Math.atan2(t,r?1:0)):this}atanh(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.atanh(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}log(){const e=this.getValue();if(typeof e=="number"&&e<=0||!Number.isFinite(e))return g.create(h.NUM);const t=Math.log(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}log10(){const e=this.getValue();if(typeof e=="number"&&e<=0||!Number.isFinite(e))return g.create(h.NUM);const t=Math.log10(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}exp(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.exp(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}abs(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.abs(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}round(e){if(e.isArray())return e.roundInverse(this);const t=this.getValue(),r=e.getValue();if(typeof r=="string")return g.create(h.VALUE);if(typeof r=="number"){if(!Number.isFinite(t)||!Number.isFinite(r))return g.create(h.NUM);const n=t<0?-Ut(Math.abs(t),r):Ut(t,r);return Number.isFinite(n)?y.create(n):g.create(h.NUM)}return typeof r=="boolean"?y.create(Ut(t,r?1:0)):this}floor(e){if(e.isArray())return e.floorInverse(this);const t=this.getValue(),r=e.getValue();if(typeof r=="string")return g.create(h.VALUE);if(typeof r=="number"){if(!Number.isFinite(t)||!Number.isFinite(r))return g.create(h.NUM);const n=t<0?-Qe(Math.abs(t),r):Qe(t,r);return Number.isFinite(n)?y.create(n):g.create(h.NUM)}return typeof r=="boolean"?y.create(Qe(t,r?1:0)):this}ceil(e){if(e.isArray())return e.ceilInverse(this);const t=this.getValue(),r=e.getValue();if(typeof r=="string")return g.create(h.VALUE);if(typeof r=="number"){if(!Number.isFinite(t)||!Number.isFinite(r))return g.create(h.NUM);const n=t<0?-$e(Math.abs(t),r):$e(t,r);return Number.isFinite(n)?y.create(n):g.create(h.NUM)}return typeof r=="boolean"?y.create($e(t,r?1:0)):this}convertToNumberObjectValue(){return this}convertToBooleanObjectValue(){return Sn(!0)}_compareInfinity(e,t,r){let n=!1;switch(r){case H.EQUALS:n=e===t;break;case H.GREATER_THAN:n=e>t;break;case H.GREATER_THAN_OR_EQUAL:n=e>=t;break;case H.LESS_THAN:n=e<t;break;case H.LESS_THAN_OR_EQUAL:n=e<=t;break;case H.NOT_EQUAL:n=e!==t;break}return n}}const kf=1e5,Ws=new yt(kf);class T extends pt{constructor(e){super(e);A(this,"_value");A(this,"_isHyperlink",!1);A(this,"_hyperlinkUrl","");A(this,"_isImage",!1);A(this,"_imageInfo");this._value=e}static create(e,t){var s;const r=Ws.get(e);if(r&&t&&this.checkCacheByOptions(r,t))return r;const n=new T(e);return t!=null&&t.isHyperlink&&(n._isHyperlink=t.isHyperlink,n._hyperlinkUrl=(s=t.hyperlinkUrl)!=null?s:""),t!=null&&t.isImage&&(n._isImage=t.isImage,n._imageInfo=t.imageInfo),Ws.set(e,n),n}static checkCacheByOptions(e,t){return!(e.isHyperlink()!==t.isHyperlink||e.getHyperlinkUrl()!==t.hyperlinkUrl||e.isImage()!==t.isImage||!M.Tools.diffValue(e.getImageInfo(),t.imageInfo))}getValue(){return this._value}isString(){return!0}isHyperlink(){return this._isHyperlink}getHyperlinkUrl(){return this._hyperlinkUrl}isImage(){return this._isImage}getImageInfo(){return this._imageInfo}concatenateFront(e){return e.isArray()?e.concatenateBack(this):T.create(this.concatenate(e.getValue(),rt.FRONT))}concatenateBack(e){return e.isArray()?e.concatenateFront(this):T.create(this.concatenate(e.getValue(),rt.BACK))}plus(e){return this.convertToNumberObjectValue().plus(e)}minus(e){return this.convertToNumberObjectValue().minus(e)}multiply(e){return this.convertToNumberObjectValue().multiply(e)}divided(e){return this.convertToNumberObjectValue().divided(e)}compare(e,t,r){return e.isArray()?e.compare(this,Fs(t),r):this.compareBy(e.getValue(),t,r)}compareBy(e,t,r=!1){let n=this.getValue(),s=!1;if(typeof e=="string"){let a=e;if(r||(n=n.toLocaleLowerCase(),a=a.toLocaleLowerCase()),wi(a))return this._checkWildcard(a,t);s=this._compareString(n,a,t)}else typeof e=="number"?s=this._compareNumber(t):typeof e=="boolean"&&(s=this._compareBoolean(t));return F.create(s)}_compareString(e,t,r){switch(r){case H.EQUALS:return e===t;case H.GREATER_THAN:return e>t;case H.GREATER_THAN_OR_EQUAL:return e>=t;case H.LESS_THAN:return e<t;case H.LESS_THAN_OR_EQUAL:return e<=t;case H.NOT_EQUAL:return e!==t}}_compareNumber(e){switch(e){case H.NOT_EQUAL:case H.GREATER_THAN:case H.GREATER_THAN_OR_EQUAL:return!0;case H.EQUALS:case H.LESS_THAN:case H.LESS_THAN_OR_EQUAL:return!1}}_compareBoolean(e){switch(e){case H.EQUALS:case H.GREATER_THAN:case H.GREATER_THAN_OR_EQUAL:return!1;case H.LESS_THAN:case H.LESS_THAN_OR_EQUAL:case H.NOT_EQUAL:return!0}}convertToNumberObjectValue(){const e=this.getValue(),t=M.getNumfmtParseValueFilter(e);return t&&t.z?Lr(t.v,t.z):Lr(e)}convertToBooleanObjectValue(){return F.create(!0)}_checkWildcard(e,t){const r=this.getValue().toLocaleLowerCase(),n=Nl(r,e,t);return F.create(n)}}function Sn(i){if(typeof i=="boolean")return F.create(i);let o=!1;if(typeof i=="string"){const e=i.toLocaleUpperCase();e===St.TRUE?o=!0:e===St.FALSE&&(o=!1)}else i===1?o=!0:o=!1;return F.create(o)}function $f(i){let o=i.toString();return o.charAt(0)==='"'&&o.charAt(o.length-1)==='"'&&(o=o.slice(1,-1),o=o.replace(/""/g,'"')),T.create(o)}function Lr(i,o=""){if(typeof i=="boolean"){let e=0;return i&&(e=1),y.create(e,o)}else{if(typeof i=="number")return Number.isFinite(i)?y.create(i,o):g.create(h.NUM);if(M.isRealNum(i))return y.create(Number(i),o)}return g.create(h.VALUE)}function Yf(i){return""}function Ki(i=[],o=!1){const e=[];for(let t=0;t<i.length;t++){const r=i[t];e[t]==null&&(e[t]=[]);for(let n=0;n<r.length;n++){const s=r[n];e[t][n]=ht.create(s,o)}}return e}function Hf(i=[]){const o=[];for(let e=0;e<i.length;e++){const t=i[e];o[e]==null&&(o[e]=[]);for(let r=0;r<t.length;r++){const n=t[r];n==null?o[e][r]=null:n.isError()?o[e][r]=n.getErrorType():o[e][r]=n.getValue()}}return o}class Z extends pt{constructor(e){super(typeof e=="string"?e:Yf());A(this,"_values",[]);A(this,"_rowCount",-1);A(this,"_columnCount",-1);A(this,"_unitId","");A(this,"_sheetId","");A(this,"_currentRow",-1);A(this,"_currentColumn",-1);A(this,"_sliceCache",new Map);A(this,"_flattenCache");A(this,"_defaultValue",null);A(this,"_flattenPosition");this._values=this._formatValue(e)}static create(e){return new Z(e)}static createByArray(e){const r={calculateValueList:Ki(e),rowCount:e.length,columnCount:e[0].length||0,unitId:"",sheetId:"",row:-1,column:-1};return new Z(r)}dispose(){this._values=[],this._defaultValue=null,this._flattenPosition=null,this._clearCache()}clone(){return this.map(e=>e)}getRowCount(){return this._rowCount}setRowCount(e){this._rowCount=e}getColumnCount(){return this._columnCount}setColumnCount(e){this._columnCount=e}setCurrent(e,t){this._currentRow=e,this._currentColumn=t}setUnitId(e){this._unitId=e}getUnitId(){return this._unitId}setSheetId(e){this._sheetId=e}getSheetId(){return this._sheetId}getCurrentRow(){return this._currentRow}getCurrentColumn(){return this._currentColumn}getArrayValue(){return this._values}setArrayValue(e){this._clearCache(),this._values=e}isArray(){return!0}setDefaultValue(e){this._defaultValue=e}get(e,t){var r;return((r=this._values[e])==null?void 0:r[t])||this._defaultValue}getRealValue(e,t){const r=this._values[e];if(r==null)return null;const n=r[t];return n==null?null:n}getValueOrDefault(e,t){return this.get(e,t)||this._defaultValue}set(e,t,r){if(e>=this._rowCount||t>=this._columnCount)throw new Error("Exceeding array bounds.");this._clearCache(),this._values[e][t]=r}getRangePosition(){const t=this.getRowCount(),r=0,n=this.getColumnCount();return{startRow:0,endRow:t-1,startColumn:r,endColumn:n-1}}iterator(e){var u;const{startRow:t,endRow:r,startColumn:n,endColumn:s}=this.getRangePosition(),a=this.getArrayValue();for(let c=t;c<=r;c++)for(let l=n;l<=s;l++)if(e(((u=a[c])==null?void 0:u[l])||this._defaultValue,c,l)===!1)return}iteratorReverse(e){var u;const{startRow:t,endRow:r,startColumn:n,endColumn:s}=this.getRangePosition(),a=this.getArrayValue();for(let c=r;c>=t;c--)for(let l=s;l>=n;l--)if(e(((u=a[c])==null?void 0:u[l])||this._defaultValue,c,l)===!1)return}getLastTruePosition(){let e;return this.iteratorReverse((t,r,n)=>{if(t!=null&&t.isBoolean()&&t.getValue()===!0)return e={row:r,column:n},!1}),e}getFirstTruePosition(){let e;return this.iterator((t,r,n)=>{if(t!=null&&t.isBoolean()&&t.getValue()===!0)return e={row:r,column:n},!1}),e}getFirstCell(){const{startRow:e,startColumn:t}=this.getRangePosition();return this.get(e,t)||this._defaultValue||le.create()}getLastCell(){const{endRow:e,endColumn:t}=this.getRangePosition();return this.get(e,t)||this._defaultValue||le.create()}pick(e){const t=this.pickRaw(e);return this._createNewArray(t,1,t[0].length)}pickRaw(e){const t=e.getRowCount(),r=e.getColumnCount();if(t!==this._rowCount||r!==this._columnCount)return[[le.create()]];const n=[];n[0]=[];for(let s=0;s<t;s++)for(let a=0;a<r;a++){const u=e.get(s,a);if(!(u==null||u.isError())&&u.getValue()===!0){const c=this.get(s,a);n[0].push(c)}}return n}flatten(){if(this._flattenCache!=null)return this._flattenCache;const e=[];e[0]=[];for(let r=0;r<this._rowCount;r++)for(let n=0;n<this._columnCount;n++){const s=this.get(r,n);e[0].push(s)}const t=this._createNewArray(e,1,e[0].length);return t.setDefaultValue(this._defaultValue),this._flattenCache=t,t}flattenPosition(){if(this._flattenPosition!=null)return this._flattenPosition;const e=[],t=[],r=[],n=[];let s=0;for(let u=0;u<this._rowCount;u++)for(let c=0;c<this._columnCount;c++){const l=this.get(u,c);if(l==null||l.isError()||l.isNull()){s++;continue}l.isString()?(e.push(l),r.push(s++)):(t.push(l),n.push(s++))}const a={stringArray:e,numberArray:t,stringPosition:r,numberPosition:n};return this._flattenPosition=a,a}slice(e,t){let r=0,n=this._rowCount,s=1,a=0,u=this._columnCount,c=1;if(e!=null&&(r=e[0]||0,n=e[1]||this._rowCount,s=e[2]||1),t!=null&&(a=t[0]||0,u=t[1]||this._columnCount,c=t[2]||1),r>=this._rowCount||a>=this._columnCount)return;const l=`${r}_${n}_${s}_${a}_${u}_${c}`,f=this._sliceCache.get(l);if(f!=null)return f;const m=[],d=this._values;let C=0,_=0;for(let N=r;N<n;N+=s){_=0,m[C]==null&&(m[C]=[]);for(let V=a;V<u;V+=c){if(!d[N])return;let S=d[N][V]||this._defaultValue;S==null&&(S=le.create()),m[C][_]=S,_++}C++}if(m.length===0||m[0].length===0)return;const E=s>1?-1:r+this._currentRow,R=c>1?-1:a+this._currentColumn,b=this._createNewArray(m,m.length,m[0].length,E,R);return b.setDefaultValue(this._defaultValue),this._sliceCache.set(l,b),b}sortByRow(e){const t=this._transposeArray(this._values);t.sort(this._sort(e)),this._clearCache(),this._values=this._transposeArray(t)}sortByColumn(e){this._clearCache(),this._values.sort(this._sort(e))}transpose(){const e=this._transposeArray(this._values),t=this._rowCount,r=this._columnCount,n=this._createNewArray(e,r,t);return n.setDefaultValue(this._defaultValue),n}orderSearch(e,t=Le.MIN,r=!1,n=!1){let s,a,u,c;const l=(f,m,d)=>{if(f==null||f.isNull())return!0;let C;if(n===!0?C=f.compare(e,H.EQUALS):C=f.isEqual(e),(C==null?void 0:C.getValue())===!0)return s=f,u={row:m,column:d},!1;t===Le.MAX?f.isGreaterThan(e).getValue()===!0&&(a==null||f.minus(e).abs().isLessThanOrEqual(a.minus(e).abs()).getValue()===!0)&&(a=f,c={row:m,column:d}):t===Le.MIN&&f.isLessThan(e).getValue()===!0&&(a==null||f.minus(e).abs().isLessThanOrEqual(a.minus(e).abs()).getValue()===!0)&&(a=f,c={row:m,column:d})};if(r?this.iteratorReverse((f,m,d)=>l(f,m,d)):this.iterator((f,m,d)=>l(f,m,d)),s!=null)return u;if(a!=null)return c}binarySearch(e,t=Gt.MIN,r=Le.MIN){if(e.isError())return;const{stringArray:n,stringPosition:s,numberArray:a,numberPosition:u}=this.flattenPosition();return e.isString()?this._binarySearch(e,n,s,t,r):this._binarySearch(e,a,u,t,r)}_binarySearch(e,t,r,n=Gt.MIN,s=Le.MIN){const a=dn(),u=Number(e.getValue()),c=!Number.isNaN(u);let l=0,f=t.length-1,m=-1,d=-1,C=-1;for(;l<=f;){const _=Math.floor((l+f)/2),E=t[_];let R;if(E.isNull())R=n===Gt.MIN?1:-1;else{const b=E.getValue();if(c){const N=Number(b);R=Number.isNaN(N)?1:Math.sign(N-u)}else R=a(b.toString().toLocaleLowerCase(),e.getValue().toString().toLocaleLowerCase())}if(n===Gt.MAX&&(R=-R),R===0){m=_;break}R<0?(d=_,l=_+1):(C=_,f=_-1)}if(s===Le.NORMAL)return m!==-1?r[m]:void 0;if(s===Le.MIN)return m!==-1?r[m]:n===Gt.MIN?r[d]:r[C];if(s===Le.MAX)return m!==-1?r[m]:n===Gt.MIN?r[C]:r[d]}sum(){let e=y.create(0);return this.iterator(t=>{if(t==null||t.isString()||t.isBoolean()||t.isNull())return!0;if(t.isError())return e=t,!1;e=e.plus(t)}),e}max(){let e=y.create(Number.NEGATIVE_INFINITY);return this.iterator(t=>{if(t==null)return!0;if(t.isError())return e=t,!1;if(t.isString()||t.isNull()||t.isBoolean())return!0;e.isLessThan(t).getValue()&&(e=t)}),e}min(){let e=y.create(Number.POSITIVE_INFINITY);return this.iterator(t=>{if(t==null)return!0;if(t.isError())return e=t,!1;if(t.isString()||t.isNull()||t.isBoolean())return!0;e.isGreaterThan(t).getValue()&&(e=t)}),e}count(){let e=y.create(0);return this.iterator(t=>{if(t==null||t.isError()||t.isString()||t.isNull()||t.isBoolean())return!0;e=e.plusBy(1)}),e}countA(){let e=y.create(0);return this.iterator(t=>{if(t==null||t.isNull())return!0;e=e.plusBy(1)}),e}countBlank(){let e=y.create(0);return this.iterator(t=>{(t==null||t.isNull()||t.getValue()==="")&&(e=e.plusBy(1))}),e}getNegative(){return Z.create("{0}").minus(this)}getReciprocal(){return Z.create("{1}").divided(this)}plus(e){return this._batchOperator(e,1)}minus(e){return this._batchOperator(e,0)}multiply(e){return this._batchOperator(e,2)}divided(e){return this._batchOperator(e,3)}mod(e){return this._batchOperator(e,4)}modInverse(e){return this.map(t=>t.isError()?t:e.mod(t))}compare(e,t,r){return this._batchOperator(e,5,t,r)}concatenateFront(e){return this._batchOperator(e,6)}concatenateBack(e){return this._batchOperator(e,7)}map(e){const t=(r,n,s)=>r==null?le.create():r.isError()?r:e(r,n,s);return this.mapValue(t)}mapValue(e){var s;const t=this._rowCount,r=this._columnCount,n=[];for(let a=0;a<t;a++){const u=[];for(let c=0;c<r;c++){const l=(s=this._values)==null?void 0:s[a];if(l==null)u[c]=g.create(h.VALUE);else{const f=l[c]||this._defaultValue;f?u[c]=e(f,a,c):u[c]=le.create()}}n.push(u)}return this._createNewArray(n,t,r)}pow(e){return this._batchOperator(e,8)}powInverse(e){return this.map(t=>t.isError()?t:e.pow(t))}sqrt(){return this.map(e=>e.isError()?e:e.sqrt())}cbrt(){return this.map(e=>e.isError()?e:e.cbrt())}cos(){return this.map(e=>e.isError()?e:e.cos())}cosh(){return this.map(e=>e.isError()?e:e.cosh())}acos(){return this.map(e=>e.isError()?e:e.acos())}acosh(){return this.map(e=>e.isError()?e:e.acosh())}sin(){return this.map(e=>e.isError()?e:e.sin())}sinh(){return this.map(e=>e.isError()?e:e.sinh())}asin(){return this.map(e=>e.isError()?e:e.asin())}asinh(){return this.map(e=>e.isError()?e:e.asinh())}tan(){return this.map(e=>e.isError()?e:e.tan())}tanh(){return this.map(e=>e.isError()?e:e.tanh())}atan(){return this.map(e=>e.isError()?e:e.atan())}atanh(){return this.map(e=>e.isError()?e:e.atanh())}atan2(e){return this._batchOperator(e,12)}atan2Inverse(e){return this.map(t=>t.isError()?t:e.atan2(t))}mean(e=0){const t=this.sum(),r=this.count();return t.divided(e===0?r:r.minusBy(1))}median(){const e=this.flattenPosition().numberArray,t=this._createNewArray([e],1,e.length),r=t.getColumnCount();if(r<=1)return t.get(0,0)||le.create();if(t.sortByRow(0),r%2===0){const n=t.get(0,r/2)||le.create(),s=t.get(0,r/2-1)||le.create();return n.plus(s).divided(y.create(2))}return t.get(0,(r-1)/2)||le.create()}var(e=0){const t=this.mean(),r=[[]];this.iterator(l=>{if(l==null||l.isError()||l.isString()||l.isBoolean()||l.isNull())return;const f=l.minus(t).pow(y.create(2));f.isError()||r[0].push(f)});const{_unitId:n,_sheetId:s,_currentRow:a,_currentColumn:u}=this;return Z.create({calculateValueList:r,rowCount:1,columnCount:r[0].length,unitId:n,sheetId:s,row:a,column:u}).mean(e)}std(e=0){const t=this.var(e);return t.isError()?t:t.sqrt()}log(){return this.map(e=>e.isError()?e:e.log())}log10(){return this.map(e=>e.isError()?e:e.log10())}exp(){return this.map(e=>e.isError()?e:e.exp())}abs(){return this.map(e=>e.isError()?e:e.abs())}round(e){return this._batchOperator(e,9)}roundInverse(e){return this.map(t=>t.isError()?t:e.round(t))}floor(e){return this._batchOperator(e,10)}floorInverse(e){return this.map(t=>t.isError()?t:e.floor(t))}ceil(e){return this._batchOperator(e,11)}ceilInverse(e){return this.map(t=>t.isError()?t:e.ceil(t))}toValue(){return Hf(this._values)}_clearCache(){this._flattenCache=null,this._sliceCache.clear()}_sort(e){const t=dn();return(r,n)=>{const s=r[e],a=n[e];return s==null?1:a==null?-1:s.isError()&&s.isError()?0:s.isError()?1:a.isError()?-1:t(s.getValue(),a.getValue())}}_transposeArray(e){const t=e.length,r=e[0].length,n=[];for(let s=0;s<r;s++){n[s]=[];for(let a=0;a<t;a++)n[s][a]=e[a][s]}return n}_batchOperator(e,t,r,n){const s=[];let a=this._rowCount,u=this._columnCount;if(e.isArray()){const f=e.getRowCount(),m=e.getColumnCount();if(a=Math.max(f,a),u=Math.max(m,u),f===1&&m===1){const d=e.getFirstCell();for(let C=0;C<u;C++)s.push(d)}else if(f===1&&this._columnCount>1){const d=e.getArrayValue();for(let C=0;C<u;C++)d[0]&&d[0][C]?s.push(d[0][C]):s.push(le.create())}else return this._batchOperatorArray(e,t,r,n)}else for(let f=0;f<u;f++)s.push(e);const c=[];for(let f=0;f<u;f++){const m=s[f];this._batchOperatorValue(m,f,c,t,r,n)}const l=this._createNewArray(c,a,u);return l.setDefaultValue(F.create(!1)),l}_batchOperatorValue(e,t,r,n,s,a){const u=this._rowCount,c=this.getUnitId(),l=this.getSheetId(),f=this.getCurrentRow(),m=this.getCurrentColumn();if(n===5){const{rowsInCache:d,rowsNotInCache:C}=Ge.canUseCache(c,l,t+m,f,f+u-1);if(d.length>0){if(s===H.EQUALS&&!(e.isString()&&wi(e.getValue()))){const _=Ge.getCellPositions(c,l,t+m,e.isNull()?null:e.getValue(),d);_!=null&&_.forEach(E=>{if(E<f||E>f+u-1)return;const R=E-f;r[R]==null&&(r[R]=[]),r[R][t]=F.create(!0)})}else{const _=Ge.getCellValuePositions(c,l,t+m);_!=null&&_.forEach((E,R)=>{let b=le.create();Dt.has(R)?b=g.create(R):typeof R=="string"?b=T.create(R):typeof R=="number"?b=y.create(R):typeof R=="boolean"&&(b=F.create(R));let N;b.isError()?N=b:e.isError()?N=e:N=b.compare(e,s,a),E.forEach(V=>{V>=f&&V<=f+u-1&&(r[V-f]==null&&(r[V-f]=[]),r[V-f][t]=N)})})}if(C.length>0)for(const _ of C){const[E,R]=_;for(let b=E;b<=R;b++)this.__batchOperatorRowValue(e,t,r,n,b-f,c,l,f,m,s,a);Ge.setContinueBuildingCache(c,l,t+m,E,R)}return}}for(let d=0;d<u;d++)this.__batchOperatorRowValue(e,t,r,n,d,c,l,f,m,s,a);Ge.setContinueBuildingCache(c,l,t+m,f,f+u-1)}__batchOperatorRowValue(e,t,r,n,s,a,u,c,l,f,m){const d=this.getValueOrDefault(s,t);if(r[s]==null&&(r[s]=[]),d&&e)if(d.isError())r[s][t]=d;else if(e.isError())r[s][t]=e;else switch(n){case 1:r[s][t]=d.plus(e);break;case 0:r[s][t]=d.minus(e);break;case 2:r[s][t]=d.multiply(e);break;case 3:r[s][t]=d.divided(e);break;case 4:r[s][t]=d.mod(e);break;case 5:f?r[s][t]=d.compare(e,f,m):r[s][t]=g.create(h.VALUE);break;case 6:r[s][t]=d.concatenateFront(e);break;case 7:r[s][t]=d.concatenateBack(e);break;case 8:r[s][t]=d.pow(e);break;case 9:r[s][t]=d.round(e);break;case 10:r[s][t]=d.floor(e);break;case 12:r[s][t]=d.atan2(e);break;case 11:r[s][t]=d.ceil(e);break}else r[s][t]=g.create(h.NA);!d||d!=null&&d.isNull()?Ge.set(a,u,t+l,Ds,s+c):Ge.set(a,u,t+l,d.getValue(),s+c)}_batchOperatorArray(e,t,r,n){let s=e.getRowCount(),a=e.getColumnCount();s<this._rowCount&&(s=this._rowCount),a<this._columnCount&&(a=this._columnCount);const u=[],c=this._checkArrayCalculateType(this),l=this._checkArrayCalculateType(e);for(let f=0;f<s;f++){const m=[];for(let d=0;d<a;d++){let C;c===3?C=this.getValueOrDefault(0,0):c===1?C=this.getValueOrDefault(0,d):c===2?C=this.getValueOrDefault(f,0):C=this.getValueOrDefault(f,d);let _;if(l===3?_=e.getValueOrDefault(0,0):l===1?_=e.getValueOrDefault(0,d):l===2?_=e.getValueOrDefault(f,0):_=e.getValueOrDefault(f,d),C&&_)if(C.isError())m[d]=C;else if(_.isError())m[d]=_;else switch(t){case 1:m[d]=C.plus(_);break;case 0:m[d]=C.minus(_);break;case 2:m[d]=C.multiply(_);break;case 3:m[d]=C.divided(_);break;case 4:m[d]=C.mod(_);break;case 5:r?m[d]=C.compare(_,r,n):m[d]=g.create(h.VALUE);break;case 6:m[d]=C.concatenateFront(_);break;case 7:m[d]=C.concatenateBack(_);break;case 8:m[d]=C.pow(_);break;case 9:m[d]=C.round(_);break;case 12:m[d]=C.atan2(_);break;case 10:m[d]=C.floor(_);break;case 11:m[d]=C.ceil(_);break}else m[d]=g.create(h.NA)}u.push(m)}return this._createNewArray(u,s,a)}_checkArrayCalculateType(e){return e.getRowCount()===1&&e.getColumnCount()===1?3:e.getRowCount()===1?1:e.getColumnCount()===1?2:0}_formatValue(e){if(typeof e!="string")return e=e,this._rowCount=e.rowCount,this._columnCount=e.columnCount,this._unitId=e.unitId,this._sheetId=e.sheetId,this._currentRow=e.row,this._currentColumn=e.column,e.calculateValueList;e=e.slice(1,-1);const t=e.split(";"),r=t.length,n=[];let s=0;for(let a=0;a<r;a++){const c=t[a].split(","),l=c.length;s<l&&(s=l);const f=[];for(let m=0;m<l;m++){const d=c[m].trim();f.push(ht.create(d))}n.push(f)}return this._rowCount=r,this._columnCount=s,n}_createNewArray(e,t,r,n=-1,s=-1){(this._currentColumn===-1||this._currentRow===-1)&&(n=-1,s=-1);const a={calculateValueList:e,rowCount:t,columnCount:r,unitId:this.getUnitId(),sheetId:this.getSheetId(),row:n,column:s};return Z.create(a)}}class ht{static create(o,e=!1){if(o==null)return le.create();if(typeof o=="boolean")return F.create(o);if(typeof o=="string"){const t=o.toLocaleUpperCase().trim();if(Dt.has(t))return g.create(t);if(t===St.TRUE||t===St.FALSE)return Sn(o);if(M.isRealNum(o))return y.create(Number(o));if(!e){const{isNumberPattern:n,value:s,pattern:a}=jl(o);if(n)return y.create(s,a)}const r=o.replace(/\n/g,"").replace(/\r/g,"");return!Gf(r)&&Qc(r)?Z.create(r):$f(o)}return typeof o=="number"?Lr(o):g.create(h.VALUE)}}function Gf(i){const o=i.trim();return o.startsWith('"')&&o.endsWith('"')}const Wf=1e4,mr=new yt(Wf);class Wt extends gn{constructor(e){super();A(this,"_forcedSheetId","");A(this,"_forcedSheetName","");A(this,"_defaultSheetId","");A(this,"_rangeData",{startColumn:-1,startRow:-1,endRow:-1,endColumn:-1});A(this,"_unitData",{});A(this,"_unitStylesData",{});A(this,"_filteredOutRows",[]);A(this,"_defaultUnitId","");A(this,"_forcedUnitId","");A(this,"_runtimeData",{});A(this,"_arrayFormulaCellData",{});A(this,"_runtimeArrayFormulaCellData",{});A(this,"_runtimeFeatureCellData",{});A(this,"_refOffsetX",0);A(this,"_refOffsetY",0);A(this,"_currentRow");A(this,"_currentColumn");this._token=e}dispose(){this._unitData={},this._unitStylesData={},this._runtimeData={}}getToken(){return this._token}setToken(e){this._token=e}isExceedRange(){const{startRow:e,endRow:t,startColumn:r,endColumn:n}=this.getRangePosition();return e<0||r<0||t>=this.getActiveSheetRowCount()||n>=this.getActiveSheetColumnCount()}setRefOffset(e=0,t=0){this._refOffsetX=e,this._refOffsetY=t}getRefOffset(){return{x:this._refOffsetX,y:this._refOffsetY}}getRangePosition(){const{x:e,y:t}=this.getRefOffset(),r=this.getRangeData();let{startRow:n,startColumn:s,endRow:a,endColumn:u}=M.moveRangeByOffset(r,e,t);return Number.isNaN(n)&&(n=0),Number.isNaN(s)&&(s=0),Number.isNaN(a)&&(a=this.getActiveSheetRowCount()-1),Number.isNaN(u)&&(u=this.getActiveSheetColumnCount()-1),{startRow:n,endRow:a,startColumn:s,endColumn:u}}isReferenceObject(){return!0}iterator(e){const{startRow:t,endRow:r,startColumn:n,endColumn:s}=this.getRangePosition();if(this._checkIfWorksheetMiss())return e(g.create(h.VALUE),t,n);const a=this._forcedUnitId||this._defaultUnitId,u=this._forcedSheetId||this._defaultSheetId;for(let c=t;c<=r;c++)for(let l=n;l<=s;l++){if(c<0||l<0)return e(g.create(h.REF),c,l);const f=this.getCellData(c,l);let m=!1;if(hn(f)){m=e(null,c,l);continue}let d=this.getCellValueObject(f);if(c===t&&l===n){const C=this.getCellPattern(a,u,c,l);if(C&&d.isNumber()){const _=Number(d.getValue());d=y.create(_,C)}}if(m=e(d,c,l),m===!1)return}}getFirstCell(){if(this._checkIfWorksheetMiss())return g.create(h.VALUE);const{startRow:e,startColumn:t}=this.getRangePosition(),r=this.getCellData(e,t);if(!r)return y.create(0);let n=this.getCellValueObject(r);const s=this._forcedUnitId||this._defaultUnitId,a=this._forcedSheetId||this._defaultSheetId,u=this.getCellPattern(s,a,e,t);if(u&&n.isNumber()){const c=Number(n.getValue());n=y.create(c,u)}return n}getRangeData(){return this._rangeData}setRangeData(e){this._rangeData=e}getUnitId(){return this._forcedUnitId&&this._forcedUnitId.length>0?this._forcedUnitId:this._defaultUnitId}getSheetId(){return this._forcedSheetId&&this._forcedSheetId.length>0?this._forcedSheetId:this._defaultSheetId}setForcedUnitIdDirect(e){e.length>0&&(this._forcedUnitId=e)}getForcedUnitId(){return this._forcedUnitId}setForcedSheetId(e){var t;this._forcedSheetId=(t=e[this.getUnitId()])==null?void 0:t[this._forcedSheetName]}setForcedSheetIdDirect(e){this._forcedSheetId=e}getForcedSheetId(){return this._forcedSheetId}setForcedSheetName(e){e.length>0&&(this._forcedSheetName=e)}getForcedSheetName(){return this._forcedSheetName}setDefaultSheetId(e){this._defaultSheetId=e}getDefaultSheetId(){return this._defaultSheetId}setDefaultUnitId(e){this._defaultUnitId=e}getDefaultUnitId(){return this._defaultUnitId}getUnitData(){return this._unitData}setUnitData(e){this._unitData=e}getUnitStylesData(){return this._unitStylesData}setUnitStylesData(e){this._unitStylesData=e}getFilteredOutRows(){return this._filteredOutRows}setFilteredOutRows(e){this._filteredOutRows=e}getRuntimeData(){return this._runtimeData}setRuntimeData(e){this._runtimeData=e}getArrayFormulaCellData(){return this._arrayFormulaCellData}setArrayFormulaCellData(e){this._arrayFormulaCellData=e}getRuntimeArrayFormulaCellData(){return this._runtimeArrayFormulaCellData}setRuntimeArrayFormulaCellData(e){this._runtimeArrayFormulaCellData=e}getRuntimeFeatureCellData(){return this._runtimeFeatureCellData}setRuntimeFeatureCellData(e){this._runtimeFeatureCellData=e}getActiveSheetRowCount(){var e;return((e=this.getCurrentActiveSheetData())==null?void 0:e.rowCount)||0}getActiveSheetColumnCount(){var e;return((e=this.getCurrentActiveSheetData())==null?void 0:e.columnCount)||0}getRowCount(){const e=this.getRangeData();return e.endRow-e.startRow+1}getColumnCount(){const e=this.getRangeData();return e.endColumn-e.startColumn+1}getRowData(){var e;return((e=this.getCurrentActiveSheetData())==null?void 0:e.rowData)||{}}getColumnData(){var e;return((e=this.getCurrentActiveSheetData())==null?void 0:e.columnData)||{}}isCell(){return!1}isColumn(){return!1}isRow(){return!1}isRange(){return!1}isTable(){return!1}isCurrentRowForRange(){return!1}isCurrentColumnForRange(){return!1}isMultiArea(){return!1}unionBy(e){return g.create(h.REF)}unionRange(e,t){return{startRow:-1,startColumn:-1,endRow:-1,endColumn:-1}}getCellValueObject(e){const t=bl(e);if(Dt.has(t))return g.create(t);if(e.t===M.CellValueType.NUMBER){const r=this._getPatternByCell(e);return M.isTextFormat(r)?T.create(t.toString()):Lr(t,r)}return e.t===M.CellValueType.STRING||e.t===M.CellValueType.FORCE_STRING?T.create(t.toString()):e.t===M.CellValueType.BOOLEAN?Sn(t):ht.create(t)}_getPatternByCell(e){var n;const t=this._unitStylesData[this.getUnitId()];if(!t)return"";const r=t.getStyleByCell(e);return((n=r==null?void 0:r.n)==null?void 0:n.pattern)||""}getCellByRow(e){return this.getCellByPosition(e)}getCellByColumn(e){return this.getCellByPosition(void 0,e)}getCurrentActiveSheetData(){var e;return(e=this._unitData[this.getUnitId()])==null?void 0:e[this.getSheetId()]}getCurrentStylesData(){return this._unitStylesData[this.getUnitId()]}getCurrentRuntimeSheetData(){var e,t;return(t=(e=this._runtimeData)==null?void 0:e[this.getUnitId()])==null?void 0:t[this.getSheetId()]}getCurrentActiveArrayFormulaCellData(){var e,t;return(t=(e=this._arrayFormulaCellData)==null?void 0:e[this.getUnitId()])==null?void 0:t[this.getSheetId()]}getCurrentRuntimeActiveArrayFormulaCellData(){var e,t;return(t=(e=this._runtimeArrayFormulaCellData)==null?void 0:e[this.getUnitId()])==null?void 0:t[this.getSheetId()]}getCellData(e,t){const r=this.getCurrentActiveSheetData(),n=this.getCurrentRuntimeSheetData(),s=this.getCurrentActiveArrayFormulaCellData(),a=this.getCurrentRuntimeActiveArrayFormulaCellData();return(n==null?void 0:n.getValue(e,t))||(a==null?void 0:a.getValue(e,t))||this.getRuntimeFeatureCellValue(e,t)||(s==null?void 0:s.getValue(e,t))||(r==null?void 0:r.cellData.getValue(e,t))}getRuntimeFeatureCellValue(e,t){return Di(e,t,this.getSheetId(),this.getUnitId(),this._runtimeFeatureCellData)}getCellByPosition(e,t){let r=e,n=t;const s=this.getRangeData();r||(r=s.startRow),n||(n=s.startColumn);const a=this.getCellData(r,n);return a?this.getCellValueObject(a):g.create(h.VALUE)}setCurrentRowAndColumn(e,t){this._currentRow=e,this._currentColumn=t}getCurrentRow(){return this._currentRow}getCurrentColumn(){return this._currentColumn}getCellPattern(e,t,r,n){var c,l,f,m;const s=this._unitStylesData[e];if(!s)return"";const a=(f=(l=(c=this._unitData[e])==null?void 0:c[t])==null?void 0:l.cellData)==null?void 0:f.getValue(r,n);if(!a)return"";const u=s.getStyleByCell(a);return((m=u==null?void 0:u.n)==null?void 0:m.pattern)||""}toArrayValueObject(e=!0){var C;const{startRow:t,endRow:r,startColumn:n,endColumn:s}=this.getRangePosition(),a=`${this.getUnitId()}_${this.getSheetId()}_${t}_${r}_${n}_${s}`,u=mr.get(a);if(u&&e)return u;const c=r-t+1,l=s-n+1;if(c<0||l<0)return this._getBlankArrayValueObject();const f=new Array(c);this.iterator((_,E,R)=>{const b=E-t,N=R-n;f[b]||(f[b]=new Array(l)),_==null&&(_=le.create()),f[b][N]=_});const m={calculateValueList:f,rowCount:f.length,columnCount:((C=f[0])==null?void 0:C.length)||0,unitId:this.getUnitId(),sheetId:this.getSheetId(),row:t,column:n},d=Z.create(m);return e&&mr.set(a,d),d}toUnitRange(){return{range:this.getRangePosition(),sheetId:this.getSheetId(),unitId:this.getUnitId()}}_checkIfWorksheetMiss(){return(this._forcedSheetId==null||this._forcedSheetId.length===0)&&this._forcedSheetName.length>0}_getBlankArrayValueObject(){const e={calculateValueList:[],rowCount:0,columnCount:0,unitId:this.getUnitId(),sheetId:this.getSheetId(),row:0,column:0};return Z.create(e)}}class Zi extends gn{constructor(o){super(),this._promise=o}isAsyncObject(){return!0}async getValue(){return this._promise}}class zi extends gn{constructor(o){super(),this._promiseList=o}isAsyncArrayObject(){return!0}async getValue(){var t;const o=[];for(let r=0;r<this._promiseList.length;r++){const n=this._promiseList[r];o[r]==null&&(o[r]=[]);for(let s=0;s<n.length;s++){const a=n[s];a.isAsyncObject()?o[r][s]=await a.getValue():o[r][s]=a}}const e={calculateValueList:o,rowCount:o.length,columnCount:((t=o[0])==null?void 0:t.length)||0,unitId:"",sheetId:"",row:0,column:0};return Z.create(e)}}class Pr extends Wt{constructor(o,e,t){super(""),this.setRangeData(o),e&&this.setForcedSheetIdDirect(e),t&&this.setForcedUnitIdDirect(t)}isRange(){return!0}}class Qs extends Wt{constructor(o){super(o);const e=Yt(o);this.setForcedUnitIdDirect(e.unitId),this.setForcedSheetName(e.sheetName),this.setRangeData(e.range)}isCell(){return!0}unionBy(o){if(!o.isCell())return g.create(h.REF);const e=o,t=this.unionRange(this.getRangeData(),e.getRangeData());return this._createRange(t)}unionRange(o,e){const t=o.startRow,r=o.startColumn,n=e.startRow,s=e.startColumn,a={startRow:-1,startColumn:-1,endRow:-1,endColumn:-1};return t>n?(a.startRow=n,a.endRow=t):(a.startRow=t,a.endRow=n),r>s?(a.startColumn=s,a.endColumn=r):(a.startColumn=r,a.endColumn=s),o.startAbsoluteRefType&&(a.startAbsoluteRefType=o.startAbsoluteRefType),e.startAbsoluteRefType&&(a.endAbsoluteRefType=e.startAbsoluteRefType),a}_createRange(o){const e=new Pr(o,this.getForcedSheetId(),this.getForcedUnitId());e.setUnitData(this.getUnitData()),e.setDefaultSheetId(this.getDefaultSheetId()),e.setDefaultUnitId(this.getDefaultUnitId()),e.setRuntimeData(this.getRuntimeData()),e.setUnitStylesData(this.getUnitStylesData()),e.setArrayFormulaCellData(this.getArrayFormulaCellData()),e.setRuntimeArrayFormulaCellData(this.getRuntimeArrayFormulaCellData()),e.setRuntimeFeatureCellData(this.getRuntimeFeatureCellData());const{x:t,y:r}=this.getRefOffset();e.setRefOffset(t,r);const n=this.getForcedSheetId();e.setForcedSheetName(this.getForcedSheetName()),n!=null&&e.setForcedSheetIdDirect(n);const s=this.getForcedUnitId();return s&&e.setForcedUnitIdDirect(s),e}}class qs extends Wt{constructor(o){super(o);const e=Yt(o);this.setForcedUnitIdDirect(e.unitId),this.setForcedSheetName(e.sheetName);const t={...e.range,startColumn:e.range.startColumn,startRow:Number.NaN,endColumn:e.range.endColumn,endRow:Number.NaN,rangeType:M.RANGE_TYPE.COLUMN};this.setRangeData(t)}isColumn(){return!0}unionBy(o){if(!o.isColumn())return g.create(h.REF);const e=o;if(e.getForcedSheetName()!==void 0&&e.getForcedSheetName()!=="")return g.create(h.REF);const t=this.getRangeData(),r=e.getRangeData(),n=r.startColumn;if(n>=t.startColumn&&n<=t.endColumn)return this;const s=t.startColumn;return n>s?t.endColumn=n:(t.startColumn=n,t.endColumn=s),r.startAbsoluteRefType&&(t.endAbsoluteRefType=r.startAbsoluteRefType),t.rangeType=M.RANGE_TYPE.COLUMN,this.setToken(`${this.getToken()}${K.COLON}${e.getToken()}`),this}}class Xs extends Wt{constructor(o){super(o);const e=Yt(o);this.setForcedUnitIdDirect(e.unitId),this.setForcedSheetName(e.sheetName);const t={...e.range,startColumn:Number.NaN,startRow:e.range.startRow,endColumn:Number.NaN,endRow:e.range.endRow,rangeType:M.RANGE_TYPE.ROW};this.setRangeData(t)}isRow(){return!0}unionBy(o){if(!o.isRow())return g.create(h.REF);const e=o;if(e.getForcedSheetName()!==void 0&&e.getForcedSheetName()!=="")return g.create(h.REF);const t=this.getRangeData(),r=e.getRangeData(),n=r.startRow;if(n>=t.startRow&&n<=t.endRow)return this;const s=t.startRow;return n>s?t.endRow=n:(t.startRow=n,t.endRow=s),r.startAbsoluteRefType&&(t.endAbsoluteRefType=r.startAbsoluteRefType),t.rangeType=M.RANGE_TYPE.ROW,this.setToken(`${this.getToken()}${K.COLON}${e.getToken()}`),this}}function O(i,o,e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=[];for(let a=0;a<i;a++){const u=[];for(let c=0;c<o;c++){if(r===1&&n===1){const f=e.isArray()?e.get(0,0):e;u.push(f);continue}if(r===1&&c<n){const f=e.get(0,c);u.push(f);continue}if(n===1&&a<r){const f=e.get(a,0);u.push(f);continue}if(a>=r||c>=n){u.push(t!=null?t:le.create());continue}const l=e.get(a,c);u.push(l)}s.push(u)}return at(s,i,o)}function at(i,o,e,t="",r=""){const n={calculateValueList:i,rowCount:o,columnCount:e,unitId:t,sheetId:r,row:-1,column:-1};return Z.create(n)}function Ks(i){const o=[H.EQUALS,H.NOT_EQUAL,H.GREATER_THAN_OR_EQUAL,H.GREATER_THAN,H.LESS_THAN_OR_EQUAL,H.LESS_THAN];for(const e of o)if(i.startsWith(e)){const t=i.substring(e.length);return[e,ht.create(t)]}return[H.EQUALS,ht.create(i)]}function Mn(i,o,e,t){if(!e)if(o.isString()){const r=`${o.getValue()}`,[n,s]=Ks(r);e=n,o=s}else e=H.EQUALS;return i.compare(o,e,t)}function Qf(i,o){const e=Math.max(i.isArray()?i.getRowCount():1,o.isArray()?o.getRowCount():1),t=Math.max(i.isArray()?i.getColumnCount():1,o.isArray()?o.getColumnCount():1),r=O(e,t,i),n=O(e,t,o);return r.mapValue((s,a,u)=>{const c=n.get(a,u);return s!=null&&s.isError()?s:c!=null&&c.isError()?c:s!=null&&s.isBoolean()&&(c!=null&&c.isBoolean())?Sn(s.getValue()&&c.getValue()):F.create(!1)})}function qf(i){const o=i.getValue();let e=0;return o&&(e=1),y.create(e)}function Ji(i){return i.isArray()&&i.getRowCount()===1&&i.getColumnCount()===1?!0:i.isReferenceObject()?!!(i.isCell()||i.getRowCount()===1&&i.getColumnCount()===1):(i=i,!!(i.isString()||i.isNumber()||i.isBoolean()||i.isError()||i.isNull()))}function Xf(i){const o=i==null?void 0:i.getPattern();let e={},t={};if(o&&(e={s:{n:{pattern:o}}}),i!=null&&i.getCustomData()&&(t={custom:i.getCustomData()}),i==null)return{v:null,...e};if(i.isError())return{v:i.getErrorType(),t:M.CellValueType.STRING,...e,...t};if(i.isValueObject()){const r=i,n=r.getValue();return r.isNumber()?{v:n,t:M.CellValueType.NUMBER,...e,...t}:r.isBoolean()?{v:n?1:0,t:M.CellValueType.BOOLEAN,...e,...t}:r.isString()?{v:n,t:M.CellValueType.STRING,...e,...t}:r.isNull()?{v:null,...e,...t}:{v:n,t:M.CellValueType.STRING,...e,...t}}}function Kf(i){let o=0,e=0;return i.forEach((t,r)=>{if(r%2===1)if(t.isArray()){const n=t;o=Math.max(o,n.getRowCount()),e=Math.max(e,n.getColumnCount())}else o=Math.max(o,1),e=Math.max(e,1)}),{maxRowLength:o,maxColumnLength:e}}function jr(i,o){if(i.length===0||i.length%2!==0)return{isError:!0,errorObject:g.create(h.VALUE),rangeIsDifferentSize:!1,criteriaMaxRowLength:0,criteriaMaxColumnLength:0,targetRange:null,variants:[]};let e=null,t=-1,r=-1;if(o){if(!o.isReferenceObject())return{isError:!0,errorObject:g.create(h.VALUE),rangeIsDifferentSize:!1,criteriaMaxRowLength:0,criteriaMaxColumnLength:0,targetRange:null,variants:[]};e=o.toArrayValueObject(),t=e.getRowCount(),r=e.getColumnCount()}let n=0,s=0,a=!1;const u=[];for(let c=0;c<i.length;c++)if(c%2===1){const l=i[c-1],f=i[c];if(!l.isReferenceObject())return{isError:!0,errorObject:g.create(h.VALUE),rangeIsDifferentSize:!1,criteriaMaxRowLength:0,criteriaMaxColumnLength:0,targetRange:null,variants:[]};const m=l.toArrayValueObject(),d=m.getRowCount(),C=m.getColumnCount();c===1&&t===-1&&r===-1?(t=d,r=C):!a&&(t!==d||r!==C)&&(a=!0);let _=f;f.isReferenceObject()&&(_=f.toArrayValueObject()),n=Math.max(n,_.isArray()?_.getRowCount():1),s=Math.max(s,_.isArray()?_.getColumnCount():1),u.push(m),u.push(_)}return{isError:!1,errorObject:null,rangeIsDifferentSize:a,criteriaMaxRowLength:n,criteriaMaxColumnLength:s,targetRange:e,variants:u}}function Zs(i){return i.isArray()?i:Z.createByArray([[i.getValue()]])}function xr(i,o,e,t=!1){const r=[];for(let n=0;n<i.length;n++){if(n%2===1)continue;const s=i[n],a=i[n+1];O(o,e,a,g.create(h.NA)).iterator((c,l,f)=>{if(!c)return;let m=Mn(s,c);if(t&&(m=Dn(m,s,c)),r[l]===void 0&&(r[l]=[]),r[l][f]===void 0){r[l][f]=m;return}r[l][f]=Qf(r[l][f],m)})}return r}function Dn(i,o,e){const[t,r]=Ks(`${e.getValue()}`);return i.mapValue((n,s,a)=>{const u=o.get(s,a);if(u&&Zf(u,r))return n;if(u!=null&&u.isError()&&r.isError()&&u.getValue()===r.getValue())return F.create(!0);if(t===H.EQUALS||t===H.NOT_EQUAL){if(u!=null&&u.isNumber()&&r.isString()){const c=r.convertToNumberObjectValue();if(c.isNumber())return u.compare(c,t)}if(r.isNumber()&&(u!=null&&u.isString())){const c=u.convertToNumberObjectValue();if(c.isNumber())return c.compare(r,t)}if(t===H.EQUALS)return F.create(!1);if(t===H.NOT_EQUAL)return F.create(!0)}return F.create(!1)})}function Zf(i,o){if(i.isNumber()&&o.isNumber()||i.isBoolean()&&o.isBoolean())return!0;const e=i.isString()&&i.getValue()==="",t=o.isString()&&o.getValue()==="";return!!((e||i.isNull())&&(t||o.isNull())||i.isString()&&!e&&o.isString()&&!t)}var Ur=(i=>(i[i.CELL=0]="CELL",i[i.COLUMN=1]="COLUMN",i[i.ROW=2]="ROW",i))(Ur||{});function zf(i,o){let e;switch(o){case 0:e=new Qs(i);break;case 1:e=new qs(i);break;case 2:e=new Xs(i);break;default:throw new Error("Unknown reference object type")}return e}function Jf(i,o){let e;return i.isCell()&&o.isCell()||i.isRow()&&o.isRow()||i.isColumn()&&o.isColumn()?e=i.unionBy(o):e=g.create(h.NAME),e}var em=Object.getOwnPropertyDescriptor,tm=(i,o,e,t)=>{for(var r=t>1?void 0:t?em(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},rm=(i,o)=>(e,t)=>o(e,t,i);w.HyperlinkEngineFormulaService=class extends M.Disposable{constructor(o){super(),this._univerInstanceService=o}generateCellValue(o,e){if(e.trim()==="")return{v:""};let t=o;if(o.startsWith("#")&&gs(o.slice(1))){const{unitId:r,sheetName:n,range:s}=ur(o.slice(1)),a=this._univerInstanceService.getCurrentUnitOfType(M.UniverInstanceType.UNIVER_SHEET);if(r===""||r===a.getUnitId())if(n==="")t=`#gid=${a.getActiveSheet().getSheetId()}&range=${bt(s)}`;else{const u=a.getSheetBySheetName(n);u&&(t=`#gid=${u.getSheetId()}&range=${bt(s)}`)}}else M.Tools.isLegalUrl(o)&&(t=M.Tools.normalizeUrl(o));return{p:M.RichTextBuilder.create().insertLink(e,t).getData()}}},w.HyperlinkEngineFormulaService=tm([rm(0,M.IUniverInstanceService)],w.HyperlinkEngineFormulaService);const zs=M.createIdentifier("univer.formula.hyperlink-engine-formula.service");var nm=Object.getOwnPropertyDescriptor,sm=(i,o,e,t)=>{for(var r=t>1?void 0:t?nm(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},eo=(i,o)=>(e,t)=>o(e,t,i),qe=(i=>(i[i.IDLE=0]="IDLE",i[i.START=1]="START",i[i.START_DEPENDENCY=2]="START_DEPENDENCY",i[i.START_CALCULATION=3]="START_CALCULATION",i[i.CURRENTLY_CALCULATING=4]="CURRENTLY_CALCULATING",i[i.START_DEPENDENCY_ARRAY_FORMULA=5]="START_DEPENDENCY_ARRAY_FORMULA",i[i.START_CALCULATION_ARRAY_FORMULA=6]="START_CALCULATION_ARRAY_FORMULA",i[i.CURRENTLY_CALCULATING_ARRAY_FORMULA=7]="CURRENTLY_CALCULATING_ARRAY_FORMULA",i[i.CALCULATION_COMPLETED=8]="CALCULATION_COMPLETED",i))(qe||{}),hr=(i=>(i[i.INITIAL=0]="INITIAL",i[i.STOP_EXECUTION=1]="STOP_EXECUTION",i[i.NOT_EXECUTED=2]="NOT_EXECUTED",i[i.SUCCESS=3]="SUCCESS",i))(hr||{});w.FormulaRuntimeService=class extends M.Disposable{constructor(e,t){super();A(this,"_formulaExecuteStage",0);A(this,"_stopState",!1);A(this,"_currentRow",-1);A(this,"_currentColumn",-1);A(this,"_currentRowCount",Number.NEGATIVE_INFINITY);A(this,"_currentColumnCount",Number.NEGATIVE_INFINITY);A(this,"_currentSubUnitId","");A(this,"_currentUnitId","");A(this,"_runtimeData",{});A(this,"_runtimeOtherData",{});A(this,"_unitArrayFormulaRange",{});A(this,"_unitArrayFormulaEmbeddedMap",{});A(this,"_runtimeArrayFormulaCellData",{});A(this,"_runtimeClearArrayFormulaCellData",{});A(this,"_runtimeFeatureRange",{});A(this,"_runtimeFeatureCellData",{});A(this,"_runtimeImageFormulaData",[]);A(this,"_functionsExecutedState",0);A(this,"_functionDefinitionPrivacyVar",new Map);A(this,"_totalFormulasToCalculate",0);A(this,"_completedFormulasCount",0);A(this,"_totalArrayFormulasToCalculate",0);A(this,"_completedArrayFormulasCount",0);A(this,"_formulaCycleIndex",0);A(this,"_isCycleDependency",!1);this._currentConfigService=e,this._hyperlinkEngineFormulaService=t}get currentRow(){return this._currentRow}get currentColumn(){return this._currentColumn}get currentRowCount(){return this._currentRowCount}get currentColumnCount(){return this._currentColumnCount}get currentSubUnitId(){return this._currentSubUnitId}get currentUnitId(){return this._currentUnitId}dispose(){super.dispose(),this.reset(),this._runtimeFeatureCellData={},this._runtimeFeatureRange={},this.clearReferenceAndNumberformatCache()}enableCycleDependency(){this._isCycleDependency=!0}disableCycleDependency(){this._isCycleDependency=!1}isCycleDependency(){return this._isCycleDependency}setFormulaCycleIndex(e){this._formulaCycleIndex=e}getFormulaCycleIndex(){return this._formulaCycleIndex}setTotalArrayFormulasToCalculate(e){this._totalArrayFormulasToCalculate=e}getTotalArrayFormulasToCalculate(){return this._totalArrayFormulasToCalculate}setCompletedArrayFormulasCount(e){this._completedArrayFormulasCount=e}getCompletedArrayFormulasCount(){return this._completedArrayFormulasCount}setTotalFormulasToCalculate(e){this._totalFormulasToCalculate=e}getTotalFormulasToCalculate(){return this._totalFormulasToCalculate}setCompletedFormulasCount(e){this._completedFormulasCount=e}getCompletedFormulasCount(){return this._completedFormulasCount}markedAsSuccessfullyExecuted(){this._functionsExecutedState=3}markedAsNoFunctionsExecuted(){this._functionsExecutedState=2}markedAsStopFunctionsExecuted(){this._functionsExecutedState=1}markedAsInitialFunctionsExecuted(){this._functionsExecutedState=0}stopExecution(){this._stopState=!0,this.setFormulaExecuteStage(0)}isStopExecution(){return this._stopState}setFormulaExecuteStage(e){this._formulaExecuteStage=e}getFormulaExecuteStage(){return this._formulaExecuteStage}reset(){this._formulaExecuteStage=0,this._runtimeData={},this._runtimeOtherData={},this._unitArrayFormulaRange={},this._unitArrayFormulaEmbeddedMap={},this._runtimeArrayFormulaCellData={},this._runtimeClearArrayFormulaCellData={},this._runtimeImageFormulaData=[],this._functionDefinitionPrivacyVar.clear(),this.markedAsInitialFunctionsExecuted(),this._stopState=!1,this._isCycleDependency=!1,this._totalFormulasToCalculate=0,this._completedFormulasCount=0,this.clearReferenceAndNumberformatCache()}clearReferenceAndNumberformatCache(){Ml(),xl(),cl()}setCurrent(e,t,r,n,s,a){this._currentRow=e,this._currentColumn=t,this._currentRowCount=r,this._currentColumnCount=n,this._currentSubUnitId=s,this._currentUnitId=a}clearFunctionDefinitionPrivacyVar(){this._functionDefinitionPrivacyVar.clear()}registerFunctionDefinitionPrivacyVar(e,t){this._functionDefinitionPrivacyVar.set(e,t)}getFunctionDefinitionPrivacyVar(e){return this._functionDefinitionPrivacyVar.get(e)}setRuntimeOtherData(e,t,r,n){const s=this._currentSubUnitId,a=this._currentUnitId;this._runtimeOtherData[a]===void 0&&(this._runtimeOtherData[a]={});const u=this._runtimeOtherData[a];(u[s]===void 0||u[s]===null)&&(u[s]={});const c=u[s];let l=[];if(n.isReferenceObject()||n.isValueObject()&&n.isArray()){const f=n,{startRow:m,startColumn:d}=f.getRangePosition();f.iterator((C,_,E)=>{const R=this._getValueObjectOfRuntimeData(C),b=_-m,N=E-d;l[b]==null&&(l[b]=[]),l[b][N]=R})}else l=[[this._getValueObjectOfRuntimeData(n)]];(c[e]===void 0||c[e]===null)&&(c[e]={}),(c[e][r]===void 0||c[e][r]===null)&&(c[e][r]={}),c[e][r][t]=l}setRuntimeData(e){const t=this._currentRow,r=this._currentColumn,n=this._currentRowCount,s=this.currentColumnCount,a=this._currentSubUnitId,u=this._currentUnitId;this._runtimeData[u]==null&&(this._runtimeData[u]={});const c=this._runtimeData[u];c[a]==null&&(c[a]=new M.ObjectMatrix);const l=c[a];this._unitArrayFormulaRange[u]==null&&(this._unitArrayFormulaRange[u]={});const f=this._unitArrayFormulaRange[u];(f[a]===null||f[a]===void 0)&&(f[a]={});const m=new M.ObjectMatrix(f[a]);this._runtimeArrayFormulaCellData[u]===void 0&&(this._runtimeArrayFormulaCellData[u]={});const d=this._runtimeArrayFormulaCellData[u];d[a]==null&&(d[a]=new M.ObjectMatrix);const C=d[a];this._runtimeClearArrayFormulaCellData[u]===void 0&&(this._runtimeClearArrayFormulaCellData[u]={});const _=this._runtimeClearArrayFormulaCellData[u];_[a]==null&&(_[a]=new M.ObjectMatrix);const E=_[a];if(e.isReferenceObject()||e.isValueObject()&&e.isArray()){const R=e,{startRow:b,startColumn:N,endRow:V,endColumn:S}=R.getRangePosition();if(b===V&&N===S){const L=R.getFirstCell(),P=this._getValueObjectOfRuntimeData(L);l.setValue(t,r,P),E.setValue(t,r,P),Ge.set(u,a,r,L.getValue(),t,!0);return}const D={startRow:t,startColumn:r,endRow:V-b+t,endColumn:S-N+r};if(m.setValue(t,r,D),this._checkIfArrayFormulaRangeHasData(u,a,t,r,D)||this._checkIfArrayFormulaExceeded(n,s,D)){const L=this._getValueObjectOfRuntimeData(g.create(h.SPILL));l.setValue(t,r,L),E.setValue(t,r,L),Ge.set(u,a,r,h.SPILL,t,!0);const P=this._currentConfigService.getUnitData();R.iterator((j,I,v)=>{var te,W;const Y=I-b+t,Q=v-N+r,se=(W=(te=P[u])==null?void 0:te[a])==null?void 0:W.cellData.getValue(Y,Q);if(I===b&&v===N)C.setValue(t,r,L);else if(se!=null)se.v==null&&(se.v=""),C.setValue(Y,Q,se);else{if(this._isInOtherArrayFormulaRange(u,a,t,r,Y,Q))return!0;C.setValue(Y,Q,{v:""})}})}else{const L=g.create(h.SPILL);R.iterator((P,j,I)=>{Ge.set(u,a,r-N+I,P?P.getValue():0,t-b+j,!0);const v=this._getValueObjectOfRuntimeData(P);if(j===b&&I===N){if(P!=null&&P.isError()&&P.isEqualType(L))return E.setValue(t,r,{}),l.setValue(t,r,{...this._getValueObjectOfRuntimeData(L)}),!1;l.setValue(t,r,{...v})}const Y=j-b+t,Q=I-N+r;C.setValue(Y,Q,v)})}}else{const R=this._getValueObjectOfRuntimeData(e);if(l.setValue(t,r,R),e.isString()&&e.isImage()){const b=e.getImageInfo();b&&this._runtimeImageFormulaData.push({...b,unitId:u,sheetId:a,row:t,column:r})}Ge.set(u,a,r,e.getValue(),t,!0),E.setValue(t,r,R)}}_getValueObjectOfRuntimeData(e){return e!=null&&e.isString()&&e.isHyperlink()?this._hyperlinkEngineFormulaService.generateCellValue(e.getHyperlinkUrl(),e.getValue()):Xf(e)}getUnitData(){return this._runtimeData}getUnitArrayFormula(){return this._unitArrayFormulaRange}getUnitArrayFormulaEmbeddedMap(){return this._unitArrayFormulaEmbeddedMap}setUnitArrayFormulaEmbeddedMap(){const e=this._currentUnitId,t=this._currentSubUnitId,r=this._currentRow,n=this._currentColumn,s=this._unitArrayFormulaEmbeddedMap;s[e]==null&&(s[e]={}),s[e][t]==null&&(s[e][t]={}),s[e][t][r]==null&&(s[e][t][r]={}),s[e][t][r][n]=!0}getRuntimeOtherData(){return this._runtimeOtherData}getRuntimeArrayFormulaCellData(){return this._runtimeArrayFormulaCellData}getRuntimeClearArrayFormulaCellData(){return this._runtimeClearArrayFormulaCellData}getRuntimeFeatureRange(){return this._runtimeFeatureRange}setRuntimeFeatureRange(e,t){this._runtimeFeatureRange[e]=t}getRuntimeFeatureCellData(){return this._runtimeFeatureCellData}setRuntimeFeatureCellData(e,t){this._runtimeFeatureCellData[e]=t}getRuntimeImageFormulaData(){return this._runtimeImageFormulaData}getAllRuntimeData(){return{unitData:this.getUnitData(),arrayFormulaRange:this.getUnitArrayFormula(),arrayFormulaEmbedded:this.getUnitArrayFormulaEmbeddedMap(),unitOtherData:this.getRuntimeOtherData(),functionsExecutedState:this._functionsExecutedState,arrayFormulaCellData:this.getRuntimeArrayFormulaCellData(),clearArrayFormulaCellData:this.getRuntimeClearArrayFormulaCellData(),imageFormulaData:this.getRuntimeImageFormulaData(),runtimeFeatureRange:this.getRuntimeFeatureRange(),runtimeFeatureCellData:this.getRuntimeFeatureCellData()}}getRuntimeState(){return{totalFormulasToCalculate:this.getTotalFormulasToCalculate(),completedFormulasCount:this.getCompletedFormulasCount(),totalArrayFormulasToCalculate:this.getTotalArrayFormulasToCalculate(),completedArrayFormulasCount:this.getCompletedArrayFormulasCount(),stage:this.getFormulaExecuteStage(),formulaCycleIndex:this.getFormulaCycleIndex()}}clearArrayObjectCache(){mr.clear()}_checkIfArrayFormulaRangeHasData(e,t,r,n,s){var d,C,_,E,R,b,N,V,S,D,L;const{startRow:a,startColumn:u,endRow:c,endColumn:l}=s,f=this._currentConfigService.getUnitData(),m=this._currentConfigService.getArrayFormulaCellData();(_=(C=(d=this._unitArrayFormulaRange[e])==null?void 0:d[t])==null?void 0:C[r])==null||_[n];for(let P=a;P<=c;P++)for(let j=u;j<=l;j++){if(P===r&&n===j)continue;const I=(b=(R=(E=this._runtimeData)==null?void 0:E[e])==null?void 0:R[t])==null?void 0:b.getValue(P,j);(V=(N=m==null?void 0:m[e])==null?void 0:N[t])==null||V.getValue(P,j);const v=(L=(D=(S=f==null?void 0:f[e])==null?void 0:S[t])==null?void 0:D.cellData)==null?void 0:L.getValue(P,j),Y=this._getRuntimeFeatureCellValue(P,j,t,e);if(!hn(I)||this._isInOtherArrayFormulaRange(e,t,r,n,P,j)||!hn(v)||!hn(Y))return!0}return!1}_getRuntimeFeatureCellValue(e,t,r,n){return Di(e,t,r,n,this._runtimeFeatureCellData)}_arrayCellHasData(e){return e==null?!1:e.v!==void 0}_isInOtherArrayFormulaRange(e,t,r,n,s,a){var f;const u=(f=this._currentConfigService.getArrayFormulaRange()[e])==null?void 0:f[t];if(u==null)return!1;let c=!1;return new M.ObjectMatrix(u).forValue((m,d,C)=>{var R,b;if(m===r&&d===n)return;const _=this._isInArrayFormulaRange(C,s,a),E=(b=(R=this._runtimeData[e])==null?void 0:R[t])==null?void 0:b.getValue(m,d);_&&(E==null?void 0:E.v)!==h.SPILL&&(c=!0)}),c}_isInArrayFormulaRange(e,t,r){if(e==null)return!1;const{startRow:n,startColumn:s,endRow:a,endColumn:u}=e;return t>=n&&t<=a&&r>=s&&r<=u}_checkIfArrayFormulaExceeded(e,t,r){return r.endRow>=e||r.endColumn>=t}_isInDirtyRange(e,t,r,n){const s=this._currentConfigService.getDirtyRanges();return s.length===0?!0:$a(s,e,t,r,n)}},w.FormulaRuntimeService=sm([eo(0,Nt),eo(1,zs)],w.FormulaRuntimeService);const it=M.createIdentifier("univer.formula.runtime.service");var ue=(i=>(i[i.REFERENCE=1]="REFERENCE",i[i.VALUE=2]="VALUE",i[i.OPERATOR=3]="OPERATOR",i[i.FUNCTION=4]="FUNCTION",i[i.LAMBDA=5]="LAMBDA",i[i.LAMBDA_PARAMETER=6]="LAMBDA_PARAMETER",i[i.ERROR=7]="ERROR",i[i.BASE=8]="BASE",i[i.ROOT=9]="ROOT",i[i.UNION=10]="UNION",i[i.PREFIX=11]="PREFIX",i[i.SUFFIX=12]="SUFFIX",i[i.NULL=13]="NULL",i))(ue||{});const gt=new Map([[1,7],[2,9],[3,8],[4,6],[5,1],[6,2],[9,10],[10,3],[11,4],[12,5]]);class Ye{constructor(o){A(this,"_children",[]);A(this,"_definedNames");A(this,"_parent");A(this,"_valueObject");A(this,"_calculateState",!1);A(this,"_async",!1);A(this,"_address",!1);A(this,"_isForcedCalculateFunction",!1);this._token=o}dispose(){var o;this._children.forEach(e=>{e.dispose()}),(o=this._valueObject)==null||o.dispose(),this._valueObject=null,this._children=[],this._definedNames=null,this._parent=null}get nodeType(){return ue.BASE}resetCalculationState(){this._children.forEach(o=>{o.resetCalculationState()}),this._valueObject=null,this._calculateState=!1}isAsync(){return this._async}isAddress(){return this._address}isForcedCalculateFunction(){return this._isForcedCalculateFunction}setAsync(){this._async=!0}setAddress(){this._address=!0}getParent(){return this._parent}setParent(o){this._parent=o,o.addChildren(this)}setForcedCalculateFunction(){this._isForcedCalculateFunction=!0}getChildren(){return this._children}addChildren(...o){this._children.push(...o)}getToken(){return this._token}setValue(o){this._valueObject=o}getValue(){return this._valueObject}isCalculated(){return this._calculateState}setCalculated(){this._calculateState=!0}execute(){}setNotEmpty(o=!0){}async executeAsync(){return Promise.resolve(Mt.SUCCESS)}serialize(){const o=this.getToken(),e=this.getChildren(),t=[],r=e.length;for(let s=0;s<r;s++){const a=e[s];t.push(a.serialize())}const n={token:o,nodeType:this.nodeType};return r>0&&(n.children=t),n}hasDefinedName(o){var e;return((e=this._definedNames)==null?void 0:e.includes(o))||!1}setDefinedNames(o){this._definedNames=o}getDefinedNames(){return this._definedNames}}class je extends Ye{constructor(e){super(e);A(this,"_errorValueObject");this._errorValueObject=g.create(e)}get nodeType(){return ue.ERROR}static create(e){return new je(e)}getValue(){return this._errorValueObject}}const dt=100;class Ct{get zIndex(){return 0}dispose(){}create(o,e,t){let r;return o instanceof oe?r=o.getToken():r=o,new Ye(r)}}class Js extends Ye{get nodeType(){return ue.ROOT}execute(){const o=this.getChildren();if(o.length>1){this.setValue(g.create(h.VALUE));return}const e=o[0];e==null?this.setValue(g.create(h.VALUE)):this.setValue(e.getValue())}}class ea extends Ct{get zIndex(){return gt.get(ue.ROOT)||dt}checkAndCreateNodeType(o){if(!(o instanceof oe))return;if(o.getToken()===Rt)return new Js(Rt)}}const am=5e3,Tr=new yt(am);function ta(i,o,e,t,r){let n=Tr.get(`${i}${o}`);if(n&&!to(n,r))return n;const s=e.treeBuilder(o);if(Dt.has(s))return je.create(s);if(n=t.parse(s),n==null)throw new Error("astNode is null");return Tr.set(`${i}${o}`,n),n}function to(i,o){const e=o.getDirtyDefinedNameMap(),t=o.getExecuteUnitId();if(t!=null&&e[t]!=null){const r=Object.keys(e[t]);for(let n=0,s=r.length;n<s;n++){const a=r[n];if(i.hasDefinedName(a))return!0}}return!1}function im(i,o,e){return!!(o!=null&&to(o,e))}const Ot=M.createIdentifier("univer.formula-function.service");class ro extends M.Disposable{constructor(){super(...arguments);A(this,"_functionExecutors",new Map);A(this,"_functionDescriptions",new Map)}dispose(){super.dispose(),this._functionExecutors.clear(),this._functionDescriptions.clear()}registerExecutors(...e){for(let t=0;t<e.length;t++){const r=e[t];this._functionExecutors.set(r.name,r)}}getExecutors(){return this._functionExecutors}getExecutor(e){return this._functionExecutors.get(e)}hasExecutor(e){return this._functionExecutors.has(e)}unregisterExecutors(...e){for(let t=0;t<e.length;t++){const r=e[t];this._functionExecutors.delete(r)}}registerDescriptions(...e){for(let t=0;t<e.length;t++){const r=e[t];this._functionDescriptions.set(r.functionName,r)}return M.toDisposable(()=>{for(let t=0;t<e.length;t++){const r=e[t];this._functionDescriptions.delete(r.functionName)}})}getDescriptions(){return this._functionDescriptions}getDescription(e){return this._functionDescriptions.get(e)}hasDescription(e){return this._functionDescriptions.has(e)}unregisterDescriptions(...e){for(let t=0;t<e.length;t++){const r=e[t];this._functionDescriptions.delete(r)}}deleteFormulaAstCacheKey(...e){Tr.forEach((t,r)=>{e.forEach(n=>{r.includes(n)&&Tr.delete(r)})})}}var Ie=(i=>(i.COMPARE="COMPARE",i.DIVIDED="DIVIDED",i.MINUS="MINUS",i.MULTIPLY="MULTIPLY",i.PLUS="PLUS",i.UNION="UNION",i.CUBE="CUBE",i))(Ie||{}),om=Object.getOwnPropertyDescriptor,um=(i,o,e,t)=>{for(var r=t>1?void 0:t?om(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},no=(i,o)=>(e,t)=>o(e,t,i);class wn extends Ye{constructor(o,e,t){super(e),this._runtimeService=o,this._operatorString=e,this._functionExecutor=t}get nodeType(){return ue.PREFIX}execute(){let e=this.getChildren()[0].getValue(),t;if(e==null)throw new Error("object is null");this._operatorString===Me.MINUS?(e.isReferenceObject()&&(e=e.toArrayValueObject()),t=this._functionExecutor.calculate(y.create(0),e)):this._operatorString===Me.AT?t=this._handlerAT(e):t=g.create(h.VALUE),this.setValue(t)}_handlerAT(o){if(!o.isReferenceObject())return g.create(h.VALUE);const e=o;if(e.isCell())return g.create(h.VALUE);const t=this._runtimeService,r=t.currentRow||0,n=t.currentColumn||0,s=e.getRangePosition(),{startRow:a,startColumn:u,endRow:c,endColumn:l}=s;return l!==u&&c!==a||a===c&&u===l?g.create(h.VALUE):c===a&&n>=u&&n<=l?e.getCellByColumn(n):u===l&&r>=a&&r<=c?e.getCellByRow(r):e.isTable()?e.getCellByPosition(r):g.create(h.VALUE)}}w.PrefixNodeFactory=class extends Ct{constructor(o,e){super(),this._functionService=o,this._runtimeService=e}get zIndex(){return gt.get(ue.PREFIX)||dt}checkAndCreateNodeType(o){if(!(o instanceof oe))return;const e=o.getToken(),t=e.trim();if(t.charAt(0)==='"'&&t.charAt(t.length-1)==='"')return;let r="";if(t===Me.MINUS)r=Ie.MINUS;else return t===Me.AT?new wn(this._runtimeService,t):void 0;const n=this._functionService.getExecutor(r);return n?new wn(this._runtimeService,t,n):(console.error(`No function ${e}`),je.create(h.NAME))}},w.PrefixNodeFactory=um([no(0,Ot),no(1,it)],w.PrefixNodeFactory);function so(i,o,e){let t,r,n=i;const s=n[0];let a=0;if(s===Me.MINUS){const u=o.getExecutor(Ie.MINUS);t=new wn(e,Me.MINUS,u),a++}else s===Me.AT&&(r=new wn(e,Me.AT),t&&r.setParent(t),a++);return a>0&&(n=n.slice(a)),{tokenTrim:n,minusPrefixNode:t,atPrefixNode:r}}var cm=Object.getOwnPropertyDescriptor,lm=(i,o,e,t)=>{for(var r=t>1?void 0:t?cm(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},gr=(i,o)=>(e,t)=>o(e,t,i);class fm extends Ye{constructor(o,e,t,r,n,s){super(o),this._functionExecutor=e,this._currentConfigService=t,this._runtimeService=r,this._definedNamesService=n,this._formulaDataModel=s,this._functionExecutor.isAsync()&&this.setAsync(),this._functionExecutor.isAddress()&&this.setAddress(),this._functionExecutor.needsLocale&&this._setLocale(),this._functionExecutor.needsSheetsInfo&&this._setSheetsInfo(),this._functionExecutor.needsFormulaDataModel&&this._functionExecutor.setFormulaDataModel(this._formulaDataModel)}get nodeType(){return ue.FUNCTION}async executeAsync(){const o=[],e=this.getChildren(),t=e.length;this._compatibility();for(let s=0;s<t;s++){const u=e[s].getValue();u!=null&&(u.isReferenceObject()&&!this._functionExecutor.needsReferenceObject?o.push(u.toArrayValueObject()):o.push(u))}const r=await this._calculateAsync(o);let n;return r.isAsyncObject()||r.isAsyncArrayObject()?n=await r.getValue():n=r,this._setEmbeddedArrayFormulaToResult(n),this._setRefData(n),this.setValue(n),Promise.resolve(Mt.SUCCESS)}execute(){const o=[],e=this.getChildren(),t=e.length;this._compatibility();for(let n=0;n<t;n++){const a=e[n].getValue();a!=null&&(a.isReferenceObject()&&this._functionExecutor.needsFilteredOutRows&&this._setFilteredOutRows(a),a.isReferenceObject()&&!this._functionExecutor.needsReferenceObject?o.push(a.toArrayValueObject()):o.push(a))}const r=this._calculate(o);this._setEmbeddedArrayFormulaToResult(r),this._setRefData(r),this.setValue(r)}isFunctionExecutorArgumentsIgnoreNumberPattern(){return this._functionExecutor.isArgumentsIgnoreNumberPattern()}_setEmbeddedArrayFormulaToResult(o){if(!o.isArray())return;const e=o.getRowCount(),t=o.getColumnCount();e<=1&&t<=1||this._runtimeService.setUnitArrayFormulaEmbeddedMap()}_compatibility(){this._lookupCompatibility()}_lookupCompatibility(){const o=this.getChildren(),e=o.length;if(!this._functionExecutor.needsExpandParams||e!==3)return;const t=o[1].getValue(),r=o[2].getValue();if(!(t!=null&&t.isReferenceObject())&&!(r!=null&&r.isReferenceObject()))return;let n,s;if(t!=null&&t.isReferenceObject()){const C=t.getRangeData(),{startRow:_,startColumn:E,endRow:R,endColumn:b}=C;n=R-_+1,s=b-E+1}else n=t!=null&&t.isArray()?t.getRowCount():1,s=t!=null&&t.isArray()?t.getColumnCount():1;const a=r.getRangeData(),{startRow:u,startColumn:c,endRow:l,endColumn:f}=a,m=l-u+1,d=f-c+1;n!==m&&(a.endRow+=n-m),s!==d&&(a.endColumn+=s-d)}_handleCustomResult(o){var t;if(typeof o!="object"||o==null)return ht.create(o);const e=Ki(o);return Z.create({calculateValueList:e,rowCount:e.length,columnCount:((t=e[0])==null?void 0:t.length)||0,unitId:"",sheetId:"",row:-1,column:-1})}_handleAddressFunction(){this._functionExecutor.isAddress()&&this._setDefinedNamesForFunction()}_mapVariantsToValues(o){return o.map(e=>e.isArray()?e.toValue():e.isLambda()?e:e.getValue())}_calculate(o){const{minParams:e,maxParams:t}=this._functionExecutor;if(e!==-1&&t!==-1&&(o.length<e||o.length>t))return g.create(h.NA);let r;if(this._setRefInfo(),this._functionExecutor.isCustom()){const n=this._functionExecutor.calculateCustom(...this._mapVariantsToValues(o));r=this._handleCustomResult(n)}else this._handleAddressFunction(),r=this._functionExecutor.calculate(...o);return r}async _calculateAsync(o){const{minParams:e,maxParams:t}=this._functionExecutor;if(e!==-1&&t!==-1&&(o.length<e||o.length>t))return g.create(h.NA);let r;if(this._setRefInfo(),this._functionExecutor.isCustom()){const n=await this._functionExecutor.calculateCustom(...this._mapVariantsToValues(o));r=this._handleCustomResult(n)}else this._handleAddressFunction(),r=this._functionExecutor.calculate(...o);return r}_setDefinedNamesForFunction(){const o=this._currentConfigService.getExecuteUnitId();if(o==null)return;const e=this._definedNamesService.getDefinedNameMap(o);e!=null&&this._functionExecutor.setDefinedNames(e)}_setRefInfo(){const{currentUnitId:o,currentSubUnitId:e,currentRow:t,currentColumn:r}=this._runtimeService;if(this._functionExecutor.setRefInfo(o,e,t,r),this._functionExecutor.needsSheetRowColumnCount){const{rowCount:n,columnCount:s}=this._currentConfigService.getSheetRowColumnCount(o,e);this._functionExecutor.setSheetRowColumnCount(n,s)}}_setRefData(o){if(!o.isReferenceObject())return;const e=o;e.setForcedSheetId(this._currentConfigService.getSheetNameMap()),e.setUnitData(this._currentConfigService.getUnitData()),e.setArrayFormulaCellData(this._currentConfigService.getArrayFormulaCellData()),e.setRuntimeData(this._runtimeService.getUnitData()),e.setRuntimeArrayFormulaCellData(this._runtimeService.getRuntimeArrayFormulaCellData()),e.setRuntimeFeatureCellData(this._runtimeService.getRuntimeFeatureCellData())}_setLocale(){this._functionExecutor.setLocale(this._currentConfigService.getLocale())}_setSheetsInfo(){this._functionExecutor.setSheetsInfo(this._currentConfigService.getSheetsInfo())}_setFilteredOutRows(o){const{startRow:e,endRow:t}=o.getRangePosition(),r=this._currentConfigService.getFilteredOutRows(o.getUnitId(),o.getSheetId(),e,t);o.setFilteredOutRows(r)}}class mm extends Ye{constructor(o="Error"){super(o)}get nodeType(){return ue.FUNCTION}async executeAsync(){return this.setValue(g.create(h.NAME)),Promise.resolve(Mt.SUCCESS)}execute(){this.setValue(g.create(h.NAME))}}w.FunctionNodeFactory=class extends Ct{constructor(o,e,t,r,n,s){super(),this._functionService=o,this._currentConfigService=e,this._runtimeService=t,this._definedNamesService=r,this._injector=n,this._formulaDataModel=s}get zIndex(){return gt.get(ue.FUNCTION)||dt}create(o){const e=this._functionService.getExecutor(o);return e?new fm(o,e,this._currentConfigService,this._runtimeService,this._definedNamesService,this._formulaDataModel):(console.error(`No function ${o}`),je.create(h.NAME))}checkAndCreateNodeType(o){if(typeof o=="string")return;const e=o.getToken(),{tokenTrim:t,minusPrefixNode:r,atPrefixNode:n}=so(e.trim(),this._functionService,this._runtimeService);if(!Number.isNaN(Number(t))&&!this._isParentUnionNode(o))return je.create(h.VALUE);const s=t.toUpperCase();if(this._functionService.hasExecutor(s)){const a=this.create(s);return n?a.setParent(n):r&&a.setParent(r),a}}_isParentUnionNode(o){var e,t;return((t=(e=o.getParent())==null?void 0:e.getParent())==null?void 0:t.getToken())===K.COLON}},w.FunctionNodeFactory=lm([gr(0,Ot),gr(1,Nt),gr(2,it),gr(3,kt),gr(4,M.Inject(M.Injector)),gr(5,M.Inject(w.FormulaDataModel))],w.FunctionNodeFactory);var hm=Object.getOwnPropertyDescriptor,gm=(i,o,e,t)=>{for(var r=t>1?void 0:t?hm(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},dm=(i,o)=>(e,t)=>o(e,t,i);w.Interpreter=class extends M.Disposable{constructor(o){super(),this._runtimeService=o}async executeAsync(o){if(!o||!o.node)return Promise.resolve(g.create(h.VALUE));const e=o.node,t=o.refOffsetX,r=o.refOffsetY;await this._executeAsync(e,t,r);const n=e.getValue();return n==null?Promise.resolve(g.create(h.VALUE)):Promise.resolve(n)}execute(o){if(!o||!o.node)return g.create(h.VALUE);const e=o.node,t=o.refOffsetX,r=o.refOffsetY;this._execute(e,t,r);const n=e.getValue();return n==null?g.create(h.VALUE):n}executePreCalculateNode(o){return o.execute(),o.getValue()}checkAsyncNode(o){if(o==null)return!1;const e=[];this._checkAsyncNode(o,e);for(let t=0,r=e.length;t<r;t++)if(e[t]===!0)return!0;return!1}_checkAsyncNode(o,e){const t=o.getChildren(),r=t.length;for(let n=0;n<r;n++){const s=t[n];e.push(s.isAsync()),this._checkAsyncNode(s,e)}}async _executeAsync(o,e=0,t=0){if(this._runtimeService.isStopExecution())return Promise.resolve(Mt.ERROR);const r=o.getChildren(),n=r.length;for(let s=0;s<n;s++){const a=r[s];if(a.getToken().toUpperCase()===or&&a.isEmptyParamFunction()){a.execute();continue}await this._executeAsync(a,e,t)}return o.nodeType===ue.REFERENCE&&o.setRefOffset(e,t),o.nodeType===ue.FUNCTION&&o.isAsync()?await o.executeAsync():o.execute(),Promise.resolve(Mt.SUCCESS)}_execute(o,e=0,t=0){if(this._runtimeService.isStopExecution())return Mt.ERROR;const r=o.getChildren(),n=r.length;for(let s=0;s<n;s++){const a=r[s];if(a.getToken().toUpperCase()===or&&a.isEmptyParamFunction()){a.execute();continue}this._execute(a,e,t)}return o.nodeType===ue.REFERENCE&&o.setRefOffset(e,t),o.execute(),Mt.SUCCESS}},w.Interpreter=gm([dm(0,it)],w.Interpreter);function ao(i){return i instanceof oe?i.getToken()===Bt:!1}function Cm(i){return i instanceof oe?i.getToken()===mi:!1}function ra(i,o,e){const t=i.getChildren(),r=t.length,n=t[0];for(let s=0;s<r;s++){const a=t[s];if(!(ao(n)&&s!==0))if(a instanceof oe)ra(a,o,e);else{const u=a.trim();if(e.has(u)){const c=new oe;c.setToken(Vr),c.setLambdaId(o),c.setLambdaPrivacyVar(e),c.setLambdaParameter(u),t[s]=c}}}}function _m(i){let o=i;for(;o!=null&&o.getParent();)o=o.getParent();return o}function na(i,o=0,e=0){return{node:i,refOffsetX:o,refOffsetY:e}}function io(i){if(!i)return;if(i.getToken()!==Vr)return i;const o=i,e=o.getCurrentLambdaPrivacyVar(),t=o.getLambdaParameter();if(!e)return;const r=e.get(t);return r==null&&i.getValue()?i:io(r)}class Ln extends pt{constructor(e,t,r){super(0);A(this,"_lambdaPrivacyValueMap",new Map);this._lambdaNode=e,this._interpreter=t,this._lambdaPrivacyVarKeys=r,this._lambdaPrivacyValueMap.clear()}static create(e,t,r){return new Ln(e,t,r)}dispose(){this._lambdaPrivacyValueMap.clear(),this._lambdaPrivacyValueMap=new Map,this._lambdaNode=null,this._interpreter=null,this._lambdaPrivacyVarKeys=[]}isLambda(){return!0}execute(...e){const t=this._lambdaPrivacyVarKeys.length;if(e.length!==t||!this._interpreter||!this._lambdaNode)return g.create(h.VALUE);this._setLambdaPrivacyValueMap(e),this._setLambdaNodeValue(this._lambdaNode),this._lambdaNode.setNotEmpty(!1);let r;if(this._interpreter.checkAsyncNode(this._lambdaNode))r=new Zi(this._interpreter.executeAsync(na(this._lambdaNode)));else{const n=this._interpreter.execute(na(this._lambdaNode));n.isReferenceObject()?r=n.toArrayValueObject():r=n}return this._lambdaNode.setNotEmpty(!0),r}executeCustom(...e){const t=e.map(r=>ht.create(r));return this.execute(...t)}_setLambdaNodeValue(e){if(!e)return;const t=e.getChildren(),r=t.length;for(let n=0;n<r;n++){const s=t[n];if(s.getToken()===Vr){const u=s.getLambdaParameter(),c=this._lambdaPrivacyValueMap.get(u);if(c)s.setValue(c);else{const l=s.getCurrentLambdaPrivacyVar(),f=io(l.get(u));f!=null&&s.setValue(f.getValue())}continue}this._setLambdaNodeValue(s)}}_setLambdaPrivacyValueMap(e){for(let t=0;t<e.length;t++){const r=e[t],n=this._lambdaPrivacyVarKeys[t];this._lambdaPrivacyValueMap.set(n,r)}}getLambdaPrivacyVarKeys(){return this._lambdaPrivacyVarKeys}}var Am=Object.getOwnPropertyDescriptor,Em=(i,o,e,t)=>{for(var r=t>1?void 0:t?Am(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},oo=(i,o)=>(e,t)=>o(e,t,i);class Rm extends Ye{constructor(e,t,r,n,s){super(e);A(this,"_isNotEmpty",!0);this._lambdaId=t,this._interpreter=r,this._lambdaPrivacyVarKeys=n,this._runtimeService=s}get nodeType(){return ue.LAMBDA}setNotEmpty(e=!1){this._isNotEmpty=e}isEmptyParamFunction(){return this.getChildren().length<2&&this._isNotEmpty}isFunctionParameter(){return this._lambdaId===null}getLambdaId(){return this._lambdaId}execute(){if(this.isEmptyParamFunction())this.setValue(Ln.create(this,this._interpreter,this._lambdaPrivacyVarKeys));else{const e=this.getChildren(),t=e.length;this.setValue(e[t-1].getValue())}this._runtimeService.setUnitArrayFormulaEmbeddedMap()}}w.LambdaNodeFactory=class extends Ct{constructor(o,e){super(),this._runtimeService=o,this._interpreter=e}get zIndex(){return gt.get(ue.LAMBDA)||dt}create(o){const e=o.getChildren(),t=e[0];let r=e.slice(1,-1);const n=e[e.length-1];if(!(t instanceof oe&&n instanceof oe))return je.create(h.NAME);if(t.getToken()===Bt){const u=t.getChildren();if(r.length!==u.length)return je.create(h.VALUE)}else r=e.slice(0,-1);const s=M.generateRandomId(8),a=new Map;for(let u=0;u<r.length;u++){const c=r[u];if(c instanceof oe){const l=c.getChildren()[0];c.setToken(mi),a.set(l.trim(),void 0)}else return je.create(h.VALUE)}return this._runtimeService.registerFunctionDefinitionPrivacyVar(s,a),this._updateLambdaStatement(n,s,a),new Rm(o.getToken(),s,this._interpreter,[...a.keys()],this._runtimeService)}checkAndCreateNodeType(o){if(!(!(o instanceof oe)||o.getToken().trim().toUpperCase()!==or))return this.create(o)}_updateLambdaStatement(o,e,t){ra(o,e,t)}},w.LambdaNodeFactory=Em([oo(0,it),oo(1,M.Inject(w.Interpreter))],w.LambdaNodeFactory);function uo(i){if(!i)return;if(i.getToken()!==Vr)return i;const o=i,e=o.getCurrentLambdaPrivacyVar(),t=o.getLambdaParameter();if(e)return uo(e.get(t))}class bm extends Ye{constructor(o,e,t){super(o),this._lambdaParameter=e,this._currentLambdaPrivacyVar=t}getLambdaParameter(){return this._lambdaParameter}getCurrentLambdaPrivacyVar(){return this._currentLambdaPrivacyVar}get nodeType(){return ue.LAMBDA_PARAMETER}execute(){const o=uo(this._currentLambdaPrivacyVar.get(this._lambdaParameter));if(o)this.setValue(o.getValue());else{const e=this.getValue();(e==null||e.isError())&&this.setValue(g.create(h.NAME))}}}class sa extends Ct{get zIndex(){return gt.get(ue.LAMBDA_PARAMETER)||dt}create(o){const e=o.getFunctionDefinitionPrivacyVar(),t=o.getLambdaParameter();return e?new bm(o.getToken(),t,e):new je(h.NAME)}checkAndCreateNodeType(o){if(!(!(o instanceof oe)||o.getToken().trim()!==Vr))return this.create(o)}}class ym extends Ye{constructor(o){super(o),this._operatorString=o}get nodeType(){return ue.NULL}execute(){this.setValue(le.create())}}var $=(i=>(i.ABS="ABS",i.ACOS="ACOS",i.ACOSH="ACOSH",i.ACOT="ACOT",i.ACOTH="ACOTH",i.AGGREGATE="AGGREGATE",i.ARABIC="ARABIC",i.ASIN="ASIN",i.ASINH="ASINH",i.ATAN="ATAN",i.ATAN2="ATAN2",i.ATANH="ATANH",i.BASE="BASE",i.CEILING="CEILING",i.CEILING_MATH="CEILING.MATH",i.CEILING_PRECISE="CEILING.PRECISE",i.COMBIN="COMBIN",i.COMBINA="COMBINA",i.COS="COS",i.COSH="COSH",i.COT="COT",i.COTH="COTH",i.CSC="CSC",i.CSCH="CSCH",i.DECIMAL="DECIMAL",i.DEGREES="DEGREES",i.EVEN="EVEN",i.EXP="EXP",i.FACT="FACT",i.FACTDOUBLE="FACTDOUBLE",i.FLOOR="FLOOR",i.FLOOR_MATH="FLOOR.MATH",i.FLOOR_PRECISE="FLOOR.PRECISE",i.GCD="GCD",i.INT="INT",i.ISO_CEILING="ISO.CEILING",i.LCM="LCM",i.LET="LET",i.LN="LN",i.LOG="LOG",i.LOG10="LOG10",i.MDETERM="MDETERM",i.MINVERSE="MINVERSE",i.MMULT="MMULT",i.MOD="MOD",i.MROUND="MROUND",i.MULTINOMIAL="MULTINOMIAL",i.MUNIT="MUNIT",i.ODD="ODD",i.PI="PI",i.POWER="POWER",i.PRODUCT="PRODUCT",i.QUOTIENT="QUOTIENT",i.RADIANS="RADIANS",i.RAND="RAND",i.RANDARRAY="RANDARRAY",i.RANDBETWEEN="RANDBETWEEN",i.ROMAN="ROMAN",i.ROUND="ROUND",i.ROUNDBANK="ROUNDBANK",i.ROUNDDOWN="ROUNDDOWN",i.ROUNDUP="ROUNDUP",i.SEC="SEC",i.SECH="SECH",i.SERIESSUM="SERIESSUM",i.SEQUENCE="SEQUENCE",i.SIGN="SIGN",i.SIN="SIN",i.SINH="SINH",i.SQRT="SQRT",i.SQRTPI="SQRTPI",i.SUBTOTAL="SUBTOTAL",i.SUM="SUM",i.SUMIF="SUMIF",i.SUMIFS="SUMIFS",i.SUMPRODUCT="SUMPRODUCT",i.SUMSQ="SUMSQ",i.SUMX2MY2="SUMX2MY2",i.SUMX2PY2="SUMX2PY2",i.SUMXMY2="SUMXMY2",i.TAN="TAN",i.TANH="TANH",i.TRUNC="TRUNC",i))($||{}),J=(i=>(i.ASC="ASC",i.ARRAYTOTEXT="ARRAYTOTEXT",i.BAHTTEXT="BAHTTEXT",i.CHAR="CHAR",i.CLEAN="CLEAN",i.CODE="CODE",i.CONCAT="CONCAT",i.CONCATENATE="CONCATENATE",i.DBCS="DBCS",i.DOLLAR="DOLLAR",i.EXACT="EXACT",i.FIND="FIND",i.FINDB="FINDB",i.FIXED="FIXED",i.LEFT="LEFT",i.LEFTB="LEFTB",i.LEN="LEN",i.LENB="LENB",i.LOWER="LOWER",i.MID="MID",i.MIDB="MIDB",i.NUMBERSTRING="NUMBERSTRING",i.NUMBERVALUE="NUMBERVALUE",i.PHONETIC="PHONETIC",i.PROPER="PROPER",i.REGEXEXTRACT="REGEXEXTRACT",i.REGEXMATCH="REGEXMATCH",i.REGEXREPLACE="REGEXREPLACE",i.REPLACE="REPLACE",i.REPLACEB="REPLACEB",i.REPT="REPT",i.RIGHT="RIGHT",i.RIGHTB="RIGHTB",i.SEARCH="SEARCH",i.SEARCHB="SEARCHB",i.SUBSTITUTE="SUBSTITUTE",i.T="T",i.TEXT="TEXT",i.TEXTAFTER="TEXTAFTER",i.TEXTBEFORE="TEXTBEFORE",i.TEXTJOIN="TEXTJOIN",i.TEXTSPLIT="TEXTSPLIT",i.TRIM="TRIM",i.UNICHAR="UNICHAR",i.UNICODE="UNICODE",i.UPPER="UPPER",i.VALUE="VALUE",i.VALUETOTEXT="VALUETOTEXT",i.CALL="CALL",i.EUROCONVERT="EUROCONVERT",i.REGISTER_ID="REGISTER.ID",i))(J||{}),Nm=Object.getOwnPropertyDescriptor,pm=(i,o,e,t)=>{for(var r=t>1?void 0:t?Nm(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},co=(i,o)=>(e,t)=>o(e,t,i);class Vm extends Ye{constructor(o,e,t){super(o),this._functionExecutor=e,this._runtimeService=t}get nodeType(){return ue.OPERATOR}execute(){const o=this.getChildren();this._functionExecutor.name===Ie.COMPARE&&this._functionExecutor.setCompareType(this.getToken());const e=o[0],t=o[1];let r=e==null?void 0:e.getValue(),n=t==null?void 0:t.getValue();const s=this.getToken();if((r==null||n==null)&&s!==z.MINUS&&s!==z.PLUS){this.setValue(g.create(h.VALUE));return}r==null&&(r=le.create()),n==null&&(n=le.create()),r.isReferenceObject()&&(r=r.toArrayValueObject()),n.isReferenceObject()&&(n=n.toArrayValueObject());const a=this._functionExecutor.calculate(r,n);this._setEmbeddedArrayFormulaToResult(a),this.setValue(a)}_setEmbeddedArrayFormulaToResult(o){if(!o.isArray())return;const e=o.getRowCount(),t=o.getColumnCount();e<=1&&t<=1||this._runtimeService.setUnitArrayFormulaEmbeddedMap()}}w.OperatorNodeFactory=class extends Ct{constructor(o,e){super(),this._functionService=o,this._runtimeService=e}get zIndex(){return gt.get(ue.OPERATOR)||dt}create(o){let e="";const t=o;t===z.PLUS?e=Ie.PLUS:t===z.MINUS?e=Ie.MINUS:t===z.MULTIPLY?e=Ie.MULTIPLY:t===z.DIVIDED?e=Ie.DIVIDED:t===z.CONCATENATE?e=J.CONCATENATE:t===z.POWER?e=$.POWER:yc.has(t)&&(e=Ie.COMPARE);const r=this._functionService.getExecutor(e);return r?new Vm(t,r,this._runtimeService):(console.error(`No function ${o}`),je.create(h.NAME))}checkAndCreateNodeType(o){if(o instanceof oe)return;const e=o.trim();if(!(e.charAt(0)==='"'&&e.charAt(e.length-1)==='"')&&lt.has(e))return this.create(e)}},w.OperatorNodeFactory=pm([co(0,Ot),co(1,it)],w.OperatorNodeFactory);class Om extends Wt{constructor(e,t,r,n){super(e);A(this,"_isCurrentRowForRange",!1);this._tableData=t,this._columnDataString=r,this._tableOptionMap=n;const{sheetId:s,range:a,titleMap:u}=this._tableData;this.setForcedSheetIdDirect(s);const{startColumn:c,endColumn:l,type:f}=this._parseStructuredRef(this._columnDataString,u),m=a.startRow,d=a.endRow;let C=-1,_=-1;switch(f){case Se.ALL:C=m,_=d;break;case Se.DATA:C=m+1,_=d;break;case Se.HEADERS:C=m,_=m;break;case Se.TOTALS:C=d,_=d;break;case Se.THIS_ROW:{const E=this._resolveThisRow(m,d);C=E,_=E;break}default:C=m+1,_=d;break}this.setRangeData({startColumn:c,endColumn:l,startRow:C,endRow:_})}getRangeData(){const e=super.getRangeData();if(this._isCurrentRowForRange){const{startRow:t,startColumn:r,endRow:n,endColumn:s}=e,a=this.getCurrentRow();return{startRow:a==null?t:a,endRow:a==null?n:a,startColumn:r,endColumn:s}}return e}getRefOffset(){return{x:0,y:0}}isTable(){return!0}isCurrentRowForRange(){return this._isCurrentRowForRange}setForcedSheetId(e){}_parseStructuredRef(e,t){var _,E;const{range:r}=this._tableData,n=(_=r.startColumn)!=null?_:0,s=(E=r.endColumn)!=null?E:0;if(!e||e.trim().length===0)return{startColumn:n,endColumn:s,type:Se.DATA};const a=e.trim();if(a[0]!=="["){const R=this._mapSection(a);if(R!==void 0)return{startColumn:n,endColumn:s,type:R};const{startColumn:b,endColumn:N}=this._parseColumnOrRange(a,t,n);return{startColumn:b,endColumn:N,type:Se.DATA}}const u=this._stripOuterBracketOnce(a),c=this._findCommaAtTopLevel(u);if(u.length===0)return{startColumn:n,endColumn:s,type:Se.DATA};if(c===-1){if(u.startsWith("#")){const N=this._mapSection(u);return N!==void 0?{startColumn:n,endColumn:s,type:N}:{startColumn:n,endColumn:s,type:Se.DATA}}const{startColumn:R,endColumn:b}=this._parseColumnOrRange(u,t,n);return{startColumn:R,endColumn:b,type:Se.DATA}}const l=u.slice(0,c).trim(),f=u.slice(c+1).trim(),m=this._parseSectionMaybeBracketed(l),{startColumn:d,endColumn:C}=this._parseColumnOrRange(f,t,n);return{startColumn:d,endColumn:C,type:m}}_stripOuterBracketOnce(e){return e.length>=2&&e[0]==="["&&e[e.length-1]==="]"?e.slice(1,-1):e}_findCommaAtTopLevel(e){let t=0;for(let r=0;r<e.length;r++){const n=e[r];if(n==="[")t++;else if(n==="]")t=Math.max(0,t-1);else if(n===K.COMMA&&t===0)return r}return-1}_parseSectionMaybeBracketed(e){const t=e.trim(),r=t.startsWith("[")&&t.endsWith("]")?this._stripOuterBracketOnce(t):t,n=this._mapSection(r);return n!=null?n:Se.DATA}_mapSection(e){const t=e.trim();if(!t.startsWith("#"))return;const r=this._tableOptionMap.get(t);if(r!==void 0)return r;const n=t.replace(/\s+/g," ").toLowerCase();for(const[s,a]of this._tableOptionMap.entries())if(s.replace(/\s+/g," ").toLowerCase()===n)return a}_parseColumnOrRange(e,t,r){const n=e.trim(),s=this._findColonAtTopLevel(n);if(s===-1){const d=this._stripOuterBracketIfAny(n),C=this._titleToIndex(d,t);return{startColumn:r+C,endColumn:+r+C}}const a=n.slice(0,s).trim(),u=n.slice(s+1).trim(),c=this._stripOuterBracketIfAny(a),l=this._stripOuterBracketIfAny(u),f=this._titleToIndex(c,t),m=this._titleToIndex(l,t);return f!==-1&&m!==-1&&f>m?{startColumn:r+m,endColumn:r+f}:{startColumn:r+f,endColumn:r+m}}_stripOuterBracketIfAny(e){return e.length>=2&&e[0]==="["&&e[e.length-1]==="]"?e.slice(1,-1):e}_findColonAtTopLevel(e){let t=0;for(let r=0;r<e.length;r++){const n=e[r];if(n==="[")t++;else if(n==="]")t=Math.max(0,t-1);else if(n===K.COLON&&t===0)return r}return-1}_titleToIndex(e,t){var a;const r=e.trim(),n=t.get(r);if(n!==void 0)return n;const s=r.replace(/\u3000/g," ").trim();return(a=t.get(s))!=null?a:-1}_resolveThisRow(e,t){return this._isCurrentRowForRange=!0,Math.min(e+1,t)}}var Sm=Object.getOwnPropertyDescriptor,Mm=(i,o,e,t)=>{for(var r=t>1?void 0:t?Sm(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},Pn=(i,o)=>(e,t)=>o(e,t,i);class lo extends Ye{constructor(e,t,r,n,s=!1,a){super(r);A(this,"_refOffsetX",0);A(this,"_refOffsetY",0);this._currentConfigService=e,this._runtimeService=t,this._referenceObjectType=n,this._isPrepareMerge=s,this._tableReferenceObject=a}get nodeType(){return ue.REFERENCE}execute(){const e=this._currentConfigService,t=this._runtimeService,r=this._tableReferenceObject||zf(this.getToken(),this._referenceObjectType);r.setDefaultUnitId(t.currentUnitId),r.setDefaultSheetId(t.currentSubUnitId),r.setForcedSheetId(e.getSheetNameMap()),r.setUnitData(e.getUnitData()),r.setArrayFormulaCellData(e.getArrayFormulaCellData()),r.setRuntimeData(t.getUnitData()),r.setUnitStylesData(e.getUnitStylesData()),r.setRuntimeArrayFormulaCellData(t.getRuntimeArrayFormulaCellData()),r.setRuntimeFeatureCellData(t.getRuntimeFeatureCellData());const n=t.currentRow,s=t.currentColumn;r.setCurrentRowAndColumn(n,s);const{x:a,y:u}=this.getRefOffset();r.setRefOffset(a,u),!this._isPrepareMerge&&r.isExceedRange()?this.setValue(g.create(h.NAME)):this.setValue(r)}setRefOffset(e=0,t=0){this._refOffsetX=e,this._refOffsetY=t}getRefOffset(){return{x:this._refOffsetX,y:this._refOffsetY}}}w.ReferenceNodeFactory=class extends Ct{constructor(o,e,t,r){super(),this._currentConfigService=o,this._formulaRuntimeService=e,this._functionService=t,this._superTableService=r}get zIndex(){return gt.get(ue.REFERENCE)||dt}checkAndCreateNodeType(o){var c,l;let e=!1,t,r=!1;o instanceof oe?(e=!0,t=o.getToken().trim(),((l=(c=o.getParent())==null?void 0:c.getParent())==null?void 0:l.getToken().trim())===K.COLON&&(r=!0)):t=o.trim();const{tokenTrim:n,minusPrefixNode:s,atPrefixNode:a}=so(t,this._functionService,this._formulaRuntimeService);if(!e&&n.charAt(0)==='"'&&n.charAt(n.length-1)==='"')return;const u=this._getNode(n,e,r,o);if(u)return a?u.setParent(a):s&&u.setParent(s),u}_getTableMap(){const o=this._currentConfigService.getExecuteUnitId();if(o)return this._superTableService.getTableMap(o)}_getNode(o,e,t,r){var C;const n=this._currentConfigService,s=this._formulaRuntimeService,a=_=>new lo(n,s,o,_,t);if(pr(o))return a(Ur.CELL);const c=e&&this._checkParentIsUnionOperator(r);if(c&&ci(o))return a(Ur.ROW);if(c&&li(o))return a(Ur.COLUMN);const m=this._getTableMap();return((C=m==null?void 0:m.has(o))!=null?C:!1)?this._getTableReferenceNode(o,e,t,!0):this._getTableReferenceNode(o,e,t,!1)}_getTableReferenceNode(o,e,t,r=!1){if(!this._checkTokenIsTableReference(o)&&!r)return;const{tableName:n,columnStruct:s}=this._splitTableStructuredRef(o),a=this._getTableMap();if(!e&&(a!=null&&a.has(n))){const u=s,c=a.get(n),l=this._superTableService.getTableOptionMap();return new lo(this._currentConfigService,this._formulaRuntimeService,o,Ur.COLUMN,t,new Om(o,c,u,l))}}_splitTableStructuredRef(o){const e=o.indexOf("[");return e===-1?{tableName:o,struct:""}:{tableName:o.slice(0,e),columnStruct:o.slice(e)}}_checkTokenIsTableReference(o){return Yc(o)||Hc(o)||Gc(o)||Wc(o)}_checkParentIsUnionOperator(o){var e,t;return((t=(e=o.getParent())==null?void 0:e.getParent())==null?void 0:t.getToken().trim())===K.COLON}},w.ReferenceNodeFactory=Mm([Pn(0,Nt),Pn(1,it),Pn(2,Ot),Pn(3,$t)],w.ReferenceNodeFactory);var Dm=Object.getOwnPropertyDescriptor,wm=(i,o,e,t)=>{for(var r=t>1?void 0:t?Dm(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},aa=(i,o)=>(e,t)=>o(e,t,i);class fo extends Ye{constructor(o,e,t,r){super(t),this._currentConfigService=o,this._lexer=e,this._operatorString=t,this._functionExecutor=r}get nodeType(){return ue.SUFFIX}execute(){var r;let e=(r=this.getChildren()[0])==null?void 0:r.getValue(),t;if(e==null){this.setValue(g.create(h.ERROR));return}if(this._operatorString===Ke.PERCENTAGE){if(e.isReferenceObject()&&(e=e.toArrayValueObject()),t=this._functionExecutor.calculate(e,y.create(100)),t.isNumber()){const n=Number(t.getValue());t=y.create(n,"0.00%")}}else this._operatorString===Ke.POUND?t=this._handlerPound(e):t=g.create(h.VALUE);this.setValue(t)}_handlerPound(o){var u,c,l,f;if(!o.isReferenceObject()||!o.isCell())return g.create(h.VALUE);const e=o,t=e.getRangePosition(),r=e.getUnitId(),n=e.getSheetId(),s=this._currentConfigService.getFormulaData(),a=(f=(l=(c=(u=s==null?void 0:s[r])==null?void 0:u[n])==null?void 0:c[t.startRow])==null?void 0:l[t.startColumn])==null?void 0:f.f;return a&&this._lexer.treeBuilder(a),g.create(h.VALUE)}}w.SuffixNodeFactory=class extends Ct{constructor(o,e,t){super(),this._functionService=o,this._lexer=e,this._currentConfigService=t}get zIndex(){return gt.get(ue.SUFFIX)||dt}checkAndCreateNodeType(o){if(!(o instanceof oe))return;const e=o.getToken().trim();if(e.charAt(0)==='"'&&e.charAt(e.length-1)==='"')return;let t="";if(e===Ke.PERCENTAGE)t=Ie.DIVIDED;else return e===Ke.POUND?new fo(this._currentConfigService,this._lexer,e):void 0;const r=this._functionService.getExecutor(t);return r?new fo(this._currentConfigService,this._lexer,e,r):(console.error(`No function ${o}`),je.create(h.NAME))}},w.SuffixNodeFactory=wm([aa(0,Ot),aa(1,M.Inject(w.Lexer)),aa(2,Nt)],w.SuffixNodeFactory);var Lm=Object.getOwnPropertyDescriptor,Pm=(i,o,e,t)=>{for(var r=t>1?void 0:t?Lm(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},jm=(i,o)=>(e,t)=>o(e,t,i);class xm extends Ye{constructor(o){super(o)}get nodeType(){return ue.UNION}execute(){const o=this.getChildren(),e=o[0],t=o[1],r=e.getValue(),n=t.getValue();if(r==null||n==null)throw new Error("leftNode and rightNode");let s;this.getToken()===K.COLON?s=this._unionFunction(r,n):s=g.create(h.NAME),this.setValue(s)}_unionFunction(o,e){return o.isError()||e.isError()||!o.isReferenceObject()||!e.isReferenceObject()?g.create(h.REF):(o=o,e=e,Jf(o,e))}}w.UnionNodeFactory=class extends Ct{constructor(o){super(),this._functionService=o}get zIndex(){return gt.get(ue.UNION)||dt}create(o){return new xm(o)}checkAndCreateNodeType(o){if(!(o instanceof oe))return;const t=o.getToken().trim();if(!(t.charAt(0)==='"'&&t.charAt(t.length-1)==='"')&&t===K.COLON)return this.create(t)}},w.UnionNodeFactory=Pm([jm(0,Ot)],w.UnionNodeFactory);class Um extends Ye{constructor(o){super(o)}get nodeType(){return ue.VALUE}execute(){var e,t,r;const o=((e=this.getParent())==null?void 0:e.nodeType)===ue.FUNCTION&&((r=(t=this.getParent())==null?void 0:t.isFunctionExecutorArgumentsIgnoreNumberPattern)==null?void 0:r.call(t));this.setValue(ht.create(this.getToken(),o))}}class ia extends Ct{get zIndex(){return gt.get(ue.VALUE)||dt}_checkValueNode(o){if(Number.isNaN(Number(o))){const e=o.trim(),t=e.charAt(0),r=e.charAt(e.length-1);if(Dt.has(e))return this.create(e);if(t==='"'&&r==='"')return this.create(e);if(t==="{"&&r==="}")return this.create(e);const n=e.toUpperCase();if(n===St.TRUE||n===St.FALSE)return this.create(n)}else return this.create(o)}create(o){return new Um(o)}checkAndCreateNodeType(o){if(!(o instanceof oe))return this._checkValueNode(o)}}var Tm=Object.getOwnPropertyDescriptor,vm=(i,o,e,t)=>{for(var r=t>1?void 0:t?Tm(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},ot=(i,o)=>(e,t)=>o(e,t,i);w.AstTreeBuilder=class extends M.Disposable{constructor(e,t,r,n,s,a,u,c,l,f,m){super();A(this,"_astNodeFactoryList",[]);this._runtimeService=e,this._astRootNodeFactory=t,this._functionNodeFactory=r,this._lambdaNodeFactory=n,this._lambdaParameterNodeFactory=s,this._operatorNodeFactory=a,this._prefixNodeFactory=u,this._referenceNodeFactory=c,this._suffixNodeFactory=l,this._unionNodeFactory=f,this._valueNodeFactory=m,this._initializeAstNode()}dispose(){this._astNodeFactoryList.forEach(e=>{e.dispose()}),this._astNodeFactoryList=[]}parse(e){const t=new Js(Rt),r=this._parse(e,t);return e.hasDefinedNames()&&(r==null||r.setDefinedNames(e.getDefinedNames())),r}_lambdaParameterHandler(e,t){if(t.getLambdaId==null)return je.create(h.VALUE);const r=t.getLambdaId(),n=new Js(Rt),s=this._runtimeService.getFunctionDefinitionPrivacyVar(r);if(!s)return!1;const a=[...s.keys()],u=e.getChildren(),c=u.length;for(let l=0;l<c;l++){const f=u[l];if(f instanceof oe){ra(f,r,s),this._parse(f,n);const d=n.getChildren()[l];d!=null&&s.set(a[l],d)}else return!1}return n.setParent(t),t}_changeLetToLambda(e){const t=e.getChildren(),r=t.length;if(r%2!==1||r===0)return;const n=new oe;n.setToken(or);const s=new oe;s.setToken(Bt);const a=[...t];for(let c=0;c<r;c++){const l=a[c];if(!(l instanceof oe))return;c%2===0?l.changeToParent(n):l.changeToParent(s)}n.addChildrenFirst(s),s.setParent(n);const u=e.getParent();return u==null||u.replaceChild(e,n),n}_parse(e,t){var f;const r=e.getChildren(),n=r.length,s=[];let a=null;const u=e.getToken().trim().toUpperCase();if(u===hi){const m=this._changeLetToLambda(e);return m!=null?this._parse(m,t):je.create(h.ERROR)}if(u===nt){if(a=t,n===0)return new ym(Rt).setParent(t),a}else{if(u===Bt){let m=this._lambdaParameterHandler(e,t);return m===!1&&(m=je.create(h.ERROR)),m}if(a=this._checkAstNode(e),a==null)return je.create(h.NAME)}const c=r[0];for(let m=0;m<n;m++){const d=r[m];if(ao(c)){if(m!==0&&m!==n-1)continue}else if(Cm(d)&&m!==n-1)continue;let C=null;if(d instanceof oe){if(d.getToken()===nt&&d.getChildren().length===0){const _=(f=d.getParent())==null?void 0:f.getChildren();if(_&&_.length===1)return je.create(h.NAME)}if(C=this._parse(d,a),C===a)continue}else C=this._checkAstNode(d);if(C==null)return je.create(h.NAME);if(C=_m(C),C==null||(C==null?void 0:C.nodeType)===ue.ERROR)return C;switch(C.nodeType){case ue.FUNCTION:{const _=C.getToken().trim().toUpperCase();Kc.has(_)&&C.setForcedCalculateFunction(),s.push(C);break}case ue.LAMBDA:s.push(C);break;case ue.LAMBDA_PARAMETER:s.push(C);break;case ue.OPERATOR:{const _=s.pop(),E=s.pop();E&&E.setParent(C),_&&_.setParent(C),s.push(C);break}case ue.REFERENCE:s.push(C);break;case ue.ROOT:s.push(C);break;case ue.UNION:s.push(C);break;case ue.VALUE:s.push(C);break;case ue.PREFIX:s.push(C);break;case ue.SUFFIX:s.push(C);break}}const l=s.length;for(let m=0;m<l;m++)s[m].setParent(a);return a}_checkAstNode(e){let t=null;const r=this._astNodeFactoryList.length;for(let n=0;n<r&&(t=this._astNodeFactoryList[n].checkAndCreateNodeType(e),t==null);n++);return t==null?new mm:t}_initializeAstNode(){this._astNodeFactoryList=[this._astRootNodeFactory,this._functionNodeFactory,this._lambdaNodeFactory,this._lambdaParameterNodeFactory,this._operatorNodeFactory,this._prefixNodeFactory,this._referenceNodeFactory,this._suffixNodeFactory,this._unionNodeFactory,this._valueNodeFactory].sort(M.sortRules)}},w.AstTreeBuilder=vm([ot(0,it),ot(1,M.Inject(ea)),ot(2,M.Inject(w.FunctionNodeFactory)),ot(3,M.Inject(w.LambdaNodeFactory)),ot(4,M.Inject(sa)),ot(5,M.Inject(w.OperatorNodeFactory)),ot(6,M.Inject(w.PrefixNodeFactory)),ot(7,M.Inject(w.ReferenceNodeFactory)),ot(8,M.Inject(w.SuffixNodeFactory)),ot(9,M.Inject(w.UnionNodeFactory)),ot(10,M.Inject(ia))],w.AstTreeBuilder);class mo extends M.Disposable{constructor(){super(...arguments);A(this,"_otherFormulaData",new Map);A(this,"_featureFormulaData",new Map);A(this,"_formulaData",new Map);A(this,"_definedNameMap",new Map);A(this,"_otherFormulaDataMainData",new Set);A(this,"_dependencyRTreeCache",new M.RTree);A(this,"_dependencyTreeIdLast",0)}buildDependencyTree(e,t){throw new Error("Method not implemented.")}getTreeById(e){throw new Error("Method not implemented.")}getAllTree(){throw new Error("Method not implemented.")}reset(){throw new Error("Method not implemented.")}addOtherFormulaDependency(e,t,r,n){throw new Error("Method not implemented.")}removeOtherFormulaDependency(e,t,r){throw new Error("Method not implemented.")}clearOtherFormulaDependency(e,t){throw new Error("Method not implemented.")}addFeatureFormulaDependency(e,t,r,n){throw new Error("Method not implemented.")}removeFeatureFormulaDependency(e,t,r){throw new Error("Method not implemented.")}clearFeatureFormulaDependency(e,t){throw new Error("Method not implemented.")}addFormulaDependency(e,t,r,n,s){throw new Error("Method not implemented.")}removeFormulaDependency(e,t,r,n){throw new Error("Method not implemented.")}clearFormulaDependency(e,t){throw new Error("Method not implemented.")}removeFormulaDependencyByDefinedName(e,t){throw new Error("Method not implemented.")}searchDependency(e,t){return this._dependencyRTreeCache.bulkSearch(e,t)}_restDependencyTreeId(){this._dependencyTreeIdLast=0}getOtherFormulaDependency(e,t,r){var n,s;return(s=(n=this._otherFormulaData.get(e))==null?void 0:n.get(t))==null?void 0:s.get(r)}addOtherFormulaDependencyMainData(e){this._otherFormulaDataMainData.add(e)}hasOtherFormulaDataMainData(e){return this._otherFormulaDataMainData.has(e)}_removeDependencyRTreeCacheById(e,t){this._dependencyRTreeCache.removeById(e,t)}getFeatureFormulaDependency(e,t,r){var n,s;return(s=(n=this._featureFormulaData.get(e))==null?void 0:n.get(t))==null?void 0:s.get(r)}getFormulaDependency(e,t,r,n){var s,a;return(a=(s=this._formulaData.get(e))==null?void 0:s.get(t))==null?void 0:a.getValue(r,n)}addDependencyRTreeCache(e){const t=[];for(let r=0;r<e.rangeList.length;r++){const n=e.rangeList[r],{unitId:s,sheetId:a,range:u}=n;t.push({unitId:s,sheetId:a,range:u,id:e.treeId})}this._dependencyRTreeCache.bulkInsert(t),this._addAllTreeMap(e)}getLastTreeId(){const e=this._dependencyTreeIdLast;return this._dependencyTreeIdLast++,e}_addAllTreeMap(e){throw new Error("Method not implemented.")}_addDefinedName(e,t,r){this._definedNameMap.has(e)||this._definedNameMap.set(e,new Map);const n=this._definedNameMap.get(e);n.has(t)||n.set(t,new Set),n.get(t).add(r)}addFormulaDependencyByDefinedName(e,t){const r=e.treeId,n=(t==null?void 0:t.getDefinedNames())||[];for(const s of n)this._addDefinedName(e.unitId,s,r)}}class ho extends mo{constructor(){super(...arguments);A(this,"_allTreeMap",new Map)}dispose(){super.dispose(),this.reset()}buildDependencyTree(e,t=[]){const r=this.getAllTree();return e.length===0?(this._buildReverseDependency(r,t),r):(this._buildDependencyTree(r,e),this._buildReverseDependency(r,e),r)}_buildDependencyTree(e,t){const r=new Map;for(let n=0;n<t.length;n++){const s=t[n];r.set(s.treeId,s)}for(let n=0;n<e.length;n++){const s=e[n],a=s.toRTreeItem(),u=this._dependencyRTreeCache.bulkSearch(a);for(const c of u){const l=r.get(c);l&&s!==l&&!l.hasChildren(s.treeId)&&l.pushChildren(s)}}r.clear()}_buildReverseDependency(e,t){const r=new Map;for(let n=0;n<e.length;n++){const s=e[n];r.set(s.treeId,s)}for(let n=0;n<t.length;n++){const s=t[n],a=s.toRTreeItem(),u=this._dependencyRTreeCache.bulkSearch(a);for(const c of u){const l=r.get(c);l&&s!==l&&!l.hasChildren(s.treeId)&&l.pushChildren(s)}}r.clear()}getAllTree(){const e=[];return this._allTreeMap.forEach(t=>{t.resetState(),e.push(t)}),e}getTreeById(e){return this._allTreeMap.get(e)}reset(){this._otherFormulaData.clear(),this._featureFormulaData.clear(),this._formulaData.clear(),this._definedNameMap.clear(),this._otherFormulaDataMainData.clear(),this._dependencyRTreeCache.clear(),this._allTreeMap.clear(),this._restDependencyTreeId()}addOtherFormulaDependency(e,t,r,n){this._otherFormulaData.has(e)||this._otherFormulaData.set(e,new Map);const s=this._otherFormulaData.get(e);s.has(t)||s.set(t,new Map);const a=s.get(t);a.has(r)||a.set(r,new M.ObjectMatrix),a.get(r).setValue(n.refOffsetX,n.refOffsetY,n.treeId),this._addAllTreeMap(n)}removeOtherFormulaDependency(e,t,r){const n=this._otherFormulaData.get(e);if(n&&n.has(t)){const s=n.get(t);r.forEach(a=>{const u=s.get(a);u!=null&&(u.forValue((c,l,f)=>{this._removeDependencyRTreeCache(f),this.clearDependencyForTree(this._allTreeMap.get(f)),this._removeAllTreeMap(f)}),s.delete(a),this._otherFormulaDataMainData.delete(a))}),s.size===0&&n.delete(t),n.size===0&&this._otherFormulaData.delete(e)}}clearOtherFormulaDependency(e,t){const r=this._otherFormulaData.get(e);if(t&&r&&r.has(t)){const n=r.get(t);this._removeDependencyRTreeCacheById(e,t);for(const s of n.keys()){const a=n.get(s);a!=null&&(a.forValue((u,c,l)=>{const f=this._allTreeMap.get(l);f&&(this.clearDependencyForTree(f),this._removeAllTreeMap(l))}),this._otherFormulaDataMainData.delete(s))}n.clear()}else if(r){for(const n of r.keys()){const s=r.get(n);this._removeDependencyRTreeCacheById(e,n);for(const a of s.keys()){const u=s.get(a);u!=null&&(u.forValue((c,l,f)=>{const m=this._allTreeMap.get(f);m&&(this.clearDependencyForTree(m),this._removeAllTreeMap(f))}),this._otherFormulaDataMainData.delete(a))}}this._otherFormulaData.delete(e)}}addFeatureFormulaDependency(e,t,r,n){this._featureFormulaData.has(e)||this._featureFormulaData.set(e,new Map);const s=this._featureFormulaData.get(e);s.has(t)||s.set(t,new Map),s.get(t).set(r,n.treeId),this._addAllTreeMap(n)}removeFeatureFormulaDependency(e,t,r){const n=this._featureFormulaData.get(e);if(n&&n.has(t)){const s=n.get(t);r.forEach(a=>{const u=s.get(a);u!=null&&(this._removeDependencyRTreeCache(u),s.delete(a),this.clearDependencyForTree(this._allTreeMap.get(u)),this._removeAllTreeMap(u))})}}clearFeatureFormulaDependency(e,t){const r=this._featureFormulaData.get(e);if(t&&r&&r.has(t)){const n=r.get(t);this._removeDependencyRTreeCacheById(e,t),n.forEach(s=>{s!=null&&(this.clearDependencyForTree(this._allTreeMap.get(s)),this._removeAllTreeMap(s))}),n.clear()}else r&&(r.forEach((n,s)=>{this._removeDependencyRTreeCacheById(e,s),n.forEach(a=>{a!=null&&(this.clearDependencyForTree(this._allTreeMap.get(a)),this._removeAllTreeMap(a))})}),this._featureFormulaData.delete(e))}addFormulaDependency(e,t,r,n,s){this._formulaData.has(e)||this._formulaData.set(e,new Map);const a=this._formulaData.get(e);a.has(t)||a.set(t,new M.ObjectMatrix),a.get(t).setValue(r,n,s.treeId),this._addAllTreeMap(s)}removeFormulaDependency(e,t,r,n){const s=this._formulaData.get(e);if(s&&s.has(t)){const a=s.get(t),u=a.getValue(r,n);if(u==null)return;this._removeDependencyRTreeCache(u),a.realDeleteValue(r,n),this.clearDependencyForTree(this._allTreeMap.get(u)),this._removeAllTreeMap(u)}}clearFormulaDependency(e,t){const r=this._formulaData.get(e);if(t&&r&&r.has(t)){const n=r.get(t);this._removeDependencyRTreeCacheById(e,t),n.forValue((s,a,u)=>{if(u==null)return!0;this.clearDependencyForTree(this._allTreeMap.get(u)),this._removeAllTreeMap(u)}),n.reset()}else r&&(r.forEach((n,s)=>{this._removeDependencyRTreeCacheById(e,s),n.forValue((a,u,c)=>{if(c==null)return!0;this.clearDependencyForTree(this._allTreeMap.get(c)),this._removeAllTreeMap(c)})}),this._formulaData.delete(e))}clearDependencyForTree(e){if(e==null)return;const t=e.parents,r=e.children,n=this._allTreeMap;for(const s of t){const a=n.get(s);a==null||a.children.delete(e.treeId)}for(const s of r){const a=n.get(s);a==null||a.parents.delete(e.treeId)}e.dispose()}_removeDependencyRTreeCache(e){if(e==null)return;const t=this._allTreeMap.get(e);if(t){const r=[];for(let n=0;n<t.rangeList.length;n++){const s=t.rangeList[n],{unitId:a,sheetId:u,range:c}=s;r.push({unitId:a,sheetId:u,range:c,id:e})}this._dependencyRTreeCache.bulkRemove(r)}}removeFormulaDependencyByDefinedName(e,t){const r=this._definedNameMap.get(e);if(r){const n=r.get(t);if(n){for(const s of n)this._removeDependencyRTreeCache(s),this.clearDependencyForTree(this._allTreeMap.get(s)),this._removeAllTreeMap(s);n.clear()}}}_removeAllTreeMap(e){e!=null&&this._allTreeMap.delete(e)}_addAllTreeMap(e){this._allTreeMap.set(e.treeId,e)}}const vr=M.createIdentifier("univer.formula.dependency-manager.service");class go extends M.Disposable{constructor(){super(...arguments);A(this,"_referenceExecutorMap",new Map);A(this,"_onChanged$",new we.Subject);A(this,"onChanged$",this._onChanged$.asObservable())}dispose(){super.dispose(),this._referenceExecutorMap.clear(),this._onChanged$.complete()}remove(e,t,r){r.forEach(n=>{var s,a;(a=(s=this._referenceExecutorMap.get(e))==null?void 0:s.get(t))==null||a.delete(n)}),this._onChanged$.next({unitId:e,subUnitId:t,featureIds:r})}get(e,t,r){var n,s;return(s=(n=this._referenceExecutorMap.get(e))==null?void 0:n.get(t))==null?void 0:s.get(r)}has(e,t,r){var n,s;return!!((s=(n=this._referenceExecutorMap.get(e))==null?void 0:n.get(t))!=null&&s.has(r))}register(e,t,r,n){let s=this._referenceExecutorMap.get(e);s||(s=new Map,this._referenceExecutorMap.set(e,s));let a=s.get(t);a||(a=new Map,s.set(t,a)),this._onChanged$.next({unitId:e,subUnitId:t,featureIds:[r]}),a.set(r,n)}getReferenceExecutorMap(){return this._referenceExecutorMap}}const dr=M.createIdentifier("univer.formula.feature-calculation-manager.service");class Co extends M.Disposable{constructor(){super(...arguments);A(this,"_otherFormulaData",{})}dispose(){super.dispose(),this._otherFormulaData={}}remove(e){var s,a,u;const{unitId:t,subUnitId:r,formulaId:n}=e;(u=(a=(s=this._otherFormulaData)==null?void 0:s[t])==null?void 0:a[r])==null||delete u[n]}get(e){var s,a;const{unitId:t,subUnitId:r,formulaId:n}=e;return(a=(s=this._otherFormulaData[t])==null?void 0:s[r])==null?void 0:a[n]}has(e){var s,a;const{unitId:t,subUnitId:r,formulaId:n}=e;return((a=(s=this._otherFormulaData[t])==null?void 0:s[r])==null?void 0:a[n])!=null}register(e){const{unitId:t,subUnitId:r,formulaId:n,item:s}=e;this._otherFormulaData[t]||(this._otherFormulaData[t]={}),this._otherFormulaData[t][r]||(this._otherFormulaData[t][r]={}),this._otherFormulaData[t][r][n]=s}batchRegister(e){Object.keys(e).forEach(t=>{const r=e[t];if(r==null)return!0;Object.keys(r).forEach(n=>{const s=r[n];if(s==null)return!0;Object.keys(s).forEach(a=>{const u=s[a];if(u==null)return!0;this.register({unitId:t,subUnitId:n,formulaId:a,item:u})})})})}batchRemove(e){Object.keys(e).forEach(t=>{const r=e[t];if(r==null)return!0;Object.keys(r).forEach(n=>{const s=r[n];if(s==null)return!0;Object.keys(s).forEach(a=>{this.remove({unitId:t,subUnitId:n,formulaId:a})})})})}getOtherFormulaData(){return this._otherFormulaData}}const jn=M.createIdentifier("univer.formula.other-formula-manager.service");var xn=(i=>(i[i.NORMAL_FORMULA=0]="NORMAL_FORMULA",i[i.OTHER_FORMULA=1]="OTHER_FORMULA",i[i.FEATURE_FORMULA=2]="FEATURE_FORMULA",i))(xn||{});class _o{constructor(){A(this,"_state",0);A(this,"treeId");A(this,"children",new Set);A(this,"parents",new Set)}resetState(){this._state=0}setAdded(){this._state=1}isAdded(){return this._state===1}setSkip(){this._state=2}isSkip(){return this._state===2}pushChildren(o){this.children.add(o.treeId),o._pushParent(this)}hasChildren(o){return this.children.has(o)}_pushParent(o){this.parents.add(o.treeId)}}class oa extends _o{constructor(){super(...arguments);A(this,"refTree");A(this,"refOffsetX",-1);A(this,"refOffsetY",-1);A(this,"isCache",!1);A(this,"isDirty",!1);A(this,"addressFunctionNodes",[]);A(this,"getDirtyData");A(this,"featureId")}get isVirtual(){return!0}get row(){return this.refTree==null?-1:this.refTree.row+this.refOffsetY}get column(){return this.refTree==null?-1:this.refTree.column+this.refOffsetX}get rowCount(){return this.refTree==null?0:this.refTree.rowCount}get columnCount(){return this.refTree==null?0:this.refTree.columnCount}get unitId(){return this.refTree==null?"":this.refTree.unitId}get subUnitId(){return this.refTree==null?"":this.refTree.subUnitId}get formula(){var e,t;return(t=(e=this.refTree)==null?void 0:e.formula)!=null?t:""}get nodeData(){return{node:this.node,refOffsetX:this.refOffsetX,refOffsetY:this.refOffsetY}}get node(){var e;return(e=this.refTree)==null?void 0:e.node}dispose(){this.refTree=null}get rangeList(){const e=[];if(this.refTree==null)return[];for(let t=0;t<this.refTree.rangeList.length;t++){const r=this.refTree.rangeList[t];e.push({unitId:r.unitId,sheetId:r.sheetId,range:M.moveRangeByOffset(r.range,this.refOffsetX,this.refOffsetY)})}return e}toRTreeItem(){const e=this.row,t=this.column;return[{unitId:this.unitId,sheetId:this.subUnitId,range:{startRow:e,startColumn:t,endRow:e,endColumn:t}}]}inRangeData(e){const t=e.startRow,r=e.startColumn,n=e.endRow,s=e.endColumn,a=this.row,u=this.column;return!(a<t||a>n||u<r||u>s)}dependencySheetName(e){return this.refTree==null?!1:this.refTree.dependencySheetName(e)}isExcludeRange(e){var r;const t=this.rangeList;if(t.length===0)return!1;for(let n=0,s=t.length;n<s;n++){const a=t[n],{unitId:u,sheetId:c,range:l}=a,f=(r=e==null?void 0:e[u])==null?void 0:r[c];let{startRow:m,endRow:d,startColumn:C,endColumn:_}=l;Number.isNaN(m)&&(m=0),Number.isNaN(C)&&(C=0),Number.isNaN(d)&&(d=Number.POSITIVE_INFINITY),Number.isNaN(_)&&(_=Number.POSITIVE_INFINITY);let E=!1;if(f==null||f.forValue((R,b)=>{if(R>=m&&R<=d&&b>=C&&b<=_)return E=!0,!1}),E)return!0}return!1}get formulaId(){return this.refTree==null?"":this.refTree.formulaId}}class Un extends _o{constructor(e){super();A(this,"isCache",!1);A(this,"featureId");A(this,"featureDirtyRanges",[]);A(this,"refOffsetX",0);A(this,"refOffsetY",0);A(this,"type",0);A(this,"formulaId");A(this,"subUnitId","");A(this,"unitId","");A(this,"rangeList",[]);A(this,"formula","");A(this,"row",-1);A(this,"column",-1);A(this,"rowCount",Number.NEGATIVE_INFINITY);A(this,"columnCount",Number.NEGATIVE_INFINITY);A(this,"isDirty",!1);A(this,"node");A(this,"addressFunctionNodes",[]);A(this,"getDirtyData");this.treeId=e}get isVirtual(){return!1}get nodeData(){return{node:this.node,refOffsetX:0,refOffsetY:0}}toJson(){return{formula:this.formula,refOffsetX:this.refOffsetX,refOffsetY:this.refOffsetY}}dispose(){this.featureDirtyRanges=[],this.rangeList=[],this.addressFunctionNodes=[],this.getDirtyData=null}inRangeData(e){const t=e.startRow,r=e.startColumn,n=e.endRow,s=e.endColumn,a=this.row,u=this.column;return!(a<t||a>n||u<r||u>s)}dependencySheetName(e){var r;const t=this.rangeList;if(t.length===0||e==null)return!1;for(let n=0,s=t.length;n<s;n++){const a=t[n],{unitId:u,sheetId:c}=a;if(((r=e[u])==null?void 0:r[c])!=null)return!0}return!1}isExcludeRange(e){var r;const t=this.rangeList;if(t.length===0)return!1;for(let n=0,s=t.length;n<s;n++){const a=t[n],{unitId:u,sheetId:c,range:l}=a,f=(r=e==null?void 0:e[u])==null?void 0:r[c];let{startRow:m,endRow:d,startColumn:C,endColumn:_}=l;Number.isNaN(m)&&(m=0),Number.isNaN(C)&&(C=0),Number.isNaN(d)&&(d=Number.POSITIVE_INFINITY),Number.isNaN(_)&&(_=Number.POSITIVE_INFINITY);let E=!1;if(f==null||f.forValue((R,b)=>{if(R>=m&&R<=d&&b>=C&&b<=_)return E=!0,!1}),E)return!0}return!1}pushRangeList(e){this.rangeList.push(...e)}shouldBePushRangeList(){return this.rangeList.length===0&&this.type!==2}toRTreeItem(){if(this.featureId!=null)return this.featureDirtyRanges;const e=this.row,t=this.column;return[{unitId:this.unitId,sheetId:this.subUnitId,range:{startRow:e,startColumn:t,endRow:e,endColumn:t}}]}}var Im=Object.getOwnPropertyDescriptor,Fm=(i,o,e,t)=>{for(var r=t>1?void 0:t?Im(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},Tt=(i,o)=>(e,t)=>o(e,t,i);function Qt(i){return i.getLastTreeId()||0}const Tn=M.createIdentifier("engine-formula.dependency-generator");w.FormulaDependencyGenerator=class extends M.Disposable{constructor(e,t,r,n,s,a,u,c){super();A(this,"_updateRangeFlattenCache",new Map);A(this,"_dependencyRTreeCacheForAddressFunction",new M.RTree);A(this,"_executedAddressFunctionNodeIds",new Set);this._currentConfigService=e,this._runtimeService=t,this._otherFormulaManagerService=r,this._featureCalculationManagerService=n,this._interpreter=s,this._astTreeBuilder=a,this._lexer=u,this._dependencyManagerService=c}dispose(){this._updateRangeFlattenCache.clear(),this._dependencyRTreeCacheForAddressFunction.clear(),Tr.clear()}async generate(){this._updateRangeFlatten();const e=this._currentConfigService.getFormulaData(),t=this._otherFormulaManagerService.getOtherFormulaData(),r=this._currentConfigService.getClearDependencyTreeCache();r!=null&&Object.keys(r).forEach(f=>{f!=null&&Object.keys(r[f]).forEach(m=>{m!=null&&(this._dependencyManagerService.clearOtherFormulaDependency(f,m),this._dependencyManagerService.clearFeatureFormulaDependency(f,m),this._dependencyManagerService.clearFormulaDependency(f,m))})});const n=this._currentConfigService.getUnitData(),s=await this._generateTreeList(e,t,n),a=this._getUpdateTreeListAndMakeDependency(s);let u=this._calculateRunList(a);return this._dependencyFeatureCalculation(u)&&(u.forEach(f=>{f.resetState()}),u=this._calculateRunList(u)),this._checkIsCycleDependency(u)&&this._runtimeService.enableCycleDependency(),this._dependencyRTreeCacheForAddressFunction.clear(),this._runtimeService.clearArrayObjectCache(),Promise.resolve(u)}_dependencyFeatureCalculation(e){const t=this._featureCalculationManagerService.getReferenceExecutorMap();if(t.size===0)return;this._clearFeatureCalculationNode(e);let r=!1;return t.forEach((n,s)=>{n.forEach((a,u)=>{a.forEach((c,l)=>{const{unitId:f,subUnitId:m,getDirtyData:d}=c,C=d(this._currentConfigService.getDirtyData(),this._runtimeService.getAllRuntimeData()),_=this._convertDirtyRangesToUnitRange(C.dirtyRanges),E=this._intersectFeatureCalculation(_,e,{unitId:f,subUnitId:m,featureId:l});if(E.length>0){let R=this._getExistTreeList({unitId:f,subUnitId:m,featureId:l},e);R==null&&(R=this._getFeatureFormulaTree(l,Qt(this._dependencyManagerService),c),e.push(R)),R.parents=new Set,E.forEach(b=>{b.hasChildren(R.treeId)||b.pushChildren(R)}),r=!0}})})}),r}_clearFeatureCalculationNode(e){const t=this._featureCalculationManagerService.getReferenceExecutorMap();e.forEach(r=>{var a,u,c,l;const n=new Set;for(const f of r.children){const m=this._dependencyManagerService.getTreeById(f);m&&(m.featureId&&(u=(a=t.get(r.unitId))==null?void 0:a.get(r.subUnitId))!=null&&u.has(m.featureId)||n.add(f))}r.children=n;const s=new Set;for(const f of r.parents){const m=this._dependencyManagerService.getTreeById(f);m&&(m.featureId&&(l=(c=t.get(r.unitId))==null?void 0:c.get(r.subUnitId))!=null&&l.has(m.featureId)||s.add(f))}r.parents=s})}_convertDirtyRangesToUnitRange(e){const t=[];for(const r in e){const n=e[r];for(const s in n){const a=n[s];for(const u of a)t.push({unitId:r,sheetId:s,range:u})}}return t}_intersectFeatureCalculation(e,t,r){const n=[],s=this._dependencyManagerService.searchDependency(e);for(let a=0,u=t.length;a<u;a++){const c=t[a];if(c.unitId===r.unitId&&c.subUnitId===r.subUnitId&&c.featureId===r.featureId)continue;s.has(c.treeId)&&n.push(c)}return n}_getExistTreeList(e,t){const{unitId:r,subUnitId:n,featureId:s}=e;for(let a=0,u=t.length;a<u;a++){const c=t[a];if(c.unitId===r&&c.subUnitId===n&&c.featureId===s)return c}}_isCyclicUtil(e,t,r){const n=this._dependencyManagerService.getTreeById(e);if(n==null)return!1;if(!t.has(n.treeId)){t.add(n.treeId),r.add(n.treeId);for(const s of n.children)if(!t.has(s)&&this._isCyclicUtil(s,t,r)||r.has(s))return!0}return r.delete(n.treeId),!1}_checkIsCycleDependency(e){const t=new Set,r=new Set;for(let n=0,s=e.length;n<s;n++){const a=e[n];if(this._isCyclicUtil(a.treeId,t,r)===!0)return!0}return!1}async _generateTreeList(e,t,r){const n=Object.keys(e),s=Object.keys(t),a=[];this._currentConfigService.isForceCalculate()&&this._dependencyManagerService.reset(),this._registerFormulas(n,e,r,a),this._registerOtherFormulas(t,s,a),this._registerFeatureFormulas(a);for(let c=0,l=a.length;c<l;c++){const f=a[c];if(!f.formula)continue;const m=this._getTreeNode(f);f.isDirty=this._includeTree(f,m);const d=this._getAddressFunctionNodeList(m);if(d.length>0&&(f.addressFunctionNodes=d),f.isVirtual)continue;this._runtimeService.setCurrent(f.row,f.column,f.rowCount,f.columnCount,f.subUnitId,f.unitId);const C=await this._getRangeListByNode({node:m,refOffsetX:f.refOffsetX,refOffsetY:f.refOffsetY});f.pushRangeList(C)}for(let c=0,l=a.length;c<l;c++){const f=a[c];f.isCache||this._dependencyManagerService.addDependencyRTreeCache(f)}return await this._calculateListByFunctionRefNode(a),a}_registerFeatureFormulas(e){this._featureCalculationManagerService.getReferenceExecutorMap().forEach((r,n)=>{r.forEach((s,a)=>{s.forEach((u,c)=>{const l=this._dependencyManagerService.getFeatureFormulaDependency(u.unitId,u.subUnitId,c);e.push(this._getFeatureFormulaTree(c,l,u))})})})}_getFeatureFormulaTree(e,t,r){const{unitId:n,subUnitId:s,dependencyRanges:a,getDirtyData:u}=r,c=t||Qt(this._dependencyManagerService),l=new Un(c);l.unitId=n,l.subUnitId=s,l.rangeList=a,l.getDirtyData=u;const f=u(this._currentConfigService.getDirtyData(),this._runtimeService.getAllRuntimeData()),m=this._convertDirtyRangesToUnitRange(f.dirtyRanges);return l.featureDirtyRanges=m,l.featureId=e,l.type=xn.FEATURE_FORMULA,this._dependencyManagerService.addFeatureFormulaDependency(n,s,e,l),this._dependencyManagerService.getFeatureFormulaDependency(r.unitId,r.subUnitId,e)&&(l.isCache=!0),l}_registerOtherFormulas(e,t,r){for(const n of t){const s=e[n];if(s==null)continue;const a=Object.keys(s);for(const u of a){const c=s[u];if(c==null)continue;const l=Object.keys(c);for(const f of l){const m=this._dependencyManagerService.hasOtherFormulaDataMainData(f),d=c[f],{f:C,ranges:_}=d;let E=!1;m&&(E=!0);const R=ta(n,C,this._lexer,this._astTreeBuilder,this._currentConfigService),{firstRow:b,firstColumn:N}=this._getFirstCellOfRange(_),V=this._dependencyManagerService.getOtherFormulaDependency(n,u,f),S=(V==null?void 0:V.getValue(0,0))||Qt(this._dependencyManagerService),D=new Un(S);for(let L=0;L<_.length;L++){const P=_[L],{startRow:j,startColumn:I,endRow:v,endColumn:Y}=P;for(let Q=j;Q<=v;Q++)for(let se=I;se<=Y;se++){const te=se-N,W=Q-b;if(te===0&&W===0){D.node=R,D.formula=C,D.unitId=n,D.subUnitId=u,D.formulaId=f,D.type=xn.OTHER_FORMULA,D.isCache=E,r.push(D),this._dependencyManagerService.addOtherFormulaDependency(n,u,f,D),this._dependencyManagerService.addFormulaDependencyByDefinedName(D);continue}const fe=new oa;fe.treeId=(V==null?void 0:V.getValue(te,W))||Qt(this._dependencyManagerService),fe.refTree=D,fe.refOffsetX=te,fe.refOffsetY=W,fe.isCache=E,this._dependencyManagerService.addOtherFormulaDependency(n,u,f,fe),this._dependencyManagerService.addFormulaDependencyByDefinedName(fe),r.push(fe)}}this._dependencyManagerService.addOtherFormulaDependencyMainData(f)}}}}_getFirstCellOfRange(e){const t=e[0];return{firstRow:t.startRow,firstColumn:t.startColumn}}_registerFormulas(e,t,r,n){for(const s of e){const a=t[s];if(a==null)continue;const u=Object.keys(a);for(const c of u){const l=new M.ObjectMatrix(a[c]||{}),f=new Map;l.forValue((m,d,C)=>{if(C==null)return!0;const{x:_=0,y:E=0,si:R}=C;if(!(_===0&&E===0&&R!=null))return!0;const b=this._createFDtree(s,c,m,d,r,C),N=this._dependencyManagerService.getFormulaDependency(s,c,m,d);N!=null?(b.treeId=N,b.isCache=!0):(this._dependencyManagerService.addFormulaDependency(s,c,m,d,b),this._dependencyManagerService.addFormulaDependencyByDefinedName(b)),f.set(R,b),n.push(b)}),l.forValue((m,d,C)=>{if(C==null)return!0;const{x:_=0,y:E=0,si:R}=C;if(_===0&&E===0&&R!=null)return!0;let b;if(R&&f.has(R)){const V=f.get(R);b=this._createVirtualFDtree(V,C)}else b=this._createFDtree(s,c,m,d,r,C);const N=this._dependencyManagerService.getFormulaDependency(s,c,m,d);N!=null?(b.treeId=N,b.isCache=!0):(this._dependencyManagerService.addFormulaDependency(s,c,m,d,b),this._dependencyManagerService.addFormulaDependencyByDefinedName(b)),n.push(b)}),f.clear()}}}_createFDtree(e,t,r,n,s,a){const{f:u,x:c=0,y:l=0}=a,f=new Un(Qt(this._dependencyManagerService)),m=s[e][t],d=ta(e,u,this._lexer,this._astTreeBuilder,this._currentConfigService);return f.node=d,f.formula=u,f.unitId=e,f.subUnitId=t,f.row=r,f.column=n,f.rowCount=m.rowCount,f.columnCount=m.columnCount,f}_createVirtualFDtree(e,t){const{x:r=0,y:n=0}=t,s=new oa;return s.treeId=Qt(this._dependencyManagerService),s.refTree=e,s.refOffsetX=r,s.refOffsetY=n,s}_updateRangeFlatten(){const e=this._currentConfigService.isForceCalculate(),t=this._currentConfigService.getDirtyRanges();if(!e){this._updateRangeFlattenCache.clear();for(let r=0;r<t.length;r++){const n=t[r],s=n.range,a=n.sheetId,u=n.unitId;this._addFlattenCache(u,a,s)}}}_addFlattenCache(e,t,r){let n=this._updateRangeFlattenCache.get(e);n==null&&(n=new Map,this._updateRangeFlattenCache.set(e,n));let s=n.get(t);s==null&&(s=[],n.set(t,s)),s.push(r)}_isPreCalculateNode(e){return e.nodeType===ue.UNION||e.nodeType===ue.PREFIX&&e.getToken()===Me.AT||e.nodeType===ue.SUFFIX&&e.getToken()===Ke.POUND}_nodeTraversalRef(e,t){const r=e.getChildren(),n=r.length;for(let s=0;s<n;s++){const a=r[s];if(this._isPreCalculateNode(a)){if(t.push(a),a.nodeType===ue.UNION)for(const u of a.getChildren())u.nodeType===ue.FUNCTION&&u.isAddress()&&this._nodeTraversalRef(u,t);continue}else a.nodeType===ue.REFERENCE&&t.push(a);this._nodeTraversalRef(a,t)}}_nodeTraversalReferenceFunction(e,t){const r=e.getChildren(),n=r.length;for(let s=0;s<n;s++){const a=r[s];if(a.nodeType===ue.FUNCTION&&a.isAddress()){t.push(a);continue}this._nodeTraversalReferenceFunction(a,t)}}async _executeNode(e,t=0,r=0){let n;const s={node:e,refOffsetX:t,refOffsetY:r};return this._interpreter.checkAsyncNode(e)?n=await this._interpreter.executeAsync(s):n=this._interpreter.execute(s),n}async _getRangeListByNode(e){const t=[],r=e.refOffsetX,n=e.refOffsetY,s=e.node;if(s==null)return[];this._nodeTraversalRef(s,t);const a=[];for(let u=0,c=t.length;u<c;u++){const l=t[u],m=(await this._executeNode(l,r,n)).toUnitRange();a.push(m),l.setValue(null)}return a}_getAddressFunctionNodeList(e){const t=[];return e==null?[]:(this._nodeTraversalReferenceFunction(e,t),t)}_getTreeNode(e){return e.node}async _buildDirtyRangesByAddressFunction(e,t){const r=t.addressFunctionNodes;if(r.length===0)return;const n=t.refOffsetX,s=t.refOffsetY,a=await this._getRangeListByFunctionRefNode(r,n,s);t.addressFunctionNodes=[],this._addDependencyTreeByAddressFunction(t,a);const u=e.bulkSearch(a),c=this._buildTreeNodeById(u);c.length!==0&&await this._calculateAddressFunctionRuntimeData(e,c)}async _calculateListByFunctionRefNode(e){const t=new M.RTree;for(let r=0,n=e.length;r<n;r++){const s=e[r];t.insert({unitId:s.unitId,sheetId:s.subUnitId,range:{startRow:s.row,startColumn:s.column,endRow:s.row,endColumn:s.column},id:s.treeId})}this._executedAddressFunctionNodeIds.clear();for(let r=0,n=e.length;r<n;r++){const s=e[r];await this._calculateAddressFunction(t,s)}}async _calculateAddressFunction(e,t){const r=t.addressFunctionNodes;if(r.length===0)return;const n=t.refOffsetX,s=t.refOffsetY;this._runtimeService.setCurrent(t.row,t.column,t.rowCount,t.columnCount,t.subUnitId,t.unitId);const a=[];for(let l=0,f=r.length;l<f;l++){const m=await this._getRangeListByNode({node:r[l],refOffsetX:n,refOffsetY:s});a.push(...m)}const u=new Set;this._searchDependencyByAddressFunction(e,a,u);const c=this._buildTreeNodeById(u);if(c.length===0){await this._buildDirtyRangesByAddressFunction(e,t);return}await this._calculateAddressFunctionRuntimeData(e,c),await this._buildDirtyRangesByAddressFunction(e,t)}async _calculateAddressFunctionRuntimeData(e,t){for(;t.length>0;){const r=t.pop(),s={node:this._getTreeNode(r),refOffsetX:r.refOffsetX,refOffsetY:r.refOffsetY};await this._calculateAddressFunction(e,r),this._runtimeService.setCurrent(r.row,r.column,r.rowCount,r.columnCount,r.subUnitId,r.unitId);let a;this._interpreter.checkAsyncNode(s.node)?a=await this._interpreter.executeAsync(s):a=this._interpreter.execute(s),r.formulaId!=null?this._runtimeService.setRuntimeOtherData(r.formulaId,r.refOffsetX,r.refOffsetY,a):this._runtimeService.setRuntimeData(a)}}_buildTreeNodeById(e){const t=[];for(const r of e){const n=this._getTreeById(r);!n||this._executedAddressFunctionNodeIds.has(r)||(this._executedAddressFunctionNodeIds.add(r),t.push(n))}return t}_searchDependencyByAddressFunction(e,t,r){const n=e.bulkSearch(t),s=this._dependencyRTreeCacheForAddressFunction.bulkSearch(t);for(const u of s)r.has(u)||r.add(u);const a=[];for(const u of n){const c=this._getTreeById(u);c&&!r.has(u)&&(a.push(...c.rangeList),r.add(u))}return a.length>0&&this._searchDependencyByAddressFunction(e,a,r),r}_getTreeById(e){return this._dependencyManagerService.getTreeById(e)}_addDependencyTreeByAddressFunction(e,t){const r=[];for(let n=0;n<t.length;n++){const s=t[n],{unitId:a,sheetId:u,range:c}=s;r.push({unitId:a,sheetId:u,range:c,id:e.treeId})}this._dependencyRTreeCacheForAddressFunction.bulkInsert(r)}async _getRangeListByFunctionRefNode(e,t,r){const n=[];for(let s=0,a=e.length;s<a;s++){const u=e[s],l=(await this._executeNode(u,t,r)).toUnitRange();n.push(l),u.setValue(null)}return n}_getUpdateTreeListAndMakeDependency(e){const t=[],r=new Set,n=this._currentConfigService.isForceCalculate(),s=this._currentConfigService.getDirtyRanges(),a=this._dependencyManagerService.searchDependency(s),u=this._dependencyRTreeCacheForAddressFunction.bulkSearch(s);for(const l of u)a.add(l);const c=this._dependencyManagerService.buildDependencyTree(e);for(const l of c){const f=l.treeId;(n||l.isDirty||l.dependencySheetName(this._currentConfigService.getDirtyNameMap())||a.has(f)&&!l.isExcludeRange(this._currentConfigService.getExcludedRange()))&&!r.has(f)&&(t.push(l),r.add(f))}return t}_includeTreeFeature(e){var s,a;const t=e.unitId,r=e.subUnitId,n=e.featureId;if(n!=null){const u=this._currentConfigService.getDirtyUnitFeatureMap();if(((a=(s=u==null?void 0:u[t])==null?void 0:s[r])==null?void 0:a[n])!=null)return!0}return!1}_includeOtherFormula(e){var s,a;const t=e.unitId,r=e.subUnitId,n=e.formulaId;if(n!=null){const u=this._currentConfigService.getDirtyUnitOtherFormulaMap();if(((a=(s=u==null?void 0:u[t])==null?void 0:s[r])==null?void 0:a[n])!=null)return!0}return!1}_detectForcedRecalculationNode(e,t){return t==null?!1:this._detectForcedRecalculationNodeRecursion(t)}_detectForcedRecalculationNodeRecursion(e){if(e.isForcedCalculateFunction())return!0;const t=e.getChildren();for(let r=0,n=t.length;r<n;r++){const s=t[r];if(this._detectForcedRecalculationNodeRecursion(s))return!0}return!1}_includeTree(e,t){var l,f,m;const r=e.unitId,n=e.subUnitId;if(this._detectForcedRecalculationNode(e,t)===!0||this._includeTreeFeature(e)===!0||this._includeOtherFormula(e)===!0||im(e,t,this._currentConfigService)===!0)return!0;const s=(f=(l=this._currentConfigService.getExcludedRange())==null?void 0:l[r])==null?void 0:f[n];if((s==null?void 0:s.getValue(e.row,e.column))!=null)return!1;if(((m=this._currentConfigService.getDirtyNameMap()[r])==null?void 0:m[n])!=null)return!0;if(!this._updateRangeFlattenCache.has(r))return!1;const u=this._updateRangeFlattenCache.get(r);if(!u.has(n))return!1;const c=u.get(n);for(const d of c)if(e.inRangeData(d))return!0;return!1}_calculateRunList(e){e.length;const t=e,r=[],n=[];for(;t.length>0;){const s=t.pop();if(s===void 0||s.isSkip())continue;if(s.isAdded()){r.push(s),s.setSkip();continue}n.length=0;for(const u of s.parents){const c=this._dependencyManagerService.getTreeById(u);if(!c)throw new Error("ParentDependencyTree object is null");c.isAdded()||s.isSkip()||n.push(c)}const a=this._dependencyRTreeCacheForAddressFunction.bulkSearch(s.toRTreeItem());for(const u of a){const c=this._dependencyManagerService.getTreeById(u);if(!c)throw new Error("ParentDependencyTree object is null");c.isAdded()||s.isSkip()||n.push(c)}n.length===0?(r.push(s),s.setSkip()):(s.setAdded(),t.push(s,...n))}return r}},w.FormulaDependencyGenerator=Fm([Tt(0,Nt),Tt(1,it),Tt(2,jn),Tt(3,dr),Tt(4,M.Inject(w.Interpreter)),Tt(5,M.Inject(w.AstTreeBuilder)),Tt(6,M.Inject(w.Lexer)),Tt(7,vr)],w.FormulaDependencyGenerator);var Bm=Object.getOwnPropertyDescriptor,km=(i,o,e,t)=>{for(var r=t>1?void 0:t?Bm(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},qt=(i,o)=>(e,t)=>o(e,t,i);const Ao=500,vn=M.createIdentifier("engine-formula.calculate-formula.service");w.CalculateFormulaService=class extends M.Disposable{constructor(e,t,r,n,s,a,u){super();A(this,"_executionInProgressListener$",new we.Subject);A(this,"executionInProgressListener$",this._executionInProgressListener$.asObservable());A(this,"_executionCompleteListener$",new we.Subject);A(this,"executionCompleteListener$",this._executionCompleteListener$.asObservable());A(this,"_executeLock",new M.AsyncLock);this._configService=e,this._lexer=t,this._currentConfigService=r,this._runtimeService=n,this._formulaDependencyGenerator=s,this._interpreter=a,this._astTreeBuilder=u}dispose(){super.dispose(),this._executionInProgressListener$.complete(),this._executionCompleteListener$.complete(),mr.clear(),Ge.clear(),Is.clear(),Ws.clear()}stopFormulaExecution(){this._runtimeService.stopExecution()}setRuntimeFeatureCellData(e,t){this._runtimeService.setRuntimeFeatureCellData(e,t)}setRuntimeFeatureRange(e,t){this._runtimeService.setRuntimeFeatureRange(e,t)}async execute(e){this._runtimeService.setFormulaExecuteStage(qe.START),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState()),this._currentConfigService.load(e),this._runtimeService.reset();const t=e.maxIteration||Oi;this._executeLock.acquire("FORMULA_EXECUTION_LOCK",async()=>{for(let r=0;r<t&&(this._runtimeService.setFormulaCycleIndex(r),await this._executeStep(),mr.clear(),!!this._runtimeService.isCycleDependency());r++);this._runtimeService.setFormulaExecuteStage(qe.CALCULATION_COMPLETED),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState()),this._executionCompleteListener$.next(this._runtimeService.getAllRuntimeData()),Ge.clear(),this._runtimeService.reset()})}async _executeStep(){const e=await this._apply();if(e==null)return;const{arrayFormulaRange:t,runtimeFeatureRange:r}=e,{dirtyRanges:n,excludedCell:s}=this._getArrayFormulaDirtyRangeAndExcludedRange(t,r);return n==null||n.length===0||(mr.clear(),this._currentConfigService.loadDirtyRangesAndExcludedCell(n,s),await this._apply(!0)),!0}_getArrayFormulaDirtyRangeAndExcludedRange(e,t){const r=[],n={};return Object.keys(e).forEach(s=>{const a=e[s];if(a==null)return!0;Object.keys(a).forEach(u=>{const c=new M.ObjectMatrix(a[u]);if(c==null)return!0;const l=new M.ObjectMatrix;c.forValue((f,m,d)=>{l.setValue(f,m,!0),r.push({unitId:s,sheetId:u,range:d})}),n[s]==null&&(n[s]={}),n[s][u]=l})}),Object.keys(t).forEach(s=>{const a=t[s];Object.keys(a).forEach(u=>{const c=a[u];if(c==null)return!0;Object.keys(c).forEach(l=>{const f=c[l];if(f==null)return!0;for(const m of f)r.push({unitId:u,sheetId:l,range:m})})})}),{dirtyRanges:r,excludedCell:n}}async _apply(e=!1){var c;e?this._runtimeService.setFormulaExecuteStage(qe.START_DEPENDENCY_ARRAY_FORMULA):this._runtimeService.setFormulaExecuteStage(qe.START_DEPENDENCY),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState());const t=(await this._formulaDependencyGenerator.generate()).reverse(),r=this._interpreter;e?(this._runtimeService.setFormulaExecuteStage(qe.START_CALCULATION_ARRAY_FORMULA),this._runtimeService.setTotalArrayFormulasToCalculate(t.length)):(this._runtimeService.setFormulaExecuteStage(qe.START_CALCULATION),this._runtimeService.setTotalFormulasToCalculate(t.length)),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState());let n=[];const s=this._configService.getConfig(fn),a=(s==null?void 0:s.intervalCount)||Ao,u=t.length;for(let l=0;l<u;l++){const f=t[l],m=f.nodeData,d=f.getDirtyData;if(l%a===0&&(await new Promise(_=>{const E=M.requestImmediateMacroTask(_);n.push(E)}),e?(this._runtimeService.setFormulaExecuteStage(qe.CURRENTLY_CALCULATING_ARRAY_FORMULA),this._runtimeService.setCompletedArrayFormulasCount(l+1)):(this._runtimeService.setFormulaExecuteStage(qe.CURRENTLY_CALCULATING),this._runtimeService.setCompletedFormulasCount(l+1)),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState()),this._runtimeService.isStopExecution()||m==null&&d==null)){this._runtimeService.setFormulaExecuteStage(qe.IDLE),this._runtimeService.markedAsStopFunctionsExecuted(),this._executionCompleteListener$.next(this._runtimeService.getAllRuntimeData());return}this._runtimeService.setCurrent(f.row,f.column,f.rowCount,f.columnCount,f.subUnitId,f.unitId);let C;if(d!=null&&f.featureId!=null){const{runtimeCellData:_,dirtyRanges:E}=d(this._currentConfigService.getDirtyData(),this._runtimeService.getAllRuntimeData());this._runtimeService.setRuntimeFeatureCellData(f.featureId,_),this._runtimeService.setRuntimeFeatureRange(f.featureId,E)}else m!=null&&(r.checkAsyncNode(m.node)?C=await r.executeAsync(m):C=r.execute(m),f.formulaId!=null?this._runtimeService.setRuntimeOtherData(f.formulaId,f.refOffsetX,f.refOffsetY,C):this._runtimeService.setRuntimeData(C));(c=m.node)==null||c.resetCalculationState()}return n.forEach(l=>l()),n=[],u>0?this._runtimeService.markedAsSuccessfullyExecuted():e||this._runtimeService.markedAsNoFunctionsExecuted(),this._runtimeService.getAllRuntimeData()}calculate(e,t=!0){const r=this._lexer.treeBuilder(e,t);if(Object.values(h).includes(r))return je.create(r);const n=this._astTreeBuilder.parse(r);n==null||n.serialize()}},w.CalculateFormulaService=km([qt(0,M.IConfigService),qt(1,M.Inject(w.Lexer)),qt(2,Nt),qt(3,it),qt(4,Tn),qt(5,M.Inject(w.Interpreter)),qt(6,M.Inject(w.AstTreeBuilder))],w.CalculateFormulaService);var $m=Object.getOwnPropertyDescriptor,Ym=(i,o,e,t)=>{for(var r=t>1?void 0:t?$m(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},ua=(i,o)=>(e,t)=>o(e,t,i);w.CalculateController=class extends M.Disposable{constructor(o,e,t){super(),this._commandService=o,this._calculateFormulaService=e,this._formulaDataModel=t,this._initialize()}_initialize(){this._commandExecutedListener(),this._initialExecuteFormulaListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(o=>{if(o.id===As.id)this._calculateFormulaService.stopFormulaExecution();else if(o.id===_s.id)this._calculate(o.params);else if(o.id===Jr.id){const e=o.params;if(e==null)return;const{arrayFormulaRange:t,arrayFormulaCellData:r}=e;this._formulaDataModel.setArrayFormulaRange(t),this._formulaDataModel.setArrayFormulaCellData(r)}}))}async _calculate(o){const{forceCalculation:e=!1,dirtyRanges:t=[],dirtyNameMap:r={},dirtyDefinedNameMap:n={},dirtyUnitFeatureMap:s={},dirtyUnitOtherFormulaMap:a={},clearDependencyTreeCache:u={},maxIteration:c=Oi,rowData:l}=o,f=this._formulaDataModel.getFormulaData(),m=this._formulaDataModel.getArrayFormulaCellData(),d=this._formulaDataModel.getArrayFormulaRange();this._calculateFormulaService.execute({formulaData:f,arrayFormulaCellData:m,arrayFormulaRange:d,forceCalculate:e,dirtyRanges:t,dirtyNameMap:r,dirtyDefinedNameMap:n,dirtyUnitFeatureMap:s,dirtyUnitOtherFormulaMap:a,clearDependencyTreeCache:u,maxIteration:c,rowData:l})}_initialExecuteFormulaListener(){this._calculateFormulaService.executionCompleteListener$.subscribe(o=>{const e=o.functionsExecutedState;switch(e){case hr.NOT_EXECUTED:break;case hr.STOP_EXECUTION:break;case hr.SUCCESS:this._applyResult(o);break;case hr.INITIAL:break}this._commandService.executeCommand(Mr.id,{functionsExecutedState:e},{onlyLocal:!0})}),this._calculateFormulaService.executionInProgressListener$.subscribe(o=>{this._commandService.executeCommand(Mr.id,{stageInfo:o},{onlyLocal:!0})})}async _applyResult(o){const{unitData:e,unitOtherData:t,arrayFormulaRange:r,arrayFormulaCellData:n,clearArrayFormulaCellData:s,arrayFormulaEmbedded:a,imageFormulaData:u}=o;if(!e){console.error("No sheetData from Formula Engine!");return}(r||a)&&(this._formulaDataModel.clearPreviousArrayFormulaCellData(s),this._formulaDataModel.mergeArrayFormulaCellData(n),this._formulaDataModel.mergeArrayFormulaRange(r),this._commandService.executeCommand(Jr.id,{arrayFormulaRange:this._formulaDataModel.getArrayFormulaRange(),arrayFormulaCellData:this._formulaDataModel.getArrayFormulaCellData(),arrayFormulaEmbedded:a},{onlyLocal:!0})),u&&u.length>0&&this._commandService.executeCommand(bs.id,{imageFormulaData:u},{onlyLocal:!0}),this._commandService.executeCommand(Es.id,{unitData:qc(e),unitOtherData:t},{onlyLocal:!0})}},w.CalculateController=Ym([ua(0,M.ICommandService),ua(1,vn),ua(2,M.Inject(w.FormulaDataModel))],w.CalculateController);const Eo=/[\[\]]/g;function Ro(i,o){if(Eo.test(i)){const e=Number(i.replace(Eo,""));return o+e}return Number(i)-1}function ca(i,o=0,e=0){i=i.toLocaleUpperCase();const t=i.split(/[RC]/),r=t[1],n=t[2],s=Ro(r,o),a=Ro(n,e);return{row:s,column:a,absoluteRefType:M.AbsoluteRefType.NONE}}function bo(i,o=0,e=0){const{refBody:t,sheetName:r,unitId:n}=rn(i),s=t.indexOf(":");if(s===-1){const _=ca(t,o,e),E=_.row,R=_.column,b=_.absoluteRefType;return{unitId:n,sheetName:r,range:{startRow:E,startColumn:R,endRow:E,endColumn:R,startAbsoluteRefType:b,endAbsoluteRefType:b}}}const a=t.substring(0,s),u=t.substring(s+1),c=ca(a,o,e),l=ca(u,o,e),f=c.row,m=c.column,d=l.row,C=l.column;return{unitId:n,sheetName:r,range:{startRow:f,startColumn:m,endRow:d,endColumn:C,startAbsoluteRefType:c.absoluteRefType,endAbsoluteRefType:l.absoluteRefType}}}function Hm(i){const o=In(i.startRow,i.startAbsoluteRefType,!0),e=In(i.startColumn,i.startAbsoluteRefType,!1),t=In(i.endRow,i.endAbsoluteRefType,!0),r=In(i.endColumn,i.endAbsoluteRefType,!1);return o===t&&e===r?`R${o}C${e}`:`R${o}C${e}:R${t}C${r}`}function In(i,o=M.AbsoluteRefType.ALL,e){switch(i+=1,o){case M.AbsoluteRefType.ALL:return`${i}`;case M.AbsoluteRefType.ROW:return e?`${i}`:`[${i}]`;case M.AbsoluteRefType.COLUMN:return e?`[${i}]`:`${i}`;case M.AbsoluteRefType.NONE:return`[${i}]`}}function Xt(i){let o=i;if(i.isArray()){const e=i.getRowCount(),t=i.getColumnCount();if(e>1||t>1)return g.create(h.VALUE);o=i.get(0,0)}return o.isError(),o}function Ir(...i){for(let o=0;o<i.length;o++){const e=Xt(i[o]);if(e.isError())return{isError:!0,errorObject:e};i[o]=e}return{isError:!1,variants:i}}function q(...i){for(let o=0;o<i.length;o++){const e=Xt(i[o]);if(e.isError())return{isError:!0,errorObject:e};if(e.isBoolean())return{isError:!0,errorObject:g.create(h.VALUE)};i[o]=e}return{isError:!1,variants:i}}function Fe(...i){for(let o=0;o<i.length;o++){let e=i[o];if(e.isError())return{isError:!0,errorObject:e};if(e.isNull())return{isError:!0,errorObject:g.create(h.NA)};if(e=Xt(i[o]),e.isError())return{isError:!0,errorObject:e};if(e.isBoolean())return{isError:!0,errorObject:g.create(h.VALUE)};i[o]=e}return{isError:!1,variants:i}}function B(...i){for(let o=0;o<i.length;o++){let e=i[o];if(e.isString()&&(e=e.convertToNumberObjectValue()),e.isError())return{isError:!0,errorObject:e};i[o]=e}return{isError:!1,variants:i}}class p{constructor(o){A(this,"_unitId");A(this,"_subUnitId");A(this,"_row",-1);A(this,"_column",-1);A(this,"_definedNames");A(this,"_locale");A(this,"_sheetOrder");A(this,"_sheetNameMap");A(this,"_formulaDataModel");A(this,"_rowCount",-1);A(this,"_columnCount",-1);A(this,"needsExpandParams",!1);A(this,"needsReferenceObject",!1);A(this,"needsLocale",!1);A(this,"needsSheetsInfo",!1);A(this,"needsFormulaDataModel",!1);A(this,"needsSheetRowColumnCount",!1);A(this,"needsFilteredOutRows",!1);A(this,"minParams",-1);A(this,"maxParams",-1);this._name=o}get name(){return this._name}get unitId(){return this._unitId}get subUnitId(){return this._subUnitId}get row(){return this._row}get column(){return this._column}dispose(){}getDefinedName(o){var t;const e=this._definedNames;return e==null?null:(t=Array.from(Object.values(e)).filter(r=>r.name===o))==null?void 0:t[0]}setDefinedNames(o){this._definedNames=o}getLocale(){return this._locale}setLocale(o){this._locale=o}getSheetsInfo(){return{sheetOrder:this._sheetOrder,sheetNameMap:this._sheetNameMap}}setSheetsInfo({sheetOrder:o,sheetNameMap:e}){this._sheetOrder=o,this._sheetNameMap=e}setFormulaDataModel(o){this._formulaDataModel=o}setSheetRowColumnCount(o,e){this._rowCount=o,this._columnCount=e}isAsync(){return!1}isAddress(){return!1}isCustom(){return!1}isArgumentsIgnoreNumberPattern(){return!1}setRefInfo(o,e,t,r){this._unitId=o,this._subUnitId=e,this._row=t,this._column=r}calculateCustom(...o){return null}calculate(...o){return g.create(h.VALUE)}checkArrayType(o){return o.isReferenceObject()||o.isValueObject()&&o.isArray()}getIndexNumValue(o,e=1){let t=o;if(t.isArray()&&(t=t.getFirstCell()),t.isBoolean())return t.getValue()===!1?g.create(h.VALUE):e;if(t.isString()){const r=Number(t.getValue());return Number.isNaN(r)?g.create(h.REF):r}else if(t.isNumber())return t.getValue();return g.create(h.VALUE)}getZeroOrOneByOneDefault(o){if(o==null)return 1;let e=1;if(o.isArray()&&(o=o.getFirstCell()),o.isBoolean())o.getValue()===!1&&(e=0);else{if(o.isString())return;o.isNumber()&&o.getValue()===0&&(e=0)}return e}getMatchTypeValue(o){if(o==null)return 1;let e=1;if(o.isArray()&&(o=o.getFirstCell()),o.isBoolean())o.getValue()===!1&&(e=0);else{if(o.isString())return;if(o.isNumber()){const t=o.getValue();t<=0&&(e=t)}}return e}binarySearch(o,e,t,r,n){const s=e.binarySearch(o,r,n);if(s==null)return g.create(h.NA);let a;return t.getRowCount()===1?a=t.get(0,s)||le.create():a=t.get(s,0)||le.create(),a.isNull()?y.create(0):a}_getOneFirstByRaw(o){return o.length===0?g.create(h.NA):o[0][0]||g.create(h.NA)}_getOneLastByRaw(o){return o.length===0?g.create(h.NA):o[o.length-1][o[0].length-1]||g.create(h.NA)}equalSearch(o,e,t,r=!0){const n=t.pickRaw(e.isEqual(o));return r?this._getOneFirstByRaw(n):this._getOneLastByRaw(n)}fuzzySearch(o,e,t,r=!0){const n=t.pickRaw(e.compare(o,H.EQUALS));return r?this._getOneFirstByRaw(n):this._getOneLastByRaw(n)}orderSearch(o,e,t,r=Le.MIN,n=!1){const s=e.orderSearch(o,r,n);if(s==null)return g.create(h.NA);const a=t.get(s.row,s.column)||le.create();return a.isNull()?g.create(h.NA):a}binarySearchExpand(o,e,t,r=0,n,s){const a=e.binarySearch(o,n,s);return a==null?g.create(h.NA):r===0?t.slice([a,a+1]):t.slice(void 0,[a,a+1])}equalSearchExpand(o,e,t,r=!0,n=0){const s=e.isEqual(o);let a;return r?a=s.getFirstTruePosition():a=s.getLastTruePosition(),a==null?g.create(h.NA):n===0?t.slice([a.row,a.row+1]):t.slice(void 0,[a.column,a.column+1])}fuzzySearchExpand(o,e,t,r=!0,n=0){const s=e.compare(o,H.EQUALS);let a;return r?a=s.getFirstTruePosition():a=s.getLastTruePosition(),a==null?g.create(h.NA):n===0?t.slice([a.row,a.row+1]):t.slice(void 0,[a.column,a.column+1])}orderSearchExpand(o,e,t,r=Le.MIN,n=!1,s=0){const a=e.orderSearch(o,r,n);return a==null?g.create(h.NA):s===0?t.slice([a.row,a.row+1]):t.slice(void 0,[a.column,a.column+1])}flattenArray(o,e=!0){const t=[];t[0]=[];for(let r=0;r<o.length;r++){let n=o[r];if((n.isString()||n.isBoolean()||n.isNull())&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(n.isArray()){let s;if(n.iterator(a=>{if(a==null||a.isNull()||e&&(a.isString()||a.isBoolean()))return!0;if(a=this._includingLogicalValuesAndText(a),a.isError())return s=a,!1;t[0].push(a)}),s!=null&&s.isError())return s}else t[0].push(n)}return at(t,1,t[0].length)}_includingLogicalValuesAndText(o){if(o.isBoolean()&&(o=qf(o)),o.isString()){const e=Number(o.getValue());o=y.create(Number.isNaN(e)?0:e)}return o}createReferenceObject(o,e){const t=o.getForcedUnitId()||o.getDefaultUnitId()||"",r=o.getForcedSheetId()||o.getDefaultUnitId()||"",n=o.getForcedSheetName(),a=en({unitId:t,sheetName:n,range:e});let u;return pr(a)?u=new Qs(a):ci(a)?u=new Xs(a):li(a)?u=new qs(a):u=new Pr(e,r,t),this._setReferenceDefault(o,u)}_setReferenceDefault(o,e){if(this.unitId==null||this.subUnitId==null)return g.create(h.REF);e.setDefaultUnitId(this.unitId),e.setDefaultSheetId(this.subUnitId);const t=o.getUnitId();t!=null&&e.setForcedUnitIdDirect(t);const r=o.getForcedSheetId();return r!=null&&e.setForcedSheetIdDirect(r),e.setForcedSheetName(o.getForcedSheetName()),e.setUnitData(o.getUnitData()),e.setRuntimeData(o.getRuntimeData()),e.setArrayFormulaCellData(o.getArrayFormulaCellData()),e.setUnitStylesData(o.getUnitStylesData()),e}}class Gm extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){if(e.isError())return e;const{isError:n,errorObject:s,variants:a}=Ir(t,r);if(n)return s;const{isError:u,errorObject:c,variants:l}=B(...a);if(u)return c;const[f,m]=l,d=Math.floor(+f.getValue()),C=Math.floor(+m.getValue());if(d<0||C<0)return g.create(h.NUM);if(d===0||C===0)return g.create(h.REF);const _=e.isArray()?e.getRowCount():1,E=e.isArray()?e.getColumnCount():1;if(_===1&&E===1)return e.isArray()?e.get(0,0):e;const R=d>_?_:d,b=C>E?E:C;return e.slice([0,R],[0,b])}}class Wm extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=[];for(let r=0;r<e.length;r++){const n=e[r],s=n.isArray()?n.getRowCount():1,a=n.isArray()?n.getColumnCount():1;for(let u=0;u<s;u++)for(let c=0;c<a;c++){const l=n.isArray()?n.get(u,c):n;t.push([l])}}return Z.create({calculateValueList:t,rowCount:t.length,columnCount:1,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}var Fn=(i=>(i.ARRAY_CONSTRAIN="ARRAY_CONSTRAIN",i.FLATTEN="FLATTEN",i))(Fn||{});const yo=[[Gm,Fn.ARRAY_CONSTRAIN],[Wm,Fn.FLATTEN]];var Cr;(i=>{const o=.636619772;function e(n,s){let a=0;for(let u=0;u<n.length;++u)a=s*a+n[u];return a}function t(n,s,a,u,c){if(s===0)return a;if(s===1)return u;const l=2/n;let f=a,m=u,d=u;for(let C=1;C<s;++C)d=m*C*l+c*f,f=m,m=d;return d}function r(n,s,a,u){return function(l,f){if(a){if(l===0)return a===1?-1/0:1/0;if(l<0)return Number.NaN}if(f===0)return n(l);if(f===1)return s(l);if(f<0)return Number.NaN;const m=f|0,d=n(l),C=s(l);return t(l,m,d,C,u)}}i.besselj=(()=>{const n=[-184.9052456,77392.33017,-1121442418e-2,6516196407e-1,-13362590354,57568490574],s=[1,267.8532712,59272.64853,9494680718e-3,1029532985,57568490411],a=[2093887211e-16,-2073370639e-15,2734510407e-14,-.001098628627,1],u=[-934935152e-16,7621095161e-16,-6911147651e-15,.0001430488765,-.01562499995];function c(_){let E=0,R=0,b=0,N=_*_;if(_<8)R=e(n,N),b=e(s,N),E=R/b;else{const V=_-.785398164;N=64/N,R=e(a,N),b=e(u,N),E=Math.sqrt(o/_)*(Math.cos(V)*R-Math.sin(V)*b*8/_)}return E}const l=[-30.16036606,15704.4826,-2972611439e-3,2423968531e-1,-7895059235,72362614232],f=[1,376.9991397,99447.43394,1858330474e-2,2300535178,144725228442],m=[-240337019e-15,2457520174e-15,-3516396496e-14,.00183105,1],d=[105787412e-15,-88228987e-14,8449199096e-15,-.0002002690873,.04687499995];function C(_){let E=0,R=0,b=0,N=_*_;const V=Math.abs(_)-2.356194491;return Math.abs(_)<8?(R=_*e(l,N),b=e(f,N),E=R/b):(N=64/N,R=e(m,N),b=e(d,N),E=Math.sqrt(o/Math.abs(_))*(Math.cos(V)*R-Math.sin(V)*b*8/Math.abs(_)),_<0&&(E=-E)),E}return function _(E,R){const b=Math.round(R);if(!Number.isFinite(E))return Number.isNaN(E)?E:0;if(b<0)return(b%2?-1:1)*_(E,-b);if(E<0)return(b%2?-1:1)*_(-E,b);if(b===0)return c(E);if(b===1)return C(E);if(E===0)return 0;let N=0;if(E>b)N=t(E,b,c(E),C(E),-1);else{const V=2*Math.floor((b+Math.floor(Math.sqrt(40*b)))/2);let S=!1,D=0,L=0,P=1,j=0;const I=2/E;for(let v=V;v>0;v--)if(j=v*I*P-D,D=P,P=j,Math.abs(P)>1e10&&(P*=1e-10,D*=1e-10,N*=1e-10,L*=1e-10),S&&(L+=P),S=!S,v===b&&(N=D),V-v>100&&N===0)return Number.NaN;L=2*L-P,N/=L}return N}})(),i.bessely=(()=>{const n=[228.4622733,-86327.92757,1087988129e-2,-5123598036e-1,7062834065,-2957821389],s=[1,226.1030244,47447.2647,7189466438e-3,7452499648e-1,40076544269],a=[2093887211e-16,-2073370639e-15,2734510407e-14,-.001098628627,1],u=[-934945152e-16,7621095161e-16,-6911147651e-15,.0001430488765,-.01562499995];function c(_){let E=0,R=0,b=0,N=_*_;const V=_-.785398164;return _<8?(R=e(n,N),b=e(s,N),E=R/b+o*(0,i.besselj)(_,0)*Math.log(_)):(N=64/N,R=e(a,N),b=e(u,N),E=Math.sqrt(o/_)*(Math.sin(V)*R+Math.cos(V)*b*8/_)),E}const l=[8511.937935,-4237922726e-3,7349264551e-1,-51534381390,127527439e4,-4900604943e3],f=[1,354.9632885,102042.605,2245904002e-2,3733650367,424441966400,249958057e5],m=[-240337019e-15,2457520174e-15,-3516396496e-14,.00183105,1],d=[105787412e-15,-88228987e-14,8449199096e-15,-.0002002690873,.04687499995];function C(_){let E=0,R=0,b=0,N=_*_;const V=_-2.356194491;return _<8?(R=_*e(l,N),b=e(f,N),E=R/b+o*((0,i.besselj)(_,1)*Math.log(_)-1/_)):(N=64/N,R=e(m,N),b=e(d,N),E=Math.sqrt(o/_)*(Math.sin(V)*R+Math.cos(V)*b*8/_)),E}return r(c,C,1,-1)})(),i.besseli=(()=>{const n=[.0045813,.0360768,.2659732,1.2067492,3.0899424,3.5156229,1],s=[.00392377,-.01647633,.02635537,-.02057706,.00916281,-.00157565,.00225319,.01328592,.39894228];function a(f){return f<=3.75?e(n,f*f/(3.75*3.75)):Math.exp(Math.abs(f))/Math.sqrt(Math.abs(f))*e(s,3.75/Math.abs(f))}const u=[32411e-8,.00301532,.02658733,.15084934,.51498869,.87890594,.5],c=[-.00420059,.01787654,-.02895312,.02282967,-.01031555,.00163801,-.00362018,-.03988024,.39894228];function l(f){return f<3.75?f*e(u,f*f/(3.75*3.75)):(f<0?-1:1)*Math.exp(Math.abs(f))/Math.sqrt(Math.abs(f))*e(c,3.75/Math.abs(f))}return function f(m,d){const C=Math.round(d);if(C===0)return a(m);if(C===1)return l(m);if(C<0)return Number.NaN;if(Math.abs(m)===0)return 0;if(m===1/0)return 1/0;let _=0,E;const R=2/Math.abs(m);let b=0,N=1,V=0;const S=2*Math.round((C+Math.round(Math.sqrt(40*C)))/2);for(E=S;E>0;E--)if(V=E*R*N+b,b=N,N=V,Math.abs(N)>1e10&&(N*=1e-10,b*=1e-10,_*=1e-10),E===C&&(_=b),S-E>100&&_===0)return Number.NaN;return _*=f(m,0)/N,m<0&&C%2?-_:_}})(),i.besselk=(()=>{const n=[74e-7,1075e-7,.00262698,.0348859,.23069756,.4227842,-.57721566],s=[53208e-8,-.0025154,.00587872,-.01062446,.02189568,-.07832358,1.25331414];function a(f){return f<=2?-Math.log(f/2)*(0,i.besseli)(f,0)+e(n,f*f/4):Math.exp(-f)/Math.sqrt(f)*e(s,2/f)}const u=[-4686e-8,-.00110404,-.01919402,-.18156897,-.67278579,.15443144,1],c=[-68245e-8,.00325614,-.00780353,.01504268,-.0365562,.23498619,1.25331414];function l(f){return f<=2?Math.log(f/2)*(0,i.besseli)(f,1)+1/f*e(u,f*f/4):Math.exp(-f)/Math.sqrt(f)*e(c,2/f)}return r(a,l,2,1)})()})(Cr||(Cr={}));function la(i){return/^[01]{1,10}$/.test(i)}function fa(i){return/^[0-7]{1,10}$/.test(i)}function ma(i){return/^[0-9A-Fa-f]{1,10}$/.test(i)}function Kt(i){if(i===0)return 0;const o=[-1.3026537197817094,.6419697923564902,.019476473204185836,-.00956151478680863,-.000946595344482036,.000366839497852761,42523324806907e-18,-20278578112534e-18,-1624290004647e-18,130365583558e-17,15626441722e-18,-85238095915e-18,6529054439e-18,5059343495e-18,-991364156e-18,-227365122e-18,96467911e-18,2394038e-18,-6886027e-18,894487e-18,313092e-18,-112708e-18,381e-18,7106e-18,-1523e-18,-94e-18,121e-18,-28e-18];let e=i,t=!1;e<0&&(e=-e,t=!0);const r=2/(2+e),n=4*r-2;let s=0,a=0,u;for(let l=o.length-1;l>0;l--)u=s,s=n*s-a+o[l],a=u;const c=r*Math.exp(-e*e+.5*(o[0]+n*s)-a);return t?c-1:1-c}function ha(i){return 1-Kt(i)}function Qm(i){if(i>=2)return-100;if(i<=0)return 100;const o=i<1?i:2-i,e=Math.sqrt(-2*Math.log(o/2));let t=-.70711*((2.30753+e*.27061)/(1+e*(.99229+e*.04481))-e);for(let r=0;r<2;r++){const n=ha(t)-o;t+=n/(1.1283791670955126*Math.exp(-t*t)-t*n)}return i<1?t:-t}function _r(i,o=1){let e=Math.floor(i);if(i<0)return Number.NaN;let t=1;for(;e>1&&Number.isFinite(t);)t*=e,e-=o;return t}function Zt(i,o){const e=Math.min(i-o,o);let t=1;for(let r=1;r<=e&&Number.isFinite(t);r++)t*=i-r+1,t/=r;return t}function ga(i,o){let e=Math.floor(i),t=Math.floor(o);for(;t!==0;){const r=t;t=e%t,e=r}return e}function No(i,o){const e=ga(i,o);return e===0?0:Math.abs(i*o)/e}function da(i){const o=i.length;if(o===1)return i[0][0];if(o===2)return i[0][0]*i[1][1]-i[0][1]*i[1][0];const{rowSwap:e,smallPivotDetected:t,luMatrix:r,permutation:n}=po(i);if(t)return 0;let s=e?1:-1;for(let a=0;a<n.length;a++)s*=r[a][a];return s===0?0:s}function qm(i){const o=da(i);return o===0?null:i.length===1?[[1/o]]:Km(i).map(r=>r.map(n=>n/o))}function Xm(i,o,e){return i.filter((t,r)=>r!==o).map(t=>t.filter((r,n)=>n!==e))}function Km(i){const o=i.length,e=Array.from({length:o},()=>new Array(o).fill(0));for(let t=0;t<o;t++)for(let r=0;r<o;r++){const s=((t+r)%2===0?1:-1)*da(Xm(i,t,r));e[r][t]=s===0?0:s}return e}function Ar(i,o){return i.map(e=>o[0].map((t,r)=>e.reduce((n,s,a)=>n+s*o[a][r],0)))}function _t(i){return i[0].map((o,e)=>i.map(t=>t[e]))}function Zm(i){const{smallPivotDetected:o,luMatrix:e,permutation:t}=po(i);return o?null:zm(e,t)}function po(i){const o=_t(i),e=o.length,t=o[0].length;let r=!0,n=!1;const s=Ca(e,t,0),a=new Array(t).fill(0).map((u,c)=>c);for(let u=0;u<t;u++){for(let m=0;m<u;m++){let d=o[m][u];for(let C=0;C<m;C++)d-=s[m][C]*s[C][u];s[m][u]=d}let c=-1/0,l=u;for(let m=u;m<e;m++){let d=o[m][u];for(let _=0;_<u;_++)d-=s[m][_]*s[_][u];s[m][u]=d;const C=Math.abs(d);C>c&&(c=C,l=m)}if(Math.abs(s[l][u])<1e-11){n=!0;break}l!==u&&([s[u],s[l]]=[s[l],s[u]],[o[u],o[l]]=[o[l],o[u]],[a[u],a[l]]=[a[l],a[u]],r=!r);const f=s[u][u];for(let m=u+1;m<e;m++)s[m][u]/=f}return{rowSwap:r,smallPivotDetected:n,luMatrix:s,permutation:a}}function zm(i,o){const e=o.length,t=Ca(e,e,0);for(let n=0;n<e;n++)t[n][n]=1;const r=Ca(e,e,0);for(let n=0;n<e;n++){const s=o[n];for(let a=0;a<e;a++)r[n][a]=t[s][a]}for(let n=0;n<e;n++){const s=r[n];for(let a=n+1;a<e;a++){const u=i[a][n];for(let c=0;c<e;c++)r[a][c]-=s[c]*u}}for(let n=e-1;n>=0;n--){const s=r[n],a=i[n][n];for(let u=0;u<e;u++)s[u]/=a;for(let u=0;u<n;u++){const c=i[u][n];for(let l=0;l<e;l++)r[u][l]-=s[l]*c}}return r}function Ca(i,o,e){const t=[];for(let r=0;r<i;r++){t[r]=[];for(let n=0;n<o;n++)t[r].push(e)}return t}function Jm(i){const o=eh(i);if(!o)return null;const{matrixU:e,matrixS:t,matrixV:r}=o,n=_t(e),s=Array.from({length:t.length},()=>new Array(i[0].length).fill(0)),a=Math.max(i.length,i[0].length)*Number.EPSILON*t[0];for(let u=0;u<t.length;u++)Math.abs(t[u])>a&&(s[u][u]=1/t[u]);return Ar(r,Ar(s,n))}function eh(i){const o=_t(i),e=o.length,t=o[0].length;if(e<t)return null;const r=new Array(t).fill(0),n=new Array(t).fill(0),s=Array.from({length:t},()=>new Array(t).fill(0));let a=Number.EPSILON,u=0,c=0,l=0;for(let _=0;_<t;_++){if(r[_]=u,c=_a(o,_,e,_,_),c<=1e-64/a)u=0;else{u=Math.sqrt(c),o[_][_]>=0&&(u=-u);const R=o[_][_]*u-c;o[_][_]-=u;for(let b=_+1;b<t;b++){c=_a(o,_,e,_,b);for(let N=_;N<e;N++)o[N][b]+=c/R*o[N][_]}}if(n[_]=u,c=Vo(o,_+1,t,_,_),c<=1e-64/a)u=0;else{u=Math.sqrt(c),o[_][_+1]>=0&&(u=-u);const R=o[_][_+1]*u-c;o[_][_+1]-=u;for(let b=_+1;b<t;b++)r[b]=o[_][b]/R;for(let b=_+1;b<e;b++){c=Vo(o,_+1,t,b,_);for(let N=_+1;N<t;N++)o[b][N]+=c*r[N]}}const E=Math.abs(n[_])+Math.abs(r[_]);E>l&&(l=E)}let f=0;for(let _=t-1;_>=0;_--){if(u!==0){for(let E=f;E<t;E++)s[E][_]=o[_][E]/(u*o[_][_+1]);for(let E=f;E<t;E++){c=0;for(let R=f;R<t;R++)c+=o[_][R]*s[R][E];for(let R=f;R<t;R++)s[R][E]+=c*s[R][_]}}for(let E=f;E<t;E++)s[_][E]=0,s[E][_]=0;s[_][_]=1,u=r[_],f=_}for(let _=t-1;_>=0;_--){u=n[_];for(let E=_+1;E<t;E++)o[_][E]=0;if(u!==0){for(let E=_+1;E<t;E++){c=_a(o,_+1,e,_,E);for(let R=_;R<e;R++)o[R][E]+=c/(o[_][_]*u)*o[R][_]}for(let E=_;E<e;E++)o[E][_]/=u}else for(let E=_;E<e;E++)o[E][_]=0;o[_][_]+=1}a*=l;let m=0,d=0,C=0;for(let _=t-1;_>=0;_--)for(let E=0;E<50;E++){let R=!1,b=_;for(;b>=0;b--){if(Math.abs(r[b])<=a){R=!0;break}if(Math.abs(n[b-1])<=a)break}if(!R){let D=0,L=1;for(let P=b;P<_+1&&(m=L*r[P],d=n[P],r[P]*=D,!(Math.abs(m)<=a));P++){C=Bn(m,d),n[P]=C,D=d/C,L=-m/C;for(let j=0;j<e;j++){const I=o[j][b-1],v=o[j][P];o[j][b-1]=I*D+v*L,o[j][P]=-I*L+v*D}}}if(b===_){if(n[_]<0){n[_]=-n[_];for(let D=0;D<t;D++)s[D][_]=-s[D][_]}break}if(E>=49)return null;let N=n[b];m=((n[_-1]-n[_])*(n[_-1]+n[_])+(r[_-1]-r[_])*(r[_-1]+r[_]))/(2*r[_]*n[_-1]),C=Bn(m,1),m<0?m=((N-n[_])*(N+n[_])+r[_]*(n[_-1]/(m-C)-r[_]))/N:m=((N-n[_])*(N+n[_])+r[_]*(n[_-1]/(m+C)-r[_]))/N;let V=1,S=1;for(let D=b+1;D<_+1;D++){let L=r[D],P=n[D];d=S*L,L*=V,C=Bn(m,d),r[D-1]=C,V=m/C,S=d/C,m=N*V+L*S,d=P*S,L=-N*S+L*V,P*=V;for(let j=0;j<t;j++){const I=s[j][D-1],v=s[j][D];s[j][D-1]=I*V+v*S,s[j][D]=-I*S+v*V}C=Bn(m,d),n[D-1]=C,V=m/C,S=d/C,m=V*L+S*P,N=-S*L+V*P;for(let j=0;j<e;j++){const I=o[j][D-1],v=o[j][D];o[j][D-1]=I*V+v*S,o[j][D]=-I*S+v*V}}r[b]=0,r[_]=m,n[_]=N}for(let _=0;_<n.length;_++)n[_]<a&&(n[_]=0);for(let _=0;_<t;_++)for(let E=_-1;E>=0;E--)if(n[E]<n[_]){const R=n[E];n[E]=n[_],n[_]=R;for(let b=0;b<o.length;b++){const N=o[b][_];o[b][_]=o[b][E],o[b][E]=N}for(let b=0;b<s.length;b++){const N=s[b][_];s[b][_]=s[b][E],s[b][E]=N}_=E}return{matrixU:o,matrixS:n,matrixV:s}}function Bn(i,o){let e=0;return Math.abs(i)>Math.abs(o)?(e=o/i,Math.abs(i)*Math.sqrt(1+e*e)):o!==0?(e=i/o,Math.abs(o)*Math.sqrt(1+e*e)):0}function _a(i,o,e,t,r){let n=0;for(let s=o;s<e;s++)n+=i[s][t]*i[s][r];return n}function Vo(i,o,e,t,r){let n=0;for(let s=o;s<e;s++)n+=i[t][s]*i[r][s];return n}const kn=new Map([["I",1],["V",5],["X",10],["L",50],["C",100],["D",500],["M",1e3]]),th=new Map([[1,"I"],[4,"IV"],[5,"V"],[9,"IX"],[10,"X"],[40,"XL"],[45,"VL"],[49,"IL"],[50,"L"],[90,"XC"],[95,"VC"],[99,"IC"],[100,"C"],[400,"CD"],[450,"LD"],[490,"XD"],[495,"VD"],[499,"ID"],[500,"D"],[900,"CM"],[950,"LM"],[990,"XM"],[995,"VM"],[999,"IM"],[1e3,"M"]]),rh=[[1,4,5,9,10,40,50,90,100,400,500,900,1e3,4e3],[1,4,5,9,10,40,45,50,90,95,100,400,450,500,900,950,1e3,4e3],[1,4,5,9,10,40,45,49,50,90,95,99,100,400,450,490,500,900,950,990,1e3,4e3],[1,4,5,9,10,40,45,49,50,90,95,99,100,400,450,490,495,500,900,950,990,995,1e3,4e3],[1,4,5,9,10,40,45,49,50,90,95,99,100,400,450,490,495,499,500,900,950,990,995,999,1e3,4e3]];function Oo(i,o,e){return i<=0?0:i>=1?1:$n(i,o,e)}function nh(i,o,e){return i<=0||i>=1?0:o===1&&e===1?1:o<512&&e<512?i**(o-1)*(1-i)**(e-1)/Ea(o,e):Math.exp((o-1)*Math.log(i)+(e-1)*Math.log(1-i)-Ra(o,e))}function Aa(i,o,e){if(i<=0)return 0;if(i>=1)return 1;const t=1e-8;let r;if(o>=1&&e>=1){const c=i<.5?i:1-i,l=Math.sqrt(-2*Math.log(c));r=(2.30753+l*.27061)/(1+l*(.99229+l*.04481))-l,i<.5&&(r=-r);const f=(r*r-3)/6,m=2/(1/(2*o-1)+1/(2*e-1)),d=r*Math.sqrt(f+m)/m-(1/(2*e-1)-1/(2*o-1))*(f+5/6-2/(3*m));r=o/(o+e*Math.exp(2*d))}else{const c=Math.exp(o*Math.log(o/(o+e)))/o,l=Math.exp(e*Math.log(e/(o+e)))/e,f=c+l;i<c/f?r=(o*f*i)**(1/o):r=1-(e*f*(1-i))**(1/e)}const n=-Ra(o,e);let s,a,u;for(let c=0;c<10;c++){if(r===0||r===1)return r;if(s=$n(r,o,e)-i,a=Math.exp((o-1)*Math.log(r)+(e-1)*Math.log(1-r)+n),u=s/a,r-=a=u/(1-.5*Math.min(1,u*((o-1)/r-(e-1)/(1-r)))),r<=0&&(r=.5*(r+a)),r>=1&&(r=.5*(r+a+1)),Math.abs(a)<t*r&&c>0)break}return r}function $n(i,o,e){const t=i===0||i===1?0:Math.exp(ut(o+e)-ut(o)-ut(e)+o*Math.log(i)+e*Math.log(1-i));return i<(o+1)/(o+e+2)?t*So(i,o,e)/o:1-t*So(1-i,e,o)/e}function So(i,o,e){let n=1-(o+e)*i/(o+1);Math.abs(n)<1e-8&&(n=1e-8),n=1/n;let s=1,a=n;for(let u=1;u<=100;u++){let c=u*(e-u)*i/((o-1+u*2)*(o+u*2));if(n=1+c*n,Math.abs(n)<1e-8&&(n=1e-8),s=1+c/s,Math.abs(s)<1e-8&&(s=1e-8),n=1/n,a*=n*s,c=-(o+u)*(o+e+u)*i/((o+u*2)*(o+1+u*2)),n=1+c*n,Math.abs(n)<1e-8&&(n=1e-8),s=1+c/s,Math.abs(s)<1e-8&&(s=1e-8),n=1/n,a*=n*s,Math.abs(n*s-1)<1e-8)break}return a}function Ea(i,o){return i+o>170?Math.exp(Ra(i,o)):Yn(i)*Yn(o)/Yn(i+o)}function Ra(i,o){return ut(i)+ut(o)-ut(i+o)}function Mo(i,o,e){if(i<0)return 0;if(i>=o)return 1;if(e<0||e>1||o<=0)return Number.NaN;let t=0;for(let r=0;r<=i;r++)t+=ba(r,o,e);return t}function ba(i,o,e){return e===0||e===1?o*e===i?1:0:Zt(o,i)*e**i*(1-e)**(o-i)}function ya(i,o){return i<=0?0:pa(o/2,i/2)}function sh(i,o){return i<0?0:i===0&&o===2?.5:Math.exp((o/2-1)*Math.log(i)-i/2-o/2*Math.log(2)-ut(o/2))}function Do(i,o){return i<=0?0:i>=1?1/0:2*Po(i,o/2)}function Na(i,o,e){return i<0?0:$n(o*i/(o*i+e),o/2,e/2)}function ah(i,o,e){if(i<0)return 0;if(i===0&&o<2)return 1/0;if(i===0&&o===2)return 1;let t=1/Ea(o/2,e/2);return t*=(o/e)**(o/2),t*=i**(o/2-1),t*=(1+o/e*i)**(-(o+e)/2),t}function wo(i,o,e){return i<=0?0:i>=1?1/0:e/(o*(1/Aa(i,o/2,e/2)-1))}function ih(i,o){return i<0?0:1-Math.exp(-o*i)}function oh(i,o){return i<0?0:o*Math.exp(-o*i)}function Lo(i,o,e){const t=o.length;let r=0,n=0;for(let m=0;m<t;m++)r+=o[m],n+=e[m];const s=r/t,a=n/t;let u=0,c=0;for(let m=0;m<t;m++)u+=(o[m]-s)*(e[m]-a),c+=(e[m]-a)**2;if(c===0)return 1/0;const l=u/c;return s-l*a+l*i}function Yn(i){const o=[-1.716185138865495,24.76565080557592,-379.80425647094563,629.3311553128184,866.9662027904133,-31451.272968848367,-36144.413418691176,66456.14382024054],e=[-30.8402300119739,315.35062697960416,-1015.1563674902192,-3107.771671572311,22538.11842098015,4755.846277527881,-134659.9598649693,-115132.2596755535];let t=0,r=i;if(i>171.6243769536076)return 1/0;if(r<=0){const f=r%1+36e-17;if(f)t=(r&1?-1:1)*Math.PI/Math.sin(Math.PI*f),r=1-r;else return 1/0}const n=r;let s=0,a;r<1?a=r++:a=(r-=s=(r|0)-1)-1;let u=0,c=0;for(let f=0;f<8;++f)u=(u+o[f])*a,c=c*a+e[f];let l=u/c+1;if(n<r)l/=n;else if(n>r)for(let f=0;f<s;++f)l*=r,r++;return t&&(l=t/l),l}function uh(i,o,e){return i<=0?0:pa(o,i/e)}function ch(i,o,e){return i<0?0:i===0&&o===1?1/e:Math.exp((o-1)*Math.log(i)-i/e-ut(o)-o*Math.log(e))}function lh(i,o,e){return i<=0?0:i>=1?1/0:e*Po(i,o)}function ut(i){const o=[76.18009172947146,-86.50532032941678,24.01409824083091,-1.231739572450155,.001208650973866179,-5395239384953e-18];let e=i,t=i+5.5;t-=(i+.5)*Math.log(t);let r=1.000000000190015;for(let n=0;n<6;n++)r+=o[n]/++e;return-t+Math.log(2.5066282746310007*r/i)}function pa(i,o){if(o<0||i<=0)return Number.NaN;const e=1e-30,t=-~(Math.log(i>=1?i:1/i)*8.5+i*.4+17),r=ut(i),n=Math.exp(-o+i*Math.log(o)-r);let s=i,a=1/i,u=a;if(o<i+1){if(n===0)return 0;for(let d=1;d<=t&&(a+=u*=o/++s,!(Math.abs(u)<Math.abs(a)*e));d++);return a*n}if(n===0)return 1;let c=o+1-i,l=1/e,f=1/c,m=f;for(let d=1;d<=t;d++){const C=-d*(d-i);if(c+=2,f=C*f+c,Math.abs(f)<e&&(f=e),l=c+C/l,Math.abs(l)<e&&(l=e),f=1/f,m*=f*l,Math.abs(f*l-1)<e)break}return 1-m*n}function Po(i,o){if(i<=0)return 0;if(i>=1)return Math.max(100,o+100*Math.sqrt(o));let e;if(o>1){const a=i<.5?i:1-i,u=Math.sqrt(-2*Math.log(a));e=(2.30753+u*.27061)/(1+u*(.99229+u*.04481))-u,i<.5&&(e=-e),e=Math.max(.001,o*(1-1/(9*o)-e/(3*Math.sqrt(o)))**3)}else{const a=1-o*(.253+o*.12);i<a?e=(i/a)**(1/o):e=1-Math.log(1-(i-a)/(1-a))}const t=1e-8,r=ut(o);let n,s;for(let a=0;a<12;a++){if(e<=0)return 0;if(n=pa(o,e)-i,o>1?s=Math.exp((o-1)*(Math.log(o-1)-1)-r)*Math.exp(-(e-(o-1))+(o-1)*(Math.log(e)-Math.log(o-1))):s=Math.exp(-e+(o-1)*Math.log(e)-r),s!==0&&(s=n/s/(1-.5*Math.min(1,n/s*((o-1)/e-1)))),e-=s,e<=0&&(e=.5*(e+s)),Math.abs(s)<t*e)break}return e}function fh(i,o,e,t){let r=0;for(let n=0;n<=i;n++)r+=Va(n,o,e,t);return r}function Va(i,o,e,t){return o-i>t-e?0:Zt(e,i)*Zt(t-e,o-i)/Zt(t,o)}function jo(i,o,e){return i<0?0:.5+.5*Kt((Math.log(i)-o)/Math.sqrt(2*e*e))}function mh(i,o,e){return i<=0?0:Math.exp(-Math.log(i)-.5*Math.log(2*Math.PI)-Math.log(e)-(Math.log(i)-o)**2/(2*e*e))}function hh(i,o,e){return Math.exp(Hn(i,o,e))}function gh(i,o,e){if(i<0)return 0;let t=0;for(let r=0;r<=i;r++)t+=Oa(r,o,e);return t}function Oa(i,o,e){return i<0?0:Zt(i+o-1,o-1)*e**o*(1-e)**i}function Fr(i,o,e){return .5*(1+Kt((i-o)/Math.sqrt(2*e*e)))}function xo(i,o,e){return Math.exp(-.5*Math.log(2*Math.PI)-Math.log(e)-(i-o)**2/(2*e*e))}function Hn(i,o,e){return-1.4142135623730951*e*Qm(2*i)+o}function dh(i,o){let e=0;for(let t=0;t<=i;t++)e+=Uo(t,o);return e}function Uo(i,o){return Math.exp(-o)*o**i/_r(i)}function Br(i,o){const e=.5*$n(o/(i**2+o),o/2,.5);return i<0?e:1-e}function Ch(i,o){const e=(1+i**2/o)**(-(o+1)/2);return 1/(Math.sqrt(o)*Ea(.5,o/2))*e}function Gn(i,o){let e=Aa(2*Math.min(i,1-i),.5*o,.5);return e=Math.sqrt(o*(1-e)/e),i>.5?e:-e}function Ze(i,o,e,t,r){const n=[],s=[];let a=!0;for(let u=0;u<e;u++){const c=Math.floor(u/t),l=u%t,f=Math.floor(u/r),m=u%r,d=i.isArray()?i.get(c,l):i,C=o.isArray()?o.get(f,m):o;if(d.isError())return{isError:!0,errorObject:d,array1Values:n,array2Values:s,noCalculate:a};if(C.isError())return{isError:!0,errorObject:C,array1Values:n,array2Values:s,noCalculate:a};if(d.isNull()||C.isNull()||d.isBoolean()||C.isBoolean())continue;const _=d.getValue(),E=C.getValue();!M.isRealNum(_)||!M.isRealNum(E)||(n.push(+_),s.push(+E),a=!1)}return{isError:!1,errorObject:null,array1Values:n,array2Values:s,noCalculate:a}}function Wn(i,o,e){const t=i.isArray()?i.getRowCount():1,r=i.isArray()?i.getColumnCount():1;let n=t,s=r;if(o&&!o.isNull()&&(n=o.isArray()?o.getRowCount():1,s=o.isArray()?o.getColumnCount():1,t===1&&s!==r||r===1&&n!==t||t!==1&&r!==1&&(n!==t||s!==r)))return{isError:!0,errorObject:g.create(h.REF)};if(e&&!e.isNull()){const a=e.isArray()?e.getRowCount():1,u=e.isArray()?e.getColumnCount():1;if(t===1&&n>1&&a!==n||r===1&&s>1&&u!==s)return{isError:!0,errorObject:g.create(h.REF)}}return{isError:!1,errorObject:null}}function At(i){const o=i.isArray()?i.getRowCount():1,e=i.isArray()?i.getColumnCount():1,t=[];for(let r=0;r<o;r++){t[r]=[];for(let n=0;n<e;n++){const s=i.isArray()?i.get(r,n):i;if(s.isError()||s.isNull()||s.isBoolean()||s.isString())return g.create(h.VALUE);t[r].push(+s.getValue())}}return t}function Qn(i,o){const e=[];let t=1;for(let r=0;r<i;r++){e[r]=[];for(let n=0;n<o;n++)e[r].push(t++)}return e}function qn(i,o,e,t){let r=o;t&&(r=o.map(a=>Math.log(a)));let n,s;return e?{slope:n,intercept:s}=_h(i,r):{slope:n,intercept:s}=Ah(i,r),t&&(n=Math.exp(n),s=Math.exp(s)),Number.isNaN(n)&&!e&&(n=0),{slope:n,intercept:s,Y:r}}function _h(i,o){const e=o.length;let t=0,r=0,n=0,s=0;for(let l=0;l<e;l++)t+=i[l],r+=o[l],n+=i[l]*i[l],s+=i[l]*o[l];const u=(e*s-t*r)/(e*n-t*t),c=1/e*r-u*(1/e)*t;return{slope:u,intercept:c}}function Ah(i,o){const e=[[...i]],t=[...o];let r=e.length,n=e[0].length,s=Math.min(r,n);const a=new Array(s).fill(0);for(let c=0;c<s;c++){const l=e[c];let f=0;for(let d=0;d<n;d++)f+=l[d]**2;const m=l[c]<0?Math.sqrt(f):-Math.sqrt(f);if(a[c]=m,m!==0){l[c]-=m;for(let d=c+1;d<r;d++){let C=0;for(let _=c;_<n;_++)C-=e[d][_]*l[_];C/=m*l[c];for(let _=c;_<n;_++)e[d][_]-=C*l[_]}}}r=e.length,n=e[0].length,s=Math.min(r,n);const u=new Array(r).fill(0);for(let c=0;c<s;c++){const l=e[c];let f=0;for(let m=0;m<n;m++)f+=t[m]*l[m];f/=a[c]*l[c];for(let m=0;m<n;m++)t[m]+=f*l[m]}for(let c=a.length-1;c>=0;c--){t[c]/=a[c];const l=t[c],f=e[c];u[c]=l;for(let m=0;m<c;m++)t[m]-=l*f[m]}return{slope:u[0],intercept:0}}function Xn(i,o,e,t,r){const n=i.length===1&&i[0].length>1;let s=i;r&&(s=i.map(_=>_.map(E=>Math.log(E))));let a=o,u=e;n&&(s=_t(s),a=_t(a),u=_t(u)),t&&(a=a.map(_=>[..._,1]));const c=_t(a),l=Ar(c,a),f=Ar(c,s);let m=Zm(l);if(!m&&(m=Jm(l),!m))return g.create(h.NA);let d=Ar(m,f);t||d.push([0]),d=_t(d);const C=d[0].pop();if(d[0].reverse(),d[0].push(C),r)for(let _=0;_<d[0].length;_++)d[0][_]=Math.exp(d[0][_]);return{coefficients:d,Y:s,X:a,newX:u,XTXInverse:m}}function To(i){const o=[],e=[];let t=!1;for(let r=0;r<i.length;r++){const n=i[r];if(n.isReferenceObject())n.isMultiArea()?o.push(n):e.push(n);else{t=!0;break}}return{isError:t,multiAreaRefs:o,normalRefs:e}}var Oe=(i=>(i.AVERAGE="AVERAGE",i.COUNT="COUNT",i.COUNTA="COUNTA",i.MAX="MAX",i.MIN="MIN",i.PRODUCT="PRODUCT",i.STDEV="STDEV",i.STDEV_S="STDEV.S",i.STDEVP="STDEVP",i.STDEV_P="STDEV.P",i.SUM="SUM",i.VAR="VAR",i.VAR_S="VAR.S",i.VARP="VARP",i.VAR_P="VAR.P",i.MEDIAN="MEDIAN",i.MODE_SNGL="MODE.SNGL",i))(Oe||{});function vo(i,o){const e=i[o];return e?e.hd===M.BooleanNumber.TRUE:!1}function Io(i,o,e,t,r,n){const s=i.getValue(o,e);if(s!=null&&s.f||s!=null&&s.si){const a=n.getFormulaStringByCell(o,e,t,r);if(a&&(a.indexOf(`${$.SUBTOTAL}(`)>-1||a.indexOf(`${$.AGGREGATE}(`)>-1))return!0}return!1}function Fo(i,o){const e=Object.entries(i).filter(([t,{count:r}])=>r===o).sort((t,r)=>t[1].order-r[1].order).map(([t])=>+t);return y.create(e[0])}function Bo(i,o){var b,N;const{type:e,ignoreRowHidden:t,ignoreErrorValues:r,ignoreNested:n,formulaDataModel:s}=i,a=[];let u=0,c=0,l=0,f=0,m=0,d=0,C=1;const _={};let E=1,R=0;for(let V=0;V<o.length;V++){const S=o[V],D=S.getFilteredOutRows(),L=S.getRowData(),P=S.getUnitId(),j=S.getSheetId(),v=(N=(b=S.getUnitData()[P])==null?void 0:b[j])==null?void 0:N.cellData;let Y;if(S.iterator((Q,se,te)=>{if(D.includes(se)||t&&vo(L,se)||n&&Io(v,se,te,j,P,s))return!0;if(e==="COUNT")return Q!=null&&Q.isNumber()&&u++,!0;if(e==="COUNTA")return Q!=null&&!Q.isNull()&&c++,!0;if(Q!=null&&Q.isError())return r?!0:(Y=Q,!1);if(!Q||Q.isNull()||Q.isBoolean()||Q.isString())return!0;let W=Q.getValue();if(!M.isRealNum(W))return!0;if(W=+W,f++,e==="MAX")return m=f===1?W:Math.max(m,W),!0;if(e==="MIN")return d=f===1?W:Math.min(d,W),!0;if(e==="MODE.SNGL")return _[W]?(_[W].count++,_[W].count>E&&(E=_[W].count)):_[W]={count:1,order:R++},!0;l+=W,C*=W,a.push(Q)}),Y!=null&&Y.isError())return Y}switch(e){case"AVERAGE":return f===0?g.create(h.DIV_BY_ZERO):y.create(l/f);case"COUNT":return y.create(u);case"COUNTA":return y.create(c);case"MAX":return y.create(m);case"MIN":return y.create(d);case"PRODUCT":return y.create(f===0?0:C);case"STDEV":case"STDEV.S":return f<2?g.create(h.DIV_BY_ZERO):at([a],1,f).std(1);case"STDEVP":case"STDEV.P":return f===0?g.create(h.DIV_BY_ZERO):at([a],1,f).std();case"SUM":return y.create(l);case"VAR":case"VAR.S":return f<2?g.create(h.DIV_BY_ZERO):at([a],1,f).var(1);case"VARP":case"VAR.P":return f===0?g.create(h.DIV_BY_ZERO):at([a],1,f).var();case"MEDIAN":return f===0?g.create(h.NUM):ko(a.map(V=>+V.getValue()));case"MODE.SNGL":return R===0||E===1?g.create(h.NA):Fo(_,E);default:return g.create(h.VALUE)}}function zt(i,o,e){var a,u;const{ignoreRowHidden:t=!1,ignoreErrorValues:r=!1,ignoreNested:n=!1}=o!=null?o:{},s=[];if(i.isReferenceObject()){const c=i.getFilteredOutRows(),l=i.getRowData(),f=i.getUnitId(),m=i.getSheetId(),C=(u=(a=i.getUnitData()[f])==null?void 0:a[m])==null?void 0:u.cellData;let _;if(i.iterator((E,R,b)=>{if(c.includes(R)||t&&vo(l,R))return!0;if(E!=null&&E.isError())return r?!0:(_=E,!1);if(n&&e&&Io(C,R,b,m,f,e)||!E||E.isNull()||E.isBoolean()||E.isString())return!0;const N=E.getValue();if(!M.isRealNum(N))return!0;s.push(+N)}),_)return _}else{const c=i.isArray()?i.getRowCount():1,l=i.isArray()?i.getColumnCount():1;for(let f=0;f<c;f++)for(let m=0;m<l;m++){const d=i.isArray()?i.get(f,m):i;if(d.isError()){if(r)continue;return d}if(!d||d.isNull()||d.isBoolean()||d.isString())continue;const C=d.getValue();M.isRealNum(C)&&s.push(+C)}}return s.length===0?g.create(h.NUM):s}function ko(i){const o=i.length;i.sort((t,r)=>t-r);let e;if(o%2===0){const t=o/2;e=(i[t-1]+i[t])/2}else e=i[Math.floor(o/2)];return y.create(e)}function $o(i,o){if(o<1||o>i.length)return g.create(h.NUM);i.sort((t,r)=>r-t);const e=Math.ceil(o);return y.create(i[e-1])}function Yo(i,o){if(o<1||o>i.length)return g.create(h.NUM);i.sort((t,r)=>t-r);const e=Math.floor(o);return y.create(i[e-1])}function Ho(i,o){const e=i.length;if(o<0||o>1)return g.create(h.NUM);i.sort((a,u)=>a-u);const t=o*(e-1),r=Math.floor(t),n=t-r;if(n===0)return y.create(i[r]);const s=i[r]+n*(i[r+1]-i[r]);return y.create(s)}function Go(i,o){const e=i.length;if(o<1/(e+1)||o>1-1/(e+1))return g.create(h.NUM);i.sort((a,u)=>a-u);const t=o*(e+1)-1,r=Math.floor(t),n=t-r;if(n===0)return y.create(i[r]);const s=i[r]+n*(i[r+1]-i[r]);return y.create(s)}function Wo(i,o){const e=i.length;if(o<0||o>4)return g.create(h.NUM);i.sort((u,c)=>u-c);const r=o/4*(e-1),n=Math.floor(r),s=r-n;if(s===0)return y.create(i[n]);const a=i[n]+s*(i[n+1]-i[n]);return y.create(a)}function Qo(i,o){const e=i.length;if(o<=0||o>=4)return g.create(h.NUM);i.sort((u,c)=>u-c);const t=o/4;if(t<1/(e+1)||t>1-1/(e+1))return g.create(h.NUM);const r=t*(e+1)-1,n=Math.floor(r),s=r-n;if(s===0)return y.create(i[n]);const a=i[n]+s*(i[n+1]-i[n]);return y.create(a)}class qo extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",5)}calculate(e,t,r,n,s){let a=n!=null?n:y.create(0),u=s!=null?s:y.create(1);a.isNull()&&(a=y.create(0)),u.isNull()&&(u=y.create(1));const c=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1,u.isArray()?u.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1,u.isArray()?u.getColumnCount():1),f=O(c,l,e,g.create(h.NA)),m=O(c,l,t,g.create(h.NA)),d=O(c,l,r,g.create(h.NA)),C=O(c,l,a,g.create(h.NA)),_=O(c,l,u,g.create(h.NA)),E=f.mapValue((R,b,N)=>{const V=m.get(b,N),S=d.get(b,N),D=C.get(b,N),L=_.get(b,N);return this._handleSingleObject(R,V,S,D,L)});return c===1&&l===1?E.get(0,0):E}_handleSingleObject(e,t,r,n,s){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(n.isError())return n;if(s.isError())return s;const{isError:a,errorObject:u,variants:c}=B(e,t,r,n,s);if(a)return u;const[l,f,m,d,C]=c,_=+l.getValue(),E=+f.getValue(),R=+m.getValue(),b=+d.getValue(),N=+C.getValue();if(E<=0||R<=0||_<=0||_>=1||b>=N)return g.create(h.NUM);const V=Aa(_,E,R)*(N-b)+b;return y.create(V)}}class Xo extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA)),f=O(s,a,n,g.create(h.NA)),m=u.mapValue((d,C,_)=>{const E=c.get(C,_),R=l.get(C,_),b=f.get(C,_);return d.isError()?d:E.isError()?E:R.isError()?R:b.isError()?b:this._handleSingleObject(d,E,R,b)});return s===1&&a===1?m.get(0,0):m}_handleSingleObject(e,t,r,n){const{isError:s,errorObject:a,variants:u}=B(e,t,r,n);if(s)return a;const[c,l,f,m]=u,d=Math.floor(+c.getValue()),C=Math.floor(+l.getValue()),_=+f.getValue(),E=+m.getValue();if(d<0||d>C||_<0||_>1)return g.create(h.NUM);let R;return E?R=Mo(d,C,_):R=ba(d,C,_),y.create(R)}}class Ko extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSingleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=B(e,t,r);if(n)return s;const[u,c,l]=a,f=Math.floor(+u.getValue()),m=+c.getValue(),d=+l.getValue();if(f<0||m<=0||m>=1||d<=0||d>=1)return g.create(h.NUM);let C=0;for(;C<=f&&!(Mo(C,f,m)>=d);)C++;return y.create(C)}}class Zo extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.mapValue((c,l,f)=>{const m=a.get(l,f);return c.isError()?c:m.isError()?m:this._handleSingleObject(c,m)});return r===1&&n===1?u.get(0,0):u}_handleSingleObject(e,t){const{isError:r,errorObject:n,variants:s}=B(e,t);if(r)return n;const[a,u]=s,c=+a.getValue(),l=Math.floor(+u.getValue());if(c<0||l<1||l>10**10)return g.create(h.NUM);const f=1-ya(c,l);return y.create(f)}}class zo extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.mapValue((c,l,f)=>{const m=a.get(l,f);return c.isError()?c:m.isError()?m:this._handleSingleObject(c,m)});return r===1&&n===1?u.get(0,0):u}_handleSingleObject(e,t){const{isError:r,errorObject:n,variants:s}=B(e,t);if(r)return n;const[a,u]=s,c=+a.getValue(),l=Math.floor(+u.getValue());if(c<0||c>1||l<1||l>10**10)return g.create(h.NUM);const f=Do(1-c,l);return Number.isNaN(f)||!Number.isFinite(f)?g.create(h.NUM):y.create(f)}}class Jo extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1;let u=e;if(e.isArray()&&r===1&&n===1&&(u=e.get(0,0)),u.isError())return u;let c=t;if(t.isArray()&&s===1&&a===1&&(c=t.get(0,0)),c.isError())return c;if(r*n===1||s*a===1)return u.isNull()||c.isNull()?g.create(h.VALUE):g.create(h.NA);if(r*n!==s*a)return g.create(h.NA);const{isError:l,errorObject:f,array1Values:m,array2Values:d,noCalculate:C}=Ze(e,t,r*n,n,a);return l?f:C?g.create(h.DIV_BY_ZERO):this._getResult(m,d,r,n)}_getResult(e,t,r,n){let s=0;for(let c=0;c<e.length;c++){if(t[c]===0)return g.create(h.DIV_BY_ZERO);s+=(e[c]-t[c])**2/t[c]}let a=(r-1)*(n-1);r===1?a=n-1:n===1&&(a=r-1);const u=1-ya(s,a);return y.create(u)}}class eu extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);if(f.isError())return f;if(C.isError())return C;if(_.isError())return _;const{isError:E,errorObject:R,variants:b}=B(f,C,_);if(E)return R;const[N,V,S]=b,D=+N.getValue(),L=+V.getValue(),P=Math.floor(+S.getValue());if(D<=0||D>=1||L<=0||P<1)return g.create(h.NUM);const j=Math.abs(Hn(D/2,0,1)*L/Math.sqrt(P));return y.create(j)});return n===1&&s===1?l.get(0,0):l}}class tu extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1;let u=e;if(e.isArray()&&r===1&&n===1&&(u=e.get(0,0)),u.isError())return u;let c=t;if(t.isArray()&&s===1&&a===1&&(c=t.get(0,0)),c.isError())return c;if((r*n===1||s*a===1)&&(u.isNull()||c.isNull()))return g.create(h.VALUE);if(r*n!==s*a)return g.create(h.NA);const{isError:l,errorObject:f,array1Values:m,array2Values:d,noCalculate:C}=Ze(e,t,r*n,n,a);return l?f:C?g.create(h.DIV_BY_ZERO):this._getResult(m,d)}_getResult(e,t){if(e.length===0)return g.create(h.DIV_BY_ZERO);const r=e.length;let n=0,s=0;for(let l=0;l<r;l++)n+=e[l],s+=t[l];const a=n/r,u=s/r;let c=0;for(let l=0;l<r;l++){const f=e[l]-a,m=t[l]-u;c+=f*m}return y.create(c/r)}}class ru extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSingleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=B(e,t,r);if(n)return s;const[u,c,l]=a,f=+u.getValue(),m=+c.getValue(),d=+l.getValue();if(f<0||m<=0)return g.create(h.NUM);let C;return d?C=ih(f,m):C=oh(f,m),y.create(C)}}class nu extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSingleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=B(e,t,r);if(n)return s;const[u,c,l]=a,f=+u.getValue(),m=Math.floor(+c.getValue()),d=Math.floor(+l.getValue());if(f<0||m<1||m>10**10||d<1||d>10**10)return g.create(h.NUM);const C=1-Na(f,m,d);return y.create(C)}}class su extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSingleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=B(e,t,r);if(n)return s;const[u,c,l]=a,f=+u.getValue(),m=Math.floor(+c.getValue()),d=Math.floor(+l.getValue());if(f<0||f>1||m<1||m>10**10||d<1||d>10**10)return g.create(h.NUM);const C=wo(1-f,m,d);return Number.isNaN(C)||!Number.isFinite(C)?g.create(h.NUM):y.create(C)}}class au extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,variance:s,ns1:a}=this._getValues(e);if(r)return n;const{isError:u,errorObject:c,variance:l,ns1:f}=this._getValues(t);if(u)return c;let m=2*(1-Na(s/l,a,f));return m>1&&(m=2-m),y.create(m)}_getValues(e){let t=0,r=0;const n=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1;if(n===1&&s===1){const f=e.isArray()?e.get(0,0):e;return f.isError()?{isError:!0,errorObject:f,variance:t,ns1:r}:f.isNull()?{isError:!0,errorObject:g.create(h.VALUE),variance:t,ns1:r}:{isError:!0,errorObject:g.create(h.DIV_BY_ZERO),variance:t,ns1:r}}const a=[];let u=0;for(let f=0;f<n;f++)for(let m=0;m<s;m++){const d=e.isArray()?e.get(f,m):e;if(d.isError())return{isError:!0,errorObject:d,variance:t,ns1:r};if(d.isNull()||d.isBoolean())continue;const C=d.getValue();M.isRealNum(C)&&(a.push(+C),u+=+C)}if(a.length<=1)return{isError:!0,errorObject:g.create(h.DIV_BY_ZERO),variance:t,ns1:r};const c=u/a.length;let l=0;for(let f=0;f<a.length;f++)l+=(a[f]-c)**2;return r=a.length-1,t=l/r,t===0?{isError:!0,errorObject:g.create(h.DIV_BY_ZERO),variance:t,ns1:r}:{isError:!1,errorObject:null,variance:t,ns1:r}}}class iu extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA)),f=O(s,a,n,g.create(h.NA)),m=u.mapValue((d,C,_)=>{const E=c.get(C,_),R=l.get(C,_),b=f.get(C,_);return d.isError()?d:E.isError()?E:R.isError()?R:b.isError()?b:this._handleSingleObject(d,E,R,b)});return s===1&&a===1?m.get(0,0):m}_handleSingleObject(e,t,r,n){const{isError:s,errorObject:a,variants:u}=B(e,t,r,n);if(s)return a;const[c,l,f,m]=u,d=+c.getValue(),C=+l.getValue(),_=+f.getValue(),E=+m.getValue();if(d<0||C<=0||_<=0)return g.create(h.NUM);let R;return E?R=uh(d,C,_):R=ch(d,C,_),y.create(R)}}class ou extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSingleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=B(e,t,r);if(n)return s;const[u,c,l]=a,f=+u.getValue(),m=+c.getValue(),d=+l.getValue();if(f<0||f>1||m<=0||d<=0)return g.create(h.NUM);const C=lh(f,m,d);return Number.isNaN(C)||!Number.isFinite(C)?g.create(h.NUM):y.create(C)}}class uu extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSingleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=B(e,t,r);if(n)return s;const[u,c,l]=a,f=+u.getValue(),m=+c.getValue(),d=+l.getValue();if(f<=0||f>=1||d<=0)return g.create(h.NUM);const C=hh(f,m,d);return Number.isNaN(C)||!Number.isFinite(C)?g.create(h.NUM):y.create(C)}}class cu extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t={};let r=0,n=1;for(let s=0;s<e.length;s++){const a=e[s];if(a.isError())return a;if(a.isString()){const l=a.convertToNumberObjectValue();if(l.isError())return l}const u=a.isArray()?a.getRowCount():1,c=a.isArray()?a.getColumnCount():1;for(let l=0;l<u;l++)for(let f=0;f<c;f++){const m=a.isArray()?a.get(l,f):a;if(m.isError())return m;if(m.isNull()||m.isBoolean()||m.isString())continue;const d=m.getValue();M.isRealNum(d)&&(t[+d]?(t[+d].count++,t[+d].count>n&&(n=t[+d].count)):t[+d]={count:1,order:r++})}}return r===0||n===1?new g(h.NA):Fo(t,n)}}class lu extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA)),f=O(s,a,n,g.create(h.NA)),m=u.mapValue((d,C,_)=>{const E=c.get(C,_),R=l.get(C,_),b=f.get(C,_);return d.isError()?d:E.isError()?E:R.isError()?R:b.isError()?b:this._handleSingleObject(d,E,R,b)});return s===1&&a===1?m.get(0,0):m}_handleSingleObject(e,t,r,n){const{isError:s,errorObject:a,variants:u}=B(e,t,r,n);if(s)return a;const[c,l,f,m]=u,d=+c.getValue(),C=+l.getValue(),_=+f.getValue(),E=+m.getValue();if(_<=0)return g.create(h.NUM);let R;return E?R=Fr(d,C,_):R=xo(d,C,_),y.create(R)}}class fu extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSingleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=B(e,t,r);if(n)return s;const[u,c,l]=a,f=+u.getValue(),m=+c.getValue(),d=+l.getValue();if(f<=0||f>=1||d<=0)return g.create(h.NUM);const C=Hn(f,m,d);return y.create(C)}}class mu extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return e.getRowCount()===1&&e.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=B(e);if(t)return r;const[s]=n,a=+s.getValue();if(a<=0||a>=1)return g.create(h.NUM);const u=Hn(a,0,1);return y.create(u)}}class hu extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=zt(e);if(t.isArray()){const n=t.mapValue(s=>this._handleSingleObject(r,s));return n.getRowCount()===1&&n.getColumnCount()===1?n.get(0,0):n}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(!Array.isArray(e))return e;const{isError:r,errorObject:n,variants:s}=B(t);if(r)return n;const[a]=s,u=+a.getValue();return Ho(e,u)}}class gu extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){const n=this._getValues(e);let s=r!=null?r:y.create(3);s.isNull()&&(s=y.create(3));const a=Math.max(t.isArray()?t.getRowCount():1,s.isArray()?s.getRowCount():1),u=Math.max(t.isArray()?t.getColumnCount():1,s.isArray()?s.getColumnCount():1),c=O(a,u,t,g.create(h.NA)),l=O(a,u,s,g.create(h.NA)),f=c.mapValue((m,d,C)=>{const _=l.get(d,C);return m.isError()?m:_.isError()?_:this._handleSingleObject(n,m,_)});return a===1&&u===1?f.get(0,0):f}_handleSingleObject(e,t,r){if(e instanceof g)return e;const{isError:n,errorObject:s,variants:a}=B(t,r);if(n)return s;const[u,c]=a,l=+u.getValue(),f=Math.floor(+c.getValue()),m=e.length;if(m===0||l<e[0]||l>e[m-1])return g.create(h.NA);if(m===1)return l===e[0]?y.create(1):g.create(h.NA);let d=0,C=!1,_=0;for(;!C&&_<m;)l===e[_]?(d=_/(m-1),C=!0):l>e[_]&&_+1<m&&l<e[_+1]&&(d=(_+(l-e[_])/(e[_+1]-e[_]))/(m-1),C=!0),_++;return C?f<1?g.create(h.NUM):(d=Qe(d,f),y.create(d)):g.create(h.NA)}_getValues(e){const t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let s=0;s<t;s++)for(let a=0;a<r;a++){const u=e.isArray()?e.get(s,a):e;if(u.isError())return u;if(u.isNull()||u.isBoolean())continue;const c=u.getValue();M.isRealNum(c)&&n.push(+c)}return n.sort((s,a)=>s-a)}}class du extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSingleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=B(e,t,r);if(n)return s;const[u,c,l]=a,f=Math.floor(+u.getValue()),m=+c.getValue(),d=+l.getValue();if(f<0||m<0)return g.create(h.NUM);let C;return d?C=dh(f,m):C=Uo(f,m),y.create(C)}}class Cu extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=zt(e);if(t.isArray()){const n=t.mapValue(s=>this._handleSingleObject(r,s));return n.getRowCount()===1&&n.getColumnCount()===1?n.get(0,0):n}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(!Array.isArray(e))return e;const{isError:r,errorObject:n,variants:s}=B(t);if(r)return n;const[a]=s,u=Math.floor(+a.getValue());return Wo(e,u)}}class _u extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=this.flattenArray(e);return t.isError()?t:t.std()}}class Au extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=this.flattenArray(e);return t.isError()?t:t.std(1)}}class Eu extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.mapValue((c,l,f)=>{const m=a.get(l,f);return c.isError()?c:m.isError()?m:this._handleSingleObject(c,m)});return r===1&&n===1?u.get(0,0):u}_handleSingleObject(e,t){const{isError:r,errorObject:n,variants:s}=B(e,t);if(r)return n;const[a,u]=s,c=+a.getValue(),l=Math.floor(+u.getValue());if(c<=0||c>1||l<1||l>10**10)return g.create(h.NUM);const f=Math.abs(Gn(c/2,l));return Number.isNaN(f)||!Number.isFinite(f)?g.create(h.NUM):y.create(f)}}class Ru extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4)}calculate(e,t,r,n){const{isError:s,errorObject:a,array1Values:u,array2Values:c}=this._handleArray1AndArray2(e,t),l=this._getArrayValues(e),f=this._getArrayValues(t),m=Math.max(r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),d=Math.max(r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),C=O(m,d,r,g.create(h.NA)),_=O(m,d,n,g.create(h.NA)),E=C.mapValue((R,b,N)=>{const V=_.get(b,N);if(e.isError())return e;if(t.isError())return t;if(R.isError())return R;if(V.isError())return V;const{isError:S,errorObject:D,variants:L}=B(R,V);if(S)return D;const[P,j]=L,I=Math.floor(+P.getValue()),v=Math.floor(+j.getValue());return![1,2].includes(I)||![1,2,3].includes(v)?g.create(h.NUM):v===1&&s?a:v!==1&&l instanceof g?l:v!==1&&f instanceof g?f:this._handleSingleObject(v===1?u:l,v===1?c:f,I,v)});return m===1&&d===1?E.get(0,0):E}_handleSingleObject(e,t,r,n){if(e.length<2||t.length<2)return g.create(h.DIV_BY_ZERO);const{isError:s,errorObject:a,x:u,degFreedom:c}=this._getTDistParamByArrayValues(e,t,n);if(s)return a;let l=Br(-u,c);return r===2&&(l*=2),Number.isNaN(l)||!Number.isFinite(l)?g.create(h.NUM):y.create(l)}_getArrayValues(e){const t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let s=0;s<t;s++)for(let a=0;a<r;a++){const u=e.isArray()?e.get(s,a):e;if(u.isError())return u;if(u.isNull()){if(t*r===1)return g.create(h.VALUE);continue}u.isBoolean()||u.isString()||n.push(+u.getValue())}return n}_handleArray1AndArray2(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1;let u=e;if(e.isArray()&&r===1&&n===1&&(u=e.get(0,0)),u.isError())return{isError:!0,errorObject:u,array1Values:[],array2Values:[]};let c=t;if(t.isArray()&&s===1&&a===1&&(c=t.get(0,0)),c.isError())return{isError:!0,errorObject:c,array1Values:[],array2Values:[]};if((r*n===1||s*a===1)&&(u.isNull()||c.isNull()))return{isError:!0,errorObject:g.create(h.VALUE),array1Values:[],array2Values:[]};if(r*n!==s*a)return{isError:!0,errorObject:g.create(h.NA),array1Values:[],array2Values:[]};const{isError:l,errorObject:f,array1Values:m,array2Values:d,noCalculate:C}=Ze(e,t,r*n,n,a);return l?{isError:!0,errorObject:f,array1Values:[],array2Values:[]}:C||m.length<2?{isError:!0,errorObject:g.create(h.DIV_BY_ZERO),array1Values:[],array2Values:[]}:{isError:!1,errorObject:null,array1Values:m,array2Values:d}}_getTDistParamByArrayValues(e,t,r){return r===1?this._getTDistParamByType1(e,t):r===2?this._getTDistParamByType2(e,t):this._getTDistParamByType3(e,t)}_getTDistParamByType1(e,t){const r=e.length;let n=0,s=0,a=0;for(let m=0;m<r;m++)n+=e[m],s+=t[m],a+=(e[m]-t[m])**2;const u=n-s,c=r*a-u**2,l=r-1;return c===0?{isError:!0,errorObject:g.create(h.DIV_BY_ZERO),x:0,degFreedom:l}:{isError:!1,errorObject:null,x:Math.abs(u)*Math.sqrt(l/c),degFreedom:l}}_getTDistParamByType2(e,t){const r=e.length,n=t.length;let s=0,a=0;for(let E=0;E<r;E++)s+=e[E],a+=e[E]**2;let u=0,c=0;for(let E=0;E<n;E++)u+=t[E],c+=t[E]**2;const l=a-s**2/r,f=c-u**2/n,m=Math.sqrt(l+f);if(m===0)return{isError:!0,errorObject:g.create(h.DIV_BY_ZERO),x:0,degFreedom:0};const d=r-1+n-1,C=Math.sqrt(r*n*d/(r+n));return{isError:!1,errorObject:null,x:Math.abs(s/r-u/n)/m*C,degFreedom:d}}_getTDistParamByType3(e,t){const r=e.length,n=t.length;let s=0,a=0;for(let _=0;_<r;_++)s+=e[_],a+=e[_]**2;let u=0,c=0;for(let _=0;_<n;_++)u+=t[_],c+=t[_]**2;const l=(a-s**2/r)/(r*(r-1)),f=(c-u**2/n)/(n*(n-1));if(l+f===0)return{isError:!0,errorObject:g.create(h.DIV_BY_ZERO),x:0,degFreedom:0};const m=l/(l+f),d=Math.abs(s/r-u/n)/Math.sqrt(l+f),C=1/(m**2/(r-1)+(1-m)**2/(n-1));return{isError:!1,errorObject:null,x:d,degFreedom:C}}}class bu extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=this.flattenArray(e);return t.isError()?t:t.var()}}class yu extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=this.flattenArray(e);return t.isError()?t:t.var(1)}}class Nu extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA)),f=O(s,a,n,g.create(h.NA)),m=u.mapValue((d,C,_)=>{const E=c.get(C,_),R=l.get(C,_),b=f.get(C,_);return d.isError()?d:E.isError()?E:R.isError()?R:b.isError()?b:this._handleSingleObject(d,E,R,b)});return s===1&&a===1?m.get(0,0):m}_handleSingleObject(e,t,r,n){const{isError:s,errorObject:a,variants:u}=B(e,t,r,n);if(s)return a;const[c,l,f,m]=u,d=+c.getValue(),C=+l.getValue(),_=+f.getValue(),E=+m.getValue();if(d<0||C<=0||_<=0)return g.create(h.NUM);const R=Math.exp(-((d/_)**C));let b;return E?b=1-R:b=C/_**C*d**(C-1)*R,Number.isNaN(b)||!Number.isFinite(b)?g.create(h.NUM):y.create(b)}}class pu extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){const n=this._getArrayValues(e),s=Math.max(t.isArray()?t.getRowCount():1,r!=null&&r.isArray()?r.getRowCount():1),a=Math.max(t.isArray()?t.getColumnCount():1,r!=null&&r.isArray()?r.getColumnCount():1),u=O(s,a,t,g.create(h.NA)),c=r?O(s,a,r,g.create(h.NA)):void 0,l=u.mapValue((f,m,d)=>{if(n instanceof g)return n;if(f.isError())return f;const C=r?c.get(m,d):void 0;return C!=null&&C.isError()?C:n.length===0?g.create(h.NA):n.length===1?g.create(h.DIV_BY_ZERO):this._handleSingleObject(n,f,C)});return s===1&&a===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=B(t);if(n)return s;const[u]=a,c=+u.getValue(),l=e.length;let f=0,m=0;for(let E=0;E<l;E++)f+=e[E],m+=e[E]**2;let d=0;if(r!==void 0){const{isError:E,errorObject:R,variants:b}=B(r);if(E)return R;const[N]=b;d=+N.getValue()}else{const E=f/l;d=Math.sqrt((m-2*E*f+l*E**2)/(l-1))}if(d<=0)return g.create(h.NUM);const C=(f/l-c)/(d/Math.sqrt(l)),_=1-Fr(C,0,1);return Number.isNaN(_)||!Number.isFinite(_)?g.create(h.NUM):y.create(_)}_getArrayValues(e){const t=[],r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1;for(let s=0;s<r;s++)for(let a=0;a<n;a++){const u=e.isArray()?e.get(s,a):e;if(u.isError())return u;if(u.isNull()||u.isBoolean()||u.isString())continue;const c=u.getValue();M.isRealNum(c)&&t.push(+c)}return t}}class Eh extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",5)}calculate(e,t,r,n,s){let a=n!=null?n:y.create(0),u=s!=null?s:y.create(1);a.isNull()&&(a=y.create(0)),u.isNull()&&(u=y.create(1));const c=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1,u.isArray()?u.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1,u.isArray()?u.getColumnCount():1),f=O(c,l,e,g.create(h.NA)),m=O(c,l,t,g.create(h.NA)),d=O(c,l,r,g.create(h.NA)),C=O(c,l,a,g.create(h.NA)),_=O(c,l,u,g.create(h.NA)),E=f.mapValue((R,b,N)=>{const V=m.get(b,N),S=d.get(b,N),D=C.get(b,N),L=_.get(b,N);return this._handleSingleObject(R,V,S,D,L)});return c===1&&l===1?E.get(0,0):E}_handleSingleObject(e,t,r,n,s){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(n.isError())return n;if(s.isError())return s;const{isError:a,errorObject:u,variants:c}=B(e,t,r,n,s);if(a)return u;const[l,f,m,d,C]=c,_=+l.getValue(),E=+f.getValue(),R=+m.getValue(),b=+d.getValue(),N=+C.getValue();if(E<=0||R<=0||_<b||_>N||b===N)return g.create(h.NUM);const V=Oo((_-b)/(N-b),E,R);return y.create(V)}}var he=(i=>(i.BETADIST="BETADIST",i.BETAINV="BETAINV",i.BINOMDIST="BINOMDIST",i.CHIDIST="CHIDIST",i.CHIINV="CHIINV",i.CHITEST="CHITEST",i.CONFIDENCE="CONFIDENCE",i.COVAR="COVAR",i.CRITBINOM="CRITBINOM",i.EXPONDIST="EXPONDIST",i.FDIST="FDIST",i.FINV="FINV",i.FTEST="FTEST",i.GAMMADIST="GAMMADIST",i.GAMMAINV="GAMMAINV",i.HYPGEOMDIST="HYPGEOMDIST",i.LOGINV="LOGINV",i.LOGNORMDIST="LOGNORMDIST",i.MODE="MODE",i.NEGBINOMDIST="NEGBINOMDIST",i.NORMDIST="NORMDIST",i.NORMINV="NORMINV",i.NORMSDIST="NORMSDIST",i.NORMSINV="NORMSINV",i.PERCENTILE="PERCENTILE",i.PERCENTRANK="PERCENTRANK",i.POISSON="POISSON",i.QUARTILE="QUARTILE",i.RANK="RANK",i.STDEV="STDEV",i.STDEVP="STDEVP",i.TDIST="TDIST",i.TINV="TINV",i.TTEST="TTEST",i.VAR="VAR",i.VARP="VARP",i.WEIBULL="WEIBULL",i.ZTEST="ZTEST",i))(he||{});class Rh extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA)),f=O(s,a,n,g.create(h.NA)),m=u.mapValue((d,C,_)=>{const E=c.get(C,_),R=l.get(C,_),b=f.get(C,_);return d.isError()?d:E.isError()?E:R.isError()?R:b.isError()?b:this._handleSingleObject(d,E,R,b)});return s===1&&a===1?m.get(0,0):m}_handleSingleObject(e,t,r,n){const{isError:s,errorObject:a,variants:u}=B(e,t,r,n);if(s)return a;const[c,l,f,m]=u,d=Math.floor(+c.getValue()),C=Math.floor(+l.getValue()),_=Math.floor(+f.getValue()),E=Math.floor(+m.getValue());if(d<0||d>C||d>_||d<C-E+_||C<=0||C>E||_<=0||_>E||E<=0)return g.create(h.NUM);let R=Va(d,C,_,E);return Number.isNaN(R)&&(R=0),y.create(R)}}class bh extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSingleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=B(e,t,r);if(n)return s;const[u,c,l]=a,f=+u.getValue(),m=+c.getValue(),d=+l.getValue();if(f<=0||d<=0)return g.create(h.NUM);const C=jo(f,m,d);return y.create(C)}}class yh extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSingleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=B(e,t,r);if(n)return s;const[u,c,l]=a,f=Math.floor(+u.getValue()),m=Math.floor(+c.getValue()),d=+l.getValue();if(f<0||m<1||d<=0||d>=1)return g.create(h.NUM);const C=Oa(f,m,d);return y.create(C)}}class Nh extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return e.getRowCount()===1&&e.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=B(e);if(t)return r;const[s]=n,a=+s.getValue(),u=Fr(a,0,1);return y.create(u)}}class ph extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3);A(this,"needsReferenceObject",!0)}calculate(e,t,r){let n=e;n.isReferenceObject()&&(n=n.toArrayValueObject());const{refHasError:s,refErrorObject:a,refNumbers:u}=this._checkRefReferenceObject(t);let c=r!=null?r:y.create(0);c.isReferenceObject()&&(c=c.toArrayValueObject());const l=Math.max(n.isArray()?n.getRowCount():1,c.isArray()?c.getRowCount():1),f=Math.max(n.isArray()?n.getColumnCount():1,c.isArray()?c.getColumnCount():1),m=O(l,f,n,g.create(h.NA)),d=O(l,f,c,g.create(h.NA)),C=m.map((_,E,R)=>{const b=d.get(E,R);if(!e.isReferenceObject()&&e.isNull())return g.create(h.NA);if(s)return a;if(b.isError())return b;const N=+_.getValue(),V=+b.getValue();if(Number.isNaN(N)||Number.isNaN(V))return g.create(h.VALUE);const D=u.sort((L,P)=>V?L-P:P-L).indexOf(N);return D===-1?g.create(h.NA):y.create(D+1)});return l===1&&f===1?C.get(0,0):C}_checkRefReferenceObject(e){let t=!1,r=g.create(h.NA);const n=[];return e.isReferenceObject()?(e.toArrayValueObject().iterator(a=>{const u=a;if(u.isError())return t=!0,r=u,!1;if(u.isNull()||u.isBoolean())return!0;const c=+u.getValue();if(Number.isNaN(c))return!0;n.push(c)}),{refHasError:t,refErrorObject:r,refNumbers:n}):{refHasError:!0,refErrorObject:r,refNumbers:n}}}class Vh extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSingleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=B(e,t,r);if(n)return s;const[u,c,l]=a,f=+u.getValue(),m=Math.floor(+c.getValue()),d=Math.floor(+l.getValue());if(f<0||m<1||m>10**10||d<1||d>2)return g.create(h.NUM);let C=Br(-f,m);return d===2&&(C*=2),Number.isNaN(C)||!Number.isFinite(C)?g.create(h.NUM):y.create(C)}}const Vu=[[Eh,he.BETADIST],[qo,he.BETAINV],[Xo,he.BINOMDIST],[Zo,he.CHIDIST],[zo,he.CHIINV],[Jo,he.CHITEST],[eu,he.CONFIDENCE],[tu,he.COVAR],[Ko,he.CRITBINOM],[ru,he.EXPONDIST],[nu,he.FDIST],[su,he.FINV],[au,he.FTEST],[iu,he.GAMMADIST],[ou,he.GAMMAINV],[Rh,he.HYPGEOMDIST],[bh,he.LOGNORMDIST],[uu,he.LOGINV],[cu,he.MODE],[yh,he.NEGBINOMDIST],[lu,he.NORMDIST],[fu,he.NORMINV],[Nh,he.NORMSDIST],[mu,he.NORMSINV],[hu,he.PERCENTILE],[gu,he.PERCENTRANK],[du,he.POISSON],[Cu,he.QUARTILE],[ph,he.RANK],[Au,he.STDEV],[_u,he.STDEVP],[Vh,he.TDIST],[Eu,he.TINV],[Ru,he.TTEST],[yu,he.VAR],[bu,he.VARP],[Nu,he.WEIBULL],[pu,he.ZTEST]],Ou=[];var Su=(i=>(i.CUBEKPIMEMBER="CUBEKPIMEMBER",i.CUBEMEMBER="CUBEMEMBER",i.CUBEMEMBERPROPERTY="CUBEMEMBERPROPERTY",i.CUBERANKEDMEMBER="CUBERANKEDMEMBER",i.CUBESET="CUBESET",i.CUBESETCOUNT="CUBESETCOUNT",i.CUBEVALUE="CUBEVALUE",i))(Su||{});class Mu extends p{isCustom(){return!0}}class Oh extends Mu{isAsync(){return!0}}function ze(i){const o=[];if(i.isError())return{isError:!0,errorObject:i,databaseValues:o};const e=i.isArray()?i.getRowCount():1,t=i.isArray()?i.getColumnCount():1;if(e<2)return{isError:!0,errorObject:g.create(h.VALUE),databaseValues:o};for(let r=0;r<e;r++){const n=[];for(let s=0;s<t;s++){const a=i.get(r,s);if(a.isNull()){n.push(null);continue}let u=`${a.getValue()}`;if(a.isBoolean()&&(u=u.toLocaleUpperCase()),a.isNumber()||M.isRealNum(u)){n.push(+u);continue}n.push(u)}o.push(n)}return{isError:!1,errorObject:null,databaseValues:o}}function Je(i,o){let e=-1;if(i.isError())return{isError:!0,errorObject:i,fieldIndex:e};const t=i.isArray()?i.getRowCount():1,r=i.isArray()?i.getColumnCount():1;if(t>1||r>1)return{isError:!0,errorObject:g.create(h.VALUE),fieldIndex:e};const n=i.isArray()?i.get(0,0):i;let s=`${n.getValue()}`;if(n.isNull()?s=0:n.isBoolean()?s=n.getValue()?1:0:(n.isNumber()||M.isRealNum(s))&&(s=Math.floor(+s)),typeof s=="number"){if(s<1||s>o[0].length)return{isError:!0,errorObject:g.create(h.VALUE),fieldIndex:e};e=s-1}else if(e=o[0].findIndex(a=>a===null?!1:`${a}`.toLocaleLowerCase()===s.toLocaleLowerCase()),e===-1)return{isError:!0,errorObject:g.create(h.VALUE),fieldIndex:e};return{isError:!1,errorObject:null,fieldIndex:e}}function et(i){const o=[];if(i.isError())return{isError:!0,errorObject:i,criteriaValues:o};const e=i.isArray()?i.getRowCount():1,t=i.isArray()?i.getColumnCount():1;if(e<2)return{isError:!0,errorObject:g.create(h.VALUE),criteriaValues:o};for(let r=0;r<e;r++){const n=[];for(let s=0;s<t;s++){const a=i.get(r,s);if(a.isNull()){n.push(null);continue}const u=`${a.getValue()}`;if(a.isBoolean()){n.push(a.getValue()?1:0);continue}if(a.isNumber()||M.isRealNum(u)){n.push(+u);continue}n.push(u)}o.push(n)}return{isError:!1,errorObject:null,criteriaValues:o}}function tt(i,o,e){const t=i.length,r=i[0].length,n={};let s=!1;for(let a=1;a<t;a++){let u=!0;for(let c=0;c<r;c++){const l=i[a][c];if(l===null)continue;let f=n[c];if(f===void 0){const m=i[0][c];f=o[0].findIndex(d=>d===null||m===null?!1:`${d}`.toLocaleLowerCase()===`${m}`.toLocaleLowerCase()),n[c]=f}if(f===-1&&(typeof l=="string"||l===0)){u=!1;break}else if(f>-1){const m=o[e][f];if(m===null){u=!1;break}const[d,C]=Ks(`${l}`);if(!ht.create(`${m}`).compare(C,d).getValue()){u=!1;break}}}if(u){s=!0;break}}return s}class Sh extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:a}=ze(e);if(n)return s;const{isError:u,errorObject:c,fieldIndex:l}=Je(t,a);if(u)return c;const{isError:f,errorObject:m,criteriaValues:d}=et(r);if(f)return m;let C=0,_=0;for(let E=1;E<a.length;E++){const R=a[E][l];typeof R=="number"&&tt(d,a,E)&&(C+=R,_++)}return _===0?g.create(h.DIV_BY_ZERO):y.create(C/_)}}class Mh extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:a}=ze(e);if(n)return s;const{isError:u,errorObject:c,fieldIndex:l}=Je(t,a);if(u)return c;const{isError:f,errorObject:m,criteriaValues:d}=et(r);if(f)return m;let C=0;for(let _=1;_<a.length;_++)typeof a[_][l]=="number"&&tt(d,a,_)&&C++;return y.create(C)}}class Dh extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:a}=ze(e);if(n)return s;const{isError:u,errorObject:c,fieldIndex:l}=Je(t,a);if(u)return c;const{isError:f,errorObject:m,criteriaValues:d}=et(r);if(f)return m;let C=0;for(let _=1;_<a.length;_++){const E=a[_][l];E!=null&&tt(d,a,_)&&C++}return y.create(C)}}class wh extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:a}=ze(e);if(n)return s;const{isError:u,errorObject:c,fieldIndex:l}=Je(t,a);if(u)return c;const{isError:f,errorObject:m,criteriaValues:d}=et(r);if(f)return m;let C=0,_=0;for(let E=1;E<a.length;E++){const R=a[E][l];R!=null&&tt(d,a,E)&&(C++,_=E)}return C===0?g.create(h.VALUE):C>1?g.create(h.NUM):e.get(_,l)}}class Lh extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:a}=ze(e);if(n)return s;const{isError:u,errorObject:c,fieldIndex:l}=Je(t,a);if(u)return c;const{isError:f,errorObject:m,criteriaValues:d}=et(r);if(f)return m;let C=-1/0,_=0;for(let E=1;E<a.length;E++){const R=a[E][l];typeof R=="number"&&tt(d,a,E)&&(C=Math.max(C,R),_++)}return _===0?y.create(0):y.create(C)}}class Ph extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:a}=ze(e);if(n)return s;const{isError:u,errorObject:c,fieldIndex:l}=Je(t,a);if(u)return c;const{isError:f,errorObject:m,criteriaValues:d}=et(r);if(f)return m;let C=1/0,_=0;for(let E=1;E<a.length;E++){const R=a[E][l];typeof R=="number"&&tt(d,a,E)&&(C=Math.min(C,R),_++)}return _===0?y.create(0):y.create(C)}}class jh extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:a}=ze(e);if(n)return s;const{isError:u,errorObject:c,fieldIndex:l}=Je(t,a);if(u)return c;const{isError:f,errorObject:m,criteriaValues:d}=et(r);if(f)return m;let C=1,_=0;for(let E=1;E<a.length;E++){const R=a[E][l];typeof R=="number"&&tt(d,a,E)&&(C*=R,_++)}return _===0?y.create(0):y.create(C)}}class xh extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:a}=ze(e);if(n)return s;const{isError:u,errorObject:c,fieldIndex:l}=Je(t,a);if(u)return c;const{isError:f,errorObject:m,criteriaValues:d}=et(r);if(f)return m;const C=[];let _=0,E=0;for(let V=1;V<a.length;V++){const S=a[V][l];typeof S=="number"&&tt(d,a,V)&&(C.push(S),_+=S,E++)}if(E<=1)return g.create(h.DIV_BY_ZERO);const R=_/E;let b=0;for(let V=0;V<E;V++)b+=(C[V]-R)**2;const N=Math.sqrt(b/(E-1));return y.create(N)}}class Uh extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:a}=ze(e);if(n)return s;const{isError:u,errorObject:c,fieldIndex:l}=Je(t,a);if(u)return c;const{isError:f,errorObject:m,criteriaValues:d}=et(r);if(f)return m;const C=[];let _=0,E=0;for(let V=1;V<a.length;V++){const S=a[V][l];typeof S=="number"&&tt(d,a,V)&&(C.push(S),_+=S,E++)}if(E===0)return g.create(h.DIV_BY_ZERO);const R=_/E;let b=0;for(let V=0;V<E;V++)b+=(C[V]-R)**2;const N=Math.sqrt(b/E);return y.create(N)}}class Th extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:a}=ze(e);if(n)return s;const{isError:u,errorObject:c,fieldIndex:l}=Je(t,a);if(u)return c;const{isError:f,errorObject:m,criteriaValues:d}=et(r);if(f)return m;let C=0;for(let _=1;_<a.length;_++){const E=a[_][l];typeof E=="number"&&tt(d,a,_)&&(C+=E)}return y.create(C)}}class vh extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:a}=ze(e);if(n)return s;const{isError:u,errorObject:c,fieldIndex:l}=Je(t,a);if(u)return c;const{isError:f,errorObject:m,criteriaValues:d}=et(r);if(f)return m;const C=[];let _=0,E=0;for(let V=1;V<a.length;V++){const S=a[V][l];typeof S=="number"&&tt(d,a,V)&&(C.push(S),_+=S,E++)}if(E<=1)return g.create(h.DIV_BY_ZERO);const R=_/E;let b=0;for(let V=0;V<E;V++)b+=(C[V]-R)**2;const N=b/(E-1);return y.create(N)}}class Ih extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:a}=ze(e);if(n)return s;const{isError:u,errorObject:c,fieldIndex:l}=Je(t,a);if(u)return c;const{isError:f,errorObject:m,criteriaValues:d}=et(r);if(f)return m;const C=[];let _=0,E=0;for(let V=1;V<a.length;V++){const S=a[V][l];typeof S=="number"&&tt(d,a,V)&&(C.push(S),_+=S,E++)}if(E===0)return g.create(h.DIV_BY_ZERO);const R=_/E;let b=0;for(let V=0;V<E;V++)b+=(C[V]-R)**2;const N=b/E;return y.create(N)}}var He=(i=>(i.DAVERAGE="DAVERAGE",i.DCOUNT="DCOUNT",i.DCOUNTA="DCOUNTA",i.DGET="DGET",i.DMAX="DMAX",i.DMIN="DMIN",i.DPRODUCT="DPRODUCT",i.DSTDEV="DSTDEV",i.DSTDEVP="DSTDEVP",i.DSUM="DSUM",i.DVAR="DVAR",i.DVARP="DVARP",i))(He||{});const Du=[[Sh,He.DAVERAGE],[Mh,He.DCOUNT],[Dh,He.DCOUNTA],[wh,He.DGET],[Lh,He.DMAX],[Ph,He.DMIN],[jh,He.DPRODUCT],[xh,He.DSTDEV],[Uh,He.DSTDEVP],[Th,He.DSUM],[vh,He.DVAR],[Ih,He.DVARP]],Sa="yyyy/mm/dd;@",Fh="yyyy/mm/dd hh:mm",Bh="h:mm A/P";function be(i){const o=new Date(Date.UTC(1900,0,1)),e=new Date(Date.UTC(1900,1,28)),t=Date.UTC(i.getFullYear(),i.getMonth(),i.getDate());let r=(t-o.getTime())/(1e3*3600*24);return t>e.getTime()&&(r+=1),Math.floor(r)+1}function kr(i){const o=new Date(Date.UTC(1900,0,1,0,0,0)),e=new Date(Date.UTC(1900,1,28,0,0,0));let r=(i.getTime()-o.getTime())/(1e3*3600*24);return i>e&&(r+=1),r+1}function ie(i){const o=new Date(Date.UTC(1900,0,1)),e=new Date(Date.UTC(1900,1,28));let t=Math.floor(i)-1;return t>(e.getTime()-o.getTime())/(1e3*3600*24)&&(t-=1),new Date(o.getTime()+t*(1e3*3600*24))}function Ma(i){const o=new Date(Date.UTC(1900,0,1,0,0,0)),e=new Date(Date.UTC(1900,1,28,0,0,0));let t=i-1;return t>(e.getTime()-o.getTime())/(1e3*3600*24)&&(t-=1),t<0&&(t=i),new Date(o.getTime()+t*(1e3*3600*24))}function Da(i){if(!/^\d{4}[-/](0?[1-9]|1[012])[-/](0?[1-9]|[12][0-9]|3[01])$/.test(i))return!1;const e=i.replace(/-/g,"/").replace(/T.+/,""),t=new Date(`${e}`);if(Number.isNaN(t.getTime()))return!1;const r=t.getFullYear(),n=(t.getMonth()+1).toString().padStart(2,"0"),s=t.getDate().toString().padStart(2,"0"),a=`${r}-${n}-${s}`;return i.replace(/\//g,"-").split("-").map(c=>c.padStart(2,"0")).join("-")===a}function Kn(i){return M.numfmt.parseDate(i)}function kh(i){return M.numfmt.parseValue(i)}function Zn(i){return M.numfmt.parseTime(i)}function wa(i){return M.numfmt.getFormatInfo(i).isDate}const wu={1:[6,0],2:[0,1],3:[1,2],4:[2,3],5:[3,4],6:[4,5],7:[5,6],11:[0],12:[1],13:[2],14:[3],15:[4],16:[5],17:[6]};function $r(i){return!!(typeof i=="string"&&/^[0|1]{7}/.test(i)||wu[Number(i)])}function Lu(i){if(!$r(i))return[];if(typeof i=="string"&&/^[0|1]{7}/.test(i)){const o=[];for(let e=1;e<=i.length;e++)`${i[e-1]}`=="1"&&(e===i.length?o.push(0):o.push(e));return o}return wu[Number(i)]||[]}function zn(i,o,e=1,t){const r=Lu(e),n=Math.floor(i),s=Math.floor(o),a=s>n?n:s;let u=0;const c=Math.abs(Math.floor(o)-Math.floor(i))+1;for(let l=0;l<c;l++){const f=a+l;if(t&&t.length>0&&t.some(d=>Math.floor(d)===f))continue;const m=Jt(f);r.includes(m)||u++}return s>=n?u:-u}function Jn(i,o,e=1,t){const r=Lu(e),n=Math.floor(i);let s=n,a=Math.abs(o);for(let u=1;u<=a;u++){const c=o<0?n-u:n+u;if(c<0)return g.create(h.NUM);if(t&&t.length>0&&t.some(f=>Math.floor(f)===c)){a++;continue}const l=Jt(c);if(r.includes(l)){a++;continue}s=c}return s}function G(i){if(i.isError())return i;const o=i.getValue();if(i.isString()){let e;if(Kn(`${o}`))e=Kn(`${o}`).v;else if(Zn(`${o}`))e=Zn(`${o}`).v;else if(M.isRealNum(o))e=+o;else return g.create(h.VALUE);return e instanceof Date&&(e=kr(e)),+e<0||+e>2958465?g.create(h.NUM):+e}else{const e=+i.getValue();return e<0||e>2958465?g.create(h.NUM):e}}function Jt(i){const o=Math.floor(i)===60;let e=ie(i);const t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())).getTime(),r=new Date(Date.UTC(1900,1,28)).getTime();return!o&&t<=r&&(e=new Date(t-24*3600*1e3)),new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())).getUTCDay()}function _e(i,o,e){switch(e){case 0:return $h(i,o);case 1:return Yh(i,o);case 2:return{days:Math.abs(o-i),yearDays:360};case 3:return{days:Math.abs(o-i),yearDays:365};case 4:return Hh(i,o);default:return{days:Math.abs(o-i),yearDays:365}}}function $h(i,o){const e=ie(i),t=i>0?e.getUTCFullYear():1900,r=i>0?e.getUTCMonth()+1:1;let n=i>0?e.getUTCDate():0,s=ie(o),a=o>0?s.getUTCFullYear():1900,u=o>0?s.getUTCMonth()+1:1,c=o>0?s.getUTCDate():0;r===2?ie(i+1).getUTCMonth()+1===3&&(n=30):n===31&&(n=30),c===31&&(n<30?(s=ie(o+1),a=s.getUTCFullYear(),u=s.getUTCMonth()+1,c=s.getUTCDate()):c=30);const l=(a-t)*360,f=o>=i?30-n:-n,m=o>=i?c:c-30,d=(o>=i?u-r-1:u-r+1)*30;return{days:Math.abs(l+f+m+d),yearDays:360}}function Yh(i,o){const e=ie(i),t=i>0?e.getUTCFullYear():1900,r=ie(o),n=o>0?r.getUTCFullYear():1900,s=Math.abs(o-i),a=Math.abs(n-t)+1;let u,c;if(n<t){const l=new Date(Date.UTC(n,0,1)),f=new Date(Date.UTC(t,11,31));u=be(l),c=be(f),n===1900&&(u+=1)}else{const l=new Date(Date.UTC(t,0,1)),f=new Date(Date.UTC(n,11,31));u=be(l),c=be(f),t===1900&&(u+=1)}return{days:s,yearDays:(c-u+1)/a}}function Hh(i,o){const e=ie(i),t=i>0?e.getUTCFullYear():1900,r=i>0?e.getUTCMonth()+1:1;let n=i>0?e.getUTCDate():0;const s=ie(o),a=o>0?s.getUTCFullYear():1900,u=o>0?s.getUTCMonth()+1:1;let c=o>0?s.getUTCDate():0;n===31&&(n=30),c===31&&(c=30);const l=(a-t)*360,f=o>=i?30-n:-n,m=o>=i?c:c-30,d=(o>=i?u-r-1:u-r+1)*30;return{days:Math.abs(l+f+m+d),yearDays:360}}function Gh(i){return i%4===0&&i%100!==0||i%400===0}function Wh(i){return i%4===0&&i%100!==0||i%400===0||i===1900}const Qh=[31,29,31,30,31,30,31,31,30,31,30,31],qh=[31,28,31,30,31,30,31,31,30,31,30,31];function Yr(i,o){return Gh(i)?Qh[o]:qh[o]}function es(i){return Wh(i)?366:365}function Pu(i,o){switch(o){case 0:case 2:case 4:return 360;case 1:return es(ie(i).getUTCFullYear());case 3:return 365;default:return-1}}function Er(i,o,e){return Yr(i,o)===e}function Rr(i,o){let e=i.getUTCFullYear(),t=i.getUTCMonth();const r=i.getUTCDate();return Er(e,t,r)?(i.setUTCDate(1),i.setUTCMonth(i.getUTCMonth()+o),e=i.getUTCFullYear(),t=i.getUTCMonth(),i.setUTCDate(Yr(e,t))):i.setUTCMonth(i.getUTCMonth()+o),i}class Xh extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.map((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);if(f.isError())return f;if(C.isError())return C;if(_.isError())return _;const{isError:E,errorObject:R,variants:b}=B(f,C,_);if(E)return R;const[N,V,S]=b;let D=Math.floor(+N.getValue());const L=Math.floor(+V.getValue()),P=Math.floor(+S.getValue());if(D<0||D>9999)return g.create(h.NUM);D>=0&&D<1899&&(D+=1900);const j=new Date(D,L-1,P),I=be(j);return I<0?g.create(h.NUM):y.create(I,Sa)});return n===1&&s===1?l.get(0,0):l}}class Kh extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){let n=e,s=t,a=r;if(n.isArray()&&(n=n.get(0,0)),s.isArray()&&(s=s.get(0,0)),a.isArray()&&(a=a.get(0,0)),n.isError())return n;if(s.isError())return s;if(a.isError())return a;const u=G(n);if(typeof u!="number")return u;const c=G(s);return typeof c!="number"?c:c<u||!a.isString()?g.create(h.NUM):this._getResultByUnit(u,c,a)}_getResultByUnit(e,t,r){const n=ie(e),s=n.getUTCFullYear(),a=n.getUTCMonth()+1,u=n.getUTCDate(),c=ie(t),l=c.getUTCFullYear(),f=c.getUTCMonth()+1,m=c.getUTCDate(),d=`${r.getValue()}`.toLocaleUpperCase();let C=0,_;switch(d){case"Y":C=l-s,(f<a||f===a&&m<u)&&(C-=1);break;case"M":C=(l-s)*12+f-a,m<u&&(C-=1);break;case"D":C=Math.floor(t)-Math.floor(e);break;case"MD":C=m-u,m<u&&(_=new Date(Date.UTC(l,f-1,0)),C+=Yr(_.getUTCFullYear(),_.getUTCMonth()));break;case"YM":C=f-a,(f<a||f===a&&m<u)&&(C+=12),m<u&&(C-=1);break;case"YD":_=new Date(Date.UTC(s,f-1,m)),(f<a||f===a&&m<u)&&(_=new Date(Date.UTC(s+1,f-1,m))),C=Math.floor(be(_))-Math.floor(e);break;default:return g.create(h.NUM)}return y.create(C)}}class Zh extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}isArgumentsIgnoreNumberPattern(){return!0}calculate(e){return e.isArray()?e.mapValue(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isString()){const t=`${e.getValue()}`;let r=Kn(t);if(r===null&&(r=Zn(t)),r){let{v:n,z:s}=r;if(s&&wa(s))return n instanceof Date&&(n=kr(n)),y.create(Math.trunc(+n))}}return g.create(h.VALUE)}}class zh extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t;const r=e.getValue();if(e.isString()){if(!Da(`${r}`))return g.create(h.VALUE);t=new Date(`${r}`)}else{const a=+e.getValue();if(a<0)return g.create(h.NUM);if(a===0)return y.create(0);t=ie(a)}const n=t.getDate();return y.create(n)}}class Jh extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e),a=O(r,n,t),u=s.map((c,l,f)=>{const m=a.get(l,f);if(c.isError())return c;if(m.isError())return m;const d=G(c);if(typeof d!="number")return d;const C=G(m);if(typeof C!="number")return C;const _=Math.floor(d)-Math.floor(C);return y.create(_)});return r===1&&n===1?u.get(0,0):u}}class eg extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){const n=r!=null?r:F.create(!1);if(e.isError())return e;if(t.isError())return t;if(n.isError())return n;const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,n,g.create(h.NA)),f=u.map((m,d,C)=>{const _=c.get(d,C);let E=l.get(d,C);if(m.isError())return m;const R=G(m);if(typeof R!="number")return R;if(_.isError())return _;const b=G(_);if(typeof b!="number")return b;if(E.isString()&&(E=E.convertToNumberObjectValue()),E.isError())return E;const N=+E.getValue(),{days:V}=_e(R,b,N?4:0),S=b>=R?V:-V;return y.create(S)});return s===1&&a===1?f.get(0,0):f}}class tg extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e),a=O(r,n,t);return s.map((u,c,l)=>{const f=a.get(c,l)||le.create();if(u.isError())return u;if(f.isError())return f;if(u.isString()||u.isBoolean()||f.isString()||f.isBoolean())return g.create(h.VALUE);const m=+u.getValue();if(m<0)return g.create(h.NUM);const d=Math.floor(+f.getValue()),C=ie(m),_=C.getUTCFullYear(),E=C.getUTCMonth()+d,R=C.getUTCDate(),b=new Date(Date.UTC(_,E,R)),N=be(b);return y.create(N,Sa)})}}class rg extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){let r=e,n=t;if(r.isArray()){const d=r.getRowCount(),C=r.getColumnCount();if(d>1||C>1)return g.create(h.VALUE);r=r.get(0,0)}if(n.isArray()){const d=n.getRowCount(),C=n.getColumnCount();if(d>1||C>1)return g.create(h.VALUE);n=n.get(0,0)}if(r.isError())return r;if(n.isError())return n;const s=G(r);if(typeof s!="number")return s;if(n.isBoolean())return g.create(h.VALUE);const a=ie(s),u=s>0?a.getUTCFullYear():1900,c=s>0?a.getUTCMonth():0,l=Math.floor(+n.getValue());if(Number.isNaN(l))return g.create(h.VALUE);const f=new Date(Date.UTC(u,c+l+1,0)),m=be(f);return y.create(m)}}class ng extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2);A(this,"needsReferenceObject",!0)}calculate(e,t){const r=t!=null?t:y.create(1),{isError:n,errorObject:s,timestampIsReferenceObject:a,timestampObject:u,unitObject:c}=this._checkVariants(e,r);if(n)return s;if(u.isNull()||u.isBoolean()||u.isString()||!a&&u.isNumber()&&u.getPattern()!=="")return g.create(h.VALUE);let l=+u.getValue();const{isError:f,errorObject:m,variants:d}=B(c);if(f)return m;const[C]=d,_=Math.floor(+C.getValue());if(l<0||_<1||_>3)return g.create(h.NUM);_===1&&(l=l*1e3),_===3&&(l=l/1e3);const E=new Date(Date.UTC(1970,0,1,0,0,0,0)+l);if(Number.isNaN(E.getTime())){const R=25569+l/864e5;return y.create(R)}else{const R=kr(E);return y.create(R,"yyyy-MM-dd AM/PM hh:mm:ss")}}_checkVariants(e,t){const r=e.isReferenceObject(),n=t.isReferenceObject();let s=e;if(r&&(s=e.toArrayValueObject()),s.isArray()){const u=s.getRowCount(),c=s.getColumnCount();if(u>1||c>1)return{isError:!0,errorObject:g.create(h.VALUE)};s=s.get(0,0)}if(s.isError())return{isError:!0,errorObject:s};let a=t;if(n&&(a=t.toArrayValueObject()),a.isArray()){const u=a.getRowCount(),c=a.getColumnCount();if(u>1||c>1)return{isError:!0,errorObject:g.create(h.VALUE)};a=a.get(0,0)}return a.isError()?{isError:!0,errorObject:a}:{isError:!1,errorObject:null,timestampIsReferenceObject:r,timestampObject:s,unitIsReferenceObject:n,unitObject:a}}}var Ae=(i=>(i.DATE="DATE",i.DATEDIF="DATEDIF",i.DATEVALUE="DATEVALUE",i.DAY="DAY",i.DAYS="DAYS",i.DAYS360="DAYS360",i.EDATE="EDATE",i.EOMONTH="EOMONTH",i.EPOCHTODATE="EPOCHTODATE",i.HOUR="HOUR",i.ISOWEEKNUM="ISOWEEKNUM",i.MINUTE="MINUTE",i.MONTH="MONTH",i.NETWORKDAYS="NETWORKDAYS",i.NETWORKDAYS_INTL="NETWORKDAYS.INTL",i.NOW="NOW",i.SECOND="SECOND",i.TIME="TIME",i.TIMEVALUE="TIMEVALUE",i.TO_DATE="TO_DATE",i.TODAY="TODAY",i.WEEKDAY="WEEKDAY",i.WEEKNUM="WEEKNUM",i.WORKDAY="WORKDAY",i.WORKDAY_INTL="WORKDAY.INTL",i.YEAR="YEAR",i.YEARFRAC="YEARFRAC",i))(Ae||{});class sg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(t=>t.isError()?t:this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){const t=G(e);if(typeof t!="number")return t;if(t===0)return y.create(0);const n=Ma(t).getUTCHours();return y.create(n)}}class ag extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(t=>t.isError()?t:this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){const t=G(e);if(typeof t!="number")return t;const r=ie(t),n=t>0?r.getUTCFullYear():1900;let s=new Date(Date.UTC(n,0,1)),a=be(s),u=Jt(a),c;u<1?c=a+1:u<=4?c=a-(u-1):c=a+(11-u),t<c&&(s=new Date(Date.UTC(n-1,0,1)),a=be(s),u=Jt(a),u<1?c=a+1:u<=4?c=a-(u-1):c=a+(11-u));const l=Math.ceil((t-c+1)/7);return y.create(l)}}class ig extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(t=>t.isError()?t:this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){const t=G(e);if(typeof t!="number")return t;if(t===0)return y.create(0);const n=Ma(t).getUTCMinutes();return y.create(n)}}class og extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;let t;const r=e.getValue();if(e.isString()){if(!Da(`${r}`))return g.create(h.VALUE);t=new Date(`${r}`)}else{const a=+e.getValue();if(a<0)return g.create(h.NUM);if(a===0)return y.create(1);t=ie(a)}const n=t.getUTCMonth()+1;return y.create(n)}}class ug extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){let n=e,s=t;if(n.isArray()){const l=n.getRowCount(),f=n.getColumnCount();if(l>1||f>1)return g.create(h.VALUE);n=n.get(0,0)}if(n.isError())return n;if(s.isArray()){const l=s.getRowCount(),f=s.getColumnCount();if(l>1||f>1)return g.create(h.VALUE);s=s.get(0,0)}if(s.isError())return s;if(r!=null&&r.isError())return r;if(n.isBoolean()||s.isBoolean())return g.create(h.VALUE);const a=G(n);if(typeof a!="number")return a;const u=G(s);if(typeof u!="number")return u;if(r)return this._getResultByHolidays(a,u,r);const c=zn(a,u);return y.create(c)}_getResultByHolidays(e,t,r){const n=[];if(r!=null&&r.isArray()){const a=r.getRowCount(),u=r.getColumnCount();for(let c=0;c<a;c++)for(let l=0;l<u;l++){const f=r.get(c,l);if(f.isBoolean())return g.create(h.VALUE);const m=G(f);if(typeof m!="number")return m;n.push(m)}}else{if(r.isBoolean())return g.create(h.VALUE);const a=G(r);if(typeof a!="number")return a;n.push(a)}const s=zn(e,t,1,n);return y.create(s)}}class cg extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",4)}calculate(e,t,r,n){return e.isError()?e:t.isError()?t:r!=null&&r.isError()?r:n!=null&&n.isError()?n:r!=null&&r.isArray()?r.map(s=>this._handleSingleObject(e,t,s,n)):this._handleSingleObject(e,t,r,n)}_handleSingleObject(e,t,r,n){let s=e,a=t;if(s.isArray()){const m=s.getRowCount(),d=s.getColumnCount();if(m>1||d>1)return g.create(h.VALUE);s=s.get(0,0)}if(s.isError())return s;if(a.isArray()){const m=a.getRowCount(),d=a.getColumnCount();if(m>1||d>1)return g.create(h.VALUE);a=a.get(0,0)}if(a.isError())return a;let u=1;if(r){if(u=r.getValue(),r.isBoolean()&&(u=+u),r.isString()&&!$r(u))return g.create(h.VALUE);if(!$r(u))return g.create(h.NUM)}if(s.isBoolean()||a.isBoolean())return g.create(h.VALUE);const c=G(s);if(typeof c!="number")return c;const l=G(a);if(typeof l!="number")return l;if(n)return this._getResultByHolidays(c,l,u,n);const f=zn(c,l,u);return y.create(f)}_getResultByHolidays(e,t,r,n){const s=[];if(n!=null&&n.isArray()){const u=n.getRowCount(),c=n.getColumnCount();for(let l=0;l<u;l++)for(let f=0;f<c;f++){const m=n.get(l,f);if(m.isBoolean())return g.create(h.VALUE);const d=G(m);if(typeof d!="number")return d;s.push(d)}}else{if(n.isBoolean())return g.create(h.VALUE);const u=G(n);if(typeof u!="number")return u;s.push(u)}const a=zn(e,t,r,s);return y.create(a)}}class lg extends p{constructor(){super(...arguments);A(this,"minParams",0);A(this,"maxParams",0)}calculate(){const e=new Date,t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds())),r=kr(t);return y.create(r,Fh)}}class fg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(t=>t.isError()?t:this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){const t=G(e);if(typeof t!="number")return t;if(t===0)return y.create(0);const n=Ma(t).getUTCSeconds();return y.create(n)}}class mg extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e),u=O(n,s,t),c=O(n,s,r);return a.map((l,f,m)=>this._calculateTime(l,u,c,f,m))}_calculateTime(e,t,r,n,s){let a=e,u=t.get(n,s)||le.create(),c=r.get(n,s)||le.create();if((a.isString()||a.isBoolean())&&(a=a.convertToNumberObjectValue()),(u.isString()||u.isBoolean())&&(u=u.convertToNumberObjectValue()),(c.isString()||c.isBoolean())&&(c=c.convertToNumberObjectValue()),a.isError())return a;if(u.isError())return u;if(c.isError())return c;let l=Math.floor(+a.getValue()),f=Math.floor(+u.getValue()),m=Math.floor(+c.getValue());if(l<0||f<0||m<0||l>32767||f>32767||m>32767)return g.create(h.NUM);f+=Math.floor(m/60),m%=60,l+=Math.floor(f/60),f%=60,l%=24;const C=(l*3600+f*60+m)/86400;return y.create(C,Bh)}}class hg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}isArgumentsIgnoreNumberPattern(){return!0}calculate(e){return e.isArray()?e.mapValue(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isString()){const t=`${e.getValue()}`,r=kh(t);if(r){let{v:n,z:s}=r;if(s&&wa(s))return n instanceof Date&&(n=kr(n)),y.create(Bf(+n))}}return g.create(h.VALUE)}}class gg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1);A(this,"needsReferenceObject",!0)}calculate(e){const t=e.isReferenceObject();let r=e;if(t&&(r=e.toArrayValueObject()),r.isArray()){const s=r.getRowCount(),a=r.getColumnCount();if(s>1||a>1)return g.create(h.VALUE);r=r.get(0,0)}if(r.isError()||r.isNull()||r.isBoolean()||r.isString()||!t&&r.isNumber()&&r.getPattern()!=="")return r;const n=+r.getValue();return y.create(n,"yyyy-MM-dd hh:mm:ss AM/PM")}}class dg extends p{constructor(){super(...arguments);A(this,"minParams",0);A(this,"maxParams",0)}calculate(){const e=be(new Date);return y.create(e,Sa)}}class Cg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2);A(this,"_returnTypeMap",{1:[1,2,3,4,5,6,7],2:[7,1,2,3,4,5,6],3:[6,0,1,2,3,4,5],11:[7,1,2,3,4,5,6],12:[6,7,1,2,3,4,5],13:[5,6,7,1,2,3,4],14:[4,5,6,7,1,2,3],15:[3,4,5,6,7,1,2],16:[2,3,4,5,6,7,1],17:[1,2,3,4,5,6,7]})}calculate(e,t){const r=t!=null?t:y.create(1);if(e.isError())return e;if(r.isError())return r;const n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,r,g.create(h.NA)),c=a.map((l,f,m)=>{const d=u.get(f,m);return this._handleSingleObject(l,d)});return n===1&&s===1?c.get(0,0):c}_handleSingleObject(e,t){let r=t;if(e.isError())return e;if(r.isError())return r;const n=G(e);if(typeof n!="number")return n;if(r.isString()&&(r=r.convertToNumberObjectValue(),r.isError()))return r;const s=Math.floor(+r.getValue());if(!this._returnTypeMap[s])return g.create(h.NUM);const a=Jt(n),u=this._returnTypeMap[s][a];return y.create(u)}}class _g extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2);A(this,"_returnTypeMap",{1:0,2:1,11:1,12:2,13:3,14:4,15:5,16:6,17:0,21:4})}calculate(e,t){let r=e,n=t!=null?t:y.create(1);if(r.isArray()){const u=r.getRowCount(),c=r.getColumnCount();if(u>1||c>1)return g.create(h.VALUE);r=r.get(0,0)}if(r.isError())return r;if(n.isArray()){const u=n.getRowCount(),c=n.getColumnCount();if(u>1||c>1)return g.create(h.VALUE);n=n.get(0,0)}if(n.isError())return n;if(r.isBoolean())return g.create(h.VALUE);const s=G(r);if(typeof s!="number")return s;if(n.isBoolean())return g.create(h.VALUE);const a=Math.floor(+n.getValue());return Number.isNaN(a)?g.create(h.VALUE):a in this._returnTypeMap?this._getResult(s,a):g.create(h.NUM)}_getResult(e,t){const r=ie(e),n=e>0?r.getUTCFullYear():1900;let s=new Date(Date.UTC(n,0,1)),a=be(s),u=Jt(a),c;if(t===21)u<1?c=a+1:u<=4?c=a-(u-1):c=a+(11-u),e<c&&(s=new Date(Date.UTC(n-1,0,1)),a=be(s),u=Jt(a),u<1?c=a+1:u<=4?c=a-(u-1):c=a+(11-u));else{const f=this._returnTypeMap[t];u<f?c=a-(u+7-f):c=a-(u-f)}const l=Math.ceil((e-c+1)/7);return y.create(l)}}class Ag extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){let n=e,s=t;if(n.isArray()){const l=n.getRowCount(),f=n.getColumnCount();if(l>1||f>1)return g.create(h.VALUE);n=n.get(0,0)}if(n.isError())return n;if(s.isArray()){const l=s.getRowCount(),f=s.getColumnCount();if(l>1||f>1)return g.create(h.VALUE);s=s.get(0,0)}if(s.isError())return s;if(r!=null&&r.isError())return r;if(n.isBoolean()||s.isBoolean())return g.create(h.VALUE);const a=G(n);if(typeof a!="number")return a;const u=+s.getValue();if(Number.isNaN(u))return g.create(h.VALUE);if(r)return this._getResultByHolidays(a,u,r);const c=Jn(a,u);return typeof c!="number"?c:y.create(c)}_getResultByHolidays(e,t,r){const n=[];if(r!=null&&r.isArray()){const a=r.getRowCount(),u=r.getColumnCount();for(let c=0;c<a;c++)for(let l=0;l<u;l++){const f=r.get(c,l);if(f.isBoolean())return g.create(h.VALUE);const m=G(f);if(typeof m!="number")return m;n.push(m)}}else{if(r.isBoolean())return g.create(h.VALUE);const a=G(r);if(typeof a!="number")return a;n.push(a)}const s=Jn(e,t,1,n);return typeof s!="number"?s:y.create(s)}}class Eg extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",4)}calculate(e,t,r,n){return e.isError()?e:t.isError()?t:r!=null&&r.isError()?r:n!=null&&n.isError()?n:r!=null&&r.isArray()?r.map(s=>this._handleSingleObject(e,t,s,n)):this._handleSingleObject(e,t,r,n)}_handleSingleObject(e,t,r,n){const s=r!=null?r:y.create(1),a=this._checkArrayError(e);if(a.isError())return a;const u=this._checkArrayError(t);if(u.isError())return u;if(a.isBoolean()||u.isBoolean())return g.create(h.VALUE);const c=G(e);if(typeof c!="number")return c;const l=+t.getValue();if(Number.isNaN(l))return g.create(h.VALUE);let f=s.getValue();if(s.isBoolean()&&(f=+f),s.isString()&&(!$r(f)||f==="1111111"))return g.create(h.VALUE);if(!$r(f))return g.create(h.NUM);if(n)return this._getResultByHolidays(c,l,f,n);const m=Jn(c,l,f);return typeof m!="number"?m:y.create(m)}_checkArrayError(e){let t=e;if(t.isArray()){const r=t.getRowCount(),n=t.getColumnCount();if(r>1||n>1)return g.create(h.VALUE);t=t.get(0,0)}return t.isError(),t}_getResultByHolidays(e,t,r,n){const s=[];if(n!=null&&n.isArray()){const u=n.getRowCount(),c=n.getColumnCount();for(let l=0;l<u;l++)for(let f=0;f<c;f++){const m=n.get(l,f);if(m.isBoolean())return g.create(h.VALUE);const d=G(m);if(typeof d!="number")return d;s.push(d)}}else{if(n.isBoolean())return g.create(h.VALUE);const u=G(n);if(typeof u!="number")return u;s.push(u)}const a=Jn(e,t,r,s);return typeof a!="number"?a:y.create(a)}}class Rg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;let t;const r=e.getValue();if(e.isString()){if(!Da(`${r}`))return g.create(h.VALUE);t=new Date(`${r}`)}else{const a=+r;if(a<0)return g.create(h.NUM);if(a===0)return y.create(1900);t=ie(a)}const n=t.getUTCFullYear();return y.create(n)}}class bg extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){let n=r!=null?r:y.create(0);const s=Xt(e);if(s.isError())return s;const a=Xt(t);if(a.isError())return a;if(n=Xt(n),n.isError())return n;if(s.isBoolean()||a.isBoolean()||n.isBoolean())return g.create(h.VALUE);const u=G(s);if(typeof u!="number")return u;const c=G(a);if(typeof c!="number")return c;const l=Math.floor(+n.getValue());if(Number.isNaN(l))return g.create(h.VALUE);if(l<0||l>4)return g.create(h.NUM);const{days:f,yearDays:m}=_e(u,c,l),d=f/m;return y.create(d)}}const ju=[[Xh,Ae.DATE],[Kh,Ae.DATEDIF],[Zh,Ae.DATEVALUE],[zh,Ae.DAY],[Jh,Ae.DAYS],[eg,Ae.DAYS360],[tg,Ae.EDATE],[rg,Ae.EOMONTH],[ng,Ae.EPOCHTODATE],[sg,Ae.HOUR],[ag,Ae.ISOWEEKNUM],[ig,Ae.MINUTE],[og,Ae.MONTH],[ug,Ae.NETWORKDAYS],[cg,Ae.NETWORKDAYS_INTL],[lg,Ae.NOW],[fg,Ae.SECOND],[mg,Ae.TIME],[hg,Ae.TIMEVALUE],[gg,Ae.TO_DATE],[dg,Ae.TODAY],[Cg,Ae.WEEKDAY],[_g,Ae.WEEKNUM],[Ag,Ae.WORKDAY],[Eg,Ae.WORKDAY_INTL],[Rg,Ae.YEAR],[bg,Ae.YEARFRAC]];class yg extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return g.create(h.NA);const{isError:r,errorObject:n,variants:s}=q(e,t);if(r)return n;const[a,u]=s,c=+a.getValue(),l=Math.floor(+u.getValue());if(Number.isNaN(c)||Number.isNaN(l))return g.create(h.VALUE);if(l<0)return g.create(h.NUM);const f=Cr.besseli(c,l);return Number.isNaN(f)||!Number.isFinite(f)?g.create(h.NUM):y.create(f)}}class Ng extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return g.create(h.NA);const{isError:r,errorObject:n,variants:s}=q(e,t);if(r)return n;const[a,u]=s,c=+a.getValue(),l=Math.floor(+u.getValue());if(Number.isNaN(c)||Number.isNaN(l))return g.create(h.VALUE);if(l<0)return g.create(h.NUM);const f=Cr.besselj(c,l);return Number.isNaN(f)||!Number.isFinite(f)?g.create(h.NUM):y.create(f)}}class pg extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return g.create(h.NA);const{isError:r,errorObject:n,variants:s}=q(e,t);if(r)return n;const[a,u]=s,c=+a.getValue(),l=Math.floor(+u.getValue());if(Number.isNaN(c)||Number.isNaN(l))return g.create(h.VALUE);if(l<0)return g.create(h.NUM);const f=Cr.besselk(c,l);return Number.isNaN(f)||!Number.isFinite(f)?g.create(h.NUM):y.create(f)}}class Vg extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return g.create(h.NA);const{isError:r,errorObject:n,variants:s}=q(e,t);if(r)return n;const[a,u]=s,c=+a.getValue(),l=Math.floor(+u.getValue());if(Number.isNaN(c)||Number.isNaN(l))return g.create(h.VALUE);if(l<0)return g.create(h.NUM);const f=Cr.bessely(c,l);return Number.isNaN(f)||!Number.isFinite(f)?g.create(h.NUM):y.create(f)}}class Og extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`;if(!la(a))return g.create(h.NUM);let u;return a.length===10&&a.substring(0,1)==="1"?u=Number.parseInt(a.substring(1),2)-512:u=Number.parseInt(a,2),y.create(u)}}class Sg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){if(e.isNull())return g.create(h.NA);let r=0;if(t){const{isError:f,errorObject:m,variants:d}=q(t);if(f)return m;const[C]=d;if(r=Math.floor(+C.getValue()),Number.isNaN(r))return g.create(h.VALUE);if(r<0||r>10)return g.create(h.NUM)}const{isError:n,errorObject:s,variants:a}=q(e);if(n)return s;const[u]=a,c=`${u.getValue()}`;if(!la(c))return g.create(h.NUM);let l;if(c.length===10&&c.substring(0,1)==="1")l=(0xfffffffe00+Number.parseInt(c.substring(1),2)).toString(16);else if(l=Number.parseInt(c,2).toString(16),t){if(r<l.length)return g.create(h.NUM);l="0".repeat(r-l.length)+l}return T.create(l.toLocaleUpperCase())}}class Mg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){if(e.isNull())return g.create(h.NA);let r=0;if(t){const{isError:f,errorObject:m,variants:d}=q(t);if(f)return m;const[C]=d;if(r=Math.floor(+C.getValue()),Number.isNaN(r))return g.create(h.VALUE);if(r<0||r>10)return g.create(h.NUM)}const{isError:n,errorObject:s,variants:a}=q(e);if(n)return s;const[u]=a,c=`${u.getValue()}`;if(!la(c))return g.create(h.NUM);let l;if(c.length===10&&c.substring(0,1)==="1")l=(1073741312+Number.parseInt(c.substring(1),2)).toString(8);else if(l=Number.parseInt(c,2).toString(8),t){if(r<l.length)return g.create(h.NUM);l="0".repeat(r-l.length)+l}return T.create(l)}}class Dg extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.map((c,l,f)=>{let m=c;if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;let d=a.get(l,f);if(d.isString()&&(d=d.convertToNumberObjectValue()),d.isError())return d;const C=+m.getValue(),_=+d.getValue();if(C<0||_<0||Math.floor(C)!==C||Math.floor(_)!==_||C>0xffffffffffff||_>0xffffffffffff)return g.create(h.NUM);const E=C&_;return y.create(E)});return r===1&&n===1?u.get(0,0):u}}class wg extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.map((c,l,f)=>{let m=c;if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;let d=a.get(l,f);if(d.isString()&&(d=d.convertToNumberObjectValue()),d.isError())return d;const C=+m.getValue();let _=+d.getValue();if(C<0||Math.floor(C)!==C||C>0xffffffffffff||Math.abs(_)>53)return g.create(h.NUM);_=Math.trunc(_);const E=Number(_>=0?BigInt(C)<<BigInt(_):BigInt(C)>>BigInt(-_));return E>0xffffffffffff?g.create(h.NUM):y.create(E)});return r===1&&n===1?u.get(0,0):u}}class Lg extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.map((c,l,f)=>{let m=c;if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;let d=a.get(l,f);if(d.isString()&&(d=d.convertToNumberObjectValue()),d.isError())return d;const C=+m.getValue(),_=+d.getValue();if(C<0||_<0||Math.floor(C)!==C||Math.floor(_)!==_||C>0xffffffffffff||_>0xffffffffffff)return g.create(h.NUM);const E=Number(BigInt(C)|BigInt(_));return y.create(E)});return r===1&&n===1?u.get(0,0):u}}class Pg extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.map((c,l,f)=>{let m=c;if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;let d=a.get(l,f);if(d.isString()&&(d=d.convertToNumberObjectValue()),d.isError())return d;const C=+m.getValue();let _=+d.getValue();if(C<0||Math.floor(C)!==C||C>0xffffffffffff||Math.abs(_)>53)return g.create(h.NUM);_=Math.trunc(_);const E=Number(_>=0?BigInt(C)>>BigInt(_):BigInt(C)<<BigInt(-_));return E>0xffffffffffff?g.create(h.NUM):y.create(E)});return r===1&&n===1?u.get(0,0):u}}class jg extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.map((c,l,f)=>{let m=c;if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;let d=a.get(l,f);if(d.isString()&&(d=d.convertToNumberObjectValue()),d.isError())return d;const C=+m.getValue(),_=+d.getValue();if(C<0||_<0||Math.floor(C)!==C||Math.floor(_)!==_||C>0xffffffffffff||_>0xffffffffffff)return g.create(h.NUM);const E=C^_;return y.create(E)});return r===1&&n===1?u.get(0,0):u}}U.prototype.cos=function(){const i=this.toNumber();return new U(Math.cos(i))};let ge=class me{constructor(o){A(this,"_inumber","");A(this,"_realNum",0);A(this,"_iNum",0);A(this,"_suffix","");A(this,"_isError",!1);if(`${o}`.trim()===""){this._isError=!0;return}this._inumber=o,this._getImReal(),this._getImAginary(),this._getImSuffix()}static getComplex(o,e,t){const r=new U(o).toSignificantDigits(15).toNumber(),n=new U(e).toSignificantDigits(15).toNumber(),s=t===""?"i":t;let a;if(r===0&&n===0)a=0;else if(r===0)a=n===1?s:`${n}${s}`;else if(n===0)a=r;else{const u=n>0?"+":"",c=n===1?s:`${n}${s}`;a=`${r}${u}${c}`}return a}static createByComplexStr(o,e,t){const r=me.getComplex(o,e,t);return new me(r)}_getImReal(){if(this._inumber===0||this._inumber==="0"){this._realNum=0;return}const o=`${this._inumber}`;if(["i","+i","1i","+1i","-i","-1i","j","+j","1j","+1j","-j","-1j"].indexOf(o)>=0){this._realNum=0;return}let e=o.indexOf("+"),t=o.indexOf("-");e===0&&(e=o.indexOf("+",1)),t===0&&(t=o.indexOf("-",1));const r=o.substring(o.length-1,o.length),n=r==="i"||r==="j";if(e>=0||t>=0){if(!n){this._isError=!0;return}e>=0?Number.isNaN(+o.substring(0,e))||Number.isNaN(+o.substring(e+1,o.length-1))?this._isError=!0:this._realNum=+o.substring(0,e):Number.isNaN(+o.substring(0,t))||Number.isNaN(+o.substring(t+1,o.length-1))?this._isError=!0:this._realNum=+o.substring(0,t)}else n?Number.isNaN(+o.substring(0,o.length-1))?this._isError=!0:this._realNum=0:Number.isNaN(+o)?this._isError=!0:this._realNum=+o}_getImAginary(){if(this._isError)return;if(this._inumber===0||this._inumber==="0"){this._iNum=0;return}let o=`${this._inumber}`;if(["i","j"].indexOf(o)>=0){this._iNum=1;return}o=o.replace("+i","+1i").replace("-i","-1i").replace("+j","+1j").replace("-j","-1j");let e=o.indexOf("+"),t=o.indexOf("-");e===0&&(e=o.indexOf("+",1)),t===0&&(t=o.indexOf("-",1));const r=o.substring(o.length-1,o.length),n=r==="i"||r==="j";if(e>=0||t>=0){if(!n){this._isError=!0;return}e>=0?Number.isNaN(+o.substring(0,e))||Number.isNaN(+o.substring(e+1,o.length-1))?this._isError=!0:this._iNum=+o.substring(e+1,o.length-1):Number.isNaN(+o.substring(0,t))||Number.isNaN(+o.substring(t+1,o.length-1))?this._isError=!0:this._iNum=-+o.substring(t+1,o.length-1)}else n?Number.isNaN(+o.substring(0,o.length-1))?this._isError=!0:this._iNum=+o.substring(0,o.length-1):Number.isNaN(+o)?this._isError=!0:this._iNum=0}_getImSuffix(){const o=`${this._inumber}`,e=o.substring(o.length-1);this._suffix=e==="i"||e==="j"?e:""}getRealNum(){return this._realNum}getINum(){return this._iNum}getSuffix(){return this._suffix}isError(){return this._isError}toString(){return me.getComplex(this._realNum,this._iNum,this._suffix)}isDifferentSuffixes(o){const e=o.getSuffix();return this._suffix===""||e===""?!1:this._suffix!==e}Abs(){return U.sqrt(U.pow(this._realNum,2).add(U.pow(this._iNum,2))).toSignificantDigits(16).toNumber()}Argument(){const o=U.sqrt(U.pow(this._realNum,2).add(U.pow(this._iNum,2)));let e=U.acos(new U(this._realNum).div(o)).toSignificantDigits(16).toNumber();return this._iNum<0&&(e=-e),e}Conjugate(){return me.getComplex(this._realNum,-this._iNum,this._suffix)}Cos(){if(this._iNum){const o=U.cos(this._realNum).mul(U.cosh(this._iNum)).toNumber(),e=U.sin(this._realNum).mul(U.sinh(this._iNum)).negated().toNumber();return me.getComplex(o,e,this._suffix)}else{const o=U.cos(this._realNum).toNumber();return me.getComplex(o,this._iNum,this._suffix)}}Cosh(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return this._isError=!0,"";if(this._iNum){const o=U.cosh(this._realNum).mul(U.cos(this._iNum)).toNumber(),e=U.sinh(this._realNum).mul(U.sin(this._iNum)).toNumber();return me.getComplex(o,e,this._suffix)}else{const o=U.cosh(this._realNum).toNumber();return me.getComplex(o,this._iNum,this._suffix)}}Cot(){if(this._iNum){const o=U.cosh(this._iNum*2).sub(U.cos(this._realNum*2)),e=U.sin(this._realNum*2).div(o).toNumber(),t=U.sinh(this._iNum*2).div(o).negated().toNumber();return me.getComplex(e,t,this._suffix)}else{const o=new U(1).div(U.tan(this._realNum)).toNumber();return me.getComplex(o,this._iNum,this._suffix)}}Coth(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return this._isError=!0,"";if(this._iNum){const o=U.cosh(this._realNum*2).sub(U.cos(this._iNum*2)),e=U.sinh(this._realNum*2).div(o).toNumber(),t=U.sin(this._iNum*2).div(o).negated().toNumber();return me.getComplex(e,t,this._suffix)}else{const o=new U(1).div(U.tanh(this._realNum)).toNumber();return me.getComplex(o,this._iNum,this._suffix)}}Csc(){if(this._iNum){const o=U.cosh(this._iNum*2).sub(U.cos(this._realNum*2)),e=U.sin(this._realNum).mul(U.cosh(this._iNum)).mul(2).div(o).toNumber(),t=U.cos(this._realNum).mul(U.sinh(this._iNum)).mul(-2).div(o).toNumber();return me.getComplex(e,t,this._suffix)}else{const o=new U(1).div(U.sin(this._realNum)).toNumber();return me.getComplex(o,this._iNum,this._suffix)}}Csch(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return me.getComplex(0,0,this._suffix);if(this._iNum){const o=U.cosh(this._realNum*2).sub(U.cos(this._iNum*2)),e=U.sinh(this._realNum).mul(U.cos(this._iNum)).mul(2).div(o).toNumber(),t=U.cosh(this._realNum).mul(U.sin(this._iNum)).mul(-2).div(o).toNumber();return me.getComplex(e,t,this._suffix)}else{const o=new U(1).div(U.sinh(this._realNum)).toNumber();return me.getComplex(o,this._iNum,this._suffix)}}Div(o){const e=new U(this._realNum),t=new U(this._iNum),r=new U(o.getRealNum()),n=new U(o.getINum()),s=r.mul(r).add(n.mul(n)),a=e.mul(r).add(t.mul(n)).div(s).toNumber(),u=t.mul(r).sub(e.mul(n)).div(s).toNumber(),c=this._suffix===""?o.getSuffix():this._suffix;return me.getComplex(a,u,c)}Exp(){if(!Number.isFinite(Math.exp(this._realNum)))return this._isError=!0,"";const o=U.exp(this._realNum).mul(U.cos(this._iNum)).toNumber(),e=U.exp(this._realNum).mul(U.sin(this._iNum)).toNumber();return me.getComplex(o,e,this._suffix)}Ln(){const o=U.sqrt(U.pow(this._realNum,2).add(U.pow(this._iNum,2))),e=U.ln(o).toNumber(),t=U.acos(new U(this._realNum).div(o)).toNumber();return me.getComplex(e,t,this._suffix)}Log(o){const e=U.sqrt(U.pow(this._realNum,2).add(U.pow(this._iNum,2))),t=U.ln(e);let r=U.acos(new U(this._realNum).div(e));this._iNum<0&&(r=r.negated());const n=U.ln(o),s=new U(0),a=n.mul(n).add(s.mul(s));if(a.eq(0))return this._isError=!0,"";const u=t.mul(n).add(r.mul(s)).div(a).toNumber(),c=r.mul(n).sub(t.mul(s)).div(a).toNumber();return me.getComplex(u,c,this._suffix)}Power(o){if(this._realNum===0&&this._iNum===0)return o>0?me.getComplex(this._realNum,this._iNum,this._suffix):(this._isError=!0,"");let e=U.sqrt(U.pow(this._realNum,2).add(U.pow(this._iNum,2))),t=U.acos(new U(this._realNum).div(e));this._iNum<0&&(t=t.negated()),e=U.pow(e,o),t=t.mul(o);const r=U.cos(t).mul(e).toNumber(),n=U.sin(t).mul(e).toNumber();return!Number.isFinite(r)||!Number.isFinite(n)?(this._isError=!0,""):me.getComplex(r,n,this._suffix)}Product(o){const e=new U(this._realNum),t=new U(this._iNum),r=new U(o.getRealNum()),n=new U(o.getINum()),s=e.mul(r).sub(t.mul(n)).toNumber(),a=e.mul(n).add(t.mul(r)).toNumber(),u=this._suffix===""?o.getSuffix():this._suffix;return me.getComplex(s,a,u)}Sec(){if(this._iNum){const o=U.cosh(this._iNum*2).add(U.cos(this._realNum*2)),e=U.cos(this._realNum).mul(U.cosh(this._iNum)).mul(2).div(o).toNumber(),t=U.sin(this._realNum).mul(U.sinh(this._iNum)).mul(2).div(o).toNumber();return me.getComplex(e,t,this._suffix)}else{const o=new U(1).div(U.cos(this._realNum)).toNumber();return me.getComplex(o,this._iNum,this._suffix)}}Sech(){if(!Number.isFinite(Math.sinh(this._realNum*2))||!Number.isFinite(Math.cosh(this._realNum*2)))return me.getComplex(0,0,this._suffix);if(this._iNum){const o=U.cosh(this._realNum*2).add(U.cos(this._iNum*2)),e=U.cosh(this._realNum).mul(U.cos(this._iNum)).mul(2).div(o).toNumber(),t=U.sinh(this._realNum).mul(U.sin(this._iNum)).mul(-2).div(o).toNumber();return me.getComplex(e,t,this._suffix)}else{const o=new U(1).div(U.cosh(this._realNum)).toNumber();return me.getComplex(o,this._iNum,this._suffix)}}Sin(){if(this._iNum){const o=U.sin(this._realNum).mul(U.cosh(this._iNum)).toNumber(),e=U.cos(this._realNum).mul(U.sinh(this._iNum)).toNumber();return me.getComplex(o,e,this._suffix)}else{const o=U.sin(this._realNum).toNumber();return me.getComplex(o,this._iNum,this._suffix)}}Sinh(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return this._isError=!0,"";if(this._iNum){const o=U.sinh(this._realNum).mul(U.cos(this._iNum)).toNumber(),e=U.cosh(this._realNum).mul(U.sin(this._iNum)).toNumber();return me.getComplex(o,e,this._suffix)}else{const o=U.sinh(this._realNum).toNumber();return me.getComplex(o,this._iNum,this._suffix)}}Sqrt(){const o=U.sqrt(U.pow(this._realNum,2).add(U.pow(this._iNum,2))),e=U.sqrt(o);let t=U.acos(new U(this._realNum).div(o));this._iNum<0&&(t=t.negated());const r=e.mul(U.cos(t.div(2).toNumber())).toNumber(),n=e.mul(U.sin(t.div(2))).toNumber();return me.getComplex(r,n,this._suffix)}Sub(o){const e=new U(this._realNum),t=new U(this._iNum),r=new U(o.getRealNum()),n=new U(o.getINum()),s=e.sub(r).toNumber(),a=t.sub(n).toNumber(),u=this._suffix===""?o.getSuffix():this._suffix;return me.getComplex(s,a,u)}Sum(o){const e=new U(this._realNum),t=new U(this._iNum),r=new U(o.getRealNum()),n=new U(o.getINum()),s=e.add(r).toNumber(),a=t.add(n).toNumber(),u=this._suffix===""?o.getSuffix():this._suffix;return me.getComplex(s,a,u)}Tan(){if(this._iNum){const o=U.cos(this._realNum*2).add(U.cosh(this._iNum*2)),e=U.sin(this._realNum*2).div(o).toNumber(),t=U.sinh(this._iNum*2).div(o).toNumber();return me.getComplex(e,t,this._suffix)}else{const o=U.tan(this._realNum).toNumber();return me.getComplex(o,this._iNum,this._suffix)}}Tanh(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return this._isError=!0,"";if(this._iNum){const o=U.cosh(this._realNum*2).add(U.cos(this._iNum*2)),e=U.sinh(this._realNum*2).div(o).toNumber(),t=U.sin(this._iNum*2).div(o).toNumber();return me.getComplex(e,t,this._suffix)}else{const o=U.tanh(this._realNum).toNumber();return me.getComplex(o,this._iNum,this._suffix)}}};class xg extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){const n=r!=null?r:T.create("i"),{isError:s,errorObject:a,variants:u}=q(e,t,n);if(s)return a;const[c,l,f]=u,m=+c.getValue(),d=+l.getValue(),C=`${f.getValue()}`;if(Number.isNaN(m)||Number.isNaN(d)||C!=="i"&&C!=="j")return g.create(h.VALUE);const _=ge.getComplex(m,d,C);return typeof _=="number"?y.create(_):T.create(_)}}class Ug extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3);A(this,"_units",[["a.u. of action","?",null,"action",!1,!1,105457168181818e-48],["a.u. of charge","e",null,"electric_charge",!1,!1,160217653141414e-33],["a.u. of energy","Eh",null,"energy",!1,!1,435974417757576e-32],["a.u. of length","a?",null,"length",!1,!1,529177210818182e-25],["a.u. of mass","m?",null,"mass",!1,!1,910938261616162e-45],["a.u. of time","?/Eh",null,"time",!1,!1,241888432650516e-31],["admiralty knot","admkn",null,"speed",!1,!0,.514773333],["ampere","A",null,"electric_current",!0,!1,1],["ampere per meter","A/m",null,"magnetic_field_intensity",!0,!1,1],["ångström","Å",["ang"],"length",!1,!0,1e-10],["are","ar",null,"area",!1,!0,100],["astronomical unit","ua",null,"length",!1,!1,149597870691667e-25],["bar","bar",null,"pressure",!1,!1,1e5],["barn","b",null,"area",!1,!1,1e-28],["becquerel","Bq",null,"radioactivity",!0,!1,1],["bit","bit",["b"],"information",!1,!0,1],["btu","BTU",["btu"],"energy",!1,!0,1055.05585262],["byte","byte",null,"information",!1,!0,8],["candela","cd",null,"luminous_intensity",!0,!1,1],["candela per square metre","cd/m?",null,"luminance",!0,!1,1],["centigrade","C",["cel"],"temperature",!0,!1,1],["cubic ångström","ang3",["ang^3"],"volume",!1,!0,1e-30],["cubic foot","ft3",["ft^3"],"volume",!1,!0,.028316846592],["cubic inch","in3",["in^3"],"volume",!1,!0,16387064e-12],["cubic light-year","ly3",["ly^3"],"volume",!1,!0,846786664623715e-61],["cubic metre","m3",["m^3"],"volume",!0,!0,1],["cubic mile","mi3",["mi^3"],"volume",!1,!0,416818182544058e-5],["cubic nautical mile","Nmi3",["Nmi^3"],"volume",!1,!0,6352182208],["cubic Pica","Pica3",["Picapt3","Pica^3","Picapt^3"],"volume",!1,!0,758660370370369e-22],["cubic yard","yd3",["yd^3"],"volume",!1,!0,.764554857984],["cup","cup",null,"volume",!1,!0,.0002365882365],["dalton","Da",["u"],"mass",!1,!1,166053886282828e-41],["day","d",["day"],"time",!1,!0,86400],["degree","°",null,"angle",!1,!1,.0174532925199433],["dyne","dyn",["dy"],"force",!1,!0,1e-5],["electronvolt","eV",["ev"],"energy",!1,!0,1.60217656514141],["ell","ell",null,"length",!1,!0,1.143],["erg","erg",["e"],"energy",!1,!0,1e-7],["fahrenheit","F",["fah"],"temperature",!0,!1,1],["fluid ounce","oz",null,"volume",!1,!0,295735295625e-16],["foot","ft",null,"length",!1,!0,.3048],["foot-pound","flb",null,"energy",!1,!0,1.3558179483314],["gal","Gal",null,"acceleration",!1,!1,.01],["gallon","gal",null,"volume",!1,!0,.003785411784],["gauss","G",["ga"],"magnetic_flux_density",!1,!0,1],["grain","grain",null,"mass",!1,!0,647989e-10],["gram","g",null,"mass",!1,!0,.001],["gray","Gy",null,"absorbed_dose",!0,!1,1],["gross registered ton","GRT",["regton"],"volume",!1,!0,2.8316846592],["hectare","ha",null,"area",!1,!0,1e4],["henry","H",null,"inductance",!0,!1,1],["hertz","Hz",null,"frequency",!0,!1,1],["horsepower","HP",["h"],"power",!1,!0,745.69987158227],["horsepower-hour","HPh",["hh","hph"],"energy",!1,!0,2684519538e-3],["hour","h",["hr"],"time",!1,!0,3600],["imperial gallon (U.K.)","uk_gal",null,"volume",!1,!0,.00454609],["imperial hundredweight","lcwt",["uk_cwt","hweight"],"mass",!1,!0,50.802345],["imperial quart (U.K)","uk_qt",null,"volume",!1,!0,.0011365225],["imperial ton","brton",["uk_ton","LTON"],"mass",!1,!0,1016.046909],["inch","in",null,"length",!1,!0,.0254],["international acre","uk_acre",null,"area",!1,!0,4046.8564224],["IT calorie","cal",null,"energy",!1,!0,4.1868],["joule","J",null,"energy",!0,!0,1],["katal","kat",null,"catalytic_activity",!0,!1,1],["kelvin","K",["kel"],"temperature",!0,!0,1],["kilogram","kg",null,"mass",!0,!0,1],["knot","kn",null,"speed",!1,!0,.514444444444444],["light-year","ly",null,"length",!1,!0,9460730472580800],["litre","L",["l","lt"],"volume",!1,!0,.001],["lumen","lm",null,"luminous_flux",!0,!1,1],["lux","lx",null,"illuminance",!0,!1,1],["maxwell","Mx",null,"magnetic_flux",!1,!1,1e-18],["measurement ton","MTON",null,"volume",!1,!0,1.13267386368],["meter per hour","m/h",["m/hr"],"speed",!1,!0,.00027777777777778],["meter per second","m/s",["m/sec"],"speed",!0,!0,1],["meter per second squared","m?s??",null,"acceleration",!0,!1,1],["parsec","pc",["parsec"],"length",!1,!0,0x6da012f958ee1c],["meter squared per second","m?/s",null,"kinematic_viscosity",!0,!1,1],["metre","m",null,"length",!0,!0,1],["miles per hour","mph",null,"speed",!1,!0,.44704],["millimetre of mercury","mmHg",null,"pressure",!1,!1,133.322],["minute","?",null,"angle",!1,!1,.000290888208665722],["minute","min",["mn"],"time",!1,!0,60],["modern teaspoon","tspm",null,"volume",!1,!0,5e-6],["mole","mol",null,"amount_of_substance",!0,!1,1],["morgen","Morgen",null,"area",!1,!0,2500],["n.u. of action","?",null,"action",!1,!1,105457168181818e-48],["n.u. of mass","m?",null,"mass",!1,!1,910938261616162e-45],["n.u. of speed","c?",null,"speed",!1,!1,299792458],["n.u. of time","?/(me?c??)",null,"time",!1,!1,128808866778687e-35],["nautical mile","M",["Nmi"],"length",!1,!0,1852],["newton","N",null,"force",!0,!0,1],["œrsted","Oe ",null,"magnetic_field_intensity",!1,!1,79.5774715459477],["ohm","Ω",null,"electric_resistance",!0,!1,1],["ounce mass","ozm",null,"mass",!1,!0,.028349523125],["pascal","Pa",null,"pressure",!0,!1,1],["pascal second","Pa?s",null,"dynamic_viscosity",!0,!1,1],["pferdestärke","PS",null,"power",!1,!0,735.49875],["phot","ph",null,"illuminance",!1,!1,1e-4],["pica (1/6 inch)","pica",null,"length",!1,!0,.00035277777777778],["pica (1/72 inch)","Pica",["Picapt"],"length",!1,!0,.00423333333333333],["poise","P",null,"dynamic_viscosity",!1,!1,.1],["pond","pond",null,"force",!1,!0,.00980665],["pound force","lbf",null,"force",!1,!0,4.4482216152605],["pound mass","lbm",null,"mass",!1,!0,.45359237],["quart","qt",null,"volume",!1,!0,.000946352946],["radian","rad",null,"angle",!0,!1,1],["rankine","Rank",null,"temperature",!1,!0,1],["reaumur","Reau",null,"temperature",!1,!0,1],["second","?",null,"angle",!1,!1,484813681109536e-20],["second","s",["sec"],"time",!0,!0,1],["short hundredweight","cwt",["shweight"],"mass",!1,!0,45.359237],["siemens","S",null,"electrical_conductance",!0,!1,1],["sievert","Sv",null,"equivalent_dose",!0,!1,1],["slug","sg",null,"mass",!1,!0,14.59390294],["square ångström","ang2",["ang^2"],"area",!1,!0,1e-20],["square foot","ft2",["ft^2"],"area",!1,!0,.09290304],["square inch","in2",["in^2"],"area",!1,!0,64516e-8],["square light-year","ly2",["ly^2"],"area",!1,!0,895054210748189e17],["square meter","m?",null,"area",!0,!0,1],["square mile","mi2",["mi^2"],"area",!1,!0,2589988110336e-6],["square nautical mile","Nmi2",["Nmi^2"],"area",!1,!0,3429904],["square Pica","Pica2",["Picapt2","Pica^2","Picapt^2"],"area",!1,!0,1792111111111e-17],["square yard","yd2",["yd^2"],"area",!1,!0,.83612736],["statute mile","mi",null,"length",!1,!0,1609.344],["steradian","sr",null,"solid_angle",!0,!1,1],["stilb","sb",null,"luminance",!1,!1,1e-4],["stokes","St",null,"kinematic_viscosity",!1,!1,1e-4],["stone","stone",null,"mass",!1,!0,6.35029318],["tablespoon","tbs",null,"volume",!1,!0,147868e-10],["teaspoon","tsp",null,"volume",!1,!0,492892e-11],["tesla","T",null,"magnetic_flux_density",!0,!0,1],["thermodynamic calorie","c",null,"energy",!1,!0,4.184],["ton","ton",null,"mass",!1,!0,907.18474],["tonne","t",null,"mass",!1,!1,1e3],["U.K. pint","uk_pt",null,"volume",!1,!0,.00056826125],["U.S. bushel","bushel",null,"volume",!1,!0,.03523907],["U.S. oil barrel","barrel",null,"volume",!1,!0,.158987295],["U.S. pint","pt",["us_pt"],"volume",!1,!0,.000473176473],["U.S. survey mile","survey_mi",null,"length",!1,!0,1609.347219],["U.S. survey/statute acre","us_acre",null,"area",!1,!0,4046.87261],["volt","V",null,"voltage",!0,!1,1],["watt","W",null,"power",!0,!0,1],["watt-hour","Wh",["wh"],"energy",!1,!0,3600],["weber","Wb",null,"magnetic_flux",!0,!1,1],["yard","yd",null,"length",!1,!0,.9144],["year","yr",null,"time",!1,!0,31557600]]);A(this,"_binaryPrefixes",{Yi:["yobi",80,12089258196146292e8,"Yi","yotta"],Zi:["zebi",70,11805916207174113e5,"Zi","zetta"],Ei:["exbi",60,1152921504606847e3,"Ei","exa"],Pi:["pebi",50,0x4000000000000,"Pi","peta"],Ti:["tebi",40,1099511627776,"Ti","tera"],Gi:["gibi",30,1073741824,"Gi","giga"],Mi:["mebi",20,1048576,"Mi","mega"],ki:["kibi",10,1024,"ki","kilo"]});A(this,"_unitPrefixes",{Y:["yotta",1e24,"Y"],Z:["zetta",1e21,"Z"],E:["exa",1e18,"E"],P:["peta",1e15,"P"],T:["tera",1e12,"T"],G:["giga",1e9,"G"],M:["mega",1e6,"M"],k:["kilo",1e3,"k"],h:["hecto",100,"h"],e:["dekao",10,"e"],d:["deci",.1,"d"],c:["centi",.01,"c"],m:["milli",.001,"m"],u:["micro",1e-6,"u"],n:["nano",1e-9,"n"],p:["pico",1e-12,"p"],f:["femto",1e-15,"f"],a:["atto",1e-18,"a"],z:["zepto",1e-21,"z"],y:["yocto",1e-24,"y"]})}calculate(e,t,r){const{isError:n,errorObject:s,variants:a}=q(e,t,r);if(n)return s;const[u,c,l]=a,f=+u.getValue(),m=`${c.getValue()}`,d=`${l.getValue()}`;if(Number.isNaN(f))return g.create(h.VALUE);let C,_=1,E,R=1;const{_from:b,_to:N}=this._lookupFromAndToUnits(m,d);if(C=b,E=N,C===null){const{_from:S,_fromMultiplier:D}=this._lookupFromPrefix(m);C=S,_=D}if(E===null){const{_to:S,_toMultiplier:D}=this._lookupToPrefix(d);E=S,R=D}if(C===null||E===null||C[3]!==E[3])return g.create(h.NA);let V;return C[3]==="temperature"?(V=this._getTemperatureConversion(f,C[1],E[1]),V=+V.toFixed(2)):V=f*C[6]*_/(E[6]*R),y.create(V)}_lookupFromAndToUnits(e,t){let r=null,n=null,s;for(let a=0;a<this._units.length;a++)s=this._units[a][2]===null?[]:this._units[a][2],(this._units[a][1]===e||s.indexOf(e)>=0)&&(r=this._units[a]),(this._units[a][1]===t||s.indexOf(t)>=0)&&(n=this._units[a]);return{_from:r,_to:n}}_lookupFromPrefix(e){let t=null,r=1,n=e,s;const a=this._binaryPrefixes[e.substring(0,2)];let u=this._unitPrefixes[e.substring(0,1)];e.substring(0,2)==="da"&&(u=["dekao",10,"da"]),a?(r=a[2],n=e.substring(2)):u&&(r=u[1],n=e.substring(u[2].length));for(let c=0;c<this._units.length;c++)s=this._units[c][2]===null?[]:this._units[c][2],(this._units[c][1]===n||s.indexOf(n)>=0)&&(t=this._units[c]);return{_from:t,_fromMultiplier:r}}_lookupToPrefix(e){let t=null,r=1,n=e,s;const a=this._binaryPrefixes[e.substring(0,2)];let u=this._unitPrefixes[e.substring(0,1)];e.substring(0,2)==="da"&&(u=["dekao",10,"da"]),a?(r=a[2],n=e.substring(2)):u&&(r=u[1],n=e.substring(u[2].length));for(let c=0;c<this._units.length;c++)s=this._units[c][2]===null?[]:this._units[c][2],(this._units[c][1]===n||s.indexOf(n)>=0)&&(t=this._units[c]);return{_to:t,_toMultiplier:r}}_getTemperatureConversion(e,t,r){switch(t){case"C":return this._centigradeConversion(e,r);case"F":return this._fahrenheitConversion(e,r);case"K":return this._kelvinConversion(e,r);case"Rank":return this._rankineConversion(e,r);case"Reau":return this._reaumurConversion(e,r);default:return e}}_centigradeConversion(e,t){switch(t){case"F":return e*9/5+32;case"K":return e+273.15;case"Rank":return(e+273.15)*9/5;case"Reau":return e*4/5;default:return e}}_fahrenheitConversion(e,t){switch(t){case"C":return(e-32)*5/9;case"K":return(e-32)*5/9+273.15;case"Rank":return e+459.67;case"Reau":return(e-32)*4/9;default:return e}}_kelvinConversion(e,t){switch(t){case"C":return e-273.15;case"F":return(e-273.15)*9/5+32;case"Rank":return e*9/5;case"Reau":return(e-273.15)*4/5;default:return e}}_rankineConversion(e,t){switch(t){case"C":return(e-491.67)*5/9;case"F":return e-459.67;case"K":return e*5/9;case"Reau":return(e-491.67)*4/9;default:return e}}_reaumurConversion(e,t){switch(t){case"C":return e*5/4;case"F":return e*9/4+32;case"K":return e*5/4+273.15;case"Rank":return e*9/4+491.67;default:return e}}}class Tg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){if(e.isNull())return g.create(h.NA);let r=0;if(t){const{isError:f,errorObject:m,variants:d}=q(t);if(f)return m;const[C]=d;if(r=Math.floor(+C.getValue()),Number.isNaN(r))return g.create(h.VALUE);if(r<0||r>10)return g.create(h.NUM)}const{isError:n,errorObject:s,variants:a}=q(e);if(n)return s;const[u]=a,c=Math.trunc(+u.getValue());if(Number.isNaN(c))return g.create(h.VALUE);if(!/^-?[0-9]{1,3}$/.test(`${c}`)||c<-512||c>511)return g.create(h.NUM);let l;if(c<0){const f=(512+c).toString(2);l=`1${"0".repeat(9-f.length)}${f}`}else if(l=Number.parseInt(`${c}`,10).toString(2),t){if(r<l.length)return g.create(h.NUM);l="0".repeat(r-l.length)+l}return T.create(l)}}class vg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){if(e.isNull())return g.create(h.NA);let r=0;if(t){const{isError:f,errorObject:m,variants:d}=q(t);if(f)return m;const[C]=d;if(r=Math.floor(+C.getValue()),Number.isNaN(r))return g.create(h.VALUE);if(r<0||r>10)return g.create(h.NUM)}const{isError:n,errorObject:s,variants:a}=q(e);if(n)return s;const[u]=a,c=Math.trunc(+u.getValue());if(Number.isNaN(c))return g.create(h.VALUE);if(!/^-?[0-9]{1,12}$/.test(`${c}`)||c<-549755813888||c>549755813887)return g.create(h.NUM);let l;if(c<0)l=(1099511627776+c).toString(16);else if(l=Number.parseInt(`${c}`,10).toString(16),t){if(r<l.length)return g.create(h.NUM);l="0".repeat(r-l.length)+l}return T.create(l.toLocaleUpperCase())}}class Ig extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){if(e.isNull())return g.create(h.NA);let r=0;if(t){const{isError:f,errorObject:m,variants:d}=q(t);if(f)return m;const[C]=d;if(r=Math.floor(+C.getValue()),Number.isNaN(r))return g.create(h.VALUE);if(r<0||r>10)return g.create(h.NUM)}const{isError:n,errorObject:s,variants:a}=q(e);if(n)return s;const[u]=a,c=Math.trunc(+u.getValue());if(Number.isNaN(c))return g.create(h.VALUE);if(!/^-?[0-9]{1,9}$/.test(`${c}`)||c<-536870912||c>536870911)return g.create(h.NUM);let l;if(c<0)l=(1073741824+c).toString(8);else if(l=Number.parseInt(`${c}`,10).toString(8),t){if(r<l.length)return g.create(h.NUM);l="0".repeat(r-l.length)+l}return T.create(l)}}class Fg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){const r=t!=null?t:y.create(0),{isError:n,errorObject:s,variants:a}=q(e,r);if(n)return s;const[u,c]=a,l=+u.getValue(),f=+c.getValue();if(Number.isNaN(l)||Number.isNaN(f))return g.create(h.VALUE);const m=l===f?1:0;return y.create(m)}}class Bg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){let r;if(t){const{isError:n,errorObject:s,variants:a}=q(e,t);if(n)return s;const[u,c]=a,l=+u.getValue(),f=+c.getValue();if(Number.isNaN(l)||Number.isNaN(f))return g.create(h.VALUE);r=Kt(f)-Kt(l)}else{const{isError:n,errorObject:s,variants:a}=q(e);if(n)return s;const[u]=a,c=+u.getValue();if(Number.isNaN(c))return g.create(h.VALUE);r=Kt(c)}return y.create(r)}}class kg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=q(e);if(t)return r;const[s]=n,a=+s.getValue();if(Number.isNaN(a))return g.create(h.VALUE);const u=Kt(a);return y.create(u)}}class $g extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=q(e);if(t)return r;const[s]=n,a=+s.getValue();if(Number.isNaN(a))return g.create(h.VALUE);const u=ha(a);return y.create(u)}}class Yg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=q(e);if(t)return r;const[s]=n,a=+s.getValue();if(Number.isNaN(a))return g.create(h.VALUE);const u=ha(a);return y.create(u)}}var X=(i=>(i.BESSELI="BESSELI",i.BESSELJ="BESSELJ",i.BESSELK="BESSELK",i.BESSELY="BESSELY",i.BIN2DEC="BIN2DEC",i.BIN2HEX="BIN2HEX",i.BIN2OCT="BIN2OCT",i.BITAND="BITAND",i.BITLSHIFT="BITLSHIFT",i.BITOR="BITOR",i.BITRSHIFT="BITRSHIFT",i.BITXOR="BITXOR",i.COMPLEX="COMPLEX",i.CONVERT="CONVERT",i.DEC2BIN="DEC2BIN",i.DEC2HEX="DEC2HEX",i.DEC2OCT="DEC2OCT",i.DELTA="DELTA",i.ERF="ERF",i.ERF_PRECISE="ERF.PRECISE",i.ERFC="ERFC",i.ERFC_PRECISE="ERFC.PRECISE",i.GESTEP="GESTEP",i.HEX2BIN="HEX2BIN",i.HEX2DEC="HEX2DEC",i.HEX2OCT="HEX2OCT",i.IMABS="IMABS",i.IMAGINARY="IMAGINARY",i.IMARGUMENT="IMARGUMENT",i.IMCONJUGATE="IMCONJUGATE",i.IMCOS="IMCOS",i.IMCOSH="IMCOSH",i.IMCOT="IMCOT",i.IMCOTH="IMCOTH",i.IMCSC="IMCSC",i.IMCSCH="IMCSCH",i.IMDIV="IMDIV",i.IMEXP="IMEXP",i.IMLN="IMLN",i.IMLOG="IMLOG",i.IMLOG10="IMLOG10",i.IMLOG2="IMLOG2",i.IMPOWER="IMPOWER",i.IMPRODUCT="IMPRODUCT",i.IMREAL="IMREAL",i.IMSEC="IMSEC",i.IMSECH="IMSECH",i.IMSIN="IMSIN",i.IMSINH="IMSINH",i.IMSQRT="IMSQRT",i.IMSUB="IMSUB",i.IMSUM="IMSUM",i.IMTAN="IMTAN",i.IMTANH="IMTANH",i.OCT2BIN="OCT2BIN",i.OCT2DEC="OCT2DEC",i.OCT2HEX="OCT2HEX",i))(X||{});class Hg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){if(e.isNull())return g.create(h.NA);const r=t!=null?t:y.create(0),{isError:n,errorObject:s,variants:a}=q(e,r);if(n)return s;const[u,c]=a,l=+u.getValue(),f=+c.getValue();if(Number.isNaN(l)||Number.isNaN(f))return g.create(h.VALUE);const m=l>=f?1:0;return y.create(m)}}class Gg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){if(e.isNull())return g.create(h.NA);let r=0;if(t){const{isError:d,errorObject:C,variants:_}=q(t);if(d)return C;const[E]=_;if(r=Math.floor(+E.getValue()),Number.isNaN(r))return g.create(h.VALUE);if(r<0||r>10)return g.create(h.NUM)}const{isError:n,errorObject:s,variants:a}=q(e);if(n)return s;const[u]=a,c=`${u.getValue()}`;if(!ma(c))return g.create(h.NUM);const l=c.length===10&&c.substring(0,1).toLocaleUpperCase()==="F",f=l?Number.parseInt(c,16)-1099511627776:Number.parseInt(c,16);if(f<-512||f>511)return g.create(h.NUM);let m;if(l){const d=(512+f).toString(2);m=`1${"0".repeat(9-d.length)}${d}`}else if(m=f.toString(2),t){if(r<m.length)return g.create(h.NUM);m="0".repeat(r-m.length)+m}return T.create(m)}}class Wg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`;if(!ma(a))return g.create(h.NUM);let u=Number.parseInt(a,16);return u>=549755813888&&(u-=1099511627776),y.create(u)}}class Qg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){if(e.isNull())return g.create(h.NA);let r=0;if(t){const{isError:m,errorObject:d,variants:C}=q(t);if(m)return d;const[_]=C;if(r=Math.floor(+_.getValue()),Number.isNaN(r))return g.create(h.VALUE);if(r<0||r>10)return g.create(h.NUM)}const{isError:n,errorObject:s,variants:a}=q(e);if(n)return s;const[u]=a,c=`${u.getValue()}`;if(!ma(c))return g.create(h.NUM);const l=Number.parseInt(c,16);if(l>536870911&&l<0xffe0000000)return g.create(h.NUM);let f;if(l>=0xffe0000000)f=(l-0xffc0000000).toString(8);else if(f=l.toString(8),t){if(r<f.length)return g.create(h.NUM);f="0".repeat(r-f.length)+f}return T.create(f)}}class qg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new ge(a);if(u.isError())return g.create(h.NUM);const c=u.Abs();return y.create(c)}}class Xg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new ge(a);if(u.isError())return g.create(h.NUM);const c=u.getINum();return y.create(c)}}class Kg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new ge(a);if(u.isError())return g.create(h.NUM);if(u.getRealNum()===0&&u.getINum()===0)return g.create(h.DIV_BY_ZERO);const c=u.Argument();return y.create(c)}}class Zg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new ge(a);if(u.isError())return g.create(h.NUM);const c=u.Conjugate();return typeof c=="number"||M.isRealNum(c)?y.create(+c):T.create(c)}}class zg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new ge(a);if(u.isError())return g.create(h.NUM);const c=u.Cos();return typeof c=="number"||M.isRealNum(c)?y.create(+c):T.create(c)}}class Jg extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new ge(a);if(u.isError())return g.create(h.NUM);const c=u.Cosh();return u.isError()?g.create(h.NUM):typeof c=="number"||M.isRealNum(c)?y.create(+c):T.create(c)}}class e1 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new ge(a);if(u.isError()||u.getRealNum()===0&&u.getINum()===0)return g.create(h.NUM);const c=u.Cot();return typeof c=="number"||M.isRealNum(c)?y.create(+c):T.create(c)}}class t1 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new ge(a);if(u.isError()||u.getRealNum()===0&&u.getINum()===0)return g.create(h.NUM);const c=u.Coth();return u.isError()?g.create(h.NUM):typeof c=="number"||M.isRealNum(c)?y.create(+c):T.create(c)}}class r1 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new ge(a);if(u.isError()||u.getRealNum()===0&&u.getINum()===0)return g.create(h.NUM);const c=u.Csc();return typeof c=="number"||M.isRealNum(c)?y.create(+c):T.create(c)}}class n1 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new ge(a);if(u.isError()||u.getRealNum()===0&&u.getINum()===0)return g.create(h.NUM);const c=u.Csch();return typeof c=="number"||M.isRealNum(c)?y.create(+c):T.create(c)}}class s1 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return g.create(h.NA);const{isError:r,errorObject:n,variants:s}=q(e,t);if(r)return n;const[a,u]=s,c=`${a.getValue()}`,l=`${u.getValue()}`,f=new ge(c),m=new ge(l);if(f.isError()||m.isError()||f.isDifferentSuffixes(m)||m.getRealNum()===0&&m.getINum()===0)return g.create(h.NUM);const d=f.Div(m);return typeof d=="number"||M.isRealNum(d)?y.create(+d):T.create(d)}}class a1 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new ge(a);if(u.isError())return g.create(h.NUM);const c=u.Exp();return u.isError()?g.create(h.NUM):typeof c=="number"||M.isRealNum(c)?y.create(+c):T.create(c)}}class i1 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new ge(a);if(u.isError()||u.getRealNum()===0&&u.getINum()===0)return g.create(h.NUM);const c=u.Ln();return typeof c=="number"||M.isRealNum(c)?y.create(+c):T.create(c)}}class o1 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,variants:s}=q(e);if(r)return n;const[a]=s;let u=t!=null?t:y.create(10);if(u.isArray()){const R=u.getRowCount(),b=u.getColumnCount();if(R>1||b>1)return g.create(h.VALUE);u=u.get(0,0)}const{isError:c,errorObject:l,variants:f}=B(u);if(c)return l;const[m]=f,d=`${a.getValue()}`,C=+m.getValue(),_=new ge(d);if(_.isError()||_.getRealNum()===0&&_.getINum()===0||C<=0)return g.create(h.NUM);const E=_.Log(C);return _.isError()?g.create(h.NUM):typeof E=="number"||M.isRealNum(E)?y.create(+E):T.create(E)}}class u1 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new ge(a);if(u.isError()||u.getRealNum()===0&&u.getINum()===0)return g.create(h.NUM);const c=u.Log(2);return typeof c=="number"||M.isRealNum(c)?y.create(+c):T.create(c)}}class c1 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new ge(a);if(u.isError()||u.getRealNum()===0&&u.getINum()===0)return g.create(h.NUM);const c=u.Log(10);return typeof c=="number"||M.isRealNum(c)?y.create(+c):T.create(c)}}class l1 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return g.create(h.NA);const{isError:r,errorObject:n,variants:s}=q(e,t);if(r)return n;const[a,u]=s,c=`${a.getValue()}`,l=new ge(c);if(l.isError())return g.create(h.NUM);const f=+u.getValue();if(Number.isNaN(f))return g.create(h.VALUE);const m=l.Power(f);return l.isError()?g.create(h.NUM):typeof m=="number"||M.isRealNum(m)?y.create(+m):T.create(m)}}class f1 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t="";for(let r=0;r<e.length;r++){if(t instanceof g)return t;const n=e[r];if(n.isArray()){let s=!1,a;if(n.iterator(u=>{if(t=this._handleSingleObject(u,t),t instanceof g)return s=!0,a=t,!1}),s)return a}else t=this._handleSingleObject(n,t)}return t instanceof g?t:typeof t=="number"||M.isRealNum(t)?y.create(+t):T.create(t)}_handleSingleObject(e,t){let r=t;if(e.isError())return e;if(e.isBoolean())return g.create(h.VALUE);const n=`${e.getValue()}`;if(typeof t!="number"&&!t){const s=new ge(n);if(s.isError())return g.create(h.NUM);r=s.toString()}else{const s=new ge(t),a=new ge(n);if(s.isError()||a.isError())return g.create(h.NUM);if(s.isDifferentSuffixes(a))return g.create(h.VALUE);r=s.Product(a)}return r}}class m1 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new ge(a);if(u.isError())return g.create(h.NUM);const c=u.getRealNum();return y.create(c)}}class h1 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new ge(a);if(u.isError())return g.create(h.NUM);const c=u.Sec();return typeof c=="number"||M.isRealNum(c)?y.create(+c):T.create(c)}}class g1 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new ge(a);if(u.isError())return g.create(h.NUM);const c=u.Sech();return typeof c=="number"||M.isRealNum(c)?y.create(+c):T.create(c)}}class d1 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new ge(a);if(u.isError())return g.create(h.NUM);const c=u.Sin();return typeof c=="number"||M.isRealNum(c)?y.create(+c):T.create(c)}}class C1 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new ge(a);if(u.isError())return g.create(h.NUM);const c=u.Sinh();return u.isError()?g.create(h.NUM):typeof c=="number"||M.isRealNum(c)?y.create(+c):T.create(c)}}class _1 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new ge(a);if(u.isError())return g.create(h.NUM);if(u.getRealNum()===0&&u.getINum()===0)return y.create(0);const c=u.Sqrt();return typeof c=="number"||M.isRealNum(c)?y.create(+c):T.create(c)}}class A1 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return g.create(h.NA);const{isError:r,errorObject:n,variants:s}=q(e,t);if(r)return n;const[a,u]=s,c=`${a.getValue()}`,l=`${u.getValue()}`,f=new ge(c),m=new ge(l);if(f.isError()||m.isError()||f.isDifferentSuffixes(m))return g.create(h.NUM);const d=f.Sub(m);return typeof d=="number"||M.isRealNum(d)?y.create(+d):T.create(d)}}class E1 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t="";for(let r=0;r<e.length;r++){if(t instanceof g)return t;const n=e[r];if(n.isArray()){let s=!1,a;if(n.iterator(u=>{if(t=this._handleSingleObject(u,t),t instanceof g)return s=!0,a=t,!1}),s)return a}else t=this._handleSingleObject(n,t)}return t instanceof g?t:typeof t=="number"||M.isRealNum(t)?y.create(+t):T.create(t)}_handleSingleObject(e,t){let r=t;if(e.isError())return e;if(e.isBoolean())return g.create(h.VALUE);const n=`${e.getValue()}`;if(typeof t!="number"&&!t){const s=new ge(n);if(s.isError())return g.create(h.NUM);r=s.toString()}else{const s=new ge(t),a=new ge(n);if(s.isError()||a.isError())return g.create(h.NUM);if(s.isDifferentSuffixes(a))return g.create(h.VALUE);r=s.Sum(a)}return r}}class R1 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new ge(a);if(u.isError())return g.create(h.NUM);const c=u.Tan();return typeof c=="number"||M.isRealNum(c)?y.create(+c):T.create(c)}}class b1 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new ge(a);if(u.isError())return g.create(h.NUM);const c=u.Tanh();return u.isError()?g.create(h.NUM):typeof c=="number"||M.isRealNum(c)?y.create(+c):T.create(c)}}class y1 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){if(e.isNull())return g.create(h.NA);let r=0;if(t){const{isError:d,errorObject:C,variants:_}=q(t);if(d)return C;const[E]=_;if(r=Math.floor(+E.getValue()),Number.isNaN(r))return g.create(h.VALUE);if(r<0||r>10)return g.create(h.NUM)}const{isError:n,errorObject:s,variants:a}=q(e);if(n)return s;const[u]=a,c=`${u.getValue()}`;if(!fa(c))return g.create(h.NUM);const l=c.length===10&&c.substring(0,1)==="7",f=l?Number.parseInt(c,8)-1073741824:Number.parseInt(c,8);if(f<-512||f>511)return g.create(h.NUM);let m;if(l){const d=(512+f).toString(2);m=`1${"0".repeat(9-d.length)}${d}`}else if(m=f.toString(2),t){if(r<m.length)return g.create(h.NUM);m="0".repeat(r-m.length)+m}return T.create(m)}}class N1 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`;if(!fa(a))return g.create(h.NUM);let u=Number.parseInt(a,8);return u>=536870912&&(u-=1073741824),y.create(u)}}class p1 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){if(e.isNull())return g.create(h.NA);let r=0;if(t){const{isError:m,errorObject:d,variants:C}=q(t);if(m)return d;const[_]=C;if(r=Math.floor(+_.getValue()),Number.isNaN(r))return g.create(h.VALUE);if(r<0||r>10)return g.create(h.NUM)}const{isError:n,errorObject:s,variants:a}=q(e);if(n)return s;const[u]=a,c=`${u.getValue()}`;if(!fa(c))return g.create(h.NUM);const l=Number.parseInt(c,8);let f;if(l>=536870912)f=`ff${(l+3221225472).toString(16)}`;else if(f=l.toString(16),t){if(r<f.length)return g.create(h.NUM);f="0".repeat(r-f.length)+f}return T.create(f.toLocaleUpperCase())}}const xu=[[yg,X.BESSELI],[Ng,X.BESSELJ],[pg,X.BESSELK],[Vg,X.BESSELY],[Og,X.BIN2DEC],[Sg,X.BIN2HEX],[Mg,X.BIN2OCT],[Dg,X.BITAND],[wg,X.BITLSHIFT],[Lg,X.BITOR],[Pg,X.BITRSHIFT],[jg,X.BITXOR],[xg,X.COMPLEX],[Ug,X.CONVERT],[Tg,X.DEC2BIN],[vg,X.DEC2HEX],[Ig,X.DEC2OCT],[Fg,X.DELTA],[Bg,X.ERF],[kg,X.ERF_PRECISE],[$g,X.ERFC],[Yg,X.ERFC_PRECISE],[Hg,X.GESTEP],[Gg,X.HEX2BIN],[Wg,X.HEX2DEC],[Qg,X.HEX2OCT],[qg,X.IMABS],[Xg,X.IMAGINARY],[Kg,X.IMARGUMENT],[Zg,X.IMCONJUGATE],[zg,X.IMCOS],[Jg,X.IMCOSH],[e1,X.IMCOT],[t1,X.IMCOTH],[r1,X.IMCSC],[n1,X.IMCSCH],[s1,X.IMDIV],[a1,X.IMEXP],[i1,X.IMLN],[o1,X.IMLOG],[c1,X.IMLOG10],[u1,X.IMLOG2],[l1,X.IMPOWER],[f1,X.IMPRODUCT],[m1,X.IMREAL],[h1,X.IMSEC],[g1,X.IMSECH],[d1,X.IMSIN],[C1,X.IMSINH],[_1,X.IMSQRT],[A1,X.IMSUB],[E1,X.IMSUM],[R1,X.IMTAN],[b1,X.IMTANH],[y1,X.OCT2BIN],[N1,X.OCT2DEC],[p1,X.OCT2HEX]];var ee=(i=>(i.ACCRINT="ACCRINT",i.ACCRINTM="ACCRINTM",i.AMORDEGRC="AMORDEGRC",i.AMORLINC="AMORLINC",i.COUPDAYBS="COUPDAYBS",i.COUPDAYS="COUPDAYS",i.COUPDAYSNC="COUPDAYSNC",i.COUPNCD="COUPNCD",i.COUPNUM="COUPNUM",i.COUPPCD="COUPPCD",i.CUMIPMT="CUMIPMT",i.CUMPRINC="CUMPRINC",i.DB="DB",i.DDB="DDB",i.DISC="DISC",i.DOLLARDE="DOLLARDE",i.DOLLARFR="DOLLARFR",i.DURATION="DURATION",i.EFFECT="EFFECT",i.FV="FV",i.FVSCHEDULE="FVSCHEDULE",i.INTRATE="INTRATE",i.IPMT="IPMT",i.IRR="IRR",i.ISPMT="ISPMT",i.MDURATION="MDURATION",i.MIRR="MIRR",i.NOMINAL="NOMINAL",i.NPER="NPER",i.NPV="NPV",i.ODDFPRICE="ODDFPRICE",i.ODDFYIELD="ODDFYIELD",i.ODDLPRICE="ODDLPRICE",i.ODDLYIELD="ODDLYIELD",i.PDURATION="PDURATION",i.PMT="PMT",i.PPMT="PPMT",i.PRICE="PRICE",i.PRICEDISC="PRICEDISC",i.PRICEMAT="PRICEMAT",i.PV="PV",i.RATE="RATE",i.RECEIVED="RECEIVED",i.RRI="RRI",i.SLN="SLN",i.SYD="SYD",i.TBILLEQ="TBILLEQ",i.TBILLPRICE="TBILLPRICE",i.TBILLYIELD="TBILLYIELD",i.VDB="VDB",i.XIRR="XIRR",i.XNPV="XNPV",i.YIELD="YIELD",i.YIELDDISC="YIELDDISC",i.YIELDMAT="YIELDMAT",i))(ee||{});function ts(i,o,e,t){const r=vt(i,o,e),{days:n}=_e(r,i,t);return n}function Xe(i,o,e,t){let r;if(t===1){const n=vt(i,o,e);let s=ie(n);s=Rr(s,12/e);const a=be(s);n<0&&e===1?r=365:r=a-n}else t===3?r=365/e:r=360/e;return r}function Uu(i,o,e){const t=ie(i);let r=ie(o);for(r.setUTCFullYear(t.getUTCFullYear()),r<t&&r.setUTCFullYear(r.getUTCFullYear()+1);r>t;)r=Rr(r,-12/e);return r=Rr(r,12/e),be(r)}function er(i,o,e){let t=0;const r=ie(i);let n=ie(o);for(;n>r;)n=Rr(n,-12/e),t++;return t}function vt(i,o,e){const t=ie(i);let r=ie(o);for(r.setUTCFullYear(t.getUTCFullYear()),r<t&&r.setUTCFullYear(r.getUTCFullYear()+1);r>t;)r=Rr(r,-12/e);return be(r)}function Tu(i,o,e,t,r,n){const s=ts(i,o,r,n),a=Xe(i,o,r,n),u=er(i,o,r),c=(a-s)/a-1,l=t/r+1,f=e*100/r;let m=0,d=0;for(let E=1;E<=u;E++){const R=E+c,b=f/l**R;m+=R*b,d+=b}const C=u+c,_=100/l**C;return m+=C*_,d+=_,m/d/r}function Hr(i,o,e,t,r){let n;if(i===0)n=(e+t)/o;else{const s=(1+i)**o;n=r===1?(t*i/(s-1)+e*i/(1-1/s))/(1+i):t*i/(s-1)+e*i/(1-1/s)}return-n}function tr(i,o,e,t,r){let n;if(i===0)n=t+e*o;else{if(i===-1&&o===0)return Number.NaN;const s=(1+i)**o;n=r===1?t*s+e*(1+i)*(s-1)/i:t*s+e*(s-1)/i}return-n}function vu(i,o,e,t,r,n){const s=Hr(i,e,t,r,n);return(o===1?n===1?0:-t:n===1?tr(i,o-2,s,t,1)-s:tr(i,o-1,s,t,0))*i}function Iu(i,o){let e=0;for(let t=1;t<=o.length;t++)e+=o[t-1]/(1+i)**t;return e}function Fu(i,o,e,t,r,n,s,a,u){const c=rr(e,t,u),l=Xe(i,t,a,u);return c<l?V1(i,o,e,t,r,n,s,a,u,c,l):O1(i,o,e,t,r,n,s,a,u,l)}function V1(i,o,e,t,r,n,s,a,u,c,l){let f=0;const m=er(i,o,a),d=rr(i,t,u);f+=s/(1+n/a)**(m-1+d/l),f+=100*r/a*c/l/(1+n/a)**(d/l);for(let _=2;_<=m;_++)f+=100*r/a/(1+n/a)**(_-1+d/l);const C=rr(e,i,u);return f-=100*r/a*C/l,f}function O1(i,o,e,t,r,n,s,a,u,c){let l=0;const f=er(t,o,a),m=S1(t,i,12/a);let d;if(u===2||u===3){const b=Uu(i,t,a);d=rr(i,b,u)}else{const b=vt(i,t,a),{days:N}=_e(b,i,u);d=c-N}l+=s/(1+n/a)**(f+m+d/c);const C=er(e,t,a);let _=t,E=0,R=0;for(let b=C;b>=1;b--){const N=nr(_,-12/a,!1),V=u===1?rr(N,_,u):c,S=b>1?V:rr(e,_,u);E+=S/V;const D=e>N?e:N,L=i<_?i:_,P=rr(D,L,u);R+=P/V,_=N}l+=100*r/a*E/(1+n/a)**(m+d/c);for(let b=1;b<=f;b++)l+=100*r/a/(1+n/a)**(b+m+d/c);return l-=100*r/a*R,l}function rr(i,o,e){const{days:t}=_e(i,o,e);return i<o?t:0}function Bu(i,o,e){const t=ie(i),r=t.getUTCFullYear(),n=t.getUTCMonth(),s=t.getUTCDate(),a=Er(r,n,s),u=ie(o),c=u.getUTCFullYear(),l=u.getUTCMonth(),f=u.getUTCDate(),m=Er(c,l,f);return!(s!==f&&!(a&&m)||Math.abs((c-r)*12+(l-n))%(12/e)!==0)}function br(i,o,e){return vt(i,o,e)>=0}function nr(i,o,e){let t=ie(i);if(t=Rr(t,o),e){const r=t.getUTCFullYear(),n=t.getUTCMonth(),s=Yr(r,n);t.setUTCDate(s)}return be(t)}function S1(i,o,e,t){const r=ie(i),n=ie(o),s=r.getUTCFullYear(),a=r.getUTCMonth(),u=r.getUTCDate(),c=n.getUTCFullYear(),l=n.getUTCMonth(),f=n.getUTCDate(),m=Er(s,a,u),d=!m&&a!==1&&u>28&&u<Yr(s,a)?Er(c,l,f):m,C=nr(o,0,d);let _=1+ +(o<C),E=nr(C,e,d);for(;!(e>0?E>=o:E<=o);)E=nr(E,e,d),_++;return _}function La(i,o){let n=1,s=0,a=i,u;for(;n>1e-7&&s<500;){const c=(o(a+1e-7)-o(a-1e-7))/2e-7;u=a-o(a)/c,s++,n=Math.abs(u-a),a=u}return Number.isNaN(a)||Math.abs(a)===1/0||s===500?M1(i,o):a}function M1(i,o){const r=Number.MAX_VALUE,n=-1,s=1.6;let a=i-.01<=n?n+1e-7:i-.01,u=i+.01>=r?r-1e-7:i+.01,c,l,f=0;if(i<=n||i>=r)return g.create(h.NUM);for(let E=0;E<60;E++){c=a<=n?n+1e-7:a,l=u>=r?r-1e-7:u;const R=o(c),b=o(l);if(R*b<=0)break;if(R*b>0)a=c+s*(c-l),u=l+s*(l-c);else return g.create(h.NUM);if(E===59)return g.create(h.NUM)}c=c,l=l;let m=o(c);const d=o(l);let C,_;if(Math.abs(m)<1e-7||Math.abs(d)<1e-7)return g.create(h.NUM);do _=c+(l-c)/2,C=o(_),m*C<0?l=_:c=_,m=o(c),f++;while(Math.abs(C)>1e-7&&f<60);return _}function rs(i,o,e,t,r,n,s){const a=er(i,o,n),u=Xe(i,o,n,s),c=ts(i,o,n,s);if(a===1){const m=u-c,d=100*e/n+r,C=t/n*m/u+1,_=100*e/n*c/u;return d/C-_}const l=u-c;let f=r/(1+t/n)**(a-1+l/u);for(let m=1;m<=a;m++)f+=100*e/n/(1+t/n)**(m-1+l/u);return f-=100*e/n*c/u,f}function Pa(i,o,e,t,r){let n=0,s=r/e;s>=1?(s=1,n=t===1?i:0):n=i*(1-s)**(t-1);const a=i*(1-s)**t;let u=0;return a<o?u=n-o:u=n-a,u<0&&(u=0),u}class D1 extends p{constructor(){super(...arguments);A(this,"minParams",6);A(this,"maxParams",8)}calculate(e,t,r,n,s,a,u,c){const l=u!=null?u:y.create(0),f=c!=null?c:F.create(!0),{isError:m,errorObject:d,variants:C}=q(e,t,r,n,s,a,l);if(m)return d;const[_,E,R,b,N,V,S]=C,D=G(_);if(typeof D!="number")return D;const L=G(E);if(typeof L!="number")return L;const P=G(R);if(typeof P!="number")return P;const j=+b.getValue(),I=+N.getValue(),v=Math.floor(+V.getValue()),Y=Math.floor(+S.getValue()),Q=+f.getValue();return Number.isNaN(j)||Number.isNaN(I)||Number.isNaN(v)||Number.isNaN(Y)||Number.isNaN(Q)?g.create(h.VALUE):j<=0||I<=0||![1,2,4].includes(v)||Y<0||Y>4||Math.floor(D)>=Math.floor(P)?g.create(h.NUM):this._getResult(D,L,P,j,I,v,Y,Q)}_getResult(e,t,r,n,s,a,u,c){let l=vt(e,t,a);if(l<=0)return y.create(0);l=vt(r,t,a);const f=12/a,m=ie(t),d=m.getUTCFullYear(),C=m.getUTCMonth(),_=m.getUTCDate(),E=Er(d,C,_);let R=nr(t,-f,E);if(r>t&&c)for(R=t;R<r;)R=nr(R,f,E);let b=e>R?e:R,{days:N}=_e(b,r,u);if(l>=e){const{days:j}=_e(b,r,u?4:0);N=j}r<b&&(N=-N);let V=Xe(R,t,a,u),S=N/V,D=R,L=e;for(;D>e;){L=D,D=nr(D,-f,E),b=e>D?e:D;const{days:j}=_e(b,L,u);if(u===0)L>=b||e<=D?N=j:N=-j,V=Xe(D,L,a,u);else if(N=L<b?-j:j,u===3)V=365/a;else{const{days:I}=_e(D,L,u);V=L<D?-I:I}S+=e<=D?c?1:0:N/V}const P=s*n/a*S;return y.create(P)}}class w1 extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",5)}calculate(e,t,r,n,s){const a=s!=null?s:y.create(0),{isError:u,errorObject:c,variants:l}=q(e,t,r,n,a);if(u)return c;const[f,m,d,C,_]=l,E=G(f);if(typeof E!="number")return E;const R=G(m);if(typeof R!="number")return R;const b=+d.getValue(),N=+C.getValue(),V=Math.floor(+_.getValue());if(Number.isNaN(b)||Number.isNaN(N)||Number.isNaN(V))return g.create(h.VALUE);if(b<=0||N<=0||V<0||V>4||Math.floor(E)>Math.floor(R))return g.create(h.NUM);if(Math.floor(E)===Math.floor(R))return y.create(0);const{days:S,yearDays:D}=_e(E,R,V),L=N*b*S/D;return y.create(L)}}class L1 extends p{constructor(){super(...arguments);A(this,"minParams",6);A(this,"maxParams",7)}calculate(e,t,r,n,s,a,u){const c=u!=null?u:y.create(0),{isError:l,errorObject:f,variants:m}=q(e,t,r,n,s,a,c);if(l)return f;const[d,C,_,E,R,b,N]=m,V=G(C);if(typeof V!="number")return V;const S=G(_);if(typeof S!="number")return S;const D=+d.getValue(),L=+E.getValue();let P=+R.getValue();const j=+b.getValue(),I=Math.floor(+N.getValue());return Number.isNaN(D)||Number.isNaN(L)||Number.isNaN(P)||Number.isNaN(j)||Number.isNaN(I)?g.create(h.VALUE):D<=0||L<0||D<L||Math.floor(V)>Math.floor(S)||P<0||j<=0||![0,1,3,4].includes(I)?g.create(h.NUM):(P>1?P=Math.floor(P):P=Math.ceil(P),this._getResult(D,V,S,L,P,j,I))}_getResult(e,t,r,n,s,a,u){const c=e-n,l=e*a,{days:f,yearDays:m}=_e(t,r,u),d=f/m,C=Math.ceil(c/l-d);if(C<0)return y.create(0);let _=l;return s===0?_=l*d:s===C?_=c-l*(d+s-1):s>C&&(_=0),y.create(_)}}class P1 extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",4)}calculate(e,t,r,n){const s=n!=null?n:y.create(0),{isError:a,errorObject:u,variants:c}=q(e,t,r,s);if(a)return u;const[l,f,m,d]=c,C=G(l);if(typeof C!="number")return C;const _=G(f);if(typeof _!="number")return _;const E=Math.floor(+m.getValue()),R=Math.floor(+d.getValue());if(Number.isNaN(E)||Number.isNaN(R))return g.create(h.VALUE);if(![1,2,4].includes(E)||R<0||R>4||Math.floor(C)>=Math.floor(_))return g.create(h.NUM);const b=ts(C,_,E,R);return y.create(b)}}class j1 extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",4)}calculate(e,t,r,n){const s=n!=null?n:y.create(0),{isError:a,errorObject:u,variants:c}=q(e,t,r,s);if(a)return u;const[l,f,m,d]=c,C=G(l);if(typeof C!="number")return C;const _=G(f);if(typeof _!="number")return _;const E=Math.floor(+m.getValue()),R=Math.floor(+d.getValue());if(Number.isNaN(E)||Number.isNaN(R))return g.create(h.VALUE);if(![1,2,4].includes(E)||R<0||R>4||Math.floor(C)>=Math.floor(_))return g.create(h.NUM);const b=Xe(C,_,E,R);return y.create(b)}}class x1 extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",4)}calculate(e,t,r,n){const s=n!=null?n:y.create(0),{isError:a,errorObject:u,variants:c}=q(e,t,r,s);if(a)return u;const[l,f,m,d]=c,C=G(l);if(typeof C!="number")return C;const _=G(f);if(typeof _!="number")return _;const E=Math.floor(+m.getValue()),R=Math.floor(+d.getValue());if(Number.isNaN(E)||Number.isNaN(R))return g.create(h.VALUE);if(![1,2,4].includes(E)||R<0||R>4||Math.floor(C)>=Math.floor(_))return g.create(h.NUM);const b=ie(C),N=ie(_);for(N.setUTCFullYear(b.getUTCFullYear()),N<b&&N.setUTCFullYear(N.getUTCFullYear()+1);N>b;)N.setUTCMonth(N.getUTCMonth()-12/E);N.setUTCMonth(N.getUTCMonth()+12/E);const V=be(N),{days:S}=_e(C,V,R);return y.create(S)}}class U1 extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",4)}calculate(e,t,r,n){const s=n!=null?n:y.create(0),{isError:a,errorObject:u,variants:c}=q(e,t,r,s);if(a)return u;const[l,f,m,d]=c,C=G(l);if(typeof C!="number")return C;const _=G(f);if(typeof _!="number")return _;const E=Math.floor(+m.getValue()),R=Math.floor(+d.getValue());if(Number.isNaN(E)||Number.isNaN(R))return g.create(h.VALUE);if(![1,2,4].includes(E)||R<0||R>4||Math.floor(C)>=Math.floor(_))return g.create(h.NUM);const b=Uu(C,_,E);return y.create(b)}}class T1 extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",4)}calculate(e,t,r,n){const s=n!=null?n:y.create(0),{isError:a,errorObject:u,variants:c}=q(e,t,r,s);if(a)return u;const[l,f,m,d]=c,C=G(l);if(typeof C!="number")return C;const _=G(f);if(typeof _!="number")return _;const E=Math.floor(+m.getValue()),R=Math.floor(+d.getValue());if(Number.isNaN(E)||Number.isNaN(R))return g.create(h.VALUE);if(![1,2,4].includes(E)||R<0||R>4||Math.floor(C)>=Math.floor(_)||vt(C,_,E)<0)return g.create(h.NUM);const N=er(C,_,E);return y.create(N)}}class v1 extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",4)}calculate(e,t,r,n){const s=n!=null?n:y.create(0),{isError:a,errorObject:u,variants:c}=q(e,t,r,s);if(a)return u;const[l,f,m,d]=c,C=G(l);if(typeof C!="number")return C;const _=G(f);if(typeof _!="number")return _;const E=Math.floor(+m.getValue()),R=Math.floor(+d.getValue());if(Number.isNaN(E)||Number.isNaN(R))return g.create(h.VALUE);if(![1,2,4].includes(E)||R<0||R>4||Math.floor(C)>=Math.floor(_))return g.create(h.NUM);let b=vt(C,_,E);return b<0&&(b=0),y.create(b)}}class I1 extends p{constructor(){super(...arguments);A(this,"minParams",6);A(this,"maxParams",6)}calculate(e,t,r,n,s,a){const{isError:u,errorObject:c,variants:l}=q(e,t,r,n,s,a);if(u)return c;const[f,m,d,C,_,E]=l,R=+f.getValue(),b=+m.getValue(),N=+d.getValue(),V=+C.getValue(),S=+_.getValue(),D=+E.getValue();return Number.isNaN(R)||Number.isNaN(b)||Number.isNaN(N)||Number.isNaN(V)||Number.isNaN(S)||Number.isNaN(D)?g.create(h.VALUE):R<=0||b<=0||N<=0||V<1||S<1||V>S||V>b||S>b||![0,1].includes(D)?g.create(h.NUM):Math.trunc(V)!==V&&Math.trunc(S)!==S&&Math.trunc(V)===Math.trunc(S)?y.create(0):this._getResult(R,b,N,V,S,D)}_getResult(e,t,r,n,s,a){const u=Hr(e,t,r,0,a);let c=0,l=Math.ceil(n);l===1&&(a===0&&(c=-r),l++);let f=!1;for(let m=l;m<=s;m++){const d=a===1?tr(e,m-2,u,r,1):tr(e,m-1,u,r,0);if(d===0){f=!0;break}c+=a===1?d-u:d}return c*=e,(c<u*(s-n+1)||f)&&(c=u*(s-n+1)),y.create(c)}}class F1 extends p{constructor(){super(...arguments);A(this,"minParams",6);A(this,"maxParams",6)}calculate(e,t,r,n,s,a){const{isError:u,errorObject:c,variants:l}=q(e,t,r,n,s,a);if(u)return c;const[f,m,d,C,_,E]=l,R=+f.getValue(),b=+m.getValue(),N=+d.getValue(),V=+C.getValue(),S=+_.getValue(),D=+E.getValue();return Number.isNaN(R)||Number.isNaN(b)||Number.isNaN(N)||Number.isNaN(V)||Number.isNaN(S)||Number.isNaN(D)?g.create(h.VALUE):R<=0||b<=0||N<=0||V<1||S<1||V>S||![0,1].includes(D)?g.create(h.NUM):Math.trunc(V)!==V&&Math.trunc(S)!==S&&Math.trunc(V)===Math.trunc(S)?y.create(0):this._getResult(R,b,N,V,S,D)}_getResult(e,t,r,n,s,a){const u=Hr(e,t,r,0,a);let c=0,l=Math.ceil(n);l===1&&(c=a===0?u+r*e:u,l++);for(let f=l;f<=s;f++)c+=a===1?u-(tr(e,f-2,u,r,1)-u)*e:u-tr(e,f-1,u,r,0)*e;return y.create(c)}}class B1 extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",5);A(this,"needsLocale",!0)}calculate(e,t,r,n,s){let a=s!=null?s:y.create(12);a.isNull()&&(a=y.create(12));const u=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,a.isArray()?a.getRowCount():1),c=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,a.isArray()?a.getColumnCount():1),l=O(u,c,e,g.create(h.NA)),f=O(u,c,t,g.create(h.NA)),m=O(u,c,r,g.create(h.NA)),d=O(u,c,n,g.create(h.NA)),C=O(u,c,a,g.create(h.NA)),_=l.map((E,R,b)=>{const N=f.get(R,b),V=m.get(R,b),S=d.get(R,b),D=C.get(R,b),{isError:L,errorObject:P,variants:j}=B(E,N,V,S,D);if(L)return P;const[I,v,Y,Q,se]=j,te=+I.getValue(),W=+v.getValue(),fe=+Y.getValue();let Ce=+Q.getValue();const Ne=Math.floor(+se.getValue());return te<0||W<0||fe<=0||Ce<=0||Math.floor(Ce)>Math.floor(fe)||Ne<1||Ne>12?g.create(h.NUM):(Ce<1&&(Ce=1),Ce=Math.floor(Ce),this._getResult(te,W,fe,Ce,Ne,R,b))});return u===1&&c===1?_.get(0,0):_}_getResult(e,t,r,n,s,a,u){const c=+(1-(t/e)**(1/r)).toFixed(3),l=e*c*s/12;let f=l,m=0;const d=n===r?r-1:n;for(let _=2;_<=d;_++)m=(e-f)*c,f+=m;let C;return n===1?C=l:n===r?C=(e-f)*c:C=m,Number.isNaN(C)||!Number.isFinite(C)?g.create(h.NUM):a===0&&u===0?y.create(C,We(this.getLocale())):y.create(C)}}class k1 extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",5);A(this,"needsLocale",!0)}calculate(e,t,r,n,s){let a=s!=null?s:y.create(2);a.isNull()&&(a=y.create(2));const u=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,a.isArray()?a.getRowCount():1),c=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,a.isArray()?a.getColumnCount():1),l=O(u,c,e,g.create(h.NA)),f=O(u,c,t,g.create(h.NA)),m=O(u,c,r,g.create(h.NA)),d=O(u,c,n,g.create(h.NA)),C=O(u,c,a,g.create(h.NA)),_=l.map((E,R,b)=>{const N=f.get(R,b),V=m.get(R,b),S=d.get(R,b),D=C.get(R,b),{isError:L,errorObject:P,variants:j}=B(E,N,V,S,D);if(L)return P;const[I,v,Y,Q,se]=j,te=+I.getValue(),W=+v.getValue(),fe=+Y.getValue(),Ce=+Q.getValue(),Ne=+se.getValue();if(te<0||W<0||fe<=0||Ce<=0||Ce>fe||Ne<=0)return g.create(h.NUM);const Ve=Pa(te,W,fe,Ce,Ne);return Number.isNaN(Ve)||!Number.isFinite(Ve)?g.create(h.NUM):R===0&&b===0?y.create(Ve,We(this.getLocale())):y.create(Ve)});return u===1&&c===1?_.get(0,0):_}}class $1 extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",5)}calculate(e,t,r,n,s){const a=s!=null?s:y.create(0),{isError:u,errorObject:c,variants:l}=q(e,t,r,n,a);if(u)return c;const[f,m,d,C,_]=l,E=G(f);if(typeof E!="number")return E;const R=G(m);if(typeof R!="number")return R;const b=+d.getValue(),N=+C.getValue(),V=Math.floor(+_.getValue());if(Number.isNaN(b)||Number.isNaN(N)||Number.isNaN(V))return g.create(h.VALUE);if(b<=0||N<=0||V<0||V>4||Math.floor(E)>=Math.floor(R))return g.create(h.NUM);const{days:S,yearDays:D}=_e(E,R,V),L=(N-b)/N*(D/S);return y.create(L)}}class Y1 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,variants:s}=q(e,t);if(r)return n;const[a,u]=s,c=+a.getValue();let l=Math.floor(+u.getValue());if(Number.isNaN(c)||Number.isNaN(l))return g.create(h.VALUE);if(l<0)return g.create(h.NUM);if(l>=0&&l<1)return g.create(h.DIV_BY_ZERO);l=Number.parseInt(`${l}`,10);let f=Number.parseInt(`${c}`,10);f+=c%1*10**Math.ceil(Math.log(l)/Math.LN10)/l;const m=10**(Math.ceil(Math.log(l)/Math.LN2)+1);return f=Math.round(f*m)/m,y.create(f)}}class H1 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,variants:s}=q(e,t);if(r)return n;const[a,u]=s,c=+a.getValue();let l=Math.floor(+u.getValue());if(Number.isNaN(c)||Number.isNaN(l))return g.create(h.VALUE);if(l<0)return g.create(h.NUM);if(l>=0&&l<1)return g.create(h.DIV_BY_ZERO);l=Number.parseInt(`${l}`,10);let f=Number.parseInt(`${c}`,10);return f+=c%1*10**-Math.ceil(Math.log(l)/Math.LN10)*l,y.create(f)}}class G1 extends p{constructor(){super(...arguments);A(this,"minParams",5);A(this,"maxParams",6)}calculate(e,t,r,n,s,a){let u=a!=null?a:y.create(0);u.isNull()&&(u=y.create(0));const{isError:c,errorObject:l,variants:f}=Fe(e,t,r,n,s,u);if(c)return l;const[m,d,C,_,E,R]=f,b=G(m);if(typeof b!="number")return b;const N=G(d);if(typeof N!="number")return N;const V=+C.getValue(),S=+_.getValue(),D=Math.floor(+E.getValue()),L=Math.floor(+R.getValue());if(Number.isNaN(V)||Number.isNaN(S)||Number.isNaN(D)||Number.isNaN(L))return g.create(h.VALUE);if(V<0||S<0||![1,2,4].includes(D)||L<0||L>4||Math.floor(b)>=Math.floor(N)||b<=0||N<=366)return g.create(h.NUM);const P=Tu(b,N,V,S,D,L);return y.create(P)}}class W1 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,variants:s}=q(e,t);if(r)return n;const[a,u]=s,c=+a.getValue();let l=Math.floor(+u.getValue());if(Number.isNaN(c)||Number.isNaN(l))return g.create(h.VALUE);if(c<=0||l<1)return g.create(h.NUM);l=Number.parseInt(`${l}`,10);const f=(1+c/l)**l-1;return y.create(f)}}class Q1 extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",5);A(this,"needsLocale",!0)}calculate(e,t,r,n,s){const a=n!=null?n:y.create(0),u=s!=null?s:y.create(0),c=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1,u.isArray()?u.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1,u.isArray()?u.getColumnCount():1),f=O(c,l,e,g.create(h.NA)),m=O(c,l,t,g.create(h.NA)),d=O(c,l,r,g.create(h.NA)),C=O(c,l,a,g.create(h.NA)),_=O(c,l,u,g.create(h.NA)),E=f.map((R,b,N)=>{const V=m.get(b,N),S=d.get(b,N),D=C.get(b,N),L=_.get(b,N),{isError:P,errorObject:j,variants:I}=B(R,V,S,D,L);if(P)return j;const[v,Y,Q,se,te]=I,W=+v.getValue(),fe=+Y.getValue(),Ce=+Q.getValue(),Ne=+se.getValue(),Ve=+te.getValue(),de=tr(W,fe,Ce,Ne,Ve?1:0);return Number.isNaN(de)||!Number.isFinite(de)?g.create(h.NUM):b===0&&N===0?y.create(de,We(this.getLocale())):y.create(de)});return c===1&&l===1?E.get(0,0):E}}class q1 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,variants:s}=q(e);if(r)return n;const[a]=s,u=+a.getValue();if(Number.isNaN(u))return g.create(h.VALUE);let c=u;if(t.isArray()){const l=t.getArrayValue().flat();for(let f=0;f<l.length;f++){const m=l[f];if(m.isBoolean())return g.create(h.VALUE);const d=+m.getValue();if(Number.isNaN(d))return g.create(h.VALUE);c*=1+d}}else{if(t.isBoolean())return g.create(h.VALUE);const l=+t.getValue();if(Number.isNaN(l))return g.create(h.VALUE);c*=1+l}return y.create(c)}}class X1 extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",5)}calculate(e,t,r,n,s){const a=s!=null?s:y.create(0),{isError:u,errorObject:c,variants:l}=q(e,t,r,n,a);if(u)return c;const[f,m,d,C,_]=l,E=G(f);if(typeof E!="number")return E;const R=G(m);if(typeof R!="number")return R;const b=+d.getValue(),N=+C.getValue(),V=Math.floor(+_.getValue());if(Number.isNaN(b)||Number.isNaN(N)||Number.isNaN(V))return g.create(h.VALUE);if(b<=0||N<=0||V<0||V>4||Math.floor(E)>=Math.floor(R))return g.create(h.NUM);const{days:S,yearDays:D}=_e(E,R,V),L=(N-b)/b*(D/S);return y.create(L)}}class K1 extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",6);A(this,"needsLocale",!0)}calculate(e,t,r,n,s,a){const u=s!=null?s:y.create(0),c=a!=null?a:y.create(0),l=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,u.isArray()?u.getRowCount():1,c.isArray()?c.getRowCount():1),f=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,u.isArray()?u.getColumnCount():1,c.isArray()?c.getColumnCount():1),m=O(l,f,e,g.create(h.NA)),d=O(l,f,t,g.create(h.NA)),C=O(l,f,r,g.create(h.NA)),_=O(l,f,n,g.create(h.NA)),E=O(l,f,u,g.create(h.NA)),R=O(l,f,c,g.create(h.NA)),b=m.map((N,V,S)=>{const D=d.get(V,S),L=C.get(V,S),P=_.get(V,S),j=E.get(V,S),I=R.get(V,S),{isError:v,errorObject:Y,variants:Q}=B(N,D,L,P,j,I);if(v)return Y;const[se,te,W,fe,Ce,Ne]=Q,Ve=+se.getValue(),de=+te.getValue(),Be=+W.getValue(),Et=+fe.getValue(),It=+Ce.getValue(),Ft=+Ne.getValue();if(de<1||Math.floor(de)>Math.ceil(Be))return g.create(h.NUM);const ct=vu(Ve,de,Be,Et,It,Ft?1:0);return Number.isNaN(ct)||!Number.isFinite(ct)?g.create(h.NUM):V===0&&S===0?y.create(ct,We(this.getLocale())):y.create(ct)});return l===1&&f===1?b.get(0,0):b}}class Z1 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){let r=t!=null?t:y.create(.1);return r.isNull()&&(r=y.create(.1)),r.isArray()?r.map((n,s,a)=>this._handleSingleObject(e,n,s,a)):this._handleSingleObject(e,r)}_handleSingleObject(e,t,r=0,n=0){if(e.isError())return e;if(t.isError())return t;if(e.isNull())return g.create(h.VALUE);if(!e.isArray())return g.create(h.NUM);const{_values:s,valuesHasError:a}=this._getValues(e);if(a)return g.create(h.VALUE);let u=t;if(u.isString()&&(u=u.convertToNumberObjectValue(),u.isError()))return u;const c=+u.getValue(),{positive:l,negative:f}=this._checkValues(s);if(!l||!f)return g.create(h.NUM);const m=La(c,d=>Iu(d,s));return typeof m!="number"?m:r===0&&n===0?y.create(m,"0%"):y.create(m)}_getValues(e){const t=[];let r=!1;return e.iterator(n=>{const s=n;if(s.isError())return r=!0,!1;if(s.isNull()||s.isBoolean()||s.isString()&&s.getValue()==="")return!0;const a=+s.getValue();if(Number.isNaN(a))return!0;t.push(a)}),{_values:t,valuesHasError:r}}_checkValues(e){let t=!1,r=!1;for(let n=0;n<e.length;n++)e[n]>0&&(t=!0),e[n]<0&&(r=!0);return{positive:t,negative:r}}}class z1 extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA)),f=O(s,a,n,g.create(h.NA)),m=u.map((d,C,_)=>{const E=c.get(C,_),R=l.get(C,_),b=f.get(C,_),{isError:N,errorObject:V,variants:S}=B(d,E,R,b);if(N)return V;const[D,L,P,j]=S,I=+D.getValue(),v=+L.getValue(),Y=+P.getValue(),Q=+j.getValue();if(Y===0)return g.create(h.DIV_BY_ZERO);const se=Q*I*(v/Y-1);return y.create(se)});return s===1&&a===1?m.get(0,0):m}}class J1 extends p{constructor(){super(...arguments);A(this,"minParams",5);A(this,"maxParams",6)}calculate(e,t,r,n,s,a){let u=a!=null?a:y.create(0);u.isNull()&&(u=y.create(0));const{isError:c,errorObject:l,variants:f}=Fe(e,t,r,n,s,u);if(c)return l;const[m,d,C,_,E,R]=f,b=G(m);if(typeof b!="number")return b;const N=G(d);if(typeof N!="number")return N;const V=+C.getValue(),S=+_.getValue(),D=Math.floor(+E.getValue()),L=Math.floor(+R.getValue());if(Number.isNaN(V)||Number.isNaN(S)||Number.isNaN(D)||Number.isNaN(L))return g.create(h.VALUE);if(V<0||S<0||![1,2,4].includes(D)||L<0||L>4||Math.floor(b)>=Math.floor(N))return g.create(h.NUM);let P=Tu(b,N,V,S,D,L);return P/=1+S/D,y.create(P)}}class ed extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{_values:n,numberValues:s,positive:a,negative:u}=this._getValues(e),c=Math.max(t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),l=Math.max(t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),f=O(c,l,t,g.create(h.NA)),m=O(c,l,r,g.create(h.NA)),d=f.map((C,_,E)=>{const R=m.get(_,E);if(e.isError())return e;if(R.isError())return R;if(n.isError())return n;if(!a||!u)return g.create(h.DIV_BY_ZERO);const b=+C.getValue(),N=+R.getValue();if(Number.isNaN(b)||Number.isNaN(N))return g.create(h.VALUE);if(N===-1)return g.create(h.DIV_BY_ZERO);const V=this._getResult(s,b,N);return _===0&&E===0?y.create(V,"0%"):y.create(V)});return c===1&&l===1?d.get(0,0):d}_getValues(e){let t=e,r=[],n=!1,s=!1;if(!e.isError())if(e.isNull())t=g.create(h.VALUE);else if(!e.isArray())t=g.create(h.DIV_BY_ZERO);else{const{numberValues:a,valuesHasError:u,errorObject:c,positive:l,negative:f}=this._checkValues(e);u&&(t=c),r=a,n=l,s=f}return{_values:t,numberValues:r,positive:n,negative:s}}_checkValues(e){const t=[];let r=!1,n=g.create(h.VALUE),s=!1,a=!1;return e.iterator(u=>{const c=u;if(c.isError())return r=!0,n=c,!1;if(c.isNull()||c.isBoolean()||c.isString()&&c.getValue()==="")return!0;const l=+c.getValue();if(Number.isNaN(l))return!0;l>0&&(s=!0),l<0&&(a=!0),t.push(l)}),{numberValues:t,valuesHasError:r,errorObject:n,positive:s,negative:a}}_getResult(e,t,r){const n=e.length,s=[],a=[];for(let d=0;d<n;d++)e[d]>0?a.push(e[d]):e[d]<0&&s.push(e[d]);const u=this._npv(r,e,"positive"),c=this._npv(t,e,"negative"),l=-u*(1+r)**n,f=c*(1+t);return(l/f)**(1/(n-1))-1}_npv(e,t,r){let n=0;for(let s=1;s<=t.length;s++){const a=t[s-1];(r==="positive"&&a>0||r==="negative"&&a<0)&&(n+=a/(1+e)**s)}return n}}class td extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,variants:s}=q(e,t);if(r)return n;const[a,u]=s,c=+a.getValue();let l=Math.floor(+u.getValue());if(Number.isNaN(c)||Number.isNaN(l))return g.create(h.VALUE);if(c<=0||l<1)return g.create(h.NUM);l=Number.parseInt(`${l}`,10);const f=((c+1)**(1/l)-1)*l;return y.create(f)}}class rd extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",5)}calculate(e,t,r,n,s){const a=n!=null?n:y.create(0),u=s!=null?s:y.create(0),c=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1,u.isArray()?u.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1,u.isArray()?u.getColumnCount():1),f=O(c,l,e,g.create(h.NA)),m=O(c,l,t,g.create(h.NA)),d=O(c,l,r,g.create(h.NA)),C=O(c,l,a,g.create(h.NA)),_=O(c,l,u,g.create(h.NA)),E=f.map((R,b,N)=>{const V=m.get(b,N),S=d.get(b,N),D=C.get(b,N),L=_.get(b,N),{isError:P,errorObject:j,variants:I}=B(R,V,S,D,L);if(P)return j;const[v,Y,Q,se,te]=I,W=+v.getValue(),fe=+Y.getValue(),Ce=+Q.getValue(),Ne=+se.getValue();let Ve=+te.getValue();if(Ve=Ve?1:0,W===0&&fe===0)return g.create(h.DIV_BY_ZERO);let de;if(W===0)de=-(Ce+Ne)/fe;else{const Be=fe*(1+W*Ve)-Ne*W,Et=Ce*W+fe*(1+W*Ve);de=Math.log(Be/Et)/Math.log(1+W)}return Number.isNaN(de)||!Number.isFinite(de)?g.create(h.NUM):y.create(de)});return c===1&&l===1?E.get(0,0):E}}class nd extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",255);A(this,"needsLocale",!0)}calculate(e,...t){if(e.isError())return e;const{isError:r,errorObject:n,values:s}=this._getValues(t);return e.isArray()?e.map((a,u,c)=>this._handleSingleObject(a,r,n,s,u,c)):this._handleSingleObject(e,r,n,s)}_handleSingleObject(e,t,r,n,s=0,a=0){let u=e;if(u.isString()&&(u=u.convertToNumberObjectValue()),u.isError())return u;if(t)return r;const c=+e.getValue(),l=Iu(c,n);return Number.isNaN(l)||Math.abs(l)===1/0?g.create(h.DIV_BY_ZERO):s===0&&a===0?y.create(l,We(this.getLocale())):y.create(l)}_getValues(e){const t=[];for(let r=0;r<e.length;r++){const n=e[r];if(n.isError())return{isError:!0,errorObject:n};if(n.isArray()){let s=!1,a=g.create(h.VALUE);if(n.iterator(u=>{const c=u;if(c.isError())return s=!0,a=c,!1;if(c.isNull()||c.isBoolean()||c.isString()&&c.getValue()==="")return!0;const l=+c.getValue();if(Number.isNaN(l))return!0;t.push(l)}),s)return{isError:s,errorObject:a}}else{const s=+n.getValue();if(Number.isNaN(s))return{isError:!0,errorObject:g.create(h.VALUE)};t.push(s)}}return{isError:!1,values:t}}}class sd extends p{constructor(){super(...arguments);A(this,"minParams",8);A(this,"maxParams",9)}calculate(e,t,r,n,s,a,u,c,l){let f=l!=null?l:y.create(0);f.isNull()&&(f=y.create(0));const{isError:m,errorObject:d,variants:C}=Fe(e,t,r,n,s,a,u,c,f);if(m)return d;const[_,E,R,b,N,V,S,D,L]=C,P=G(_);if(typeof P!="number")return P;const j=G(E);if(typeof j!="number")return j;const I=G(R);if(typeof I!="number")return I;const v=G(b);if(typeof v!="number")return v;const Y=+N.getValue(),Q=+V.getValue(),se=+S.getValue(),te=Math.floor(+D.getValue()),W=Math.floor(+L.getValue());if(Number.isNaN(Y)||Number.isNaN(Q)||Number.isNaN(se)||Number.isNaN(te)||Number.isNaN(W))return g.create(h.VALUE);if(Y<0||Q<0||se<=0||![1,2,4].includes(te)||W<0||W>4||!this._validDate(j,v,P,I,te))return g.create(h.NUM);const fe=Fu(P,j,I,v,Y,Q,se,te,W);return y.create(fe)}_validDate(e,t,r,n,s){return this._getDateCorrectOrder(e,t,r,n)&&Bu(e,t,s)&&br(n,e,s)}_getDateCorrectOrder(e,t,r,n){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)&&Math.floor(r)>Math.floor(n)}}class ad extends p{constructor(){super(...arguments);A(this,"minParams",8);A(this,"maxParams",9)}calculate(e,t,r,n,s,a,u,c,l){let f=l!=null?l:y.create(0);f.isNull()&&(f=y.create(0));const{isError:m,errorObject:d,variants:C}=Fe(e,t,r,n,s,a,u,c,f);if(m)return d;const[_,E,R,b,N,V,S,D,L]=C,P=G(_);if(typeof P!="number")return P;const j=G(E);if(typeof j!="number")return j;const I=G(R);if(typeof I!="number")return I;const v=G(b);if(typeof v!="number")return v;const Y=+N.getValue(),Q=+V.getValue(),se=+S.getValue(),te=Math.floor(+D.getValue()),W=Math.floor(+L.getValue());return Number.isNaN(Y)||Number.isNaN(Q)||Number.isNaN(se)||Number.isNaN(te)||Number.isNaN(W)?g.create(h.VALUE):Y<0||Q<=0||se<=0||![1,2,4].includes(te)||W<0||W>4||!this._validDate(j,v,P,I,te)?g.create(h.NUM):this._getResult(P,j,I,v,Y,Q,se,te,W)}_validDate(e,t,r,n,s){return this._getDateCorrectOrder(e,t,r,n)&&Bu(e,t,s)&&br(n,e,s)}_getDateCorrectOrder(e,t,r,n){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)&&Math.floor(r)>Math.floor(n)}_getResult(e,t,r,n,s,a,u,c,l){const{days:f}=_e(e,t,l),m=(s*f*100-(a-100))/((a-100)*.25*(1+2*f)+f*100);function d(_){return a-Fu(e,t,r,n,s,_,u,c,l)}const C=La(m,_=>d(_));return typeof C!="number"?C:y.create(C)}}class id extends p{constructor(){super(...arguments);A(this,"minParams",7);A(this,"maxParams",8)}calculate(e,t,r,n,s,a,u,c){let l=c!=null?c:y.create(0);l.isNull()&&(l=y.create(0));const{isError:f,errorObject:m,variants:d}=Fe(e,t,r,n,s,a,u,l);if(f)return m;const[C,_,E,R,b,N,V,S]=d,D=G(C);if(typeof D!="number")return D;const L=G(_);if(typeof L!="number")return L;const P=G(E);if(typeof P!="number")return P;const j=+R.getValue(),I=+b.getValue(),v=+N.getValue(),Y=Math.floor(+V.getValue()),Q=Math.floor(+S.getValue());if(Number.isNaN(j)||Number.isNaN(I)||Number.isNaN(v)||Number.isNaN(Y)||Number.isNaN(Q))return g.create(h.VALUE);if(j<0||I<0||v<=0||![1,2,4].includes(Y)||Q<0||Q>4||!this._validDate(L,D,P,Y))return g.create(h.NUM);const se=this._getResult(D,L,P,j,I,v,Y,Q);return y.create(se)}_validDate(e,t,r,n){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)&&br(r,e,n)}_getResult(e,t,r,n,s,a,u,c){const l=this._getCoupDate(t,r,u),f=this._getFrac(r,e,l,u,c),m=this._getFrac(r,t,l,u,c),d=this._getFrac(e,t,l,u,c);return(a*u+100*n*(m-f*(1+s*d/u)))/(s*d+u)}_getCoupDate(e,t,r){const n=ie(e),s=ie(t);for(s.setUTCFullYear(n.getUTCFullYear()),s>n&&s.setUTCFullYear(s.getUTCFullYear()-1);s<n;)s.setUTCMonth(s.getUTCMonth()+12/r);return be(s)}_getFrac(e,t,r,n,s){const a=ie(e),u=ie(t),c=ie(r);for(c.setUTCFullYear(a.getUTCFullYear()),c<a&&c.setUTCFullYear(c.getUTCFullYear()+1);c>a;)c.setUTCMonth(c.getUTCMonth()-12/n);let l=be(c);c.setUTCMonth(c.getUTCMonth()+12/n);let f=be(c);if(f>=t){const{days:N}=_e(e,t,s),V=Xe(l,f,n,s);return N/V}const{days:m}=_e(e,f,s),d=Xe(l,f,n,s);let C=m/d;const _=ie(f),E=ie(f);for(E.setUTCMonth(E.getUTCMonth()+12/n);E<u;)_.setUTCMonth(_.getUTCMonth()+12/n),E.setUTCMonth(E.getUTCMonth()+12/n),C+=1;l=be(_),f=be(E);const{days:R}=_e(l,t,s),b=Xe(l,f,n,s);return C+=R/b,C}}class od extends p{constructor(){super(...arguments);A(this,"minParams",8);A(this,"maxParams",9)}calculate(e,t,r,n,s,a,u,c){let l=c!=null?c:y.create(0);l.isNull()&&(l=y.create(0));const{isError:f,errorObject:m,variants:d}=Fe(e,t,r,n,s,a,u,l);if(f)return m;const[C,_,E,R,b,N,V,S]=d,D=G(C);if(typeof D!="number")return D;const L=G(_);if(typeof L!="number")return L;const P=G(E);if(typeof P!="number")return P;const j=+R.getValue(),I=+b.getValue(),v=+N.getValue(),Y=Math.floor(+V.getValue()),Q=Math.floor(+S.getValue());if(Number.isNaN(j)||Number.isNaN(I)||Number.isNaN(v)||Number.isNaN(Y)||Number.isNaN(Q))return g.create(h.VALUE);if(j<0||I<=0||v<=0||![1,2,4].includes(Y)||Q<0||Q>4||!this._validDate(L,D,P,Y))return g.create(h.NUM);const se=this._getResult(D,L,P,j,I,v,Y,Q);return y.create(se)}_validDate(e,t,r,n){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)&&br(r,e,n)}_getResult(e,t,r,n,s,a,u,c){const l=this._getCoupDate(t,r,u),f=this._getFrac(r,e,l,u,c),m=this._getFrac(r,t,l,u,c),d=this._getFrac(e,t,l,u,c);return(u*(a-s)+100*n*(m-f))/(d*s+100*n*f*d/u)}_getCoupDate(e,t,r){const n=ie(e),s=ie(t);for(s.setUTCFullYear(n.getUTCFullYear()),s>n&&s.setUTCFullYear(s.getUTCFullYear()-1);s<n;)s.setUTCMonth(s.getUTCMonth()+12/r);return be(s)}_getFrac(e,t,r,n,s){const a=ie(e),u=ie(t),c=ie(r);for(c.setUTCFullYear(a.getUTCFullYear()),c<a&&c.setUTCFullYear(c.getUTCFullYear()+1);c>a;)c.setUTCMonth(c.getUTCMonth()-12/n);let l=be(c);c.setUTCMonth(c.getUTCMonth()+12/n);let f=be(c);if(f>=t){const{days:N}=_e(e,t,s),V=Xe(l,f,n,s);return N/V}const{days:m}=_e(e,f,s),d=Xe(l,f,n,s);let C=m/d;const _=ie(f),E=ie(f);for(E.setUTCMonth(E.getUTCMonth()+12/n);E<u;)_.setUTCMonth(_.getUTCMonth()+12/n),E.setUTCMonth(E.getUTCMonth()+12/n),C+=1;l=be(_),f=be(E);const{days:R}=_e(l,t,s),b=Xe(l,f,n,s);return C+=R/b,C}}class ud extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.map((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d),{isError:E,errorObject:R,variants:b}=B(f,C,_);if(E)return R;const[N,V,S]=b,D=+N.getValue(),L=+V.getValue(),P=+S.getValue();if(D<=-1)return g.create(h.NUM);const j=(Math.log(P)-Math.log(L))/Math.log(1+D);return Number.isNaN(j)||!Number.isFinite(j)?g.create(h.NUM):y.create(j)});return n===1&&s===1?l.get(0,0):l}}class cd extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",5);A(this,"needsLocale",!0)}calculate(e,t,r,n,s){const a=n!=null?n:y.create(0),u=s!=null?s:y.create(0),c=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1,u.isArray()?u.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1,u.isArray()?u.getColumnCount():1),f=O(c,l,e,g.create(h.NA)),m=O(c,l,t,g.create(h.NA)),d=O(c,l,r,g.create(h.NA)),C=O(c,l,a,g.create(h.NA)),_=O(c,l,u,g.create(h.NA)),E=f.map((R,b,N)=>{const V=m.get(b,N),S=d.get(b,N),D=C.get(b,N),L=_.get(b,N),{isError:P,errorObject:j,variants:I}=B(R,V,S,D,L);if(P)return j;const[v,Y,Q,se,te]=I,W=+v.getValue(),fe=+Y.getValue(),Ce=+Q.getValue(),Ne=+se.getValue(),Ve=+te.getValue();if(W<=-1)return g.create(h.NUM);const de=Hr(W,fe,Ce,Ne,Ve?1:0);return Number.isNaN(de)||!Number.isFinite(de)?g.create(h.NUM):b===0&&N===0?y.create(de,We(this.getLocale())):y.create(de)});return c===1&&l===1?E.get(0,0):E}}class ld extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",6);A(this,"needsLocale",!0)}calculate(e,t,r,n,s,a){const u=s!=null?s:y.create(0),c=a!=null?a:y.create(0),l=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,u.isArray()?u.getRowCount():1,c.isArray()?c.getRowCount():1),f=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,u.isArray()?u.getColumnCount():1,c.isArray()?c.getColumnCount():1),m=O(l,f,e,g.create(h.NA)),d=O(l,f,t,g.create(h.NA)),C=O(l,f,r,g.create(h.NA)),_=O(l,f,n,g.create(h.NA)),E=O(l,f,u,g.create(h.NA)),R=O(l,f,c,g.create(h.NA)),b=m.map((N,V,S)=>{const D=d.get(V,S),L=C.get(V,S),P=_.get(V,S),j=E.get(V,S),I=R.get(V,S),{isError:v,errorObject:Y,variants:Q}=B(N,D,L,P,j,I);if(v)return Y;const[se,te,W,fe,Ce,Ne]=Q,Ve=+se.getValue(),de=+te.getValue(),Be=+W.getValue(),Et=+fe.getValue(),It=+Ce.getValue(),Ft=+Ne.getValue();if(de<1||Math.floor(de)>Math.ceil(Be)||de-Be>=1)return g.create(h.NUM);const ct=Hr(Ve,Be,Et,It,Ft?1:0)-vu(Ve,de,Be,Et,It,Ft?1:0);return Number.isNaN(ct)||!Number.isFinite(ct)?g.create(h.NUM):V===0&&S===0?y.create(ct,We(this.getLocale())):y.create(ct)});return l===1&&f===1?b.get(0,0):b}}class fd extends p{constructor(){super(...arguments);A(this,"minParams",6);A(this,"maxParams",7)}calculate(e,t,r,n,s,a,u){let c=u!=null?u:y.create(0);c.isNull()&&(c=y.create(0));const{isError:l,errorObject:f,variants:m}=Fe(e,t,r,n,s,a,c);if(l)return f;const[d,C,_,E,R,b,N]=m,V=G(d);if(typeof V!="number")return V;const S=G(C);if(typeof S!="number")return S;const D=+_.getValue(),L=+E.getValue(),P=+R.getValue(),j=Math.floor(+b.getValue()),I=Math.floor(+N.getValue());if(Number.isNaN(D)||Number.isNaN(L)||Number.isNaN(P)||Number.isNaN(j)||Number.isNaN(I))return g.create(h.VALUE);if(D<0||L<0||P<=0||![1,2,4].includes(j)||I<0||I>4||V>=S||!br(V,S,j))return g.create(h.NUM);const v=rs(V,S,D,L,P,j,I);return y.create(v)}}class md extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",5)}calculate(e,t,r,n,s){let a=s!=null?s:y.create(0);a.isNull()&&(a=y.create(0));const{isError:u,errorObject:c,variants:l}=Fe(e,t,r,n,a);if(u)return c;const[f,m,d,C,_]=l,E=G(f);if(typeof E!="number")return E;const R=G(m);if(typeof R!="number")return R;const b=+d.getValue(),N=+C.getValue(),V=Math.floor(+_.getValue());if(Number.isNaN(b)||Number.isNaN(N)||Number.isNaN(V))return g.create(h.VALUE);if(b<=0||N<=0||V<0||V>4||E>=R)return g.create(h.NUM);const{days:S,yearDays:D}=_e(E,R,V),L=N-b*N*S/D;return y.create(L)}}class hd extends p{constructor(){super(...arguments);A(this,"minParams",5);A(this,"maxParams",6)}calculate(e,t,r,n,s,a){let u=a!=null?a:y.create(0);u.isNull()&&(u=y.create(0));const{isError:c,errorObject:l,variants:f}=Fe(e,t,r,n,s,u);if(c)return l;const[m,d,C,_,E,R]=f,b=G(m);if(typeof b!="number")return b;const N=G(d);if(typeof N!="number")return N;const V=G(C);if(typeof V!="number")return V;const S=+_.getValue(),D=+E.getValue(),L=Math.floor(+R.getValue());if(Number.isNaN(S)||Number.isNaN(D)||Number.isNaN(L))return g.create(h.VALUE);const P=this._getDateCorrectOrder(N,b,V);if(S<0||D<0||L<0||L>4||!P)return g.create(h.NUM);const j=Pu(b,L),{days:I}=_e(b,N,L),{days:v}=_e(V,N,L),{days:Y}=_e(V,b,L),Q=(100+v/j*S*100)/(1+I/j*D)-Y/j*S*100;return y.create(Q)}_getDateCorrectOrder(e,t,r){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)}}class gd extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",5);A(this,"needsLocale",!0)}calculate(e,t,r,n,s){const a=n!=null?n:y.create(0),u=s!=null?s:y.create(0),c=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1,u.isArray()?u.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1,u.isArray()?u.getColumnCount():1),f=O(c,l,e,g.create(h.NA)),m=O(c,l,t,g.create(h.NA)),d=O(c,l,r,g.create(h.NA)),C=O(c,l,a,g.create(h.NA)),_=O(c,l,u,g.create(h.NA)),E=f.map((R,b,N)=>{const V=m.get(b,N),S=d.get(b,N),D=C.get(b,N),L=_.get(b,N),{isError:P,errorObject:j,variants:I}=B(R,V,S,D,L);if(P)return j;const[v,Y,Q,se,te]=I,W=+v.getValue(),fe=+Y.getValue(),Ce=+Q.getValue(),Ne=+se.getValue();let Ve=+te.getValue();Ve=Ve?1:0;const de=W===0?-Ce*fe-Ne:((1-(1+W)**fe)/W*Ce*(1+W*Ve)-Ne)/(1+W)**fe;return Number.isNaN(de)||!Number.isFinite(de)?g.create(h.NUM):b===0&&N===0?y.create(de,We(this.getLocale())):y.create(de)});return c===1&&l===1?E.get(0,0):E}}class dd extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",6)}calculate(e,t,r,n,s,a){const u=n!=null?n:y.create(0),c=s!=null?s:y.create(0),l=a!=null?a:y.create(.1),f=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,u.isArray()?u.getRowCount():1,c.isArray()?c.getRowCount():1,l.isArray()?l.getRowCount():1),m=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,u.isArray()?u.getColumnCount():1,c.isArray()?c.getColumnCount():1,l.isArray()?l.getColumnCount():1),d=O(f,m,e,g.create(h.NA)),C=O(f,m,t,g.create(h.NA)),_=O(f,m,r,g.create(h.NA)),E=O(f,m,u,g.create(h.NA)),R=O(f,m,c,g.create(h.NA)),b=O(f,m,l,g.create(h.NA)),N=d.map((V,S,D)=>{const L=C.get(S,D),P=_.get(S,D),j=E.get(S,D),I=R.get(S,D),v=b.get(S,D),{isError:Y,errorObject:Q,variants:se}=B(V,L,P,j,I,v);if(Y)return Q;const[te,W,fe,Ce,Ne,Ve]=se,de=+te.getValue(),Be=+W.getValue(),Et=+fe.getValue(),It=+Ce.getValue();let Ft=+Ne.getValue();const ct=+Ve.getValue();if(Ft=Ft?1:0,de<=0)return g.create(h.NUM);const SR=Be>=0&&Et>=0&&It>=0,MR=Be<=0&&Et<=0&&It<=0;return SR||MR?g.create(h.NUM):this._getResult(de,Be,Et,It,Ft,ct,S,D)});return f===1&&m===1?N.get(0,0):N}_getResult(e,t,r,n,s,a,u,c){if(Math.abs(t)<1e-14)return this._computeSimpleGrowthRate(e,r,n,u,c);let m=a,d=Number.POSITIVE_INFINITY;for(let C=0;C<100;C++){if(m<=-1)return g.create(h.NUM);const{value:_,derivative:E}=this._evaluateRateFunction(m,e,t,r,n,s,1e-10),R=Math.abs(_);if(R<1e-10||Math.abs(E)<1e-14)break;const b=this._getAdaptiveDampedStep(_,E,R,d);m-=b,d=R}return!Number.isFinite(m)||m<=-1?g.create(h.NUM):y.create(m,u===0&&c===0?"0%":void 0)}_computeSimpleGrowthRate(e,t,r,n,s){if(Math.sign(t)===Math.sign(r))return g.create(h.NUM);const a=(r/-t)**(1/e)-1;return y.create(a,n===0&&s===0?"0%":void 0)}_evaluateRateFunction(e,t,r,n,s,a,u){let c,l,f;if(Math.abs(e)<u)c=n*(1+t*e)+r*(1+e*a)*t+s,l=n*t+r*a*t;else{f=(1+e)**t,c=n*f+r*(1/e+a)*(f-1)+s;const m=t*(1+e)**(t-1);l=n*m+r*(1/e+a)*m+r*(-1/(e*e))*(f-1)}return{value:c,derivative:l}}_getAdaptiveDampedStep(e,t,r,n){const s=e/t;return r>.001||r>=n*.9?Math.max(Math.min(s,5),-5):Math.max(Math.min(s,.5),-.5)}}class Cd extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",5)}calculate(e,t,r,n,s){let a=s!=null?s:y.create(0);a.isNull()&&(a=y.create(0));const{isError:u,errorObject:c,variants:l}=Fe(e,t,r,n,a);if(u)return c;const[f,m,d,C,_]=l,E=G(f);if(typeof E!="number")return E;const R=G(m);if(typeof R!="number")return R;const b=+d.getValue(),N=+C.getValue(),V=Math.floor(+_.getValue());if(Number.isNaN(b)||Number.isNaN(N)||Number.isNaN(V))return g.create(h.VALUE);if(b<=0||N<=0||V<0||V>4||E>=R)return g.create(h.NUM);const{days:S,yearDays:D}=_e(E,R,V),L=b/(1-N*S/D);return L<0?g.create(h.NUM):y.create(L)}}class _d extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",6)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.map((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d),{isError:E,errorObject:R,variants:b}=B(f,C,_);if(E)return R;const[N,V,S]=b,D=+N.getValue(),L=+V.getValue(),P=+S.getValue();if(D<=0)return g.create(h.NUM);if(L===0&&P===0)return y.create(0);const j=(P/L)**(1/D)-1;return Number.isNaN(j)||!Number.isFinite(j)||P/L<0?g.create(h.NUM):y.create(j)});return n===1&&s===1?l.get(0,0):l}}class Ad extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3);A(this,"needsLocale",!0)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.map((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);if(C.isError())return C;if(_.isError())return _;const E=+f.getValue(),R=+C.getValue(),b=+_.getValue();if(Number.isNaN(E)||Number.isNaN(R)||Number.isNaN(b))return g.create(h.VALUE);if(b===0)return g.create(h.DIV_BY_ZERO);const N=(E-R)/b;return m===0&&d===0?y.create(N,We(this.getLocale())):y.create(N)});return n===1&&s===1?l.get(0,0):l}}class Ed extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4);A(this,"needsLocale",!0)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA)),f=O(s,a,n,g.create(h.NA)),m=u.map((d,C,_)=>{const E=c.get(C,_),R=l.get(C,_),b=f.get(C,_);if(E.isError())return E;if(R.isError())return R;if(b.isError())return b;const N=+d.getValue(),V=+E.getValue(),S=+R.getValue(),D=+b.getValue();if(Number.isNaN(N)||Number.isNaN(V)||Number.isNaN(S)||Number.isNaN(D))return g.create(h.VALUE);if(V<0||S<=0||D>S)return g.create(h.NUM);const L=(N-V)*(S-D+1)*2/(S*(S+1));return C===0&&_===0?y.create(L,We(this.getLocale())):y.create(L)});return s===1&&a===1?m.get(0,0):m}}class Rd extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,variants:a}=Fe(e,t,r);if(n)return s;const[u,c,l]=a,f=G(u);if(typeof f!="number")return f;const m=G(c);if(typeof m!="number")return m;const d=+l.getValue();if(Number.isNaN(d))return g.create(h.VALUE);if(d<=0||f>=m)return g.create(h.NUM);const C=Math.floor(m)-Math.floor(f),E=ie(f).getUTCFullYear(),R=es(E);if(C>R)return g.create(h.NUM);let b=365*d/(360-d*C);if(C>182){const N=100*(1-d*C/360),V=C/365;if(b=(-V+Math.sqrt(V*V-(V*2-1)*(1-100/N)))/(V-.5),Number.isNaN(b))return g.create(h.NUM)}return b<0?g.create(h.NUM):y.create(b)}}class bd extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3);A(this,"needsLocale",!0)}calculate(e,t,r){const{isError:n,errorObject:s,variants:a}=Fe(e,t,r);if(n)return s;const[u,c,l]=a,f=G(u);if(typeof f!="number")return f;const m=G(c);if(typeof m!="number")return m;const d=+l.getValue();if(Number.isNaN(d))return g.create(h.VALUE);if(d<=0||f>=m)return g.create(h.NUM);const C=Math.floor(m)-Math.floor(f),E=ie(f).getUTCFullYear(),R=es(E);if(C>R)return g.create(h.NUM);const b=100*(1-d*C/360);return b<0?g.create(h.NUM):y.create(b,We(this.getLocale()))}}class yd extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,variants:a}=Fe(e,t,r);if(n)return s;const[u,c,l]=a,f=G(u);if(typeof f!="number")return f;const m=G(c);if(typeof m!="number")return m;const d=+l.getValue();if(Number.isNaN(d))return g.create(h.VALUE);if(d<=0||f>=m)return g.create(h.NUM);const C=Math.floor(m)-Math.floor(f),E=ie(f).getUTCFullYear(),R=es(E);if(C>R)return g.create(h.NUM);const b=(100-d)/d*360/C;return y.create(b)}}class Nd extends p{constructor(){super(...arguments);A(this,"minParams",5);A(this,"maxParams",7);A(this,"needsLocale",!0)}calculate(e,t,r,n,s,a,u){let c=a!=null?a:y.create(2);c.isNull()&&(c=y.create(2));let l=u!=null?u:F.create(!1);l.isNull()&&(l=F.create(!1));const f=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1,c.isArray()?c.getRowCount():1,l.isArray()?l.getRowCount():1),m=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1,c.isArray()?c.getColumnCount():1,l.isArray()?l.getColumnCount():1),d=O(f,m,e,g.create(h.NA)),C=O(f,m,t,g.create(h.NA)),_=O(f,m,r,g.create(h.NA)),E=O(f,m,n,g.create(h.NA)),R=O(f,m,s,g.create(h.NA)),b=O(f,m,c,g.create(h.NA)),N=O(f,m,l,g.create(h.NA));return this._getResultArray(d,C,_,E,R,b,N,f,m)}_getResultArray(e,t,r,n,s,a,u,c,l){const f=e.map((m,d,C)=>{const _=t.get(d,C),E=r.get(d,C),R=n.get(d,C),b=s.get(d,C),N=a.get(d,C),V=u.get(d,C),{isError:S,errorObject:D,variants:L}=B(m,_,E,R,b,N,V);if(S)return D;const[P,j,I,v,Y,Q,se]=L,te=+P.getValue(),W=+j.getValue(),fe=+I.getValue(),Ce=+v.getValue(),Ne=+Y.getValue(),Ve=+Q.getValue(),de=+se.getValue();if(te<0||W<0||fe<0||Ce<0||Ne<0||Ne>fe||Ce>Ne||Ve<0)return g.create(h.NUM);if(fe===0&&Ce===0&&Ne===0)return g.create(h.DIV_BY_ZERO);const Be=this._getResult(te,W,fe,Ce,Ne,Ve,de);return d===0&&C===0?y.create(Be,We(this.getLocale())):y.create(Be)});return c===1&&l===1?f.get(0,0):f}_getResult(e,t,r,n,s,a,u){const c=Math.floor(n),l=Math.ceil(s);let f=0;if(e<t){if(n>=1||u)return f;const m=Math.abs(e-t);return f=m*(s-n)>m?m:m*(s-n),-f}if(u)for(let m=c+1;m<=l;m++){let d=Pa(e,t,r,m,a);m===c+1?d*=Math.min(s,c+1)-n:m===l&&(d*=s+1-l),f+=d}else{const m=e-this._getVdb(e,t,r,r,n,a);f=this._getVdb(m,t,r,r-n,s-n,a)}return f}_getVdb(e,t,r,n,s,a){const u=Math.ceil(s);let c=0,l=e-t,f=0,m=0,d=!1;for(let C=1;C<=u;C++){if(d)m=f;else{const _=Pa(e,t,r,C,a);f=l/(n-(C-1)),f>_?(m=f,d=!0):(m=_,l-=_)}C===u&&(m*=s+1-u),c+=m}return c}}class pd extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){if(e.isNull()||t.isNull())return g.create(h.NA);const{isError:n,errorObejct:s,_values:a,_dates:u}=this._checkErrors(e,t);if(n)return s;let c=r!=null?r:y.create(.1);c.isNull()&&(c=y.create(.1));const{isError:l,errorObject:f,variants:m}=q(c);if(l)return f;const[d]=m,C=+d.getValue();if(Number.isNaN(C))return g.create(h.VALUE);const{positive:_,negative:E}=this._checkValues(a);if(!_||!E||(a==null?void 0:a.length)!==(u==null?void 0:u.length)||C<0)return g.create(h.NUM);const R=La(C,b=>this._iterF(a,u,b));return typeof R!="number"?R:y.create(R)}_checkErrors(e,t){if(e.isError())return{isError:!0,errorObejct:e};if(t.isError())return{isError:!0,errorObejct:t};const{isError:r,errorObejct:n,_values:s}=this._checkErrorValues(e);if(r)return{isError:r,errorObejct:n};const{isError:a,errorObejct:u,_dates:c}=this._checkErrorDates(t);return a?{isError:a,errorObejct:u}:{isError:!1,_values:s,_dates:c}}_checkErrorValues(e){const t=[];if(e.isArray()){let r=!1,n=g.create(h.VALUE);return e.iterator(s=>{const a=s;if(a.isError())return r=!0,n=a,!1;if(a.isBoolean())return r=!0,n=g.create(h.VALUE),!1;const u=+a.getValue();if(Number.isNaN(u))return r=!0,n=g.create(h.VALUE),!1;t.push(u)}),r?{isError:r,errorObejct:n}:t.length<=1?{isError:!0,errorObejct:g.create(h.NA)}:{isError:r,_values:t}}else{const r=e.getValue();return e.isBoolean()||e.isString()&&!M.isRealNum(r)?{isError:!0,errorObejct:g.create(h.VALUE)}:{isError:!0,errorObejct:g.create(h.NA)}}}_checkErrorDates(e){const t=[];if(e.isArray()){let r=!1,n=g.create(h.VALUE);return e.iterator(s=>{if(s!=null&&s.isError())return r=!0,n=s,!1;if(s!=null&&s.isBoolean())return r=!0,n=g.create(h.VALUE),!1;const a=+s.getValue();if(Number.isNaN(a))return r=!0,n=g.create(h.VALUE),!1;if(a<0)return r=!0,n=g.create(h.NUM),!1;t.push(Math.floor(a))}),r?{isError:r,errorObejct:n}:t.length<=1?{isError:!0,errorObejct:g.create(h.NA)}:{isError:r,_dates:t}}else{const r=e.getValue();return e.isBoolean()||e.isString()&&!M.isRealNum(r)?{isError:!0,errorObejct:g.create(h.VALUE)}:+r<0?{isError:!0,errorObejct:g.create(h.NUM)}:{isError:!0,errorObejct:g.create(h.NA)}}}_checkValues(e){let t=!1,r=!1;for(let n=0;n<e.length;n++)e[n]>0&&(t=!0),e[n]<0&&(r=!0);return{positive:t,negative:r}}_iterF(e,t,r){return e.reduce((n,s,a)=>n+s/(1+r)**((t[a]-t[0])/365),0)}}class Vd extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){if(e.isNull()||t.isNull()||r.isNull())return g.create(h.NA);const{isError:n,errorObject:s,variants:a}=q(e);if(n)return s;const[u]=a,c=+u.getValue();if(Number.isNaN(c))return g.create(h.VALUE);let{isError:l,errorObejct:f,_values:m,_dates:d}=this._checkErrors(t,r);if(l)return f;if(m=m,d=d,c<0||m.length!==d.length)return g.create(h.NUM);let C=0;const _=d[0];for(let E=0;E<d.length;E++){const R=d[E],b=m[E];C+=b/(1+c)**((R-_)/365)}return y.create(C)}_checkErrors(e,t){if(e.isError())return{isError:!0,errorObejct:e};if(t.isError())return{isError:!0,errorObejct:t};const{isError:r,errorObejct:n,_values:s}=this._checkErrorValues(e);if(r)return{isError:r,errorObejct:n};const{isError:a,errorObejct:u,_dates:c}=this._checkErrorDates(t);return a?{isError:a,errorObejct:u}:{isError:!1,_values:s,_dates:c}}_checkErrorValues(e){const t=[];if(e.isArray()){let r=!1,n=g.create(h.VALUE);return e.iterator(s=>{const a=s;if(a.isError())return r=!0,n=a,!1;if(a.isNull()||a.isBoolean()||a.isString()&&a.getValue()==="")return r=!0,n=g.create(h.VALUE),!1;const u=+a.getValue();if(Number.isNaN(u))return r=!0,n=g.create(h.VALUE),!1;t.push(u)}),r?{isError:r,errorObejct:n}:{isError:r,_values:t}}else{if(e.isError())return{isError:!0,errorObejct:e};if(e.isNull()||e.isBoolean())return{isError:!0,errorObejct:g.create(h.VALUE)};const r=+e.getValue();return Number.isNaN(r)?{isError:!0,errorObejct:g.create(h.VALUE)}:{isError:!1,_values:[r]}}}_checkErrorDates(e){const t=[];if(e.isArray()){let r=!1,n=g.create(h.VALUE);return e.iterator(s=>{const a=s;if(a.isError())return r=!0,n=a,!1;if(a.isNull()||a.isBoolean())return r=!0,n=g.create(h.VALUE),!1;const u=+a.getValue();if(Number.isNaN(u))return r=!0,n=g.create(h.VALUE),!1;if(u<0)return r=!0,n=g.create(h.NUM),!1;t.push(Math.floor(u))}),r?{isError:r,errorObejct:n}:{isError:r,_dates:t}}else{if(e.isError())return{isError:!0,errorObejct:e};if(e.isNull()||e.isBoolean())return{isError:!0,errorObejct:g.create(h.VALUE)};const r=+e.getValue();return Number.isNaN(r)?{isError:!0,errorObejct:g.create(h.VALUE)}:+r<0?{isError:!0,errorObejct:g.create(h.NUM)}:{isError:!1,_dates:[Math.floor(r)]}}}}class Od extends p{constructor(){super(...arguments);A(this,"minParams",6);A(this,"maxParams",7)}calculate(e,t,r,n,s,a,u){let c=u!=null?u:y.create(0);c.isNull()&&(c=y.create(0));const{isError:l,errorObject:f,variants:m}=Fe(e,t,r,n,s,a,c);if(l)return f;const[d,C,_,E,R,b,N]=m,V=G(d);if(typeof V!="number")return V;const S=G(C);if(typeof S!="number")return S;const D=+_.getValue(),L=+E.getValue(),P=+R.getValue(),j=Math.floor(+b.getValue()),I=Math.floor(+N.getValue());if(Number.isNaN(D)||Number.isNaN(L)||Number.isNaN(P)||Number.isNaN(j)||Number.isNaN(I))return g.create(h.VALUE);if(D<0||L<=0||P<=0||![1,2,4].includes(j)||I<0||I>4||V>=S||!br(V,S,j))return g.create(h.NUM);const v=this._getResult(V,S,D,L,P,j,I);return y.create(v)}_getResult(e,t,r,n,s,a,u){if(er(e,t,a)>1){let E=r||.01,R=rs(e,t,r,E,s,a,u),b=R-n;for(let N=0;N<100&&Math.abs(b)>1e-7;N++)R=rs(e,t,r,1.01*E,s,a,u),E+=-b/(R-n-b)*E*.01,b=rs(e,t,r,E,s,a,u)-n;return E}const l=ts(e,t,a,u),f=Xe(e,t,a,u),{days:m}=_e(e,t,u),d=n/100+l/f*r/a;return(s/100+r/a-d)/d*a*f/m}}class Sd extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",5)}calculate(e,t,r,n,s){let a=s!=null?s:y.create(0);a.isNull()&&(a=y.create(0));const{isError:u,errorObject:c,variants:l}=Fe(e,t,r,n,a);if(u)return c;const[f,m,d,C,_]=l,E=G(f);if(typeof E!="number")return E;const R=G(m);if(typeof R!="number")return R;const b=+d.getValue(),N=+C.getValue(),V=Math.floor(+_.getValue());if(Number.isNaN(b)||Number.isNaN(N)||Number.isNaN(V))return g.create(h.VALUE);if(b<=0||N<=0||V<0||V>4||E>=R)return g.create(h.NUM);const{days:S,yearDays:D}=_e(E,R,V),L=(N/b-1)/(S/D);return y.create(L)}}class Md extends p{constructor(){super(...arguments);A(this,"minParams",5);A(this,"maxParams",6)}calculate(e,t,r,n,s,a){let u=a!=null?a:y.create(0);u.isNull()&&(u=y.create(0));const{isError:c,errorObject:l,variants:f}=Fe(e,t,r,n,s,u);if(c)return l;const[m,d,C,_,E,R]=f,b=G(m);if(typeof b!="number")return b;const N=G(d);if(typeof N!="number")return N;const V=G(C);if(typeof V!="number")return V;const S=+_.getValue(),D=+E.getValue(),L=Math.floor(+R.getValue());if(Number.isNaN(S)||Number.isNaN(D)||Number.isNaN(L))return g.create(h.VALUE);const P=this._getDateCorrectOrder(N,b,V);if(S<0||D<=0||L<0||L>4||!P)return g.create(h.NUM);const j=Pu(b,L),{days:I}=_e(b,N,L),{days:v}=_e(V,N,L),{days:Y}=_e(V,b,L),Q=((1+v/j*S)/(D/100+Y/j*S)-1)/(I/j);return y.create(Q)}_getDateCorrectOrder(e,t,r){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)}}const ku=[[D1,ee.ACCRINT],[w1,ee.ACCRINTM],[L1,ee.AMORLINC],[P1,ee.COUPDAYBS],[j1,ee.COUPDAYS],[x1,ee.COUPDAYSNC],[U1,ee.COUPNCD],[T1,ee.COUPNUM],[v1,ee.COUPPCD],[I1,ee.CUMIPMT],[F1,ee.CUMPRINC],[B1,ee.DB],[k1,ee.DDB],[$1,ee.DISC],[Y1,ee.DOLLARDE],[H1,ee.DOLLARFR],[G1,ee.DURATION],[W1,ee.EFFECT],[Q1,ee.FV],[q1,ee.FVSCHEDULE],[X1,ee.INTRATE],[K1,ee.IPMT],[Z1,ee.IRR],[z1,ee.ISPMT],[J1,ee.MDURATION],[ed,ee.MIRR],[td,ee.NOMINAL],[rd,ee.NPER],[nd,ee.NPV],[sd,ee.ODDFPRICE],[ad,ee.ODDFYIELD],[id,ee.ODDLPRICE],[od,ee.ODDLYIELD],[ud,ee.PDURATION],[cd,ee.PMT],[ld,ee.PPMT],[fd,ee.PRICE],[md,ee.PRICEDISC],[hd,ee.PRICEMAT],[gd,ee.PV],[dd,ee.RATE],[Cd,ee.RECEIVED],[_d,ee.RRI],[Ad,ee.SLN],[Ed,ee.SYD],[Rd,ee.TBILLEQ],[bd,ee.TBILLPRICE],[yd,ee.TBILLYIELD],[Nd,ee.VDB],[pd,ee.XIRR],[Vd,ee.XNPV],[Od,ee.YIELD],[Sd,ee.YIELDDISC],[Md,ee.YIELDMAT]];class Dd extends p{constructor(){super(...arguments);A(this,"needsReferenceObject",!0);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isError())return r;if(r.isReferenceObject()&&(r=r.toArrayValueObject()),r.isArray()){const n=r.getRowCount(),s=r.getColumnCount();if(n===1&&s===1){const a=r.get(0,0);return this._handleSingleObject(a,t)}return r.map(a=>a.isError()?a:this._handleSingleObject(a,t,!0))}return this._handleSingleObject(r,t)}_handleSingleObject(e,t,r=!1){let n=t;if(n.isError())return n;if(!n.isReferenceObject())return g.create(h.NA);const s=n.getCurrentActiveSheetData(),{columnData:a,defaultColumnWidth:u}=s;n=n.toArrayValueObject();const c=n.getCurrentRow(),l=n.getCurrentColumn();n=n.getFirstCell();const f=`${e.getValue()}`;let m;switch(f.toLocaleLowerCase()){case"address":return T.create(`$${M.Tools.chatAtABC(l)}$${c+1}`);case"col":return y.create(l+1);case"color":return y.create(0);case"contents":return n;case"filename":return g.create(h.VALUE);case"format":return T.create("G");case"parentheses":return y.create(0);case"prefix":return T.create("");case"protect":return y.create(1);case"row":return y.create(c+1);case"type":return m="v",n.isNull()&&(m="b"),n.isString()&&(m="l"),T.create(m);case"width":return this._getWidthResult(a,u,l,r);default:return g.create(h.VALUE)}}_getWidthResult(e,t,r,n){var u;let s=(u=e[r])==null?void 0:u.w;if(!s&&s!==0&&(s=t),n)return y.create(s);const a=[[s,s===t]];return Z.createByArray(a)}}class wd extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1);A(this,"_errorTypeValueMap",new Map([[h.NULL,1],[h.DIV_BY_ZERO,2],[h.VALUE,3],[h.REF,4],[h.NAME,5],[h.NUM,6],[h.NA,7],[h.CONNECT,8],[h.CALC,14]]))}calculate(e){return e.isArray()?e.mapValue(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){const t=e.getValue(),r=this._errorTypeValueMap.get(t);return r?y.create(r):g.create(h.NA)}}var ye=(i=>(i.CELL="CELL",i.ERROR_TYPE="ERROR.TYPE",i.INFO="INFO",i.ISBETWEEN="ISBETWEEN",i.ISBLANK="ISBLANK",i.ISDATE="ISDATE",i.ISEMAIL="ISEMAIL",i.ISERR="ISERR",i.ISERROR="ISERROR",i.ISEVEN="ISEVEN",i.ISFORMULA="ISFORMULA",i.ISLOGICAL="ISLOGICAL",i.ISNA="ISNA",i.ISNONTEXT="ISNONTEXT",i.ISNUMBER="ISNUMBER",i.ISODD="ISODD",i.ISOMITTED="ISOMITTED",i.ISREF="ISREF",i.ISTEXT="ISTEXT",i.ISURL="ISURL",i.N="N",i.NA="NA",i.SHEET="SHEET",i.SHEETS="SHEETS",i.TYPE="TYPE",i))(ye||{});class Ld extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",5)}calculate(e,t,r,n,s){const a=n!=null?n:F.create(!0),u=s!=null?s:F.create(!0),{isError:c,errorObject:l,variants:f}=Ir(e,t,r,a,u);if(c)return l;const[m,d,C,_,E]=f;if(_.isString()||E.isString())return g.create(h.VALUE);if(d.compare(C,">").getValue()===!0)return g.create(h.NUM);const b=+_.getValue(),N=+E.getValue(),V=b?">=":">",S=N?"<=":"<";return m.compare(d,V).getValue()===!1||m.compare(C,S).getValue()===!1?F.create(!1):F.create(!0)}}class Pd extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isNull()?F.create(!0):e.isArray()?e.mapValue(t=>t.isNull()?F.create(!0):F.create(!1)):F.create(!1)}}class jd extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){const r=t.getRowCount(),n=t.getColumnCount();if(r>1||n>1)return g.create(h.VALUE);t=t.get(0,0)}return t.isError()?t:t.isNumber()&&t.getPattern()!==""?F.create(wa(t.getPattern())):t.isString()&&(Kn(`${t.getValue()}`)||Zn(`${t.getValue()}`))?F.create(!0):F.create(!1)}}class xd extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){const a=t.getRowCount(),u=t.getColumnCount();if(a>1||u>1)return g.create(h.VALUE);t=t.get(0,0)}if(t.isError())return t;if(t.isNull()||t.isBoolean()||t.isNumber())return F.create(!1);const r=`${t.getValue()}`;if(r.length>254)return F.create(!1);const n=M.Tools.topLevelDomainCombiningString(),s=new RegExp(`^(?:[\\w+-]+\\.)*[\\w+-]+@[a-z0-9_-]+(?:\\.[a-z0-9_-]+)*\\.(?:${n})$`,"i");return F.create(s.test(r))}}class Ud extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.getValue()===h.NA?F.create(!1):e.isError()?F.create(!0):e.isArray()?e.mapValue(t=>t.getValue()===h.NA?F.create(!1):t.isError()?F.create(!0):F.create(!1)):F.create(!1)}}class Td extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isError()?F.create(!0):e.isArray()?e.mapValue(t=>t.isError()?F.create(!0):F.create(!1)):F.create(!1)}}class vd extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){const s=t.getRowCount(),a=t.getColumnCount();if(s>1||a>1)return g.create(h.VALUE);t=t.get(0,0)}if(t.isError())return t;if(t.isBoolean())return g.create(h.VALUE);const r=Math.trunc(+t.getValue());if(Number.isNaN(r))return g.create(h.VALUE);const n=r%2===0;return F.create(n)}}class Id extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1);A(this,"needsReferenceObject",!0)}calculate(e){var u;if(e.isError())return e;if(!e.isReferenceObject())return g.create(h.NA);const t=(u=e.getCurrentActiveSheetData())==null?void 0:u.cellData.getMatrix(),{startRow:r,startColumn:n}=e.getRangePosition(),s=e.toArrayValueObject(),a=s.mapValue((c,l,f)=>{var d;const m=(d=t==null?void 0:t[r+l])==null?void 0:d[n+f];return m!=null&&m.f||m!=null&&m.si?F.create(!0):F.create(!1)});return s.getRowCount()===1&&s.getColumnCount()===1?a.get(0,0):a}}class Fd extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isBoolean()?F.create(!0):e.isArray()?e.mapValue(t=>t.isBoolean()?F.create(!0):F.create(!1)):F.create(!1)}}class Bd extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.getValue()===h.NA?F.create(!0):e.isArray()?e.mapValue(t=>t.getValue()===h.NA?F.create(!0):F.create(!1)):F.create(!1)}}class kd extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return!e.isArray()&&!e.isString()?F.create(!0):e.isArray()?e.mapValue(t=>t.isString()?F.create(!1):F.create(!0)):F.create(!1)}}class $d extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isNumber()?F.create(!0):e.isArray()?e.mapValue(t=>t.isNumber()?F.create(!0):F.create(!1)):F.create(!1)}}class Yd extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){const s=t.getRowCount(),a=t.getColumnCount();if(s>1||a>1)return g.create(h.VALUE);t=t.get(0,0)}if(t.isError())return t;if(t.isBoolean())return g.create(h.VALUE);const r=Math.trunc(+t.getValue());if(Number.isNaN(r))return g.create(h.VALUE);const n=r%2!==0;return F.create(n)}}class Hd extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1);A(this,"needsReferenceObject",!0)}calculate(e){return e.isReferenceObject()?F.create(!0):F.create(!1)}}class Gd extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isString()?F.create(!0):e.isArray()?e.mapValue(t=>t.isString()?F.create(!0):F.create(!1)):F.create(!1)}}class Wd extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){const a=t.getRowCount(),u=t.getColumnCount();if(a>1||u>1)return g.create(h.VALUE);t=t.get(0,0)}if(t.isError())return t;if(t.isNull()||t.isBoolean()||t.isNumber())return F.create(!1);const r=`${t.getValue()}`.replace(/^\s+|\s+$/g,"");if(r.length>1e3)return F.create(!1);const n=M.Tools.topLevelDomainCombiningString(),s=new RegExp(`^(?:(?:https?|s?ftp|ftps|nfs|ssh)://+[a-z0-9_-]+(?:\\.[a-z0-9_-]+)*(?::[0-9]+)?(?:/(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[A-Fa-f0-9]{2})*)*/?(?:[?#]\\S*)?|[a-z0-9_-]+(?:\\.[a-z0-9_-]+)*\\.(?:${n})(?::[0-9]+)?(?:/(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[A-Fa-f0-9]{2})*)*/?(?:[?#]\\S*)?|mailto:(?:[\\w+-]+\\.)*[\\w+-]+@[a-z0-9_-]+(?:\\.[a-z0-9_-]+)*\\.(?:${n})|(?:news|aim):[%a-z0-9$_\\.+!*(),;/?#:@&~=-]+)$`,"i");return F.create(s.test(r))}}class Qd extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;if(e.isArray()&&(t=e.get(0,0)),t.isError())return t;if(t.isString())return y.create(0);const r=+t.getValue();return y.create(r)}}class qd extends p{constructor(){super(...arguments);A(this,"minParams",0);A(this,"maxParams",0)}calculate(){return g.create(h.NA)}}class Xd extends p{constructor(){super(...arguments);A(this,"minParams",0);A(this,"maxParams",1);A(this,"needsReferenceObject",!0);A(this,"needsSheetsInfo",!0)}calculate(e){var u;if(e!=null&&e.isError())return e;const{sheetOrder:t,sheetNameMap:r}=this.getSheetsInfo();if(!e){const c=t.findIndex(l=>l===this.subUnitId);return y.create(c+1)}if(e.isReferenceObject()){const c=e.getForcedSheetId(),l=e.getDefaultSheetId(),f=t.findIndex(m=>c?m===c:m===l);return y.create(f+1)}if(e.isArray())return g.create(h.NA);const n=`${e.getValue()}`.toLocaleLowerCase(),s=(u=Object.entries(r).find(([c,l])=>l.toLocaleLowerCase()===n))==null?void 0:u[0];if(!s)return g.create(h.NA);const a=t.findIndex(c=>c===s);return y.create(a+1)}}class Kd extends p{constructor(){super(...arguments);A(this,"minParams",0);A(this,"maxParams",0);A(this,"needsSheetsInfo",!0)}calculate(){const{sheetOrder:e}=this.getSheetsInfo();return y.create(e.length)}}class Zd extends p{constructor(){super(...arguments);A(this,"needsReferenceObject",!0);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isReferenceObject()){const t=e.getRowCount(),r=e.getColumnCount();if(t===1&&r===1){const n=e.getFirstCell();if(n.isError())return y.create(16);if(n.isBoolean())return y.create(4);if(n.isString())return y.create(2);if(n.isNumber()||n.isNull())return y.create(1)}else return y.create(64)}else{if(e.isArray())return y.create(64);if(e.isError())return y.create(16);if(e.isBoolean())return y.create(4);if(e.isString())return y.create(2);if(e.isNumber()||e.isNull())return y.create(1)}return y.create(128)}}const $u=[[Dd,ye.CELL],[wd,ye.ERROR_TYPE],[Ld,ye.ISBETWEEN],[Pd,ye.ISBLANK],[jd,ye.ISDATE],[xd,ye.ISEMAIL],[Ud,ye.ISERR],[Td,ye.ISERROR],[vd,ye.ISEVEN],[Id,ye.ISFORMULA],[Fd,ye.ISLOGICAL],[Bd,ye.ISNA],[kd,ye.ISNONTEXT],[$d,ye.ISNUMBER],[Yd,ye.ISODD],[Hd,ye.ISREF],[Gd,ye.ISTEXT],[Wd,ye.ISURL],[Qd,ye.N],[qd,ye.NA],[Xd,ye.SHEET],[Kd,ye.SHEETS],[Zd,ye.TYPE]];class zd extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=!0,r=!0,n=null;for(const s of e){if(s.isError())return s;if(s.isArray()){if(s.iterator(a=>{if(a!=null&&a.isError())return n=a,!1;(a!=null&&a.isBoolean()||a!=null&&a.isNumber())&&(t=t&&!!a.getValue(),r=!1)}),n)return n}else(s.isBoolean()||s.isNumber())&&(t=t&&!!s.getValue(),r=!1)}return r?g.create(h.VALUE):F.create(t)}}class Jd extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2);A(this,"needsReferenceObject",!0)}calculate(e,t){let r=e,n=null;if(e.isReferenceObject()&&(r=e.toArrayValueObject(),n=e),r.isError())return r;if(t.isError())return t;if(!(t.isValueObject()&&t.isLambda()&&t.getLambdaPrivacyVarKeys().length===1))return g.create(h.VALUE);const s=t,a=r.isArray()?r.getRowCount():1,u=r.isArray()?r.getColumnCount():1;r=O(a,u,r);const c=[[]];for(let l=0;l<u;l++){const f=[];for(let C=0;C<a;C++){const _=r.get(C,l);f.push([_])}let m=Z.create({calculateValueList:f,rowCount:a,columnCount:1,unitId:"",sheetId:"",row:0,column:0});if(n){const{startRow:C,startColumn:_}=n.getRangePosition(),E={startRow:C,startColumn:_+l,endRow:C+a-1,endColumn:_+l};m=this.createReferenceObject(n,E)}let d=s.execute(m);if(d.isArray()){const C=d.getRowCount(),_=d.getColumnCount();if(C>1||_>1)return g.create(h.CALC);d=d.get(0,0)}d.isNull()&&(d=y.create(0)),c[0].push(d)}return u===1?c[0][0]:Z.create({calculateValueList:c,rowCount:1,columnCount:u,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}class e0 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2);A(this,"needsReferenceObject",!0)}calculate(e,t){let r=e,n=null;if(e.isReferenceObject()&&(r=e.toArrayValueObject(),n=e),r.isError())return r;if(t.isError())return t;if(!(t.isValueObject()&&t.isLambda()&&t.getLambdaPrivacyVarKeys().length===1))return g.create(h.VALUE);const s=t,a=r.isArray()?r.getRowCount():1,u=r.isArray()?r.getColumnCount():1;r=O(a,u,r);const c=[];for(let l=0;l<a;l++){const f=[[]];for(let C=0;C<u;C++){const _=r.get(l,C);f[0].push(_)}let m=Z.create({calculateValueList:f,rowCount:1,columnCount:u,unitId:"",sheetId:"",row:0,column:0});if(n){const{startRow:C,startColumn:_}=n.getRangePosition(),E={startRow:C+l,startColumn:_,endRow:C+l,endColumn:_+u-1};m=this.createReferenceObject(n,E)}let d=s.execute(m);if(d.isArray()){const C=d.getRowCount(),_=d.getColumnCount();if(C>1||_>1)return g.create(h.CALC);d=d.get(0,0)}d.isNull()&&(d=y.create(0)),c.push([d])}return a===1?c[0][0]:Z.create({calculateValueList:c,rowCount:a,columnCount:1,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}class t0 extends p{constructor(){super(...arguments);A(this,"minParams",0);A(this,"maxParams",0)}calculate(){return F.create(!1)}}var Ee=(i=>(i.AND="AND",i.BYCOL="BYCOL",i.BYROW="BYROW",i.FALSE="FALSE",i.IF="IF",i.IFERROR="IFERROR",i.IFNA="IFNA",i.IFS="IFS",i.LAMBDA="LAMBDA",i.LET="LET",i.MAKEARRAY="MAKEARRAY",i.MAP="MAP",i.NOT="NOT",i.OR="OR",i.REDUCE="REDUCE",i.SCAN="SCAN",i.SWITCH="SWITCH",i.TRUE="TRUE",i.XOR="XOR",i))(Ee||{});class r0 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r=F.create(!1)){let n=e;if(e.isArray()){const f=e.getRowCount(),m=e.getColumnCount();f===1&&m===1&&(n=e.get(0,0))}if(!n.isArray())return this._handleSingleObject(n,t,r);const s=Math.max(n.isArray()?n.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),a=Math.max(n.isArray()?n.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=O(s,a,n,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA));return u.mapValue((f,m,d)=>{const C=c.get(m,d),_=l.get(m,d);return this._handleSingleObject(f,C,_)})}_handleSingleObject(e,t,r){return e.isError()?e:e.getValue()?t:r}}class n0 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(!e.isArray())return e.isError()?t:e;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e),a=O(r,n,t);return s.iterator((u,c,l)=>{u!=null&&u.isError()&&s.set(c,l,a.get(c,l))}),s}}class s0 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError()&&e.getErrorType()!==h.NA)return e;if(t.isError())return t;if(!e.isArray())return e.isError()&&e.getErrorType()===h.NA?t:e;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e),a=O(r,n,t);return s.iterator((u,c,l)=>{u!=null&&u.isError()&&u.getErrorType()===h.NA&&s.set(c,l,a.get(c,l))}),s}}class a0 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",255)}calculate(...e){if(e.length%2!==0)return g.create(h.NA);for(let a=0;a<e.length;a++)if(e[a].isError())return e[a];const t=Math.max(...e.map(a=>a.isArray()?a.getRowCount():1)),r=Math.max(...e.map(a=>a.isArray()?a.getColumnCount():1)),n=e.map(a=>O(t,r,a,g.create(h.NA))),s=n[0].map((a,u,c)=>{for(let l=0;l<n.length;l+=2){const f=n[l].get(u,c)||le.create(),m=n[l+1].get(u,c)||le.create();if(f.isNull())continue;if(f.isError())return f;const d=f.getValue();if(f.isString()){if(`${d}`.toLocaleUpperCase()==="TRUE")return m;if(`${d}`.toLocaleUpperCase()==="FALSE")continue;return g.create(h.VALUE)}if(+d)return m.isNull()?g.create(h.NA):m}return g.create(h.NA)});return t===1&&r===1?s.get(0,0):s}}class i0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){return g.create(h.VALUE)}}class o0 extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",255)}calculate(...e){return g.create(h.VALUE)}}class u0 extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(...e){const t=this.getIndexNumValue(e[0]);if(typeof t!="number")return t;const r=this.getIndexNumValue(e[1]);if(typeof r!="number")return r;if(!(e[2].isValueObject()&&e[2].isLambda()))return g.create(h.VALUE);const n=e[2],s=[];for(let a=0;a<t;a++){s[a]==null&&(s[a]=[]);for(let u=0;u<r;u++){let c=n.execute(y.create(a+1),y.create(u+1));c.isArray()&&(c=c.get(0,0)),s[a][u]=c}}return new zi(s)}isAsync(){return!0}}let c0=class extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",255);A(this,"needsReferenceObject",!0)}calculate(...e){const t=[];let r=null,n=0,s=0;for(let u=0;u<e.length;u++){const c=e[u];let l=c;if(l.isReferenceObject()&&(l=c.toArrayValueObject()),l.isError())return l;if(u===e.length-1){if(!(c.isValueObject()&&c.isLambda()))return g.create(h.VALUE);r=c}else t.push(c),n=Math.max(n,l.isArray()?l.getRowCount():1),s=Math.max(s,l.isArray()?l.getColumnCount():1)}const a=this._getResultArray(t,r,n,s);return a instanceof g?a:n===1&&s===1?a[0][0]:Z.create({calculateValueList:a,rowCount:n,columnCount:s,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}_getResultArray(e,t,r,n){const s=[];for(let a=0;a<r;a++){const u=[];for(let c=0;c<n;c++){const l=[];let f=!1;for(let d=0;d<e.length;d++){let C=e[d],_=null;if(C.isReferenceObject()&&(_=C,C=C.toArrayValueObject()),!C.isArray())if(a===0&&c===0){l.push(_||C);continue}else{u.push(g.create(h.NA)),f=!0;break}let E=C.get(a,c);if(!E){u.push(g.create(h.NA)),f=!0;break}if(_){const{startRow:R,startColumn:b}=_.getRangePosition(),N={startRow:R+a,startColumn:b+c,endRow:R+a,endColumn:b+c};E=this.createReferenceObject(_,N)}l.push(E)}if(f||l.length===0)continue;let m=t.execute(...l);if(m.isArray()){const d=m.getRowCount(),C=m.getColumnCount();if(d>1||C>1)return g.create(h.CALC);m=m.get(0,0)}m.isNull()&&(m=y.create(0)),u.push(m)}s.push(u)}return s}};class l0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;const t=+e.getValue();return Number.isNaN(t)?g.create(h.VALUE):F.create(!t)}}class f0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=!1,r=!0,n=null;for(const s of e){if(s.isError())return s;if(s.isArray()){if(s.iterator(a=>{if(a!=null&&a.isError())return n=a,!1;(a!=null&&a.isBoolean()||a!=null&&a.isNumber())&&(t=t||!!a.getValue(),r=!1)}),n)return n}else(s.isBoolean()||s.isNumber())&&(t=t||!!s.getValue(),r=!1)}return r?new g(h.VALUE):new F(t)}}class m0 extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3);A(this,"needsReferenceObject",!0)}calculate(e,t,r){let n,s;e.isReferenceObject()?(n=e.toArrayValueObject(),s=e):(n=e,s=null);let a,u;return t.isReferenceObject()?(a=t.toArrayValueObject(),u=t):(a=t,u=null),n.isArray()?n.mapValue(c=>this._handleSingleValueObject(c,a,r,s,u)):this._handleSingleValueObject(n,a,r,s,u)}_handleSingleValueObject(e,t,r,n,s){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(!(r.isValueObject()&&r.isLambda()&&r.getLambdaPrivacyVarKeys().length===2))return g.create(h.VALUE);const a=r,u=t.isArray()?t.getRowCount():1,c=t.isArray()?t.getColumnCount():1;let l=e;n&&(l=n);for(let f=0;f<u;f++)for(let m=0;m<c;m++){let d=t.isArray()?t.get(f,m):t;if(d.isError())return d;if(s){const{startRow:_,startColumn:E}=s.getRangePosition(),R={startRow:_+f,startColumn:E+m,endRow:_+f,endColumn:E+m};d=this.createReferenceObject(s,R)}let C=a.execute(l,d);if(C.isError())return C;C.isNull()&&(C=y.create(0)),l=C}return l.isReferenceObject()?l.toArrayValueObject():l}}class h0 extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3);A(this,"needsReferenceObject",!0)}calculate(e,t,r){let n=e,s=null;e.isReferenceObject()&&(n=e.toArrayValueObject(),s=e),n=n;let a=t,u=null;if(t.isReferenceObject()&&(a=t.toArrayValueObject(),u=t),a=a,n.isError())return n;if(a.isError())return a;if(r.isError())return r;if(!(r.isValueObject()&&r.isLambda()&&r.getLambdaPrivacyVarKeys().length===2))return g.create(h.VALUE);if(n.isArray()){const c=n.getRowCount(),l=n.getColumnCount();if(c>1||l>1)return g.create(h.CALC);n=n.get(0,0)}return this._getResult(n,a,r,s,u)}_getResult(e,t,r,n,s){const a=[],u=t.isArray()?t.getRowCount():1,c=t.isArray()?t.getColumnCount():1;let l=e;n&&(l=n);for(let f=0;f<u;f++){const m=[];for(let d=0;d<c;d++){if(l.isError()){m.push(l);continue}let C=t.isArray()?t.get(f,d):t;if(C.isError()){l=C,m.push(C);continue}if(s){const{startRow:E,startColumn:R}=s.getRangePosition(),b={startRow:E+f,startColumn:R+d,endRow:E+f,endColumn:R+d};C=this.createReferenceObject(s,b)}let _=r.execute(l,C);if(_.isArray()){const E=_.getRowCount(),R=_.getColumnCount();if(E>1||R>1)return g.create(h.CALC);_=_.get(0,0)}_.isNull()&&(_=y.create(0)),l=_,m.push(_)}a.push(m)}return u===1&&c===1?a[0][0]:Z.create({calculateValueList:a,rowCount:u,columnCount:c,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}class g0 extends p{constructor(){super(...arguments);A(this,"minParams",3)}calculate(e,...t){if(e.isError())return e;const r=t.length%2!==0,n=r?t[t.length-1]:le.create();return!e.isArray()&&!t.some(s=>s.isArray())?this._handleNonArrayInputs(e,t,n,r):this._handleArrayInputs(e,t,n,r)}_handleNonArrayInputs(e,t,r,n){for(let s=0;s<t.length-(n?1:0);s+=2){const a=t[s],u=t[s+1];if(!a.isNull()){if(a.isError())return a;if(`${e.getValue()}`.toLocaleLowerCase()===`${a.getValue()}`.toLocaleLowerCase())return u.isNull()?g.create(h.NA):u}}return r.isNull()?g.create(h.NA):r}_handleArrayInputs(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,...t.map(f=>f.isArray()?f.getRowCount():1),r.isArray()?r.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,...t.map(f=>f.isArray()?f.getColumnCount():1),r.isArray()?r.getColumnCount():1),u=O(s,a,e),c=t.map(f=>O(s,a,f,g.create(h.NA))),l=O(s,a,r,g.create(h.NA));return u.map((f,m,d)=>{for(let _=0;_<c.length-(n?1:0);_+=2){const E=c[_].get(m,d)||le.create(),R=c[_+1].get(m,d)||le.create();if(!E.isNull()){if(E.isError()||f.isError())return E.isError()?E:f;if(`${f.getValue()}`.toLocaleLowerCase()===`${E.getValue()}`.toLocaleLowerCase())return R.isNull()?g.create(h.NA):R}}const C=l.get(m,d)||le.create();return C.isNull()?g.create(h.NA):C})}}class d0 extends p{constructor(){super(...arguments);A(this,"minParams",0);A(this,"maxParams",0)}calculate(){return F.create(!0)}}class C0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=0,r=!0,n=null;for(const s of e){if(s.isError())return s;if(s.isArray()){if(s.iterator(a=>{if(a!=null&&a.isError())return n=a,!1;(a!=null&&a.isBoolean()||a!=null&&a.isNumber())&&(a.getValue()&&t++,r=!1)}),n)return n}else(s.isBoolean()||s.isNumber())&&(s.getValue()&&t++,r=!1)}return r?g.create(h.VALUE):F.create(t%2===1)}}const Yu=[[zd,Ee.AND],[Jd,Ee.BYCOL],[e0,Ee.BYROW],[t0,Ee.FALSE],[r0,Ee.IF],[n0,Ee.IFERROR],[s0,Ee.IFNA],[a0,Ee.IFS],[i0,Ee.LAMBDA],[o0,Ee.LET],[u0,Ee.MAKEARRAY],[c0,Ee.MAP],[l0,Ee.NOT],[f0,Ee.OR],[m0,Ee.REDUCE],[h0,Ee.SCAN],[g0,Ee.SWITCH],[d0,Ee.TRUE],[C0,Ee.XOR]];class _0 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",5)}calculate(e,t,r,n,s){if(e.isError())return e;if(t.isError())return t;if(r!=null&&r.isError())return r;if(n!=null&&n.isError())return n;if(s!=null&&s.isError())return s;const a=r!=null?r:y.create(1),u=n!=null?n:F.create(!0),c=s!=null?s:T.create(""),l=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,a.isArray()?a.getRowCount():1,u.isArray()?u.getRowCount():1,c.isArray()?c.getRowCount():1),f=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,a.isArray()?a.getColumnCount():1,u.isArray()?u.getColumnCount():1,c.isArray()?c.getColumnCount():1),m=O(l,f,e,g.create(h.NA)),d=O(l,f,t,g.create(h.NA)),C=O(l,f,a,g.create(h.NA)),_=O(l,f,u,g.create(h.NA)),E=O(l,f,c,g.create(h.NA));return m.map((R,b,N)=>{const V=d.get(b,N)||g.create(h.NA),S=C.get(b,N)||g.create(h.NA),D=_.get(b,N)||g.create(h.NA),L=E.get(b,N)||g.create(h.NA);return R.isError()?R:V.isError()?V:S.isError()?S:D.isError()?D:L.isError()?L:this._calculateSingleCell(R,V,S,D,L)})}_calculateSingleCell(e,t,r,n,s){const a=Number.parseInt(`${Number(e.getValue())-1}`),u=Number.parseInt(`${Number(t.getValue())-1}`),c=Number.parseInt(`${Number(r.getValue())}`);if(Number.isNaN(a)||Number.isNaN(u)||Number.isNaN(c)||c<1||c>4)return g.create(h.VALUE);const l=A0(c),f=this.getZeroOrOneByOneDefault(n),m=`${s.getValue()}`,d=Ri(m),C={startRow:a,startColumn:u,endRow:a,endColumn:u,startAbsoluteRefType:l,endAbsoluteRefType:l},_=n&&!f?Hm(C):bt(C);return T.create(d!==""?`${d}!${_}`:_)}}function A0(i){switch(i){case 1:return M.AbsoluteRefType.ALL;case 2:return M.AbsoluteRefType.ROW;case 3:return M.AbsoluteRefType.COLUMN;case 4:return M.AbsoluteRefType.NONE;default:return M.AbsoluteRefType.ALL}}class E0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1);A(this,"needsReferenceObject",!0)}calculate(e){return e.isReferenceObject()?y.create(1):g.create(h.VALUE)}}class R0 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",255);A(this,"needsReferenceObject",!0)}calculate(e,...t){let r=e;if(r.isError())return r;if(r.isReferenceObject()&&(r=r.toArrayValueObject()),!r.isArray()){const c=r.convertToNumberObjectValue();return c.isError()?c:t[Math.trunc(+c.getValue())-1]||g.create(h.VALUE)}let n=r.isArray()?r.getRowCount():1,s=r.isArray()?r.getColumnCount():1;t.forEach((c,l)=>{if(c.isArray()){const f=c;n=Math.max(n,f.getRowCount()),s=Math.max(s,f.getColumnCount())}else n=Math.max(n,1),s=Math.max(s,1)});const a=O(n,s,r,g.create(h.NA)),u=t.map(c=>{let l=c;return l.isReferenceObject()&&(l=l.toArrayValueObject()),O(n,s,l,g.create(h.NA))});return a.map((c,l,f)=>{if(c.isError())return c;const m=c.convertToNumberObjectValue();if(m.isError())return m;const d=u[Math.trunc(+m.getValue())-1];let C=(d==null?void 0:d.get(l,f))||g.create(h.VALUE);return C!=null&&C.isNull()&&(C=y.create(0)),C})}}class b0 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",255)}calculate(e,...t){if(e.isError())return e;const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=[];for(let a=0;a<t.length;a++){let u=t[a];if(u.isArray()){const f=u.getRowCount(),m=u.getColumnCount();if(f>1||m>1)return g.create(h.VALUE);u=u.get(0,0)}if(u.isString()&&(u=u.convertToNumberObjectValue()),u.isError())return u;const c=Math.trunc(+u.getValue());if(c===0||Math.abs(c)>n)return g.create(h.VALUE);let l=e;n>1&&(c<0?l=e.slice(void 0,[c+n,c+1+n]):l=e.slice(void 0,[c-1,c]));for(let f=0;f<r;f++)s[f]||(s[f]=[]),e.isArray()?s[f].push(l.get(f,0)):s[f].push(e)}return Z.create({calculateValueList:s,rowCount:s.length,columnCount:s[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}class y0 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",255)}calculate(e,...t){if(e.isError())return e;const r=e.isArray()?e.getRowCount():1,n=[];for(let s=0;s<t.length;s++){let a=t[s];if(a.isArray()){const l=a.getRowCount(),f=a.getColumnCount();if(l>1||f>1)return g.create(h.VALUE);a=a.get(0,0)}if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;const u=Math.trunc(+a.getValue());if(u===0||Math.abs(u)>r)return g.create(h.VALUE);let c=e;r>1&&(u<0?c=e.slice([u+r,u+1+r]):c=e.slice([u-1,u])),e.isArray()?n.push(c.getArrayValue()[0]):n.push([e])}return Z.create({calculateValueList:n,rowCount:n.length,columnCount:n[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}class N0 extends p{constructor(){super(...arguments);A(this,"minParams",0);A(this,"maxParams",1)}calculate(e){if(e==null)return y.create(this.column+1);if(e.isError())return e;if(!e.isArray())return g.create(h.NA);const t=e.getCurrentColumn(),r=e.getColumnCount(),n=[];for(let a=0;a<r;a++)n.push(y.create(t+a+1));const s={calculateValueList:[n],rowCount:1,columnCount:r,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return Z.create(s)}}class p0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isError())return e;if(e.isString()||e.isNumber()||e.isBoolean())return y.create(1);if(!e.isArray())return g.create(h.NA);const t=e.getColumnCount();return y.create(t)}}class V0 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){const n=r!=null?r:y.create(0),s=e.isArray()?e.getRowCount():1,a=e.isArray()?e.getColumnCount():1,u=Math.max(t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),c=Math.max(t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),l=O(u,c,t,g.create(h.NA)),f=O(u,c,n,g.create(h.NA));if(u>1||c>1)return l.mapValue((b,N,V)=>{const S=f.get(N,V);if(e.isError())return e;if(e.isNull())return g.create(h.VALUE);const{isError:D,errorObject:L}=this._checkRowsColumns(b,S,s,a);return D?L:e.isArray()?g.create(h.VALUE):e});if(e.isError())return e;if(e.isNull())return g.create(h.VALUE);const m=t.isArray()?t.get(0,0):t,d=n.isArray()?n.get(0,0):n,{isError:C,errorObject:_,rowsValue:E,columnsValue:R}=this._checkRowsColumns(m,d,s,a);return C?_:this._getResultArray(e,E,R,s,a)}_checkRowsColumns(e,t,r,n){if(e.isError())return{isError:!0,errorObject:e};if(t.isError())return{isError:!0,errorObject:t};const s=Math.trunc(+e.getValue()),a=Math.trunc(+t.getValue());return Number.isNaN(s)||Number.isNaN(a)?{isError:!0,errorObject:g.create(h.VALUE)}:Math.abs(s)>=r||Math.abs(a)>=n?{isError:!0,errorObject:g.create(h.CALC)}:{isError:!1,rowsValue:s,columnsValue:a}}_getResultArray(e,t,r,n,s){const a=t>=0?[t,n]:[0,n+t],u=r>=0?[r,s]:[0,s+r];let c;return t===0&&r===0?c=e:t===0?c=e.slice(void 0,u):r===0?c=e.slice(a,void 0):c=e.slice(a,u),c=c.map(l=>l.isNull()?y.create(0):l),n-t===1&&s-r===1?c.get(0,0):c}}class O0 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",4)}calculate(e,t,r,n){const s=e.isArray()?e.getRowCount():1,a=e.isArray()?e.getColumnCount():1;let u=t,c=r!=null?r:y.create(a);const l=n!=null?n:g.create(h.NA);t.isNull()&&(u=y.create(s)),c.isNull()&&(c=y.create(a));const f=Math.max(u.isArray()?u.getRowCount():1,c.isArray()?c.getRowCount():1),m=Math.max(u.isArray()?u.getColumnCount():1,c.isArray()?c.getColumnCount():1),d=O(f,m,u,g.create(h.NA)),C=O(f,m,c,g.create(h.NA));if(f>1||m>1)return d.mapValue((D,L,P)=>{const j=C.get(L,P);if(e.isError())return e;if(e.isNull())return g.create(h.VALUE);const{isError:I,errorObject:v}=this._checkRowsColumnsPadWith(D,j,l,s,a);return I?v:e.isArray()?e.get(0,0):e});if(e.isError())return e;if(e.isNull())return g.create(h.VALUE);const _=u.isArray()?u.get(0,0):u,E=c.isArray()?c.get(0,0):c,{isError:R,errorObject:b,rowsValue:N,columnsValue:V,padWithObject:S}=this._checkRowsColumnsPadWith(_,E,l,s,a);return R?b:this._getResultArray(e,N,V,S,s,a)}_checkRowsColumnsPadWith(e,t,r,n,s){if(e.isError())return{isError:!0,errorObject:e};if(t.isError())return{isError:!0,errorObject:t};const a=Math.trunc(+e.getValue()),u=Math.trunc(+t.getValue());if(Number.isNaN(a)||Number.isNaN(u))return{isError:!0,errorObject:g.create(h.VALUE)};if(Math.abs(a)<n||Math.abs(u)<s)return{isError:!0,errorObject:g.create(h.VALUE)};let c=r;if(r.isArray()){const l=r.getRowCount(),f=r.getColumnCount();if(l>1||f>1)return{isError:!0,errorObject:g.create(h.VALUE)};c=r.get(0,0)}return{isError:!1,rowsValue:a,columnsValue:u,padWithObject:c}}_getResultArray(e,t,r,n,s,a){let u=[];e.isArray()?u=e.map(f=>f.isNull()?y.create(0):f).getArrayValue():u=[[e]];const c=Math.max(0,t-s),l=Math.max(0,r-a);for(let f=0;f<c;f++)u.push(new Array(a).fill(n));for(let f=0;f<l;f++)u.forEach(m=>{m.push(n)});return t===1&&r===1?u[0][0]:Z.create({calculateValueList:u,rowCount:u.length,columnCount:u[0].length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}class S0 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){const n=r!=null?r:g.create(h.CALC);if(e.isError())return e;if(t.isError())return t;const s=e.isArray()?e.getRowCount():1,a=e.isArray()?e.getColumnCount():1,u=t.isArray()?t.getRowCount():1,c=t.isArray()?t.getColumnCount():1;return u>1&&c>1||u===1&&c!==a||c===1&&u!==s?g.create(h.VALUE):s===1&&a===1?this._getResultArrayByR1C1(e,t,n):u===1?c!==a?g.create(h.VALUE):this._getResultArrayByR1(s,a,e,t,n):c===1?u!==s?g.create(h.VALUE):this._getResultArrayByC1(s,a,e,t,n):n}_getResultArrayByR1C1(e,t,r){let n=e,s=t;return n.isArray()&&(n=n.get(0,0)),s.isArray()&&(s=s.get(0,0)),s.isString()&&(s=s.convertToNumberObjectValue()),s.isError()?s:+s.getValue()?n:r}_getResultArrayByR1(e,t,r,n,s){const a=[];for(let u=0;u<t;u++){let c=n.get(0,u);if(c.isString()&&(c=c.convertToNumberObjectValue()),c.isError())return c;if(+c.getValue())for(let f=0;f<e;f++){a[f]||(a[f]=[]);const m=r.get(f,u);a[f].push(m)}}return a.length===0?s:Z.create({calculateValueList:a,rowCount:a.length,columnCount:a[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}_getResultArrayByC1(e,t,r,n,s){const a=[];for(let u=0;u<e;u++){let c=n.get(u,0);if(c.isString()&&(c=c.convertToNumberObjectValue()),c.isError())return c;if(!+c.getValue())continue;const f=[];for(let m=0;m<t;m++){const d=r.get(u,m);f.push(d)}a.push(f)}return a.length===0?s:Z.create({calculateValueList:a,rowCount:a.length,columnCount:a[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}class M0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1);A(this,"needsReferenceObject",!0);A(this,"needsFormulaDataModel",!0)}calculate(e){var f,m;if(!e.isReferenceObject())return g.create(h.NA);const t=e.getUnitId(),r=e.getSheetId(),s=(m=(f=e.getUnitData()[t])==null?void 0:f[r])==null?void 0:m.cellData,{startRow:a,startColumn:u}=e.getRangePosition(),l=e.toArrayValueObject().mapValue((d,C,_)=>{const E=s.getValue(a+C,u+_);if(E!=null&&E.f||E!=null&&E.si){const R=this._formulaDataModel.getFormulaStringByCell(a+C,u+_,r,t);return T.create(R)}return g.create(h.NA)});return l.getRowCount()===1&&l.getColumnCount()===1?l.get(0,0):l}}var ne=(i=>(i.ADDRESS="ADDRESS",i.AREAS="AREAS",i.CHOOSE="CHOOSE",i.CHOOSECOLS="CHOOSECOLS",i.CHOOSEROWS="CHOOSEROWS",i.COLUMN="COLUMN",i.COLUMNS="COLUMNS",i.DROP="DROP",i.EXPAND="EXPAND",i.FILTER="FILTER",i.FORMULATEXT="FORMULATEXT",i.GETPIVOTDATA="GETPIVOTDATA",i.HLOOKUP="HLOOKUP",i.HSTACK="HSTACK",i.HYPERLINK="HYPERLINK",i.IMAGE="IMAGE",i.INDEX="INDEX",i.INDIRECT="INDIRECT",i.LOOKUP="LOOKUP",i.MATCH="MATCH",i.OFFSET="OFFSET",i.ROW="ROW",i.ROWS="ROWS",i.RTD="RTD",i.SORT="SORT",i.SORTBY="SORTBY",i.TAKE="TAKE",i.TOCOL="TOCOL",i.TOROW="TOROW",i.TRANSPOSE="TRANSPOSE",i.UNIQUE="UNIQUE",i.VLOOKUP="VLOOKUP",i.VSTACK="VSTACK",i.WRAPCOLS="WRAPCOLS",i.WRAPROWS="WRAPROWS",i.XLOOKUP="XLOOKUP",i.XMATCH="XMATCH",i))(ne||{});class D0 extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",4)}calculate(e,t,r,n){if(e.isError())return e;if(t.isError())return g.create(h.REF);if(!t.isArray()||r.isError()||n!=null&&n.isError())return g.create(h.NA);const s=this.getZeroOrOneByOneDefault(n);if(s==null)return g.create(h.VALUE);const a=this.getIndexNumValue(r);if(a instanceof g)return a;const u=t.slice([0,1]),c=t.slice([a-1,a]);return u==null||c==null?g.create(h.REF):e.isArray()?e.map(l=>this._handleSingleObject(l,u,c,s)):this._handleSingleObject(e,u,c,s)}_handleSingleObject(e,t,r,n){return n===0?this.equalSearch(e,t,r):this.binarySearch(e,t,r)}}class w0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=Math.max(...e.map(n=>n.isArray()?n.getRowCount():1)),r=[];for(let n=0;n<e.length;n++){const s=e[n];if(s.isError())return s;const a=s.isArray()?s.getRowCount():1,u=s.isArray()?s.getColumnCount():1;for(let c=0;c<t;c++){r[c]||(r[c]=[]);for(let l=0;l<u;l++){let f=s;s.isArray()&&(f=s.get(c,l)),c>a-1||!f?r[c].push(g.create(h.NA)):r[c].push(f)}}}return Z.create({calculateValueList:r,rowCount:r.length,columnCount:r[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}class L0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){let r=e;if(e.isArray()&&(r=e.get(0,0)),r.isError())return r;let n=t;if(t!=null&&t.isArray()&&(n=t.get(0,0)),n!=null&&n.isError())return n;let s=`${r.getValue()}`;r.isNull()&&(s="");let a=s;return n&&(a=`${n.getValue()}`,n.isNull()?a="0":n.isBoolean()&&(a=a.toLocaleUpperCase())),T.create(a,{isHyperlink:!0,hyperlinkUrl:s})}}class P0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",5)}calculate(e,t,r,n,s){const a=Math.max(e.isArray()?e.getRowCount():1,t!=null&&t.isArray()?t.getRowCount():1,r!=null&&r.isArray()?r.getRowCount():1,n!=null&&n.isArray()?n.getRowCount():1,s!=null&&s.isArray()?s.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t!=null&&t.isArray()?t.getColumnCount():1,r!=null&&r.isArray()?r.getColumnCount():1,n!=null&&n.isArray()?n.getColumnCount():1,s!=null&&s.isArray()?s.getColumnCount():1),c=O(a,u,e,g.create(h.NA)),l=t?O(a,u,t,g.create(h.NA)):void 0,f=r?O(a,u,r,g.create(h.NA)):void 0,m=n?O(a,u,n,g.create(h.NA)):void 0,d=s?O(a,u,s,g.create(h.NA)):void 0,C=c.mapValue((_,E,R)=>{if(_.isError())return _;const b=l?l.get(E,R):void 0;if(b!=null&&b.isError())return b;const N=f?f.get(E,R):void 0;if(N!=null&&N.isError())return N;const V=m?m.get(E,R):void 0;if(V!=null&&V.isError())return V;const S=d?d.get(E,R):void 0;return S!=null&&S.isError()?S:this._handleSingleObject(_,b,N,V,S)});return a===1&&u===1?C.get(0,0):C}_handleSingleObject(e,t,r,n,s){if(!e.isString())return g.create(h.VALUE);const a=e.getValue();let u="";t&&(t.isBoolean()?u=t.getValue()?"TRUE":"FALSE":t.isNull()||(u=`${t.getValue()}`));let c=r!=null?r:y.create(0);if(c.isString()&&(c=c.convertToNumberObjectValue()),c.isError())return c;const l=Math.abs(Math.trunc(+c.getValue()));if(l<0||l>3||[0,1,2].includes(l)&&(n||s))return g.create(h.VALUE);let f=n!=null?n:y.create(0);if(f.isString()&&(f=f.convertToNumberObjectValue()),f.isError())return f;const m=Math.ceil(+f.getValue());let d=s!=null?s:y.create(0);if(d.isString()&&(d=d.convertToNumberObjectValue()),d.isError())return d;const C=Math.ceil(+d.getValue());return l===3&&m<1&&C<1?g.create(h.VALUE):T.create("",{isImage:!0,imageInfo:{source:a,altText:u,sizing:l,height:m,width:C}})}}class j0 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",4);A(this,"needsReferenceObject",!0)}calculate(e,t,r,n){if(e.isError())return e;const s=this._getReferenceCounts(e);let a=t;t.isReferenceObject()&&(a=t.toArrayValueObject());let u=r;u!=null&&u.isReferenceObject()&&(u=r.toArrayValueObject());let c=n!=null?n:y.create(1);c.isReferenceObject()&&(c=n.toArrayValueObject());const l=Math.max(a.isArray()?a.getRowCount():1,u!=null&&u.isArray()?u.getRowCount():1,c.isArray()?c.getRowCount():1),f=Math.max(a.isArray()?a.getColumnCount():1,u!=null&&u.isArray()?u.getColumnCount():1,c.isArray()?c.getColumnCount():1);if(l===1&&f===1)return this._handleSingleObject(e,a.isArray()?a.get(0,0):a,u?u.isArray()?u.get(0,0):u:void 0,c.isArray()?c.get(0,0):c,s);{const m=O(l,f,a,g.create(h.NA)),d=u?O(l,f,u,g.create(h.NA)):[],C=O(l,f,c,g.create(h.NA));return m.mapValue((_,E,R)=>{const b=u?d.get(E,R):void 0,N=C.get(E,R),V=this._handleSingleObject(e,_,b,N,s);return V.isReferenceObject()?V.getCellByPosition():V})}}_handleSingleObject(e,t,r,n,s){let a,u,c;if(r){const{isError:_,errorObject:E,variants:R}=B(t,r,n);if(_)return E;a=R[0],u=R[1],c=R[2]}else{const{isError:_,errorObject:E,variants:R}=B(t,n);if(_)return E;a=R[0],c=R[1]}const l=Math.floor(+c.getValue());if(l<0)return g.create(h.VALUE);if(l>s.length)return g.create(h.REF);const f=s[l-1];let m=0,d=0;if(f.rowCount===1&&!r?d=Math.floor(+a.getValue()):(m=Math.floor(+a.getValue()),r&&(d=Math.floor(+u.getValue()))),m<0||d<0)return g.create(h.VALUE);if(m>f.rowCount||d>f.columnCount)return g.create(h.REF);let C=e;return l>1&&(C=e.getCubeValues()[l-1]),C.isReferenceObject()?this._calculateReferenceObject(C,m,d):this._calculateArrayObject(C,m,d)}_getReferenceCounts(e){let t=[{rowCount:1,columnCount:1}];return e.isReferenceObject()?t=[{rowCount:e.getRowCount(),columnCount:e.getColumnCount()}]:e.isCube()?t=e.getCubeValues().map(r=>({rowCount:r.getRowCount(),columnCount:r.getColumnCount()})):e.isArray()&&(t=[{rowCount:e.getRowCount(),columnCount:e.getColumnCount()}]),t}_calculateReferenceObject(e,t,r){const{startRow:n,endRow:s,startColumn:a,endColumn:u}=e.getRangePosition();let c=0,l=0,f=0,m=0;if(t===0?(c=n,l=s):c=l=n+t-1,r===0?(f=a,m=u):f=m=a+r-1,c>s||f>u)return g.create(h.REF);const d={startRow:c,startColumn:f,endRow:l,endColumn:m};return this.createReferenceObject(e,d)}_calculateArrayObject(e,t,r){return!e.isArray()||t===0&&r===0?e:t===0?e.slice(void 0,[r-1,r]):r===0?e.slice([t-1,t],void 0):e.get(t-1,r-1)}}class x0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}isAddress(){return!0}calculate(e,t){if(e.isError())return e;if(t!=null&&t.isError())return t;let r=this.getZeroOrOneByOneDefault(t);r==null&&(r=1);let n=e;if(e.isArray()){const s=e.getRowCount(),a=e.getColumnCount();if(s>1||a>1)return e.map(()=>g.create(h.VALUE));n=e.getFirstCell()}return this._handleSingleObject(n,r)}_handleSingleObject(e,t){const r=`${e.getValue()}`;if(r.trim()==="")return g.create(h.REF);const n=this._convertToDefinedName(r);if(t===0){const f=bo(n),{range:m,sheetName:d,unitId:C}=f,_=new Pr(m);return _.setForcedUnitIdDirect(C),_.setForcedSheetName(d),this._setDefault(_)}if(pr(n))return this._setDefault(new Qs(n));if(oi(n))return this._setDefault(new Xs(n));if(ui(n))return this._setDefault(new qs(n));const s=Yt(n),{range:a,sheetName:u,unitId:c}=s;if(Number.isNaN(a.startRow)||a.endRow+1>1048576||Number.isNaN(a.startColumn)||a.endColumn+1>16384)return g.create(h.REF);const l=new Pr(a);return l.setForcedUnitIdDirect(c),l.setForcedSheetName(u),this._setDefault(l)}_setDefault(e){return this.unitId==null||this.subUnitId==null?g.create(h.REF):(e.setDefaultUnitId(this.unitId),e.setDefaultSheetId(this.subUnitId),e)}_convertToDefinedName(e){const t=this.getDefinedName(e);if(t==null)return e;const r=t.formulaOrRefString;return r==null?e:r.startsWith(z.EQUALS)?r.slice(1):r}}class U0 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3);A(this,"needsExpandParams",!0)}calculate(e,t,r){return e.isError()?e:t.isError()?g.create(h.REF):t.isArray()?r!=null&&r.isError()?r:t.getColumnCount()===1||t.getRowCount()===1?r!=null&&!r.isArray()?g.create(h.REF):this._handleVector(e,t,r):this._handleArray(e,t):g.create(h.VALUE)}_handleVector(e,t,r){let n=r;if(n==null)n=t;else if(n.getRowCount()!==t.getRowCount()||n.getColumnCount()!==t.getColumnCount())return g.create(h.REF);return e.isArray()?e.map(s=>this.binarySearch(s,t,n)):this.binarySearch(e,t,n)}_handleArray(e,t){const r=t.getRowCount(),n=t.getColumnCount();let s,a;return n>r?(s=t.slice([0,1]),a=t.slice([r-1,r])):(s=t.slice(void 0,[0,1]),a=t.slice(void 0,[n-1,n])),s==null||a==null?g.create(h.VALUE):e.isArray()?e.map(u=>this.binarySearch(u,s,a)):this.binarySearch(e,s,a)}}class T0 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){if(e.isError())return e;if(t.isError())return g.create(h.REF);if(!t.isArray())return g.create(h.VALUE);const n=t.getRowCount(),s=t.getColumnCount();if(n!==1&&s!==1||r!=null&&r.isError())return g.create(h.NA);const a=this.getMatchTypeValue(r);return a==null?g.create(h.VALUE):e.isArray()?e.map(u=>this._handleSingleObject(u,t,a)):this._handleSingleObject(e,t,a)}_handleSingleObject(e,t,r){const n=e.isNull()?y.create(0):e,s=this._getSearchModeValue(r),a=t.orderSearch(n,s);if(a==null)return g.create(h.NA);if(a instanceof g)return a;const u=t.getRowCount()===1?a.column+1:a.row+1;return y.create(u)}_getSearchModeValue(e){switch(e){case 1:return Le.MIN;case 0:return Le.NORMAL;case-1:return Le.MAX}}}class v0 extends Wt{constructor(e,t=[]){super(e);A(this,"_areas",[]);this._areas=t}dispose(){this._areas.forEach(e=>{e.forEach(t=>t.dispose())}),this._areas=[],super.dispose()}getAreas(){return this._areas}setAreas(e){this._areas=e}addArea(e){Array.isArray(e)?this._areas.push(e):this._areas.push([e])}_flatAreas(){return this._areas.flat()}isMultiArea(){return!0}isRange(){return!1}isCell(){return!1}isRow(){return!1}isColumn(){return!1}getRowCount(){let e=0;for(const t of this._flatAreas())t.isError()||(e+=t.getRowCount());return e}getColumnCount(){let e=0;for(const t of this._flatAreas())t.isError()||(e+=t.getColumnCount());return e}isExceedRange(){return this._flatAreas().some(e=>e.isError()?!1:e.isExceedRange())}setRefOffset(e=0,t=0){super.setRefOffset(e,t),this._flatAreas().forEach(r=>{r.isError()||r.setRefOffset(e,t)})}_getReferenceArea(){return this._flatAreas().find(r=>!r.isError())}getUnitId(){var e,t;return(t=(e=this._getReferenceArea())==null?void 0:e.getUnitId())!=null?t:super.getUnitId()}getSheetId(){var e,t;return(t=(e=this._getReferenceArea())==null?void 0:e.getSheetId())!=null?t:super.getSheetId()}getActiveSheetRowCount(){var e,t;return(t=(e=this._getReferenceArea())==null?void 0:e.getActiveSheetRowCount())!=null?t:0}getActiveSheetColumnCount(){var e,t;return(t=(e=this._getReferenceArea())==null?void 0:e.getActiveSheetColumnCount())!=null?t:0}iterator(e){for(const t of this._areas){let r=!1;for(const n of t){if(n.isError())continue;let s=!1;if(n.iterator((a,u,c)=>{const l=e(a,u,c);return l===!1?(s=!0,r=!0,!1):l}),s)break}if(r)return}}getFirstCell(){const e=this._getReferenceArea();return e?e.getFirstCell():super.getFirstCell()}toArrayValueObject(){var n,s;const e=this._areas.length;if(e===0)return at([],0,0);const t=(s=(n=this._areas[0])==null?void 0:n.length)!=null?s:0,r=[];for(let a=0;a<e;a++){const u=this._areas[a];if(u){r[a]=r[a]||[];for(let c=0;c<t;c++){const l=u[c];if(!l)continue;if(l.isError()){r[a][c]=l;continue}let f=null;l.iterator(m=>(f=m!=null?m:null,!1)),f!=null&&(r[a][c]=f),r[a][c]=le.create()}}}return at(r,e,t)}getRangePosition(){const e=this._flatAreas();if(!e.length)return super.getRangePosition();let t=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,s=Number.NEGATIVE_INFINITY;for(const a of e){if(a.isError())continue;const{startRow:u,startColumn:c,endRow:l,endColumn:f}=a.getRangePosition();!Number.isFinite(u)||!Number.isFinite(c)||!Number.isFinite(l)||!Number.isFinite(f)||(u<t&&(t=u),c<r&&(r=c),l>n&&(n=l),f>s&&(s=s<f?f:s))}return!Number.isFinite(t)||!Number.isFinite(r)||!Number.isFinite(n)||!Number.isFinite(s)?super.getRangePosition():{startRow:t,startColumn:r,endRow:n,endColumn:s}}toUnitRange(){return{range:this.getRangePosition(),sheetId:this.getSheetId(),unitId:this.getUnitId()}}getRangeData(){const e=this._flatAreas();if(!e.length)return super.getRangeData();let t=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,s=Number.NEGATIVE_INFINITY;for(const a of e){if(a.isError())continue;const{startRow:u,startColumn:c,endRow:l,endColumn:f}=a.getRangeData();!Number.isFinite(u)||!Number.isFinite(c)||!Number.isFinite(l)||!Number.isFinite(f)||(u<t&&(t=u),c<r&&(r=c),l>n&&(n=l),f>s&&(s=f))}return!Number.isFinite(t)||!Number.isFinite(r)||!Number.isFinite(n)||!Number.isFinite(s)?super.getRangeData():{startRow:t,startColumn:r,endRow:n,endColumn:s}}}class I0 extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",5);A(this,"needsReferenceObject",!0)}isAddress(){return!0}calculate(e,t,r,n,s){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(n!=null&&n.isError())return n;if(s!=null&&s.isError())return s;if(!e.isReferenceObject())return g.create(h.VALUE);const a=e.getRowCount(),u=e.getColumnCount();let c=t;c.isReferenceObject()&&(c=c.toArrayValueObject());let l=r;l.isReferenceObject()&&(l=l.toArrayValueObject());let f=n!=null?n:y.create(a);f.isReferenceObject()&&(f=f.toArrayValueObject()),f.isNull()&&(f=y.create(a));let m=s!=null?s:y.create(u);m.isReferenceObject()&&(m=m.toArrayValueObject()),m.isNull()&&(m=y.create(u));const d=Math.max(c.isArray()?c.getRowCount():1,l.isArray()?l.getRowCount():1,f.isArray()?f.getRowCount():1,m.isArray()?m.getRowCount():1),C=Math.max(c.isArray()?c.getColumnCount():1,l.isArray()?l.getColumnCount():1,f.isArray()?f.getColumnCount():1,m.isArray()?m.getColumnCount():1);if(c=c,l=l,f=f,m=m,d===1&&C===1)return c=c.isArray()?c.get(0,0):c,l=l.isArray()?l.get(0,0):l,f=f.isArray()?f.get(0,0):f,m=m.isArray()?m.get(0,0):m,this._handleSingleObject(e,c,l,f,m);const _=O(d,C,c,g.create(h.NA)),E=O(d,C,l,g.create(h.NA)),R=O(d,C,f,g.create(h.NA)),b=O(d,C,m,g.create(h.NA)),N=[];return _.iterator((V,S,D)=>{const L=E.get(S,D),P=R.get(S,D),j=b.get(S,D);if(N[S]=N[S]||[],V==null){N[S][D]=g.create(h.NA);return}if(V.isError()){N[S][D]=V;return}if(L.isError()){N[S][D]=L;return}if(P.isError()){N[S][D]=P;return}if(j.isError()){N[S][D]=j;return}const I=this._handleSingleObject(e,V,L,P,j);N[S][D]=I}),new v0("",N)}_handleSingleObject(e,t,r,n,s){const{startRow:a,startColumn:u}=e.getRangePosition();let c=t;if(c.isString()&&(c=c.convertToNumberObjectValue()),c.isError())return c;let l=r;if(l.isString()&&(l=l.convertToNumberObjectValue()),l.isError())return l;const f=+c.getValue(),m=+l.getValue();if(typeof f!="number"||typeof m!="number")return g.create(h.VALUE);const d=a+f,C=u+m;if(d<0||C<0)return g.create(h.REF);const _=this.getIndexNumValue(n),E=this.getIndexNumValue(s);if(typeof _!="number"||typeof E!="number")return g.create(h.VALUE);if(_===0||E===0)return g.create(h.REF);const R=_>0?d+_-1:d+_+1,b=E>0?C+E-1:C+E+1;if(R<0||b<0)return g.create(h.REF);const N=d<R?d:R,V=C<b?C:b,S=d>R?d:R,D=C>b?C:b,L={startRow:N,startColumn:V,endRow:S,endColumn:D};return this.createReferenceObject(e,L)}}class F0 extends p{constructor(){super(...arguments);A(this,"minParams",0);A(this,"maxParams",1)}calculate(e){if(e==null)return y.create(this.row+1);if(e.isError())return e;if(!e.isArray())return g.create(h.NA);const t=e.getCurrentRow(),r=e.getRowCount(),n=[];for(let a=0;a<r;a++)n.push([y.create(t+a+1)]);const s={calculateValueList:n,rowCount:r,columnCount:1,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return Z.create(s)}}class B0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isError())return e;if(e.isString()||e.isNumber()||e.isBoolean())return y.create(1);if(!e.isArray())return g.create(h.NA);const t=e.getRowCount();return y.create(t)}}class k0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",4)}calculate(e,t,r,n){let s=t!=null?t:y.create(1);const a=r!=null?r:y.create(1),u=n!=null?n:F.create(!1);if(s.isNull()&&(s=y.create(1)),u.isArray()){const c=u.getRowCount(),l=u.getColumnCount();if(c===1&&l===1){const f=u.get(0,0);return this._handleSingleObject(e,s,a,f)}return u.map(f=>{const m=this._handleSingleObject(e,s,a,f);return m.isArray()?m.get(0,0):m})}return this._handleSingleObject(e,s,a,u)}_handleSingleObject(e,t,r,n){if(e.isError())return e;const s=e.isArray()?e.getRowCount():1,a=e.isArray()?e.getColumnCount():1,u=this._checkArrayError(t);if(u.isError())return u;const c=Math.floor(+u.getValue());if(c<1)return g.create(h.VALUE);const l=this._checkArrayError(r);if(l.isError())return l;const f=Math.floor(+l.getValue());if(f!==-1&&f!==1)return g.create(h.VALUE);let m=n;if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;if(!e.isArray()||s===1&&a===1)return e;const d=+m.getValue();return this._getResult(e,c,f,d,s,a)}_checkArrayError(e){let t=e;if(t.isArray()){const r=t.getRowCount(),n=t.getColumnCount();if(r>1||n>1)return g.create(h.VALUE);t=t.get(0,0)}return t.isString()&&(t=t.convertToNumberObjectValue()),t}_getResult(e,t,r,n,s,a){if(n){if(t>s)return g.create(h.VALUE);const u=e.transpose().getArrayValue();return u.sort(this._sort(t-1,r)),Z.create({calculateValueList:u,rowCount:u.length,columnCount:u[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column}).transpose()}else{if(t>a)return g.create(h.VALUE);const u=e.getArrayValue();return u.sort(this._sort(t-1,r)),Z.create({calculateValueList:u,rowCount:u.length,columnCount:u[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}_sort(e,t=1){const r=dn();return t===1?this._sortAsc(e,r):this._sortDesc(e,r)}_sortAsc(e,t){return(r,n)=>{const s=r[e],a=n[e];if(s==null||s.isNull())return 1;if(a==null||a.isNull())return-1;if(s.isError()&&a.isError())return 0;if(s.isError())return 1;if(a.isError())return-1;const u=s.getValue(),c=a.getValue();return s.isBoolean()&&u===!0?1:a.isBoolean()&&c===!0?-1:s.isBoolean()&&u===!1?1:a.isBoolean()&&c===!1?-1:s.isNumber()&&a.isNumber()?+u-+c:t(u,c)}}_sortDesc(e,t){return(r,n)=>{const s=r[e],a=n[e];if(s==null||s.isNull())return 1;if(a==null||a.isNull())return-1;if(s.isError()&&a.isError())return 0;if(s.isError())return-1;if(a.isError())return 1;const u=s.getValue(),c=a.getValue();return s.isBoolean()&&u===!0?-1:a.isBoolean()&&c===!0?1:s.isBoolean()&&u===!1?-1:a.isBoolean()&&c===!1?1:s.isNumber()&&a.isNumber()?+c-+u:t(c,u)}}}class $0 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",255)}calculate(e,...t){t.length===1&&t.push(y.create(1));const r=this._getVariantsError(e,...t),{maxRowLength:n,maxColumnLength:s}=Kf(t);if(r.isError()){const c=O(n,s,r);return n===1&&s===1?c.get(0,0):c}const a=t.map((c,l)=>l%2===0?c:O(n,s,c,g.create(h.NA))),u=this._getResultArray(e,a,n,s);return n===1&&s===1?u[0][0]:Z.create({calculateValueList:u,rowCount:u.length,columnCount:u[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}_getVariantsError(e,...t){if(e.isError())return e;for(let u=0;u<t.length;u++){const c=t[u];if(c.isError())return c}if(t.length<2||t.length%2!==0)return g.create(h.VALUE);const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t[0].isArray()?t[0].getRowCount():1,a=t[0].isArray()?t[0].getColumnCount():1;if((s>1||a>1)&&(s>1&&a>1||s===1&&a!==n||a===1&&s!==r))return g.create(h.VALUE);for(let u=2;u<t.length;u++){if(u%2===1)continue;const c=t[u].isArray()?t[u].getRowCount():1,l=t[u].isArray()?t[u].getColumnCount():1;if(c!==s||l!==a)return g.create(h.VALUE)}return F.create(!0)}_getResultArray(e,t,r,n){const s=e.isArray()?e.getRowCount():1,a=e.isArray()?e.getColumnCount():1,u=t[0].isArray()?t[0].getRowCount():1,c=t[0].isArray()?t[0].getColumnCount():1,l=[];for(let f=0;f<r;f++){l[f]=[];for(let m=0;m<n;m++){const{isError:d,errorObject:C,byArrays:_,sortOrders:E}=this._getByArraysAndSortOrders(t,f,m,c);if(d){l[f].push(C);continue}if(!e.isArray()||s===1&&a===1){l[f].push(e);continue}let R=e.getArrayValue();u===1&&c===1||(u===1?(R=R.concat(_),R=this._transposeArray(R),R.sort(this._sort(s,E)),R=this._transposeArray(R).slice(0,s)):c===1&&(R=this._transposeArray(R),R=R.concat(_),R=this._transposeArray(R),R.sort(this._sort(a,E)),R=R.map(N=>N.slice(0,a))));const b=Z.create({calculateValueList:R,rowCount:R.length,columnCount:R[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column});if(r>1||n>1){l[f].push(b.get(0,0));continue}l[f].push(b)}}return l}_getByArraysAndSortOrders(e,t,r,n){const s=[],a=[];let u=!1,c=null;for(let l=0;l<e.length;l++){if(l%2===1)continue;const f=e[l];let m=e[l+1].get(t,r);if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError()){u=!0,c=m;break}const d=Math.floor(+m.getValue());if(d!==-1&&d!==1){u=!0,c=g.create(h.VALUE);break}if(a.push(d),f.isArray()){let C=f.getArrayValue();n===1&&(C=this._transposeArray(C)),s.push(C[0])}else s.push([f])}return{isError:u,errorObject:c,byArrays:s,sortOrders:a}}_transposeArray(e){const t=e.length,r=e[0].length,n=[];for(let s=0;s<r;s++){n[s]=[];for(let a=0;a<t;a++)n[s][a]=e[a][s]}return n}_sort(e,t){const r=dn();return(n,s)=>{let a=n[e],u=s[e],c=this._compare(a,u,t[0],r);if(c===0&&t.length>1){for(let l=1;l<t.length;l++)if(a=n[e+l],u=s[e+l],c=this._compare(a,u,t[l],r),c!==0)return c}return c}}_compare(e,t,r,n){return r===1?this._asc(e,t,n):this._desc(e,t,n)}_asc(e,t,r){if(e==null||e.isNull())return 1;if(t==null||t.isNull())return-1;if(e.isError()&&t.isError())return 0;if(e.isError())return 1;if(t.isError())return-1;const n=e.getValue(),s=t.getValue();return e.isBoolean()&&n===!0?1:t.isBoolean()&&s===!0?-1:e.isBoolean()&&n===!1?1:t.isBoolean()&&s===!1?-1:e.isNumber()&&t.isNumber()?+n-+s:r(n,s)}_desc(e,t,r){if(e==null||e.isNull())return 1;if(t==null||t.isNull())return-1;if(e.isError()&&t.isError())return 0;if(e.isError())return-1;if(t.isError())return 1;const n=e.getValue(),s=t.getValue();return e.isBoolean()&&n===!0?-1:t.isBoolean()&&s===!0?1:e.isBoolean()&&n===!1?-1:t.isBoolean()&&s===!1?1:e.isNumber()&&t.isNumber()?+s-+n:r(s,n)}}class Y0 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){const n=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1;let a=t,u=r!=null?r:y.create(s);t.isNull()&&(a=y.create(n)),u.isNull()&&(u=y.create(s));const c=Math.max(a.isArray()?a.getRowCount():1,u.isArray()?u.getRowCount():1),l=Math.max(a.isArray()?a.getColumnCount():1,u.isArray()?u.getColumnCount():1),f=O(c,l,a,g.create(h.NA)),m=O(c,l,u,g.create(h.NA));if(c>1||l>1)return f.mapValue((N,V,S)=>{const D=m.get(V,S);if(e.isError())return e;if(e.isNull())return g.create(h.VALUE);const{isError:L,errorObject:P}=this._checkRowsColumns(N,D,n,s);return L?P:e.isArray()?g.create(h.VALUE):e});if(e.isError())return e;if(e.isNull())return g.create(h.VALUE);const d=a.isArray()?a.get(0,0):a,C=u.isArray()?u.get(0,0):u,{isError:_,errorObject:E,rowsValue:R,columnsValue:b}=this._checkRowsColumns(d,C,n,s);return _?E:this._getResultArray(e,R,b,n,s)}_checkRowsColumns(e,t,r,n){if(e.isError())return{isError:!0,errorObject:e};if(t.isError())return{isError:!0,errorObject:t};let s=Math.trunc(+e.getValue()),a=Math.trunc(+t.getValue());return Number.isNaN(s)||Number.isNaN(a)?{isError:!0,errorObject:g.create(h.VALUE)}:Math.abs(s)===0||Math.abs(a)===0?{isError:!0,errorObject:g.create(h.CALC)}:(s>r&&(s=r),a>n&&(a=n),{isError:!1,rowsValue:s,columnsValue:a})}_getResultArray(e,t,r,n,s){if(!e.isArray())return e;const a=t>=0?[0,t]:[n+t,n],u=r>=0?[0,r]:[s+r,s];let c;return t===n&&r===s?c=e:t===n?c=e.slice(void 0,u):r===s?c=e.slice(a,void 0):c=e.slice(a,u),c=c.map(l=>l.isNull()?y.create(0):l),t===1&&r===1?c.get(0,0):c}}class H0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",3)}calculate(e,t,r){const n=t!=null?t:y.create(0),s=r!=null?r:F.create(!1),a=Math.max(n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1),u=Math.max(n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1),c=O(a,u,n,g.create(h.NA)),l=O(a,u,s,g.create(h.NA)),f=c.mapValue((m,d,C)=>{const _=l.get(d,C);if(e.isError())return e;if(e.isNull())return g.create(h.VALUE);if(m.isError())return m;if(_.isError())return _;const E=Math.trunc(+m.getValue()),R=+_.getValue();if(Number.isNaN(E)||E<0||E>3||Number.isNaN(R))return g.create(h.VALUE);if(!e.isArray())return e;let b=[];return R?b=this._getArrayValueByColumn(e,E):b=this._getArrayValueByRow(e,E),b.length===0?g.create(h.CALC):a>1||u>1||b.length===1?b[0]:Z.create({calculateValueList:b.map(N=>[N]),rowCount:b.length,columnCount:1,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})});return a===1&&u===1?f.get(0,0):f}_getArrayValueByColumn(e,t){const r=e,n=r.getRowCount(),s=r.getColumnCount(),a=[];for(let u=0;u<s;u++)for(let c=0;c<n;c++){const l=r.get(c,u);this._isIgnore(l,t)||a.push(l.isNull()?y.create(0):l)}return a}_getArrayValueByRow(e,t){const r=e,n=r.getRowCount(),s=r.getColumnCount(),a=[];for(let u=0;u<n;u++)for(let c=0;c<s;c++){const l=r.get(u,c);this._isIgnore(l,t)||a.push(l.isNull()?y.create(0):l)}return a}_isIgnore(e,t){switch(t){case 0:return!1;case 1:return e.isNull();case 2:return e.isError();case 3:return e.isNull()||e.isError();default:return!1}}}class G0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",3)}calculate(e,t,r){const n=t!=null?t:y.create(0),s=r!=null?r:F.create(!1),a=Math.max(n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1),u=Math.max(n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1),c=O(a,u,n,g.create(h.NA)),l=O(a,u,s,g.create(h.NA)),f=c.mapValue((m,d,C)=>{const _=l.get(d,C);if(e.isError())return e;if(m.isError())return m;if(_.isError())return _;const E=Math.trunc(+m.getValue()),R=+_.getValue();if(Number.isNaN(E)||E<0||E>3||Number.isNaN(R)||e.isNull())return g.create(h.VALUE);if(!e.isArray())return e;let b=[];return R?b=this._getArrayValueByColumn(e,E):b=this._getArrayValueByRow(e,E),b.length===0?g.create(h.CALC):a>1||u>1||b.length===1?b[0]:Z.create({calculateValueList:[b],rowCount:1,columnCount:b.length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})});return a===1&&u===1?f.get(0,0):f}_getArrayValueByColumn(e,t){const r=e,n=r.getRowCount(),s=r.getColumnCount(),a=[];for(let u=0;u<s;u++)for(let c=0;c<n;c++){const l=r.get(c,u);this._isIgnore(l,t)||a.push(l.isNull()?y.create(0):l)}return a}_getArrayValueByRow(e,t){const r=e,n=r.getRowCount(),s=r.getColumnCount(),a=[];for(let u=0;u<n;u++)for(let c=0;c<s;c++){const l=r.get(u,c);this._isIgnore(l,t)||a.push(l.isNull()?y.create(0):l)}return a}_isIgnore(e,t){switch(t){case 0:return!1;case 1:return e.isNull();case 2:return e.isError();case 3:return e.isNull()||e.isError();default:return!1}}}class W0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isError())return e;if(e.isArray()){const t=e.getRowCount(),r=e.getColumnCount();return t===1&&r===1?e.get(0,0):e.transpose()}return e}}class Q0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",3)}calculate(e,t,r){const n=t!=null?t:F.create(!1),s=r!=null?r:F.create(!1),a=e.isArray()?e.getRowCount():1,u=e.isArray()?e.getColumnCount():1,c=Math.max(n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1),l=Math.max(n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1),f=O(c,l,n,g.create(h.NA)),m=O(c,l,s,g.create(h.NA)),d=f.map((C,_,E)=>{let R=C,b=m.get(_,E);if(e.isError())return e;if(R.isString()&&(R=R.convertToNumberObjectValue()),R.isError())return R;if(b.isString()&&(b=b.convertToNumberObjectValue()),b.isError())return b;const N=+R.getValue(),V=+b.getValue();let S;return!N&&a===1||N&&u===1?S=e:S=this._getResult(e,N,V),(c>1||l>1)&&(S!=null&&S.isArray())?S.get(0,0):S});return c===1&&l===1?d.get(0,0):d}_getResult(e,t,r){const n=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1;let a=e.getArrayValue(),u=n,c=s;t&&(a=this._transposeArray(a),u=s,c=n);const l=this._getRepeatRows(a,u,c);if(l.length>0){const f=[];l.forEach(m=>{m.forEach((d,C)=>{(C!==0||r)&&f.push(d)})}),a=a.filter((m,d)=>!f.includes(d))}return a.length===0?g.create(h.CALC):(t&&(a=this._transposeArray(a)),Z.create({calculateValueList:a,rowCount:a.length,columnCount:a[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column}))}_getRepeatRows(e,t,r){let n=[];for(let s=0;s<r;s++)if(s===0){const a=new Array(t).fill(null).map((u,c)=>({r:c,valueObject:e[c][s]}));n=this._getRepeatRowsByObjects(a)}else{if(n.length===0)break;let a=[];n.forEach(u=>{const c=u.map(f=>({r:f,valueObject:e[f][s]})),l=this._getRepeatRowsByObjects(c);a=a.concat(l)}),n=a}return n}_getRepeatRowsByObjects(e){const t=new Map;return e.forEach(r=>{const n=r.r,s=r.valueObject;let a=s.getValue();if(s.isNull()?a=null:s.isString()&&M.isRealNum(a)&&(a=+a),!t.has(a))t.set(a,[n]);else{const u=t.get(a);u.push(n),t.set(a,u)}}),Array.from(t.values()).filter(r=>r.length>1)}_transposeArray(e){const t=e.length,r=e[0].length,n=[];for(let s=0;s<r;s++){n[s]=[];for(let a=0;a<t;a++)n[s][a]=e[a][s]}return n}}class q0 extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",4)}calculate(e,t,r,n){if(e.isError())return e;if(t.isError())return t;if(!t.isArray())return g.create(h.VALUE);if(r.isError())return r;if(n!=null&&n.isError())return n;const s=n!=null?n:F.create(!0);return Ji(e)&&Ji(s)&&r.isArray()?this._handleArrayColIndexNum(e,t,r,s):this._handleNonArrayColIndexNum(e,t,r,s)}_handleArrayColIndexNum(e,t,r,n){const s=e.isArray()?e.getFirstCell():e,a=this.getZeroOrOneByOneDefault(n);if(a==null)return g.create(h.VALUE);let u;const c=[];return r.iterator((l,f,m)=>{if(l==null)return u=g.create(h.VALUE),!1;const d=this._handleTableArray(s,t,l,a);if(d.isError())return u=d,!1;c[f]===void 0&&(c[f]=[]),c[f][m]=d}),u||at(c,c.length,c[0].length,this.unitId||"",this.subUnitId||"")}_handleNonArrayColIndexNum(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=O(s,a,e),c=O(s,a,n);return u.map((l,f,m)=>{if(l.isError())return l;const d=c.get(f,m);if(d==null)return g.create(h.VALUE);if(d.isError())return d;const C=this.getZeroOrOneByOneDefault(d);return C==null?g.create(h.VALUE):this._handleTableArray(l,t,r,C)})}_handleTableArray(e,t,r,n){let s=this.getIndexNumValue(r);if(s instanceof g)return s;if(s=Math.floor(s),s<1)return g.create(h.VALUE);const a=t.slice(void 0,[0,1]);if(a==null)return g.create(h.VALUE);const u=t.slice(void 0,[s-1,s]);return u==null?g.create(h.REF):this._handleSingleObject(e,a,u,n)}_handleSingleObject(e,t,r,n){return n===0?this.equalSearch(e,t,r):this.binarySearch(e,t,r)}}class X0 extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=Math.max(...e.map(n=>n.isArray()?n.getColumnCount():1)),r=[];for(let n=0;n<e.length;n++){const s=e[n];if(s.isError())return s;const a=s.isArray()?s.getRowCount():1,u=s.isArray()?s.getColumnCount():1;for(let c=0;c<a;c++){const l=[];for(let f=0;f<t;f++){let m=s;s.isArray()&&(m=s.get(c,f)),f>u-1||!m?l.push(g.create(h.NA)):l.push(m)}r.push(l)}}return Z.create({calculateValueList:r,rowCount:r.length,columnCount:r[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}class K0 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){let n=r!=null?r:g.create(h.NA);n.isNull()&&(n=g.create(h.NA));const s=e.isArray()?e.getRowCount():1,a=e.isArray()?e.getColumnCount():1,u=Math.max(t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),c=Math.max(t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),l=O(u,c,t,g.create(h.NA)),f=O(u,c,n,g.create(h.NA)),m=l.mapValue((d,C,_)=>{const E=f.get(C,_);if(e.isError())return e;if(e.isNull())return g.create(h.VALUE);if(d.isError())return d;const R=Math.trunc(+d.getValue());if(s>1&&a>1||Number.isNaN(R))return g.create(h.VALUE);if(R<1)return g.create(h.NUM);const b=e.isArray()?e.getArrayValue().flat():[e],N=this._getWrapArray(b,R,E);return u>1||c>1||N.length===1&&N[0].length===1?N[0][0]:Z.create({calculateValueList:N,rowCount:N.length,columnCount:N[0].length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})});return u===1&&c===1?m.get(0,0):m}_getWrapArray(e,t,r){const n=Math.ceil(e.length/t),s=n>1?t:e.length,a=[];for(let u=0;u<n;u++)for(let c=0;c<s;c++){a[c]||(a[c]=[]);const l=u*s+c;l<e.length?a[c].push(e[l].isNull()?y.create(0):e[l]):a[c].push(r)}return a}}class Z0 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){let n=r!=null?r:g.create(h.NA);n.isNull()&&(n=g.create(h.NA));const s=e.isArray()?e.getRowCount():1,a=e.isArray()?e.getColumnCount():1,u=Math.max(t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),c=Math.max(t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),l=O(u,c,t,g.create(h.NA)),f=O(u,c,n,g.create(h.NA)),m=l.mapValue((d,C,_)=>{const E=f.get(C,_);if(e.isError())return e;if(e.isNull())return g.create(h.VALUE);if(d.isError())return d;const R=Math.trunc(+d.getValue());if(s>1&&a>1||Number.isNaN(R))return g.create(h.VALUE);if(R<1)return g.create(h.NUM);const b=e.isArray()?e.getArrayValue().flat():[e],N=this._getWrapArray(b,R,E);return u>1||c>1||N.length===1&&N[0].length===1?N[0][0]:Z.create({calculateValueList:N,rowCount:N.length,columnCount:N[0].length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})});return u===1&&c===1?m.get(0,0):m}_getWrapArray(e,t,r){const n=Math.ceil(e.length/t),s=n>1?t:e.length,a=[];for(let u=0;u<n;u++){const c=[];for(let l=0;l<s;l++){const f=u*s+l;f<e.length?c.push(e[f].isNull()?y.create(0):e[f]):c.push(r)}a.push(c)}return a}}class z0 extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",6)}calculate(e,t,r,n,s,a){let u=n!=null?n:g.create(h.NA);n!=null&&n.isNull()&&(u=g.create(h.NA));let c=s!=null?s:y.create(0);s!=null&&s.isNull()&&(c=y.create(0));let l=a!=null?a:y.create(1);if(a!=null&&a.isNull()&&(l=y.create(1)),e.isError())return e;const f=t.isArray()?t.getRowCount():1,m=t.isArray()?t.getColumnCount():1,d=r.isArray()?r.getRowCount():1,C=r.isArray()?r.getColumnCount():1;if(f!==1&&m!==1||f===1&&m>1&&m!==C||m===1&&f>1&&f!==d)return g.create(h.VALUE);if(c.isError())return c;if(l.isError())return l;const _=this.getIndexNumValue(c);if(_ instanceof g)return _;const E=this.getIndexNumValue(l);return E instanceof g?E:this._getResult(e,Zs(t),Zs(r),u,_,E,f,m,d,C)}_getResult(e,t,r,n,s,a,u,c,l,f){const m=e.isArray()?e.getRowCount():1,d=e.isArray()?e.getColumnCount():1;if(m>1||d>1){let R;return u===1?R=r.slice([0,1]):R=r.slice(void 0,[0,1]),R==null?g.create(h.NA):e.map(b=>{const N=this._checkErrorCombination(s,a);if(N)return N;const V=this._handleSingleObject(b,t,R,s,a);return V.isError()?n:V})}const C=e.isArray()?e.get(0,0):e;if(c===f&&u===l){const R=this._checkErrorCombination(s,a);if(R)return R;const b=this._handleSingleObject(C,t,r,s,a);return b.isError()?n:b}let _=0;c===f&&(_=1);const E=this._handleExpandObject(C,t,r,s,a,_);return E==null?g.create(h.NA):E}_handleExpandObject(e,t,r,n,s,a=0){if((s===2||s===-2)&&n!==2){const u=xs(s),c=js(n);return this.binarySearchExpand(e,t,r,a,u,c)}return n===2?this.fuzzySearchExpand(e,t,r,s!==-1,a):n===-1||n===1?this.orderSearchExpand(e,t,r,n===1?Le.MAX:Le.MIN,s===-1,a):this.equalSearchExpand(e,t,r,s!==-1,a)}_handleSingleObject(e,t,r,n,s){if((s===2||s===-2)&&n!==2){const a=xs(s),u=js(n);return this.binarySearch(e,t,r,a,u)}return n===2?this.fuzzySearch(e,t,r,s!==-1):n===-1||n===1?this.orderSearch(e,t,r,n===1?Le.MAX:Le.MIN,s===-1):this.equalSearch(e,t,r,s!==-1)}_checkErrorCombination(e,t){return e===2&&(t===-2||t===2)?g.create(h.VALUE):null}}class J0 extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",4)}calculate(e,t,r,n){let s=y.create(0);r&&!r.isNull()&&(s=r);let a=y.create(1);n&&!n.isNull()&&(a=n);const u=Math.max(e.isArray()?e.getRowCount():1,s.isArray()?s.getRowCount():1,a.isArray()?a.getRowCount():1),c=Math.max(e.isArray()?e.getColumnCount():1,s.isArray()?s.getColumnCount():1,a.isArray()?a.getColumnCount():1),l=O(u,c,e,g.create(h.NA)),f=O(u,c,s,g.create(h.NA)),m=O(u,c,a,g.create(h.NA)),d=l.mapValue((C,_,E)=>{if(C.isError())return C;const R=f.get(_,E),b=m.get(_,E);return R.isError()?R:b.isError()?b:this._handleSingleObject(C,t,R,b)});return u===1&&c===1?d.get(0,0):d}_handleSingleObject(e,t,r,n){const s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1;if(s!==1&&a!==1)return g.create(h.VALUE);let u=r;if((r.isString()||r.isBoolean()||r.isNull())&&(u=r.convertToNumberObjectValue()),u.isError())return u;let c=n;if((n.isString()||n.isBoolean()||n.isNull())&&(c=n.convertToNumberObjectValue()),c.isError())return c;const l=u.getValue(),f=c.getValue();return![-1,0,1,2].includes(l)||![-1,1,2].includes(f)?g.create(h.VALUE):this._getResult(e,t,l,f)}_getResult(e,t,r,n){const s=Zs(t);let a;if((n===2||n===-2)&&r!==2){const u=xs(n),c=js(r);a=s.binarySearch(e,u,c)}else if(r===2){const u=s.compare(e,H.EQUALS);let c;if(n!==-1?c=u.getFirstTruePosition():c=u.getLastTruePosition(),c==null)return g.create(h.NA);a=s.getRowCount()===1?c.column:c.row}else if(r===-1||r===1){const u=s.orderSearch(e,r===1?Le.MAX:Le.MIN,n===-1);if(u==null)return g.create(h.NA);if(u instanceof g)return u;a=s.getRowCount()===1?u.column:u.row}else{const u=s.isEqual(e);let c;if(n!==-1?c=u.getFirstTruePosition():c=u.getLastTruePosition(),c==null)return g.create(h.NA);a=s.getRowCount()===1?c.column:c.row}return a==null?g.create(h.NA):y.create(a+1)}}const Hu=[[_0,ne.ADDRESS],[E0,ne.AREAS],[R0,ne.CHOOSE],[b0,ne.CHOOSECOLS],[y0,ne.CHOOSEROWS],[N0,ne.COLUMN],[p0,ne.COLUMNS],[V0,ne.DROP],[O0,ne.EXPAND],[S0,ne.FILTER],[M0,ne.FORMULATEXT],[D0,ne.HLOOKUP],[w0,ne.HSTACK],[L0,ne.HYPERLINK],[P0,ne.IMAGE],[j0,ne.INDEX],[x0,ne.INDIRECT],[U0,ne.LOOKUP],[T0,ne.MATCH],[I0,ne.OFFSET],[F0,ne.ROW],[B0,ne.ROWS],[k0,ne.SORT],[$0,ne.SORTBY],[Y0,ne.TAKE],[H0,ne.TOCOL],[G0,ne.TOROW],[W0,ne.TRANSPOSE],[Q0,ne.UNIQUE],[q0,ne.VLOOKUP],[X0,ne.VSTACK],[K0,ne.WRAPCOLS],[Z0,ne.WRAPROWS],[z0,ne.XLOOKUP],[J0,ne.XMATCH]];class eC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.abs()}}class tC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.acos()}}class rC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.acosh()}}class nC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.isArray()?t.map(r=>r.isError()?r:Gu(r)):Gu(t)}}function Gu(i){let o=i.getValue();if(i.isBoolean()&&(o=o?1:0),!Number.isFinite(o))return g.create(h.VALUE);o=Number(o);let e=Math.atan(1/o);return o<0&&(e+=Math.PI),Number.isNaN(e)?g.create(h.VALUE):y.create(e)}class sC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.isArray()?t.map(r=>r.isError()?r:Wu(r)):Wu(t)}}function Wu(i){let o=i.getValue();if(i.isBoolean()&&(o=o?1:0),!Number.isFinite(o))return g.create(h.VALUE);if(o=Number(o),Math.abs(o)<=1)return g.create(h.NUM);const e=1/2*Math.log((o+1)/(o-1));return Number.isNaN(e)?g.create(h.VALUE):y.create(e)}const aC={1:Oe.AVERAGE,2:Oe.COUNT,3:Oe.COUNTA,4:Oe.MAX,5:Oe.MIN,6:Oe.PRODUCT,7:Oe.STDEV_S,8:Oe.STDEV_P,9:Oe.SUM,10:Oe.VAR_S,11:Oe.VAR_P,12:Oe.MEDIAN,13:Oe.MODE_SNGL};class iC extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",255);A(this,"needsReferenceObject",!0);A(this,"needsFilteredOutRows",!0);A(this,"needsFormulaDataModel",!0)}calculate(e,t,...r){const{isError:n,multiAreaRefs:s,normalRefs:a}=To(r);let u;e.isReferenceObject()?u=e.toArrayValueObject():u=e;let c;t.isReferenceObject()?c=t.toArrayValueObject():c=t;const l=Math.max(u.isArray()?u.getRowCount():1,c.isArray()?c.getRowCount():1),f=Math.max(u.isArray()?u.getColumnCount():1,c.isArray()?c.getColumnCount():1),m=O(l,f,u,g.create(h.NA)),d=O(l,f,c,g.create(h.NA)),C=m.mapValue((_,E,R)=>{if(_.isError())return _;const b=d.get(E,R);return b.isError()?b:s.length>0?g.create(h.VALUE):this._handleSingleObject(_,b,r,n,a)});return C.getRowCount()===1&&C.getColumnCount()===1?C.get(0,0):C}_handleSingleObject(e,t,r,n,s){let a=e;if(e.isString()&&(a=e.convertToNumberObjectValue()),a.isError())return a;const u=Math.floor(+a.getValue());if(u<1||u>19||u>=1&&u<=13&&n||u>=14&&u<=19&&r.length!==2)return g.create(h.VALUE);let c=t;if(t.isString()&&(c=t.convertToNumberObjectValue()),c.isError())return c;const l=Math.floor(+c.getValue());if(l<0||l>7)return g.create(h.VALUE);const f=this._getAggregateOptions(l);return u>=14&&u<=19?this._handleLargeSmallPercentileQuartile(u,f,r[0],r[1]):Bo({type:aC[u],...f,formulaDataModel:this._formulaDataModel},s)}_getAggregateOptions(e){switch(e){case 1:return{ignoreRowHidden:!0,ignoreErrorValues:!1,ignoreNested:!0};case 2:return{ignoreRowHidden:!1,ignoreErrorValues:!0,ignoreNested:!0};case 3:return{ignoreRowHidden:!0,ignoreErrorValues:!0,ignoreNested:!0};case 4:return{ignoreRowHidden:!1,ignoreErrorValues:!1,ignoreNested:!1};case 5:return{ignoreRowHidden:!0,ignoreErrorValues:!1,ignoreNested:!1};case 6:return{ignoreRowHidden:!1,ignoreErrorValues:!0,ignoreNested:!1};case 7:return{ignoreRowHidden:!0,ignoreErrorValues:!0,ignoreNested:!1};case 0:default:return{ignoreRowHidden:!1,ignoreErrorValues:!1,ignoreNested:!0}}}_handleLargeSmallPercentileQuartile(e,t,r,n){let s;if(n.isReferenceObject()?s=n.toArrayValueObject():s=n,s.isError())return s;if(s.isArray()){const c=s.getRowCount(),l=s.getColumnCount();if(c>1||l>1)return g.create(h.VALUE);s=s.get(0,0)}const a=zt(r,t,this._formulaDataModel);if(!Array.isArray(a))return a;const u=+s.getValue();switch(e){case 14:return $o(a,u);case 15:return Yo(a,u);case 16:return Ho(a,u);case 17:return Wo(a,u);case 18:return Go(a,u);case 19:return Qo(a,u);default:return g.create(h.VALUE)}}}class oC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return y.create(0);if(e.isBoolean()||e.isNumber())return g.create(h.VALUE);let t=e.getValue().toLocaleString().toLocaleUpperCase();if(t.length>255)return g.create(h.VALUE);const r=t.startsWith("-");r&&(t=t.slice(1));let n=0;for(let s=0;s<t.length;s++){const a=kn.get(t[s])||0,u=kn.get(t[s+1])||0,c=kn.get(t[s+2])||0,l=kn.get(t[s+3])||0;if(!a||c>=u&&c>a||a===u&&a===c&&a===l||a===u/2)return g.create(h.VALUE);a<u?n-=a:n+=a}return y.create(r?-n:n)}}class uC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.asin()}}class cC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.asinh()}}class lC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.atan()}}class fC extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){let r=e,n=t;return r.isString()&&(r=r.convertToNumberObjectValue()),r.isError()?r:(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:n.atan2(r))}}class mC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.atanh()}}class hC extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){const n=r!=null?r:y.create(0);if(e.isError())return e;if(t.isError())return t;if(n.isError())return n;const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,n,g.create(h.NA)),f=u.map((m,d,C)=>{const _=c.get(d,C),E=l.get(d,C);return this._handleSingleObject(m,_,E)});return f.getRowCount()===1&&f.getColumnCount()===1?f.getArrayValue()[0][0]:f}_handleSingleObject(e,t,r){let n=e;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let s=t;if(s.isString()&&(s=s.convertToNumberObjectValue()),s.isError())return s;let a=r;if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;const u=Math.floor(+n.getValue()),c=Math.floor(+s.getValue()),l=Math.floor(+a.getValue());if(u<0||u>=2**53||c<2||c>36||l<0)return g.create(h.NUM);let f=u.toString(c);return f.length<l&&(f=new Array(l-f.length+1).join("0")+f),T.create(f.toLocaleUpperCase())}}class gC extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.map((c,l,f)=>{let m=c,d=a.get(l,f);if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;if(d.isString()&&(d=d.convertToNumberObjectValue()),d.isError())return d;const C=+m.getValue(),_=+d.getValue();if(C>0&&_<0)return g.create(h.NUM);if(C===0||_===0)return y.create(0);const E=$e(C/_,0)*_;return y.create(E)});return u.getRowCount()===1&&u.getColumnCount()===1?u.getArrayValue()[0][0]:u}}class dC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",3)}calculate(e,t,r){const n=t!=null?t:y.create(1),s=r!=null?r:y.create(0);if(e.isError())return e;if(n.isError())return n;if(s.isError())return s;const a=Math.max(e.isArray()?e.getRowCount():1,n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1),c=O(a,u,e,g.create(h.NA)),l=O(a,u,n,g.create(h.NA)),f=O(a,u,s,g.create(h.NA)),m=c.map((d,C,_)=>{let E=d,R=l.get(C,_),b=f.get(C,_);if(E.isString()&&(E=E.convertToNumberObjectValue()),E.isError())return E;if(R.isString()&&(R=R.convertToNumberObjectValue()),R.isError())return R;if(b.isString()&&(b=b.convertToNumberObjectValue()),b.isError())return b;const N=+E.getValue(),V=+R.getValue(),S=+b.getValue();return N===0||V===0?y.create(0):this._getResult(N,V,S)});return a===1&&u===1?m.get(0,0):m}_getResult(e,t,r){let n;return e<0&&r!==0?n=(t<0?$e(Math.abs(e)/Math.abs(t),0):-$e(Math.abs(e)/t,0))*t:n=(t<0?-$e(e/Math.abs(t),0):$e(e/t,0))*t,y.create(n)}}class CC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){const r=t!=null?t:y.create(1);if(e.isError())return e;if(r.isError())return r;const n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,r,g.create(h.NA)),c=a.map((l,f,m)=>{let d=u.get(f,m),C=l;if(C.isString()&&(C=C.convertToNumberObjectValue()),C.isError())return C;if(d.isString()&&(d=d.convertToNumberObjectValue()),d.isError())return d;const _=+C.getValue(),E=+d.getValue();if(_===0||E===0)return y.create(0);const R=(E<0?-$e(_/Math.abs(E),0):$e(_/E,0))*E;return y.create(R)});return n===1&&s===1?c.get(0,0):c}}class _C extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.mapValue((c,l,f)=>{let m=c,d=a.get(l,f);if(m.isString()&&(m=m.convertToNumberObjectValue()),d.isString()&&(d=d.convertToNumberObjectValue()),m.isError())return m;if(d.isError())return d;const C=Math.floor(+m.getValue()),_=Math.floor(+d.getValue());if(C<0||_<0||C<_)return g.create(h.NUM);const E=Zt(C,_);return Number.isNaN(E)||!Number.isFinite(E)?g.create(h.NUM):y.create(E)});return r===1&&n===1?u.get(0,0):u}}class AC extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.mapValue((c,l,f)=>{let m=c,d=a.get(l,f);if(m.isString()&&(m=m.convertToNumberObjectValue()),d.isString()&&(d=d.convertToNumberObjectValue()),m.isError())return m;if(d.isError())return d;const C=Math.floor(+m.getValue()),_=Math.floor(+d.getValue());if(C<0||_<0||C===0&&C<_)return g.create(h.NUM);const E=Zt(C+_-1,C-1);return Number.isNaN(E)||!Number.isFinite(E)?g.create(h.NUM):y.create(E)});return r===1&&n===1?u.get(0,0):u}}class EC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.cos()}}class RC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.cosh()}}class bC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=+t.getValue();return Math.abs(r)>=2**27?g.create(h.NUM):r===0?g.create(h.DIV_BY_ZERO):t.tan().getReciprocal()}}class yC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:+t.getValue()===0?g.create(h.DIV_BY_ZERO):t.tanh().getReciprocal()}}class NC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=+t.getValue();return Math.abs(r)>=2**27?g.create(h.NUM):r===0?g.create(h.DIV_BY_ZERO):t.sin().getReciprocal()}}class pC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=+t.getValue();return r===0?g.create(h.DIV_BY_ZERO):!Number.isNaN(r)&&!Number.isFinite(Math.sinh(r))?y.create(0):t.sinh().getReciprocal()}}class VC extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.map((c,l,f)=>{if(c.isError())return c;let m=a.get(l,f);if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;const d=`${c.getValue()}`,C=Math.floor(+m.getValue());if(M.isRealNum(d)&&(+d<0||+d>=2**53||!Number.isInteger(+d))||d.toLocaleLowerCase()==="true"||d.toLocaleLowerCase()==="false"||C<2||C>36)return g.create(h.NUM);if(d.replace(/\s/g,"")==="")return y.create(0);if(!this._isValidCharForRadix(d,C))return g.create(h.NUM);const _=Number.parseInt(d,C);return Number.isNaN(_)?g.create(h.NUM):y.create(_)});return r===1&&n===1?u.get(0,0):u}_isValidCharForRadix(e,t){for(const r of e){const n=r.toUpperCase().charCodeAt(0);if(t<=10&&!(n>=48&&n<48+t)||t>10&&!(n>=48&&n<58||n>=65&&n<65+t-10))return!1}return!0}}class OC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=+t.getValue();if(!Number.isFinite(r))return g.create(h.VALUE);const n=r*(180/Math.PI);return Number.isNaN(n)?g.create(h.VALUE):y.create(n)}}class SC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=+t.getValue();if(!Number.isFinite(r))return g.create(h.VALUE);const n=(r<0?-$e(Math.abs(r)/2,0):$e(r/2,0))*2;return Number.isNaN(n)?g.create(h.VALUE):n===0?y.create(0):y.create(n)}}class MC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.exp()}}class DC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.mapValue(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=Math.floor(+t.getValue()),n=_r(r);return Number.isNaN(n)||!Number.isFinite(n)?g.create(h.NUM):y.create(n)}}class wC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;if(e.isArray()){const r=e.getRowCount(),n=e.getColumnCount();if(r>1||n>1)return g.create(h.VALUE);t=e.get(0,0)}return this._handleSingleObject(t)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=Math.floor(+t.getValue()),n=_r(r,2);return Number.isNaN(n)||!Number.isFinite(n)?g.create(h.NUM):y.create(n)}}class LC extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.map((c,l,f)=>{let m=a.get(l,f),d=c;if(d.isString()&&(d=d.convertToNumberObjectValue()),d.isError())return d;if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;const C=+d.getValue(),_=+m.getValue();if(C>0&&_<0)return g.create(h.NUM);if(C===0)return y.create(0);if(_===0)return g.create(h.DIV_BY_ZERO);const E=Qe(C/_,0)*_;return y.create(E)});return r===1&&n===1?u.get(0,0):u}}class PC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",3)}calculate(e,t,r){const n=t!=null?t:y.create(1),s=r!=null?r:y.create(0),a=Math.max(e.isArray()?e.getRowCount():1,n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1),c=O(a,u,e,g.create(h.NA)),l=O(a,u,n,g.create(h.NA)),f=O(a,u,s,g.create(h.NA)),m=c.map((d,C,_)=>{let E=d,R=l.get(C,_),b=f.get(C,_);if(E.isString()&&(E=E.convertToNumberObjectValue()),E.isError())return E;if(R.isString()&&(R=R.convertToNumberObjectValue()),R.isError())return R;if(b.isString()&&(b=b.convertToNumberObjectValue()),b.isError())return b;const N=+E.getValue(),V=+R.getValue(),S=+b.getValue();if(N===0||V===0)return y.create(0);let D;return N<0&&S!==0?D=(V<0?Qe(Math.abs(N)/Math.abs(V),0):-Qe(Math.abs(N)/V,0))*V:D=(V<0?-Qe(N/Math.abs(V),0):Qe(N/V,0))*V,y.create(D)});return a===1&&u===1?m.get(0,0):m}}class jC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){const r=t!=null?t:y.create(1);if(e.isError())return e;if(r.isError())return r;const n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,r,g.create(h.NA)),c=a.map((l,f,m)=>{let d=u.get(f,m),C=l;if(C.isString()&&(C=C.convertToNumberObjectValue()),C.isError())return C;if(d.isString()&&(d=d.convertToNumberObjectValue()),d.isError())return d;const _=+C.getValue(),E=+d.getValue();if(_===0||E===0)return y.create(0);const R=(E<0?-Qe(_/Math.abs(E),0):Qe(_/E,0))*E;return y.create(R)});return n===1&&s===1?c.get(0,0):c}}class xC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=0;for(let r=0;r<e.length;r++){const n=e[r];if(!n.isNull())if(n.isArray()){let s=!1,a=g.create(h.VALUE);if(n.iterator(u=>{if(u!=null&&u.isNull())return!0;const{isError:c,errorObject:l,number:f}=this._handleSingleObject(u);if(c)return s=!0,a=l,!1;t=ga(t,f)}),s)return a}else{const{isError:s,errorObject:a,number:u}=this._handleSingleObject(n);if(s)return a;t=ga(t,u)}}return y.create(t)}_handleSingleObject(e){if(e.isBoolean())return{isError:!0,errorObject:g.create(h.VALUE),number:null};let t=e;if(e.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return{isError:!0,errorObject:t,number:null};const r=Math.floor(+t.getValue());return r<0||r>=2**53?{isError:!0,errorObject:g.create(h.NUM),number:null}:{isError:!1,errorObject:null,number:r}}}class UC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.mapValue(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=Math.floor(+t.getValue());return y.create(r)}}class TC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=1,r=!0;for(let n=0;n<e.length;n++){const s=e[n];if(!s.isNull())if(s.isArray()){let a=!1,u=g.create(h.VALUE);if(s.iterator(c=>{if(c!=null&&c.isNull())return!0;const{isError:l,errorObject:f,number:m}=this._handleSingleObject(c);if(l)return a=!0,u=f,!1;t=No(t,m),r=!1}),a)return u}else{const{isError:a,errorObject:u,number:c}=this._handleSingleObject(s);if(a)return u;t=No(t,c),r=!1}}return r?y.create(0):Number.isNaN(t)||!Number.isFinite(t)||t>=2**53?g.create(h.VALUE):y.create(t)}_handleSingleObject(e){if(e.isBoolean())return{isError:!0,errorObject:g.create(h.VALUE),number:null};let t=e;if(e.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return{isError:!0,errorObject:t,number:null};const r=Math.floor(+t.getValue());return r<0?{isError:!0,errorObject:g.create(h.NUM),number:null}:{isError:!1,errorObject:null,number:r}}}class vC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.log()}}class IC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){const r=t!=null?t:y.create(10);if(e.isError())return e;if(r.isError())return r;const n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,r,g.create(h.NA)),c=a.map((l,f,m)=>{let d=u.get(f,m),C=l;if(C.isString()&&(C=C.convertToNumberObjectValue()),C.isError())return C;if(d.isString()&&(d=d.convertToNumberObjectValue()),d.isError())return d;const _=+C.getValue(),E=+d.getValue();if(_<=0||E<=0)return g.create(h.NUM);const R=Math.log(E);if(R===0)return g.create(h.DIV_BY_ZERO);const b=Math.log(_)/R;return y.create(b)});return n===1&&s===1?c.get(0,0):c}}class FC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.log10()}}class BC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let a=0;a<t;a++){const u=[];for(let c=0;c<r;c++){let l=e.isArray()?e.get(a,c):e;if(l.isError())return l;if(l.isNull()||l.isBoolean())return g.create(h.VALUE);if(l.isString()&&(l=l.convertToNumberObjectValue()),l.isError())return l;const f=+l.getValue();u.push(f)}n.push(u)}if(t!==r)return g.create(h.VALUE);const s=da(n);return y.create(s)}}class kC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let a=0;a<t;a++){const u=[];for(let c=0;c<r;c++){let l=e.isArray()?e.get(a,c):e;if(l.isError())return l;if(l.isNull()||l.isBoolean())return g.create(h.VALUE);if(l.isString()&&(l=l.convertToNumberObjectValue()),l.isError())return l;const f=+l.getValue();u.push(f)}n.push(u)}if(t!==r)return g.create(h.VALUE);const s=qm(n);return s===null?g.create(h.NUM):Z.createByArray(s)}}class $C extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1;if(n!==s)return g.create(h.VALUE);const u=this._getMatrix(e,r,n),c=this._getMatrix(t,s,a);if(u instanceof g)return u;if(c instanceof g)return c;const l=Ar(u,c);return Z.createByArray(l)}_getMatrix(e,t,r){const n=[];for(let s=0;s<t;s++){const a=[];for(let u=0;u<r;u++){let c=e.isArray()?e.get(s,u):e;if(c.isError())return c;if(c.isNull()||c.isBoolean())return g.create(h.VALUE);if(c.isString()&&(c=c.convertToNumberObjectValue()),c.isError())return c;const l=+c.getValue();a.push(l)}n.push(a)}return n}}class YC extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let n=t;return n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:r.mod(n)}}class HC extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isArray()){const c=r.getRowCount(),l=r.getColumnCount();if(c>1||l>1)return g.create(h.VALUE);r=r.get(0,0)}if(r.isError())return r;let n=t;if(n.isArray()){const c=n.getRowCount(),l=n.getColumnCount();if(c>1||l>1)return g.create(h.VALUE);n=n.get(0,0)}if(n.isError())return n;if(r.isBoolean()||n.isBoolean())return g.create(h.VALUE);const s=+r.getValue(),a=+n.getValue();if(Number.isNaN(s)||Number.isNaN(a))return g.create(h.VALUE);if(a===0)return y.create(0);if(s>0&&a<0||s<0&&a>0)return g.create(h.NUM);const u=Ut(s/a,0)*a;return y.create(u)}}class GC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=0,r=1;for(let s=0;s<e.length;s++){const a=e[s];if(!a.isNull())if(a.isArray()){let u=!1,c=g.create(h.VALUE);if(a.iterator(l=>{if(l!=null&&l.isNull())return!0;const{isError:f,errorObject:m,number:d}=this._handleSingleObject(l);if(f)return u=!0,c=m,!1;if(t+=d,t>170)return u=!0,c=g.create(h.NUM),!1;r*=_r(d)}),u)return c}else{const{isError:u,errorObject:c,number:l}=this._handleSingleObject(a);if(u)return c;if(t+=l,t>170)return g.create(h.NUM);r*=_r(l)}}const n=_r(t)/r;return y.create(n)}_handleSingleObject(e){if(e.isBoolean())return{isError:!0,errorObject:g.create(h.VALUE),number:null};let t=e;if(e.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return{isError:!0,errorObject:t,number:null};const r=Math.floor(+t.getValue());return r<0?{isError:!0,errorObject:g.create(h.NUM),number:null}:{isError:!1,errorObject:null,number:r}}}class WC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.getRowCount(),r=e.getColumnCount(),n=e.mapValue(s=>{const a=this._handleSingleObject(s);return a.isError()?a:t>1||r>1?a.get(0,0):a});return t===1&&r===1?n.get(0,0):n}return this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=Math.floor(+t.getValue());if(r<=0)return g.create(h.VALUE);const n=[];for(let s=0;s<r;s++){n[s]=[];for(let a=0;a<r;a++)n[s][a]=s===a?1:0}return Z.createByArray(n)}}class QC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=+t.getValue();if(!Number.isFinite(r))return g.create(h.VALUE);let n=r<0?-$e(Math.abs(r),0):$e(r,0);return Number.isNaN(n)?g.create(h.VALUE):(Math.abs(n)%2===0&&(r<0?n--:n++),y.create(n))}}class qC extends p{constructor(){super(...arguments);A(this,"minParams",0);A(this,"maxParams",0)}calculate(){return y.create(Math.PI)}}class XC extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let n=t;return n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:r.pow(n)}}class KC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=y.create(1),r=!0;for(let n=0;n<e.length;n++){let s=e[n];if(s.isError())return s;if(s.isArray()){let a=!1,u=null;if(s.iterator(c=>{if(c!=null&&c.isError())return a=!0,u=c,!1;if(!c||c.isNull()||c.isString()||c.isBoolean())return!0;t=t.multiply(c),r=!1}),a)return u}else{if(s.isNull())continue;if(s.isString()&&(s=s.convertToNumberObjectValue()),s.isError())return s;t=t.multiply(s),r=!1}if(t.isError())return t}return r?y.create(0):t}}class ZC extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,variants:s}=q(e,t);if(r)return n;const[a,u]=s,c=+a.getValue(),l=+u.getValue();if(Number.isNaN(c)||Number.isNaN(l))return g.create(h.VALUE);if(l===0)return g.create(h.DIV_BY_ZERO);const f=Math.trunc(c/l);return y.create(f)}}class zC extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=+t.getValue();if(!Number.isFinite(r))return g.create(h.VALUE);const n=r*(Math.PI/180);return Number.isNaN(n)?g.create(h.VALUE):y.create(n)}}class JC extends p{constructor(){super(...arguments);A(this,"minParams",0);A(this,"maxParams",0)}calculate(){return y.create(Math.random())}}class e_ extends p{constructor(){super(...arguments);A(this,"minParams",0);A(this,"maxParams",5);A(this,"needsSheetRowColumnCount",!0)}calculate(e,t,r,n,s){if(e!=null&&e.isError())return e;if(t!=null&&t.isError())return t;if(r!=null&&r.isError())return r;if(n!=null&&n.isError())return n;if(s!=null&&s.isError())return s;const a=e!=null?e:y.create(1),u=t!=null?t:y.create(1),c=r!=null?r:y.create(0),l=n!=null?n:y.create(1),f=s!=null?s:y.create(0);return this._calculateResult(a,u,c,l,f)}_calculateResult(e,t,r,n,s){const a=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1);if(a===1&&u===1)return this._calculateSingleCell(e,t,r,n,s);const c=O(a,u,e,g.create(h.NA)),l=O(a,u,t,g.create(h.NA)),f=O(a,u,r,g.create(h.NA)),m=O(a,u,n,g.create(h.NA)),d=O(a,u,s,g.create(h.NA));return c.map((C,_,E)=>{const R=l.get(_,E),b=f.get(_,E),N=m.get(_,E),V=d.get(_,E),S=this._handleError(C,R,b,N,V);if(S.errorObject)return S.errorObject;let{minValue:D,maxValue:L,wholeNumberValue:P}=S,j;return P?(D=Math.ceil(D),L=Math.floor(L),j=Math.floor(Math.random()*(L-D+1))+D):j=Math.random()*(L-D)+D,j<D||j>L?g.create(h.VALUE):y.create(j)})}_calculateSingleCell(e,t,r,n,s){let a=e;a.isArray()&&(a=a.get(0,0));let u=t;u.isArray()&&(u=u.get(0,0));let c=r;c.isArray()&&(c=c.get(0,0));let l=n;l.isArray()&&(l=l.get(0,0));let f=s;f.isArray()&&(f=f.get(0,0));const m=this._handleError(a,u,c,l,f);if(m.errorObject)return m.errorObject;let{rowsValue:d,columnsValue:C,minValue:_,maxValue:E,wholeNumberValue:R}=m;if(R&&(_=Math.ceil(_),E=Math.floor(E),_>E))return g.create(h.VALUE);const b=[];for(let N=0;N<d;N++){const V=[];for(let S=0;S<C;S++)R?V.push(Math.floor(Math.random()*(E-_+1))+_):V.push(Math.random()*(E-_)+_);b.push(V)}return d===1&&C===1?y.create(b[0][0]):Z.createByArray(b)}_handleError(e,t,r,n,s){let a=e;if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return{errorObject:a};let u=t;if(u.isString()&&(u=u.convertToNumberObjectValue()),u.isError())return{errorObject:u};let c=r;if(c.isString()&&(c=c.convertToNumberObjectValue()),c.isError())return{errorObject:c};let l=n;if(l.isString()&&(l=l.convertToNumberObjectValue()),l.isError())return{errorObject:l};let f=s;return f.isString()&&(f=f.convertToNumberObjectValue()),f.isError()?{errorObject:f}:this._getValue(a,u,c,l,f)}_getValue(e,t,r,n,s){const a=Math.floor(+e.getValue()),u=Math.floor(+t.getValue());if(a===0||u===0)return{errorObject:g.create(h.CALC)};const c=this._rowCount-this.row,l=this._columnCount-this.column;if(a<0||u<0||a*u>10**7)return{errorObject:g.create(h.VALUE)};if(a>c||u>l)return{errorObject:g.create(h.REF)};const f=+r.getValue(),m=+n.getValue(),d=+s.getValue();return f>m?{errorObject:g.create(h.VALUE)}:d&&(!Number.isInteger(f)||!Number.isInteger(m))?{errorObject:g.create(h.VALUE)}:{rowsValue:a,columnsValue:u,minValue:f,maxValue:m,wholeNumberValue:d}}}class t_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isArray()){const c=r.getRowCount(),l=r.getColumnCount();if(c>1||l>1)return g.create(h.VALUE);r=r.get(0,0)}if(r.isError())return r;let n=t;if(n.isArray()){const c=n.getRowCount(),l=n.getColumnCount();if(c>1||l>1)return g.create(h.VALUE);n=n.get(0,0)}if(n.isError())return n;if(r.isBoolean()||n.isBoolean())return g.create(h.VALUE);let s=+r.getValue(),a=+n.getValue();if(Number.isNaN(s)||Number.isNaN(a))return g.create(h.VALUE);if(s>a)return g.create(h.NUM);s=Math.ceil(s),a=Math.floor(a);const u=Math.floor(Math.random()*(a-s+1))+s;return y.create(u)}}class r_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){const r=t!=null?t:y.create(0),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,r,g.create(h.NA)),c=a.mapValue((l,f,m)=>{const d=u.get(f,m);return l.isError()?l:d.isError()?d:this._handleSingleObject(l,d)});return n===1&&s===1?c.get(0,0):c}_handleSingleObject(e,t){const{isError:r,errorObject:n,variants:s}=B(e);if(r)return n;const[a]=s;let u=Math.floor(+a.getValue()),c=t;if(c.isString()&&(c=c.convertToNumberObjectValue(),c.isError()))return c;let l=Math.floor(+c.getValue());if(c.isBoolean()&&(l=c.getValue()?0:4),u<0||u>3999||l<0||l>4)return g.create(h.VALUE);const f=rh[l];let m=f.length-1,d="";for(;u>0;){m=this._binarySearch(u,0,m,f);const C=f[m];u-=C,d+=th.get(C)}return T.create(d)}_binarySearch(e,t,r,n){let s=t,a=r;for(;a-s>1;){const u=Math.floor((s+a)/2),c=n[u];if(c===e)return u;c>e?a=u:s=u}return s!==a&&n[a]<=e?a:s}}class n_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let n=t;return n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:r.round(n)}}class s_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.mapValue((c,l,f)=>{const m=a.get(l,f);if(c.isError())return c;if(m.isError())return m;const{isError:d,errorObject:C,variants:_}=B(c,m);if(d)return C;const[E,R]=_,b=+E.getValue(),N=Math.trunc(+R.getValue()),V=this._roundBank(b,N);return y.create(V)});return r===1&&n===1?u.get(0,0):u}_roundBank(e,t){if(t>16)return e;if(t<-16)return 0;const r=1e-8,n=10**t,s=+(e*n).toFixed(8),a=Math.floor(s),u=s-a;let c=Math.round(s);return u>.5-r&&u<.5+r&&(c=a%2===0?a:a+1),t?c/n:c}}class a_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let n=t;return n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:r.floor(n)}}class i_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let n=t;return n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:r.ceil(n)}}class o_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=+t.getValue();return Math.abs(r)>=2**27?g.create(h.NUM):t.cos().getReciprocal()}}class u_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=+t.getValue();return Number.isFinite(Math.cosh(r))?Math.abs(r)>=2**27?g.create(h.NUM):t.cosh().getReciprocal():y.create(0)}}class c_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",4);A(this,"needsSheetRowColumnCount",!0)}calculate(e,t,r,n){let s=e,a=t!=null?t:y.create(1),u=r!=null?r:y.create(1),c=n!=null?n:y.create(1);s.isNull()&&(s=y.create(1)),a.isNull()&&(a=y.create(1)),u.isNull()&&(u=y.create(1)),c.isNull()&&(c=y.create(1));const l=Math.max(s.isArray()?s.getRowCount():1,a.isArray()?a.getRowCount():1,u.isArray()?u.getRowCount():1,c.isArray()?c.getRowCount():1),f=Math.max(s.isArray()?s.getColumnCount():1,a.isArray()?a.getColumnCount():1,u.isArray()?u.getColumnCount():1,c.isArray()?c.getColumnCount():1),m=O(l,f,s,g.create(h.NA)),d=O(l,f,a,g.create(h.NA)),C=O(l,f,u,g.create(h.NA)),_=O(l,f,c,g.create(h.NA)),E=m.mapValue((R,b,N)=>{const V=d.get(b,N),S=C.get(b,N),D=_.get(b,N);return R.isError()?R:V.isError()?V:S.isError()?S:D.isError()?D:this._getResult(R,V,S,D,l,f)});return l===1&&f===1?E.get(0,0):E}_getResult(e,t,r,n,s,a){const{isError:u,errorObject:c,variants:l}=B(e,t,r,n);if(u)return c;const[f,m,d,C]=l,_=Math.floor(+f.getValue()),E=Math.floor(+m.getValue()),R=+d.getValue(),b=+C.getValue();if(_<0||E<0||_*E>10**7)return g.create(h.VALUE);if(_===0||E===0)return g.create(h.CALC);const N=this._rowCount-this.row,V=this._columnCount-this.column;if(_>N||E>V)return g.create(h.REF);const S=[];for(let D=0;D<_;D++){S[D]=[];for(let L=0;L<E;L++)S[D][L]=R+(D*E+L)*b}return s>1||a>1?y.create(S[0][0]):Z.createByArray(S)}}class l_ extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4)}calculate(e,t,r,n){if(e.isNull()||t.isNull()||r.isNull()||n.isNull())return g.create(h.NA);const{isError:s,errorObject:a,variants:u}=q(e,t,r);if(s)return a;const{isError:c,errorObject:l,variants:f}=B(...u);if(c)return l;const[m,d,C]=f,_=+m.getValue(),E=+d.getValue(),R=+C.getValue(),b=[];if(n.isArray()){let V=!1,S=g.create(h.VALUE);if(n.iterator(D=>{const{isError:L,errorObject:P,coefficientsObject:j}=this._handleSingleObject(D);if(L)return V=!0,S=P,!1;const I=+j.getValue();b.push(I)}),V)return S}else{const{isError:V,errorObject:S,coefficientsObject:D}=this._handleSingleObject(n);if(V)return S;const L=+D.getValue();b.push(L)}let N=0;for(let V=0;V<b.length;V++)N+=b[V]*_**(E+V*R);return Number.isNaN(N)||!Number.isFinite(N)?g.create(h.NUM):y.create(N)}_handleSingleObject(e){if(e.isError())return{isError:!0,errorObject:e,coefficientsObject:null};if(e!=null&&e.isBoolean())return{isError:!0,errorObject:g.create(h.VALUE),coefficientsObject:null};let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?{isError:!0,errorObject:t,coefficientsObject:null}:{isError:!1,errorObject:null,coefficientsObject:t}}}class f_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;const{isError:t,errorObject:r,variants:n}=B(e);if(t)return r;const[s]=n,a=+s.getValue();return a>0?y.create(1):a<0?y.create(-1):y.create(0)}}class m_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.sin()}}class h_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.sinh()}}class g_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.sqrt()}}class d_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){const s=t.getRowCount(),a=t.getColumnCount();if(s>1||a>1)return g.create(h.VALUE);t=t.get(0,0)}if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=+t.getValue();if(r<0)return g.create(h.NUM);const n=Math.sqrt(r*Math.PI);return y.create(n)}}const C_={1:Oe.AVERAGE,2:Oe.COUNT,3:Oe.COUNTA,4:Oe.MAX,5:Oe.MIN,6:Oe.PRODUCT,7:Oe.STDEV,8:Oe.STDEVP,9:Oe.SUM,10:Oe.VAR,11:Oe.VARP};class __ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",255);A(this,"needsReferenceObject",!0);A(this,"needsFilteredOutRows",!0);A(this,"needsFormulaDataModel",!0)}calculate(e,...t){let r;e.isReferenceObject()?r=e.toArrayValueObject():r=e;const{isError:n,multiAreaRefs:s,normalRefs:a}=To(t);if(!n&&s.length>0)return this._handleMultiAreaRefs(r,s,t);if(r.isArray()){const u=r.mapValue(c=>this._handleSingleObject(c,{isError:n,refs:a}));return u.getRowCount()===1&&u.getColumnCount()===1?u.get(0,0):u}return this._handleSingleObject(r,{isError:n,refs:a})}_handleSingleObject(e,t){const{isError:r=!1,refs:n}=t;let s=e;if(e.isString()&&(s=e.convertToNumberObjectValue()),s.isError())return s;if(r)return g.create(h.VALUE);let a=Math.floor(+s.getValue());if(a<1||a>11&&a<101||a>111)return g.create(h.VALUE);let u=!1;return a>=101&&(a-=100,u=!0),Bo({type:C_[a],ignoreRowHidden:u,ignoreErrorValues:!1,ignoreNested:!0,formulaDataModel:this._formulaDataModel},n)}_handleMultiAreaRefs(e,t,r){const n=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1,{multiAreaInfoMap:a,maxAreasLen:u}=this._getMultiAreaInfo(t),c=Math.max(n,u),l=[];for(let f=0;f<c;f++){const m=f<n?f:n-1,d=[];for(let C=0;C<s;C++){if(n>1&&f>=n){d.push(g.create(h.NA));continue}const _=e.isArray()?e.get(m,C):e,E=[];for(let b=0;b<r.length;b++){const N=r[b],V=a.get(N);if(V){const S=f<V.rowAreas.length?f:V.rowAreas.length-1,D=V.rowAreas[S];if(D.isError()){d.push(D);break}E.push(D);continue}E.push(N)}const R=this._handleSingleObject(_,{isError:!1,refs:E});d.push(R)}l.push(d)}return l.length===1?l[0][0]:at(l,l.length,s)}_getMultiAreaInfo(e){const t=new Map;let r=1;return e.forEach(n=>{const s=n.getAreas().map(a=>{if(!a||a.length===0)return n;const u=a.find(c=>!c.isError());return u!=null?u:a[0]});t.set(n,{ref:n,rowAreas:s}),r=Math.max(r,s.length||1)}),{multiAreaInfoMap:t,maxAreasLen:r}}}class A_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=y.create(0);for(let r=0;r<e.length;r++){let n=e[r];if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()||(n.isArray()&&(n=n.sum()),n.isError()))return n;if(t=t.plus(n),t.isError())return t}return t}}class E_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3);A(this,"needsReferenceObject",!0)}calculate(e,t,r){if(!e.isReferenceObject()||r&&!r.isReferenceObject())return g.create(h.VALUE);let n=t;if(t.isReferenceObject()&&(n=t.toArrayValueObject()),n.isArray()){const s=n.mapValue(a=>this._handleSingleObject(e,a,r));return s.getRowCount()===1&&s.getColumnCount()===1?s.get(0,0):s}return this._handleSingleObject(e,n,r)}_handleSingleObject(e,t,r){const n=e.toArrayValueObject();let s=Mn(n,t);s=Dn(s,n,t);const a=n.getRowCount(),u=n.getColumnCount();let c=n;if(r){c=r.toArrayValueObject();const l=c.getRowCount(),f=c.getColumnCount();if(a!==l||u!==f){const m=r.getRangeData();m.endRow=m.startRow+a-1,m.endColumn=m.startColumn+u-1,r.setRangeData(m),c=r.toArrayValueObject()}}return c.pick(s).sum()}}class R_ extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",255);A(this,"needsReferenceObject",!0)}calculate(e,...t){const{isError:r,errorObject:n,rangeIsDifferentSize:s,criteriaMaxRowLength:a,criteriaMaxColumnLength:u,targetRange:c,variants:l}=jr(t,e);if(r)return n;if(s)return a===1&&u===1?g.create(h.VALUE):O(a,u,g.create(h.VALUE));const f=xr(l,a,u,!0);return this._aggregateResults(c,f)}_aggregateResults(e,t){const r=t.map(n=>n.map(s=>e.pick(s).sum()));return r.length===1&&r[0].length===1?r[0][0]:Z.create({calculateValueList:r,rowCount:r.length,columnCount:r[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column})}}class b_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(e,...t){if(e.isError())return e;const r=this._initArray1(e);if(t.length===0)return r.sum();const n=r.getRowCount(),s=r.getColumnCount(),a=this._getResultArrayByArray1(n,s,r);if(a instanceof g)return a;const u=a,c=this._validateVariants(t,n,s);return c||this._sumProduct(u,t,n,s)}_validateVariants(e,t,r){for(const n of e){if(n.isError())return n;if(n.isArray()){const s=n,a=s.getRowCount(),u=s.getColumnCount();if(a!==t&&u!==r)return g.create(h.VALUE)}}return null}_sumProduct(e,t,r,n){let s=0;for(let a=0;a<r;a++)for(let u=0;u<n;u++){let c=e[a][u];for(let l=0;l<t.length;l++){const f=t[l],m=this._getVariantCell(f,a,u);if(!m)return g.create(h.VALUE);if(m.isError())return m;m.isNumber()?c*=m.getValue():c=0}s+=c}return y.create(s)}_getVariantCell(e,t,r){if(!e.isArray())return e;const s=e.get(t,r);return s!=null?s:null}_initArray1(e){let t=e;return t.isArray()||(t=Z.create({calculateValueList:[[t]],rowCount:1,columnCount:1,unitId:"",sheetId:"",row:0,column:0})),t}_getResultArrayByArray1(e,t,r){const n=[];for(let s=0;s<e;s++){const a=[];for(let u=0;u<t;u++){const c=r.get(s,u);if(c.isError())return c;c.isNumber()?a.push(c.getValue()):a.push(0)}n.push(a)}return n}}class y_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=y.create(0);const r=y.create(2);for(let n=0;n<e.length;n++){let s=e[n];if(s.isString()&&(s=s.convertToNumberObjectValue()),s.isError())return s;if(s.isArray()?s.iterator(a=>{if(a==null||a.isString()||a.isBoolean()||a.isNull())return!0;if(a.isError())return t=a,!1;t=t.plus(a.pow(r))}):t=t.plus(s.pow(r)),t.isError())return t}return t}}class N_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=r*n,a=t.isArray()?t.getRowCount():1,u=t.isArray()?t.getColumnCount():1,c=a*u;if(s!==c)return g.create(h.NA);if(s===1)return this._calculateSingleCell(e,t);{const l=e.flatten(),f=t.flatten();let m=le.create();const d=[],C=[];let _=0;return l.iterator((E,R,b)=>{const N=f.get(R,b);if(E==null||E.isString()||E.isBoolean()||E.isNull())return!0;if(E!=null&&E.isError())return m=E,!1;if(N==null||N.isString()||N.isBoolean()||N.isNull())return!0;if(N!=null&&N.isError())return m=N,!1;const V=+E.getValue(),S=+N.getValue();d.push(V),C.push(S),_+=V**2-S**2}),m.isError()?m:d.length===0||C.length===0?g.create(h.DIV_BY_ZERO):y.create(_)}}_calculateSingleCell(e,t){let r=e;if(r.isArray()&&(r=r.get(0,0)),r.isError())return r;let n=t;if(n.isArray()&&(n=n.get(0,0)),n.isError())return n;if(r.isNull()||n.isNull())return g.create(h.VALUE);const s=+r.getValue(),a=+n.getValue();if(r.isString()&&!M.isRealNum(s)||r.isBoolean()||n.isString()&&!M.isRealNum(a)||n.isBoolean())return g.create(h.DIV_BY_ZERO);const u=s**2-a**2;return y.create(u)}}class p_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=r*n,a=t.isArray()?t.getRowCount():1,u=t.isArray()?t.getColumnCount():1,c=a*u;if(s!==c)return g.create(h.NA);if(s===1)return this._calculateSingleCell(e,t);{const l=e.flatten(),f=t.flatten();let m=le.create();const d=[],C=[];let _=0;return l.iterator((E,R,b)=>{const N=f.get(R,b);if(E==null||E.isString()||E.isBoolean()||E.isNull())return!0;if(E!=null&&E.isError())return m=E,!1;if(N==null||N.isString()||N.isBoolean()||N.isNull())return!0;if(N!=null&&N.isError())return m=N,!1;const V=+E.getValue(),S=+N.getValue();d.push(V),C.push(S),_+=V**2+S**2}),m.isError()?m:d.length===0||C.length===0?g.create(h.DIV_BY_ZERO):y.create(_)}}_calculateSingleCell(e,t){let r=e;if(r.isArray()&&(r=r.get(0,0)),r.isError())return r;let n=t;if(n.isArray()&&(n=n.get(0,0)),n.isError())return n;if(r.isNull()||n.isNull())return g.create(h.VALUE);const s=+r.getValue(),a=+n.getValue();if(r.isString()&&!M.isRealNum(s)||r.isBoolean()||n.isString()&&!M.isRealNum(a)||n.isBoolean())return g.create(h.DIV_BY_ZERO);const u=s**2+a**2;return y.create(u)}}class V_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=r*n,a=t.isArray()?t.getRowCount():1,u=t.isArray()?t.getColumnCount():1,c=a*u;if(s!==c)return g.create(h.NA);if(s===1)return this._calculateSingleCell(e,t);{const l=e.flatten(),f=t.flatten();let m=le.create();const d=[],C=[];let _=0;return l.iterator((E,R,b)=>{const N=f.get(R,b);if(E==null||E.isString()||E.isBoolean()||E.isNull())return!0;if(E!=null&&E.isError())return m=E,!1;if(N==null||N.isString()||N.isBoolean()||N.isNull())return!0;if(N!=null&&N.isError())return m=N,!1;const V=+E.getValue(),S=+N.getValue();d.push(V),C.push(S),_+=(V-S)**2}),m.isError()?m:d.length===0||C.length===0?g.create(h.DIV_BY_ZERO):y.create(_)}}_calculateSingleCell(e,t){let r=e;if(r.isArray()&&(r=r.get(0,0)),r.isError())return r;let n=t;if(n.isArray()&&(n=n.get(0,0)),n.isError())return n;if(r.isNull()||n.isNull())return g.create(h.VALUE);const s=+r.getValue(),a=+n.getValue();if(r.isString()&&!M.isRealNum(s)||r.isBoolean()||n.isString()&&!M.isRealNum(a)||n.isBoolean())return g.create(h.DIV_BY_ZERO);const u=(s-a)**2;return y.create(u)}}class O_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.tan()}}class S_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.tanh()}}class M_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){const r=t!=null?t:y.create(0),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,r,g.create(h.NA)),c=a.map((l,f,m)=>{let d=u.get(f,m),C=l;if(C.isString()&&(C=C.convertToNumberObjectValue()),C.isError())return C;if(d.isString()&&(d=d.convertToNumberObjectValue()),d.isError())return d;const _=+C.getValue(),E=+d.getValue(),R=10**Math.trunc(E),b=Vn(_,R),N=Math.trunc(fr(_,R)+b)/R;return y.create(N)});return n===1&&s===1?c.get(0,0):c}}const Qu=[[eC,$.ABS],[tC,$.ACOS],[rC,$.ACOSH],[nC,$.ACOT],[sC,$.ACOTH],[iC,$.AGGREGATE],[oC,$.ARABIC],[uC,$.ASIN],[cC,$.ASINH],[lC,$.ATAN],[fC,$.ATAN2],[mC,$.ATANH],[hC,$.BASE],[gC,$.CEILING],[dC,$.CEILING_MATH],[CC,$.CEILING_PRECISE],[_C,$.COMBIN],[AC,$.COMBINA],[EC,$.COS],[RC,$.COSH],[bC,$.COT],[yC,$.COTH],[NC,$.CSC],[pC,$.CSCH],[VC,$.DECIMAL],[OC,$.DEGREES],[SC,$.EVEN],[MC,$.EXP],[DC,$.FACT],[wC,$.FACTDOUBLE],[LC,$.FLOOR],[PC,$.FLOOR_MATH],[jC,$.FLOOR_PRECISE],[xC,$.GCD],[UC,$.INT],[TC,$.LCM],[vC,$.LN],[IC,$.LOG],[FC,$.LOG10],[BC,$.MDETERM],[kC,$.MINVERSE],[$C,$.MMULT],[YC,$.MOD],[HC,$.MROUND],[GC,$.MULTINOMIAL],[WC,$.MUNIT],[QC,$.ODD],[qC,$.PI],[XC,$.POWER],[KC,$.PRODUCT],[ZC,$.QUOTIENT],[zC,$.RADIANS],[JC,$.RAND],[e_,$.RANDARRAY],[t_,$.RANDBETWEEN],[r_,$.ROMAN],[n_,$.ROUND],[s_,$.ROUNDBANK],[a_,$.ROUNDDOWN],[i_,$.ROUNDUP],[o_,$.SEC],[u_,$.SECH],[l_,$.SERIESSUM],[c_,$.SEQUENCE],[f_,$.SIGN],[m_,$.SIN],[h_,$.SINH],[g_,$.SQRT],[d_,$.SQRTPI],[__,$.SUBTOTAL],[A_,$.SUM],[E_,$.SUMIF],[R_,$.SUMIFS],[b_,$.SUMPRODUCT],[y_,$.SUMSQ],[N_,$.SUMX2MY2],[p_,$.SUMX2PY2],[V_,$.SUMXMY2],[O_,$.TAN],[S_,$.TANH],[M_,$.TRUNC]];class D_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2);A(this,"_compareType",H.EQUALS)}setCompareType(e){this._compareType=e}calculate(e,t){return e.isError()?e:t.isError()?t:e.compare(t,this._compareType)}}class ja extends pt{constructor(e){super("");A(this,"_values",[]);this._values=e}static create(e){return new ja(e)}isCube(){return!0}dispose(){this._values.forEach(e=>{e.dispose()}),this._values=[]}getCubeValues(){return this._values}getCubeCount(){return this._values.length}sum(){const e=y.create(0);return this._values.forEach(t=>{e.plus(t.sum())}),e}max(){let e=y.create(Number.NEGATIVE_INFINITY);return this._values.forEach(t=>{const r=t.max();e.isLessThan(r)&&(e=r)}),e}min(){let e=y.create(Number.POSITIVE_INFINITY);return this._values.forEach(t=>{const r=t.max();e.isGreaterThan(r)&&(e=r)}),e}count(){const e=y.create(0);return this._values.forEach(t=>{e.plus(t.count())}),e}countA(){const e=y.create(0);return this._values.forEach(t=>{e.plus(t.countA())}),e}countBlank(){const e=y.create(0);return this._values.forEach(t=>{e.plus(t.countBlank())}),e}}class w_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=[];for(let r=0;r<e.length;r++){const n=e[r];if(n.isError())return n;if(!n.isArray())return g.create(h.VALUE);t.push(n)}return ja.create(t)}}class L_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){return e.isError()?e:t.isError()?t:!t.isArray()&&t.getValue()===0?g.create(h.DIV_BY_ZERO):e.divided(t)}}class P_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){return e.isError()?e:t.isError()?t:e.minus(t)}}class j_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){return e.isError()?e:t.isError()?t:e.multiply(t)}}class x_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){return e.isError()?e:t.isError()?t:e.plus(t)}}const qu=[[D_,Ie.COMPARE],[L_,Ie.DIVIDED],[P_,Ie.MINUS],[j_,Ie.MULTIPLY],[x_,Ie.PLUS],[w_,Ie.CUBE]];var x=(i=>(i.AVEDEV="AVEDEV",i.AVERAGE="AVERAGE",i.AVERAGE_WEIGHTED="AVERAGE.WEIGHTED",i.AVERAGEA="AVERAGEA",i.AVERAGEIF="AVERAGEIF",i.AVERAGEIFS="AVERAGEIFS",i.BETA_DIST="BETA.DIST",i.BETA_INV="BETA.INV",i.BINOM_DIST="BINOM.DIST",i.BINOM_DIST_RANGE="BINOM.DIST.RANGE",i.BINOM_INV="BINOM.INV",i.CHISQ_DIST="CHISQ.DIST",i.CHISQ_DIST_RT="CHISQ.DIST.RT",i.CHISQ_INV="CHISQ.INV",i.CHISQ_INV_RT="CHISQ.INV.RT",i.CHISQ_TEST="CHISQ.TEST",i.CONFIDENCE_NORM="CONFIDENCE.NORM",i.CONFIDENCE_T="CONFIDENCE.T",i.CORREL="CORREL",i.COUNT="COUNT",i.COUNTA="COUNTA",i.COUNTBLANK="COUNTBLANK",i.COUNTIF="COUNTIF",i.COUNTIFS="COUNTIFS",i.COVARIANCE_P="COVARIANCE.P",i.COVARIANCE_S="COVARIANCE.S",i.DEVSQ="DEVSQ",i.EXPON_DIST="EXPON.DIST",i.F_DIST="F.DIST",i.F_DIST_RT="F.DIST.RT",i.F_INV="F.INV",i.F_INV_RT="F.INV.RT",i.F_TEST="F.TEST",i.FISHER="FISHER",i.FISHERINV="FISHERINV",i.FORECAST="FORECAST",i.FORECAST_ETS="FORECAST.ETS",i.FORECAST_ETS_CONFINT="FORECAST.ETS.CONFINT",i.FORECAST_ETS_SEASONALITY="FORECAST.ETS.SEASONALITY",i.FORECAST_ETS_STAT="FORECAST.ETS.STAT",i.FORECAST_LINEAR="FORECAST.LINEAR",i.FREQUENCY="FREQUENCY",i.GAMMA="GAMMA",i.GAMMA_DIST="GAMMA.DIST",i.GAMMA_INV="GAMMA.INV",i.GAMMALN="GAMMALN",i.GAMMALN_PRECISE="GAMMALN.PRECISE",i.GAUSS="GAUSS",i.GEOMEAN="GEOMEAN",i.GROWTH="GROWTH",i.HARMEAN="HARMEAN",i.HYPGEOM_DIST="HYPGEOM.DIST",i.INTERCEPT="INTERCEPT",i.KURT="KURT",i.LARGE="LARGE",i.LINEST="LINEST",i.LOGEST="LOGEST",i.LOGNORM_DIST="LOGNORM.DIST",i.LOGNORM_INV="LOGNORM.INV",i.MARGINOFERROR="MARGINOFERROR",i.MAX="MAX",i.MAXA="MAXA",i.MAXIFS="MAXIFS",i.MEDIAN="MEDIAN",i.MIN="MIN",i.MINA="MINA",i.MINIFS="MINIFS",i.MODE_MULT="MODE.MULT",i.MODE_SNGL="MODE.SNGL",i.NEGBINOM_DIST="NEGBINOM.DIST",i.NORM_DIST="NORM.DIST",i.NORM_INV="NORM.INV",i.NORM_S_DIST="NORM.S.DIST",i.NORM_S_INV="NORM.S.INV",i.PEARSON="PEARSON",i.PERCENTILE_EXC="PERCENTILE.EXC",i.PERCENTILE_INC="PERCENTILE.INC",i.PERCENTRANK_EXC="PERCENTRANK.EXC",i.PERCENTRANK_INC="PERCENTRANK.INC",i.PERMUT="PERMUT",i.PERMUTATIONA="PERMUTATIONA",i.PHI="PHI",i.POISSON_DIST="POISSON.DIST",i.PROB="PROB",i.QUARTILE_EXC="QUARTILE.EXC",i.QUARTILE_INC="QUARTILE.INC",i.RANK_AVG="RANK.AVG",i.RANK_EQ="RANK.EQ",i.RSQ="RSQ",i.SKEW="SKEW",i.SKEW_P="SKEW.P",i.SLOPE="SLOPE",i.SMALL="SMALL",i.STANDARDIZE="STANDARDIZE",i.STDEV_P="STDEV.P",i.STDEV_S="STDEV.S",i.STDEVA="STDEVA",i.STDEVPA="STDEVPA",i.STEYX="STEYX",i.T_DIST="T.DIST",i.T_DIST_2T="T.DIST.2T",i.T_DIST_RT="T.DIST.RT",i.T_INV="T.INV",i.T_INV_2T="T.INV.2T",i.T_TEST="T.TEST",i.TREND="TREND",i.TRIMMEAN="TRIMMEAN",i.VAR_P="VAR.P",i.VAR_S="VAR.S",i.VARA="VARA",i.VARPA="VARPA",i.WEIBULL_DIST="WEIBULL.DIST",i.Z_TEST="Z.TEST",i))(x||{}),ns=(i=>(i.ENCODEURL="ENCODEURL",i.FILTERXML="FILTERXML",i.WEBSERVICE="WEBSERVICE",i))(ns||{});const U_=new Set([$.ACOT,$.ACOTH,$.ARABIC,$.BASE,$.CEILING_MATH,$.CEILING_PRECISE,$.COMBINA,$.COT,$.COTH,$.CSC,$.CSCH,$.DECIMAL,$.FLOOR_MATH,$.FLOOR_PRECISE,$.MUNIT,$.RANDARRAY,$.SEC,$.SECH,$.SEQUENCE,ne.CHOOSECOLS,ne.CHOOSEROWS,ne.DROP,ne.EXPAND,ne.FILTER,ne.FORMULATEXT,ne.HSTACK,ne.SORT,ne.SORTBY,ne.TAKE,ne.TOCOL,ne.TOROW,ne.UNIQUE,ne.VSTACK,ne.WRAPCOLS,ne.WRAPROWS,ne.XLOOKUP,ne.XMATCH,X.BITAND,X.BITLSHIFT,X.BITOR,X.BITRSHIFT,X.BITXOR,X.ERF_PRECISE,X.ERFC_PRECISE,X.IMCOSH,X.IMCOT,X.IMCSC,X.IMCSCH,X.IMSEC,X.IMSECH,X.IMSINH,X.IMTAN,ye.ISFORMULA,ye.SHEET,ye.SHEETS,Ee.IFNA,Ee.IFS,Ee.SWITCH,Ee.XOR,x.BETA_DIST,x.BETA_INV,x.BINOM_DIST,x.BINOM_DIST_RANGE,x.BINOM_INV,x.CHISQ_DIST,x.CHISQ_DIST_RT,x.CHISQ_INV,x.CHISQ_INV_RT,x.CHISQ_TEST,x.CONFIDENCE_NORM,x.CONFIDENCE_T,x.COVARIANCE_P,x.COVARIANCE_S,x.EXPON_DIST,x.F_DIST,x.F_DIST_RT,x.F_INV,x.F_INV_RT,x.F_TEST,x.FORECAST_LINEAR,x.GAMMA,x.GAMMA_DIST,x.GAMMA_INV,x.GAMMALN_PRECISE,x.GAUSS,x.HYPGEOM_DIST,x.LOGNORM_DIST,x.LOGNORM_INV,x.MAXIFS,x.MINIFS,x.MODE_MULT,x.MODE_SNGL,x.NEGBINOM_DIST,x.NORM_DIST,x.NORM_INV,x.NORM_S_DIST,x.NORM_S_INV,x.PERCENTILE_EXC,x.PERCENTILE_INC,x.PERCENTRANK_EXC,x.PERCENTRANK_INC,x.PERMUTATIONA,x.PHI,x.POISSON_DIST,x.QUARTILE_EXC,x.QUARTILE_INC,x.RANK_AVG,x.RANK_EQ,x.SKEW_P,x.STDEV_P,x.STDEV_S,x.T_DIST,x.T_DIST_2T,x.T_DIST_RT,x.T_INV,x.T_INV_2T,x.T_TEST,x.VAR_P,x.VAR_S,x.WEIBULL_DIST,x.Z_TEST,J.ARRAYTOTEXT,ns.ENCODEURL,J.NUMBERVALUE,J.TEXTAFTER,J.TEXTBEFORE,J.TEXTJOIN,J.TEXTSPLIT,J.UNICHAR,J.UNICODE,J.VALUETOTEXT,Ae.DAYS,Ae.ISOWEEKNUM,ee.PDURATION,ee.RRI,Ee.BYCOL,Ee.BYROW,Ee.MAKEARRAY,Ee.MAP,Ee.REDUCE,Ee.SCAN]);class T_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=y.create(0),r=y.create(0);for(let a=0;a<e.length;a++){let u=e[a];if(u.isString()&&(u=u.convertToNumberObjectValue()),u.isError())return u;if(u.isArray()){if(u=v_(u),u.isError())return u;if(e[a]=u,t=t.plus(u.sum()),t.isError())return t;r=r.plus(u.count())}else u.isNull()||(t=t.plus(u),r=r.plus(y.create(1)))}if(r.getValue()===0)return g.create(h.NUM);const n=t.divided(r);if(n.isError())return n;let s=y.create(0);for(let a=0;a<e.length;a++){let u=e[a];if(u.isString()&&(u=u.convertToNumberObjectValue()),u.isError())return u;if(u.isArray()){if(s=s.plus(u.minus(n).abs().sum()),s.isError())return s}else u.isNull()||(s=s.plus(u.minus(n).abs()))}return s.divided(r)}}function v_(i){const o=[];o[0]=[];let e=null;return i.iterator((t,r,n)=>{if(t!=null&&t.isError())return e=t,!1;t!=null&&t.isNumber()&&o[0].push(t)}),e||at(o,1,o[0].length)}class I_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=y.create(0),r=y.create(0);for(let n=0;n<e.length;n++){let s=e[n];if((s.isString()||s.isBoolean())&&(s=s.convertToNumberObjectValue()),s.isError())return s;if(s.isArray()){if(t=t.plus(s.sum()),t.isError())return t;r=r.plus(s.count())}else s.isNull()||(t=t.plus(s),r=r.plus(y.create(1)))}return t.divided(r)}}class F_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",254)}calculate(...e){let t=!1,r;e.length%2!==0&&(t=!0,r=g.create(h.NA));const n=[],s=[];for(let a=0;a<e.length;a+=2){const u=e[a],c=u.isArray()?u.getRowCount():1,l=u.isArray()?u.getColumnCount():1;for(let C=0;C<c;C++)for(let _=0;_<l;_++){const E=u.isArray()?u.get(C,_):u;if(E.isError())return E;if(t)continue;const R=E.isNull()?"":E.getValue();n.push(R)}if(a+1>=e.length)continue;const f=e[a+1],m=f.isArray()?f.getRowCount():1,d=f.isArray()?f.getColumnCount():1;(m!==c||d!==l)&&(t=!0,r=g.create(h.VALUE));for(let C=0;C<m;C++)for(let _=0;_<d;_++){const E=f.isArray()?f.get(C,_):f;if(E.isError())return E;if(t)continue;const R=E.isNull()?"":E.getValue();s.push(R)}}return t?r:this._getResult(n,s)}_getResult(e,t){const r=e.length;let n=0,s=0;for(let u=0;u<r;u++){const c=e[u],l=t[u];if(!(typeof c!="number"&&typeof l!="number")){if(typeof c!="number"||typeof l!="number"||l<0)return g.create(h.VALUE);n+=c*l,s+=l}}if(s===0)return g.create(h.DIV_BY_ZERO);const a=n/s;return y.create(a)}}class B_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=y.create(0),r=y.create(0);for(let n=0;n<e.length;n++){let s=e[n];if((s.isString()||s.isBoolean())&&(s=s.convertToNumberObjectValue()),s.isError())return s;if(s.isArray()){if(s.iterator(a=>{if(a==null||a.isNull())return!0;let u=a;if(u.isString()&&(u=u.convertToNumberObjectValue(),u.isError()&&(u=y.create(0))),u.isBoolean()&&(u=u.convertToNumberObjectValue()),u.isError())return t=u,!1;t=t.plus(u),r=r.plus(y.create(1))}),t.isError())return t}else s.isNull()||(t=t.plus(s),r=r.plus(y.create(1)))}return t.divided(r)}}class k_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3);A(this,"needsReferenceObject",!0)}calculate(e,t,r){if(!e.isReferenceObject()||r&&!r.isReferenceObject())return g.create(h.VALUE);let n=t;if(t.isReferenceObject()&&(n=t.toArrayValueObject()),n.isArray()){const s=n.mapValue(a=>this._handleSingleObject(e,a,r));return s.getRowCount()===1&&s.getColumnCount()===1?s.get(0,0):s}return this._handleSingleObject(e,n,r)}_handleSingleObject(e,t,r){const n=e.toArrayValueObject();let s=Mn(n,t);s=Dn(s,n,t);const a=n.getRowCount(),u=n.getColumnCount();let c=n;if(r){c=r.toArrayValueObject();const d=c.getRowCount(),C=c.getColumnCount();if(a!==d||u!==C){const _=r.getRangeData();_.endRow=_.startRow+a-1,_.endColumn=_.startColumn+u-1,r.setRangeData(_),c=r.toArrayValueObject()}}const l=c.pick(s),f=l.sum(),m=l.count();return f.divided(m)}}class $_ extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",255);A(this,"needsReferenceObject",!0)}calculate(e,...t){const{isError:r,errorObject:n,rangeIsDifferentSize:s,criteriaMaxRowLength:a,criteriaMaxColumnLength:u,targetRange:c,variants:l}=jr(t,e);if(r)return n;if(s)return a===1&&u===1?g.create(h.VALUE):O(a,u,g.create(h.VALUE));const f=xr(l,a,u,!0);return this._aggregateResults(c,f)}_aggregateResults(e,t){const r=t.map(n=>n.map(s=>{const a=e.pick(s),u=a.sum(),c=a.count();return u.divided(c)}));return r.length===1&&r[0].length===1?r[0][0]:Z.create({calculateValueList:r,rowCount:r.length,columnCount:r[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column})}}class Y_ extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",6)}calculate(e,t,r,n,s,a){let u=s!=null?s:y.create(0),c=a!=null?a:y.create(1);u.isNull()&&(u=y.create(0)),c.isNull()&&(c=y.create(1));const l=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,u.isArray()?u.getRowCount():1,c.isArray()?c.getRowCount():1),f=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,u.isArray()?u.getColumnCount():1,c.isArray()?c.getColumnCount():1),m=O(l,f,e,g.create(h.NA)),d=O(l,f,t,g.create(h.NA)),C=O(l,f,r,g.create(h.NA)),_=O(l,f,n,g.create(h.NA)),E=O(l,f,u,g.create(h.NA)),R=O(l,f,c,g.create(h.NA)),b=m.mapValue((N,V,S)=>{const D=d.get(V,S),L=C.get(V,S),P=_.get(V,S),j=E.get(V,S),I=R.get(V,S);return this._handleSingleObject(N,D,L,P,j,I)});return l===1&&f===1?b.get(0,0):b}_handleSingleObject(e,t,r,n,s,a){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(n.isError())return n;if(s.isError())return s;if(a.isError())return a;const{isError:u,errorObject:c,variants:l}=B(e,t,r,n,s,a);if(u)return c;const[f,m,d,C,_,E]=l,R=+f.getValue(),b=+m.getValue(),N=+d.getValue(),V=+C.getValue(),S=+_.getValue(),D=+E.getValue();if(b<=0||N<=0||R<S||R>D||S===D)return g.create(h.NUM);let L;return V?L=Oo((R-S)/(D-S),b,N):L=nh((R-S)/(D-S),b,N)/(D-S),y.create(L)}}class H_ extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",4)}calculate(e,t,r,n){let s=n!=null?n:r;s.isNull()&&(s=r);const a=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,s.isArray()?s.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,s.isArray()?s.getColumnCount():1),c=O(a,u,e,g.create(h.NA)),l=O(a,u,t,g.create(h.NA)),f=O(a,u,r,g.create(h.NA)),m=O(a,u,s,g.create(h.NA)),d=c.mapValue((C,_,E)=>{const R=l.get(_,E),b=f.get(_,E),N=m.get(_,E);return C.isError()?C:R.isError()?R:b.isError()?b:N.isError()?N:this._handleSingleObject(C,R,b,N)});return a===1&&u===1?d.get(0,0):d}_handleSingleObject(e,t,r,n){const{isError:s,errorObject:a,variants:u}=B(e,t,r,n);if(s)return a;const[c,l,f,m]=u,d=Math.floor(+c.getValue()),C=+l.getValue(),_=Math.floor(+f.getValue()),E=Math.floor(+m.getValue());if(d<0||C<0||C>1||_<0||_>d||E<0||E<_||E>d)return g.create(h.NUM);let R=0;for(let b=_;b<=E;b++)R+=ba(b,d,C);return y.create(R)}}class G_ extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSingleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=B(e,t,r);if(n)return s;const[u,c,l]=a,f=+u.getValue(),m=Math.floor(+c.getValue()),d=+l.getValue();if(f<0||m<1||m>10**10)return g.create(h.NUM);let C;return d?C=ya(f,m):C=sh(f,m),y.create(C)}}class W_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.mapValue((c,l,f)=>{const m=a.get(l,f);return c.isError()?c:m.isError()?m:this._handleSingleObject(c,m)});return r===1&&n===1?u.get(0,0):u}_handleSingleObject(e,t){const{isError:r,errorObject:n,variants:s}=B(e,t);if(r)return n;const[a,u]=s,c=+a.getValue(),l=Math.floor(+u.getValue());if(c<0||c>1||l<1||l>10**10)return g.create(h.NUM);const f=Do(c,l);return Number.isNaN(f)||!Number.isFinite(f)?g.create(h.NUM):y.create(f)}}class Q_ extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);if(f.isError())return f;if(C.isError())return C;if(_.isError())return _;const{isError:E,errorObject:R,variants:b}=B(f,C,_);if(E)return R;const[N,V,S]=b,D=+N.getValue(),L=+V.getValue(),P=Math.floor(+S.getValue());if(D<=0||D>=1||L<=0||P<1)return g.create(h.NUM);if(P===1)return g.create(h.DIV_BY_ZERO);const j=Math.abs(Gn(D/2,P-1)*L/Math.sqrt(P));return y.create(j)});return n===1&&s===1?l.get(0,0):l}}class q_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1;let u=e;if(e.isArray()&&r===1&&n===1&&(u=e.get(0,0)),u.isError())return u;let c=t;if(t.isArray()&&s===1&&a===1&&(c=t.get(0,0)),c.isError())return c;if(r*n===1||s*a===1)return u.isNull()||c.isNull()?g.create(h.VALUE):g.create(h.DIV_BY_ZERO);if(r*n!==s*a)return g.create(h.NA);const{isError:l,errorObject:f,array1Values:m,array2Values:d,noCalculate:C}=Ze(e,t,r*n,n,a);return l?f:C?g.create(h.DIV_BY_ZERO):this._getResult(m,d)}_getResult(e,t){const r=e.length;let n=0,s=0;for(let d=0;d<r;d++)n+=e[d],s+=t[d];const a=n/r,u=s/r;let c=0,l=0,f=0;for(let d=0;d<r;d++){const C=e[d]-a,_=t[d]-u;c+=C*_,l+=C**2,f+=_**2}const m=Math.sqrt(l*f);return m===0?g.create(h.DIV_BY_ZERO):y.create(c/m)}}class X_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=y.create(0);for(let r=0;r<e.length;r++){const n=e[r];n.isError()||(n.isArray()?t=t.plus(n.count()):n.isString()?n.convertToNumberObjectValue().isError()||(t=t.plus(y.create(1))):n.isNull()||(t=t.plus(y.create(1))))}return t}}class K_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=y.create(0);for(let r=0;r<e.length;r++){let n=e[r];if(n.isError()){t=t.plus(y.create(1));continue}n.isArray()?(n=n.countA(),t=t.plus(n)):n.isNull()||(t=t.plus(y.create(1)))}return t}}class Z_ extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isError()?e:e.getValue()===""||e.isNull()?y.create(1):e.isArray()?e.countBlank():y.create(0)}}class z_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2);A(this,"needsReferenceObject",!0)}calculate(e,t){if(!e.isReferenceObject())return g.create(h.VALUE);let r=t;if(t.isReferenceObject()&&(r=t.toArrayValueObject()),r.isArray()){const n=r.mapValue(s=>this._handleSingleObject(e,s));return n.getRowCount()===1&&n.getColumnCount()===1?n.get(0,0):n}return this._handleSingleObject(e,r)}_handleSingleObject(e,t){const r=e.toArrayValueObject();let n=Mn(r,t);n=Dn(n,r,t);const s=r.pick(n);return this._countA(s)}_countA(e){let t=y.create(0);return e.iterator(r=>{if(r==null)return!0;t=t.plusBy(1)}),t}}class J_ extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",255);A(this,"needsReferenceObject",!0)}calculate(...e){const{isError:t,errorObject:r,rangeIsDifferentSize:n,criteriaMaxRowLength:s,criteriaMaxColumnLength:a,variants:u}=jr(e);if(t)return r;if(n)return s===1&&a===1?g.create(h.VALUE):O(s,a,g.create(h.VALUE));const c=xr(u,s,a,!0);return this._aggregateResults(c)}_aggregateResults(e){const t=e.map(r=>r.map(n=>eA(n)));return t.length===1&&t[0].length===1?t[0][0]:Z.create({calculateValueList:t,rowCount:t.length,columnCount:t[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column})}}function eA(i){let o=0;return i.iterator(e=>{e!=null&&e.isBoolean()&&e.getValue()===!0&&o++}),y.create(o)}class tA extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1;let u=e;if(e.isArray()&&r===1&&n===1&&(u=e.get(0,0)),u.isError())return u;let c=t;if(t.isArray()&&s===1&&a===1&&(c=t.get(0,0)),c.isError())return c;if((r*n===1||s*a===1)&&(u.isNull()||c.isNull()))return g.create(h.VALUE);if(r*n!==s*a)return g.create(h.NA);const{isError:l,errorObject:f,array1Values:m,array2Values:d,noCalculate:C}=Ze(e,t,r*n,n,a);return l?f:C?g.create(h.DIV_BY_ZERO):this._getResult(m,d)}_getResult(e,t){if(e.length<=1)return g.create(h.DIV_BY_ZERO);const r=e.length;let n=0,s=0;for(let l=0;l<r;l++)n+=e[l],s+=t[l];const a=n/r,u=s/r;let c=0;for(let l=0;l<r;l++){const f=e[l]-a,m=t[l]-u;c+=f*m}return y.create(c/(r-1))}}class rA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=[];let r=0,n=!0;for(let u=0;u<e.length;u++){const c=e[u];if(c.isArray()){let l=!1,f=g.create(h.VALUE);if(c.iterator(m=>{const d=this._handleSingleObject(m);if(d.isError())return l=!0,f=d,!1;if(d.isNull())return!0;const C=d.getValue();t.push(C),r+=C,n=!1}),l)return f}else{const l=this._handleSingleObject(c);if(l.isError())return l;if(l.isNull())continue;const f=l.getValue();t.push(f),r+=f,n=!1}}if(n)return g.create(h.NUM);const s=r/t.length;let a=0;for(let u=0;u<t.length;u++)a+=(t[u]-s)**2;return y.create(a)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull()||e.isBoolean())return le.create();const t=e.getValue();return M.isRealNum(t)?y.create(+t):le.create()}}class nA extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA)),f=O(s,a,n,g.create(h.NA)),m=u.mapValue((d,C,_)=>{const E=c.get(C,_),R=l.get(C,_),b=f.get(C,_);return d.isError()?d:E.isError()?E:R.isError()?R:b.isError()?b:this._handleSingleObject(d,E,R,b)});return s===1&&a===1?m.get(0,0):m}_handleSingleObject(e,t,r,n){const{isError:s,errorObject:a,variants:u}=B(e,t,r,n);if(s)return a;const[c,l,f,m]=u,d=+c.getValue(),C=Math.floor(+l.getValue()),_=Math.floor(+f.getValue()),E=+m.getValue();if(d<0||C<1||C>10**10||_<1||_>10**10)return g.create(h.NUM);let R;return E?R=Na(d,C,_):R=ah(d,C,_),Number.isNaN(R)||!Number.isFinite(R)?g.create(h.NUM):y.create(R)}}class sA extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSingleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=B(e,t,r);if(n)return s;const[u,c,l]=a,f=+u.getValue(),m=Math.floor(+c.getValue()),d=Math.floor(+l.getValue());if(f<0||f>1||m<1||m>10**10||d<1||d>10**10)return g.create(h.NUM);const C=wo(f,m,d);return Number.isNaN(C)||!Number.isFinite(C)?g.create(h.NUM):y.create(C)}}class aA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.mapValue(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=B(e);if(t)return r;const[s]=n,a=s.getValue();if(a<=-1||a>=1)return g.create(h.NUM);const u=Math.log((1+a)/(1-a))/2;return y.create(u)}}class iA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.mapValue(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=B(e);if(t)return r;const[s]=n,a=+s.getValue(),u=Math.exp(2*a)-1,c=Math.exp(2*a)+1;return!Number.isFinite(u)&&u>0&&!Number.isFinite(c)&&c>0?y.create(1):y.create(u/c)}}class Xu extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1,a=r.isArray()?r.getRowCount():1,u=r.isArray()?r.getColumnCount():1;let c=t;t.isArray()&&n===1&&s===1&&(c=t.get(0,0));let l=r;return r.isArray()&&a===1&&u===1&&(l=r.get(0,0)),e.isArray()?e.mapValue(f=>this._handleSingleObject(f,c,l,n,s,a,u)):this._handleSingleObject(e,c,l,n,s,a,u)}_handleSingleObject(e,t,r,n,s,a,u){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;let c=e;if(e.isString()&&(c=e.convertToNumberObjectValue()),c.isError())return c;const l=+c.getValue();if((n*s===1||a*u===1)&&(t.isNull()||r.isNull()))return g.create(h.VALUE);if(n*s!==a*u)return g.create(h.NA);const{isError:f,errorObject:m,array1Values:d,array2Values:C,noCalculate:_}=Ze(t,r,n*s,s,u);if(f)return m;if(_)return g.create(h.DIV_BY_ZERO);const E=Lo(l,d,C);return Number.isFinite(E)?y.create(E):g.create(h.DIV_BY_ZERO)}}class oA extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,values:s}=this._getValues(e);if(r)return n;if(e.isNull()||t.isNull())return g.create(h.VALUE);let{values:a}=this._getValues(t,!0);a.length===0&&(a=[0]);const u=this._getNewBinsArrayValues(a),c=new Array(u.length).fill(0);for(let l=0;l<s.length;l++){const f=s[l],m=u.findIndex(d=>f>d.start&&f<=d.end);c[m]++}return Z.createByArray(c.map(l=>[l]))}_getValues(e,t=!1){const r=[],n=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1;for(let a=0;a<n;a++)for(let u=0;u<s;u++){const c=e.isArray()?e.get(a,u):e;if(c.isError()){if(!t)return{isError:!0,errorObject:c,values:r};continue}if(c.isNull()||c.isBoolean())continue;const l=c.getValue();M.isRealNum(l)&&r.push(+l)}return{isError:!1,errorObject:null,values:r}}_getNewBinsArrayValues(e){const t=e.map((n,s)=>({value:n,index:s})).sort((n,s)=>n.value-s.value),r=[];for(let n=0;n<t.length;n++){const s=t[n].index;if(n===0){r[s]={start:-1/0,end:t[n].value};continue}r[s]={start:t[n-1].value,end:t[n].value}}return r.push({start:t[t.length-1].value,end:1/0}),r}}class uA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=B(e);if(t)return r;const[s]=n,a=+s.getValue();if(a===0||a<0&&a%1===0)return g.create(h.NUM);const u=Yn(a);return Number.isNaN(u)||!Number.isFinite(u)?g.create(h.NUM):y.create(u)}}class Ku extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=B(e);if(t)return r;const[s]=n,a=+s.getValue();if(a<=0)return g.create(h.NUM);const u=ut(a);return Math.abs(u)<1e-15?y.create(0):y.create(u)}}class cA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=B(e);if(t)return r;const[s]=n,a=+s.getValue(),u=Fr(a,0,1)-.5;return y.create(u)}}class lA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=1,r=0,n=!1;for(let a=0;a<e.length;a++){const u=e[a];if(u.isArray()){let c=!1,l=g.create(h.VALUE);if(u.iterator(f=>{if(f!=null&&f.isError())return c=!0,l=f,!1;if(f!=null&&f.isNull()||f!=null&&f.isBoolean())return!0;const m=f.getValue();if(!M.isRealNum(m))return!0;+m<=0&&(n=!0),t*=+m,r++}),c)return l}else{if(u.isError())return u;if(u.isString()){const l=u.convertToNumberObjectValue();if(l.isError())return l}if(u.isNull()||u.isBoolean())continue;const c=u.getValue();if(!M.isRealNum(c))continue;+c<=0&&(n=!0),t*=+c,r++}}if(r===0||n)return g.create(h.NUM);const s=t**(1/r);return y.create(s)}}class fA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",4)}calculate(e,t,r,n){const{isError:s,errorObject:a}=Wn(e,t,r);if(s)return a;const u=At(e);if(u instanceof g)return u;const c=this._getKnownXsValues(u,t);if(c instanceof g)return c;const l=this._getNewXsValues(c,r);if(l instanceof g)return l;let f=n!=null?n:F.create(!0);if(f.isArray()&&(f=f.get(0,0)),f.isString()&&(f=f.convertToNumberObjectValue()),f.isError())return f;const m=+f.getValue();return this._getResult(u,c,l,m)}_getResult(e,t,r,n){return e.length===1&&t.length>1||e[0].length===1&&t[0].length>1?e.length===1&&t.length>1&&(n?t.length+1:t.length)>e[0].length||e[0].length===1&&t[0].length>1&&(n?t[0].length+1:t[0].length)>e.length?g.create(h.NA):this._getResultByMultipleVariables(e,t,r,n):this._getResultBySimpleVariables(e,t,r,n)}_getResultByMultipleVariables(e,t,r,n){const s=e.length===1&&e[0].length>1,a=Xn(e,t,r,n,!0);if(a instanceof g)return a;const{coefficients:u,newX:c}=a,l=u[0].length,f=u[0][l-1];let m=[];for(let d=0;d<c.length;d++){m[d]=[];let C=f;for(let _=l-2;_>=0;_--)C*=u[0][l-2-_]**c[d][_];m[d].push(C)}return s&&(m=_t(m)),Z.createByArray(m)}_getResultBySimpleVariables(e,t,r,n){const s=e.flat(),a=t.flat(),{slope:u,intercept:c}=qn(a,s,n,!0),l=r.map(f=>f.map(m=>c*u**m));return Z.createByArray(l)}_getKnownXsValues(e,t){return!t||t.isNull()?Qn(e.length,e[0].length):At(t)}_getNewXsValues(e,t){return!t||t.isNull()?e:At(t)}}class mA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=0,r=0,n=!1;for(let a=0;a<e.length;a++){const u=e[a];if(u.isArray()){let c=!1,l=g.create(h.VALUE);if(u.iterator(f=>{if(f!=null&&f.isError())return c=!0,l=f,!1;if(f!=null&&f.isNull()||f!=null&&f.isBoolean())return!0;const m=f.getValue();if(!M.isRealNum(m))return!0;+m<=0&&(n=!0),t+=1/+m,r++}),c)return l}else{if(u.isError())return u;if(u.isString()){const l=u.convertToNumberObjectValue();if(l.isError())return l}if(u.isNull()||u.isBoolean())continue;const c=u.getValue();if(!M.isRealNum(c))continue;+c<=0&&(n=!0),t+=1/+c,r++}}if(r===0)return g.create(h.NA);if(n)return g.create(h.NUM);const s=r/t;return y.create(s)}}class hA extends p{constructor(){super(...arguments);A(this,"minParams",5);A(this,"maxParams",5)}calculate(e,t,r,n,s){const a=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1),c=O(a,u,e,g.create(h.NA)),l=O(a,u,t,g.create(h.NA)),f=O(a,u,r,g.create(h.NA)),m=O(a,u,n,g.create(h.NA)),d=O(a,u,s,g.create(h.NA)),C=c.mapValue((_,E,R)=>{const b=l.get(E,R),N=f.get(E,R),V=m.get(E,R),S=d.get(E,R);return _.isError()?_:b.isError()?b:N.isError()?N:V.isError()?V:S.isError()?S:this._handleSingleObject(_,b,N,V,S)});return a===1&&u===1?C.get(0,0):C}_handleSingleObject(e,t,r,n,s){const{isError:a,errorObject:u,variants:c}=B(e,t,r,n,s);if(a)return u;const[l,f,m,d,C]=c,_=Math.floor(+l.getValue()),E=Math.floor(+f.getValue()),R=Math.floor(+m.getValue()),b=Math.floor(+d.getValue()),N=+C.getValue();if(_<0||_>E||_>R||_<E-b+R||E<=0||E>b||R<=0||R>b||b<=0)return g.create(h.NUM);let V;return N?V=fh(_,E,R,b):V=Va(_,E,R,b),Number.isNaN(V)&&(V=0),y.create(V)}}class gA extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1;let u=e;if(e.isArray()&&r===1&&n===1&&(u=e.get(0,0)),u.isError())return u;let c=t;if(t.isArray()&&s===1&&a===1&&(c=t.get(0,0)),c.isError())return c;if(r*n===1||s*a===1)return u.isNull()||c.isNull()?g.create(h.VALUE):g.create(h.DIV_BY_ZERO);if(r*n!==s*a)return g.create(h.NA);const{isError:l,errorObject:f,array1Values:m,array2Values:d,noCalculate:C}=Ze(e,t,r*n,n,a);return l?f:C?g.create(h.DIV_BY_ZERO):this._getResult(m,d)}_getResult(e,t){const r=Lo(0,e,t);return Number.isFinite(r)?y.create(r):g.create(h.DIV_BY_ZERO)}}class dA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=[];let r=0;for(let n=0;n<e.length;n++){const s=e[n];if(s.isError())return s;if(s.isString()){const c=s.convertToNumberObjectValue();if(c.isError())return c}const a=s.isArray()?s.getRowCount():1,u=s.isArray()?s.getColumnCount():1;for(let c=0;c<a;c++)for(let l=0;l<u;l++){const f=s.isArray()?s.get(c,l):s;if(f.isError())return f;if(f.isNull()||f.isBoolean())continue;const m=f.getValue();M.isRealNum(m)&&(t.push(+m),r+=+m)}}return t.length<=3?g.create(h.DIV_BY_ZERO):this._getResult(t,r)}_getResult(e,t){const r=e.length,n=t/r;let s=0;for(let l=0;l<r;l++)s+=(e[l]-n)**2;const a=Math.sqrt(s/(r-1));if(a===0)return g.create(h.DIV_BY_ZERO);let u=0;for(let l=0;l<r;l++)u+=((e[l]-n)/a)**4;const c=r*(r+1)/((r-1)*(r-2)*(r-3))*u-3*(r-1)**2/((r-2)*(r-3));return y.create(c)}}class CA extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=zt(e);if(t.isArray()){const n=t.mapValue(s=>this._handleSingleObject(r,s));return n.getRowCount()===1&&n.getColumnCount()===1?n.get(0,0):n}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(!Array.isArray(e))return e;const{isError:r,errorObject:n,variants:s}=B(t);if(r)return n;const[a]=s,u=+a.getValue();return $o(e,u)}}class _A extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",4)}calculate(e,t,r,n){const{isError:s,errorObject:a}=Wn(e,t);if(s)return a;const u=At(e);if(u instanceof g)return u;const c=this._getKnownXsValues(u,t);if(c instanceof g)return c;let l=r!=null?r:F.create(!0);l.isArray()&&(l=l.get(0,0));let f=n!=null?n:F.create(!1);f.isArray()&&(f=f.get(0,0));const{isError:m,errorObject:d,variants:C}=B(l,f);if(m)return d;const[_,E]=C;return this._getResult(u,c,+_.getValue(),+E.getValue())}_getResult(e,t,r,n){return e.length===1&&t.length>1||e[0].length===1&&t[0].length>1?e.length===1&&t.length>1&&(r?t.length+1:t.length)>e[0].length||e[0].length===1&&t[0].length>1&&(r?t[0].length+1:t[0].length)>e.length?g.create(h.NA):this._getResultByMultipleVariables(e,t,r,n):this._getResultBySimpleVariables(e,t,r,n)}_getResultByMultipleVariables(e,t,r,n){const s=Xn(e,t,t,r,!1);if(s instanceof g)return s;const{coefficients:a,X:u,XTXInverse:c}=s;let l=[];if(n){const f=e.flat(),m=f.length,d=r?f.reduce((v,Y)=>v+Y,0)/m:0,C=c.length,_=m-C,E=a[0].length,R=new Array(E-2).fill(h.NA),b=a[0][E-1],N=[];for(let v=0;v<u.length;v++){let Y=b;for(let Q=E-2;Q>=0;Q--)Y+=a[0][E-2-Q]*u[v][Q];N.push(Y)}let V=0,S=0;for(let v=0;v<m;v++)V+=(f[v]-d)**2,S+=(f[v]-N[v])**2;const D=V-S,L=V===0?0:D/V,P=[];for(let v=C-1;v>=0;v--){const Y=_>0?Math.sqrt(S/_*c[v][v]):0;P.push(Y)}if(r){const v=P.shift();P.push(v)}else P.push(h.NA);const j=_>0?Math.sqrt(S/_):0,I=_>0?D/(E-1)/(S/_):h.NUM;l=[a[0],[...P],[L,j,...R],[I,_,...R],[D,S,...R]]}else l=[a[0]];return Z.createByArray(l)}_getResultBySimpleVariables(e,t,r,n){const s=e.flat(),a=t.flat(),{slope:u,intercept:c}=qn(a,s,r,!1);if(Number.isNaN(u))return g.create(h.NA);let l=[];if(n){const f=s.length;let m=0,d=0,C=f-1;if(r){let P=0,j=0;for(let I=0;I<f;I++)P+=s[I],j+=a[I];m=P/f,d=j/f,C=f-2}let _=0,E=0,R=0;for(let P=0;P<f;P++)_+=(s[P]-m)**2,E+=(s[P]-(u*a[P]+c))**2,R+=(a[P]-d)**2;const b=_-E,N=b===_?1:b/_;let V=0,S=0,D=0;C>0&&(R>0&&(V=Math.sqrt(E/C/R),S=Math.sqrt(E/C*(1/f+d**2/R))),D=Math.sqrt(E/C));const L=C>0?b/1/(E/C):h.NUM;r||(S=h.NA),l=[[u,c],[V,S],[N,D],[L,C],[b,E]]}else l=[[u,c]];return Z.createByArray(l)}_getKnownXsValues(e,t){return!t||t.isNull()?Qn(e.length,e[0].length):At(t)}}class AA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",4)}calculate(e,t,r,n){const{isError:s,errorObject:a}=Wn(e,t);if(s)return a;const u=At(e);if(u instanceof g)return u;const c=this._getKnownXsValues(u,t);if(c instanceof g)return c;let l=r!=null?r:F.create(!0);l.isArray()&&(l=l.get(0,0));let f=n!=null?n:F.create(!1);f.isArray()&&(f=f.get(0,0));const{isError:m,errorObject:d,variants:C}=B(l,f);if(m)return d;const[_,E]=C;return this._getResult(u,c,+_.getValue(),+E.getValue())}_getResult(e,t,r,n){return e.length===1&&t.length>1||e[0].length===1&&t[0].length>1?e.length===1&&t.length>1&&(r?t.length+1:t.length)>e[0].length||e[0].length===1&&t[0].length>1&&(r?t[0].length+1:t[0].length)>e.length?g.create(h.NA):this._getResultByMultipleVariables(e,t,r,n):this._getResultBySimpleVariables(e,t,r,n)}_getResultByMultipleVariables(e,t,r,n){const s=Xn(e,t,t,r,!0);if(s instanceof g)return s;const{coefficients:a,Y:u,X:c,XTXInverse:l}=s;let f=[];if(n){const m=u.flat(),d=m.length,C=r?m.reduce((Y,Q)=>Y+Q,0)/d:0,_=l.length,E=d-_,R=a[0].length,b=new Array(R-2).fill(h.NA),N=a[0][R-1],V=[];for(let Y=0;Y<c.length;Y++){let Q=N;for(let se=R-2;se>=0;se--)Q*=a[0][R-2-se]**c[Y][se];V.push(Math.log(Q))}let S=0,D=0;for(let Y=0;Y<d;Y++)S+=(m[Y]-C)**2,!(!r&&!Number.isFinite(V[Y]))&&(D+=(m[Y]-V[Y])**2);Number.isFinite(D)||(D=0);const L=S-D,P=S===0?0:L/S,j=[];for(let Y=_-1;Y>=0;Y--){const Q=E>0?Math.sqrt(D/E*l[Y][Y]):0;j.push(Q)}if(r){const Y=j.shift();j.push(Y)}else j.push(h.NA);const I=E>0?Math.sqrt(D/E):0,v=E>0?L/(R-1)/(D/E):h.NUM;f=[a[0],[...j],[P,I,...b],[v,E,...b],[L,D,...b]]}else f=[a[0]];return Z.createByArray(f)}_getResultBySimpleVariables(e,t,r,n){const s=e.flat(),a=t.flat(),{slope:u,intercept:c,Y:l}=qn(a,s,r,!0);if(Number.isNaN(u))return g.create(h.NA);let f=[];if(n){const m=l.length;let d=0,C=0,_=m-1;if(r){let j=0,I=0;for(let v=0;v<m;v++)j+=l[v],I+=a[v];d=j/m,C=I/m,_=m-2}let E=0,R=0,b=0;for(let j=0;j<m;j++)E+=(l[j]-d)**2,R+=(l[j]-Math.log(c*u**a[j]))**2,b+=(a[j]-C)**2;const N=E-R,V=E===0?0:N/E;let S=0,D=0,L=0,P=0;_>0&&(b>0&&(S=Math.sqrt(R/_/b),D=Math.sqrt(R/_*(1/m+C**2/b))),L=Math.sqrt(R/_),P=N/1/(R/_)),r||(D=h.NA),f=[[u,c],[S,D],[V,L],[P,_],[N,R]]}else f=[[u,c]];return Z.createByArray(f)}_getKnownXsValues(e,t){return!t||t.isNull()?Qn(e.length,e[0].length):At(t)}}class EA extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA)),f=O(s,a,n,g.create(h.NA)),m=u.mapValue((d,C,_)=>{const E=c.get(C,_),R=l.get(C,_),b=f.get(C,_);return d.isError()?d:E.isError()?E:R.isError()?R:b.isError()?b:this._handleSingleObject(d,E,R,b)});return s===1&&a===1?m.get(0,0):m}_handleSingleObject(e,t,r,n){const{isError:s,errorObject:a,variants:u}=B(e,t,r,n);if(s)return a;const[c,l,f,m]=u,d=+c.getValue(),C=+l.getValue(),_=+f.getValue(),E=+m.getValue();if(d<=0||_<=0)return g.create(h.NUM);let R;return E?R=jo(d,C,_):R=mh(d,C,_),y.create(R)}}class RA extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=this._getRangeValues(e);if(r instanceof g)return r;const n=Xt(t);if(n.isError())return n;const{isError:s,errorObject:a,variants:u}=B(n);if(s)return a;const[c]=u,l=+c.getValue();if(l<=0||l>=1)return g.create(h.NUM);if(r.length<2)return g.create(h.DIV_BY_ZERO);const f=1-l,m=r.length,d=r.reduce((R,b)=>R+b,0)/m,C=r.reduce((R,b)=>R+(b-d)**2,0)/(m-1),_=Math.sqrt(C);if(_<=0)return g.create(h.NUM);const E=Math.abs(Gn(f/2,m-1)*_/Math.sqrt(m));return y.create(E)}_getRangeValues(e){const t=[],r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1;for(let s=0;s<r;s++)for(let a=0;a<n;a++){const u=e.isArray()?e.get(s,a):e;if(u.isError())return u;u.isNull()||u.isBoolean()||u.isString()||t.push(+u.getValue())}return t}}class bA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=y.create(Number.NEGATIVE_INFINITY);for(let r=0;r<e.length;r++){let n=e[r];if(!n.isNull()){if((n.isString()||n.isBoolean())&&(n=n.convertToNumberObjectValue()),n.isArray()&&(n=n.max()),n.isError())return n;t=this._validator(t,n)}}return t.getValue()===Number.NEGATIVE_INFINITY?y.create(0):t}_validator(e,t){const r=e.isLessThan(t);let n=e;return r.getValue()&&(n=t),n}}class yA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=y.create(Number.NEGATIVE_INFINITY);for(let r=0;r<e.length;r++){let n=e[r];if(!n.isNull()){if((n.isString()||n.isBoolean())&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(n.isArray()&&n.iterator(s=>{let a=s;if((a==null||a.isNull()||a.isString())&&(a=y.create(0)),a.isBoolean()&&(a=a.convertToNumberObjectValue()),a.isError())return t=a,!1;t=this._validator(t,a)}),t.isError())return t;t=this._validator(t,n)}}return t.getValue()===Number.NEGATIVE_INFINITY?y.create(0):t}_validator(e,t){const r=e.isLessThan(t);let n=e;return r.getValue()&&(n=t),n}}class NA extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",255);A(this,"needsReferenceObject",!0)}calculate(e,...t){const{isError:r,errorObject:n,rangeIsDifferentSize:s,criteriaMaxRowLength:a,criteriaMaxColumnLength:u,targetRange:c,variants:l}=jr(t,e);if(r)return n;if(s)return a===1&&u===1?g.create(h.VALUE):O(a,u,g.create(h.VALUE));const f=xr(l,a,u,!0);return this._aggregateResults(c,f)}_aggregateResults(e,t){const r=t.map(n=>n.map(s=>{const a=e.pick(s);return a.getColumnCount()===0?Z.create("0"):a.max()}));return r.length===1&&r[0].length===1?r[0][0]:Z.create({calculateValueList:r,rowCount:r.length,columnCount:r[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column})}}class pA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=[];for(let r=0;r<e.length;r++){const n=e[r];if(n.isArray()){let s=!1,a=g.create(h.VALUE);if(n.iterator(u=>{if(u!=null&&u.isError())return s=!0,a=u,!1;if(u!=null&&u.isNull()||u!=null&&u.isBoolean())return!0;const c=u.getValue();if(!M.isRealNum(c))return!0;t.push(+c)}),s)return a}else{if(n.isError())return n;if(n.isNull()||n.isBoolean())continue;if(n.isString()){const a=n.convertToNumberObjectValue();if(a.isError())return a}const s=n.getValue();if(!M.isRealNum(s))continue;t.push(+s)}}return t.length===0?g.create(h.NUM):ko(t)}}class VA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=y.create(Number.POSITIVE_INFINITY);for(let r=0;r<e.length;r++){let n=e[r];if(!n.isNull()){if((n.isString()||n.isBoolean())&&(n=n.convertToNumberObjectValue()),n.isArray()&&(n=n.min()),n.isError())return n;t=this._validator(t,n)}}return t.getValue()===Number.POSITIVE_INFINITY?y.create(0):t}_validator(e,t){const r=e.isGreaterThan(t);let n=e;return r.getValue()&&(n=t),n}}class OA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=y.create(Number.POSITIVE_INFINITY);for(let r=0;r<e.length;r++){let n=e[r];if(!n.isNull()){if((n.isString()||n.isBoolean())&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(n.isArray()&&n.iterator(s=>{let a=s;if((a==null||a.isNull()||a.isString())&&(a=y.create(0)),a.isBoolean()&&(a=a.convertToNumberObjectValue()),a.isError())return t=a,!1;t=this._validator(t,a)}),t.isError())return t;t=this._validator(t,n)}}return t.getValue()===Number.POSITIVE_INFINITY?y.create(0):t}_validator(e,t){const r=e.isGreaterThan(t);let n=e;return r.getValue()&&(n=t),n}}class SA extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",255);A(this,"needsReferenceObject",!0)}calculate(e,...t){const{isError:r,errorObject:n,rangeIsDifferentSize:s,criteriaMaxRowLength:a,criteriaMaxColumnLength:u,targetRange:c,variants:l}=jr(t,e);if(r)return n;if(s)return a===1&&u===1?g.create(h.VALUE):O(a,u,g.create(h.VALUE));const f=xr(l,a,u,!0);return this._aggregateResults(c,f)}_aggregateResults(e,t){const r=t.map(n=>n.map(s=>{const a=e.pick(s);return a.getColumnCount()===0?Z.create("0"):a.min()}));return r.length===1&&r[0].length===1?r[0][0]:Z.create({calculateValueList:r,rowCount:r.length,columnCount:r[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column})}}class MA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t={};let r=0,n=1;for(let s=0;s<e.length;s++){const a=e[s];if(a.isError())return a;if(a.isString()){const l=a.convertToNumberObjectValue();if(l.isError())return l}const u=a.isArray()?a.getRowCount():1,c=a.isArray()?a.getColumnCount():1;for(let l=0;l<u;l++)for(let f=0;f<c;f++){const m=a.isArray()?a.get(l,f):a;if(m.isError())return m;if(m.isNull()||m.isBoolean()||m.isString())continue;const d=m.getValue();M.isRealNum(d)&&(t[+d]?(t[+d].count++,t[+d].count>n&&(n=t[+d].count)):t[+d]={count:1,order:r++})}}return r===0||n===1?new g(h.NA):this._getResult(t,n)}_getResult(e,t){const r=Object.entries(e).filter(([n,{count:s}])=>s===t).sort((n,s)=>n[1].order-s[1].order).map(([n])=>+n);return r.length===1?y.create(r[0]):Z.createByArray(r.map(n=>[n]))}}class DA extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA)),f=O(s,a,n,g.create(h.NA)),m=u.mapValue((d,C,_)=>{const E=c.get(C,_),R=l.get(C,_),b=f.get(C,_);return d.isError()?d:E.isError()?E:R.isError()?R:b.isError()?b:this._handleSingleObject(d,E,R,b)});return s===1&&a===1?m.get(0,0):m}_handleSingleObject(e,t,r,n){const{isError:s,errorObject:a,variants:u}=B(e,t,r,n);if(s)return a;const[c,l,f,m]=u,d=Math.floor(+c.getValue()),C=Math.floor(+l.getValue()),_=+f.getValue(),E=+m.getValue();if(d<0||C<1||_<=0||_>=1)return g.create(h.NUM);let R;return E?R=gh(d,C,_):R=Oa(d,C,_),y.create(R)}}class wA extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.mapValue((c,l,f)=>{const m=a.get(l,f);return c.isError()?c:m.isError()?m:this._handleSingleObject(c,m)});return r===1&&n===1?u.get(0,0):u}_handleSingleObject(e,t){const{isError:r,errorObject:n,variants:s}=B(e,t);if(r)return n;const[a,u]=s,c=+a.getValue(),l=+u.getValue();let f;return l?f=Fr(c,0,1):f=xo(c,0,1),y.create(f)}}class LA extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1;let u=e;if(e.isArray()&&r===1&&n===1&&(u=e.get(0,0)),u.isError())return u;let c=t;if(t.isArray()&&s===1&&a===1&&(c=t.get(0,0)),c.isError())return c;if(r*n===1||s*a===1)return u.isNull()||c.isNull()?g.create(h.VALUE):g.create(h.DIV_BY_ZERO);if(r*n!==s*a)return g.create(h.NA);const{isError:l,errorObject:f,array1Values:m,array2Values:d,noCalculate:C}=Ze(e,t,r*n,n,a);return l?f:C?g.create(h.DIV_BY_ZERO):this._getResult(m,d)}_getResult(e,t){const r=e.length;let n=0,s=0;for(let d=0;d<r;d++)n+=e[d],s+=t[d];const a=n/r,u=s/r;let c=0,l=0,f=0;for(let d=0;d<r;d++)c+=(e[d]-a)*(t[d]-u),l+=(e[d]-a)**2,f+=(t[d]-u)**2;if(l===0||f===0)return g.create(h.DIV_BY_ZERO);const m=c/Math.sqrt(l*f);return y.create(m)}}class PA extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=zt(e);if(t.isArray()){const n=t.mapValue(s=>this._handleSingleObject(r,s));return n.getRowCount()===1&&n.getColumnCount()===1?n.get(0,0):n}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(!Array.isArray(e))return e;const{isError:r,errorObject:n,variants:s}=B(t);if(r)return n;const[a]=s,u=+a.getValue();return Go(e,u)}}class jA extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){const n=this._getValues(e);let s=r!=null?r:y.create(3);s.isNull()&&(s=y.create(3));const a=Math.max(t.isArray()?t.getRowCount():1,s.isArray()?s.getRowCount():1),u=Math.max(t.isArray()?t.getColumnCount():1,s.isArray()?s.getColumnCount():1),c=O(a,u,t,g.create(h.NA)),l=O(a,u,s,g.create(h.NA)),f=c.mapValue((m,d,C)=>{const _=l.get(d,C);return m.isError()?m:_.isError()?_:this._handleSingleObject(n,m,_)});return a===1&&u===1?f.get(0,0):f}_handleSingleObject(e,t,r){if(e instanceof g)return e;const{isError:n,errorObject:s,variants:a}=B(t,r);if(n)return s;const[u,c]=a,l=+u.getValue(),f=Math.floor(+c.getValue()),m=e.length;if(m===0||l<e[0]||l>e[m-1])return g.create(h.NA);if(m===1)return l===e[0]?y.create(1):g.create(h.NA);let d=0,C=!1,_=0;for(;!C&&_<m;)l===e[_]?(d=(_+1)/(m+1),C=!0):l>e[_]&&_+1<m&&l<e[_+1]&&(d=(_+1+(l-e[_])/(e[_+1]-e[_]))/(m+1),C=!0),_++;return C?f<1?g.create(h.NUM):(d=Qe(d,f),y.create(d)):g.create(h.NA)}_getValues(e){const t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let s=0;s<t;s++)for(let a=0;a<r;a++){const u=e.isArray()?e.get(s,a):e;if(u.isError())return u;if(u.isNull()||u.isBoolean())continue;const c=u.getValue();M.isRealNum(c)&&n.push(+c)}return n.sort((s,a)=>s-a)}}class xA extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.mapValue((c,l,f)=>{const m=a.get(l,f);if(c.isError())return c;if(m.isError())return m;const{isError:d,errorObject:C,variants:_}=B(c,m);if(d)return C;const[E,R]=_,b=Math.floor(+E.getValue()),N=Math.floor(+R.getValue());if(b<0||b>=2147483647||N<0||b<N)return g.create(h.NUM);let V=1;for(let S=b-N+1;S<=b;S++)V*=S;return Number.isFinite(V)?y.create(V):g.create(h.NUM)});return r===1&&n===1?u.get(0,0):u}}class UA extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.mapValue((c,l,f)=>{const m=a.get(l,f);if(c.isError())return c;if(m.isError())return m;const{isError:d,errorObject:C,variants:_}=B(c,m);if(d)return C;const[E,R]=_,b=Math.floor(+E.getValue()),N=Math.floor(+R.getValue());if(b<0||b>=2147483647||N<0)return g.create(h.NUM);if(b===0)return N===0?y.create(1):y.create(0);const V=b**N;return Number.isFinite(V)?y.create(V):g.create(h.NUM)});return r===1&&n===1?u.get(0,0):u}}class TA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=B(e);if(t)return r;const[s]=n,a=+s.getValue(),u=Math.exp(-.5*a*a)/Math.sqrt(2*Math.PI);return y.create(u)}}class vA extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",4)}calculate(e,t,r,n){const{isError:s,errorObject:a,xRangeValues:u,probRangeValues:c}=this._handleXRangeAndProbRange(e,t);let l=n!=null?n:r;n!=null&&n.isNull()&&(l=r);const f=Math.max(r.isArray()?r.getRowCount():1,l.isArray()?l.getRowCount():1),m=Math.max(r.isArray()?r.getColumnCount():1,l.isArray()?l.getColumnCount():1),d=O(f,m,r,g.create(h.NA)),C=O(f,m,l,g.create(h.NA)),_=d.mapValue((E,R,b)=>{const N=C.get(R,b);return e.isError()?e:t.isError()?t:E.isError()?E:N.isError()?N:s?a:this._handleSingleObject(u,c,E,N)});return f===1&&m===1?_.get(0,0):_}_handleSingleObject(e,t,r,n){const{isError:s,errorObject:a,variants:u}=B(r,n);if(s)return a;const[c,l]=u,f=+c.getValue(),m=+l.getValue();if(t.reduce((C,_)=>C+_,0)!==1)return g.create(h.NUM);let d=0;for(let C=0;C<e.length;C++)e[C]>=f&&e[C]<=m&&(d+=t[C]);return y.create(d)}_handleXRangeAndProbRange(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1;let u=e;if(e.isArray()&&r===1&&n===1&&(u=e.get(0,0)),u.isError())return{isError:!0,errorObject:u,xRangeValues:[],probRangeValues:[]};let c=t;if(t.isArray()&&s===1&&a===1&&(c=t.get(0,0)),c.isError())return{isError:!0,errorObject:c,xRangeValues:[],probRangeValues:[]};if((r*n===1||s*a===1)&&(u.isNull()||c.isNull()))return{isError:!0,errorObject:g.create(h.VALUE),xRangeValues:[],probRangeValues:[]};if(r*n!==s*a)return{isError:!0,errorObject:g.create(h.NA),xRangeValues:[],probRangeValues:[]};const{isError:l,errorObject:f,array1Values:m,array2Values:d,noCalculate:C}=Ze(e,t,r*n,n,a);return l?{isError:!0,errorObject:f,xRangeValues:[],probRangeValues:[]}:C?{isError:!0,errorObject:g.create(h.DIV_BY_ZERO),xRangeValues:[],probRangeValues:[]}:{isError:!1,errorObject:null,xRangeValues:m,probRangeValues:d}}}class IA extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=zt(e);if(t.isArray()){const n=t.mapValue(s=>this._handleSingleObject(r,s));return n.getRowCount()===1&&n.getColumnCount()===1?n.get(0,0):n}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(!Array.isArray(e))return e;const{isError:r,errorObject:n,variants:s}=B(t);if(r)return n;const[a]=s,u=Math.floor(+a.getValue());return Qo(e,u)}}class FA extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3);A(this,"needsReferenceObject",!0)}calculate(e,t,r){let n=e;n.isReferenceObject()&&(n=n.toArrayValueObject());const{refHasError:s,refErrorObject:a,refNumbers:u}=this._checkRefReferenceObject(t);let c=r!=null?r:y.create(0);c.isReferenceObject()&&(c=c.toArrayValueObject());const l=Math.max(n.isArray()?n.getRowCount():1,c.isArray()?c.getRowCount():1),f=Math.max(n.isArray()?n.getColumnCount():1,c.isArray()?c.getColumnCount():1),m=O(l,f,n,g.create(h.NA)),d=O(l,f,c,g.create(h.NA)),C=m.map((_,E,R)=>{const b=d.get(E,R);if(!e.isReferenceObject()&&e.isNull())return g.create(h.NA);if(s)return a;if(b.isError())return b;const N=+_.getValue(),V=+b.getValue();return Number.isNaN(N)||Number.isNaN(V)?g.create(h.VALUE):this._getResult(N,V,u)});return l===1&&f===1?C.get(0,0):C}_getResult(e,t,r){const n=r.sort((c,l)=>t?c-l:l-c);let s=n.indexOf(e);const a=[];for(;s>=0;){const c=s+1;a.push(c),s=n.indexOf(e,c)}if(a.length===0)return g.create(h.NA);const u=a.reduce((c,l)=>c+l,0)/a.length;return y.create(u)}_checkRefReferenceObject(e){let t=!1,r=g.create(h.NA);const n=[];return e.isReferenceObject()?(e.toArrayValueObject().iterator(a=>{const u=a;if(u.isError())return t=!0,r=u,!1;if(u.isNull()||u.isBoolean())return!0;const c=+u.getValue();if(Number.isNaN(c))return!0;n.push(c)}),{refHasError:t,refErrorObject:r,refNumbers:n}):{refHasError:!0,refErrorObject:r,refNumbers:n}}}class BA extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3);A(this,"needsReferenceObject",!0)}calculate(e,t,r){let n=e;n.isReferenceObject()&&(n=n.toArrayValueObject());const{refHasError:s,refErrorObject:a,refNumbers:u}=this._checkRefReferenceObject(t);let c=r!=null?r:y.create(0);c.isReferenceObject()&&(c=c.toArrayValueObject());const l=Math.max(n.isArray()?n.getRowCount():1,c.isArray()?c.getRowCount():1),f=Math.max(n.isArray()?n.getColumnCount():1,c.isArray()?c.getColumnCount():1),m=O(l,f,n,g.create(h.NA)),d=O(l,f,c,g.create(h.NA)),C=m.map((_,E,R)=>{const b=d.get(E,R);if(!e.isReferenceObject()&&e.isNull())return g.create(h.NA);if(s)return a;if(b.isError())return b;const N=+_.getValue(),V=+b.getValue();if(Number.isNaN(N)||Number.isNaN(V))return g.create(h.VALUE);const D=u.sort((L,P)=>V?L-P:P-L).indexOf(N);return D===-1?g.create(h.NA):y.create(D+1)});return l===1&&f===1?C.get(0,0):C}_checkRefReferenceObject(e){let t=!1,r=g.create(h.NA);const n=[];return e.isReferenceObject()?(e.toArrayValueObject().iterator(a=>{const u=a;if(u.isError())return t=!0,r=u,!1;if(u.isNull()||u.isBoolean())return!0;const c=+u.getValue();if(Number.isNaN(c))return!0;n.push(c)}),{refHasError:t,refErrorObject:r,refNumbers:n}):{refHasError:!0,refErrorObject:r,refNumbers:n}}}class kA extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1;let u=e;if(e.isArray()&&r===1&&n===1&&(u=e.get(0,0)),u.isError())return u;let c=t;if(t.isArray()&&s===1&&a===1&&(c=t.get(0,0)),c.isError())return c;if((r*n===1||s*a===1)&&(u.isNull()||c.isNull()))return g.create(h.VALUE);if(r*n!==s*a)return g.create(h.NA);const{isError:l,errorObject:f,array1Values:m,array2Values:d,noCalculate:C}=Ze(e,t,r*n,n,a);return l?f:C?g.create(h.DIV_BY_ZERO):this._getResult(m,d)}_getResult(e,t){if(e.length===0)return g.create(h.DIV_BY_ZERO);const r=e.length;let n=0,s=0;for(let d=0;d<r;d++)n+=e[d],s+=t[d];const a=n/r,u=s/r;let c=0,l=0,f=0;for(let d=0;d<r;d++)c+=(e[d]-a)*(t[d]-u),l+=(e[d]-a)**2,f+=(t[d]-u)**2;if(l===0||f===0)return g.create(h.DIV_BY_ZERO);const m=(c/Math.sqrt(l*f))**2;return y.create(m)}}class $A extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=[];let r=0;for(let n=0;n<e.length;n++){const s=e[n];if(s.isError())return s;if(s.isString()){const c=s.convertToNumberObjectValue();if(c.isError())return c}const a=s.isArray()?s.getRowCount():1,u=s.isArray()?s.getColumnCount():1;for(let c=0;c<a;c++)for(let l=0;l<u;l++){const f=s.isArray()?s.get(c,l):s;if(f.isError())return f;if(f.isNull()||f.isBoolean())continue;const m=f.getValue();M.isRealNum(m)&&(t.push(+m),r+=+m)}}return t.length<=2?g.create(h.DIV_BY_ZERO):this._getResult(t,r)}_getResult(e,t){const r=e.length,n=t/r;let s=0;for(let l=0;l<r;l++)s+=(e[l]-n)**2;const a=Math.sqrt(s/(r-1));if(a===0)return g.create(h.DIV_BY_ZERO);let u=0;for(let l=0;l<r;l++)u+=((e[l]-n)/a)**3;const c=r/((r-1)*(r-2))*u;return y.create(c)}}class YA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=[];let r=0;for(let n=0;n<e.length;n++){const s=e[n];if(s.isError())return s;if(s.isString()){const c=s.convertToNumberObjectValue();if(c.isError())return c}const a=s.isArray()?s.getRowCount():1,u=s.isArray()?s.getColumnCount():1;for(let c=0;c<a;c++)for(let l=0;l<u;l++){const f=s.isArray()?s.get(c,l):s;if(f.isError())return f;if(f.isNull()||f.isBoolean())continue;const m=f.getValue();M.isRealNum(m)&&(t.push(+m),r+=+m)}}return t.length<=2?g.create(h.DIV_BY_ZERO):this._getResult(t,r)}_getResult(e,t){const r=e.length,n=t/r;let s=0;for(let l=0;l<r;l++)s+=(e[l]-n)**2;const a=Math.sqrt(s/r);if(a===0)return g.create(h.DIV_BY_ZERO);let u=0;for(let l=0;l<r;l++)u+=((e[l]-n)/a)**3;const c=u/r;return y.create(c)}}class HA extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1;let u=e;if(e.isArray()&&r===1&&n===1&&(u=e.get(0,0)),u.isError())return u;let c=t;if(t.isArray()&&s===1&&a===1&&(c=t.get(0,0)),c.isError())return c;if(r*n===1||s*a===1)return u.isNull()||c.isNull()?g.create(h.VALUE):g.create(h.DIV_BY_ZERO);if(r*n!==s*a)return g.create(h.NA);const{isError:l,errorObject:f,array1Values:m,array2Values:d,noCalculate:C}=Ze(e,t,r*n,n,a);return l?f:C?g.create(h.DIV_BY_ZERO):this._getResult(m,d)}_getResult(e,t){const r=e.length;let n=0,s=0;for(let m=0;m<r;m++)n+=e[m],s+=t[m];const a=n/r,u=s/r;let c=0,l=0;for(let m=0;m<r;m++)c+=(e[m]-a)*(t[m]-u),l+=(t[m]-u)**2;if(l===0)return g.create(h.DIV_BY_ZERO);const f=c/l;return y.create(f)}}class GA extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=zt(e);if(t.isArray()){const n=t.mapValue(s=>this._handleSingleObject(r,s));return n.getRowCount()===1&&n.getColumnCount()===1?n.get(0,0):n}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(!Array.isArray(e))return e;const{isError:r,errorObject:n,variants:s}=B(t);if(r)return n;const[a]=s,u=+a.getValue();return Yo(e,u)}}class WA extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSingleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=B(e,t,r);if(n)return s;const[u,c,l]=a,f=+u.getValue(),m=+c.getValue(),d=+l.getValue();if(d<=0)return g.create(h.NUM);const C=(f-m)/d;return y.create(C)}}class QA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=this.flattenArray(e,!1);return t.isError()?t:t.std(1)}}class qA extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=this.flattenArray(e,!1);return t.isError()?t:t.std()}}class XA extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1;let u=e;if(e.isArray()&&r===1&&n===1&&(u=e.get(0,0)),u.isError())return u;let c=t;if(t.isArray()&&s===1&&a===1&&(c=t.get(0,0)),c.isError())return c;if((r*n===1||s*a===1)&&(u.isNull()||c.isNull()))return g.create(h.VALUE);if(r*n!==s*a)return g.create(h.NA);const{isError:l,errorObject:f,array1Values:m,array2Values:d,noCalculate:C}=Ze(e,t,r*n,n,a);return l?f:C?g.create(h.DIV_BY_ZERO):this._getResult(m,d)}_getResult(e,t){const r=e.length;if(r<=2)return g.create(h.DIV_BY_ZERO);let n=0,s=0;for(let d=0;d<r;d++)n+=e[d],s+=t[d];const a=n/r,u=s/r;let c=0,l=0,f=0;for(let d=0;d<r;d++)c+=(e[d]-a)*(t[d]-u),l+=(e[d]-a)**2,f+=(t[d]-u)**2;if(f===0)return g.create(h.DIV_BY_ZERO);const m=Math.sqrt((l-c**2/f)/(r-2));return Number.isNaN(m)||!Number.isFinite(m)?g.create(h.NUM):y.create(m)}}class KA extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSingleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=B(e,t,r);if(n)return s;const[u,c,l]=a,f=+u.getValue(),m=Math.floor(+c.getValue()),d=+l.getValue();if(m<1)return g.create(h.NUM);let C;return d?C=Br(f,m):C=Ch(f,m),Number.isNaN(C)||!Number.isFinite(C)?g.create(h.NUM):y.create(C)}}class ZA extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.mapValue((c,l,f)=>{const m=a.get(l,f);return c.isError()?c:m.isError()?m:this._handleSingleObject(c,m)});return r===1&&n===1?u.get(0,0):u}_handleSingleObject(e,t){const{isError:r,errorObject:n,variants:s}=B(e,t);if(r)return n;const[a,u]=s,c=+a.getValue(),l=Math.floor(+u.getValue());if(c<0||l<1||l>10**10)return g.create(h.NUM);const f=Br(-c,l)*2;return Number.isNaN(f)||!Number.isFinite(f)?g.create(h.NUM):y.create(f)}}class zA extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.mapValue((c,l,f)=>{const m=a.get(l,f);return c.isError()?c:m.isError()?m:this._handleSingleObject(c,m)});return r===1&&n===1?u.get(0,0):u}_handleSingleObject(e,t){const{isError:r,errorObject:n,variants:s}=B(e,t);if(r)return n;const[a,u]=s,c=+a.getValue(),l=Math.floor(+u.getValue());if(l<1||l>10**10)return g.create(h.NUM);const f=Br(-c,l);return Number.isNaN(f)||!Number.isFinite(f)?g.create(h.NUM):y.create(f)}}class JA extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.mapValue((c,l,f)=>{const m=a.get(l,f);return c.isError()?c:m.isError()?m:this._handleSingleObject(c,m)});return r===1&&n===1?u.get(0,0):u}_handleSingleObject(e,t){const{isError:r,errorObject:n,variants:s}=B(e,t);if(r)return n;const[a,u]=s,c=+a.getValue(),l=Math.floor(+u.getValue());if(c<=0||c>1||l<1||l>10**10)return g.create(h.NUM);const f=Gn(c,l);return Number.isNaN(f)||!Number.isFinite(f)?g.create(h.NUM):y.create(f)}}class eE extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",4)}calculate(e,t,r,n){const{isError:s,errorObject:a}=Wn(e,t,r);if(s)return a;const u=At(e);if(u instanceof g)return u;const c=this._getKnownXsValues(u,t);if(c instanceof g)return c;const l=this._getNewXsValues(c,r);if(l instanceof g)return l;let f=n!=null?n:F.create(!0);if(f.isArray()&&(f=f.get(0,0)),f.isString()&&(f=f.convertToNumberObjectValue()),f.isError())return f;const m=+f.getValue();return this._getResult(u,c,l,m)}_getResult(e,t,r,n){return e.length===1&&t.length>1||e[0].length===1&&t[0].length>1?e.length===1&&t.length>1&&(n?t.length+1:t.length)>e[0].length||e[0].length===1&&t[0].length>1&&(n?t[0].length+1:t[0].length)>e.length?g.create(h.NA):this._getResultByMultipleVariables(e,t,r,n):this._getResultBySimpleVariables(e,t,r,n)}_getResultByMultipleVariables(e,t,r,n){const s=e.length===1&&e[0].length>1,a=Xn(e,t,r,n,!1);if(a instanceof g)return a;const{coefficients:u,newX:c}=a,l=u[0].length,f=u[0][l-1];let m=[];for(let d=0;d<c.length;d++){m[d]=[];let C=f;for(let _=l-2;_>=0;_--)C+=u[0][l-2-_]*c[d][_];m[d].push(C)}return s&&(m=_t(m)),Z.createByArray(m)}_getResultBySimpleVariables(e,t,r,n){const s=e.flat(),a=t.flat(),{slope:u,intercept:c}=qn(a,s,n,!1);if(Number.isNaN(u))return g.create(h.NA);const l=r.map(f=>f.map(m=>u*m+c));return Z.createByArray(l)}_getKnownXsValues(e,t){return!t||t.isNull()?Qn(e.length,e[0].length):At(t)}_getNewXsValues(e,t){return!t||t.isNull()?e:At(t)}}class tE extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=this._getValues(e);if(t.isArray()){const n=t.mapValue(s=>this._handleSingleObject(r,s));return n.getRowCount()===1&&n.getColumnCount()===1?n.get(0,0):n}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(e instanceof g)return e;const{isError:r,errorObject:n,variants:s}=B(t);if(r)return n;const[a]=s,u=+a.getValue();if(u<0||u>=1)return g.create(h.NUM);const c=Qe(e.length*u/2,0)*2,l=e.slice(c/2,e.length-c/2),f=l.reduce((m,d)=>m+d,0)/l.length;return y.create(f)}_getValues(e){const t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let s=0;s<t;s++)for(let a=0;a<r;a++){const u=e.isArray()?e.get(s,a):e;if(u.isError())return u;if(u.isNull()||u.isBoolean())continue;const c=u.getValue();M.isRealNum(c)&&n.push(+c)}return n.length===0?g.create(h.NUM):n.sort((s,a)=>s-a)}}class rE extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=this.flattenArray(e,!1);return t.isError()?t:t.var(1)}}class nE extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=this.flattenArray(e,!1);return t.isError()?t:t.var()}}const Zu=[[T_,x.AVEDEV],[I_,x.AVERAGE],[F_,x.AVERAGE_WEIGHTED],[B_,x.AVERAGEA],[k_,x.AVERAGEIF],[$_,x.AVERAGEIFS],[Y_,x.BETA_DIST],[qo,x.BETA_INV],[Xo,x.BINOM_DIST],[H_,x.BINOM_DIST_RANGE],[Ko,x.BINOM_INV],[G_,x.CHISQ_DIST],[Zo,x.CHISQ_DIST_RT],[W_,x.CHISQ_INV],[zo,x.CHISQ_INV_RT],[Jo,x.CHISQ_TEST],[eu,x.CONFIDENCE_NORM],[Q_,x.CONFIDENCE_T],[q_,x.CORREL],[X_,x.COUNT],[K_,x.COUNTA],[Z_,x.COUNTBLANK],[z_,x.COUNTIF],[J_,x.COUNTIFS],[tu,x.COVARIANCE_P],[tA,x.COVARIANCE_S],[rA,x.DEVSQ],[ru,x.EXPON_DIST],[nA,x.F_DIST],[nu,x.F_DIST_RT],[sA,x.F_INV],[su,x.F_INV_RT],[au,x.F_TEST],[aA,x.FISHER],[iA,x.FISHERINV],[Xu,x.FORECAST],[Xu,x.FORECAST_LINEAR],[oA,x.FREQUENCY],[uA,x.GAMMA],[iu,x.GAMMA_DIST],[ou,x.GAMMA_INV],[Ku,x.GAMMALN],[Ku,x.GAMMALN_PRECISE],[cA,x.GAUSS],[lA,x.GEOMEAN],[fA,x.GROWTH],[mA,x.HARMEAN],[hA,x.HYPGEOM_DIST],[gA,x.INTERCEPT],[dA,x.KURT],[CA,x.LARGE],[_A,x.LINEST],[AA,x.LOGEST],[EA,x.LOGNORM_DIST],[uu,x.LOGNORM_INV],[RA,x.MARGINOFERROR],[bA,x.MAX],[yA,x.MAXA],[NA,x.MAXIFS],[pA,x.MEDIAN],[VA,x.MIN],[OA,x.MINA],[SA,x.MINIFS],[MA,x.MODE_MULT],[cu,x.MODE_SNGL],[DA,x.NEGBINOM_DIST],[lu,x.NORM_DIST],[fu,x.NORM_INV],[wA,x.NORM_S_DIST],[mu,x.NORM_S_INV],[LA,x.PEARSON],[PA,x.PERCENTILE_EXC],[hu,x.PERCENTILE_INC],[jA,x.PERCENTRANK_EXC],[gu,x.PERCENTRANK_INC],[xA,x.PERMUT],[UA,x.PERMUTATIONA],[TA,x.PHI],[du,x.POISSON_DIST],[vA,x.PROB],[IA,x.QUARTILE_EXC],[Cu,x.QUARTILE_INC],[FA,x.RANK_AVG],[BA,x.RANK_EQ],[kA,x.RSQ],[$A,x.SKEW],[YA,x.SKEW_P],[HA,x.SLOPE],[GA,x.SMALL],[WA,x.STANDARDIZE],[_u,x.STDEV_P],[Au,x.STDEV_S],[QA,x.STDEVA],[qA,x.STDEVPA],[XA,x.STEYX],[KA,x.T_DIST],[ZA,x.T_DIST_2T],[zA,x.T_DIST_RT],[JA,x.T_INV],[Eu,x.T_INV_2T],[Ru,x.T_TEST],[eE,x.TREND],[tE,x.TRIMMEAN],[bu,x.VAR_P],[yu,x.VAR_S],[rE,x.VARA],[nE,x.VARPA],[Nu,x.WEIBULL_DIST],[pu,x.Z_TEST]];class sE extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){let r=t!=null?t:y.create(0);if(t!=null&&t.isNull()&&(r=y.create(0)),r.isArray()){const n=r.mapValue(s=>this._handleSingleObject(e,s));return n.getRowCount()===1&&n.getColumnCount()===1?n.get(0,0):n}return this._handleSingleObject(e,r)}_handleSingleObject(e,t){const r=this._checkArray(e);if(r.isError())return r;const{isError:n,errorObject:s,variants:a}=B(t);if(n)return s;const[u]=a,c=+u.getValue(),l=e.isArray()?e.getRowCount():1,f=e.isArray()?e.getColumnCount():1;let m="";for(let d=0;d<l;d++)for(let C=0;C<f;C++){const _=e.isArray()?e.get(d,C):e;let E=`${_.getValue()}`;_.isNull()&&(E=""),_.isBoolean()&&(E=E.toLocaleUpperCase()),_.isString()&&c?m+=`"${E}"`:m+=E,d===l-1&&C===f-1||(c?C===f-1?m+=";":m+=",":m+=", ")}return c&&(m=`{${m}}`),m.length>32767?g.create(h.CALC):T.create(m)}_checkArray(e){if(e.isArray()){const t=e.getRowCount(),r=e.getColumnCount();return t>1||r>1?e:e.get(0,0)}return e}}class aE extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError()||e.isNull()||e.isBoolean()||e.isNumber())return e;const t=e.getValue().toLocaleString();let r="";for(let n=0;n<t.length;n++){let s=t.charCodeAt(n);s===12288?s=32:s>=65281&&s<=65374&&(s-=65248),r+=String.fromCharCode(s)}return T.create(r)}}class iE extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=B(e);if(t)return r;const[s]=n,a=+s.getValue(),u=Math.abs(Number.parseInt(a.toString(),10)),c=Number.parseFloat((Math.abs(a)-u).toFixed(2));let l="";return u===0?c!==0?l=`${a<0?"ลบ":""}${this._convertNumberToThaiText(c*100)}สตางค์`:l="ศูนย์บาทถ้วน":c===0?l=`${a<0?"ลบ":""}${this._convertNumberToThaiText(u)}บาทถ้วน`:l=`${a<0?"ลบ":""}${this._convertNumberToThaiText(u)}บาท${this._convertNumberToThaiText(c*100)}สตางค์`,T.create(l)}_convertNumberToThaiText(e){const t=["ล้าน","สิบ","ร้อย","พัน","หมื่น","แสน",""],r=["ศูนย์","หนึ่ง","สอง","สาม","สี่","ห้า","หก","เจ็ด","แปด","เก้า"],n=["ลบ","บาท","ถ้วน","สตางค์","ยี่","เอ็ด",","," ","฿"],s=e.toString(),a=s.length;let u="";for(let c=a;c>0;c--){const l=Number.parseInt(s.charAt(a-c),10);let f=r[l];const m=c>1?(c-1)%6:6;if(m===1&&l===2&&(f=n[4]),l===1)switch(m){case 0:case 6:u+=c<a?n[5]:f;break;case 1:break;default:u+=f;break}else if(l===0){m===0&&(u+=t[m]);continue}else u+=f;u+=t[m]}return u}}const oE=Object.values(M.DataStreamTreeTokenType).filter(i=>[M.DataStreamTreeTokenType.TABLE_START,M.DataStreamTreeTokenType.TABLE_ROW_START,M.DataStreamTreeTokenType.TABLE_CELL_START,M.DataStreamTreeTokenType.TABLE_CELL_END,M.DataStreamTreeTokenType.TABLE_ROW_END,M.DataStreamTreeTokenType.TABLE_END,M.DataStreamTreeTokenType.CUSTOM_BLOCK].includes(i));class uE extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=B(e);if(t)return r;const[s]=n,a=Math.floor(+s.getValue());if(a<=0)return g.create(h.VALUE);let u=String.fromCharCode(a);return oE.some(c=>c===u)&&(u=""),T.create(u)}}class cE extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError()||e.isBoolean()||e.isNumber())return e;if(e.isNull())return T.create("");const r=`${e.getValue()}`.replace(/[\0-\x1F]/g,"");return T.create(r)}}class lE extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return g.create(h.VALUE);let t=e.getValue().toLocaleString();if(e.isBoolean()&&(t=t.toLocaleUpperCase()),t==="")return g.create(h.VALUE);const r=t.charCodeAt(0);return y.create(r)}}class fE extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t="",r=null;for(const n of e)if(n.isArray()){if(n.iterator(s=>{if(s==null||s.isNull())return!0;if(s.isError())return r=s,!1;s.isBoolean()?t+=`${s.getValue()}`.toLocaleUpperCase():(s.isString()||s.isNumber())&&(t+=s.getValue())}),r)return r}else!n.isError()&&!n.isNull()&&(t+=n.getValue());return T.create(t)}}class mE extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=0,r=0;e.forEach(s=>{if(s.isArray()){const a=s;t=Math.max(t,a.getRowCount()),r=Math.max(r,a.getColumnCount())}else t=Math.max(t,1),r=Math.max(r,1)});let n=null;for(const s of e)n=O(t,r,s,g.create(h.NA)).mapValue((u,c,l)=>{const f=n&&n.get(c,l);if(f!=null&&f.isError())return f;if(u.isError())return u;let m=f==null?void 0:f.getValue(),d=u==null?void 0:u.getValue();f!=null&&f.isBoolean()&&(m=`${m}`.toLocaleUpperCase()),u!=null&&u.isBoolean()&&(d=`${d}`.toLocaleUpperCase());const C=f!=null&&f.isNull()?"":m!=null?m:"",_=u!=null&&u.isNull()?"":d!=null?d:"";return T.create(`${C}${_}`)});return n||g.create(h.VALUE)}}class hE extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return T.create("");let t=`${e.getValue()}`;e.isBoolean()&&(t=t.toLocaleUpperCase());let r="";for(let n=0;n<t.length;n++){const s=t.charCodeAt(n);s>=33&&s<=126?r+=String.fromCharCode(s+65248):s===32?r+="　":r+=t.charAt(n)}return T.create(r)}}class gE extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2);A(this,"needsLocale",!0)}calculate(e,t){let r=t!=null?t:y.create(2);r.isNull()&&(r=y.create(2));const n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,r,g.create(h.NA)),c=a.mapValue((l,f,m)=>{const d=u.get(f,m);return l.isError()?l:d.isError()?d:this._handleSingleObject(l,d)});return n===1&&s===1?c.get(0,0):c}_handleSingleObject(e,t){const{isError:r,errorObject:n,variants:s}=B(e,t);if(r)return n;const[a,u]=s;let c=+a.getValue(),l=Math.trunc(+u.getValue());if(l>127)return g.create(h.VALUE);l<0&&(`${c}`.length<Math.abs(l)?c=0:c=c<0?-Ut(Math.abs(c),l):Ut(c,l),l=0);const f=Pl(this.getLocale(),c,l);return T.create(f)}}class dE extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,le.create()),a=O(r,n,t,le.create()),u=s.mapValue((c,l,f)=>{const m=a.get(l,f);return c.isError()?c:m.isError()?m:this._handleSingleObject(c,m)});return r===1&&n===1?u.get(0,0):u}_handleSingleObject(e,t){if(e.isNull()||t.isNull()){const a=e.isNull()&&t.isNull();return F.create(a)}let r=`${e.getValue()}`;e.isBoolean()&&(r=r.toLocaleUpperCase());let n=`${t.getValue()}`;t.isBoolean()&&(n=n.toLocaleUpperCase());const s=r===n;return F.create(s)}}const xa=(i,o)=>M.numfmt.format(i,o,{throws:!1}),De=i=>{let o=`${i.getValue()}`;return i.isNull()&&(o=""),i.isBoolean()&&(o=o.toLocaleUpperCase()),i.isNumber()&&(i.getPattern()!==""?o=xa(i.getPattern(),+i.getValue()):o=`${On(+i.getValue())}`),o};class CE extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){const n=r!=null?r:y.create(1),s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,n,g.create(h.NA)),f=u.mapValue((m,d,C)=>{const _=c.get(d,C),E=l.get(d,C);return m.isError()?m:_.isError()?_:E.isError()?E:this._handleSingleObject(m,_,E)});return s===1&&a===1?f.get(0,0):f}_handleSingleObject(e,t,r){const n=De(e),s=De(t),{isError:a,errorObject:u,variants:c}=B(r);if(a)return u;const[l]=c,f=Math.floor(+l.getValue());if(t.isNull()||f<=0||f>s.length)return g.create(h.VALUE);if(e.isNull()||n.length===0)return y.create(f);const m=s.indexOf(n,f-1);return m===-1?g.create(h.VALUE):y.create(m+1)}}function Ua(i){let o=0;for(let e=0;e<i.length;e++)o+=Gr(i,e);return o}function Gr(i,o,e="ltr"){return _E(i,o,e)>255?2:1}function zu(i){return i>=55296&&i<=56319}function Ju(i){return i>=56320&&i<=57343}function ec(i,o){const e=(i&1023)<<10,t=o&1023;return e+t+65536}function _E(i,o,e="ltr"){const t=i.charCodeAt(o);if(e==="ltr"&&zu(t)&&o+1<i.length){const r=i.charCodeAt(o+1);if(Ju(r))return ec(t,r)}if(e==="rtl"&&Ju(t)&&o-1>=0){const r=i.charCodeAt(o-1);if(zu(r))return ec(r,t)}return t}class AE extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){const n=r!=null?r:y.create(1),s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,n,g.create(h.NA)),f=u.mapValue((m,d,C)=>{const _=c.get(d,C),E=l.get(d,C);return m.isError()?m:_.isError()?_:E.isError()?E:this._handleSingleObject(m,_,E)});return s===1&&a===1?f.get(0,0):f}_handleSingleObject(e,t,r){const n=De(e),s=De(t),{isError:a,errorObject:u,variants:c}=B(r);if(a)return u;const[l]=c,f=Math.floor(+l.getValue());if(t.isNull()||f<=0||f>s.length)return g.create(h.VALUE);if(e.isNull()||n.length===0)return y.create(f);const m=s.indexOf(n,f-1);if(m===-1)return g.create(h.VALUE);const d=Ua(s.substring(0,m))+1;return y.create(d)}}class EE extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",3)}calculate(e,t,r){let n=t!=null?t:y.create(2);n.isNull()&&(n=y.create(2));let s=r!=null?r:F.create(!1);s.isNull()&&(s=F.create(!1));const a=Math.max(e.isArray()?e.getRowCount():1,n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1),c=O(a,u,e,g.create(h.NA)),l=O(a,u,n,g.create(h.NA)),f=O(a,u,s,g.create(h.NA)),m=c.mapValue((d,C,_)=>{const E=l.get(C,_),R=f.get(C,_);return d.isError()?d:E.isError()?E:R.isError()?R:this._handleSingleObject(d,E,R)});return a===1&&u===1?m.get(0,0):m}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=B(e,t,r);if(n)return s;const[u,c,l]=a;let f=+u.getValue(),m=Math.trunc(+c.getValue());const d=+l.getValue();if(m>127)return g.create(h.VALUE);m<0&&(`${f}`.length<Math.abs(m)?f=0:f=f<0?-Ut(Math.abs(f),m):Ut(f,m),m=0);let C=d?"###0":"#,##0";m>0&&(C+=`.${"0".repeat(m)}`);const _=xa(C,f);return T.create(_)}}class RE extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){const r=t!=null?t:y.create(1),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,r,g.create(h.NA)),c=a.mapValue((l,f,m)=>{const d=u.get(f,m);return l.isError()?l:d.isError()?d:this._handleSingleObject(l,d)});return n===1&&s===1?c.get(0,0):c}_handleSingleObject(e,t){const r=De(e),{isError:n,errorObject:s,variants:a}=B(t);if(n)return s;const[u]=a,c=Math.floor(+u.getValue());if(c<0)return g.create(h.VALUE);if(e.isNull()||c===0)return T.create("");if(c>=r.length)return T.create(r);const l=r.substring(0,c);return T.create(l)}}class bE extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){const r=t!=null?t:y.create(1),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,le.create()),u=O(n,s,r,le.create()),c=a.mapValue((l,f,m)=>{const d=u.get(f,m);return l.isError()?l:d.isError()?d:this._handleSingleObject(l,d)});return n===1&&s===1?c.get(0,0):c}_handleSingleObject(e,t){const r=De(e),{isError:n,errorObject:s,variants:a}=B(t);if(n)return s;const[u]=a,c=Math.floor(+u.getValue());if(c<0)return g.create(h.VALUE);if(e.isNull()||c===0)return T.create("");let l=0,f=0,m="";for(;f<c&&l<r.length;)f+=Gr(r,l),m+=r.charAt(l),l++;return T.create(m)}}class yE extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleText(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleText(e)}_handleSingleText(e){if(e.isError())return e;const t=De(e);return y.create(t.length)}}class NE extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleText(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleText(e)}_handleSingleText(e){if(e.isError())return e;const t=De(e),r=Ua(t);return y.create(r)}}class pE extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return T.create("");const t=`${e.getValue()}`.toLocaleLowerCase();return T.create(t)}}class VE extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSingleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const n=De(e),{isError:s,errorObject:a,variants:u}=B(t,r);if(s)return a;const[c,l]=u,f=Math.floor(+c.getValue()),m=Math.floor(+l.getValue());if(f<=0||m<0)return g.create(h.VALUE);if(e.isNull()||f>n.length||m===0)return T.create("");const d=n.substring(f-1,f-1+m);return T.create(d)}}class OE extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSingleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){let n=De(e);const{isError:s,errorObject:a,variants:u}=B(t,r);if(s)return a;const[c,l]=u,f=Math.floor(+c.getValue()),m=Math.floor(+l.getValue());if(f<=0||m<0)return g.create(h.VALUE);if(e.isNull()||f>n.length||m===0)return T.create("");n=n.substring(f-1);let d=0,C=0,_="";for(;C<m&&d<n.length;)C+=Gr(n,d),_+=n.charAt(d),d++;return T.create(_)}}const Wr=["〇","一","二","三","四","五","六","七","八","九"],ss=["零","壹","贰","叁","肆","伍","陆","柒","捌","玖"],SE=["","十","百","千"],ME=["","拾","佰","仟"],DE=["","万","亿","兆"];class wE extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.mapValue((c,l,f)=>{const m=a.get(l,f);return c.isError()?c:m.isError()?m:this._handleSingleObject(c,m)});return r===1&&n===1?u.get(0,0):u}_handleSingleObject(e,t){const r=e.convertToNumberObjectValue();if(r.isError())return r;const n=t.convertToNumberObjectValue();if(n.isError())return n;let s=r.getValue();const a=Math.trunc(n.getValue());if(s<0||![1,2,3].includes(a))return g.create(h.NUM);s=Math.round(s);const u=s.toString(),c=u.length;let l="",f=!1;for(let m=0;m<c;m++){const d=Number(u[m]);if(c===1&&d===0){l+=a===2?ss[0]:Wr[0];break}if(a===3){l+=Wr[d];continue}const C=c-m-1,_=C%4,E=Math.trunc(C/4);if(c>=17&&E>2){if(l+=a===1?Wr[d]:ss[d],E>3)continue}else d===0?f=_!==0:(f&&(l+=a===1?Wr[0]:ss[0],f=!1),l+=a===1?Wr[d]+SE[_]:ss[d]+ME[_]);_===0&&E>0&&u.slice(Math.max(0,m-3),m+1)!=="0000"&&(l+=DE[E])}return T.create(l)}}class LE extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",3)}isArgumentsIgnoreNumberPattern(){return!0}calculate(e,t,r){const n=t!=null?t:T.create("."),s=Math.max(e.isArray()?e.getRowCount():1,n.isArray()?n.getRowCount():1,r!=null&&r.isArray()?r.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,n.isArray()?n.getColumnCount():1,r!=null&&r.isArray()?r.getColumnCount():1),u=O(s,a,e,g.create(h.NA)),c=O(s,a,n,g.create(h.NA)),l=r?O(s,a,r,g.create(h.NA)):void 0,f=u.mapValue((m,d,C)=>{const _=c.get(d,C),E=r?l.get(d,C):void 0;return m.isError()?m:_.isError()?_:E!=null&&E.isError()?E:_.isNull()||E!=null&&E.isNull()?g.create(h.VALUE):m.isNull()?y.create(0):this._handleSingleObject(m,_,E)});return s===1&&a===1?f.get(0,0):f}_handleSingleObject(e,t,r){let n=`${e.getValue()}`;n=n.replace(/\s+/g,"");let s=`${t.getValue()}`;t.isBoolean()&&(s=s.toLocaleUpperCase()),s=s.charAt(0);let a;if(r&&(a=`${r.getValue()}`,r.isBoolean()&&(a=a.toLocaleUpperCase()),a=a.charAt(0),s===a))return g.create(h.VALUE);if(n.trim()==="")return y.create(0);if(!n.match(/^\s*[+-]?\s*(?:(?:\d+(?:\.\d*)?)|(?:\.\d+))(?:[eE][+-]?\d+)?[ \t]*/))return g.create(h.VALUE);const u=n.split(s);if(u.length>2)return g.create(h.VALUE);let c=u[0].replace(/,/g,"");r&&(c=c.split(a).join(""));let l=0;if(u.length===1){s===","&&(c=c.replace(/\./g,""));let f=0;for(;c.endsWith("%");)c=c.slice(0,-1),f++;f>0?l=+c/100**f:l=+c}else{if(!M.isRealNum(c))return g.create(h.VALUE);let f=u[1],m=0;for(;f.endsWith("%");)f=f.slice(0,-1),m++;const d=`${c}.${f}`;if(!M.isRealNum(d))return g.create(h.VALUE);m>0?l=+d/100**m:l=+d}return Number.isNaN(l)?g.create(h.VALUE):y.create(l)}}class PE extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError()||e.isNull()||e.isBoolean()||e.isNumber())return e;const r=e.getValue().toLocaleString().toLocaleLowerCase().replace(/(^|\b|\W|\d|_)[a-z]/g,n=>n.toLocaleUpperCase());return T.create(r)}}const tc=()=>[{type:4,from:48,to:57}],rc=()=>[{type:7,value:95},{type:4,from:97,to:122},{type:4,from:65,to:90},{type:4,from:48,to:57}],nc=()=>[{type:7,value:9},{type:7,value:10},{type:7,value:11},{type:7,value:12},{type:7,value:13},{type:7,value:32},{type:7,value:160},{type:7,value:5760},{type:4,from:8192,to:8202},{type:7,value:8232},{type:7,value:8233},{type:7,value:8239},{type:7,value:8287},{type:7,value:12288},{type:7,value:65279}],sc=()=>({type:3,set:rc(),not:!1}),ac=()=>({type:3,set:rc(),not:!0}),ic=()=>({type:3,set:tc(),not:!1}),oc=()=>({type:3,set:tc(),not:!0}),uc=()=>({type:3,set:nc(),not:!1}),cc=()=>({type:3,set:nc(),not:!0}),jE=()=>({type:3,set:[{type:7,value:10},{type:7,value:13},{type:7,value:8232},{type:7,value:8233}],not:!0});function xE(i){const o={type:0,stack:[]};let e=o,t=o.stack;const r=[],n=[];let s=0;const a=f=>{throw new SyntaxError(`Invalid regular expression: /${i}/: Nothing to repeat at column ${f-1}`)},u=TE(i);let c=0,l;for(;c<u.length;)switch(l=u[c++],l){case"\\":if(c===u.length)throw new SyntaxError(`Invalid regular expression: /${i}/: \\ at end of pattern`);switch(l=u[c++],l){case"b":t.push({type:2,value:"b"});break;case"B":t.push({type:2,value:"B"});break;case"w":t.push(sc());break;case"W":t.push(ac());break;case"d":t.push(ic());break;case"D":t.push(oc());break;case"s":t.push(uc());break;case"S":t.push(cc());break;default:if(/\d/.test(l)){for(;/\d/.test(u[c])&&c<u.length;)l+=u[c++];const f=Number.parseInt(l,10);t.push({type:6,value:f}),n.push({reference:{type:6,value:f},stack:t,index:t.length-1})}else t.push({type:7,value:l.charCodeAt(0)})}break;case"^":t.push({type:2,value:"^"});break;case"$":t.push({type:2,value:"$"});break;case"[":{const f=u[c]==="^";f&&c++;const m=UE(u.slice(c),i);c+=m[1],t.push({type:3,set:m[0],not:f});break}case".":t.push(jE());break;case"(":{const f={type:1,stack:[],remember:!0};if(u[c]==="?"){const m=u[c+1];if(c+=2,m==="=")f.followedBy=!0;else if(m==="!")f.notFollowedBy=!0;else if(m!==":")throw new SyntaxError(`Invalid regular expression: /${i}/: Invalid group, character '${m}' after '?' at column ${c-1}`);f.remember=!1}else s+=1;t.push(f),r.push(e),e=f,t=f.stack;break}case")":if(r.length===0)throw new SyntaxError(`Invalid regular expression: /${i}/: Unmatched ) at column ${c-1}`);e=r.pop(),t=e.options?e.options[e.options.length-1]:e.stack;break;case"|":{e.options||(e.options=[e.stack],delete e.stack);const f=[];e.options.push(f),t=f;break}case"{":{const f=/^(\d+)(,(\d+)?)?\}/.exec(u.slice(c));if(f){t.length===0&&a(c);const m=Number.parseInt(f[1],10),d=f[2]?f[3]?Number.parseInt(f[3],10):1/0:m;c+=f[0].length,t.push({type:5,min:m,max:d,value:t.pop()})}else t.push({type:7,value:123});break}case"?":t.length===0&&a(c),t.push({type:5,min:0,max:1,value:t.pop()});break;case"+":t.length===0&&a(c),t.push({type:5,min:1,max:1/0,value:t.pop()});break;case"*":t.length===0&&a(c),t.push({type:5,min:0,max:1/0,value:t.pop()});break;default:t.push({type:7,value:l.charCodeAt(0)})}if(r.length>0)throw new SyntaxError(`Invalid regular expression: /${i}/: Unterminated group`);return vE(n,s),o}function UE(i,o){let e;const t=[],r=/\\(?:(w)|(d)|(s)|(W)|(D)|(S))|((?:(?:\\)(.)|([^\]\\]))-(((?:\\)])|(((?:\\)?([^\]])))))|(\])|(?:\\)?([^])/g;for(;(e=r.exec(i))!==null;){let n=null;const[,s,a,u,c,l,f,m,d,C,_]=e;if(s||a||u||c||l||f?n=(()=>{let E={type:3,set:[],not:!1};return s?E=sc():a?E=ic():u?E=uc():c?E=ac():l?E=oc():f&&(E=cc()),E})():m&&_?n={type:4,from:(d||C).charCodeAt(0),to:_.charCodeAt(_.length-1)}:e[16]&&(n={type:7,value:e[16].charCodeAt(0)}),!n)return[t,r.lastIndex];t.push(n)}throw new SyntaxError(`Invalid regular expression: /${o}/: Unterminated character class`)}function TE(i){return i.replace(/(\[\\b\])|(\\)?\\(?:u([A-F0-9]{4})|x([A-F0-9]{2})|c([@A-Z[\\\]^?])|([0tnvfr]))/g,(o,e,t,r,n,s,a)=>{if(t)return o;let u;e?u=8:r?u=Number.parseInt(r,16):n?u=Number.parseInt(n,16):s?u="@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^ ?".indexOf(s):u={0:0,t:9,n:10,v:11,f:12,r:13}[a];const c=String.fromCharCode(u);return/[[\]{}^$.|?*+()]/.test(c)?`\\${c}`:c})}function vE(i,o){for(const e of i.reverse()){const t=e.reference.value;if(o<t){e.reference.type=7;const r=t.toString();if(e.reference.value=Number.parseInt(r,8),!/^[0-7]+$/.test(r)){let n=0;for(;r[n]!=="8"&&r[n]!=="9"&&n<r.length;)n+=1;if(n===0?(e.reference.value=r.charCodeAt(0),n+=1):e.reference.value=Number.parseInt(r.slice(0,n),8),r.length>n){const s=e.stack.splice(e.index+1);for(const a of r.slice(n))e.stack.push({type:7,value:a.charCodeAt(0)});e.stack.push(...s)}}}}}function Ta(i,o){if(!IE(i))return{isError:!0,regExp:null};try{const e=new RegExp(i,o?"ug":"u");return FE(e)?{isError:!1,regExp:e}:{isError:!0,regExp:null}}catch{return{isError:!0,regExp:null}}}function IE(i){return!(/\(\?<=.*?\)/g.test(i)&&!/\[.*?(\?<=.*?)\]/g.test(i)||/\(\?<!.*?\)/g.test(i)&&!/\[.*?(\?<!.*?)\]/g.test(i))}function FE(i,o){let t;Object.prototype.toString.call(i)==="[object RegExp]"?t=i.source:i&&typeof i!="string"&&(t=`${i}`);let r;try{r=xE(t)}catch{return!1}let n=0;const s=(a,u)=>{let c=u;if(a.type===5&&(c++,n++,c>1||n>25))return!1;if(a.options){for(const f of a.options)if(!s({stack:f},c))return!1}const l=a.stack||a.value&&a.value.stack;if(!l)return!0;for(const f of l)if(!s(f,c))return!1;return!0};return s(r,0)}class BE extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,variants:s}=Ir(e,t);if(r)return n;const[a,u]=s;let c=a.getValue();a.isNull()&&(c=""),a.isBoolean()&&(c=c?"TRUE":"FALSE"),c=`${c}`;let l=u.getValue();u.isNull()&&(l=""),u.isBoolean()&&(l=l?"TRUE":"FALSE"),l=`${l}`;const{isError:f,regExp:m}=Ta(l,!1);if(f)return g.create(h.REF);const d=c.match(m);if(d===null)return g.create(h.NA);if(d.length>1){const C=d.slice(1).map(_=>T.create(_));return C.length>1?Z.create({calculateValueList:[C],rowCount:1,columnCount:C.length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column}):C[0]}return T.create(d[0])}}class kE extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,variants:s}=Ir(e,t);if(r)return n;const[a,u]=s;let c=a.getValue();a.isNull()&&(c=""),a.isBoolean()&&(c=c?"TRUE":"FALSE"),c=`${c}`;let l=u.getValue();u.isNull()&&(l=""),u.isBoolean()&&(l=l?"TRUE":"FALSE"),l=`${l}`;const{isError:f,regExp:m}=Ta(l,!1);return f?g.create(h.REF):c.match(m)===null?F.create(!1):F.create(!0)}}class $E extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,variants:a}=Ir(e,t,r);if(n)return s;const[u,c,l]=a;let f=u.getValue();u.isNull()&&(f=""),u.isBoolean()&&(f=f?"TRUE":"FALSE"),f=`${f}`;let m=c.getValue();c.isNull()&&(m=""),c.isBoolean()&&(m=m?"TRUE":"FALSE"),m=`${m}`;let d=l.getValue();l.isNull()&&(d=""),l.isBoolean()&&(d=d?"TRUE":"FALSE"),d=`${d}`;const{isError:C,regExp:_}=Ta(m,!0);if(C)return g.create(h.REF);const E=f.replace(_,d);return T.create(E)}}class YE extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA)),f=O(s,a,n,g.create(h.NA)),m=u.mapValue((d,C,_)=>{const E=c.get(C,_),R=l.get(C,_),b=f.get(C,_);return d.isError()?d:E.isError()?E:R.isError()?R:b.isError()?b:this._handleSingleObject(d,E,R,b)});return s===1&&a===1?m.get(0,0):m}_handleSingleObject(e,t,r,n){const{isError:s,errorObject:a,variants:u}=B(t,r);if(s)return a;const[c,l]=u,f=Math.floor(+c.getValue()),m=Math.floor(+l.getValue());if(f<=0||m<0)return g.create(h.VALUE);const d=De(e),C=De(n),_=d.substring(0,f-1)+C+d.substring(f-1+m);return T.create(_)}}class HE extends p{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA)),f=O(s,a,n,g.create(h.NA)),m=u.mapValue((d,C,_)=>{const E=c.get(C,_),R=l.get(C,_),b=f.get(C,_);return d.isError()?d:E.isError()?E:R.isError()?R:b.isError()?b:this._handleSingleObject(d,E,R,b)});return s===1&&a===1?m.get(0,0):m}_handleSingleObject(e,t,r,n){const{isError:s,errorObject:a,variants:u}=B(t,r);if(s)return a;const[c,l]=u,f=Math.floor(+c.getValue()),m=Math.floor(+l.getValue());if(f<=0||m<0)return g.create(h.VALUE);let d=De(e);const C=De(n);let _=d.substring(0,f-1);d=d.substring(f-1);let E=0,R=0;for(;R<m&&E<d.length;)R+=Gr(d,E),E++;return _+=C+d.substring(E),T.create(_)}}class GE extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.map((c,l,f)=>{let m=a.get(l,f);if(c.isError())return c;let d=c.getValue();if(c.isNull()&&(d=""),c.isBoolean()&&(d=d?"TRUE":"FALSE"),d+="",m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;const C=32767,_=Math.floor(+m.getValue());if(_<0||_>C/d.length)return g.create(h.VALUE);const E=d.repeat(_);return T.create(E)});return r===1&&n===1?u.get(0,0):u}}class WE extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){const r=t!=null?t:y.create(1),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,r,g.create(h.NA)),c=a.mapValue((l,f,m)=>{const d=u.get(f,m);return l.isError()?l:d.isError()?d:this._handleSingleObject(l,d)});return n===1&&s===1?c.get(0,0):c}_handleSingleObject(e,t){const r=De(e),{isError:n,errorObject:s,variants:a}=B(t);if(n)return s;const[u]=a,c=Math.floor(+u.getValue());if(c<0)return g.create(h.VALUE);if(e.isNull()||c===0)return T.create("");if(c>=r.length)return T.create(r);const l=r.substring(r.length-c);return T.create(l)}}class QE extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){const r=t!=null?t:y.create(1),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,r,g.create(h.NA)),c=a.mapValue((l,f,m)=>{const d=u.get(f,m);return l.isError()?l:d.isError()?d:this._handleSingleObject(l,d)});return n===1&&s===1?c.get(0,0):c}_handleSingleObject(e,t){const r=De(e),{isError:n,errorObject:s,variants:a}=B(t);if(n)return s;const[u]=a,c=Math.floor(+u.getValue());if(c<0)return g.create(h.VALUE);if(e.isNull()||c===0)return T.create("");let l=r.length-1,f=0,m="";for(;f<c&&l>=0;)f+=Gr(r,l,"rtl"),m=r.charAt(l)+m,l--;return T.create(m)}}class qE extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){const n=r!=null?r:y.create(1),s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,n,g.create(h.NA)),f=u.mapValue((m,d,C)=>{const _=c.get(d,C),E=l.get(d,C);return m.isError()?m:_.isError()?_:E.isError()?E:this._handleSingleObject(m,_,E)});return s===1&&a===1?f.get(0,0):f}_handleSingleObject(e,t,r){const n=De(e).toLocaleUpperCase(),s=De(t).toLocaleUpperCase(),{isError:a,errorObject:u,variants:c}=B(r);if(a)return u;const[l]=c,f=Math.floor(+l.getValue());if(t.isNull()||f<=0||f>s.length)return g.create(h.VALUE);if(e.isNull()||n.length===0)return y.create(f);const m=s.indexOf(n,f-1);return m===-1?g.create(h.VALUE):y.create(m+1)}}class XE extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){const n=r!=null?r:y.create(1),s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,n,g.create(h.NA)),f=u.mapValue((m,d,C)=>{const _=c.get(d,C),E=l.get(d,C);return m.isError()?m:_.isError()?_:E.isError()?E:this._handleSingleObject(m,_,E)});return s===1&&a===1?f.get(0,0):f}_handleSingleObject(e,t,r){const n=De(e).toLocaleUpperCase(),s=De(t).toLocaleUpperCase(),{isError:a,errorObject:u,variants:c}=B(r);if(a)return u;const[l]=c,f=Math.floor(+l.getValue());if(t.isNull()||f<=0||f>s.length)return g.create(h.VALUE);if(e.isNull()||n.length===0)return y.create(f);const m=s.indexOf(n,f-1);if(m===-1)return g.create(h.VALUE);const d=Ua(s.substring(0,m))+1;return y.create(d)}}class KE extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n!=null&&n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n!=null&&n.isArray()?n.getColumnCount():1),u=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA)),f=n?O(s,a,n,g.create(h.NA)):void 0,m=u.mapValue((d,C,_)=>{const E=c.get(C,_),R=l.get(C,_);let b=n?f.get(C,_):void 0;return d.isError()?d:E.isError()?E:R.isError()?R:b!=null&&b.isError()?b:b!=null&&b.isNull()||b!=null&&b.isBoolean()?g.create(h.VALUE):(b!=null&&b.isString()&&(b=b.convertToNumberObjectValue()),b!=null&&b.isError()?b:this._handleSingleObject(d,E,R,b))});return s===1&&a===1?m.get(0,0):m}_handleSingleObject(e,t,r,n){const s=this._getObjectString(e),a=this._getObjectString(t),u=this._getObjectString(r),c=n?Math.floor(+n.getValue()):void 0;if(n&&c<=0)return g.create(h.VALUE);if(a==="")return T.create(s);let l="",f=0;for(let m=0;m<s.length;m++){const d=s.substr(m,a.length);if(d===a||d.length===a.length&&d.trim()===a.trim()){if(f++,f===c){l=s.substr(0,m)+u+s.substr(m+a.length);break}c===void 0&&(l+=u),m+=a.length-1}else c===void 0&&(l+=s[m])}return c&&f<c&&(l=s),T.create(l)}_getObjectString(e){let t=`${e.getValue()}`;return e.isNull()&&(t=""),e.isBoolean()&&(t=t.toLocaleUpperCase()),t}}class ZE extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1);A(this,"needsReferenceObject",!0)}calculate(e){let t=e;return e.isReferenceObject()&&(t=e.toArrayValueObject().get(0,0)),t.isArray()?t.mapValue(r=>this._handleSingleObject(r)):this._handleSingleObject(t)}_handleSingleObject(e){return e.isError()?e:e.isNull()||e.isBoolean()||e.isNumber()?T.create(""):e}}class zE extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}isArgumentsIgnoreNumberPattern(){return!0}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e),a=O(r,n,t),u=s.map((c,l,f)=>{if(c.isError())return c;let m=a.get(l,f)||T.create(" ");if(m.isError())return m;if(m.isBoolean())return g.create(h.VALUE);if(c.isBoolean())return c;let d=c.getValue();if(c.isNull()&&(d=0),c.isString())if(M.isRealNum(d))d=Number(d);else{const E=M.getNumfmtParseValueFilter(`${d}`);E&&E.v!=null&&typeof E.v=="number"&&(d=E.v)}m.isNull()&&(m=T.create(" "));const C=`${m.getValue()}`,_=xa(C,d);return T.create(C===" "?_.trimEnd():_)});return u.getRowCount()===1&&u.getColumnCount()===1?u.get(0,0):u}}class JE extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",6)}calculate(e,t,r,n,s,a){let u=!1,c=r!=null?r:y.create(1);c.isNull()&&(u=!0,c=y.create(1));const l=!n,f=n!=null?n:y.create(0),m=s!=null?s:y.create(0),d=a!=null?a:g.create(h.NA),C=Math.max(e.isArray()?e.getRowCount():1,c.isArray()?c.getRowCount():1,f.isArray()?f.getRowCount():1,m.isArray()?m.getRowCount():1,d.isArray()?d.getRowCount():1),_=Math.max(e.isArray()?e.getColumnCount():1,c.isArray()?c.getColumnCount():1,f.isArray()?f.getColumnCount():1,m.isArray()?m.getColumnCount():1,d.isArray()?d.getColumnCount():1),E=O(C,_,e,g.create(h.NA)),R=O(C,_,c,g.create(h.NA)),b=O(C,_,f,g.create(h.NA)),N=O(C,_,m,g.create(h.NA)),V=O(C,_,d,g.create(h.NA)),S=this._getResultArray(E,t,R,b,N,V,u,l);return C===1&&_===1?S.get(0,0):S}_getResultArray(e,t,r,n,s,a,u,c){return e.map((f,m,d)=>{const C=r.get(m,d),_=n.get(m,d),E=s.get(m,d),R=a.get(m,d),b=this._checkVariantsError(f,C,_,E);if(b.isError())return b;const N=this._getStringValue(f),V=this._getDelimiterValue(t);if(V instanceof g)return V;const S=this._getVariantsNumberFloorValue(C,_,E);if(S instanceof g)return S;const[D,L,P]=S;return D===0||L<0||L>1||P<0||P>1?g.create(h.VALUE):V.includes("")?D>0?T.create(N):T.create(""):!u&&Math.abs(D)>N.length?g.create(h.VALUE):V.every(j=>j.length>N.length)?g.create(h.NA):this._getResult(N,V,D,L,P,R,c)})}_checkVariantsError(...e){for(let t=0;t<e.length;t++){const r=e[t];if(r.isError())return r}return F.create(!0)}_getStringValue(e){let t=`${e.getValue()}`;return e.isNull()&&(t=""),e.isBoolean()&&(t=t.toLocaleUpperCase()),t}_getDelimiterValue(e){const t=[];if(e.isArray()){let r=!1,n=g.create(h.VALUE);if(e.iterator(s=>{const a=s;if(a.isError())return r=!0,n=a,!1;t.push(this._getStringValue(a))}),r)return n}else{if(e.isError())return e;t.push(this._getStringValue(e))}return t}_getVariantsNumberFloorValue(...e){const t=[];for(let r=0;r<e.length;r++){let n=e[r];if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;const s=Math.floor(+n.getValue());t.push(s)}return t}_getResult(e,t,r,n,s,a,u){let c=n?e.toLocaleLowerCase():e;const l=n?t.map(_=>_.toLocaleLowerCase()):t;let f=0,m=0,d=0;for(let _=0;_<Math.abs(r);_++)if(r<0){const E=l.map(R=>({index:c.lastIndexOf(R),length:R.length})).filter(R=>R.index!==-1).sort((R,b)=>b.index-R.index)[0];if(!E)break;f=E.index,c=c.substr(0,E.index),d=E.length,m++}else{const E=l.map(R=>({index:c.indexOf(R),length:R.length})).filter(R=>R.index!==-1).sort((R,b)=>R.index-b.index)[0];if(!E)break;f+=E.index+d,c=c.substr(E.index+E.length),d=E.length,m++}if(m&&m<Math.abs(r)&&u)return g.create(h.NA);if(!m||m<Math.abs(r))return s?r>0?T.create(""):T.create(e):a;const C=e.substr(f+d);return T.create(C)}}class eR extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",6)}calculate(e,t,r,n,s,a){let u=!1,c=r!=null?r:y.create(1);c.isNull()&&(u=!0,c=y.create(1));const l=!n,f=n!=null?n:y.create(0),m=s!=null?s:y.create(0),d=a!=null?a:g.create(h.NA),C=Math.max(e.isArray()?e.getRowCount():1,c.isArray()?c.getRowCount():1,f.isArray()?f.getRowCount():1,m.isArray()?m.getRowCount():1,d.isArray()?d.getRowCount():1),_=Math.max(e.isArray()?e.getColumnCount():1,c.isArray()?c.getColumnCount():1,f.isArray()?f.getColumnCount():1,m.isArray()?m.getColumnCount():1,d.isArray()?d.getColumnCount():1),E=O(C,_,e,g.create(h.NA)),R=O(C,_,c,g.create(h.NA)),b=O(C,_,f,g.create(h.NA)),N=O(C,_,m,g.create(h.NA)),V=O(C,_,d,g.create(h.NA)),S=this._getResultArray(E,t,R,b,N,V,u,l);return C===1&&_===1?S.get(0,0):S}_getResultArray(e,t,r,n,s,a,u,c){return e.map((f,m,d)=>{const C=r.get(m,d),_=n.get(m,d),E=s.get(m,d),R=a.get(m,d),b=this._checkVariantsError(f,C,_,E);if(b.isError())return b;const N=this._getStringValue(f),V=this._getDelimiterValue(t);if(V instanceof g)return V;const S=this._getVariantsNumberFloorValue(C,_,E);if(S instanceof g)return S;const[D,L,P]=S;return D===0||L<0||L>1||P<0||P>1?g.create(h.VALUE):V.includes("")?D>0?T.create(""):T.create(N):!u&&Math.abs(D)>N.length?g.create(h.VALUE):V.every(j=>j.length>N.length)?g.create(h.NA):this._getResult(N,V,D,L,P,R,c)})}_checkVariantsError(...e){for(let t=0;t<e.length;t++){const r=e[t];if(r.isError())return r}return F.create(!0)}_getStringValue(e){let t=`${e.getValue()}`;return e.isNull()&&(t=""),e.isBoolean()&&(t=t.toLocaleUpperCase()),t}_getDelimiterValue(e){const t=[];if(e.isArray()){let r=!1,n=g.create(h.VALUE);if(e.iterator(s=>{const a=s;if(a.isError())return r=!0,n=a,!1;t.push(this._getStringValue(a))}),r)return n}else{if(e.isError())return e;t.push(this._getStringValue(e))}return t}_getVariantsNumberFloorValue(...e){const t=[];for(let r=0;r<e.length;r++){let n=e[r];if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;const s=Math.floor(+n.getValue());t.push(s)}return t}_getResult(e,t,r,n,s,a,u){let c=n?e.toLocaleLowerCase():e;const l=n?t.map(_=>_.toLocaleLowerCase()):t;let f=0,m=0,d=0;for(let _=0;_<Math.abs(r);_++)if(r<0){const E=l.map(R=>({index:c.lastIndexOf(R),length:R.length})).filter(R=>R.index!==-1).sort((R,b)=>b.index-R.index)[0];if(!E)break;f=E.index,c=c.substr(0,E.index),m++}else{const E=l.map(R=>({index:c.indexOf(R),length:R.length})).filter(R=>R.index!==-1).sort((R,b)=>R.index-b.index)[0];if(!E)break;f+=E.index+d,c=c.substr(E.index+E.length),d=E.length,m++}if(m&&m<Math.abs(r)&&u)return g.create(h.NA);if(!m||m<Math.abs(r))return s?r>0?T.create(e):T.create(""):a;const C=e.substr(0,f);return T.create(C)}}class tR extends p{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",255)}calculate(e,t,...r){const n=this._getDelimiterValues(e),s=this._getTextValues(r);if(t.isArray()){const u=t.mapValue(c=>this._handleSingleObject(n,c,s));return u.getRowCount()===1&&u.getColumnCount()===1?u.get(0,0):u}const a=t;if(a.isString()){const u=`${a.getValue()}`.toLocaleUpperCase();if(u==="TRUE")return this._handleSingleObject(n,F.create(!0),s);if(u==="FALSE")return this._handleSingleObject(n,F.create(!1),s)}return this._handleSingleObject(n,t,s)}_handleSingleObject(e,t,r){if(e instanceof g)return e;const{isError:n,errorObject:s,variants:a}=B(t);if(n)return s;if(r instanceof g)return r;const[u]=a,c=+u.getValue();let l=r;c&&(l=r.filter(m=>m!==null&&m!==""));let f="";for(let m=0;m<l.length;m++)l[m]!==null&&(f+=l[m]),m<l.length-1&&(f+=e[m%e.length]);return T.create(f)}_getDelimiterValues(e){const t=[],r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1;for(let s=0;s<r;s++)for(let a=0;a<n;a++){const u=e.isArray()?e.get(s,a):e;if(u.isError())return u;let c=`${u.getValue()}`;u.isNull()&&(c=""),u.isBoolean()&&(c=c.toLocaleUpperCase()),t.push(c)}return t}_getTextValues(e){const t=[];for(const r of e){const n=r.isArray()?r.getRowCount():1,s=r.isArray()?r.getColumnCount():1;for(let a=0;a<n;a++)for(let u=0;u<s;u++){const c=r.isArray()?r.get(a,u):r;if(c.isError())return c;if(c.isNull()){t.push(null);continue}let l=`${c.getValue()}`;c.isBoolean()&&(l=l.toLocaleUpperCase()),t.push(l)}}return t}}class rR extends p{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",6)}calculate(e,t,r,n,s,a){let u=r!=null?r:T.create("\\s");const c=n!=null?n:y.create(0),l=s!=null?s:y.create(0),f=a!=null?a:T.create(h.NA),{_variant:m,values:d}=this._getStringValues(t),{_variant:C,values:_}=this._getStringValues(u,!1);u=C;const E=Math.max(e.isArray()?e.getRowCount():1,c.isArray()?c.getRowCount():1,l.isArray()?l.getRowCount():1),R=Math.max(e.isArray()?e.getColumnCount():1,c.isArray()?c.getColumnCount():1,l.isArray()?l.getColumnCount():1),b=O(E,R,e,g.create(h.NA)),N=O(E,R,c,g.create(h.NA)),V=O(E,R,l,g.create(h.NA)),S=this._getResultArray(b,m,u,N,V,f,d,_);return E===1&&R===1?S.get(0,0):S.map(D=>D.get(0,0))}_getStringValues(e,t=!0){let r=e;const n=[];if(r.isArray())r.iterator(s=>{if(s!=null&&s.isError())return r=s,!1;if(s!=null&&s.isNull()&&t)return r=g.create(h.VALUE),!1;const a=this._getRegExpStringValue(s);if(a==="")return r=g.create(h.VALUE),!1;n.push(a)});else{r.isNull()&&t&&(r=g.create(h.VALUE));const s=this._getRegExpStringValue(r);s===""&&(r=g.create(h.VALUE)),n.push(s)}return{_variant:r,values:n}}_getResultArray(e,t,r,n,s,a,u,c){return e.map((f,m,d)=>{let C=n.get(m,d),_=s.get(m,d);const E=this._checkVariantsError(f,t,r,C,_);if(E.isError())return E;if(f.isNull())return g.create(h.VALUE);let R=a;if(R.isArray()){const D=R.getRowCount(),L=R.getColumnCount();if(D>1||L>1)return g.create(h.VALUE);R=R.get(0,0)}let b=`${f.getValue()}`;if(f.isBoolean()&&(b=b.toLocaleUpperCase()),C.isString()&&(C=C.convertToNumberObjectValue(),C.isError()))return C;const N=Math.floor(+C.getValue());if(_.isString()&&(_=_.convertToNumberObjectValue(),_.isError()))return _;const V=Math.floor(+_.getValue());if(V<0||V>1)return g.create(h.VALUE);let S=`${R.getValue()}`;return R.isBoolean()&&(S=S.toLocaleUpperCase()),this._getResult(b,u,c,N,V,S)})}_getResult(e,t,r,n,s,a){const u=new RegExp(r.join("|"),`g${s?"i":""}`),c=new RegExp(t.join("|"),`g${s?"i":""}`),l=e.split(u);let f=1,m=l.map(d=>{let C=d.split(c);return n&&(C=C.filter(_=>_!=="")),f=Math.max(f,C.length),C});return m=m.map(d=>{let C=d;return C.length<f&&(C=C.concat(new Array(f-C.length).fill(a))),C}),Z.createByArray(m)}_checkVariantsError(...e){for(let t=0;t<e.length;t++){const r=e[t];if(r.isError())return r}return F.create(!0)}_getRegExpStringValue(e){let t=e.getValue();return e.isNull()&&(t="\\s"),e.isBoolean()&&(t=t?"TRUE":"FALSE"),t+="",this._escapeRegExp(t)}_escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}}class nR extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return T.create("");let t=`${e.getValue()}`;return e.isBoolean()&&(t=t.toLocaleUpperCase()),t=t.trim().replace(/\s+/g," "),T.create(t)}}const sR=Object.values(M.DataStreamTreeTokenType).filter(i=>[M.DataStreamTreeTokenType.TABLE_START,M.DataStreamTreeTokenType.TABLE_ROW_START,M.DataStreamTreeTokenType.TABLE_CELL_START,M.DataStreamTreeTokenType.TABLE_CELL_END,M.DataStreamTreeTokenType.TABLE_ROW_END,M.DataStreamTreeTokenType.TABLE_END,M.DataStreamTreeTokenType.CUSTOM_BLOCK].includes(i));class aR extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=B(e);if(t)return r;const[s]=n,a=Math.floor(+s.getValue());if(a<1||a>1114111)return g.create(h.VALUE);if(a===1114111||a===1114110)return g.create(h.NA);let u=String.fromCharCode(a);return sR.some(c=>c===u)&&(u=""),T.create(u)}}class iR extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return g.create(h.VALUE);let t=e.getValue().toLocaleString();e.isBoolean()&&(t=t.toLocaleUpperCase());const r=t.charCodeAt(0);return y.create(r)}}class oR extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return T.create("");const t=`${e.getValue()}`.toLocaleUpperCase();return T.create(t)}}class uR extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isBoolean())return g.create(h.VALUE);let t=e;if(e.isString()&&(t=t.convertToNumberObjectValue(),t.isError()))return t;const r=+t.getValue();return y.create(r)}}class cR extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){const r=t!=null?t:y.create(0),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,r,g.create(h.NA)),c=a.mapValue((l,f,m)=>{const d=u.get(f,m);return l.isError()?l:d.isError()?d:this._handleSingleObject(l,d)});return n===1&&s===1?c.get(0,0):c}_handleSingleObject(e,t){const{isError:r,errorObject:n,variants:s}=B(t);if(r)return n;const[a]=s,u=Math.floor(+a.getValue());if(u<0||u>1)return g.create(h.VALUE);if(e.isNull())return T.create("");if(e.isBoolean())return e;if(e.isNumber())return y.create(e.getValue());const c=u?`"${e.getValue()}"`:`${e.getValue()}`;return T.create(c)}}const lc=[[aE,J.ASC],[sE,J.ARRAYTOTEXT],[iE,J.BAHTTEXT],[uE,J.CHAR],[cE,J.CLEAN],[lE,J.CODE],[fE,J.CONCAT],[mE,J.CONCATENATE],[hE,J.DBCS],[gE,J.DOLLAR],[dE,J.EXACT],[CE,J.FIND],[AE,J.FINDB],[EE,J.FIXED],[RE,J.LEFT],[bE,J.LEFTB],[yE,J.LEN],[NE,J.LENB],[pE,J.LOWER],[VE,J.MID],[OE,J.MIDB],[wE,J.NUMBERSTRING],[LE,J.NUMBERVALUE],[BE,J.REGEXEXTRACT],[kE,J.REGEXMATCH],[$E,J.REGEXREPLACE],[PE,J.PROPER],[YE,J.REPLACE],[HE,J.REPLACEB],[GE,J.REPT],[WE,J.RIGHT],[QE,J.RIGHTB],[qE,J.SEARCH],[XE,J.SEARCHB],[KE,J.SUBSTITUTE],[ZE,J.T],[zE,J.TEXT],[JE,J.TEXTAFTER],[eR,J.TEXTBEFORE],[tR,J.TEXTJOIN],[rR,J.TEXTSPLIT],[nR,J.TRIM],[aR,J.UNICHAR],[iR,J.UNICODE],[oR,J.UPPER],[uR,J.VALUE],[cR,J.VALUETOTEXT]],fc=[];var mc=(i=>i)(mc||{});function hc(i){return i.map(o=>o.map(e=>typeof e=="number"?On(e):e))}function lR(i,o=!1){if(i.isReferenceObject()){const e=i.toArrayValueObject().toValue();return o?hc(e):e}else if(i.isArray()){const e=i.toValue();return o?hc(e):e}else if(i.isNumber()){const e=i.getValue();return o?On(e):e}return i.getValue()}class fR extends p{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;const t=De(e),r=encodeURIComponent(t).replace(/[!~'()*]/g,n=>`%${n.charCodeAt(0).toString(16).toLocaleUpperCase()}`);return T.create(r)}}const gc=[[fR,ns.ENCODEURL]];class va extends M.Disposable{constructor(){super(...arguments);A(this,"_allSubjects",[]);A(this,"_computingStatus$",new we.BehaviorSubject(!0));A(this,"computingStatus$",this._computingStatus$.pipe(we.distinctUntilChanged()));A(this,"_computingSubscription")}get computingStatus(){return this._computingStatus$.getValue()}dispose(){var e;super.dispose(),(e=this._computingSubscription)==null||e.unsubscribe(),this._computingStatus$.next(!0),this._computingStatus$.complete(),this._allSubjects.forEach(t=>{t.complete()})}pushComputingStatusSubject(e){return this._allSubjects.push(e),this._updateComputingObservable(),{dispose:()=>{const t=this._allSubjects.indexOf(e);t!==-1&&this._allSubjects.splice(t,1),this._updateComputingObservable()}}}_updateComputingObservable(){var e;if((e=this._computingSubscription)==null||e.unsubscribe(),this._allSubjects.length===0){this._computingStatus$.next(!0);return}this._computingSubscription=we.combineLatest(this._allSubjects).pipe(we.map(t=>t.every(r=>r))).subscribe(t=>this._computingStatus$.next(t))}}var mR=Object.getOwnPropertyDescriptor,hR=(i,o,e,t)=>{for(var r=t>1?void 0:t?mR(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},dc=(i,o)=>(e,t)=>o(e,t,i);let Ia=class extends M.Disposable{constructor(o,e){super();A(this,"_computingCompleted$",new we.Observable(o=>{this._commandService.onCommandExecuted(e=>{if(e.id!==Mr.id)return;const t=e.params;if(t.stageInfo)return o.next(t.stageInfo.stage===qe.IDLE||t.stageInfo.stage===qe.CALCULATION_COMPLETED)})}).pipe(we.distinctUntilChanged(),we.shareReplay()));this._commandService=o,this._globalComputingSrv=e;const t=new M.DisposableCollection,r=new we.BehaviorSubject(!0);t.add(this._globalComputingSrv.pushComputingStatusSubject(r)),t.add(this._computingCompleted$.subscribe(n=>r.next(n))),t.add(()=>r.complete()),this.disposeWithMe(t)}};Ia=hR([dc(0,M.ICommandService),dc(1,M.Inject(va))],Ia);var gR=Object.getOwnPropertyDescriptor,dR=(i,o,e,t)=>{for(var r=t>1?void 0:t?gR(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},as=(i,o)=>(e,t)=>o(e,t,i);let is=class extends M.Disposable{constructor(i,o,e,t){super(),this._commandService=i,this._functionService=o,this._configService=e,this._dataSyncPrimaryController=t,this._initialize()}_initialize(){this._registerCommands(),this._registerFunctions()}_registerCommands(){[Rs,Jr,bs,_s,As,Mr,Es,an,Cs,on,un,cn,ln,yi,Ni,ys,gi].forEach(i=>{var o;this._commandService.registerCommand(i),(o=this._dataSyncPrimaryController)==null||o.registerSyncingMutations(i)})}_registerFunctions(){var e;const i=this._configService.getConfig(fn),o=[...yo,...Vu,...Ou,...Du,...ju,...xu,...ku,...$u,...Yu,...Hu,...Qu,...qu,...Zu,...lc,...fc,...gc].concat((e=i==null?void 0:i.function)!=null?e:[]).map(t=>{const r=t[0],n=t[1];return new r(n)});this._functionService.registerExecutors(...o)}};is=dR([as(0,M.ICommandService),as(1,Ot),as(2,M.IConfigService),as(3,M.Optional(bc.DataSyncPrimaryController))],is);var CR=Object.getOwnPropertyDescriptor,_R=(i,o,e,t)=>{for(var r=t>1?void 0:t?CR(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},os=(i,o)=>(e,t)=>o(e,t,i);let us=class extends M.Disposable{constructor(i,o,e){super(),this._commandService=i,this._dependencyManagerService=o,this._featureCalculationManagerService=e,this._initialize()}_initialize(){this._commandExecutedListener(),this._featureCalculationManagerServiceListener()}_featureCalculationManagerServiceListener(){this.disposeWithMe(this._featureCalculationManagerService.onChanged$.subscribe(i=>{const{unitId:o,subUnitId:e,featureIds:t}=i;this._dependencyManagerService.removeFeatureFormulaDependency(o,e,t)}))}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(i=>{if(i.id===un.id){const o=i.params;if(o==null)return;const{featureIds:e,unitId:t,subUnitId:r}=o;this._dependencyManagerService.removeFeatureFormulaDependency(t,r,e)}else if(i.id===on.id){const o=i.params;if(o==null)return;const{featureId:e,calculationParam:t}=o,{unitId:r,subUnitId:n}=t;this._dependencyManagerService.removeFeatureFormulaDependency(r,n,[e])}else if(i.id===ln.id){const o=i.params;if(o==null)return;this._dependencyManagerService.removeOtherFormulaDependency(o.unitId,o.subUnitId,o.formulaIdList)}else if(i.id===cn.id){const o=i.params;if(o==null)return;const e=o.formulaMap,t=[];Object.keys(e).forEach(r=>{t.push(r)}),this._dependencyManagerService.removeOtherFormulaDependency(o.unitId,o.subUnitId,t)}else if(i.id===Rs.id){const o=i.params.formulaData;Object.keys(o).forEach(e=>{const t=o[e];if(t!==void 0){if(t===null){this._dependencyManagerService.clearFormulaDependency(e);return}Object.keys(t).forEach(r=>{const n=t[r];if(n!==void 0){if(n===null)return this._dependencyManagerService.clearFormulaDependency(e,r),!0;new M.ObjectMatrix(n).forValue((s,a)=>{this._dependencyManagerService.removeFormulaDependency(e,r,s,a)})}})}})}else i.id===an.id&&this._handleSetDefinedName(i)}))}_handleSetDefinedName(i){const o=i.params;if(o==null)return;const{unitId:e,name:t}=o;this._dependencyManagerService.removeFormulaDependencyByDefinedName(e,t)}};us=_R([os(0,M.ICommandService),os(1,dr),os(1,vr),os(2,dr)],us);var AR=Object.getOwnPropertyDescriptor,ER=(i,o,e,t)=>{for(var r=t>1?void 0:t?AR(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},Cc=(i,o)=>(e,t)=>o(e,t,i);let cs=class extends M.Disposable{constructor(i,o){super(),this._commandService=i,this._featureCalculationManagerService=o,this._initialize()}_initialize(){this._commandExecutedListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(i=>{if(i.id===on.id){const o=i.params;if(o==null)return;const{featureId:e,calculationParam:t}=o,{unitId:r,subUnitId:n}=t;this._featureCalculationManagerService.register(r,n,e,t)}else if(i.id===un.id){const o=i.params;if(o==null)return;const{featureIds:e,unitId:t,subUnitId:r}=o;this._featureCalculationManagerService.remove(t,r,e)}}))}};cs=ER([Cc(0,M.ICommandService),Cc(1,dr)],cs);var RR=Object.getOwnPropertyDescriptor,bR=(i,o,e,t)=>{for(var r=t>1?void 0:t?RR(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},Fa=(i,o)=>(e,t)=>o(e,t,i);let ls=class extends M.Disposable{constructor(i,o,e){super(),this._commandService=i,this._otherFormulaManagerService=o,this._dependencyManagerService=e,this._initialize()}_initialize(){this._commandExecutedListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(i=>{if(i.id===cn.id){const o=i.params;if(o==null)return;const e={[o.unitId]:{[o.subUnitId]:o.formulaMap}};this._otherFormulaManagerService.batchRegister(e)}else if(i.id===ln.id){const o=i.params;if(o==null)return;const e={};o.formulaIdList.forEach(r=>e[r]=!0);const t={[o.unitId]:{[o.subUnitId]:e}};this._otherFormulaManagerService.batchRemove(t)}}))}};ls=bR([Fa(0,M.ICommandService),Fa(1,jn),Fa(2,vr)],ls);var yR=Object.getOwnPropertyDescriptor,NR=(i,o,e,t)=>{for(var r=t>1?void 0:t?yR(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},_c=(i,o)=>(e,t)=>o(e,t,i);let fs=class extends M.Disposable{constructor(i,o){super(),this._commandService=i,this._superTableService=o,this._initialize()}_initialize(){this._commandExecutedListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(i=>{if(i.id===an.id){const o=i.params;if(o==null)return;const{unitId:e,tableName:t,reference:r}=o;this._superTableService.registerTable(e,t,r)}else if(i.id===Cs.id){const o=i.params;if(o==null)return;const{unitId:e,tableName:t}=o;this._superTableService.remove(e,t)}else if(i.id===ys.id){const o=i.params;if(o==null)return;const{tableOption:e,tableOptionType:t}=o;this._superTableService.registerTableOptionMap(e,t)}}))}};fs=NR([_c(0,M.ICommandService),_c(1,$t)],fs);class Ac extends M.Disposable{constructor(){super(...arguments);A(this,"_dirtyConversionMap",new Map)}dispose(){this._dirtyConversionMap.clear()}remove(e){this._dirtyConversionMap.delete(e)}get(e){return this._dirtyConversionMap.get(e)}has(e){return this._dirtyConversionMap.has(e)}register(e,t){this._dirtyConversionMap.set(e,t)}getDirtyConversionMap(){return this._dirtyConversionMap}}const Ec=M.createIdentifier("univer.formula.active-dirty-manager.service");var pR=Object.getOwnPropertyDescriptor,VR=(i,o,e,t)=>{for(var r=t>1?void 0:t?pR(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},Rc=(i,o)=>(e,t)=>o(e,t,i);const OR="UNIVER_ENGINE_FORMULA_PLUGIN";w.UniverFormulaEnginePlugin=(Ba=class extends M.Plugin{constructor(o=Si,e,t){super(),this._config=o,this._injector=e,this._configService=t;const{...r}=M.merge({},Si,this._config);this._configService.setConfig(fn,r)}onStarting(){this._initialize(),this._initializeWithOverride()}onReady(){var o;M.touchDependencies(this._injector,[[is],[fs]]),(o=this._config)!=null&&o.notExecuteFormula||M.touchDependencies(this._injector,[[ls],[cs],[us],[w.CalculateController]])}onRendered(){var o;(o=this._config)!=null&&o.notExecuteFormula||M.touchDependencies(this._injector,[[vn],[Tn]])}_initialize(){const o=!this._config.notExecuteFormula,e=[[Ot,{useClass:ro}],[kt,{useClass:w.DefinedNamesService}],[Ec,{useClass:Ac}],[zs,{useClass:w.HyperlinkEngineFormulaService}],[ws,{useClass:Mi}],[$t,{useClass:bi}],[va],[w.FormulaDataModel],[is],[fs],[Ia]];o&&e.push([jn,{useClass:Co}],[it,{useClass:w.FormulaRuntimeService}],[Nt,{useClass:w.FormulaCurrentConfigService}],[dr,{useClass:go}],[w.CalculateController],[ls],[us],[cs],[w.Interpreter],[w.AstTreeBuilder],[w.Lexer],[ea],[w.FunctionNodeFactory],[w.LambdaNodeFactory],[sa],[w.OperatorNodeFactory],[w.PrefixNodeFactory],[w.ReferenceNodeFactory],[w.SuffixNodeFactory],[w.UnionNodeFactory],[ia]),e.forEach(t=>this._injector.add(t))}_initializeWithOverride(){var o;this._injector.add([Dr,{useClass:Dr}]),(o=this._config)!=null&&o.notExecuteFormula||[[vn,{useClass:w.CalculateFormulaService}],[vr,{useClass:ho}],[Tn,{useClass:w.FormulaDependencyGenerator}]].forEach(t=>this._injector.add(t))}},A(Ba,"pluginName",OR),Ba),w.UniverFormulaEnginePlugin=VR([Rc(1,M.Inject(M.Injector)),Rc(2,M.IConfigService)],w.UniverFormulaEnginePlugin),w.ActiveDirtyManagerService=Ac,w.ArrayValueObject=Z,w.AstRootNodeFactory=ea,w.AsyncArrayObject=zi,w.AsyncCustomFunction=Oh,w.AsyncObject=Zi,w.BaseFunction=p,w.BaseReferenceObject=Wt,w.BaseValueObject=pt,w.BooleanValue=St,w.BooleanValueObject=F,w.CustomFunction=Mu,w.DEFAULT_INTERVAL_COUNT=Ao,w.DEFAULT_TOKEN_LAMBDA_FUNCTION_NAME=or,w.DEFAULT_TOKEN_LET_FUNCTION_NAME=hi,w.DEFAULT_TOKEN_TYPE_LAMBDA_PARAMETER=Bt,w.DEFAULT_TOKEN_TYPE_PARAMETER=nt,w.DEFAULT_TOKEN_TYPE_ROOT=Rt,w.DependencyManagerBaseService=mo,w.DependencyManagerService=ho,w.ENGINE_FORMULA_CYCLE_REFERENCE_COUNT=Cl,w.ENGINE_FORMULA_PLUGIN_CONFIG_KEY=fn,w.ERROR_TYPE_SET=Dt,w.ErrorType=h,w.ErrorValueObject=g,w.FUNCTION_NAMES_ARRAY=Fn,w.FUNCTION_NAMES_COMPATIBILITY=he,w.FUNCTION_NAMES_CUBE=Su,w.FUNCTION_NAMES_DATABASE=He,w.FUNCTION_NAMES_DATE=Ae,w.FUNCTION_NAMES_ENGINEERING=X,w.FUNCTION_NAMES_FINANCIAL=ee,w.FUNCTION_NAMES_INFORMATION=ye,w.FUNCTION_NAMES_LOGICAL=Ee,w.FUNCTION_NAMES_LOOKUP=ne,w.FUNCTION_NAMES_MATH=$,w.FUNCTION_NAMES_STATISTICAL=x,w.FUNCTION_NAMES_TEXT=J,w.FUNCTION_NAMES_UNIVER=mc,w.FUNCTION_NAMES_WEB=ns,w.FeatureCalculationManagerService=go,w.FormulaDependencyTree=Un,w.FormulaDependencyTreeType=xn,w.FormulaDependencyTreeVirtual=oa,w.FormulaExecuteStageType=qe,w.FormulaExecutedStateType=hr,w.FunctionService=ro,w.FunctionType=Ha,w.GlobalComputingStatusService=va,w.IActiveDirtyManagerService=Ec,w.ICalculateFormulaService=vn,w.IDefinedNamesService=kt,w.IDependencyManagerService=vr,w.IFeatureCalculationManagerService=dr,w.IFormulaCurrentConfigService=Nt,w.IFormulaDependencyGenerator=Tn,w.IFormulaRuntimeService=it,w.IFunctionService=Ot,w.IHyperlinkEngineFormulaService=zs,w.IOtherFormulaManagerService=jn,w.ISheetRowFilteredService=ws,w.ISuperTableService=$t,w.LambdaParameterNodeFactory=sa,w.LambdaValueObjectObject=Ln,w.LexerNode=oe,w.LexerTreeBuilder=Dr,w.NEW_EXCEL_FUNCTIONS=U_,w.NullValueObject=le,w.NumberValueObject=y,w.OPERATOR_TOKEN_SET=lt,w.OtherFormulaManagerService=Co,w.RangeReferenceObject=Pr,w.RegisterFunctionMutation=gi,w.RemoveDefinedNameMutation=Cs,w.RemoveFeatureCalculationMutation=un,w.RemoveOtherFormulaMutation=ln,w.RemoveSuperTableMutation=Ni,w.SUFFIX_TOKEN_SET=qr,w.SetArrayFormulaDataMutation=Jr,w.SetDefinedNameMutation=an,w.SetDefinedNameMutationFactory=ul,w.SetFeatureCalculationMutation=on,w.SetFormulaCalculationNotificationMutation=Mr,w.SetFormulaCalculationResultMutation=Es,w.SetFormulaCalculationStartMutation=_s,w.SetFormulaCalculationStopMutation=As,w.SetFormulaDataMutation=Rs,w.SetImageFormulaDataMutation=bs,w.SetOtherFormulaMutation=cn,w.SetSuperTableMutation=yi,w.SetSuperTableOptionMutation=ys,w.SheetRowFilteredService=Mi,w.StringValueObject=T,w.SuperTableService=bi,w.ValueNodeFactory=ia,w.ValueObjectFactory=ht,w.compareToken=H,w.convertUnitDataToRuntime=fi,w.deserializeRangeForR1C1=bo,w.deserializeRangeWithSheet=ur,w.deserializeRangeWithSheetWithCache=Yt,w.extractFormulaError=yl,w.functionArray=yo,w.functionCompatibility=Vu,w.functionCube=Ou,w.functionDatabase=Du,w.functionDate=ju,w.functionEngineering=xu,w.functionFinancial=ku,w.functionInformation=$u,w.functionLogical=Yu,w.functionLookup=Hu,w.functionMath=Qu,w.functionMeta=qu,w.functionStatistical=Zu,w.functionText=lc,w.functionUniver=fc,w.functionWeb=gc,w.generateAstNode=ta,w.generateExecuteAstNodeData=na,w.generateRandomDependencyTreeId=Qt,w.generateStringWithSequence=ps,w.getAbsoluteRefTypeWitString=Jc,w.getAbsoluteRefTypeWithSingleString=Or,w.getObjectValue=lR,w.getRangeWithRefsString=tl,w.handleNumfmtInCell=Sl,w.handleRefStringInfo=rn,w.includeFormulaLexerToken=Wa,w.initSheetFormulaData=Ss,w.isFormulaLexerToken=yr,w.isInDirtyRange=$a,w.isReferenceString=gs,w.isReferenceStringWithEffectiveColumn=Sr,w.isReferenceStrings=Ei,w.matchRefDrawToken=Vc,w.matchToken=K,w.needsQuoting=nn,w.normalizeSheetName=pc,w.operatorToken=z,w.prefixToken=Me,w.quoteSheetName=sn,w.sequenceNodeType=Te,w.serializeRange=bt,w.serializeRangeToRefString=en,w.serializeRangeWithSheet=Ci,w.serializeRangeWithSpreadsheet=_i,w.singleReferenceToGrid=tn,w.strip=Gs,w.stripErrorMargin=On,w.unquoteSheetName=ds,Object.defineProperty(w,Symbol.toStringTag,{value:"Module"})}));

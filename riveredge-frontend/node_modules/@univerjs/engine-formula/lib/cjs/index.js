"use strict";var yc=Object.defineProperty;var pc=(i,o,e)=>o in i?yc(i,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[o]=e;var A=(i,o,e)=>pc(i,typeof o!="symbol"?o+"":o,e);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const M=require("@univerjs/core"),Fe=require("rxjs"),Nc=require("@univerjs/rpc");var xt=(i=>(i.FALSE="FALSE",i.TRUE="TRUE",i))(xt||{}),wt=(i=>(i[i.SUCCESS=0]="SUCCESS",i[i.ERROR=1]="ERROR",i))(wt||{}),Oe=(i=>(i.ALL="#All",i.DATA="#Data",i.HEADERS="#Headers",i.TOTALS="#Totals",i.THIS_ROW="#This Row",i))(Oe||{}),st=(i=>(i[i.FRONT=0]="FRONT",i[i.BACK=1]="BACK",i))(st||{});function Ti(i,o,e,t,r){for(let n=0,s=i.length;n<s;n++){const a=i[n];if(o!==a.unitId||e!==a.sheetId)continue;const{startRow:u,startColumn:c,endRow:l,endColumn:f}=a.range;if(t>=u&&t<=l&&r>=c&&r<=f)return!0}return!1}var h=(i=>(i.DIV_BY_ZERO="#DIV/0!",i.NAME="#NAME?",i.VALUE="#VALUE!",i.NUM="#NUM!",i.NA="#N/A",i.CYCLE="#CYCLE!",i.REF="#REF!",i.SPILL="#SPILL!",i.CALC="#CALC!",i.ERROR="#ERROR!",i.CONNECT="#GETTING_DATA",i.NULL="#NULL!",i))(h||{});const vt=new Set(Object.values(h)),ka=[...new Set(Object.values(h).map(i=>i.length))];var vi=(i=>(i[i.Financial=0]="Financial",i[i.Date=1]="Date",i[i.Math=2]="Math",i[i.Statistical=3]="Statistical",i[i.Lookup=4]="Lookup",i[i.Database=5]="Database",i[i.Text=6]="Text",i[i.Logical=7]="Logical",i[i.Information=8]="Information",i[i.Engineering=9]="Engineering",i[i.Cube=10]="Cube",i[i.Compatibility=11]="Compatibility",i[i.Web=12]="Web",i[i.Array=13]="Array",i[i.Univer=14]="Univer",i[i.User=15]="User",i[i.DefinedName=16]="DefinedName",i[i.Table=17]="Table",i))(vi||{}),Z=(i=>(i.PLUS="+",i.MINUS="-",i.MULTIPLY="*",i.DIVIDED="/",i.CONCATENATE="&",i.POWER="^",i.EQUALS="=",i.NOT_EQUAL="<>",i.GREATER_THAN=">",i.GREATER_THAN_OR_EQUAL=">=",i.LESS_THAN="<",i.LESS_THAN_OR_EQUAL="<=",i))(Z||{}),Y=(i=>(i.EQUALS="=",i.NOT_EQUAL="<>",i.GREATER_THAN=">",i.GREATER_THAN_OR_EQUAL=">=",i.LESS_THAN="<",i.LESS_THAN_OR_EQUAL="<=",i))(Y||{});const tn=new Map([["<>",4],["<",4],[">=",4],["=",4],[">",4],["<=",4],["&",3],["+",2],["-",2],["/",1],["*",1],["^",0]]),lt=new Set(tn.keys()),Vc=new Set(["=","<>",">",">=","<","<="]);var X=(i=>(i.OPEN_BRACKET="(",i.CLOSE_BRACKET=")",i.COMMA=",",i.SINGLE_QUOTATION="'",i.DOUBLE_QUOTATION='"',i.OPEN_BRACES="{",i.CLOSE_BRACES="}",i.COLON=":",i.OPEN_SQUARE_BRACKET="[",i.CLOSE_SQUARE_BRACKET="]",i))(X||{}),Xe=(i=>(i.PERCENTAGE="%",i.POUND="#",i))(Xe||{});const rn=new Set(["%","#"]);var Se=(i=>(i.AT="@",i.MINUS="-",i.PLUS="+",i))(Se||{});const Oc=" ",Ii=[...Object.values(Y),...Object.values(Z),...Object.values(X),...Object.values(Xe),...Object.values(Se)];function pr(i){return Ii.includes(i)}function Fi(i){for(const o of Ii)if(i.indexOf(o)>-1)return!0;return!1}function Sc(i){return i[0]==="'"&&i[i.length-1]==="'"?i.substring(1,i.length-1):i}function Mc(i){return pr(i)&&i!==X.CLOSE_BRACES&&i!==X.CLOSE_BRACKET&&i!==X.SINGLE_QUOTATION&&i!==X.DOUBLE_QUOTATION||i===" "}const Dc=new Set([Z.PLUS,Z.MINUS,Z.MULTIPLY,Z.DIVIDED,Z.CONCATENATE,Z.POWER,Z.EQUALS,Z.NOT_EQUAL,Z.GREATER_THAN,Z.GREATER_THAN_OR_EQUAL,Z.LESS_THAN,Z.LESS_THAN_OR_EQUAL,X.OPEN_BRACKET,X.COMMA,X.COLON,X.OPEN_BRACES,X.OPEN_SQUARE_BRACKET]);function wc(i){return Dc.has(i)}const Lc=new Set([Z.PLUS,Z.MINUS,Z.MULTIPLY,Z.DIVIDED,Z.CONCATENATE,Z.POWER,Z.EQUALS,Z.NOT_EQUAL,Z.GREATER_THAN,Z.GREATER_THAN_OR_EQUAL,Z.LESS_THAN,Z.LESS_THAN_OR_EQUAL,X.OPEN_BRACKET,X.COMMA,X.COLON,X.OPEN_BRACES,X.OPEN_SQUARE_BRACKET,Xe.PERCENTAGE,Xe.POUND]);function Pc(i){return Lc.has(i)}const _r='\\[([^\\[\\]\\/?:"<>|*\\\\]+)\\]',$a=new RegExp(_r),xc="((?![\\[\\]\\/?*\\\\]).)*!",jt="$",vn="\\s*?:\\s*?",fn="[A-Za-z]+",mn="[1-9][0-9]*",Ar=`'?(${_r})?(${xc})?'?`,ps=`\\${jt}?${fn}\\${jt}?${mn}`,jc=`^(${Se.AT})?${Ar}${ps}${vn}${ps}$`,Ya=new RegExp(jc),Uc=`^${Ar}\\s*?${ps}(${Xe.POUND})?$`,Ha=new RegExp(Uc),Tc=`^${Ar}\\${jt}?${mn}${vn}\\${jt}?${mn}$`,Ga=new RegExp(Tc),vc=`^${Ar}\\${jt}?${fn}${vn}\\${jt}?${fn}$`,Wa=new RegExp(vc),Ic=`^${Ar}\\s*?\\${jt}?${mn}$`,Qa=new RegExp(Ic),Fc=`^${Ar}\\s*?\\${jt}?${fn}$`,qa=new RegExp(Fc),Or="((?![~!@#$%^&*()_+<>?:,./;’，。、‘：“《》？~！@#￥%……（）【】\\[\\]\\/\\\\]).)+",Bi="\\[#.+\\]\\s*?,\\s*?",hn="\\[((?<!#).)*\\]",Xa=`${hn}${vn}${hn}`,Bc=`^(${_r})?${Or}$`,kc=`^(${_r})?${Or}(${hn}|\\[${Bi}${hn}\\])+$`,$c=`^(${_r})?${Or}(\\[${Xa}\\])?$|^${Or}(\\[${Bi}${Xa}\\])?$`,Yc=`^(${_r})?${Or}\\[\\s*#([^\\]]+)\\s*\\]$`,Ka=new RegExp(Bc),Za=new RegExp(kc),za=new RegExp($c),Ja=new RegExp(Yc),Hc="{.*?}",ei=new RegExp(Hc,"g");function jr(i){return Ha.lastIndex=0,Ha.test(i)}function Gc(i){return Ya.lastIndex=0,Ya.test(i)}function ki(i){return Ga.lastIndex=0,Ga.test(i)}function $i(i){return Wa.lastIndex=0,Wa.test(i)}function Yi(i){return Qa.lastIndex=0,Qa.test(i)}function Hi(i){return qa.lastIndex=0,qa.test(i)}function Wc(i){return Ka.lastIndex=0,Ka.test(i)}function Qc(i){return Za.lastIndex=0,Za.test(i)}function qc(i){return za.lastIndex=0,za.test(i)}function Xc(i){return Ja.lastIndex=0,Ja.test(i)}function Kc(i){return ei.lastIndex=0,ei.test(i)}function Xs(i){return jr(i)||Gc(i)||ki(i)||$i(i)}function Gi(i){const o={};return Object.keys(i).forEach(e=>{const t=i[e];if(t==null)return!0;o[e]==null&&(o[e]={}),Object.keys(t).forEach(r=>{const n=t[r];o[e][r]=new M.ObjectMatrix(n)})}),o}function Zc(i){const o={};for(const e in i){const t=i[e];if(t!=null){o[e]==null&&(o[e]={});for(const r in t){const n=t[r],s={};n.forValue((a,u,c)=>{s[a]===void 0&&(s[a]={}),s[a][u]=c}),o[e][r]=s}}}return o}const nt="P_1",Rt="R_1",Xt="L_1",Ur="LR_1",Wi="LO_1",Qi="LET",lr="LAMBDA",zc="CUBE",Jc=new Set(["RAND","RANDBETWEEN","NOW","TODAY"]),qi={id:"formula.mutation.register-function",type:M.CommandType.MUTATION,handler:()=>!0},gn={id:"formula.mutation.set-array-formula-data",type:M.CommandType.MUTATION,handler:(i,o)=>!0},el=/[^0-9]/g,tl=/[^A-Za-z]/g;function Nr(i){let o=i[0]==="$";const e=i.substring(1);let t=e.indexOf("$")>-1;return M.Tools.isStringNumber(e)&&o&&!t&&(o=!1,t=!0),o&&t?M.AbsoluteRefType.ALL:o?M.AbsoluteRefType.COLUMN:t?M.AbsoluteRefType.ROW:M.AbsoluteRefType.NONE}function rl(i){const o=i.split("!");o.length>1&&(i=o[o.length-1]);const e=i.split(":");return e.length>1?{startAbsoluteRefType:Nr(e[0]),endAbsoluteRefType:Nr(e[1])}:{startAbsoluteRefType:Nr(e[0])}}function ti(i=M.AbsoluteRefType.NONE){let o="",e="";return i===M.AbsoluteRefType.ROW?o="$":i===M.AbsoluteRefType.COLUMN?e="$":i===M.AbsoluteRefType.ALL&&(o="$",e="$"),{rowAbsoluteString:o,columnAbsoluteString:e}}function bt(i){const{startColumn:o,startRow:e,endColumn:t,endRow:r,startAbsoluteRefType:n,endAbsoluteRefType:s,rangeType:a=M.RANGE_TYPE.NORMAL}=i,u=ti(n),c=ti(s);if(a===M.RANGE_TYPE.ROW||a===M.RANGE_TYPE.ALL){const m=`${u.rowAbsoluteString}${e+1}`,d=`${c.rowAbsoluteString}${r+1}`;return`${m}:${d}`}if(a===M.RANGE_TYPE.COLUMN){const m=`${u.columnAbsoluteString}${M.Tools.chatAtABC(o)}`,d=`${c.columnAbsoluteString}${M.Tools.chatAtABC(t)}`;return`${m}:${d}`}const l=`${u.columnAbsoluteString}${M.Tools.chatAtABC(o)}${u.rowAbsoluteString}${e+1}`,f=`${c.columnAbsoluteString}${M.Tools.chatAtABC(t)}${c.rowAbsoluteString}${r+1}`;return l===f?l:`${l}:${f}`}function Xi(i,o){return`${Ji(i)}!${bt(o)}`}function Ki(i,o,e){return Cn(i)||Cn(o)?`'[${_n(i)}]${_n(o)}'!${bt(e)}`:`[${i}]${o}!${bt(e)}`}function dn(i){const{unitId:o,sheetName:e,range:t}=i;return o!=null&&o.length>0&&e!=null&&e.length>0?Ki(o,e,t):e!=null&&e.length>0?Xi(e,t):bt(t)}function nn(i){const o=Number.parseInt(i.replace(el,""))-1,e=M.Tools.ABCatNum(i.replace(tl,"")),t=Nr(i);return{row:o,column:e,absoluteRefType:t}}function In(i){const o=$a.exec(i);let e="";o!=null&&(e=o[0].trim(),e=Ns(e.slice(1,e.length-1)),i=i.replace($a,""));const t=i.indexOf("!");let r="",n="";return t>-1?(r=i.substring(0,t),r[0]==="'"&&r[r.length-1]==="'"&&(r=r.substring(1,r.length-1)),r=Ns(r),n=i.substring(t+1)):n=i,{refBody:n,sheetName:r,unitId:e}}function fr(i){const{refBody:o,sheetName:e,unitId:t}=In(i),r=o.indexOf(":");if(r===-1){const C=nn(o),_=C.row,E=C.column,R=C.absoluteRefType;return{unitId:t,sheetName:e,range:{startRow:_,startColumn:E,endRow:_,endColumn:E,startAbsoluteRefType:R,endAbsoluteRefType:R}}}const n=o.substring(0,r),s=o.substring(r+1),a=nn(n),u=nn(s),c=a.row>u.row?u.row:a.row,l=a.column>u.column?u.column:a.column,f=a.row>u.row?a.row:u.row,m=a.column>u.column?a.column:u.column;let d=M.RANGE_TYPE.NORMAL;return Number.isNaN(c)&&Number.isNaN(f)?d=M.RANGE_TYPE.COLUMN:Number.isNaN(l)&&Number.isNaN(m)&&(d=M.RANGE_TYPE.ROW),{unitId:t,sheetName:e,range:{startRow:c,startColumn:l,endRow:f,endColumn:m,startAbsoluteRefType:a.absoluteRefType,endAbsoluteRefType:u.absoluteRefType,rangeType:d}}}const nl=["LOG10"];function Vr(i){const o=Zi(i);if(!Xs(o)||nl.includes(o.toUpperCase().trim()))return!1;const{range:e}=fr(o);return!(e.endColumn>=16384)}function Zi(i){const o=[];let e=!1;for(let t=0,r=i.length;t<r;t++){const n=i[t];if(n===Oc&&!e)o.push(n);else{if(!e&&(n===Se.AT||n===Se.MINUS||n===Se.PLUS))continue;o.push(n),e=!0}}return o.join("")}function sl(i,o){const e=(i==null?void 0:i.split(","))||[];return i===""||e.length===0?[]:zi(i)?e.map(n=>{const s=fr(n);return{unitId:s.unitId,sheetId:o(s.sheetName),range:s.range,sheetName:s.sheetName}}):[]}function zi(i){return((i==null?void 0:i.split(","))||[]).every(e=>Vr(e.trim()))}function Cn(i){return i.length===0?!1:!!(Fi(i)||al(i)||il(i)||ol(i)||/[\s!$%^&*()+\-=\[\]{};':"\\|,.<>\/?（）]/.test(i))}function Ji(i){return Cn(i)?`'${_n(i)}'`:i}function _n(i){return i.replace(/'/g,"''")}function Ns(i){return i.replace(/''/g,"'")}function al(i){const o=i.match(/[1-9][0-9]{0,6}/);return/^[A-Z]+[1-9][0-9]{0,6}$/.test(i)&&o!==null}function il(i){return/^(R(-?[0-9]+)?C(-?[0-9]+)?|C(-?[0-9]+)?|R(-?[0-9]+)?)$/.test(i)}function ol(i){return!new RegExp("^\\p{Letter}","u").test(i.charAt(0))}var ul=Object.getOwnPropertyDescriptor,cl=(i,o,e,t)=>{for(var r=t>1?void 0:t?ul(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},ll=(i,o)=>(e,t)=>o(e,t,i);exports.DefinedNamesService=class extends M.Disposable{constructor(e){super();A(this,"_definedNameMap",{});A(this,"_nameCacheMap",{});A(this,"_update$",new Fe.Subject);A(this,"update$",this._update$.asObservable());A(this,"_currentRange",{unitId:"",sheetId:"",range:{startRow:0,endRow:0,startColumn:0,endColumn:0}});A(this,"_currentRange$",new Fe.Subject);A(this,"currentRange$",this._currentRange$.asObservable());A(this,"_focusRange$",new Fe.Subject);A(this,"focusRange$",this._focusRange$.asObservable());this._univerInstanceService=e}dispose(){super.dispose(),this._definedNameMap={},this._nameCacheMap={},this._update$.complete(),this._currentRange$.complete(),this._focusRange$.complete()}getWorksheetByRef(e,t){var n;const{sheetName:r}=In(t);return(n=this._univerInstanceService.getUnit(e))==null?void 0:n.getSheetBySheetName(r)}focusRange(e,t){const r=this.getValueById(e,t);r!==void 0&&this._focusRange$.next({...r,unitId:e})}setCurrentRange(e){this._currentRange=e,this._currentRange$.next(e)}getCurrentRange(){return this._currentRange}getCurrentRangeForString(){return bt(this._currentRange.range)}registerDefinedNames(e,t){this._definedNameMap[e]=t,this._updateCache(e),this._update()}registerDefinedName(e,t){this._definedNameMap[e]===void 0&&(this._definedNameMap[e]={}),this._definedNameMap[e][t.id]=t,this._updateCache(e),this._update()}removeDefinedName(e,t){var r;(r=this._definedNameMap[e])==null||delete r[t],this._updateCache(e),this._update()}removeUnitDefinedName(e){delete this._definedNameMap[e],this._updateCache(e),this._update()}getDefinedNameMap(e){return this._definedNameMap[e]}getValueByName(e,t){const r=this._nameCacheMap[e];if(r)return r[t]||null;const n=this._definedNameMap[e];if(n===void 0)return null;let s=null;for(const a of Object.values(n))if(a.name===t){s=a;break}return s&&(this._nameCacheMap[e]=this._nameCacheMap[e]||{},this._nameCacheMap[e][t]=s),s}getValueById(e,t){var r;return(r=this._definedNameMap[e])==null?void 0:r[t]}hasDefinedName(e){return this._definedNameMap[e]===void 0?!1:(Array.from(Object.values(this._definedNameMap[e])).length||0)!==0}getAllDefinedNames(){return this._definedNameMap}_update(){this._update$.next(null)}_updateCache(e){const t=this._definedNameMap[e];if(t===void 0){delete this._nameCacheMap[e];return}this._nameCacheMap[e]={};for(const r of Object.values(t))this._nameCacheMap[e][r.name]=r}};exports.DefinedNamesService=cl([ll(0,M.IUniverInstanceService)],exports.DefinedNamesService);const er=M.createIdentifier("univer.formula.defined-names.service"),fl=(i,o)=>{const{unitId:e,id:t}=o;return{...i.get(er).getValueById(e,t),unitId:e}},Fn={id:"formula.mutation.set-defined-name",type:M.CommandType.MUTATION,handler:(i,o)=>{if(o==null)return!1;const e=i.get(er),{id:t,unitId:r,name:n,formulaOrRefString:s,comment:a,hidden:u,localSheetId:c,formulaOrRefStringWithPrefix:l}=o;return e.registerDefinedName(r,{id:t,name:n.trim(),formulaOrRefString:s.trim(),comment:a==null?void 0:a.trim(),hidden:u,localSheetId:c,formulaOrRefStringWithPrefix:l}),!0}},Ks={id:"formula.mutation.remove-defined-name",type:M.CommandType.MUTATION,handler:(i,o)=>{if(o==null)return!1;const e=i.get(er),{unitId:t,id:r}=o;return e.removeDefinedName(t,r),!0}},Bn={id:"formula.mutation.set-feature-calculation",type:M.CommandType.MUTATION,handler:()=>!0},kn={id:"formula.mutation.remove-feature-calculation",type:M.CommandType.MUTATION,handler:()=>!0},Zs={id:"formula.mutation.set-formula-calculation-start",type:M.CommandType.MUTATION,handler:()=>!0},zs={id:"formula.mutation.set-formula-calculation-stop",type:M.CommandType.MUTATION,handler:()=>!0},Sr={id:"formula.mutation.set-formula-calculation-notification",type:M.CommandType.MUTATION,handler:()=>!0},Js={id:"formula.mutation.set-formula-calculation-result",type:M.CommandType.MUTATION,handler:()=>!0},ea={id:"formula.mutation.set-formula-data",type:M.CommandType.MUTATION,handler:(i,o)=>!0},ta={id:"formula.mutation.set-image-formula-data",type:M.CommandType.MUTATION,handler:(i,o)=>!0},$n={id:"formula.mutation.set-other-formula",type:M.CommandType.MUTATION,handler:()=>!0},Yn={id:"formula.mutation.remove-other-formula",type:M.CommandType.MUTATION,handler:()=>!0};class eo extends M.Disposable{constructor(){super();A(this,"_tableMap",new Map);A(this,"_tableOptionMap",new Map);A(this,"_update$",new Fe.Subject);A(this,"update$",this._update$.asObservable());this.registerTableOptionMap(Oe.ALL,Oe.ALL),this.registerTableOptionMap(Oe.DATA,Oe.DATA),this.registerTableOptionMap(Oe.HEADERS,Oe.HEADERS),this.registerTableOptionMap(Oe.TOTALS,Oe.TOTALS),this.registerTableOptionMap(Oe.THIS_ROW,Oe.THIS_ROW)}dispose(){super.dispose(),this._update$.complete(),this._tableMap.clear(),this._tableOptionMap.clear()}remove(e,t){var r;(r=this._tableMap.get(e))==null||r.delete(t),this._update()}getTableMap(e){return this._tableMap.get(e)}getTableOptionMap(){return this._tableOptionMap}registerTable(e,t,r){var n;this._tableMap.get(e)==null&&this._tableMap.set(e,new Map),(n=this._tableMap.get(e))==null||n.set(t,r),this._update()}registerTableOptionMap(e,t){this._tableOptionMap.set(e,t)}_update(){this._update$.next(null)}}const tr=M.createIdentifier("univer.formula.super-table.service"),to={id:"formula.mutation.set-super-table",type:M.CommandType.MUTATION,handler:(i,o)=>{const{unitId:e,tableName:t,reference:r}=o;return i.get(tr).registerTable(e,t,r),!0}},ro={id:"formula.mutation.remove-super-table",type:M.CommandType.MUTATION,handler:(i,o)=>{const{unitId:e,tableName:t}=o;return i.get(tr).remove(e,t),!0}},ra={id:"formula.mutation.set-super-table-option",type:M.CommandType.MUTATION,handler:(i,o)=>{const{tableOption:e,tableOptionType:t}=o;return i.get(tr).registerTableOptionMap(e,t),!0}};class yt{constructor(o){A(this,"_cache");this._cache=new M.LRUMap(o)}set(o,e){const t=this._hash(o);this._cache.set(t,e)}get(o){const e=this._hash(o);return this._cache.get(e)}clear(){this._cache.clear()}delete(o){this._cache.delete(this._hash(o))}forEach(o,e){this._cache.forEach(o,e)}_hash(o){return o.length<=64?o:M.hashAlgorithm(o).toString()}}const Vs=new yt(1e5);function Kt(i){const o=Vs.get(i);if(o)return o;const e=fr(i);return Vs.set(i,e),fr(i)}function ml(){Vs.clear()}var Ue=(i=>(i[i.NORMAL=0]="NORMAL",i[i.NUMBER=1]="NUMBER",i[i.STRING=2]="STRING",i[i.FUNCTION=3]="FUNCTION",i[i.REFERENCE=4]="REFERENCE",i[i.ARRAY=5]="ARRAY",i[i.DEFINED_NAME=6]="DEFINED_NAME",i))(Ue||{});function Os(i){let o="";for(const e of i)typeof e=="string"?o+=e:o+=e.token;return o}class ie{constructor(){A(this,"_parent");A(this,"_token",Rt);A(this,"_children",[]);A(this,"_lambdaId");A(this,"_functionDefinitionPrivacyVar");A(this,"_lambdaParameter","");A(this,"_startIndex",-1);A(this,"_endIndex",-1);A(this,"_definedNames",[])}dispose(){var o;this._children.forEach(e=>{typeof e!="string"&&e.dispose()}),(o=this._functionDefinitionPrivacyVar)==null||o.clear(),this._functionDefinitionPrivacyVar=null,this._children=[],this._parent=null,this._definedNames=[]}getDefinedNames(){return this._definedNames}getStartIndex(){return this._startIndex}getLambdaId(){return this._lambdaId}setLambdaId(o){this._lambdaId=o}getFunctionDefinitionPrivacyVar(){return this._functionDefinitionPrivacyVar}setLambdaPrivacyVar(o){this._functionDefinitionPrivacyVar=o}getLambdaParameter(){return this._lambdaParameter}setLambdaParameter(o){this._lambdaParameter=o}getParent(){return this._parent}setParent(o){this._parent=o}getChildren(){return this._children}setChildren(o){this._children=o}addChildren(o){this._children.push(o)}addChildrenFirst(o){this._children.unshift(o)}getToken(){return this._token}setToken(o){this._token=o}setIndex(o,e){this._startIndex=o,this._endIndex=e}setDefinedNames(o){this._definedNames=o}hasDefinedNames(){return this._definedNames.length>0}replaceChild(o,e){const t=this._getIndexInParent(o);t!=null&&(this.getChildren().splice(t,1,e),e.setParent(this))}changeToParent(o){const e=this.getParent();e&&e.removeChild(this),this.setParent(o),o.getChildren().push(this)}removeChild(o){const e=this._getIndexInParent(o);e!=null&&this.getChildren().splice(e,1)}serialize(){const o=this.getToken(),e=this.getChildren(),t=[],r=e.length;for(let n=0;n<r;n++){const s=e[n];s instanceof ie?t.push(s.serialize()):t.push(s)}return{token:o,st:this._startIndex,ed:this._endIndex,children:t}}_getIndexInParent(o){const e=this.getChildren(),t=e.length;for(let r=0;r<t;r++)if(e[r]===o)return r}}const no=2e3,ms=new yt(no),hs=new yt(no);class Mr extends M.Disposable{constructor(){super(...arguments);A(this,"_currentLexerNode",new ie);A(this,"_upLevel",0);A(this,"_segment","");A(this,"_bracketState",[]);A(this,"_squareBracketState",0);A(this,"_bracesState",0);A(this,"_singleQuotationState",0);A(this,"_doubleQuotationState",0);A(this,"_lambdaState",!1);A(this,"_colonState",!1);A(this,"_formulaErrorCount",0);A(this,"_tableBracketState",!1)}dispose(){this._resetTemp(),this._currentLexerNode.dispose(),ms.clear(),hs.clear()}getUpLevel(){return this._upLevel}isColonClose(){return this._colonState===!1}isColonOpen(){return this._colonState===!0}isDoubleQuotationClose(){return this._doubleQuotationState===0}isLambdaOpen(){return this._lambdaState===!0}isLambdaClose(){return this._lambdaState===!1}isSingleQuotationClose(){return this._singleQuotationState===0}isBracesClose(){return this._bracesState===0}isBracketClose(){return this._bracketState.length===0}isSquareBracketClose(){return this._squareBracketState===0}getCurrentLexerNode(){return this._currentLexerNode}getFunctionAndParameter(e,t){const r=this._getCurrentParamIndex(e,t);if(r==null||r===h.VALUE)return;const n=r[0];if(typeof n=="string")return;let s=n.getParent(),a=n;for(;s;){const u=s.getToken();if(u!==nt&&!pr(u)&&s.getStartIndex()!==-1){const c=s.getChildren().indexOf(a);return{functionName:u,paramIndex:c}}a=s,s=s.getParent()}}checkIfAddBracket(e){let t=0,r=e.length-1,n=e[r];for(;(n===X.CLOSE_BRACKET||n===" ")&&r>=0;)n===X.CLOSE_BRACKET&&t++,n=e[--r];const s=this._getCurrentParamIndex(e,e.length-2);if(s==null||s===h.VALUE)return 0;const a=s[0];if(typeof a=="string")return 0;let u=a.getParent(),c=0;for(s[1]===X.OPEN_BRACKET&&c++;u;){const l=u.getToken();l!==nt&&l!==X.COLON&&u.getStartIndex()!==-1&&l.toUpperCase()!==lr&&(t===0?c+=1:t--),u=u.getParent()}return c}sequenceNodesBuilder(e){const t=hs.get(e);if(t)return[...t];const r=this._getSequenceArray(e);if(r.length===0)return;const n=this.getSequenceNode(r);return hs.set(e,[...n]),n}convertRefersToAbsolute(e,t,r,n=""){const s=this.sequenceNodesBuilder(e);if(s==null)return e;let a="";e.substring(0,1)===Z.EQUALS&&(a=Z.EQUALS);for(let u=0,c=s.length;u<c;u++){const l=s[u];if(typeof l!="string"&&l.nodeType===Ue.REFERENCE){const{token:f,endIndex:m}=l,d=Kt(f);if(d==null)continue;const{range:C,sheetName:_,unitId:E}=d,R={...C,startAbsoluteRefType:t,endAbsoluteRefType:r},b=dn({range:R,unitId:E,sheetName:_||n}),p=b.length-f.length;s[u]={...l,token:b,endIndex:m+p};for(let V=u+1;V<c;V++){const S=s[V];typeof S!="string"&&(S.startIndex+=p,S.endIndex+=p)}}}return`${a}${Os(s)}`}moveFormulaRefOffset(e,t,r,n=!1){const s=this.sequenceNodesBuilder(e);if(s==null)return e;const a=[];for(let u=0,c=s.length;u<c;u++){const l=s[u];if(typeof l=="string"||l.nodeType!==Ue.REFERENCE){a.push(l);continue}const{token:f}=l,m=Kt(f),{sheetName:d,unitId:C}=m;let _=m.range;if(!n&&_.startAbsoluteRefType===M.AbsoluteRefType.ALL&&_.endAbsoluteRefType===M.AbsoluteRefType.ALL){a.push(l);continue}else _=M.moveRangeByOffset(_,t,r,n);let E="";M.isValidRange(_)?E=dn({range:_,unitId:C,sheetName:d}):E=h.REF,a.push({...l,token:E})}return`=${Os(a)}`}_formulaSpellCheck(){if(this._currentLexerNode.getChildren().length===0)return!0;const e=this._currentLexerNode.getChildren()[0];return e instanceof ie?!0:!!(this._passArrayOperator(e)||lt.has(e)||rn.has(e)||e===Se.AT||e===X.COMMA||e===X.COLON||e===X.OPEN_BRACKET)}_passArrayOperator(e){if(e.length===0||!(e[0]==="{"&&e[e.length-1]==="}"))return!1;const t=this._currentLexerNode.getChildren(),r=t[t.length-1];return r instanceof ie?!1:!!lt.has(r)}getSequenceNode(e){const t=[];let r=!1;for(let n=0,s=e.length;n<s;n++){const a=e[n],u=e[n-1],{segment:c,currentString:l}=a;if(l===X.DOUBLE_QUOTATION&&(r=!0),(c!==""||n===0)&&n!==s-1){t.push(l);continue}let f=(u==null?void 0:u.segment)||"";const m=n-f.length;let d=n-1;const C=n-1;if(n===s-1&&this._isLastMergeString(l)&&(f+=l,d+=1),f===""||tn.has(f)){t.push(l);continue}const _=f.trim(),E=Zi(_);r===!0&&_[_.length-1]===X.DOUBLE_QUOTATION&&_[0]!==X.OPEN_BRACES?(r=!1,this._processPushSequenceNode(t,Ue.STRING,f,m,d,C)):jr(E)&&Vr(E)?this._processPushSequenceNode(t,Ue.REFERENCE,f,m,d,C):M.Tools.isStringNumber(_)?this._processPushSequenceNode(t,Ue.NUMBER,f,m,d,C):_.length>0&&this._processPushSequenceNode(t,Ue.FUNCTION,f,m,d,C),(n!==s-1||!this._isLastMergeString(l))&&t.push(l)}return this._mergeSequenceNodeReference(t)}_processPushSequenceNode(e,t,r,n,s,a){this._pushSequenceNode(e,{nodeType:t,token:r,startIndex:n,endIndex:s},a)}_getCurrentParamIndex(e,t){return this._nodeMaker(e,void 0,t)}_isLastMergeString(e){return e===X.DOUBLE_QUOTATION||M.Tools.isStringNumber(e)||!pr(e)}_mergeSequenceNodeReference(e){const t=[],r=e.length;let n=0;for(;n<r;){const s=e[n];if(typeof s=="string"){const a=e[n-1];if(s.trim()===X.CLOSE_BRACES&&a!=null&&typeof a!="string"&&a.nodeType===Ue.FUNCTION&&a.token.trim().substring(0,1)===X.OPEN_BRACES){a.nodeType=Ue.ARRAY,a.token+=s,a.endIndex+=s.length,n++;continue}t.push(s)}else{const a=e[n+1],u=e[n+2];a===X.COLON&&typeof s!="string"&&u!=null&&typeof u!="string"&&Vr((s.token+a+u.token).trim())&&(s.nodeType=Ue.REFERENCE,s.token+=a+u.token,s.endIndex=u.endIndex,n+=2),t.push(s)}n++}return this._minusSplitSequenceNode(t)}_minusSplitSequenceNode(e){const t=[];for(const r of e){if(typeof r!="string"){const s=r.token.match(/^(\s*([-@+]\s*)+)(.*)$/);if(s){const a=s[1],u=s[3];if(Vr(u.trim())){const c=a.length,l=r.startIndex,f=r.startIndex+c-1,m={nodeType:Ue.NORMAL,token:a,startIndex:l,endIndex:f},d={nodeType:Ue.REFERENCE,token:u,startIndex:f+1,endIndex:r.endIndex};t.push(m),t.push(d);continue}}}t.push(r)}return t}_pushSequenceNode(e,t,r){const n=r-t.startIndex+1;e.splice(e.length-n,n,t)}nodeMakerTest(e){return this._nodeMaker(e)}treeBuilder(e,t=!0,r){var f;if(t===!0){const m=ms.get(e),d=r&&((f=this._simpleCheckDefinedName)==null?void 0:f.call(this,e,r));if(m&&!d)return m}this._resetCurrentLexerNode(),this._currentLexerNode.setToken(Rt);const n=[];let s=this._nodeMaker(e,n);if(s===h.VALUE||n.length===0)return s;let a=!1,u="",c=[];if(r){const{hasDefinedName:m,sequenceString:d,definedNames:C}=this._handleDefinedName(n,r);a=m,u=d,c=C}if(a&&(this._resetCurrentLexerNode(),this._currentLexerNode.setToken(Rt),s=this._nodeMaker(`=${u}`),s===h.VALUE))return s;const l=this._getTopNode(this._currentLexerNode);if(l&&(this._currentLexerNode=l),t){if(!this._suffixExpressionHandler(this._currentLexerNode))return h.VALUE;ms.set(e,this._currentLexerNode)}return a&&this._currentLexerNode.setDefinedNames(c),this._currentLexerNode}_handleDefinedName(e,t){const{unitId:r,getValueByName:n,getSheetName:s}=t;if(r==null)return{sequenceString:"",hasDefinedName:!1,definedNames:[]};const a=this.getSequenceNode(e);let u="",c=!1;const l=[];for(let f=0,m=a.length;f<m;f++){const d=a[f];if(typeof d=="string"){u+=d;continue}const{nodeType:C,token:_}=d;let E=_;if(C===Ue.REFERENCE||C===Ue.FUNCTION){C===Ue.FUNCTION&&(E=this._getHasSheetNameDefinedName(_,r,t));const R=n(r,E);if(R){const b=R.formulaOrRefString,p=this._handleNestedDefinedName(b,t);if(p==null||typeof p!="object")u+=p||h.NAME,c=!0,l.push(E);else if(typeof p=="object"){const{sequenceString:V,definedNames:S}=p;u+=V,S.forEach(D=>{l.push(D)}),c=!0}}else this._checkDefinedNameDirty(E,t)?(u+=h.NAME,c=!0,l.push(E)):u+=E}else u+=E}return{sequenceString:u,hasDefinedName:c,definedNames:l}}_getHasSheetNameDefinedName(e,t,r){if(!e.includes("!"))return e;const n=e.split("!");if(n.length!==2)return e;const s=n[0],a=n[1].trim(),u=r.getValueByName(t,a);if(!u)return e;const c=u.localSheetId;if(c!==void 0){if(c==="AllDefaultWorkbook")return a;const l=r.getSheetName(t,c);if(s===l)return a}else return a;return e}_handleNestedDefinedName(e,t){const r=[],n=this._nodeMaker(e,r);return n===h.VALUE||r.length===0?n:this._handleDefinedName(r,t)}_simpleCheckDefinedName(e,t){const{getDirtyDefinedNameMap:r,unitId:n}=t,s=r(),a=n;if(a!=null&&s[a]!=null){const u=Object.keys(s[a]);for(let c=0,l=u.length;c<l;c++){const f=u[c];if(e.indexOf(f)>-1)return!0}}return!1}_checkDefinedNameDirty(e,t){const{getDirtyDefinedNameMap:r,unitId:n}=t,s=r(),a=n;if(a!=null&&s[a]!=null){const u=Object.keys(s[a]);for(let c=0,l=u.length;c<l;c++)if(u[c]===e)return!0}return!1}_suffixExpressionHandler(e){var u;const t=e.getChildren();if(!t)return!1;const r=t.length,n=[],s=[];let a=!0;for(let c=0;c<r;c++){const l=t[c];if(l instanceof ie)a=this._suffixExpressionHandler(l),n.push(l);else{const f=l.trim();if(f==="")continue;if(lt.has(f)){if(f===Z.PLUS&&this._deletePlusForPreNode(t[c-1]))continue;if(f!==Z.PLUS&&f!==Z.MINUS&&this._deletePlusForPreNode(t[c-1]))return!1;for(;s.length>0;){const m=(u=s[s.length-1])==null?void 0:u.trim();if(!m||m===X.OPEN_BRACKET)break;const d=tn.get(m),C=tn.get(f);if(d===void 0||C===void 0)break;if(C>=d)n.push(s.pop());else break}s.push(l)}else if(f===X.OPEN_BRACKET)s.push(l);else if(f===X.CLOSE_BRACKET)this._processSuffixExpressionCloseBracket(n,s,t,c);else{if(this._checkCloseBracket(t[c-1]))return!1;n.push(l)}}}return a?this._processSuffixExpressionRemain(n,s,e):!1}_processSuffixExpressionRemain(e,t,r){const n=e.length,s=e[n-1];for(;t.length>0;){const a=t.pop();if(!(s instanceof ie)&&(a===X.OPEN_BRACKET||a===X.CLOSE_BRACKET))return!1;e.push(a)}return r.setChildren(e),!0}_processSuffixExpressionCloseBracket(e,t,r,n){var s;if(this._checkOpenBracket(r[n-1])||this._checkOperator(r[n-1]))return!1;for(;t.length>0;){const a=(s=t[t.length-1])==null?void 0:s.trim();if(!a)break;if(a===X.OPEN_BRACKET){t.pop();break}e.push(t.pop())}}_checkCloseBracket(e){return e===X.CLOSE_BRACKET||e instanceof ie}_checkOpenBracket(e){return e===X.OPEN_BRACKET}_checkOperator(e){return e==null||e instanceof ie?!1:lt.has(e)}_deletePlusForPreNode(e){if(e==null)return!0;if(!(e instanceof ie)){const t=e.trim();if(lt.has(t)||t===X.OPEN_BRACKET)return!0}return!1}_resetCurrentLexerNode(){this._currentLexerNode=new ie}_resetSegment(){this._segment=""}_openBracket(e=0){this._bracketState.push(e)}_closeBracket(){this._bracketState.pop()}_openSquareBracket(){this._squareBracketState+=1}_closeSquareBracket(){this._squareBracketState-=1}_getCurrentBracket(){const e=this._bracketState;return e[e.length-1]}_changeCurrentBracket(e){const t=this._bracketState;t[t.length-1]=e}_openBraces(){this._bracesState+=1}_closeBraces(){this._bracesState-=1}_openSingleQuotation(){this._singleQuotationState+=1}_closeSingleQuotation(){this._singleQuotationState-=1}_openDoubleQuotation(){this._doubleQuotationState+=1}_closeDoubleQuotation(){this._doubleQuotationState-=1}_openLambda(){this._lambdaState=!0}_closeLambda(){this._lambdaState=!1}_openColon(e){this._upLevel=e,this._colonState=!0}_closeColon(){this._upLevel=0,this._colonState=!1}_isTableBracket(){return this._tableBracketState}_openTableBracket(){this._tableBracketState=!0}_closeTableBracket(){this._tableBracketState=!1}_formalErrorOccurred(){this._formulaErrorCount+=1}_hasFormalError(){return this._formulaErrorCount>0}_getLastChildCurrentLexerNode(){const e=this._currentLexerNode.getChildren();if(e&&e.length>0){const t=e[e.length-1];if(t instanceof ie)return t}return!1}_getLastChildCurrent(){const e=this._currentLexerNode.getChildren();return e&&e.length>0?e[e.length-1]:!1}_setParentCurrentLexerNode(){const e=this._currentLexerNode.getParent();return e?(this._currentLexerNode=e,!0):!1}_setAncestorCurrentLexerNode(){var r,n,s,a,u,c;const e=(r=this._currentLexerNode)==null?void 0:r.getParent();let t=!1;if(e&&e.getToken()===Xt){if((n=e==null?void 0:e.getParent())!=null&&n.getParent()){const l=(a=(s=this._currentLexerNode.getParent())==null?void 0:s.getParent())==null?void 0:a.getParent();l&&(this._currentLexerNode=l),t=!0}}else if(e!=null&&e.getParent()){const l=(u=this._currentLexerNode.getParent())==null?void 0:u.getParent();l&&(this._currentLexerNode=l),t=!0}for(let l=0;l<this._upLevel;l++){const f=(c=this._currentLexerNode)==null?void 0:c.getParent();f&&(this._currentLexerNode=f),this._currentLexerNode?t=!0:t=!1}return t}_segmentCount(){return this._segment.trim().length}_pushSegment(e){this._segment+=e}_pushNodeToChildren(e,t=!1){let r=e;if(r!==""){const n=this._currentLexerNode.getChildren();if(!(r instanceof ie)&&this.isColonOpen()){const s=new ie;s.setToken(r),s.setParent(this._currentLexerNode),r=s}t?n.unshift(r):n.push(r)}this.isColonOpen()&&(this._setAncestorCurrentLexerNode(),this._closeColon())}_setCurrentLexerNode(e,t=!1){this._pushNodeToChildren(e,t),e.setParent(this._currentLexerNode),this._currentLexerNode=e}_newAndPushCurrentLexerNode(e,t,r=!1){const n=new ie;n.setToken(e),n.setIndex(t-e.length,t-1),this._setCurrentLexerNode(n,r)}_getTopNode(e){let t=e;for(;t!=null&&t.getParent();)t=t.getParent();return t}_removeLastChild(){this._currentLexerNode.getChildren().splice(-1)}_formulaErrorLastTokenCheck(e,t){const r=this._findPreviousToken(e,t)||"",n=e.length-1===t;if(!n&&this._isOperatorToken(r)||n&&wc(r))return!0;if(rn.has(r)){const s=this._findSecondLastNonSpaceToken(e,t);if(s==null||Pc(s))return!0}return!1}_findPreviousToken(e,t){let r=t;for(;r>=0;){const n=e[r];if(n!==" ")return n;r--}}_findSecondLastNonSpaceToken(e,t){let r=t,n=0;for(;r>=0;){const s=e[r];if(s!==" "&&(n++,n===2))return s;r--}return null}_findNextToken(e,t){let r=t;for(;r>=0;){const n=e[r];if(n!==" ")return n;r++}}_unexpectedEndingTokenExcludeOperator(e){return e===X.OPEN_BRACKET||e===X.COMMA||e===Z.EQUALS||e===""}_unexpectedEndingToken(e){return!!(this._isOperatorToken(e)||this._unexpectedEndingTokenExcludeOperator(e))}_isOperatorToken(e){return!!lt.has(e)}_getSequenceArray(e){const t=[];return this._nodeMaker(e,t),t}_resetTemp(){this._currentLexerNode=new ie,this._upLevel=0,this._segment="",this._bracketState=[],this._bracesState=0,this._singleQuotationState=0,this._doubleQuotationState=0,this._lambdaState=!1,this._colonState=!1,this._formulaErrorCount=0}_checkErrorState(){return!!(this._bracketState.length>0||this._bracesState>0||this._singleQuotationState>0||this._doubleQuotationState>0||this._hasFormalError())}_checkSimilarErrorToken(e,t,r){let n=t;if(e!==Xe.POUND)return!0;let s=r[++n];for(;s===" ";)s=r[++n];return!!pr(s)}_checkIfErrorObject(e,t){return!!this._findErrorObject(e,t)}_findErrorObject(e,t){for(let r=0;r<ka.length;r++){const n=ka[r],s=t.slice(e,e+n).join("").toUpperCase();if(vt.has(s))return s}}_nodeMaker(e,t,r){let n=e.replace(/\r\n$|\r|\n/g," ");n.substring(0,1)===Z.EQUALS&&(n=n.substring(1));const s=n.split(""),a=s.length;this._resetTemp(),this._formulaErrorLastTokenCheck(s,a-1)&&this._formalErrorOccurred();let u=0;for(;u<a;){const c=s[u];if(r===u)return[this._currentLexerNode,c];if(c===Xe.POUND&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isBracesClose()&&this.isSquareBracketClose()&&this._checkIfErrorObject(u,s)){const l=this._findErrorObject(u,s);if(l==null)return h.VALUE;this._pushNodeToChildren(l);for(let f=0;f<l.length;f++){const m=s[u];this._pushSegment(m),this._addSequenceArray(t,m,u),u++}this._resetSegment();continue}else if(c===X.OPEN_BRACKET&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose())if(this._segmentCount()>0||this.isLambdaOpen()){this.isLambdaClose()&&(this._newAndPushCurrentLexerNode(this._segment,u),this._resetSegment()),this._openBracket(1),this._closeLambda();const l=s[u+1];if(l&&l===X.CLOSE_BRACKET){if(!this._setParentCurrentLexerNode()&&u!==a-1)return h.VALUE;this._addSequenceArray(t,c,u),u++,this._addSequenceArray(t,l,u),u++,this._closeBracket();continue}else l&&this._newAndPushCurrentLexerNode(nt,u)}else this._pushNodeToChildren(c),this._openBracket(0),this._resetSegment();else if(c===X.CLOSE_BRACKET&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()){this._formulaErrorLastTokenCheck(s,u-1)&&this._formalErrorOccurred(),this._pushNodeToChildren(this._segment),this._resetSegment();const l=this._getCurrentBracket();if(l===0)this._pushNodeToChildren(c);else if(l===1){const f=s[u+1];if(f&&f===X.OPEN_BRACKET){if(!this._setParentCurrentLexerNode()&&u!==a-1)return h.VALUE;this._newAndPushCurrentLexerNode(Xt,u,!0),this._openLambda()}else if(!this._setAncestorCurrentLexerNode()&&u!==a-1)return h.VALUE}else return h.VALUE;this._closeBracket()}else if(c===X.OPEN_BRACES&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()){if(this._pushSegment(c),this._openBraces(),!this._formulaSpellCheck())return h.VALUE}else if(c===X.CLOSE_BRACES&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose())this._pushSegment(c),this._pushNodeToChildren(this._segment),this._resetSegment(),this._closeBraces();else if(c===X.OPEN_SQUARE_BRACKET&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose())this._segment.length>0&&this._openTableBracket(),this._pushSegment(c),this._openSquareBracket();else if(c===X.CLOSE_SQUARE_BRACKET&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose())this._closeSquareBracket(),this.isSquareBracketClose()?(this._pushSegment(c),this._isTableBracket()&&(this._pushNodeToChildren(this._segment),this._resetSegment()),this._closeTableBracket()):this._pushSegment(c);else if(c===X.DOUBLE_QUOTATION&&this.isSingleQuotationClose()&&this.isSquareBracketClose()){if(this.isDoubleQuotationClose())this._openDoubleQuotation();else{const l=s[u+1];l&&l===X.DOUBLE_QUOTATION?u++:this._closeDoubleQuotation()}this._pushSegment(c)}else if(c===X.SINGLE_QUOTATION&&this.isDoubleQuotationClose()){if(this.isSingleQuotationClose())this._openSingleQuotation(),this._segmentCount()===0&&this._resetSegment();else{const l=s[u+1];if(l&&l===X.SINGLE_QUOTATION){this._pushSegment(c),this._addSequenceArray(t,c,u),u++,this._pushSegment(l),this._addSequenceArray(t,l,u),u++;continue}else this._closeSingleQuotation()}this._pushSegment(c)}else if(c===X.COMMA&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isBracesClose()&&this.isSquareBracketClose()){this._formulaErrorLastTokenCheck(s,u-1)&&this._formalErrorOccurred();const l=this._getCurrentBracket();if(l===1||l==null){if(this._pushNodeToChildren(this._segment),this._resetSegment(),!this._setParentCurrentLexerNode()&&u!==a-1&&l!=null)return h.VALUE;this._newAndPushCurrentLexerNode(nt,u)}else{const f=new ie;f.setToken(zc);const m=new ie;m.setToken(nt),m.changeToParent(f);const d=this._currentLexerNode.getParent();if(d&&d.getToken()===X.COLON){const C=d.getParent();if(!C)return h.VALUE;d.changeToParent(m),C.setChildren([]),f.changeToParent(C)}else return h.VALUE;this._changeCurrentBracket(1),this._pushNodeToChildren(this._segment),this._resetSegment(),this._currentLexerNode=f,this._newAndPushCurrentLexerNode(nt,u)}}else if(c===X.COLON&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isBracesClose()&&this.isSquareBracketClose()){const l=new ie;l.setToken(c);const f=new ie;f.setToken(nt),f.setParent(l);const m=new ie;m.setToken(nt),m.setParent(l),l.getChildren().push(f,m);let d=l,C=0;if(this._segmentCount()>0){let _,E,R=0;const b=this._segment.trim(),p=b[0],V=b[1];if(p===Se.MINUS&&(_=new ie,_.setToken(Se.MINUS),R++),(p===Se.AT||V===Se.AT)&&(E=new ie,E.setToken(Se.AT),_&&(_.addChildren(E),E.setParent(_)),R++),R>0&&(this._segment=b.slice(R)),C=R,E)if(E.addChildren(l),l.setParent(E),E.getParent()){const D=E.getParent();D&&(d=D)}else d=E;else _&&(d=_,_.addChildren(l),l.setParent(_));const S=new ie;S.setToken(this._segment),S.setParent(f),f.getChildren().push(S),this._resetSegment()}else{const _=this._getLastChildCurrentLexerNode();_&&_.changeToParent(f)}this._setCurrentLexerNode(d),this._currentLexerNode=m,this._openColon(C)}else if(rn.has(c)&&this._checkSimilarErrorToken(c,u,s)&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isSquareBracketClose()&&this.isBracesClose()){this._pushNodeToChildren(this._segment);const l=new ie;l.setToken(c);const f=this._getLastChildCurrent();f instanceof ie?f.changeToParent(l):f!==!1&&(l.getChildren().push(f),this._removeLastChild()),this._pushNodeToChildren(l),l.setParent(this._currentLexerNode),this._resetSegment()}else if(lt.has(c)&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isSquareBracketClose()&&this.isBracesClose()){let l=this._segment.trim();if(c===Z.MINUS&&l===""){const f=this._findPreviousToken(s,u-1)||"",m=this._findNextToken(s,u+1)||"";if(this._unexpectedEndingTokenExcludeOperator(f)&&this._isOperatorToken(m)){this._pushNodeToChildren("0"),this._pushNodeToChildren(Z.MINUS),this._addSequenceArray(t,c,u),this._resetSegment(),u++;continue}else if(this._unexpectedEndingToken(f))if(m===Z.PLUS){this._pushSegment(Z.MINUS),this._addSequenceArray(t,c,u),this._addSequenceArray(t,Z.PLUS,u+1),u+=2;continue}else{this._pushSegment(Z.MINUS),this._addSequenceArray(t,c,u),u++;continue}}else if(this._segment.length>0&&this._isScientificNotation(s,u,c)){this._pushSegment(c),this._addSequenceArray(t,c,u),u++;continue}else this._segment.length>0&&l===""?l=this._segment:(this._pushNodeToChildren(this._segment),l="");if(c===Z.LESS_THAN||c===Z.GREATER_THAN){const f=s[u+1];if(f&&lt.has(c+f)){this._pushNodeToChildren(l+c+f),this._resetSegment(),this._addSequenceArray(t,c,u),u++,this._addSequenceArray(t,f,u),u++;continue}else this._pushNodeToChildren(l+c)}else this._pushNodeToChildren(l+c);this._resetSegment()}else(this._segment!==""||c!==" ")&&this._pushSegment(c);this._addSequenceArray(t,c,u),u++}if(this._pushNodeToChildren(this._segment),this._checkErrorState())return h.VALUE}_isScientificNotation(e,t,r){const n=e[t-2];if(n&&Number.isNaN(Number(n))||!(r===Z.MINUS||r===Z.PLUS))return!1;const s=e[t+1];if(s&&Number.isNaN(Number(s)))return!1;const a=e[t-1];return a&&a.toUpperCase()==="E"}_addSequenceArray(e,t,r){e==null||e.push({segment:this._segment,currentString:t,cur:r,currentLexerNode:this._currentLexerNode})}getNewFormulaWithPrefix(e,t){return null}}function hl(i,o,e,t,r,n,s){const a=(s==null?void 0:s.f)||"",u=(s==null?void 0:s.si)||"",c=M.isFormulaString(a),l=M.isFormulaId(u),f=i.getValue(r,n),m=(f==null?void 0:f.f)||"",d=(f==null?void 0:f.si)||"";function C(){var _;if(M.isFormulaString(m)&&M.isFormulaId(d)){const E=(_=e==null?void 0:e[d])==null?void 0:_.f;E?t.set(d,E):t.set(d,m)}}c&&l?(d!==u&&C(),i.setValue(r,n,{f:a,si:u}),e[u]={f:a,r,c:n},o.setValue(r,n,{f:a,si:u})):c&&!l?(m!==a&&C(),i.setValue(r,n,{f:a}),o.setValue(r,n,{f:a})):!c&&l?(d!==u&&C(),i.setValue(r,n,{f:"",si:u})):!c&&!l&&i.getValue(r,n)&&(C(),i.realDeleteValue(r,n),o.setValue(r,n,null))}function gl(i,o,e,t){const r=i==null?void 0:i.getValue(e,t);if(r==null)return!0;const n=[];i.forValue((l,f,m)=>{l===e&&f===t||M.Rectangle.intersects(m,r)&&n.push(m)});const{startRow:s,startColumn:a,endRow:u,endColumn:c}=r;for(let l=s;l<=u;l++)for(let f=a;f<=c;f++){let m=!1;const d=M.cellToRange(l,f);n.some(C=>M.Rectangle.contains(C,d)?(m=!0,!0):!1),m||o.realDeleteValue(l,f)}}var dl=Object.getOwnPropertyDescriptor,Cl=(i,o,e,t)=>{for(var r=t>1?void 0:t?dl(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},ri=(i,o)=>(e,t)=>o(e,t,i);exports.FormulaDataModel=class extends M.Disposable{constructor(e,t){super();A(this,"_arrayFormulaRange",{});A(this,"_arrayFormulaCellData",{});A(this,"_unitImageFormulaData",{});this._univerInstanceService=e,this._lexerTreeBuilder=t}dispose(){super.dispose(),this._arrayFormulaRange={},this._arrayFormulaCellData={},this._unitImageFormulaData={}}clearPreviousArrayFormulaCellData(e){Object.keys(e).forEach(t=>{const r=e[t];if(r==null)return!0;Object.keys(r).forEach(n=>{var l,f,m,d;const s=r[n],a=(f=(l=this._arrayFormulaRange)==null?void 0:l[t])==null?void 0:f[n];if(a==null)return!0;const u=new M.ObjectMatrix(a);let c=new M.ObjectMatrix;((m=this._arrayFormulaCellData[t])==null?void 0:m[n])!=null&&(c=new M.ObjectMatrix((d=this._arrayFormulaCellData[t])==null?void 0:d[n])),s.forValue((C,_)=>{const E=u.getValue(C,_);if(E==null)return!0;const{startRow:R,startColumn:b,endRow:p,endColumn:V}=E;for(let S=R;S<=p;S++)for(let D=b;D<=V;D++)c.setValue(S,D,null);u.realDeleteValue(C,_)}),this._arrayFormulaCellData[t]&&(this._arrayFormulaCellData[t][n]=c.getData())})})}mergeArrayFormulaCellData(e){Object.keys(e).forEach(t=>{const r=e[t];if(r==null)return!0;this._arrayFormulaRange[t]==null&&(this._arrayFormulaRange[t]={}),this._arrayFormulaCellData[t]==null&&(this._arrayFormulaCellData[t]={}),Object.keys(r).forEach(n=>{var c,l;const s=r[n],a=new M.ObjectMatrix((c=this._arrayFormulaRange[t])==null?void 0:c[n]),u=new M.ObjectMatrix((l=this._arrayFormulaCellData[t])==null?void 0:l[n]);s.forValue((f,m)=>{const d=a==null?void 0:a.getValue(f,m);if(d==null)return!0;const{startRow:C,startColumn:_,endRow:E,endColumn:R}=d;for(let b=C;b<=E;b++)for(let p=_;p<=R;p++)u.setValue(b,p,null)}),s.forValue((f,m,d)=>{u.setValue(f,m,d)}),this._arrayFormulaCellData[t]&&(this._arrayFormulaCellData[t][n]=u.getData())})})}getFormulaData(){const e={},t=this._univerInstanceService.getAllUnitsForType(M.UniverInstanceType.UNIVER_SHEET);return t.length===0||t.forEach(r=>{const n=r.getUnitId();e[n]={},r.getSheets().forEach(a=>{const u=a.getCellMatrix(),c=a.getSheetId();Ss(e,n,c,u)})}),e}getSheetFormulaData(e,t){const r={},n=this._univerInstanceService.getUnit(e);if(n==null)return{};r[e]={};const s=n.getSheetBySheetId(t);if(s==null)return{};const a=s.getCellMatrix();return Ss(r,e,t,a),r[e][t]}getArrayFormulaRange(){return this._arrayFormulaRange}setArrayFormulaRange(e){this._arrayFormulaRange=e}getArrayFormulaCellData(){return this._arrayFormulaCellData}setArrayFormulaCellData(e){this._arrayFormulaCellData=e}getUnitImageFormulaData(){return this._unitImageFormulaData}setUnitImageFormulaData(e){this._unitImageFormulaData=e}mergeArrayFormulaRange(e){Object.keys(e).forEach(t=>{const r=e[t];if(r==null)return!0;this._arrayFormulaRange[t]||(this._arrayFormulaRange[t]={}),Object.keys(r).forEach(n=>{var u;const s=new M.ObjectMatrix(r[n]),a=new M.ObjectMatrix((u=this._arrayFormulaRange[t])==null?void 0:u[n]);s.forValue((c,l,f)=>{a.setValue(c,l,f)}),this._arrayFormulaRange[t]&&(this._arrayFormulaRange[t][n]=a.getData())})})}mergeUnitImageFormulaData(e){const t=Object.keys(e);for(let r=0;r<t.length;r++){const n=t[r],s=e[n];if(!s)continue;this._unitImageFormulaData[n]||(this._unitImageFormulaData[n]={});const a=Object.keys(s);for(let u=0;u<a.length;u++){const c=a[u],l=s[c];l&&(this._unitImageFormulaData[n][c]||(this._unitImageFormulaData[n][c]=new M.ObjectMatrix),l.forValue((f,m,d)=>{this._unitImageFormulaData[n][c].setValue(f,m,d)}))}}}deleteArrayFormulaRange(e,t,r,n){var u;const s=(u=this._arrayFormulaRange[e])==null?void 0:u[t];if(s==null)return;const a=new M.ObjectMatrix(s);a.getValue(r,n)&&(a.realDeleteValue(r,n),this._arrayFormulaRange[e]&&(this._arrayFormulaRange[e][t]=a.getData()))}getCalculateData(){const e=this._univerInstanceService.getAllUnitsForType(M.UniverInstanceType.UNIVER_SHEET),t={},r={},n={};for(const s of e){const a=s.getUnitId(),u=s.getSheets(),c={},l={};for(const f of u){const m=f.getSheetId(),d=f.getConfig();c[m]={cellData:new M.ObjectMatrix(d.cellData),rowCount:d.rowCount,columnCount:d.columnCount,rowData:d.rowData,columnData:d.columnData,defaultRowHeight:d.defaultRowHeight,defaultColumnWidth:d.defaultColumnWidth},l[f.getName()]=f.getSheetId()}t[a]=c,r[a]=s.getStyles(),n[a]=l}return{allUnitData:t,unitStylesData:r,unitSheetNameMap:n}}getHiddenRowsFiltered(){const e=this._univerInstanceService.getAllUnitsForType(M.UniverInstanceType.UNIVER_SHEET),t={};for(const r of e){const n=r.getUnitId(),s=r.getSheets();t[n]={};for(const a of s){const u=a.getSheetId();t[n][u]={};const c=0,l=a.getRowCount()-1,f={};for(let m=c;m<=l;m++)a.getRowVisible(m)||(f[m]={hd:M.BooleanNumber.TRUE});t[n][u]=f}}return t}updateFormulaData(e,t,r){const n=new M.ObjectMatrix(r),s=this._getSheetFormulaIdMap(e,t),a=new Map,u=this.getFormulaData();u[e]==null&&(u[e]={});const c=u[e];c[t]==null&&(c[t]={});const l=new M.ObjectMatrix(c[t]||{}),f=new M.ObjectMatrix;return n.forValue((m,d,C)=>{hl(l,f,s,a,m,d,C)}),l.forValue((m,d,C)=>{const _=(C==null?void 0:C.f)||"",E=(C==null?void 0:C.si)||"";if(M.isFormulaId(E)){const R=s==null?void 0:s[E],b=a.get(E);if(R&&!M.isFormulaString(_)){const p=R.f,V=d-R.c,S=m-R.r;l.setValue(m,d,{f:p,si:E,x:V,y:S}),f.setValue(m,d,{f:p,si:E,x:V,y:S})}else if(typeof b=="string"){const p=(C==null?void 0:C.x)||0,V=(C==null?void 0:C.y)||0,S=this._lexerTreeBuilder.moveFormulaRefOffset(b,p,V);a.set(E,{r:m,c:d,f:S}),l.setValue(m,d,{f:S,si:E}),f.setValue(m,d,{f:S,si:E})}else if(typeof b=="object"){const p=d-b.c,V=m-b.r;l.setValue(m,d,{f:b.f,si:E,x:p,y:V}),f.setValue(m,d,{f:b.f,si:E,x:p,y:V})}}}),f.getMatrix()}updateArrayFormulaRange(e,t,r){var u;const n=(u=this._arrayFormulaRange[e])==null?void 0:u[t];if(!n)return;const s=new M.ObjectMatrix(n);new M.ObjectMatrix(r).forValue((c,l,f)=>{s.realDeleteValue(c,l)})}updateArrayFormulaCellData(e,t,r){var l,f;const n=(l=this._arrayFormulaRange[e])==null?void 0:l[t];if(!n)return;const s=new M.ObjectMatrix(n),a=(f=this._arrayFormulaCellData[e])==null?void 0:f[t];if(!a)return;const u=new M.ObjectMatrix(a);new M.ObjectMatrix(r).forValue((m,d,C)=>{gl(s,u,m,d)})}updateImageFormulaData(e,t,r){var a;const n=(a=this._unitImageFormulaData[e])==null?void 0:a[t];if(!n)return;new M.ObjectMatrix(r).forValue((u,c)=>{n.realDeleteValue(u,c)})}getFormulaStringByCell(e,t,r,n){const s=this._univerInstanceService.getUnit(n);if(s==null)return null;const a=s.getSheetBySheetId(r);if(a==null)return null;const u=a.getCellMatrix(),c=u.getValue(e,t);if(c==null)return null;const{f:l,si:f}=c;if(M.isFormulaString(l))return l;if(M.isFormulaId(f)){let m=null;return u.forValue((d,C,_)=>{if(_==null)return!0;const{f:E,si:R}=_;if(M.isFormulaString(E)&&f===R)return m=this._lexerTreeBuilder.moveFormulaRefOffset(E,t-C,e-d),!1}),m}return null}getFormulaDirtyRanges(){const e=this.getFormulaData(),t=[];for(const r in e){const n=e[r];if(!n)continue;const s=this._univerInstanceService.getUnit(r);if(s)for(const a in n){const u=n[a];if(!u)continue;const c=s.getSheetBySheetId(a);if(!c)continue;const l={};for(const f of Object.keys(u)){const m=Number(f);for(const d in u[m]){const C=Number(d),_=c.getCellRaw(m,C),E=M.isFormulaString(_==null?void 0:_.f)||M.isFormulaId(_==null?void 0:_.si),R=(_==null?void 0:_.v)===void 0;if(!(E&&R))continue;l[C]||(l[C]=[]);const b=l[C].slice(-1)[0];b&&b.endRow===m-1?b.endRow=m:l[C].push({startRow:m,endRow:m})}}for(const f in l){const m=l[f];for(let d=0;d<m.length;d++){const C=m[d];t.push({unitId:r,sheetId:a,range:{rangeType:M.RANGE_TYPE.NORMAL,startRow:C.startRow,endRow:C.endRow,startColumn:Number(f),endColumn:Number(f)}})}}}}return t}_getSheetFormulaIdMap(e,t){const r={},n=this._univerInstanceService.getUnit(e);if(n==null)return r;const s=n.getSheetBySheetId(t);return s==null||s.getCellMatrix().forValue((u,c,l)=>{if(l==null)return!0;const{f,si:m}=l;M.isFormulaString(f)&&M.isFormulaId(m)&&(r[m]={f,r:u,c})}),r}};exports.FormulaDataModel=Cl([ri(0,M.IUniverInstanceService),ri(1,M.Inject(Mr))],exports.FormulaDataModel);function Ss(i,o,e,t){i[o]||(i[o]={}),i[o][e]||(i[o][e]={});const r=new Map,n=new M.ObjectMatrix(i[o][e]);t.forValue((a,u,c)=>{const l=(c==null?void 0:c.f)||"",f=(c==null?void 0:c.si)||"",m=M.isFormulaString(l),d=M.isFormulaId(f);m&&d?(n.setValue(a,u,{f:l,si:f}),r.set(f,{f:l,r:a,c:u})):m&&!d?n.setValue(a,u,{f:l}):!m&&d&&n.setValue(a,u,{f:"",si:f})}),n.forValue((a,u,c)=>{const l=(c==null?void 0:c.f)||"",f=(c==null?void 0:c.si)||"";if(M.isFormulaId(f)&&!M.isFormulaString(l)){const m=r.get(f);if(m){const d=m.f,C=u-m.c,_=a-m.r;n.setValue(a,u,{f:d,si:f,x:C,y:_})}else n.realDeleteValue(a,u)}});const s=n.getMatrix();return{[o]:{[e]:s}}}const _l=class Ms{constructor(o,e){this.low=o,this.high=e}clone(){return new Ms(this.low,this.high)}get max(){return this.clone()}less_than(o){return this.low<o.low||this.low===o.low&&this.high<o.high}equal_to(o){return this.low===o.low&&this.high===o.high}intersect(o){return!this.not_intersect(o)}not_intersect(o){return this.high<o.low||o.high<this.low}merge(o){return new Ms(this.low===void 0?o.low:this.low<o.low?this.low:o.low,this.high===void 0?o.high:this.high>o.high?this.high:o.high)}output(){return[this.low,this.high]}static comparable_max(o,e){return o.merge(e)}static comparable_less_than(o,e){return o<e}},Pe=0,Ee=1;class Ft{constructor(o=void 0,e=void 0,t=null,r=null,n=null,s=Ee){if(this.left=t,this.right=r,this.parent=n,this.color=s,this.item={key:o,value:e},o&&o instanceof Array&&o.length===2&&!Number.isNaN(o[0])&&!Number.isNaN(o[1])){let[a,u]=o;a>u&&([a,u]=[u,a]),this.item.key=new _l(a,u)}this.max=this.item.key?this.item.key.max:void 0}isNil(){return this.item.key===void 0&&this.item.value===void 0&&this.left===null&&this.right===null&&this.color===Ee}_value_less_than(o){return this.item.value&&o.item.value&&this.item.value.less_than?this.item.value.less_than(o.item.value):this.item.value<o.item.value}less_than(o){return this.item.value===this.item.key&&o.item.value===o.item.key?this.item.key.less_than(o.item.key):this.item.key.less_than(o.item.key)||this.item.key.equal_to(o.item.key)&&this._value_less_than(o)}_value_equal(o){return this.item.value&&o.item.value&&this.item.value.equal_to?this.item.value.equal_to(o.item.value):this.item.value===o.item.value}equal_to(o){return this.item.value===this.item.key&&o.item.value===o.item.key?this.item.key.equal_to(o.item.key):this.item.key.equal_to(o.item.key)&&this._value_equal(o)}intersect(o){return this.item.key.intersect(o.item.key)}copy_data(o){this.item.key=o.item.key,this.item.value=o.item.value}update_max(){if(this.max=this.item.key?this.item.key.max:void 0,this.right&&this.right.max){const o=this.item.key.constructor.comparable_max;this.max=o(this.max,this.right.max)}if(this.left&&this.left.max){const o=this.item.key.constructor.comparable_max;this.max=o(this.max,this.left.max)}}not_intersect_left_subtree(o){const e=this.item.key.constructor.comparable_less_than;let t=this.left.max.high!==void 0?this.left.max.high:this.left.max;return e(t,o.item.key.low)}not_intersect_right_subtree(o){const e=this.item.key.constructor.comparable_less_than;let t=this.right.max.low!==void 0?this.right.max.low:this.right.item.key.low;return e(o.item.key.high,t)}}class na{constructor(){this.root=null,this.nil_node=new Ft}get size(){let o=0;return this.tree_walk(this.root,()=>o++),o}get keys(){let o=[];return this.tree_walk(this.root,e=>o.push(e.item.key.output?e.item.key.output():e.item.key)),o}get values(){let o=[];return this.tree_walk(this.root,e=>o.push(e.item.value)),o}get items(){let o=[];return this.tree_walk(this.root,e=>o.push({key:e.item.key.output?e.item.key.output():e.item.key,value:e.item.value})),o}isEmpty(){return this.root==null||this.root===this.nil_node}clear(){this.root=null}insert(o,e=o){if(o===void 0)return;let t=new Ft(o,e,this.nil_node,this.nil_node,null,Pe);return this.tree_insert(t),this.recalc_max(t),t}exist(o,e=o){let t=new Ft(o,e);return!!this.tree_search(this.root,t)}remove(o,e=o){let t=new Ft(o,e),r=this.tree_search(this.root,t);return r&&this.tree_delete(r),r}search(o,e=(t,r)=>t===r?r.output():t){let t=new Ft(o),r=[];return this.tree_search_interval(this.root,t,r),r.map(n=>e(n.item.value,n.item.key))}intersect_any(o){let e=new Ft(o);return this.tree_find_any_interval(this.root,e)}forEach(o){this.tree_walk(this.root,e=>o(e.item.key,e.item.value))}map(o){const e=new na;return this.tree_walk(this.root,t=>e.insert(t.item.key,o(t.item.value,t.item.key))),e}*iterate(o,e=(t,r)=>t===r?r.output():t){let t;for(o?t=this.tree_search_nearest_forward(this.root,new Ft(o)):this.root&&(t=this.local_minimum(this.root));t;)yield e(t.item.value,t.item.key),t=this.tree_successor(t)}recalc_max(o){let e=o;for(;e.parent!=null;)e.parent.update_max(),e=e.parent}tree_insert(o){let e=this.root,t=null;if(this.root==null||this.root===this.nil_node)this.root=o;else{for(;e!==this.nil_node;)t=e,o.less_than(e)?e=e.left:e=e.right;o.parent=t,o.less_than(t)?t.left=o:t.right=o}this.insert_fixup(o)}insert_fixup(o){let e,t;for(e=o;e!==this.root&&e.parent.color===Pe;)e.parent===e.parent.parent.left?(t=e.parent.parent.right,t.color===Pe?(e.parent.color=Ee,t.color=Ee,e.parent.parent.color=Pe,e=e.parent.parent):(e===e.parent.right&&(e=e.parent,this.rotate_left(e)),e.parent.color=Ee,e.parent.parent.color=Pe,this.rotate_right(e.parent.parent))):(t=e.parent.parent.left,t.color===Pe?(e.parent.color=Ee,t.color=Ee,e.parent.parent.color=Pe,e=e.parent.parent):(e===e.parent.left&&(e=e.parent,this.rotate_right(e)),e.parent.color=Ee,e.parent.parent.color=Pe,this.rotate_left(e.parent.parent)));this.root.color=Ee}tree_delete(o){let e,t;o.left===this.nil_node||o.right===this.nil_node?e=o:e=this.tree_successor(o),e.left!==this.nil_node?t=e.left:t=e.right,t.parent=e.parent,e===this.root?this.root=t:(e===e.parent.left?e.parent.left=t:e.parent.right=t,e.parent.update_max()),this.recalc_max(t),e!==o&&(o.copy_data(e),o.update_max(),this.recalc_max(o)),e.color===Ee&&this.delete_fixup(t)}delete_fixup(o){let e=o,t;for(;e!==this.root&&e.parent!=null&&e.color===Ee;)e===e.parent.left?(t=e.parent.right,t.color===Pe&&(t.color=Ee,e.parent.color=Pe,this.rotate_left(e.parent),t=e.parent.right),t.left.color===Ee&&t.right.color===Ee?(t.color=Pe,e=e.parent):(t.right.color===Ee&&(t.color=Pe,t.left.color=Ee,this.rotate_right(t),t=e.parent.right),t.color=e.parent.color,e.parent.color=Ee,t.right.color=Ee,this.rotate_left(e.parent),e=this.root)):(t=e.parent.left,t.color===Pe&&(t.color=Ee,e.parent.color=Pe,this.rotate_right(e.parent),t=e.parent.left),t.left.color===Ee&&t.right.color===Ee?(t.color=Pe,e=e.parent):(t.left.color===Ee&&(t.color=Pe,t.right.color=Ee,this.rotate_left(t),t=e.parent.left),t.color=e.parent.color,e.parent.color=Ee,t.left.color=Ee,this.rotate_right(e.parent),e=this.root));e.color=Ee}tree_search(o,e){if(!(o==null||o===this.nil_node))return e.equal_to(o)?o:e.less_than(o)?this.tree_search(o.left,e):this.tree_search(o.right,e)}tree_search_nearest_forward(o,e){let t,r=o;for(;r&&r!==this.nil_node;)r.less_than(e)?r.intersect(e)?(t=r,r=r.left):r=r.right:((!t||r.less_than(t))&&(t=r),r=r.left);return t||null}tree_search_interval(o,e,t){o!=null&&o!==this.nil_node&&(o.left!==this.nil_node&&!o.not_intersect_left_subtree(e)&&this.tree_search_interval(o.left,e,t),o.intersect(e)&&t.push(o),o.right!==this.nil_node&&!o.not_intersect_right_subtree(e)&&this.tree_search_interval(o.right,e,t))}tree_find_any_interval(o,e){let t=!1;return o!=null&&o!==this.nil_node&&(o.left!==this.nil_node&&!o.not_intersect_left_subtree(e)&&(t=this.tree_find_any_interval(o.left,e)),t||(t=o.intersect(e)),!t&&o.right!==this.nil_node&&!o.not_intersect_right_subtree(e)&&(t=this.tree_find_any_interval(o.right,e))),t}local_minimum(o){let e=o;for(;e.left!=null&&e.left!==this.nil_node;)e=e.left;return e}local_maximum(o){let e=o;for(;e.right!=null&&e.right!==this.nil_node;)e=e.right;return e}tree_successor(o){let e,t,r;if(o.right!==this.nil_node)e=this.local_minimum(o.right);else{for(t=o,r=o.parent;r!=null&&r.right===t;)t=r,r=r.parent;e=r}return e}rotate_left(o){let e=o.right;o.right=e.left,e.left!==this.nil_node&&(e.left.parent=o),e.parent=o.parent,o===this.root?this.root=e:o===o.parent.left?o.parent.left=e:o.parent.right=e,e.left=o,o.parent=e,o!=null&&o!==this.nil_node&&o.update_max(),e=o.parent,e!=null&&e!==this.nil_node&&e.update_max()}rotate_right(o){let e=o.left;o.left=e.right,e.right!==this.nil_node&&(e.right.parent=o),e.parent=o.parent,o===this.root?this.root=e:o===o.parent.left?o.parent.left=e:o.parent.right=e,e.right=o,o.parent=e,o!==null&&o!==this.nil_node&&o.update_max(),e=o.parent,e!=null&&e!==this.nil_node&&e.update_max()}tree_walk(o,e){o!=null&&o!==this.nil_node&&(this.tree_walk(o.left,e),e(o),this.tree_walk(o.right,e))}testRedBlackProperty(){let o=!0;return this.tree_walk(this.root,function(e){e.color===Pe&&(e.left.color===Ee&&e.right.color===Ee||(o=!1))}),o}testBlackHeightProperty(o){let e=0,t=0,r=0;if(o.color===Ee&&e++,o.left!==this.nil_node?t=this.testBlackHeightProperty(o.left):t=1,o.right!==this.nil_node?r=this.testBlackHeightProperty(o.right):r=1,t!==r)throw new Error("Red-black height property violated");return e+=t,e}}const Ds=Symbol("EMPTY_CELL");class Al{constructor(){A(this,"_cache",new Map);A(this,"_continueBuildingCache",new Map)}set(o,e,t,r,n,s=!1){if(!this.shouldContinueBuildingCache(o,e,t,n)&&!s)return;let a=this._cache.get(o);a==null&&(a=new Map,this._cache.set(o,a));let u=a.get(e);u==null&&(u=new Map,a.set(e,u));let c=u.get(t);if(c==null&&(c=new Map,u.set(t,c)),s){for(const[m,d]of c)if(d.has(n)){d.delete(n);break}}let l=typeof r=="string"?r.toLowerCase():r;(l===""||l===null)&&(l=Ds);let f=c.get(l);f==null&&(f=new Set,c.set(l,f)),f.add(n)}getCellValuePositions(o,e,t){var r,n;return(n=(r=this._cache.get(o))==null?void 0:r.get(e))==null?void 0:n.get(t)}getCellPositions(o,e,t,r,n){var u,c,l;let s=typeof r=="string"?r.toLowerCase():r;(s===""||s===null)&&(s=Ds);const a=(l=(c=(u=this._cache.get(o))==null?void 0:u.get(e))==null?void 0:c.get(t))==null?void 0:l.get(s);return a&&[...a].filter(f=>n.some(([m,d])=>f>=m&&f<=d))}setContinueBuildingCache(o,e,t,r,n){if(t===-1||r===-1||n===-1)return;let s=this._continueBuildingCache.get(o);s==null&&(s=new Map,this._continueBuildingCache.set(o,s));let a=s.get(e);a==null&&(a=new Map,s.set(e,a));let u=a.get(t);if(u==null){u=new na,u.insert([r,n]),a.set(t,u);return}this._handleNewInterval(u,r,n)}shouldContinueBuildingCache(o,e,t,r){var a,u;if(t===-1||r===-1)return!1;const n=(u=(a=this._continueBuildingCache.get(o))==null?void 0:a.get(e))==null?void 0:u.get(t);return n?n.search([r,r]).length===0:!0}canUseCache(o,e,t,r,n){var f,m;const s=(m=(f=this._continueBuildingCache.get(o))==null?void 0:f.get(e))==null?void 0:m.get(t);if(t===-1||r===-1||n===-1||!s)return{rowsInCache:[],rowsNotInCache:[]};const a=s.search([r,n]);if(a.length===0)return{rowsInCache:[],rowsNotInCache:[]};a.sort((d,C)=>d[0]-C[0]);const u=[],c=[];let l=r;for(let d=0;d<a.length;d++){const[C,_]=a[d];if(l>=C){if(n<=_){u.push([l,n]);break}u.push([l,_]),l=_+1,d===a.length-1&&l<=n&&c.push([l,n])}else{if(n>_){u.push([C,_]),c.push([l,C-1]),l=_+1,d===a.length-1&&l<=n&&c.push([l,n]);continue}u.push([C,n]),c.push([l,C-1])}}return{rowsInCache:u,rowsNotInCache:c}}clear(){this._cache.clear(),this._continueBuildingCache.clear()}_handleNewInterval(o,e,t){let r=o.search([e,t]);if(r.length===0){const a=[e-1<0?0:e-1,t+1];if(r=o.search(a),r.length===0){o.insert([e,t]);return}}let n=e,s=t;for(const a of r)n=Math.min(n,a[0]),s=Math.max(s,a[1]),o.remove(a);o.insert([n,s])}}const Ge=new Al,Hn="engine-formula.config",so=1,El="CYCLE_REFERENCE_COUNT",ni={};class ao extends M.Disposable{constructor(){super(...arguments);A(this,"_getRowFilteredCallback")}register(e){this._getRowFilteredCallback=e}getRowFiltered(e,t,r){var n;return this._getRowFilteredCallback&&(n=this._getRowFilteredCallback(e,t,r))!=null?n:!1}}const sa=M.createIdentifier("univer.formula.sheet-row-filtered.service");var Rl=Object.getOwnPropertyDescriptor,bl=(i,o,e,t)=>{for(var r=t>1?void 0:t?Rl(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},Wr=(i,o)=>(e,t)=>o(e,t,i);exports.FormulaCurrentConfigService=class extends M.Disposable{constructor(e,t,r,n){super();A(this,"_unitData",{});A(this,"_unitStylesData",{});A(this,"_arrayFormulaCellData",{});A(this,"_arrayFormulaRange",{});A(this,"_formulaData",{});A(this,"_sheetNameMap",{});A(this,"_forceCalculate",!1);A(this,"_clearDependencyTreeCache",{});A(this,"_dirtyRanges",[]);A(this,"_dirtyNameMap",{});A(this,"_dirtyDefinedNameMap",{});A(this,"_dirtyUnitFeatureMap",{});A(this,"_dirtyUnitOtherFormulaMap",{});A(this,"_excludedCell");A(this,"_sheetIdToNameMap",{});A(this,"_executeUnitId","");A(this,"_executeSubUnitId","");this._univerInstanceService=e,this._localeService=t,this._formulaDataModel=r,this._sheetRowFilteredService=n}dispose(){super.dispose(),this._unitData={},this._unitStylesData={},this._arrayFormulaCellData={},this._arrayFormulaRange={},this._formulaData={},this._sheetNameMap={},this._clearDependencyTreeCache={},this._dirtyRanges=[],this._dirtyNameMap={},this._dirtyDefinedNameMap={},this._dirtyUnitFeatureMap={},this._dirtyUnitOtherFormulaMap={},this._excludedCell={},this._sheetIdToNameMap={}}getExecuteUnitId(){return this._executeUnitId}getExecuteSubUnitId(){return this._executeSubUnitId}setExecuteUnitId(e){this._executeUnitId=e}setExecuteSubUnitId(e){this._executeSubUnitId=e}getExcludedRange(){return this._excludedCell}getUnitData(){return this._unitData}getUnitStylesData(){return this._unitStylesData}getFormulaData(){return this._formulaData}getArrayFormulaCellData(){return this._arrayFormulaCellData}getArrayFormulaRange(){return this._arrayFormulaRange}getSheetNameMap(){return this._sheetNameMap}isForceCalculate(){return this._forceCalculate}getDirtyRanges(){return this._dirtyRanges}getDirtyNameMap(){return this._dirtyNameMap}getDirtyDefinedNameMap(){return this._dirtyDefinedNameMap}getDirtyUnitFeatureMap(){return this._dirtyUnitFeatureMap}getDirtyUnitOtherFormulaMap(){return this._dirtyUnitOtherFormulaMap}getSheetName(e,t){return this._sheetIdToNameMap[e]==null?"":this._sheetIdToNameMap[e][t]||""}setSheetNameMap(e){this._sheetIdToNameMap=e}getClearDependencyTreeCache(){return this._clearDependencyTreeCache}getLocale(){return this._localeService.getCurrentLocale()}getSheetsInfo(){const e=this._univerInstanceService.getCurrentUnitForType(M.UniverInstanceType.UNIVER_SHEET),{id:t,sheetOrder:r}=e.getSnapshot();return{sheetOrder:r,sheetNameMap:this._sheetIdToNameMap[t]}}getSheetRowColumnCount(e,t){const r=this._univerInstanceService.getUnit(e),n=r==null?void 0:r.getSheetBySheetId(t),s=n==null?void 0:n.getSnapshot();if(!s)return{rowCount:0,columnCount:0};const{rowCount:a,columnCount:u}=s;return{rowCount:a,columnCount:u}}getFilteredOutRows(e,t,r,n){const s=[];for(let a=r;a<=n;a++)this._sheetRowFilteredService.getRowFiltered(e,t,a)&&s.push(a);return s}load(e){if(e.allUnitData&&e.unitSheetNameMap&&e.unitStylesData)this._unitData=e.allUnitData,this._unitStylesData=e.unitStylesData,this._sheetNameMap=e.unitSheetNameMap;else{const{allUnitData:t,unitSheetNameMap:r,unitStylesData:n}=this._loadSheetData();this._unitData=t,this._unitStylesData=n,this._sheetNameMap=r}e.rowData&&this._applyUnitRowData(e.rowData),this._formulaData=e.formulaData,this._arrayFormulaCellData=Gi(e.arrayFormulaCellData),this._arrayFormulaRange=e.arrayFormulaRange,this._forceCalculate=e.forceCalculate,this._clearDependencyTreeCache=e.clearDependencyTreeCache||{},this._dirtyRanges=e.dirtyRanges,this._dirtyNameMap=e.dirtyNameMap,this._dirtyDefinedNameMap=e.dirtyDefinedNameMap,this._dirtyUnitFeatureMap=e.dirtyUnitFeatureMap,this._dirtyUnitOtherFormulaMap=e.dirtyUnitOtherFormulaMap,this._excludedCell=e.excludedCell,this._mergeNameMap(this._sheetNameMap,this._dirtyNameMap)}getDirtyData(){return{forceCalculation:this._forceCalculate,dirtyRanges:this._dirtyRanges,dirtyNameMap:this._dirtyNameMap,dirtyDefinedNameMap:this._dirtyDefinedNameMap,dirtyUnitFeatureMap:this._dirtyUnitFeatureMap,dirtyUnitOtherFormulaMap:this._dirtyUnitOtherFormulaMap,clearDependencyTreeCache:this._clearDependencyTreeCache}}loadDirtyRangesAndExcludedCell(e,t){this._dirtyRanges=e,this._excludedCell=t,this._dirtyNameMap={}}registerUnitData(e){this._unitData=e}registerFormulaData(e){this._formulaData=e}registerSheetNameMap(e){this._sheetNameMap=e}_mergeNameMap(e,t){Object.keys(t).forEach(r=>{t[r]&&Object.keys(t[r]).forEach(n=>{e[r]==null&&(e[r]={}),e[r][t[r][n]]=n})}),this._sheetIdToNameMap={},Object.keys(e).forEach(r=>{Object.keys(e[r]).forEach(n=>{this._sheetIdToNameMap[r]==null&&(this._sheetIdToNameMap[r]={}),this._sheetIdToNameMap[r][e[r][n]]=n})})}_loadSheetData(){const e=this._univerInstanceService.getCurrentUnitForType(M.UniverInstanceType.UNIVER_SHEET),t=e==null?void 0:e.getActiveSheet();return this._executeUnitId=e==null?void 0:e.getUnitId(),this._executeSubUnitId=t==null?void 0:t.getSheetId(),this._formulaDataModel.getCalculateData()}_applyUnitRowData(e){for(const t in e)if(e[t]!=null)for(const r in e[t])e[t][r]!=null&&(this._unitData[t]==null&&(this._unitData[t]={}),this._unitData[t][r]==null&&(this._unitData[t][r]={cellData:new M.ObjectMatrix({}),rowCount:0,columnCount:0,rowData:{},columnData:{}}),this._unitData[t][r].rowData=e[t][r])}};exports.FormulaCurrentConfigService=bl([Wr(0,M.IUniverInstanceService),Wr(1,M.Inject(M.LocaleService)),Wr(2,M.Inject(exports.FormulaDataModel)),Wr(3,M.Inject(sa))],exports.FormulaCurrentConfigService);const pt=M.createIdentifier("univer.formula.current-data.service");var yl=Object.getOwnPropertyDescriptor,pl=(i,o,e,t)=>{for(var r=t>1?void 0:t?yl(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},gs=(i,o)=>(e,t)=>o(e,t,i);exports.Lexer=class extends M.Disposable{constructor(o,e,t){super(),this._definedNamesService=o,this._lexerTreeBuilder=e,this._formulaCurrentConfigService=t}treeBuilder(o,e=!0){const t=this._definedNamesService.getAllDefinedNames();return this._isDeepDefinedNameMapEmpty(t)?this._lexerTreeBuilder.treeBuilder(o,e):this._lexerTreeBuilder.treeBuilder(o,e,{unitId:this._formulaCurrentConfigService.getExecuteUnitId(),getValueByName:this._definedNamesService.getValueByName.bind(this._definedNamesService),getDirtyDefinedNameMap:this._formulaCurrentConfigService.getDirtyDefinedNameMap.bind(this._formulaCurrentConfigService),getSheetName:this._formulaCurrentConfigService.getSheetName.bind(this._formulaCurrentConfigService)})}_isDeepDefinedNameMapEmpty(o){for(const e in o)if(Object.keys(o[e]).length>0)return!1;return!0}};exports.Lexer=pl([gs(0,er),gs(1,M.Inject(Mr)),gs(2,pt)],exports.Lexer);function sn(i){if(i==null)return!0;const{v:o,f:e,si:t,p:r}=i;return!(!(o==null||typeof o=="string"&&o.length===0)||e!=null&&e.length>0||t!=null&&t.length>0||r!=null)}class Gn{constructor(){A(this,"pattern","")}dispose(){}getPattern(){return this.pattern}setPattern(o){this.pattern=o}isError(){return!1}isAsyncObject(){return!1}isAsyncArrayObject(){return!1}isReferenceObject(){return!1}isArray(){return!1}isValueObject(){return!1}isEqualType(o){return!1}}function Nl(i){var o;if(i===null)return 0;if(i!=null&&i.p){const e=i==null?void 0:i.p.body;if(e==null)return 0;const t=e.dataStream;return M.BuildTextUtils.transform.getPlainText(t)}return(o=i==null?void 0:i.v)!=null?o:0}function Vl(i,o=!1){return!o&&!(M.isFormulaString(i==null?void 0:i.f)||M.isFormulaId(i==null?void 0:i.si))?null:typeof(i==null?void 0:i.v)=="string"&&vt.has(i.v)?i.v:null}function io(i,o,e,t,r){var s;const n=Object.keys(r);for(const a of n){const u=r[a],c=(s=u==null?void 0:u[t])==null?void 0:s[e];if(c==null)continue;const l=c.getValue(i,o);if(l!=null)return l}}var kt=(i=>(i[i.MIN=0]="MIN",i[i.MAX=1]="MAX",i))(kt||{}),De=(i=>(i[i.NORMAL=0]="NORMAL",i[i.MIN=1]="MIN",i[i.MAX=2]="MAX",i))(De||{});function An(){return Intl&&Intl.Collator?new Intl.Collator(void 0,{numeric:!1}).compare:(i,o)=>i.localeCompare(o)}function oo(i){return i.indexOf("*")>-1||i.indexOf("?")>-1}function ds(i,o){const e=Sl(o).replace(/~?[*?]/g,r=>r.startsWith("~")?`\\${r.substring(1)}`:r==="*"?".*":r==="?"?".":r);return new RegExp(`^${e}$`).test(i)}function si(i){return i.replace(/~?[*?]/g,o=>o.startsWith("~")?o.substring(1):" ")}function Ol(i,o,e){let t=!1;switch(e){case Y.EQUALS:t=ds(i,o);break;case Y.NOT_EQUAL:t=!ds(i,o);break;case Y.GREATER_THAN:case Y.GREATER_THAN_OR_EQUAL:t=ds(i,o)||i>si(o);break;case Y.LESS_THAN:case Y.LESS_THAN_OR_EQUAL:t=i<si(o);break}return t}function Sl(i){return i.replace(/[.+^${}()|[\]\\]/g,"\\$&")}function ws(i){switch(i){case 1:return 2;case 0:return 0;case-1:return 1;default:return 0}}function Ls(i){return i===-2?1:0}const Ml=["$","£","¥","¤","֏","؋","৳","฿","៛","₡","₦","₩","₪","₫","€","₭","₮","₱","₲","₴","₸","₹","₺","₼","₽","₾","₿"],Dl={currency:2,date:4,datetime:5,error:11,fraction:7,general:0,grouped:11,number:1,percent:6,scientific:8,text:9,time:5,unknown:11};function wl(i,o,e){var u,c;if(i==null||o==null)return o;const t=(e==null?void 0:e.getStyleByCell(i))||i.s,r=(e==null?void 0:e.getStyleByCell(o))||o.s;if(t==null||r==null||typeof t!="object"||typeof r!="object")return o;const n=(u=t==null?void 0:t.n)==null?void 0:u.pattern,s=(c=r==null?void 0:r.n)==null?void 0:c.pattern;if(n==null||s==null)return o;const a=n||s;return r.n.pattern=a,o}const Ps=new yt(1e5);function ai(i){const o=Ps.get(i);if(o!==void 0)return o;const e=Pl(i);return Ps.set(i,e),e}function Ll(){Ps.clear()}function Pl(i){if(xl(i))return 3;const o=M.numfmt.getFormatInfo(i).type||"unknown";return Dl[o]}function xl(i){return!!Ml.find(o=>i.includes(o))&&i.startsWith("_(")}function Qr(i,o,e){if(i==="")return o;if(o==="")return i;const t=ai(i),r=ai(o);return e===Z.PLUS||e===Z.MINUS?t===4&&r===4||t===11&&r===11?"":o:e===Z.MULTIPLY||e===Z.DIVIDED?t===6&&r===6||t===7&&r===7||t===8&&r===8||t===9&&r===9?o:"":i||o}const jl=new Map([[M.LocaleType.EN_US,"$"],[M.LocaleType.RU_RU,"₽"],[M.LocaleType.VI_VN,"₫"],[M.LocaleType.ZH_CN,"¥"],[M.LocaleType.ZH_TW,"NT$"],[M.LocaleType.FR_FR,"€"],[M.LocaleType.FA_IR,"﷼"],[M.LocaleType.KO_KR,"₩"],[M.LocaleType.ES_ES,"€"],[M.LocaleType.CA_ES,"€"]]);function ii(i){return jl.get(i)||"$"}function qe(i,o=2){let e=o;o>127&&(e=127);let t="";return e>0&&(t=`.${"0".repeat(e)}`),`"${ii(i)}"#,##0${t}_);[Red]("${ii(i)}"#,##0${t})`}function Ul(i,o,e=2){return M.numfmt.format(qe(i,e),o)}const aa=new yt(1e5);function Tl(i){let o=i;o.startsWith('"')&&o.endsWith('"')&&(o=o.slice(1,-1));const e=aa.get(o);if(e)return{isNumberPattern:!0,value:e.value,pattern:e.pattern};const t=M.numfmt.parseNumber(o);if(t&&t.z)return Cs(o,t.v,t.z);const r=M.numfmt.parseDate(o);if(r&&r.z)return Cs(o,r.v,r.z);const n=M.numfmt.parseTime(o);return n&&n.z?Cs(o,n.v,n.z):{isNumberPattern:!1}}function Cs(i,o,e){return aa.set(i,{value:o,pattern:e}),{isNumberPattern:!0,value:o,pattern:e}}function vl(){aa.clear()}class Nt extends Gn{constructor(e){super();A(this,"_customData");this._rawValue=e}isValueObject(){return!0}toUnitRange(){return{range:{startColumn:-1,startRow:-1,endRow:-1,endColumn:-1},sheetId:"",unitId:""}}getValue(){return 0}getArrayValue(){return[]}setValue(e){}setArrayValue(e){}withCustomData(e){return this._customData=e,this}getCustomData(){return this._customData}isCube(){return!1}isString(){return!1}isNumber(){return!1}isBoolean(){return!1}isLambda(){return!1}isDateFormat(){return!1}isError(){return!1}isNull(){return!1}isHyperlink(){return!1}isImage(){return!1}sum(){return g.create(h.VALUE)}max(){return g.create(h.VALUE)}min(){return g.create(h.VALUE)}count(){return g.create(h.VALUE)}countA(){return g.create(h.VALUE)}countBlank(){return g.create(h.VALUE)}getNegative(){return g.create(h.VALUE)}getReciprocal(){return g.create(h.VALUE)}plus(e){return g.create(h.VALUE)}minus(e){return g.create(h.VALUE)}multiply(e){return g.create(h.VALUE)}divided(e){return g.create(h.VALUE)}mod(e){return g.create(h.VALUE)}map(e){return g.create(h.NAME)}mapValue(e){return g.create(h.NAME)}compare(e,t,r=!1){return g.create(h.NAME)}isEqual(e){return this.compare(e,Y.EQUALS)}isNotEqual(e){return this.compare(e,Y.NOT_EQUAL)}isGreaterThanOrEqual(e){return this.compare(e,Y.GREATER_THAN_OR_EQUAL)}isLessThanOrEqual(e){return this.compare(e,Y.LESS_THAN_OR_EQUAL)}isLessThan(e){return this.compare(e,Y.LESS_THAN)}isGreaterThan(e){return this.compare(e,Y.GREATER_THAN)}concatenateFront(e){return g.create(h.NAME)}concatenateBack(e){return g.create(h.NAME)}plusBy(e){return g.create(h.VALUE)}minusBy(e){return g.create(h.VALUE)}multiplyBy(e){return g.create(h.VALUE)}dividedBy(e){return g.create(h.VALUE)}modInverse(e){return g.create(h.VALUE)}compareBy(e,t,r=!1){return g.create(h.NAME)}concatenate(e,t=st.FRONT){let r=this.getValue().toString();if(typeof e=="string")t===st.FRONT?r=e+r:r+=e;else if(typeof e=="number")t===st.FRONT?r=e.toString()+r:r+=e.toString();else if(typeof e=="boolean"){const n=e?"TRUE":"FALSE";t===st.FRONT?r=n+r:r+=n}return r}pow(e){return g.create(h.VALUE)}powInverse(e){return g.create(h.VALUE)}sqrt(){return g.create(h.VALUE)}cbrt(){return g.create(h.VALUE)}cos(){return g.create(h.VALUE)}cosh(){return g.create(h.VALUE)}acos(){return g.create(h.VALUE)}acosh(){return g.create(h.VALUE)}sin(){return g.create(h.VALUE)}sinh(){return g.create(h.VALUE)}asin(){return g.create(h.VALUE)}asinh(){return g.create(h.VALUE)}tan(){return g.create(h.VALUE)}tanh(){return g.create(h.VALUE)}atan(){return g.create(h.VALUE)}atan2(e){return g.create(h.VALUE)}atan2Inverse(e){return g.create(h.VALUE)}atanh(){return g.create(h.VALUE)}mean(){return this}median(){return this}var(){return this}std(){return this}log(){return g.create(h.VALUE)}log10(){return g.create(h.VALUE)}exp(){return g.create(h.VALUE)}abs(){return g.create(h.VALUE)}round(e){return g.create(h.VALUE)}roundInverse(e){return g.create(h.VALUE)}floor(e){return g.create(h.VALUE)}floorInverse(e){return g.create(h.VALUE)}ceil(e){return g.create(h.VALUE)}ceilInverse(e){return g.create(h.VALUE)}convertToNumberObjectValue(){return g.create(h.VALUE)}convertToBooleanObjectValue(){return g.create(h.VALUE)}}const Il=1e3,xs=new yt(Il);class g extends Nt{constructor(o,e=""){super(o),this._errorType=o,this._errorContent=e}static create(o,e=""){const t=`${o}-${e}`,r=xs.get(t);if(r)return r;const n=new g(o,e);return xs.set(t,n),n}getValue(){return this._errorType}getErrorType(){return this._errorType}getErrorContent(){return this._errorContent}isEqualType(o){return o.getErrorType()===this.getErrorType()}isError(){return!0}}function ia(i){let o;switch(i){case Y.EQUALS:o=Y.EQUALS;break;case Y.GREATER_THAN:o=Y.LESS_THAN;break;case Y.GREATER_THAN_OR_EQUAL:o=Y.LESS_THAN_OR_EQUAL;break;case Y.LESS_THAN:o=Y.GREATER_THAN;break;case Y.LESS_THAN_OR_EQUAL:o=Y.GREATER_THAN_OR_EQUAL;break;case Y.NOT_EQUAL:o=Y.NOT_EQUAL;break}return o}var ar=9e15,It=1e9,js="0123456789abcdef",En="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Rn="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",Us={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-ar,maxE:ar,crypto:!1},uo,Et,ue=!0,Wn="[DecimalError] ",Ut=Wn+"Invalid argument: ",co=Wn+"Precision limit exceeded",lo=Wn+"crypto unavailable",fo="[object Decimal]",ve=Math.floor,we=Math.pow,Fl=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Bl=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,kl=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,mo=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,it=1e7,se=7,$l=9007199254740991,Yl=En.length-1,Ts=Rn.length-1,B={toStringTag:fo};B.absoluteValue=B.abs=function(){var i=new this.constructor(this);return i.s<0&&(i.s=1),te(i)};B.ceil=function(){return te(new this.constructor(this),this.e+1,2)};B.clampedTo=B.clamp=function(i,o){var e,t=this,r=t.constructor;if(i=new r(i),o=new r(o),!i.s||!o.s)return new r(NaN);if(i.gt(o))throw Error(Ut+o);return e=t.cmp(i),e<0?i:t.cmp(o)>0?o:new r(t)};B.comparedTo=B.cmp=function(i){var o,e,t,r,n=this,s=n.d,a=(i=new n.constructor(i)).d,u=n.s,c=i.s;if(!s||!a)return!u||!c?NaN:u!==c?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-c:0;if(u!==c)return u;if(n.e!==i.e)return n.e>i.e^u<0?1:-1;for(t=s.length,r=a.length,o=0,e=t<r?t:r;o<e;++o)if(s[o]!==a[o])return s[o]>a[o]^u<0?1:-1;return t===r?0:t>r^u<0?1:-1};B.cosine=B.cos=function(){var i,o,e=this,t=e.constructor;return e.d?e.d[0]?(i=t.precision,o=t.rounding,t.precision=i+Math.max(e.e,e.sd())+se,t.rounding=1,e=Hl(t,Ao(t,e)),t.precision=i,t.rounding=o,te(Et==2||Et==3?e.neg():e,i,o,!0)):new t(1):new t(NaN)};B.cubeRoot=B.cbrt=function(){var i,o,e,t,r,n,s,a,u,c,l=this,f=l.constructor;if(!l.isFinite()||l.isZero())return new f(l);for(ue=!1,n=l.s*we(l.s*l,1/3),!n||Math.abs(n)==1/0?(e=xe(l.d),i=l.e,(n=(i-e.length+1)%3)&&(e+=n==1||n==-2?"0":"00"),n=we(e,1/3),i=ve((i+1)/3)-(i%3==(i<0?-1:2)),n==1/0?e="5e"+i:(e=n.toExponential(),e=e.slice(0,e.indexOf("e")+1)+i),t=new f(e),t.s=l.s):t=new f(n.toString()),s=(i=f.precision)+3;;)if(a=t,u=a.times(a).times(a),c=u.plus(l),t=Ne(c.plus(l).times(a),c.plus(u),s+2,1),xe(a.d).slice(0,s)===(e=xe(t.d)).slice(0,s))if(e=e.slice(s-3,s+1),e=="9999"||!r&&e=="4999"){if(!r&&(te(a,i+1,0),a.times(a).times(a).eq(l))){t=a;break}s+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(te(t,i+1,1),o=!t.times(t).times(t).eq(l));break}return ue=!0,te(t,i,f.rounding,o)};B.decimalPlaces=B.dp=function(){var i,o=this.d,e=NaN;if(o){if(i=o.length-1,e=(i-ve(this.e/se))*se,i=o[i],i)for(;i%10==0;i/=10)e--;e<0&&(e=0)}return e};B.dividedBy=B.div=function(i){return Ne(this,new this.constructor(i))};B.dividedToIntegerBy=B.divToInt=function(i){var o=this,e=o.constructor;return te(Ne(o,new e(i),0,1,1),e.precision,e.rounding)};B.equals=B.eq=function(i){return this.cmp(i)===0};B.floor=function(){return te(new this.constructor(this),this.e+1,3)};B.greaterThan=B.gt=function(i){return this.cmp(i)>0};B.greaterThanOrEqualTo=B.gte=function(i){var o=this.cmp(i);return o==1||o===0};B.hyperbolicCosine=B.cosh=function(){var i,o,e,t,r,n=this,s=n.constructor,a=new s(1);if(!n.isFinite())return new s(n.s?1/0:NaN);if(n.isZero())return a;e=s.precision,t=s.rounding,s.precision=e+Math.max(n.e,n.sd())+4,s.rounding=1,r=n.d.length,r<32?(i=Math.ceil(r/3),o=(1/qn(4,i)).toString()):(i=16,o="2.3283064365386962890625e-10"),n=mr(s,1,n.times(o),new s(1),!0);for(var u,c=i,l=new s(8);c--;)u=n.times(n),n=a.minus(u.times(l.minus(u.times(l))));return te(n,s.precision=e,s.rounding=t,!0)};B.hyperbolicSine=B.sinh=function(){var i,o,e,t,r=this,n=r.constructor;if(!r.isFinite()||r.isZero())return new n(r);if(o=n.precision,e=n.rounding,n.precision=o+Math.max(r.e,r.sd())+4,n.rounding=1,t=r.d.length,t<3)r=mr(n,2,r,r,!0);else{i=1.4*Math.sqrt(t),i=i>16?16:i|0,r=r.times(1/qn(5,i)),r=mr(n,2,r,r,!0);for(var s,a=new n(5),u=new n(16),c=new n(20);i--;)s=r.times(r),r=r.times(a.plus(s.times(u.times(s).plus(c))))}return n.precision=o,n.rounding=e,te(r,o,e,!0)};B.hyperbolicTangent=B.tanh=function(){var i,o,e=this,t=e.constructor;return e.isFinite()?e.isZero()?new t(e):(i=t.precision,o=t.rounding,t.precision=i+7,t.rounding=1,Ne(e.sinh(),e.cosh(),t.precision=i,t.rounding=o)):new t(e.s)};B.inverseCosine=B.acos=function(){var i=this,o=i.constructor,e=i.abs().cmp(1),t=o.precision,r=o.rounding;return e!==-1?e===0?i.isNeg()?mt(o,t,r):new o(0):new o(NaN):i.isZero()?mt(o,t+4,r).times(.5):(o.precision=t+6,o.rounding=1,i=new o(1).minus(i).div(i.plus(1)).sqrt().atan(),o.precision=t,o.rounding=r,i.times(2))};B.inverseHyperbolicCosine=B.acosh=function(){var i,o,e=this,t=e.constructor;return e.lte(1)?new t(e.eq(1)?0:NaN):e.isFinite()?(i=t.precision,o=t.rounding,t.precision=i+Math.max(Math.abs(e.e),e.sd())+4,t.rounding=1,ue=!1,e=e.times(e).minus(1).sqrt().plus(e),ue=!0,t.precision=i,t.rounding=o,e.ln()):new t(e)};B.inverseHyperbolicSine=B.asinh=function(){var i,o,e=this,t=e.constructor;return!e.isFinite()||e.isZero()?new t(e):(i=t.precision,o=t.rounding,t.precision=i+2*Math.max(Math.abs(e.e),e.sd())+6,t.rounding=1,ue=!1,e=e.times(e).plus(1).sqrt().plus(e),ue=!0,t.precision=i,t.rounding=o,e.ln())};B.inverseHyperbolicTangent=B.atanh=function(){var i,o,e,t,r=this,n=r.constructor;return r.isFinite()?r.e>=0?new n(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(i=n.precision,o=n.rounding,t=r.sd(),Math.max(t,i)<2*-r.e-1?te(new n(r),i,o,!0):(n.precision=e=t-r.e,r=Ne(r.plus(1),new n(1).minus(r),e+i,1),n.precision=i+4,n.rounding=1,r=r.ln(),n.precision=i,n.rounding=o,r.times(.5))):new n(NaN)};B.inverseSine=B.asin=function(){var i,o,e,t,r=this,n=r.constructor;return r.isZero()?new n(r):(o=r.abs().cmp(1),e=n.precision,t=n.rounding,o!==-1?o===0?(i=mt(n,e+4,t).times(.5),i.s=r.s,i):new n(NaN):(n.precision=e+6,n.rounding=1,r=r.div(new n(1).minus(r.times(r)).sqrt().plus(1)).atan(),n.precision=e,n.rounding=t,r.times(2)))};B.inverseTangent=B.atan=function(){var i,o,e,t,r,n,s,a,u,c=this,l=c.constructor,f=l.precision,m=l.rounding;if(c.isFinite()){if(c.isZero())return new l(c);if(c.abs().eq(1)&&f+4<=Ts)return s=mt(l,f+4,m).times(.25),s.s=c.s,s}else{if(!c.s)return new l(NaN);if(f+4<=Ts)return s=mt(l,f+4,m).times(.5),s.s=c.s,s}for(l.precision=a=f+10,l.rounding=1,e=Math.min(28,a/se+2|0),i=e;i;--i)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(ue=!1,o=Math.ceil(a/se),t=1,u=c.times(c),s=new l(c),r=c;i!==-1;)if(r=r.times(u),n=s.minus(r.div(t+=2)),r=r.times(u),s=n.plus(r.div(t+=2)),s.d[o]!==void 0)for(i=o;s.d[i]===n.d[i]&&i--;);return e&&(s=s.times(2<<e-1)),ue=!0,te(s,l.precision=f,l.rounding=m,!0)};B.isFinite=function(){return!!this.d};B.isInteger=B.isInt=function(){return!!this.d&&ve(this.e/se)>this.d.length-2};B.isNaN=function(){return!this.s};B.isNegative=B.isNeg=function(){return this.s<0};B.isPositive=B.isPos=function(){return this.s>0};B.isZero=function(){return!!this.d&&this.d[0]===0};B.lessThan=B.lt=function(i){return this.cmp(i)<0};B.lessThanOrEqualTo=B.lte=function(i){return this.cmp(i)<1};B.logarithm=B.log=function(i){var o,e,t,r,n,s,a,u,c=this,l=c.constructor,f=l.precision,m=l.rounding,d=5;if(i==null)i=new l(10),o=!0;else{if(i=new l(i),e=i.d,i.s<0||!e||!e[0]||i.eq(1))return new l(NaN);o=i.eq(10)}if(e=c.d,c.s<0||!e||!e[0]||c.eq(1))return new l(e&&!e[0]?-1/0:c.s!=1?NaN:e?0:1/0);if(o)if(e.length>1)n=!0;else{for(r=e[0];r%10===0;)r/=10;n=r!==1}if(ue=!1,a=f+d,s=Lt(c,a),t=o?bn(l,a+10):Lt(i,a),u=Ne(s,t,a,1),Dr(u.d,r=f,m))do if(a+=10,s=Lt(c,a),t=o?bn(l,a+10):Lt(i,a),u=Ne(s,t,a,1),!n){+xe(u.d).slice(r+1,r+15)+1==1e14&&(u=te(u,f+1,0));break}while(Dr(u.d,r+=10,m));return ue=!0,te(u,f,m)};B.minus=B.sub=function(i){var o,e,t,r,n,s,a,u,c,l,f,m,d=this,C=d.constructor;if(i=new C(i),!d.d||!i.d)return!d.s||!i.s?i=new C(NaN):d.d?i.s=-i.s:i=new C(i.d||d.s!==i.s?d:NaN),i;if(d.s!=i.s)return i.s=-i.s,d.plus(i);if(c=d.d,m=i.d,a=C.precision,u=C.rounding,!c[0]||!m[0]){if(m[0])i.s=-i.s;else if(c[0])i=new C(d);else return new C(u===3?-0:0);return ue?te(i,a,u):i}if(e=ve(i.e/se),l=ve(d.e/se),c=c.slice(),n=l-e,n){for(f=n<0,f?(o=c,n=-n,s=m.length):(o=m,e=l,s=c.length),t=Math.max(Math.ceil(a/se),s)+2,n>t&&(n=t,o.length=1),o.reverse(),t=n;t--;)o.push(0);o.reverse()}else{for(t=c.length,s=m.length,f=t<s,f&&(s=t),t=0;t<s;t++)if(c[t]!=m[t]){f=c[t]<m[t];break}n=0}for(f&&(o=c,c=m,m=o,i.s=-i.s),s=c.length,t=m.length-s;t>0;--t)c[s++]=0;for(t=m.length;t>n;){if(c[--t]<m[t]){for(r=t;r&&c[--r]===0;)c[r]=it-1;--c[r],c[t]+=it}c[t]-=m[t]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--e;return c[0]?(i.d=c,i.e=Qn(c,e),ue?te(i,a,u):i):new C(u===3?-0:0)};B.modulo=B.mod=function(i){var o,e=this,t=e.constructor;return i=new t(i),!e.d||!i.s||i.d&&!i.d[0]?new t(NaN):!i.d||e.d&&!e.d[0]?te(new t(e),t.precision,t.rounding):(ue=!1,t.modulo==9?(o=Ne(e,i.abs(),0,3,1),o.s*=i.s):o=Ne(e,i,0,t.modulo,1),o=o.times(i),ue=!0,e.minus(o))};B.naturalExponential=B.exp=function(){return vs(this)};B.naturalLogarithm=B.ln=function(){return Lt(this)};B.negated=B.neg=function(){var i=new this.constructor(this);return i.s=-i.s,te(i)};B.plus=B.add=function(i){var o,e,t,r,n,s,a,u,c,l,f=this,m=f.constructor;if(i=new m(i),!f.d||!i.d)return!f.s||!i.s?i=new m(NaN):f.d||(i=new m(i.d||f.s===i.s?f:NaN)),i;if(f.s!=i.s)return i.s=-i.s,f.minus(i);if(c=f.d,l=i.d,a=m.precision,u=m.rounding,!c[0]||!l[0])return l[0]||(i=new m(f)),ue?te(i,a,u):i;if(n=ve(f.e/se),t=ve(i.e/se),c=c.slice(),r=n-t,r){for(r<0?(e=c,r=-r,s=l.length):(e=l,t=n,s=c.length),n=Math.ceil(a/se),s=n>s?n+1:s+1,r>s&&(r=s,e.length=1),e.reverse();r--;)e.push(0);e.reverse()}for(s=c.length,r=l.length,s-r<0&&(r=s,e=l,l=c,c=e),o=0;r;)o=(c[--r]=c[r]+l[r]+o)/it|0,c[r]%=it;for(o&&(c.unshift(o),++t),s=c.length;c[--s]==0;)c.pop();return i.d=c,i.e=Qn(c,t),ue?te(i,a,u):i};B.precision=B.sd=function(i){var o,e=this;if(i!==void 0&&i!==!!i&&i!==1&&i!==0)throw Error(Ut+i);return e.d?(o=ho(e.d),i&&e.e+1>o&&(o=e.e+1)):o=NaN,o};B.round=function(){var i=this,o=i.constructor;return te(new o(i),i.e+1,o.rounding)};B.sine=B.sin=function(){var i,o,e=this,t=e.constructor;return e.isFinite()?e.isZero()?new t(e):(i=t.precision,o=t.rounding,t.precision=i+Math.max(e.e,e.sd())+se,t.rounding=1,e=Wl(t,Ao(t,e)),t.precision=i,t.rounding=o,te(Et>2?e.neg():e,i,o,!0)):new t(NaN)};B.squareRoot=B.sqrt=function(){var i,o,e,t,r,n,s=this,a=s.d,u=s.e,c=s.s,l=s.constructor;if(c!==1||!a||!a[0])return new l(!c||c<0&&(!a||a[0])?NaN:a?s:1/0);for(ue=!1,c=Math.sqrt(+s),c==0||c==1/0?(o=xe(a),(o.length+u)%2==0&&(o+="0"),c=Math.sqrt(o),u=ve((u+1)/2)-(u<0||u%2),c==1/0?o="5e"+u:(o=c.toExponential(),o=o.slice(0,o.indexOf("e")+1)+u),t=new l(o)):t=new l(c.toString()),e=(u=l.precision)+3;;)if(n=t,t=n.plus(Ne(s,n,e+2,1)).times(.5),xe(n.d).slice(0,e)===(o=xe(t.d)).slice(0,e))if(o=o.slice(e-3,e+1),o=="9999"||!r&&o=="4999"){if(!r&&(te(n,u+1,0),n.times(n).eq(s))){t=n;break}e+=4,r=1}else{(!+o||!+o.slice(1)&&o.charAt(0)=="5")&&(te(t,u+1,1),i=!t.times(t).eq(s));break}return ue=!0,te(t,u,l.rounding,i)};B.tangent=B.tan=function(){var i,o,e=this,t=e.constructor;return e.isFinite()?e.isZero()?new t(e):(i=t.precision,o=t.rounding,t.precision=i+10,t.rounding=1,e=e.sin(),e.s=1,e=Ne(e,new t(1).minus(e.times(e)).sqrt(),i+10,0),t.precision=i,t.rounding=o,te(Et==2||Et==4?e.neg():e,i,o,!0)):new t(NaN)};B.times=B.mul=function(i){var o,e,t,r,n,s,a,u,c,l=this,f=l.constructor,m=l.d,d=(i=new f(i)).d;if(i.s*=l.s,!m||!m[0]||!d||!d[0])return new f(!i.s||m&&!m[0]&&!d||d&&!d[0]&&!m?NaN:!m||!d?i.s/0:i.s*0);for(e=ve(l.e/se)+ve(i.e/se),u=m.length,c=d.length,u<c&&(n=m,m=d,d=n,s=u,u=c,c=s),n=[],s=u+c,t=s;t--;)n.push(0);for(t=c;--t>=0;){for(o=0,r=u+t;r>t;)a=n[r]+d[t]*m[r-t-1]+o,n[r--]=a%it|0,o=a/it|0;n[r]=(n[r]+o)%it|0}for(;!n[--s];)n.pop();return o?++e:n.shift(),i.d=n,i.e=Qn(n,e),ue?te(i,f.precision,f.rounding):i};B.toBinary=function(i,o){return oa(this,2,i,o)};B.toDecimalPlaces=B.toDP=function(i,o){var e=this,t=e.constructor;return e=new t(e),i===void 0?e:($e(i,0,It),o===void 0?o=t.rounding:$e(o,0,8),te(e,i+e.e+1,o))};B.toExponential=function(i,o){var e,t=this,r=t.constructor;return i===void 0?e=gt(t,!0):($e(i,0,It),o===void 0?o=r.rounding:$e(o,0,8),t=te(new r(t),i+1,o),e=gt(t,!0,i+1)),t.isNeg()&&!t.isZero()?"-"+e:e};B.toFixed=function(i,o){var e,t,r=this,n=r.constructor;return i===void 0?e=gt(r):($e(i,0,It),o===void 0?o=n.rounding:$e(o,0,8),t=te(new n(r),i+r.e+1,o),e=gt(t,!1,i+t.e+1)),r.isNeg()&&!r.isZero()?"-"+e:e};B.toFraction=function(i){var o,e,t,r,n,s,a,u,c,l,f,m,d=this,C=d.d,_=d.constructor;if(!C)return new _(d);if(c=e=new _(1),t=u=new _(0),o=new _(t),n=o.e=ho(C)-d.e-1,s=n%se,o.d[0]=we(10,s<0?se+s:s),i==null)i=n>0?o:c;else{if(a=new _(i),!a.isInt()||a.lt(c))throw Error(Ut+a);i=a.gt(o)?n>0?o:c:a}for(ue=!1,a=new _(xe(C)),l=_.precision,_.precision=n=C.length*se*2;f=Ne(a,o,0,1,1),r=e.plus(f.times(t)),r.cmp(i)!=1;)e=t,t=r,r=c,c=u.plus(f.times(r)),u=r,r=o,o=a.minus(f.times(r)),a=r;return r=Ne(i.minus(e),t,0,1,1),u=u.plus(r.times(c)),e=e.plus(r.times(t)),u.s=c.s=d.s,m=Ne(c,t,n,1).minus(d).abs().cmp(Ne(u,e,n,1).minus(d).abs())<1?[c,t]:[u,e],_.precision=l,ue=!0,m};B.toHexadecimal=B.toHex=function(i,o){return oa(this,16,i,o)};B.toNearest=function(i,o){var e=this,t=e.constructor;if(e=new t(e),i==null){if(!e.d)return e;i=new t(1),o=t.rounding}else{if(i=new t(i),o===void 0?o=t.rounding:$e(o,0,8),!e.d)return i.s?e:i;if(!i.d)return i.s&&(i.s=e.s),i}return i.d[0]?(ue=!1,e=Ne(e,i,0,o,1).times(i),ue=!0,te(e)):(i.s=e.s,e=i),e};B.toNumber=function(){return+this};B.toOctal=function(i,o){return oa(this,8,i,o)};B.toPower=B.pow=function(i){var o,e,t,r,n,s,a=this,u=a.constructor,c=+(i=new u(i));if(!a.d||!i.d||!a.d[0]||!i.d[0])return new u(we(+a,c));if(a=new u(a),a.eq(1))return a;if(t=u.precision,n=u.rounding,i.eq(1))return te(a,t,n);if(o=ve(i.e/se),o>=i.d.length-1&&(e=c<0?-c:c)<=$l)return r=go(u,a,e,t),i.s<0?new u(1).div(r):te(r,t,n);if(s=a.s,s<0){if(o<i.d.length-1)return new u(NaN);if((i.d[o]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return e=we(+a,c),o=e==0||!isFinite(e)?ve(c*(Math.log("0."+xe(a.d))/Math.LN10+a.e+1)):new u(e+"").e,o>u.maxE+1||o<u.minE-1?new u(o>0?s/0:0):(ue=!1,u.rounding=a.s=1,e=Math.min(12,(o+"").length),r=vs(i.times(Lt(a,t+e)),t),r.d&&(r=te(r,t+5,1),Dr(r.d,t,n)&&(o=t+10,r=te(vs(i.times(Lt(a,o+e)),o),o+5,1),+xe(r.d).slice(t+1,t+15)+1==1e14&&(r=te(r,t+1,0)))),r.s=s,ue=!0,u.rounding=n,te(r,t,n))};B.toPrecision=function(i,o){var e,t=this,r=t.constructor;return i===void 0?e=gt(t,t.e<=r.toExpNeg||t.e>=r.toExpPos):($e(i,1,It),o===void 0?o=r.rounding:$e(o,0,8),t=te(new r(t),i,o),e=gt(t,i<=t.e||t.e<=r.toExpNeg,i)),t.isNeg()&&!t.isZero()?"-"+e:e};B.toSignificantDigits=B.toSD=function(i,o){var e=this,t=e.constructor;return i===void 0?(i=t.precision,o=t.rounding):($e(i,1,It),o===void 0?o=t.rounding:$e(o,0,8)),te(new t(e),i,o)};B.toString=function(){var i=this,o=i.constructor,e=gt(i,i.e<=o.toExpNeg||i.e>=o.toExpPos);return i.isNeg()&&!i.isZero()?"-"+e:e};B.truncated=B.trunc=function(){return te(new this.constructor(this),this.e+1,1)};B.valueOf=B.toJSON=function(){var i=this,o=i.constructor,e=gt(i,i.e<=o.toExpNeg||i.e>=o.toExpPos);return i.isNeg()?"-"+e:e};function xe(i){var o,e,t,r=i.length-1,n="",s=i[0];if(r>0){for(n+=s,o=1;o<r;o++)t=i[o]+"",e=se-t.length,e&&(n+=Dt(e)),n+=t;s=i[o],t=s+"",e=se-t.length,e&&(n+=Dt(e))}else if(s===0)return"0";for(;s%10===0;)s/=10;return n+s}function $e(i,o,e){if(i!==~~i||i<o||i>e)throw Error(Ut+i)}function Dr(i,o,e,t){var r,n,s,a;for(n=i[0];n>=10;n/=10)--o;return--o<0?(o+=se,r=0):(r=Math.ceil((o+1)/se),o%=se),n=we(10,se-o),a=i[r]%n|0,t==null?o<3?(o==0?a=a/100|0:o==1&&(a=a/10|0),s=e<4&&a==99999||e>3&&a==49999||a==5e4||a==0):s=(e<4&&a+1==n||e>3&&a+1==n/2)&&(i[r+1]/n/100|0)==we(10,o-2)-1||(a==n/2||a==0)&&(i[r+1]/n/100|0)==0:o<4?(o==0?a=a/1e3|0:o==1?a=a/100|0:o==2&&(a=a/10|0),s=(t||e<4)&&a==9999||!t&&e>3&&a==4999):s=((t||e<4)&&a+1==n||!t&&e>3&&a+1==n/2)&&(i[r+1]/n/1e3|0)==we(10,o-3)-1,s}function an(i,o,e){for(var t,r=[0],n,s=0,a=i.length;s<a;){for(n=r.length;n--;)r[n]*=o;for(r[0]+=js.indexOf(i.charAt(s++)),t=0;t<r.length;t++)r[t]>e-1&&(r[t+1]===void 0&&(r[t+1]=0),r[t+1]+=r[t]/e|0,r[t]%=e)}return r.reverse()}function Hl(i,o){var e,t,r;if(o.isZero())return o;t=o.d.length,t<32?(e=Math.ceil(t/3),r=(1/qn(4,e)).toString()):(e=16,r="2.3283064365386962890625e-10"),i.precision+=e,o=mr(i,1,o.times(r),new i(1));for(var n=e;n--;){var s=o.times(o);o=s.times(s).minus(s).times(8).plus(1)}return i.precision-=e,o}var Ne=(function(){function i(t,r,n){var s,a=0,u=t.length;for(t=t.slice();u--;)s=t[u]*r+a,t[u]=s%n|0,a=s/n|0;return a&&t.unshift(a),t}function o(t,r,n,s){var a,u;if(n!=s)u=n>s?1:-1;else for(a=u=0;a<n;a++)if(t[a]!=r[a]){u=t[a]>r[a]?1:-1;break}return u}function e(t,r,n,s){for(var a=0;n--;)t[n]-=a,a=t[n]<r[n]?1:0,t[n]=a*s+t[n]-r[n];for(;!t[0]&&t.length>1;)t.shift()}return function(t,r,n,s,a,u){var c,l,f,m,d,C,_,E,R,b,p,V,S,D,w,L,P,v,U,$,W=t.constructor,re=t.s==r.s?1:-1,J=t.d,H=r.d;if(!J||!J[0]||!H||!H[0])return new W(!t.s||!r.s||(J?H&&J[0]==H[0]:!H)?NaN:J&&J[0]==0||!H?re*0:re/0);for(u?(d=1,l=t.e-r.e):(u=it,d=se,l=ve(t.e/d)-ve(r.e/d)),U=H.length,P=J.length,R=new W(re),b=R.d=[],f=0;H[f]==(J[f]||0);f++);if(H[f]>(J[f]||0)&&l--,n==null?(D=n=W.precision,s=W.rounding):a?D=n+(t.e-r.e)+1:D=n,D<0)b.push(1),C=!0;else{if(D=D/d+2|0,f=0,U==1){for(m=0,H=H[0],D++;(f<P||m)&&D--;f++)w=m*u+(J[f]||0),b[f]=w/H|0,m=w%H|0;C=m||f<P}else{for(m=u/(H[0]+1)|0,m>1&&(H=i(H,m,u),J=i(J,m,u),U=H.length,P=J.length),L=U,p=J.slice(0,U),V=p.length;V<U;)p[V++]=0;$=H.slice(),$.unshift(0),v=H[0],H[1]>=u/2&&++v;do m=0,c=o(H,p,U,V),c<0?(S=p[0],U!=V&&(S=S*u+(p[1]||0)),m=S/v|0,m>1?(m>=u&&(m=u-1),_=i(H,m,u),E=_.length,V=p.length,c=o(_,p,E,V),c==1&&(m--,e(_,U<E?$:H,E,u))):(m==0&&(c=m=1),_=H.slice()),E=_.length,E<V&&_.unshift(0),e(p,_,V,u),c==-1&&(V=p.length,c=o(H,p,U,V),c<1&&(m++,e(p,U<V?$:H,V,u))),V=p.length):c===0&&(m++,p=[0]),b[f++]=m,c&&p[0]?p[V++]=J[L]||0:(p=[J[L]],V=1);while((L++<P||p[0]!==void 0)&&D--);C=p[0]!==void 0}b[0]||b.shift()}if(d==1)R.e=l,uo=C;else{for(f=1,m=b[0];m>=10;m/=10)f++;R.e=f+l*d-1,te(R,a?n+R.e+1:n,s,C)}return R}})();function te(i,o,e,t){var r,n,s,a,u,c,l,f,m,d=i.constructor;e:if(o!=null){if(f=i.d,!f)return i;for(r=1,a=f[0];a>=10;a/=10)r++;if(n=o-r,n<0)n+=se,s=o,l=f[m=0],u=l/we(10,r-s-1)%10|0;else if(m=Math.ceil((n+1)/se),a=f.length,m>=a)if(t){for(;a++<=m;)f.push(0);l=u=0,r=1,n%=se,s=n-se+1}else break e;else{for(l=a=f[m],r=1;a>=10;a/=10)r++;n%=se,s=n-se+r,u=s<0?0:l/we(10,r-s-1)%10|0}if(t=t||o<0||f[m+1]!==void 0||(s<0?l:l%we(10,r-s-1)),c=e<4?(u||t)&&(e==0||e==(i.s<0?3:2)):u>5||u==5&&(e==4||t||e==6&&(n>0?s>0?l/we(10,r-s):0:f[m-1])%10&1||e==(i.s<0?8:7)),o<1||!f[0])return f.length=0,c?(o-=i.e+1,f[0]=we(10,(se-o%se)%se),i.e=-o||0):f[0]=i.e=0,i;if(n==0?(f.length=m,a=1,m--):(f.length=m+1,a=we(10,se-n),f[m]=s>0?(l/we(10,r-s)%we(10,s)|0)*a:0),c)for(;;)if(m==0){for(n=1,s=f[0];s>=10;s/=10)n++;for(s=f[0]+=a,a=1;s>=10;s/=10)a++;n!=a&&(i.e++,f[0]==it&&(f[0]=1));break}else{if(f[m]+=a,f[m]!=it)break;f[m--]=0,a=1}for(n=f.length;f[--n]===0;)f.pop()}return ue&&(i.e>d.maxE?(i.d=null,i.e=NaN):i.e<d.minE&&(i.e=0,i.d=[0])),i}function gt(i,o,e){if(!i.isFinite())return _o(i);var t,r=i.e,n=xe(i.d),s=n.length;return o?(e&&(t=e-s)>0?n=n.charAt(0)+"."+n.slice(1)+Dt(t):s>1&&(n=n.charAt(0)+"."+n.slice(1)),n=n+(i.e<0?"e":"e+")+i.e):r<0?(n="0."+Dt(-r-1)+n,e&&(t=e-s)>0&&(n+=Dt(t))):r>=s?(n+=Dt(r+1-s),e&&(t=e-r-1)>0&&(n=n+"."+Dt(t))):((t=r+1)<s&&(n=n.slice(0,t)+"."+n.slice(t)),e&&(t=e-s)>0&&(r+1===s&&(n+="."),n+=Dt(t))),n}function Qn(i,o){var e=i[0];for(o*=se;e>=10;e/=10)o++;return o}function bn(i,o,e){if(o>Yl)throw ue=!0,e&&(i.precision=e),Error(co);return te(new i(En),o,1,!0)}function mt(i,o,e){if(o>Ts)throw Error(co);return te(new i(Rn),o,e,!0)}function ho(i){var o=i.length-1,e=o*se+1;if(o=i[o],o){for(;o%10==0;o/=10)e--;for(o=i[0];o>=10;o/=10)e++}return e}function Dt(i){for(var o="";i--;)o+="0";return o}function go(i,o,e,t){var r,n=new i(1),s=Math.ceil(t/se+4);for(ue=!1;;){if(e%2&&(n=n.times(o),ui(n.d,s)&&(r=!0)),e=ve(e/2),e===0){e=n.d.length-1,r&&n.d[e]===0&&++n.d[e];break}o=o.times(o),ui(o.d,s)}return ue=!0,n}function oi(i){return i.d[i.d.length-1]&1}function Co(i,o,e){for(var t,r,n=new i(o[0]),s=0;++s<o.length;){if(r=new i(o[s]),!r.s){n=r;break}t=n.cmp(r),(t===e||t===0&&n.s===e)&&(n=r)}return n}function vs(i,o){var e,t,r,n,s,a,u,c=0,l=0,f=0,m=i.constructor,d=m.rounding,C=m.precision;if(!i.d||!i.d[0]||i.e>17)return new m(i.d?i.d[0]?i.s<0?0:1/0:1:i.s?i.s<0?0:i:NaN);for(o==null?(ue=!1,u=C):u=o,a=new m(.03125);i.e>-2;)i=i.times(a),f+=5;for(t=Math.log(we(2,f))/Math.LN10*2+5|0,u+=t,e=n=s=new m(1),m.precision=u;;){if(n=te(n.times(i),u,1),e=e.times(++l),a=s.plus(Ne(n,e,u,1)),xe(a.d).slice(0,u)===xe(s.d).slice(0,u)){for(r=f;r--;)s=te(s.times(s),u,1);if(o==null)if(c<3&&Dr(s.d,u-t,d,c))m.precision=u+=10,e=n=a=new m(1),l=0,c++;else return te(s,m.precision=C,d,ue=!0);else return m.precision=C,s}s=a}}function Lt(i,o){var e,t,r,n,s,a,u,c,l,f,m,d=1,C=10,_=i,E=_.d,R=_.constructor,b=R.rounding,p=R.precision;if(_.s<0||!E||!E[0]||!_.e&&E[0]==1&&E.length==1)return new R(E&&!E[0]?-1/0:_.s!=1?NaN:E?0:_);if(o==null?(ue=!1,l=p):l=o,R.precision=l+=C,e=xe(E),t=e.charAt(0),Math.abs(n=_.e)<15e14){for(;t<7&&t!=1||t==1&&e.charAt(1)>3;)_=_.times(i),e=xe(_.d),t=e.charAt(0),d++;n=_.e,t>1?(_=new R("0."+e),n++):_=new R(t+"."+e.slice(1))}else return c=bn(R,l+2,p).times(n+""),_=Lt(new R(t+"."+e.slice(1)),l-C).plus(c),R.precision=p,o==null?te(_,p,b,ue=!0):_;for(f=_,u=s=_=Ne(_.minus(1),_.plus(1),l,1),m=te(_.times(_),l,1),r=3;;){if(s=te(s.times(m),l,1),c=u.plus(Ne(s,new R(r),l,1)),xe(c.d).slice(0,l)===xe(u.d).slice(0,l))if(u=u.times(2),n!==0&&(u=u.plus(bn(R,l+2,p).times(n+""))),u=Ne(u,new R(d),l,1),o==null)if(Dr(u.d,l-C,b,a))R.precision=l+=C,c=s=_=Ne(f.minus(1),f.plus(1),l,1),m=te(_.times(_),l,1),r=a=1;else return te(u,R.precision=p,b,ue=!0);else return R.precision=p,u;u=c,r+=2}}function _o(i){return String(i.s*i.s/0)}function on(i,o){var e,t,r;for((e=o.indexOf("."))>-1&&(o=o.replace(".","")),(t=o.search(/e/i))>0?(e<0&&(e=t),e+=+o.slice(t+1),o=o.substring(0,t)):e<0&&(e=o.length),t=0;o.charCodeAt(t)===48;t++);for(r=o.length;o.charCodeAt(r-1)===48;--r);if(o=o.slice(t,r),o){if(r-=t,i.e=e=e-t-1,i.d=[],t=(e+1)%se,e<0&&(t+=se),t<r){for(t&&i.d.push(+o.slice(0,t)),r-=se;t<r;)i.d.push(+o.slice(t,t+=se));o=o.slice(t),t=se-o.length}else t-=r;for(;t--;)o+="0";i.d.push(+o),ue&&(i.e>i.constructor.maxE?(i.d=null,i.e=NaN):i.e<i.constructor.minE&&(i.e=0,i.d=[0]))}else i.e=0,i.d=[0];return i}function Gl(i,o){var e,t,r,n,s,a,u,c,l;if(o.indexOf("_")>-1){if(o=o.replace(/(\d)_(?=\d)/g,"$1"),mo.test(o))return on(i,o)}else if(o==="Infinity"||o==="NaN")return+o||(i.s=NaN),i.e=NaN,i.d=null,i;if(Bl.test(o))e=16,o=o.toLowerCase();else if(Fl.test(o))e=2;else if(kl.test(o))e=8;else throw Error(Ut+o);for(n=o.search(/p/i),n>0?(u=+o.slice(n+1),o=o.substring(2,n)):o=o.slice(2),n=o.indexOf("."),s=n>=0,t=i.constructor,s&&(o=o.replace(".",""),a=o.length,n=a-n,r=go(t,new t(e),n,n*2)),c=an(o,e,it),l=c.length-1,n=l;c[n]===0;--n)c.pop();return n<0?new t(i.s*0):(i.e=Qn(c,l),i.d=c,ue=!1,s&&(i=Ne(i,r,a*4)),u&&(i=i.times(Math.abs(u)<54?we(2,u):j.pow(2,u))),ue=!0,i)}function Wl(i,o){var e,t=o.d.length;if(t<3)return o.isZero()?o:mr(i,2,o,o);e=1.4*Math.sqrt(t),e=e>16?16:e|0,o=o.times(1/qn(5,e)),o=mr(i,2,o,o);for(var r,n=new i(5),s=new i(16),a=new i(20);e--;)r=o.times(o),o=o.times(n.plus(r.times(s.times(r).minus(a))));return o}function mr(i,o,e,t,r){var n,s,a,u,c=i.precision,l=Math.ceil(c/se);for(ue=!1,u=e.times(e),a=new i(t);;){if(s=Ne(a.times(u),new i(o++*o++),c,1),a=r?t.plus(s):t.minus(s),t=Ne(s.times(u),new i(o++*o++),c,1),s=a.plus(t),s.d[l]!==void 0){for(n=l;s.d[n]===a.d[n]&&n--;);if(n==-1)break}n=a,a=t,t=s,s=n}return ue=!0,s.d.length=l+1,s}function qn(i,o){for(var e=i;--o;)e*=i;return e}function Ao(i,o){var e,t=o.s<0,r=mt(i,i.precision,1),n=r.times(.5);if(o=o.abs(),o.lte(n))return Et=t?4:1,o;if(e=o.divToInt(r),e.isZero())Et=t?3:2;else{if(o=o.minus(e.times(r)),o.lte(n))return Et=oi(e)?t?2:3:t?4:1,o;Et=oi(e)?t?1:4:t?3:2}return o.minus(r).abs()}function oa(i,o,e,t){var r,n,s,a,u,c,l,f,m,d=i.constructor,C=e!==void 0;if(C?($e(e,1,It),t===void 0?t=d.rounding:$e(t,0,8)):(e=d.precision,t=d.rounding),!i.isFinite())l=_o(i);else{for(l=gt(i),s=l.indexOf("."),C?(r=2,o==16?e=e*4-3:o==8&&(e=e*3-2)):r=o,s>=0&&(l=l.replace(".",""),m=new d(1),m.e=l.length-s,m.d=an(gt(m),10,r),m.e=m.d.length),f=an(l,10,r),n=u=f.length;f[--u]==0;)f.pop();if(!f[0])l=C?"0p+0":"0";else{if(s<0?n--:(i=new d(i),i.d=f,i.e=n,i=Ne(i,m,e,t,0,r),f=i.d,n=i.e,c=uo),s=f[e],a=r/2,c=c||f[e+1]!==void 0,c=t<4?(s!==void 0||c)&&(t===0||t===(i.s<0?3:2)):s>a||s===a&&(t===4||c||t===6&&f[e-1]&1||t===(i.s<0?8:7)),f.length=e,c)for(;++f[--e]>r-1;)f[e]=0,e||(++n,f.unshift(1));for(u=f.length;!f[u-1];--u);for(s=0,l="";s<u;s++)l+=js.charAt(f[s]);if(C){if(u>1)if(o==16||o==8){for(s=o==16?4:3,--u;u%s;u++)l+="0";for(f=an(l,r,o),u=f.length;!f[u-1];--u);for(s=1,l="1.";s<u;s++)l+=js.charAt(f[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(n<0?"p":"p+")+n}else if(n<0){for(;++n;)l="0"+l;l="0."+l}else if(++n>u)for(n-=u;n--;)l+="0";else n<u&&(l=l.slice(0,n)+"."+l.slice(n))}l=(o==16?"0x":o==2?"0b":o==8?"0o":"")+l}return i.s<0?"-"+l:l}function ui(i,o){if(i.length>o)return i.length=o,!0}function Ql(i){return new this(i).abs()}function ql(i){return new this(i).acos()}function Xl(i){return new this(i).acosh()}function Kl(i,o){return new this(i).plus(o)}function Zl(i){return new this(i).asin()}function zl(i){return new this(i).asinh()}function Jl(i){return new this(i).atan()}function ef(i){return new this(i).atanh()}function tf(i,o){i=new this(i),o=new this(o);var e,t=this.precision,r=this.rounding,n=t+4;return!i.s||!o.s?e=new this(NaN):!i.d&&!o.d?(e=mt(this,n,1).times(o.s>0?.25:.75),e.s=i.s):!o.d||i.isZero()?(e=o.s<0?mt(this,t,r):new this(0),e.s=i.s):!i.d||o.isZero()?(e=mt(this,n,1).times(.5),e.s=i.s):o.s<0?(this.precision=n,this.rounding=1,e=this.atan(Ne(i,o,n,1)),o=mt(this,n,1),this.precision=t,this.rounding=r,e=i.s<0?e.minus(o):e.plus(o)):e=this.atan(Ne(i,o,n,1)),e}function rf(i){return new this(i).cbrt()}function nf(i){return te(i=new this(i),i.e+1,2)}function sf(i,o,e){return new this(i).clamp(o,e)}function af(i){if(!i||typeof i!="object")throw Error(Wn+"Object expected");var o,e,t,r=i.defaults===!0,n=["precision",1,It,"rounding",0,8,"toExpNeg",-ar,0,"toExpPos",0,ar,"maxE",0,ar,"minE",-ar,0,"modulo",0,9];for(o=0;o<n.length;o+=3)if(e=n[o],r&&(this[e]=Us[e]),(t=i[e])!==void 0)if(ve(t)===t&&t>=n[o+1]&&t<=n[o+2])this[e]=t;else throw Error(Ut+e+": "+t);if(e="crypto",r&&(this[e]=Us[e]),(t=i[e])!==void 0)if(t===!0||t===!1||t===0||t===1)if(t)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[e]=!0;else throw Error(lo);else this[e]=!1;else throw Error(Ut+e+": "+t);return this}function of(i){return new this(i).cos()}function uf(i){return new this(i).cosh()}function Eo(i){var o,e,t;function r(n){var s,a,u,c=this;if(!(c instanceof r))return new r(n);if(c.constructor=r,ci(n)){c.s=n.s,ue?!n.d||n.e>r.maxE?(c.e=NaN,c.d=null):n.e<r.minE?(c.e=0,c.d=[0]):(c.e=n.e,c.d=n.d.slice()):(c.e=n.e,c.d=n.d?n.d.slice():n.d);return}if(u=typeof n,u==="number"){if(n===0){c.s=1/n<0?-1:1,c.e=0,c.d=[0];return}if(n<0?(n=-n,c.s=-1):c.s=1,n===~~n&&n<1e7){for(s=0,a=n;a>=10;a/=10)s++;ue?s>r.maxE?(c.e=NaN,c.d=null):s<r.minE?(c.e=0,c.d=[0]):(c.e=s,c.d=[n]):(c.e=s,c.d=[n]);return}if(n*0!==0){n||(c.s=NaN),c.e=NaN,c.d=null;return}return on(c,n.toString())}if(u==="string")return(a=n.charCodeAt(0))===45?(n=n.slice(1),c.s=-1):(a===43&&(n=n.slice(1)),c.s=1),mo.test(n)?on(c,n):Gl(c,n);if(u==="bigint")return n<0?(n=-n,c.s=-1):c.s=1,on(c,n.toString());throw Error(Ut+n)}if(r.prototype=B,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=af,r.clone=Eo,r.isDecimal=ci,r.abs=Ql,r.acos=ql,r.acosh=Xl,r.add=Kl,r.asin=Zl,r.asinh=zl,r.atan=Jl,r.atanh=ef,r.atan2=tf,r.cbrt=rf,r.ceil=nf,r.clamp=sf,r.cos=of,r.cosh=uf,r.div=cf,r.exp=lf,r.floor=ff,r.hypot=mf,r.ln=hf,r.log=gf,r.log10=Cf,r.log2=df,r.max=_f,r.min=Af,r.mod=Ef,r.mul=Rf,r.pow=bf,r.random=yf,r.round=pf,r.sign=Nf,r.sin=Vf,r.sinh=Of,r.sqrt=Sf,r.sub=Mf,r.sum=Df,r.tan=wf,r.tanh=Lf,r.trunc=Pf,i===void 0&&(i={}),i&&i.defaults!==!0)for(t=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],o=0;o<t.length;)i.hasOwnProperty(e=t[o++])||(i[e]=this[e]);return r.config(i),r}function cf(i,o){return new this(i).div(o)}function lf(i){return new this(i).exp()}function ff(i){return te(i=new this(i),i.e+1,3)}function mf(){var i,o,e=new this(0);for(ue=!1,i=0;i<arguments.length;)if(o=new this(arguments[i++]),o.d)e.d&&(e=e.plus(o.times(o)));else{if(o.s)return ue=!0,new this(1/0);e=o}return ue=!0,e.sqrt()}function ci(i){return i instanceof j||i&&i.toStringTag===fo||!1}function hf(i){return new this(i).ln()}function gf(i,o){return new this(i).log(o)}function df(i){return new this(i).log(2)}function Cf(i){return new this(i).log(10)}function _f(){return Co(this,arguments,-1)}function Af(){return Co(this,arguments,1)}function Ef(i,o){return new this(i).mod(o)}function Rf(i,o){return new this(i).mul(o)}function bf(i,o){return new this(i).pow(o)}function yf(i){var o,e,t,r,n=0,s=new this(1),a=[];if(i===void 0?i=this.precision:$e(i,1,It),t=Math.ceil(i/se),this.crypto)if(crypto.getRandomValues)for(o=crypto.getRandomValues(new Uint32Array(t));n<t;)r=o[n],r>=429e7?o[n]=crypto.getRandomValues(new Uint32Array(1))[0]:a[n++]=r%1e7;else if(crypto.randomBytes){for(o=crypto.randomBytes(t*=4);n<t;)r=o[n]+(o[n+1]<<8)+(o[n+2]<<16)+((o[n+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(o,n):(a.push(r%1e7),n+=4);n=t/4}else throw Error(lo);else for(;n<t;)a[n++]=Math.random()*1e7|0;for(t=a[--n],i%=se,t&&i&&(r=we(10,se-i),a[n]=(t/r|0)*r);a[n]===0;n--)a.pop();if(n<0)e=0,a=[0];else{for(e=-1;a[0]===0;e-=se)a.shift();for(t=1,r=a[0];r>=10;r/=10)t++;t<se&&(e-=se-t)}return s.e=e,s.d=a,s}function pf(i){return te(i=new this(i),i.e+1,this.rounding)}function Nf(i){return i=new this(i),i.d?i.d[0]?i.s:0*i.s:i.s||NaN}function Vf(i){return new this(i).sin()}function Of(i){return new this(i).sinh()}function Sf(i){return new this(i).sqrt()}function Mf(i,o){return new this(i).sub(o)}function Df(){var i=0,o=arguments,e=new this(o[i]);for(ue=!1;e.s&&++i<o.length;)e=e.plus(o[i]);return ue=!0,te(e,this.precision,this.rounding)}function wf(i){return new this(i).tan()}function Lf(i){return new this(i).tanh()}function Pf(i){return te(i=new this(i),i.e+1,1)}B[Symbol.for("nodejs.util.inspect.custom")]=B.toString;B[Symbol.toStringTag]="Decimal";var j=B.constructor=Eo(Us);En=new j(En);Rn=new j(Rn);function xf(i,o){const e=i+o;return Number.isSafeInteger(e)?e:new j(i).add(o).toNumber()}function jf(i,o){const e=i-o;return Number.isSafeInteger(e)?e:new j(i).sub(o).toNumber()}function Er(i,o){const e=i*o;return Number.isSafeInteger(e)?e:new j(i).mul(o).toNumber()}function Uf(i,o){const e=i/o;return Number.isSafeInteger(e)?e:new j(i).div(o).toNumber()}function Pt(i,o){const e=10**Math.trunc(o),t=Xn(i,e);return Math.round(Er(i,e)+t)/e}function We(i,o){const e=10**Math.trunc(o),t=Xn(i,e);return Math.floor(Er(i,e)+t)/e}function ke(i,o){const e=10**Math.trunc(o),t=Xn(i,e);return Math.ceil(Er(i,e)-t)/e}function Xn(i,o){return Number.EPSILON*Math.max(1,Math.abs(Er(i,o)))}function li(i,o){return i-o*Math.floor(i/o)}function Tf(i,o){return i**o}function vf(i){return Math.sqrt(i)}function fi(i,o){return i===o}function If(i,o){return i>o}function Ff(i,o){return i>=o}function Bf(i,o){return i<o}function kf(i,o){return i<=o}function Is(i,o=15){return Math.floor(Math.abs(i)).toString().length>=o?i:Number.parseFloat(i.toPrecision(o))}function $f(i,o,e=Number.EPSILON){return Math.abs(i-o)<e}function Kn(i,o=12,e=1e-10){const t=Is(i,o);return $f(i,t,e)?t:Is(i)}function Yf(i){return i-Math.trunc(i)}const Tn=class Tn extends Nt{static create(){return this._instance=this._instance||new Tn(0),this._instance}isNull(){return!0}plus(o){return y.create(0).plus(o)}minus(o){return y.create(0).minus(o)}multiply(o){return y.create(0).multiply(o)}divided(o){return y.create(0).divided(o)}mod(o){return y.create(0).mod(o)}compare(o,e){return o.isString()?T.create("").compare(o,e):o.isBoolean()?I.create(!1).compare(o,e):y.create(0).compare(o,e)}concatenateFront(o){return o.isArray()?o.concatenateBack(T.create("")):T.create(this.concatenate(o.getValue(),st.FRONT))}concatenateBack(o){return o.isArray()?o.concatenateFront(T.create("")):T.create(this.concatenate(o.getValue(),st.BACK))}plusBy(o){return y.create(0).plusBy(o)}minusBy(o){return y.create(0).minusBy(o)}multiplyBy(o){return y.create(0).multiplyBy(o)}dividedBy(o){return y.create(0).dividedBy(o)}compareBy(o,e){return typeof o=="string"?T.create("").compareBy(o,e):typeof o=="boolean"?I.create(!1).compareBy(o,e):y.create(0).compareBy(o,e)}pow(o){return y.create(0).pow(o)}sqrt(){return y.create(0).sqrt()}cbrt(){return y.create(0).cbrt()}cos(){return y.create(0).cos()}cosh(){return y.create(0).cosh()}acos(){return y.create(0).acos()}acosh(){return y.create(0).acosh()}sin(){return y.create(0).sin()}sinh(){return y.create(0).sinh()}asin(){return y.create(0).asin()}asinh(){return y.create(0).asinh()}tan(){return y.create(0).tan()}tanh(){return y.create(0).tanh()}atan(){return y.create(0).atan()}atan2(o){return y.create(0).atan2(o)}atanh(){return y.create(0).atanh()}log(){return g.create(h.NUM)}log10(){return g.create(h.NUM)}exp(){return y.create(0).exp()}abs(){return y.create(0).abs()}round(o){return y.create(0).round(o)}floor(o){return y.create(0).floor(o)}ceil(o){return y.create(0).ceil(o)}convertToNumberObjectValue(){return y.create(0)}convertToBooleanObjectValue(){return I.create(!1)}};A(Tn,"_instance");let ce=Tn;const Yt=class Yt extends Nt{constructor(e){super(e);A(this,"_value",!1);this._value=e}static create(e){return e?(this._instanceTrue=this._instanceTrue||new Yt(!0),this._instanceTrue):(this._instanceFalse=this._instanceFalse||new Yt(!1),this._instanceFalse)}getValue(){return this._value}isBoolean(){return!0}getNegative(){const e=this.getValue();let t=0;return e&&(t=1),y.create(-t)}getReciprocal(){return this.getValue()?y.create(1):g.create(h.DIV_BY_ZERO)}plus(e){return this._convertToNumber().plus(e)}minus(e){return this._convertToNumber().minus(e)}multiply(e){return this._convertToNumber().multiply(e)}divided(e){return this._convertToNumber().divided(e)}mod(e){return this._convertToNumber().mod(e)}compare(e,t){return e.isArray()?e.compare(this,ia(t)):e.isNull()?this._convertToNumber().compare(e,t):this.compareBy(e.getValue(),t)}compareBy(e,t){let r=!1;if(typeof e=="string"||typeof e=="number")r=this._compareString(t);else if(typeof e=="boolean"){const n=y.create(e?1:0);return this._convertToNumber().compare(n,t)}return Yt.create(r)}_compareString(e){switch(e){case Y.GREATER_THAN:case Y.GREATER_THAN_OR_EQUAL:return!0;case Y.EQUALS:case Y.LESS_THAN:case Y.LESS_THAN_OR_EQUAL:case Y.NOT_EQUAL:return!1}}concatenateFront(e){return this._convertToNumber().concatenateFront(e)}concatenateBack(e){return this._convertToNumber().concatenateBack(e)}_convertToNumber(){const e=this.getValue();let t=0;return e&&(t=1),y.create(t)}pow(e){return this._convertToNumber().pow(e)}sqrt(){return this._convertToNumber().sqrt()}cbrt(){return this._convertToNumber().cbrt()}cos(){return this._convertToNumber().cos()}cosh(){return this._convertToNumber().cosh()}acos(){return this._convertToNumber().acos()}acosh(){return this._convertToNumber().acosh()}sin(){return this._convertToNumber().sin()}sinh(){return this._convertToNumber().sinh()}asin(){return this._convertToNumber().asin()}asinh(){return this._convertToNumber().asinh()}tan(){return this._convertToNumber().tan()}tanh(){return this._convertToNumber().tanh()}atan(){return this._convertToNumber().atan()}atan2(e){return this._convertToNumber().atan2(e)}atanh(){return this._convertToNumber().atanh()}log(){return this._convertToNumber().log()}log10(){return this._convertToNumber().log10()}exp(){return this._convertToNumber().exp()}abs(){return this._convertToNumber().abs()}round(e){return this._convertToNumber().round(e)}floor(e){return this._convertToNumber().floor(e)}ceil(e){return this._convertToNumber().ceil(e)}convertToNumberObjectValue(){return wr(this.getValue())}convertToBooleanObjectValue(){return this}};A(Yt,"_instanceTrue"),A(Yt,"_instanceFalse");let I=Yt;class y extends Nt{constructor(e){super(e);A(this,"_value",0);this._value=Number(e)}static create(e,t=""){const r=new y(e);return t&&r.setPattern(t),r}getValue(){return this._value}setValue(e){this._value=e}isNumber(){return!0}getNegative(){return y.create(0).minus(this)}getReciprocal(){return y.create(1).divided(this)}plus(e){if(e.isArray())return e.plus(this);let t=e;e.isNumber()||(t=e.convertToNumberObjectValue());let r=this.plusBy(t.getValue());if(r.isError())return r;const n=Qr(this.getPattern(),t.getPattern(),Z.PLUS);return r=y.create(Number(r.getValue()),n),r}equalZero(){return this._value===0}minus(e){if(e.isArray()){const s=e.getNegative();return s.isError()?s:s.plus(this)}let t=e;e.isNumber()||(t=e.convertToNumberObjectValue());let r=this.minusBy(t.getValue());if(r.isError())return r;const n=Qr(this.getPattern(),t.getPattern(),Z.MINUS);return r=y.create(Number(r.getValue()),n),r}multiply(e){if(e.isArray())return e.multiply(this);let t=e;e.isNumber()||(t=e.convertToNumberObjectValue());let r=this.multiplyBy(t.getValue());if(r.isError())return r;const n=Qr(this.getPattern(),t.getPattern(),Z.MULTIPLY);return r=y.create(Number(r.getValue()),n),r}divided(e){if(e.isArray()){const s=e.getReciprocal();return s.isError()?s:s.multiply(this)}let t=e;e.isNumber()||(t=e.convertToNumberObjectValue());let r=this.dividedBy(t.getValue());if(r.isError())return r;const n=Qr(this.getPattern(),t.getPattern(),Z.DIVIDED);return r=y.create(Number(r.getValue()),n),r}mod(e){if(e.isArray())return e.modInverse(this);const t=this.getValue(),r=e.getValue();if(e.isNull())return g.create(h.DIV_BY_ZERO);if(typeof r=="string")return g.create(h.VALUE);if(typeof r=="number"){if(r===0)return g.create(h.DIV_BY_ZERO);if(!Number.isFinite(t)||!Number.isFinite(r)||Math.abs(r)*11259e8<=Math.abs(t))return g.create(h.NUM);const n=li(t,r);return Number.isFinite(n)?y.create(n):g.create(h.NUM)}if(typeof r=="boolean"){const n=r?1:0;return n===0?g.create(h.DIV_BY_ZERO):y.create(li(t,n))}return this}concatenateFront(e){return e.isArray()?e.concatenateBack(this):T.create(this.concatenate(e.getValue(),st.FRONT))}concatenateBack(e){return e.isArray()?e.concatenateFront(this):T.create(this.concatenate(e.getValue(),st.BACK))}isDateFormat(){const e=this.getPattern();return M.numfmt.isDateFormat(e)}compare(e,t){if(e.isArray())return e.compare(this,ia(t));let r=!1;return e.isDateFormat()&&this.isDateFormat()&&(r=!0),this.compareBy(e.getValue(),t,r)}plusBy(e){if(typeof e=="string"&&e.trim()==="")return g.create(h.VALUE);const t=+this.getValue(),r=+e;if(Number.isNaN(t)||Number.isNaN(r))return g.create(h.VALUE);if(!Number.isFinite(t)||!Number.isFinite(r))return g.create(h.NUM);const n=xf(t,r);return Number.isFinite(n)?y.create(n):g.create(h.NUM)}minusBy(e){if(typeof e=="string"&&e.trim()==="")return g.create(h.VALUE);const t=+this.getValue(),r=+e;if(Number.isNaN(t)||Number.isNaN(r))return g.create(h.VALUE);if(!Number.isFinite(t)||!Number.isFinite(r))return g.create(h.NUM);const n=jf(t,r);return Number.isFinite(n)?y.create(n):g.create(h.NUM)}multiplyBy(e){if(typeof e=="string"&&e.trim()==="")return g.create(h.VALUE);const t=+this.getValue(),r=+e;if(Number.isNaN(t)||Number.isNaN(r))return g.create(h.VALUE);if(!Number.isFinite(t)||!Number.isFinite(r))return g.create(h.NUM);const n=Er(t,r);return Number.isFinite(n)?y.create(n):g.create(h.NUM)}dividedBy(e){if(typeof e=="string"&&e.trim()==="")return g.create(h.VALUE);const t=+this.getValue(),r=+e;if(Number.isNaN(t)||Number.isNaN(r))return g.create(h.VALUE);if(!Number.isFinite(t)||!Number.isFinite(r))return g.create(h.NUM);if(r===0)return g.create(h.DIV_BY_ZERO);const n=Uf(t,r);return Number.isFinite(n)?y.create(n):g.create(h.NUM)}compareBy(e,t,r=!1){const n=this.getValue();let s=!1,a=n,u=e;return r&&(a=Math.round(n*1e8)/1e8,u=Math.round(e*1e8)/1e8),typeof u=="string"?s=this._compareString(t):typeof u=="number"?s=this._compareNumber(a,u,t):typeof u=="boolean"&&(s=this._compareBoolean(t)),I.create(s)}_compareString(e){switch(e){case Y.EQUALS:case Y.GREATER_THAN:case Y.GREATER_THAN_OR_EQUAL:return!1;case Y.LESS_THAN:case Y.LESS_THAN_OR_EQUAL:case Y.NOT_EQUAL:return!0}}_compareNumber(e,t,r){return!Number.isFinite(e)||!Number.isFinite(t)?this._compareInfinity(e,t,r):this._compareFiniteNumber(e,t,r)}_compareFiniteNumber(e,t,r){switch(r){case Y.EQUALS:return fi(e,t);case Y.GREATER_THAN:return If(e,t);case Y.GREATER_THAN_OR_EQUAL:return Ff(e,t);case Y.LESS_THAN:return Bf(e,t);case Y.LESS_THAN_OR_EQUAL:return kf(e,t);case Y.NOT_EQUAL:return!fi(e,t)}}_compareBoolean(e){switch(e){case Y.EQUALS:case Y.GREATER_THAN:case Y.GREATER_THAN_OR_EQUAL:return!1;case Y.LESS_THAN:case Y.LESS_THAN_OR_EQUAL:case Y.NOT_EQUAL:return!0}}pow(e){if(e.isArray())return e.powInverse(this);if(this.isError())return this;const t=this.getValue();let r=e;if(e.isString()&&(r=e.convertToNumberObjectValue()),r.isError())return r;const n=+r.getValue();if(Number.isNaN(n))return g.create(h.VALUE);if(!Number.isFinite(t)||!Number.isFinite(n))return g.create(h.NUM);if(t===0)return n<0?g.create(h.DIV_BY_ZERO):n===0?g.create(h.NUM):y.create(0);const s=Tf(t,n);return Number.isFinite(s)?y.create(s):g.create(h.NUM)}sqrt(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=vf(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}cbrt(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.cbrt(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}cos(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.cos(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}cosh(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.cosh(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}acos(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.acos(e);return Number.isNaN(t)?g.create(h.NUM):y.create(t)}acosh(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.acosh(e);return Number.isNaN(t)?g.create(h.NUM):y.create(t)}sin(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.sin(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}sinh(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.sinh(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}asin(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.asin(e);return Number.isNaN(t)?g.create(h.NUM):y.create(t)}asinh(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.asinh(e);return Number.isNaN(t)?g.create(h.NUM):y.create(t)}tan(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.tan(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}tanh(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.tanh(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}atan(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.atan(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}atan2(e){if(e.isArray())return e.atan2Inverse(this);const t=this.getValue(),r=e.getValue();if(typeof r=="string")return g.create(h.VALUE);if(typeof r=="number"){if(!Number.isFinite(t)||!Number.isFinite(r))return g.create(h.NUM);if(t===0&&r===0)return g.create(h.DIV_BY_ZERO);const n=Math.atan2(t,r);return Number.isFinite(n)?y.create(n):g.create(h.NUM)}return typeof r=="boolean"?y.create(Math.atan2(t,r?1:0)):this}atanh(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.atanh(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}log(){const e=this.getValue();if(typeof e=="number"&&e<=0||!Number.isFinite(e))return g.create(h.NUM);const t=Math.log(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}log10(){const e=this.getValue();if(typeof e=="number"&&e<=0||!Number.isFinite(e))return g.create(h.NUM);const t=Math.log10(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}exp(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.exp(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}abs(){const e=this.getValue();if(!Number.isFinite(e))return g.create(h.NUM);const t=Math.abs(e);return Number.isFinite(t)?y.create(t):g.create(h.NUM)}round(e){if(e.isArray())return e.roundInverse(this);const t=this.getValue(),r=e.getValue();if(typeof r=="string")return g.create(h.VALUE);if(typeof r=="number"){if(!Number.isFinite(t)||!Number.isFinite(r))return g.create(h.NUM);const n=t<0?-Pt(Math.abs(t),r):Pt(t,r);return Number.isFinite(n)?y.create(n):g.create(h.NUM)}return typeof r=="boolean"?y.create(Pt(t,r?1:0)):this}floor(e){if(e.isArray())return e.floorInverse(this);const t=this.getValue(),r=e.getValue();if(typeof r=="string")return g.create(h.VALUE);if(typeof r=="number"){if(!Number.isFinite(t)||!Number.isFinite(r))return g.create(h.NUM);const n=t<0?-We(Math.abs(t),r):We(t,r);return Number.isFinite(n)?y.create(n):g.create(h.NUM)}return typeof r=="boolean"?y.create(We(t,r?1:0)):this}ceil(e){if(e.isArray())return e.ceilInverse(this);const t=this.getValue(),r=e.getValue();if(typeof r=="string")return g.create(h.VALUE);if(typeof r=="number"){if(!Number.isFinite(t)||!Number.isFinite(r))return g.create(h.NUM);const n=t<0?-ke(Math.abs(t),r):ke(t,r);return Number.isFinite(n)?y.create(n):g.create(h.NUM)}return typeof r=="boolean"?y.create(ke(t,r?1:0)):this}convertToNumberObjectValue(){return this}convertToBooleanObjectValue(){return Zn(!0)}_compareInfinity(e,t,r){let n=!1;switch(r){case Y.EQUALS:n=e===t;break;case Y.GREATER_THAN:n=e>t;break;case Y.GREATER_THAN_OR_EQUAL:n=e>=t;break;case Y.LESS_THAN:n=e<t;break;case Y.LESS_THAN_OR_EQUAL:n=e<=t;break;case Y.NOT_EQUAL:n=e!==t;break}return n}}const Hf=1e5,Fs=new yt(Hf);class T extends Nt{constructor(e){super(e);A(this,"_value");A(this,"_isHyperlink",!1);A(this,"_hyperlinkUrl","");A(this,"_isImage",!1);A(this,"_imageInfo");this._value=e}static create(e,t){var s;const r=Fs.get(e);if(r&&t&&this.checkCacheByOptions(r,t))return r;const n=new T(e);return t!=null&&t.isHyperlink&&(n._isHyperlink=t.isHyperlink,n._hyperlinkUrl=(s=t.hyperlinkUrl)!=null?s:""),t!=null&&t.isImage&&(n._isImage=t.isImage,n._imageInfo=t.imageInfo),Fs.set(e,n),n}static checkCacheByOptions(e,t){return!(e.isHyperlink()!==t.isHyperlink||e.getHyperlinkUrl()!==t.hyperlinkUrl||e.isImage()!==t.isImage||!M.Tools.diffValue(e.getImageInfo(),t.imageInfo))}getValue(){return this._value}isString(){return!0}isHyperlink(){return this._isHyperlink}getHyperlinkUrl(){return this._hyperlinkUrl}isImage(){return this._isImage}getImageInfo(){return this._imageInfo}concatenateFront(e){return e.isArray()?e.concatenateBack(this):T.create(this.concatenate(e.getValue(),st.FRONT))}concatenateBack(e){return e.isArray()?e.concatenateFront(this):T.create(this.concatenate(e.getValue(),st.BACK))}plus(e){return this.convertToNumberObjectValue().plus(e)}minus(e){return this.convertToNumberObjectValue().minus(e)}multiply(e){return this.convertToNumberObjectValue().multiply(e)}divided(e){return this.convertToNumberObjectValue().divided(e)}compare(e,t,r){return e.isArray()?e.compare(this,ia(t),r):this.compareBy(e.getValue(),t,r)}compareBy(e,t,r=!1){let n=this.getValue(),s=!1;if(typeof e=="string"){let a=e;if(r||(n=n.toLocaleLowerCase(),a=a.toLocaleLowerCase()),oo(a))return this._checkWildcard(a,t);s=this._compareString(n,a,t)}else typeof e=="number"?s=this._compareNumber(t):typeof e=="boolean"&&(s=this._compareBoolean(t));return I.create(s)}_compareString(e,t,r){switch(r){case Y.EQUALS:return e===t;case Y.GREATER_THAN:return e>t;case Y.GREATER_THAN_OR_EQUAL:return e>=t;case Y.LESS_THAN:return e<t;case Y.LESS_THAN_OR_EQUAL:return e<=t;case Y.NOT_EQUAL:return e!==t}}_compareNumber(e){switch(e){case Y.NOT_EQUAL:case Y.GREATER_THAN:case Y.GREATER_THAN_OR_EQUAL:return!0;case Y.EQUALS:case Y.LESS_THAN:case Y.LESS_THAN_OR_EQUAL:return!1}}_compareBoolean(e){switch(e){case Y.EQUALS:case Y.GREATER_THAN:case Y.GREATER_THAN_OR_EQUAL:return!1;case Y.LESS_THAN:case Y.LESS_THAN_OR_EQUAL:case Y.NOT_EQUAL:return!0}}convertToNumberObjectValue(){const e=this.getValue(),t=M.getNumfmtParseValueFilter(e);return t&&t.z?wr(t.v,t.z):wr(e)}convertToBooleanObjectValue(){return I.create(!0)}_checkWildcard(e,t){const r=this.getValue().toLocaleLowerCase(),n=Ol(r,e,t);return I.create(n)}}function Zn(i){if(typeof i=="boolean")return I.create(i);let o=!1;if(typeof i=="string"){const e=i.toLocaleUpperCase();e===xt.TRUE?o=!0:e===xt.FALSE&&(o=!1)}else i===1?o=!0:o=!1;return I.create(o)}function Gf(i){let o=i.toString();return o.charAt(0)==='"'&&o.charAt(o.length-1)==='"'&&(o=o.slice(1,-1),o=o.replace(/""/g,'"')),T.create(o)}function wr(i,o=""){if(typeof i=="boolean"){let e=0;return i&&(e=1),y.create(e,o)}else{if(typeof i=="number")return Number.isFinite(i)?y.create(i,o):g.create(h.NUM);if(M.isRealNum(i))return y.create(Number(i),o)}return g.create(h.VALUE)}function Wf(i){return""}function Ro(i=[],o=!1){const e=[];for(let t=0;t<i.length;t++){const r=i[t];e[t]==null&&(e[t]=[]);for(let n=0;n<r.length;n++){const s=r[n];e[t][n]=dt.create(s,o)}}return e}function Qf(i=[]){const o=[];for(let e=0;e<i.length;e++){const t=i[e];o[e]==null&&(o[e]=[]);for(let r=0;r<t.length;r++){const n=t[r];n==null?o[e][r]=null:n.isError()?o[e][r]=n.getErrorType():o[e][r]=n.getValue()}}return o}class K extends Nt{constructor(e){super(typeof e=="string"?e:Wf());A(this,"_values",[]);A(this,"_rowCount",-1);A(this,"_columnCount",-1);A(this,"_unitId","");A(this,"_sheetId","");A(this,"_currentRow",-1);A(this,"_currentColumn",-1);A(this,"_sliceCache",new Map);A(this,"_flattenCache");A(this,"_defaultValue",null);A(this,"_flattenPosition");this._values=this._formatValue(e)}static create(e){return new K(e)}static createByArray(e){const r={calculateValueList:Ro(e),rowCount:e.length,columnCount:e[0].length||0,unitId:"",sheetId:"",row:-1,column:-1};return new K(r)}dispose(){this._values=[],this._defaultValue=null,this._flattenPosition=null,this._clearCache()}clone(){return this.map(e=>e)}getRowCount(){return this._rowCount}setRowCount(e){this._rowCount=e}getColumnCount(){return this._columnCount}setColumnCount(e){this._columnCount=e}setCurrent(e,t){this._currentRow=e,this._currentColumn=t}setUnitId(e){this._unitId=e}getUnitId(){return this._unitId}setSheetId(e){this._sheetId=e}getSheetId(){return this._sheetId}getCurrentRow(){return this._currentRow}getCurrentColumn(){return this._currentColumn}getArrayValue(){return this._values}setArrayValue(e){this._clearCache(),this._values=e}isArray(){return!0}setDefaultValue(e){this._defaultValue=e}get(e,t){var r;return((r=this._values[e])==null?void 0:r[t])||this._defaultValue}getRealValue(e,t){const r=this._values[e];if(r==null)return null;const n=r[t];return n==null?null:n}getValueOrDefault(e,t){return this.get(e,t)||this._defaultValue}set(e,t,r){if(e>=this._rowCount||t>=this._columnCount)throw new Error("Exceeding array bounds.");this._clearCache(),this._values[e][t]=r}getRangePosition(){const t=this.getRowCount(),r=0,n=this.getColumnCount();return{startRow:0,endRow:t-1,startColumn:r,endColumn:n-1}}iterator(e){var u;const{startRow:t,endRow:r,startColumn:n,endColumn:s}=this.getRangePosition(),a=this.getArrayValue();for(let c=t;c<=r;c++)for(let l=n;l<=s;l++)if(e(((u=a[c])==null?void 0:u[l])||this._defaultValue,c,l)===!1)return}iteratorReverse(e){var u;const{startRow:t,endRow:r,startColumn:n,endColumn:s}=this.getRangePosition(),a=this.getArrayValue();for(let c=r;c>=t;c--)for(let l=s;l>=n;l--)if(e(((u=a[c])==null?void 0:u[l])||this._defaultValue,c,l)===!1)return}getLastTruePosition(){let e;return this.iteratorReverse((t,r,n)=>{if(t!=null&&t.isBoolean()&&t.getValue()===!0)return e={row:r,column:n},!1}),e}getFirstTruePosition(){let e;return this.iterator((t,r,n)=>{if(t!=null&&t.isBoolean()&&t.getValue()===!0)return e={row:r,column:n},!1}),e}getFirstCell(){const{startRow:e,startColumn:t}=this.getRangePosition();return this.get(e,t)||this._defaultValue||ce.create()}getLastCell(){const{endRow:e,endColumn:t}=this.getRangePosition();return this.get(e,t)||this._defaultValue||ce.create()}pick(e){const t=this.pickRaw(e);return this._createNewArray(t,1,t[0].length)}pickRaw(e){const t=e.getRowCount(),r=e.getColumnCount();if(t!==this._rowCount||r!==this._columnCount)return[[ce.create()]];const n=[];n[0]=[];for(let s=0;s<t;s++)for(let a=0;a<r;a++){const u=e.get(s,a);if(!(u==null||u.isError())&&u.getValue()===!0){const c=this.get(s,a);n[0].push(c)}}return n}flatten(){if(this._flattenCache!=null)return this._flattenCache;const e=[];e[0]=[];for(let r=0;r<this._rowCount;r++)for(let n=0;n<this._columnCount;n++){const s=this.get(r,n);e[0].push(s)}const t=this._createNewArray(e,1,e[0].length);return t.setDefaultValue(this._defaultValue),this._flattenCache=t,t}flattenPosition(){if(this._flattenPosition!=null)return this._flattenPosition;const e=[],t=[],r=[],n=[];let s=0;for(let u=0;u<this._rowCount;u++)for(let c=0;c<this._columnCount;c++){const l=this.get(u,c);if(l==null||l.isError()||l.isNull()){s++;continue}l.isString()?(e.push(l),r.push(s++)):(t.push(l),n.push(s++))}const a={stringArray:e,numberArray:t,stringPosition:r,numberPosition:n};return this._flattenPosition=a,a}slice(e,t){let r=0,n=this._rowCount,s=1,a=0,u=this._columnCount,c=1;if(e!=null&&(r=e[0]||0,n=e[1]||this._rowCount,s=e[2]||1),t!=null&&(a=t[0]||0,u=t[1]||this._columnCount,c=t[2]||1),r>=this._rowCount||a>=this._columnCount)return;const l=`${r}_${n}_${s}_${a}_${u}_${c}`,f=this._sliceCache.get(l);if(f!=null)return f;const m=[],d=this._values;let C=0,_=0;for(let p=r;p<n;p+=s){_=0,m[C]==null&&(m[C]=[]);for(let V=a;V<u;V+=c){if(!d[p])return;let S=d[p][V]||this._defaultValue;S==null&&(S=ce.create()),m[C][_]=S,_++}C++}if(m.length===0||m[0].length===0)return;const E=s>1?-1:r+this._currentRow,R=c>1?-1:a+this._currentColumn,b=this._createNewArray(m,m.length,m[0].length,E,R);return b.setDefaultValue(this._defaultValue),this._sliceCache.set(l,b),b}sortByRow(e){const t=this._transposeArray(this._values);t.sort(this._sort(e)),this._clearCache(),this._values=this._transposeArray(t)}sortByColumn(e){this._clearCache(),this._values.sort(this._sort(e))}transpose(){const e=this._transposeArray(this._values),t=this._rowCount,r=this._columnCount,n=this._createNewArray(e,r,t);return n.setDefaultValue(this._defaultValue),n}orderSearch(e,t=De.MIN,r=!1,n=!1){let s,a,u,c;const l=(f,m,d)=>{if(f==null||f.isNull())return!0;let C;if(n===!0?C=f.compare(e,Y.EQUALS):C=f.isEqual(e),(C==null?void 0:C.getValue())===!0)return s=f,u={row:m,column:d},!1;t===De.MAX?f.isGreaterThan(e).getValue()===!0&&(a==null||f.minus(e).abs().isLessThanOrEqual(a.minus(e).abs()).getValue()===!0)&&(a=f,c={row:m,column:d}):t===De.MIN&&f.isLessThan(e).getValue()===!0&&(a==null||f.minus(e).abs().isLessThanOrEqual(a.minus(e).abs()).getValue()===!0)&&(a=f,c={row:m,column:d})};if(r?this.iteratorReverse((f,m,d)=>l(f,m,d)):this.iterator((f,m,d)=>l(f,m,d)),s!=null)return u;if(a!=null)return c}binarySearch(e,t=kt.MIN,r=De.MIN){if(e.isError())return;const{stringArray:n,stringPosition:s,numberArray:a,numberPosition:u}=this.flattenPosition();return e.isString()?this._binarySearch(e,n,s,t,r):this._binarySearch(e,a,u,t,r)}_binarySearch(e,t,r,n=kt.MIN,s=De.MIN){const a=An(),u=Number(e.getValue()),c=!Number.isNaN(u);let l=0,f=t.length-1,m=-1,d=-1,C=-1;for(;l<=f;){const _=Math.floor((l+f)/2),E=t[_];let R;if(E.isNull())R=n===kt.MIN?1:-1;else{const b=E.getValue();if(c){const p=Number(b);R=Number.isNaN(p)?1:Math.sign(p-u)}else R=a(b.toString().toLocaleLowerCase(),e.getValue().toString().toLocaleLowerCase())}if(n===kt.MAX&&(R=-R),R===0){m=_;break}R<0?(d=_,l=_+1):(C=_,f=_-1)}if(s===De.NORMAL)return m!==-1?r[m]:void 0;if(s===De.MIN)return m!==-1?r[m]:n===kt.MIN?r[d]:r[C];if(s===De.MAX)return m!==-1?r[m]:n===kt.MIN?r[C]:r[d]}sum(){let e=y.create(0);return this.iterator(t=>{if(t==null||t.isString()||t.isBoolean()||t.isNull())return!0;if(t.isError())return e=t,!1;e=e.plus(t)}),e}max(){let e=y.create(Number.NEGATIVE_INFINITY);return this.iterator(t=>{if(t==null)return!0;if(t.isError())return e=t,!1;if(t.isString()||t.isNull()||t.isBoolean())return!0;e.isLessThan(t).getValue()&&(e=t)}),e}min(){let e=y.create(Number.POSITIVE_INFINITY);return this.iterator(t=>{if(t==null)return!0;if(t.isError())return e=t,!1;if(t.isString()||t.isNull()||t.isBoolean())return!0;e.isGreaterThan(t).getValue()&&(e=t)}),e}count(){let e=y.create(0);return this.iterator(t=>{if(t==null||t.isError()||t.isString()||t.isNull()||t.isBoolean())return!0;e=e.plusBy(1)}),e}countA(){let e=y.create(0);return this.iterator(t=>{if(t==null||t.isNull())return!0;e=e.plusBy(1)}),e}countBlank(){let e=y.create(0);return this.iterator(t=>{(t==null||t.isNull()||t.getValue()==="")&&(e=e.plusBy(1))}),e}getNegative(){return K.create("{0}").minus(this)}getReciprocal(){return K.create("{1}").divided(this)}plus(e){return this._batchOperator(e,1)}minus(e){return this._batchOperator(e,0)}multiply(e){return this._batchOperator(e,2)}divided(e){return this._batchOperator(e,3)}mod(e){return this._batchOperator(e,4)}modInverse(e){return this.map(t=>t.isError()?t:e.mod(t))}compare(e,t,r){return this._batchOperator(e,5,t,r)}concatenateFront(e){return this._batchOperator(e,6)}concatenateBack(e){return this._batchOperator(e,7)}map(e){const t=(r,n,s)=>r==null?ce.create():r.isError()?r:e(r,n,s);return this.mapValue(t)}mapValue(e){var s;const t=this._rowCount,r=this._columnCount,n=[];for(let a=0;a<t;a++){const u=[];for(let c=0;c<r;c++){const l=(s=this._values)==null?void 0:s[a];if(l==null)u[c]=g.create(h.VALUE);else{const f=l[c]||this._defaultValue;f?u[c]=e(f,a,c):u[c]=ce.create()}}n.push(u)}return this._createNewArray(n,t,r)}pow(e){return this._batchOperator(e,8)}powInverse(e){return this.map(t=>t.isError()?t:e.pow(t))}sqrt(){return this.map(e=>e.isError()?e:e.sqrt())}cbrt(){return this.map(e=>e.isError()?e:e.cbrt())}cos(){return this.map(e=>e.isError()?e:e.cos())}cosh(){return this.map(e=>e.isError()?e:e.cosh())}acos(){return this.map(e=>e.isError()?e:e.acos())}acosh(){return this.map(e=>e.isError()?e:e.acosh())}sin(){return this.map(e=>e.isError()?e:e.sin())}sinh(){return this.map(e=>e.isError()?e:e.sinh())}asin(){return this.map(e=>e.isError()?e:e.asin())}asinh(){return this.map(e=>e.isError()?e:e.asinh())}tan(){return this.map(e=>e.isError()?e:e.tan())}tanh(){return this.map(e=>e.isError()?e:e.tanh())}atan(){return this.map(e=>e.isError()?e:e.atan())}atanh(){return this.map(e=>e.isError()?e:e.atanh())}atan2(e){return this._batchOperator(e,12)}atan2Inverse(e){return this.map(t=>t.isError()?t:e.atan2(t))}mean(e=0){const t=this.sum(),r=this.count();return t.divided(e===0?r:r.minusBy(1))}median(){const e=this.flattenPosition().numberArray,t=this._createNewArray([e],1,e.length),r=t.getColumnCount();if(r<=1)return t.get(0,0)||ce.create();if(t.sortByRow(0),r%2===0){const n=t.get(0,r/2)||ce.create(),s=t.get(0,r/2-1)||ce.create();return n.plus(s).divided(y.create(2))}return t.get(0,(r-1)/2)||ce.create()}var(e=0){const t=this.mean(),r=[[]];this.iterator(l=>{if(l==null||l.isError()||l.isString()||l.isBoolean()||l.isNull())return;const f=l.minus(t).pow(y.create(2));f.isError()||r[0].push(f)});const{_unitId:n,_sheetId:s,_currentRow:a,_currentColumn:u}=this;return K.create({calculateValueList:r,rowCount:1,columnCount:r[0].length,unitId:n,sheetId:s,row:a,column:u}).mean(e)}std(e=0){const t=this.var(e);return t.isError()?t:t.sqrt()}log(){return this.map(e=>e.isError()?e:e.log())}log10(){return this.map(e=>e.isError()?e:e.log10())}exp(){return this.map(e=>e.isError()?e:e.exp())}abs(){return this.map(e=>e.isError()?e:e.abs())}round(e){return this._batchOperator(e,9)}roundInverse(e){return this.map(t=>t.isError()?t:e.round(t))}floor(e){return this._batchOperator(e,10)}floorInverse(e){return this.map(t=>t.isError()?t:e.floor(t))}ceil(e){return this._batchOperator(e,11)}ceilInverse(e){return this.map(t=>t.isError()?t:e.ceil(t))}toValue(){return Qf(this._values)}_clearCache(){this._flattenCache=null,this._sliceCache.clear()}_sort(e){const t=An();return(r,n)=>{const s=r[e],a=n[e];return s==null?1:a==null?-1:s.isError()&&s.isError()?0:s.isError()?1:a.isError()?-1:t(s.getValue(),a.getValue())}}_transposeArray(e){const t=e.length,r=e[0].length,n=[];for(let s=0;s<r;s++){n[s]=[];for(let a=0;a<t;a++)n[s][a]=e[a][s]}return n}_batchOperator(e,t,r,n){const s=[];let a=this._rowCount,u=this._columnCount;if(e.isArray()){const f=e.getRowCount(),m=e.getColumnCount();if(a=Math.max(f,a),u=Math.max(m,u),f===1&&m===1){const d=e.getFirstCell();for(let C=0;C<u;C++)s.push(d)}else if(f===1&&this._columnCount>1){const d=e.getArrayValue();for(let C=0;C<u;C++)d[0]&&d[0][C]?s.push(d[0][C]):s.push(ce.create())}else return this._batchOperatorArray(e,t,r,n)}else for(let f=0;f<u;f++)s.push(e);const c=[];for(let f=0;f<u;f++){const m=s[f];this._batchOperatorValue(m,f,c,t,r,n)}const l=this._createNewArray(c,a,u);return l.setDefaultValue(I.create(!1)),l}_batchOperatorValue(e,t,r,n,s,a){const u=this._rowCount,c=this.getUnitId(),l=this.getSheetId(),f=this.getCurrentRow(),m=this.getCurrentColumn();if(n===5){const{rowsInCache:d,rowsNotInCache:C}=Ge.canUseCache(c,l,t+m,f,f+u-1);if(d.length>0){if(s===Y.EQUALS&&!(e.isString()&&oo(e.getValue()))){const _=Ge.getCellPositions(c,l,t+m,e.isNull()?null:e.getValue(),d);_!=null&&_.forEach(E=>{if(E<f||E>f+u-1)return;const R=E-f;r[R]==null&&(r[R]=[]),r[R][t]=I.create(!0)})}else{const _=Ge.getCellValuePositions(c,l,t+m);_!=null&&_.forEach((E,R)=>{let b=ce.create();vt.has(R)?b=g.create(R):typeof R=="string"?b=T.create(R):typeof R=="number"?b=y.create(R):typeof R=="boolean"&&(b=I.create(R));let p;b.isError()?p=b:e.isError()?p=e:p=b.compare(e,s,a),E.forEach(V=>{V>=f&&V<=f+u-1&&(r[V-f]==null&&(r[V-f]=[]),r[V-f][t]=p)})})}if(C.length>0)for(const _ of C){const[E,R]=_;for(let b=E;b<=R;b++)this.__batchOperatorRowValue(e,t,r,n,b-f,c,l,f,m,s,a);Ge.setContinueBuildingCache(c,l,t+m,E,R)}return}}for(let d=0;d<u;d++)this.__batchOperatorRowValue(e,t,r,n,d,c,l,f,m,s,a);Ge.setContinueBuildingCache(c,l,t+m,f,f+u-1)}__batchOperatorRowValue(e,t,r,n,s,a,u,c,l,f,m){const d=this.getValueOrDefault(s,t);if(r[s]==null&&(r[s]=[]),d&&e)if(d.isError())r[s][t]=d;else if(e.isError())r[s][t]=e;else switch(n){case 1:r[s][t]=d.plus(e);break;case 0:r[s][t]=d.minus(e);break;case 2:r[s][t]=d.multiply(e);break;case 3:r[s][t]=d.divided(e);break;case 4:r[s][t]=d.mod(e);break;case 5:f?r[s][t]=d.compare(e,f,m):r[s][t]=g.create(h.VALUE);break;case 6:r[s][t]=d.concatenateFront(e);break;case 7:r[s][t]=d.concatenateBack(e);break;case 8:r[s][t]=d.pow(e);break;case 9:r[s][t]=d.round(e);break;case 10:r[s][t]=d.floor(e);break;case 12:r[s][t]=d.atan2(e);break;case 11:r[s][t]=d.ceil(e);break}else r[s][t]=g.create(h.NA);!d||d!=null&&d.isNull()?Ge.set(a,u,t+l,Ds,s+c):Ge.set(a,u,t+l,d.getValue(),s+c)}_batchOperatorArray(e,t,r,n){let s=e.getRowCount(),a=e.getColumnCount();s<this._rowCount&&(s=this._rowCount),a<this._columnCount&&(a=this._columnCount);const u=[],c=this._checkArrayCalculateType(this),l=this._checkArrayCalculateType(e);for(let f=0;f<s;f++){const m=[];for(let d=0;d<a;d++){let C;c===3?C=this.getValueOrDefault(0,0):c===1?C=this.getValueOrDefault(0,d):c===2?C=this.getValueOrDefault(f,0):C=this.getValueOrDefault(f,d);let _;if(l===3?_=e.getValueOrDefault(0,0):l===1?_=e.getValueOrDefault(0,d):l===2?_=e.getValueOrDefault(f,0):_=e.getValueOrDefault(f,d),C&&_)if(C.isError())m[d]=C;else if(_.isError())m[d]=_;else switch(t){case 1:m[d]=C.plus(_);break;case 0:m[d]=C.minus(_);break;case 2:m[d]=C.multiply(_);break;case 3:m[d]=C.divided(_);break;case 4:m[d]=C.mod(_);break;case 5:r?m[d]=C.compare(_,r,n):m[d]=g.create(h.VALUE);break;case 6:m[d]=C.concatenateFront(_);break;case 7:m[d]=C.concatenateBack(_);break;case 8:m[d]=C.pow(_);break;case 9:m[d]=C.round(_);break;case 12:m[d]=C.atan2(_);break;case 10:m[d]=C.floor(_);break;case 11:m[d]=C.ceil(_);break}else m[d]=g.create(h.NA)}u.push(m)}return this._createNewArray(u,s,a)}_checkArrayCalculateType(e){return e.getRowCount()===1&&e.getColumnCount()===1?3:e.getRowCount()===1?1:e.getColumnCount()===1?2:0}_formatValue(e){if(typeof e!="string")return e=e,this._rowCount=e.rowCount,this._columnCount=e.columnCount,this._unitId=e.unitId,this._sheetId=e.sheetId,this._currentRow=e.row,this._currentColumn=e.column,e.calculateValueList;e=e.slice(1,-1);const t=e.split(";"),r=t.length,n=[];let s=0;for(let a=0;a<r;a++){const c=t[a].split(","),l=c.length;s<l&&(s=l);const f=[];for(let m=0;m<l;m++){const d=c[m].trim();f.push(dt.create(d))}n.push(f)}return this._rowCount=r,this._columnCount=s,n}_createNewArray(e,t,r,n=-1,s=-1){(this._currentColumn===-1||this._currentRow===-1)&&(n=-1,s=-1);const a={calculateValueList:e,rowCount:t,columnCount:r,unitId:this.getUnitId(),sheetId:this.getSheetId(),row:n,column:s};return K.create(a)}}class dt{static create(o,e=!1){if(o==null)return ce.create();if(typeof o=="boolean")return I.create(o);if(typeof o=="string"){const t=o.toLocaleUpperCase().trim();if(vt.has(t))return g.create(t);if(t===xt.TRUE||t===xt.FALSE)return Zn(o);if(M.isRealNum(o))return y.create(Number(o));if(!e){const{isNumberPattern:n,value:s,pattern:a}=Tl(o);if(n)return y.create(s,a)}const r=o.replace(/\n/g,"").replace(/\r/g,"");return!qf(r)&&Kc(r)?K.create(r):Gf(o)}return typeof o=="number"?wr(o):g.create(h.VALUE)}}function qf(i){const o=i.trim();return o.startsWith('"')&&o.endsWith('"')}const Xf=1e4,or=new yt(Xf);class rr extends Gn{constructor(e){super();A(this,"_forcedSheetId","");A(this,"_forcedSheetName","");A(this,"_defaultSheetId","");A(this,"_rangeData",{startColumn:-1,startRow:-1,endRow:-1,endColumn:-1});A(this,"_unitData",{});A(this,"_unitStylesData",{});A(this,"_filteredOutRows",[]);A(this,"_defaultUnitId","");A(this,"_forcedUnitId","");A(this,"_runtimeData",{});A(this,"_arrayFormulaCellData",{});A(this,"_runtimeArrayFormulaCellData",{});A(this,"_runtimeFeatureCellData",{});A(this,"_refOffsetX",0);A(this,"_refOffsetY",0);A(this,"_currentRow");A(this,"_currentColumn");this._token=e}dispose(){this._unitData={},this._unitStylesData={},this._runtimeData={}}getToken(){return this._token}setToken(e){this._token=e}isExceedRange(){const{startRow:e,endRow:t,startColumn:r,endColumn:n}=this.getRangePosition();return e<0||r<0||t>=this.getActiveSheetRowCount()||n>=this.getActiveSheetColumnCount()}setRefOffset(e=0,t=0){this._refOffsetX=e,this._refOffsetY=t}getRefOffset(){return{x:this._refOffsetX,y:this._refOffsetY}}getRangePosition(){const{x:e,y:t}=this.getRefOffset(),r=this.getRangeData();let{startRow:n,startColumn:s,endRow:a,endColumn:u}=M.moveRangeByOffset(r,e,t);return Number.isNaN(n)&&(n=0),Number.isNaN(s)&&(s=0),Number.isNaN(a)&&(a=this.getActiveSheetRowCount()-1),Number.isNaN(u)&&(u=this.getActiveSheetColumnCount()-1),{startRow:n,endRow:a,startColumn:s,endColumn:u}}isReferenceObject(){return!0}iterator(e){const{startRow:t,endRow:r,startColumn:n,endColumn:s}=this.getRangePosition();if(this._checkIfWorksheetMiss())return e(g.create(h.VALUE),t,n);const a=this._forcedUnitId||this._defaultUnitId,u=this._forcedSheetId||this._defaultSheetId;for(let c=t;c<=r;c++)for(let l=n;l<=s;l++){if(c<0||l<0)return e(g.create(h.REF),c,l);const f=this.getCellData(c,l);let m=!1;if(sn(f)){m=e(null,c,l);continue}let d=this.getCellValueObject(f);if(c===t&&l===n){const C=this.getCellPattern(a,u,c,l);if(C&&d.isNumber()){const _=Number(d.getValue());d=y.create(_,C)}}if(m=e(d,c,l),m===!1)return}}getFirstCell(){if(this._checkIfWorksheetMiss())return g.create(h.VALUE);const{startRow:e,startColumn:t}=this.getRangePosition(),r=this.getCellData(e,t);if(!r)return y.create(0);let n=this.getCellValueObject(r);const s=this._forcedUnitId||this._defaultUnitId,a=this._forcedSheetId||this._defaultSheetId,u=this.getCellPattern(s,a,e,t);if(u&&n.isNumber()){const c=Number(n.getValue());n=y.create(c,u)}return n}getRangeData(){return this._rangeData}setRangeData(e){this._rangeData=e}getUnitId(){return this._forcedUnitId&&this._forcedUnitId.length>0?this._forcedUnitId:this._defaultUnitId}getSheetId(){return this._forcedSheetId&&this._forcedSheetId.length>0?this._forcedSheetId:this._defaultSheetId}setForcedUnitIdDirect(e){e.length>0&&(this._forcedUnitId=e)}getForcedUnitId(){return this._forcedUnitId}setForcedSheetId(e){var t;this._forcedSheetId=(t=e[this.getUnitId()])==null?void 0:t[this._forcedSheetName]}setForcedSheetIdDirect(e){this._forcedSheetId=e}getForcedSheetId(){return this._forcedSheetId}setForcedSheetName(e){e.length>0&&(this._forcedSheetName=e)}getForcedSheetName(){return this._forcedSheetName}setDefaultSheetId(e){this._defaultSheetId=e}getDefaultSheetId(){return this._defaultSheetId}setDefaultUnitId(e){this._defaultUnitId=e}getDefaultUnitId(){return this._defaultUnitId}getUnitData(){return this._unitData}setUnitData(e){this._unitData=e}getUnitStylesData(){return this._unitStylesData}setUnitStylesData(e){this._unitStylesData=e}getFilteredOutRows(){return this._filteredOutRows}setFilteredOutRows(e){this._filteredOutRows=e}getRuntimeData(){return this._runtimeData}setRuntimeData(e){this._runtimeData=e}getArrayFormulaCellData(){return this._arrayFormulaCellData}setArrayFormulaCellData(e){this._arrayFormulaCellData=e}getRuntimeArrayFormulaCellData(){return this._runtimeArrayFormulaCellData}setRuntimeArrayFormulaCellData(e){this._runtimeArrayFormulaCellData=e}getRuntimeFeatureCellData(){return this._runtimeFeatureCellData}setRuntimeFeatureCellData(e){this._runtimeFeatureCellData=e}getActiveSheetRowCount(){var e;return((e=this.getCurrentActiveSheetData())==null?void 0:e.rowCount)||0}getActiveSheetColumnCount(){var e;return((e=this.getCurrentActiveSheetData())==null?void 0:e.columnCount)||0}getRowCount(){const e=this.getRangeData();return e.endRow-e.startRow+1}getColumnCount(){const e=this.getRangeData();return e.endColumn-e.startColumn+1}getRowData(){var e;return((e=this.getCurrentActiveSheetData())==null?void 0:e.rowData)||{}}getColumnData(){var e;return((e=this.getCurrentActiveSheetData())==null?void 0:e.columnData)||{}}isCell(){return!1}isColumn(){return!1}isRow(){return!1}isRange(){return!1}isTable(){return!1}isCurrentRowForRange(){return!1}isCurrentColumnForRange(){return!1}isMultiArea(){return!1}unionBy(e){return g.create(h.REF)}unionRange(e,t){return{startRow:-1,startColumn:-1,endRow:-1,endColumn:-1}}getCellValueObject(e){const t=Nl(e);if(vt.has(t))return g.create(t);if(e.t===M.CellValueType.NUMBER){const r=this._getPatternByCell(e);return M.isTextFormat(r)?T.create(t.toString()):wr(t,r)}return e.t===M.CellValueType.STRING||e.t===M.CellValueType.FORCE_STRING?T.create(t.toString()):e.t===M.CellValueType.BOOLEAN?Zn(t):dt.create(t)}_getPatternByCell(e){var n;const t=this._unitStylesData[this.getUnitId()];if(!t)return"";const r=t.getStyleByCell(e);return((n=r==null?void 0:r.n)==null?void 0:n.pattern)||""}getCellByRow(e){return this.getCellByPosition(e)}getCellByColumn(e){return this.getCellByPosition(void 0,e)}getCurrentActiveSheetData(){var e;return(e=this._unitData[this.getUnitId()])==null?void 0:e[this.getSheetId()]}getCurrentStylesData(){return this._unitStylesData[this.getUnitId()]}getCurrentRuntimeSheetData(){var e,t;return(t=(e=this._runtimeData)==null?void 0:e[this.getUnitId()])==null?void 0:t[this.getSheetId()]}getCurrentActiveArrayFormulaCellData(){var e,t;return(t=(e=this._arrayFormulaCellData)==null?void 0:e[this.getUnitId()])==null?void 0:t[this.getSheetId()]}getCurrentRuntimeActiveArrayFormulaCellData(){var e,t;return(t=(e=this._runtimeArrayFormulaCellData)==null?void 0:e[this.getUnitId()])==null?void 0:t[this.getSheetId()]}getCellData(e,t){const r=this.getCurrentActiveSheetData(),n=this.getCurrentRuntimeSheetData(),s=this.getCurrentActiveArrayFormulaCellData(),a=this.getCurrentRuntimeActiveArrayFormulaCellData();return(n==null?void 0:n.getValue(e,t))||(a==null?void 0:a.getValue(e,t))||this.getRuntimeFeatureCellValue(e,t)||(s==null?void 0:s.getValue(e,t))||(r==null?void 0:r.cellData.getValue(e,t))}getRuntimeFeatureCellValue(e,t){return io(e,t,this.getSheetId(),this.getUnitId(),this._runtimeFeatureCellData)}getCellByPosition(e,t){let r=e,n=t;const s=this.getRangeData();r||(r=s.startRow),n||(n=s.startColumn);const a=this.getCellData(r,n);return a?this.getCellValueObject(a):g.create(h.VALUE)}setCurrentRowAndColumn(e,t){this._currentRow=e,this._currentColumn=t}getCurrentRow(){return this._currentRow}getCurrentColumn(){return this._currentColumn}getCellPattern(e,t,r,n){var c,l,f,m;const s=this._unitStylesData[e];if(!s)return"";const a=(f=(l=(c=this._unitData[e])==null?void 0:c[t])==null?void 0:l.cellData)==null?void 0:f.getValue(r,n);if(!a)return"";const u=s.getStyleByCell(a);return((m=u==null?void 0:u.n)==null?void 0:m.pattern)||""}toArrayValueObject(e=!0){var C;const{startRow:t,endRow:r,startColumn:n,endColumn:s}=this.getRangePosition(),a=`${this.getUnitId()}_${this.getSheetId()}_${t}_${r}_${n}_${s}`,u=or.get(a);if(u&&e)return u;const c=r-t+1,l=s-n+1;if(c<0||l<0)return this._getBlankArrayValueObject();const f=new Array(c);this.iterator((_,E,R)=>{const b=E-t,p=R-n;f[b]||(f[b]=new Array(l)),_==null&&(_=ce.create()),f[b][p]=_});const m={calculateValueList:f,rowCount:f.length,columnCount:((C=f[0])==null?void 0:C.length)||0,unitId:this.getUnitId(),sheetId:this.getSheetId(),row:t,column:n},d=K.create(m);return e&&or.set(a,d),d}toUnitRange(){return{range:this.getRangePosition(),sheetId:this.getSheetId(),unitId:this.getUnitId()}}_checkIfWorksheetMiss(){return(this._forcedSheetId==null||this._forcedSheetId.length===0)&&this._forcedSheetName.length>0}_getBlankArrayValueObject(){const e={calculateValueList:[],rowCount:0,columnCount:0,unitId:this.getUnitId(),sheetId:this.getSheetId(),row:0,column:0};return K.create(e)}}class bo extends Gn{constructor(o){super(),this._promise=o}isAsyncObject(){return!0}async getValue(){return this._promise}}class yo extends Gn{constructor(o){super(),this._promiseList=o}isAsyncArrayObject(){return!0}async getValue(){var t;const o=[];for(let r=0;r<this._promiseList.length;r++){const n=this._promiseList[r];o[r]==null&&(o[r]=[]);for(let s=0;s<n.length;s++){const a=n[s];a.isAsyncObject()?o[r][s]=await a.getValue():o[r][s]=a}}const e={calculateValueList:o,rowCount:o.length,columnCount:((t=o[0])==null?void 0:t.length)||0,unitId:"",sheetId:"",row:0,column:0};return K.create(e)}}class Lr extends rr{constructor(o,e,t){super(""),this.setRangeData(o),e&&this.setForcedSheetIdDirect(e),t&&this.setForcedUnitIdDirect(t)}isRange(){return!0}}class ua extends rr{constructor(o){super(o);const e=Kt(o);this.setForcedUnitIdDirect(e.unitId),this.setForcedSheetName(e.sheetName),this.setRangeData(e.range)}isCell(){return!0}unionBy(o){if(!o.isCell())return g.create(h.REF);const e=o,t=this.unionRange(this.getRangeData(),e.getRangeData());return this._createRange(t)}unionRange(o,e){const t=o.startRow,r=o.startColumn,n=e.startRow,s=e.startColumn,a={startRow:-1,startColumn:-1,endRow:-1,endColumn:-1};return t>n?(a.startRow=n,a.endRow=t):(a.startRow=t,a.endRow=n),r>s?(a.startColumn=s,a.endColumn=r):(a.startColumn=r,a.endColumn=s),o.startAbsoluteRefType&&(a.startAbsoluteRefType=o.startAbsoluteRefType),e.startAbsoluteRefType&&(a.endAbsoluteRefType=e.startAbsoluteRefType),a}_createRange(o){const e=new Lr(o,this.getForcedSheetId(),this.getForcedUnitId());e.setUnitData(this.getUnitData()),e.setDefaultSheetId(this.getDefaultSheetId()),e.setDefaultUnitId(this.getDefaultUnitId()),e.setRuntimeData(this.getRuntimeData()),e.setUnitStylesData(this.getUnitStylesData()),e.setArrayFormulaCellData(this.getArrayFormulaCellData()),e.setRuntimeArrayFormulaCellData(this.getRuntimeArrayFormulaCellData()),e.setRuntimeFeatureCellData(this.getRuntimeFeatureCellData());const{x:t,y:r}=this.getRefOffset();e.setRefOffset(t,r);const n=this.getForcedSheetId();e.setForcedSheetName(this.getForcedSheetName()),n!=null&&e.setForcedSheetIdDirect(n);const s=this.getForcedUnitId();return s&&e.setForcedUnitIdDirect(s),e}}class ca extends rr{constructor(o){super(o);const e=Kt(o);this.setForcedUnitIdDirect(e.unitId),this.setForcedSheetName(e.sheetName);const t={...e.range,startColumn:e.range.startColumn,startRow:Number.NaN,endColumn:e.range.endColumn,endRow:Number.NaN,rangeType:M.RANGE_TYPE.COLUMN};this.setRangeData(t)}isColumn(){return!0}unionBy(o){if(!o.isColumn())return g.create(h.REF);const e=o;if(e.getForcedSheetName()!==void 0&&e.getForcedSheetName()!=="")return g.create(h.REF);const t=this.getRangeData(),r=e.getRangeData(),n=r.startColumn;if(n>=t.startColumn&&n<=t.endColumn)return this;const s=t.startColumn;return n>s?t.endColumn=n:(t.startColumn=n,t.endColumn=s),r.startAbsoluteRefType&&(t.endAbsoluteRefType=r.startAbsoluteRefType),t.rangeType=M.RANGE_TYPE.COLUMN,this.setToken(`${this.getToken()}${X.COLON}${e.getToken()}`),this}}class la extends rr{constructor(o){super(o);const e=Kt(o);this.setForcedUnitIdDirect(e.unitId),this.setForcedSheetName(e.sheetName);const t={...e.range,startColumn:Number.NaN,startRow:e.range.startRow,endColumn:Number.NaN,endRow:e.range.endRow,rangeType:M.RANGE_TYPE.ROW};this.setRangeData(t)}isRow(){return!0}unionBy(o){if(!o.isRow())return g.create(h.REF);const e=o;if(e.getForcedSheetName()!==void 0&&e.getForcedSheetName()!=="")return g.create(h.REF);const t=this.getRangeData(),r=e.getRangeData(),n=r.startRow;if(n>=t.startRow&&n<=t.endRow)return this;const s=t.startRow;return n>s?t.endRow=n:(t.startRow=n,t.endRow=s),r.startAbsoluteRefType&&(t.endAbsoluteRefType=r.startAbsoluteRefType),t.rangeType=M.RANGE_TYPE.ROW,this.setToken(`${this.getToken()}${X.COLON}${e.getToken()}`),this}}function O(i,o,e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=[];for(let a=0;a<i;a++){const u=[];for(let c=0;c<o;c++){if(r===1&&n===1){const f=e.isArray()?e.get(0,0):e;u.push(f);continue}if(r===1&&c<n){const f=e.get(0,c);u.push(f);continue}if(n===1&&a<r){const f=e.get(a,0);u.push(f);continue}if(a>=r||c>=n){u.push(t!=null?t:ce.create());continue}const l=e.get(a,c);u.push(l)}s.push(u)}return at(s,i,o)}function at(i,o,e,t="",r=""){const n={calculateValueList:i,rowCount:o,columnCount:e,unitId:t,sheetId:r,row:-1,column:-1};return K.create(n)}function fa(i){const o=[Y.EQUALS,Y.NOT_EQUAL,Y.GREATER_THAN_OR_EQUAL,Y.GREATER_THAN,Y.LESS_THAN_OR_EQUAL,Y.LESS_THAN];for(const e of o)if(i.startsWith(e)){const t=i.substring(e.length);return[e,dt.create(t)]}return[Y.EQUALS,dt.create(i)]}function zn(i,o,e,t){if(!e)if(o.isString()){const r=`${o.getValue()}`,[n,s]=fa(r);e=n,o=s}else e=Y.EQUALS;return i.compare(o,e,t)}function Kf(i,o){const e=Math.max(i.isArray()?i.getRowCount():1,o.isArray()?o.getRowCount():1),t=Math.max(i.isArray()?i.getColumnCount():1,o.isArray()?o.getColumnCount():1),r=O(e,t,i),n=O(e,t,o);return r.mapValue((s,a,u)=>{const c=n.get(a,u);return s!=null&&s.isError()?s:c!=null&&c.isError()?c:s!=null&&s.isBoolean()&&(c!=null&&c.isBoolean())?Zn(s.getValue()&&c.getValue()):I.create(!1)})}function Zf(i){const o=i.getValue();let e=0;return o&&(e=1),y.create(e)}function mi(i){return i.isArray()&&i.getRowCount()===1&&i.getColumnCount()===1?!0:i.isReferenceObject()?!!(i.isCell()||i.getRowCount()===1&&i.getColumnCount()===1):(i=i,!!(i.isString()||i.isNumber()||i.isBoolean()||i.isError()||i.isNull()))}function zf(i){const o=i==null?void 0:i.getPattern();let e={},t={};if(o&&(e={s:{n:{pattern:o}}}),i!=null&&i.getCustomData()&&(t={custom:i.getCustomData()}),i==null)return{v:null,...e};if(i.isError())return{v:i.getErrorType(),t:M.CellValueType.STRING,...e,...t};if(i.isValueObject()){const r=i,n=r.getValue();return r.isNumber()?{v:n,t:M.CellValueType.NUMBER,...e,...t}:r.isBoolean()?{v:n?1:0,t:M.CellValueType.BOOLEAN,...e,...t}:r.isString()?{v:n,t:M.CellValueType.STRING,...e,...t}:r.isNull()?{v:null,...e,...t}:{v:n,t:M.CellValueType.STRING,...e,...t}}}function Jf(i){let o=0,e=0;return i.forEach((t,r)=>{if(r%2===1)if(t.isArray()){const n=t;o=Math.max(o,n.getRowCount()),e=Math.max(e,n.getColumnCount())}else o=Math.max(o,1),e=Math.max(e,1)}),{maxRowLength:o,maxColumnLength:e}}function Tr(i,o){if(i.length===0||i.length%2!==0)return{isError:!0,errorObject:g.create(h.VALUE),rangeIsDifferentSize:!1,criteriaMaxRowLength:0,criteriaMaxColumnLength:0,targetRange:null,variants:[]};let e=null,t=-1,r=-1;if(o){if(!o.isReferenceObject())return{isError:!0,errorObject:g.create(h.VALUE),rangeIsDifferentSize:!1,criteriaMaxRowLength:0,criteriaMaxColumnLength:0,targetRange:null,variants:[]};e=o.toArrayValueObject(),t=e.getRowCount(),r=e.getColumnCount()}let n=0,s=0,a=!1;const u=[];for(let c=0;c<i.length;c++)if(c%2===1){const l=i[c-1],f=i[c];if(!l.isReferenceObject())return{isError:!0,errorObject:g.create(h.VALUE),rangeIsDifferentSize:!1,criteriaMaxRowLength:0,criteriaMaxColumnLength:0,targetRange:null,variants:[]};const m=l.toArrayValueObject(),d=m.getRowCount(),C=m.getColumnCount();c===1&&t===-1&&r===-1?(t=d,r=C):!a&&(t!==d||r!==C)&&(a=!0);let _=f;f.isReferenceObject()&&(_=f.toArrayValueObject()),n=Math.max(n,_.isArray()?_.getRowCount():1),s=Math.max(s,_.isArray()?_.getColumnCount():1),u.push(m),u.push(_)}return{isError:!1,errorObject:null,rangeIsDifferentSize:a,criteriaMaxRowLength:n,criteriaMaxColumnLength:s,targetRange:e,variants:u}}function Bs(i){return i.isArray()?i:K.createByArray([[i.getValue()]])}function vr(i,o,e,t=!1){const r=[];for(let n=0;n<i.length;n++){if(n%2===1)continue;const s=i[n],a=i[n+1];O(o,e,a,g.create(h.NA)).iterator((c,l,f)=>{if(!c)return;let m=zn(s,c);if(t&&(m=Jn(m,s,c)),r[l]===void 0&&(r[l]=[]),r[l][f]===void 0){r[l][f]=m;return}r[l][f]=Kf(r[l][f],m)})}return r}function Jn(i,o,e){const[t,r]=fa(`${e.getValue()}`);return i.mapValue((n,s,a)=>{const u=o.get(s,a);if(u&&em(u,r))return n;if(u!=null&&u.isError()&&r.isError()&&u.getValue()===r.getValue())return I.create(!0);if(t===Y.EQUALS||t===Y.NOT_EQUAL){if(u!=null&&u.isNumber()&&r.isString()){const c=r.convertToNumberObjectValue();if(c.isNumber())return u.compare(c,t)}if(r.isNumber()&&(u!=null&&u.isString())){const c=u.convertToNumberObjectValue();if(c.isNumber())return c.compare(r,t)}if(t===Y.EQUALS)return I.create(!1);if(t===Y.NOT_EQUAL)return I.create(!0)}return I.create(!1)})}function em(i,o){if(i.isNumber()&&o.isNumber()||i.isBoolean()&&o.isBoolean())return!0;const e=i.isString()&&i.getValue()==="",t=o.isString()&&o.getValue()==="";return!!((e||i.isNull())&&(t||o.isNull())||i.isString()&&!e&&o.isString()&&!t)}var yr=(i=>(i[i.CELL=0]="CELL",i[i.COLUMN=1]="COLUMN",i[i.ROW=2]="ROW",i))(yr||{});function tm(i,o){let e;switch(o){case 0:e=new ua(i);break;case 1:e=new ca(i);break;case 2:e=new la(i);break;default:throw new Error("Unknown reference object type")}return e}function rm(i,o){let e;return i.isCell()&&o.isCell()||i.isRow()&&o.isRow()||i.isColumn()&&o.isColumn()?e=i.unionBy(o):e=g.create(h.NAME),e}var nm=Object.getOwnPropertyDescriptor,sm=(i,o,e,t)=>{for(var r=t>1?void 0:t?nm(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},am=(i,o)=>(e,t)=>o(e,t,i);exports.HyperlinkEngineFormulaService=class extends M.Disposable{constructor(o){super(),this._univerInstanceService=o}generateCellValue(o,e){if(e.trim()==="")return{v:""};let t=o;if(o.startsWith("#")&&Xs(o.slice(1))){const{unitId:r,sheetName:n,range:s}=fr(o.slice(1)),a=this._univerInstanceService.getCurrentUnitOfType(M.UniverInstanceType.UNIVER_SHEET);if(r===""||r===a.getUnitId())if(n==="")t=`#gid=${a.getActiveSheet().getSheetId()}&range=${bt(s)}`;else{const u=a.getSheetBySheetName(n);u&&(t=`#gid=${u.getSheetId()}&range=${bt(s)}`)}}else M.Tools.isLegalUrl(o)&&(t=M.Tools.normalizeUrl(o));return{p:M.RichTextBuilder.create().insertLink(e,t).getData()}}};exports.HyperlinkEngineFormulaService=sm([am(0,M.IUniverInstanceService)],exports.HyperlinkEngineFormulaService);const ma=M.createIdentifier("univer.formula.hyperlink-engine-formula.service");var im=Object.getOwnPropertyDescriptor,om=(i,o,e,t)=>{for(var r=t>1?void 0:t?im(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},hi=(i,o)=>(e,t)=>o(e,t,i),He=(i=>(i[i.IDLE=0]="IDLE",i[i.START=1]="START",i[i.START_DEPENDENCY=2]="START_DEPENDENCY",i[i.START_CALCULATION=3]="START_CALCULATION",i[i.CURRENTLY_CALCULATING=4]="CURRENTLY_CALCULATING",i[i.START_DEPENDENCY_ARRAY_FORMULA=5]="START_DEPENDENCY_ARRAY_FORMULA",i[i.START_CALCULATION_ARRAY_FORMULA=6]="START_CALCULATION_ARRAY_FORMULA",i[i.CURRENTLY_CALCULATING_ARRAY_FORMULA=7]="CURRENTLY_CALCULATING_ARRAY_FORMULA",i[i.CALCULATION_COMPLETED=8]="CALCULATION_COMPLETED",i))(He||{}),ir=(i=>(i[i.INITIAL=0]="INITIAL",i[i.STOP_EXECUTION=1]="STOP_EXECUTION",i[i.NOT_EXECUTED=2]="NOT_EXECUTED",i[i.SUCCESS=3]="SUCCESS",i))(ir||{});exports.FormulaRuntimeService=class extends M.Disposable{constructor(e,t){super();A(this,"_formulaExecuteStage",0);A(this,"_stopState",!1);A(this,"_currentRow",-1);A(this,"_currentColumn",-1);A(this,"_currentRowCount",Number.NEGATIVE_INFINITY);A(this,"_currentColumnCount",Number.NEGATIVE_INFINITY);A(this,"_currentSubUnitId","");A(this,"_currentUnitId","");A(this,"_runtimeData",{});A(this,"_runtimeOtherData",{});A(this,"_unitArrayFormulaRange",{});A(this,"_unitArrayFormulaEmbeddedMap",{});A(this,"_runtimeArrayFormulaCellData",{});A(this,"_runtimeClearArrayFormulaCellData",{});A(this,"_runtimeFeatureRange",{});A(this,"_runtimeFeatureCellData",{});A(this,"_runtimeImageFormulaData",[]);A(this,"_functionsExecutedState",0);A(this,"_functionDefinitionPrivacyVar",new Map);A(this,"_totalFormulasToCalculate",0);A(this,"_completedFormulasCount",0);A(this,"_totalArrayFormulasToCalculate",0);A(this,"_completedArrayFormulasCount",0);A(this,"_formulaCycleIndex",0);A(this,"_isCycleDependency",!1);this._currentConfigService=e,this._hyperlinkEngineFormulaService=t}get currentRow(){return this._currentRow}get currentColumn(){return this._currentColumn}get currentRowCount(){return this._currentRowCount}get currentColumnCount(){return this._currentColumnCount}get currentSubUnitId(){return this._currentSubUnitId}get currentUnitId(){return this._currentUnitId}dispose(){super.dispose(),this.reset(),this._runtimeFeatureCellData={},this._runtimeFeatureRange={},this.clearReferenceAndNumberformatCache()}enableCycleDependency(){this._isCycleDependency=!0}disableCycleDependency(){this._isCycleDependency=!1}isCycleDependency(){return this._isCycleDependency}setFormulaCycleIndex(e){this._formulaCycleIndex=e}getFormulaCycleIndex(){return this._formulaCycleIndex}setTotalArrayFormulasToCalculate(e){this._totalArrayFormulasToCalculate=e}getTotalArrayFormulasToCalculate(){return this._totalArrayFormulasToCalculate}setCompletedArrayFormulasCount(e){this._completedArrayFormulasCount=e}getCompletedArrayFormulasCount(){return this._completedArrayFormulasCount}setTotalFormulasToCalculate(e){this._totalFormulasToCalculate=e}getTotalFormulasToCalculate(){return this._totalFormulasToCalculate}setCompletedFormulasCount(e){this._completedFormulasCount=e}getCompletedFormulasCount(){return this._completedFormulasCount}markedAsSuccessfullyExecuted(){this._functionsExecutedState=3}markedAsNoFunctionsExecuted(){this._functionsExecutedState=2}markedAsStopFunctionsExecuted(){this._functionsExecutedState=1}markedAsInitialFunctionsExecuted(){this._functionsExecutedState=0}stopExecution(){this._stopState=!0,this.setFormulaExecuteStage(0)}isStopExecution(){return this._stopState}setFormulaExecuteStage(e){this._formulaExecuteStage=e}getFormulaExecuteStage(){return this._formulaExecuteStage}reset(){this._formulaExecuteStage=0,this._runtimeData={},this._runtimeOtherData={},this._unitArrayFormulaRange={},this._unitArrayFormulaEmbeddedMap={},this._runtimeArrayFormulaCellData={},this._runtimeClearArrayFormulaCellData={},this._runtimeImageFormulaData=[],this._functionDefinitionPrivacyVar.clear(),this.markedAsInitialFunctionsExecuted(),this._stopState=!1,this._isCycleDependency=!1,this._totalFormulasToCalculate=0,this._completedFormulasCount=0,this.clearReferenceAndNumberformatCache()}clearReferenceAndNumberformatCache(){Ll(),vl(),ml()}setCurrent(e,t,r,n,s,a){this._currentRow=e,this._currentColumn=t,this._currentRowCount=r,this._currentColumnCount=n,this._currentSubUnitId=s,this._currentUnitId=a}clearFunctionDefinitionPrivacyVar(){this._functionDefinitionPrivacyVar.clear()}registerFunctionDefinitionPrivacyVar(e,t){this._functionDefinitionPrivacyVar.set(e,t)}getFunctionDefinitionPrivacyVar(e){return this._functionDefinitionPrivacyVar.get(e)}setRuntimeOtherData(e,t,r,n){const s=this._currentSubUnitId,a=this._currentUnitId;this._runtimeOtherData[a]===void 0&&(this._runtimeOtherData[a]={});const u=this._runtimeOtherData[a];(u[s]===void 0||u[s]===null)&&(u[s]={});const c=u[s];let l=[];if(n.isReferenceObject()||n.isValueObject()&&n.isArray()){const f=n,{startRow:m,startColumn:d}=f.getRangePosition();f.iterator((C,_,E)=>{const R=this._getValueObjectOfRuntimeData(C),b=_-m,p=E-d;l[b]==null&&(l[b]=[]),l[b][p]=R})}else l=[[this._getValueObjectOfRuntimeData(n)]];(c[e]===void 0||c[e]===null)&&(c[e]={}),(c[e][r]===void 0||c[e][r]===null)&&(c[e][r]={}),c[e][r][t]=l}setRuntimeData(e){const t=this._currentRow,r=this._currentColumn,n=this._currentRowCount,s=this.currentColumnCount,a=this._currentSubUnitId,u=this._currentUnitId;this._runtimeData[u]==null&&(this._runtimeData[u]={});const c=this._runtimeData[u];c[a]==null&&(c[a]=new M.ObjectMatrix);const l=c[a];this._unitArrayFormulaRange[u]==null&&(this._unitArrayFormulaRange[u]={});const f=this._unitArrayFormulaRange[u];(f[a]===null||f[a]===void 0)&&(f[a]={});const m=new M.ObjectMatrix(f[a]);this._runtimeArrayFormulaCellData[u]===void 0&&(this._runtimeArrayFormulaCellData[u]={});const d=this._runtimeArrayFormulaCellData[u];d[a]==null&&(d[a]=new M.ObjectMatrix);const C=d[a];this._runtimeClearArrayFormulaCellData[u]===void 0&&(this._runtimeClearArrayFormulaCellData[u]={});const _=this._runtimeClearArrayFormulaCellData[u];_[a]==null&&(_[a]=new M.ObjectMatrix);const E=_[a];if(e.isReferenceObject()||e.isValueObject()&&e.isArray()){const R=e,{startRow:b,startColumn:p,endRow:V,endColumn:S}=R.getRangePosition();if(b===V&&p===S){const w=R.getFirstCell(),L=this._getValueObjectOfRuntimeData(w);l.setValue(t,r,L),E.setValue(t,r,L),Ge.set(u,a,r,w.getValue(),t,!0);return}const D={startRow:t,startColumn:r,endRow:V-b+t,endColumn:S-p+r};if(m.setValue(t,r,D),this._checkIfArrayFormulaRangeHasData(u,a,t,r,D)||this._checkIfArrayFormulaExceeded(n,s,D)){const w=this._getValueObjectOfRuntimeData(g.create(h.SPILL));l.setValue(t,r,w),E.setValue(t,r,w),Ge.set(u,a,r,h.SPILL,t,!0);const L=this._currentConfigService.getUnitData();R.iterator((P,v,U)=>{var J,H;const $=v-b+t,W=U-p+r,re=(H=(J=L[u])==null?void 0:J[a])==null?void 0:H.cellData.getValue($,W);if(v===b&&U===p)C.setValue(t,r,w);else if(re!=null)re.v==null&&(re.v=""),C.setValue($,W,re);else{if(this._isInOtherArrayFormulaRange(u,a,t,r,$,W))return!0;C.setValue($,W,{v:""})}})}else{const w=g.create(h.SPILL);R.iterator((L,P,v)=>{Ge.set(u,a,r-p+v,L?L.getValue():0,t-b+P,!0);const U=this._getValueObjectOfRuntimeData(L);if(P===b&&v===p){if(L!=null&&L.isError()&&L.isEqualType(w))return E.setValue(t,r,{}),l.setValue(t,r,{...this._getValueObjectOfRuntimeData(w)}),!1;l.setValue(t,r,{...U})}const $=P-b+t,W=v-p+r;C.setValue($,W,U)})}}else{const R=this._getValueObjectOfRuntimeData(e);if(l.setValue(t,r,R),e.isString()&&e.isImage()){const b=e.getImageInfo();b&&this._runtimeImageFormulaData.push({...b,unitId:u,sheetId:a,row:t,column:r})}Ge.set(u,a,r,e.getValue(),t,!0),E.setValue(t,r,R)}}_getValueObjectOfRuntimeData(e){return e!=null&&e.isString()&&e.isHyperlink()?this._hyperlinkEngineFormulaService.generateCellValue(e.getHyperlinkUrl(),e.getValue()):zf(e)}getUnitData(){return this._runtimeData}getUnitArrayFormula(){return this._unitArrayFormulaRange}getUnitArrayFormulaEmbeddedMap(){return this._unitArrayFormulaEmbeddedMap}setUnitArrayFormulaEmbeddedMap(){const e=this._currentUnitId,t=this._currentSubUnitId,r=this._currentRow,n=this._currentColumn,s=this._unitArrayFormulaEmbeddedMap;s[e]==null&&(s[e]={}),s[e][t]==null&&(s[e][t]={}),s[e][t][r]==null&&(s[e][t][r]={}),s[e][t][r][n]=!0}getRuntimeOtherData(){return this._runtimeOtherData}getRuntimeArrayFormulaCellData(){return this._runtimeArrayFormulaCellData}getRuntimeClearArrayFormulaCellData(){return this._runtimeClearArrayFormulaCellData}getRuntimeFeatureRange(){return this._runtimeFeatureRange}setRuntimeFeatureRange(e,t){this._runtimeFeatureRange[e]=t}getRuntimeFeatureCellData(){return this._runtimeFeatureCellData}setRuntimeFeatureCellData(e,t){this._runtimeFeatureCellData[e]=t}getRuntimeImageFormulaData(){return this._runtimeImageFormulaData}getAllRuntimeData(){return{unitData:this.getUnitData(),arrayFormulaRange:this.getUnitArrayFormula(),arrayFormulaEmbedded:this.getUnitArrayFormulaEmbeddedMap(),unitOtherData:this.getRuntimeOtherData(),functionsExecutedState:this._functionsExecutedState,arrayFormulaCellData:this.getRuntimeArrayFormulaCellData(),clearArrayFormulaCellData:this.getRuntimeClearArrayFormulaCellData(),imageFormulaData:this.getRuntimeImageFormulaData(),runtimeFeatureRange:this.getRuntimeFeatureRange(),runtimeFeatureCellData:this.getRuntimeFeatureCellData()}}getRuntimeState(){return{totalFormulasToCalculate:this.getTotalFormulasToCalculate(),completedFormulasCount:this.getCompletedFormulasCount(),totalArrayFormulasToCalculate:this.getTotalArrayFormulasToCalculate(),completedArrayFormulasCount:this.getCompletedArrayFormulasCount(),stage:this.getFormulaExecuteStage(),formulaCycleIndex:this.getFormulaCycleIndex()}}clearArrayObjectCache(){or.clear()}_checkIfArrayFormulaRangeHasData(e,t,r,n,s){var d,C,_,E,R,b,p,V,S,D,w;const{startRow:a,startColumn:u,endRow:c,endColumn:l}=s,f=this._currentConfigService.getUnitData(),m=this._currentConfigService.getArrayFormulaCellData();(_=(C=(d=this._unitArrayFormulaRange[e])==null?void 0:d[t])==null?void 0:C[r])==null||_[n];for(let L=a;L<=c;L++)for(let P=u;P<=l;P++){if(L===r&&n===P)continue;const v=(b=(R=(E=this._runtimeData)==null?void 0:E[e])==null?void 0:R[t])==null?void 0:b.getValue(L,P);(V=(p=m==null?void 0:m[e])==null?void 0:p[t])==null||V.getValue(L,P);const U=(w=(D=(S=f==null?void 0:f[e])==null?void 0:S[t])==null?void 0:D.cellData)==null?void 0:w.getValue(L,P),$=this._getRuntimeFeatureCellValue(L,P,t,e);if(!sn(v)||this._isInOtherArrayFormulaRange(e,t,r,n,L,P)||!sn(U)||!sn($))return!0}return!1}_getRuntimeFeatureCellValue(e,t,r,n){return io(e,t,r,n,this._runtimeFeatureCellData)}_arrayCellHasData(e){return e==null?!1:e.v!==void 0}_isInOtherArrayFormulaRange(e,t,r,n,s,a){var f;const u=(f=this._currentConfigService.getArrayFormulaRange()[e])==null?void 0:f[t];if(u==null)return!1;let c=!1;return new M.ObjectMatrix(u).forValue((m,d,C)=>{var R,b;if(m===r&&d===n)return;const _=this._isInArrayFormulaRange(C,s,a),E=(b=(R=this._runtimeData[e])==null?void 0:R[t])==null?void 0:b.getValue(m,d);_&&(E==null?void 0:E.v)!==h.SPILL&&(c=!0)}),c}_isInArrayFormulaRange(e,t,r){if(e==null)return!1;const{startRow:n,startColumn:s,endRow:a,endColumn:u}=e;return t>=n&&t<=a&&r>=s&&r<=u}_checkIfArrayFormulaExceeded(e,t,r){return r.endRow>=e||r.endColumn>=t}_isInDirtyRange(e,t,r,n){const s=this._currentConfigService.getDirtyRanges();return s.length===0?!0:Ti(s,e,t,r,n)}};exports.FormulaRuntimeService=om([hi(0,pt),hi(1,ma)],exports.FormulaRuntimeService);const ut=M.createIdentifier("univer.formula.runtime.service");var oe=(i=>(i[i.REFERENCE=1]="REFERENCE",i[i.VALUE=2]="VALUE",i[i.OPERATOR=3]="OPERATOR",i[i.FUNCTION=4]="FUNCTION",i[i.LAMBDA=5]="LAMBDA",i[i.LAMBDA_PARAMETER=6]="LAMBDA_PARAMETER",i[i.ERROR=7]="ERROR",i[i.BASE=8]="BASE",i[i.ROOT=9]="ROOT",i[i.UNION=10]="UNION",i[i.PREFIX=11]="PREFIX",i[i.SUFFIX=12]="SUFFIX",i[i.NULL=13]="NULL",i))(oe||{});const Ct=new Map([[1,7],[2,9],[3,8],[4,6],[5,1],[6,2],[9,10],[10,3],[11,4],[12,5]]);class Ye{constructor(o){A(this,"_children",[]);A(this,"_definedNames");A(this,"_parent");A(this,"_valueObject");A(this,"_calculateState",!1);A(this,"_async",!1);A(this,"_address",!1);A(this,"_isForcedCalculateFunction",!1);this._token=o}dispose(){var o;this._children.forEach(e=>{e.dispose()}),(o=this._valueObject)==null||o.dispose(),this._valueObject=null,this._children=[],this._definedNames=null,this._parent=null}get nodeType(){return oe.BASE}resetCalculationState(){this._children.forEach(o=>{o.resetCalculationState()}),this._valueObject=null,this._calculateState=!1}isAsync(){return this._async}isAddress(){return this._address}isForcedCalculateFunction(){return this._isForcedCalculateFunction}setAsync(){this._async=!0}setAddress(){this._address=!0}getParent(){return this._parent}setParent(o){this._parent=o,o.addChildren(this)}setForcedCalculateFunction(){this._isForcedCalculateFunction=!0}getChildren(){return this._children}addChildren(...o){this._children.push(...o)}getToken(){return this._token}setValue(o){this._valueObject=o}getValue(){return this._valueObject}isCalculated(){return this._calculateState}setCalculated(){this._calculateState=!0}execute(){}setNotEmpty(o=!0){}async executeAsync(){return Promise.resolve(wt.SUCCESS)}serialize(){const o=this.getToken(),e=this.getChildren(),t=[],r=e.length;for(let s=0;s<r;s++){const a=e[s];t.push(a.serialize())}const n={token:o,nodeType:this.nodeType};return r>0&&(n.children=t),n}hasDefinedName(o){var e;return((e=this._definedNames)==null?void 0:e.includes(o))||!1}setDefinedNames(o){this._definedNames=o}getDefinedNames(){return this._definedNames}}class Le extends Ye{constructor(e){super(e);A(this,"_errorValueObject");this._errorValueObject=g.create(e)}get nodeType(){return oe.ERROR}static create(e){return new Le(e)}getValue(){return this._errorValueObject}}const _t=100;class At{get zIndex(){return 0}dispose(){}create(o,e,t){let r;return o instanceof ie?r=o.getToken():r=o,new Ye(r)}}class ks extends Ye{get nodeType(){return oe.ROOT}execute(){const o=this.getChildren();if(o.length>1){this.setValue(g.create(h.VALUE));return}const e=o[0];e==null?this.setValue(g.create(h.VALUE)):this.setValue(e.getValue())}}class ha extends At{get zIndex(){return Ct.get(oe.ROOT)||_t}checkAndCreateNodeType(o){if(!(o instanceof ie))return;if(o.getToken()===Rt)return new ks(Rt)}}const um=5e3,Pr=new yt(um);function $s(i,o,e,t,r){let n=Pr.get(`${i}${o}`);if(n&&!po(n,r))return n;const s=e.treeBuilder(o);if(vt.has(s))return Le.create(s);if(n=t.parse(s),n==null)throw new Error("astNode is null");return Pr.set(`${i}${o}`,n),n}function po(i,o){const e=o.getDirtyDefinedNameMap(),t=o.getExecuteUnitId();if(t!=null&&e[t]!=null){const r=Object.keys(e[t]);for(let n=0,s=r.length;n<s;n++){const a=r[n];if(i.hasDefinedName(a))return!0}}return!1}function cm(i,o,e){return!!(o!=null&&po(o,e))}const Vt=M.createIdentifier("univer.formula-function.service");class No extends M.Disposable{constructor(){super(...arguments);A(this,"_functionExecutors",new Map);A(this,"_functionDescriptions",new Map)}dispose(){super.dispose(),this._functionExecutors.clear(),this._functionDescriptions.clear()}registerExecutors(...e){for(let t=0;t<e.length;t++){const r=e[t];this._functionExecutors.set(r.name,r)}}getExecutors(){return this._functionExecutors}getExecutor(e){return this._functionExecutors.get(e)}hasExecutor(e){return this._functionExecutors.has(e)}unregisterExecutors(...e){for(let t=0;t<e.length;t++){const r=e[t];this._functionExecutors.delete(r)}}registerDescriptions(...e){for(let t=0;t<e.length;t++){const r=e[t];this._functionDescriptions.set(r.functionName,r)}return M.toDisposable(()=>{for(let t=0;t<e.length;t++){const r=e[t];this._functionDescriptions.delete(r.functionName)}})}getDescriptions(){return this._functionDescriptions}getDescription(e){return this._functionDescriptions.get(e)}hasDescription(e){return this._functionDescriptions.has(e)}unregisterDescriptions(...e){for(let t=0;t<e.length;t++){const r=e[t];this._functionDescriptions.delete(r)}}deleteFormulaAstCacheKey(...e){Pr.forEach((t,r)=>{e.forEach(n=>{r.includes(n)&&Pr.delete(r)})})}}var Te=(i=>(i.COMPARE="COMPARE",i.DIVIDED="DIVIDED",i.MINUS="MINUS",i.MULTIPLY="MULTIPLY",i.PLUS="PLUS",i.UNION="UNION",i.CUBE="CUBE",i))(Te||{}),lm=Object.getOwnPropertyDescriptor,fm=(i,o,e,t)=>{for(var r=t>1?void 0:t?lm(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},gi=(i,o)=>(e,t)=>o(e,t,i);class yn extends Ye{constructor(o,e,t){super(e),this._runtimeService=o,this._operatorString=e,this._functionExecutor=t}get nodeType(){return oe.PREFIX}execute(){let e=this.getChildren()[0].getValue(),t;if(e==null)throw new Error("object is null");this._operatorString===Se.MINUS?(e.isReferenceObject()&&(e=e.toArrayValueObject()),t=this._functionExecutor.calculate(y.create(0),e)):this._operatorString===Se.AT?t=this._handlerAT(e):t=g.create(h.VALUE),this.setValue(t)}_handlerAT(o){if(!o.isReferenceObject())return g.create(h.VALUE);const e=o;if(e.isCell())return g.create(h.VALUE);const t=this._runtimeService,r=t.currentRow||0,n=t.currentColumn||0,s=e.getRangePosition(),{startRow:a,startColumn:u,endRow:c,endColumn:l}=s;return l!==u&&c!==a||a===c&&u===l?g.create(h.VALUE):c===a&&n>=u&&n<=l?e.getCellByColumn(n):u===l&&r>=a&&r<=c?e.getCellByRow(r):e.isTable()?e.getCellByPosition(r):g.create(h.VALUE)}}exports.PrefixNodeFactory=class extends At{constructor(o,e){super(),this._functionService=o,this._runtimeService=e}get zIndex(){return Ct.get(oe.PREFIX)||_t}checkAndCreateNodeType(o){if(!(o instanceof ie))return;const e=o.getToken(),t=e.trim();if(t.charAt(0)==='"'&&t.charAt(t.length-1)==='"')return;let r="";if(t===Se.MINUS)r=Te.MINUS;else return t===Se.AT?new yn(this._runtimeService,t):void 0;const n=this._functionService.getExecutor(r);return n?new yn(this._runtimeService,t,n):(console.error(`No function ${e}`),Le.create(h.NAME))}};exports.PrefixNodeFactory=fm([gi(0,Vt),gi(1,ut)],exports.PrefixNodeFactory);function Vo(i,o,e){let t,r,n=i;const s=n[0];let a=0;if(s===Se.MINUS){const u=o.getExecutor(Te.MINUS);t=new yn(e,Se.MINUS,u),a++}else s===Se.AT&&(r=new yn(e,Se.AT),t&&r.setParent(t),a++);return a>0&&(n=n.slice(a)),{tokenTrim:n,minusPrefixNode:t,atPrefixNode:r}}var mm=Object.getOwnPropertyDescriptor,hm=(i,o,e,t)=>{for(var r=t>1?void 0:t?mm(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},sr=(i,o)=>(e,t)=>o(e,t,i);class gm extends Ye{constructor(o,e,t,r,n,s){super(o),this._functionExecutor=e,this._currentConfigService=t,this._runtimeService=r,this._definedNamesService=n,this._formulaDataModel=s,this._functionExecutor.isAsync()&&this.setAsync(),this._functionExecutor.isAddress()&&this.setAddress(),this._functionExecutor.needsLocale&&this._setLocale(),this._functionExecutor.needsSheetsInfo&&this._setSheetsInfo(),this._functionExecutor.needsFormulaDataModel&&this._functionExecutor.setFormulaDataModel(this._formulaDataModel)}get nodeType(){return oe.FUNCTION}async executeAsync(){const o=[],e=this.getChildren(),t=e.length;this._compatibility();for(let s=0;s<t;s++){const u=e[s].getValue();u!=null&&(u.isReferenceObject()&&!this._functionExecutor.needsReferenceObject?o.push(u.toArrayValueObject()):o.push(u))}const r=await this._calculateAsync(o);let n;return r.isAsyncObject()||r.isAsyncArrayObject()?n=await r.getValue():n=r,this._setEmbeddedArrayFormulaToResult(n),this._setRefData(n),this.setValue(n),Promise.resolve(wt.SUCCESS)}execute(){const o=[],e=this.getChildren(),t=e.length;this._compatibility();for(let n=0;n<t;n++){const a=e[n].getValue();a!=null&&(a.isReferenceObject()&&this._functionExecutor.needsFilteredOutRows&&this._setFilteredOutRows(a),a.isReferenceObject()&&!this._functionExecutor.needsReferenceObject?o.push(a.toArrayValueObject()):o.push(a))}const r=this._calculate(o);this._setEmbeddedArrayFormulaToResult(r),this._setRefData(r),this.setValue(r)}isFunctionExecutorArgumentsIgnoreNumberPattern(){return this._functionExecutor.isArgumentsIgnoreNumberPattern()}_setEmbeddedArrayFormulaToResult(o){if(!o.isArray())return;const e=o.getRowCount(),t=o.getColumnCount();e<=1&&t<=1||this._runtimeService.setUnitArrayFormulaEmbeddedMap()}_compatibility(){this._lookupCompatibility()}_lookupCompatibility(){const o=this.getChildren(),e=o.length;if(!this._functionExecutor.needsExpandParams||e!==3)return;const t=o[1].getValue(),r=o[2].getValue();if(!(t!=null&&t.isReferenceObject())&&!(r!=null&&r.isReferenceObject()))return;let n,s;if(t!=null&&t.isReferenceObject()){const C=t.getRangeData(),{startRow:_,startColumn:E,endRow:R,endColumn:b}=C;n=R-_+1,s=b-E+1}else n=t!=null&&t.isArray()?t.getRowCount():1,s=t!=null&&t.isArray()?t.getColumnCount():1;const a=r.getRangeData(),{startRow:u,startColumn:c,endRow:l,endColumn:f}=a,m=l-u+1,d=f-c+1;n!==m&&(a.endRow+=n-m),s!==d&&(a.endColumn+=s-d)}_handleCustomResult(o){var t;if(typeof o!="object"||o==null)return dt.create(o);const e=Ro(o);return K.create({calculateValueList:e,rowCount:e.length,columnCount:((t=e[0])==null?void 0:t.length)||0,unitId:"",sheetId:"",row:-1,column:-1})}_handleAddressFunction(){this._functionExecutor.isAddress()&&this._setDefinedNamesForFunction()}_mapVariantsToValues(o){return o.map(e=>e.isArray()?e.toValue():e.isLambda()?e:e.getValue())}_calculate(o){const{minParams:e,maxParams:t}=this._functionExecutor;if(e!==-1&&t!==-1&&(o.length<e||o.length>t))return g.create(h.NA);let r;if(this._setRefInfo(),this._functionExecutor.isCustom()){const n=this._functionExecutor.calculateCustom(...this._mapVariantsToValues(o));r=this._handleCustomResult(n)}else this._handleAddressFunction(),r=this._functionExecutor.calculate(...o);return r}async _calculateAsync(o){const{minParams:e,maxParams:t}=this._functionExecutor;if(e!==-1&&t!==-1&&(o.length<e||o.length>t))return g.create(h.NA);let r;if(this._setRefInfo(),this._functionExecutor.isCustom()){const n=await this._functionExecutor.calculateCustom(...this._mapVariantsToValues(o));r=this._handleCustomResult(n)}else this._handleAddressFunction(),r=this._functionExecutor.calculate(...o);return r}_setDefinedNamesForFunction(){const o=this._currentConfigService.getExecuteUnitId();if(o==null)return;const e=this._definedNamesService.getDefinedNameMap(o);e!=null&&this._functionExecutor.setDefinedNames(e)}_setRefInfo(){const{currentUnitId:o,currentSubUnitId:e,currentRow:t,currentColumn:r}=this._runtimeService;if(this._functionExecutor.setRefInfo(o,e,t,r),this._functionExecutor.needsSheetRowColumnCount){const{rowCount:n,columnCount:s}=this._currentConfigService.getSheetRowColumnCount(o,e);this._functionExecutor.setSheetRowColumnCount(n,s)}}_setRefData(o){if(!o.isReferenceObject())return;const e=o;e.setForcedSheetId(this._currentConfigService.getSheetNameMap()),e.setUnitData(this._currentConfigService.getUnitData()),e.setArrayFormulaCellData(this._currentConfigService.getArrayFormulaCellData()),e.setRuntimeData(this._runtimeService.getUnitData()),e.setRuntimeArrayFormulaCellData(this._runtimeService.getRuntimeArrayFormulaCellData()),e.setRuntimeFeatureCellData(this._runtimeService.getRuntimeFeatureCellData())}_setLocale(){this._functionExecutor.setLocale(this._currentConfigService.getLocale())}_setSheetsInfo(){this._functionExecutor.setSheetsInfo(this._currentConfigService.getSheetsInfo())}_setFilteredOutRows(o){const{startRow:e,endRow:t}=o.getRangePosition(),r=this._currentConfigService.getFilteredOutRows(o.getUnitId(),o.getSheetId(),e,t);o.setFilteredOutRows(r)}}class dm extends Ye{constructor(o="Error"){super(o)}get nodeType(){return oe.FUNCTION}async executeAsync(){return this.setValue(g.create(h.NAME)),Promise.resolve(wt.SUCCESS)}execute(){this.setValue(g.create(h.NAME))}}exports.FunctionNodeFactory=class extends At{constructor(o,e,t,r,n,s){super(),this._functionService=o,this._currentConfigService=e,this._runtimeService=t,this._definedNamesService=r,this._injector=n,this._formulaDataModel=s}get zIndex(){return Ct.get(oe.FUNCTION)||_t}create(o){const e=this._functionService.getExecutor(o);return e?new gm(o,e,this._currentConfigService,this._runtimeService,this._definedNamesService,this._formulaDataModel):(console.error(`No function ${o}`),Le.create(h.NAME))}checkAndCreateNodeType(o){if(typeof o=="string")return;const e=o.getToken(),{tokenTrim:t,minusPrefixNode:r,atPrefixNode:n}=Vo(e.trim(),this._functionService,this._runtimeService);if(!Number.isNaN(Number(t))&&!this._isParentUnionNode(o))return Le.create(h.VALUE);const s=t.toUpperCase();if(this._functionService.hasExecutor(s)){const a=this.create(s);return n?a.setParent(n):r&&a.setParent(r),a}}_isParentUnionNode(o){var e,t;return((t=(e=o.getParent())==null?void 0:e.getParent())==null?void 0:t.getToken())===X.COLON}};exports.FunctionNodeFactory=hm([sr(0,Vt),sr(1,pt),sr(2,ut),sr(3,er),sr(4,M.Inject(M.Injector)),sr(5,M.Inject(exports.FormulaDataModel))],exports.FunctionNodeFactory);var Cm=Object.getOwnPropertyDescriptor,_m=(i,o,e,t)=>{for(var r=t>1?void 0:t?Cm(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},Am=(i,o)=>(e,t)=>o(e,t,i);exports.Interpreter=class extends M.Disposable{constructor(o){super(),this._runtimeService=o}async executeAsync(o){if(!o||!o.node)return Promise.resolve(g.create(h.VALUE));const e=o.node,t=o.refOffsetX,r=o.refOffsetY;await this._executeAsync(e,t,r);const n=e.getValue();return n==null?Promise.resolve(g.create(h.VALUE)):Promise.resolve(n)}execute(o){if(!o||!o.node)return g.create(h.VALUE);const e=o.node,t=o.refOffsetX,r=o.refOffsetY;this._execute(e,t,r);const n=e.getValue();return n==null?g.create(h.VALUE):n}executePreCalculateNode(o){return o.execute(),o.getValue()}checkAsyncNode(o){if(o==null)return!1;const e=[];this._checkAsyncNode(o,e);for(let t=0,r=e.length;t<r;t++)if(e[t]===!0)return!0;return!1}_checkAsyncNode(o,e){const t=o.getChildren(),r=t.length;for(let n=0;n<r;n++){const s=t[n];e.push(s.isAsync()),this._checkAsyncNode(s,e)}}async _executeAsync(o,e=0,t=0){if(this._runtimeService.isStopExecution())return Promise.resolve(wt.ERROR);const r=o.getChildren(),n=r.length;for(let s=0;s<n;s++){const a=r[s];if(a.getToken().toUpperCase()===lr&&a.isEmptyParamFunction()){a.execute();continue}await this._executeAsync(a,e,t)}return o.nodeType===oe.REFERENCE&&o.setRefOffset(e,t),o.nodeType===oe.FUNCTION&&o.isAsync()?await o.executeAsync():o.execute(),Promise.resolve(wt.SUCCESS)}_execute(o,e=0,t=0){if(this._runtimeService.isStopExecution())return wt.ERROR;const r=o.getChildren(),n=r.length;for(let s=0;s<n;s++){const a=r[s];if(a.getToken().toUpperCase()===lr&&a.isEmptyParamFunction()){a.execute();continue}this._execute(a,e,t)}return o.nodeType===oe.REFERENCE&&o.setRefOffset(e,t),o.execute(),wt.SUCCESS}};exports.Interpreter=_m([Am(0,ut)],exports.Interpreter);function Oo(i){return i instanceof ie?i.getToken()===Xt:!1}function Em(i){return i instanceof ie?i.getToken()===Wi:!1}function ga(i,o,e){const t=i.getChildren(),r=t.length,n=t[0];for(let s=0;s<r;s++){const a=t[s];if(!(Oo(n)&&s!==0))if(a instanceof ie)ga(a,o,e);else{const u=a.trim();if(e.has(u)){const c=new ie;c.setToken(Ur),c.setLambdaId(o),c.setLambdaPrivacyVar(e),c.setLambdaParameter(u),t[s]=c}}}}function Rm(i){let o=i;for(;o!=null&&o.getParent();)o=o.getParent();return o}function Ys(i,o=0,e=0){return{node:i,refOffsetX:o,refOffsetY:e}}function So(i){if(!i)return;if(i.getToken()!==Ur)return i;const o=i,e=o.getCurrentLambdaPrivacyVar(),t=o.getLambdaParameter();if(!e)return;const r=e.get(t);return r==null&&i.getValue()?i:So(r)}class es extends Nt{constructor(e,t,r){super(0);A(this,"_lambdaPrivacyValueMap",new Map);this._lambdaNode=e,this._interpreter=t,this._lambdaPrivacyVarKeys=r,this._lambdaPrivacyValueMap.clear()}static create(e,t,r){return new es(e,t,r)}dispose(){this._lambdaPrivacyValueMap.clear(),this._lambdaPrivacyValueMap=new Map,this._lambdaNode=null,this._interpreter=null,this._lambdaPrivacyVarKeys=[]}isLambda(){return!0}execute(...e){const t=this._lambdaPrivacyVarKeys.length;if(e.length!==t||!this._interpreter||!this._lambdaNode)return g.create(h.VALUE);this._setLambdaPrivacyValueMap(e),this._setLambdaNodeValue(this._lambdaNode),this._lambdaNode.setNotEmpty(!1);let r;if(this._interpreter.checkAsyncNode(this._lambdaNode))r=new bo(this._interpreter.executeAsync(Ys(this._lambdaNode)));else{const n=this._interpreter.execute(Ys(this._lambdaNode));n.isReferenceObject()?r=n.toArrayValueObject():r=n}return this._lambdaNode.setNotEmpty(!0),r}executeCustom(...e){const t=e.map(r=>dt.create(r));return this.execute(...t)}_setLambdaNodeValue(e){if(!e)return;const t=e.getChildren(),r=t.length;for(let n=0;n<r;n++){const s=t[n];if(s.getToken()===Ur){const u=s.getLambdaParameter(),c=this._lambdaPrivacyValueMap.get(u);if(c)s.setValue(c);else{const l=s.getCurrentLambdaPrivacyVar(),f=So(l.get(u));f!=null&&s.setValue(f.getValue())}continue}this._setLambdaNodeValue(s)}}_setLambdaPrivacyValueMap(e){for(let t=0;t<e.length;t++){const r=e[t],n=this._lambdaPrivacyVarKeys[t];this._lambdaPrivacyValueMap.set(n,r)}}getLambdaPrivacyVarKeys(){return this._lambdaPrivacyVarKeys}}var bm=Object.getOwnPropertyDescriptor,ym=(i,o,e,t)=>{for(var r=t>1?void 0:t?bm(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},di=(i,o)=>(e,t)=>o(e,t,i);class pm extends Ye{constructor(e,t,r,n,s){super(e);A(this,"_isNotEmpty",!0);this._lambdaId=t,this._interpreter=r,this._lambdaPrivacyVarKeys=n,this._runtimeService=s}get nodeType(){return oe.LAMBDA}setNotEmpty(e=!1){this._isNotEmpty=e}isEmptyParamFunction(){return this.getChildren().length<2&&this._isNotEmpty}isFunctionParameter(){return this._lambdaId===null}getLambdaId(){return this._lambdaId}execute(){if(this.isEmptyParamFunction())this.setValue(es.create(this,this._interpreter,this._lambdaPrivacyVarKeys));else{const e=this.getChildren(),t=e.length;this.setValue(e[t-1].getValue())}this._runtimeService.setUnitArrayFormulaEmbeddedMap()}}exports.LambdaNodeFactory=class extends At{constructor(o,e){super(),this._runtimeService=o,this._interpreter=e}get zIndex(){return Ct.get(oe.LAMBDA)||_t}create(o){const e=o.getChildren(),t=e[0];let r=e.slice(1,-1);const n=e[e.length-1];if(!(t instanceof ie&&n instanceof ie))return Le.create(h.NAME);if(t.getToken()===Xt){const u=t.getChildren();if(r.length!==u.length)return Le.create(h.VALUE)}else r=e.slice(0,-1);const s=M.generateRandomId(8),a=new Map;for(let u=0;u<r.length;u++){const c=r[u];if(c instanceof ie){const l=c.getChildren()[0];c.setToken(Wi),a.set(l.trim(),void 0)}else return Le.create(h.VALUE)}return this._runtimeService.registerFunctionDefinitionPrivacyVar(s,a),this._updateLambdaStatement(n,s,a),new pm(o.getToken(),s,this._interpreter,[...a.keys()],this._runtimeService)}checkAndCreateNodeType(o){if(!(!(o instanceof ie)||o.getToken().trim().toUpperCase()!==lr))return this.create(o)}_updateLambdaStatement(o,e,t){ga(o,e,t)}};exports.LambdaNodeFactory=ym([di(0,ut),di(1,M.Inject(exports.Interpreter))],exports.LambdaNodeFactory);function Mo(i){if(!i)return;if(i.getToken()!==Ur)return i;const o=i,e=o.getCurrentLambdaPrivacyVar(),t=o.getLambdaParameter();if(e)return Mo(e.get(t))}class Nm extends Ye{constructor(o,e,t){super(o),this._lambdaParameter=e,this._currentLambdaPrivacyVar=t}getLambdaParameter(){return this._lambdaParameter}getCurrentLambdaPrivacyVar(){return this._currentLambdaPrivacyVar}get nodeType(){return oe.LAMBDA_PARAMETER}execute(){const o=Mo(this._currentLambdaPrivacyVar.get(this._lambdaParameter));if(o)this.setValue(o.getValue());else{const e=this.getValue();(e==null||e.isError())&&this.setValue(g.create(h.NAME))}}}class da extends At{get zIndex(){return Ct.get(oe.LAMBDA_PARAMETER)||_t}create(o){const e=o.getFunctionDefinitionPrivacyVar(),t=o.getLambdaParameter();return e?new Nm(o.getToken(),t,e):new Le(h.NAME)}checkAndCreateNodeType(o){if(!(!(o instanceof ie)||o.getToken().trim()!==Ur))return this.create(o)}}class Vm extends Ye{constructor(o){super(o),this._operatorString=o}get nodeType(){return oe.NULL}execute(){this.setValue(ce.create())}}var k=(i=>(i.ABS="ABS",i.ACOS="ACOS",i.ACOSH="ACOSH",i.ACOT="ACOT",i.ACOTH="ACOTH",i.AGGREGATE="AGGREGATE",i.ARABIC="ARABIC",i.ASIN="ASIN",i.ASINH="ASINH",i.ATAN="ATAN",i.ATAN2="ATAN2",i.ATANH="ATANH",i.BASE="BASE",i.CEILING="CEILING",i.CEILING_MATH="CEILING.MATH",i.CEILING_PRECISE="CEILING.PRECISE",i.COMBIN="COMBIN",i.COMBINA="COMBINA",i.COS="COS",i.COSH="COSH",i.COT="COT",i.COTH="COTH",i.CSC="CSC",i.CSCH="CSCH",i.DECIMAL="DECIMAL",i.DEGREES="DEGREES",i.EVEN="EVEN",i.EXP="EXP",i.FACT="FACT",i.FACTDOUBLE="FACTDOUBLE",i.FLOOR="FLOOR",i.FLOOR_MATH="FLOOR.MATH",i.FLOOR_PRECISE="FLOOR.PRECISE",i.GCD="GCD",i.INT="INT",i.ISO_CEILING="ISO.CEILING",i.LCM="LCM",i.LET="LET",i.LN="LN",i.LOG="LOG",i.LOG10="LOG10",i.MDETERM="MDETERM",i.MINVERSE="MINVERSE",i.MMULT="MMULT",i.MOD="MOD",i.MROUND="MROUND",i.MULTINOMIAL="MULTINOMIAL",i.MUNIT="MUNIT",i.ODD="ODD",i.PI="PI",i.POWER="POWER",i.PRODUCT="PRODUCT",i.QUOTIENT="QUOTIENT",i.RADIANS="RADIANS",i.RAND="RAND",i.RANDARRAY="RANDARRAY",i.RANDBETWEEN="RANDBETWEEN",i.ROMAN="ROMAN",i.ROUND="ROUND",i.ROUNDBANK="ROUNDBANK",i.ROUNDDOWN="ROUNDDOWN",i.ROUNDUP="ROUNDUP",i.SEC="SEC",i.SECH="SECH",i.SERIESSUM="SERIESSUM",i.SEQUENCE="SEQUENCE",i.SIGN="SIGN",i.SIN="SIN",i.SINH="SINH",i.SQRT="SQRT",i.SQRTPI="SQRTPI",i.SUBTOTAL="SUBTOTAL",i.SUM="SUM",i.SUMIF="SUMIF",i.SUMIFS="SUMIFS",i.SUMPRODUCT="SUMPRODUCT",i.SUMSQ="SUMSQ",i.SUMX2MY2="SUMX2MY2",i.SUMX2PY2="SUMX2PY2",i.SUMXMY2="SUMXMY2",i.TAN="TAN",i.TANH="TANH",i.TRUNC="TRUNC",i))(k||{}),z=(i=>(i.ASC="ASC",i.ARRAYTOTEXT="ARRAYTOTEXT",i.BAHTTEXT="BAHTTEXT",i.CHAR="CHAR",i.CLEAN="CLEAN",i.CODE="CODE",i.CONCAT="CONCAT",i.CONCATENATE="CONCATENATE",i.DBCS="DBCS",i.DOLLAR="DOLLAR",i.EXACT="EXACT",i.FIND="FIND",i.FINDB="FINDB",i.FIXED="FIXED",i.LEFT="LEFT",i.LEFTB="LEFTB",i.LEN="LEN",i.LENB="LENB",i.LOWER="LOWER",i.MID="MID",i.MIDB="MIDB",i.NUMBERSTRING="NUMBERSTRING",i.NUMBERVALUE="NUMBERVALUE",i.PHONETIC="PHONETIC",i.PROPER="PROPER",i.REGEXEXTRACT="REGEXEXTRACT",i.REGEXMATCH="REGEXMATCH",i.REGEXREPLACE="REGEXREPLACE",i.REPLACE="REPLACE",i.REPLACEB="REPLACEB",i.REPT="REPT",i.RIGHT="RIGHT",i.RIGHTB="RIGHTB",i.SEARCH="SEARCH",i.SEARCHB="SEARCHB",i.SUBSTITUTE="SUBSTITUTE",i.T="T",i.TEXT="TEXT",i.TEXTAFTER="TEXTAFTER",i.TEXTBEFORE="TEXTBEFORE",i.TEXTJOIN="TEXTJOIN",i.TEXTSPLIT="TEXTSPLIT",i.TRIM="TRIM",i.UNICHAR="UNICHAR",i.UNICODE="UNICODE",i.UPPER="UPPER",i.VALUE="VALUE",i.VALUETOTEXT="VALUETOTEXT",i.CALL="CALL",i.EUROCONVERT="EUROCONVERT",i.REGISTER_ID="REGISTER.ID",i))(z||{}),Om=Object.getOwnPropertyDescriptor,Sm=(i,o,e,t)=>{for(var r=t>1?void 0:t?Om(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},Ci=(i,o)=>(e,t)=>o(e,t,i);class Mm extends Ye{constructor(o,e,t){super(o),this._functionExecutor=e,this._runtimeService=t}get nodeType(){return oe.OPERATOR}execute(){const o=this.getChildren();this._functionExecutor.name===Te.COMPARE&&this._functionExecutor.setCompareType(this.getToken());const e=o[0],t=o[1];let r=e==null?void 0:e.getValue(),n=t==null?void 0:t.getValue();const s=this.getToken();if((r==null||n==null)&&s!==Z.MINUS&&s!==Z.PLUS){this.setValue(g.create(h.VALUE));return}r==null&&(r=ce.create()),n==null&&(n=ce.create()),r.isReferenceObject()&&(r=r.toArrayValueObject()),n.isReferenceObject()&&(n=n.toArrayValueObject());const a=this._functionExecutor.calculate(r,n);this._setEmbeddedArrayFormulaToResult(a),this.setValue(a)}_setEmbeddedArrayFormulaToResult(o){if(!o.isArray())return;const e=o.getRowCount(),t=o.getColumnCount();e<=1&&t<=1||this._runtimeService.setUnitArrayFormulaEmbeddedMap()}}exports.OperatorNodeFactory=class extends At{constructor(o,e){super(),this._functionService=o,this._runtimeService=e}get zIndex(){return Ct.get(oe.OPERATOR)||_t}create(o){let e="";const t=o;t===Z.PLUS?e=Te.PLUS:t===Z.MINUS?e=Te.MINUS:t===Z.MULTIPLY?e=Te.MULTIPLY:t===Z.DIVIDED?e=Te.DIVIDED:t===Z.CONCATENATE?e=z.CONCATENATE:t===Z.POWER?e=k.POWER:Vc.has(t)&&(e=Te.COMPARE);const r=this._functionService.getExecutor(e);return r?new Mm(t,r,this._runtimeService):(console.error(`No function ${o}`),Le.create(h.NAME))}checkAndCreateNodeType(o){if(o instanceof ie)return;const e=o.trim();if(!(e.charAt(0)==='"'&&e.charAt(e.length-1)==='"')&&lt.has(e))return this.create(e)}};exports.OperatorNodeFactory=Sm([Ci(0,Vt),Ci(1,ut)],exports.OperatorNodeFactory);class Dm extends rr{constructor(e,t,r,n){super(e);A(this,"_isCurrentRowForRange",!1);this._tableData=t,this._columnDataString=r,this._tableOptionMap=n;const{sheetId:s,range:a,titleMap:u}=this._tableData;this.setForcedSheetIdDirect(s);const{startColumn:c,endColumn:l,type:f}=this._parseStructuredRef(this._columnDataString,u),m=a.startRow,d=a.endRow;let C=-1,_=-1;switch(f){case Oe.ALL:C=m,_=d;break;case Oe.DATA:C=m+1,_=d;break;case Oe.HEADERS:C=m,_=m;break;case Oe.TOTALS:C=d,_=d;break;case Oe.THIS_ROW:{const E=this._resolveThisRow(m,d);C=E,_=E;break}default:C=m+1,_=d;break}this.setRangeData({startColumn:c,endColumn:l,startRow:C,endRow:_})}getRangeData(){const e=super.getRangeData();if(this._isCurrentRowForRange){const{startRow:t,startColumn:r,endRow:n,endColumn:s}=e,a=this.getCurrentRow();return{startRow:a==null?t:a,endRow:a==null?n:a,startColumn:r,endColumn:s}}return e}getRefOffset(){return{x:0,y:0}}isTable(){return!0}isCurrentRowForRange(){return this._isCurrentRowForRange}setForcedSheetId(e){}_parseStructuredRef(e,t){var _,E;const{range:r}=this._tableData,n=(_=r.startColumn)!=null?_:0,s=(E=r.endColumn)!=null?E:0;if(!e||e.trim().length===0)return{startColumn:n,endColumn:s,type:Oe.DATA};const a=e.trim();if(a[0]!=="["){const R=this._mapSection(a);if(R!==void 0)return{startColumn:n,endColumn:s,type:R};const{startColumn:b,endColumn:p}=this._parseColumnOrRange(a,t,n);return{startColumn:b,endColumn:p,type:Oe.DATA}}const u=this._stripOuterBracketOnce(a),c=this._findCommaAtTopLevel(u);if(u.length===0)return{startColumn:n,endColumn:s,type:Oe.DATA};if(c===-1){if(u.startsWith("#")){const p=this._mapSection(u);return p!==void 0?{startColumn:n,endColumn:s,type:p}:{startColumn:n,endColumn:s,type:Oe.DATA}}const{startColumn:R,endColumn:b}=this._parseColumnOrRange(u,t,n);return{startColumn:R,endColumn:b,type:Oe.DATA}}const l=u.slice(0,c).trim(),f=u.slice(c+1).trim(),m=this._parseSectionMaybeBracketed(l),{startColumn:d,endColumn:C}=this._parseColumnOrRange(f,t,n);return{startColumn:d,endColumn:C,type:m}}_stripOuterBracketOnce(e){return e.length>=2&&e[0]==="["&&e[e.length-1]==="]"?e.slice(1,-1):e}_findCommaAtTopLevel(e){let t=0;for(let r=0;r<e.length;r++){const n=e[r];if(n==="[")t++;else if(n==="]")t=Math.max(0,t-1);else if(n===X.COMMA&&t===0)return r}return-1}_parseSectionMaybeBracketed(e){const t=e.trim(),r=t.startsWith("[")&&t.endsWith("]")?this._stripOuterBracketOnce(t):t,n=this._mapSection(r);return n!=null?n:Oe.DATA}_mapSection(e){const t=e.trim();if(!t.startsWith("#"))return;const r=this._tableOptionMap.get(t);if(r!==void 0)return r;const n=t.replace(/\s+/g," ").toLowerCase();for(const[s,a]of this._tableOptionMap.entries())if(s.replace(/\s+/g," ").toLowerCase()===n)return a}_parseColumnOrRange(e,t,r){const n=e.trim(),s=this._findColonAtTopLevel(n);if(s===-1){const d=this._stripOuterBracketIfAny(n),C=this._titleToIndex(d,t);return{startColumn:r+C,endColumn:+r+C}}const a=n.slice(0,s).trim(),u=n.slice(s+1).trim(),c=this._stripOuterBracketIfAny(a),l=this._stripOuterBracketIfAny(u),f=this._titleToIndex(c,t),m=this._titleToIndex(l,t);return f!==-1&&m!==-1&&f>m?{startColumn:r+m,endColumn:r+f}:{startColumn:r+f,endColumn:r+m}}_stripOuterBracketIfAny(e){return e.length>=2&&e[0]==="["&&e[e.length-1]==="]"?e.slice(1,-1):e}_findColonAtTopLevel(e){let t=0;for(let r=0;r<e.length;r++){const n=e[r];if(n==="[")t++;else if(n==="]")t=Math.max(0,t-1);else if(n===X.COLON&&t===0)return r}return-1}_titleToIndex(e,t){var a;const r=e.trim(),n=t.get(r);if(n!==void 0)return n;const s=r.replace(/\u3000/g," ").trim();return(a=t.get(s))!=null?a:-1}_resolveThisRow(e,t){return this._isCurrentRowForRange=!0,Math.min(e+1,t)}}var wm=Object.getOwnPropertyDescriptor,Lm=(i,o,e,t)=>{for(var r=t>1?void 0:t?wm(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},qr=(i,o)=>(e,t)=>o(e,t,i);class _i extends Ye{constructor(e,t,r,n,s=!1,a){super(r);A(this,"_refOffsetX",0);A(this,"_refOffsetY",0);this._currentConfigService=e,this._runtimeService=t,this._referenceObjectType=n,this._isPrepareMerge=s,this._tableReferenceObject=a}get nodeType(){return oe.REFERENCE}execute(){const e=this._currentConfigService,t=this._runtimeService,r=this._tableReferenceObject||tm(this.getToken(),this._referenceObjectType);r.setDefaultUnitId(t.currentUnitId),r.setDefaultSheetId(t.currentSubUnitId),r.setForcedSheetId(e.getSheetNameMap()),r.setUnitData(e.getUnitData()),r.setArrayFormulaCellData(e.getArrayFormulaCellData()),r.setRuntimeData(t.getUnitData()),r.setUnitStylesData(e.getUnitStylesData()),r.setRuntimeArrayFormulaCellData(t.getRuntimeArrayFormulaCellData()),r.setRuntimeFeatureCellData(t.getRuntimeFeatureCellData());const n=t.currentRow,s=t.currentColumn;r.setCurrentRowAndColumn(n,s);const{x:a,y:u}=this.getRefOffset();r.setRefOffset(a,u),!this._isPrepareMerge&&r.isExceedRange()?this.setValue(g.create(h.NAME)):this.setValue(r)}setRefOffset(e=0,t=0){this._refOffsetX=e,this._refOffsetY=t}getRefOffset(){return{x:this._refOffsetX,y:this._refOffsetY}}}exports.ReferenceNodeFactory=class extends At{constructor(o,e,t,r){super(),this._currentConfigService=o,this._formulaRuntimeService=e,this._functionService=t,this._superTableService=r}get zIndex(){return Ct.get(oe.REFERENCE)||_t}checkAndCreateNodeType(o){var c,l;let e=!1,t,r=!1;o instanceof ie?(e=!0,t=o.getToken().trim(),((l=(c=o.getParent())==null?void 0:c.getParent())==null?void 0:l.getToken().trim())===X.COLON&&(r=!0)):t=o.trim();const{tokenTrim:n,minusPrefixNode:s,atPrefixNode:a}=Vo(t,this._functionService,this._formulaRuntimeService);if(!e&&n.charAt(0)==='"'&&n.charAt(n.length-1)==='"')return;const u=this._getNode(n,e,r,o);if(u)return a?u.setParent(a):s&&u.setParent(s),u}_getTableMap(){const o=this._currentConfigService.getExecuteUnitId();if(o)return this._superTableService.getTableMap(o)}_getNode(o,e,t,r){var C;const n=this._currentConfigService,s=this._formulaRuntimeService,a=_=>new _i(n,s,o,_,t);if(jr(o))return a(yr.CELL);const c=e&&this._checkParentIsUnionOperator(r);if(c&&Yi(o))return a(yr.ROW);if(c&&Hi(o))return a(yr.COLUMN);const m=this._getTableMap();return((C=m==null?void 0:m.has(o))!=null?C:!1)?this._getTableReferenceNode(o,e,t,!0):this._getTableReferenceNode(o,e,t,!1)}_getTableReferenceNode(o,e,t,r=!1){if(!this._checkTokenIsTableReference(o)&&!r)return;const{tableName:n,columnStruct:s}=this._splitTableStructuredRef(o),a=this._getTableMap();if(!e&&(a!=null&&a.has(n))){const u=s,c=a.get(n),l=this._superTableService.getTableOptionMap();return new _i(this._currentConfigService,this._formulaRuntimeService,o,yr.COLUMN,t,new Dm(o,c,u,l))}}_splitTableStructuredRef(o){const e=o.indexOf("[");return e===-1?{tableName:o,struct:""}:{tableName:o.slice(0,e),columnStruct:o.slice(e)}}_checkTokenIsTableReference(o){return Wc(o)||Qc(o)||qc(o)||Xc(o)}_checkParentIsUnionOperator(o){var e,t;return((t=(e=o.getParent())==null?void 0:e.getParent())==null?void 0:t.getToken().trim())===X.COLON}};exports.ReferenceNodeFactory=Lm([qr(0,pt),qr(1,ut),qr(2,Vt),qr(3,tr)],exports.ReferenceNodeFactory);var Pm=Object.getOwnPropertyDescriptor,xm=(i,o,e,t)=>{for(var r=t>1?void 0:t?Pm(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},_s=(i,o)=>(e,t)=>o(e,t,i);class Ai extends Ye{constructor(o,e,t,r){super(t),this._currentConfigService=o,this._lexer=e,this._operatorString=t,this._functionExecutor=r}get nodeType(){return oe.SUFFIX}execute(){var r;let e=(r=this.getChildren()[0])==null?void 0:r.getValue(),t;if(e==null){this.setValue(g.create(h.ERROR));return}if(this._operatorString===Xe.PERCENTAGE){if(e.isReferenceObject()&&(e=e.toArrayValueObject()),t=this._functionExecutor.calculate(e,y.create(100)),t.isNumber()){const n=Number(t.getValue());t=y.create(n,"0.00%")}}else this._operatorString===Xe.POUND?t=this._handlerPound(e):t=g.create(h.VALUE);this.setValue(t)}_handlerPound(o){var u,c,l,f;if(!o.isReferenceObject()||!o.isCell())return g.create(h.VALUE);const e=o,t=e.getRangePosition(),r=e.getUnitId(),n=e.getSheetId(),s=this._currentConfigService.getFormulaData(),a=(f=(l=(c=(u=s==null?void 0:s[r])==null?void 0:u[n])==null?void 0:c[t.startRow])==null?void 0:l[t.startColumn])==null?void 0:f.f;return a&&this._lexer.treeBuilder(a),g.create(h.VALUE)}}exports.SuffixNodeFactory=class extends At{constructor(o,e,t){super(),this._functionService=o,this._lexer=e,this._currentConfigService=t}get zIndex(){return Ct.get(oe.SUFFIX)||_t}checkAndCreateNodeType(o){if(!(o instanceof ie))return;const e=o.getToken().trim();if(e.charAt(0)==='"'&&e.charAt(e.length-1)==='"')return;let t="";if(e===Xe.PERCENTAGE)t=Te.DIVIDED;else return e===Xe.POUND?new Ai(this._currentConfigService,this._lexer,e):void 0;const r=this._functionService.getExecutor(t);return r?new Ai(this._currentConfigService,this._lexer,e,r):(console.error(`No function ${o}`),Le.create(h.NAME))}};exports.SuffixNodeFactory=xm([_s(0,Vt),_s(1,M.Inject(exports.Lexer)),_s(2,pt)],exports.SuffixNodeFactory);var jm=Object.getOwnPropertyDescriptor,Um=(i,o,e,t)=>{for(var r=t>1?void 0:t?jm(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},Tm=(i,o)=>(e,t)=>o(e,t,i);class vm extends Ye{constructor(o){super(o)}get nodeType(){return oe.UNION}execute(){const o=this.getChildren(),e=o[0],t=o[1],r=e.getValue(),n=t.getValue();if(r==null||n==null)throw new Error("leftNode and rightNode");let s;this.getToken()===X.COLON?s=this._unionFunction(r,n):s=g.create(h.NAME),this.setValue(s)}_unionFunction(o,e){return o.isError()||e.isError()||!o.isReferenceObject()||!e.isReferenceObject()?g.create(h.REF):(o=o,e=e,rm(o,e))}}exports.UnionNodeFactory=class extends At{constructor(o){super(),this._functionService=o}get zIndex(){return Ct.get(oe.UNION)||_t}create(o){return new vm(o)}checkAndCreateNodeType(o){if(!(o instanceof ie))return;const t=o.getToken().trim();if(!(t.charAt(0)==='"'&&t.charAt(t.length-1)==='"')&&t===X.COLON)return this.create(t)}};exports.UnionNodeFactory=Um([Tm(0,Vt)],exports.UnionNodeFactory);class Im extends Ye{constructor(o){super(o)}get nodeType(){return oe.VALUE}execute(){var e,t,r;const o=((e=this.getParent())==null?void 0:e.nodeType)===oe.FUNCTION&&((r=(t=this.getParent())==null?void 0:t.isFunctionExecutorArgumentsIgnoreNumberPattern)==null?void 0:r.call(t));this.setValue(dt.create(this.getToken(),o))}}class Ca extends At{get zIndex(){return Ct.get(oe.VALUE)||_t}_checkValueNode(o){if(Number.isNaN(Number(o))){const e=o.trim(),t=e.charAt(0),r=e.charAt(e.length-1);if(vt.has(e))return this.create(e);if(t==='"'&&r==='"')return this.create(e);if(t==="{"&&r==="}")return this.create(e);const n=e.toUpperCase();if(n===xt.TRUE||n===xt.FALSE)return this.create(n)}else return this.create(o)}create(o){return new Im(o)}checkAndCreateNodeType(o){if(!(o instanceof ie))return this._checkValueNode(o)}}var Fm=Object.getOwnPropertyDescriptor,Bm=(i,o,e,t)=>{for(var r=t>1?void 0:t?Fm(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},rt=(i,o)=>(e,t)=>o(e,t,i);exports.AstTreeBuilder=class extends M.Disposable{constructor(e,t,r,n,s,a,u,c,l,f,m){super();A(this,"_astNodeFactoryList",[]);this._runtimeService=e,this._astRootNodeFactory=t,this._functionNodeFactory=r,this._lambdaNodeFactory=n,this._lambdaParameterNodeFactory=s,this._operatorNodeFactory=a,this._prefixNodeFactory=u,this._referenceNodeFactory=c,this._suffixNodeFactory=l,this._unionNodeFactory=f,this._valueNodeFactory=m,this._initializeAstNode()}dispose(){this._astNodeFactoryList.forEach(e=>{e.dispose()}),this._astNodeFactoryList=[]}parse(e){const t=new ks(Rt),r=this._parse(e,t);return e.hasDefinedNames()&&(r==null||r.setDefinedNames(e.getDefinedNames())),r}_lambdaParameterHandler(e,t){if(t.getLambdaId==null)return Le.create(h.VALUE);const r=t.getLambdaId(),n=new ks(Rt),s=this._runtimeService.getFunctionDefinitionPrivacyVar(r);if(!s)return!1;const a=[...s.keys()],u=e.getChildren(),c=u.length;for(let l=0;l<c;l++){const f=u[l];if(f instanceof ie){ga(f,r,s),this._parse(f,n);const d=n.getChildren()[l];d!=null&&s.set(a[l],d)}else return!1}return n.setParent(t),t}_changeLetToLambda(e){const t=e.getChildren(),r=t.length;if(r%2!==1||r===0)return;const n=new ie;n.setToken(lr);const s=new ie;s.setToken(Xt);const a=[...t];for(let c=0;c<r;c++){const l=a[c];if(!(l instanceof ie))return;c%2===0?l.changeToParent(n):l.changeToParent(s)}n.addChildrenFirst(s),s.setParent(n);const u=e.getParent();return u==null||u.replaceChild(e,n),n}_parse(e,t){var f;const r=e.getChildren(),n=r.length,s=[];let a=null;const u=e.getToken().trim().toUpperCase();if(u===Qi){const m=this._changeLetToLambda(e);return m!=null?this._parse(m,t):Le.create(h.ERROR)}if(u===nt){if(a=t,n===0)return new Vm(Rt).setParent(t),a}else{if(u===Xt){let m=this._lambdaParameterHandler(e,t);return m===!1&&(m=Le.create(h.ERROR)),m}if(a=this._checkAstNode(e),a==null)return Le.create(h.NAME)}const c=r[0];for(let m=0;m<n;m++){const d=r[m];if(Oo(c)){if(m!==0&&m!==n-1)continue}else if(Em(d)&&m!==n-1)continue;let C=null;if(d instanceof ie){if(d.getToken()===nt&&d.getChildren().length===0){const _=(f=d.getParent())==null?void 0:f.getChildren();if(_&&_.length===1)return Le.create(h.NAME)}if(C=this._parse(d,a),C===a)continue}else C=this._checkAstNode(d);if(C==null)return Le.create(h.NAME);if(C=Rm(C),C==null||(C==null?void 0:C.nodeType)===oe.ERROR)return C;switch(C.nodeType){case oe.FUNCTION:{const _=C.getToken().trim().toUpperCase();Jc.has(_)&&C.setForcedCalculateFunction(),s.push(C);break}case oe.LAMBDA:s.push(C);break;case oe.LAMBDA_PARAMETER:s.push(C);break;case oe.OPERATOR:{const _=s.pop(),E=s.pop();E&&E.setParent(C),_&&_.setParent(C),s.push(C);break}case oe.REFERENCE:s.push(C);break;case oe.ROOT:s.push(C);break;case oe.UNION:s.push(C);break;case oe.VALUE:s.push(C);break;case oe.PREFIX:s.push(C);break;case oe.SUFFIX:s.push(C);break}}const l=s.length;for(let m=0;m<l;m++)s[m].setParent(a);return a}_checkAstNode(e){let t=null;const r=this._astNodeFactoryList.length;for(let n=0;n<r&&(t=this._astNodeFactoryList[n].checkAndCreateNodeType(e),t==null);n++);return t==null?new dm:t}_initializeAstNode(){this._astNodeFactoryList=[this._astRootNodeFactory,this._functionNodeFactory,this._lambdaNodeFactory,this._lambdaParameterNodeFactory,this._operatorNodeFactory,this._prefixNodeFactory,this._referenceNodeFactory,this._suffixNodeFactory,this._unionNodeFactory,this._valueNodeFactory].sort(M.sortRules)}};exports.AstTreeBuilder=Bm([rt(0,ut),rt(1,M.Inject(ha)),rt(2,M.Inject(exports.FunctionNodeFactory)),rt(3,M.Inject(exports.LambdaNodeFactory)),rt(4,M.Inject(da)),rt(5,M.Inject(exports.OperatorNodeFactory)),rt(6,M.Inject(exports.PrefixNodeFactory)),rt(7,M.Inject(exports.ReferenceNodeFactory)),rt(8,M.Inject(exports.SuffixNodeFactory)),rt(9,M.Inject(exports.UnionNodeFactory)),rt(10,M.Inject(Ca))],exports.AstTreeBuilder);class Do extends M.Disposable{constructor(){super(...arguments);A(this,"_otherFormulaData",new Map);A(this,"_featureFormulaData",new Map);A(this,"_formulaData",new Map);A(this,"_definedNameMap",new Map);A(this,"_otherFormulaDataMainData",new Set);A(this,"_dependencyRTreeCache",new M.RTree);A(this,"_dependencyTreeIdLast",0)}buildDependencyTree(e,t){throw new Error("Method not implemented.")}getTreeById(e){throw new Error("Method not implemented.")}getAllTree(){throw new Error("Method not implemented.")}reset(){throw new Error("Method not implemented.")}addOtherFormulaDependency(e,t,r,n){throw new Error("Method not implemented.")}removeOtherFormulaDependency(e,t,r){throw new Error("Method not implemented.")}clearOtherFormulaDependency(e,t){throw new Error("Method not implemented.")}addFeatureFormulaDependency(e,t,r,n){throw new Error("Method not implemented.")}removeFeatureFormulaDependency(e,t,r){throw new Error("Method not implemented.")}clearFeatureFormulaDependency(e,t){throw new Error("Method not implemented.")}addFormulaDependency(e,t,r,n,s){throw new Error("Method not implemented.")}removeFormulaDependency(e,t,r,n){throw new Error("Method not implemented.")}clearFormulaDependency(e,t){throw new Error("Method not implemented.")}removeFormulaDependencyByDefinedName(e,t){throw new Error("Method not implemented.")}searchDependency(e,t){return this._dependencyRTreeCache.bulkSearch(e,t)}_restDependencyTreeId(){this._dependencyTreeIdLast=0}getOtherFormulaDependency(e,t,r){var n,s;return(s=(n=this._otherFormulaData.get(e))==null?void 0:n.get(t))==null?void 0:s.get(r)}addOtherFormulaDependencyMainData(e){this._otherFormulaDataMainData.add(e)}hasOtherFormulaDataMainData(e){return this._otherFormulaDataMainData.has(e)}_removeDependencyRTreeCacheById(e,t){this._dependencyRTreeCache.removeById(e,t)}getFeatureFormulaDependency(e,t,r){var n,s;return(s=(n=this._featureFormulaData.get(e))==null?void 0:n.get(t))==null?void 0:s.get(r)}getFormulaDependency(e,t,r,n){var s,a;return(a=(s=this._formulaData.get(e))==null?void 0:s.get(t))==null?void 0:a.getValue(r,n)}addDependencyRTreeCache(e){const t=[];for(let r=0;r<e.rangeList.length;r++){const n=e.rangeList[r],{unitId:s,sheetId:a,range:u}=n;t.push({unitId:s,sheetId:a,range:u,id:e.treeId})}this._dependencyRTreeCache.bulkInsert(t),this._addAllTreeMap(e)}getLastTreeId(){const e=this._dependencyTreeIdLast;return this._dependencyTreeIdLast++,e}_addAllTreeMap(e){throw new Error("Method not implemented.")}_addDefinedName(e,t,r){this._definedNameMap.has(e)||this._definedNameMap.set(e,new Map);const n=this._definedNameMap.get(e);n.has(t)||n.set(t,new Set),n.get(t).add(r)}addFormulaDependencyByDefinedName(e,t){const r=e.treeId,n=(t==null?void 0:t.getDefinedNames())||[];for(const s of n)this._addDefinedName(e.unitId,s,r)}}class wo extends Do{constructor(){super(...arguments);A(this,"_allTreeMap",new Map)}dispose(){super.dispose(),this.reset()}buildDependencyTree(e,t=[]){const r=this.getAllTree();return e.length===0?(this._buildReverseDependency(r,t),r):(this._buildDependencyTree(r,e),this._buildReverseDependency(r,e),r)}_buildDependencyTree(e,t){const r=new Map;for(let n=0;n<t.length;n++){const s=t[n];r.set(s.treeId,s)}for(let n=0;n<e.length;n++){const s=e[n],a=s.toRTreeItem(),u=this._dependencyRTreeCache.bulkSearch(a);for(const c of u){const l=r.get(c);l&&s!==l&&!l.hasChildren(s.treeId)&&l.pushChildren(s)}}r.clear()}_buildReverseDependency(e,t){const r=new Map;for(let n=0;n<e.length;n++){const s=e[n];r.set(s.treeId,s)}for(let n=0;n<t.length;n++){const s=t[n],a=s.toRTreeItem(),u=this._dependencyRTreeCache.bulkSearch(a);for(const c of u){const l=r.get(c);l&&s!==l&&!l.hasChildren(s.treeId)&&l.pushChildren(s)}}r.clear()}getAllTree(){const e=[];return this._allTreeMap.forEach(t=>{t.resetState(),e.push(t)}),e}getTreeById(e){return this._allTreeMap.get(e)}reset(){this._otherFormulaData.clear(),this._featureFormulaData.clear(),this._formulaData.clear(),this._definedNameMap.clear(),this._otherFormulaDataMainData.clear(),this._dependencyRTreeCache.clear(),this._allTreeMap.clear(),this._restDependencyTreeId()}addOtherFormulaDependency(e,t,r,n){this._otherFormulaData.has(e)||this._otherFormulaData.set(e,new Map);const s=this._otherFormulaData.get(e);s.has(t)||s.set(t,new Map);const a=s.get(t);a.has(r)||a.set(r,new M.ObjectMatrix),a.get(r).setValue(n.refOffsetX,n.refOffsetY,n.treeId),this._addAllTreeMap(n)}removeOtherFormulaDependency(e,t,r){const n=this._otherFormulaData.get(e);if(n&&n.has(t)){const s=n.get(t);r.forEach(a=>{const u=s.get(a);u!=null&&(u.forValue((c,l,f)=>{this._removeDependencyRTreeCache(f),this.clearDependencyForTree(this._allTreeMap.get(f)),this._removeAllTreeMap(f)}),s.delete(a),this._otherFormulaDataMainData.delete(a))}),s.size===0&&n.delete(t),n.size===0&&this._otherFormulaData.delete(e)}}clearOtherFormulaDependency(e,t){const r=this._otherFormulaData.get(e);if(t&&r&&r.has(t)){const n=r.get(t);this._removeDependencyRTreeCacheById(e,t);for(const s of n.keys()){const a=n.get(s);a!=null&&(a.forValue((u,c,l)=>{const f=this._allTreeMap.get(l);f&&(this.clearDependencyForTree(f),this._removeAllTreeMap(l))}),this._otherFormulaDataMainData.delete(s))}n.clear()}else if(r){for(const n of r.keys()){const s=r.get(n);this._removeDependencyRTreeCacheById(e,n);for(const a of s.keys()){const u=s.get(a);u!=null&&(u.forValue((c,l,f)=>{const m=this._allTreeMap.get(f);m&&(this.clearDependencyForTree(m),this._removeAllTreeMap(f))}),this._otherFormulaDataMainData.delete(a))}}this._otherFormulaData.delete(e)}}addFeatureFormulaDependency(e,t,r,n){this._featureFormulaData.has(e)||this._featureFormulaData.set(e,new Map);const s=this._featureFormulaData.get(e);s.has(t)||s.set(t,new Map),s.get(t).set(r,n.treeId),this._addAllTreeMap(n)}removeFeatureFormulaDependency(e,t,r){const n=this._featureFormulaData.get(e);if(n&&n.has(t)){const s=n.get(t);r.forEach(a=>{const u=s.get(a);u!=null&&(this._removeDependencyRTreeCache(u),s.delete(a),this.clearDependencyForTree(this._allTreeMap.get(u)),this._removeAllTreeMap(u))})}}clearFeatureFormulaDependency(e,t){const r=this._featureFormulaData.get(e);if(t&&r&&r.has(t)){const n=r.get(t);this._removeDependencyRTreeCacheById(e,t),n.forEach(s=>{s!=null&&(this.clearDependencyForTree(this._allTreeMap.get(s)),this._removeAllTreeMap(s))}),n.clear()}else r&&(r.forEach((n,s)=>{this._removeDependencyRTreeCacheById(e,s),n.forEach(a=>{a!=null&&(this.clearDependencyForTree(this._allTreeMap.get(a)),this._removeAllTreeMap(a))})}),this._featureFormulaData.delete(e))}addFormulaDependency(e,t,r,n,s){this._formulaData.has(e)||this._formulaData.set(e,new Map);const a=this._formulaData.get(e);a.has(t)||a.set(t,new M.ObjectMatrix),a.get(t).setValue(r,n,s.treeId),this._addAllTreeMap(s)}removeFormulaDependency(e,t,r,n){const s=this._formulaData.get(e);if(s&&s.has(t)){const a=s.get(t),u=a.getValue(r,n);if(u==null)return;this._removeDependencyRTreeCache(u),a.realDeleteValue(r,n),this.clearDependencyForTree(this._allTreeMap.get(u)),this._removeAllTreeMap(u)}}clearFormulaDependency(e,t){const r=this._formulaData.get(e);if(t&&r&&r.has(t)){const n=r.get(t);this._removeDependencyRTreeCacheById(e,t),n.forValue((s,a,u)=>{if(u==null)return!0;this.clearDependencyForTree(this._allTreeMap.get(u)),this._removeAllTreeMap(u)}),n.reset()}else r&&(r.forEach((n,s)=>{this._removeDependencyRTreeCacheById(e,s),n.forValue((a,u,c)=>{if(c==null)return!0;this.clearDependencyForTree(this._allTreeMap.get(c)),this._removeAllTreeMap(c)})}),this._formulaData.delete(e))}clearDependencyForTree(e){if(e==null)return;const t=e.parents,r=e.children,n=this._allTreeMap;for(const s of t){const a=n.get(s);a==null||a.children.delete(e.treeId)}for(const s of r){const a=n.get(s);a==null||a.parents.delete(e.treeId)}e.dispose()}_removeDependencyRTreeCache(e){if(e==null)return;const t=this._allTreeMap.get(e);if(t){const r=[];for(let n=0;n<t.rangeList.length;n++){const s=t.rangeList[n],{unitId:a,sheetId:u,range:c}=s;r.push({unitId:a,sheetId:u,range:c,id:e})}this._dependencyRTreeCache.bulkRemove(r)}}removeFormulaDependencyByDefinedName(e,t){const r=this._definedNameMap.get(e);if(r){const n=r.get(t);if(n){for(const s of n)this._removeDependencyRTreeCache(s),this.clearDependencyForTree(this._allTreeMap.get(s)),this._removeAllTreeMap(s);n.clear()}}}_removeAllTreeMap(e){e!=null&&this._allTreeMap.delete(e)}_addAllTreeMap(e){this._allTreeMap.set(e.treeId,e)}}const Ir=M.createIdentifier("univer.formula.dependency-manager.service");class Lo extends M.Disposable{constructor(){super(...arguments);A(this,"_referenceExecutorMap",new Map);A(this,"_onChanged$",new Fe.Subject);A(this,"onChanged$",this._onChanged$.asObservable())}dispose(){super.dispose(),this._referenceExecutorMap.clear(),this._onChanged$.complete()}remove(e,t,r){r.forEach(n=>{var s,a;(a=(s=this._referenceExecutorMap.get(e))==null?void 0:s.get(t))==null||a.delete(n)}),this._onChanged$.next({unitId:e,subUnitId:t,featureIds:r})}get(e,t,r){var n,s;return(s=(n=this._referenceExecutorMap.get(e))==null?void 0:n.get(t))==null?void 0:s.get(r)}has(e,t,r){var n,s;return!!((s=(n=this._referenceExecutorMap.get(e))==null?void 0:n.get(t))!=null&&s.has(r))}register(e,t,r,n){let s=this._referenceExecutorMap.get(e);s||(s=new Map,this._referenceExecutorMap.set(e,s));let a=s.get(t);a||(a=new Map,s.set(t,a)),this._onChanged$.next({unitId:e,subUnitId:t,featureIds:[r]}),a.set(r,n)}getReferenceExecutorMap(){return this._referenceExecutorMap}}const hr=M.createIdentifier("univer.formula.feature-calculation-manager.service");class Po extends M.Disposable{constructor(){super(...arguments);A(this,"_otherFormulaData",{})}dispose(){super.dispose(),this._otherFormulaData={}}remove(e){var s,a,u;const{unitId:t,subUnitId:r,formulaId:n}=e;(u=(a=(s=this._otherFormulaData)==null?void 0:s[t])==null?void 0:a[r])==null||delete u[n]}get(e){var s,a;const{unitId:t,subUnitId:r,formulaId:n}=e;return(a=(s=this._otherFormulaData[t])==null?void 0:s[r])==null?void 0:a[n]}has(e){var s,a;const{unitId:t,subUnitId:r,formulaId:n}=e;return((a=(s=this._otherFormulaData[t])==null?void 0:s[r])==null?void 0:a[n])!=null}register(e){const{unitId:t,subUnitId:r,formulaId:n,item:s}=e;this._otherFormulaData[t]||(this._otherFormulaData[t]={}),this._otherFormulaData[t][r]||(this._otherFormulaData[t][r]={}),this._otherFormulaData[t][r][n]=s}batchRegister(e){Object.keys(e).forEach(t=>{const r=e[t];if(r==null)return!0;Object.keys(r).forEach(n=>{const s=r[n];if(s==null)return!0;Object.keys(s).forEach(a=>{const u=s[a];if(u==null)return!0;this.register({unitId:t,subUnitId:n,formulaId:a,item:u})})})})}batchRemove(e){Object.keys(e).forEach(t=>{const r=e[t];if(r==null)return!0;Object.keys(r).forEach(n=>{const s=r[n];if(s==null)return!0;Object.keys(s).forEach(a=>{this.remove({unitId:t,subUnitId:n,formulaId:a})})})})}getOtherFormulaData(){return this._otherFormulaData}}const ts=M.createIdentifier("univer.formula.other-formula-manager.service");var pn=(i=>(i[i.NORMAL_FORMULA=0]="NORMAL_FORMULA",i[i.OTHER_FORMULA=1]="OTHER_FORMULA",i[i.FEATURE_FORMULA=2]="FEATURE_FORMULA",i))(pn||{});class xo{constructor(){A(this,"_state",0);A(this,"treeId");A(this,"children",new Set);A(this,"parents",new Set)}resetState(){this._state=0}setAdded(){this._state=1}isAdded(){return this._state===1}setSkip(){this._state=2}isSkip(){return this._state===2}pushChildren(o){this.children.add(o.treeId),o._pushParent(this)}hasChildren(o){return this.children.has(o)}_pushParent(o){this.parents.add(o.treeId)}}class Hs extends xo{constructor(){super(...arguments);A(this,"refTree");A(this,"refOffsetX",-1);A(this,"refOffsetY",-1);A(this,"isCache",!1);A(this,"isDirty",!1);A(this,"addressFunctionNodes",[]);A(this,"getDirtyData");A(this,"featureId")}get isVirtual(){return!0}get row(){return this.refTree==null?-1:this.refTree.row+this.refOffsetY}get column(){return this.refTree==null?-1:this.refTree.column+this.refOffsetX}get rowCount(){return this.refTree==null?0:this.refTree.rowCount}get columnCount(){return this.refTree==null?0:this.refTree.columnCount}get unitId(){return this.refTree==null?"":this.refTree.unitId}get subUnitId(){return this.refTree==null?"":this.refTree.subUnitId}get formula(){var e,t;return(t=(e=this.refTree)==null?void 0:e.formula)!=null?t:""}get nodeData(){return{node:this.node,refOffsetX:this.refOffsetX,refOffsetY:this.refOffsetY}}get node(){var e;return(e=this.refTree)==null?void 0:e.node}dispose(){this.refTree=null}get rangeList(){const e=[];if(this.refTree==null)return[];for(let t=0;t<this.refTree.rangeList.length;t++){const r=this.refTree.rangeList[t];e.push({unitId:r.unitId,sheetId:r.sheetId,range:M.moveRangeByOffset(r.range,this.refOffsetX,this.refOffsetY)})}return e}toRTreeItem(){const e=this.row,t=this.column;return[{unitId:this.unitId,sheetId:this.subUnitId,range:{startRow:e,startColumn:t,endRow:e,endColumn:t}}]}inRangeData(e){const t=e.startRow,r=e.startColumn,n=e.endRow,s=e.endColumn,a=this.row,u=this.column;return!(a<t||a>n||u<r||u>s)}dependencySheetName(e){return this.refTree==null?!1:this.refTree.dependencySheetName(e)}isExcludeRange(e){var r;const t=this.rangeList;if(t.length===0)return!1;for(let n=0,s=t.length;n<s;n++){const a=t[n],{unitId:u,sheetId:c,range:l}=a,f=(r=e==null?void 0:e[u])==null?void 0:r[c];let{startRow:m,endRow:d,startColumn:C,endColumn:_}=l;Number.isNaN(m)&&(m=0),Number.isNaN(C)&&(C=0),Number.isNaN(d)&&(d=Number.POSITIVE_INFINITY),Number.isNaN(_)&&(_=Number.POSITIVE_INFINITY);let E=!1;if(f==null||f.forValue((R,b)=>{if(R>=m&&R<=d&&b>=C&&b<=_)return E=!0,!1}),E)return!0}return!1}get formulaId(){return this.refTree==null?"":this.refTree.formulaId}}class un extends xo{constructor(e){super();A(this,"isCache",!1);A(this,"featureId");A(this,"featureDirtyRanges",[]);A(this,"refOffsetX",0);A(this,"refOffsetY",0);A(this,"type",0);A(this,"formulaId");A(this,"subUnitId","");A(this,"unitId","");A(this,"rangeList",[]);A(this,"formula","");A(this,"row",-1);A(this,"column",-1);A(this,"rowCount",Number.NEGATIVE_INFINITY);A(this,"columnCount",Number.NEGATIVE_INFINITY);A(this,"isDirty",!1);A(this,"node");A(this,"addressFunctionNodes",[]);A(this,"getDirtyData");this.treeId=e}get isVirtual(){return!1}get nodeData(){return{node:this.node,refOffsetX:0,refOffsetY:0}}toJson(){return{formula:this.formula,refOffsetX:this.refOffsetX,refOffsetY:this.refOffsetY}}dispose(){this.featureDirtyRanges=[],this.rangeList=[],this.addressFunctionNodes=[],this.getDirtyData=null}inRangeData(e){const t=e.startRow,r=e.startColumn,n=e.endRow,s=e.endColumn,a=this.row,u=this.column;return!(a<t||a>n||u<r||u>s)}dependencySheetName(e){var r;const t=this.rangeList;if(t.length===0||e==null)return!1;for(let n=0,s=t.length;n<s;n++){const a=t[n],{unitId:u,sheetId:c}=a;if(((r=e[u])==null?void 0:r[c])!=null)return!0}return!1}isExcludeRange(e){var r;const t=this.rangeList;if(t.length===0)return!1;for(let n=0,s=t.length;n<s;n++){const a=t[n],{unitId:u,sheetId:c,range:l}=a,f=(r=e==null?void 0:e[u])==null?void 0:r[c];let{startRow:m,endRow:d,startColumn:C,endColumn:_}=l;Number.isNaN(m)&&(m=0),Number.isNaN(C)&&(C=0),Number.isNaN(d)&&(d=Number.POSITIVE_INFINITY),Number.isNaN(_)&&(_=Number.POSITIVE_INFINITY);let E=!1;if(f==null||f.forValue((R,b)=>{if(R>=m&&R<=d&&b>=C&&b<=_)return E=!0,!1}),E)return!0}return!1}pushRangeList(e){this.rangeList.push(...e)}shouldBePushRangeList(){return this.rangeList.length===0&&this.type!==2}toRTreeItem(){if(this.featureId!=null)return this.featureDirtyRanges;const e=this.row,t=this.column;return[{unitId:this.unitId,sheetId:this.subUnitId,range:{startRow:e,startColumn:t,endRow:e,endColumn:t}}]}}var km=Object.getOwnPropertyDescriptor,$m=(i,o,e,t)=>{for(var r=t>1?void 0:t?km(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},Mt=(i,o)=>(e,t)=>o(e,t,i);function $t(i){return i.getLastTreeId()||0}const Nn=M.createIdentifier("engine-formula.dependency-generator");exports.FormulaDependencyGenerator=class extends M.Disposable{constructor(e,t,r,n,s,a,u,c){super();A(this,"_updateRangeFlattenCache",new Map);A(this,"_dependencyRTreeCacheForAddressFunction",new M.RTree);A(this,"_executedAddressFunctionNodeIds",new Set);this._currentConfigService=e,this._runtimeService=t,this._otherFormulaManagerService=r,this._featureCalculationManagerService=n,this._interpreter=s,this._astTreeBuilder=a,this._lexer=u,this._dependencyManagerService=c}dispose(){this._updateRangeFlattenCache.clear(),this._dependencyRTreeCacheForAddressFunction.clear(),Pr.clear()}async generate(){this._updateRangeFlatten();const e=this._currentConfigService.getFormulaData(),t=this._otherFormulaManagerService.getOtherFormulaData(),r=this._currentConfigService.getClearDependencyTreeCache();r!=null&&Object.keys(r).forEach(f=>{f!=null&&Object.keys(r[f]).forEach(m=>{m!=null&&(this._dependencyManagerService.clearOtherFormulaDependency(f,m),this._dependencyManagerService.clearFeatureFormulaDependency(f,m),this._dependencyManagerService.clearFormulaDependency(f,m))})});const n=this._currentConfigService.getUnitData(),s=await this._generateTreeList(e,t,n),a=this._getUpdateTreeListAndMakeDependency(s);let u=this._calculateRunList(a);return this._dependencyFeatureCalculation(u)&&(u.forEach(f=>{f.resetState()}),u=this._calculateRunList(u)),this._checkIsCycleDependency(u)&&this._runtimeService.enableCycleDependency(),this._dependencyRTreeCacheForAddressFunction.clear(),this._runtimeService.clearArrayObjectCache(),Promise.resolve(u)}_dependencyFeatureCalculation(e){const t=this._featureCalculationManagerService.getReferenceExecutorMap();if(t.size===0)return;this._clearFeatureCalculationNode(e);let r=!1;return t.forEach((n,s)=>{n.forEach((a,u)=>{a.forEach((c,l)=>{const{unitId:f,subUnitId:m,getDirtyData:d}=c,C=d(this._currentConfigService.getDirtyData(),this._runtimeService.getAllRuntimeData()),_=this._convertDirtyRangesToUnitRange(C.dirtyRanges),E=this._intersectFeatureCalculation(_,e,{unitId:f,subUnitId:m,featureId:l});if(E.length>0){let R=this._getExistTreeList({unitId:f,subUnitId:m,featureId:l},e);R==null&&(R=this._getFeatureFormulaTree(l,$t(this._dependencyManagerService),c),e.push(R)),R.parents=new Set,E.forEach(b=>{b.hasChildren(R.treeId)||b.pushChildren(R)}),r=!0}})})}),r}_clearFeatureCalculationNode(e){const t=this._featureCalculationManagerService.getReferenceExecutorMap();e.forEach(r=>{var a,u,c,l;const n=new Set;for(const f of r.children){const m=this._dependencyManagerService.getTreeById(f);m&&(m.featureId&&(u=(a=t.get(r.unitId))==null?void 0:a.get(r.subUnitId))!=null&&u.has(m.featureId)||n.add(f))}r.children=n;const s=new Set;for(const f of r.parents){const m=this._dependencyManagerService.getTreeById(f);m&&(m.featureId&&(l=(c=t.get(r.unitId))==null?void 0:c.get(r.subUnitId))!=null&&l.has(m.featureId)||s.add(f))}r.parents=s})}_convertDirtyRangesToUnitRange(e){const t=[];for(const r in e){const n=e[r];for(const s in n){const a=n[s];for(const u of a)t.push({unitId:r,sheetId:s,range:u})}}return t}_intersectFeatureCalculation(e,t,r){const n=[],s=this._dependencyManagerService.searchDependency(e);for(let a=0,u=t.length;a<u;a++){const c=t[a];if(c.unitId===r.unitId&&c.subUnitId===r.subUnitId&&c.featureId===r.featureId)continue;s.has(c.treeId)&&n.push(c)}return n}_getExistTreeList(e,t){const{unitId:r,subUnitId:n,featureId:s}=e;for(let a=0,u=t.length;a<u;a++){const c=t[a];if(c.unitId===r&&c.subUnitId===n&&c.featureId===s)return c}}_isCyclicUtil(e,t,r){const n=this._dependencyManagerService.getTreeById(e);if(n==null)return!1;if(!t.has(n.treeId)){t.add(n.treeId),r.add(n.treeId);for(const s of n.children)if(!t.has(s)&&this._isCyclicUtil(s,t,r)||r.has(s))return!0}return r.delete(n.treeId),!1}_checkIsCycleDependency(e){const t=new Set,r=new Set;for(let n=0,s=e.length;n<s;n++){const a=e[n];if(this._isCyclicUtil(a.treeId,t,r)===!0)return!0}return!1}async _generateTreeList(e,t,r){const n=Object.keys(e),s=Object.keys(t),a=[];this._currentConfigService.isForceCalculate()&&this._dependencyManagerService.reset(),this._registerFormulas(n,e,r,a),this._registerOtherFormulas(t,s,a),this._registerFeatureFormulas(a);for(let c=0,l=a.length;c<l;c++){const f=a[c];if(!f.formula)continue;const m=this._getTreeNode(f);f.isDirty=this._includeTree(f,m);const d=this._getAddressFunctionNodeList(m);if(d.length>0&&(f.addressFunctionNodes=d),f.isVirtual)continue;this._runtimeService.setCurrent(f.row,f.column,f.rowCount,f.columnCount,f.subUnitId,f.unitId);const C=await this._getRangeListByNode({node:m,refOffsetX:f.refOffsetX,refOffsetY:f.refOffsetY});f.pushRangeList(C)}for(let c=0,l=a.length;c<l;c++){const f=a[c];f.isCache||this._dependencyManagerService.addDependencyRTreeCache(f)}return await this._calculateListByFunctionRefNode(a),a}_registerFeatureFormulas(e){this._featureCalculationManagerService.getReferenceExecutorMap().forEach((r,n)=>{r.forEach((s,a)=>{s.forEach((u,c)=>{const l=this._dependencyManagerService.getFeatureFormulaDependency(u.unitId,u.subUnitId,c);e.push(this._getFeatureFormulaTree(c,l,u))})})})}_getFeatureFormulaTree(e,t,r){const{unitId:n,subUnitId:s,dependencyRanges:a,getDirtyData:u}=r,c=t||$t(this._dependencyManagerService),l=new un(c);l.unitId=n,l.subUnitId=s,l.rangeList=a,l.getDirtyData=u;const f=u(this._currentConfigService.getDirtyData(),this._runtimeService.getAllRuntimeData()),m=this._convertDirtyRangesToUnitRange(f.dirtyRanges);return l.featureDirtyRanges=m,l.featureId=e,l.type=pn.FEATURE_FORMULA,this._dependencyManagerService.addFeatureFormulaDependency(n,s,e,l),this._dependencyManagerService.getFeatureFormulaDependency(r.unitId,r.subUnitId,e)&&(l.isCache=!0),l}_registerOtherFormulas(e,t,r){for(const n of t){const s=e[n];if(s==null)continue;const a=Object.keys(s);for(const u of a){const c=s[u];if(c==null)continue;const l=Object.keys(c);for(const f of l){const m=this._dependencyManagerService.hasOtherFormulaDataMainData(f),d=c[f],{f:C,ranges:_}=d;let E=!1;m&&(E=!0);const R=$s(n,C,this._lexer,this._astTreeBuilder,this._currentConfigService),{firstRow:b,firstColumn:p}=this._getFirstCellOfRange(_),V=this._dependencyManagerService.getOtherFormulaDependency(n,u,f),S=(V==null?void 0:V.getValue(0,0))||$t(this._dependencyManagerService),D=new un(S);for(let w=0;w<_.length;w++){const L=_[w],{startRow:P,startColumn:v,endRow:U,endColumn:$}=L;for(let W=P;W<=U;W++)for(let re=v;re<=$;re++){const J=re-p,H=W-b;if(J===0&&H===0){D.node=R,D.formula=C,D.unitId=n,D.subUnitId=u,D.formulaId=f,D.type=pn.OTHER_FORMULA,D.isCache=E,r.push(D),this._dependencyManagerService.addOtherFormulaDependency(n,u,f,D),this._dependencyManagerService.addFormulaDependencyByDefinedName(D);continue}const le=new Hs;le.treeId=(V==null?void 0:V.getValue(J,H))||$t(this._dependencyManagerService),le.refTree=D,le.refOffsetX=J,le.refOffsetY=H,le.isCache=E,this._dependencyManagerService.addOtherFormulaDependency(n,u,f,le),this._dependencyManagerService.addFormulaDependencyByDefinedName(le),r.push(le)}}this._dependencyManagerService.addOtherFormulaDependencyMainData(f)}}}}_getFirstCellOfRange(e){const t=e[0];return{firstRow:t.startRow,firstColumn:t.startColumn}}_registerFormulas(e,t,r,n){for(const s of e){const a=t[s];if(a==null)continue;const u=Object.keys(a);for(const c of u){const l=new M.ObjectMatrix(a[c]||{}),f=new Map;l.forValue((m,d,C)=>{if(C==null)return!0;const{x:_=0,y:E=0,si:R}=C;if(!(_===0&&E===0&&R!=null))return!0;const b=this._createFDtree(s,c,m,d,r,C),p=this._dependencyManagerService.getFormulaDependency(s,c,m,d);p!=null?(b.treeId=p,b.isCache=!0):(this._dependencyManagerService.addFormulaDependency(s,c,m,d,b),this._dependencyManagerService.addFormulaDependencyByDefinedName(b)),f.set(R,b),n.push(b)}),l.forValue((m,d,C)=>{if(C==null)return!0;const{x:_=0,y:E=0,si:R}=C;if(_===0&&E===0&&R!=null)return!0;let b;if(R&&f.has(R)){const V=f.get(R);b=this._createVirtualFDtree(V,C)}else b=this._createFDtree(s,c,m,d,r,C);const p=this._dependencyManagerService.getFormulaDependency(s,c,m,d);p!=null?(b.treeId=p,b.isCache=!0):(this._dependencyManagerService.addFormulaDependency(s,c,m,d,b),this._dependencyManagerService.addFormulaDependencyByDefinedName(b)),n.push(b)}),f.clear()}}}_createFDtree(e,t,r,n,s,a){const{f:u,x:c=0,y:l=0}=a,f=new un($t(this._dependencyManagerService)),m=s[e][t],d=$s(e,u,this._lexer,this._astTreeBuilder,this._currentConfigService);return f.node=d,f.formula=u,f.unitId=e,f.subUnitId=t,f.row=r,f.column=n,f.rowCount=m.rowCount,f.columnCount=m.columnCount,f}_createVirtualFDtree(e,t){const{x:r=0,y:n=0}=t,s=new Hs;return s.treeId=$t(this._dependencyManagerService),s.refTree=e,s.refOffsetX=r,s.refOffsetY=n,s}_updateRangeFlatten(){const e=this._currentConfigService.isForceCalculate(),t=this._currentConfigService.getDirtyRanges();if(!e){this._updateRangeFlattenCache.clear();for(let r=0;r<t.length;r++){const n=t[r],s=n.range,a=n.sheetId,u=n.unitId;this._addFlattenCache(u,a,s)}}}_addFlattenCache(e,t,r){let n=this._updateRangeFlattenCache.get(e);n==null&&(n=new Map,this._updateRangeFlattenCache.set(e,n));let s=n.get(t);s==null&&(s=[],n.set(t,s)),s.push(r)}_isPreCalculateNode(e){return e.nodeType===oe.UNION||e.nodeType===oe.PREFIX&&e.getToken()===Se.AT||e.nodeType===oe.SUFFIX&&e.getToken()===Xe.POUND}_nodeTraversalRef(e,t){const r=e.getChildren(),n=r.length;for(let s=0;s<n;s++){const a=r[s];if(this._isPreCalculateNode(a)){if(t.push(a),a.nodeType===oe.UNION)for(const u of a.getChildren())u.nodeType===oe.FUNCTION&&u.isAddress()&&this._nodeTraversalRef(u,t);continue}else a.nodeType===oe.REFERENCE&&t.push(a);this._nodeTraversalRef(a,t)}}_nodeTraversalReferenceFunction(e,t){const r=e.getChildren(),n=r.length;for(let s=0;s<n;s++){const a=r[s];if(a.nodeType===oe.FUNCTION&&a.isAddress()){t.push(a);continue}this._nodeTraversalReferenceFunction(a,t)}}async _executeNode(e,t=0,r=0){let n;const s={node:e,refOffsetX:t,refOffsetY:r};return this._interpreter.checkAsyncNode(e)?n=await this._interpreter.executeAsync(s):n=this._interpreter.execute(s),n}async _getRangeListByNode(e){const t=[],r=e.refOffsetX,n=e.refOffsetY,s=e.node;if(s==null)return[];this._nodeTraversalRef(s,t);const a=[];for(let u=0,c=t.length;u<c;u++){const l=t[u],m=(await this._executeNode(l,r,n)).toUnitRange();a.push(m),l.setValue(null)}return a}_getAddressFunctionNodeList(e){const t=[];return e==null?[]:(this._nodeTraversalReferenceFunction(e,t),t)}_getTreeNode(e){return e.node}async _buildDirtyRangesByAddressFunction(e,t){const r=t.addressFunctionNodes;if(r.length===0)return;const n=t.refOffsetX,s=t.refOffsetY,a=await this._getRangeListByFunctionRefNode(r,n,s);t.addressFunctionNodes=[],this._addDependencyTreeByAddressFunction(t,a);const u=e.bulkSearch(a),c=this._buildTreeNodeById(u);c.length!==0&&await this._calculateAddressFunctionRuntimeData(e,c)}async _calculateListByFunctionRefNode(e){const t=new M.RTree;for(let r=0,n=e.length;r<n;r++){const s=e[r];t.insert({unitId:s.unitId,sheetId:s.subUnitId,range:{startRow:s.row,startColumn:s.column,endRow:s.row,endColumn:s.column},id:s.treeId})}this._executedAddressFunctionNodeIds.clear();for(let r=0,n=e.length;r<n;r++){const s=e[r];await this._calculateAddressFunction(t,s)}}async _calculateAddressFunction(e,t){const r=t.addressFunctionNodes;if(r.length===0)return;const n=t.refOffsetX,s=t.refOffsetY;this._runtimeService.setCurrent(t.row,t.column,t.rowCount,t.columnCount,t.subUnitId,t.unitId);const a=[];for(let l=0,f=r.length;l<f;l++){const m=await this._getRangeListByNode({node:r[l],refOffsetX:n,refOffsetY:s});a.push(...m)}const u=new Set;this._searchDependencyByAddressFunction(e,a,u);const c=this._buildTreeNodeById(u);if(c.length===0){await this._buildDirtyRangesByAddressFunction(e,t);return}await this._calculateAddressFunctionRuntimeData(e,c),await this._buildDirtyRangesByAddressFunction(e,t)}async _calculateAddressFunctionRuntimeData(e,t){for(;t.length>0;){const r=t.pop(),s={node:this._getTreeNode(r),refOffsetX:r.refOffsetX,refOffsetY:r.refOffsetY};await this._calculateAddressFunction(e,r),this._runtimeService.setCurrent(r.row,r.column,r.rowCount,r.columnCount,r.subUnitId,r.unitId);let a;this._interpreter.checkAsyncNode(s.node)?a=await this._interpreter.executeAsync(s):a=this._interpreter.execute(s),r.formulaId!=null?this._runtimeService.setRuntimeOtherData(r.formulaId,r.refOffsetX,r.refOffsetY,a):this._runtimeService.setRuntimeData(a)}}_buildTreeNodeById(e){const t=[];for(const r of e){const n=this._getTreeById(r);!n||this._executedAddressFunctionNodeIds.has(r)||(this._executedAddressFunctionNodeIds.add(r),t.push(n))}return t}_searchDependencyByAddressFunction(e,t,r){const n=e.bulkSearch(t),s=this._dependencyRTreeCacheForAddressFunction.bulkSearch(t);for(const u of s)r.has(u)||r.add(u);const a=[];for(const u of n){const c=this._getTreeById(u);c&&!r.has(u)&&(a.push(...c.rangeList),r.add(u))}return a.length>0&&this._searchDependencyByAddressFunction(e,a,r),r}_getTreeById(e){return this._dependencyManagerService.getTreeById(e)}_addDependencyTreeByAddressFunction(e,t){const r=[];for(let n=0;n<t.length;n++){const s=t[n],{unitId:a,sheetId:u,range:c}=s;r.push({unitId:a,sheetId:u,range:c,id:e.treeId})}this._dependencyRTreeCacheForAddressFunction.bulkInsert(r)}async _getRangeListByFunctionRefNode(e,t,r){const n=[];for(let s=0,a=e.length;s<a;s++){const u=e[s],l=(await this._executeNode(u,t,r)).toUnitRange();n.push(l),u.setValue(null)}return n}_getUpdateTreeListAndMakeDependency(e){const t=[],r=new Set,n=this._currentConfigService.isForceCalculate(),s=this._currentConfigService.getDirtyRanges(),a=this._dependencyManagerService.searchDependency(s),u=this._dependencyRTreeCacheForAddressFunction.bulkSearch(s);for(const l of u)a.add(l);const c=this._dependencyManagerService.buildDependencyTree(e);for(const l of c){const f=l.treeId;(n||l.isDirty||l.dependencySheetName(this._currentConfigService.getDirtyNameMap())||a.has(f)&&!l.isExcludeRange(this._currentConfigService.getExcludedRange()))&&!r.has(f)&&(t.push(l),r.add(f))}return t}_includeTreeFeature(e){var s,a;const t=e.unitId,r=e.subUnitId,n=e.featureId;if(n!=null){const u=this._currentConfigService.getDirtyUnitFeatureMap();if(((a=(s=u==null?void 0:u[t])==null?void 0:s[r])==null?void 0:a[n])!=null)return!0}return!1}_includeOtherFormula(e){var s,a;const t=e.unitId,r=e.subUnitId,n=e.formulaId;if(n!=null){const u=this._currentConfigService.getDirtyUnitOtherFormulaMap();if(((a=(s=u==null?void 0:u[t])==null?void 0:s[r])==null?void 0:a[n])!=null)return!0}return!1}_detectForcedRecalculationNode(e,t){return t==null?!1:this._detectForcedRecalculationNodeRecursion(t)}_detectForcedRecalculationNodeRecursion(e){if(e.isForcedCalculateFunction())return!0;const t=e.getChildren();for(let r=0,n=t.length;r<n;r++){const s=t[r];if(this._detectForcedRecalculationNodeRecursion(s))return!0}return!1}_includeTree(e,t){var l,f,m;const r=e.unitId,n=e.subUnitId;if(this._detectForcedRecalculationNode(e,t)===!0||this._includeTreeFeature(e)===!0||this._includeOtherFormula(e)===!0||cm(e,t,this._currentConfigService)===!0)return!0;const s=(f=(l=this._currentConfigService.getExcludedRange())==null?void 0:l[r])==null?void 0:f[n];if((s==null?void 0:s.getValue(e.row,e.column))!=null)return!1;if(((m=this._currentConfigService.getDirtyNameMap()[r])==null?void 0:m[n])!=null)return!0;if(!this._updateRangeFlattenCache.has(r))return!1;const u=this._updateRangeFlattenCache.get(r);if(!u.has(n))return!1;const c=u.get(n);for(const d of c)if(e.inRangeData(d))return!0;return!1}_calculateRunList(e){e.length;const t=e,r=[],n=[];for(;t.length>0;){const s=t.pop();if(s===void 0||s.isSkip())continue;if(s.isAdded()){r.push(s),s.setSkip();continue}n.length=0;for(const u of s.parents){const c=this._dependencyManagerService.getTreeById(u);if(!c)throw new Error("ParentDependencyTree object is null");c.isAdded()||s.isSkip()||n.push(c)}const a=this._dependencyRTreeCacheForAddressFunction.bulkSearch(s.toRTreeItem());for(const u of a){const c=this._dependencyManagerService.getTreeById(u);if(!c)throw new Error("ParentDependencyTree object is null");c.isAdded()||s.isSkip()||n.push(c)}n.length===0?(r.push(s),s.setSkip()):(s.setAdded(),t.push(s,...n))}return r}};exports.FormulaDependencyGenerator=$m([Mt(0,pt),Mt(1,ut),Mt(2,ts),Mt(3,hr),Mt(4,M.Inject(exports.Interpreter)),Mt(5,M.Inject(exports.AstTreeBuilder)),Mt(6,M.Inject(exports.Lexer)),Mt(7,Ir)],exports.FormulaDependencyGenerator);var Ym=Object.getOwnPropertyDescriptor,Hm=(i,o,e,t)=>{for(var r=t>1?void 0:t?Ym(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},Bt=(i,o)=>(e,t)=>o(e,t,i);const jo=500,Vn=M.createIdentifier("engine-formula.calculate-formula.service");exports.CalculateFormulaService=class extends M.Disposable{constructor(e,t,r,n,s,a,u){super();A(this,"_executionInProgressListener$",new Fe.Subject);A(this,"executionInProgressListener$",this._executionInProgressListener$.asObservable());A(this,"_executionCompleteListener$",new Fe.Subject);A(this,"executionCompleteListener$",this._executionCompleteListener$.asObservable());A(this,"_executeLock",new M.AsyncLock);this._configService=e,this._lexer=t,this._currentConfigService=r,this._runtimeService=n,this._formulaDependencyGenerator=s,this._interpreter=a,this._astTreeBuilder=u}dispose(){super.dispose(),this._executionInProgressListener$.complete(),this._executionCompleteListener$.complete(),or.clear(),Ge.clear(),xs.clear(),Fs.clear()}stopFormulaExecution(){this._runtimeService.stopExecution()}setRuntimeFeatureCellData(e,t){this._runtimeService.setRuntimeFeatureCellData(e,t)}setRuntimeFeatureRange(e,t){this._runtimeService.setRuntimeFeatureRange(e,t)}async execute(e){this._runtimeService.setFormulaExecuteStage(He.START),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState()),this._currentConfigService.load(e),this._runtimeService.reset();const t=e.maxIteration||so;this._executeLock.acquire("FORMULA_EXECUTION_LOCK",async()=>{for(let r=0;r<t&&(this._runtimeService.setFormulaCycleIndex(r),await this._executeStep(),or.clear(),!!this._runtimeService.isCycleDependency());r++);this._runtimeService.setFormulaExecuteStage(He.CALCULATION_COMPLETED),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState()),this._executionCompleteListener$.next(this._runtimeService.getAllRuntimeData()),Ge.clear(),this._runtimeService.reset()})}async _executeStep(){const e=await this._apply();if(e==null)return;const{arrayFormulaRange:t,runtimeFeatureRange:r}=e,{dirtyRanges:n,excludedCell:s}=this._getArrayFormulaDirtyRangeAndExcludedRange(t,r);return n==null||n.length===0||(or.clear(),this._currentConfigService.loadDirtyRangesAndExcludedCell(n,s),await this._apply(!0)),!0}_getArrayFormulaDirtyRangeAndExcludedRange(e,t){const r=[],n={};return Object.keys(e).forEach(s=>{const a=e[s];if(a==null)return!0;Object.keys(a).forEach(u=>{const c=new M.ObjectMatrix(a[u]);if(c==null)return!0;const l=new M.ObjectMatrix;c.forValue((f,m,d)=>{l.setValue(f,m,!0),r.push({unitId:s,sheetId:u,range:d})}),n[s]==null&&(n[s]={}),n[s][u]=l})}),Object.keys(t).forEach(s=>{const a=t[s];Object.keys(a).forEach(u=>{const c=a[u];if(c==null)return!0;Object.keys(c).forEach(l=>{const f=c[l];if(f==null)return!0;for(const m of f)r.push({unitId:u,sheetId:l,range:m})})})}),{dirtyRanges:r,excludedCell:n}}async _apply(e=!1){var c;e?this._runtimeService.setFormulaExecuteStage(He.START_DEPENDENCY_ARRAY_FORMULA):this._runtimeService.setFormulaExecuteStage(He.START_DEPENDENCY),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState());const t=(await this._formulaDependencyGenerator.generate()).reverse(),r=this._interpreter;e?(this._runtimeService.setFormulaExecuteStage(He.START_CALCULATION_ARRAY_FORMULA),this._runtimeService.setTotalArrayFormulasToCalculate(t.length)):(this._runtimeService.setFormulaExecuteStage(He.START_CALCULATION),this._runtimeService.setTotalFormulasToCalculate(t.length)),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState());let n=[];const s=this._configService.getConfig(Hn),a=(s==null?void 0:s.intervalCount)||jo,u=t.length;for(let l=0;l<u;l++){const f=t[l],m=f.nodeData,d=f.getDirtyData;if(l%a===0&&(await new Promise(_=>{const E=M.requestImmediateMacroTask(_);n.push(E)}),e?(this._runtimeService.setFormulaExecuteStage(He.CURRENTLY_CALCULATING_ARRAY_FORMULA),this._runtimeService.setCompletedArrayFormulasCount(l+1)):(this._runtimeService.setFormulaExecuteStage(He.CURRENTLY_CALCULATING),this._runtimeService.setCompletedFormulasCount(l+1)),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState()),this._runtimeService.isStopExecution()||m==null&&d==null)){this._runtimeService.setFormulaExecuteStage(He.IDLE),this._runtimeService.markedAsStopFunctionsExecuted(),this._executionCompleteListener$.next(this._runtimeService.getAllRuntimeData());return}this._runtimeService.setCurrent(f.row,f.column,f.rowCount,f.columnCount,f.subUnitId,f.unitId);let C;if(d!=null&&f.featureId!=null){const{runtimeCellData:_,dirtyRanges:E}=d(this._currentConfigService.getDirtyData(),this._runtimeService.getAllRuntimeData());this._runtimeService.setRuntimeFeatureCellData(f.featureId,_),this._runtimeService.setRuntimeFeatureRange(f.featureId,E)}else m!=null&&(r.checkAsyncNode(m.node)?C=await r.executeAsync(m):C=r.execute(m),f.formulaId!=null?this._runtimeService.setRuntimeOtherData(f.formulaId,f.refOffsetX,f.refOffsetY,C):this._runtimeService.setRuntimeData(C));(c=m.node)==null||c.resetCalculationState()}return n.forEach(l=>l()),n=[],u>0?this._runtimeService.markedAsSuccessfullyExecuted():e||this._runtimeService.markedAsNoFunctionsExecuted(),this._runtimeService.getAllRuntimeData()}calculate(e,t=!0){const r=this._lexer.treeBuilder(e,t);if(Object.values(h).includes(r))return Le.create(r);const n=this._astTreeBuilder.parse(r);n==null||n.serialize()}};exports.CalculateFormulaService=Hm([Bt(0,M.IConfigService),Bt(1,M.Inject(exports.Lexer)),Bt(2,pt),Bt(3,ut),Bt(4,Nn),Bt(5,M.Inject(exports.Interpreter)),Bt(6,M.Inject(exports.AstTreeBuilder))],exports.CalculateFormulaService);var Gm=Object.getOwnPropertyDescriptor,Wm=(i,o,e,t)=>{for(var r=t>1?void 0:t?Gm(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},As=(i,o)=>(e,t)=>o(e,t,i);exports.CalculateController=class extends M.Disposable{constructor(o,e,t){super(),this._commandService=o,this._calculateFormulaService=e,this._formulaDataModel=t,this._initialize()}_initialize(){this._commandExecutedListener(),this._initialExecuteFormulaListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(o=>{if(o.id===zs.id)this._calculateFormulaService.stopFormulaExecution();else if(o.id===Zs.id)this._calculate(o.params);else if(o.id===gn.id){const e=o.params;if(e==null)return;const{arrayFormulaRange:t,arrayFormulaCellData:r}=e;this._formulaDataModel.setArrayFormulaRange(t),this._formulaDataModel.setArrayFormulaCellData(r)}}))}async _calculate(o){const{forceCalculation:e=!1,dirtyRanges:t=[],dirtyNameMap:r={},dirtyDefinedNameMap:n={},dirtyUnitFeatureMap:s={},dirtyUnitOtherFormulaMap:a={},clearDependencyTreeCache:u={},maxIteration:c=so,rowData:l}=o,f=this._formulaDataModel.getFormulaData(),m=this._formulaDataModel.getArrayFormulaCellData(),d=this._formulaDataModel.getArrayFormulaRange();this._calculateFormulaService.execute({formulaData:f,arrayFormulaCellData:m,arrayFormulaRange:d,forceCalculate:e,dirtyRanges:t,dirtyNameMap:r,dirtyDefinedNameMap:n,dirtyUnitFeatureMap:s,dirtyUnitOtherFormulaMap:a,clearDependencyTreeCache:u,maxIteration:c,rowData:l})}_initialExecuteFormulaListener(){this._calculateFormulaService.executionCompleteListener$.subscribe(o=>{const e=o.functionsExecutedState;switch(e){case ir.NOT_EXECUTED:break;case ir.STOP_EXECUTION:break;case ir.SUCCESS:this._applyResult(o);break;case ir.INITIAL:break}this._commandService.executeCommand(Sr.id,{functionsExecutedState:e},{onlyLocal:!0})}),this._calculateFormulaService.executionInProgressListener$.subscribe(o=>{this._commandService.executeCommand(Sr.id,{stageInfo:o},{onlyLocal:!0})})}async _applyResult(o){const{unitData:e,unitOtherData:t,arrayFormulaRange:r,arrayFormulaCellData:n,clearArrayFormulaCellData:s,arrayFormulaEmbedded:a,imageFormulaData:u}=o;if(!e){console.error("No sheetData from Formula Engine!");return}(r||a)&&(this._formulaDataModel.clearPreviousArrayFormulaCellData(s),this._formulaDataModel.mergeArrayFormulaCellData(n),this._formulaDataModel.mergeArrayFormulaRange(r),this._commandService.executeCommand(gn.id,{arrayFormulaRange:this._formulaDataModel.getArrayFormulaRange(),arrayFormulaCellData:this._formulaDataModel.getArrayFormulaCellData(),arrayFormulaEmbedded:a},{onlyLocal:!0})),u&&u.length>0&&this._commandService.executeCommand(ta.id,{imageFormulaData:u},{onlyLocal:!0}),this._commandService.executeCommand(Js.id,{unitData:Zc(e),unitOtherData:t},{onlyLocal:!0})}};exports.CalculateController=Wm([As(0,M.ICommandService),As(1,Vn),As(2,M.Inject(exports.FormulaDataModel))],exports.CalculateController);const Ei=/[\[\]]/g;function Ri(i,o){if(Ei.test(i)){const e=Number(i.replace(Ei,""));return o+e}return Number(i)-1}function Es(i,o=0,e=0){i=i.toLocaleUpperCase();const t=i.split(/[RC]/),r=t[1],n=t[2],s=Ri(r,o),a=Ri(n,e);return{row:s,column:a,absoluteRefType:M.AbsoluteRefType.NONE}}function Uo(i,o=0,e=0){const{refBody:t,sheetName:r,unitId:n}=In(i),s=t.indexOf(":");if(s===-1){const _=Es(t,o,e),E=_.row,R=_.column,b=_.absoluteRefType;return{unitId:n,sheetName:r,range:{startRow:E,startColumn:R,endRow:E,endColumn:R,startAbsoluteRefType:b,endAbsoluteRefType:b}}}const a=t.substring(0,s),u=t.substring(s+1),c=Es(a,o,e),l=Es(u,o,e),f=c.row,m=c.column,d=l.row,C=l.column;return{unitId:n,sheetName:r,range:{startRow:f,startColumn:m,endRow:d,endColumn:C,startAbsoluteRefType:c.absoluteRefType,endAbsoluteRefType:l.absoluteRefType}}}function Qm(i){const o=Xr(i.startRow,i.startAbsoluteRefType,!0),e=Xr(i.startColumn,i.startAbsoluteRefType,!1),t=Xr(i.endRow,i.endAbsoluteRefType,!0),r=Xr(i.endColumn,i.endAbsoluteRefType,!1);return o===t&&e===r?`R${o}C${e}`:`R${o}C${e}:R${t}C${r}`}function Xr(i,o=M.AbsoluteRefType.ALL,e){switch(i+=1,o){case M.AbsoluteRefType.ALL:return`${i}`;case M.AbsoluteRefType.ROW:return e?`${i}`:`[${i}]`;case M.AbsoluteRefType.COLUMN:return e?`[${i}]`:`${i}`;case M.AbsoluteRefType.NONE:return`[${i}]`}}function Gt(i){let o=i;if(i.isArray()){const e=i.getRowCount(),t=i.getColumnCount();if(e>1||t>1)return g.create(h.VALUE);o=i.get(0,0)}return o.isError(),o}function Fr(...i){for(let o=0;o<i.length;o++){const e=Gt(i[o]);if(e.isError())return{isError:!0,errorObject:e};i[o]=e}return{isError:!1,variants:i}}function Q(...i){for(let o=0;o<i.length;o++){const e=Gt(i[o]);if(e.isError())return{isError:!0,errorObject:e};if(e.isBoolean())return{isError:!0,errorObject:g.create(h.VALUE)};i[o]=e}return{isError:!1,variants:i}}function Ie(...i){for(let o=0;o<i.length;o++){let e=i[o];if(e.isError())return{isError:!0,errorObject:e};if(e.isNull())return{isError:!0,errorObject:g.create(h.NA)};if(e=Gt(i[o]),e.isError())return{isError:!0,errorObject:e};if(e.isBoolean())return{isError:!0,errorObject:g.create(h.VALUE)};i[o]=e}return{isError:!1,variants:i}}function F(...i){for(let o=0;o<i.length;o++){let e=i[o];if(e.isString()&&(e=e.convertToNumberObjectValue()),e.isError())return{isError:!0,errorObject:e};i[o]=e}return{isError:!1,variants:i}}class N{constructor(o){A(this,"_unitId");A(this,"_subUnitId");A(this,"_row",-1);A(this,"_column",-1);A(this,"_definedNames");A(this,"_locale");A(this,"_sheetOrder");A(this,"_sheetNameMap");A(this,"_formulaDataModel");A(this,"_rowCount",-1);A(this,"_columnCount",-1);A(this,"needsExpandParams",!1);A(this,"needsReferenceObject",!1);A(this,"needsLocale",!1);A(this,"needsSheetsInfo",!1);A(this,"needsFormulaDataModel",!1);A(this,"needsSheetRowColumnCount",!1);A(this,"needsFilteredOutRows",!1);A(this,"minParams",-1);A(this,"maxParams",-1);this._name=o}get name(){return this._name}get unitId(){return this._unitId}get subUnitId(){return this._subUnitId}get row(){return this._row}get column(){return this._column}dispose(){}getDefinedName(o){var t;const e=this._definedNames;return e==null?null:(t=Array.from(Object.values(e)).filter(r=>r.name===o))==null?void 0:t[0]}setDefinedNames(o){this._definedNames=o}getLocale(){return this._locale}setLocale(o){this._locale=o}getSheetsInfo(){return{sheetOrder:this._sheetOrder,sheetNameMap:this._sheetNameMap}}setSheetsInfo({sheetOrder:o,sheetNameMap:e}){this._sheetOrder=o,this._sheetNameMap=e}setFormulaDataModel(o){this._formulaDataModel=o}setSheetRowColumnCount(o,e){this._rowCount=o,this._columnCount=e}isAsync(){return!1}isAddress(){return!1}isCustom(){return!1}isArgumentsIgnoreNumberPattern(){return!1}setRefInfo(o,e,t,r){this._unitId=o,this._subUnitId=e,this._row=t,this._column=r}calculateCustom(...o){return null}calculate(...o){return g.create(h.VALUE)}checkArrayType(o){return o.isReferenceObject()||o.isValueObject()&&o.isArray()}getIndexNumValue(o,e=1){let t=o;if(t.isArray()&&(t=t.getFirstCell()),t.isBoolean())return t.getValue()===!1?g.create(h.VALUE):e;if(t.isString()){const r=Number(t.getValue());return Number.isNaN(r)?g.create(h.REF):r}else if(t.isNumber())return t.getValue();return g.create(h.VALUE)}getZeroOrOneByOneDefault(o){if(o==null)return 1;let e=1;if(o.isArray()&&(o=o.getFirstCell()),o.isBoolean())o.getValue()===!1&&(e=0);else{if(o.isString())return;o.isNumber()&&o.getValue()===0&&(e=0)}return e}getMatchTypeValue(o){if(o==null)return 1;let e=1;if(o.isArray()&&(o=o.getFirstCell()),o.isBoolean())o.getValue()===!1&&(e=0);else{if(o.isString())return;if(o.isNumber()){const t=o.getValue();t<=0&&(e=t)}}return e}binarySearch(o,e,t,r,n){const s=e.binarySearch(o,r,n);if(s==null)return g.create(h.NA);let a;return t.getRowCount()===1?a=t.get(0,s)||ce.create():a=t.get(s,0)||ce.create(),a.isNull()?y.create(0):a}_getOneFirstByRaw(o){return o.length===0?g.create(h.NA):o[0][0]||g.create(h.NA)}_getOneLastByRaw(o){return o.length===0?g.create(h.NA):o[o.length-1][o[0].length-1]||g.create(h.NA)}equalSearch(o,e,t,r=!0){const n=t.pickRaw(e.isEqual(o));return r?this._getOneFirstByRaw(n):this._getOneLastByRaw(n)}fuzzySearch(o,e,t,r=!0){const n=t.pickRaw(e.compare(o,Y.EQUALS));return r?this._getOneFirstByRaw(n):this._getOneLastByRaw(n)}orderSearch(o,e,t,r=De.MIN,n=!1){const s=e.orderSearch(o,r,n);if(s==null)return g.create(h.NA);const a=t.get(s.row,s.column)||ce.create();return a.isNull()?g.create(h.NA):a}binarySearchExpand(o,e,t,r=0,n,s){const a=e.binarySearch(o,n,s);return a==null?g.create(h.NA):r===0?t.slice([a,a+1]):t.slice(void 0,[a,a+1])}equalSearchExpand(o,e,t,r=!0,n=0){const s=e.isEqual(o);let a;return r?a=s.getFirstTruePosition():a=s.getLastTruePosition(),a==null?g.create(h.NA):n===0?t.slice([a.row,a.row+1]):t.slice(void 0,[a.column,a.column+1])}fuzzySearchExpand(o,e,t,r=!0,n=0){const s=e.compare(o,Y.EQUALS);let a;return r?a=s.getFirstTruePosition():a=s.getLastTruePosition(),a==null?g.create(h.NA):n===0?t.slice([a.row,a.row+1]):t.slice(void 0,[a.column,a.column+1])}orderSearchExpand(o,e,t,r=De.MIN,n=!1,s=0){const a=e.orderSearch(o,r,n);return a==null?g.create(h.NA):s===0?t.slice([a.row,a.row+1]):t.slice(void 0,[a.column,a.column+1])}flattenArray(o,e=!0){const t=[];t[0]=[];for(let r=0;r<o.length;r++){let n=o[r];if((n.isString()||n.isBoolean()||n.isNull())&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(n.isArray()){let s;if(n.iterator(a=>{if(a==null||a.isNull()||e&&(a.isString()||a.isBoolean()))return!0;if(a=this._includingLogicalValuesAndText(a),a.isError())return s=a,!1;t[0].push(a)}),s!=null&&s.isError())return s}else t[0].push(n)}return at(t,1,t[0].length)}_includingLogicalValuesAndText(o){if(o.isBoolean()&&(o=Zf(o)),o.isString()){const e=Number(o.getValue());o=y.create(Number.isNaN(e)?0:e)}return o}createReferenceObject(o,e){const t=o.getForcedUnitId()||o.getDefaultUnitId()||"",r=o.getForcedSheetId()||o.getDefaultUnitId()||"",n=o.getForcedSheetName(),a=dn({unitId:t,sheetName:n,range:e});let u;return jr(a)?u=new ua(a):Yi(a)?u=new la(a):Hi(a)?u=new ca(a):u=new Lr(e,r,t),this._setReferenceDefault(o,u)}_setReferenceDefault(o,e){if(this.unitId==null||this.subUnitId==null)return g.create(h.REF);e.setDefaultUnitId(this.unitId),e.setDefaultSheetId(this.subUnitId);const t=o.getUnitId();t!=null&&e.setForcedUnitIdDirect(t);const r=o.getForcedSheetId();return r!=null&&e.setForcedSheetIdDirect(r),e.setForcedSheetName(o.getForcedSheetName()),e.setUnitData(o.getUnitData()),e.setRuntimeData(o.getRuntimeData()),e.setArrayFormulaCellData(o.getArrayFormulaCellData()),e.setUnitStylesData(o.getUnitStylesData()),e}}class qm extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){if(e.isError())return e;const{isError:n,errorObject:s,variants:a}=Fr(t,r);if(n)return s;const{isError:u,errorObject:c,variants:l}=F(...a);if(u)return c;const[f,m]=l,d=Math.floor(+f.getValue()),C=Math.floor(+m.getValue());if(d<0||C<0)return g.create(h.NUM);if(d===0||C===0)return g.create(h.REF);const _=e.isArray()?e.getRowCount():1,E=e.isArray()?e.getColumnCount():1;if(_===1&&E===1)return e.isArray()?e.get(0,0):e;const R=d>_?_:d,b=C>E?E:C;return e.slice([0,R],[0,b])}}class Xm extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=[];for(let r=0;r<e.length;r++){const n=e[r],s=n.isArray()?n.getRowCount():1,a=n.isArray()?n.getColumnCount():1;for(let u=0;u<s;u++)for(let c=0;c<a;c++){const l=n.isArray()?n.get(u,c):n;t.push([l])}}return K.create({calculateValueList:t,rowCount:t.length,columnCount:1,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}var On=(i=>(i.ARRAY_CONSTRAIN="ARRAY_CONSTRAIN",i.FLATTEN="FLATTEN",i))(On||{});const To=[[qm,On.ARRAY_CONSTRAIN],[Xm,On.FLATTEN]];var gr;(i=>{const o=.636619772;function e(n,s){let a=0;for(let u=0;u<n.length;++u)a=s*a+n[u];return a}function t(n,s,a,u,c){if(s===0)return a;if(s===1)return u;const l=2/n;let f=a,m=u,d=u;for(let C=1;C<s;++C)d=m*C*l+c*f,f=m,m=d;return d}function r(n,s,a,u){return function(l,f){if(a){if(l===0)return a===1?-1/0:1/0;if(l<0)return Number.NaN}if(f===0)return n(l);if(f===1)return s(l);if(f<0)return Number.NaN;const m=f|0,d=n(l),C=s(l);return t(l,m,d,C,u)}}i.besselj=(()=>{const n=[-184.9052456,77392.33017,-1121442418e-2,6516196407e-1,-13362590354,57568490574],s=[1,267.8532712,59272.64853,9494680718e-3,1029532985,57568490411],a=[2093887211e-16,-2073370639e-15,2734510407e-14,-.001098628627,1],u=[-934935152e-16,7621095161e-16,-6911147651e-15,.0001430488765,-.01562499995];function c(_){let E=0,R=0,b=0,p=_*_;if(_<8)R=e(n,p),b=e(s,p),E=R/b;else{const V=_-.785398164;p=64/p,R=e(a,p),b=e(u,p),E=Math.sqrt(o/_)*(Math.cos(V)*R-Math.sin(V)*b*8/_)}return E}const l=[-30.16036606,15704.4826,-2972611439e-3,2423968531e-1,-7895059235,72362614232],f=[1,376.9991397,99447.43394,1858330474e-2,2300535178,144725228442],m=[-240337019e-15,2457520174e-15,-3516396496e-14,.00183105,1],d=[105787412e-15,-88228987e-14,8449199096e-15,-.0002002690873,.04687499995];function C(_){let E=0,R=0,b=0,p=_*_;const V=Math.abs(_)-2.356194491;return Math.abs(_)<8?(R=_*e(l,p),b=e(f,p),E=R/b):(p=64/p,R=e(m,p),b=e(d,p),E=Math.sqrt(o/Math.abs(_))*(Math.cos(V)*R-Math.sin(V)*b*8/Math.abs(_)),_<0&&(E=-E)),E}return function _(E,R){const b=Math.round(R);if(!Number.isFinite(E))return Number.isNaN(E)?E:0;if(b<0)return(b%2?-1:1)*_(E,-b);if(E<0)return(b%2?-1:1)*_(-E,b);if(b===0)return c(E);if(b===1)return C(E);if(E===0)return 0;let p=0;if(E>b)p=t(E,b,c(E),C(E),-1);else{const V=2*Math.floor((b+Math.floor(Math.sqrt(40*b)))/2);let S=!1,D=0,w=0,L=1,P=0;const v=2/E;for(let U=V;U>0;U--)if(P=U*v*L-D,D=L,L=P,Math.abs(L)>1e10&&(L*=1e-10,D*=1e-10,p*=1e-10,w*=1e-10),S&&(w+=L),S=!S,U===b&&(p=D),V-U>100&&p===0)return Number.NaN;w=2*w-L,p/=w}return p}})(),i.bessely=(()=>{const n=[228.4622733,-86327.92757,1087988129e-2,-5123598036e-1,7062834065,-2957821389],s=[1,226.1030244,47447.2647,7189466438e-3,7452499648e-1,40076544269],a=[2093887211e-16,-2073370639e-15,2734510407e-14,-.001098628627,1],u=[-934945152e-16,7621095161e-16,-6911147651e-15,.0001430488765,-.01562499995];function c(_){let E=0,R=0,b=0,p=_*_;const V=_-.785398164;return _<8?(R=e(n,p),b=e(s,p),E=R/b+o*(0,i.besselj)(_,0)*Math.log(_)):(p=64/p,R=e(a,p),b=e(u,p),E=Math.sqrt(o/_)*(Math.sin(V)*R+Math.cos(V)*b*8/_)),E}const l=[8511.937935,-4237922726e-3,7349264551e-1,-51534381390,127527439e4,-4900604943e3],f=[1,354.9632885,102042.605,2245904002e-2,3733650367,424441966400,249958057e5],m=[-240337019e-15,2457520174e-15,-3516396496e-14,.00183105,1],d=[105787412e-15,-88228987e-14,8449199096e-15,-.0002002690873,.04687499995];function C(_){let E=0,R=0,b=0,p=_*_;const V=_-2.356194491;return _<8?(R=_*e(l,p),b=e(f,p),E=R/b+o*((0,i.besselj)(_,1)*Math.log(_)-1/_)):(p=64/p,R=e(m,p),b=e(d,p),E=Math.sqrt(o/_)*(Math.sin(V)*R+Math.cos(V)*b*8/_)),E}return r(c,C,1,-1)})(),i.besseli=(()=>{const n=[.0045813,.0360768,.2659732,1.2067492,3.0899424,3.5156229,1],s=[.00392377,-.01647633,.02635537,-.02057706,.00916281,-.00157565,.00225319,.01328592,.39894228];function a(f){return f<=3.75?e(n,f*f/(3.75*3.75)):Math.exp(Math.abs(f))/Math.sqrt(Math.abs(f))*e(s,3.75/Math.abs(f))}const u=[32411e-8,.00301532,.02658733,.15084934,.51498869,.87890594,.5],c=[-.00420059,.01787654,-.02895312,.02282967,-.01031555,.00163801,-.00362018,-.03988024,.39894228];function l(f){return f<3.75?f*e(u,f*f/(3.75*3.75)):(f<0?-1:1)*Math.exp(Math.abs(f))/Math.sqrt(Math.abs(f))*e(c,3.75/Math.abs(f))}return function f(m,d){const C=Math.round(d);if(C===0)return a(m);if(C===1)return l(m);if(C<0)return Number.NaN;if(Math.abs(m)===0)return 0;if(m===1/0)return 1/0;let _=0,E;const R=2/Math.abs(m);let b=0,p=1,V=0;const S=2*Math.round((C+Math.round(Math.sqrt(40*C)))/2);for(E=S;E>0;E--)if(V=E*R*p+b,b=p,p=V,Math.abs(p)>1e10&&(p*=1e-10,b*=1e-10,_*=1e-10),E===C&&(_=b),S-E>100&&_===0)return Number.NaN;return _*=f(m,0)/p,m<0&&C%2?-_:_}})(),i.besselk=(()=>{const n=[74e-7,1075e-7,.00262698,.0348859,.23069756,.4227842,-.57721566],s=[53208e-8,-.0025154,.00587872,-.01062446,.02189568,-.07832358,1.25331414];function a(f){return f<=2?-Math.log(f/2)*(0,i.besseli)(f,0)+e(n,f*f/4):Math.exp(-f)/Math.sqrt(f)*e(s,2/f)}const u=[-4686e-8,-.00110404,-.01919402,-.18156897,-.67278579,.15443144,1],c=[-68245e-8,.00325614,-.00780353,.01504268,-.0365562,.23498619,1.25331414];function l(f){return f<=2?Math.log(f/2)*(0,i.besseli)(f,1)+1/f*e(u,f*f/4):Math.exp(-f)/Math.sqrt(f)*e(c,2/f)}return r(a,l,2,1)})()})(gr||(gr={}));function _a(i){return/^[01]{1,10}$/.test(i)}function Aa(i){return/^[0-7]{1,10}$/.test(i)}function Ea(i){return/^[0-9A-Fa-f]{1,10}$/.test(i)}function Wt(i){if(i===0)return 0;const o=[-1.3026537197817094,.6419697923564902,.019476473204185836,-.00956151478680863,-.000946595344482036,.000366839497852761,42523324806907e-18,-20278578112534e-18,-1624290004647e-18,130365583558e-17,15626441722e-18,-85238095915e-18,6529054439e-18,5059343495e-18,-991364156e-18,-227365122e-18,96467911e-18,2394038e-18,-6886027e-18,894487e-18,313092e-18,-112708e-18,381e-18,7106e-18,-1523e-18,-94e-18,121e-18,-28e-18];let e=i,t=!1;e<0&&(e=-e,t=!0);const r=2/(2+e),n=4*r-2;let s=0,a=0,u;for(let l=o.length-1;l>0;l--)u=s,s=n*s-a+o[l],a=u;const c=r*Math.exp(-e*e+.5*(o[0]+n*s)-a);return t?c-1:1-c}function Ra(i){return 1-Wt(i)}function Km(i){if(i>=2)return-100;if(i<=0)return 100;const o=i<1?i:2-i,e=Math.sqrt(-2*Math.log(o/2));let t=-.70711*((2.30753+e*.27061)/(1+e*(.99229+e*.04481))-e);for(let r=0;r<2;r++){const n=Ra(t)-o;t+=n/(1.1283791670955126*Math.exp(-t*t)-t*n)}return i<1?t:-t}function ur(i,o=1){let e=Math.floor(i);if(i<0)return Number.NaN;let t=1;for(;e>1&&Number.isFinite(t);)t*=e,e-=o;return t}function Qt(i,o){const e=Math.min(i-o,o);let t=1;for(let r=1;r<=e&&Number.isFinite(t);r++)t*=i-r+1,t/=r;return t}function Gs(i,o){let e=Math.floor(i),t=Math.floor(o);for(;t!==0;){const r=t;t=e%t,e=r}return e}function bi(i,o){const e=Gs(i,o);return e===0?0:Math.abs(i*o)/e}function ba(i){const o=i.length;if(o===1)return i[0][0];if(o===2)return i[0][0]*i[1][1]-i[0][1]*i[1][0];const{rowSwap:e,smallPivotDetected:t,luMatrix:r,permutation:n}=vo(i);if(t)return 0;let s=e?1:-1;for(let a=0;a<n.length;a++)s*=r[a][a];return s===0?0:s}function Zm(i){const o=ba(i);return o===0?null:i.length===1?[[1/o]]:Jm(i).map(r=>r.map(n=>n/o))}function zm(i,o,e){return i.filter((t,r)=>r!==o).map(t=>t.filter((r,n)=>n!==e))}function Jm(i){const o=i.length,e=Array.from({length:o},()=>new Array(o).fill(0));for(let t=0;t<o;t++)for(let r=0;r<o;r++){const s=((t+r)%2===0?1:-1)*ba(zm(i,t,r));e[r][t]=s===0?0:s}return e}function cr(i,o){return i.map(e=>o[0].map((t,r)=>e.reduce((n,s,a)=>n+s*o[a][r],0)))}function ft(i){return i[0].map((o,e)=>i.map(t=>t[e]))}function eh(i){const{smallPivotDetected:o,luMatrix:e,permutation:t}=vo(i);return o?null:th(e,t)}function vo(i){const o=ft(i),e=o.length,t=o[0].length;let r=!0,n=!1;const s=Ws(e,t,0),a=new Array(t).fill(0).map((u,c)=>c);for(let u=0;u<t;u++){for(let m=0;m<u;m++){let d=o[m][u];for(let C=0;C<m;C++)d-=s[m][C]*s[C][u];s[m][u]=d}let c=-1/0,l=u;for(let m=u;m<e;m++){let d=o[m][u];for(let _=0;_<u;_++)d-=s[m][_]*s[_][u];s[m][u]=d;const C=Math.abs(d);C>c&&(c=C,l=m)}if(Math.abs(s[l][u])<1e-11){n=!0;break}l!==u&&([s[u],s[l]]=[s[l],s[u]],[o[u],o[l]]=[o[l],o[u]],[a[u],a[l]]=[a[l],a[u]],r=!r);const f=s[u][u];for(let m=u+1;m<e;m++)s[m][u]/=f}return{rowSwap:r,smallPivotDetected:n,luMatrix:s,permutation:a}}function th(i,o){const e=o.length,t=Ws(e,e,0);for(let n=0;n<e;n++)t[n][n]=1;const r=Ws(e,e,0);for(let n=0;n<e;n++){const s=o[n];for(let a=0;a<e;a++)r[n][a]=t[s][a]}for(let n=0;n<e;n++){const s=r[n];for(let a=n+1;a<e;a++){const u=i[a][n];for(let c=0;c<e;c++)r[a][c]-=s[c]*u}}for(let n=e-1;n>=0;n--){const s=r[n],a=i[n][n];for(let u=0;u<e;u++)s[u]/=a;for(let u=0;u<n;u++){const c=i[u][n];for(let l=0;l<e;l++)r[u][l]-=s[l]*c}}return r}function Ws(i,o,e){const t=[];for(let r=0;r<i;r++){t[r]=[];for(let n=0;n<o;n++)t[r].push(e)}return t}function rh(i){const o=nh(i);if(!o)return null;const{matrixU:e,matrixS:t,matrixV:r}=o,n=ft(e),s=Array.from({length:t.length},()=>new Array(i[0].length).fill(0)),a=Math.max(i.length,i[0].length)*Number.EPSILON*t[0];for(let u=0;u<t.length;u++)Math.abs(t[u])>a&&(s[u][u]=1/t[u]);return cr(r,cr(s,n))}function nh(i){const o=ft(i),e=o.length,t=o[0].length;if(e<t)return null;const r=new Array(t).fill(0),n=new Array(t).fill(0),s=Array.from({length:t},()=>new Array(t).fill(0));let a=Number.EPSILON,u=0,c=0,l=0;for(let _=0;_<t;_++){if(r[_]=u,c=Rs(o,_,e,_,_),c<=1e-64/a)u=0;else{u=Math.sqrt(c),o[_][_]>=0&&(u=-u);const R=o[_][_]*u-c;o[_][_]-=u;for(let b=_+1;b<t;b++){c=Rs(o,_,e,_,b);for(let p=_;p<e;p++)o[p][b]+=c/R*o[p][_]}}if(n[_]=u,c=yi(o,_+1,t,_,_),c<=1e-64/a)u=0;else{u=Math.sqrt(c),o[_][_+1]>=0&&(u=-u);const R=o[_][_+1]*u-c;o[_][_+1]-=u;for(let b=_+1;b<t;b++)r[b]=o[_][b]/R;for(let b=_+1;b<e;b++){c=yi(o,_+1,t,b,_);for(let p=_+1;p<t;p++)o[b][p]+=c*r[p]}}const E=Math.abs(n[_])+Math.abs(r[_]);E>l&&(l=E)}let f=0;for(let _=t-1;_>=0;_--){if(u!==0){for(let E=f;E<t;E++)s[E][_]=o[_][E]/(u*o[_][_+1]);for(let E=f;E<t;E++){c=0;for(let R=f;R<t;R++)c+=o[_][R]*s[R][E];for(let R=f;R<t;R++)s[R][E]+=c*s[R][_]}}for(let E=f;E<t;E++)s[_][E]=0,s[E][_]=0;s[_][_]=1,u=r[_],f=_}for(let _=t-1;_>=0;_--){u=n[_];for(let E=_+1;E<t;E++)o[_][E]=0;if(u!==0){for(let E=_+1;E<t;E++){c=Rs(o,_+1,e,_,E);for(let R=_;R<e;R++)o[R][E]+=c/(o[_][_]*u)*o[R][_]}for(let E=_;E<e;E++)o[E][_]/=u}else for(let E=_;E<e;E++)o[E][_]=0;o[_][_]+=1}a*=l;let m=0,d=0,C=0;for(let _=t-1;_>=0;_--)for(let E=0;E<50;E++){let R=!1,b=_;for(;b>=0;b--){if(Math.abs(r[b])<=a){R=!0;break}if(Math.abs(n[b-1])<=a)break}if(!R){let D=0,w=1;for(let L=b;L<_+1&&(m=w*r[L],d=n[L],r[L]*=D,!(Math.abs(m)<=a));L++){C=Kr(m,d),n[L]=C,D=d/C,w=-m/C;for(let P=0;P<e;P++){const v=o[P][b-1],U=o[P][L];o[P][b-1]=v*D+U*w,o[P][L]=-v*w+U*D}}}if(b===_){if(n[_]<0){n[_]=-n[_];for(let D=0;D<t;D++)s[D][_]=-s[D][_]}break}if(E>=49)return null;let p=n[b];m=((n[_-1]-n[_])*(n[_-1]+n[_])+(r[_-1]-r[_])*(r[_-1]+r[_]))/(2*r[_]*n[_-1]),C=Kr(m,1),m<0?m=((p-n[_])*(p+n[_])+r[_]*(n[_-1]/(m-C)-r[_]))/p:m=((p-n[_])*(p+n[_])+r[_]*(n[_-1]/(m+C)-r[_]))/p;let V=1,S=1;for(let D=b+1;D<_+1;D++){let w=r[D],L=n[D];d=S*w,w*=V,C=Kr(m,d),r[D-1]=C,V=m/C,S=d/C,m=p*V+w*S,d=L*S,w=-p*S+w*V,L*=V;for(let P=0;P<t;P++){const v=s[P][D-1],U=s[P][D];s[P][D-1]=v*V+U*S,s[P][D]=-v*S+U*V}C=Kr(m,d),n[D-1]=C,V=m/C,S=d/C,m=V*w+S*L,p=-S*w+V*L;for(let P=0;P<e;P++){const v=o[P][D-1],U=o[P][D];o[P][D-1]=v*V+U*S,o[P][D]=-v*S+U*V}}r[b]=0,r[_]=m,n[_]=p}for(let _=0;_<n.length;_++)n[_]<a&&(n[_]=0);for(let _=0;_<t;_++)for(let E=_-1;E>=0;E--)if(n[E]<n[_]){const R=n[E];n[E]=n[_],n[_]=R;for(let b=0;b<o.length;b++){const p=o[b][_];o[b][_]=o[b][E],o[b][E]=p}for(let b=0;b<s.length;b++){const p=s[b][_];s[b][_]=s[b][E],s[b][E]=p}_=E}return{matrixU:o,matrixS:n,matrixV:s}}function Kr(i,o){let e=0;return Math.abs(i)>Math.abs(o)?(e=o/i,Math.abs(i)*Math.sqrt(1+e*e)):o!==0?(e=i/o,Math.abs(o)*Math.sqrt(1+e*e)):0}function Rs(i,o,e,t,r){let n=0;for(let s=o;s<e;s++)n+=i[s][t]*i[s][r];return n}function yi(i,o,e,t,r){let n=0;for(let s=o;s<e;s++)n+=i[t][s]*i[r][s];return n}const Zr=new Map([["I",1],["V",5],["X",10],["L",50],["C",100],["D",500],["M",1e3]]),sh=new Map([[1,"I"],[4,"IV"],[5,"V"],[9,"IX"],[10,"X"],[40,"XL"],[45,"VL"],[49,"IL"],[50,"L"],[90,"XC"],[95,"VC"],[99,"IC"],[100,"C"],[400,"CD"],[450,"LD"],[490,"XD"],[495,"VD"],[499,"ID"],[500,"D"],[900,"CM"],[950,"LM"],[990,"XM"],[995,"VM"],[999,"IM"],[1e3,"M"]]),ah=[[1,4,5,9,10,40,50,90,100,400,500,900,1e3,4e3],[1,4,5,9,10,40,45,50,90,95,100,400,450,500,900,950,1e3,4e3],[1,4,5,9,10,40,45,49,50,90,95,99,100,400,450,490,500,900,950,990,1e3,4e3],[1,4,5,9,10,40,45,49,50,90,95,99,100,400,450,490,495,500,900,950,990,995,1e3,4e3],[1,4,5,9,10,40,45,49,50,90,95,99,100,400,450,490,495,499,500,900,950,990,995,999,1e3,4e3]];function Io(i,o,e){return i<=0?0:i>=1?1:rs(i,o,e)}function ih(i,o,e){return i<=0||i>=1?0:o===1&&e===1?1:o<512&&e<512?i**(o-1)*(1-i)**(e-1)/pa(o,e):Math.exp((o-1)*Math.log(i)+(e-1)*Math.log(1-i)-Na(o,e))}function ya(i,o,e){if(i<=0)return 0;if(i>=1)return 1;const t=1e-8;let r;if(o>=1&&e>=1){const c=i<.5?i:1-i,l=Math.sqrt(-2*Math.log(c));r=(2.30753+l*.27061)/(1+l*(.99229+l*.04481))-l,i<.5&&(r=-r);const f=(r*r-3)/6,m=2/(1/(2*o-1)+1/(2*e-1)),d=r*Math.sqrt(f+m)/m-(1/(2*e-1)-1/(2*o-1))*(f+5/6-2/(3*m));r=o/(o+e*Math.exp(2*d))}else{const c=Math.exp(o*Math.log(o/(o+e)))/o,l=Math.exp(e*Math.log(e/(o+e)))/e,f=c+l;i<c/f?r=(o*f*i)**(1/o):r=1-(e*f*(1-i))**(1/e)}const n=-Na(o,e);let s,a,u;for(let c=0;c<10;c++){if(r===0||r===1)return r;if(s=rs(r,o,e)-i,a=Math.exp((o-1)*Math.log(r)+(e-1)*Math.log(1-r)+n),u=s/a,r-=a=u/(1-.5*Math.min(1,u*((o-1)/r-(e-1)/(1-r)))),r<=0&&(r=.5*(r+a)),r>=1&&(r=.5*(r+a+1)),Math.abs(a)<t*r&&c>0)break}return r}function rs(i,o,e){const t=i===0||i===1?0:Math.exp(ot(o+e)-ot(o)-ot(e)+o*Math.log(i)+e*Math.log(1-i));return i<(o+1)/(o+e+2)?t*pi(i,o,e)/o:1-t*pi(1-i,e,o)/e}function pi(i,o,e){let n=1-(o+e)*i/(o+1);Math.abs(n)<1e-8&&(n=1e-8),n=1/n;let s=1,a=n;for(let u=1;u<=100;u++){let c=u*(e-u)*i/((o-1+u*2)*(o+u*2));if(n=1+c*n,Math.abs(n)<1e-8&&(n=1e-8),s=1+c/s,Math.abs(s)<1e-8&&(s=1e-8),n=1/n,a*=n*s,c=-(o+u)*(o+e+u)*i/((o+u*2)*(o+1+u*2)),n=1+c*n,Math.abs(n)<1e-8&&(n=1e-8),s=1+c/s,Math.abs(s)<1e-8&&(s=1e-8),n=1/n,a*=n*s,Math.abs(n*s-1)<1e-8)break}return a}function pa(i,o){return i+o>170?Math.exp(Na(i,o)):cn(i)*cn(o)/cn(i+o)}function Na(i,o){return ot(i)+ot(o)-ot(i+o)}function Fo(i,o,e){if(i<0)return 0;if(i>=o)return 1;if(e<0||e>1||o<=0)return Number.NaN;let t=0;for(let r=0;r<=i;r++)t+=Va(r,o,e);return t}function Va(i,o,e){return e===0||e===1?o*e===i?1:0:Qt(o,i)*e**i*(1-e)**(o-i)}function Oa(i,o){return i<=0?0:Ma(o/2,i/2)}function oh(i,o){return i<0?0:i===0&&o===2?.5:Math.exp((o/2-1)*Math.log(i)-i/2-o/2*Math.log(2)-ot(o/2))}function Bo(i,o){return i<=0?0:i>=1?1/0:2*Yo(i,o/2)}function Sa(i,o,e){return i<0?0:rs(o*i/(o*i+e),o/2,e/2)}function uh(i,o,e){if(i<0)return 0;if(i===0&&o<2)return 1/0;if(i===0&&o===2)return 1;let t=1/pa(o/2,e/2);return t*=(o/e)**(o/2),t*=i**(o/2-1),t*=(1+o/e*i)**(-(o+e)/2),t}function ko(i,o,e){return i<=0?0:i>=1?1/0:e/(o*(1/ya(i,o/2,e/2)-1))}function ch(i,o){return i<0?0:1-Math.exp(-o*i)}function lh(i,o){return i<0?0:o*Math.exp(-o*i)}function $o(i,o,e){const t=o.length;let r=0,n=0;for(let m=0;m<t;m++)r+=o[m],n+=e[m];const s=r/t,a=n/t;let u=0,c=0;for(let m=0;m<t;m++)u+=(o[m]-s)*(e[m]-a),c+=(e[m]-a)**2;if(c===0)return 1/0;const l=u/c;return s-l*a+l*i}function cn(i){const o=[-1.716185138865495,24.76565080557592,-379.80425647094563,629.3311553128184,866.9662027904133,-31451.272968848367,-36144.413418691176,66456.14382024054],e=[-30.8402300119739,315.35062697960416,-1015.1563674902192,-3107.771671572311,22538.11842098015,4755.846277527881,-134659.9598649693,-115132.2596755535];let t=0,r=i;if(i>171.6243769536076)return 1/0;if(r<=0){const f=r%1+36e-17;if(f)t=(r&1?-1:1)*Math.PI/Math.sin(Math.PI*f),r=1-r;else return 1/0}const n=r;let s=0,a;r<1?a=r++:a=(r-=s=(r|0)-1)-1;let u=0,c=0;for(let f=0;f<8;++f)u=(u+o[f])*a,c=c*a+e[f];let l=u/c+1;if(n<r)l/=n;else if(n>r)for(let f=0;f<s;++f)l*=r,r++;return t&&(l=t/l),l}function fh(i,o,e){return i<=0?0:Ma(o,i/e)}function mh(i,o,e){return i<0?0:i===0&&o===1?1/e:Math.exp((o-1)*Math.log(i)-i/e-ot(o)-o*Math.log(e))}function hh(i,o,e){return i<=0?0:i>=1?1/0:e*Yo(i,o)}function ot(i){const o=[76.18009172947146,-86.50532032941678,24.01409824083091,-1.231739572450155,.001208650973866179,-5395239384953e-18];let e=i,t=i+5.5;t-=(i+.5)*Math.log(t);let r=1.000000000190015;for(let n=0;n<6;n++)r+=o[n]/++e;return-t+Math.log(2.5066282746310007*r/i)}function Ma(i,o){if(o<0||i<=0)return Number.NaN;const e=1e-30,t=-~(Math.log(i>=1?i:1/i)*8.5+i*.4+17),r=ot(i),n=Math.exp(-o+i*Math.log(o)-r);let s=i,a=1/i,u=a;if(o<i+1){if(n===0)return 0;for(let d=1;d<=t&&(a+=u*=o/++s,!(Math.abs(u)<Math.abs(a)*e));d++);return a*n}if(n===0)return 1;let c=o+1-i,l=1/e,f=1/c,m=f;for(let d=1;d<=t;d++){const C=-d*(d-i);if(c+=2,f=C*f+c,Math.abs(f)<e&&(f=e),l=c+C/l,Math.abs(l)<e&&(l=e),f=1/f,m*=f*l,Math.abs(f*l-1)<e)break}return 1-m*n}function Yo(i,o){if(i<=0)return 0;if(i>=1)return Math.max(100,o+100*Math.sqrt(o));let e;if(o>1){const a=i<.5?i:1-i,u=Math.sqrt(-2*Math.log(a));e=(2.30753+u*.27061)/(1+u*(.99229+u*.04481))-u,i<.5&&(e=-e),e=Math.max(.001,o*(1-1/(9*o)-e/(3*Math.sqrt(o)))**3)}else{const a=1-o*(.253+o*.12);i<a?e=(i/a)**(1/o):e=1-Math.log(1-(i-a)/(1-a))}const t=1e-8,r=ot(o);let n,s;for(let a=0;a<12;a++){if(e<=0)return 0;if(n=Ma(o,e)-i,o>1?s=Math.exp((o-1)*(Math.log(o-1)-1)-r)*Math.exp(-(e-(o-1))+(o-1)*(Math.log(e)-Math.log(o-1))):s=Math.exp(-e+(o-1)*Math.log(e)-r),s!==0&&(s=n/s/(1-.5*Math.min(1,n/s*((o-1)/e-1)))),e-=s,e<=0&&(e=.5*(e+s)),Math.abs(s)<t*e)break}return e}function gh(i,o,e,t){let r=0;for(let n=0;n<=i;n++)r+=Da(n,o,e,t);return r}function Da(i,o,e,t){return o-i>t-e?0:Qt(e,i)*Qt(t-e,o-i)/Qt(t,o)}function Ho(i,o,e){return i<0?0:.5+.5*Wt((Math.log(i)-o)/Math.sqrt(2*e*e))}function dh(i,o,e){return i<=0?0:Math.exp(-Math.log(i)-.5*Math.log(2*Math.PI)-Math.log(e)-(Math.log(i)-o)**2/(2*e*e))}function Ch(i,o,e){return Math.exp(ns(i,o,e))}function _h(i,o,e){if(i<0)return 0;let t=0;for(let r=0;r<=i;r++)t+=wa(r,o,e);return t}function wa(i,o,e){return i<0?0:Qt(i+o-1,o-1)*e**o*(1-e)**i}function Br(i,o,e){return .5*(1+Wt((i-o)/Math.sqrt(2*e*e)))}function Go(i,o,e){return Math.exp(-.5*Math.log(2*Math.PI)-Math.log(e)-(i-o)**2/(2*e*e))}function ns(i,o,e){return-1.4142135623730951*e*Km(2*i)+o}function Ah(i,o){let e=0;for(let t=0;t<=i;t++)e+=Wo(t,o);return e}function Wo(i,o){return Math.exp(-o)*o**i/ur(i)}function kr(i,o){const e=.5*rs(o/(i**2+o),o/2,.5);return i<0?e:1-e}function Eh(i,o){const e=(1+i**2/o)**(-(o+1)/2);return 1/(Math.sqrt(o)*pa(.5,o/2))*e}function ss(i,o){let e=ya(2*Math.min(i,1-i),.5*o,.5);return e=Math.sqrt(o*(1-e)/e),i>.5?e:-e}function Ke(i,o,e,t,r){const n=[],s=[];let a=!0;for(let u=0;u<e;u++){const c=Math.floor(u/t),l=u%t,f=Math.floor(u/r),m=u%r,d=i.isArray()?i.get(c,l):i,C=o.isArray()?o.get(f,m):o;if(d.isError())return{isError:!0,errorObject:d,array1Values:n,array2Values:s,noCalculate:a};if(C.isError())return{isError:!0,errorObject:C,array1Values:n,array2Values:s,noCalculate:a};if(d.isNull()||C.isNull()||d.isBoolean()||C.isBoolean())continue;const _=d.getValue(),E=C.getValue();!M.isRealNum(_)||!M.isRealNum(E)||(n.push(+_),s.push(+E),a=!1)}return{isError:!1,errorObject:null,array1Values:n,array2Values:s,noCalculate:a}}function as(i,o,e){const t=i.isArray()?i.getRowCount():1,r=i.isArray()?i.getColumnCount():1;let n=t,s=r;if(o&&!o.isNull()&&(n=o.isArray()?o.getRowCount():1,s=o.isArray()?o.getColumnCount():1,t===1&&s!==r||r===1&&n!==t||t!==1&&r!==1&&(n!==t||s!==r)))return{isError:!0,errorObject:g.create(h.REF)};if(e&&!e.isNull()){const a=e.isArray()?e.getRowCount():1,u=e.isArray()?e.getColumnCount():1;if(t===1&&n>1&&a!==n||r===1&&s>1&&u!==s)return{isError:!0,errorObject:g.create(h.REF)}}return{isError:!1,errorObject:null}}function ht(i){const o=i.isArray()?i.getRowCount():1,e=i.isArray()?i.getColumnCount():1,t=[];for(let r=0;r<o;r++){t[r]=[];for(let n=0;n<e;n++){const s=i.isArray()?i.get(r,n):i;if(s.isError()||s.isNull()||s.isBoolean()||s.isString())return g.create(h.VALUE);t[r].push(+s.getValue())}}return t}function is(i,o){const e=[];let t=1;for(let r=0;r<i;r++){e[r]=[];for(let n=0;n<o;n++)e[r].push(t++)}return e}function os(i,o,e,t){let r=o;t&&(r=o.map(a=>Math.log(a)));let n,s;return e?{slope:n,intercept:s}=Rh(i,r):{slope:n,intercept:s}=bh(i,r),t&&(n=Math.exp(n),s=Math.exp(s)),Number.isNaN(n)&&!e&&(n=0),{slope:n,intercept:s,Y:r}}function Rh(i,o){const e=o.length;let t=0,r=0,n=0,s=0;for(let l=0;l<e;l++)t+=i[l],r+=o[l],n+=i[l]*i[l],s+=i[l]*o[l];const u=(e*s-t*r)/(e*n-t*t),c=1/e*r-u*(1/e)*t;return{slope:u,intercept:c}}function bh(i,o){const e=[[...i]],t=[...o];let r=e.length,n=e[0].length,s=Math.min(r,n);const a=new Array(s).fill(0);for(let c=0;c<s;c++){const l=e[c];let f=0;for(let d=0;d<n;d++)f+=l[d]**2;const m=l[c]<0?Math.sqrt(f):-Math.sqrt(f);if(a[c]=m,m!==0){l[c]-=m;for(let d=c+1;d<r;d++){let C=0;for(let _=c;_<n;_++)C-=e[d][_]*l[_];C/=m*l[c];for(let _=c;_<n;_++)e[d][_]-=C*l[_]}}}r=e.length,n=e[0].length,s=Math.min(r,n);const u=new Array(r).fill(0);for(let c=0;c<s;c++){const l=e[c];let f=0;for(let m=0;m<n;m++)f+=t[m]*l[m];f/=a[c]*l[c];for(let m=0;m<n;m++)t[m]+=f*l[m]}for(let c=a.length-1;c>=0;c--){t[c]/=a[c];const l=t[c],f=e[c];u[c]=l;for(let m=0;m<c;m++)t[m]-=l*f[m]}return{slope:u[0],intercept:0}}function us(i,o,e,t,r){const n=i.length===1&&i[0].length>1;let s=i;r&&(s=i.map(_=>_.map(E=>Math.log(E))));let a=o,u=e;n&&(s=ft(s),a=ft(a),u=ft(u)),t&&(a=a.map(_=>[..._,1]));const c=ft(a),l=cr(c,a),f=cr(c,s);let m=eh(l);if(!m&&(m=rh(l),!m))return g.create(h.NA);let d=cr(m,f);t||d.push([0]),d=ft(d);const C=d[0].pop();if(d[0].reverse(),d[0].push(C),r)for(let _=0;_<d[0].length;_++)d[0][_]=Math.exp(d[0][_]);return{coefficients:d,Y:s,X:a,newX:u,XTXInverse:m}}function Qo(i){const o=[],e=[];let t=!1;for(let r=0;r<i.length;r++){const n=i[r];if(n.isReferenceObject())n.isMultiArea()?o.push(n):e.push(n);else{t=!0;break}}return{isError:t,multiAreaRefs:o,normalRefs:e}}var Ve=(i=>(i.AVERAGE="AVERAGE",i.COUNT="COUNT",i.COUNTA="COUNTA",i.MAX="MAX",i.MIN="MIN",i.PRODUCT="PRODUCT",i.STDEV="STDEV",i.STDEV_S="STDEV.S",i.STDEVP="STDEVP",i.STDEV_P="STDEV.P",i.SUM="SUM",i.VAR="VAR",i.VAR_S="VAR.S",i.VARP="VARP",i.VAR_P="VAR.P",i.MEDIAN="MEDIAN",i.MODE_SNGL="MODE.SNGL",i))(Ve||{});function qo(i,o){const e=i[o];return e?e.hd===M.BooleanNumber.TRUE:!1}function Xo(i,o,e,t,r,n){const s=i.getValue(o,e);if(s!=null&&s.f||s!=null&&s.si){const a=n.getFormulaStringByCell(o,e,t,r);if(a&&(a.indexOf(`${k.SUBTOTAL}(`)>-1||a.indexOf(`${k.AGGREGATE}(`)>-1))return!0}return!1}function Ko(i,o){const e=Object.entries(i).filter(([t,{count:r}])=>r===o).sort((t,r)=>t[1].order-r[1].order).map(([t])=>+t);return y.create(e[0])}function Zo(i,o){var b,p;const{type:e,ignoreRowHidden:t,ignoreErrorValues:r,ignoreNested:n,formulaDataModel:s}=i,a=[];let u=0,c=0,l=0,f=0,m=0,d=0,C=1;const _={};let E=1,R=0;for(let V=0;V<o.length;V++){const S=o[V],D=S.getFilteredOutRows(),w=S.getRowData(),L=S.getUnitId(),P=S.getSheetId(),U=(p=(b=S.getUnitData()[L])==null?void 0:b[P])==null?void 0:p.cellData;let $;if(S.iterator((W,re,J)=>{if(D.includes(re)||t&&qo(w,re)||n&&Xo(U,re,J,P,L,s))return!0;if(e==="COUNT")return W!=null&&W.isNumber()&&u++,!0;if(e==="COUNTA")return W!=null&&!W.isNull()&&c++,!0;if(W!=null&&W.isError())return r?!0:($=W,!1);if(!W||W.isNull()||W.isBoolean()||W.isString())return!0;let H=W.getValue();if(!M.isRealNum(H))return!0;if(H=+H,f++,e==="MAX")return m=f===1?H:Math.max(m,H),!0;if(e==="MIN")return d=f===1?H:Math.min(d,H),!0;if(e==="MODE.SNGL")return _[H]?(_[H].count++,_[H].count>E&&(E=_[H].count)):_[H]={count:1,order:R++},!0;l+=H,C*=H,a.push(W)}),$!=null&&$.isError())return $}switch(e){case"AVERAGE":return f===0?g.create(h.DIV_BY_ZERO):y.create(l/f);case"COUNT":return y.create(u);case"COUNTA":return y.create(c);case"MAX":return y.create(m);case"MIN":return y.create(d);case"PRODUCT":return y.create(f===0?0:C);case"STDEV":case"STDEV.S":return f<2?g.create(h.DIV_BY_ZERO):at([a],1,f).std(1);case"STDEVP":case"STDEV.P":return f===0?g.create(h.DIV_BY_ZERO):at([a],1,f).std();case"SUM":return y.create(l);case"VAR":case"VAR.S":return f<2?g.create(h.DIV_BY_ZERO):at([a],1,f).var(1);case"VARP":case"VAR.P":return f===0?g.create(h.DIV_BY_ZERO):at([a],1,f).var();case"MEDIAN":return f===0?g.create(h.NUM):zo(a.map(V=>+V.getValue()));case"MODE.SNGL":return R===0||E===1?g.create(h.NA):Ko(_,E);default:return g.create(h.VALUE)}}function nr(i,o,e){var a,u;const{ignoreRowHidden:t=!1,ignoreErrorValues:r=!1,ignoreNested:n=!1}=o!=null?o:{},s=[];if(i.isReferenceObject()){const c=i.getFilteredOutRows(),l=i.getRowData(),f=i.getUnitId(),m=i.getSheetId(),C=(u=(a=i.getUnitData()[f])==null?void 0:a[m])==null?void 0:u.cellData;let _;if(i.iterator((E,R,b)=>{if(c.includes(R)||t&&qo(l,R))return!0;if(E!=null&&E.isError())return r?!0:(_=E,!1);if(n&&e&&Xo(C,R,b,m,f,e)||!E||E.isNull()||E.isBoolean()||E.isString())return!0;const p=E.getValue();if(!M.isRealNum(p))return!0;s.push(+p)}),_)return _}else{const c=i.isArray()?i.getRowCount():1,l=i.isArray()?i.getColumnCount():1;for(let f=0;f<c;f++)for(let m=0;m<l;m++){const d=i.isArray()?i.get(f,m):i;if(d.isError()){if(r)continue;return d}if(!d||d.isNull()||d.isBoolean()||d.isString())continue;const C=d.getValue();M.isRealNum(C)&&s.push(+C)}}return s.length===0?g.create(h.NUM):s}function zo(i){const o=i.length;i.sort((t,r)=>t-r);let e;if(o%2===0){const t=o/2;e=(i[t-1]+i[t])/2}else e=i[Math.floor(o/2)];return y.create(e)}function Jo(i,o){if(o<1||o>i.length)return g.create(h.NUM);i.sort((t,r)=>r-t);const e=Math.ceil(o);return y.create(i[e-1])}function eu(i,o){if(o<1||o>i.length)return g.create(h.NUM);i.sort((t,r)=>t-r);const e=Math.floor(o);return y.create(i[e-1])}function tu(i,o){const e=i.length;if(o<0||o>1)return g.create(h.NUM);i.sort((a,u)=>a-u);const t=o*(e-1),r=Math.floor(t),n=t-r;if(n===0)return y.create(i[r]);const s=i[r]+n*(i[r+1]-i[r]);return y.create(s)}function ru(i,o){const e=i.length;if(o<1/(e+1)||o>1-1/(e+1))return g.create(h.NUM);i.sort((a,u)=>a-u);const t=o*(e+1)-1,r=Math.floor(t),n=t-r;if(n===0)return y.create(i[r]);const s=i[r]+n*(i[r+1]-i[r]);return y.create(s)}function nu(i,o){const e=i.length;if(o<0||o>4)return g.create(h.NUM);i.sort((u,c)=>u-c);const r=o/4*(e-1),n=Math.floor(r),s=r-n;if(s===0)return y.create(i[n]);const a=i[n]+s*(i[n+1]-i[n]);return y.create(a)}function su(i,o){const e=i.length;if(o<=0||o>=4)return g.create(h.NUM);i.sort((u,c)=>u-c);const t=o/4;if(t<1/(e+1)||t>1-1/(e+1))return g.create(h.NUM);const r=t*(e+1)-1,n=Math.floor(r),s=r-n;if(s===0)return y.create(i[n]);const a=i[n]+s*(i[n+1]-i[n]);return y.create(a)}class au extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",5)}calculate(e,t,r,n,s){let a=n!=null?n:y.create(0),u=s!=null?s:y.create(1);a.isNull()&&(a=y.create(0)),u.isNull()&&(u=y.create(1));const c=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1,u.isArray()?u.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1,u.isArray()?u.getColumnCount():1),f=O(c,l,e,g.create(h.NA)),m=O(c,l,t,g.create(h.NA)),d=O(c,l,r,g.create(h.NA)),C=O(c,l,a,g.create(h.NA)),_=O(c,l,u,g.create(h.NA)),E=f.mapValue((R,b,p)=>{const V=m.get(b,p),S=d.get(b,p),D=C.get(b,p),w=_.get(b,p);return this._handleSingleObject(R,V,S,D,w)});return c===1&&l===1?E.get(0,0):E}_handleSingleObject(e,t,r,n,s){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(n.isError())return n;if(s.isError())return s;const{isError:a,errorObject:u,variants:c}=F(e,t,r,n,s);if(a)return u;const[l,f,m,d,C]=c,_=+l.getValue(),E=+f.getValue(),R=+m.getValue(),b=+d.getValue(),p=+C.getValue();if(E<=0||R<=0||_<=0||_>=1||b>=p)return g.create(h.NUM);const V=ya(_,E,R)*(p-b)+b;return y.create(V)}}class iu extends N{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA)),f=O(s,a,n,g.create(h.NA)),m=u.mapValue((d,C,_)=>{const E=c.get(C,_),R=l.get(C,_),b=f.get(C,_);return d.isError()?d:E.isError()?E:R.isError()?R:b.isError()?b:this._handleSingleObject(d,E,R,b)});return s===1&&a===1?m.get(0,0):m}_handleSingleObject(e,t,r,n){const{isError:s,errorObject:a,variants:u}=F(e,t,r,n);if(s)return a;const[c,l,f,m]=u,d=Math.floor(+c.getValue()),C=Math.floor(+l.getValue()),_=+f.getValue(),E=+m.getValue();if(d<0||d>C||_<0||_>1)return g.create(h.NUM);let R;return E?R=Fo(d,C,_):R=Va(d,C,_),y.create(R)}}class ou extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSingleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=F(e,t,r);if(n)return s;const[u,c,l]=a,f=Math.floor(+u.getValue()),m=+c.getValue(),d=+l.getValue();if(f<0||m<=0||m>=1||d<=0||d>=1)return g.create(h.NUM);let C=0;for(;C<=f&&!(Fo(C,f,m)>=d);)C++;return y.create(C)}}class uu extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.mapValue((c,l,f)=>{const m=a.get(l,f);return c.isError()?c:m.isError()?m:this._handleSingleObject(c,m)});return r===1&&n===1?u.get(0,0):u}_handleSingleObject(e,t){const{isError:r,errorObject:n,variants:s}=F(e,t);if(r)return n;const[a,u]=s,c=+a.getValue(),l=Math.floor(+u.getValue());if(c<0||l<1||l>10**10)return g.create(h.NUM);const f=1-Oa(c,l);return y.create(f)}}class cu extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.mapValue((c,l,f)=>{const m=a.get(l,f);return c.isError()?c:m.isError()?m:this._handleSingleObject(c,m)});return r===1&&n===1?u.get(0,0):u}_handleSingleObject(e,t){const{isError:r,errorObject:n,variants:s}=F(e,t);if(r)return n;const[a,u]=s,c=+a.getValue(),l=Math.floor(+u.getValue());if(c<0||c>1||l<1||l>10**10)return g.create(h.NUM);const f=Bo(1-c,l);return Number.isNaN(f)||!Number.isFinite(f)?g.create(h.NUM):y.create(f)}}class lu extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1;let u=e;if(e.isArray()&&r===1&&n===1&&(u=e.get(0,0)),u.isError())return u;let c=t;if(t.isArray()&&s===1&&a===1&&(c=t.get(0,0)),c.isError())return c;if(r*n===1||s*a===1)return u.isNull()||c.isNull()?g.create(h.VALUE):g.create(h.NA);if(r*n!==s*a)return g.create(h.NA);const{isError:l,errorObject:f,array1Values:m,array2Values:d,noCalculate:C}=Ke(e,t,r*n,n,a);return l?f:C?g.create(h.DIV_BY_ZERO):this._getResult(m,d,r,n)}_getResult(e,t,r,n){let s=0;for(let c=0;c<e.length;c++){if(t[c]===0)return g.create(h.DIV_BY_ZERO);s+=(e[c]-t[c])**2/t[c]}let a=(r-1)*(n-1);r===1?a=n-1:n===1&&(a=r-1);const u=1-Oa(s,a);return y.create(u)}}class fu extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);if(f.isError())return f;if(C.isError())return C;if(_.isError())return _;const{isError:E,errorObject:R,variants:b}=F(f,C,_);if(E)return R;const[p,V,S]=b,D=+p.getValue(),w=+V.getValue(),L=Math.floor(+S.getValue());if(D<=0||D>=1||w<=0||L<1)return g.create(h.NUM);const P=Math.abs(ns(D/2,0,1)*w/Math.sqrt(L));return y.create(P)});return n===1&&s===1?l.get(0,0):l}}class mu extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1;let u=e;if(e.isArray()&&r===1&&n===1&&(u=e.get(0,0)),u.isError())return u;let c=t;if(t.isArray()&&s===1&&a===1&&(c=t.get(0,0)),c.isError())return c;if((r*n===1||s*a===1)&&(u.isNull()||c.isNull()))return g.create(h.VALUE);if(r*n!==s*a)return g.create(h.NA);const{isError:l,errorObject:f,array1Values:m,array2Values:d,noCalculate:C}=Ke(e,t,r*n,n,a);return l?f:C?g.create(h.DIV_BY_ZERO):this._getResult(m,d)}_getResult(e,t){if(e.length===0)return g.create(h.DIV_BY_ZERO);const r=e.length;let n=0,s=0;for(let l=0;l<r;l++)n+=e[l],s+=t[l];const a=n/r,u=s/r;let c=0;for(let l=0;l<r;l++){const f=e[l]-a,m=t[l]-u;c+=f*m}return y.create(c/r)}}class hu extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSingleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=F(e,t,r);if(n)return s;const[u,c,l]=a,f=+u.getValue(),m=+c.getValue(),d=+l.getValue();if(f<0||m<=0)return g.create(h.NUM);let C;return d?C=ch(f,m):C=lh(f,m),y.create(C)}}class gu extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSingleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=F(e,t,r);if(n)return s;const[u,c,l]=a,f=+u.getValue(),m=Math.floor(+c.getValue()),d=Math.floor(+l.getValue());if(f<0||m<1||m>10**10||d<1||d>10**10)return g.create(h.NUM);const C=1-Sa(f,m,d);return y.create(C)}}class du extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSingleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=F(e,t,r);if(n)return s;const[u,c,l]=a,f=+u.getValue(),m=Math.floor(+c.getValue()),d=Math.floor(+l.getValue());if(f<0||f>1||m<1||m>10**10||d<1||d>10**10)return g.create(h.NUM);const C=ko(1-f,m,d);return Number.isNaN(C)||!Number.isFinite(C)?g.create(h.NUM):y.create(C)}}class Cu extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,variance:s,ns1:a}=this._getValues(e);if(r)return n;const{isError:u,errorObject:c,variance:l,ns1:f}=this._getValues(t);if(u)return c;let m=2*(1-Sa(s/l,a,f));return m>1&&(m=2-m),y.create(m)}_getValues(e){let t=0,r=0;const n=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1;if(n===1&&s===1){const f=e.isArray()?e.get(0,0):e;return f.isError()?{isError:!0,errorObject:f,variance:t,ns1:r}:f.isNull()?{isError:!0,errorObject:g.create(h.VALUE),variance:t,ns1:r}:{isError:!0,errorObject:g.create(h.DIV_BY_ZERO),variance:t,ns1:r}}const a=[];let u=0;for(let f=0;f<n;f++)for(let m=0;m<s;m++){const d=e.isArray()?e.get(f,m):e;if(d.isError())return{isError:!0,errorObject:d,variance:t,ns1:r};if(d.isNull()||d.isBoolean())continue;const C=d.getValue();M.isRealNum(C)&&(a.push(+C),u+=+C)}if(a.length<=1)return{isError:!0,errorObject:g.create(h.DIV_BY_ZERO),variance:t,ns1:r};const c=u/a.length;let l=0;for(let f=0;f<a.length;f++)l+=(a[f]-c)**2;return r=a.length-1,t=l/r,t===0?{isError:!0,errorObject:g.create(h.DIV_BY_ZERO),variance:t,ns1:r}:{isError:!1,errorObject:null,variance:t,ns1:r}}}class _u extends N{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA)),f=O(s,a,n,g.create(h.NA)),m=u.mapValue((d,C,_)=>{const E=c.get(C,_),R=l.get(C,_),b=f.get(C,_);return d.isError()?d:E.isError()?E:R.isError()?R:b.isError()?b:this._handleSingleObject(d,E,R,b)});return s===1&&a===1?m.get(0,0):m}_handleSingleObject(e,t,r,n){const{isError:s,errorObject:a,variants:u}=F(e,t,r,n);if(s)return a;const[c,l,f,m]=u,d=+c.getValue(),C=+l.getValue(),_=+f.getValue(),E=+m.getValue();if(d<0||C<=0||_<=0)return g.create(h.NUM);let R;return E?R=fh(d,C,_):R=mh(d,C,_),y.create(R)}}class Au extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSingleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=F(e,t,r);if(n)return s;const[u,c,l]=a,f=+u.getValue(),m=+c.getValue(),d=+l.getValue();if(f<0||f>1||m<=0||d<=0)return g.create(h.NUM);const C=hh(f,m,d);return Number.isNaN(C)||!Number.isFinite(C)?g.create(h.NUM):y.create(C)}}class Eu extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSingleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=F(e,t,r);if(n)return s;const[u,c,l]=a,f=+u.getValue(),m=+c.getValue(),d=+l.getValue();if(f<=0||f>=1||d<=0)return g.create(h.NUM);const C=Ch(f,m,d);return Number.isNaN(C)||!Number.isFinite(C)?g.create(h.NUM):y.create(C)}}class Ru extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t={};let r=0,n=1;for(let s=0;s<e.length;s++){const a=e[s];if(a.isError())return a;if(a.isString()){const l=a.convertToNumberObjectValue();if(l.isError())return l}const u=a.isArray()?a.getRowCount():1,c=a.isArray()?a.getColumnCount():1;for(let l=0;l<u;l++)for(let f=0;f<c;f++){const m=a.isArray()?a.get(l,f):a;if(m.isError())return m;if(m.isNull()||m.isBoolean()||m.isString())continue;const d=m.getValue();M.isRealNum(d)&&(t[+d]?(t[+d].count++,t[+d].count>n&&(n=t[+d].count)):t[+d]={count:1,order:r++})}}return r===0||n===1?new g(h.NA):Ko(t,n)}}class bu extends N{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA)),f=O(s,a,n,g.create(h.NA)),m=u.mapValue((d,C,_)=>{const E=c.get(C,_),R=l.get(C,_),b=f.get(C,_);return d.isError()?d:E.isError()?E:R.isError()?R:b.isError()?b:this._handleSingleObject(d,E,R,b)});return s===1&&a===1?m.get(0,0):m}_handleSingleObject(e,t,r,n){const{isError:s,errorObject:a,variants:u}=F(e,t,r,n);if(s)return a;const[c,l,f,m]=u,d=+c.getValue(),C=+l.getValue(),_=+f.getValue(),E=+m.getValue();if(_<=0)return g.create(h.NUM);let R;return E?R=Br(d,C,_):R=Go(d,C,_),y.create(R)}}class yu extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSingleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=F(e,t,r);if(n)return s;const[u,c,l]=a,f=+u.getValue(),m=+c.getValue(),d=+l.getValue();if(f<=0||f>=1||d<=0)return g.create(h.NUM);const C=ns(f,m,d);return y.create(C)}}class pu extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return e.getRowCount()===1&&e.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=F(e);if(t)return r;const[s]=n,a=+s.getValue();if(a<=0||a>=1)return g.create(h.NUM);const u=ns(a,0,1);return y.create(u)}}class Nu extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=nr(e);if(t.isArray()){const n=t.mapValue(s=>this._handleSingleObject(r,s));return n.getRowCount()===1&&n.getColumnCount()===1?n.get(0,0):n}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(!Array.isArray(e))return e;const{isError:r,errorObject:n,variants:s}=F(t);if(r)return n;const[a]=s,u=+a.getValue();return tu(e,u)}}class Vu extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){const n=this._getValues(e);let s=r!=null?r:y.create(3);s.isNull()&&(s=y.create(3));const a=Math.max(t.isArray()?t.getRowCount():1,s.isArray()?s.getRowCount():1),u=Math.max(t.isArray()?t.getColumnCount():1,s.isArray()?s.getColumnCount():1),c=O(a,u,t,g.create(h.NA)),l=O(a,u,s,g.create(h.NA)),f=c.mapValue((m,d,C)=>{const _=l.get(d,C);return m.isError()?m:_.isError()?_:this._handleSingleObject(n,m,_)});return a===1&&u===1?f.get(0,0):f}_handleSingleObject(e,t,r){if(e instanceof g)return e;const{isError:n,errorObject:s,variants:a}=F(t,r);if(n)return s;const[u,c]=a,l=+u.getValue(),f=Math.floor(+c.getValue()),m=e.length;if(m===0||l<e[0]||l>e[m-1])return g.create(h.NA);if(m===1)return l===e[0]?y.create(1):g.create(h.NA);let d=0,C=!1,_=0;for(;!C&&_<m;)l===e[_]?(d=_/(m-1),C=!0):l>e[_]&&_+1<m&&l<e[_+1]&&(d=(_+(l-e[_])/(e[_+1]-e[_]))/(m-1),C=!0),_++;return C?f<1?g.create(h.NUM):(d=We(d,f),y.create(d)):g.create(h.NA)}_getValues(e){const t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let s=0;s<t;s++)for(let a=0;a<r;a++){const u=e.isArray()?e.get(s,a):e;if(u.isError())return u;if(u.isNull()||u.isBoolean())continue;const c=u.getValue();M.isRealNum(c)&&n.push(+c)}return n.sort((s,a)=>s-a)}}class Ou extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSingleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=F(e,t,r);if(n)return s;const[u,c,l]=a,f=Math.floor(+u.getValue()),m=+c.getValue(),d=+l.getValue();if(f<0||m<0)return g.create(h.NUM);let C;return d?C=Ah(f,m):C=Wo(f,m),y.create(C)}}class Su extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=nr(e);if(t.isArray()){const n=t.mapValue(s=>this._handleSingleObject(r,s));return n.getRowCount()===1&&n.getColumnCount()===1?n.get(0,0):n}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(!Array.isArray(e))return e;const{isError:r,errorObject:n,variants:s}=F(t);if(r)return n;const[a]=s,u=Math.floor(+a.getValue());return nu(e,u)}}class Mu extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=this.flattenArray(e);return t.isError()?t:t.std()}}class Du extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=this.flattenArray(e);return t.isError()?t:t.std(1)}}class wu extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.mapValue((c,l,f)=>{const m=a.get(l,f);return c.isError()?c:m.isError()?m:this._handleSingleObject(c,m)});return r===1&&n===1?u.get(0,0):u}_handleSingleObject(e,t){const{isError:r,errorObject:n,variants:s}=F(e,t);if(r)return n;const[a,u]=s,c=+a.getValue(),l=Math.floor(+u.getValue());if(c<=0||c>1||l<1||l>10**10)return g.create(h.NUM);const f=Math.abs(ss(c/2,l));return Number.isNaN(f)||!Number.isFinite(f)?g.create(h.NUM):y.create(f)}}class Lu extends N{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4)}calculate(e,t,r,n){const{isError:s,errorObject:a,array1Values:u,array2Values:c}=this._handleArray1AndArray2(e,t),l=this._getArrayValues(e),f=this._getArrayValues(t),m=Math.max(r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),d=Math.max(r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),C=O(m,d,r,g.create(h.NA)),_=O(m,d,n,g.create(h.NA)),E=C.mapValue((R,b,p)=>{const V=_.get(b,p);if(e.isError())return e;if(t.isError())return t;if(R.isError())return R;if(V.isError())return V;const{isError:S,errorObject:D,variants:w}=F(R,V);if(S)return D;const[L,P]=w,v=Math.floor(+L.getValue()),U=Math.floor(+P.getValue());return![1,2].includes(v)||![1,2,3].includes(U)?g.create(h.NUM):U===1&&s?a:U!==1&&l instanceof g?l:U!==1&&f instanceof g?f:this._handleSingleObject(U===1?u:l,U===1?c:f,v,U)});return m===1&&d===1?E.get(0,0):E}_handleSingleObject(e,t,r,n){if(e.length<2||t.length<2)return g.create(h.DIV_BY_ZERO);const{isError:s,errorObject:a,x:u,degFreedom:c}=this._getTDistParamByArrayValues(e,t,n);if(s)return a;let l=kr(-u,c);return r===2&&(l*=2),Number.isNaN(l)||!Number.isFinite(l)?g.create(h.NUM):y.create(l)}_getArrayValues(e){const t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let s=0;s<t;s++)for(let a=0;a<r;a++){const u=e.isArray()?e.get(s,a):e;if(u.isError())return u;if(u.isNull()){if(t*r===1)return g.create(h.VALUE);continue}u.isBoolean()||u.isString()||n.push(+u.getValue())}return n}_handleArray1AndArray2(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1;let u=e;if(e.isArray()&&r===1&&n===1&&(u=e.get(0,0)),u.isError())return{isError:!0,errorObject:u,array1Values:[],array2Values:[]};let c=t;if(t.isArray()&&s===1&&a===1&&(c=t.get(0,0)),c.isError())return{isError:!0,errorObject:c,array1Values:[],array2Values:[]};if((r*n===1||s*a===1)&&(u.isNull()||c.isNull()))return{isError:!0,errorObject:g.create(h.VALUE),array1Values:[],array2Values:[]};if(r*n!==s*a)return{isError:!0,errorObject:g.create(h.NA),array1Values:[],array2Values:[]};const{isError:l,errorObject:f,array1Values:m,array2Values:d,noCalculate:C}=Ke(e,t,r*n,n,a);return l?{isError:!0,errorObject:f,array1Values:[],array2Values:[]}:C||m.length<2?{isError:!0,errorObject:g.create(h.DIV_BY_ZERO),array1Values:[],array2Values:[]}:{isError:!1,errorObject:null,array1Values:m,array2Values:d}}_getTDistParamByArrayValues(e,t,r){return r===1?this._getTDistParamByType1(e,t):r===2?this._getTDistParamByType2(e,t):this._getTDistParamByType3(e,t)}_getTDistParamByType1(e,t){const r=e.length;let n=0,s=0,a=0;for(let m=0;m<r;m++)n+=e[m],s+=t[m],a+=(e[m]-t[m])**2;const u=n-s,c=r*a-u**2,l=r-1;return c===0?{isError:!0,errorObject:g.create(h.DIV_BY_ZERO),x:0,degFreedom:l}:{isError:!1,errorObject:null,x:Math.abs(u)*Math.sqrt(l/c),degFreedom:l}}_getTDistParamByType2(e,t){const r=e.length,n=t.length;let s=0,a=0;for(let E=0;E<r;E++)s+=e[E],a+=e[E]**2;let u=0,c=0;for(let E=0;E<n;E++)u+=t[E],c+=t[E]**2;const l=a-s**2/r,f=c-u**2/n,m=Math.sqrt(l+f);if(m===0)return{isError:!0,errorObject:g.create(h.DIV_BY_ZERO),x:0,degFreedom:0};const d=r-1+n-1,C=Math.sqrt(r*n*d/(r+n));return{isError:!1,errorObject:null,x:Math.abs(s/r-u/n)/m*C,degFreedom:d}}_getTDistParamByType3(e,t){const r=e.length,n=t.length;let s=0,a=0;for(let _=0;_<r;_++)s+=e[_],a+=e[_]**2;let u=0,c=0;for(let _=0;_<n;_++)u+=t[_],c+=t[_]**2;const l=(a-s**2/r)/(r*(r-1)),f=(c-u**2/n)/(n*(n-1));if(l+f===0)return{isError:!0,errorObject:g.create(h.DIV_BY_ZERO),x:0,degFreedom:0};const m=l/(l+f),d=Math.abs(s/r-u/n)/Math.sqrt(l+f),C=1/(m**2/(r-1)+(1-m)**2/(n-1));return{isError:!1,errorObject:null,x:d,degFreedom:C}}}class Pu extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=this.flattenArray(e);return t.isError()?t:t.var()}}class xu extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=this.flattenArray(e);return t.isError()?t:t.var(1)}}class ju extends N{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA)),f=O(s,a,n,g.create(h.NA)),m=u.mapValue((d,C,_)=>{const E=c.get(C,_),R=l.get(C,_),b=f.get(C,_);return d.isError()?d:E.isError()?E:R.isError()?R:b.isError()?b:this._handleSingleObject(d,E,R,b)});return s===1&&a===1?m.get(0,0):m}_handleSingleObject(e,t,r,n){const{isError:s,errorObject:a,variants:u}=F(e,t,r,n);if(s)return a;const[c,l,f,m]=u,d=+c.getValue(),C=+l.getValue(),_=+f.getValue(),E=+m.getValue();if(d<0||C<=0||_<=0)return g.create(h.NUM);const R=Math.exp(-((d/_)**C));let b;return E?b=1-R:b=C/_**C*d**(C-1)*R,Number.isNaN(b)||!Number.isFinite(b)?g.create(h.NUM):y.create(b)}}class Uu extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){const n=this._getArrayValues(e),s=Math.max(t.isArray()?t.getRowCount():1,r!=null&&r.isArray()?r.getRowCount():1),a=Math.max(t.isArray()?t.getColumnCount():1,r!=null&&r.isArray()?r.getColumnCount():1),u=O(s,a,t,g.create(h.NA)),c=r?O(s,a,r,g.create(h.NA)):void 0,l=u.mapValue((f,m,d)=>{if(n instanceof g)return n;if(f.isError())return f;const C=r?c.get(m,d):void 0;return C!=null&&C.isError()?C:n.length===0?g.create(h.NA):n.length===1?g.create(h.DIV_BY_ZERO):this._handleSingleObject(n,f,C)});return s===1&&a===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=F(t);if(n)return s;const[u]=a,c=+u.getValue(),l=e.length;let f=0,m=0;for(let E=0;E<l;E++)f+=e[E],m+=e[E]**2;let d=0;if(r!==void 0){const{isError:E,errorObject:R,variants:b}=F(r);if(E)return R;const[p]=b;d=+p.getValue()}else{const E=f/l;d=Math.sqrt((m-2*E*f+l*E**2)/(l-1))}if(d<=0)return g.create(h.NUM);const C=(f/l-c)/(d/Math.sqrt(l)),_=1-Br(C,0,1);return Number.isNaN(_)||!Number.isFinite(_)?g.create(h.NUM):y.create(_)}_getArrayValues(e){const t=[],r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1;for(let s=0;s<r;s++)for(let a=0;a<n;a++){const u=e.isArray()?e.get(s,a):e;if(u.isError())return u;if(u.isNull()||u.isBoolean()||u.isString())continue;const c=u.getValue();M.isRealNum(c)&&t.push(+c)}return t}}class yh extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",5)}calculate(e,t,r,n,s){let a=n!=null?n:y.create(0),u=s!=null?s:y.create(1);a.isNull()&&(a=y.create(0)),u.isNull()&&(u=y.create(1));const c=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1,u.isArray()?u.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1,u.isArray()?u.getColumnCount():1),f=O(c,l,e,g.create(h.NA)),m=O(c,l,t,g.create(h.NA)),d=O(c,l,r,g.create(h.NA)),C=O(c,l,a,g.create(h.NA)),_=O(c,l,u,g.create(h.NA)),E=f.mapValue((R,b,p)=>{const V=m.get(b,p),S=d.get(b,p),D=C.get(b,p),w=_.get(b,p);return this._handleSingleObject(R,V,S,D,w)});return c===1&&l===1?E.get(0,0):E}_handleSingleObject(e,t,r,n,s){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(n.isError())return n;if(s.isError())return s;const{isError:a,errorObject:u,variants:c}=F(e,t,r,n,s);if(a)return u;const[l,f,m,d,C]=c,_=+l.getValue(),E=+f.getValue(),R=+m.getValue(),b=+d.getValue(),p=+C.getValue();if(E<=0||R<=0||_<b||_>p||b===p)return g.create(h.NUM);const V=Io((_-b)/(p-b),E,R);return y.create(V)}}var me=(i=>(i.BETADIST="BETADIST",i.BETAINV="BETAINV",i.BINOMDIST="BINOMDIST",i.CHIDIST="CHIDIST",i.CHIINV="CHIINV",i.CHITEST="CHITEST",i.CONFIDENCE="CONFIDENCE",i.COVAR="COVAR",i.CRITBINOM="CRITBINOM",i.EXPONDIST="EXPONDIST",i.FDIST="FDIST",i.FINV="FINV",i.FTEST="FTEST",i.GAMMADIST="GAMMADIST",i.GAMMAINV="GAMMAINV",i.HYPGEOMDIST="HYPGEOMDIST",i.LOGINV="LOGINV",i.LOGNORMDIST="LOGNORMDIST",i.MODE="MODE",i.NEGBINOMDIST="NEGBINOMDIST",i.NORMDIST="NORMDIST",i.NORMINV="NORMINV",i.NORMSDIST="NORMSDIST",i.NORMSINV="NORMSINV",i.PERCENTILE="PERCENTILE",i.PERCENTRANK="PERCENTRANK",i.POISSON="POISSON",i.QUARTILE="QUARTILE",i.RANK="RANK",i.STDEV="STDEV",i.STDEVP="STDEVP",i.TDIST="TDIST",i.TINV="TINV",i.TTEST="TTEST",i.VAR="VAR",i.VARP="VARP",i.WEIBULL="WEIBULL",i.ZTEST="ZTEST",i))(me||{});class ph extends N{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA)),f=O(s,a,n,g.create(h.NA)),m=u.mapValue((d,C,_)=>{const E=c.get(C,_),R=l.get(C,_),b=f.get(C,_);return d.isError()?d:E.isError()?E:R.isError()?R:b.isError()?b:this._handleSingleObject(d,E,R,b)});return s===1&&a===1?m.get(0,0):m}_handleSingleObject(e,t,r,n){const{isError:s,errorObject:a,variants:u}=F(e,t,r,n);if(s)return a;const[c,l,f,m]=u,d=Math.floor(+c.getValue()),C=Math.floor(+l.getValue()),_=Math.floor(+f.getValue()),E=Math.floor(+m.getValue());if(d<0||d>C||d>_||d<C-E+_||C<=0||C>E||_<=0||_>E||E<=0)return g.create(h.NUM);let R=Da(d,C,_,E);return Number.isNaN(R)&&(R=0),y.create(R)}}class Nh extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSingleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=F(e,t,r);if(n)return s;const[u,c,l]=a,f=+u.getValue(),m=+c.getValue(),d=+l.getValue();if(f<=0||d<=0)return g.create(h.NUM);const C=Ho(f,m,d);return y.create(C)}}class Vh extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSingleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=F(e,t,r);if(n)return s;const[u,c,l]=a,f=Math.floor(+u.getValue()),m=Math.floor(+c.getValue()),d=+l.getValue();if(f<0||m<1||d<=0||d>=1)return g.create(h.NUM);const C=wa(f,m,d);return y.create(C)}}class Oh extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return e.getRowCount()===1&&e.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=F(e);if(t)return r;const[s]=n,a=+s.getValue(),u=Br(a,0,1);return y.create(u)}}class Sh extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3);A(this,"needsReferenceObject",!0)}calculate(e,t,r){let n=e;n.isReferenceObject()&&(n=n.toArrayValueObject());const{refHasError:s,refErrorObject:a,refNumbers:u}=this._checkRefReferenceObject(t);let c=r!=null?r:y.create(0);c.isReferenceObject()&&(c=c.toArrayValueObject());const l=Math.max(n.isArray()?n.getRowCount():1,c.isArray()?c.getRowCount():1),f=Math.max(n.isArray()?n.getColumnCount():1,c.isArray()?c.getColumnCount():1),m=O(l,f,n,g.create(h.NA)),d=O(l,f,c,g.create(h.NA)),C=m.map((_,E,R)=>{const b=d.get(E,R);if(!e.isReferenceObject()&&e.isNull())return g.create(h.NA);if(s)return a;if(b.isError())return b;const p=+_.getValue(),V=+b.getValue();if(Number.isNaN(p)||Number.isNaN(V))return g.create(h.VALUE);const D=u.sort((w,L)=>V?w-L:L-w).indexOf(p);return D===-1?g.create(h.NA):y.create(D+1)});return l===1&&f===1?C.get(0,0):C}_checkRefReferenceObject(e){let t=!1,r=g.create(h.NA);const n=[];return e.isReferenceObject()?(e.toArrayValueObject().iterator(a=>{const u=a;if(u.isError())return t=!0,r=u,!1;if(u.isNull()||u.isBoolean())return!0;const c=+u.getValue();if(Number.isNaN(c))return!0;n.push(c)}),{refHasError:t,refErrorObject:r,refNumbers:n}):{refHasError:!0,refErrorObject:r,refNumbers:n}}}class Mh extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSingleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=F(e,t,r);if(n)return s;const[u,c,l]=a,f=+u.getValue(),m=Math.floor(+c.getValue()),d=Math.floor(+l.getValue());if(f<0||m<1||m>10**10||d<1||d>2)return g.create(h.NUM);let C=kr(-f,m);return d===2&&(C*=2),Number.isNaN(C)||!Number.isFinite(C)?g.create(h.NUM):y.create(C)}}const Tu=[[yh,me.BETADIST],[au,me.BETAINV],[iu,me.BINOMDIST],[uu,me.CHIDIST],[cu,me.CHIINV],[lu,me.CHITEST],[fu,me.CONFIDENCE],[mu,me.COVAR],[ou,me.CRITBINOM],[hu,me.EXPONDIST],[gu,me.FDIST],[du,me.FINV],[Cu,me.FTEST],[_u,me.GAMMADIST],[Au,me.GAMMAINV],[ph,me.HYPGEOMDIST],[Nh,me.LOGNORMDIST],[Eu,me.LOGINV],[Ru,me.MODE],[Vh,me.NEGBINOMDIST],[bu,me.NORMDIST],[yu,me.NORMINV],[Oh,me.NORMSDIST],[pu,me.NORMSINV],[Nu,me.PERCENTILE],[Vu,me.PERCENTRANK],[Ou,me.POISSON],[Su,me.QUARTILE],[Sh,me.RANK],[Du,me.STDEV],[Mu,me.STDEVP],[Mh,me.TDIST],[wu,me.TINV],[Lu,me.TTEST],[xu,me.VAR],[Pu,me.VARP],[ju,me.WEIBULL],[Uu,me.ZTEST]],vu=[];var Iu=(i=>(i.CUBEKPIMEMBER="CUBEKPIMEMBER",i.CUBEMEMBER="CUBEMEMBER",i.CUBEMEMBERPROPERTY="CUBEMEMBERPROPERTY",i.CUBERANKEDMEMBER="CUBERANKEDMEMBER",i.CUBESET="CUBESET",i.CUBESETCOUNT="CUBESETCOUNT",i.CUBEVALUE="CUBEVALUE",i))(Iu||{});class Fu extends N{isCustom(){return!0}}class Dh extends Fu{isAsync(){return!0}}function Ze(i){const o=[];if(i.isError())return{isError:!0,errorObject:i,databaseValues:o};const e=i.isArray()?i.getRowCount():1,t=i.isArray()?i.getColumnCount():1;if(e<2)return{isError:!0,errorObject:g.create(h.VALUE),databaseValues:o};for(let r=0;r<e;r++){const n=[];for(let s=0;s<t;s++){const a=i.get(r,s);if(a.isNull()){n.push(null);continue}let u=`${a.getValue()}`;if(a.isBoolean()&&(u=u.toLocaleUpperCase()),a.isNumber()||M.isRealNum(u)){n.push(+u);continue}n.push(u)}o.push(n)}return{isError:!1,errorObject:null,databaseValues:o}}function ze(i,o){let e=-1;if(i.isError())return{isError:!0,errorObject:i,fieldIndex:e};const t=i.isArray()?i.getRowCount():1,r=i.isArray()?i.getColumnCount():1;if(t>1||r>1)return{isError:!0,errorObject:g.create(h.VALUE),fieldIndex:e};const n=i.isArray()?i.get(0,0):i;let s=`${n.getValue()}`;if(n.isNull()?s=0:n.isBoolean()?s=n.getValue()?1:0:(n.isNumber()||M.isRealNum(s))&&(s=Math.floor(+s)),typeof s=="number"){if(s<1||s>o[0].length)return{isError:!0,errorObject:g.create(h.VALUE),fieldIndex:e};e=s-1}else if(e=o[0].findIndex(a=>a===null?!1:`${a}`.toLocaleLowerCase()===s.toLocaleLowerCase()),e===-1)return{isError:!0,errorObject:g.create(h.VALUE),fieldIndex:e};return{isError:!1,errorObject:null,fieldIndex:e}}function Je(i){const o=[];if(i.isError())return{isError:!0,errorObject:i,criteriaValues:o};const e=i.isArray()?i.getRowCount():1,t=i.isArray()?i.getColumnCount():1;if(e<2)return{isError:!0,errorObject:g.create(h.VALUE),criteriaValues:o};for(let r=0;r<e;r++){const n=[];for(let s=0;s<t;s++){const a=i.get(r,s);if(a.isNull()){n.push(null);continue}const u=`${a.getValue()}`;if(a.isBoolean()){n.push(a.getValue()?1:0);continue}if(a.isNumber()||M.isRealNum(u)){n.push(+u);continue}n.push(u)}o.push(n)}return{isError:!1,errorObject:null,criteriaValues:o}}function et(i,o,e){const t=i.length,r=i[0].length,n={};let s=!1;for(let a=1;a<t;a++){let u=!0;for(let c=0;c<r;c++){const l=i[a][c];if(l===null)continue;let f=n[c];if(f===void 0){const m=i[0][c];f=o[0].findIndex(d=>d===null||m===null?!1:`${d}`.toLocaleLowerCase()===`${m}`.toLocaleLowerCase()),n[c]=f}if(f===-1&&(typeof l=="string"||l===0)){u=!1;break}else if(f>-1){const m=o[e][f];if(m===null){u=!1;break}const[d,C]=fa(`${l}`);if(!dt.create(`${m}`).compare(C,d).getValue()){u=!1;break}}}if(u){s=!0;break}}return s}class wh extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:a}=Ze(e);if(n)return s;const{isError:u,errorObject:c,fieldIndex:l}=ze(t,a);if(u)return c;const{isError:f,errorObject:m,criteriaValues:d}=Je(r);if(f)return m;let C=0,_=0;for(let E=1;E<a.length;E++){const R=a[E][l];typeof R=="number"&&et(d,a,E)&&(C+=R,_++)}return _===0?g.create(h.DIV_BY_ZERO):y.create(C/_)}}class Lh extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:a}=Ze(e);if(n)return s;const{isError:u,errorObject:c,fieldIndex:l}=ze(t,a);if(u)return c;const{isError:f,errorObject:m,criteriaValues:d}=Je(r);if(f)return m;let C=0;for(let _=1;_<a.length;_++)typeof a[_][l]=="number"&&et(d,a,_)&&C++;return y.create(C)}}class Ph extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:a}=Ze(e);if(n)return s;const{isError:u,errorObject:c,fieldIndex:l}=ze(t,a);if(u)return c;const{isError:f,errorObject:m,criteriaValues:d}=Je(r);if(f)return m;let C=0;for(let _=1;_<a.length;_++){const E=a[_][l];E!=null&&et(d,a,_)&&C++}return y.create(C)}}class xh extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:a}=Ze(e);if(n)return s;const{isError:u,errorObject:c,fieldIndex:l}=ze(t,a);if(u)return c;const{isError:f,errorObject:m,criteriaValues:d}=Je(r);if(f)return m;let C=0,_=0;for(let E=1;E<a.length;E++){const R=a[E][l];R!=null&&et(d,a,E)&&(C++,_=E)}return C===0?g.create(h.VALUE):C>1?g.create(h.NUM):e.get(_,l)}}class jh extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:a}=Ze(e);if(n)return s;const{isError:u,errorObject:c,fieldIndex:l}=ze(t,a);if(u)return c;const{isError:f,errorObject:m,criteriaValues:d}=Je(r);if(f)return m;let C=-1/0,_=0;for(let E=1;E<a.length;E++){const R=a[E][l];typeof R=="number"&&et(d,a,E)&&(C=Math.max(C,R),_++)}return _===0?y.create(0):y.create(C)}}class Uh extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:a}=Ze(e);if(n)return s;const{isError:u,errorObject:c,fieldIndex:l}=ze(t,a);if(u)return c;const{isError:f,errorObject:m,criteriaValues:d}=Je(r);if(f)return m;let C=1/0,_=0;for(let E=1;E<a.length;E++){const R=a[E][l];typeof R=="number"&&et(d,a,E)&&(C=Math.min(C,R),_++)}return _===0?y.create(0):y.create(C)}}class Th extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:a}=Ze(e);if(n)return s;const{isError:u,errorObject:c,fieldIndex:l}=ze(t,a);if(u)return c;const{isError:f,errorObject:m,criteriaValues:d}=Je(r);if(f)return m;let C=1,_=0;for(let E=1;E<a.length;E++){const R=a[E][l];typeof R=="number"&&et(d,a,E)&&(C*=R,_++)}return _===0?y.create(0):y.create(C)}}class vh extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:a}=Ze(e);if(n)return s;const{isError:u,errorObject:c,fieldIndex:l}=ze(t,a);if(u)return c;const{isError:f,errorObject:m,criteriaValues:d}=Je(r);if(f)return m;const C=[];let _=0,E=0;for(let V=1;V<a.length;V++){const S=a[V][l];typeof S=="number"&&et(d,a,V)&&(C.push(S),_+=S,E++)}if(E<=1)return g.create(h.DIV_BY_ZERO);const R=_/E;let b=0;for(let V=0;V<E;V++)b+=(C[V]-R)**2;const p=Math.sqrt(b/(E-1));return y.create(p)}}class Ih extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:a}=Ze(e);if(n)return s;const{isError:u,errorObject:c,fieldIndex:l}=ze(t,a);if(u)return c;const{isError:f,errorObject:m,criteriaValues:d}=Je(r);if(f)return m;const C=[];let _=0,E=0;for(let V=1;V<a.length;V++){const S=a[V][l];typeof S=="number"&&et(d,a,V)&&(C.push(S),_+=S,E++)}if(E===0)return g.create(h.DIV_BY_ZERO);const R=_/E;let b=0;for(let V=0;V<E;V++)b+=(C[V]-R)**2;const p=Math.sqrt(b/E);return y.create(p)}}class Fh extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:a}=Ze(e);if(n)return s;const{isError:u,errorObject:c,fieldIndex:l}=ze(t,a);if(u)return c;const{isError:f,errorObject:m,criteriaValues:d}=Je(r);if(f)return m;let C=0;for(let _=1;_<a.length;_++){const E=a[_][l];typeof E=="number"&&et(d,a,_)&&(C+=E)}return y.create(C)}}class Bh extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:a}=Ze(e);if(n)return s;const{isError:u,errorObject:c,fieldIndex:l}=ze(t,a);if(u)return c;const{isError:f,errorObject:m,criteriaValues:d}=Je(r);if(f)return m;const C=[];let _=0,E=0;for(let V=1;V<a.length;V++){const S=a[V][l];typeof S=="number"&&et(d,a,V)&&(C.push(S),_+=S,E++)}if(E<=1)return g.create(h.DIV_BY_ZERO);const R=_/E;let b=0;for(let V=0;V<E;V++)b+=(C[V]-R)**2;const p=b/(E-1);return y.create(p)}}class kh extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:a}=Ze(e);if(n)return s;const{isError:u,errorObject:c,fieldIndex:l}=ze(t,a);if(u)return c;const{isError:f,errorObject:m,criteriaValues:d}=Je(r);if(f)return m;const C=[];let _=0,E=0;for(let V=1;V<a.length;V++){const S=a[V][l];typeof S=="number"&&et(d,a,V)&&(C.push(S),_+=S,E++)}if(E===0)return g.create(h.DIV_BY_ZERO);const R=_/E;let b=0;for(let V=0;V<E;V++)b+=(C[V]-R)**2;const p=b/E;return y.create(p)}}var Be=(i=>(i.DAVERAGE="DAVERAGE",i.DCOUNT="DCOUNT",i.DCOUNTA="DCOUNTA",i.DGET="DGET",i.DMAX="DMAX",i.DMIN="DMIN",i.DPRODUCT="DPRODUCT",i.DSTDEV="DSTDEV",i.DSTDEVP="DSTDEVP",i.DSUM="DSUM",i.DVAR="DVAR",i.DVARP="DVARP",i))(Be||{});const Bu=[[wh,Be.DAVERAGE],[Lh,Be.DCOUNT],[Ph,Be.DCOUNTA],[xh,Be.DGET],[jh,Be.DMAX],[Uh,Be.DMIN],[Th,Be.DPRODUCT],[vh,Be.DSTDEV],[Ih,Be.DSTDEVP],[Fh,Be.DSUM],[Bh,Be.DVAR],[kh,Be.DVARP]],La="yyyy/mm/dd;@",$h="yyyy/mm/dd hh:mm",Yh="h:mm A/P";function ye(i){const o=new Date(Date.UTC(1900,0,1)),e=new Date(Date.UTC(1900,1,28)),t=Date.UTC(i.getFullYear(),i.getMonth(),i.getDate());let r=(t-o.getTime())/(1e3*3600*24);return t>e.getTime()&&(r+=1),Math.floor(r)+1}function $r(i){const o=new Date(Date.UTC(1900,0,1,0,0,0)),e=new Date(Date.UTC(1900,1,28,0,0,0));let r=(i.getTime()-o.getTime())/(1e3*3600*24);return i>e&&(r+=1),r+1}function ae(i){const o=new Date(Date.UTC(1900,0,1)),e=new Date(Date.UTC(1900,1,28));let t=Math.floor(i)-1;return t>(e.getTime()-o.getTime())/(1e3*3600*24)&&(t-=1),new Date(o.getTime()+t*(1e3*3600*24))}function Pa(i){const o=new Date(Date.UTC(1900,0,1,0,0,0)),e=new Date(Date.UTC(1900,1,28,0,0,0));let t=i-1;return t>(e.getTime()-o.getTime())/(1e3*3600*24)&&(t-=1),t<0&&(t=i),new Date(o.getTime()+t*(1e3*3600*24))}function xa(i){if(!/^\d{4}[-/](0?[1-9]|1[012])[-/](0?[1-9]|[12][0-9]|3[01])$/.test(i))return!1;const e=i.replace(/-/g,"/").replace(/T.+/,""),t=new Date(`${e}`);if(Number.isNaN(t.getTime()))return!1;const r=t.getFullYear(),n=(t.getMonth()+1).toString().padStart(2,"0"),s=t.getDate().toString().padStart(2,"0"),a=`${r}-${n}-${s}`;return i.replace(/\//g,"-").split("-").map(c=>c.padStart(2,"0")).join("-")===a}function Sn(i){return M.numfmt.parseDate(i)}function Hh(i){return M.numfmt.parseValue(i)}function Mn(i){return M.numfmt.parseTime(i)}function ja(i){return M.numfmt.getFormatInfo(i).isDate}const ku={1:[6,0],2:[0,1],3:[1,2],4:[2,3],5:[3,4],6:[4,5],7:[5,6],11:[0],12:[1],13:[2],14:[3],15:[4],16:[5],17:[6]};function xr(i){return!!(typeof i=="string"&&/^[0|1]{7}/.test(i)||ku[Number(i)])}function $u(i){if(!xr(i))return[];if(typeof i=="string"&&/^[0|1]{7}/.test(i)){const o=[];for(let e=1;e<=i.length;e++)`${i[e-1]}`=="1"&&(e===i.length?o.push(0):o.push(e));return o}return ku[Number(i)]||[]}function Dn(i,o,e=1,t){const r=$u(e),n=Math.floor(i),s=Math.floor(o),a=s>n?n:s;let u=0;const c=Math.abs(Math.floor(o)-Math.floor(i))+1;for(let l=0;l<c;l++){const f=a+l;if(t&&t.length>0&&t.some(d=>Math.floor(d)===f))continue;const m=Zt(f);r.includes(m)||u++}return s>=n?u:-u}function wn(i,o,e=1,t){const r=$u(e),n=Math.floor(i);let s=n,a=Math.abs(o);for(let u=1;u<=a;u++){const c=o<0?n-u:n+u;if(c<0)return g.create(h.NUM);if(t&&t.length>0&&t.some(f=>Math.floor(f)===c)){a++;continue}const l=Zt(c);if(r.includes(l)){a++;continue}s=c}return s}function G(i){if(i.isError())return i;const o=i.getValue();if(i.isString()){let e;if(Sn(`${o}`))e=Sn(`${o}`).v;else if(Mn(`${o}`))e=Mn(`${o}`).v;else if(M.isRealNum(o))e=+o;else return g.create(h.VALUE);return e instanceof Date&&(e=$r(e)),+e<0||+e>2958465?g.create(h.NUM):+e}else{const e=+i.getValue();return e<0||e>2958465?g.create(h.NUM):e}}function Zt(i){const o=Math.floor(i)===60;let e=ae(i);const t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())).getTime(),r=new Date(Date.UTC(1900,1,28)).getTime();return!o&&t<=r&&(e=new Date(t-24*3600*1e3)),new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())).getUTCDay()}function Ae(i,o,e){switch(e){case 0:return Gh(i,o);case 1:return Wh(i,o);case 2:return{days:Math.abs(o-i),yearDays:360};case 3:return{days:Math.abs(o-i),yearDays:365};case 4:return Qh(i,o);default:return{days:Math.abs(o-i),yearDays:365}}}function Gh(i,o){const e=ae(i),t=i>0?e.getUTCFullYear():1900,r=i>0?e.getUTCMonth()+1:1;let n=i>0?e.getUTCDate():0,s=ae(o),a=o>0?s.getUTCFullYear():1900,u=o>0?s.getUTCMonth()+1:1,c=o>0?s.getUTCDate():0;r===2?ae(i+1).getUTCMonth()+1===3&&(n=30):n===31&&(n=30),c===31&&(n<30?(s=ae(o+1),a=s.getUTCFullYear(),u=s.getUTCMonth()+1,c=s.getUTCDate()):c=30);const l=(a-t)*360,f=o>=i?30-n:-n,m=o>=i?c:c-30,d=(o>=i?u-r-1:u-r+1)*30;return{days:Math.abs(l+f+m+d),yearDays:360}}function Wh(i,o){const e=ae(i),t=i>0?e.getUTCFullYear():1900,r=ae(o),n=o>0?r.getUTCFullYear():1900,s=Math.abs(o-i),a=Math.abs(n-t)+1;let u,c;if(n<t){const l=new Date(Date.UTC(n,0,1)),f=new Date(Date.UTC(t,11,31));u=ye(l),c=ye(f),n===1900&&(u+=1)}else{const l=new Date(Date.UTC(t,0,1)),f=new Date(Date.UTC(n,11,31));u=ye(l),c=ye(f),t===1900&&(u+=1)}return{days:s,yearDays:(c-u+1)/a}}function Qh(i,o){const e=ae(i),t=i>0?e.getUTCFullYear():1900,r=i>0?e.getUTCMonth()+1:1;let n=i>0?e.getUTCDate():0;const s=ae(o),a=o>0?s.getUTCFullYear():1900,u=o>0?s.getUTCMonth()+1:1;let c=o>0?s.getUTCDate():0;n===31&&(n=30),c===31&&(c=30);const l=(a-t)*360,f=o>=i?30-n:-n,m=o>=i?c:c-30,d=(o>=i?u-r-1:u-r+1)*30;return{days:Math.abs(l+f+m+d),yearDays:360}}function qh(i){return i%4===0&&i%100!==0||i%400===0}function Xh(i){return i%4===0&&i%100!==0||i%400===0||i===1900}const Kh=[31,29,31,30,31,30,31,31,30,31,30,31],Zh=[31,28,31,30,31,30,31,31,30,31,30,31];function Yr(i,o){return qh(i)?Kh[o]:Zh[o]}function cs(i){return Xh(i)?366:365}function Yu(i,o){switch(o){case 0:case 2:case 4:return 360;case 1:return cs(ae(i).getUTCFullYear());case 3:return 365;default:return-1}}function dr(i,o,e){return Yr(i,o)===e}function Cr(i,o){let e=i.getUTCFullYear(),t=i.getUTCMonth();const r=i.getUTCDate();return dr(e,t,r)?(i.setUTCDate(1),i.setUTCMonth(i.getUTCMonth()+o),e=i.getUTCFullYear(),t=i.getUTCMonth(),i.setUTCDate(Yr(e,t))):i.setUTCMonth(i.getUTCMonth()+o),i}class zh extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.map((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);if(f.isError())return f;if(C.isError())return C;if(_.isError())return _;const{isError:E,errorObject:R,variants:b}=F(f,C,_);if(E)return R;const[p,V,S]=b;let D=Math.floor(+p.getValue());const w=Math.floor(+V.getValue()),L=Math.floor(+S.getValue());if(D<0||D>9999)return g.create(h.NUM);D>=0&&D<1899&&(D+=1900);const P=new Date(D,w-1,L),v=ye(P);return v<0?g.create(h.NUM):y.create(v,La)});return n===1&&s===1?l.get(0,0):l}}class Jh extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){let n=e,s=t,a=r;if(n.isArray()&&(n=n.get(0,0)),s.isArray()&&(s=s.get(0,0)),a.isArray()&&(a=a.get(0,0)),n.isError())return n;if(s.isError())return s;if(a.isError())return a;const u=G(n);if(typeof u!="number")return u;const c=G(s);return typeof c!="number"?c:c<u||!a.isString()?g.create(h.NUM):this._getResultByUnit(u,c,a)}_getResultByUnit(e,t,r){const n=ae(e),s=n.getUTCFullYear(),a=n.getUTCMonth()+1,u=n.getUTCDate(),c=ae(t),l=c.getUTCFullYear(),f=c.getUTCMonth()+1,m=c.getUTCDate(),d=`${r.getValue()}`.toLocaleUpperCase();let C=0,_;switch(d){case"Y":C=l-s,(f<a||f===a&&m<u)&&(C-=1);break;case"M":C=(l-s)*12+f-a,m<u&&(C-=1);break;case"D":C=Math.floor(t)-Math.floor(e);break;case"MD":C=m-u,m<u&&(_=new Date(Date.UTC(l,f-1,0)),C+=Yr(_.getUTCFullYear(),_.getUTCMonth()));break;case"YM":C=f-a,(f<a||f===a&&m<u)&&(C+=12),m<u&&(C-=1);break;case"YD":_=new Date(Date.UTC(s,f-1,m)),(f<a||f===a&&m<u)&&(_=new Date(Date.UTC(s+1,f-1,m))),C=Math.floor(ye(_))-Math.floor(e);break;default:return g.create(h.NUM)}return y.create(C)}}class eg extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}isArgumentsIgnoreNumberPattern(){return!0}calculate(e){return e.isArray()?e.mapValue(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isString()){const t=`${e.getValue()}`;let r=Sn(t);if(r===null&&(r=Mn(t)),r){let{v:n,z:s}=r;if(s&&ja(s))return n instanceof Date&&(n=$r(n)),y.create(Math.trunc(+n))}}return g.create(h.VALUE)}}class tg extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t;const r=e.getValue();if(e.isString()){if(!xa(`${r}`))return g.create(h.VALUE);t=new Date(`${r}`)}else{const a=+e.getValue();if(a<0)return g.create(h.NUM);if(a===0)return y.create(0);t=ae(a)}const n=t.getDate();return y.create(n)}}class rg extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e),a=O(r,n,t),u=s.map((c,l,f)=>{const m=a.get(l,f);if(c.isError())return c;if(m.isError())return m;const d=G(c);if(typeof d!="number")return d;const C=G(m);if(typeof C!="number")return C;const _=Math.floor(d)-Math.floor(C);return y.create(_)});return r===1&&n===1?u.get(0,0):u}}class ng extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){const n=r!=null?r:I.create(!1);if(e.isError())return e;if(t.isError())return t;if(n.isError())return n;const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,n,g.create(h.NA)),f=u.map((m,d,C)=>{const _=c.get(d,C);let E=l.get(d,C);if(m.isError())return m;const R=G(m);if(typeof R!="number")return R;if(_.isError())return _;const b=G(_);if(typeof b!="number")return b;if(E.isString()&&(E=E.convertToNumberObjectValue()),E.isError())return E;const p=+E.getValue(),{days:V}=Ae(R,b,p?4:0),S=b>=R?V:-V;return y.create(S)});return s===1&&a===1?f.get(0,0):f}}class sg extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e),a=O(r,n,t);return s.map((u,c,l)=>{const f=a.get(c,l)||ce.create();if(u.isError())return u;if(f.isError())return f;if(u.isString()||u.isBoolean()||f.isString()||f.isBoolean())return g.create(h.VALUE);const m=+u.getValue();if(m<0)return g.create(h.NUM);const d=Math.floor(+f.getValue()),C=ae(m),_=C.getUTCFullYear(),E=C.getUTCMonth()+d,R=C.getUTCDate(),b=new Date(Date.UTC(_,E,R)),p=ye(b);return y.create(p,La)})}}class ag extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){let r=e,n=t;if(r.isArray()){const d=r.getRowCount(),C=r.getColumnCount();if(d>1||C>1)return g.create(h.VALUE);r=r.get(0,0)}if(n.isArray()){const d=n.getRowCount(),C=n.getColumnCount();if(d>1||C>1)return g.create(h.VALUE);n=n.get(0,0)}if(r.isError())return r;if(n.isError())return n;const s=G(r);if(typeof s!="number")return s;if(n.isBoolean())return g.create(h.VALUE);const a=ae(s),u=s>0?a.getUTCFullYear():1900,c=s>0?a.getUTCMonth():0,l=Math.floor(+n.getValue());if(Number.isNaN(l))return g.create(h.VALUE);const f=new Date(Date.UTC(u,c+l+1,0)),m=ye(f);return y.create(m)}}class ig extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2);A(this,"needsReferenceObject",!0)}calculate(e,t){const r=t!=null?t:y.create(1),{isError:n,errorObject:s,timestampIsReferenceObject:a,timestampObject:u,unitObject:c}=this._checkVariants(e,r);if(n)return s;if(u.isNull()||u.isBoolean()||u.isString()||!a&&u.isNumber()&&u.getPattern()!=="")return g.create(h.VALUE);let l=+u.getValue();const{isError:f,errorObject:m,variants:d}=F(c);if(f)return m;const[C]=d,_=Math.floor(+C.getValue());if(l<0||_<1||_>3)return g.create(h.NUM);_===1&&(l=l*1e3),_===3&&(l=l/1e3);const E=new Date(Date.UTC(1970,0,1,0,0,0,0)+l);if(Number.isNaN(E.getTime())){const R=25569+l/864e5;return y.create(R)}else{const R=$r(E);return y.create(R,"yyyy-MM-dd AM/PM hh:mm:ss")}}_checkVariants(e,t){const r=e.isReferenceObject(),n=t.isReferenceObject();let s=e;if(r&&(s=e.toArrayValueObject()),s.isArray()){const u=s.getRowCount(),c=s.getColumnCount();if(u>1||c>1)return{isError:!0,errorObject:g.create(h.VALUE)};s=s.get(0,0)}if(s.isError())return{isError:!0,errorObject:s};let a=t;if(n&&(a=t.toArrayValueObject()),a.isArray()){const u=a.getRowCount(),c=a.getColumnCount();if(u>1||c>1)return{isError:!0,errorObject:g.create(h.VALUE)};a=a.get(0,0)}return a.isError()?{isError:!0,errorObject:a}:{isError:!1,errorObject:null,timestampIsReferenceObject:r,timestampObject:s,unitIsReferenceObject:n,unitObject:a}}}var Ce=(i=>(i.DATE="DATE",i.DATEDIF="DATEDIF",i.DATEVALUE="DATEVALUE",i.DAY="DAY",i.DAYS="DAYS",i.DAYS360="DAYS360",i.EDATE="EDATE",i.EOMONTH="EOMONTH",i.EPOCHTODATE="EPOCHTODATE",i.HOUR="HOUR",i.ISOWEEKNUM="ISOWEEKNUM",i.MINUTE="MINUTE",i.MONTH="MONTH",i.NETWORKDAYS="NETWORKDAYS",i.NETWORKDAYS_INTL="NETWORKDAYS.INTL",i.NOW="NOW",i.SECOND="SECOND",i.TIME="TIME",i.TIMEVALUE="TIMEVALUE",i.TO_DATE="TO_DATE",i.TODAY="TODAY",i.WEEKDAY="WEEKDAY",i.WEEKNUM="WEEKNUM",i.WORKDAY="WORKDAY",i.WORKDAY_INTL="WORKDAY.INTL",i.YEAR="YEAR",i.YEARFRAC="YEARFRAC",i))(Ce||{});class og extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(t=>t.isError()?t:this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){const t=G(e);if(typeof t!="number")return t;if(t===0)return y.create(0);const n=Pa(t).getUTCHours();return y.create(n)}}class ug extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(t=>t.isError()?t:this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){const t=G(e);if(typeof t!="number")return t;const r=ae(t),n=t>0?r.getUTCFullYear():1900;let s=new Date(Date.UTC(n,0,1)),a=ye(s),u=Zt(a),c;u<1?c=a+1:u<=4?c=a-(u-1):c=a+(11-u),t<c&&(s=new Date(Date.UTC(n-1,0,1)),a=ye(s),u=Zt(a),u<1?c=a+1:u<=4?c=a-(u-1):c=a+(11-u));const l=Math.ceil((t-c+1)/7);return y.create(l)}}class cg extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(t=>t.isError()?t:this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){const t=G(e);if(typeof t!="number")return t;if(t===0)return y.create(0);const n=Pa(t).getUTCMinutes();return y.create(n)}}class lg extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;let t;const r=e.getValue();if(e.isString()){if(!xa(`${r}`))return g.create(h.VALUE);t=new Date(`${r}`)}else{const a=+e.getValue();if(a<0)return g.create(h.NUM);if(a===0)return y.create(1);t=ae(a)}const n=t.getUTCMonth()+1;return y.create(n)}}class fg extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){let n=e,s=t;if(n.isArray()){const l=n.getRowCount(),f=n.getColumnCount();if(l>1||f>1)return g.create(h.VALUE);n=n.get(0,0)}if(n.isError())return n;if(s.isArray()){const l=s.getRowCount(),f=s.getColumnCount();if(l>1||f>1)return g.create(h.VALUE);s=s.get(0,0)}if(s.isError())return s;if(r!=null&&r.isError())return r;if(n.isBoolean()||s.isBoolean())return g.create(h.VALUE);const a=G(n);if(typeof a!="number")return a;const u=G(s);if(typeof u!="number")return u;if(r)return this._getResultByHolidays(a,u,r);const c=Dn(a,u);return y.create(c)}_getResultByHolidays(e,t,r){const n=[];if(r!=null&&r.isArray()){const a=r.getRowCount(),u=r.getColumnCount();for(let c=0;c<a;c++)for(let l=0;l<u;l++){const f=r.get(c,l);if(f.isBoolean())return g.create(h.VALUE);const m=G(f);if(typeof m!="number")return m;n.push(m)}}else{if(r.isBoolean())return g.create(h.VALUE);const a=G(r);if(typeof a!="number")return a;n.push(a)}const s=Dn(e,t,1,n);return y.create(s)}}class mg extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",4)}calculate(e,t,r,n){return e.isError()?e:t.isError()?t:r!=null&&r.isError()?r:n!=null&&n.isError()?n:r!=null&&r.isArray()?r.map(s=>this._handleSingleObject(e,t,s,n)):this._handleSingleObject(e,t,r,n)}_handleSingleObject(e,t,r,n){let s=e,a=t;if(s.isArray()){const m=s.getRowCount(),d=s.getColumnCount();if(m>1||d>1)return g.create(h.VALUE);s=s.get(0,0)}if(s.isError())return s;if(a.isArray()){const m=a.getRowCount(),d=a.getColumnCount();if(m>1||d>1)return g.create(h.VALUE);a=a.get(0,0)}if(a.isError())return a;let u=1;if(r){if(u=r.getValue(),r.isBoolean()&&(u=+u),r.isString()&&!xr(u))return g.create(h.VALUE);if(!xr(u))return g.create(h.NUM)}if(s.isBoolean()||a.isBoolean())return g.create(h.VALUE);const c=G(s);if(typeof c!="number")return c;const l=G(a);if(typeof l!="number")return l;if(n)return this._getResultByHolidays(c,l,u,n);const f=Dn(c,l,u);return y.create(f)}_getResultByHolidays(e,t,r,n){const s=[];if(n!=null&&n.isArray()){const u=n.getRowCount(),c=n.getColumnCount();for(let l=0;l<u;l++)for(let f=0;f<c;f++){const m=n.get(l,f);if(m.isBoolean())return g.create(h.VALUE);const d=G(m);if(typeof d!="number")return d;s.push(d)}}else{if(n.isBoolean())return g.create(h.VALUE);const u=G(n);if(typeof u!="number")return u;s.push(u)}const a=Dn(e,t,r,s);return y.create(a)}}class hg extends N{constructor(){super(...arguments);A(this,"minParams",0);A(this,"maxParams",0)}calculate(){const e=new Date,t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds())),r=$r(t);return y.create(r,$h)}}class gg extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(t=>t.isError()?t:this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){const t=G(e);if(typeof t!="number")return t;if(t===0)return y.create(0);const n=Pa(t).getUTCSeconds();return y.create(n)}}class dg extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e),u=O(n,s,t),c=O(n,s,r);return a.map((l,f,m)=>this._calculateTime(l,u,c,f,m))}_calculateTime(e,t,r,n,s){let a=e,u=t.get(n,s)||ce.create(),c=r.get(n,s)||ce.create();if((a.isString()||a.isBoolean())&&(a=a.convertToNumberObjectValue()),(u.isString()||u.isBoolean())&&(u=u.convertToNumberObjectValue()),(c.isString()||c.isBoolean())&&(c=c.convertToNumberObjectValue()),a.isError())return a;if(u.isError())return u;if(c.isError())return c;let l=Math.floor(+a.getValue()),f=Math.floor(+u.getValue()),m=Math.floor(+c.getValue());if(l<0||f<0||m<0||l>32767||f>32767||m>32767)return g.create(h.NUM);f+=Math.floor(m/60),m%=60,l+=Math.floor(f/60),f%=60,l%=24;const C=(l*3600+f*60+m)/86400;return y.create(C,Yh)}}class Cg extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}isArgumentsIgnoreNumberPattern(){return!0}calculate(e){return e.isArray()?e.mapValue(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isString()){const t=`${e.getValue()}`,r=Hh(t);if(r){let{v:n,z:s}=r;if(s&&ja(s))return n instanceof Date&&(n=$r(n)),y.create(Yf(+n))}}return g.create(h.VALUE)}}class _g extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1);A(this,"needsReferenceObject",!0)}calculate(e){const t=e.isReferenceObject();let r=e;if(t&&(r=e.toArrayValueObject()),r.isArray()){const s=r.getRowCount(),a=r.getColumnCount();if(s>1||a>1)return g.create(h.VALUE);r=r.get(0,0)}if(r.isError()||r.isNull()||r.isBoolean()||r.isString()||!t&&r.isNumber()&&r.getPattern()!=="")return r;const n=+r.getValue();return y.create(n,"yyyy-MM-dd hh:mm:ss AM/PM")}}class Ag extends N{constructor(){super(...arguments);A(this,"minParams",0);A(this,"maxParams",0)}calculate(){const e=ye(new Date);return y.create(e,La)}}class Eg extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2);A(this,"_returnTypeMap",{1:[1,2,3,4,5,6,7],2:[7,1,2,3,4,5,6],3:[6,0,1,2,3,4,5],11:[7,1,2,3,4,5,6],12:[6,7,1,2,3,4,5],13:[5,6,7,1,2,3,4],14:[4,5,6,7,1,2,3],15:[3,4,5,6,7,1,2],16:[2,3,4,5,6,7,1],17:[1,2,3,4,5,6,7]})}calculate(e,t){const r=t!=null?t:y.create(1);if(e.isError())return e;if(r.isError())return r;const n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,r,g.create(h.NA)),c=a.map((l,f,m)=>{const d=u.get(f,m);return this._handleSingleObject(l,d)});return n===1&&s===1?c.get(0,0):c}_handleSingleObject(e,t){let r=t;if(e.isError())return e;if(r.isError())return r;const n=G(e);if(typeof n!="number")return n;if(r.isString()&&(r=r.convertToNumberObjectValue(),r.isError()))return r;const s=Math.floor(+r.getValue());if(!this._returnTypeMap[s])return g.create(h.NUM);const a=Zt(n),u=this._returnTypeMap[s][a];return y.create(u)}}class Rg extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2);A(this,"_returnTypeMap",{1:0,2:1,11:1,12:2,13:3,14:4,15:5,16:6,17:0,21:4})}calculate(e,t){let r=e,n=t!=null?t:y.create(1);if(r.isArray()){const u=r.getRowCount(),c=r.getColumnCount();if(u>1||c>1)return g.create(h.VALUE);r=r.get(0,0)}if(r.isError())return r;if(n.isArray()){const u=n.getRowCount(),c=n.getColumnCount();if(u>1||c>1)return g.create(h.VALUE);n=n.get(0,0)}if(n.isError())return n;if(r.isBoolean())return g.create(h.VALUE);const s=G(r);if(typeof s!="number")return s;if(n.isBoolean())return g.create(h.VALUE);const a=Math.floor(+n.getValue());return Number.isNaN(a)?g.create(h.VALUE):a in this._returnTypeMap?this._getResult(s,a):g.create(h.NUM)}_getResult(e,t){const r=ae(e),n=e>0?r.getUTCFullYear():1900;let s=new Date(Date.UTC(n,0,1)),a=ye(s),u=Zt(a),c;if(t===21)u<1?c=a+1:u<=4?c=a-(u-1):c=a+(11-u),e<c&&(s=new Date(Date.UTC(n-1,0,1)),a=ye(s),u=Zt(a),u<1?c=a+1:u<=4?c=a-(u-1):c=a+(11-u));else{const f=this._returnTypeMap[t];u<f?c=a-(u+7-f):c=a-(u-f)}const l=Math.ceil((e-c+1)/7);return y.create(l)}}class bg extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){let n=e,s=t;if(n.isArray()){const l=n.getRowCount(),f=n.getColumnCount();if(l>1||f>1)return g.create(h.VALUE);n=n.get(0,0)}if(n.isError())return n;if(s.isArray()){const l=s.getRowCount(),f=s.getColumnCount();if(l>1||f>1)return g.create(h.VALUE);s=s.get(0,0)}if(s.isError())return s;if(r!=null&&r.isError())return r;if(n.isBoolean()||s.isBoolean())return g.create(h.VALUE);const a=G(n);if(typeof a!="number")return a;const u=+s.getValue();if(Number.isNaN(u))return g.create(h.VALUE);if(r)return this._getResultByHolidays(a,u,r);const c=wn(a,u);return typeof c!="number"?c:y.create(c)}_getResultByHolidays(e,t,r){const n=[];if(r!=null&&r.isArray()){const a=r.getRowCount(),u=r.getColumnCount();for(let c=0;c<a;c++)for(let l=0;l<u;l++){const f=r.get(c,l);if(f.isBoolean())return g.create(h.VALUE);const m=G(f);if(typeof m!="number")return m;n.push(m)}}else{if(r.isBoolean())return g.create(h.VALUE);const a=G(r);if(typeof a!="number")return a;n.push(a)}const s=wn(e,t,1,n);return typeof s!="number"?s:y.create(s)}}class yg extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",4)}calculate(e,t,r,n){return e.isError()?e:t.isError()?t:r!=null&&r.isError()?r:n!=null&&n.isError()?n:r!=null&&r.isArray()?r.map(s=>this._handleSingleObject(e,t,s,n)):this._handleSingleObject(e,t,r,n)}_handleSingleObject(e,t,r,n){const s=r!=null?r:y.create(1),a=this._checkArrayError(e);if(a.isError())return a;const u=this._checkArrayError(t);if(u.isError())return u;if(a.isBoolean()||u.isBoolean())return g.create(h.VALUE);const c=G(e);if(typeof c!="number")return c;const l=+t.getValue();if(Number.isNaN(l))return g.create(h.VALUE);let f=s.getValue();if(s.isBoolean()&&(f=+f),s.isString()&&(!xr(f)||f==="1111111"))return g.create(h.VALUE);if(!xr(f))return g.create(h.NUM);if(n)return this._getResultByHolidays(c,l,f,n);const m=wn(c,l,f);return typeof m!="number"?m:y.create(m)}_checkArrayError(e){let t=e;if(t.isArray()){const r=t.getRowCount(),n=t.getColumnCount();if(r>1||n>1)return g.create(h.VALUE);t=t.get(0,0)}return t.isError(),t}_getResultByHolidays(e,t,r,n){const s=[];if(n!=null&&n.isArray()){const u=n.getRowCount(),c=n.getColumnCount();for(let l=0;l<u;l++)for(let f=0;f<c;f++){const m=n.get(l,f);if(m.isBoolean())return g.create(h.VALUE);const d=G(m);if(typeof d!="number")return d;s.push(d)}}else{if(n.isBoolean())return g.create(h.VALUE);const u=G(n);if(typeof u!="number")return u;s.push(u)}const a=wn(e,t,r,s);return typeof a!="number"?a:y.create(a)}}class pg extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;let t;const r=e.getValue();if(e.isString()){if(!xa(`${r}`))return g.create(h.VALUE);t=new Date(`${r}`)}else{const a=+r;if(a<0)return g.create(h.NUM);if(a===0)return y.create(1900);t=ae(a)}const n=t.getUTCFullYear();return y.create(n)}}class Ng extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){let n=r!=null?r:y.create(0);const s=Gt(e);if(s.isError())return s;const a=Gt(t);if(a.isError())return a;if(n=Gt(n),n.isError())return n;if(s.isBoolean()||a.isBoolean()||n.isBoolean())return g.create(h.VALUE);const u=G(s);if(typeof u!="number")return u;const c=G(a);if(typeof c!="number")return c;const l=Math.floor(+n.getValue());if(Number.isNaN(l))return g.create(h.VALUE);if(l<0||l>4)return g.create(h.NUM);const{days:f,yearDays:m}=Ae(u,c,l),d=f/m;return y.create(d)}}const Hu=[[zh,Ce.DATE],[Jh,Ce.DATEDIF],[eg,Ce.DATEVALUE],[tg,Ce.DAY],[rg,Ce.DAYS],[ng,Ce.DAYS360],[sg,Ce.EDATE],[ag,Ce.EOMONTH],[ig,Ce.EPOCHTODATE],[og,Ce.HOUR],[ug,Ce.ISOWEEKNUM],[cg,Ce.MINUTE],[lg,Ce.MONTH],[fg,Ce.NETWORKDAYS],[mg,Ce.NETWORKDAYS_INTL],[hg,Ce.NOW],[gg,Ce.SECOND],[dg,Ce.TIME],[Cg,Ce.TIMEVALUE],[_g,Ce.TO_DATE],[Ag,Ce.TODAY],[Eg,Ce.WEEKDAY],[Rg,Ce.WEEKNUM],[bg,Ce.WORKDAY],[yg,Ce.WORKDAY_INTL],[pg,Ce.YEAR],[Ng,Ce.YEARFRAC]];class Vg extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return g.create(h.NA);const{isError:r,errorObject:n,variants:s}=Q(e,t);if(r)return n;const[a,u]=s,c=+a.getValue(),l=Math.floor(+u.getValue());if(Number.isNaN(c)||Number.isNaN(l))return g.create(h.VALUE);if(l<0)return g.create(h.NUM);const f=gr.besseli(c,l);return Number.isNaN(f)||!Number.isFinite(f)?g.create(h.NUM):y.create(f)}}class Og extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return g.create(h.NA);const{isError:r,errorObject:n,variants:s}=Q(e,t);if(r)return n;const[a,u]=s,c=+a.getValue(),l=Math.floor(+u.getValue());if(Number.isNaN(c)||Number.isNaN(l))return g.create(h.VALUE);if(l<0)return g.create(h.NUM);const f=gr.besselj(c,l);return Number.isNaN(f)||!Number.isFinite(f)?g.create(h.NUM):y.create(f)}}class Sg extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return g.create(h.NA);const{isError:r,errorObject:n,variants:s}=Q(e,t);if(r)return n;const[a,u]=s,c=+a.getValue(),l=Math.floor(+u.getValue());if(Number.isNaN(c)||Number.isNaN(l))return g.create(h.VALUE);if(l<0)return g.create(h.NUM);const f=gr.besselk(c,l);return Number.isNaN(f)||!Number.isFinite(f)?g.create(h.NUM):y.create(f)}}class Mg extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return g.create(h.NA);const{isError:r,errorObject:n,variants:s}=Q(e,t);if(r)return n;const[a,u]=s,c=+a.getValue(),l=Math.floor(+u.getValue());if(Number.isNaN(c)||Number.isNaN(l))return g.create(h.VALUE);if(l<0)return g.create(h.NUM);const f=gr.bessely(c,l);return Number.isNaN(f)||!Number.isFinite(f)?g.create(h.NUM):y.create(f)}}class Dg extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=Q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`;if(!_a(a))return g.create(h.NUM);let u;return a.length===10&&a.substring(0,1)==="1"?u=Number.parseInt(a.substring(1),2)-512:u=Number.parseInt(a,2),y.create(u)}}class wg extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){if(e.isNull())return g.create(h.NA);let r=0;if(t){const{isError:f,errorObject:m,variants:d}=Q(t);if(f)return m;const[C]=d;if(r=Math.floor(+C.getValue()),Number.isNaN(r))return g.create(h.VALUE);if(r<0||r>10)return g.create(h.NUM)}const{isError:n,errorObject:s,variants:a}=Q(e);if(n)return s;const[u]=a,c=`${u.getValue()}`;if(!_a(c))return g.create(h.NUM);let l;if(c.length===10&&c.substring(0,1)==="1")l=(0xfffffffe00+Number.parseInt(c.substring(1),2)).toString(16);else if(l=Number.parseInt(c,2).toString(16),t){if(r<l.length)return g.create(h.NUM);l="0".repeat(r-l.length)+l}return T.create(l.toLocaleUpperCase())}}class Lg extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){if(e.isNull())return g.create(h.NA);let r=0;if(t){const{isError:f,errorObject:m,variants:d}=Q(t);if(f)return m;const[C]=d;if(r=Math.floor(+C.getValue()),Number.isNaN(r))return g.create(h.VALUE);if(r<0||r>10)return g.create(h.NUM)}const{isError:n,errorObject:s,variants:a}=Q(e);if(n)return s;const[u]=a,c=`${u.getValue()}`;if(!_a(c))return g.create(h.NUM);let l;if(c.length===10&&c.substring(0,1)==="1")l=(1073741312+Number.parseInt(c.substring(1),2)).toString(8);else if(l=Number.parseInt(c,2).toString(8),t){if(r<l.length)return g.create(h.NUM);l="0".repeat(r-l.length)+l}return T.create(l)}}class Pg extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.map((c,l,f)=>{let m=c;if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;let d=a.get(l,f);if(d.isString()&&(d=d.convertToNumberObjectValue()),d.isError())return d;const C=+m.getValue(),_=+d.getValue();if(C<0||_<0||Math.floor(C)!==C||Math.floor(_)!==_||C>0xffffffffffff||_>0xffffffffffff)return g.create(h.NUM);const E=C&_;return y.create(E)});return r===1&&n===1?u.get(0,0):u}}class xg extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.map((c,l,f)=>{let m=c;if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;let d=a.get(l,f);if(d.isString()&&(d=d.convertToNumberObjectValue()),d.isError())return d;const C=+m.getValue();let _=+d.getValue();if(C<0||Math.floor(C)!==C||C>0xffffffffffff||Math.abs(_)>53)return g.create(h.NUM);_=Math.trunc(_);const E=Number(_>=0?BigInt(C)<<BigInt(_):BigInt(C)>>BigInt(-_));return E>0xffffffffffff?g.create(h.NUM):y.create(E)});return r===1&&n===1?u.get(0,0):u}}class jg extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.map((c,l,f)=>{let m=c;if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;let d=a.get(l,f);if(d.isString()&&(d=d.convertToNumberObjectValue()),d.isError())return d;const C=+m.getValue(),_=+d.getValue();if(C<0||_<0||Math.floor(C)!==C||Math.floor(_)!==_||C>0xffffffffffff||_>0xffffffffffff)return g.create(h.NUM);const E=Number(BigInt(C)|BigInt(_));return y.create(E)});return r===1&&n===1?u.get(0,0):u}}class Ug extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.map((c,l,f)=>{let m=c;if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;let d=a.get(l,f);if(d.isString()&&(d=d.convertToNumberObjectValue()),d.isError())return d;const C=+m.getValue();let _=+d.getValue();if(C<0||Math.floor(C)!==C||C>0xffffffffffff||Math.abs(_)>53)return g.create(h.NUM);_=Math.trunc(_);const E=Number(_>=0?BigInt(C)>>BigInt(_):BigInt(C)<<BigInt(-_));return E>0xffffffffffff?g.create(h.NUM):y.create(E)});return r===1&&n===1?u.get(0,0):u}}class Tg extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.map((c,l,f)=>{let m=c;if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;let d=a.get(l,f);if(d.isString()&&(d=d.convertToNumberObjectValue()),d.isError())return d;const C=+m.getValue(),_=+d.getValue();if(C<0||_<0||Math.floor(C)!==C||Math.floor(_)!==_||C>0xffffffffffff||_>0xffffffffffff)return g.create(h.NUM);const E=C^_;return y.create(E)});return r===1&&n===1?u.get(0,0):u}}j.prototype.cos=function(){const i=this.toNumber();return new j(Math.cos(i))};let he=class fe{constructor(o){A(this,"_inumber","");A(this,"_realNum",0);A(this,"_iNum",0);A(this,"_suffix","");A(this,"_isError",!1);if(`${o}`.trim()===""){this._isError=!0;return}this._inumber=o,this._getImReal(),this._getImAginary(),this._getImSuffix()}static getComplex(o,e,t){const r=new j(o).toSignificantDigits(15).toNumber(),n=new j(e).toSignificantDigits(15).toNumber(),s=t===""?"i":t;let a;if(r===0&&n===0)a=0;else if(r===0)a=n===1?s:`${n}${s}`;else if(n===0)a=r;else{const u=n>0?"+":"",c=n===1?s:`${n}${s}`;a=`${r}${u}${c}`}return a}static createByComplexStr(o,e,t){const r=fe.getComplex(o,e,t);return new fe(r)}_getImReal(){if(this._inumber===0||this._inumber==="0"){this._realNum=0;return}const o=`${this._inumber}`;if(["i","+i","1i","+1i","-i","-1i","j","+j","1j","+1j","-j","-1j"].indexOf(o)>=0){this._realNum=0;return}let e=o.indexOf("+"),t=o.indexOf("-");e===0&&(e=o.indexOf("+",1)),t===0&&(t=o.indexOf("-",1));const r=o.substring(o.length-1,o.length),n=r==="i"||r==="j";if(e>=0||t>=0){if(!n){this._isError=!0;return}e>=0?Number.isNaN(+o.substring(0,e))||Number.isNaN(+o.substring(e+1,o.length-1))?this._isError=!0:this._realNum=+o.substring(0,e):Number.isNaN(+o.substring(0,t))||Number.isNaN(+o.substring(t+1,o.length-1))?this._isError=!0:this._realNum=+o.substring(0,t)}else n?Number.isNaN(+o.substring(0,o.length-1))?this._isError=!0:this._realNum=0:Number.isNaN(+o)?this._isError=!0:this._realNum=+o}_getImAginary(){if(this._isError)return;if(this._inumber===0||this._inumber==="0"){this._iNum=0;return}let o=`${this._inumber}`;if(["i","j"].indexOf(o)>=0){this._iNum=1;return}o=o.replace("+i","+1i").replace("-i","-1i").replace("+j","+1j").replace("-j","-1j");let e=o.indexOf("+"),t=o.indexOf("-");e===0&&(e=o.indexOf("+",1)),t===0&&(t=o.indexOf("-",1));const r=o.substring(o.length-1,o.length),n=r==="i"||r==="j";if(e>=0||t>=0){if(!n){this._isError=!0;return}e>=0?Number.isNaN(+o.substring(0,e))||Number.isNaN(+o.substring(e+1,o.length-1))?this._isError=!0:this._iNum=+o.substring(e+1,o.length-1):Number.isNaN(+o.substring(0,t))||Number.isNaN(+o.substring(t+1,o.length-1))?this._isError=!0:this._iNum=-+o.substring(t+1,o.length-1)}else n?Number.isNaN(+o.substring(0,o.length-1))?this._isError=!0:this._iNum=+o.substring(0,o.length-1):Number.isNaN(+o)?this._isError=!0:this._iNum=0}_getImSuffix(){const o=`${this._inumber}`,e=o.substring(o.length-1);this._suffix=e==="i"||e==="j"?e:""}getRealNum(){return this._realNum}getINum(){return this._iNum}getSuffix(){return this._suffix}isError(){return this._isError}toString(){return fe.getComplex(this._realNum,this._iNum,this._suffix)}isDifferentSuffixes(o){const e=o.getSuffix();return this._suffix===""||e===""?!1:this._suffix!==e}Abs(){return j.sqrt(j.pow(this._realNum,2).add(j.pow(this._iNum,2))).toSignificantDigits(16).toNumber()}Argument(){const o=j.sqrt(j.pow(this._realNum,2).add(j.pow(this._iNum,2)));let e=j.acos(new j(this._realNum).div(o)).toSignificantDigits(16).toNumber();return this._iNum<0&&(e=-e),e}Conjugate(){return fe.getComplex(this._realNum,-this._iNum,this._suffix)}Cos(){if(this._iNum){const o=j.cos(this._realNum).mul(j.cosh(this._iNum)).toNumber(),e=j.sin(this._realNum).mul(j.sinh(this._iNum)).negated().toNumber();return fe.getComplex(o,e,this._suffix)}else{const o=j.cos(this._realNum).toNumber();return fe.getComplex(o,this._iNum,this._suffix)}}Cosh(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return this._isError=!0,"";if(this._iNum){const o=j.cosh(this._realNum).mul(j.cos(this._iNum)).toNumber(),e=j.sinh(this._realNum).mul(j.sin(this._iNum)).toNumber();return fe.getComplex(o,e,this._suffix)}else{const o=j.cosh(this._realNum).toNumber();return fe.getComplex(o,this._iNum,this._suffix)}}Cot(){if(this._iNum){const o=j.cosh(this._iNum*2).sub(j.cos(this._realNum*2)),e=j.sin(this._realNum*2).div(o).toNumber(),t=j.sinh(this._iNum*2).div(o).negated().toNumber();return fe.getComplex(e,t,this._suffix)}else{const o=new j(1).div(j.tan(this._realNum)).toNumber();return fe.getComplex(o,this._iNum,this._suffix)}}Coth(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return this._isError=!0,"";if(this._iNum){const o=j.cosh(this._realNum*2).sub(j.cos(this._iNum*2)),e=j.sinh(this._realNum*2).div(o).toNumber(),t=j.sin(this._iNum*2).div(o).negated().toNumber();return fe.getComplex(e,t,this._suffix)}else{const o=new j(1).div(j.tanh(this._realNum)).toNumber();return fe.getComplex(o,this._iNum,this._suffix)}}Csc(){if(this._iNum){const o=j.cosh(this._iNum*2).sub(j.cos(this._realNum*2)),e=j.sin(this._realNum).mul(j.cosh(this._iNum)).mul(2).div(o).toNumber(),t=j.cos(this._realNum).mul(j.sinh(this._iNum)).mul(-2).div(o).toNumber();return fe.getComplex(e,t,this._suffix)}else{const o=new j(1).div(j.sin(this._realNum)).toNumber();return fe.getComplex(o,this._iNum,this._suffix)}}Csch(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return fe.getComplex(0,0,this._suffix);if(this._iNum){const o=j.cosh(this._realNum*2).sub(j.cos(this._iNum*2)),e=j.sinh(this._realNum).mul(j.cos(this._iNum)).mul(2).div(o).toNumber(),t=j.cosh(this._realNum).mul(j.sin(this._iNum)).mul(-2).div(o).toNumber();return fe.getComplex(e,t,this._suffix)}else{const o=new j(1).div(j.sinh(this._realNum)).toNumber();return fe.getComplex(o,this._iNum,this._suffix)}}Div(o){const e=new j(this._realNum),t=new j(this._iNum),r=new j(o.getRealNum()),n=new j(o.getINum()),s=r.mul(r).add(n.mul(n)),a=e.mul(r).add(t.mul(n)).div(s).toNumber(),u=t.mul(r).sub(e.mul(n)).div(s).toNumber(),c=this._suffix===""?o.getSuffix():this._suffix;return fe.getComplex(a,u,c)}Exp(){if(!Number.isFinite(Math.exp(this._realNum)))return this._isError=!0,"";const o=j.exp(this._realNum).mul(j.cos(this._iNum)).toNumber(),e=j.exp(this._realNum).mul(j.sin(this._iNum)).toNumber();return fe.getComplex(o,e,this._suffix)}Ln(){const o=j.sqrt(j.pow(this._realNum,2).add(j.pow(this._iNum,2))),e=j.ln(o).toNumber(),t=j.acos(new j(this._realNum).div(o)).toNumber();return fe.getComplex(e,t,this._suffix)}Log(o){const e=j.sqrt(j.pow(this._realNum,2).add(j.pow(this._iNum,2))),t=j.ln(e);let r=j.acos(new j(this._realNum).div(e));this._iNum<0&&(r=r.negated());const n=j.ln(o),s=new j(0),a=n.mul(n).add(s.mul(s));if(a.eq(0))return this._isError=!0,"";const u=t.mul(n).add(r.mul(s)).div(a).toNumber(),c=r.mul(n).sub(t.mul(s)).div(a).toNumber();return fe.getComplex(u,c,this._suffix)}Power(o){if(this._realNum===0&&this._iNum===0)return o>0?fe.getComplex(this._realNum,this._iNum,this._suffix):(this._isError=!0,"");let e=j.sqrt(j.pow(this._realNum,2).add(j.pow(this._iNum,2))),t=j.acos(new j(this._realNum).div(e));this._iNum<0&&(t=t.negated()),e=j.pow(e,o),t=t.mul(o);const r=j.cos(t).mul(e).toNumber(),n=j.sin(t).mul(e).toNumber();return!Number.isFinite(r)||!Number.isFinite(n)?(this._isError=!0,""):fe.getComplex(r,n,this._suffix)}Product(o){const e=new j(this._realNum),t=new j(this._iNum),r=new j(o.getRealNum()),n=new j(o.getINum()),s=e.mul(r).sub(t.mul(n)).toNumber(),a=e.mul(n).add(t.mul(r)).toNumber(),u=this._suffix===""?o.getSuffix():this._suffix;return fe.getComplex(s,a,u)}Sec(){if(this._iNum){const o=j.cosh(this._iNum*2).add(j.cos(this._realNum*2)),e=j.cos(this._realNum).mul(j.cosh(this._iNum)).mul(2).div(o).toNumber(),t=j.sin(this._realNum).mul(j.sinh(this._iNum)).mul(2).div(o).toNumber();return fe.getComplex(e,t,this._suffix)}else{const o=new j(1).div(j.cos(this._realNum)).toNumber();return fe.getComplex(o,this._iNum,this._suffix)}}Sech(){if(!Number.isFinite(Math.sinh(this._realNum*2))||!Number.isFinite(Math.cosh(this._realNum*2)))return fe.getComplex(0,0,this._suffix);if(this._iNum){const o=j.cosh(this._realNum*2).add(j.cos(this._iNum*2)),e=j.cosh(this._realNum).mul(j.cos(this._iNum)).mul(2).div(o).toNumber(),t=j.sinh(this._realNum).mul(j.sin(this._iNum)).mul(-2).div(o).toNumber();return fe.getComplex(e,t,this._suffix)}else{const o=new j(1).div(j.cosh(this._realNum)).toNumber();return fe.getComplex(o,this._iNum,this._suffix)}}Sin(){if(this._iNum){const o=j.sin(this._realNum).mul(j.cosh(this._iNum)).toNumber(),e=j.cos(this._realNum).mul(j.sinh(this._iNum)).toNumber();return fe.getComplex(o,e,this._suffix)}else{const o=j.sin(this._realNum).toNumber();return fe.getComplex(o,this._iNum,this._suffix)}}Sinh(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return this._isError=!0,"";if(this._iNum){const o=j.sinh(this._realNum).mul(j.cos(this._iNum)).toNumber(),e=j.cosh(this._realNum).mul(j.sin(this._iNum)).toNumber();return fe.getComplex(o,e,this._suffix)}else{const o=j.sinh(this._realNum).toNumber();return fe.getComplex(o,this._iNum,this._suffix)}}Sqrt(){const o=j.sqrt(j.pow(this._realNum,2).add(j.pow(this._iNum,2))),e=j.sqrt(o);let t=j.acos(new j(this._realNum).div(o));this._iNum<0&&(t=t.negated());const r=e.mul(j.cos(t.div(2).toNumber())).toNumber(),n=e.mul(j.sin(t.div(2))).toNumber();return fe.getComplex(r,n,this._suffix)}Sub(o){const e=new j(this._realNum),t=new j(this._iNum),r=new j(o.getRealNum()),n=new j(o.getINum()),s=e.sub(r).toNumber(),a=t.sub(n).toNumber(),u=this._suffix===""?o.getSuffix():this._suffix;return fe.getComplex(s,a,u)}Sum(o){const e=new j(this._realNum),t=new j(this._iNum),r=new j(o.getRealNum()),n=new j(o.getINum()),s=e.add(r).toNumber(),a=t.add(n).toNumber(),u=this._suffix===""?o.getSuffix():this._suffix;return fe.getComplex(s,a,u)}Tan(){if(this._iNum){const o=j.cos(this._realNum*2).add(j.cosh(this._iNum*2)),e=j.sin(this._realNum*2).div(o).toNumber(),t=j.sinh(this._iNum*2).div(o).toNumber();return fe.getComplex(e,t,this._suffix)}else{const o=j.tan(this._realNum).toNumber();return fe.getComplex(o,this._iNum,this._suffix)}}Tanh(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return this._isError=!0,"";if(this._iNum){const o=j.cosh(this._realNum*2).add(j.cos(this._iNum*2)),e=j.sinh(this._realNum*2).div(o).toNumber(),t=j.sin(this._iNum*2).div(o).toNumber();return fe.getComplex(e,t,this._suffix)}else{const o=j.tanh(this._realNum).toNumber();return fe.getComplex(o,this._iNum,this._suffix)}}};class vg extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){const n=r!=null?r:T.create("i"),{isError:s,errorObject:a,variants:u}=Q(e,t,n);if(s)return a;const[c,l,f]=u,m=+c.getValue(),d=+l.getValue(),C=`${f.getValue()}`;if(Number.isNaN(m)||Number.isNaN(d)||C!=="i"&&C!=="j")return g.create(h.VALUE);const _=he.getComplex(m,d,C);return typeof _=="number"?y.create(_):T.create(_)}}class Ig extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3);A(this,"_units",[["a.u. of action","?",null,"action",!1,!1,105457168181818e-48],["a.u. of charge","e",null,"electric_charge",!1,!1,160217653141414e-33],["a.u. of energy","Eh",null,"energy",!1,!1,435974417757576e-32],["a.u. of length","a?",null,"length",!1,!1,529177210818182e-25],["a.u. of mass","m?",null,"mass",!1,!1,910938261616162e-45],["a.u. of time","?/Eh",null,"time",!1,!1,241888432650516e-31],["admiralty knot","admkn",null,"speed",!1,!0,.514773333],["ampere","A",null,"electric_current",!0,!1,1],["ampere per meter","A/m",null,"magnetic_field_intensity",!0,!1,1],["ångström","Å",["ang"],"length",!1,!0,1e-10],["are","ar",null,"area",!1,!0,100],["astronomical unit","ua",null,"length",!1,!1,149597870691667e-25],["bar","bar",null,"pressure",!1,!1,1e5],["barn","b",null,"area",!1,!1,1e-28],["becquerel","Bq",null,"radioactivity",!0,!1,1],["bit","bit",["b"],"information",!1,!0,1],["btu","BTU",["btu"],"energy",!1,!0,1055.05585262],["byte","byte",null,"information",!1,!0,8],["candela","cd",null,"luminous_intensity",!0,!1,1],["candela per square metre","cd/m?",null,"luminance",!0,!1,1],["centigrade","C",["cel"],"temperature",!0,!1,1],["cubic ångström","ang3",["ang^3"],"volume",!1,!0,1e-30],["cubic foot","ft3",["ft^3"],"volume",!1,!0,.028316846592],["cubic inch","in3",["in^3"],"volume",!1,!0,16387064e-12],["cubic light-year","ly3",["ly^3"],"volume",!1,!0,846786664623715e-61],["cubic metre","m3",["m^3"],"volume",!0,!0,1],["cubic mile","mi3",["mi^3"],"volume",!1,!0,416818182544058e-5],["cubic nautical mile","Nmi3",["Nmi^3"],"volume",!1,!0,6352182208],["cubic Pica","Pica3",["Picapt3","Pica^3","Picapt^3"],"volume",!1,!0,758660370370369e-22],["cubic yard","yd3",["yd^3"],"volume",!1,!0,.764554857984],["cup","cup",null,"volume",!1,!0,.0002365882365],["dalton","Da",["u"],"mass",!1,!1,166053886282828e-41],["day","d",["day"],"time",!1,!0,86400],["degree","°",null,"angle",!1,!1,.0174532925199433],["dyne","dyn",["dy"],"force",!1,!0,1e-5],["electronvolt","eV",["ev"],"energy",!1,!0,1.60217656514141],["ell","ell",null,"length",!1,!0,1.143],["erg","erg",["e"],"energy",!1,!0,1e-7],["fahrenheit","F",["fah"],"temperature",!0,!1,1],["fluid ounce","oz",null,"volume",!1,!0,295735295625e-16],["foot","ft",null,"length",!1,!0,.3048],["foot-pound","flb",null,"energy",!1,!0,1.3558179483314],["gal","Gal",null,"acceleration",!1,!1,.01],["gallon","gal",null,"volume",!1,!0,.003785411784],["gauss","G",["ga"],"magnetic_flux_density",!1,!0,1],["grain","grain",null,"mass",!1,!0,647989e-10],["gram","g",null,"mass",!1,!0,.001],["gray","Gy",null,"absorbed_dose",!0,!1,1],["gross registered ton","GRT",["regton"],"volume",!1,!0,2.8316846592],["hectare","ha",null,"area",!1,!0,1e4],["henry","H",null,"inductance",!0,!1,1],["hertz","Hz",null,"frequency",!0,!1,1],["horsepower","HP",["h"],"power",!1,!0,745.69987158227],["horsepower-hour","HPh",["hh","hph"],"energy",!1,!0,2684519538e-3],["hour","h",["hr"],"time",!1,!0,3600],["imperial gallon (U.K.)","uk_gal",null,"volume",!1,!0,.00454609],["imperial hundredweight","lcwt",["uk_cwt","hweight"],"mass",!1,!0,50.802345],["imperial quart (U.K)","uk_qt",null,"volume",!1,!0,.0011365225],["imperial ton","brton",["uk_ton","LTON"],"mass",!1,!0,1016.046909],["inch","in",null,"length",!1,!0,.0254],["international acre","uk_acre",null,"area",!1,!0,4046.8564224],["IT calorie","cal",null,"energy",!1,!0,4.1868],["joule","J",null,"energy",!0,!0,1],["katal","kat",null,"catalytic_activity",!0,!1,1],["kelvin","K",["kel"],"temperature",!0,!0,1],["kilogram","kg",null,"mass",!0,!0,1],["knot","kn",null,"speed",!1,!0,.514444444444444],["light-year","ly",null,"length",!1,!0,9460730472580800],["litre","L",["l","lt"],"volume",!1,!0,.001],["lumen","lm",null,"luminous_flux",!0,!1,1],["lux","lx",null,"illuminance",!0,!1,1],["maxwell","Mx",null,"magnetic_flux",!1,!1,1e-18],["measurement ton","MTON",null,"volume",!1,!0,1.13267386368],["meter per hour","m/h",["m/hr"],"speed",!1,!0,.00027777777777778],["meter per second","m/s",["m/sec"],"speed",!0,!0,1],["meter per second squared","m?s??",null,"acceleration",!0,!1,1],["parsec","pc",["parsec"],"length",!1,!0,0x6da012f958ee1c],["meter squared per second","m?/s",null,"kinematic_viscosity",!0,!1,1],["metre","m",null,"length",!0,!0,1],["miles per hour","mph",null,"speed",!1,!0,.44704],["millimetre of mercury","mmHg",null,"pressure",!1,!1,133.322],["minute","?",null,"angle",!1,!1,.000290888208665722],["minute","min",["mn"],"time",!1,!0,60],["modern teaspoon","tspm",null,"volume",!1,!0,5e-6],["mole","mol",null,"amount_of_substance",!0,!1,1],["morgen","Morgen",null,"area",!1,!0,2500],["n.u. of action","?",null,"action",!1,!1,105457168181818e-48],["n.u. of mass","m?",null,"mass",!1,!1,910938261616162e-45],["n.u. of speed","c?",null,"speed",!1,!1,299792458],["n.u. of time","?/(me?c??)",null,"time",!1,!1,128808866778687e-35],["nautical mile","M",["Nmi"],"length",!1,!0,1852],["newton","N",null,"force",!0,!0,1],["œrsted","Oe ",null,"magnetic_field_intensity",!1,!1,79.5774715459477],["ohm","Ω",null,"electric_resistance",!0,!1,1],["ounce mass","ozm",null,"mass",!1,!0,.028349523125],["pascal","Pa",null,"pressure",!0,!1,1],["pascal second","Pa?s",null,"dynamic_viscosity",!0,!1,1],["pferdestärke","PS",null,"power",!1,!0,735.49875],["phot","ph",null,"illuminance",!1,!1,1e-4],["pica (1/6 inch)","pica",null,"length",!1,!0,.00035277777777778],["pica (1/72 inch)","Pica",["Picapt"],"length",!1,!0,.00423333333333333],["poise","P",null,"dynamic_viscosity",!1,!1,.1],["pond","pond",null,"force",!1,!0,.00980665],["pound force","lbf",null,"force",!1,!0,4.4482216152605],["pound mass","lbm",null,"mass",!1,!0,.45359237],["quart","qt",null,"volume",!1,!0,.000946352946],["radian","rad",null,"angle",!0,!1,1],["rankine","Rank",null,"temperature",!1,!0,1],["reaumur","Reau",null,"temperature",!1,!0,1],["second","?",null,"angle",!1,!1,484813681109536e-20],["second","s",["sec"],"time",!0,!0,1],["short hundredweight","cwt",["shweight"],"mass",!1,!0,45.359237],["siemens","S",null,"electrical_conductance",!0,!1,1],["sievert","Sv",null,"equivalent_dose",!0,!1,1],["slug","sg",null,"mass",!1,!0,14.59390294],["square ångström","ang2",["ang^2"],"area",!1,!0,1e-20],["square foot","ft2",["ft^2"],"area",!1,!0,.09290304],["square inch","in2",["in^2"],"area",!1,!0,64516e-8],["square light-year","ly2",["ly^2"],"area",!1,!0,895054210748189e17],["square meter","m?",null,"area",!0,!0,1],["square mile","mi2",["mi^2"],"area",!1,!0,2589988110336e-6],["square nautical mile","Nmi2",["Nmi^2"],"area",!1,!0,3429904],["square Pica","Pica2",["Picapt2","Pica^2","Picapt^2"],"area",!1,!0,1792111111111e-17],["square yard","yd2",["yd^2"],"area",!1,!0,.83612736],["statute mile","mi",null,"length",!1,!0,1609.344],["steradian","sr",null,"solid_angle",!0,!1,1],["stilb","sb",null,"luminance",!1,!1,1e-4],["stokes","St",null,"kinematic_viscosity",!1,!1,1e-4],["stone","stone",null,"mass",!1,!0,6.35029318],["tablespoon","tbs",null,"volume",!1,!0,147868e-10],["teaspoon","tsp",null,"volume",!1,!0,492892e-11],["tesla","T",null,"magnetic_flux_density",!0,!0,1],["thermodynamic calorie","c",null,"energy",!1,!0,4.184],["ton","ton",null,"mass",!1,!0,907.18474],["tonne","t",null,"mass",!1,!1,1e3],["U.K. pint","uk_pt",null,"volume",!1,!0,.00056826125],["U.S. bushel","bushel",null,"volume",!1,!0,.03523907],["U.S. oil barrel","barrel",null,"volume",!1,!0,.158987295],["U.S. pint","pt",["us_pt"],"volume",!1,!0,.000473176473],["U.S. survey mile","survey_mi",null,"length",!1,!0,1609.347219],["U.S. survey/statute acre","us_acre",null,"area",!1,!0,4046.87261],["volt","V",null,"voltage",!0,!1,1],["watt","W",null,"power",!0,!0,1],["watt-hour","Wh",["wh"],"energy",!1,!0,3600],["weber","Wb",null,"magnetic_flux",!0,!1,1],["yard","yd",null,"length",!1,!0,.9144],["year","yr",null,"time",!1,!0,31557600]]);A(this,"_binaryPrefixes",{Yi:["yobi",80,12089258196146292e8,"Yi","yotta"],Zi:["zebi",70,11805916207174113e5,"Zi","zetta"],Ei:["exbi",60,1152921504606847e3,"Ei","exa"],Pi:["pebi",50,0x4000000000000,"Pi","peta"],Ti:["tebi",40,1099511627776,"Ti","tera"],Gi:["gibi",30,1073741824,"Gi","giga"],Mi:["mebi",20,1048576,"Mi","mega"],ki:["kibi",10,1024,"ki","kilo"]});A(this,"_unitPrefixes",{Y:["yotta",1e24,"Y"],Z:["zetta",1e21,"Z"],E:["exa",1e18,"E"],P:["peta",1e15,"P"],T:["tera",1e12,"T"],G:["giga",1e9,"G"],M:["mega",1e6,"M"],k:["kilo",1e3,"k"],h:["hecto",100,"h"],e:["dekao",10,"e"],d:["deci",.1,"d"],c:["centi",.01,"c"],m:["milli",.001,"m"],u:["micro",1e-6,"u"],n:["nano",1e-9,"n"],p:["pico",1e-12,"p"],f:["femto",1e-15,"f"],a:["atto",1e-18,"a"],z:["zepto",1e-21,"z"],y:["yocto",1e-24,"y"]})}calculate(e,t,r){const{isError:n,errorObject:s,variants:a}=Q(e,t,r);if(n)return s;const[u,c,l]=a,f=+u.getValue(),m=`${c.getValue()}`,d=`${l.getValue()}`;if(Number.isNaN(f))return g.create(h.VALUE);let C,_=1,E,R=1;const{_from:b,_to:p}=this._lookupFromAndToUnits(m,d);if(C=b,E=p,C===null){const{_from:S,_fromMultiplier:D}=this._lookupFromPrefix(m);C=S,_=D}if(E===null){const{_to:S,_toMultiplier:D}=this._lookupToPrefix(d);E=S,R=D}if(C===null||E===null||C[3]!==E[3])return g.create(h.NA);let V;return C[3]==="temperature"?(V=this._getTemperatureConversion(f,C[1],E[1]),V=+V.toFixed(2)):V=f*C[6]*_/(E[6]*R),y.create(V)}_lookupFromAndToUnits(e,t){let r=null,n=null,s;for(let a=0;a<this._units.length;a++)s=this._units[a][2]===null?[]:this._units[a][2],(this._units[a][1]===e||s.indexOf(e)>=0)&&(r=this._units[a]),(this._units[a][1]===t||s.indexOf(t)>=0)&&(n=this._units[a]);return{_from:r,_to:n}}_lookupFromPrefix(e){let t=null,r=1,n=e,s;const a=this._binaryPrefixes[e.substring(0,2)];let u=this._unitPrefixes[e.substring(0,1)];e.substring(0,2)==="da"&&(u=["dekao",10,"da"]),a?(r=a[2],n=e.substring(2)):u&&(r=u[1],n=e.substring(u[2].length));for(let c=0;c<this._units.length;c++)s=this._units[c][2]===null?[]:this._units[c][2],(this._units[c][1]===n||s.indexOf(n)>=0)&&(t=this._units[c]);return{_from:t,_fromMultiplier:r}}_lookupToPrefix(e){let t=null,r=1,n=e,s;const a=this._binaryPrefixes[e.substring(0,2)];let u=this._unitPrefixes[e.substring(0,1)];e.substring(0,2)==="da"&&(u=["dekao",10,"da"]),a?(r=a[2],n=e.substring(2)):u&&(r=u[1],n=e.substring(u[2].length));for(let c=0;c<this._units.length;c++)s=this._units[c][2]===null?[]:this._units[c][2],(this._units[c][1]===n||s.indexOf(n)>=0)&&(t=this._units[c]);return{_to:t,_toMultiplier:r}}_getTemperatureConversion(e,t,r){switch(t){case"C":return this._centigradeConversion(e,r);case"F":return this._fahrenheitConversion(e,r);case"K":return this._kelvinConversion(e,r);case"Rank":return this._rankineConversion(e,r);case"Reau":return this._reaumurConversion(e,r);default:return e}}_centigradeConversion(e,t){switch(t){case"F":return e*9/5+32;case"K":return e+273.15;case"Rank":return(e+273.15)*9/5;case"Reau":return e*4/5;default:return e}}_fahrenheitConversion(e,t){switch(t){case"C":return(e-32)*5/9;case"K":return(e-32)*5/9+273.15;case"Rank":return e+459.67;case"Reau":return(e-32)*4/9;default:return e}}_kelvinConversion(e,t){switch(t){case"C":return e-273.15;case"F":return(e-273.15)*9/5+32;case"Rank":return e*9/5;case"Reau":return(e-273.15)*4/5;default:return e}}_rankineConversion(e,t){switch(t){case"C":return(e-491.67)*5/9;case"F":return e-459.67;case"K":return e*5/9;case"Reau":return(e-491.67)*4/9;default:return e}}_reaumurConversion(e,t){switch(t){case"C":return e*5/4;case"F":return e*9/4+32;case"K":return e*5/4+273.15;case"Rank":return e*9/4+491.67;default:return e}}}class Fg extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){if(e.isNull())return g.create(h.NA);let r=0;if(t){const{isError:f,errorObject:m,variants:d}=Q(t);if(f)return m;const[C]=d;if(r=Math.floor(+C.getValue()),Number.isNaN(r))return g.create(h.VALUE);if(r<0||r>10)return g.create(h.NUM)}const{isError:n,errorObject:s,variants:a}=Q(e);if(n)return s;const[u]=a,c=Math.trunc(+u.getValue());if(Number.isNaN(c))return g.create(h.VALUE);if(!/^-?[0-9]{1,3}$/.test(`${c}`)||c<-512||c>511)return g.create(h.NUM);let l;if(c<0){const f=(512+c).toString(2);l=`1${"0".repeat(9-f.length)}${f}`}else if(l=Number.parseInt(`${c}`,10).toString(2),t){if(r<l.length)return g.create(h.NUM);l="0".repeat(r-l.length)+l}return T.create(l)}}class Bg extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){if(e.isNull())return g.create(h.NA);let r=0;if(t){const{isError:f,errorObject:m,variants:d}=Q(t);if(f)return m;const[C]=d;if(r=Math.floor(+C.getValue()),Number.isNaN(r))return g.create(h.VALUE);if(r<0||r>10)return g.create(h.NUM)}const{isError:n,errorObject:s,variants:a}=Q(e);if(n)return s;const[u]=a,c=Math.trunc(+u.getValue());if(Number.isNaN(c))return g.create(h.VALUE);if(!/^-?[0-9]{1,12}$/.test(`${c}`)||c<-549755813888||c>549755813887)return g.create(h.NUM);let l;if(c<0)l=(1099511627776+c).toString(16);else if(l=Number.parseInt(`${c}`,10).toString(16),t){if(r<l.length)return g.create(h.NUM);l="0".repeat(r-l.length)+l}return T.create(l.toLocaleUpperCase())}}class kg extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){if(e.isNull())return g.create(h.NA);let r=0;if(t){const{isError:f,errorObject:m,variants:d}=Q(t);if(f)return m;const[C]=d;if(r=Math.floor(+C.getValue()),Number.isNaN(r))return g.create(h.VALUE);if(r<0||r>10)return g.create(h.NUM)}const{isError:n,errorObject:s,variants:a}=Q(e);if(n)return s;const[u]=a,c=Math.trunc(+u.getValue());if(Number.isNaN(c))return g.create(h.VALUE);if(!/^-?[0-9]{1,9}$/.test(`${c}`)||c<-536870912||c>536870911)return g.create(h.NUM);let l;if(c<0)l=(1073741824+c).toString(8);else if(l=Number.parseInt(`${c}`,10).toString(8),t){if(r<l.length)return g.create(h.NUM);l="0".repeat(r-l.length)+l}return T.create(l)}}class $g extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){const r=t!=null?t:y.create(0),{isError:n,errorObject:s,variants:a}=Q(e,r);if(n)return s;const[u,c]=a,l=+u.getValue(),f=+c.getValue();if(Number.isNaN(l)||Number.isNaN(f))return g.create(h.VALUE);const m=l===f?1:0;return y.create(m)}}class Yg extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){let r;if(t){const{isError:n,errorObject:s,variants:a}=Q(e,t);if(n)return s;const[u,c]=a,l=+u.getValue(),f=+c.getValue();if(Number.isNaN(l)||Number.isNaN(f))return g.create(h.VALUE);r=Wt(f)-Wt(l)}else{const{isError:n,errorObject:s,variants:a}=Q(e);if(n)return s;const[u]=a,c=+u.getValue();if(Number.isNaN(c))return g.create(h.VALUE);r=Wt(c)}return y.create(r)}}class Hg extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=Q(e);if(t)return r;const[s]=n,a=+s.getValue();if(Number.isNaN(a))return g.create(h.VALUE);const u=Wt(a);return y.create(u)}}class Gg extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=Q(e);if(t)return r;const[s]=n,a=+s.getValue();if(Number.isNaN(a))return g.create(h.VALUE);const u=Ra(a);return y.create(u)}}class Wg extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=Q(e);if(t)return r;const[s]=n,a=+s.getValue();if(Number.isNaN(a))return g.create(h.VALUE);const u=Ra(a);return y.create(u)}}var q=(i=>(i.BESSELI="BESSELI",i.BESSELJ="BESSELJ",i.BESSELK="BESSELK",i.BESSELY="BESSELY",i.BIN2DEC="BIN2DEC",i.BIN2HEX="BIN2HEX",i.BIN2OCT="BIN2OCT",i.BITAND="BITAND",i.BITLSHIFT="BITLSHIFT",i.BITOR="BITOR",i.BITRSHIFT="BITRSHIFT",i.BITXOR="BITXOR",i.COMPLEX="COMPLEX",i.CONVERT="CONVERT",i.DEC2BIN="DEC2BIN",i.DEC2HEX="DEC2HEX",i.DEC2OCT="DEC2OCT",i.DELTA="DELTA",i.ERF="ERF",i.ERF_PRECISE="ERF.PRECISE",i.ERFC="ERFC",i.ERFC_PRECISE="ERFC.PRECISE",i.GESTEP="GESTEP",i.HEX2BIN="HEX2BIN",i.HEX2DEC="HEX2DEC",i.HEX2OCT="HEX2OCT",i.IMABS="IMABS",i.IMAGINARY="IMAGINARY",i.IMARGUMENT="IMARGUMENT",i.IMCONJUGATE="IMCONJUGATE",i.IMCOS="IMCOS",i.IMCOSH="IMCOSH",i.IMCOT="IMCOT",i.IMCOTH="IMCOTH",i.IMCSC="IMCSC",i.IMCSCH="IMCSCH",i.IMDIV="IMDIV",i.IMEXP="IMEXP",i.IMLN="IMLN",i.IMLOG="IMLOG",i.IMLOG10="IMLOG10",i.IMLOG2="IMLOG2",i.IMPOWER="IMPOWER",i.IMPRODUCT="IMPRODUCT",i.IMREAL="IMREAL",i.IMSEC="IMSEC",i.IMSECH="IMSECH",i.IMSIN="IMSIN",i.IMSINH="IMSINH",i.IMSQRT="IMSQRT",i.IMSUB="IMSUB",i.IMSUM="IMSUM",i.IMTAN="IMTAN",i.IMTANH="IMTANH",i.OCT2BIN="OCT2BIN",i.OCT2DEC="OCT2DEC",i.OCT2HEX="OCT2HEX",i))(q||{});class Qg extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){if(e.isNull())return g.create(h.NA);const r=t!=null?t:y.create(0),{isError:n,errorObject:s,variants:a}=Q(e,r);if(n)return s;const[u,c]=a,l=+u.getValue(),f=+c.getValue();if(Number.isNaN(l)||Number.isNaN(f))return g.create(h.VALUE);const m=l>=f?1:0;return y.create(m)}}class qg extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){if(e.isNull())return g.create(h.NA);let r=0;if(t){const{isError:d,errorObject:C,variants:_}=Q(t);if(d)return C;const[E]=_;if(r=Math.floor(+E.getValue()),Number.isNaN(r))return g.create(h.VALUE);if(r<0||r>10)return g.create(h.NUM)}const{isError:n,errorObject:s,variants:a}=Q(e);if(n)return s;const[u]=a,c=`${u.getValue()}`;if(!Ea(c))return g.create(h.NUM);const l=c.length===10&&c.substring(0,1).toLocaleUpperCase()==="F",f=l?Number.parseInt(c,16)-1099511627776:Number.parseInt(c,16);if(f<-512||f>511)return g.create(h.NUM);let m;if(l){const d=(512+f).toString(2);m=`1${"0".repeat(9-d.length)}${d}`}else if(m=f.toString(2),t){if(r<m.length)return g.create(h.NUM);m="0".repeat(r-m.length)+m}return T.create(m)}}class Xg extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=Q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`;if(!Ea(a))return g.create(h.NUM);let u=Number.parseInt(a,16);return u>=549755813888&&(u-=1099511627776),y.create(u)}}class Kg extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){if(e.isNull())return g.create(h.NA);let r=0;if(t){const{isError:m,errorObject:d,variants:C}=Q(t);if(m)return d;const[_]=C;if(r=Math.floor(+_.getValue()),Number.isNaN(r))return g.create(h.VALUE);if(r<0||r>10)return g.create(h.NUM)}const{isError:n,errorObject:s,variants:a}=Q(e);if(n)return s;const[u]=a,c=`${u.getValue()}`;if(!Ea(c))return g.create(h.NUM);const l=Number.parseInt(c,16);if(l>536870911&&l<0xffe0000000)return g.create(h.NUM);let f;if(l>=0xffe0000000)f=(l-0xffc0000000).toString(8);else if(f=l.toString(8),t){if(r<f.length)return g.create(h.NUM);f="0".repeat(r-f.length)+f}return T.create(f)}}class Zg extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=Q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new he(a);if(u.isError())return g.create(h.NUM);const c=u.Abs();return y.create(c)}}class zg extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=Q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new he(a);if(u.isError())return g.create(h.NUM);const c=u.getINum();return y.create(c)}}class Jg extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=Q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new he(a);if(u.isError())return g.create(h.NUM);if(u.getRealNum()===0&&u.getINum()===0)return g.create(h.DIV_BY_ZERO);const c=u.Argument();return y.create(c)}}class e1 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=Q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new he(a);if(u.isError())return g.create(h.NUM);const c=u.Conjugate();return typeof c=="number"||M.isRealNum(c)?y.create(+c):T.create(c)}}class t1 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=Q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new he(a);if(u.isError())return g.create(h.NUM);const c=u.Cos();return typeof c=="number"||M.isRealNum(c)?y.create(+c):T.create(c)}}class r1 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=Q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new he(a);if(u.isError())return g.create(h.NUM);const c=u.Cosh();return u.isError()?g.create(h.NUM):typeof c=="number"||M.isRealNum(c)?y.create(+c):T.create(c)}}class n1 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=Q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new he(a);if(u.isError()||u.getRealNum()===0&&u.getINum()===0)return g.create(h.NUM);const c=u.Cot();return typeof c=="number"||M.isRealNum(c)?y.create(+c):T.create(c)}}class s1 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=Q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new he(a);if(u.isError()||u.getRealNum()===0&&u.getINum()===0)return g.create(h.NUM);const c=u.Coth();return u.isError()?g.create(h.NUM):typeof c=="number"||M.isRealNum(c)?y.create(+c):T.create(c)}}class a1 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=Q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new he(a);if(u.isError()||u.getRealNum()===0&&u.getINum()===0)return g.create(h.NUM);const c=u.Csc();return typeof c=="number"||M.isRealNum(c)?y.create(+c):T.create(c)}}class i1 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=Q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new he(a);if(u.isError()||u.getRealNum()===0&&u.getINum()===0)return g.create(h.NUM);const c=u.Csch();return typeof c=="number"||M.isRealNum(c)?y.create(+c):T.create(c)}}class o1 extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return g.create(h.NA);const{isError:r,errorObject:n,variants:s}=Q(e,t);if(r)return n;const[a,u]=s,c=`${a.getValue()}`,l=`${u.getValue()}`,f=new he(c),m=new he(l);if(f.isError()||m.isError()||f.isDifferentSuffixes(m)||m.getRealNum()===0&&m.getINum()===0)return g.create(h.NUM);const d=f.Div(m);return typeof d=="number"||M.isRealNum(d)?y.create(+d):T.create(d)}}class u1 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=Q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new he(a);if(u.isError())return g.create(h.NUM);const c=u.Exp();return u.isError()?g.create(h.NUM):typeof c=="number"||M.isRealNum(c)?y.create(+c):T.create(c)}}class c1 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=Q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new he(a);if(u.isError()||u.getRealNum()===0&&u.getINum()===0)return g.create(h.NUM);const c=u.Ln();return typeof c=="number"||M.isRealNum(c)?y.create(+c):T.create(c)}}class l1 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,variants:s}=Q(e);if(r)return n;const[a]=s;let u=t!=null?t:y.create(10);if(u.isArray()){const R=u.getRowCount(),b=u.getColumnCount();if(R>1||b>1)return g.create(h.VALUE);u=u.get(0,0)}const{isError:c,errorObject:l,variants:f}=F(u);if(c)return l;const[m]=f,d=`${a.getValue()}`,C=+m.getValue(),_=new he(d);if(_.isError()||_.getRealNum()===0&&_.getINum()===0||C<=0)return g.create(h.NUM);const E=_.Log(C);return _.isError()?g.create(h.NUM):typeof E=="number"||M.isRealNum(E)?y.create(+E):T.create(E)}}class f1 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=Q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new he(a);if(u.isError()||u.getRealNum()===0&&u.getINum()===0)return g.create(h.NUM);const c=u.Log(2);return typeof c=="number"||M.isRealNum(c)?y.create(+c):T.create(c)}}class m1 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=Q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new he(a);if(u.isError()||u.getRealNum()===0&&u.getINum()===0)return g.create(h.NUM);const c=u.Log(10);return typeof c=="number"||M.isRealNum(c)?y.create(+c):T.create(c)}}class h1 extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return g.create(h.NA);const{isError:r,errorObject:n,variants:s}=Q(e,t);if(r)return n;const[a,u]=s,c=`${a.getValue()}`,l=new he(c);if(l.isError())return g.create(h.NUM);const f=+u.getValue();if(Number.isNaN(f))return g.create(h.VALUE);const m=l.Power(f);return l.isError()?g.create(h.NUM):typeof m=="number"||M.isRealNum(m)?y.create(+m):T.create(m)}}class g1 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t="";for(let r=0;r<e.length;r++){if(t instanceof g)return t;const n=e[r];if(n.isArray()){let s=!1,a;if(n.iterator(u=>{if(t=this._handleSingleObject(u,t),t instanceof g)return s=!0,a=t,!1}),s)return a}else t=this._handleSingleObject(n,t)}return t instanceof g?t:typeof t=="number"||M.isRealNum(t)?y.create(+t):T.create(t)}_handleSingleObject(e,t){let r=t;if(e.isError())return e;if(e.isBoolean())return g.create(h.VALUE);const n=`${e.getValue()}`;if(typeof t!="number"&&!t){const s=new he(n);if(s.isError())return g.create(h.NUM);r=s.toString()}else{const s=new he(t),a=new he(n);if(s.isError()||a.isError())return g.create(h.NUM);if(s.isDifferentSuffixes(a))return g.create(h.VALUE);r=s.Product(a)}return r}}class d1 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=Q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new he(a);if(u.isError())return g.create(h.NUM);const c=u.getRealNum();return y.create(c)}}class C1 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=Q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new he(a);if(u.isError())return g.create(h.NUM);const c=u.Sec();return typeof c=="number"||M.isRealNum(c)?y.create(+c):T.create(c)}}class _1 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=Q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new he(a);if(u.isError())return g.create(h.NUM);const c=u.Sech();return typeof c=="number"||M.isRealNum(c)?y.create(+c):T.create(c)}}class A1 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=Q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new he(a);if(u.isError())return g.create(h.NUM);const c=u.Sin();return typeof c=="number"||M.isRealNum(c)?y.create(+c):T.create(c)}}class E1 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=Q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new he(a);if(u.isError())return g.create(h.NUM);const c=u.Sinh();return u.isError()?g.create(h.NUM):typeof c=="number"||M.isRealNum(c)?y.create(+c):T.create(c)}}class R1 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=Q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new he(a);if(u.isError())return g.create(h.NUM);if(u.getRealNum()===0&&u.getINum()===0)return y.create(0);const c=u.Sqrt();return typeof c=="number"||M.isRealNum(c)?y.create(+c):T.create(c)}}class b1 extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return g.create(h.NA);const{isError:r,errorObject:n,variants:s}=Q(e,t);if(r)return n;const[a,u]=s,c=`${a.getValue()}`,l=`${u.getValue()}`,f=new he(c),m=new he(l);if(f.isError()||m.isError()||f.isDifferentSuffixes(m))return g.create(h.NUM);const d=f.Sub(m);return typeof d=="number"||M.isRealNum(d)?y.create(+d):T.create(d)}}class y1 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t="";for(let r=0;r<e.length;r++){if(t instanceof g)return t;const n=e[r];if(n.isArray()){let s=!1,a;if(n.iterator(u=>{if(t=this._handleSingleObject(u,t),t instanceof g)return s=!0,a=t,!1}),s)return a}else t=this._handleSingleObject(n,t)}return t instanceof g?t:typeof t=="number"||M.isRealNum(t)?y.create(+t):T.create(t)}_handleSingleObject(e,t){let r=t;if(e.isError())return e;if(e.isBoolean())return g.create(h.VALUE);const n=`${e.getValue()}`;if(typeof t!="number"&&!t){const s=new he(n);if(s.isError())return g.create(h.NUM);r=s.toString()}else{const s=new he(t),a=new he(n);if(s.isError()||a.isError())return g.create(h.NUM);if(s.isDifferentSuffixes(a))return g.create(h.VALUE);r=s.Sum(a)}return r}}class p1 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=Q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new he(a);if(u.isError())return g.create(h.NUM);const c=u.Tan();return typeof c=="number"||M.isRealNum(c)?y.create(+c):T.create(c)}}class N1 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=Q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`,u=new he(a);if(u.isError())return g.create(h.NUM);const c=u.Tanh();return u.isError()?g.create(h.NUM):typeof c=="number"||M.isRealNum(c)?y.create(+c):T.create(c)}}class V1 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){if(e.isNull())return g.create(h.NA);let r=0;if(t){const{isError:d,errorObject:C,variants:_}=Q(t);if(d)return C;const[E]=_;if(r=Math.floor(+E.getValue()),Number.isNaN(r))return g.create(h.VALUE);if(r<0||r>10)return g.create(h.NUM)}const{isError:n,errorObject:s,variants:a}=Q(e);if(n)return s;const[u]=a,c=`${u.getValue()}`;if(!Aa(c))return g.create(h.NUM);const l=c.length===10&&c.substring(0,1)==="7",f=l?Number.parseInt(c,8)-1073741824:Number.parseInt(c,8);if(f<-512||f>511)return g.create(h.NUM);let m;if(l){const d=(512+f).toString(2);m=`1${"0".repeat(9-d.length)}${d}`}else if(m=f.toString(2),t){if(r<m.length)return g.create(h.NUM);m="0".repeat(r-m.length)+m}return T.create(m)}}class O1 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=Q(e);if(t)return r;const[s]=n,a=`${s.getValue()}`;if(!Aa(a))return g.create(h.NUM);let u=Number.parseInt(a,8);return u>=536870912&&(u-=1073741824),y.create(u)}}class S1 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){if(e.isNull())return g.create(h.NA);let r=0;if(t){const{isError:m,errorObject:d,variants:C}=Q(t);if(m)return d;const[_]=C;if(r=Math.floor(+_.getValue()),Number.isNaN(r))return g.create(h.VALUE);if(r<0||r>10)return g.create(h.NUM)}const{isError:n,errorObject:s,variants:a}=Q(e);if(n)return s;const[u]=a,c=`${u.getValue()}`;if(!Aa(c))return g.create(h.NUM);const l=Number.parseInt(c,8);let f;if(l>=536870912)f=`ff${(l+3221225472).toString(16)}`;else if(f=l.toString(16),t){if(r<f.length)return g.create(h.NUM);f="0".repeat(r-f.length)+f}return T.create(f.toLocaleUpperCase())}}const Gu=[[Vg,q.BESSELI],[Og,q.BESSELJ],[Sg,q.BESSELK],[Mg,q.BESSELY],[Dg,q.BIN2DEC],[wg,q.BIN2HEX],[Lg,q.BIN2OCT],[Pg,q.BITAND],[xg,q.BITLSHIFT],[jg,q.BITOR],[Ug,q.BITRSHIFT],[Tg,q.BITXOR],[vg,q.COMPLEX],[Ig,q.CONVERT],[Fg,q.DEC2BIN],[Bg,q.DEC2HEX],[kg,q.DEC2OCT],[$g,q.DELTA],[Yg,q.ERF],[Hg,q.ERF_PRECISE],[Gg,q.ERFC],[Wg,q.ERFC_PRECISE],[Qg,q.GESTEP],[qg,q.HEX2BIN],[Xg,q.HEX2DEC],[Kg,q.HEX2OCT],[Zg,q.IMABS],[zg,q.IMAGINARY],[Jg,q.IMARGUMENT],[e1,q.IMCONJUGATE],[t1,q.IMCOS],[r1,q.IMCOSH],[n1,q.IMCOT],[s1,q.IMCOTH],[a1,q.IMCSC],[i1,q.IMCSCH],[o1,q.IMDIV],[u1,q.IMEXP],[c1,q.IMLN],[l1,q.IMLOG],[m1,q.IMLOG10],[f1,q.IMLOG2],[h1,q.IMPOWER],[g1,q.IMPRODUCT],[d1,q.IMREAL],[C1,q.IMSEC],[_1,q.IMSECH],[A1,q.IMSIN],[E1,q.IMSINH],[R1,q.IMSQRT],[b1,q.IMSUB],[y1,q.IMSUM],[p1,q.IMTAN],[N1,q.IMTANH],[V1,q.OCT2BIN],[O1,q.OCT2DEC],[S1,q.OCT2HEX]];var ee=(i=>(i.ACCRINT="ACCRINT",i.ACCRINTM="ACCRINTM",i.AMORDEGRC="AMORDEGRC",i.AMORLINC="AMORLINC",i.COUPDAYBS="COUPDAYBS",i.COUPDAYS="COUPDAYS",i.COUPDAYSNC="COUPDAYSNC",i.COUPNCD="COUPNCD",i.COUPNUM="COUPNUM",i.COUPPCD="COUPPCD",i.CUMIPMT="CUMIPMT",i.CUMPRINC="CUMPRINC",i.DB="DB",i.DDB="DDB",i.DISC="DISC",i.DOLLARDE="DOLLARDE",i.DOLLARFR="DOLLARFR",i.DURATION="DURATION",i.EFFECT="EFFECT",i.FV="FV",i.FVSCHEDULE="FVSCHEDULE",i.INTRATE="INTRATE",i.IPMT="IPMT",i.IRR="IRR",i.ISPMT="ISPMT",i.MDURATION="MDURATION",i.MIRR="MIRR",i.NOMINAL="NOMINAL",i.NPER="NPER",i.NPV="NPV",i.ODDFPRICE="ODDFPRICE",i.ODDFYIELD="ODDFYIELD",i.ODDLPRICE="ODDLPRICE",i.ODDLYIELD="ODDLYIELD",i.PDURATION="PDURATION",i.PMT="PMT",i.PPMT="PPMT",i.PRICE="PRICE",i.PRICEDISC="PRICEDISC",i.PRICEMAT="PRICEMAT",i.PV="PV",i.RATE="RATE",i.RECEIVED="RECEIVED",i.RRI="RRI",i.SLN="SLN",i.SYD="SYD",i.TBILLEQ="TBILLEQ",i.TBILLPRICE="TBILLPRICE",i.TBILLYIELD="TBILLYIELD",i.VDB="VDB",i.XIRR="XIRR",i.XNPV="XNPV",i.YIELD="YIELD",i.YIELDDISC="YIELDDISC",i.YIELDMAT="YIELDMAT",i))(ee||{});function ls(i,o,e,t){const r=Tt(i,o,e),{days:n}=Ae(r,i,t);return n}function Qe(i,o,e,t){let r;if(t===1){const n=Tt(i,o,e);let s=ae(n);s=Cr(s,12/e);const a=ye(s);n<0&&e===1?r=365:r=a-n}else t===3?r=365/e:r=360/e;return r}function Wu(i,o,e){const t=ae(i);let r=ae(o);for(r.setUTCFullYear(t.getUTCFullYear()),r<t&&r.setUTCFullYear(r.getUTCFullYear()+1);r>t;)r=Cr(r,-12/e);return r=Cr(r,12/e),ye(r)}function zt(i,o,e){let t=0;const r=ae(i);let n=ae(o);for(;n>r;)n=Cr(n,-12/e),t++;return t}function Tt(i,o,e){const t=ae(i);let r=ae(o);for(r.setUTCFullYear(t.getUTCFullYear()),r<t&&r.setUTCFullYear(r.getUTCFullYear()+1);r>t;)r=Cr(r,-12/e);return ye(r)}function Qu(i,o,e,t,r,n){const s=ls(i,o,r,n),a=Qe(i,o,r,n),u=zt(i,o,r),c=(a-s)/a-1,l=t/r+1,f=e*100/r;let m=0,d=0;for(let E=1;E<=u;E++){const R=E+c,b=f/l**R;m+=R*b,d+=b}const C=u+c,_=100/l**C;return m+=C*_,d+=_,m/d/r}function Hr(i,o,e,t,r){let n;if(i===0)n=(e+t)/o;else{const s=(1+i)**o;n=r===1?(t*i/(s-1)+e*i/(1-1/s))/(1+i):t*i/(s-1)+e*i/(1-1/s)}return-n}function Jt(i,o,e,t,r){let n;if(i===0)n=t+e*o;else{if(i===-1&&o===0)return Number.NaN;const s=(1+i)**o;n=r===1?t*s+e*(1+i)*(s-1)/i:t*s+e*(s-1)/i}return-n}function qu(i,o,e,t,r,n){const s=Hr(i,e,t,r,n);return(o===1?n===1?0:-t:n===1?Jt(i,o-2,s,t,1)-s:Jt(i,o-1,s,t,0))*i}function Xu(i,o){let e=0;for(let t=1;t<=o.length;t++)e+=o[t-1]/(1+i)**t;return e}function Ku(i,o,e,t,r,n,s,a,u){const c=Ht(e,t,u),l=Qe(i,t,a,u);return c<l?M1(i,o,e,t,r,n,s,a,u,c,l):D1(i,o,e,t,r,n,s,a,u,l)}function M1(i,o,e,t,r,n,s,a,u,c,l){let f=0;const m=zt(i,o,a),d=Ht(i,t,u);f+=s/(1+n/a)**(m-1+d/l),f+=100*r/a*c/l/(1+n/a)**(d/l);for(let _=2;_<=m;_++)f+=100*r/a/(1+n/a)**(_-1+d/l);const C=Ht(e,i,u);return f-=100*r/a*C/l,f}function D1(i,o,e,t,r,n,s,a,u,c){let l=0;const f=zt(t,o,a),m=w1(t,i,12/a);let d;if(u===2||u===3){const b=Wu(i,t,a);d=Ht(i,b,u)}else{const b=Tt(i,t,a),{days:p}=Ae(b,i,u);d=c-p}l+=s/(1+n/a)**(f+m+d/c);const C=zt(e,t,a);let _=t,E=0,R=0;for(let b=C;b>=1;b--){const p=qt(_,-12/a,!1),V=u===1?Ht(p,_,u):c,S=b>1?V:Ht(e,_,u);E+=S/V;const D=e>p?e:p,w=i<_?i:_,L=Ht(D,w,u);R+=L/V,_=p}l+=100*r/a*E/(1+n/a)**(m+d/c);for(let b=1;b<=f;b++)l+=100*r/a/(1+n/a)**(b+m+d/c);return l-=100*r/a*R,l}function Ht(i,o,e){const{days:t}=Ae(i,o,e);return i<o?t:0}function Zu(i,o,e){const t=ae(i),r=t.getUTCFullYear(),n=t.getUTCMonth(),s=t.getUTCDate(),a=dr(r,n,s),u=ae(o),c=u.getUTCFullYear(),l=u.getUTCMonth(),f=u.getUTCDate(),m=dr(c,l,f);return!(s!==f&&!(a&&m)||Math.abs((c-r)*12+(l-n))%(12/e)!==0)}function Rr(i,o,e){return Tt(i,o,e)>=0}function qt(i,o,e){let t=ae(i);if(t=Cr(t,o),e){const r=t.getUTCFullYear(),n=t.getUTCMonth(),s=Yr(r,n);t.setUTCDate(s)}return ye(t)}function w1(i,o,e,t){const r=ae(i),n=ae(o),s=r.getUTCFullYear(),a=r.getUTCMonth(),u=r.getUTCDate(),c=n.getUTCFullYear(),l=n.getUTCMonth(),f=n.getUTCDate(),m=dr(s,a,u),d=!m&&a!==1&&u>28&&u<Yr(s,a)?dr(c,l,f):m,C=qt(o,0,d);let _=1+ +(o<C),E=qt(C,e,d);for(;!(e>0?E>=o:E<=o);)E=qt(E,e,d),_++;return _}function Ua(i,o){let n=1,s=0,a=i,u;for(;n>1e-7&&s<500;){const c=(o(a+1e-7)-o(a-1e-7))/2e-7;u=a-o(a)/c,s++,n=Math.abs(u-a),a=u}return Number.isNaN(a)||Math.abs(a)===1/0||s===500?L1(i,o):a}function L1(i,o){const r=Number.MAX_VALUE,n=-1,s=1.6;let a=i-.01<=n?n+1e-7:i-.01,u=i+.01>=r?r-1e-7:i+.01,c,l,f=0;if(i<=n||i>=r)return g.create(h.NUM);for(let E=0;E<60;E++){c=a<=n?n+1e-7:a,l=u>=r?r-1e-7:u;const R=o(c),b=o(l);if(R*b<=0)break;if(R*b>0)a=c+s*(c-l),u=l+s*(l-c);else return g.create(h.NUM);if(E===59)return g.create(h.NUM)}c=c,l=l;let m=o(c);const d=o(l);let C,_;if(Math.abs(m)<1e-7||Math.abs(d)<1e-7)return g.create(h.NUM);do _=c+(l-c)/2,C=o(_),m*C<0?l=_:c=_,m=o(c),f++;while(Math.abs(C)>1e-7&&f<60);return _}function ln(i,o,e,t,r,n,s){const a=zt(i,o,n),u=Qe(i,o,n,s),c=ls(i,o,n,s);if(a===1){const m=u-c,d=100*e/n+r,C=t/n*m/u+1,_=100*e/n*c/u;return d/C-_}const l=u-c;let f=r/(1+t/n)**(a-1+l/u);for(let m=1;m<=a;m++)f+=100*e/n/(1+t/n)**(m-1+l/u);return f-=100*e/n*c/u,f}function Qs(i,o,e,t,r){let n=0,s=r/e;s>=1?(s=1,n=t===1?i:0):n=i*(1-s)**(t-1);const a=i*(1-s)**t;let u=0;return a<o?u=n-o:u=n-a,u<0&&(u=0),u}class P1 extends N{constructor(){super(...arguments);A(this,"minParams",6);A(this,"maxParams",8)}calculate(e,t,r,n,s,a,u,c){const l=u!=null?u:y.create(0),f=c!=null?c:I.create(!0),{isError:m,errorObject:d,variants:C}=Q(e,t,r,n,s,a,l);if(m)return d;const[_,E,R,b,p,V,S]=C,D=G(_);if(typeof D!="number")return D;const w=G(E);if(typeof w!="number")return w;const L=G(R);if(typeof L!="number")return L;const P=+b.getValue(),v=+p.getValue(),U=Math.floor(+V.getValue()),$=Math.floor(+S.getValue()),W=+f.getValue();return Number.isNaN(P)||Number.isNaN(v)||Number.isNaN(U)||Number.isNaN($)||Number.isNaN(W)?g.create(h.VALUE):P<=0||v<=0||![1,2,4].includes(U)||$<0||$>4||Math.floor(D)>=Math.floor(L)?g.create(h.NUM):this._getResult(D,w,L,P,v,U,$,W)}_getResult(e,t,r,n,s,a,u,c){let l=Tt(e,t,a);if(l<=0)return y.create(0);l=Tt(r,t,a);const f=12/a,m=ae(t),d=m.getUTCFullYear(),C=m.getUTCMonth(),_=m.getUTCDate(),E=dr(d,C,_);let R=qt(t,-f,E);if(r>t&&c)for(R=t;R<r;)R=qt(R,f,E);let b=e>R?e:R,{days:p}=Ae(b,r,u);if(l>=e){const{days:P}=Ae(b,r,u?4:0);p=P}r<b&&(p=-p);let V=Qe(R,t,a,u),S=p/V,D=R,w=e;for(;D>e;){w=D,D=qt(D,-f,E),b=e>D?e:D;const{days:P}=Ae(b,w,u);if(u===0)w>=b||e<=D?p=P:p=-P,V=Qe(D,w,a,u);else if(p=w<b?-P:P,u===3)V=365/a;else{const{days:v}=Ae(D,w,u);V=w<D?-v:v}S+=e<=D?c?1:0:p/V}const L=s*n/a*S;return y.create(L)}}class x1 extends N{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",5)}calculate(e,t,r,n,s){const a=s!=null?s:y.create(0),{isError:u,errorObject:c,variants:l}=Q(e,t,r,n,a);if(u)return c;const[f,m,d,C,_]=l,E=G(f);if(typeof E!="number")return E;const R=G(m);if(typeof R!="number")return R;const b=+d.getValue(),p=+C.getValue(),V=Math.floor(+_.getValue());if(Number.isNaN(b)||Number.isNaN(p)||Number.isNaN(V))return g.create(h.VALUE);if(b<=0||p<=0||V<0||V>4||Math.floor(E)>Math.floor(R))return g.create(h.NUM);if(Math.floor(E)===Math.floor(R))return y.create(0);const{days:S,yearDays:D}=Ae(E,R,V),w=p*b*S/D;return y.create(w)}}class j1 extends N{constructor(){super(...arguments);A(this,"minParams",6);A(this,"maxParams",7)}calculate(e,t,r,n,s,a,u){const c=u!=null?u:y.create(0),{isError:l,errorObject:f,variants:m}=Q(e,t,r,n,s,a,c);if(l)return f;const[d,C,_,E,R,b,p]=m,V=G(C);if(typeof V!="number")return V;const S=G(_);if(typeof S!="number")return S;const D=+d.getValue(),w=+E.getValue();let L=+R.getValue();const P=+b.getValue(),v=Math.floor(+p.getValue());return Number.isNaN(D)||Number.isNaN(w)||Number.isNaN(L)||Number.isNaN(P)||Number.isNaN(v)?g.create(h.VALUE):D<=0||w<0||D<w||Math.floor(V)>Math.floor(S)||L<0||P<=0||![0,1,3,4].includes(v)?g.create(h.NUM):(L>1?L=Math.floor(L):L=Math.ceil(L),this._getResult(D,V,S,w,L,P,v))}_getResult(e,t,r,n,s,a,u){const c=e-n,l=e*a,{days:f,yearDays:m}=Ae(t,r,u),d=f/m,C=Math.ceil(c/l-d);if(C<0)return y.create(0);let _=l;return s===0?_=l*d:s===C?_=c-l*(d+s-1):s>C&&(_=0),y.create(_)}}class U1 extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",4)}calculate(e,t,r,n){const s=n!=null?n:y.create(0),{isError:a,errorObject:u,variants:c}=Q(e,t,r,s);if(a)return u;const[l,f,m,d]=c,C=G(l);if(typeof C!="number")return C;const _=G(f);if(typeof _!="number")return _;const E=Math.floor(+m.getValue()),R=Math.floor(+d.getValue());if(Number.isNaN(E)||Number.isNaN(R))return g.create(h.VALUE);if(![1,2,4].includes(E)||R<0||R>4||Math.floor(C)>=Math.floor(_))return g.create(h.NUM);const b=ls(C,_,E,R);return y.create(b)}}class T1 extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",4)}calculate(e,t,r,n){const s=n!=null?n:y.create(0),{isError:a,errorObject:u,variants:c}=Q(e,t,r,s);if(a)return u;const[l,f,m,d]=c,C=G(l);if(typeof C!="number")return C;const _=G(f);if(typeof _!="number")return _;const E=Math.floor(+m.getValue()),R=Math.floor(+d.getValue());if(Number.isNaN(E)||Number.isNaN(R))return g.create(h.VALUE);if(![1,2,4].includes(E)||R<0||R>4||Math.floor(C)>=Math.floor(_))return g.create(h.NUM);const b=Qe(C,_,E,R);return y.create(b)}}class v1 extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",4)}calculate(e,t,r,n){const s=n!=null?n:y.create(0),{isError:a,errorObject:u,variants:c}=Q(e,t,r,s);if(a)return u;const[l,f,m,d]=c,C=G(l);if(typeof C!="number")return C;const _=G(f);if(typeof _!="number")return _;const E=Math.floor(+m.getValue()),R=Math.floor(+d.getValue());if(Number.isNaN(E)||Number.isNaN(R))return g.create(h.VALUE);if(![1,2,4].includes(E)||R<0||R>4||Math.floor(C)>=Math.floor(_))return g.create(h.NUM);const b=ae(C),p=ae(_);for(p.setUTCFullYear(b.getUTCFullYear()),p<b&&p.setUTCFullYear(p.getUTCFullYear()+1);p>b;)p.setUTCMonth(p.getUTCMonth()-12/E);p.setUTCMonth(p.getUTCMonth()+12/E);const V=ye(p),{days:S}=Ae(C,V,R);return y.create(S)}}class I1 extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",4)}calculate(e,t,r,n){const s=n!=null?n:y.create(0),{isError:a,errorObject:u,variants:c}=Q(e,t,r,s);if(a)return u;const[l,f,m,d]=c,C=G(l);if(typeof C!="number")return C;const _=G(f);if(typeof _!="number")return _;const E=Math.floor(+m.getValue()),R=Math.floor(+d.getValue());if(Number.isNaN(E)||Number.isNaN(R))return g.create(h.VALUE);if(![1,2,4].includes(E)||R<0||R>4||Math.floor(C)>=Math.floor(_))return g.create(h.NUM);const b=Wu(C,_,E);return y.create(b)}}class F1 extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",4)}calculate(e,t,r,n){const s=n!=null?n:y.create(0),{isError:a,errorObject:u,variants:c}=Q(e,t,r,s);if(a)return u;const[l,f,m,d]=c,C=G(l);if(typeof C!="number")return C;const _=G(f);if(typeof _!="number")return _;const E=Math.floor(+m.getValue()),R=Math.floor(+d.getValue());if(Number.isNaN(E)||Number.isNaN(R))return g.create(h.VALUE);if(![1,2,4].includes(E)||R<0||R>4||Math.floor(C)>=Math.floor(_)||Tt(C,_,E)<0)return g.create(h.NUM);const p=zt(C,_,E);return y.create(p)}}class B1 extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",4)}calculate(e,t,r,n){const s=n!=null?n:y.create(0),{isError:a,errorObject:u,variants:c}=Q(e,t,r,s);if(a)return u;const[l,f,m,d]=c,C=G(l);if(typeof C!="number")return C;const _=G(f);if(typeof _!="number")return _;const E=Math.floor(+m.getValue()),R=Math.floor(+d.getValue());if(Number.isNaN(E)||Number.isNaN(R))return g.create(h.VALUE);if(![1,2,4].includes(E)||R<0||R>4||Math.floor(C)>=Math.floor(_))return g.create(h.NUM);let b=Tt(C,_,E);return b<0&&(b=0),y.create(b)}}class k1 extends N{constructor(){super(...arguments);A(this,"minParams",6);A(this,"maxParams",6)}calculate(e,t,r,n,s,a){const{isError:u,errorObject:c,variants:l}=Q(e,t,r,n,s,a);if(u)return c;const[f,m,d,C,_,E]=l,R=+f.getValue(),b=+m.getValue(),p=+d.getValue(),V=+C.getValue(),S=+_.getValue(),D=+E.getValue();return Number.isNaN(R)||Number.isNaN(b)||Number.isNaN(p)||Number.isNaN(V)||Number.isNaN(S)||Number.isNaN(D)?g.create(h.VALUE):R<=0||b<=0||p<=0||V<1||S<1||V>S||V>b||S>b||![0,1].includes(D)?g.create(h.NUM):Math.trunc(V)!==V&&Math.trunc(S)!==S&&Math.trunc(V)===Math.trunc(S)?y.create(0):this._getResult(R,b,p,V,S,D)}_getResult(e,t,r,n,s,a){const u=Hr(e,t,r,0,a);let c=0,l=Math.ceil(n);l===1&&(a===0&&(c=-r),l++);let f=!1;for(let m=l;m<=s;m++){const d=a===1?Jt(e,m-2,u,r,1):Jt(e,m-1,u,r,0);if(d===0){f=!0;break}c+=a===1?d-u:d}return c*=e,(c<u*(s-n+1)||f)&&(c=u*(s-n+1)),y.create(c)}}class $1 extends N{constructor(){super(...arguments);A(this,"minParams",6);A(this,"maxParams",6)}calculate(e,t,r,n,s,a){const{isError:u,errorObject:c,variants:l}=Q(e,t,r,n,s,a);if(u)return c;const[f,m,d,C,_,E]=l,R=+f.getValue(),b=+m.getValue(),p=+d.getValue(),V=+C.getValue(),S=+_.getValue(),D=+E.getValue();return Number.isNaN(R)||Number.isNaN(b)||Number.isNaN(p)||Number.isNaN(V)||Number.isNaN(S)||Number.isNaN(D)?g.create(h.VALUE):R<=0||b<=0||p<=0||V<1||S<1||V>S||![0,1].includes(D)?g.create(h.NUM):Math.trunc(V)!==V&&Math.trunc(S)!==S&&Math.trunc(V)===Math.trunc(S)?y.create(0):this._getResult(R,b,p,V,S,D)}_getResult(e,t,r,n,s,a){const u=Hr(e,t,r,0,a);let c=0,l=Math.ceil(n);l===1&&(c=a===0?u+r*e:u,l++);for(let f=l;f<=s;f++)c+=a===1?u-(Jt(e,f-2,u,r,1)-u)*e:u-Jt(e,f-1,u,r,0)*e;return y.create(c)}}class Y1 extends N{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",5);A(this,"needsLocale",!0)}calculate(e,t,r,n,s){let a=s!=null?s:y.create(12);a.isNull()&&(a=y.create(12));const u=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,a.isArray()?a.getRowCount():1),c=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,a.isArray()?a.getColumnCount():1),l=O(u,c,e,g.create(h.NA)),f=O(u,c,t,g.create(h.NA)),m=O(u,c,r,g.create(h.NA)),d=O(u,c,n,g.create(h.NA)),C=O(u,c,a,g.create(h.NA)),_=l.map((E,R,b)=>{const p=f.get(R,b),V=m.get(R,b),S=d.get(R,b),D=C.get(R,b),{isError:w,errorObject:L,variants:P}=F(E,p,V,S,D);if(w)return L;const[v,U,$,W,re]=P,J=+v.getValue(),H=+U.getValue(),le=+$.getValue();let de=+W.getValue();const Re=Math.floor(+re.getValue());return J<0||H<0||le<=0||de<=0||Math.floor(de)>Math.floor(le)||Re<1||Re>12?g.create(h.NUM):(de<1&&(de=1),de=Math.floor(de),this._getResult(J,H,le,de,Re,R,b))});return u===1&&c===1?_.get(0,0):_}_getResult(e,t,r,n,s,a,u){const c=+(1-(t/e)**(1/r)).toFixed(3),l=e*c*s/12;let f=l,m=0;const d=n===r?r-1:n;for(let _=2;_<=d;_++)m=(e-f)*c,f+=m;let C;return n===1?C=l:n===r?C=(e-f)*c:C=m,Number.isNaN(C)||!Number.isFinite(C)?g.create(h.NUM):a===0&&u===0?y.create(C,qe(this.getLocale())):y.create(C)}}class H1 extends N{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",5);A(this,"needsLocale",!0)}calculate(e,t,r,n,s){let a=s!=null?s:y.create(2);a.isNull()&&(a=y.create(2));const u=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,a.isArray()?a.getRowCount():1),c=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,a.isArray()?a.getColumnCount():1),l=O(u,c,e,g.create(h.NA)),f=O(u,c,t,g.create(h.NA)),m=O(u,c,r,g.create(h.NA)),d=O(u,c,n,g.create(h.NA)),C=O(u,c,a,g.create(h.NA)),_=l.map((E,R,b)=>{const p=f.get(R,b),V=m.get(R,b),S=d.get(R,b),D=C.get(R,b),{isError:w,errorObject:L,variants:P}=F(E,p,V,S,D);if(w)return L;const[v,U,$,W,re]=P,J=+v.getValue(),H=+U.getValue(),le=+$.getValue(),de=+W.getValue(),Re=+re.getValue();if(J<0||H<0||le<=0||de<=0||de>le||Re<=0)return g.create(h.NUM);const pe=Qs(J,H,le,de,Re);return Number.isNaN(pe)||!Number.isFinite(pe)?g.create(h.NUM):R===0&&b===0?y.create(pe,qe(this.getLocale())):y.create(pe)});return u===1&&c===1?_.get(0,0):_}}class G1 extends N{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",5)}calculate(e,t,r,n,s){const a=s!=null?s:y.create(0),{isError:u,errorObject:c,variants:l}=Q(e,t,r,n,a);if(u)return c;const[f,m,d,C,_]=l,E=G(f);if(typeof E!="number")return E;const R=G(m);if(typeof R!="number")return R;const b=+d.getValue(),p=+C.getValue(),V=Math.floor(+_.getValue());if(Number.isNaN(b)||Number.isNaN(p)||Number.isNaN(V))return g.create(h.VALUE);if(b<=0||p<=0||V<0||V>4||Math.floor(E)>=Math.floor(R))return g.create(h.NUM);const{days:S,yearDays:D}=Ae(E,R,V),w=(p-b)/p*(D/S);return y.create(w)}}class W1 extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,variants:s}=Q(e,t);if(r)return n;const[a,u]=s,c=+a.getValue();let l=Math.floor(+u.getValue());if(Number.isNaN(c)||Number.isNaN(l))return g.create(h.VALUE);if(l<0)return g.create(h.NUM);if(l>=0&&l<1)return g.create(h.DIV_BY_ZERO);l=Number.parseInt(`${l}`,10);let f=Number.parseInt(`${c}`,10);f+=c%1*10**Math.ceil(Math.log(l)/Math.LN10)/l;const m=10**(Math.ceil(Math.log(l)/Math.LN2)+1);return f=Math.round(f*m)/m,y.create(f)}}class Q1 extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,variants:s}=Q(e,t);if(r)return n;const[a,u]=s,c=+a.getValue();let l=Math.floor(+u.getValue());if(Number.isNaN(c)||Number.isNaN(l))return g.create(h.VALUE);if(l<0)return g.create(h.NUM);if(l>=0&&l<1)return g.create(h.DIV_BY_ZERO);l=Number.parseInt(`${l}`,10);let f=Number.parseInt(`${c}`,10);return f+=c%1*10**-Math.ceil(Math.log(l)/Math.LN10)*l,y.create(f)}}class q1 extends N{constructor(){super(...arguments);A(this,"minParams",5);A(this,"maxParams",6)}calculate(e,t,r,n,s,a){let u=a!=null?a:y.create(0);u.isNull()&&(u=y.create(0));const{isError:c,errorObject:l,variants:f}=Ie(e,t,r,n,s,u);if(c)return l;const[m,d,C,_,E,R]=f,b=G(m);if(typeof b!="number")return b;const p=G(d);if(typeof p!="number")return p;const V=+C.getValue(),S=+_.getValue(),D=Math.floor(+E.getValue()),w=Math.floor(+R.getValue());if(Number.isNaN(V)||Number.isNaN(S)||Number.isNaN(D)||Number.isNaN(w))return g.create(h.VALUE);if(V<0||S<0||![1,2,4].includes(D)||w<0||w>4||Math.floor(b)>=Math.floor(p)||b<=0||p<=366)return g.create(h.NUM);const L=Qu(b,p,V,S,D,w);return y.create(L)}}class X1 extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,variants:s}=Q(e,t);if(r)return n;const[a,u]=s,c=+a.getValue();let l=Math.floor(+u.getValue());if(Number.isNaN(c)||Number.isNaN(l))return g.create(h.VALUE);if(c<=0||l<1)return g.create(h.NUM);l=Number.parseInt(`${l}`,10);const f=(1+c/l)**l-1;return y.create(f)}}class K1 extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",5);A(this,"needsLocale",!0)}calculate(e,t,r,n,s){const a=n!=null?n:y.create(0),u=s!=null?s:y.create(0),c=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1,u.isArray()?u.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1,u.isArray()?u.getColumnCount():1),f=O(c,l,e,g.create(h.NA)),m=O(c,l,t,g.create(h.NA)),d=O(c,l,r,g.create(h.NA)),C=O(c,l,a,g.create(h.NA)),_=O(c,l,u,g.create(h.NA)),E=f.map((R,b,p)=>{const V=m.get(b,p),S=d.get(b,p),D=C.get(b,p),w=_.get(b,p),{isError:L,errorObject:P,variants:v}=F(R,V,S,D,w);if(L)return P;const[U,$,W,re,J]=v,H=+U.getValue(),le=+$.getValue(),de=+W.getValue(),Re=+re.getValue(),pe=+J.getValue(),ge=Jt(H,le,de,Re,pe?1:0);return Number.isNaN(ge)||!Number.isFinite(ge)?g.create(h.NUM):b===0&&p===0?y.create(ge,qe(this.getLocale())):y.create(ge)});return c===1&&l===1?E.get(0,0):E}}class Z1 extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,variants:s}=Q(e);if(r)return n;const[a]=s,u=+a.getValue();if(Number.isNaN(u))return g.create(h.VALUE);let c=u;if(t.isArray()){const l=t.getArrayValue().flat();for(let f=0;f<l.length;f++){const m=l[f];if(m.isBoolean())return g.create(h.VALUE);const d=+m.getValue();if(Number.isNaN(d))return g.create(h.VALUE);c*=1+d}}else{if(t.isBoolean())return g.create(h.VALUE);const l=+t.getValue();if(Number.isNaN(l))return g.create(h.VALUE);c*=1+l}return y.create(c)}}class z1 extends N{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",5)}calculate(e,t,r,n,s){const a=s!=null?s:y.create(0),{isError:u,errorObject:c,variants:l}=Q(e,t,r,n,a);if(u)return c;const[f,m,d,C,_]=l,E=G(f);if(typeof E!="number")return E;const R=G(m);if(typeof R!="number")return R;const b=+d.getValue(),p=+C.getValue(),V=Math.floor(+_.getValue());if(Number.isNaN(b)||Number.isNaN(p)||Number.isNaN(V))return g.create(h.VALUE);if(b<=0||p<=0||V<0||V>4||Math.floor(E)>=Math.floor(R))return g.create(h.NUM);const{days:S,yearDays:D}=Ae(E,R,V),w=(p-b)/b*(D/S);return y.create(w)}}class J1 extends N{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",6);A(this,"needsLocale",!0)}calculate(e,t,r,n,s,a){const u=s!=null?s:y.create(0),c=a!=null?a:y.create(0),l=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,u.isArray()?u.getRowCount():1,c.isArray()?c.getRowCount():1),f=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,u.isArray()?u.getColumnCount():1,c.isArray()?c.getColumnCount():1),m=O(l,f,e,g.create(h.NA)),d=O(l,f,t,g.create(h.NA)),C=O(l,f,r,g.create(h.NA)),_=O(l,f,n,g.create(h.NA)),E=O(l,f,u,g.create(h.NA)),R=O(l,f,c,g.create(h.NA)),b=m.map((p,V,S)=>{const D=d.get(V,S),w=C.get(V,S),L=_.get(V,S),P=E.get(V,S),v=R.get(V,S),{isError:U,errorObject:$,variants:W}=F(p,D,w,L,P,v);if(U)return $;const[re,J,H,le,de,Re]=W,pe=+re.getValue(),ge=+J.getValue(),je=+H.getValue(),ct=+le.getValue(),Ot=+de.getValue(),St=+Re.getValue();if(ge<1||Math.floor(ge)>Math.ceil(je))return g.create(h.NUM);const tt=qu(pe,ge,je,ct,Ot,St?1:0);return Number.isNaN(tt)||!Number.isFinite(tt)?g.create(h.NUM):V===0&&S===0?y.create(tt,qe(this.getLocale())):y.create(tt)});return l===1&&f===1?b.get(0,0):b}}class ed extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){let r=t!=null?t:y.create(.1);return r.isNull()&&(r=y.create(.1)),r.isArray()?r.map((n,s,a)=>this._handleSingleObject(e,n,s,a)):this._handleSingleObject(e,r)}_handleSingleObject(e,t,r=0,n=0){if(e.isError())return e;if(t.isError())return t;if(e.isNull())return g.create(h.VALUE);if(!e.isArray())return g.create(h.NUM);const{_values:s,valuesHasError:a}=this._getValues(e);if(a)return g.create(h.VALUE);let u=t;if(u.isString()&&(u=u.convertToNumberObjectValue(),u.isError()))return u;const c=+u.getValue(),{positive:l,negative:f}=this._checkValues(s);if(!l||!f)return g.create(h.NUM);const m=Ua(c,d=>Xu(d,s));return typeof m!="number"?m:r===0&&n===0?y.create(m,"0%"):y.create(m)}_getValues(e){const t=[];let r=!1;return e.iterator(n=>{const s=n;if(s.isError())return r=!0,!1;if(s.isNull()||s.isBoolean()||s.isString()&&s.getValue()==="")return!0;const a=+s.getValue();if(Number.isNaN(a))return!0;t.push(a)}),{_values:t,valuesHasError:r}}_checkValues(e){let t=!1,r=!1;for(let n=0;n<e.length;n++)e[n]>0&&(t=!0),e[n]<0&&(r=!0);return{positive:t,negative:r}}}class td extends N{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA)),f=O(s,a,n,g.create(h.NA)),m=u.map((d,C,_)=>{const E=c.get(C,_),R=l.get(C,_),b=f.get(C,_),{isError:p,errorObject:V,variants:S}=F(d,E,R,b);if(p)return V;const[D,w,L,P]=S,v=+D.getValue(),U=+w.getValue(),$=+L.getValue(),W=+P.getValue();if($===0)return g.create(h.DIV_BY_ZERO);const re=W*v*(U/$-1);return y.create(re)});return s===1&&a===1?m.get(0,0):m}}class rd extends N{constructor(){super(...arguments);A(this,"minParams",5);A(this,"maxParams",6)}calculate(e,t,r,n,s,a){let u=a!=null?a:y.create(0);u.isNull()&&(u=y.create(0));const{isError:c,errorObject:l,variants:f}=Ie(e,t,r,n,s,u);if(c)return l;const[m,d,C,_,E,R]=f,b=G(m);if(typeof b!="number")return b;const p=G(d);if(typeof p!="number")return p;const V=+C.getValue(),S=+_.getValue(),D=Math.floor(+E.getValue()),w=Math.floor(+R.getValue());if(Number.isNaN(V)||Number.isNaN(S)||Number.isNaN(D)||Number.isNaN(w))return g.create(h.VALUE);if(V<0||S<0||![1,2,4].includes(D)||w<0||w>4||Math.floor(b)>=Math.floor(p))return g.create(h.NUM);let L=Qu(b,p,V,S,D,w);return L/=1+S/D,y.create(L)}}class nd extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{_values:n,numberValues:s,positive:a,negative:u}=this._getValues(e),c=Math.max(t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),l=Math.max(t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),f=O(c,l,t,g.create(h.NA)),m=O(c,l,r,g.create(h.NA)),d=f.map((C,_,E)=>{const R=m.get(_,E);if(e.isError())return e;if(R.isError())return R;if(n.isError())return n;if(!a||!u)return g.create(h.DIV_BY_ZERO);const b=+C.getValue(),p=+R.getValue();if(Number.isNaN(b)||Number.isNaN(p))return g.create(h.VALUE);if(p===-1)return g.create(h.DIV_BY_ZERO);const V=this._getResult(s,b,p);return _===0&&E===0?y.create(V,"0%"):y.create(V)});return c===1&&l===1?d.get(0,0):d}_getValues(e){let t=e,r=[],n=!1,s=!1;if(!e.isError())if(e.isNull())t=g.create(h.VALUE);else if(!e.isArray())t=g.create(h.DIV_BY_ZERO);else{const{numberValues:a,valuesHasError:u,errorObject:c,positive:l,negative:f}=this._checkValues(e);u&&(t=c),r=a,n=l,s=f}return{_values:t,numberValues:r,positive:n,negative:s}}_checkValues(e){const t=[];let r=!1,n=g.create(h.VALUE),s=!1,a=!1;return e.iterator(u=>{const c=u;if(c.isError())return r=!0,n=c,!1;if(c.isNull()||c.isBoolean()||c.isString()&&c.getValue()==="")return!0;const l=+c.getValue();if(Number.isNaN(l))return!0;l>0&&(s=!0),l<0&&(a=!0),t.push(l)}),{numberValues:t,valuesHasError:r,errorObject:n,positive:s,negative:a}}_getResult(e,t,r){const n=e.length,s=[],a=[];for(let d=0;d<n;d++)e[d]>0?a.push(e[d]):e[d]<0&&s.push(e[d]);const u=this._npv(r,e,"positive"),c=this._npv(t,e,"negative"),l=-u*(1+r)**n,f=c*(1+t);return(l/f)**(1/(n-1))-1}_npv(e,t,r){let n=0;for(let s=1;s<=t.length;s++){const a=t[s-1];(r==="positive"&&a>0||r==="negative"&&a<0)&&(n+=a/(1+e)**s)}return n}}class sd extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,variants:s}=Q(e,t);if(r)return n;const[a,u]=s,c=+a.getValue();let l=Math.floor(+u.getValue());if(Number.isNaN(c)||Number.isNaN(l))return g.create(h.VALUE);if(c<=0||l<1)return g.create(h.NUM);l=Number.parseInt(`${l}`,10);const f=((c+1)**(1/l)-1)*l;return y.create(f)}}class ad extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",5)}calculate(e,t,r,n,s){const a=n!=null?n:y.create(0),u=s!=null?s:y.create(0),c=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1,u.isArray()?u.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1,u.isArray()?u.getColumnCount():1),f=O(c,l,e,g.create(h.NA)),m=O(c,l,t,g.create(h.NA)),d=O(c,l,r,g.create(h.NA)),C=O(c,l,a,g.create(h.NA)),_=O(c,l,u,g.create(h.NA)),E=f.map((R,b,p)=>{const V=m.get(b,p),S=d.get(b,p),D=C.get(b,p),w=_.get(b,p),{isError:L,errorObject:P,variants:v}=F(R,V,S,D,w);if(L)return P;const[U,$,W,re,J]=v,H=+U.getValue(),le=+$.getValue(),de=+W.getValue(),Re=+re.getValue();let pe=+J.getValue();if(pe=pe?1:0,H===0&&le===0)return g.create(h.DIV_BY_ZERO);let ge;if(H===0)ge=-(de+Re)/le;else{const je=le*(1+H*pe)-Re*H,ct=de*H+le*(1+H*pe);ge=Math.log(je/ct)/Math.log(1+H)}return Number.isNaN(ge)||!Number.isFinite(ge)?g.create(h.NUM):y.create(ge)});return c===1&&l===1?E.get(0,0):E}}class id extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",255);A(this,"needsLocale",!0)}calculate(e,...t){if(e.isError())return e;const{isError:r,errorObject:n,values:s}=this._getValues(t);return e.isArray()?e.map((a,u,c)=>this._handleSingleObject(a,r,n,s,u,c)):this._handleSingleObject(e,r,n,s)}_handleSingleObject(e,t,r,n,s=0,a=0){let u=e;if(u.isString()&&(u=u.convertToNumberObjectValue()),u.isError())return u;if(t)return r;const c=+e.getValue(),l=Xu(c,n);return Number.isNaN(l)||Math.abs(l)===1/0?g.create(h.DIV_BY_ZERO):s===0&&a===0?y.create(l,qe(this.getLocale())):y.create(l)}_getValues(e){const t=[];for(let r=0;r<e.length;r++){const n=e[r];if(n.isError())return{isError:!0,errorObject:n};if(n.isArray()){let s=!1,a=g.create(h.VALUE);if(n.iterator(u=>{const c=u;if(c.isError())return s=!0,a=c,!1;if(c.isNull()||c.isBoolean()||c.isString()&&c.getValue()==="")return!0;const l=+c.getValue();if(Number.isNaN(l))return!0;t.push(l)}),s)return{isError:s,errorObject:a}}else{const s=+n.getValue();if(Number.isNaN(s))return{isError:!0,errorObject:g.create(h.VALUE)};t.push(s)}}return{isError:!1,values:t}}}class od extends N{constructor(){super(...arguments);A(this,"minParams",8);A(this,"maxParams",9)}calculate(e,t,r,n,s,a,u,c,l){let f=l!=null?l:y.create(0);f.isNull()&&(f=y.create(0));const{isError:m,errorObject:d,variants:C}=Ie(e,t,r,n,s,a,u,c,f);if(m)return d;const[_,E,R,b,p,V,S,D,w]=C,L=G(_);if(typeof L!="number")return L;const P=G(E);if(typeof P!="number")return P;const v=G(R);if(typeof v!="number")return v;const U=G(b);if(typeof U!="number")return U;const $=+p.getValue(),W=+V.getValue(),re=+S.getValue(),J=Math.floor(+D.getValue()),H=Math.floor(+w.getValue());if(Number.isNaN($)||Number.isNaN(W)||Number.isNaN(re)||Number.isNaN(J)||Number.isNaN(H))return g.create(h.VALUE);if($<0||W<0||re<=0||![1,2,4].includes(J)||H<0||H>4||!this._validDate(P,U,L,v,J))return g.create(h.NUM);const le=Ku(L,P,v,U,$,W,re,J,H);return y.create(le)}_validDate(e,t,r,n,s){return this._getDateCorrectOrder(e,t,r,n)&&Zu(e,t,s)&&Rr(n,e,s)}_getDateCorrectOrder(e,t,r,n){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)&&Math.floor(r)>Math.floor(n)}}class ud extends N{constructor(){super(...arguments);A(this,"minParams",8);A(this,"maxParams",9)}calculate(e,t,r,n,s,a,u,c,l){let f=l!=null?l:y.create(0);f.isNull()&&(f=y.create(0));const{isError:m,errorObject:d,variants:C}=Ie(e,t,r,n,s,a,u,c,f);if(m)return d;const[_,E,R,b,p,V,S,D,w]=C,L=G(_);if(typeof L!="number")return L;const P=G(E);if(typeof P!="number")return P;const v=G(R);if(typeof v!="number")return v;const U=G(b);if(typeof U!="number")return U;const $=+p.getValue(),W=+V.getValue(),re=+S.getValue(),J=Math.floor(+D.getValue()),H=Math.floor(+w.getValue());return Number.isNaN($)||Number.isNaN(W)||Number.isNaN(re)||Number.isNaN(J)||Number.isNaN(H)?g.create(h.VALUE):$<0||W<=0||re<=0||![1,2,4].includes(J)||H<0||H>4||!this._validDate(P,U,L,v,J)?g.create(h.NUM):this._getResult(L,P,v,U,$,W,re,J,H)}_validDate(e,t,r,n,s){return this._getDateCorrectOrder(e,t,r,n)&&Zu(e,t,s)&&Rr(n,e,s)}_getDateCorrectOrder(e,t,r,n){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)&&Math.floor(r)>Math.floor(n)}_getResult(e,t,r,n,s,a,u,c,l){const{days:f}=Ae(e,t,l),m=(s*f*100-(a-100))/((a-100)*.25*(1+2*f)+f*100);function d(_){return a-Ku(e,t,r,n,s,_,u,c,l)}const C=Ua(m,_=>d(_));return typeof C!="number"?C:y.create(C)}}class cd extends N{constructor(){super(...arguments);A(this,"minParams",7);A(this,"maxParams",8)}calculate(e,t,r,n,s,a,u,c){let l=c!=null?c:y.create(0);l.isNull()&&(l=y.create(0));const{isError:f,errorObject:m,variants:d}=Ie(e,t,r,n,s,a,u,l);if(f)return m;const[C,_,E,R,b,p,V,S]=d,D=G(C);if(typeof D!="number")return D;const w=G(_);if(typeof w!="number")return w;const L=G(E);if(typeof L!="number")return L;const P=+R.getValue(),v=+b.getValue(),U=+p.getValue(),$=Math.floor(+V.getValue()),W=Math.floor(+S.getValue());if(Number.isNaN(P)||Number.isNaN(v)||Number.isNaN(U)||Number.isNaN($)||Number.isNaN(W))return g.create(h.VALUE);if(P<0||v<0||U<=0||![1,2,4].includes($)||W<0||W>4||!this._validDate(w,D,L,$))return g.create(h.NUM);const re=this._getResult(D,w,L,P,v,U,$,W);return y.create(re)}_validDate(e,t,r,n){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)&&Rr(r,e,n)}_getResult(e,t,r,n,s,a,u,c){const l=this._getCoupDate(t,r,u),f=this._getFrac(r,e,l,u,c),m=this._getFrac(r,t,l,u,c),d=this._getFrac(e,t,l,u,c);return(a*u+100*n*(m-f*(1+s*d/u)))/(s*d+u)}_getCoupDate(e,t,r){const n=ae(e),s=ae(t);for(s.setUTCFullYear(n.getUTCFullYear()),s>n&&s.setUTCFullYear(s.getUTCFullYear()-1);s<n;)s.setUTCMonth(s.getUTCMonth()+12/r);return ye(s)}_getFrac(e,t,r,n,s){const a=ae(e),u=ae(t),c=ae(r);for(c.setUTCFullYear(a.getUTCFullYear()),c<a&&c.setUTCFullYear(c.getUTCFullYear()+1);c>a;)c.setUTCMonth(c.getUTCMonth()-12/n);let l=ye(c);c.setUTCMonth(c.getUTCMonth()+12/n);let f=ye(c);if(f>=t){const{days:p}=Ae(e,t,s),V=Qe(l,f,n,s);return p/V}const{days:m}=Ae(e,f,s),d=Qe(l,f,n,s);let C=m/d;const _=ae(f),E=ae(f);for(E.setUTCMonth(E.getUTCMonth()+12/n);E<u;)_.setUTCMonth(_.getUTCMonth()+12/n),E.setUTCMonth(E.getUTCMonth()+12/n),C+=1;l=ye(_),f=ye(E);const{days:R}=Ae(l,t,s),b=Qe(l,f,n,s);return C+=R/b,C}}class ld extends N{constructor(){super(...arguments);A(this,"minParams",8);A(this,"maxParams",9)}calculate(e,t,r,n,s,a,u,c){let l=c!=null?c:y.create(0);l.isNull()&&(l=y.create(0));const{isError:f,errorObject:m,variants:d}=Ie(e,t,r,n,s,a,u,l);if(f)return m;const[C,_,E,R,b,p,V,S]=d,D=G(C);if(typeof D!="number")return D;const w=G(_);if(typeof w!="number")return w;const L=G(E);if(typeof L!="number")return L;const P=+R.getValue(),v=+b.getValue(),U=+p.getValue(),$=Math.floor(+V.getValue()),W=Math.floor(+S.getValue());if(Number.isNaN(P)||Number.isNaN(v)||Number.isNaN(U)||Number.isNaN($)||Number.isNaN(W))return g.create(h.VALUE);if(P<0||v<=0||U<=0||![1,2,4].includes($)||W<0||W>4||!this._validDate(w,D,L,$))return g.create(h.NUM);const re=this._getResult(D,w,L,P,v,U,$,W);return y.create(re)}_validDate(e,t,r,n){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)&&Rr(r,e,n)}_getResult(e,t,r,n,s,a,u,c){const l=this._getCoupDate(t,r,u),f=this._getFrac(r,e,l,u,c),m=this._getFrac(r,t,l,u,c),d=this._getFrac(e,t,l,u,c);return(u*(a-s)+100*n*(m-f))/(d*s+100*n*f*d/u)}_getCoupDate(e,t,r){const n=ae(e),s=ae(t);for(s.setUTCFullYear(n.getUTCFullYear()),s>n&&s.setUTCFullYear(s.getUTCFullYear()-1);s<n;)s.setUTCMonth(s.getUTCMonth()+12/r);return ye(s)}_getFrac(e,t,r,n,s){const a=ae(e),u=ae(t),c=ae(r);for(c.setUTCFullYear(a.getUTCFullYear()),c<a&&c.setUTCFullYear(c.getUTCFullYear()+1);c>a;)c.setUTCMonth(c.getUTCMonth()-12/n);let l=ye(c);c.setUTCMonth(c.getUTCMonth()+12/n);let f=ye(c);if(f>=t){const{days:p}=Ae(e,t,s),V=Qe(l,f,n,s);return p/V}const{days:m}=Ae(e,f,s),d=Qe(l,f,n,s);let C=m/d;const _=ae(f),E=ae(f);for(E.setUTCMonth(E.getUTCMonth()+12/n);E<u;)_.setUTCMonth(_.getUTCMonth()+12/n),E.setUTCMonth(E.getUTCMonth()+12/n),C+=1;l=ye(_),f=ye(E);const{days:R}=Ae(l,t,s),b=Qe(l,f,n,s);return C+=R/b,C}}class fd extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.map((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d),{isError:E,errorObject:R,variants:b}=F(f,C,_);if(E)return R;const[p,V,S]=b,D=+p.getValue(),w=+V.getValue(),L=+S.getValue();if(D<=-1)return g.create(h.NUM);const P=(Math.log(L)-Math.log(w))/Math.log(1+D);return Number.isNaN(P)||!Number.isFinite(P)?g.create(h.NUM):y.create(P)});return n===1&&s===1?l.get(0,0):l}}class md extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",5);A(this,"needsLocale",!0)}calculate(e,t,r,n,s){const a=n!=null?n:y.create(0),u=s!=null?s:y.create(0),c=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1,u.isArray()?u.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1,u.isArray()?u.getColumnCount():1),f=O(c,l,e,g.create(h.NA)),m=O(c,l,t,g.create(h.NA)),d=O(c,l,r,g.create(h.NA)),C=O(c,l,a,g.create(h.NA)),_=O(c,l,u,g.create(h.NA)),E=f.map((R,b,p)=>{const V=m.get(b,p),S=d.get(b,p),D=C.get(b,p),w=_.get(b,p),{isError:L,errorObject:P,variants:v}=F(R,V,S,D,w);if(L)return P;const[U,$,W,re,J]=v,H=+U.getValue(),le=+$.getValue(),de=+W.getValue(),Re=+re.getValue(),pe=+J.getValue();if(H<=-1)return g.create(h.NUM);const ge=Hr(H,le,de,Re,pe?1:0);return Number.isNaN(ge)||!Number.isFinite(ge)?g.create(h.NUM):b===0&&p===0?y.create(ge,qe(this.getLocale())):y.create(ge)});return c===1&&l===1?E.get(0,0):E}}class hd extends N{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",6);A(this,"needsLocale",!0)}calculate(e,t,r,n,s,a){const u=s!=null?s:y.create(0),c=a!=null?a:y.create(0),l=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,u.isArray()?u.getRowCount():1,c.isArray()?c.getRowCount():1),f=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,u.isArray()?u.getColumnCount():1,c.isArray()?c.getColumnCount():1),m=O(l,f,e,g.create(h.NA)),d=O(l,f,t,g.create(h.NA)),C=O(l,f,r,g.create(h.NA)),_=O(l,f,n,g.create(h.NA)),E=O(l,f,u,g.create(h.NA)),R=O(l,f,c,g.create(h.NA)),b=m.map((p,V,S)=>{const D=d.get(V,S),w=C.get(V,S),L=_.get(V,S),P=E.get(V,S),v=R.get(V,S),{isError:U,errorObject:$,variants:W}=F(p,D,w,L,P,v);if(U)return $;const[re,J,H,le,de,Re]=W,pe=+re.getValue(),ge=+J.getValue(),je=+H.getValue(),ct=+le.getValue(),Ot=+de.getValue(),St=+Re.getValue();if(ge<1||Math.floor(ge)>Math.ceil(je)||ge-je>=1)return g.create(h.NUM);const tt=Hr(pe,je,ct,Ot,St?1:0)-qu(pe,ge,je,ct,Ot,St?1:0);return Number.isNaN(tt)||!Number.isFinite(tt)?g.create(h.NUM):V===0&&S===0?y.create(tt,qe(this.getLocale())):y.create(tt)});return l===1&&f===1?b.get(0,0):b}}class gd extends N{constructor(){super(...arguments);A(this,"minParams",6);A(this,"maxParams",7)}calculate(e,t,r,n,s,a,u){let c=u!=null?u:y.create(0);c.isNull()&&(c=y.create(0));const{isError:l,errorObject:f,variants:m}=Ie(e,t,r,n,s,a,c);if(l)return f;const[d,C,_,E,R,b,p]=m,V=G(d);if(typeof V!="number")return V;const S=G(C);if(typeof S!="number")return S;const D=+_.getValue(),w=+E.getValue(),L=+R.getValue(),P=Math.floor(+b.getValue()),v=Math.floor(+p.getValue());if(Number.isNaN(D)||Number.isNaN(w)||Number.isNaN(L)||Number.isNaN(P)||Number.isNaN(v))return g.create(h.VALUE);if(D<0||w<0||L<=0||![1,2,4].includes(P)||v<0||v>4||V>=S||!Rr(V,S,P))return g.create(h.NUM);const U=ln(V,S,D,w,L,P,v);return y.create(U)}}class dd extends N{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",5)}calculate(e,t,r,n,s){let a=s!=null?s:y.create(0);a.isNull()&&(a=y.create(0));const{isError:u,errorObject:c,variants:l}=Ie(e,t,r,n,a);if(u)return c;const[f,m,d,C,_]=l,E=G(f);if(typeof E!="number")return E;const R=G(m);if(typeof R!="number")return R;const b=+d.getValue(),p=+C.getValue(),V=Math.floor(+_.getValue());if(Number.isNaN(b)||Number.isNaN(p)||Number.isNaN(V))return g.create(h.VALUE);if(b<=0||p<=0||V<0||V>4||E>=R)return g.create(h.NUM);const{days:S,yearDays:D}=Ae(E,R,V),w=p-b*p*S/D;return y.create(w)}}class Cd extends N{constructor(){super(...arguments);A(this,"minParams",5);A(this,"maxParams",6)}calculate(e,t,r,n,s,a){let u=a!=null?a:y.create(0);u.isNull()&&(u=y.create(0));const{isError:c,errorObject:l,variants:f}=Ie(e,t,r,n,s,u);if(c)return l;const[m,d,C,_,E,R]=f,b=G(m);if(typeof b!="number")return b;const p=G(d);if(typeof p!="number")return p;const V=G(C);if(typeof V!="number")return V;const S=+_.getValue(),D=+E.getValue(),w=Math.floor(+R.getValue());if(Number.isNaN(S)||Number.isNaN(D)||Number.isNaN(w))return g.create(h.VALUE);const L=this._getDateCorrectOrder(p,b,V);if(S<0||D<0||w<0||w>4||!L)return g.create(h.NUM);const P=Yu(b,w),{days:v}=Ae(b,p,w),{days:U}=Ae(V,p,w),{days:$}=Ae(V,b,w),W=(100+U/P*S*100)/(1+v/P*D)-$/P*S*100;return y.create(W)}_getDateCorrectOrder(e,t,r){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)}}class _d extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",5);A(this,"needsLocale",!0)}calculate(e,t,r,n,s){const a=n!=null?n:y.create(0),u=s!=null?s:y.create(0),c=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1,u.isArray()?u.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1,u.isArray()?u.getColumnCount():1),f=O(c,l,e,g.create(h.NA)),m=O(c,l,t,g.create(h.NA)),d=O(c,l,r,g.create(h.NA)),C=O(c,l,a,g.create(h.NA)),_=O(c,l,u,g.create(h.NA)),E=f.map((R,b,p)=>{const V=m.get(b,p),S=d.get(b,p),D=C.get(b,p),w=_.get(b,p),{isError:L,errorObject:P,variants:v}=F(R,V,S,D,w);if(L)return P;const[U,$,W,re,J]=v,H=+U.getValue(),le=+$.getValue(),de=+W.getValue(),Re=+re.getValue();let pe=+J.getValue();pe=pe?1:0;const ge=H===0?-de*le-Re:((1-(1+H)**le)/H*de*(1+H*pe)-Re)/(1+H)**le;return Number.isNaN(ge)||!Number.isFinite(ge)?g.create(h.NUM):b===0&&p===0?y.create(ge,qe(this.getLocale())):y.create(ge)});return c===1&&l===1?E.get(0,0):E}}class Ad extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",6)}calculate(e,t,r,n,s,a){const u=n!=null?n:y.create(0),c=s!=null?s:y.create(0),l=a!=null?a:y.create(.1),f=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,u.isArray()?u.getRowCount():1,c.isArray()?c.getRowCount():1,l.isArray()?l.getRowCount():1),m=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,u.isArray()?u.getColumnCount():1,c.isArray()?c.getColumnCount():1,l.isArray()?l.getColumnCount():1),d=O(f,m,e,g.create(h.NA)),C=O(f,m,t,g.create(h.NA)),_=O(f,m,r,g.create(h.NA)),E=O(f,m,u,g.create(h.NA)),R=O(f,m,c,g.create(h.NA)),b=O(f,m,l,g.create(h.NA)),p=d.map((V,S,D)=>{const w=C.get(S,D),L=_.get(S,D),P=E.get(S,D),v=R.get(S,D),U=b.get(S,D),{isError:$,errorObject:W,variants:re}=F(V,w,L,P,v,U);if($)return W;const[J,H,le,de,Re,pe]=re,ge=+J.getValue(),je=+H.getValue(),ct=+le.getValue(),Ot=+de.getValue();let St=+Re.getValue();const tt=+pe.getValue();if(St=St?1:0,ge<=0)return g.create(h.NUM);const Rc=je>=0&&ct>=0&&Ot>=0,bc=je<=0&&ct<=0&&Ot<=0;return Rc||bc?g.create(h.NUM):this._getResult(ge,je,ct,Ot,St,tt,S,D)});return f===1&&m===1?p.get(0,0):p}_getResult(e,t,r,n,s,a,u,c){if(Math.abs(t)<1e-14)return this._computeSimpleGrowthRate(e,r,n,u,c);let m=a,d=Number.POSITIVE_INFINITY;for(let C=0;C<100;C++){if(m<=-1)return g.create(h.NUM);const{value:_,derivative:E}=this._evaluateRateFunction(m,e,t,r,n,s,1e-10),R=Math.abs(_);if(R<1e-10||Math.abs(E)<1e-14)break;const b=this._getAdaptiveDampedStep(_,E,R,d);m-=b,d=R}return!Number.isFinite(m)||m<=-1?g.create(h.NUM):y.create(m,u===0&&c===0?"0%":void 0)}_computeSimpleGrowthRate(e,t,r,n,s){if(Math.sign(t)===Math.sign(r))return g.create(h.NUM);const a=(r/-t)**(1/e)-1;return y.create(a,n===0&&s===0?"0%":void 0)}_evaluateRateFunction(e,t,r,n,s,a,u){let c,l,f;if(Math.abs(e)<u)c=n*(1+t*e)+r*(1+e*a)*t+s,l=n*t+r*a*t;else{f=(1+e)**t,c=n*f+r*(1/e+a)*(f-1)+s;const m=t*(1+e)**(t-1);l=n*m+r*(1/e+a)*m+r*(-1/(e*e))*(f-1)}return{value:c,derivative:l}}_getAdaptiveDampedStep(e,t,r,n){const s=e/t;return r>.001||r>=n*.9?Math.max(Math.min(s,5),-5):Math.max(Math.min(s,.5),-.5)}}class Ed extends N{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",5)}calculate(e,t,r,n,s){let a=s!=null?s:y.create(0);a.isNull()&&(a=y.create(0));const{isError:u,errorObject:c,variants:l}=Ie(e,t,r,n,a);if(u)return c;const[f,m,d,C,_]=l,E=G(f);if(typeof E!="number")return E;const R=G(m);if(typeof R!="number")return R;const b=+d.getValue(),p=+C.getValue(),V=Math.floor(+_.getValue());if(Number.isNaN(b)||Number.isNaN(p)||Number.isNaN(V))return g.create(h.VALUE);if(b<=0||p<=0||V<0||V>4||E>=R)return g.create(h.NUM);const{days:S,yearDays:D}=Ae(E,R,V),w=b/(1-p*S/D);return w<0?g.create(h.NUM):y.create(w)}}class Rd extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",6)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.map((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d),{isError:E,errorObject:R,variants:b}=F(f,C,_);if(E)return R;const[p,V,S]=b,D=+p.getValue(),w=+V.getValue(),L=+S.getValue();if(D<=0)return g.create(h.NUM);if(w===0&&L===0)return y.create(0);const P=(L/w)**(1/D)-1;return Number.isNaN(P)||!Number.isFinite(P)||L/w<0?g.create(h.NUM):y.create(P)});return n===1&&s===1?l.get(0,0):l}}class bd extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3);A(this,"needsLocale",!0)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.map((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);if(C.isError())return C;if(_.isError())return _;const E=+f.getValue(),R=+C.getValue(),b=+_.getValue();if(Number.isNaN(E)||Number.isNaN(R)||Number.isNaN(b))return g.create(h.VALUE);if(b===0)return g.create(h.DIV_BY_ZERO);const p=(E-R)/b;return m===0&&d===0?y.create(p,qe(this.getLocale())):y.create(p)});return n===1&&s===1?l.get(0,0):l}}class yd extends N{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4);A(this,"needsLocale",!0)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA)),f=O(s,a,n,g.create(h.NA)),m=u.map((d,C,_)=>{const E=c.get(C,_),R=l.get(C,_),b=f.get(C,_);if(E.isError())return E;if(R.isError())return R;if(b.isError())return b;const p=+d.getValue(),V=+E.getValue(),S=+R.getValue(),D=+b.getValue();if(Number.isNaN(p)||Number.isNaN(V)||Number.isNaN(S)||Number.isNaN(D))return g.create(h.VALUE);if(V<0||S<=0||D>S)return g.create(h.NUM);const w=(p-V)*(S-D+1)*2/(S*(S+1));return C===0&&_===0?y.create(w,qe(this.getLocale())):y.create(w)});return s===1&&a===1?m.get(0,0):m}}class pd extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,variants:a}=Ie(e,t,r);if(n)return s;const[u,c,l]=a,f=G(u);if(typeof f!="number")return f;const m=G(c);if(typeof m!="number")return m;const d=+l.getValue();if(Number.isNaN(d))return g.create(h.VALUE);if(d<=0||f>=m)return g.create(h.NUM);const C=Math.floor(m)-Math.floor(f),E=ae(f).getUTCFullYear(),R=cs(E);if(C>R)return g.create(h.NUM);let b=365*d/(360-d*C);if(C>182){const p=100*(1-d*C/360),V=C/365;if(b=(-V+Math.sqrt(V*V-(V*2-1)*(1-100/p)))/(V-.5),Number.isNaN(b))return g.create(h.NUM)}return b<0?g.create(h.NUM):y.create(b)}}class Nd extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3);A(this,"needsLocale",!0)}calculate(e,t,r){const{isError:n,errorObject:s,variants:a}=Ie(e,t,r);if(n)return s;const[u,c,l]=a,f=G(u);if(typeof f!="number")return f;const m=G(c);if(typeof m!="number")return m;const d=+l.getValue();if(Number.isNaN(d))return g.create(h.VALUE);if(d<=0||f>=m)return g.create(h.NUM);const C=Math.floor(m)-Math.floor(f),E=ae(f).getUTCFullYear(),R=cs(E);if(C>R)return g.create(h.NUM);const b=100*(1-d*C/360);return b<0?g.create(h.NUM):y.create(b,qe(this.getLocale()))}}class Vd extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,variants:a}=Ie(e,t,r);if(n)return s;const[u,c,l]=a,f=G(u);if(typeof f!="number")return f;const m=G(c);if(typeof m!="number")return m;const d=+l.getValue();if(Number.isNaN(d))return g.create(h.VALUE);if(d<=0||f>=m)return g.create(h.NUM);const C=Math.floor(m)-Math.floor(f),E=ae(f).getUTCFullYear(),R=cs(E);if(C>R)return g.create(h.NUM);const b=(100-d)/d*360/C;return y.create(b)}}class Od extends N{constructor(){super(...arguments);A(this,"minParams",5);A(this,"maxParams",7);A(this,"needsLocale",!0)}calculate(e,t,r,n,s,a,u){let c=a!=null?a:y.create(2);c.isNull()&&(c=y.create(2));let l=u!=null?u:I.create(!1);l.isNull()&&(l=I.create(!1));const f=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1,c.isArray()?c.getRowCount():1,l.isArray()?l.getRowCount():1),m=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1,c.isArray()?c.getColumnCount():1,l.isArray()?l.getColumnCount():1),d=O(f,m,e,g.create(h.NA)),C=O(f,m,t,g.create(h.NA)),_=O(f,m,r,g.create(h.NA)),E=O(f,m,n,g.create(h.NA)),R=O(f,m,s,g.create(h.NA)),b=O(f,m,c,g.create(h.NA)),p=O(f,m,l,g.create(h.NA));return this._getResultArray(d,C,_,E,R,b,p,f,m)}_getResultArray(e,t,r,n,s,a,u,c,l){const f=e.map((m,d,C)=>{const _=t.get(d,C),E=r.get(d,C),R=n.get(d,C),b=s.get(d,C),p=a.get(d,C),V=u.get(d,C),{isError:S,errorObject:D,variants:w}=F(m,_,E,R,b,p,V);if(S)return D;const[L,P,v,U,$,W,re]=w,J=+L.getValue(),H=+P.getValue(),le=+v.getValue(),de=+U.getValue(),Re=+$.getValue(),pe=+W.getValue(),ge=+re.getValue();if(J<0||H<0||le<0||de<0||Re<0||Re>le||de>Re||pe<0)return g.create(h.NUM);if(le===0&&de===0&&Re===0)return g.create(h.DIV_BY_ZERO);const je=this._getResult(J,H,le,de,Re,pe,ge);return d===0&&C===0?y.create(je,qe(this.getLocale())):y.create(je)});return c===1&&l===1?f.get(0,0):f}_getResult(e,t,r,n,s,a,u){const c=Math.floor(n),l=Math.ceil(s);let f=0;if(e<t){if(n>=1||u)return f;const m=Math.abs(e-t);return f=m*(s-n)>m?m:m*(s-n),-f}if(u)for(let m=c+1;m<=l;m++){let d=Qs(e,t,r,m,a);m===c+1?d*=Math.min(s,c+1)-n:m===l&&(d*=s+1-l),f+=d}else{const m=e-this._getVdb(e,t,r,r,n,a);f=this._getVdb(m,t,r,r-n,s-n,a)}return f}_getVdb(e,t,r,n,s,a){const u=Math.ceil(s);let c=0,l=e-t,f=0,m=0,d=!1;for(let C=1;C<=u;C++){if(d)m=f;else{const _=Qs(e,t,r,C,a);f=l/(n-(C-1)),f>_?(m=f,d=!0):(m=_,l-=_)}C===u&&(m*=s+1-u),c+=m}return c}}class Sd extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){if(e.isNull()||t.isNull())return g.create(h.NA);const{isError:n,errorObejct:s,_values:a,_dates:u}=this._checkErrors(e,t);if(n)return s;let c=r!=null?r:y.create(.1);c.isNull()&&(c=y.create(.1));const{isError:l,errorObject:f,variants:m}=Q(c);if(l)return f;const[d]=m,C=+d.getValue();if(Number.isNaN(C))return g.create(h.VALUE);const{positive:_,negative:E}=this._checkValues(a);if(!_||!E||(a==null?void 0:a.length)!==(u==null?void 0:u.length)||C<0)return g.create(h.NUM);const R=Ua(C,b=>this._iterF(a,u,b));return typeof R!="number"?R:y.create(R)}_checkErrors(e,t){if(e.isError())return{isError:!0,errorObejct:e};if(t.isError())return{isError:!0,errorObejct:t};const{isError:r,errorObejct:n,_values:s}=this._checkErrorValues(e);if(r)return{isError:r,errorObejct:n};const{isError:a,errorObejct:u,_dates:c}=this._checkErrorDates(t);return a?{isError:a,errorObejct:u}:{isError:!1,_values:s,_dates:c}}_checkErrorValues(e){const t=[];if(e.isArray()){let r=!1,n=g.create(h.VALUE);return e.iterator(s=>{const a=s;if(a.isError())return r=!0,n=a,!1;if(a.isBoolean())return r=!0,n=g.create(h.VALUE),!1;const u=+a.getValue();if(Number.isNaN(u))return r=!0,n=g.create(h.VALUE),!1;t.push(u)}),r?{isError:r,errorObejct:n}:t.length<=1?{isError:!0,errorObejct:g.create(h.NA)}:{isError:r,_values:t}}else{const r=e.getValue();return e.isBoolean()||e.isString()&&!M.isRealNum(r)?{isError:!0,errorObejct:g.create(h.VALUE)}:{isError:!0,errorObejct:g.create(h.NA)}}}_checkErrorDates(e){const t=[];if(e.isArray()){let r=!1,n=g.create(h.VALUE);return e.iterator(s=>{if(s!=null&&s.isError())return r=!0,n=s,!1;if(s!=null&&s.isBoolean())return r=!0,n=g.create(h.VALUE),!1;const a=+s.getValue();if(Number.isNaN(a))return r=!0,n=g.create(h.VALUE),!1;if(a<0)return r=!0,n=g.create(h.NUM),!1;t.push(Math.floor(a))}),r?{isError:r,errorObejct:n}:t.length<=1?{isError:!0,errorObejct:g.create(h.NA)}:{isError:r,_dates:t}}else{const r=e.getValue();return e.isBoolean()||e.isString()&&!M.isRealNum(r)?{isError:!0,errorObejct:g.create(h.VALUE)}:+r<0?{isError:!0,errorObejct:g.create(h.NUM)}:{isError:!0,errorObejct:g.create(h.NA)}}}_checkValues(e){let t=!1,r=!1;for(let n=0;n<e.length;n++)e[n]>0&&(t=!0),e[n]<0&&(r=!0);return{positive:t,negative:r}}_iterF(e,t,r){return e.reduce((n,s,a)=>n+s/(1+r)**((t[a]-t[0])/365),0)}}class Md extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){if(e.isNull()||t.isNull()||r.isNull())return g.create(h.NA);const{isError:n,errorObject:s,variants:a}=Q(e);if(n)return s;const[u]=a,c=+u.getValue();if(Number.isNaN(c))return g.create(h.VALUE);let{isError:l,errorObejct:f,_values:m,_dates:d}=this._checkErrors(t,r);if(l)return f;if(m=m,d=d,c<0||m.length!==d.length)return g.create(h.NUM);let C=0;const _=d[0];for(let E=0;E<d.length;E++){const R=d[E],b=m[E];C+=b/(1+c)**((R-_)/365)}return y.create(C)}_checkErrors(e,t){if(e.isError())return{isError:!0,errorObejct:e};if(t.isError())return{isError:!0,errorObejct:t};const{isError:r,errorObejct:n,_values:s}=this._checkErrorValues(e);if(r)return{isError:r,errorObejct:n};const{isError:a,errorObejct:u,_dates:c}=this._checkErrorDates(t);return a?{isError:a,errorObejct:u}:{isError:!1,_values:s,_dates:c}}_checkErrorValues(e){const t=[];if(e.isArray()){let r=!1,n=g.create(h.VALUE);return e.iterator(s=>{const a=s;if(a.isError())return r=!0,n=a,!1;if(a.isNull()||a.isBoolean()||a.isString()&&a.getValue()==="")return r=!0,n=g.create(h.VALUE),!1;const u=+a.getValue();if(Number.isNaN(u))return r=!0,n=g.create(h.VALUE),!1;t.push(u)}),r?{isError:r,errorObejct:n}:{isError:r,_values:t}}else{if(e.isError())return{isError:!0,errorObejct:e};if(e.isNull()||e.isBoolean())return{isError:!0,errorObejct:g.create(h.VALUE)};const r=+e.getValue();return Number.isNaN(r)?{isError:!0,errorObejct:g.create(h.VALUE)}:{isError:!1,_values:[r]}}}_checkErrorDates(e){const t=[];if(e.isArray()){let r=!1,n=g.create(h.VALUE);return e.iterator(s=>{const a=s;if(a.isError())return r=!0,n=a,!1;if(a.isNull()||a.isBoolean())return r=!0,n=g.create(h.VALUE),!1;const u=+a.getValue();if(Number.isNaN(u))return r=!0,n=g.create(h.VALUE),!1;if(u<0)return r=!0,n=g.create(h.NUM),!1;t.push(Math.floor(u))}),r?{isError:r,errorObejct:n}:{isError:r,_dates:t}}else{if(e.isError())return{isError:!0,errorObejct:e};if(e.isNull()||e.isBoolean())return{isError:!0,errorObejct:g.create(h.VALUE)};const r=+e.getValue();return Number.isNaN(r)?{isError:!0,errorObejct:g.create(h.VALUE)}:+r<0?{isError:!0,errorObejct:g.create(h.NUM)}:{isError:!1,_dates:[Math.floor(r)]}}}}class Dd extends N{constructor(){super(...arguments);A(this,"minParams",6);A(this,"maxParams",7)}calculate(e,t,r,n,s,a,u){let c=u!=null?u:y.create(0);c.isNull()&&(c=y.create(0));const{isError:l,errorObject:f,variants:m}=Ie(e,t,r,n,s,a,c);if(l)return f;const[d,C,_,E,R,b,p]=m,V=G(d);if(typeof V!="number")return V;const S=G(C);if(typeof S!="number")return S;const D=+_.getValue(),w=+E.getValue(),L=+R.getValue(),P=Math.floor(+b.getValue()),v=Math.floor(+p.getValue());if(Number.isNaN(D)||Number.isNaN(w)||Number.isNaN(L)||Number.isNaN(P)||Number.isNaN(v))return g.create(h.VALUE);if(D<0||w<=0||L<=0||![1,2,4].includes(P)||v<0||v>4||V>=S||!Rr(V,S,P))return g.create(h.NUM);const U=this._getResult(V,S,D,w,L,P,v);return y.create(U)}_getResult(e,t,r,n,s,a,u){if(zt(e,t,a)>1){let E=r||.01,R=ln(e,t,r,E,s,a,u),b=R-n;for(let p=0;p<100&&Math.abs(b)>1e-7;p++)R=ln(e,t,r,1.01*E,s,a,u),E+=-b/(R-n-b)*E*.01,b=ln(e,t,r,E,s,a,u)-n;return E}const l=ls(e,t,a,u),f=Qe(e,t,a,u),{days:m}=Ae(e,t,u),d=n/100+l/f*r/a;return(s/100+r/a-d)/d*a*f/m}}class wd extends N{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",5)}calculate(e,t,r,n,s){let a=s!=null?s:y.create(0);a.isNull()&&(a=y.create(0));const{isError:u,errorObject:c,variants:l}=Ie(e,t,r,n,a);if(u)return c;const[f,m,d,C,_]=l,E=G(f);if(typeof E!="number")return E;const R=G(m);if(typeof R!="number")return R;const b=+d.getValue(),p=+C.getValue(),V=Math.floor(+_.getValue());if(Number.isNaN(b)||Number.isNaN(p)||Number.isNaN(V))return g.create(h.VALUE);if(b<=0||p<=0||V<0||V>4||E>=R)return g.create(h.NUM);const{days:S,yearDays:D}=Ae(E,R,V),w=(p/b-1)/(S/D);return y.create(w)}}class Ld extends N{constructor(){super(...arguments);A(this,"minParams",5);A(this,"maxParams",6)}calculate(e,t,r,n,s,a){let u=a!=null?a:y.create(0);u.isNull()&&(u=y.create(0));const{isError:c,errorObject:l,variants:f}=Ie(e,t,r,n,s,u);if(c)return l;const[m,d,C,_,E,R]=f,b=G(m);if(typeof b!="number")return b;const p=G(d);if(typeof p!="number")return p;const V=G(C);if(typeof V!="number")return V;const S=+_.getValue(),D=+E.getValue(),w=Math.floor(+R.getValue());if(Number.isNaN(S)||Number.isNaN(D)||Number.isNaN(w))return g.create(h.VALUE);const L=this._getDateCorrectOrder(p,b,V);if(S<0||D<=0||w<0||w>4||!L)return g.create(h.NUM);const P=Yu(b,w),{days:v}=Ae(b,p,w),{days:U}=Ae(V,p,w),{days:$}=Ae(V,b,w),W=((1+U/P*S)/(D/100+$/P*S)-1)/(v/P);return y.create(W)}_getDateCorrectOrder(e,t,r){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)}}const zu=[[P1,ee.ACCRINT],[x1,ee.ACCRINTM],[j1,ee.AMORLINC],[U1,ee.COUPDAYBS],[T1,ee.COUPDAYS],[v1,ee.COUPDAYSNC],[I1,ee.COUPNCD],[F1,ee.COUPNUM],[B1,ee.COUPPCD],[k1,ee.CUMIPMT],[$1,ee.CUMPRINC],[Y1,ee.DB],[H1,ee.DDB],[G1,ee.DISC],[W1,ee.DOLLARDE],[Q1,ee.DOLLARFR],[q1,ee.DURATION],[X1,ee.EFFECT],[K1,ee.FV],[Z1,ee.FVSCHEDULE],[z1,ee.INTRATE],[J1,ee.IPMT],[ed,ee.IRR],[td,ee.ISPMT],[rd,ee.MDURATION],[nd,ee.MIRR],[sd,ee.NOMINAL],[ad,ee.NPER],[id,ee.NPV],[od,ee.ODDFPRICE],[ud,ee.ODDFYIELD],[cd,ee.ODDLPRICE],[ld,ee.ODDLYIELD],[fd,ee.PDURATION],[md,ee.PMT],[hd,ee.PPMT],[gd,ee.PRICE],[dd,ee.PRICEDISC],[Cd,ee.PRICEMAT],[_d,ee.PV],[Ad,ee.RATE],[Ed,ee.RECEIVED],[Rd,ee.RRI],[bd,ee.SLN],[yd,ee.SYD],[pd,ee.TBILLEQ],[Nd,ee.TBILLPRICE],[Vd,ee.TBILLYIELD],[Od,ee.VDB],[Sd,ee.XIRR],[Md,ee.XNPV],[Dd,ee.YIELD],[wd,ee.YIELDDISC],[Ld,ee.YIELDMAT]];class Pd extends N{constructor(){super(...arguments);A(this,"needsReferenceObject",!0);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isError())return r;if(r.isReferenceObject()&&(r=r.toArrayValueObject()),r.isArray()){const n=r.getRowCount(),s=r.getColumnCount();if(n===1&&s===1){const a=r.get(0,0);return this._handleSingleObject(a,t)}return r.map(a=>a.isError()?a:this._handleSingleObject(a,t,!0))}return this._handleSingleObject(r,t)}_handleSingleObject(e,t,r=!1){let n=t;if(n.isError())return n;if(!n.isReferenceObject())return g.create(h.NA);const s=n.getCurrentActiveSheetData(),{columnData:a,defaultColumnWidth:u}=s;n=n.toArrayValueObject();const c=n.getCurrentRow(),l=n.getCurrentColumn();n=n.getFirstCell();const f=`${e.getValue()}`;let m;switch(f.toLocaleLowerCase()){case"address":return T.create(`$${M.Tools.chatAtABC(l)}$${c+1}`);case"col":return y.create(l+1);case"color":return y.create(0);case"contents":return n;case"filename":return g.create(h.VALUE);case"format":return T.create("G");case"parentheses":return y.create(0);case"prefix":return T.create("");case"protect":return y.create(1);case"row":return y.create(c+1);case"type":return m="v",n.isNull()&&(m="b"),n.isString()&&(m="l"),T.create(m);case"width":return this._getWidthResult(a,u,l,r);default:return g.create(h.VALUE)}}_getWidthResult(e,t,r,n){var u;let s=(u=e[r])==null?void 0:u.w;if(!s&&s!==0&&(s=t),n)return y.create(s);const a=[[s,s===t]];return K.createByArray(a)}}class xd extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1);A(this,"_errorTypeValueMap",new Map([[h.NULL,1],[h.DIV_BY_ZERO,2],[h.VALUE,3],[h.REF,4],[h.NAME,5],[h.NUM,6],[h.NA,7],[h.CONNECT,8],[h.CALC,14]]))}calculate(e){return e.isArray()?e.mapValue(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){const t=e.getValue(),r=this._errorTypeValueMap.get(t);return r?y.create(r):g.create(h.NA)}}var be=(i=>(i.CELL="CELL",i.ERROR_TYPE="ERROR.TYPE",i.INFO="INFO",i.ISBETWEEN="ISBETWEEN",i.ISBLANK="ISBLANK",i.ISDATE="ISDATE",i.ISEMAIL="ISEMAIL",i.ISERR="ISERR",i.ISERROR="ISERROR",i.ISEVEN="ISEVEN",i.ISFORMULA="ISFORMULA",i.ISLOGICAL="ISLOGICAL",i.ISNA="ISNA",i.ISNONTEXT="ISNONTEXT",i.ISNUMBER="ISNUMBER",i.ISODD="ISODD",i.ISOMITTED="ISOMITTED",i.ISREF="ISREF",i.ISTEXT="ISTEXT",i.ISURL="ISURL",i.N="N",i.NA="NA",i.SHEET="SHEET",i.SHEETS="SHEETS",i.TYPE="TYPE",i))(be||{});class jd extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",5)}calculate(e,t,r,n,s){const a=n!=null?n:I.create(!0),u=s!=null?s:I.create(!0),{isError:c,errorObject:l,variants:f}=Fr(e,t,r,a,u);if(c)return l;const[m,d,C,_,E]=f;if(_.isString()||E.isString())return g.create(h.VALUE);if(d.compare(C,">").getValue()===!0)return g.create(h.NUM);const b=+_.getValue(),p=+E.getValue(),V=b?">=":">",S=p?"<=":"<";return m.compare(d,V).getValue()===!1||m.compare(C,S).getValue()===!1?I.create(!1):I.create(!0)}}class Ud extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isNull()?I.create(!0):e.isArray()?e.mapValue(t=>t.isNull()?I.create(!0):I.create(!1)):I.create(!1)}}class Td extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){const r=t.getRowCount(),n=t.getColumnCount();if(r>1||n>1)return g.create(h.VALUE);t=t.get(0,0)}return t.isError()?t:t.isNumber()&&t.getPattern()!==""?I.create(ja(t.getPattern())):t.isString()&&(Sn(`${t.getValue()}`)||Mn(`${t.getValue()}`))?I.create(!0):I.create(!1)}}class vd extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){const a=t.getRowCount(),u=t.getColumnCount();if(a>1||u>1)return g.create(h.VALUE);t=t.get(0,0)}if(t.isError())return t;if(t.isNull()||t.isBoolean()||t.isNumber())return I.create(!1);const r=`${t.getValue()}`;if(r.length>254)return I.create(!1);const n=M.Tools.topLevelDomainCombiningString(),s=new RegExp(`^(?:[\\w+-]+\\.)*[\\w+-]+@[a-z0-9_-]+(?:\\.[a-z0-9_-]+)*\\.(?:${n})$`,"i");return I.create(s.test(r))}}class Id extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.getValue()===h.NA?I.create(!1):e.isError()?I.create(!0):e.isArray()?e.mapValue(t=>t.getValue()===h.NA?I.create(!1):t.isError()?I.create(!0):I.create(!1)):I.create(!1)}}class Fd extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isError()?I.create(!0):e.isArray()?e.mapValue(t=>t.isError()?I.create(!0):I.create(!1)):I.create(!1)}}class Bd extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){const s=t.getRowCount(),a=t.getColumnCount();if(s>1||a>1)return g.create(h.VALUE);t=t.get(0,0)}if(t.isError())return t;if(t.isBoolean())return g.create(h.VALUE);const r=Math.trunc(+t.getValue());if(Number.isNaN(r))return g.create(h.VALUE);const n=r%2===0;return I.create(n)}}class kd extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1);A(this,"needsReferenceObject",!0)}calculate(e){var u;if(e.isError())return e;if(!e.isReferenceObject())return g.create(h.NA);const t=(u=e.getCurrentActiveSheetData())==null?void 0:u.cellData.getMatrix(),{startRow:r,startColumn:n}=e.getRangePosition(),s=e.toArrayValueObject(),a=s.mapValue((c,l,f)=>{var d;const m=(d=t==null?void 0:t[r+l])==null?void 0:d[n+f];return m!=null&&m.f||m!=null&&m.si?I.create(!0):I.create(!1)});return s.getRowCount()===1&&s.getColumnCount()===1?a.get(0,0):a}}class $d extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isBoolean()?I.create(!0):e.isArray()?e.mapValue(t=>t.isBoolean()?I.create(!0):I.create(!1)):I.create(!1)}}class Yd extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.getValue()===h.NA?I.create(!0):e.isArray()?e.mapValue(t=>t.getValue()===h.NA?I.create(!0):I.create(!1)):I.create(!1)}}class Hd extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return!e.isArray()&&!e.isString()?I.create(!0):e.isArray()?e.mapValue(t=>t.isString()?I.create(!1):I.create(!0)):I.create(!1)}}class Gd extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isNumber()?I.create(!0):e.isArray()?e.mapValue(t=>t.isNumber()?I.create(!0):I.create(!1)):I.create(!1)}}class Wd extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){const s=t.getRowCount(),a=t.getColumnCount();if(s>1||a>1)return g.create(h.VALUE);t=t.get(0,0)}if(t.isError())return t;if(t.isBoolean())return g.create(h.VALUE);const r=Math.trunc(+t.getValue());if(Number.isNaN(r))return g.create(h.VALUE);const n=r%2!==0;return I.create(n)}}class Qd extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1);A(this,"needsReferenceObject",!0)}calculate(e){return e.isReferenceObject()?I.create(!0):I.create(!1)}}class qd extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isString()?I.create(!0):e.isArray()?e.mapValue(t=>t.isString()?I.create(!0):I.create(!1)):I.create(!1)}}class Xd extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){const a=t.getRowCount(),u=t.getColumnCount();if(a>1||u>1)return g.create(h.VALUE);t=t.get(0,0)}if(t.isError())return t;if(t.isNull()||t.isBoolean()||t.isNumber())return I.create(!1);const r=`${t.getValue()}`.replace(/^\s+|\s+$/g,"");if(r.length>1e3)return I.create(!1);const n=M.Tools.topLevelDomainCombiningString(),s=new RegExp(`^(?:(?:https?|s?ftp|ftps|nfs|ssh)://+[a-z0-9_-]+(?:\\.[a-z0-9_-]+)*(?::[0-9]+)?(?:/(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[A-Fa-f0-9]{2})*)*/?(?:[?#]\\S*)?|[a-z0-9_-]+(?:\\.[a-z0-9_-]+)*\\.(?:${n})(?::[0-9]+)?(?:/(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[A-Fa-f0-9]{2})*)*/?(?:[?#]\\S*)?|mailto:(?:[\\w+-]+\\.)*[\\w+-]+@[a-z0-9_-]+(?:\\.[a-z0-9_-]+)*\\.(?:${n})|(?:news|aim):[%a-z0-9$_\\.+!*(),;/?#:@&~=-]+)$`,"i");return I.create(s.test(r))}}class Kd extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;if(e.isArray()&&(t=e.get(0,0)),t.isError())return t;if(t.isString())return y.create(0);const r=+t.getValue();return y.create(r)}}class Zd extends N{constructor(){super(...arguments);A(this,"minParams",0);A(this,"maxParams",0)}calculate(){return g.create(h.NA)}}class zd extends N{constructor(){super(...arguments);A(this,"minParams",0);A(this,"maxParams",1);A(this,"needsReferenceObject",!0);A(this,"needsSheetsInfo",!0)}calculate(e){var u;if(e!=null&&e.isError())return e;const{sheetOrder:t,sheetNameMap:r}=this.getSheetsInfo();if(!e){const c=t.findIndex(l=>l===this.subUnitId);return y.create(c+1)}if(e.isReferenceObject()){const c=e.getForcedSheetId(),l=e.getDefaultSheetId(),f=t.findIndex(m=>c?m===c:m===l);return y.create(f+1)}if(e.isArray())return g.create(h.NA);const n=`${e.getValue()}`.toLocaleLowerCase(),s=(u=Object.entries(r).find(([c,l])=>l.toLocaleLowerCase()===n))==null?void 0:u[0];if(!s)return g.create(h.NA);const a=t.findIndex(c=>c===s);return y.create(a+1)}}class Jd extends N{constructor(){super(...arguments);A(this,"minParams",0);A(this,"maxParams",0);A(this,"needsSheetsInfo",!0)}calculate(){const{sheetOrder:e}=this.getSheetsInfo();return y.create(e.length)}}class e0 extends N{constructor(){super(...arguments);A(this,"needsReferenceObject",!0);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isReferenceObject()){const t=e.getRowCount(),r=e.getColumnCount();if(t===1&&r===1){const n=e.getFirstCell();if(n.isError())return y.create(16);if(n.isBoolean())return y.create(4);if(n.isString())return y.create(2);if(n.isNumber()||n.isNull())return y.create(1)}else return y.create(64)}else{if(e.isArray())return y.create(64);if(e.isError())return y.create(16);if(e.isBoolean())return y.create(4);if(e.isString())return y.create(2);if(e.isNumber()||e.isNull())return y.create(1)}return y.create(128)}}const Ju=[[Pd,be.CELL],[xd,be.ERROR_TYPE],[jd,be.ISBETWEEN],[Ud,be.ISBLANK],[Td,be.ISDATE],[vd,be.ISEMAIL],[Id,be.ISERR],[Fd,be.ISERROR],[Bd,be.ISEVEN],[kd,be.ISFORMULA],[$d,be.ISLOGICAL],[Yd,be.ISNA],[Hd,be.ISNONTEXT],[Gd,be.ISNUMBER],[Wd,be.ISODD],[Qd,be.ISREF],[qd,be.ISTEXT],[Xd,be.ISURL],[Kd,be.N],[Zd,be.NA],[zd,be.SHEET],[Jd,be.SHEETS],[e0,be.TYPE]];class t0 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=!0,r=!0,n=null;for(const s of e){if(s.isError())return s;if(s.isArray()){if(s.iterator(a=>{if(a!=null&&a.isError())return n=a,!1;(a!=null&&a.isBoolean()||a!=null&&a.isNumber())&&(t=t&&!!a.getValue(),r=!1)}),n)return n}else(s.isBoolean()||s.isNumber())&&(t=t&&!!s.getValue(),r=!1)}return r?g.create(h.VALUE):I.create(t)}}class r0 extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2);A(this,"needsReferenceObject",!0)}calculate(e,t){let r=e,n=null;if(e.isReferenceObject()&&(r=e.toArrayValueObject(),n=e),r.isError())return r;if(t.isError())return t;if(!(t.isValueObject()&&t.isLambda()&&t.getLambdaPrivacyVarKeys().length===1))return g.create(h.VALUE);const s=t,a=r.isArray()?r.getRowCount():1,u=r.isArray()?r.getColumnCount():1;r=O(a,u,r);const c=[[]];for(let l=0;l<u;l++){const f=[];for(let C=0;C<a;C++){const _=r.get(C,l);f.push([_])}let m=K.create({calculateValueList:f,rowCount:a,columnCount:1,unitId:"",sheetId:"",row:0,column:0});if(n){const{startRow:C,startColumn:_}=n.getRangePosition(),E={startRow:C,startColumn:_+l,endRow:C+a-1,endColumn:_+l};m=this.createReferenceObject(n,E)}let d=s.execute(m);if(d.isArray()){const C=d.getRowCount(),_=d.getColumnCount();if(C>1||_>1)return g.create(h.CALC);d=d.get(0,0)}d.isNull()&&(d=y.create(0)),c[0].push(d)}return u===1?c[0][0]:K.create({calculateValueList:c,rowCount:1,columnCount:u,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}class n0 extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2);A(this,"needsReferenceObject",!0)}calculate(e,t){let r=e,n=null;if(e.isReferenceObject()&&(r=e.toArrayValueObject(),n=e),r.isError())return r;if(t.isError())return t;if(!(t.isValueObject()&&t.isLambda()&&t.getLambdaPrivacyVarKeys().length===1))return g.create(h.VALUE);const s=t,a=r.isArray()?r.getRowCount():1,u=r.isArray()?r.getColumnCount():1;r=O(a,u,r);const c=[];for(let l=0;l<a;l++){const f=[[]];for(let C=0;C<u;C++){const _=r.get(l,C);f[0].push(_)}let m=K.create({calculateValueList:f,rowCount:1,columnCount:u,unitId:"",sheetId:"",row:0,column:0});if(n){const{startRow:C,startColumn:_}=n.getRangePosition(),E={startRow:C+l,startColumn:_,endRow:C+l,endColumn:_+u-1};m=this.createReferenceObject(n,E)}let d=s.execute(m);if(d.isArray()){const C=d.getRowCount(),_=d.getColumnCount();if(C>1||_>1)return g.create(h.CALC);d=d.get(0,0)}d.isNull()&&(d=y.create(0)),c.push([d])}return a===1?c[0][0]:K.create({calculateValueList:c,rowCount:a,columnCount:1,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}class s0 extends N{constructor(){super(...arguments);A(this,"minParams",0);A(this,"maxParams",0)}calculate(){return I.create(!1)}}var _e=(i=>(i.AND="AND",i.BYCOL="BYCOL",i.BYROW="BYROW",i.FALSE="FALSE",i.IF="IF",i.IFERROR="IFERROR",i.IFNA="IFNA",i.IFS="IFS",i.LAMBDA="LAMBDA",i.LET="LET",i.MAKEARRAY="MAKEARRAY",i.MAP="MAP",i.NOT="NOT",i.OR="OR",i.REDUCE="REDUCE",i.SCAN="SCAN",i.SWITCH="SWITCH",i.TRUE="TRUE",i.XOR="XOR",i))(_e||{});class a0 extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r=I.create(!1)){let n=e;if(e.isArray()){const f=e.getRowCount(),m=e.getColumnCount();f===1&&m===1&&(n=e.get(0,0))}if(!n.isArray())return this._handleSingleObject(n,t,r);const s=Math.max(n.isArray()?n.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),a=Math.max(n.isArray()?n.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=O(s,a,n,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA));return u.mapValue((f,m,d)=>{const C=c.get(m,d),_=l.get(m,d);return this._handleSingleObject(f,C,_)})}_handleSingleObject(e,t,r){return e.isError()?e:e.getValue()?t:r}}class i0 extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(!e.isArray())return e.isError()?t:e;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e),a=O(r,n,t);return s.iterator((u,c,l)=>{u!=null&&u.isError()&&s.set(c,l,a.get(c,l))}),s}}class o0 extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError()&&e.getErrorType()!==h.NA)return e;if(t.isError())return t;if(!e.isArray())return e.isError()&&e.getErrorType()===h.NA?t:e;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e),a=O(r,n,t);return s.iterator((u,c,l)=>{u!=null&&u.isError()&&u.getErrorType()===h.NA&&s.set(c,l,a.get(c,l))}),s}}class u0 extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",255)}calculate(...e){if(e.length%2!==0)return g.create(h.NA);for(let a=0;a<e.length;a++)if(e[a].isError())return e[a];const t=Math.max(...e.map(a=>a.isArray()?a.getRowCount():1)),r=Math.max(...e.map(a=>a.isArray()?a.getColumnCount():1)),n=e.map(a=>O(t,r,a,g.create(h.NA))),s=n[0].map((a,u,c)=>{for(let l=0;l<n.length;l+=2){const f=n[l].get(u,c)||ce.create(),m=n[l+1].get(u,c)||ce.create();if(f.isNull())continue;if(f.isError())return f;const d=f.getValue();if(f.isString()){if(`${d}`.toLocaleUpperCase()==="TRUE")return m;if(`${d}`.toLocaleUpperCase()==="FALSE")continue;return g.create(h.VALUE)}if(+d)return m.isNull()?g.create(h.NA):m}return g.create(h.NA)});return t===1&&r===1?s.get(0,0):s}}class c0 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){return g.create(h.VALUE)}}class l0 extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",255)}calculate(...e){return g.create(h.VALUE)}}class f0 extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(...e){const t=this.getIndexNumValue(e[0]);if(typeof t!="number")return t;const r=this.getIndexNumValue(e[1]);if(typeof r!="number")return r;if(!(e[2].isValueObject()&&e[2].isLambda()))return g.create(h.VALUE);const n=e[2],s=[];for(let a=0;a<t;a++){s[a]==null&&(s[a]=[]);for(let u=0;u<r;u++){let c=n.execute(y.create(a+1),y.create(u+1));c.isArray()&&(c=c.get(0,0)),s[a][u]=c}}return new yo(s)}isAsync(){return!0}}let m0=class extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",255);A(this,"needsReferenceObject",!0)}calculate(...e){const t=[];let r=null,n=0,s=0;for(let u=0;u<e.length;u++){const c=e[u];let l=c;if(l.isReferenceObject()&&(l=c.toArrayValueObject()),l.isError())return l;if(u===e.length-1){if(!(c.isValueObject()&&c.isLambda()))return g.create(h.VALUE);r=c}else t.push(c),n=Math.max(n,l.isArray()?l.getRowCount():1),s=Math.max(s,l.isArray()?l.getColumnCount():1)}const a=this._getResultArray(t,r,n,s);return a instanceof g?a:n===1&&s===1?a[0][0]:K.create({calculateValueList:a,rowCount:n,columnCount:s,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}_getResultArray(e,t,r,n){const s=[];for(let a=0;a<r;a++){const u=[];for(let c=0;c<n;c++){const l=[];let f=!1;for(let d=0;d<e.length;d++){let C=e[d],_=null;if(C.isReferenceObject()&&(_=C,C=C.toArrayValueObject()),!C.isArray())if(a===0&&c===0){l.push(_||C);continue}else{u.push(g.create(h.NA)),f=!0;break}let E=C.get(a,c);if(!E){u.push(g.create(h.NA)),f=!0;break}if(_){const{startRow:R,startColumn:b}=_.getRangePosition(),p={startRow:R+a,startColumn:b+c,endRow:R+a,endColumn:b+c};E=this.createReferenceObject(_,p)}l.push(E)}if(f||l.length===0)continue;let m=t.execute(...l);if(m.isArray()){const d=m.getRowCount(),C=m.getColumnCount();if(d>1||C>1)return g.create(h.CALC);m=m.get(0,0)}m.isNull()&&(m=y.create(0)),u.push(m)}s.push(u)}return s}};class h0 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;const t=+e.getValue();return Number.isNaN(t)?g.create(h.VALUE):I.create(!t)}}class g0 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=!1,r=!0,n=null;for(const s of e){if(s.isError())return s;if(s.isArray()){if(s.iterator(a=>{if(a!=null&&a.isError())return n=a,!1;(a!=null&&a.isBoolean()||a!=null&&a.isNumber())&&(t=t||!!a.getValue(),r=!1)}),n)return n}else(s.isBoolean()||s.isNumber())&&(t=t||!!s.getValue(),r=!1)}return r?new g(h.VALUE):new I(t)}}class d0 extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3);A(this,"needsReferenceObject",!0)}calculate(e,t,r){let n,s;e.isReferenceObject()?(n=e.toArrayValueObject(),s=e):(n=e,s=null);let a,u;return t.isReferenceObject()?(a=t.toArrayValueObject(),u=t):(a=t,u=null),n.isArray()?n.mapValue(c=>this._handleSingleValueObject(c,a,r,s,u)):this._handleSingleValueObject(n,a,r,s,u)}_handleSingleValueObject(e,t,r,n,s){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(!(r.isValueObject()&&r.isLambda()&&r.getLambdaPrivacyVarKeys().length===2))return g.create(h.VALUE);const a=r,u=t.isArray()?t.getRowCount():1,c=t.isArray()?t.getColumnCount():1;let l=e;n&&(l=n);for(let f=0;f<u;f++)for(let m=0;m<c;m++){let d=t.isArray()?t.get(f,m):t;if(d.isError())return d;if(s){const{startRow:_,startColumn:E}=s.getRangePosition(),R={startRow:_+f,startColumn:E+m,endRow:_+f,endColumn:E+m};d=this.createReferenceObject(s,R)}let C=a.execute(l,d);if(C.isError())return C;C.isNull()&&(C=y.create(0)),l=C}return l.isReferenceObject()?l.toArrayValueObject():l}}class C0 extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3);A(this,"needsReferenceObject",!0)}calculate(e,t,r){let n=e,s=null;e.isReferenceObject()&&(n=e.toArrayValueObject(),s=e),n=n;let a=t,u=null;if(t.isReferenceObject()&&(a=t.toArrayValueObject(),u=t),a=a,n.isError())return n;if(a.isError())return a;if(r.isError())return r;if(!(r.isValueObject()&&r.isLambda()&&r.getLambdaPrivacyVarKeys().length===2))return g.create(h.VALUE);if(n.isArray()){const c=n.getRowCount(),l=n.getColumnCount();if(c>1||l>1)return g.create(h.CALC);n=n.get(0,0)}return this._getResult(n,a,r,s,u)}_getResult(e,t,r,n,s){const a=[],u=t.isArray()?t.getRowCount():1,c=t.isArray()?t.getColumnCount():1;let l=e;n&&(l=n);for(let f=0;f<u;f++){const m=[];for(let d=0;d<c;d++){if(l.isError()){m.push(l);continue}let C=t.isArray()?t.get(f,d):t;if(C.isError()){l=C,m.push(C);continue}if(s){const{startRow:E,startColumn:R}=s.getRangePosition(),b={startRow:E+f,startColumn:R+d,endRow:E+f,endColumn:R+d};C=this.createReferenceObject(s,b)}let _=r.execute(l,C);if(_.isArray()){const E=_.getRowCount(),R=_.getColumnCount();if(E>1||R>1)return g.create(h.CALC);_=_.get(0,0)}_.isNull()&&(_=y.create(0)),l=_,m.push(_)}a.push(m)}return u===1&&c===1?a[0][0]:K.create({calculateValueList:a,rowCount:u,columnCount:c,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}class _0 extends N{constructor(){super(...arguments);A(this,"minParams",3)}calculate(e,...t){if(e.isError())return e;const r=t.length%2!==0,n=r?t[t.length-1]:ce.create();return!e.isArray()&&!t.some(s=>s.isArray())?this._handleNonArrayInputs(e,t,n,r):this._handleArrayInputs(e,t,n,r)}_handleNonArrayInputs(e,t,r,n){for(let s=0;s<t.length-(n?1:0);s+=2){const a=t[s],u=t[s+1];if(!a.isNull()){if(a.isError())return a;if(`${e.getValue()}`.toLocaleLowerCase()===`${a.getValue()}`.toLocaleLowerCase())return u.isNull()?g.create(h.NA):u}}return r.isNull()?g.create(h.NA):r}_handleArrayInputs(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,...t.map(f=>f.isArray()?f.getRowCount():1),r.isArray()?r.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,...t.map(f=>f.isArray()?f.getColumnCount():1),r.isArray()?r.getColumnCount():1),u=O(s,a,e),c=t.map(f=>O(s,a,f,g.create(h.NA))),l=O(s,a,r,g.create(h.NA));return u.map((f,m,d)=>{for(let _=0;_<c.length-(n?1:0);_+=2){const E=c[_].get(m,d)||ce.create(),R=c[_+1].get(m,d)||ce.create();if(!E.isNull()){if(E.isError()||f.isError())return E.isError()?E:f;if(`${f.getValue()}`.toLocaleLowerCase()===`${E.getValue()}`.toLocaleLowerCase())return R.isNull()?g.create(h.NA):R}}const C=l.get(m,d)||ce.create();return C.isNull()?g.create(h.NA):C})}}class A0 extends N{constructor(){super(...arguments);A(this,"minParams",0);A(this,"maxParams",0)}calculate(){return I.create(!0)}}class E0 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=0,r=!0,n=null;for(const s of e){if(s.isError())return s;if(s.isArray()){if(s.iterator(a=>{if(a!=null&&a.isError())return n=a,!1;(a!=null&&a.isBoolean()||a!=null&&a.isNumber())&&(a.getValue()&&t++,r=!1)}),n)return n}else(s.isBoolean()||s.isNumber())&&(s.getValue()&&t++,r=!1)}return r?g.create(h.VALUE):I.create(t%2===1)}}const ec=[[t0,_e.AND],[r0,_e.BYCOL],[n0,_e.BYROW],[s0,_e.FALSE],[a0,_e.IF],[i0,_e.IFERROR],[o0,_e.IFNA],[u0,_e.IFS],[c0,_e.LAMBDA],[l0,_e.LET],[f0,_e.MAKEARRAY],[m0,_e.MAP],[h0,_e.NOT],[g0,_e.OR],[d0,_e.REDUCE],[C0,_e.SCAN],[_0,_e.SWITCH],[A0,_e.TRUE],[E0,_e.XOR]];class R0 extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",5)}calculate(e,t,r,n,s){if(e.isError())return e;if(t.isError())return t;if(r!=null&&r.isError())return r;if(n!=null&&n.isError())return n;if(s!=null&&s.isError())return s;const a=r!=null?r:y.create(1),u=n!=null?n:I.create(!0),c=s!=null?s:T.create(""),l=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,a.isArray()?a.getRowCount():1,u.isArray()?u.getRowCount():1,c.isArray()?c.getRowCount():1),f=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,a.isArray()?a.getColumnCount():1,u.isArray()?u.getColumnCount():1,c.isArray()?c.getColumnCount():1),m=O(l,f,e,g.create(h.NA)),d=O(l,f,t,g.create(h.NA)),C=O(l,f,a,g.create(h.NA)),_=O(l,f,u,g.create(h.NA)),E=O(l,f,c,g.create(h.NA));return m.map((R,b,p)=>{const V=d.get(b,p)||g.create(h.NA),S=C.get(b,p)||g.create(h.NA),D=_.get(b,p)||g.create(h.NA),w=E.get(b,p)||g.create(h.NA);return R.isError()?R:V.isError()?V:S.isError()?S:D.isError()?D:w.isError()?w:this._calculateSingleCell(R,V,S,D,w)})}_calculateSingleCell(e,t,r,n,s){const a=Number.parseInt(`${Number(e.getValue())-1}`),u=Number.parseInt(`${Number(t.getValue())-1}`),c=Number.parseInt(`${Number(r.getValue())}`);if(Number.isNaN(a)||Number.isNaN(u)||Number.isNaN(c)||c<1||c>4)return g.create(h.VALUE);const l=b0(c),f=this.getZeroOrOneByOneDefault(n),m=`${s.getValue()}`,d=Ji(m),C={startRow:a,startColumn:u,endRow:a,endColumn:u,startAbsoluteRefType:l,endAbsoluteRefType:l},_=n&&!f?Qm(C):bt(C);return T.create(d!==""?`${d}!${_}`:_)}}function b0(i){switch(i){case 1:return M.AbsoluteRefType.ALL;case 2:return M.AbsoluteRefType.ROW;case 3:return M.AbsoluteRefType.COLUMN;case 4:return M.AbsoluteRefType.NONE;default:return M.AbsoluteRefType.ALL}}class y0 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1);A(this,"needsReferenceObject",!0)}calculate(e){return e.isReferenceObject()?y.create(1):g.create(h.VALUE)}}class p0 extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",255);A(this,"needsReferenceObject",!0)}calculate(e,...t){let r=e;if(r.isError())return r;if(r.isReferenceObject()&&(r=r.toArrayValueObject()),!r.isArray()){const c=r.convertToNumberObjectValue();return c.isError()?c:t[Math.trunc(+c.getValue())-1]||g.create(h.VALUE)}let n=r.isArray()?r.getRowCount():1,s=r.isArray()?r.getColumnCount():1;t.forEach((c,l)=>{if(c.isArray()){const f=c;n=Math.max(n,f.getRowCount()),s=Math.max(s,f.getColumnCount())}else n=Math.max(n,1),s=Math.max(s,1)});const a=O(n,s,r,g.create(h.NA)),u=t.map(c=>{let l=c;return l.isReferenceObject()&&(l=l.toArrayValueObject()),O(n,s,l,g.create(h.NA))});return a.map((c,l,f)=>{if(c.isError())return c;const m=c.convertToNumberObjectValue();if(m.isError())return m;const d=u[Math.trunc(+m.getValue())-1];let C=(d==null?void 0:d.get(l,f))||g.create(h.VALUE);return C!=null&&C.isNull()&&(C=y.create(0)),C})}}class N0 extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",255)}calculate(e,...t){if(e.isError())return e;const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=[];for(let a=0;a<t.length;a++){let u=t[a];if(u.isArray()){const f=u.getRowCount(),m=u.getColumnCount();if(f>1||m>1)return g.create(h.VALUE);u=u.get(0,0)}if(u.isString()&&(u=u.convertToNumberObjectValue()),u.isError())return u;const c=Math.trunc(+u.getValue());if(c===0||Math.abs(c)>n)return g.create(h.VALUE);let l=e;n>1&&(c<0?l=e.slice(void 0,[c+n,c+1+n]):l=e.slice(void 0,[c-1,c]));for(let f=0;f<r;f++)s[f]||(s[f]=[]),e.isArray()?s[f].push(l.get(f,0)):s[f].push(e)}return K.create({calculateValueList:s,rowCount:s.length,columnCount:s[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}class V0 extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",255)}calculate(e,...t){if(e.isError())return e;const r=e.isArray()?e.getRowCount():1,n=[];for(let s=0;s<t.length;s++){let a=t[s];if(a.isArray()){const l=a.getRowCount(),f=a.getColumnCount();if(l>1||f>1)return g.create(h.VALUE);a=a.get(0,0)}if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;const u=Math.trunc(+a.getValue());if(u===0||Math.abs(u)>r)return g.create(h.VALUE);let c=e;r>1&&(u<0?c=e.slice([u+r,u+1+r]):c=e.slice([u-1,u])),e.isArray()?n.push(c.getArrayValue()[0]):n.push([e])}return K.create({calculateValueList:n,rowCount:n.length,columnCount:n[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}class O0 extends N{constructor(){super(...arguments);A(this,"minParams",0);A(this,"maxParams",1)}calculate(e){if(e==null)return y.create(this.column+1);if(e.isError())return e;if(!e.isArray())return g.create(h.NA);const t=e.getCurrentColumn(),r=e.getColumnCount(),n=[];for(let a=0;a<r;a++)n.push(y.create(t+a+1));const s={calculateValueList:[n],rowCount:1,columnCount:r,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return K.create(s)}}class S0 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isError())return e;if(e.isString()||e.isNumber()||e.isBoolean())return y.create(1);if(!e.isArray())return g.create(h.NA);const t=e.getColumnCount();return y.create(t)}}class M0 extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){const n=r!=null?r:y.create(0),s=e.isArray()?e.getRowCount():1,a=e.isArray()?e.getColumnCount():1,u=Math.max(t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),c=Math.max(t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),l=O(u,c,t,g.create(h.NA)),f=O(u,c,n,g.create(h.NA));if(u>1||c>1)return l.mapValue((b,p,V)=>{const S=f.get(p,V);if(e.isError())return e;if(e.isNull())return g.create(h.VALUE);const{isError:D,errorObject:w}=this._checkRowsColumns(b,S,s,a);return D?w:e.isArray()?g.create(h.VALUE):e});if(e.isError())return e;if(e.isNull())return g.create(h.VALUE);const m=t.isArray()?t.get(0,0):t,d=n.isArray()?n.get(0,0):n,{isError:C,errorObject:_,rowsValue:E,columnsValue:R}=this._checkRowsColumns(m,d,s,a);return C?_:this._getResultArray(e,E,R,s,a)}_checkRowsColumns(e,t,r,n){if(e.isError())return{isError:!0,errorObject:e};if(t.isError())return{isError:!0,errorObject:t};const s=Math.trunc(+e.getValue()),a=Math.trunc(+t.getValue());return Number.isNaN(s)||Number.isNaN(a)?{isError:!0,errorObject:g.create(h.VALUE)}:Math.abs(s)>=r||Math.abs(a)>=n?{isError:!0,errorObject:g.create(h.CALC)}:{isError:!1,rowsValue:s,columnsValue:a}}_getResultArray(e,t,r,n,s){const a=t>=0?[t,n]:[0,n+t],u=r>=0?[r,s]:[0,s+r];let c;return t===0&&r===0?c=e:t===0?c=e.slice(void 0,u):r===0?c=e.slice(a,void 0):c=e.slice(a,u),c=c.map(l=>l.isNull()?y.create(0):l),n-t===1&&s-r===1?c.get(0,0):c}}class D0 extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",4)}calculate(e,t,r,n){const s=e.isArray()?e.getRowCount():1,a=e.isArray()?e.getColumnCount():1;let u=t,c=r!=null?r:y.create(a);const l=n!=null?n:g.create(h.NA);t.isNull()&&(u=y.create(s)),c.isNull()&&(c=y.create(a));const f=Math.max(u.isArray()?u.getRowCount():1,c.isArray()?c.getRowCount():1),m=Math.max(u.isArray()?u.getColumnCount():1,c.isArray()?c.getColumnCount():1),d=O(f,m,u,g.create(h.NA)),C=O(f,m,c,g.create(h.NA));if(f>1||m>1)return d.mapValue((D,w,L)=>{const P=C.get(w,L);if(e.isError())return e;if(e.isNull())return g.create(h.VALUE);const{isError:v,errorObject:U}=this._checkRowsColumnsPadWith(D,P,l,s,a);return v?U:e.isArray()?e.get(0,0):e});if(e.isError())return e;if(e.isNull())return g.create(h.VALUE);const _=u.isArray()?u.get(0,0):u,E=c.isArray()?c.get(0,0):c,{isError:R,errorObject:b,rowsValue:p,columnsValue:V,padWithObject:S}=this._checkRowsColumnsPadWith(_,E,l,s,a);return R?b:this._getResultArray(e,p,V,S,s,a)}_checkRowsColumnsPadWith(e,t,r,n,s){if(e.isError())return{isError:!0,errorObject:e};if(t.isError())return{isError:!0,errorObject:t};const a=Math.trunc(+e.getValue()),u=Math.trunc(+t.getValue());if(Number.isNaN(a)||Number.isNaN(u))return{isError:!0,errorObject:g.create(h.VALUE)};if(Math.abs(a)<n||Math.abs(u)<s)return{isError:!0,errorObject:g.create(h.VALUE)};let c=r;if(r.isArray()){const l=r.getRowCount(),f=r.getColumnCount();if(l>1||f>1)return{isError:!0,errorObject:g.create(h.VALUE)};c=r.get(0,0)}return{isError:!1,rowsValue:a,columnsValue:u,padWithObject:c}}_getResultArray(e,t,r,n,s,a){let u=[];e.isArray()?u=e.map(f=>f.isNull()?y.create(0):f).getArrayValue():u=[[e]];const c=Math.max(0,t-s),l=Math.max(0,r-a);for(let f=0;f<c;f++)u.push(new Array(a).fill(n));for(let f=0;f<l;f++)u.forEach(m=>{m.push(n)});return t===1&&r===1?u[0][0]:K.create({calculateValueList:u,rowCount:u.length,columnCount:u[0].length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}class w0 extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){const n=r!=null?r:g.create(h.CALC);if(e.isError())return e;if(t.isError())return t;const s=e.isArray()?e.getRowCount():1,a=e.isArray()?e.getColumnCount():1,u=t.isArray()?t.getRowCount():1,c=t.isArray()?t.getColumnCount():1;return u>1&&c>1||u===1&&c!==a||c===1&&u!==s?g.create(h.VALUE):s===1&&a===1?this._getResultArrayByR1C1(e,t,n):u===1?c!==a?g.create(h.VALUE):this._getResultArrayByR1(s,a,e,t,n):c===1?u!==s?g.create(h.VALUE):this._getResultArrayByC1(s,a,e,t,n):n}_getResultArrayByR1C1(e,t,r){let n=e,s=t;return n.isArray()&&(n=n.get(0,0)),s.isArray()&&(s=s.get(0,0)),s.isString()&&(s=s.convertToNumberObjectValue()),s.isError()?s:+s.getValue()?n:r}_getResultArrayByR1(e,t,r,n,s){const a=[];for(let u=0;u<t;u++){let c=n.get(0,u);if(c.isString()&&(c=c.convertToNumberObjectValue()),c.isError())return c;if(+c.getValue())for(let f=0;f<e;f++){a[f]||(a[f]=[]);const m=r.get(f,u);a[f].push(m)}}return a.length===0?s:K.create({calculateValueList:a,rowCount:a.length,columnCount:a[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}_getResultArrayByC1(e,t,r,n,s){const a=[];for(let u=0;u<e;u++){let c=n.get(u,0);if(c.isString()&&(c=c.convertToNumberObjectValue()),c.isError())return c;if(!+c.getValue())continue;const f=[];for(let m=0;m<t;m++){const d=r.get(u,m);f.push(d)}a.push(f)}return a.length===0?s:K.create({calculateValueList:a,rowCount:a.length,columnCount:a[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}class L0 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1);A(this,"needsReferenceObject",!0);A(this,"needsFormulaDataModel",!0)}calculate(e){var f,m;if(!e.isReferenceObject())return g.create(h.NA);const t=e.getUnitId(),r=e.getSheetId(),s=(m=(f=e.getUnitData()[t])==null?void 0:f[r])==null?void 0:m.cellData,{startRow:a,startColumn:u}=e.getRangePosition(),l=e.toArrayValueObject().mapValue((d,C,_)=>{const E=s.getValue(a+C,u+_);if(E!=null&&E.f||E!=null&&E.si){const R=this._formulaDataModel.getFormulaStringByCell(a+C,u+_,r,t);return T.create(R)}return g.create(h.NA)});return l.getRowCount()===1&&l.getColumnCount()===1?l.get(0,0):l}}var ne=(i=>(i.ADDRESS="ADDRESS",i.AREAS="AREAS",i.CHOOSE="CHOOSE",i.CHOOSECOLS="CHOOSECOLS",i.CHOOSEROWS="CHOOSEROWS",i.COLUMN="COLUMN",i.COLUMNS="COLUMNS",i.DROP="DROP",i.EXPAND="EXPAND",i.FILTER="FILTER",i.FORMULATEXT="FORMULATEXT",i.GETPIVOTDATA="GETPIVOTDATA",i.HLOOKUP="HLOOKUP",i.HSTACK="HSTACK",i.HYPERLINK="HYPERLINK",i.IMAGE="IMAGE",i.INDEX="INDEX",i.INDIRECT="INDIRECT",i.LOOKUP="LOOKUP",i.MATCH="MATCH",i.OFFSET="OFFSET",i.ROW="ROW",i.ROWS="ROWS",i.RTD="RTD",i.SORT="SORT",i.SORTBY="SORTBY",i.TAKE="TAKE",i.TOCOL="TOCOL",i.TOROW="TOROW",i.TRANSPOSE="TRANSPOSE",i.UNIQUE="UNIQUE",i.VLOOKUP="VLOOKUP",i.VSTACK="VSTACK",i.WRAPCOLS="WRAPCOLS",i.WRAPROWS="WRAPROWS",i.XLOOKUP="XLOOKUP",i.XMATCH="XMATCH",i))(ne||{});class P0 extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",4)}calculate(e,t,r,n){if(e.isError())return e;if(t.isError())return g.create(h.REF);if(!t.isArray()||r.isError()||n!=null&&n.isError())return g.create(h.NA);const s=this.getZeroOrOneByOneDefault(n);if(s==null)return g.create(h.VALUE);const a=this.getIndexNumValue(r);if(a instanceof g)return a;const u=t.slice([0,1]),c=t.slice([a-1,a]);return u==null||c==null?g.create(h.REF):e.isArray()?e.map(l=>this._handleSingleObject(l,u,c,s)):this._handleSingleObject(e,u,c,s)}_handleSingleObject(e,t,r,n){return n===0?this.equalSearch(e,t,r):this.binarySearch(e,t,r)}}class x0 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=Math.max(...e.map(n=>n.isArray()?n.getRowCount():1)),r=[];for(let n=0;n<e.length;n++){const s=e[n];if(s.isError())return s;const a=s.isArray()?s.getRowCount():1,u=s.isArray()?s.getColumnCount():1;for(let c=0;c<t;c++){r[c]||(r[c]=[]);for(let l=0;l<u;l++){let f=s;s.isArray()&&(f=s.get(c,l)),c>a-1||!f?r[c].push(g.create(h.NA)):r[c].push(f)}}}return K.create({calculateValueList:r,rowCount:r.length,columnCount:r[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}class j0 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){let r=e;if(e.isArray()&&(r=e.get(0,0)),r.isError())return r;let n=t;if(t!=null&&t.isArray()&&(n=t.get(0,0)),n!=null&&n.isError())return n;let s=`${r.getValue()}`;r.isNull()&&(s="");let a=s;return n&&(a=`${n.getValue()}`,n.isNull()?a="0":n.isBoolean()&&(a=a.toLocaleUpperCase())),T.create(a,{isHyperlink:!0,hyperlinkUrl:s})}}class U0 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",5)}calculate(e,t,r,n,s){const a=Math.max(e.isArray()?e.getRowCount():1,t!=null&&t.isArray()?t.getRowCount():1,r!=null&&r.isArray()?r.getRowCount():1,n!=null&&n.isArray()?n.getRowCount():1,s!=null&&s.isArray()?s.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t!=null&&t.isArray()?t.getColumnCount():1,r!=null&&r.isArray()?r.getColumnCount():1,n!=null&&n.isArray()?n.getColumnCount():1,s!=null&&s.isArray()?s.getColumnCount():1),c=O(a,u,e,g.create(h.NA)),l=t?O(a,u,t,g.create(h.NA)):void 0,f=r?O(a,u,r,g.create(h.NA)):void 0,m=n?O(a,u,n,g.create(h.NA)):void 0,d=s?O(a,u,s,g.create(h.NA)):void 0,C=c.mapValue((_,E,R)=>{if(_.isError())return _;const b=l?l.get(E,R):void 0;if(b!=null&&b.isError())return b;const p=f?f.get(E,R):void 0;if(p!=null&&p.isError())return p;const V=m?m.get(E,R):void 0;if(V!=null&&V.isError())return V;const S=d?d.get(E,R):void 0;return S!=null&&S.isError()?S:this._handleSingleObject(_,b,p,V,S)});return a===1&&u===1?C.get(0,0):C}_handleSingleObject(e,t,r,n,s){if(!e.isString())return g.create(h.VALUE);const a=e.getValue();let u="";t&&(t.isBoolean()?u=t.getValue()?"TRUE":"FALSE":t.isNull()||(u=`${t.getValue()}`));let c=r!=null?r:y.create(0);if(c.isString()&&(c=c.convertToNumberObjectValue()),c.isError())return c;const l=Math.abs(Math.trunc(+c.getValue()));if(l<0||l>3||[0,1,2].includes(l)&&(n||s))return g.create(h.VALUE);let f=n!=null?n:y.create(0);if(f.isString()&&(f=f.convertToNumberObjectValue()),f.isError())return f;const m=Math.ceil(+f.getValue());let d=s!=null?s:y.create(0);if(d.isString()&&(d=d.convertToNumberObjectValue()),d.isError())return d;const C=Math.ceil(+d.getValue());return l===3&&m<1&&C<1?g.create(h.VALUE):T.create("",{isImage:!0,imageInfo:{source:a,altText:u,sizing:l,height:m,width:C}})}}class T0 extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",4);A(this,"needsReferenceObject",!0)}calculate(e,t,r,n){if(e.isError())return e;const s=this._getReferenceCounts(e);let a=t;t.isReferenceObject()&&(a=t.toArrayValueObject());let u=r;u!=null&&u.isReferenceObject()&&(u=r.toArrayValueObject());let c=n!=null?n:y.create(1);c.isReferenceObject()&&(c=n.toArrayValueObject());const l=Math.max(a.isArray()?a.getRowCount():1,u!=null&&u.isArray()?u.getRowCount():1,c.isArray()?c.getRowCount():1),f=Math.max(a.isArray()?a.getColumnCount():1,u!=null&&u.isArray()?u.getColumnCount():1,c.isArray()?c.getColumnCount():1);if(l===1&&f===1)return this._handleSingleObject(e,a.isArray()?a.get(0,0):a,u?u.isArray()?u.get(0,0):u:void 0,c.isArray()?c.get(0,0):c,s);{const m=O(l,f,a,g.create(h.NA)),d=u?O(l,f,u,g.create(h.NA)):[],C=O(l,f,c,g.create(h.NA));return m.mapValue((_,E,R)=>{const b=u?d.get(E,R):void 0,p=C.get(E,R),V=this._handleSingleObject(e,_,b,p,s);return V.isReferenceObject()?V.getCellByPosition():V})}}_handleSingleObject(e,t,r,n,s){let a,u,c;if(r){const{isError:_,errorObject:E,variants:R}=F(t,r,n);if(_)return E;a=R[0],u=R[1],c=R[2]}else{const{isError:_,errorObject:E,variants:R}=F(t,n);if(_)return E;a=R[0],c=R[1]}const l=Math.floor(+c.getValue());if(l<0)return g.create(h.VALUE);if(l>s.length)return g.create(h.REF);const f=s[l-1];let m=0,d=0;if(f.rowCount===1&&!r?d=Math.floor(+a.getValue()):(m=Math.floor(+a.getValue()),r&&(d=Math.floor(+u.getValue()))),m<0||d<0)return g.create(h.VALUE);if(m>f.rowCount||d>f.columnCount)return g.create(h.REF);let C=e;return l>1&&(C=e.getCubeValues()[l-1]),C.isReferenceObject()?this._calculateReferenceObject(C,m,d):this._calculateArrayObject(C,m,d)}_getReferenceCounts(e){let t=[{rowCount:1,columnCount:1}];return e.isReferenceObject()?t=[{rowCount:e.getRowCount(),columnCount:e.getColumnCount()}]:e.isCube()?t=e.getCubeValues().map(r=>({rowCount:r.getRowCount(),columnCount:r.getColumnCount()})):e.isArray()&&(t=[{rowCount:e.getRowCount(),columnCount:e.getColumnCount()}]),t}_calculateReferenceObject(e,t,r){const{startRow:n,endRow:s,startColumn:a,endColumn:u}=e.getRangePosition();let c=0,l=0,f=0,m=0;if(t===0?(c=n,l=s):c=l=n+t-1,r===0?(f=a,m=u):f=m=a+r-1,c>s||f>u)return g.create(h.REF);const d={startRow:c,startColumn:f,endRow:l,endColumn:m};return this.createReferenceObject(e,d)}_calculateArrayObject(e,t,r){return!e.isArray()||t===0&&r===0?e:t===0?e.slice(void 0,[r-1,r]):r===0?e.slice([t-1,t],void 0):e.get(t-1,r-1)}}class v0 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}isAddress(){return!0}calculate(e,t){if(e.isError())return e;if(t!=null&&t.isError())return t;let r=this.getZeroOrOneByOneDefault(t);r==null&&(r=1);let n=e;if(e.isArray()){const s=e.getRowCount(),a=e.getColumnCount();if(s>1||a>1)return e.map(()=>g.create(h.VALUE));n=e.getFirstCell()}return this._handleSingleObject(n,r)}_handleSingleObject(e,t){const r=`${e.getValue()}`;if(r.trim()==="")return g.create(h.REF);const n=this._convertToDefinedName(r);if(t===0){const f=Uo(n),{range:m,sheetName:d,unitId:C}=f,_=new Lr(m);return _.setForcedUnitIdDirect(C),_.setForcedSheetName(d),this._setDefault(_)}if(jr(n))return this._setDefault(new ua(n));if(ki(n))return this._setDefault(new la(n));if($i(n))return this._setDefault(new ca(n));const s=Kt(n),{range:a,sheetName:u,unitId:c}=s;if(Number.isNaN(a.startRow)||a.endRow+1>1048576||Number.isNaN(a.startColumn)||a.endColumn+1>16384)return g.create(h.REF);const l=new Lr(a);return l.setForcedUnitIdDirect(c),l.setForcedSheetName(u),this._setDefault(l)}_setDefault(e){return this.unitId==null||this.subUnitId==null?g.create(h.REF):(e.setDefaultUnitId(this.unitId),e.setDefaultSheetId(this.subUnitId),e)}_convertToDefinedName(e){const t=this.getDefinedName(e);if(t==null)return e;const r=t.formulaOrRefString;return r==null?e:r.startsWith(Z.EQUALS)?r.slice(1):r}}class I0 extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3);A(this,"needsExpandParams",!0)}calculate(e,t,r){return e.isError()?e:t.isError()?g.create(h.REF):t.isArray()?r!=null&&r.isError()?r:t.getColumnCount()===1||t.getRowCount()===1?r!=null&&!r.isArray()?g.create(h.REF):this._handleVector(e,t,r):this._handleArray(e,t):g.create(h.VALUE)}_handleVector(e,t,r){let n=r;if(n==null)n=t;else if(n.getRowCount()!==t.getRowCount()||n.getColumnCount()!==t.getColumnCount())return g.create(h.REF);return e.isArray()?e.map(s=>this.binarySearch(s,t,n)):this.binarySearch(e,t,n)}_handleArray(e,t){const r=t.getRowCount(),n=t.getColumnCount();let s,a;return n>r?(s=t.slice([0,1]),a=t.slice([r-1,r])):(s=t.slice(void 0,[0,1]),a=t.slice(void 0,[n-1,n])),s==null||a==null?g.create(h.VALUE):e.isArray()?e.map(u=>this.binarySearch(u,s,a)):this.binarySearch(e,s,a)}}class F0 extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){if(e.isError())return e;if(t.isError())return g.create(h.REF);if(!t.isArray())return g.create(h.VALUE);const n=t.getRowCount(),s=t.getColumnCount();if(n!==1&&s!==1||r!=null&&r.isError())return g.create(h.NA);const a=this.getMatchTypeValue(r);return a==null?g.create(h.VALUE):e.isArray()?e.map(u=>this._handleSingleObject(u,t,a)):this._handleSingleObject(e,t,a)}_handleSingleObject(e,t,r){const n=e.isNull()?y.create(0):e,s=this._getSearchModeValue(r),a=t.orderSearch(n,s);if(a==null)return g.create(h.NA);if(a instanceof g)return a;const u=t.getRowCount()===1?a.column+1:a.row+1;return y.create(u)}_getSearchModeValue(e){switch(e){case 1:return De.MIN;case 0:return De.NORMAL;case-1:return De.MAX}}}class B0 extends rr{constructor(e,t=[]){super(e);A(this,"_areas",[]);this._areas=t}dispose(){this._areas.forEach(e=>{e.forEach(t=>t.dispose())}),this._areas=[],super.dispose()}getAreas(){return this._areas}setAreas(e){this._areas=e}addArea(e){Array.isArray(e)?this._areas.push(e):this._areas.push([e])}_flatAreas(){return this._areas.flat()}isMultiArea(){return!0}isRange(){return!1}isCell(){return!1}isRow(){return!1}isColumn(){return!1}getRowCount(){let e=0;for(const t of this._flatAreas())t.isError()||(e+=t.getRowCount());return e}getColumnCount(){let e=0;for(const t of this._flatAreas())t.isError()||(e+=t.getColumnCount());return e}isExceedRange(){return this._flatAreas().some(e=>e.isError()?!1:e.isExceedRange())}setRefOffset(e=0,t=0){super.setRefOffset(e,t),this._flatAreas().forEach(r=>{r.isError()||r.setRefOffset(e,t)})}_getReferenceArea(){return this._flatAreas().find(r=>!r.isError())}getUnitId(){var e,t;return(t=(e=this._getReferenceArea())==null?void 0:e.getUnitId())!=null?t:super.getUnitId()}getSheetId(){var e,t;return(t=(e=this._getReferenceArea())==null?void 0:e.getSheetId())!=null?t:super.getSheetId()}getActiveSheetRowCount(){var e,t;return(t=(e=this._getReferenceArea())==null?void 0:e.getActiveSheetRowCount())!=null?t:0}getActiveSheetColumnCount(){var e,t;return(t=(e=this._getReferenceArea())==null?void 0:e.getActiveSheetColumnCount())!=null?t:0}iterator(e){for(const t of this._areas){let r=!1;for(const n of t){if(n.isError())continue;let s=!1;if(n.iterator((a,u,c)=>{const l=e(a,u,c);return l===!1?(s=!0,r=!0,!1):l}),s)break}if(r)return}}getFirstCell(){const e=this._getReferenceArea();return e?e.getFirstCell():super.getFirstCell()}toArrayValueObject(){var n,s;const e=this._areas.length;if(e===0)return at([],0,0);const t=(s=(n=this._areas[0])==null?void 0:n.length)!=null?s:0,r=[];for(let a=0;a<e;a++){const u=this._areas[a];if(u){r[a]=r[a]||[];for(let c=0;c<t;c++){const l=u[c];if(!l)continue;if(l.isError()){r[a][c]=l;continue}let f=null;l.iterator(m=>(f=m!=null?m:null,!1)),f!=null&&(r[a][c]=f),r[a][c]=ce.create()}}}return at(r,e,t)}getRangePosition(){const e=this._flatAreas();if(!e.length)return super.getRangePosition();let t=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,s=Number.NEGATIVE_INFINITY;for(const a of e){if(a.isError())continue;const{startRow:u,startColumn:c,endRow:l,endColumn:f}=a.getRangePosition();!Number.isFinite(u)||!Number.isFinite(c)||!Number.isFinite(l)||!Number.isFinite(f)||(u<t&&(t=u),c<r&&(r=c),l>n&&(n=l),f>s&&(s=s<f?f:s))}return!Number.isFinite(t)||!Number.isFinite(r)||!Number.isFinite(n)||!Number.isFinite(s)?super.getRangePosition():{startRow:t,startColumn:r,endRow:n,endColumn:s}}toUnitRange(){return{range:this.getRangePosition(),sheetId:this.getSheetId(),unitId:this.getUnitId()}}getRangeData(){const e=this._flatAreas();if(!e.length)return super.getRangeData();let t=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,s=Number.NEGATIVE_INFINITY;for(const a of e){if(a.isError())continue;const{startRow:u,startColumn:c,endRow:l,endColumn:f}=a.getRangeData();!Number.isFinite(u)||!Number.isFinite(c)||!Number.isFinite(l)||!Number.isFinite(f)||(u<t&&(t=u),c<r&&(r=c),l>n&&(n=l),f>s&&(s=f))}return!Number.isFinite(t)||!Number.isFinite(r)||!Number.isFinite(n)||!Number.isFinite(s)?super.getRangeData():{startRow:t,startColumn:r,endRow:n,endColumn:s}}}class k0 extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",5);A(this,"needsReferenceObject",!0)}isAddress(){return!0}calculate(e,t,r,n,s){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(n!=null&&n.isError())return n;if(s!=null&&s.isError())return s;if(!e.isReferenceObject())return g.create(h.VALUE);const a=e.getRowCount(),u=e.getColumnCount();let c=t;c.isReferenceObject()&&(c=c.toArrayValueObject());let l=r;l.isReferenceObject()&&(l=l.toArrayValueObject());let f=n!=null?n:y.create(a);f.isReferenceObject()&&(f=f.toArrayValueObject()),f.isNull()&&(f=y.create(a));let m=s!=null?s:y.create(u);m.isReferenceObject()&&(m=m.toArrayValueObject()),m.isNull()&&(m=y.create(u));const d=Math.max(c.isArray()?c.getRowCount():1,l.isArray()?l.getRowCount():1,f.isArray()?f.getRowCount():1,m.isArray()?m.getRowCount():1),C=Math.max(c.isArray()?c.getColumnCount():1,l.isArray()?l.getColumnCount():1,f.isArray()?f.getColumnCount():1,m.isArray()?m.getColumnCount():1);if(c=c,l=l,f=f,m=m,d===1&&C===1)return c=c.isArray()?c.get(0,0):c,l=l.isArray()?l.get(0,0):l,f=f.isArray()?f.get(0,0):f,m=m.isArray()?m.get(0,0):m,this._handleSingleObject(e,c,l,f,m);const _=O(d,C,c,g.create(h.NA)),E=O(d,C,l,g.create(h.NA)),R=O(d,C,f,g.create(h.NA)),b=O(d,C,m,g.create(h.NA)),p=[];return _.iterator((V,S,D)=>{const w=E.get(S,D),L=R.get(S,D),P=b.get(S,D);if(p[S]=p[S]||[],V==null){p[S][D]=g.create(h.NA);return}if(V.isError()){p[S][D]=V;return}if(w.isError()){p[S][D]=w;return}if(L.isError()){p[S][D]=L;return}if(P.isError()){p[S][D]=P;return}const v=this._handleSingleObject(e,V,w,L,P);p[S][D]=v}),new B0("",p)}_handleSingleObject(e,t,r,n,s){const{startRow:a,startColumn:u}=e.getRangePosition();let c=t;if(c.isString()&&(c=c.convertToNumberObjectValue()),c.isError())return c;let l=r;if(l.isString()&&(l=l.convertToNumberObjectValue()),l.isError())return l;const f=+c.getValue(),m=+l.getValue();if(typeof f!="number"||typeof m!="number")return g.create(h.VALUE);const d=a+f,C=u+m;if(d<0||C<0)return g.create(h.REF);const _=this.getIndexNumValue(n),E=this.getIndexNumValue(s);if(typeof _!="number"||typeof E!="number")return g.create(h.VALUE);if(_===0||E===0)return g.create(h.REF);const R=_>0?d+_-1:d+_+1,b=E>0?C+E-1:C+E+1;if(R<0||b<0)return g.create(h.REF);const p=d<R?d:R,V=C<b?C:b,S=d>R?d:R,D=C>b?C:b,w={startRow:p,startColumn:V,endRow:S,endColumn:D};return this.createReferenceObject(e,w)}}class $0 extends N{constructor(){super(...arguments);A(this,"minParams",0);A(this,"maxParams",1)}calculate(e){if(e==null)return y.create(this.row+1);if(e.isError())return e;if(!e.isArray())return g.create(h.NA);const t=e.getCurrentRow(),r=e.getRowCount(),n=[];for(let a=0;a<r;a++)n.push([y.create(t+a+1)]);const s={calculateValueList:n,rowCount:r,columnCount:1,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return K.create(s)}}class Y0 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isError())return e;if(e.isString()||e.isNumber()||e.isBoolean())return y.create(1);if(!e.isArray())return g.create(h.NA);const t=e.getRowCount();return y.create(t)}}class H0 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",4)}calculate(e,t,r,n){let s=t!=null?t:y.create(1);const a=r!=null?r:y.create(1),u=n!=null?n:I.create(!1);if(s.isNull()&&(s=y.create(1)),u.isArray()){const c=u.getRowCount(),l=u.getColumnCount();if(c===1&&l===1){const f=u.get(0,0);return this._handleSingleObject(e,s,a,f)}return u.map(f=>{const m=this._handleSingleObject(e,s,a,f);return m.isArray()?m.get(0,0):m})}return this._handleSingleObject(e,s,a,u)}_handleSingleObject(e,t,r,n){if(e.isError())return e;const s=e.isArray()?e.getRowCount():1,a=e.isArray()?e.getColumnCount():1,u=this._checkArrayError(t);if(u.isError())return u;const c=Math.floor(+u.getValue());if(c<1)return g.create(h.VALUE);const l=this._checkArrayError(r);if(l.isError())return l;const f=Math.floor(+l.getValue());if(f!==-1&&f!==1)return g.create(h.VALUE);let m=n;if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;if(!e.isArray()||s===1&&a===1)return e;const d=+m.getValue();return this._getResult(e,c,f,d,s,a)}_checkArrayError(e){let t=e;if(t.isArray()){const r=t.getRowCount(),n=t.getColumnCount();if(r>1||n>1)return g.create(h.VALUE);t=t.get(0,0)}return t.isString()&&(t=t.convertToNumberObjectValue()),t}_getResult(e,t,r,n,s,a){if(n){if(t>s)return g.create(h.VALUE);const u=e.transpose().getArrayValue();return u.sort(this._sort(t-1,r)),K.create({calculateValueList:u,rowCount:u.length,columnCount:u[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column}).transpose()}else{if(t>a)return g.create(h.VALUE);const u=e.getArrayValue();return u.sort(this._sort(t-1,r)),K.create({calculateValueList:u,rowCount:u.length,columnCount:u[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}_sort(e,t=1){const r=An();return t===1?this._sortAsc(e,r):this._sortDesc(e,r)}_sortAsc(e,t){return(r,n)=>{const s=r[e],a=n[e];if(s==null||s.isNull())return 1;if(a==null||a.isNull())return-1;if(s.isError()&&a.isError())return 0;if(s.isError())return 1;if(a.isError())return-1;const u=s.getValue(),c=a.getValue();return s.isBoolean()&&u===!0?1:a.isBoolean()&&c===!0?-1:s.isBoolean()&&u===!1?1:a.isBoolean()&&c===!1?-1:s.isNumber()&&a.isNumber()?+u-+c:t(u,c)}}_sortDesc(e,t){return(r,n)=>{const s=r[e],a=n[e];if(s==null||s.isNull())return 1;if(a==null||a.isNull())return-1;if(s.isError()&&a.isError())return 0;if(s.isError())return-1;if(a.isError())return 1;const u=s.getValue(),c=a.getValue();return s.isBoolean()&&u===!0?-1:a.isBoolean()&&c===!0?1:s.isBoolean()&&u===!1?-1:a.isBoolean()&&c===!1?1:s.isNumber()&&a.isNumber()?+c-+u:t(c,u)}}}class G0 extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",255)}calculate(e,...t){t.length===1&&t.push(y.create(1));const r=this._getVariantsError(e,...t),{maxRowLength:n,maxColumnLength:s}=Jf(t);if(r.isError()){const c=O(n,s,r);return n===1&&s===1?c.get(0,0):c}const a=t.map((c,l)=>l%2===0?c:O(n,s,c,g.create(h.NA))),u=this._getResultArray(e,a,n,s);return n===1&&s===1?u[0][0]:K.create({calculateValueList:u,rowCount:u.length,columnCount:u[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}_getVariantsError(e,...t){if(e.isError())return e;for(let u=0;u<t.length;u++){const c=t[u];if(c.isError())return c}if(t.length<2||t.length%2!==0)return g.create(h.VALUE);const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t[0].isArray()?t[0].getRowCount():1,a=t[0].isArray()?t[0].getColumnCount():1;if((s>1||a>1)&&(s>1&&a>1||s===1&&a!==n||a===1&&s!==r))return g.create(h.VALUE);for(let u=2;u<t.length;u++){if(u%2===1)continue;const c=t[u].isArray()?t[u].getRowCount():1,l=t[u].isArray()?t[u].getColumnCount():1;if(c!==s||l!==a)return g.create(h.VALUE)}return I.create(!0)}_getResultArray(e,t,r,n){const s=e.isArray()?e.getRowCount():1,a=e.isArray()?e.getColumnCount():1,u=t[0].isArray()?t[0].getRowCount():1,c=t[0].isArray()?t[0].getColumnCount():1,l=[];for(let f=0;f<r;f++){l[f]=[];for(let m=0;m<n;m++){const{isError:d,errorObject:C,byArrays:_,sortOrders:E}=this._getByArraysAndSortOrders(t,f,m,c);if(d){l[f].push(C);continue}if(!e.isArray()||s===1&&a===1){l[f].push(e);continue}let R=e.getArrayValue();u===1&&c===1||(u===1?(R=R.concat(_),R=this._transposeArray(R),R.sort(this._sort(s,E)),R=this._transposeArray(R).slice(0,s)):c===1&&(R=this._transposeArray(R),R=R.concat(_),R=this._transposeArray(R),R.sort(this._sort(a,E)),R=R.map(p=>p.slice(0,a))));const b=K.create({calculateValueList:R,rowCount:R.length,columnCount:R[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column});if(r>1||n>1){l[f].push(b.get(0,0));continue}l[f].push(b)}}return l}_getByArraysAndSortOrders(e,t,r,n){const s=[],a=[];let u=!1,c=null;for(let l=0;l<e.length;l++){if(l%2===1)continue;const f=e[l];let m=e[l+1].get(t,r);if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError()){u=!0,c=m;break}const d=Math.floor(+m.getValue());if(d!==-1&&d!==1){u=!0,c=g.create(h.VALUE);break}if(a.push(d),f.isArray()){let C=f.getArrayValue();n===1&&(C=this._transposeArray(C)),s.push(C[0])}else s.push([f])}return{isError:u,errorObject:c,byArrays:s,sortOrders:a}}_transposeArray(e){const t=e.length,r=e[0].length,n=[];for(let s=0;s<r;s++){n[s]=[];for(let a=0;a<t;a++)n[s][a]=e[a][s]}return n}_sort(e,t){const r=An();return(n,s)=>{let a=n[e],u=s[e],c=this._compare(a,u,t[0],r);if(c===0&&t.length>1){for(let l=1;l<t.length;l++)if(a=n[e+l],u=s[e+l],c=this._compare(a,u,t[l],r),c!==0)return c}return c}}_compare(e,t,r,n){return r===1?this._asc(e,t,n):this._desc(e,t,n)}_asc(e,t,r){if(e==null||e.isNull())return 1;if(t==null||t.isNull())return-1;if(e.isError()&&t.isError())return 0;if(e.isError())return 1;if(t.isError())return-1;const n=e.getValue(),s=t.getValue();return e.isBoolean()&&n===!0?1:t.isBoolean()&&s===!0?-1:e.isBoolean()&&n===!1?1:t.isBoolean()&&s===!1?-1:e.isNumber()&&t.isNumber()?+n-+s:r(n,s)}_desc(e,t,r){if(e==null||e.isNull())return 1;if(t==null||t.isNull())return-1;if(e.isError()&&t.isError())return 0;if(e.isError())return-1;if(t.isError())return 1;const n=e.getValue(),s=t.getValue();return e.isBoolean()&&n===!0?-1:t.isBoolean()&&s===!0?1:e.isBoolean()&&n===!1?-1:t.isBoolean()&&s===!1?1:e.isNumber()&&t.isNumber()?+s-+n:r(s,n)}}class W0 extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){const n=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1;let a=t,u=r!=null?r:y.create(s);t.isNull()&&(a=y.create(n)),u.isNull()&&(u=y.create(s));const c=Math.max(a.isArray()?a.getRowCount():1,u.isArray()?u.getRowCount():1),l=Math.max(a.isArray()?a.getColumnCount():1,u.isArray()?u.getColumnCount():1),f=O(c,l,a,g.create(h.NA)),m=O(c,l,u,g.create(h.NA));if(c>1||l>1)return f.mapValue((p,V,S)=>{const D=m.get(V,S);if(e.isError())return e;if(e.isNull())return g.create(h.VALUE);const{isError:w,errorObject:L}=this._checkRowsColumns(p,D,n,s);return w?L:e.isArray()?g.create(h.VALUE):e});if(e.isError())return e;if(e.isNull())return g.create(h.VALUE);const d=a.isArray()?a.get(0,0):a,C=u.isArray()?u.get(0,0):u,{isError:_,errorObject:E,rowsValue:R,columnsValue:b}=this._checkRowsColumns(d,C,n,s);return _?E:this._getResultArray(e,R,b,n,s)}_checkRowsColumns(e,t,r,n){if(e.isError())return{isError:!0,errorObject:e};if(t.isError())return{isError:!0,errorObject:t};let s=Math.trunc(+e.getValue()),a=Math.trunc(+t.getValue());return Number.isNaN(s)||Number.isNaN(a)?{isError:!0,errorObject:g.create(h.VALUE)}:Math.abs(s)===0||Math.abs(a)===0?{isError:!0,errorObject:g.create(h.CALC)}:(s>r&&(s=r),a>n&&(a=n),{isError:!1,rowsValue:s,columnsValue:a})}_getResultArray(e,t,r,n,s){if(!e.isArray())return e;const a=t>=0?[0,t]:[n+t,n],u=r>=0?[0,r]:[s+r,s];let c;return t===n&&r===s?c=e:t===n?c=e.slice(void 0,u):r===s?c=e.slice(a,void 0):c=e.slice(a,u),c=c.map(l=>l.isNull()?y.create(0):l),t===1&&r===1?c.get(0,0):c}}class Q0 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",3)}calculate(e,t,r){const n=t!=null?t:y.create(0),s=r!=null?r:I.create(!1),a=Math.max(n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1),u=Math.max(n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1),c=O(a,u,n,g.create(h.NA)),l=O(a,u,s,g.create(h.NA)),f=c.mapValue((m,d,C)=>{const _=l.get(d,C);if(e.isError())return e;if(e.isNull())return g.create(h.VALUE);if(m.isError())return m;if(_.isError())return _;const E=Math.trunc(+m.getValue()),R=+_.getValue();if(Number.isNaN(E)||E<0||E>3||Number.isNaN(R))return g.create(h.VALUE);if(!e.isArray())return e;let b=[];return R?b=this._getArrayValueByColumn(e,E):b=this._getArrayValueByRow(e,E),b.length===0?g.create(h.CALC):a>1||u>1||b.length===1?b[0]:K.create({calculateValueList:b.map(p=>[p]),rowCount:b.length,columnCount:1,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})});return a===1&&u===1?f.get(0,0):f}_getArrayValueByColumn(e,t){const r=e,n=r.getRowCount(),s=r.getColumnCount(),a=[];for(let u=0;u<s;u++)for(let c=0;c<n;c++){const l=r.get(c,u);this._isIgnore(l,t)||a.push(l.isNull()?y.create(0):l)}return a}_getArrayValueByRow(e,t){const r=e,n=r.getRowCount(),s=r.getColumnCount(),a=[];for(let u=0;u<n;u++)for(let c=0;c<s;c++){const l=r.get(u,c);this._isIgnore(l,t)||a.push(l.isNull()?y.create(0):l)}return a}_isIgnore(e,t){switch(t){case 0:return!1;case 1:return e.isNull();case 2:return e.isError();case 3:return e.isNull()||e.isError();default:return!1}}}class q0 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",3)}calculate(e,t,r){const n=t!=null?t:y.create(0),s=r!=null?r:I.create(!1),a=Math.max(n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1),u=Math.max(n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1),c=O(a,u,n,g.create(h.NA)),l=O(a,u,s,g.create(h.NA)),f=c.mapValue((m,d,C)=>{const _=l.get(d,C);if(e.isError())return e;if(m.isError())return m;if(_.isError())return _;const E=Math.trunc(+m.getValue()),R=+_.getValue();if(Number.isNaN(E)||E<0||E>3||Number.isNaN(R)||e.isNull())return g.create(h.VALUE);if(!e.isArray())return e;let b=[];return R?b=this._getArrayValueByColumn(e,E):b=this._getArrayValueByRow(e,E),b.length===0?g.create(h.CALC):a>1||u>1||b.length===1?b[0]:K.create({calculateValueList:[b],rowCount:1,columnCount:b.length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})});return a===1&&u===1?f.get(0,0):f}_getArrayValueByColumn(e,t){const r=e,n=r.getRowCount(),s=r.getColumnCount(),a=[];for(let u=0;u<s;u++)for(let c=0;c<n;c++){const l=r.get(c,u);this._isIgnore(l,t)||a.push(l.isNull()?y.create(0):l)}return a}_getArrayValueByRow(e,t){const r=e,n=r.getRowCount(),s=r.getColumnCount(),a=[];for(let u=0;u<n;u++)for(let c=0;c<s;c++){const l=r.get(u,c);this._isIgnore(l,t)||a.push(l.isNull()?y.create(0):l)}return a}_isIgnore(e,t){switch(t){case 0:return!1;case 1:return e.isNull();case 2:return e.isError();case 3:return e.isNull()||e.isError();default:return!1}}}class X0 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isError())return e;if(e.isArray()){const t=e.getRowCount(),r=e.getColumnCount();return t===1&&r===1?e.get(0,0):e.transpose()}return e}}class K0 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",3)}calculate(e,t,r){const n=t!=null?t:I.create(!1),s=r!=null?r:I.create(!1),a=e.isArray()?e.getRowCount():1,u=e.isArray()?e.getColumnCount():1,c=Math.max(n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1),l=Math.max(n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1),f=O(c,l,n,g.create(h.NA)),m=O(c,l,s,g.create(h.NA)),d=f.map((C,_,E)=>{let R=C,b=m.get(_,E);if(e.isError())return e;if(R.isString()&&(R=R.convertToNumberObjectValue()),R.isError())return R;if(b.isString()&&(b=b.convertToNumberObjectValue()),b.isError())return b;const p=+R.getValue(),V=+b.getValue();let S;return!p&&a===1||p&&u===1?S=e:S=this._getResult(e,p,V),(c>1||l>1)&&(S!=null&&S.isArray())?S.get(0,0):S});return c===1&&l===1?d.get(0,0):d}_getResult(e,t,r){const n=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1;let a=e.getArrayValue(),u=n,c=s;t&&(a=this._transposeArray(a),u=s,c=n);const l=this._getRepeatRows(a,u,c);if(l.length>0){const f=[];l.forEach(m=>{m.forEach((d,C)=>{(C!==0||r)&&f.push(d)})}),a=a.filter((m,d)=>!f.includes(d))}return a.length===0?g.create(h.CALC):(t&&(a=this._transposeArray(a)),K.create({calculateValueList:a,rowCount:a.length,columnCount:a[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column}))}_getRepeatRows(e,t,r){let n=[];for(let s=0;s<r;s++)if(s===0){const a=new Array(t).fill(null).map((u,c)=>({r:c,valueObject:e[c][s]}));n=this._getRepeatRowsByObjects(a)}else{if(n.length===0)break;let a=[];n.forEach(u=>{const c=u.map(f=>({r:f,valueObject:e[f][s]})),l=this._getRepeatRowsByObjects(c);a=a.concat(l)}),n=a}return n}_getRepeatRowsByObjects(e){const t=new Map;return e.forEach(r=>{const n=r.r,s=r.valueObject;let a=s.getValue();if(s.isNull()?a=null:s.isString()&&M.isRealNum(a)&&(a=+a),!t.has(a))t.set(a,[n]);else{const u=t.get(a);u.push(n),t.set(a,u)}}),Array.from(t.values()).filter(r=>r.length>1)}_transposeArray(e){const t=e.length,r=e[0].length,n=[];for(let s=0;s<r;s++){n[s]=[];for(let a=0;a<t;a++)n[s][a]=e[a][s]}return n}}class Z0 extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",4)}calculate(e,t,r,n){if(e.isError())return e;if(t.isError())return t;if(!t.isArray())return g.create(h.VALUE);if(r.isError())return r;if(n!=null&&n.isError())return n;const s=n!=null?n:I.create(!0);return mi(e)&&mi(s)&&r.isArray()?this._handleArrayColIndexNum(e,t,r,s):this._handleNonArrayColIndexNum(e,t,r,s)}_handleArrayColIndexNum(e,t,r,n){const s=e.isArray()?e.getFirstCell():e,a=this.getZeroOrOneByOneDefault(n);if(a==null)return g.create(h.VALUE);let u;const c=[];return r.iterator((l,f,m)=>{if(l==null)return u=g.create(h.VALUE),!1;const d=this._handleTableArray(s,t,l,a);if(d.isError())return u=d,!1;c[f]===void 0&&(c[f]=[]),c[f][m]=d}),u||at(c,c.length,c[0].length,this.unitId||"",this.subUnitId||"")}_handleNonArrayColIndexNum(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=O(s,a,e),c=O(s,a,n);return u.map((l,f,m)=>{if(l.isError())return l;const d=c.get(f,m);if(d==null)return g.create(h.VALUE);if(d.isError())return d;const C=this.getZeroOrOneByOneDefault(d);return C==null?g.create(h.VALUE):this._handleTableArray(l,t,r,C)})}_handleTableArray(e,t,r,n){let s=this.getIndexNumValue(r);if(s instanceof g)return s;if(s=Math.floor(s),s<1)return g.create(h.VALUE);const a=t.slice(void 0,[0,1]);if(a==null)return g.create(h.VALUE);const u=t.slice(void 0,[s-1,s]);return u==null?g.create(h.REF):this._handleSingleObject(e,a,u,n)}_handleSingleObject(e,t,r,n){return n===0?this.equalSearch(e,t,r):this.binarySearch(e,t,r)}}class z0 extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=Math.max(...e.map(n=>n.isArray()?n.getColumnCount():1)),r=[];for(let n=0;n<e.length;n++){const s=e[n];if(s.isError())return s;const a=s.isArray()?s.getRowCount():1,u=s.isArray()?s.getColumnCount():1;for(let c=0;c<a;c++){const l=[];for(let f=0;f<t;f++){let m=s;s.isArray()&&(m=s.get(c,f)),f>u-1||!m?l.push(g.create(h.NA)):l.push(m)}r.push(l)}}return K.create({calculateValueList:r,rowCount:r.length,columnCount:r[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}class J0 extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){let n=r!=null?r:g.create(h.NA);n.isNull()&&(n=g.create(h.NA));const s=e.isArray()?e.getRowCount():1,a=e.isArray()?e.getColumnCount():1,u=Math.max(t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),c=Math.max(t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),l=O(u,c,t,g.create(h.NA)),f=O(u,c,n,g.create(h.NA)),m=l.mapValue((d,C,_)=>{const E=f.get(C,_);if(e.isError())return e;if(e.isNull())return g.create(h.VALUE);if(d.isError())return d;const R=Math.trunc(+d.getValue());if(s>1&&a>1||Number.isNaN(R))return g.create(h.VALUE);if(R<1)return g.create(h.NUM);const b=e.isArray()?e.getArrayValue().flat():[e],p=this._getWrapArray(b,R,E);return u>1||c>1||p.length===1&&p[0].length===1?p[0][0]:K.create({calculateValueList:p,rowCount:p.length,columnCount:p[0].length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})});return u===1&&c===1?m.get(0,0):m}_getWrapArray(e,t,r){const n=Math.ceil(e.length/t),s=n>1?t:e.length,a=[];for(let u=0;u<n;u++)for(let c=0;c<s;c++){a[c]||(a[c]=[]);const l=u*s+c;l<e.length?a[c].push(e[l].isNull()?y.create(0):e[l]):a[c].push(r)}return a}}class eC extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){let n=r!=null?r:g.create(h.NA);n.isNull()&&(n=g.create(h.NA));const s=e.isArray()?e.getRowCount():1,a=e.isArray()?e.getColumnCount():1,u=Math.max(t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),c=Math.max(t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),l=O(u,c,t,g.create(h.NA)),f=O(u,c,n,g.create(h.NA)),m=l.mapValue((d,C,_)=>{const E=f.get(C,_);if(e.isError())return e;if(e.isNull())return g.create(h.VALUE);if(d.isError())return d;const R=Math.trunc(+d.getValue());if(s>1&&a>1||Number.isNaN(R))return g.create(h.VALUE);if(R<1)return g.create(h.NUM);const b=e.isArray()?e.getArrayValue().flat():[e],p=this._getWrapArray(b,R,E);return u>1||c>1||p.length===1&&p[0].length===1?p[0][0]:K.create({calculateValueList:p,rowCount:p.length,columnCount:p[0].length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})});return u===1&&c===1?m.get(0,0):m}_getWrapArray(e,t,r){const n=Math.ceil(e.length/t),s=n>1?t:e.length,a=[];for(let u=0;u<n;u++){const c=[];for(let l=0;l<s;l++){const f=u*s+l;f<e.length?c.push(e[f].isNull()?y.create(0):e[f]):c.push(r)}a.push(c)}return a}}class tC extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",6)}calculate(e,t,r,n,s,a){let u=n!=null?n:g.create(h.NA);n!=null&&n.isNull()&&(u=g.create(h.NA));let c=s!=null?s:y.create(0);s!=null&&s.isNull()&&(c=y.create(0));let l=a!=null?a:y.create(1);if(a!=null&&a.isNull()&&(l=y.create(1)),e.isError())return e;const f=t.isArray()?t.getRowCount():1,m=t.isArray()?t.getColumnCount():1,d=r.isArray()?r.getRowCount():1,C=r.isArray()?r.getColumnCount():1;if(f!==1&&m!==1||f===1&&m>1&&m!==C||m===1&&f>1&&f!==d)return g.create(h.VALUE);if(c.isError())return c;if(l.isError())return l;const _=this.getIndexNumValue(c);if(_ instanceof g)return _;const E=this.getIndexNumValue(l);return E instanceof g?E:this._getResult(e,Bs(t),Bs(r),u,_,E,f,m,d,C)}_getResult(e,t,r,n,s,a,u,c,l,f){const m=e.isArray()?e.getRowCount():1,d=e.isArray()?e.getColumnCount():1;if(m>1||d>1){let R;return u===1?R=r.slice([0,1]):R=r.slice(void 0,[0,1]),R==null?g.create(h.NA):e.map(b=>{const p=this._checkErrorCombination(s,a);if(p)return p;const V=this._handleSingleObject(b,t,R,s,a);return V.isError()?n:V})}const C=e.isArray()?e.get(0,0):e;if(c===f&&u===l){const R=this._checkErrorCombination(s,a);if(R)return R;const b=this._handleSingleObject(C,t,r,s,a);return b.isError()?n:b}let _=0;c===f&&(_=1);const E=this._handleExpandObject(C,t,r,s,a,_);return E==null?g.create(h.NA):E}_handleExpandObject(e,t,r,n,s,a=0){if((s===2||s===-2)&&n!==2){const u=Ls(s),c=ws(n);return this.binarySearchExpand(e,t,r,a,u,c)}return n===2?this.fuzzySearchExpand(e,t,r,s!==-1,a):n===-1||n===1?this.orderSearchExpand(e,t,r,n===1?De.MAX:De.MIN,s===-1,a):this.equalSearchExpand(e,t,r,s!==-1,a)}_handleSingleObject(e,t,r,n,s){if((s===2||s===-2)&&n!==2){const a=Ls(s),u=ws(n);return this.binarySearch(e,t,r,a,u)}return n===2?this.fuzzySearch(e,t,r,s!==-1):n===-1||n===1?this.orderSearch(e,t,r,n===1?De.MAX:De.MIN,s===-1):this.equalSearch(e,t,r,s!==-1)}_checkErrorCombination(e,t){return e===2&&(t===-2||t===2)?g.create(h.VALUE):null}}class rC extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",4)}calculate(e,t,r,n){let s=y.create(0);r&&!r.isNull()&&(s=r);let a=y.create(1);n&&!n.isNull()&&(a=n);const u=Math.max(e.isArray()?e.getRowCount():1,s.isArray()?s.getRowCount():1,a.isArray()?a.getRowCount():1),c=Math.max(e.isArray()?e.getColumnCount():1,s.isArray()?s.getColumnCount():1,a.isArray()?a.getColumnCount():1),l=O(u,c,e,g.create(h.NA)),f=O(u,c,s,g.create(h.NA)),m=O(u,c,a,g.create(h.NA)),d=l.mapValue((C,_,E)=>{if(C.isError())return C;const R=f.get(_,E),b=m.get(_,E);return R.isError()?R:b.isError()?b:this._handleSingleObject(C,t,R,b)});return u===1&&c===1?d.get(0,0):d}_handleSingleObject(e,t,r,n){const s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1;if(s!==1&&a!==1)return g.create(h.VALUE);let u=r;if((r.isString()||r.isBoolean()||r.isNull())&&(u=r.convertToNumberObjectValue()),u.isError())return u;let c=n;if((n.isString()||n.isBoolean()||n.isNull())&&(c=n.convertToNumberObjectValue()),c.isError())return c;const l=u.getValue(),f=c.getValue();return![-1,0,1,2].includes(l)||![-1,1,2].includes(f)?g.create(h.VALUE):this._getResult(e,t,l,f)}_getResult(e,t,r,n){const s=Bs(t);let a;if((n===2||n===-2)&&r!==2){const u=Ls(n),c=ws(r);a=s.binarySearch(e,u,c)}else if(r===2){const u=s.compare(e,Y.EQUALS);let c;if(n!==-1?c=u.getFirstTruePosition():c=u.getLastTruePosition(),c==null)return g.create(h.NA);a=s.getRowCount()===1?c.column:c.row}else if(r===-1||r===1){const u=s.orderSearch(e,r===1?De.MAX:De.MIN,n===-1);if(u==null)return g.create(h.NA);if(u instanceof g)return u;a=s.getRowCount()===1?u.column:u.row}else{const u=s.isEqual(e);let c;if(n!==-1?c=u.getFirstTruePosition():c=u.getLastTruePosition(),c==null)return g.create(h.NA);a=s.getRowCount()===1?c.column:c.row}return a==null?g.create(h.NA):y.create(a+1)}}const tc=[[R0,ne.ADDRESS],[y0,ne.AREAS],[p0,ne.CHOOSE],[N0,ne.CHOOSECOLS],[V0,ne.CHOOSEROWS],[O0,ne.COLUMN],[S0,ne.COLUMNS],[M0,ne.DROP],[D0,ne.EXPAND],[w0,ne.FILTER],[L0,ne.FORMULATEXT],[P0,ne.HLOOKUP],[x0,ne.HSTACK],[j0,ne.HYPERLINK],[U0,ne.IMAGE],[T0,ne.INDEX],[v0,ne.INDIRECT],[I0,ne.LOOKUP],[F0,ne.MATCH],[k0,ne.OFFSET],[$0,ne.ROW],[Y0,ne.ROWS],[H0,ne.SORT],[G0,ne.SORTBY],[W0,ne.TAKE],[Q0,ne.TOCOL],[q0,ne.TOROW],[X0,ne.TRANSPOSE],[K0,ne.UNIQUE],[Z0,ne.VLOOKUP],[z0,ne.VSTACK],[J0,ne.WRAPCOLS],[eC,ne.WRAPROWS],[tC,ne.XLOOKUP],[rC,ne.XMATCH]];class nC extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.abs()}}class sC extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.acos()}}class aC extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.acosh()}}class iC extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.isArray()?t.map(r=>r.isError()?r:Ni(r)):Ni(t)}}function Ni(i){let o=i.getValue();if(i.isBoolean()&&(o=o?1:0),!Number.isFinite(o))return g.create(h.VALUE);o=Number(o);let e=Math.atan(1/o);return o<0&&(e+=Math.PI),Number.isNaN(e)?g.create(h.VALUE):y.create(e)}class oC extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.isArray()?t.map(r=>r.isError()?r:Vi(r)):Vi(t)}}function Vi(i){let o=i.getValue();if(i.isBoolean()&&(o=o?1:0),!Number.isFinite(o))return g.create(h.VALUE);if(o=Number(o),Math.abs(o)<=1)return g.create(h.NUM);const e=1/2*Math.log((o+1)/(o-1));return Number.isNaN(e)?g.create(h.VALUE):y.create(e)}const uC={1:Ve.AVERAGE,2:Ve.COUNT,3:Ve.COUNTA,4:Ve.MAX,5:Ve.MIN,6:Ve.PRODUCT,7:Ve.STDEV_S,8:Ve.STDEV_P,9:Ve.SUM,10:Ve.VAR_S,11:Ve.VAR_P,12:Ve.MEDIAN,13:Ve.MODE_SNGL};class cC extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",255);A(this,"needsReferenceObject",!0);A(this,"needsFilteredOutRows",!0);A(this,"needsFormulaDataModel",!0)}calculate(e,t,...r){const{isError:n,multiAreaRefs:s,normalRefs:a}=Qo(r);let u;e.isReferenceObject()?u=e.toArrayValueObject():u=e;let c;t.isReferenceObject()?c=t.toArrayValueObject():c=t;const l=Math.max(u.isArray()?u.getRowCount():1,c.isArray()?c.getRowCount():1),f=Math.max(u.isArray()?u.getColumnCount():1,c.isArray()?c.getColumnCount():1),m=O(l,f,u,g.create(h.NA)),d=O(l,f,c,g.create(h.NA)),C=m.mapValue((_,E,R)=>{if(_.isError())return _;const b=d.get(E,R);return b.isError()?b:s.length>0?g.create(h.VALUE):this._handleSingleObject(_,b,r,n,a)});return C.getRowCount()===1&&C.getColumnCount()===1?C.get(0,0):C}_handleSingleObject(e,t,r,n,s){let a=e;if(e.isString()&&(a=e.convertToNumberObjectValue()),a.isError())return a;const u=Math.floor(+a.getValue());if(u<1||u>19||u>=1&&u<=13&&n||u>=14&&u<=19&&r.length!==2)return g.create(h.VALUE);let c=t;if(t.isString()&&(c=t.convertToNumberObjectValue()),c.isError())return c;const l=Math.floor(+c.getValue());if(l<0||l>7)return g.create(h.VALUE);const f=this._getAggregateOptions(l);return u>=14&&u<=19?this._handleLargeSmallPercentileQuartile(u,f,r[0],r[1]):Zo({type:uC[u],...f,formulaDataModel:this._formulaDataModel},s)}_getAggregateOptions(e){switch(e){case 1:return{ignoreRowHidden:!0,ignoreErrorValues:!1,ignoreNested:!0};case 2:return{ignoreRowHidden:!1,ignoreErrorValues:!0,ignoreNested:!0};case 3:return{ignoreRowHidden:!0,ignoreErrorValues:!0,ignoreNested:!0};case 4:return{ignoreRowHidden:!1,ignoreErrorValues:!1,ignoreNested:!1};case 5:return{ignoreRowHidden:!0,ignoreErrorValues:!1,ignoreNested:!1};case 6:return{ignoreRowHidden:!1,ignoreErrorValues:!0,ignoreNested:!1};case 7:return{ignoreRowHidden:!0,ignoreErrorValues:!0,ignoreNested:!1};case 0:default:return{ignoreRowHidden:!1,ignoreErrorValues:!1,ignoreNested:!0}}}_handleLargeSmallPercentileQuartile(e,t,r,n){let s;if(n.isReferenceObject()?s=n.toArrayValueObject():s=n,s.isError())return s;if(s.isArray()){const c=s.getRowCount(),l=s.getColumnCount();if(c>1||l>1)return g.create(h.VALUE);s=s.get(0,0)}const a=nr(r,t,this._formulaDataModel);if(!Array.isArray(a))return a;const u=+s.getValue();switch(e){case 14:return Jo(a,u);case 15:return eu(a,u);case 16:return tu(a,u);case 17:return nu(a,u);case 18:return ru(a,u);case 19:return su(a,u);default:return g.create(h.VALUE)}}}class lC extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return y.create(0);if(e.isBoolean()||e.isNumber())return g.create(h.VALUE);let t=e.getValue().toLocaleString().toLocaleUpperCase();if(t.length>255)return g.create(h.VALUE);const r=t.startsWith("-");r&&(t=t.slice(1));let n=0;for(let s=0;s<t.length;s++){const a=Zr.get(t[s])||0,u=Zr.get(t[s+1])||0,c=Zr.get(t[s+2])||0,l=Zr.get(t[s+3])||0;if(!a||c>=u&&c>a||a===u&&a===c&&a===l||a===u/2)return g.create(h.VALUE);a<u?n-=a:n+=a}return y.create(r?-n:n)}}class fC extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.asin()}}class mC extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.asinh()}}class hC extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.atan()}}class gC extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){let r=e,n=t;return r.isString()&&(r=r.convertToNumberObjectValue()),r.isError()?r:(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:n.atan2(r))}}class dC extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.atanh()}}class CC extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){const n=r!=null?r:y.create(0);if(e.isError())return e;if(t.isError())return t;if(n.isError())return n;const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,n,g.create(h.NA)),f=u.map((m,d,C)=>{const _=c.get(d,C),E=l.get(d,C);return this._handleSingleObject(m,_,E)});return f.getRowCount()===1&&f.getColumnCount()===1?f.getArrayValue()[0][0]:f}_handleSingleObject(e,t,r){let n=e;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let s=t;if(s.isString()&&(s=s.convertToNumberObjectValue()),s.isError())return s;let a=r;if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;const u=Math.floor(+n.getValue()),c=Math.floor(+s.getValue()),l=Math.floor(+a.getValue());if(u<0||u>=2**53||c<2||c>36||l<0)return g.create(h.NUM);let f=u.toString(c);return f.length<l&&(f=new Array(l-f.length+1).join("0")+f),T.create(f.toLocaleUpperCase())}}class _C extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.map((c,l,f)=>{let m=c,d=a.get(l,f);if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;if(d.isString()&&(d=d.convertToNumberObjectValue()),d.isError())return d;const C=+m.getValue(),_=+d.getValue();if(C>0&&_<0)return g.create(h.NUM);if(C===0||_===0)return y.create(0);const E=ke(C/_,0)*_;return y.create(E)});return u.getRowCount()===1&&u.getColumnCount()===1?u.getArrayValue()[0][0]:u}}class AC extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",3)}calculate(e,t,r){const n=t!=null?t:y.create(1),s=r!=null?r:y.create(0);if(e.isError())return e;if(n.isError())return n;if(s.isError())return s;const a=Math.max(e.isArray()?e.getRowCount():1,n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1),c=O(a,u,e,g.create(h.NA)),l=O(a,u,n,g.create(h.NA)),f=O(a,u,s,g.create(h.NA)),m=c.map((d,C,_)=>{let E=d,R=l.get(C,_),b=f.get(C,_);if(E.isString()&&(E=E.convertToNumberObjectValue()),E.isError())return E;if(R.isString()&&(R=R.convertToNumberObjectValue()),R.isError())return R;if(b.isString()&&(b=b.convertToNumberObjectValue()),b.isError())return b;const p=+E.getValue(),V=+R.getValue(),S=+b.getValue();return p===0||V===0?y.create(0):this._getResult(p,V,S)});return a===1&&u===1?m.get(0,0):m}_getResult(e,t,r){let n;return e<0&&r!==0?n=(t<0?ke(Math.abs(e)/Math.abs(t),0):-ke(Math.abs(e)/t,0))*t:n=(t<0?-ke(e/Math.abs(t),0):ke(e/t,0))*t,y.create(n)}}class EC extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){const r=t!=null?t:y.create(1);if(e.isError())return e;if(r.isError())return r;const n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,r,g.create(h.NA)),c=a.map((l,f,m)=>{let d=u.get(f,m),C=l;if(C.isString()&&(C=C.convertToNumberObjectValue()),C.isError())return C;if(d.isString()&&(d=d.convertToNumberObjectValue()),d.isError())return d;const _=+C.getValue(),E=+d.getValue();if(_===0||E===0)return y.create(0);const R=(E<0?-ke(_/Math.abs(E),0):ke(_/E,0))*E;return y.create(R)});return n===1&&s===1?c.get(0,0):c}}class RC extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.mapValue((c,l,f)=>{let m=c,d=a.get(l,f);if(m.isString()&&(m=m.convertToNumberObjectValue()),d.isString()&&(d=d.convertToNumberObjectValue()),m.isError())return m;if(d.isError())return d;const C=Math.floor(+m.getValue()),_=Math.floor(+d.getValue());if(C<0||_<0||C<_)return g.create(h.NUM);const E=Qt(C,_);return Number.isNaN(E)||!Number.isFinite(E)?g.create(h.NUM):y.create(E)});return r===1&&n===1?u.get(0,0):u}}class bC extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.mapValue((c,l,f)=>{let m=c,d=a.get(l,f);if(m.isString()&&(m=m.convertToNumberObjectValue()),d.isString()&&(d=d.convertToNumberObjectValue()),m.isError())return m;if(d.isError())return d;const C=Math.floor(+m.getValue()),_=Math.floor(+d.getValue());if(C<0||_<0||C===0&&C<_)return g.create(h.NUM);const E=Qt(C+_-1,C-1);return Number.isNaN(E)||!Number.isFinite(E)?g.create(h.NUM):y.create(E)});return r===1&&n===1?u.get(0,0):u}}class yC extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.cos()}}class pC extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.cosh()}}class NC extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=+t.getValue();return Math.abs(r)>=2**27?g.create(h.NUM):r===0?g.create(h.DIV_BY_ZERO):t.tan().getReciprocal()}}class VC extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:+t.getValue()===0?g.create(h.DIV_BY_ZERO):t.tanh().getReciprocal()}}class OC extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=+t.getValue();return Math.abs(r)>=2**27?g.create(h.NUM):r===0?g.create(h.DIV_BY_ZERO):t.sin().getReciprocal()}}class SC extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=+t.getValue();return r===0?g.create(h.DIV_BY_ZERO):!Number.isNaN(r)&&!Number.isFinite(Math.sinh(r))?y.create(0):t.sinh().getReciprocal()}}class MC extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.map((c,l,f)=>{if(c.isError())return c;let m=a.get(l,f);if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;const d=`${c.getValue()}`,C=Math.floor(+m.getValue());if(M.isRealNum(d)&&(+d<0||+d>=2**53||!Number.isInteger(+d))||d.toLocaleLowerCase()==="true"||d.toLocaleLowerCase()==="false"||C<2||C>36)return g.create(h.NUM);if(d.replace(/\s/g,"")==="")return y.create(0);if(!this._isValidCharForRadix(d,C))return g.create(h.NUM);const _=Number.parseInt(d,C);return Number.isNaN(_)?g.create(h.NUM):y.create(_)});return r===1&&n===1?u.get(0,0):u}_isValidCharForRadix(e,t){for(const r of e){const n=r.toUpperCase().charCodeAt(0);if(t<=10&&!(n>=48&&n<48+t)||t>10&&!(n>=48&&n<58||n>=65&&n<65+t-10))return!1}return!0}}class DC extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=+t.getValue();if(!Number.isFinite(r))return g.create(h.VALUE);const n=r*(180/Math.PI);return Number.isNaN(n)?g.create(h.VALUE):y.create(n)}}class wC extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=+t.getValue();if(!Number.isFinite(r))return g.create(h.VALUE);const n=(r<0?-ke(Math.abs(r)/2,0):ke(r/2,0))*2;return Number.isNaN(n)?g.create(h.VALUE):n===0?y.create(0):y.create(n)}}class LC extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.exp()}}class PC extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.mapValue(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=Math.floor(+t.getValue()),n=ur(r);return Number.isNaN(n)||!Number.isFinite(n)?g.create(h.NUM):y.create(n)}}class xC extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;if(e.isArray()){const r=e.getRowCount(),n=e.getColumnCount();if(r>1||n>1)return g.create(h.VALUE);t=e.get(0,0)}return this._handleSingleObject(t)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=Math.floor(+t.getValue()),n=ur(r,2);return Number.isNaN(n)||!Number.isFinite(n)?g.create(h.NUM):y.create(n)}}class jC extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.map((c,l,f)=>{let m=a.get(l,f),d=c;if(d.isString()&&(d=d.convertToNumberObjectValue()),d.isError())return d;if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;const C=+d.getValue(),_=+m.getValue();if(C>0&&_<0)return g.create(h.NUM);if(C===0)return y.create(0);if(_===0)return g.create(h.DIV_BY_ZERO);const E=We(C/_,0)*_;return y.create(E)});return r===1&&n===1?u.get(0,0):u}}class UC extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",3)}calculate(e,t,r){const n=t!=null?t:y.create(1),s=r!=null?r:y.create(0),a=Math.max(e.isArray()?e.getRowCount():1,n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1),c=O(a,u,e,g.create(h.NA)),l=O(a,u,n,g.create(h.NA)),f=O(a,u,s,g.create(h.NA)),m=c.map((d,C,_)=>{let E=d,R=l.get(C,_),b=f.get(C,_);if(E.isString()&&(E=E.convertToNumberObjectValue()),E.isError())return E;if(R.isString()&&(R=R.convertToNumberObjectValue()),R.isError())return R;if(b.isString()&&(b=b.convertToNumberObjectValue()),b.isError())return b;const p=+E.getValue(),V=+R.getValue(),S=+b.getValue();if(p===0||V===0)return y.create(0);let D;return p<0&&S!==0?D=(V<0?We(Math.abs(p)/Math.abs(V),0):-We(Math.abs(p)/V,0))*V:D=(V<0?-We(p/Math.abs(V),0):We(p/V,0))*V,y.create(D)});return a===1&&u===1?m.get(0,0):m}}class TC extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){const r=t!=null?t:y.create(1);if(e.isError())return e;if(r.isError())return r;const n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,r,g.create(h.NA)),c=a.map((l,f,m)=>{let d=u.get(f,m),C=l;if(C.isString()&&(C=C.convertToNumberObjectValue()),C.isError())return C;if(d.isString()&&(d=d.convertToNumberObjectValue()),d.isError())return d;const _=+C.getValue(),E=+d.getValue();if(_===0||E===0)return y.create(0);const R=(E<0?-We(_/Math.abs(E),0):We(_/E,0))*E;return y.create(R)});return n===1&&s===1?c.get(0,0):c}}class vC extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=0;for(let r=0;r<e.length;r++){const n=e[r];if(!n.isNull())if(n.isArray()){let s=!1,a=g.create(h.VALUE);if(n.iterator(u=>{if(u!=null&&u.isNull())return!0;const{isError:c,errorObject:l,number:f}=this._handleSingleObject(u);if(c)return s=!0,a=l,!1;t=Gs(t,f)}),s)return a}else{const{isError:s,errorObject:a,number:u}=this._handleSingleObject(n);if(s)return a;t=Gs(t,u)}}return y.create(t)}_handleSingleObject(e){if(e.isBoolean())return{isError:!0,errorObject:g.create(h.VALUE),number:null};let t=e;if(e.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return{isError:!0,errorObject:t,number:null};const r=Math.floor(+t.getValue());return r<0||r>=2**53?{isError:!0,errorObject:g.create(h.NUM),number:null}:{isError:!1,errorObject:null,number:r}}}class IC extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.mapValue(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=Math.floor(+t.getValue());return y.create(r)}}class FC extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=1,r=!0;for(let n=0;n<e.length;n++){const s=e[n];if(!s.isNull())if(s.isArray()){let a=!1,u=g.create(h.VALUE);if(s.iterator(c=>{if(c!=null&&c.isNull())return!0;const{isError:l,errorObject:f,number:m}=this._handleSingleObject(c);if(l)return a=!0,u=f,!1;t=bi(t,m),r=!1}),a)return u}else{const{isError:a,errorObject:u,number:c}=this._handleSingleObject(s);if(a)return u;t=bi(t,c),r=!1}}return r?y.create(0):Number.isNaN(t)||!Number.isFinite(t)||t>=2**53?g.create(h.VALUE):y.create(t)}_handleSingleObject(e){if(e.isBoolean())return{isError:!0,errorObject:g.create(h.VALUE),number:null};let t=e;if(e.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return{isError:!0,errorObject:t,number:null};const r=Math.floor(+t.getValue());return r<0?{isError:!0,errorObject:g.create(h.NUM),number:null}:{isError:!1,errorObject:null,number:r}}}class BC extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.log()}}class kC extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){const r=t!=null?t:y.create(10);if(e.isError())return e;if(r.isError())return r;const n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,r,g.create(h.NA)),c=a.map((l,f,m)=>{let d=u.get(f,m),C=l;if(C.isString()&&(C=C.convertToNumberObjectValue()),C.isError())return C;if(d.isString()&&(d=d.convertToNumberObjectValue()),d.isError())return d;const _=+C.getValue(),E=+d.getValue();if(_<=0||E<=0)return g.create(h.NUM);const R=Math.log(E);if(R===0)return g.create(h.DIV_BY_ZERO);const b=Math.log(_)/R;return y.create(b)});return n===1&&s===1?c.get(0,0):c}}class $C extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.log10()}}class YC extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let a=0;a<t;a++){const u=[];for(let c=0;c<r;c++){let l=e.isArray()?e.get(a,c):e;if(l.isError())return l;if(l.isNull()||l.isBoolean())return g.create(h.VALUE);if(l.isString()&&(l=l.convertToNumberObjectValue()),l.isError())return l;const f=+l.getValue();u.push(f)}n.push(u)}if(t!==r)return g.create(h.VALUE);const s=ba(n);return y.create(s)}}class HC extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){const t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let a=0;a<t;a++){const u=[];for(let c=0;c<r;c++){let l=e.isArray()?e.get(a,c):e;if(l.isError())return l;if(l.isNull()||l.isBoolean())return g.create(h.VALUE);if(l.isString()&&(l=l.convertToNumberObjectValue()),l.isError())return l;const f=+l.getValue();u.push(f)}n.push(u)}if(t!==r)return g.create(h.VALUE);const s=Zm(n);return s===null?g.create(h.NUM):K.createByArray(s)}}class GC extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1;if(n!==s)return g.create(h.VALUE);const u=this._getMatrix(e,r,n),c=this._getMatrix(t,s,a);if(u instanceof g)return u;if(c instanceof g)return c;const l=cr(u,c);return K.createByArray(l)}_getMatrix(e,t,r){const n=[];for(let s=0;s<t;s++){const a=[];for(let u=0;u<r;u++){let c=e.isArray()?e.get(s,u):e;if(c.isError())return c;if(c.isNull()||c.isBoolean())return g.create(h.VALUE);if(c.isString()&&(c=c.convertToNumberObjectValue()),c.isError())return c;const l=+c.getValue();a.push(l)}n.push(a)}return n}}class WC extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let n=t;return n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:r.mod(n)}}class QC extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isArray()){const c=r.getRowCount(),l=r.getColumnCount();if(c>1||l>1)return g.create(h.VALUE);r=r.get(0,0)}if(r.isError())return r;let n=t;if(n.isArray()){const c=n.getRowCount(),l=n.getColumnCount();if(c>1||l>1)return g.create(h.VALUE);n=n.get(0,0)}if(n.isError())return n;if(r.isBoolean()||n.isBoolean())return g.create(h.VALUE);const s=+r.getValue(),a=+n.getValue();if(Number.isNaN(s)||Number.isNaN(a))return g.create(h.VALUE);if(a===0)return y.create(0);if(s>0&&a<0||s<0&&a>0)return g.create(h.NUM);const u=Pt(s/a,0)*a;return y.create(u)}}class qC extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=0,r=1;for(let s=0;s<e.length;s++){const a=e[s];if(!a.isNull())if(a.isArray()){let u=!1,c=g.create(h.VALUE);if(a.iterator(l=>{if(l!=null&&l.isNull())return!0;const{isError:f,errorObject:m,number:d}=this._handleSingleObject(l);if(f)return u=!0,c=m,!1;if(t+=d,t>170)return u=!0,c=g.create(h.NUM),!1;r*=ur(d)}),u)return c}else{const{isError:u,errorObject:c,number:l}=this._handleSingleObject(a);if(u)return c;if(t+=l,t>170)return g.create(h.NUM);r*=ur(l)}}const n=ur(t)/r;return y.create(n)}_handleSingleObject(e){if(e.isBoolean())return{isError:!0,errorObject:g.create(h.VALUE),number:null};let t=e;if(e.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return{isError:!0,errorObject:t,number:null};const r=Math.floor(+t.getValue());return r<0?{isError:!0,errorObject:g.create(h.NUM),number:null}:{isError:!1,errorObject:null,number:r}}}class XC extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.getRowCount(),r=e.getColumnCount(),n=e.mapValue(s=>{const a=this._handleSingleObject(s);return a.isError()?a:t>1||r>1?a.get(0,0):a});return t===1&&r===1?n.get(0,0):n}return this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=Math.floor(+t.getValue());if(r<=0)return g.create(h.VALUE);const n=[];for(let s=0;s<r;s++){n[s]=[];for(let a=0;a<r;a++)n[s][a]=s===a?1:0}return K.createByArray(n)}}class KC extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=+t.getValue();if(!Number.isFinite(r))return g.create(h.VALUE);let n=r<0?-ke(Math.abs(r),0):ke(r,0);return Number.isNaN(n)?g.create(h.VALUE):(Math.abs(n)%2===0&&(r<0?n--:n++),y.create(n))}}class ZC extends N{constructor(){super(...arguments);A(this,"minParams",0);A(this,"maxParams",0)}calculate(){return y.create(Math.PI)}}class zC extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let n=t;return n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:r.pow(n)}}class JC extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=y.create(1),r=!0;for(let n=0;n<e.length;n++){let s=e[n];if(s.isError())return s;if(s.isArray()){let a=!1,u=null;if(s.iterator(c=>{if(c!=null&&c.isError())return a=!0,u=c,!1;if(!c||c.isNull()||c.isString()||c.isBoolean())return!0;t=t.multiply(c),r=!1}),a)return u}else{if(s.isNull())continue;if(s.isString()&&(s=s.convertToNumberObjectValue()),s.isError())return s;t=t.multiply(s),r=!1}if(t.isError())return t}return r?y.create(0):t}}class e_ extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,variants:s}=Q(e,t);if(r)return n;const[a,u]=s,c=+a.getValue(),l=+u.getValue();if(Number.isNaN(c)||Number.isNaN(l))return g.create(h.VALUE);if(l===0)return g.create(h.DIV_BY_ZERO);const f=Math.trunc(c/l);return y.create(f)}}class t_ extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=+t.getValue();if(!Number.isFinite(r))return g.create(h.VALUE);const n=r*(Math.PI/180);return Number.isNaN(n)?g.create(h.VALUE):y.create(n)}}class r_ extends N{constructor(){super(...arguments);A(this,"minParams",0);A(this,"maxParams",0)}calculate(){return y.create(Math.random())}}class n_ extends N{constructor(){super(...arguments);A(this,"minParams",0);A(this,"maxParams",5);A(this,"needsSheetRowColumnCount",!0)}calculate(e,t,r,n,s){if(e!=null&&e.isError())return e;if(t!=null&&t.isError())return t;if(r!=null&&r.isError())return r;if(n!=null&&n.isError())return n;if(s!=null&&s.isError())return s;const a=e!=null?e:y.create(1),u=t!=null?t:y.create(1),c=r!=null?r:y.create(0),l=n!=null?n:y.create(1),f=s!=null?s:y.create(0);return this._calculateResult(a,u,c,l,f)}_calculateResult(e,t,r,n,s){const a=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1);if(a===1&&u===1)return this._calculateSingleCell(e,t,r,n,s);const c=O(a,u,e,g.create(h.NA)),l=O(a,u,t,g.create(h.NA)),f=O(a,u,r,g.create(h.NA)),m=O(a,u,n,g.create(h.NA)),d=O(a,u,s,g.create(h.NA));return c.map((C,_,E)=>{const R=l.get(_,E),b=f.get(_,E),p=m.get(_,E),V=d.get(_,E),S=this._handleError(C,R,b,p,V);if(S.errorObject)return S.errorObject;let{minValue:D,maxValue:w,wholeNumberValue:L}=S,P;return L?(D=Math.ceil(D),w=Math.floor(w),P=Math.floor(Math.random()*(w-D+1))+D):P=Math.random()*(w-D)+D,P<D||P>w?g.create(h.VALUE):y.create(P)})}_calculateSingleCell(e,t,r,n,s){let a=e;a.isArray()&&(a=a.get(0,0));let u=t;u.isArray()&&(u=u.get(0,0));let c=r;c.isArray()&&(c=c.get(0,0));let l=n;l.isArray()&&(l=l.get(0,0));let f=s;f.isArray()&&(f=f.get(0,0));const m=this._handleError(a,u,c,l,f);if(m.errorObject)return m.errorObject;let{rowsValue:d,columnsValue:C,minValue:_,maxValue:E,wholeNumberValue:R}=m;if(R&&(_=Math.ceil(_),E=Math.floor(E),_>E))return g.create(h.VALUE);const b=[];for(let p=0;p<d;p++){const V=[];for(let S=0;S<C;S++)R?V.push(Math.floor(Math.random()*(E-_+1))+_):V.push(Math.random()*(E-_)+_);b.push(V)}return d===1&&C===1?y.create(b[0][0]):K.createByArray(b)}_handleError(e,t,r,n,s){let a=e;if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return{errorObject:a};let u=t;if(u.isString()&&(u=u.convertToNumberObjectValue()),u.isError())return{errorObject:u};let c=r;if(c.isString()&&(c=c.convertToNumberObjectValue()),c.isError())return{errorObject:c};let l=n;if(l.isString()&&(l=l.convertToNumberObjectValue()),l.isError())return{errorObject:l};let f=s;return f.isString()&&(f=f.convertToNumberObjectValue()),f.isError()?{errorObject:f}:this._getValue(a,u,c,l,f)}_getValue(e,t,r,n,s){const a=Math.floor(+e.getValue()),u=Math.floor(+t.getValue());if(a===0||u===0)return{errorObject:g.create(h.CALC)};const c=this._rowCount-this.row,l=this._columnCount-this.column;if(a<0||u<0||a*u>10**7)return{errorObject:g.create(h.VALUE)};if(a>c||u>l)return{errorObject:g.create(h.REF)};const f=+r.getValue(),m=+n.getValue(),d=+s.getValue();return f>m?{errorObject:g.create(h.VALUE)}:d&&(!Number.isInteger(f)||!Number.isInteger(m))?{errorObject:g.create(h.VALUE)}:{rowsValue:a,columnsValue:u,minValue:f,maxValue:m,wholeNumberValue:d}}}class s_ extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isArray()){const c=r.getRowCount(),l=r.getColumnCount();if(c>1||l>1)return g.create(h.VALUE);r=r.get(0,0)}if(r.isError())return r;let n=t;if(n.isArray()){const c=n.getRowCount(),l=n.getColumnCount();if(c>1||l>1)return g.create(h.VALUE);n=n.get(0,0)}if(n.isError())return n;if(r.isBoolean()||n.isBoolean())return g.create(h.VALUE);let s=+r.getValue(),a=+n.getValue();if(Number.isNaN(s)||Number.isNaN(a))return g.create(h.VALUE);if(s>a)return g.create(h.NUM);s=Math.ceil(s),a=Math.floor(a);const u=Math.floor(Math.random()*(a-s+1))+s;return y.create(u)}}class a_ extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){const r=t!=null?t:y.create(0),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,r,g.create(h.NA)),c=a.mapValue((l,f,m)=>{const d=u.get(f,m);return l.isError()?l:d.isError()?d:this._handleSingleObject(l,d)});return n===1&&s===1?c.get(0,0):c}_handleSingleObject(e,t){const{isError:r,errorObject:n,variants:s}=F(e);if(r)return n;const[a]=s;let u=Math.floor(+a.getValue()),c=t;if(c.isString()&&(c=c.convertToNumberObjectValue(),c.isError()))return c;let l=Math.floor(+c.getValue());if(c.isBoolean()&&(l=c.getValue()?0:4),u<0||u>3999||l<0||l>4)return g.create(h.VALUE);const f=ah[l];let m=f.length-1,d="";for(;u>0;){m=this._binarySearch(u,0,m,f);const C=f[m];u-=C,d+=sh.get(C)}return T.create(d)}_binarySearch(e,t,r,n){let s=t,a=r;for(;a-s>1;){const u=Math.floor((s+a)/2),c=n[u];if(c===e)return u;c>e?a=u:s=u}return s!==a&&n[a]<=e?a:s}}class i_ extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let n=t;return n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:r.round(n)}}class o_ extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.mapValue((c,l,f)=>{const m=a.get(l,f);if(c.isError())return c;if(m.isError())return m;const{isError:d,errorObject:C,variants:_}=F(c,m);if(d)return C;const[E,R]=_,b=+E.getValue(),p=Math.trunc(+R.getValue()),V=this._roundBank(b,p);return y.create(V)});return r===1&&n===1?u.get(0,0):u}_roundBank(e,t){if(t>16)return e;if(t<-16)return 0;const r=1e-8,n=10**t,s=+(e*n).toFixed(8),a=Math.floor(s),u=s-a;let c=Math.round(s);return u>.5-r&&u<.5+r&&(c=a%2===0?a:a+1),t?c/n:c}}class u_ extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let n=t;return n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:r.floor(n)}}class c_ extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let n=t;return n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:r.ceil(n)}}class l_ extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=+t.getValue();return Math.abs(r)>=2**27?g.create(h.NUM):t.cos().getReciprocal()}}class f_ extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=+t.getValue();return Number.isFinite(Math.cosh(r))?Math.abs(r)>=2**27?g.create(h.NUM):t.cosh().getReciprocal():y.create(0)}}class m_ extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",4);A(this,"needsSheetRowColumnCount",!0)}calculate(e,t,r,n){let s=e,a=t!=null?t:y.create(1),u=r!=null?r:y.create(1),c=n!=null?n:y.create(1);s.isNull()&&(s=y.create(1)),a.isNull()&&(a=y.create(1)),u.isNull()&&(u=y.create(1)),c.isNull()&&(c=y.create(1));const l=Math.max(s.isArray()?s.getRowCount():1,a.isArray()?a.getRowCount():1,u.isArray()?u.getRowCount():1,c.isArray()?c.getRowCount():1),f=Math.max(s.isArray()?s.getColumnCount():1,a.isArray()?a.getColumnCount():1,u.isArray()?u.getColumnCount():1,c.isArray()?c.getColumnCount():1),m=O(l,f,s,g.create(h.NA)),d=O(l,f,a,g.create(h.NA)),C=O(l,f,u,g.create(h.NA)),_=O(l,f,c,g.create(h.NA)),E=m.mapValue((R,b,p)=>{const V=d.get(b,p),S=C.get(b,p),D=_.get(b,p);return R.isError()?R:V.isError()?V:S.isError()?S:D.isError()?D:this._getResult(R,V,S,D,l,f)});return l===1&&f===1?E.get(0,0):E}_getResult(e,t,r,n,s,a){const{isError:u,errorObject:c,variants:l}=F(e,t,r,n);if(u)return c;const[f,m,d,C]=l,_=Math.floor(+f.getValue()),E=Math.floor(+m.getValue()),R=+d.getValue(),b=+C.getValue();if(_<0||E<0||_*E>10**7)return g.create(h.VALUE);if(_===0||E===0)return g.create(h.CALC);const p=this._rowCount-this.row,V=this._columnCount-this.column;if(_>p||E>V)return g.create(h.REF);const S=[];for(let D=0;D<_;D++){S[D]=[];for(let w=0;w<E;w++)S[D][w]=R+(D*E+w)*b}return s>1||a>1?y.create(S[0][0]):K.createByArray(S)}}class h_ extends N{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4)}calculate(e,t,r,n){if(e.isNull()||t.isNull()||r.isNull()||n.isNull())return g.create(h.NA);const{isError:s,errorObject:a,variants:u}=Q(e,t,r);if(s)return a;const{isError:c,errorObject:l,variants:f}=F(...u);if(c)return l;const[m,d,C]=f,_=+m.getValue(),E=+d.getValue(),R=+C.getValue(),b=[];if(n.isArray()){let V=!1,S=g.create(h.VALUE);if(n.iterator(D=>{const{isError:w,errorObject:L,coefficientsObject:P}=this._handleSingleObject(D);if(w)return V=!0,S=L,!1;const v=+P.getValue();b.push(v)}),V)return S}else{const{isError:V,errorObject:S,coefficientsObject:D}=this._handleSingleObject(n);if(V)return S;const w=+D.getValue();b.push(w)}let p=0;for(let V=0;V<b.length;V++)p+=b[V]*_**(E+V*R);return Number.isNaN(p)||!Number.isFinite(p)?g.create(h.NUM):y.create(p)}_handleSingleObject(e){if(e.isError())return{isError:!0,errorObject:e,coefficientsObject:null};if(e!=null&&e.isBoolean())return{isError:!0,errorObject:g.create(h.VALUE),coefficientsObject:null};let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?{isError:!0,errorObject:t,coefficientsObject:null}:{isError:!1,errorObject:null,coefficientsObject:t}}}class g_ extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;const{isError:t,errorObject:r,variants:n}=F(e);if(t)return r;const[s]=n,a=+s.getValue();return a>0?y.create(1):a<0?y.create(-1):y.create(0)}}class d_ extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.sin()}}class C_ extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.sinh()}}class __ extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.sqrt()}}class A_ extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){const s=t.getRowCount(),a=t.getColumnCount();if(s>1||a>1)return g.create(h.VALUE);t=t.get(0,0)}if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=+t.getValue();if(r<0)return g.create(h.NUM);const n=Math.sqrt(r*Math.PI);return y.create(n)}}const E_={1:Ve.AVERAGE,2:Ve.COUNT,3:Ve.COUNTA,4:Ve.MAX,5:Ve.MIN,6:Ve.PRODUCT,7:Ve.STDEV,8:Ve.STDEVP,9:Ve.SUM,10:Ve.VAR,11:Ve.VARP};class R_ extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",255);A(this,"needsReferenceObject",!0);A(this,"needsFilteredOutRows",!0);A(this,"needsFormulaDataModel",!0)}calculate(e,...t){let r;e.isReferenceObject()?r=e.toArrayValueObject():r=e;const{isError:n,multiAreaRefs:s,normalRefs:a}=Qo(t);if(!n&&s.length>0)return this._handleMultiAreaRefs(r,s,t);if(r.isArray()){const u=r.mapValue(c=>this._handleSingleObject(c,{isError:n,refs:a}));return u.getRowCount()===1&&u.getColumnCount()===1?u.get(0,0):u}return this._handleSingleObject(r,{isError:n,refs:a})}_handleSingleObject(e,t){const{isError:r=!1,refs:n}=t;let s=e;if(e.isString()&&(s=e.convertToNumberObjectValue()),s.isError())return s;if(r)return g.create(h.VALUE);let a=Math.floor(+s.getValue());if(a<1||a>11&&a<101||a>111)return g.create(h.VALUE);let u=!1;return a>=101&&(a-=100,u=!0),Zo({type:E_[a],ignoreRowHidden:u,ignoreErrorValues:!1,ignoreNested:!0,formulaDataModel:this._formulaDataModel},n)}_handleMultiAreaRefs(e,t,r){const n=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1,{multiAreaInfoMap:a,maxAreasLen:u}=this._getMultiAreaInfo(t),c=Math.max(n,u),l=[];for(let f=0;f<c;f++){const m=f<n?f:n-1,d=[];for(let C=0;C<s;C++){if(n>1&&f>=n){d.push(g.create(h.NA));continue}const _=e.isArray()?e.get(m,C):e,E=[];for(let b=0;b<r.length;b++){const p=r[b],V=a.get(p);if(V){const S=f<V.rowAreas.length?f:V.rowAreas.length-1,D=V.rowAreas[S];if(D.isError()){d.push(D);break}E.push(D);continue}E.push(p)}const R=this._handleSingleObject(_,{isError:!1,refs:E});d.push(R)}l.push(d)}return l.length===1?l[0][0]:at(l,l.length,s)}_getMultiAreaInfo(e){const t=new Map;let r=1;return e.forEach(n=>{const s=n.getAreas().map(a=>{if(!a||a.length===0)return n;const u=a.find(c=>!c.isError());return u!=null?u:a[0]});t.set(n,{ref:n,rowAreas:s}),r=Math.max(r,s.length||1)}),{multiAreaInfoMap:t,maxAreasLen:r}}}class b_ extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=y.create(0);for(let r=0;r<e.length;r++){let n=e[r];if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()||(n.isArray()&&(n=n.sum()),n.isError()))return n;if(t=t.plus(n),t.isError())return t}return t}}class y_ extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3);A(this,"needsReferenceObject",!0)}calculate(e,t,r){if(!e.isReferenceObject()||r&&!r.isReferenceObject())return g.create(h.VALUE);let n=t;if(t.isReferenceObject()&&(n=t.toArrayValueObject()),n.isArray()){const s=n.mapValue(a=>this._handleSingleObject(e,a,r));return s.getRowCount()===1&&s.getColumnCount()===1?s.get(0,0):s}return this._handleSingleObject(e,n,r)}_handleSingleObject(e,t,r){const n=e.toArrayValueObject();let s=zn(n,t);s=Jn(s,n,t);const a=n.getRowCount(),u=n.getColumnCount();let c=n;if(r){c=r.toArrayValueObject();const l=c.getRowCount(),f=c.getColumnCount();if(a!==l||u!==f){const m=r.getRangeData();m.endRow=m.startRow+a-1,m.endColumn=m.startColumn+u-1,r.setRangeData(m),c=r.toArrayValueObject()}}return c.pick(s).sum()}}class p_ extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",255);A(this,"needsReferenceObject",!0)}calculate(e,...t){const{isError:r,errorObject:n,rangeIsDifferentSize:s,criteriaMaxRowLength:a,criteriaMaxColumnLength:u,targetRange:c,variants:l}=Tr(t,e);if(r)return n;if(s)return a===1&&u===1?g.create(h.VALUE):O(a,u,g.create(h.VALUE));const f=vr(l,a,u,!0);return this._aggregateResults(c,f)}_aggregateResults(e,t){const r=t.map(n=>n.map(s=>e.pick(s).sum()));return r.length===1&&r[0].length===1?r[0][0]:K.create({calculateValueList:r,rowCount:r.length,columnCount:r[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column})}}class N_ extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(e,...t){if(e.isError())return e;const r=this._initArray1(e);if(t.length===0)return r.sum();const n=r.getRowCount(),s=r.getColumnCount(),a=this._getResultArrayByArray1(n,s,r);if(a instanceof g)return a;const u=a,c=this._validateVariants(t,n,s);return c||this._sumProduct(u,t,n,s)}_validateVariants(e,t,r){for(const n of e){if(n.isError())return n;if(n.isArray()){const s=n,a=s.getRowCount(),u=s.getColumnCount();if(a!==t&&u!==r)return g.create(h.VALUE)}}return null}_sumProduct(e,t,r,n){let s=0;for(let a=0;a<r;a++)for(let u=0;u<n;u++){let c=e[a][u];for(let l=0;l<t.length;l++){const f=t[l],m=this._getVariantCell(f,a,u);if(!m)return g.create(h.VALUE);if(m.isError())return m;m.isNumber()?c*=m.getValue():c=0}s+=c}return y.create(s)}_getVariantCell(e,t,r){if(!e.isArray())return e;const s=e.get(t,r);return s!=null?s:null}_initArray1(e){let t=e;return t.isArray()||(t=K.create({calculateValueList:[[t]],rowCount:1,columnCount:1,unitId:"",sheetId:"",row:0,column:0})),t}_getResultArrayByArray1(e,t,r){const n=[];for(let s=0;s<e;s++){const a=[];for(let u=0;u<t;u++){const c=r.get(s,u);if(c.isError())return c;c.isNumber()?a.push(c.getValue()):a.push(0)}n.push(a)}return n}}class V_ extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=y.create(0);const r=y.create(2);for(let n=0;n<e.length;n++){let s=e[n];if(s.isString()&&(s=s.convertToNumberObjectValue()),s.isError())return s;if(s.isArray()?s.iterator(a=>{if(a==null||a.isString()||a.isBoolean()||a.isNull())return!0;if(a.isError())return t=a,!1;t=t.plus(a.pow(r))}):t=t.plus(s.pow(r)),t.isError())return t}return t}}class O_ extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=r*n,a=t.isArray()?t.getRowCount():1,u=t.isArray()?t.getColumnCount():1,c=a*u;if(s!==c)return g.create(h.NA);if(s===1)return this._calculateSingleCell(e,t);{const l=e.flatten(),f=t.flatten();let m=ce.create();const d=[],C=[];let _=0;return l.iterator((E,R,b)=>{const p=f.get(R,b);if(E==null||E.isString()||E.isBoolean()||E.isNull())return!0;if(E!=null&&E.isError())return m=E,!1;if(p==null||p.isString()||p.isBoolean()||p.isNull())return!0;if(p!=null&&p.isError())return m=p,!1;const V=+E.getValue(),S=+p.getValue();d.push(V),C.push(S),_+=V**2-S**2}),m.isError()?m:d.length===0||C.length===0?g.create(h.DIV_BY_ZERO):y.create(_)}}_calculateSingleCell(e,t){let r=e;if(r.isArray()&&(r=r.get(0,0)),r.isError())return r;let n=t;if(n.isArray()&&(n=n.get(0,0)),n.isError())return n;if(r.isNull()||n.isNull())return g.create(h.VALUE);const s=+r.getValue(),a=+n.getValue();if(r.isString()&&!M.isRealNum(s)||r.isBoolean()||n.isString()&&!M.isRealNum(a)||n.isBoolean())return g.create(h.DIV_BY_ZERO);const u=s**2-a**2;return y.create(u)}}class S_ extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=r*n,a=t.isArray()?t.getRowCount():1,u=t.isArray()?t.getColumnCount():1,c=a*u;if(s!==c)return g.create(h.NA);if(s===1)return this._calculateSingleCell(e,t);{const l=e.flatten(),f=t.flatten();let m=ce.create();const d=[],C=[];let _=0;return l.iterator((E,R,b)=>{const p=f.get(R,b);if(E==null||E.isString()||E.isBoolean()||E.isNull())return!0;if(E!=null&&E.isError())return m=E,!1;if(p==null||p.isString()||p.isBoolean()||p.isNull())return!0;if(p!=null&&p.isError())return m=p,!1;const V=+E.getValue(),S=+p.getValue();d.push(V),C.push(S),_+=V**2+S**2}),m.isError()?m:d.length===0||C.length===0?g.create(h.DIV_BY_ZERO):y.create(_)}}_calculateSingleCell(e,t){let r=e;if(r.isArray()&&(r=r.get(0,0)),r.isError())return r;let n=t;if(n.isArray()&&(n=n.get(0,0)),n.isError())return n;if(r.isNull()||n.isNull())return g.create(h.VALUE);const s=+r.getValue(),a=+n.getValue();if(r.isString()&&!M.isRealNum(s)||r.isBoolean()||n.isString()&&!M.isRealNum(a)||n.isBoolean())return g.create(h.DIV_BY_ZERO);const u=s**2+a**2;return y.create(u)}}class M_ extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=r*n,a=t.isArray()?t.getRowCount():1,u=t.isArray()?t.getColumnCount():1,c=a*u;if(s!==c)return g.create(h.NA);if(s===1)return this._calculateSingleCell(e,t);{const l=e.flatten(),f=t.flatten();let m=ce.create();const d=[],C=[];let _=0;return l.iterator((E,R,b)=>{const p=f.get(R,b);if(E==null||E.isString()||E.isBoolean()||E.isNull())return!0;if(E!=null&&E.isError())return m=E,!1;if(p==null||p.isString()||p.isBoolean()||p.isNull())return!0;if(p!=null&&p.isError())return m=p,!1;const V=+E.getValue(),S=+p.getValue();d.push(V),C.push(S),_+=(V-S)**2}),m.isError()?m:d.length===0||C.length===0?g.create(h.DIV_BY_ZERO):y.create(_)}}_calculateSingleCell(e,t){let r=e;if(r.isArray()&&(r=r.get(0,0)),r.isError())return r;let n=t;if(n.isArray()&&(n=n.get(0,0)),n.isError())return n;if(r.isNull()||n.isNull())return g.create(h.VALUE);const s=+r.getValue(),a=+n.getValue();if(r.isString()&&!M.isRealNum(s)||r.isBoolean()||n.isString()&&!M.isRealNum(a)||n.isBoolean())return g.create(h.DIV_BY_ZERO);const u=(s-a)**2;return y.create(u)}}class D_ extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.tan()}}class w_ extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.tanh()}}class L_ extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){const r=t!=null?t:y.create(0),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,r,g.create(h.NA)),c=a.map((l,f,m)=>{let d=u.get(f,m),C=l;if(C.isString()&&(C=C.convertToNumberObjectValue()),C.isError())return C;if(d.isString()&&(d=d.convertToNumberObjectValue()),d.isError())return d;const _=+C.getValue(),E=+d.getValue(),R=10**Math.trunc(E),b=Xn(_,R),p=Math.trunc(Er(_,R)+b)/R;return y.create(p)});return n===1&&s===1?c.get(0,0):c}}const rc=[[nC,k.ABS],[sC,k.ACOS],[aC,k.ACOSH],[iC,k.ACOT],[oC,k.ACOTH],[cC,k.AGGREGATE],[lC,k.ARABIC],[fC,k.ASIN],[mC,k.ASINH],[hC,k.ATAN],[gC,k.ATAN2],[dC,k.ATANH],[CC,k.BASE],[_C,k.CEILING],[AC,k.CEILING_MATH],[EC,k.CEILING_PRECISE],[RC,k.COMBIN],[bC,k.COMBINA],[yC,k.COS],[pC,k.COSH],[NC,k.COT],[VC,k.COTH],[OC,k.CSC],[SC,k.CSCH],[MC,k.DECIMAL],[DC,k.DEGREES],[wC,k.EVEN],[LC,k.EXP],[PC,k.FACT],[xC,k.FACTDOUBLE],[jC,k.FLOOR],[UC,k.FLOOR_MATH],[TC,k.FLOOR_PRECISE],[vC,k.GCD],[IC,k.INT],[FC,k.LCM],[BC,k.LN],[kC,k.LOG],[$C,k.LOG10],[YC,k.MDETERM],[HC,k.MINVERSE],[GC,k.MMULT],[WC,k.MOD],[QC,k.MROUND],[qC,k.MULTINOMIAL],[XC,k.MUNIT],[KC,k.ODD],[ZC,k.PI],[zC,k.POWER],[JC,k.PRODUCT],[e_,k.QUOTIENT],[t_,k.RADIANS],[r_,k.RAND],[n_,k.RANDARRAY],[s_,k.RANDBETWEEN],[a_,k.ROMAN],[i_,k.ROUND],[o_,k.ROUNDBANK],[u_,k.ROUNDDOWN],[c_,k.ROUNDUP],[l_,k.SEC],[f_,k.SECH],[h_,k.SERIESSUM],[m_,k.SEQUENCE],[g_,k.SIGN],[d_,k.SIN],[C_,k.SINH],[__,k.SQRT],[A_,k.SQRTPI],[R_,k.SUBTOTAL],[b_,k.SUM],[y_,k.SUMIF],[p_,k.SUMIFS],[N_,k.SUMPRODUCT],[V_,k.SUMSQ],[O_,k.SUMX2MY2],[S_,k.SUMX2PY2],[M_,k.SUMXMY2],[D_,k.TAN],[w_,k.TANH],[L_,k.TRUNC]];class P_ extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2);A(this,"_compareType",Y.EQUALS)}setCompareType(e){this._compareType=e}calculate(e,t){return e.isError()?e:t.isError()?t:e.compare(t,this._compareType)}}class Ta extends Nt{constructor(e){super("");A(this,"_values",[]);this._values=e}static create(e){return new Ta(e)}isCube(){return!0}dispose(){this._values.forEach(e=>{e.dispose()}),this._values=[]}getCubeValues(){return this._values}getCubeCount(){return this._values.length}sum(){const e=y.create(0);return this._values.forEach(t=>{e.plus(t.sum())}),e}max(){let e=y.create(Number.NEGATIVE_INFINITY);return this._values.forEach(t=>{const r=t.max();e.isLessThan(r)&&(e=r)}),e}min(){let e=y.create(Number.POSITIVE_INFINITY);return this._values.forEach(t=>{const r=t.max();e.isGreaterThan(r)&&(e=r)}),e}count(){const e=y.create(0);return this._values.forEach(t=>{e.plus(t.count())}),e}countA(){const e=y.create(0);return this._values.forEach(t=>{e.plus(t.countA())}),e}countBlank(){const e=y.create(0);return this._values.forEach(t=>{e.plus(t.countBlank())}),e}}class x_ extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=[];for(let r=0;r<e.length;r++){const n=e[r];if(n.isError())return n;if(!n.isArray())return g.create(h.VALUE);t.push(n)}return Ta.create(t)}}class j_ extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){return e.isError()?e:t.isError()?t:!t.isArray()&&t.getValue()===0?g.create(h.DIV_BY_ZERO):e.divided(t)}}class U_ extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){return e.isError()?e:t.isError()?t:e.minus(t)}}class T_ extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){return e.isError()?e:t.isError()?t:e.multiply(t)}}class v_ extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){return e.isError()?e:t.isError()?t:e.plus(t)}}const nc=[[P_,Te.COMPARE],[j_,Te.DIVIDED],[U_,Te.MINUS],[T_,Te.MULTIPLY],[v_,Te.PLUS],[x_,Te.CUBE]];var x=(i=>(i.AVEDEV="AVEDEV",i.AVERAGE="AVERAGE",i.AVERAGE_WEIGHTED="AVERAGE.WEIGHTED",i.AVERAGEA="AVERAGEA",i.AVERAGEIF="AVERAGEIF",i.AVERAGEIFS="AVERAGEIFS",i.BETA_DIST="BETA.DIST",i.BETA_INV="BETA.INV",i.BINOM_DIST="BINOM.DIST",i.BINOM_DIST_RANGE="BINOM.DIST.RANGE",i.BINOM_INV="BINOM.INV",i.CHISQ_DIST="CHISQ.DIST",i.CHISQ_DIST_RT="CHISQ.DIST.RT",i.CHISQ_INV="CHISQ.INV",i.CHISQ_INV_RT="CHISQ.INV.RT",i.CHISQ_TEST="CHISQ.TEST",i.CONFIDENCE_NORM="CONFIDENCE.NORM",i.CONFIDENCE_T="CONFIDENCE.T",i.CORREL="CORREL",i.COUNT="COUNT",i.COUNTA="COUNTA",i.COUNTBLANK="COUNTBLANK",i.COUNTIF="COUNTIF",i.COUNTIFS="COUNTIFS",i.COVARIANCE_P="COVARIANCE.P",i.COVARIANCE_S="COVARIANCE.S",i.DEVSQ="DEVSQ",i.EXPON_DIST="EXPON.DIST",i.F_DIST="F.DIST",i.F_DIST_RT="F.DIST.RT",i.F_INV="F.INV",i.F_INV_RT="F.INV.RT",i.F_TEST="F.TEST",i.FISHER="FISHER",i.FISHERINV="FISHERINV",i.FORECAST="FORECAST",i.FORECAST_ETS="FORECAST.ETS",i.FORECAST_ETS_CONFINT="FORECAST.ETS.CONFINT",i.FORECAST_ETS_SEASONALITY="FORECAST.ETS.SEASONALITY",i.FORECAST_ETS_STAT="FORECAST.ETS.STAT",i.FORECAST_LINEAR="FORECAST.LINEAR",i.FREQUENCY="FREQUENCY",i.GAMMA="GAMMA",i.GAMMA_DIST="GAMMA.DIST",i.GAMMA_INV="GAMMA.INV",i.GAMMALN="GAMMALN",i.GAMMALN_PRECISE="GAMMALN.PRECISE",i.GAUSS="GAUSS",i.GEOMEAN="GEOMEAN",i.GROWTH="GROWTH",i.HARMEAN="HARMEAN",i.HYPGEOM_DIST="HYPGEOM.DIST",i.INTERCEPT="INTERCEPT",i.KURT="KURT",i.LARGE="LARGE",i.LINEST="LINEST",i.LOGEST="LOGEST",i.LOGNORM_DIST="LOGNORM.DIST",i.LOGNORM_INV="LOGNORM.INV",i.MARGINOFERROR="MARGINOFERROR",i.MAX="MAX",i.MAXA="MAXA",i.MAXIFS="MAXIFS",i.MEDIAN="MEDIAN",i.MIN="MIN",i.MINA="MINA",i.MINIFS="MINIFS",i.MODE_MULT="MODE.MULT",i.MODE_SNGL="MODE.SNGL",i.NEGBINOM_DIST="NEGBINOM.DIST",i.NORM_DIST="NORM.DIST",i.NORM_INV="NORM.INV",i.NORM_S_DIST="NORM.S.DIST",i.NORM_S_INV="NORM.S.INV",i.PEARSON="PEARSON",i.PERCENTILE_EXC="PERCENTILE.EXC",i.PERCENTILE_INC="PERCENTILE.INC",i.PERCENTRANK_EXC="PERCENTRANK.EXC",i.PERCENTRANK_INC="PERCENTRANK.INC",i.PERMUT="PERMUT",i.PERMUTATIONA="PERMUTATIONA",i.PHI="PHI",i.POISSON_DIST="POISSON.DIST",i.PROB="PROB",i.QUARTILE_EXC="QUARTILE.EXC",i.QUARTILE_INC="QUARTILE.INC",i.RANK_AVG="RANK.AVG",i.RANK_EQ="RANK.EQ",i.RSQ="RSQ",i.SKEW="SKEW",i.SKEW_P="SKEW.P",i.SLOPE="SLOPE",i.SMALL="SMALL",i.STANDARDIZE="STANDARDIZE",i.STDEV_P="STDEV.P",i.STDEV_S="STDEV.S",i.STDEVA="STDEVA",i.STDEVPA="STDEVPA",i.STEYX="STEYX",i.T_DIST="T.DIST",i.T_DIST_2T="T.DIST.2T",i.T_DIST_RT="T.DIST.RT",i.T_INV="T.INV",i.T_INV_2T="T.INV.2T",i.T_TEST="T.TEST",i.TREND="TREND",i.TRIMMEAN="TRIMMEAN",i.VAR_P="VAR.P",i.VAR_S="VAR.S",i.VARA="VARA",i.VARPA="VARPA",i.WEIBULL_DIST="WEIBULL.DIST",i.Z_TEST="Z.TEST",i))(x||{}),fs=(i=>(i.ENCODEURL="ENCODEURL",i.FILTERXML="FILTERXML",i.WEBSERVICE="WEBSERVICE",i))(fs||{});const I_=new Set([k.ACOT,k.ACOTH,k.ARABIC,k.BASE,k.CEILING_MATH,k.CEILING_PRECISE,k.COMBINA,k.COT,k.COTH,k.CSC,k.CSCH,k.DECIMAL,k.FLOOR_MATH,k.FLOOR_PRECISE,k.MUNIT,k.RANDARRAY,k.SEC,k.SECH,k.SEQUENCE,ne.CHOOSECOLS,ne.CHOOSEROWS,ne.DROP,ne.EXPAND,ne.FILTER,ne.FORMULATEXT,ne.HSTACK,ne.SORT,ne.SORTBY,ne.TAKE,ne.TOCOL,ne.TOROW,ne.UNIQUE,ne.VSTACK,ne.WRAPCOLS,ne.WRAPROWS,ne.XLOOKUP,ne.XMATCH,q.BITAND,q.BITLSHIFT,q.BITOR,q.BITRSHIFT,q.BITXOR,q.ERF_PRECISE,q.ERFC_PRECISE,q.IMCOSH,q.IMCOT,q.IMCSC,q.IMCSCH,q.IMSEC,q.IMSECH,q.IMSINH,q.IMTAN,be.ISFORMULA,be.SHEET,be.SHEETS,_e.IFNA,_e.IFS,_e.SWITCH,_e.XOR,x.BETA_DIST,x.BETA_INV,x.BINOM_DIST,x.BINOM_DIST_RANGE,x.BINOM_INV,x.CHISQ_DIST,x.CHISQ_DIST_RT,x.CHISQ_INV,x.CHISQ_INV_RT,x.CHISQ_TEST,x.CONFIDENCE_NORM,x.CONFIDENCE_T,x.COVARIANCE_P,x.COVARIANCE_S,x.EXPON_DIST,x.F_DIST,x.F_DIST_RT,x.F_INV,x.F_INV_RT,x.F_TEST,x.FORECAST_LINEAR,x.GAMMA,x.GAMMA_DIST,x.GAMMA_INV,x.GAMMALN_PRECISE,x.GAUSS,x.HYPGEOM_DIST,x.LOGNORM_DIST,x.LOGNORM_INV,x.MAXIFS,x.MINIFS,x.MODE_MULT,x.MODE_SNGL,x.NEGBINOM_DIST,x.NORM_DIST,x.NORM_INV,x.NORM_S_DIST,x.NORM_S_INV,x.PERCENTILE_EXC,x.PERCENTILE_INC,x.PERCENTRANK_EXC,x.PERCENTRANK_INC,x.PERMUTATIONA,x.PHI,x.POISSON_DIST,x.QUARTILE_EXC,x.QUARTILE_INC,x.RANK_AVG,x.RANK_EQ,x.SKEW_P,x.STDEV_P,x.STDEV_S,x.T_DIST,x.T_DIST_2T,x.T_DIST_RT,x.T_INV,x.T_INV_2T,x.T_TEST,x.VAR_P,x.VAR_S,x.WEIBULL_DIST,x.Z_TEST,z.ARRAYTOTEXT,fs.ENCODEURL,z.NUMBERVALUE,z.TEXTAFTER,z.TEXTBEFORE,z.TEXTJOIN,z.TEXTSPLIT,z.UNICHAR,z.UNICODE,z.VALUETOTEXT,Ce.DAYS,Ce.ISOWEEKNUM,ee.PDURATION,ee.RRI,_e.BYCOL,_e.BYROW,_e.MAKEARRAY,_e.MAP,_e.REDUCE,_e.SCAN]);class F_ extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=y.create(0),r=y.create(0);for(let a=0;a<e.length;a++){let u=e[a];if(u.isString()&&(u=u.convertToNumberObjectValue()),u.isError())return u;if(u.isArray()){if(u=B_(u),u.isError())return u;if(e[a]=u,t=t.plus(u.sum()),t.isError())return t;r=r.plus(u.count())}else u.isNull()||(t=t.plus(u),r=r.plus(y.create(1)))}if(r.getValue()===0)return g.create(h.NUM);const n=t.divided(r);if(n.isError())return n;let s=y.create(0);for(let a=0;a<e.length;a++){let u=e[a];if(u.isString()&&(u=u.convertToNumberObjectValue()),u.isError())return u;if(u.isArray()){if(s=s.plus(u.minus(n).abs().sum()),s.isError())return s}else u.isNull()||(s=s.plus(u.minus(n).abs()))}return s.divided(r)}}function B_(i){const o=[];o[0]=[];let e=null;return i.iterator((t,r,n)=>{if(t!=null&&t.isError())return e=t,!1;t!=null&&t.isNumber()&&o[0].push(t)}),e||at(o,1,o[0].length)}class k_ extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=y.create(0),r=y.create(0);for(let n=0;n<e.length;n++){let s=e[n];if((s.isString()||s.isBoolean())&&(s=s.convertToNumberObjectValue()),s.isError())return s;if(s.isArray()){if(t=t.plus(s.sum()),t.isError())return t;r=r.plus(s.count())}else s.isNull()||(t=t.plus(s),r=r.plus(y.create(1)))}return t.divided(r)}}class $_ extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",254)}calculate(...e){let t=!1,r;e.length%2!==0&&(t=!0,r=g.create(h.NA));const n=[],s=[];for(let a=0;a<e.length;a+=2){const u=e[a],c=u.isArray()?u.getRowCount():1,l=u.isArray()?u.getColumnCount():1;for(let C=0;C<c;C++)for(let _=0;_<l;_++){const E=u.isArray()?u.get(C,_):u;if(E.isError())return E;if(t)continue;const R=E.isNull()?"":E.getValue();n.push(R)}if(a+1>=e.length)continue;const f=e[a+1],m=f.isArray()?f.getRowCount():1,d=f.isArray()?f.getColumnCount():1;(m!==c||d!==l)&&(t=!0,r=g.create(h.VALUE));for(let C=0;C<m;C++)for(let _=0;_<d;_++){const E=f.isArray()?f.get(C,_):f;if(E.isError())return E;if(t)continue;const R=E.isNull()?"":E.getValue();s.push(R)}}return t?r:this._getResult(n,s)}_getResult(e,t){const r=e.length;let n=0,s=0;for(let u=0;u<r;u++){const c=e[u],l=t[u];if(!(typeof c!="number"&&typeof l!="number")){if(typeof c!="number"||typeof l!="number"||l<0)return g.create(h.VALUE);n+=c*l,s+=l}}if(s===0)return g.create(h.DIV_BY_ZERO);const a=n/s;return y.create(a)}}class Y_ extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=y.create(0),r=y.create(0);for(let n=0;n<e.length;n++){let s=e[n];if((s.isString()||s.isBoolean())&&(s=s.convertToNumberObjectValue()),s.isError())return s;if(s.isArray()){if(s.iterator(a=>{if(a==null||a.isNull())return!0;let u=a;if(u.isString()&&(u=u.convertToNumberObjectValue(),u.isError()&&(u=y.create(0))),u.isBoolean()&&(u=u.convertToNumberObjectValue()),u.isError())return t=u,!1;t=t.plus(u),r=r.plus(y.create(1))}),t.isError())return t}else s.isNull()||(t=t.plus(s),r=r.plus(y.create(1)))}return t.divided(r)}}class H_ extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3);A(this,"needsReferenceObject",!0)}calculate(e,t,r){if(!e.isReferenceObject()||r&&!r.isReferenceObject())return g.create(h.VALUE);let n=t;if(t.isReferenceObject()&&(n=t.toArrayValueObject()),n.isArray()){const s=n.mapValue(a=>this._handleSingleObject(e,a,r));return s.getRowCount()===1&&s.getColumnCount()===1?s.get(0,0):s}return this._handleSingleObject(e,n,r)}_handleSingleObject(e,t,r){const n=e.toArrayValueObject();let s=zn(n,t);s=Jn(s,n,t);const a=n.getRowCount(),u=n.getColumnCount();let c=n;if(r){c=r.toArrayValueObject();const d=c.getRowCount(),C=c.getColumnCount();if(a!==d||u!==C){const _=r.getRangeData();_.endRow=_.startRow+a-1,_.endColumn=_.startColumn+u-1,r.setRangeData(_),c=r.toArrayValueObject()}}const l=c.pick(s),f=l.sum(),m=l.count();return f.divided(m)}}class G_ extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",255);A(this,"needsReferenceObject",!0)}calculate(e,...t){const{isError:r,errorObject:n,rangeIsDifferentSize:s,criteriaMaxRowLength:a,criteriaMaxColumnLength:u,targetRange:c,variants:l}=Tr(t,e);if(r)return n;if(s)return a===1&&u===1?g.create(h.VALUE):O(a,u,g.create(h.VALUE));const f=vr(l,a,u,!0);return this._aggregateResults(c,f)}_aggregateResults(e,t){const r=t.map(n=>n.map(s=>{const a=e.pick(s),u=a.sum(),c=a.count();return u.divided(c)}));return r.length===1&&r[0].length===1?r[0][0]:K.create({calculateValueList:r,rowCount:r.length,columnCount:r[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column})}}class W_ extends N{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",6)}calculate(e,t,r,n,s,a){let u=s!=null?s:y.create(0),c=a!=null?a:y.create(1);u.isNull()&&(u=y.create(0)),c.isNull()&&(c=y.create(1));const l=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,u.isArray()?u.getRowCount():1,c.isArray()?c.getRowCount():1),f=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,u.isArray()?u.getColumnCount():1,c.isArray()?c.getColumnCount():1),m=O(l,f,e,g.create(h.NA)),d=O(l,f,t,g.create(h.NA)),C=O(l,f,r,g.create(h.NA)),_=O(l,f,n,g.create(h.NA)),E=O(l,f,u,g.create(h.NA)),R=O(l,f,c,g.create(h.NA)),b=m.mapValue((p,V,S)=>{const D=d.get(V,S),w=C.get(V,S),L=_.get(V,S),P=E.get(V,S),v=R.get(V,S);return this._handleSingleObject(p,D,w,L,P,v)});return l===1&&f===1?b.get(0,0):b}_handleSingleObject(e,t,r,n,s,a){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(n.isError())return n;if(s.isError())return s;if(a.isError())return a;const{isError:u,errorObject:c,variants:l}=F(e,t,r,n,s,a);if(u)return c;const[f,m,d,C,_,E]=l,R=+f.getValue(),b=+m.getValue(),p=+d.getValue(),V=+C.getValue(),S=+_.getValue(),D=+E.getValue();if(b<=0||p<=0||R<S||R>D||S===D)return g.create(h.NUM);let w;return V?w=Io((R-S)/(D-S),b,p):w=ih((R-S)/(D-S),b,p)/(D-S),y.create(w)}}class Q_ extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",4)}calculate(e,t,r,n){let s=n!=null?n:r;s.isNull()&&(s=r);const a=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,s.isArray()?s.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,s.isArray()?s.getColumnCount():1),c=O(a,u,e,g.create(h.NA)),l=O(a,u,t,g.create(h.NA)),f=O(a,u,r,g.create(h.NA)),m=O(a,u,s,g.create(h.NA)),d=c.mapValue((C,_,E)=>{const R=l.get(_,E),b=f.get(_,E),p=m.get(_,E);return C.isError()?C:R.isError()?R:b.isError()?b:p.isError()?p:this._handleSingleObject(C,R,b,p)});return a===1&&u===1?d.get(0,0):d}_handleSingleObject(e,t,r,n){const{isError:s,errorObject:a,variants:u}=F(e,t,r,n);if(s)return a;const[c,l,f,m]=u,d=Math.floor(+c.getValue()),C=+l.getValue(),_=Math.floor(+f.getValue()),E=Math.floor(+m.getValue());if(d<0||C<0||C>1||_<0||_>d||E<0||E<_||E>d)return g.create(h.NUM);let R=0;for(let b=_;b<=E;b++)R+=Va(b,d,C);return y.create(R)}}class q_ extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSingleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=F(e,t,r);if(n)return s;const[u,c,l]=a,f=+u.getValue(),m=Math.floor(+c.getValue()),d=+l.getValue();if(f<0||m<1||m>10**10)return g.create(h.NUM);let C;return d?C=Oa(f,m):C=oh(f,m),y.create(C)}}class X_ extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.mapValue((c,l,f)=>{const m=a.get(l,f);return c.isError()?c:m.isError()?m:this._handleSingleObject(c,m)});return r===1&&n===1?u.get(0,0):u}_handleSingleObject(e,t){const{isError:r,errorObject:n,variants:s}=F(e,t);if(r)return n;const[a,u]=s,c=+a.getValue(),l=Math.floor(+u.getValue());if(c<0||c>1||l<1||l>10**10)return g.create(h.NUM);const f=Bo(c,l);return Number.isNaN(f)||!Number.isFinite(f)?g.create(h.NUM):y.create(f)}}class K_ extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);if(f.isError())return f;if(C.isError())return C;if(_.isError())return _;const{isError:E,errorObject:R,variants:b}=F(f,C,_);if(E)return R;const[p,V,S]=b,D=+p.getValue(),w=+V.getValue(),L=Math.floor(+S.getValue());if(D<=0||D>=1||w<=0||L<1)return g.create(h.NUM);if(L===1)return g.create(h.DIV_BY_ZERO);const P=Math.abs(ss(D/2,L-1)*w/Math.sqrt(L));return y.create(P)});return n===1&&s===1?l.get(0,0):l}}class Z_ extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1;let u=e;if(e.isArray()&&r===1&&n===1&&(u=e.get(0,0)),u.isError())return u;let c=t;if(t.isArray()&&s===1&&a===1&&(c=t.get(0,0)),c.isError())return c;if(r*n===1||s*a===1)return u.isNull()||c.isNull()?g.create(h.VALUE):g.create(h.DIV_BY_ZERO);if(r*n!==s*a)return g.create(h.NA);const{isError:l,errorObject:f,array1Values:m,array2Values:d,noCalculate:C}=Ke(e,t,r*n,n,a);return l?f:C?g.create(h.DIV_BY_ZERO):this._getResult(m,d)}_getResult(e,t){const r=e.length;let n=0,s=0;for(let d=0;d<r;d++)n+=e[d],s+=t[d];const a=n/r,u=s/r;let c=0,l=0,f=0;for(let d=0;d<r;d++){const C=e[d]-a,_=t[d]-u;c+=C*_,l+=C**2,f+=_**2}const m=Math.sqrt(l*f);return m===0?g.create(h.DIV_BY_ZERO):y.create(c/m)}}class z_ extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=y.create(0);for(let r=0;r<e.length;r++){const n=e[r];n.isError()||(n.isArray()?t=t.plus(n.count()):n.isString()?n.convertToNumberObjectValue().isError()||(t=t.plus(y.create(1))):n.isNull()||(t=t.plus(y.create(1))))}return t}}class J_ extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=y.create(0);for(let r=0;r<e.length;r++){let n=e[r];if(n.isError()){t=t.plus(y.create(1));continue}n.isArray()?(n=n.countA(),t=t.plus(n)):n.isNull()||(t=t.plus(y.create(1)))}return t}}class eA extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isError()?e:e.getValue()===""||e.isNull()?y.create(1):e.isArray()?e.countBlank():y.create(0)}}class tA extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2);A(this,"needsReferenceObject",!0)}calculate(e,t){if(!e.isReferenceObject())return g.create(h.VALUE);let r=t;if(t.isReferenceObject()&&(r=t.toArrayValueObject()),r.isArray()){const n=r.mapValue(s=>this._handleSingleObject(e,s));return n.getRowCount()===1&&n.getColumnCount()===1?n.get(0,0):n}return this._handleSingleObject(e,r)}_handleSingleObject(e,t){const r=e.toArrayValueObject();let n=zn(r,t);n=Jn(n,r,t);const s=r.pick(n);return this._countA(s)}_countA(e){let t=y.create(0);return e.iterator(r=>{if(r==null)return!0;t=t.plusBy(1)}),t}}class rA extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",255);A(this,"needsReferenceObject",!0)}calculate(...e){const{isError:t,errorObject:r,rangeIsDifferentSize:n,criteriaMaxRowLength:s,criteriaMaxColumnLength:a,variants:u}=Tr(e);if(t)return r;if(n)return s===1&&a===1?g.create(h.VALUE):O(s,a,g.create(h.VALUE));const c=vr(u,s,a,!0);return this._aggregateResults(c)}_aggregateResults(e){const t=e.map(r=>r.map(n=>nA(n)));return t.length===1&&t[0].length===1?t[0][0]:K.create({calculateValueList:t,rowCount:t.length,columnCount:t[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column})}}function nA(i){let o=0;return i.iterator(e=>{e!=null&&e.isBoolean()&&e.getValue()===!0&&o++}),y.create(o)}class sA extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1;let u=e;if(e.isArray()&&r===1&&n===1&&(u=e.get(0,0)),u.isError())return u;let c=t;if(t.isArray()&&s===1&&a===1&&(c=t.get(0,0)),c.isError())return c;if((r*n===1||s*a===1)&&(u.isNull()||c.isNull()))return g.create(h.VALUE);if(r*n!==s*a)return g.create(h.NA);const{isError:l,errorObject:f,array1Values:m,array2Values:d,noCalculate:C}=Ke(e,t,r*n,n,a);return l?f:C?g.create(h.DIV_BY_ZERO):this._getResult(m,d)}_getResult(e,t){if(e.length<=1)return g.create(h.DIV_BY_ZERO);const r=e.length;let n=0,s=0;for(let l=0;l<r;l++)n+=e[l],s+=t[l];const a=n/r,u=s/r;let c=0;for(let l=0;l<r;l++){const f=e[l]-a,m=t[l]-u;c+=f*m}return y.create(c/(r-1))}}class aA extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=[];let r=0,n=!0;for(let u=0;u<e.length;u++){const c=e[u];if(c.isArray()){let l=!1,f=g.create(h.VALUE);if(c.iterator(m=>{const d=this._handleSingleObject(m);if(d.isError())return l=!0,f=d,!1;if(d.isNull())return!0;const C=d.getValue();t.push(C),r+=C,n=!1}),l)return f}else{const l=this._handleSingleObject(c);if(l.isError())return l;if(l.isNull())continue;const f=l.getValue();t.push(f),r+=f,n=!1}}if(n)return g.create(h.NUM);const s=r/t.length;let a=0;for(let u=0;u<t.length;u++)a+=(t[u]-s)**2;return y.create(a)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull()||e.isBoolean())return ce.create();const t=e.getValue();return M.isRealNum(t)?y.create(+t):ce.create()}}class iA extends N{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA)),f=O(s,a,n,g.create(h.NA)),m=u.mapValue((d,C,_)=>{const E=c.get(C,_),R=l.get(C,_),b=f.get(C,_);return d.isError()?d:E.isError()?E:R.isError()?R:b.isError()?b:this._handleSingleObject(d,E,R,b)});return s===1&&a===1?m.get(0,0):m}_handleSingleObject(e,t,r,n){const{isError:s,errorObject:a,variants:u}=F(e,t,r,n);if(s)return a;const[c,l,f,m]=u,d=+c.getValue(),C=Math.floor(+l.getValue()),_=Math.floor(+f.getValue()),E=+m.getValue();if(d<0||C<1||C>10**10||_<1||_>10**10)return g.create(h.NUM);let R;return E?R=Sa(d,C,_):R=uh(d,C,_),Number.isNaN(R)||!Number.isFinite(R)?g.create(h.NUM):y.create(R)}}class oA extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSingleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=F(e,t,r);if(n)return s;const[u,c,l]=a,f=+u.getValue(),m=Math.floor(+c.getValue()),d=Math.floor(+l.getValue());if(f<0||f>1||m<1||m>10**10||d<1||d>10**10)return g.create(h.NUM);const C=ko(f,m,d);return Number.isNaN(C)||!Number.isFinite(C)?g.create(h.NUM):y.create(C)}}class uA extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.mapValue(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=F(e);if(t)return r;const[s]=n,a=s.getValue();if(a<=-1||a>=1)return g.create(h.NUM);const u=Math.log((1+a)/(1-a))/2;return y.create(u)}}class cA extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){return e.isArray()?e.mapValue(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=F(e);if(t)return r;const[s]=n,a=+s.getValue(),u=Math.exp(2*a)-1,c=Math.exp(2*a)+1;return!Number.isFinite(u)&&u>0&&!Number.isFinite(c)&&c>0?y.create(1):y.create(u/c)}}class Oi extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1,a=r.isArray()?r.getRowCount():1,u=r.isArray()?r.getColumnCount():1;let c=t;t.isArray()&&n===1&&s===1&&(c=t.get(0,0));let l=r;return r.isArray()&&a===1&&u===1&&(l=r.get(0,0)),e.isArray()?e.mapValue(f=>this._handleSingleObject(f,c,l,n,s,a,u)):this._handleSingleObject(e,c,l,n,s,a,u)}_handleSingleObject(e,t,r,n,s,a,u){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;let c=e;if(e.isString()&&(c=e.convertToNumberObjectValue()),c.isError())return c;const l=+c.getValue();if((n*s===1||a*u===1)&&(t.isNull()||r.isNull()))return g.create(h.VALUE);if(n*s!==a*u)return g.create(h.NA);const{isError:f,errorObject:m,array1Values:d,array2Values:C,noCalculate:_}=Ke(t,r,n*s,s,u);if(f)return m;if(_)return g.create(h.DIV_BY_ZERO);const E=$o(l,d,C);return Number.isFinite(E)?y.create(E):g.create(h.DIV_BY_ZERO)}}class lA extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,values:s}=this._getValues(e);if(r)return n;if(e.isNull()||t.isNull())return g.create(h.VALUE);let{values:a}=this._getValues(t,!0);a.length===0&&(a=[0]);const u=this._getNewBinsArrayValues(a),c=new Array(u.length).fill(0);for(let l=0;l<s.length;l++){const f=s[l],m=u.findIndex(d=>f>d.start&&f<=d.end);c[m]++}return K.createByArray(c.map(l=>[l]))}_getValues(e,t=!1){const r=[],n=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1;for(let a=0;a<n;a++)for(let u=0;u<s;u++){const c=e.isArray()?e.get(a,u):e;if(c.isError()){if(!t)return{isError:!0,errorObject:c,values:r};continue}if(c.isNull()||c.isBoolean())continue;const l=c.getValue();M.isRealNum(l)&&r.push(+l)}return{isError:!1,errorObject:null,values:r}}_getNewBinsArrayValues(e){const t=e.map((n,s)=>({value:n,index:s})).sort((n,s)=>n.value-s.value),r=[];for(let n=0;n<t.length;n++){const s=t[n].index;if(n===0){r[s]={start:-1/0,end:t[n].value};continue}r[s]={start:t[n-1].value,end:t[n].value}}return r.push({start:t[t.length-1].value,end:1/0}),r}}class fA extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=F(e);if(t)return r;const[s]=n,a=+s.getValue();if(a===0||a<0&&a%1===0)return g.create(h.NUM);const u=cn(a);return Number.isNaN(u)||!Number.isFinite(u)?g.create(h.NUM):y.create(u)}}class Si extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=F(e);if(t)return r;const[s]=n,a=+s.getValue();if(a<=0)return g.create(h.NUM);const u=ot(a);return Math.abs(u)<1e-15?y.create(0):y.create(u)}}class mA extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=F(e);if(t)return r;const[s]=n,a=+s.getValue(),u=Br(a,0,1)-.5;return y.create(u)}}class hA extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=1,r=0,n=!1;for(let a=0;a<e.length;a++){const u=e[a];if(u.isArray()){let c=!1,l=g.create(h.VALUE);if(u.iterator(f=>{if(f!=null&&f.isError())return c=!0,l=f,!1;if(f!=null&&f.isNull()||f!=null&&f.isBoolean())return!0;const m=f.getValue();if(!M.isRealNum(m))return!0;+m<=0&&(n=!0),t*=+m,r++}),c)return l}else{if(u.isError())return u;if(u.isString()){const l=u.convertToNumberObjectValue();if(l.isError())return l}if(u.isNull()||u.isBoolean())continue;const c=u.getValue();if(!M.isRealNum(c))continue;+c<=0&&(n=!0),t*=+c,r++}}if(r===0||n)return g.create(h.NUM);const s=t**(1/r);return y.create(s)}}class gA extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",4)}calculate(e,t,r,n){const{isError:s,errorObject:a}=as(e,t,r);if(s)return a;const u=ht(e);if(u instanceof g)return u;const c=this._getKnownXsValues(u,t);if(c instanceof g)return c;const l=this._getNewXsValues(c,r);if(l instanceof g)return l;let f=n!=null?n:I.create(!0);if(f.isArray()&&(f=f.get(0,0)),f.isString()&&(f=f.convertToNumberObjectValue()),f.isError())return f;const m=+f.getValue();return this._getResult(u,c,l,m)}_getResult(e,t,r,n){return e.length===1&&t.length>1||e[0].length===1&&t[0].length>1?e.length===1&&t.length>1&&(n?t.length+1:t.length)>e[0].length||e[0].length===1&&t[0].length>1&&(n?t[0].length+1:t[0].length)>e.length?g.create(h.NA):this._getResultByMultipleVariables(e,t,r,n):this._getResultBySimpleVariables(e,t,r,n)}_getResultByMultipleVariables(e,t,r,n){const s=e.length===1&&e[0].length>1,a=us(e,t,r,n,!0);if(a instanceof g)return a;const{coefficients:u,newX:c}=a,l=u[0].length,f=u[0][l-1];let m=[];for(let d=0;d<c.length;d++){m[d]=[];let C=f;for(let _=l-2;_>=0;_--)C*=u[0][l-2-_]**c[d][_];m[d].push(C)}return s&&(m=ft(m)),K.createByArray(m)}_getResultBySimpleVariables(e,t,r,n){const s=e.flat(),a=t.flat(),{slope:u,intercept:c}=os(a,s,n,!0),l=r.map(f=>f.map(m=>c*u**m));return K.createByArray(l)}_getKnownXsValues(e,t){return!t||t.isNull()?is(e.length,e[0].length):ht(t)}_getNewXsValues(e,t){return!t||t.isNull()?e:ht(t)}}class dA extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=0,r=0,n=!1;for(let a=0;a<e.length;a++){const u=e[a];if(u.isArray()){let c=!1,l=g.create(h.VALUE);if(u.iterator(f=>{if(f!=null&&f.isError())return c=!0,l=f,!1;if(f!=null&&f.isNull()||f!=null&&f.isBoolean())return!0;const m=f.getValue();if(!M.isRealNum(m))return!0;+m<=0&&(n=!0),t+=1/+m,r++}),c)return l}else{if(u.isError())return u;if(u.isString()){const l=u.convertToNumberObjectValue();if(l.isError())return l}if(u.isNull()||u.isBoolean())continue;const c=u.getValue();if(!M.isRealNum(c))continue;+c<=0&&(n=!0),t+=1/+c,r++}}if(r===0)return g.create(h.NA);if(n)return g.create(h.NUM);const s=r/t;return y.create(s)}}class CA extends N{constructor(){super(...arguments);A(this,"minParams",5);A(this,"maxParams",5)}calculate(e,t,r,n,s){const a=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1),c=O(a,u,e,g.create(h.NA)),l=O(a,u,t,g.create(h.NA)),f=O(a,u,r,g.create(h.NA)),m=O(a,u,n,g.create(h.NA)),d=O(a,u,s,g.create(h.NA)),C=c.mapValue((_,E,R)=>{const b=l.get(E,R),p=f.get(E,R),V=m.get(E,R),S=d.get(E,R);return _.isError()?_:b.isError()?b:p.isError()?p:V.isError()?V:S.isError()?S:this._handleSingleObject(_,b,p,V,S)});return a===1&&u===1?C.get(0,0):C}_handleSingleObject(e,t,r,n,s){const{isError:a,errorObject:u,variants:c}=F(e,t,r,n,s);if(a)return u;const[l,f,m,d,C]=c,_=Math.floor(+l.getValue()),E=Math.floor(+f.getValue()),R=Math.floor(+m.getValue()),b=Math.floor(+d.getValue()),p=+C.getValue();if(_<0||_>E||_>R||_<E-b+R||E<=0||E>b||R<=0||R>b||b<=0)return g.create(h.NUM);let V;return p?V=gh(_,E,R,b):V=Da(_,E,R,b),Number.isNaN(V)&&(V=0),y.create(V)}}class _A extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1;let u=e;if(e.isArray()&&r===1&&n===1&&(u=e.get(0,0)),u.isError())return u;let c=t;if(t.isArray()&&s===1&&a===1&&(c=t.get(0,0)),c.isError())return c;if(r*n===1||s*a===1)return u.isNull()||c.isNull()?g.create(h.VALUE):g.create(h.DIV_BY_ZERO);if(r*n!==s*a)return g.create(h.NA);const{isError:l,errorObject:f,array1Values:m,array2Values:d,noCalculate:C}=Ke(e,t,r*n,n,a);return l?f:C?g.create(h.DIV_BY_ZERO):this._getResult(m,d)}_getResult(e,t){const r=$o(0,e,t);return Number.isFinite(r)?y.create(r):g.create(h.DIV_BY_ZERO)}}class AA extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=[];let r=0;for(let n=0;n<e.length;n++){const s=e[n];if(s.isError())return s;if(s.isString()){const c=s.convertToNumberObjectValue();if(c.isError())return c}const a=s.isArray()?s.getRowCount():1,u=s.isArray()?s.getColumnCount():1;for(let c=0;c<a;c++)for(let l=0;l<u;l++){const f=s.isArray()?s.get(c,l):s;if(f.isError())return f;if(f.isNull()||f.isBoolean())continue;const m=f.getValue();M.isRealNum(m)&&(t.push(+m),r+=+m)}}return t.length<=3?g.create(h.DIV_BY_ZERO):this._getResult(t,r)}_getResult(e,t){const r=e.length,n=t/r;let s=0;for(let l=0;l<r;l++)s+=(e[l]-n)**2;const a=Math.sqrt(s/(r-1));if(a===0)return g.create(h.DIV_BY_ZERO);let u=0;for(let l=0;l<r;l++)u+=((e[l]-n)/a)**4;const c=r*(r+1)/((r-1)*(r-2)*(r-3))*u-3*(r-1)**2/((r-2)*(r-3));return y.create(c)}}class EA extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=nr(e);if(t.isArray()){const n=t.mapValue(s=>this._handleSingleObject(r,s));return n.getRowCount()===1&&n.getColumnCount()===1?n.get(0,0):n}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(!Array.isArray(e))return e;const{isError:r,errorObject:n,variants:s}=F(t);if(r)return n;const[a]=s,u=+a.getValue();return Jo(e,u)}}class RA extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",4)}calculate(e,t,r,n){const{isError:s,errorObject:a}=as(e,t);if(s)return a;const u=ht(e);if(u instanceof g)return u;const c=this._getKnownXsValues(u,t);if(c instanceof g)return c;let l=r!=null?r:I.create(!0);l.isArray()&&(l=l.get(0,0));let f=n!=null?n:I.create(!1);f.isArray()&&(f=f.get(0,0));const{isError:m,errorObject:d,variants:C}=F(l,f);if(m)return d;const[_,E]=C;return this._getResult(u,c,+_.getValue(),+E.getValue())}_getResult(e,t,r,n){return e.length===1&&t.length>1||e[0].length===1&&t[0].length>1?e.length===1&&t.length>1&&(r?t.length+1:t.length)>e[0].length||e[0].length===1&&t[0].length>1&&(r?t[0].length+1:t[0].length)>e.length?g.create(h.NA):this._getResultByMultipleVariables(e,t,r,n):this._getResultBySimpleVariables(e,t,r,n)}_getResultByMultipleVariables(e,t,r,n){const s=us(e,t,t,r,!1);if(s instanceof g)return s;const{coefficients:a,X:u,XTXInverse:c}=s;let l=[];if(n){const f=e.flat(),m=f.length,d=r?f.reduce((U,$)=>U+$,0)/m:0,C=c.length,_=m-C,E=a[0].length,R=new Array(E-2).fill(h.NA),b=a[0][E-1],p=[];for(let U=0;U<u.length;U++){let $=b;for(let W=E-2;W>=0;W--)$+=a[0][E-2-W]*u[U][W];p.push($)}let V=0,S=0;for(let U=0;U<m;U++)V+=(f[U]-d)**2,S+=(f[U]-p[U])**2;const D=V-S,w=V===0?0:D/V,L=[];for(let U=C-1;U>=0;U--){const $=_>0?Math.sqrt(S/_*c[U][U]):0;L.push($)}if(r){const U=L.shift();L.push(U)}else L.push(h.NA);const P=_>0?Math.sqrt(S/_):0,v=_>0?D/(E-1)/(S/_):h.NUM;l=[a[0],[...L],[w,P,...R],[v,_,...R],[D,S,...R]]}else l=[a[0]];return K.createByArray(l)}_getResultBySimpleVariables(e,t,r,n){const s=e.flat(),a=t.flat(),{slope:u,intercept:c}=os(a,s,r,!1);if(Number.isNaN(u))return g.create(h.NA);let l=[];if(n){const f=s.length;let m=0,d=0,C=f-1;if(r){let L=0,P=0;for(let v=0;v<f;v++)L+=s[v],P+=a[v];m=L/f,d=P/f,C=f-2}let _=0,E=0,R=0;for(let L=0;L<f;L++)_+=(s[L]-m)**2,E+=(s[L]-(u*a[L]+c))**2,R+=(a[L]-d)**2;const b=_-E,p=b===_?1:b/_;let V=0,S=0,D=0;C>0&&(R>0&&(V=Math.sqrt(E/C/R),S=Math.sqrt(E/C*(1/f+d**2/R))),D=Math.sqrt(E/C));const w=C>0?b/1/(E/C):h.NUM;r||(S=h.NA),l=[[u,c],[V,S],[p,D],[w,C],[b,E]]}else l=[[u,c]];return K.createByArray(l)}_getKnownXsValues(e,t){return!t||t.isNull()?is(e.length,e[0].length):ht(t)}}class bA extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",4)}calculate(e,t,r,n){const{isError:s,errorObject:a}=as(e,t);if(s)return a;const u=ht(e);if(u instanceof g)return u;const c=this._getKnownXsValues(u,t);if(c instanceof g)return c;let l=r!=null?r:I.create(!0);l.isArray()&&(l=l.get(0,0));let f=n!=null?n:I.create(!1);f.isArray()&&(f=f.get(0,0));const{isError:m,errorObject:d,variants:C}=F(l,f);if(m)return d;const[_,E]=C;return this._getResult(u,c,+_.getValue(),+E.getValue())}_getResult(e,t,r,n){return e.length===1&&t.length>1||e[0].length===1&&t[0].length>1?e.length===1&&t.length>1&&(r?t.length+1:t.length)>e[0].length||e[0].length===1&&t[0].length>1&&(r?t[0].length+1:t[0].length)>e.length?g.create(h.NA):this._getResultByMultipleVariables(e,t,r,n):this._getResultBySimpleVariables(e,t,r,n)}_getResultByMultipleVariables(e,t,r,n){const s=us(e,t,t,r,!0);if(s instanceof g)return s;const{coefficients:a,Y:u,X:c,XTXInverse:l}=s;let f=[];if(n){const m=u.flat(),d=m.length,C=r?m.reduce(($,W)=>$+W,0)/d:0,_=l.length,E=d-_,R=a[0].length,b=new Array(R-2).fill(h.NA),p=a[0][R-1],V=[];for(let $=0;$<c.length;$++){let W=p;for(let re=R-2;re>=0;re--)W*=a[0][R-2-re]**c[$][re];V.push(Math.log(W))}let S=0,D=0;for(let $=0;$<d;$++)S+=(m[$]-C)**2,!(!r&&!Number.isFinite(V[$]))&&(D+=(m[$]-V[$])**2);Number.isFinite(D)||(D=0);const w=S-D,L=S===0?0:w/S,P=[];for(let $=_-1;$>=0;$--){const W=E>0?Math.sqrt(D/E*l[$][$]):0;P.push(W)}if(r){const $=P.shift();P.push($)}else P.push(h.NA);const v=E>0?Math.sqrt(D/E):0,U=E>0?w/(R-1)/(D/E):h.NUM;f=[a[0],[...P],[L,v,...b],[U,E,...b],[w,D,...b]]}else f=[a[0]];return K.createByArray(f)}_getResultBySimpleVariables(e,t,r,n){const s=e.flat(),a=t.flat(),{slope:u,intercept:c,Y:l}=os(a,s,r,!0);if(Number.isNaN(u))return g.create(h.NA);let f=[];if(n){const m=l.length;let d=0,C=0,_=m-1;if(r){let P=0,v=0;for(let U=0;U<m;U++)P+=l[U],v+=a[U];d=P/m,C=v/m,_=m-2}let E=0,R=0,b=0;for(let P=0;P<m;P++)E+=(l[P]-d)**2,R+=(l[P]-Math.log(c*u**a[P]))**2,b+=(a[P]-C)**2;const p=E-R,V=E===0?0:p/E;let S=0,D=0,w=0,L=0;_>0&&(b>0&&(S=Math.sqrt(R/_/b),D=Math.sqrt(R/_*(1/m+C**2/b))),w=Math.sqrt(R/_),L=p/1/(R/_)),r||(D=h.NA),f=[[u,c],[S,D],[V,w],[L,_],[p,R]]}else f=[[u,c]];return K.createByArray(f)}_getKnownXsValues(e,t){return!t||t.isNull()?is(e.length,e[0].length):ht(t)}}class yA extends N{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA)),f=O(s,a,n,g.create(h.NA)),m=u.mapValue((d,C,_)=>{const E=c.get(C,_),R=l.get(C,_),b=f.get(C,_);return d.isError()?d:E.isError()?E:R.isError()?R:b.isError()?b:this._handleSingleObject(d,E,R,b)});return s===1&&a===1?m.get(0,0):m}_handleSingleObject(e,t,r,n){const{isError:s,errorObject:a,variants:u}=F(e,t,r,n);if(s)return a;const[c,l,f,m]=u,d=+c.getValue(),C=+l.getValue(),_=+f.getValue(),E=+m.getValue();if(d<=0||_<=0)return g.create(h.NUM);let R;return E?R=Ho(d,C,_):R=dh(d,C,_),y.create(R)}}class pA extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=this._getRangeValues(e);if(r instanceof g)return r;const n=Gt(t);if(n.isError())return n;const{isError:s,errorObject:a,variants:u}=F(n);if(s)return a;const[c]=u,l=+c.getValue();if(l<=0||l>=1)return g.create(h.NUM);if(r.length<2)return g.create(h.DIV_BY_ZERO);const f=1-l,m=r.length,d=r.reduce((R,b)=>R+b,0)/m,C=r.reduce((R,b)=>R+(b-d)**2,0)/(m-1),_=Math.sqrt(C);if(_<=0)return g.create(h.NUM);const E=Math.abs(ss(f/2,m-1)*_/Math.sqrt(m));return y.create(E)}_getRangeValues(e){const t=[],r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1;for(let s=0;s<r;s++)for(let a=0;a<n;a++){const u=e.isArray()?e.get(s,a):e;if(u.isError())return u;u.isNull()||u.isBoolean()||u.isString()||t.push(+u.getValue())}return t}}class NA extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=y.create(Number.NEGATIVE_INFINITY);for(let r=0;r<e.length;r++){let n=e[r];if(!n.isNull()){if((n.isString()||n.isBoolean())&&(n=n.convertToNumberObjectValue()),n.isArray()&&(n=n.max()),n.isError())return n;t=this._validator(t,n)}}return t.getValue()===Number.NEGATIVE_INFINITY?y.create(0):t}_validator(e,t){const r=e.isLessThan(t);let n=e;return r.getValue()&&(n=t),n}}class VA extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=y.create(Number.NEGATIVE_INFINITY);for(let r=0;r<e.length;r++){let n=e[r];if(!n.isNull()){if((n.isString()||n.isBoolean())&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(n.isArray()&&n.iterator(s=>{let a=s;if((a==null||a.isNull()||a.isString())&&(a=y.create(0)),a.isBoolean()&&(a=a.convertToNumberObjectValue()),a.isError())return t=a,!1;t=this._validator(t,a)}),t.isError())return t;t=this._validator(t,n)}}return t.getValue()===Number.NEGATIVE_INFINITY?y.create(0):t}_validator(e,t){const r=e.isLessThan(t);let n=e;return r.getValue()&&(n=t),n}}class OA extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",255);A(this,"needsReferenceObject",!0)}calculate(e,...t){const{isError:r,errorObject:n,rangeIsDifferentSize:s,criteriaMaxRowLength:a,criteriaMaxColumnLength:u,targetRange:c,variants:l}=Tr(t,e);if(r)return n;if(s)return a===1&&u===1?g.create(h.VALUE):O(a,u,g.create(h.VALUE));const f=vr(l,a,u,!0);return this._aggregateResults(c,f)}_aggregateResults(e,t){const r=t.map(n=>n.map(s=>{const a=e.pick(s);return a.getColumnCount()===0?K.create("0"):a.max()}));return r.length===1&&r[0].length===1?r[0][0]:K.create({calculateValueList:r,rowCount:r.length,columnCount:r[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column})}}class SA extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=[];for(let r=0;r<e.length;r++){const n=e[r];if(n.isArray()){let s=!1,a=g.create(h.VALUE);if(n.iterator(u=>{if(u!=null&&u.isError())return s=!0,a=u,!1;if(u!=null&&u.isNull()||u!=null&&u.isBoolean())return!0;const c=u.getValue();if(!M.isRealNum(c))return!0;t.push(+c)}),s)return a}else{if(n.isError())return n;if(n.isNull()||n.isBoolean())continue;if(n.isString()){const a=n.convertToNumberObjectValue();if(a.isError())return a}const s=n.getValue();if(!M.isRealNum(s))continue;t.push(+s)}}return t.length===0?g.create(h.NUM):zo(t)}}class MA extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=y.create(Number.POSITIVE_INFINITY);for(let r=0;r<e.length;r++){let n=e[r];if(!n.isNull()){if((n.isString()||n.isBoolean())&&(n=n.convertToNumberObjectValue()),n.isArray()&&(n=n.min()),n.isError())return n;t=this._validator(t,n)}}return t.getValue()===Number.POSITIVE_INFINITY?y.create(0):t}_validator(e,t){const r=e.isGreaterThan(t);let n=e;return r.getValue()&&(n=t),n}}class DA extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=y.create(Number.POSITIVE_INFINITY);for(let r=0;r<e.length;r++){let n=e[r];if(!n.isNull()){if((n.isString()||n.isBoolean())&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(n.isArray()&&n.iterator(s=>{let a=s;if((a==null||a.isNull()||a.isString())&&(a=y.create(0)),a.isBoolean()&&(a=a.convertToNumberObjectValue()),a.isError())return t=a,!1;t=this._validator(t,a)}),t.isError())return t;t=this._validator(t,n)}}return t.getValue()===Number.POSITIVE_INFINITY?y.create(0):t}_validator(e,t){const r=e.isGreaterThan(t);let n=e;return r.getValue()&&(n=t),n}}class wA extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",255);A(this,"needsReferenceObject",!0)}calculate(e,...t){const{isError:r,errorObject:n,rangeIsDifferentSize:s,criteriaMaxRowLength:a,criteriaMaxColumnLength:u,targetRange:c,variants:l}=Tr(t,e);if(r)return n;if(s)return a===1&&u===1?g.create(h.VALUE):O(a,u,g.create(h.VALUE));const f=vr(l,a,u,!0);return this._aggregateResults(c,f)}_aggregateResults(e,t){const r=t.map(n=>n.map(s=>{const a=e.pick(s);return a.getColumnCount()===0?K.create("0"):a.min()}));return r.length===1&&r[0].length===1?r[0][0]:K.create({calculateValueList:r,rowCount:r.length,columnCount:r[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column})}}class LA extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t={};let r=0,n=1;for(let s=0;s<e.length;s++){const a=e[s];if(a.isError())return a;if(a.isString()){const l=a.convertToNumberObjectValue();if(l.isError())return l}const u=a.isArray()?a.getRowCount():1,c=a.isArray()?a.getColumnCount():1;for(let l=0;l<u;l++)for(let f=0;f<c;f++){const m=a.isArray()?a.get(l,f):a;if(m.isError())return m;if(m.isNull()||m.isBoolean()||m.isString())continue;const d=m.getValue();M.isRealNum(d)&&(t[+d]?(t[+d].count++,t[+d].count>n&&(n=t[+d].count)):t[+d]={count:1,order:r++})}}return r===0||n===1?new g(h.NA):this._getResult(t,n)}_getResult(e,t){const r=Object.entries(e).filter(([n,{count:s}])=>s===t).sort((n,s)=>n[1].order-s[1].order).map(([n])=>+n);return r.length===1?y.create(r[0]):K.createByArray(r.map(n=>[n]))}}class PA extends N{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA)),f=O(s,a,n,g.create(h.NA)),m=u.mapValue((d,C,_)=>{const E=c.get(C,_),R=l.get(C,_),b=f.get(C,_);return d.isError()?d:E.isError()?E:R.isError()?R:b.isError()?b:this._handleSingleObject(d,E,R,b)});return s===1&&a===1?m.get(0,0):m}_handleSingleObject(e,t,r,n){const{isError:s,errorObject:a,variants:u}=F(e,t,r,n);if(s)return a;const[c,l,f,m]=u,d=Math.floor(+c.getValue()),C=Math.floor(+l.getValue()),_=+f.getValue(),E=+m.getValue();if(d<0||C<1||_<=0||_>=1)return g.create(h.NUM);let R;return E?R=_h(d,C,_):R=wa(d,C,_),y.create(R)}}class xA extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.mapValue((c,l,f)=>{const m=a.get(l,f);return c.isError()?c:m.isError()?m:this._handleSingleObject(c,m)});return r===1&&n===1?u.get(0,0):u}_handleSingleObject(e,t){const{isError:r,errorObject:n,variants:s}=F(e,t);if(r)return n;const[a,u]=s,c=+a.getValue(),l=+u.getValue();let f;return l?f=Br(c,0,1):f=Go(c,0,1),y.create(f)}}class jA extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1;let u=e;if(e.isArray()&&r===1&&n===1&&(u=e.get(0,0)),u.isError())return u;let c=t;if(t.isArray()&&s===1&&a===1&&(c=t.get(0,0)),c.isError())return c;if(r*n===1||s*a===1)return u.isNull()||c.isNull()?g.create(h.VALUE):g.create(h.DIV_BY_ZERO);if(r*n!==s*a)return g.create(h.NA);const{isError:l,errorObject:f,array1Values:m,array2Values:d,noCalculate:C}=Ke(e,t,r*n,n,a);return l?f:C?g.create(h.DIV_BY_ZERO):this._getResult(m,d)}_getResult(e,t){const r=e.length;let n=0,s=0;for(let d=0;d<r;d++)n+=e[d],s+=t[d];const a=n/r,u=s/r;let c=0,l=0,f=0;for(let d=0;d<r;d++)c+=(e[d]-a)*(t[d]-u),l+=(e[d]-a)**2,f+=(t[d]-u)**2;if(l===0||f===0)return g.create(h.DIV_BY_ZERO);const m=c/Math.sqrt(l*f);return y.create(m)}}class UA extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=nr(e);if(t.isArray()){const n=t.mapValue(s=>this._handleSingleObject(r,s));return n.getRowCount()===1&&n.getColumnCount()===1?n.get(0,0):n}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(!Array.isArray(e))return e;const{isError:r,errorObject:n,variants:s}=F(t);if(r)return n;const[a]=s,u=+a.getValue();return ru(e,u)}}class TA extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){const n=this._getValues(e);let s=r!=null?r:y.create(3);s.isNull()&&(s=y.create(3));const a=Math.max(t.isArray()?t.getRowCount():1,s.isArray()?s.getRowCount():1),u=Math.max(t.isArray()?t.getColumnCount():1,s.isArray()?s.getColumnCount():1),c=O(a,u,t,g.create(h.NA)),l=O(a,u,s,g.create(h.NA)),f=c.mapValue((m,d,C)=>{const _=l.get(d,C);return m.isError()?m:_.isError()?_:this._handleSingleObject(n,m,_)});return a===1&&u===1?f.get(0,0):f}_handleSingleObject(e,t,r){if(e instanceof g)return e;const{isError:n,errorObject:s,variants:a}=F(t,r);if(n)return s;const[u,c]=a,l=+u.getValue(),f=Math.floor(+c.getValue()),m=e.length;if(m===0||l<e[0]||l>e[m-1])return g.create(h.NA);if(m===1)return l===e[0]?y.create(1):g.create(h.NA);let d=0,C=!1,_=0;for(;!C&&_<m;)l===e[_]?(d=(_+1)/(m+1),C=!0):l>e[_]&&_+1<m&&l<e[_+1]&&(d=(_+1+(l-e[_])/(e[_+1]-e[_]))/(m+1),C=!0),_++;return C?f<1?g.create(h.NUM):(d=We(d,f),y.create(d)):g.create(h.NA)}_getValues(e){const t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let s=0;s<t;s++)for(let a=0;a<r;a++){const u=e.isArray()?e.get(s,a):e;if(u.isError())return u;if(u.isNull()||u.isBoolean())continue;const c=u.getValue();M.isRealNum(c)&&n.push(+c)}return n.sort((s,a)=>s-a)}}class vA extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.mapValue((c,l,f)=>{const m=a.get(l,f);if(c.isError())return c;if(m.isError())return m;const{isError:d,errorObject:C,variants:_}=F(c,m);if(d)return C;const[E,R]=_,b=Math.floor(+E.getValue()),p=Math.floor(+R.getValue());if(b<0||b>=2147483647||p<0||b<p)return g.create(h.NUM);let V=1;for(let S=b-p+1;S<=b;S++)V*=S;return Number.isFinite(V)?y.create(V):g.create(h.NUM)});return r===1&&n===1?u.get(0,0):u}}class IA extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.mapValue((c,l,f)=>{const m=a.get(l,f);if(c.isError())return c;if(m.isError())return m;const{isError:d,errorObject:C,variants:_}=F(c,m);if(d)return C;const[E,R]=_,b=Math.floor(+E.getValue()),p=Math.floor(+R.getValue());if(b<0||b>=2147483647||p<0)return g.create(h.NUM);if(b===0)return p===0?y.create(1):y.create(0);const V=b**p;return Number.isFinite(V)?y.create(V):g.create(h.NUM)});return r===1&&n===1?u.get(0,0):u}}class FA extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=F(e);if(t)return r;const[s]=n,a=+s.getValue(),u=Math.exp(-.5*a*a)/Math.sqrt(2*Math.PI);return y.create(u)}}class BA extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",4)}calculate(e,t,r,n){const{isError:s,errorObject:a,xRangeValues:u,probRangeValues:c}=this._handleXRangeAndProbRange(e,t);let l=n!=null?n:r;n!=null&&n.isNull()&&(l=r);const f=Math.max(r.isArray()?r.getRowCount():1,l.isArray()?l.getRowCount():1),m=Math.max(r.isArray()?r.getColumnCount():1,l.isArray()?l.getColumnCount():1),d=O(f,m,r,g.create(h.NA)),C=O(f,m,l,g.create(h.NA)),_=d.mapValue((E,R,b)=>{const p=C.get(R,b);return e.isError()?e:t.isError()?t:E.isError()?E:p.isError()?p:s?a:this._handleSingleObject(u,c,E,p)});return f===1&&m===1?_.get(0,0):_}_handleSingleObject(e,t,r,n){const{isError:s,errorObject:a,variants:u}=F(r,n);if(s)return a;const[c,l]=u,f=+c.getValue(),m=+l.getValue();if(t.reduce((C,_)=>C+_,0)!==1)return g.create(h.NUM);let d=0;for(let C=0;C<e.length;C++)e[C]>=f&&e[C]<=m&&(d+=t[C]);return y.create(d)}_handleXRangeAndProbRange(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1;let u=e;if(e.isArray()&&r===1&&n===1&&(u=e.get(0,0)),u.isError())return{isError:!0,errorObject:u,xRangeValues:[],probRangeValues:[]};let c=t;if(t.isArray()&&s===1&&a===1&&(c=t.get(0,0)),c.isError())return{isError:!0,errorObject:c,xRangeValues:[],probRangeValues:[]};if((r*n===1||s*a===1)&&(u.isNull()||c.isNull()))return{isError:!0,errorObject:g.create(h.VALUE),xRangeValues:[],probRangeValues:[]};if(r*n!==s*a)return{isError:!0,errorObject:g.create(h.NA),xRangeValues:[],probRangeValues:[]};const{isError:l,errorObject:f,array1Values:m,array2Values:d,noCalculate:C}=Ke(e,t,r*n,n,a);return l?{isError:!0,errorObject:f,xRangeValues:[],probRangeValues:[]}:C?{isError:!0,errorObject:g.create(h.DIV_BY_ZERO),xRangeValues:[],probRangeValues:[]}:{isError:!1,errorObject:null,xRangeValues:m,probRangeValues:d}}}class kA extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=nr(e);if(t.isArray()){const n=t.mapValue(s=>this._handleSingleObject(r,s));return n.getRowCount()===1&&n.getColumnCount()===1?n.get(0,0):n}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(!Array.isArray(e))return e;const{isError:r,errorObject:n,variants:s}=F(t);if(r)return n;const[a]=s,u=Math.floor(+a.getValue());return su(e,u)}}class $A extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3);A(this,"needsReferenceObject",!0)}calculate(e,t,r){let n=e;n.isReferenceObject()&&(n=n.toArrayValueObject());const{refHasError:s,refErrorObject:a,refNumbers:u}=this._checkRefReferenceObject(t);let c=r!=null?r:y.create(0);c.isReferenceObject()&&(c=c.toArrayValueObject());const l=Math.max(n.isArray()?n.getRowCount():1,c.isArray()?c.getRowCount():1),f=Math.max(n.isArray()?n.getColumnCount():1,c.isArray()?c.getColumnCount():1),m=O(l,f,n,g.create(h.NA)),d=O(l,f,c,g.create(h.NA)),C=m.map((_,E,R)=>{const b=d.get(E,R);if(!e.isReferenceObject()&&e.isNull())return g.create(h.NA);if(s)return a;if(b.isError())return b;const p=+_.getValue(),V=+b.getValue();return Number.isNaN(p)||Number.isNaN(V)?g.create(h.VALUE):this._getResult(p,V,u)});return l===1&&f===1?C.get(0,0):C}_getResult(e,t,r){const n=r.sort((c,l)=>t?c-l:l-c);let s=n.indexOf(e);const a=[];for(;s>=0;){const c=s+1;a.push(c),s=n.indexOf(e,c)}if(a.length===0)return g.create(h.NA);const u=a.reduce((c,l)=>c+l,0)/a.length;return y.create(u)}_checkRefReferenceObject(e){let t=!1,r=g.create(h.NA);const n=[];return e.isReferenceObject()?(e.toArrayValueObject().iterator(a=>{const u=a;if(u.isError())return t=!0,r=u,!1;if(u.isNull()||u.isBoolean())return!0;const c=+u.getValue();if(Number.isNaN(c))return!0;n.push(c)}),{refHasError:t,refErrorObject:r,refNumbers:n}):{refHasError:!0,refErrorObject:r,refNumbers:n}}}class YA extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3);A(this,"needsReferenceObject",!0)}calculate(e,t,r){let n=e;n.isReferenceObject()&&(n=n.toArrayValueObject());const{refHasError:s,refErrorObject:a,refNumbers:u}=this._checkRefReferenceObject(t);let c=r!=null?r:y.create(0);c.isReferenceObject()&&(c=c.toArrayValueObject());const l=Math.max(n.isArray()?n.getRowCount():1,c.isArray()?c.getRowCount():1),f=Math.max(n.isArray()?n.getColumnCount():1,c.isArray()?c.getColumnCount():1),m=O(l,f,n,g.create(h.NA)),d=O(l,f,c,g.create(h.NA)),C=m.map((_,E,R)=>{const b=d.get(E,R);if(!e.isReferenceObject()&&e.isNull())return g.create(h.NA);if(s)return a;if(b.isError())return b;const p=+_.getValue(),V=+b.getValue();if(Number.isNaN(p)||Number.isNaN(V))return g.create(h.VALUE);const D=u.sort((w,L)=>V?w-L:L-w).indexOf(p);return D===-1?g.create(h.NA):y.create(D+1)});return l===1&&f===1?C.get(0,0):C}_checkRefReferenceObject(e){let t=!1,r=g.create(h.NA);const n=[];return e.isReferenceObject()?(e.toArrayValueObject().iterator(a=>{const u=a;if(u.isError())return t=!0,r=u,!1;if(u.isNull()||u.isBoolean())return!0;const c=+u.getValue();if(Number.isNaN(c))return!0;n.push(c)}),{refHasError:t,refErrorObject:r,refNumbers:n}):{refHasError:!0,refErrorObject:r,refNumbers:n}}}class HA extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1;let u=e;if(e.isArray()&&r===1&&n===1&&(u=e.get(0,0)),u.isError())return u;let c=t;if(t.isArray()&&s===1&&a===1&&(c=t.get(0,0)),c.isError())return c;if((r*n===1||s*a===1)&&(u.isNull()||c.isNull()))return g.create(h.VALUE);if(r*n!==s*a)return g.create(h.NA);const{isError:l,errorObject:f,array1Values:m,array2Values:d,noCalculate:C}=Ke(e,t,r*n,n,a);return l?f:C?g.create(h.DIV_BY_ZERO):this._getResult(m,d)}_getResult(e,t){if(e.length===0)return g.create(h.DIV_BY_ZERO);const r=e.length;let n=0,s=0;for(let d=0;d<r;d++)n+=e[d],s+=t[d];const a=n/r,u=s/r;let c=0,l=0,f=0;for(let d=0;d<r;d++)c+=(e[d]-a)*(t[d]-u),l+=(e[d]-a)**2,f+=(t[d]-u)**2;if(l===0||f===0)return g.create(h.DIV_BY_ZERO);const m=(c/Math.sqrt(l*f))**2;return y.create(m)}}class GA extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=[];let r=0;for(let n=0;n<e.length;n++){const s=e[n];if(s.isError())return s;if(s.isString()){const c=s.convertToNumberObjectValue();if(c.isError())return c}const a=s.isArray()?s.getRowCount():1,u=s.isArray()?s.getColumnCount():1;for(let c=0;c<a;c++)for(let l=0;l<u;l++){const f=s.isArray()?s.get(c,l):s;if(f.isError())return f;if(f.isNull()||f.isBoolean())continue;const m=f.getValue();M.isRealNum(m)&&(t.push(+m),r+=+m)}}return t.length<=2?g.create(h.DIV_BY_ZERO):this._getResult(t,r)}_getResult(e,t){const r=e.length,n=t/r;let s=0;for(let l=0;l<r;l++)s+=(e[l]-n)**2;const a=Math.sqrt(s/(r-1));if(a===0)return g.create(h.DIV_BY_ZERO);let u=0;for(let l=0;l<r;l++)u+=((e[l]-n)/a)**3;const c=r/((r-1)*(r-2))*u;return y.create(c)}}class WA extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=[];let r=0;for(let n=0;n<e.length;n++){const s=e[n];if(s.isError())return s;if(s.isString()){const c=s.convertToNumberObjectValue();if(c.isError())return c}const a=s.isArray()?s.getRowCount():1,u=s.isArray()?s.getColumnCount():1;for(let c=0;c<a;c++)for(let l=0;l<u;l++){const f=s.isArray()?s.get(c,l):s;if(f.isError())return f;if(f.isNull()||f.isBoolean())continue;const m=f.getValue();M.isRealNum(m)&&(t.push(+m),r+=+m)}}return t.length<=2?g.create(h.DIV_BY_ZERO):this._getResult(t,r)}_getResult(e,t){const r=e.length,n=t/r;let s=0;for(let l=0;l<r;l++)s+=(e[l]-n)**2;const a=Math.sqrt(s/r);if(a===0)return g.create(h.DIV_BY_ZERO);let u=0;for(let l=0;l<r;l++)u+=((e[l]-n)/a)**3;const c=u/r;return y.create(c)}}class QA extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1;let u=e;if(e.isArray()&&r===1&&n===1&&(u=e.get(0,0)),u.isError())return u;let c=t;if(t.isArray()&&s===1&&a===1&&(c=t.get(0,0)),c.isError())return c;if(r*n===1||s*a===1)return u.isNull()||c.isNull()?g.create(h.VALUE):g.create(h.DIV_BY_ZERO);if(r*n!==s*a)return g.create(h.NA);const{isError:l,errorObject:f,array1Values:m,array2Values:d,noCalculate:C}=Ke(e,t,r*n,n,a);return l?f:C?g.create(h.DIV_BY_ZERO):this._getResult(m,d)}_getResult(e,t){const r=e.length;let n=0,s=0;for(let m=0;m<r;m++)n+=e[m],s+=t[m];const a=n/r,u=s/r;let c=0,l=0;for(let m=0;m<r;m++)c+=(e[m]-a)*(t[m]-u),l+=(t[m]-u)**2;if(l===0)return g.create(h.DIV_BY_ZERO);const f=c/l;return y.create(f)}}class qA extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=nr(e);if(t.isArray()){const n=t.mapValue(s=>this._handleSingleObject(r,s));return n.getRowCount()===1&&n.getColumnCount()===1?n.get(0,0):n}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(!Array.isArray(e))return e;const{isError:r,errorObject:n,variants:s}=F(t);if(r)return n;const[a]=s,u=+a.getValue();return eu(e,u)}}class XA extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSingleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=F(e,t,r);if(n)return s;const[u,c,l]=a,f=+u.getValue(),m=+c.getValue(),d=+l.getValue();if(d<=0)return g.create(h.NUM);const C=(f-m)/d;return y.create(C)}}class KA extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=this.flattenArray(e,!1);return t.isError()?t:t.std(1)}}class ZA extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=this.flattenArray(e,!1);return t.isError()?t:t.std()}}class zA extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1;let u=e;if(e.isArray()&&r===1&&n===1&&(u=e.get(0,0)),u.isError())return u;let c=t;if(t.isArray()&&s===1&&a===1&&(c=t.get(0,0)),c.isError())return c;if((r*n===1||s*a===1)&&(u.isNull()||c.isNull()))return g.create(h.VALUE);if(r*n!==s*a)return g.create(h.NA);const{isError:l,errorObject:f,array1Values:m,array2Values:d,noCalculate:C}=Ke(e,t,r*n,n,a);return l?f:C?g.create(h.DIV_BY_ZERO):this._getResult(m,d)}_getResult(e,t){const r=e.length;if(r<=2)return g.create(h.DIV_BY_ZERO);let n=0,s=0;for(let d=0;d<r;d++)n+=e[d],s+=t[d];const a=n/r,u=s/r;let c=0,l=0,f=0;for(let d=0;d<r;d++)c+=(e[d]-a)*(t[d]-u),l+=(e[d]-a)**2,f+=(t[d]-u)**2;if(f===0)return g.create(h.DIV_BY_ZERO);const m=Math.sqrt((l-c**2/f)/(r-2));return Number.isNaN(m)||!Number.isFinite(m)?g.create(h.NUM):y.create(m)}}class JA extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSingleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=F(e,t,r);if(n)return s;const[u,c,l]=a,f=+u.getValue(),m=Math.floor(+c.getValue()),d=+l.getValue();if(m<1)return g.create(h.NUM);let C;return d?C=kr(f,m):C=Eh(f,m),Number.isNaN(C)||!Number.isFinite(C)?g.create(h.NUM):y.create(C)}}class eE extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.mapValue((c,l,f)=>{const m=a.get(l,f);return c.isError()?c:m.isError()?m:this._handleSingleObject(c,m)});return r===1&&n===1?u.get(0,0):u}_handleSingleObject(e,t){const{isError:r,errorObject:n,variants:s}=F(e,t);if(r)return n;const[a,u]=s,c=+a.getValue(),l=Math.floor(+u.getValue());if(c<0||l<1||l>10**10)return g.create(h.NUM);const f=kr(-c,l)*2;return Number.isNaN(f)||!Number.isFinite(f)?g.create(h.NUM):y.create(f)}}class tE extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.mapValue((c,l,f)=>{const m=a.get(l,f);return c.isError()?c:m.isError()?m:this._handleSingleObject(c,m)});return r===1&&n===1?u.get(0,0):u}_handleSingleObject(e,t){const{isError:r,errorObject:n,variants:s}=F(e,t);if(r)return n;const[a,u]=s,c=+a.getValue(),l=Math.floor(+u.getValue());if(l<1||l>10**10)return g.create(h.NUM);const f=kr(-c,l);return Number.isNaN(f)||!Number.isFinite(f)?g.create(h.NUM):y.create(f)}}class rE extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.mapValue((c,l,f)=>{const m=a.get(l,f);return c.isError()?c:m.isError()?m:this._handleSingleObject(c,m)});return r===1&&n===1?u.get(0,0):u}_handleSingleObject(e,t){const{isError:r,errorObject:n,variants:s}=F(e,t);if(r)return n;const[a,u]=s,c=+a.getValue(),l=Math.floor(+u.getValue());if(c<=0||c>1||l<1||l>10**10)return g.create(h.NUM);const f=ss(c,l);return Number.isNaN(f)||!Number.isFinite(f)?g.create(h.NUM):y.create(f)}}class nE extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",4)}calculate(e,t,r,n){const{isError:s,errorObject:a}=as(e,t,r);if(s)return a;const u=ht(e);if(u instanceof g)return u;const c=this._getKnownXsValues(u,t);if(c instanceof g)return c;const l=this._getNewXsValues(c,r);if(l instanceof g)return l;let f=n!=null?n:I.create(!0);if(f.isArray()&&(f=f.get(0,0)),f.isString()&&(f=f.convertToNumberObjectValue()),f.isError())return f;const m=+f.getValue();return this._getResult(u,c,l,m)}_getResult(e,t,r,n){return e.length===1&&t.length>1||e[0].length===1&&t[0].length>1?e.length===1&&t.length>1&&(n?t.length+1:t.length)>e[0].length||e[0].length===1&&t[0].length>1&&(n?t[0].length+1:t[0].length)>e.length?g.create(h.NA):this._getResultByMultipleVariables(e,t,r,n):this._getResultBySimpleVariables(e,t,r,n)}_getResultByMultipleVariables(e,t,r,n){const s=e.length===1&&e[0].length>1,a=us(e,t,r,n,!1);if(a instanceof g)return a;const{coefficients:u,newX:c}=a,l=u[0].length,f=u[0][l-1];let m=[];for(let d=0;d<c.length;d++){m[d]=[];let C=f;for(let _=l-2;_>=0;_--)C+=u[0][l-2-_]*c[d][_];m[d].push(C)}return s&&(m=ft(m)),K.createByArray(m)}_getResultBySimpleVariables(e,t,r,n){const s=e.flat(),a=t.flat(),{slope:u,intercept:c}=os(a,s,n,!1);if(Number.isNaN(u))return g.create(h.NA);const l=r.map(f=>f.map(m=>u*m+c));return K.createByArray(l)}_getKnownXsValues(e,t){return!t||t.isNull()?is(e.length,e[0].length):ht(t)}_getNewXsValues(e,t){return!t||t.isNull()?e:ht(t)}}class sE extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=this._getValues(e);if(t.isArray()){const n=t.mapValue(s=>this._handleSingleObject(r,s));return n.getRowCount()===1&&n.getColumnCount()===1?n.get(0,0):n}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(e instanceof g)return e;const{isError:r,errorObject:n,variants:s}=F(t);if(r)return n;const[a]=s,u=+a.getValue();if(u<0||u>=1)return g.create(h.NUM);const c=We(e.length*u/2,0)*2,l=e.slice(c/2,e.length-c/2),f=l.reduce((m,d)=>m+d,0)/l.length;return y.create(f)}_getValues(e){const t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let s=0;s<t;s++)for(let a=0;a<r;a++){const u=e.isArray()?e.get(s,a):e;if(u.isError())return u;if(u.isNull()||u.isBoolean())continue;const c=u.getValue();M.isRealNum(c)&&n.push(+c)}return n.length===0?g.create(h.NUM):n.sort((s,a)=>s-a)}}class aE extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=this.flattenArray(e,!1);return t.isError()?t:t.var(1)}}class iE extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){const t=this.flattenArray(e,!1);return t.isError()?t:t.var()}}const sc=[[F_,x.AVEDEV],[k_,x.AVERAGE],[$_,x.AVERAGE_WEIGHTED],[Y_,x.AVERAGEA],[H_,x.AVERAGEIF],[G_,x.AVERAGEIFS],[W_,x.BETA_DIST],[au,x.BETA_INV],[iu,x.BINOM_DIST],[Q_,x.BINOM_DIST_RANGE],[ou,x.BINOM_INV],[q_,x.CHISQ_DIST],[uu,x.CHISQ_DIST_RT],[X_,x.CHISQ_INV],[cu,x.CHISQ_INV_RT],[lu,x.CHISQ_TEST],[fu,x.CONFIDENCE_NORM],[K_,x.CONFIDENCE_T],[Z_,x.CORREL],[z_,x.COUNT],[J_,x.COUNTA],[eA,x.COUNTBLANK],[tA,x.COUNTIF],[rA,x.COUNTIFS],[mu,x.COVARIANCE_P],[sA,x.COVARIANCE_S],[aA,x.DEVSQ],[hu,x.EXPON_DIST],[iA,x.F_DIST],[gu,x.F_DIST_RT],[oA,x.F_INV],[du,x.F_INV_RT],[Cu,x.F_TEST],[uA,x.FISHER],[cA,x.FISHERINV],[Oi,x.FORECAST],[Oi,x.FORECAST_LINEAR],[lA,x.FREQUENCY],[fA,x.GAMMA],[_u,x.GAMMA_DIST],[Au,x.GAMMA_INV],[Si,x.GAMMALN],[Si,x.GAMMALN_PRECISE],[mA,x.GAUSS],[hA,x.GEOMEAN],[gA,x.GROWTH],[dA,x.HARMEAN],[CA,x.HYPGEOM_DIST],[_A,x.INTERCEPT],[AA,x.KURT],[EA,x.LARGE],[RA,x.LINEST],[bA,x.LOGEST],[yA,x.LOGNORM_DIST],[Eu,x.LOGNORM_INV],[pA,x.MARGINOFERROR],[NA,x.MAX],[VA,x.MAXA],[OA,x.MAXIFS],[SA,x.MEDIAN],[MA,x.MIN],[DA,x.MINA],[wA,x.MINIFS],[LA,x.MODE_MULT],[Ru,x.MODE_SNGL],[PA,x.NEGBINOM_DIST],[bu,x.NORM_DIST],[yu,x.NORM_INV],[xA,x.NORM_S_DIST],[pu,x.NORM_S_INV],[jA,x.PEARSON],[UA,x.PERCENTILE_EXC],[Nu,x.PERCENTILE_INC],[TA,x.PERCENTRANK_EXC],[Vu,x.PERCENTRANK_INC],[vA,x.PERMUT],[IA,x.PERMUTATIONA],[FA,x.PHI],[Ou,x.POISSON_DIST],[BA,x.PROB],[kA,x.QUARTILE_EXC],[Su,x.QUARTILE_INC],[$A,x.RANK_AVG],[YA,x.RANK_EQ],[HA,x.RSQ],[GA,x.SKEW],[WA,x.SKEW_P],[QA,x.SLOPE],[qA,x.SMALL],[XA,x.STANDARDIZE],[Mu,x.STDEV_P],[Du,x.STDEV_S],[KA,x.STDEVA],[ZA,x.STDEVPA],[zA,x.STEYX],[JA,x.T_DIST],[eE,x.T_DIST_2T],[tE,x.T_DIST_RT],[rE,x.T_INV],[wu,x.T_INV_2T],[Lu,x.T_TEST],[nE,x.TREND],[sE,x.TRIMMEAN],[Pu,x.VAR_P],[xu,x.VAR_S],[aE,x.VARA],[iE,x.VARPA],[ju,x.WEIBULL_DIST],[Uu,x.Z_TEST]];class oE extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){let r=t!=null?t:y.create(0);if(t!=null&&t.isNull()&&(r=y.create(0)),r.isArray()){const n=r.mapValue(s=>this._handleSingleObject(e,s));return n.getRowCount()===1&&n.getColumnCount()===1?n.get(0,0):n}return this._handleSingleObject(e,r)}_handleSingleObject(e,t){const r=this._checkArray(e);if(r.isError())return r;const{isError:n,errorObject:s,variants:a}=F(t);if(n)return s;const[u]=a,c=+u.getValue(),l=e.isArray()?e.getRowCount():1,f=e.isArray()?e.getColumnCount():1;let m="";for(let d=0;d<l;d++)for(let C=0;C<f;C++){const _=e.isArray()?e.get(d,C):e;let E=`${_.getValue()}`;_.isNull()&&(E=""),_.isBoolean()&&(E=E.toLocaleUpperCase()),_.isString()&&c?m+=`"${E}"`:m+=E,d===l-1&&C===f-1||(c?C===f-1?m+=";":m+=",":m+=", ")}return c&&(m=`{${m}}`),m.length>32767?g.create(h.CALC):T.create(m)}_checkArray(e){if(e.isArray()){const t=e.getRowCount(),r=e.getColumnCount();return t>1||r>1?e:e.get(0,0)}return e}}class uE extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError()||e.isNull()||e.isBoolean()||e.isNumber())return e;const t=e.getValue().toLocaleString();let r="";for(let n=0;n<t.length;n++){let s=t.charCodeAt(n);s===12288?s=32:s>=65281&&s<=65374&&(s-=65248),r+=String.fromCharCode(s)}return T.create(r)}}class cE extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=F(e);if(t)return r;const[s]=n,a=+s.getValue(),u=Math.abs(Number.parseInt(a.toString(),10)),c=Number.parseFloat((Math.abs(a)-u).toFixed(2));let l="";return u===0?c!==0?l=`${a<0?"ลบ":""}${this._convertNumberToThaiText(c*100)}สตางค์`:l="ศูนย์บาทถ้วน":c===0?l=`${a<0?"ลบ":""}${this._convertNumberToThaiText(u)}บาทถ้วน`:l=`${a<0?"ลบ":""}${this._convertNumberToThaiText(u)}บาท${this._convertNumberToThaiText(c*100)}สตางค์`,T.create(l)}_convertNumberToThaiText(e){const t=["ล้าน","สิบ","ร้อย","พัน","หมื่น","แสน",""],r=["ศูนย์","หนึ่ง","สอง","สาม","สี่","ห้า","หก","เจ็ด","แปด","เก้า"],n=["ลบ","บาท","ถ้วน","สตางค์","ยี่","เอ็ด",","," ","฿"],s=e.toString(),a=s.length;let u="";for(let c=a;c>0;c--){const l=Number.parseInt(s.charAt(a-c),10);let f=r[l];const m=c>1?(c-1)%6:6;if(m===1&&l===2&&(f=n[4]),l===1)switch(m){case 0:case 6:u+=c<a?n[5]:f;break;case 1:break;default:u+=f;break}else if(l===0){m===0&&(u+=t[m]);continue}else u+=f;u+=t[m]}return u}}const lE=Object.values(M.DataStreamTreeTokenType).filter(i=>[M.DataStreamTreeTokenType.TABLE_START,M.DataStreamTreeTokenType.TABLE_ROW_START,M.DataStreamTreeTokenType.TABLE_CELL_START,M.DataStreamTreeTokenType.TABLE_CELL_END,M.DataStreamTreeTokenType.TABLE_ROW_END,M.DataStreamTreeTokenType.TABLE_END,M.DataStreamTreeTokenType.CUSTOM_BLOCK].includes(i));class fE extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=F(e);if(t)return r;const[s]=n,a=Math.floor(+s.getValue());if(a<=0)return g.create(h.VALUE);let u=String.fromCharCode(a);return lE.some(c=>c===u)&&(u=""),T.create(u)}}class mE extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError()||e.isBoolean()||e.isNumber())return e;if(e.isNull())return T.create("");const r=`${e.getValue()}`.replace(/[\0-\x1F]/g,"");return T.create(r)}}class hE extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return g.create(h.VALUE);let t=e.getValue().toLocaleString();if(e.isBoolean()&&(t=t.toLocaleUpperCase()),t==="")return g.create(h.VALUE);const r=t.charCodeAt(0);return y.create(r)}}class gE extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t="",r=null;for(const n of e)if(n.isArray()){if(n.iterator(s=>{if(s==null||s.isNull())return!0;if(s.isError())return r=s,!1;s.isBoolean()?t+=`${s.getValue()}`.toLocaleUpperCase():(s.isString()||s.isNumber())&&(t+=s.getValue())}),r)return r}else!n.isError()&&!n.isNull()&&(t+=n.getValue());return T.create(t)}}class dE extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",255)}calculate(...e){let t=0,r=0;e.forEach(s=>{if(s.isArray()){const a=s;t=Math.max(t,a.getRowCount()),r=Math.max(r,a.getColumnCount())}else t=Math.max(t,1),r=Math.max(r,1)});let n=null;for(const s of e)n=O(t,r,s,g.create(h.NA)).mapValue((u,c,l)=>{const f=n&&n.get(c,l);if(f!=null&&f.isError())return f;if(u.isError())return u;let m=f==null?void 0:f.getValue(),d=u==null?void 0:u.getValue();f!=null&&f.isBoolean()&&(m=`${m}`.toLocaleUpperCase()),u!=null&&u.isBoolean()&&(d=`${d}`.toLocaleUpperCase());const C=f!=null&&f.isNull()?"":m!=null?m:"",_=u!=null&&u.isNull()?"":d!=null?d:"";return T.create(`${C}${_}`)});return n||g.create(h.VALUE)}}class CE extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return T.create("");let t=`${e.getValue()}`;e.isBoolean()&&(t=t.toLocaleUpperCase());let r="";for(let n=0;n<t.length;n++){const s=t.charCodeAt(n);s>=33&&s<=126?r+=String.fromCharCode(s+65248):s===32?r+="　":r+=t.charAt(n)}return T.create(r)}}class _E extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2);A(this,"needsLocale",!0)}calculate(e,t){let r=t!=null?t:y.create(2);r.isNull()&&(r=y.create(2));const n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,r,g.create(h.NA)),c=a.mapValue((l,f,m)=>{const d=u.get(f,m);return l.isError()?l:d.isError()?d:this._handleSingleObject(l,d)});return n===1&&s===1?c.get(0,0):c}_handleSingleObject(e,t){const{isError:r,errorObject:n,variants:s}=F(e,t);if(r)return n;const[a,u]=s;let c=+a.getValue(),l=Math.trunc(+u.getValue());if(l>127)return g.create(h.VALUE);l<0&&(`${c}`.length<Math.abs(l)?c=0:c=c<0?-Pt(Math.abs(c),l):Pt(c,l),l=0);const f=Ul(this.getLocale(),c,l);return T.create(f)}}class AE extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,ce.create()),a=O(r,n,t,ce.create()),u=s.mapValue((c,l,f)=>{const m=a.get(l,f);return c.isError()?c:m.isError()?m:this._handleSingleObject(c,m)});return r===1&&n===1?u.get(0,0):u}_handleSingleObject(e,t){if(e.isNull()||t.isNull()){const a=e.isNull()&&t.isNull();return I.create(a)}let r=`${e.getValue()}`;e.isBoolean()&&(r=r.toLocaleUpperCase());let n=`${t.getValue()}`;t.isBoolean()&&(n=n.toLocaleUpperCase());const s=r===n;return I.create(s)}}const va=(i,o)=>M.numfmt.format(i,o,{throws:!1}),Me=i=>{let o=`${i.getValue()}`;return i.isNull()&&(o=""),i.isBoolean()&&(o=o.toLocaleUpperCase()),i.isNumber()&&(i.getPattern()!==""?o=va(i.getPattern(),+i.getValue()):o=`${Kn(+i.getValue())}`),o};class EE extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){const n=r!=null?r:y.create(1),s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,n,g.create(h.NA)),f=u.mapValue((m,d,C)=>{const _=c.get(d,C),E=l.get(d,C);return m.isError()?m:_.isError()?_:E.isError()?E:this._handleSingleObject(m,_,E)});return s===1&&a===1?f.get(0,0):f}_handleSingleObject(e,t,r){const n=Me(e),s=Me(t),{isError:a,errorObject:u,variants:c}=F(r);if(a)return u;const[l]=c,f=Math.floor(+l.getValue());if(t.isNull()||f<=0||f>s.length)return g.create(h.VALUE);if(e.isNull()||n.length===0)return y.create(f);const m=s.indexOf(n,f-1);return m===-1?g.create(h.VALUE):y.create(m+1)}}function Ia(i){let o=0;for(let e=0;e<i.length;e++)o+=Gr(i,e);return o}function Gr(i,o,e="ltr"){return RE(i,o,e)>255?2:1}function Mi(i){return i>=55296&&i<=56319}function Di(i){return i>=56320&&i<=57343}function wi(i,o){const e=(i&1023)<<10,t=o&1023;return e+t+65536}function RE(i,o,e="ltr"){const t=i.charCodeAt(o);if(e==="ltr"&&Mi(t)&&o+1<i.length){const r=i.charCodeAt(o+1);if(Di(r))return wi(t,r)}if(e==="rtl"&&Di(t)&&o-1>=0){const r=i.charCodeAt(o-1);if(Mi(r))return wi(r,t)}return t}class bE extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){const n=r!=null?r:y.create(1),s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,n,g.create(h.NA)),f=u.mapValue((m,d,C)=>{const _=c.get(d,C),E=l.get(d,C);return m.isError()?m:_.isError()?_:E.isError()?E:this._handleSingleObject(m,_,E)});return s===1&&a===1?f.get(0,0):f}_handleSingleObject(e,t,r){const n=Me(e),s=Me(t),{isError:a,errorObject:u,variants:c}=F(r);if(a)return u;const[l]=c,f=Math.floor(+l.getValue());if(t.isNull()||f<=0||f>s.length)return g.create(h.VALUE);if(e.isNull()||n.length===0)return y.create(f);const m=s.indexOf(n,f-1);if(m===-1)return g.create(h.VALUE);const d=Ia(s.substring(0,m))+1;return y.create(d)}}class yE extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",3)}calculate(e,t,r){let n=t!=null?t:y.create(2);n.isNull()&&(n=y.create(2));let s=r!=null?r:I.create(!1);s.isNull()&&(s=I.create(!1));const a=Math.max(e.isArray()?e.getRowCount():1,n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1),c=O(a,u,e,g.create(h.NA)),l=O(a,u,n,g.create(h.NA)),f=O(a,u,s,g.create(h.NA)),m=c.mapValue((d,C,_)=>{const E=l.get(C,_),R=f.get(C,_);return d.isError()?d:E.isError()?E:R.isError()?R:this._handleSingleObject(d,E,R)});return a===1&&u===1?m.get(0,0):m}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:a}=F(e,t,r);if(n)return s;const[u,c,l]=a;let f=+u.getValue(),m=Math.trunc(+c.getValue());const d=+l.getValue();if(m>127)return g.create(h.VALUE);m<0&&(`${f}`.length<Math.abs(m)?f=0:f=f<0?-Pt(Math.abs(f),m):Pt(f,m),m=0);let C=d?"###0":"#,##0";m>0&&(C+=`.${"0".repeat(m)}`);const _=va(C,f);return T.create(_)}}class pE extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){const r=t!=null?t:y.create(1),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,r,g.create(h.NA)),c=a.mapValue((l,f,m)=>{const d=u.get(f,m);return l.isError()?l:d.isError()?d:this._handleSingleObject(l,d)});return n===1&&s===1?c.get(0,0):c}_handleSingleObject(e,t){const r=Me(e),{isError:n,errorObject:s,variants:a}=F(t);if(n)return s;const[u]=a,c=Math.floor(+u.getValue());if(c<0)return g.create(h.VALUE);if(e.isNull()||c===0)return T.create("");if(c>=r.length)return T.create(r);const l=r.substring(0,c);return T.create(l)}}class NE extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){const r=t!=null?t:y.create(1),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,ce.create()),u=O(n,s,r,ce.create()),c=a.mapValue((l,f,m)=>{const d=u.get(f,m);return l.isError()?l:d.isError()?d:this._handleSingleObject(l,d)});return n===1&&s===1?c.get(0,0):c}_handleSingleObject(e,t){const r=Me(e),{isError:n,errorObject:s,variants:a}=F(t);if(n)return s;const[u]=a,c=Math.floor(+u.getValue());if(c<0)return g.create(h.VALUE);if(e.isNull()||c===0)return T.create("");let l=0,f=0,m="";for(;f<c&&l<r.length;)f+=Gr(r,l),m+=r.charAt(l),l++;return T.create(m)}}class VE extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleText(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleText(e)}_handleSingleText(e){if(e.isError())return e;const t=Me(e);return y.create(t.length)}}class OE extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleText(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleText(e)}_handleSingleText(e){if(e.isError())return e;const t=Me(e),r=Ia(t);return y.create(r)}}class SE extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return T.create("");const t=`${e.getValue()}`.toLocaleLowerCase();return T.create(t)}}class ME extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSingleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const n=Me(e),{isError:s,errorObject:a,variants:u}=F(t,r);if(s)return a;const[c,l]=u,f=Math.floor(+c.getValue()),m=Math.floor(+l.getValue());if(f<=0||m<0)return g.create(h.VALUE);if(e.isNull()||f>n.length||m===0)return T.create("");const d=n.substring(f-1,f-1+m);return T.create(d)}}class DE extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,t,g.create(h.NA)),c=O(n,s,r,g.create(h.NA)),l=a.mapValue((f,m,d)=>{const C=u.get(m,d),_=c.get(m,d);return f.isError()?f:C.isError()?C:_.isError()?_:this._handleSingleObject(f,C,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){let n=Me(e);const{isError:s,errorObject:a,variants:u}=F(t,r);if(s)return a;const[c,l]=u,f=Math.floor(+c.getValue()),m=Math.floor(+l.getValue());if(f<=0||m<0)return g.create(h.VALUE);if(e.isNull()||f>n.length||m===0)return T.create("");n=n.substring(f-1);let d=0,C=0,_="";for(;C<m&&d<n.length;)C+=Gr(n,d),_+=n.charAt(d),d++;return T.create(_)}}const br=["〇","一","二","三","四","五","六","七","八","九"],zr=["零","壹","贰","叁","肆","伍","陆","柒","捌","玖"],wE=["","十","百","千"],LE=["","拾","佰","仟"],PE=["","万","亿","兆"];class xE extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.mapValue((c,l,f)=>{const m=a.get(l,f);return c.isError()?c:m.isError()?m:this._handleSingleObject(c,m)});return r===1&&n===1?u.get(0,0):u}_handleSingleObject(e,t){const r=e.convertToNumberObjectValue();if(r.isError())return r;const n=t.convertToNumberObjectValue();if(n.isError())return n;let s=r.getValue();const a=Math.trunc(n.getValue());if(s<0||![1,2,3].includes(a))return g.create(h.NUM);s=Math.round(s);const u=s.toString(),c=u.length;let l="",f=!1;for(let m=0;m<c;m++){const d=Number(u[m]);if(c===1&&d===0){l+=a===2?zr[0]:br[0];break}if(a===3){l+=br[d];continue}const C=c-m-1,_=C%4,E=Math.trunc(C/4);if(c>=17&&E>2){if(l+=a===1?br[d]:zr[d],E>3)continue}else d===0?f=_!==0:(f&&(l+=a===1?br[0]:zr[0],f=!1),l+=a===1?br[d]+wE[_]:zr[d]+LE[_]);_===0&&E>0&&u.slice(Math.max(0,m-3),m+1)!=="0000"&&(l+=PE[E])}return T.create(l)}}class jE extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",3)}isArgumentsIgnoreNumberPattern(){return!0}calculate(e,t,r){const n=t!=null?t:T.create("."),s=Math.max(e.isArray()?e.getRowCount():1,n.isArray()?n.getRowCount():1,r!=null&&r.isArray()?r.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,n.isArray()?n.getColumnCount():1,r!=null&&r.isArray()?r.getColumnCount():1),u=O(s,a,e,g.create(h.NA)),c=O(s,a,n,g.create(h.NA)),l=r?O(s,a,r,g.create(h.NA)):void 0,f=u.mapValue((m,d,C)=>{const _=c.get(d,C),E=r?l.get(d,C):void 0;return m.isError()?m:_.isError()?_:E!=null&&E.isError()?E:_.isNull()||E!=null&&E.isNull()?g.create(h.VALUE):m.isNull()?y.create(0):this._handleSingleObject(m,_,E)});return s===1&&a===1?f.get(0,0):f}_handleSingleObject(e,t,r){let n=`${e.getValue()}`;n=n.replace(/\s+/g,"");let s=`${t.getValue()}`;t.isBoolean()&&(s=s.toLocaleUpperCase()),s=s.charAt(0);let a;if(r&&(a=`${r.getValue()}`,r.isBoolean()&&(a=a.toLocaleUpperCase()),a=a.charAt(0),s===a))return g.create(h.VALUE);if(n.trim()==="")return y.create(0);if(!n.match(/^\s*[+-]?\s*(?:(?:\d+(?:\.\d*)?)|(?:\.\d+))(?:[eE][+-]?\d+)?[ \t]*/))return g.create(h.VALUE);const u=n.split(s);if(u.length>2)return g.create(h.VALUE);let c=u[0].replace(/,/g,"");r&&(c=c.split(a).join(""));let l=0;if(u.length===1){s===","&&(c=c.replace(/\./g,""));let f=0;for(;c.endsWith("%");)c=c.slice(0,-1),f++;f>0?l=+c/100**f:l=+c}else{if(!M.isRealNum(c))return g.create(h.VALUE);let f=u[1],m=0;for(;f.endsWith("%");)f=f.slice(0,-1),m++;const d=`${c}.${f}`;if(!M.isRealNum(d))return g.create(h.VALUE);m>0?l=+d/100**m:l=+d}return Number.isNaN(l)?g.create(h.VALUE):y.create(l)}}class UE extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError()||e.isNull()||e.isBoolean()||e.isNumber())return e;const r=e.getValue().toLocaleString().toLocaleLowerCase().replace(/(^|\b|\W|\d|_)[a-z]/g,n=>n.toLocaleUpperCase());return T.create(r)}}const ac=()=>[{type:4,from:48,to:57}],ic=()=>[{type:7,value:95},{type:4,from:97,to:122},{type:4,from:65,to:90},{type:4,from:48,to:57}],oc=()=>[{type:7,value:9},{type:7,value:10},{type:7,value:11},{type:7,value:12},{type:7,value:13},{type:7,value:32},{type:7,value:160},{type:7,value:5760},{type:4,from:8192,to:8202},{type:7,value:8232},{type:7,value:8233},{type:7,value:8239},{type:7,value:8287},{type:7,value:12288},{type:7,value:65279}],uc=()=>({type:3,set:ic(),not:!1}),cc=()=>({type:3,set:ic(),not:!0}),lc=()=>({type:3,set:ac(),not:!1}),fc=()=>({type:3,set:ac(),not:!0}),mc=()=>({type:3,set:oc(),not:!1}),hc=()=>({type:3,set:oc(),not:!0}),TE=()=>({type:3,set:[{type:7,value:10},{type:7,value:13},{type:7,value:8232},{type:7,value:8233}],not:!0});function vE(i){const o={type:0,stack:[]};let e=o,t=o.stack;const r=[],n=[];let s=0;const a=f=>{throw new SyntaxError(`Invalid regular expression: /${i}/: Nothing to repeat at column ${f-1}`)},u=FE(i);let c=0,l;for(;c<u.length;)switch(l=u[c++],l){case"\\":if(c===u.length)throw new SyntaxError(`Invalid regular expression: /${i}/: \\ at end of pattern`);switch(l=u[c++],l){case"b":t.push({type:2,value:"b"});break;case"B":t.push({type:2,value:"B"});break;case"w":t.push(uc());break;case"W":t.push(cc());break;case"d":t.push(lc());break;case"D":t.push(fc());break;case"s":t.push(mc());break;case"S":t.push(hc());break;default:if(/\d/.test(l)){for(;/\d/.test(u[c])&&c<u.length;)l+=u[c++];const f=Number.parseInt(l,10);t.push({type:6,value:f}),n.push({reference:{type:6,value:f},stack:t,index:t.length-1})}else t.push({type:7,value:l.charCodeAt(0)})}break;case"^":t.push({type:2,value:"^"});break;case"$":t.push({type:2,value:"$"});break;case"[":{const f=u[c]==="^";f&&c++;const m=IE(u.slice(c),i);c+=m[1],t.push({type:3,set:m[0],not:f});break}case".":t.push(TE());break;case"(":{const f={type:1,stack:[],remember:!0};if(u[c]==="?"){const m=u[c+1];if(c+=2,m==="=")f.followedBy=!0;else if(m==="!")f.notFollowedBy=!0;else if(m!==":")throw new SyntaxError(`Invalid regular expression: /${i}/: Invalid group, character '${m}' after '?' at column ${c-1}`);f.remember=!1}else s+=1;t.push(f),r.push(e),e=f,t=f.stack;break}case")":if(r.length===0)throw new SyntaxError(`Invalid regular expression: /${i}/: Unmatched ) at column ${c-1}`);e=r.pop(),t=e.options?e.options[e.options.length-1]:e.stack;break;case"|":{e.options||(e.options=[e.stack],delete e.stack);const f=[];e.options.push(f),t=f;break}case"{":{const f=/^(\d+)(,(\d+)?)?\}/.exec(u.slice(c));if(f){t.length===0&&a(c);const m=Number.parseInt(f[1],10),d=f[2]?f[3]?Number.parseInt(f[3],10):1/0:m;c+=f[0].length,t.push({type:5,min:m,max:d,value:t.pop()})}else t.push({type:7,value:123});break}case"?":t.length===0&&a(c),t.push({type:5,min:0,max:1,value:t.pop()});break;case"+":t.length===0&&a(c),t.push({type:5,min:1,max:1/0,value:t.pop()});break;case"*":t.length===0&&a(c),t.push({type:5,min:0,max:1/0,value:t.pop()});break;default:t.push({type:7,value:l.charCodeAt(0)})}if(r.length>0)throw new SyntaxError(`Invalid regular expression: /${i}/: Unterminated group`);return BE(n,s),o}function IE(i,o){let e;const t=[],r=/\\(?:(w)|(d)|(s)|(W)|(D)|(S))|((?:(?:\\)(.)|([^\]\\]))-(((?:\\)])|(((?:\\)?([^\]])))))|(\])|(?:\\)?([^])/g;for(;(e=r.exec(i))!==null;){let n=null;const[,s,a,u,c,l,f,m,d,C,_]=e;if(s||a||u||c||l||f?n=(()=>{let E={type:3,set:[],not:!1};return s?E=uc():a?E=lc():u?E=mc():c?E=cc():l?E=fc():f&&(E=hc()),E})():m&&_?n={type:4,from:(d||C).charCodeAt(0),to:_.charCodeAt(_.length-1)}:e[16]&&(n={type:7,value:e[16].charCodeAt(0)}),!n)return[t,r.lastIndex];t.push(n)}throw new SyntaxError(`Invalid regular expression: /${o}/: Unterminated character class`)}function FE(i){return i.replace(/(\[\\b\])|(\\)?\\(?:u([A-F0-9]{4})|x([A-F0-9]{2})|c([@A-Z[\\\]^?])|([0tnvfr]))/g,(o,e,t,r,n,s,a)=>{if(t)return o;let u;e?u=8:r?u=Number.parseInt(r,16):n?u=Number.parseInt(n,16):s?u="@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^ ?".indexOf(s):u={0:0,t:9,n:10,v:11,f:12,r:13}[a];const c=String.fromCharCode(u);return/[[\]{}^$.|?*+()]/.test(c)?`\\${c}`:c})}function BE(i,o){for(const e of i.reverse()){const t=e.reference.value;if(o<t){e.reference.type=7;const r=t.toString();if(e.reference.value=Number.parseInt(r,8),!/^[0-7]+$/.test(r)){let n=0;for(;r[n]!=="8"&&r[n]!=="9"&&n<r.length;)n+=1;if(n===0?(e.reference.value=r.charCodeAt(0),n+=1):e.reference.value=Number.parseInt(r.slice(0,n),8),r.length>n){const s=e.stack.splice(e.index+1);for(const a of r.slice(n))e.stack.push({type:7,value:a.charCodeAt(0)});e.stack.push(...s)}}}}}function Fa(i,o){if(!kE(i))return{isError:!0,regExp:null};try{const e=new RegExp(i,o?"ug":"u");return $E(e)?{isError:!1,regExp:e}:{isError:!0,regExp:null}}catch{return{isError:!0,regExp:null}}}function kE(i){return!(/\(\?<=.*?\)/g.test(i)&&!/\[.*?(\?<=.*?)\]/g.test(i)||/\(\?<!.*?\)/g.test(i)&&!/\[.*?(\?<!.*?)\]/g.test(i))}function $E(i,o){let t;Object.prototype.toString.call(i)==="[object RegExp]"?t=i.source:i&&typeof i!="string"&&(t=`${i}`);let r;try{r=vE(t)}catch{return!1}let n=0;const s=(a,u)=>{let c=u;if(a.type===5&&(c++,n++,c>1||n>25))return!1;if(a.options){for(const f of a.options)if(!s({stack:f},c))return!1}const l=a.stack||a.value&&a.value.stack;if(!l)return!0;for(const f of l)if(!s(f,c))return!1;return!0};return s(r,0)}class YE extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,variants:s}=Fr(e,t);if(r)return n;const[a,u]=s;let c=a.getValue();a.isNull()&&(c=""),a.isBoolean()&&(c=c?"TRUE":"FALSE"),c=`${c}`;let l=u.getValue();u.isNull()&&(l=""),u.isBoolean()&&(l=l?"TRUE":"FALSE"),l=`${l}`;const{isError:f,regExp:m}=Fa(l,!1);if(f)return g.create(h.REF);const d=c.match(m);if(d===null)return g.create(h.NA);if(d.length>1){const C=d.slice(1).map(_=>T.create(_));return C.length>1?K.create({calculateValueList:[C],rowCount:1,columnCount:C.length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column}):C[0]}return T.create(d[0])}}class HE extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,variants:s}=Fr(e,t);if(r)return n;const[a,u]=s;let c=a.getValue();a.isNull()&&(c=""),a.isBoolean()&&(c=c?"TRUE":"FALSE"),c=`${c}`;let l=u.getValue();u.isNull()&&(l=""),u.isBoolean()&&(l=l?"TRUE":"FALSE"),l=`${l}`;const{isError:f,regExp:m}=Fa(l,!1);return f?g.create(h.REF):c.match(m)===null?I.create(!1):I.create(!0)}}class GE extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,variants:a}=Fr(e,t,r);if(n)return s;const[u,c,l]=a;let f=u.getValue();u.isNull()&&(f=""),u.isBoolean()&&(f=f?"TRUE":"FALSE"),f=`${f}`;let m=c.getValue();c.isNull()&&(m=""),c.isBoolean()&&(m=m?"TRUE":"FALSE"),m=`${m}`;let d=l.getValue();l.isNull()&&(d=""),l.isBoolean()&&(d=d?"TRUE":"FALSE"),d=`${d}`;const{isError:C,regExp:_}=Fa(m,!0);if(C)return g.create(h.REF);const E=f.replace(_,d);return T.create(E)}}class WE extends N{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA)),f=O(s,a,n,g.create(h.NA)),m=u.mapValue((d,C,_)=>{const E=c.get(C,_),R=l.get(C,_),b=f.get(C,_);return d.isError()?d:E.isError()?E:R.isError()?R:b.isError()?b:this._handleSingleObject(d,E,R,b)});return s===1&&a===1?m.get(0,0):m}_handleSingleObject(e,t,r,n){const{isError:s,errorObject:a,variants:u}=F(t,r);if(s)return a;const[c,l]=u,f=Math.floor(+c.getValue()),m=Math.floor(+l.getValue());if(f<=0||m<0)return g.create(h.VALUE);const d=Me(e),C=Me(n),_=d.substring(0,f-1)+C+d.substring(f-1+m);return T.create(_)}}class QE extends N{constructor(){super(...arguments);A(this,"minParams",4);A(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA)),f=O(s,a,n,g.create(h.NA)),m=u.mapValue((d,C,_)=>{const E=c.get(C,_),R=l.get(C,_),b=f.get(C,_);return d.isError()?d:E.isError()?E:R.isError()?R:b.isError()?b:this._handleSingleObject(d,E,R,b)});return s===1&&a===1?m.get(0,0):m}_handleSingleObject(e,t,r,n){const{isError:s,errorObject:a,variants:u}=F(t,r);if(s)return a;const[c,l]=u,f=Math.floor(+c.getValue()),m=Math.floor(+l.getValue());if(f<=0||m<0)return g.create(h.VALUE);let d=Me(e);const C=Me(n);let _=d.substring(0,f-1);d=d.substring(f-1);let E=0,R=0;for(;R<m&&E<d.length;)R+=Gr(d,E),E++;return _+=C+d.substring(E),T.create(_)}}class qE extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e,g.create(h.NA)),a=O(r,n,t,g.create(h.NA)),u=s.map((c,l,f)=>{let m=a.get(l,f);if(c.isError())return c;let d=c.getValue();if(c.isNull()&&(d=""),c.isBoolean()&&(d=d?"TRUE":"FALSE"),d+="",m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;const C=32767,_=Math.floor(+m.getValue());if(_<0||_>C/d.length)return g.create(h.VALUE);const E=d.repeat(_);return T.create(E)});return r===1&&n===1?u.get(0,0):u}}class XE extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){const r=t!=null?t:y.create(1),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,r,g.create(h.NA)),c=a.mapValue((l,f,m)=>{const d=u.get(f,m);return l.isError()?l:d.isError()?d:this._handleSingleObject(l,d)});return n===1&&s===1?c.get(0,0):c}_handleSingleObject(e,t){const r=Me(e),{isError:n,errorObject:s,variants:a}=F(t);if(n)return s;const[u]=a,c=Math.floor(+u.getValue());if(c<0)return g.create(h.VALUE);if(e.isNull()||c===0)return T.create("");if(c>=r.length)return T.create(r);const l=r.substring(r.length-c);return T.create(l)}}class KE extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){const r=t!=null?t:y.create(1),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,r,g.create(h.NA)),c=a.mapValue((l,f,m)=>{const d=u.get(f,m);return l.isError()?l:d.isError()?d:this._handleSingleObject(l,d)});return n===1&&s===1?c.get(0,0):c}_handleSingleObject(e,t){const r=Me(e),{isError:n,errorObject:s,variants:a}=F(t);if(n)return s;const[u]=a,c=Math.floor(+u.getValue());if(c<0)return g.create(h.VALUE);if(e.isNull()||c===0)return T.create("");let l=r.length-1,f=0,m="";for(;f<c&&l>=0;)f+=Gr(r,l,"rtl"),m=r.charAt(l)+m,l--;return T.create(m)}}class ZE extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){const n=r!=null?r:y.create(1),s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,n,g.create(h.NA)),f=u.mapValue((m,d,C)=>{const _=c.get(d,C),E=l.get(d,C);return m.isError()?m:_.isError()?_:E.isError()?E:this._handleSingleObject(m,_,E)});return s===1&&a===1?f.get(0,0):f}_handleSingleObject(e,t,r){const n=Me(e).toLocaleUpperCase(),s=Me(t).toLocaleUpperCase(),{isError:a,errorObject:u,variants:c}=F(r);if(a)return u;const[l]=c,f=Math.floor(+l.getValue());if(t.isNull()||f<=0||f>s.length)return g.create(h.VALUE);if(e.isNull()||n.length===0)return y.create(f);const m=s.indexOf(n,f-1);return m===-1?g.create(h.VALUE):y.create(m+1)}}class zE extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",3)}calculate(e,t,r){const n=r!=null?r:y.create(1),s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),u=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,n,g.create(h.NA)),f=u.mapValue((m,d,C)=>{const _=c.get(d,C),E=l.get(d,C);return m.isError()?m:_.isError()?_:E.isError()?E:this._handleSingleObject(m,_,E)});return s===1&&a===1?f.get(0,0):f}_handleSingleObject(e,t,r){const n=Me(e).toLocaleUpperCase(),s=Me(t).toLocaleUpperCase(),{isError:a,errorObject:u,variants:c}=F(r);if(a)return u;const[l]=c,f=Math.floor(+l.getValue());if(t.isNull()||f<=0||f>s.length)return g.create(h.VALUE);if(e.isNull()||n.length===0)return y.create(f);const m=s.indexOf(n,f-1);if(m===-1)return g.create(h.VALUE);const d=Ia(s.substring(0,m))+1;return y.create(d)}}class JE extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n!=null&&n.isArray()?n.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n!=null&&n.isArray()?n.getColumnCount():1),u=O(s,a,e,g.create(h.NA)),c=O(s,a,t,g.create(h.NA)),l=O(s,a,r,g.create(h.NA)),f=n?O(s,a,n,g.create(h.NA)):void 0,m=u.mapValue((d,C,_)=>{const E=c.get(C,_),R=l.get(C,_);let b=n?f.get(C,_):void 0;return d.isError()?d:E.isError()?E:R.isError()?R:b!=null&&b.isError()?b:b!=null&&b.isNull()||b!=null&&b.isBoolean()?g.create(h.VALUE):(b!=null&&b.isString()&&(b=b.convertToNumberObjectValue()),b!=null&&b.isError()?b:this._handleSingleObject(d,E,R,b))});return s===1&&a===1?m.get(0,0):m}_handleSingleObject(e,t,r,n){const s=this._getObjectString(e),a=this._getObjectString(t),u=this._getObjectString(r),c=n?Math.floor(+n.getValue()):void 0;if(n&&c<=0)return g.create(h.VALUE);if(a==="")return T.create(s);let l="",f=0;for(let m=0;m<s.length;m++){const d=s.substr(m,a.length);if(d===a||d.length===a.length&&d.trim()===a.trim()){if(f++,f===c){l=s.substr(0,m)+u+s.substr(m+a.length);break}c===void 0&&(l+=u),m+=a.length-1}else c===void 0&&(l+=s[m])}return c&&f<c&&(l=s),T.create(l)}_getObjectString(e){let t=`${e.getValue()}`;return e.isNull()&&(t=""),e.isBoolean()&&(t=t.toLocaleUpperCase()),t}}class eR extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1);A(this,"needsReferenceObject",!0)}calculate(e){let t=e;return e.isReferenceObject()&&(t=e.toArrayValueObject().get(0,0)),t.isArray()?t.mapValue(r=>this._handleSingleObject(r)):this._handleSingleObject(t)}_handleSingleObject(e){return e.isError()?e:e.isNull()||e.isBoolean()||e.isNumber()?T.create(""):e}}class tR extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",2)}isArgumentsIgnoreNumberPattern(){return!0}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=O(r,n,e),a=O(r,n,t),u=s.map((c,l,f)=>{if(c.isError())return c;let m=a.get(l,f)||T.create(" ");if(m.isError())return m;if(m.isBoolean())return g.create(h.VALUE);if(c.isBoolean())return c;let d=c.getValue();if(c.isNull()&&(d=0),c.isString())if(M.isRealNum(d))d=Number(d);else{const E=M.getNumfmtParseValueFilter(`${d}`);E&&E.v!=null&&typeof E.v=="number"&&(d=E.v)}m.isNull()&&(m=T.create(" "));const C=`${m.getValue()}`,_=va(C,d);return T.create(C===" "?_.trimEnd():_)});return u.getRowCount()===1&&u.getColumnCount()===1?u.get(0,0):u}}class rR extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",6)}calculate(e,t,r,n,s,a){let u=!1,c=r!=null?r:y.create(1);c.isNull()&&(u=!0,c=y.create(1));const l=!n,f=n!=null?n:y.create(0),m=s!=null?s:y.create(0),d=a!=null?a:g.create(h.NA),C=Math.max(e.isArray()?e.getRowCount():1,c.isArray()?c.getRowCount():1,f.isArray()?f.getRowCount():1,m.isArray()?m.getRowCount():1,d.isArray()?d.getRowCount():1),_=Math.max(e.isArray()?e.getColumnCount():1,c.isArray()?c.getColumnCount():1,f.isArray()?f.getColumnCount():1,m.isArray()?m.getColumnCount():1,d.isArray()?d.getColumnCount():1),E=O(C,_,e,g.create(h.NA)),R=O(C,_,c,g.create(h.NA)),b=O(C,_,f,g.create(h.NA)),p=O(C,_,m,g.create(h.NA)),V=O(C,_,d,g.create(h.NA)),S=this._getResultArray(E,t,R,b,p,V,u,l);return C===1&&_===1?S.get(0,0):S}_getResultArray(e,t,r,n,s,a,u,c){return e.map((f,m,d)=>{const C=r.get(m,d),_=n.get(m,d),E=s.get(m,d),R=a.get(m,d),b=this._checkVariantsError(f,C,_,E);if(b.isError())return b;const p=this._getStringValue(f),V=this._getDelimiterValue(t);if(V instanceof g)return V;const S=this._getVariantsNumberFloorValue(C,_,E);if(S instanceof g)return S;const[D,w,L]=S;return D===0||w<0||w>1||L<0||L>1?g.create(h.VALUE):V.includes("")?D>0?T.create(p):T.create(""):!u&&Math.abs(D)>p.length?g.create(h.VALUE):V.every(P=>P.length>p.length)?g.create(h.NA):this._getResult(p,V,D,w,L,R,c)})}_checkVariantsError(...e){for(let t=0;t<e.length;t++){const r=e[t];if(r.isError())return r}return I.create(!0)}_getStringValue(e){let t=`${e.getValue()}`;return e.isNull()&&(t=""),e.isBoolean()&&(t=t.toLocaleUpperCase()),t}_getDelimiterValue(e){const t=[];if(e.isArray()){let r=!1,n=g.create(h.VALUE);if(e.iterator(s=>{const a=s;if(a.isError())return r=!0,n=a,!1;t.push(this._getStringValue(a))}),r)return n}else{if(e.isError())return e;t.push(this._getStringValue(e))}return t}_getVariantsNumberFloorValue(...e){const t=[];for(let r=0;r<e.length;r++){let n=e[r];if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;const s=Math.floor(+n.getValue());t.push(s)}return t}_getResult(e,t,r,n,s,a,u){let c=n?e.toLocaleLowerCase():e;const l=n?t.map(_=>_.toLocaleLowerCase()):t;let f=0,m=0,d=0;for(let _=0;_<Math.abs(r);_++)if(r<0){const E=l.map(R=>({index:c.lastIndexOf(R),length:R.length})).filter(R=>R.index!==-1).sort((R,b)=>b.index-R.index)[0];if(!E)break;f=E.index,c=c.substr(0,E.index),d=E.length,m++}else{const E=l.map(R=>({index:c.indexOf(R),length:R.length})).filter(R=>R.index!==-1).sort((R,b)=>R.index-b.index)[0];if(!E)break;f+=E.index+d,c=c.substr(E.index+E.length),d=E.length,m++}if(m&&m<Math.abs(r)&&u)return g.create(h.NA);if(!m||m<Math.abs(r))return s?r>0?T.create(""):T.create(e):a;const C=e.substr(f+d);return T.create(C)}}class nR extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",6)}calculate(e,t,r,n,s,a){let u=!1,c=r!=null?r:y.create(1);c.isNull()&&(u=!0,c=y.create(1));const l=!n,f=n!=null?n:y.create(0),m=s!=null?s:y.create(0),d=a!=null?a:g.create(h.NA),C=Math.max(e.isArray()?e.getRowCount():1,c.isArray()?c.getRowCount():1,f.isArray()?f.getRowCount():1,m.isArray()?m.getRowCount():1,d.isArray()?d.getRowCount():1),_=Math.max(e.isArray()?e.getColumnCount():1,c.isArray()?c.getColumnCount():1,f.isArray()?f.getColumnCount():1,m.isArray()?m.getColumnCount():1,d.isArray()?d.getColumnCount():1),E=O(C,_,e,g.create(h.NA)),R=O(C,_,c,g.create(h.NA)),b=O(C,_,f,g.create(h.NA)),p=O(C,_,m,g.create(h.NA)),V=O(C,_,d,g.create(h.NA)),S=this._getResultArray(E,t,R,b,p,V,u,l);return C===1&&_===1?S.get(0,0):S}_getResultArray(e,t,r,n,s,a,u,c){return e.map((f,m,d)=>{const C=r.get(m,d),_=n.get(m,d),E=s.get(m,d),R=a.get(m,d),b=this._checkVariantsError(f,C,_,E);if(b.isError())return b;const p=this._getStringValue(f),V=this._getDelimiterValue(t);if(V instanceof g)return V;const S=this._getVariantsNumberFloorValue(C,_,E);if(S instanceof g)return S;const[D,w,L]=S;return D===0||w<0||w>1||L<0||L>1?g.create(h.VALUE):V.includes("")?D>0?T.create(""):T.create(p):!u&&Math.abs(D)>p.length?g.create(h.VALUE):V.every(P=>P.length>p.length)?g.create(h.NA):this._getResult(p,V,D,w,L,R,c)})}_checkVariantsError(...e){for(let t=0;t<e.length;t++){const r=e[t];if(r.isError())return r}return I.create(!0)}_getStringValue(e){let t=`${e.getValue()}`;return e.isNull()&&(t=""),e.isBoolean()&&(t=t.toLocaleUpperCase()),t}_getDelimiterValue(e){const t=[];if(e.isArray()){let r=!1,n=g.create(h.VALUE);if(e.iterator(s=>{const a=s;if(a.isError())return r=!0,n=a,!1;t.push(this._getStringValue(a))}),r)return n}else{if(e.isError())return e;t.push(this._getStringValue(e))}return t}_getVariantsNumberFloorValue(...e){const t=[];for(let r=0;r<e.length;r++){let n=e[r];if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;const s=Math.floor(+n.getValue());t.push(s)}return t}_getResult(e,t,r,n,s,a,u){let c=n?e.toLocaleLowerCase():e;const l=n?t.map(_=>_.toLocaleLowerCase()):t;let f=0,m=0,d=0;for(let _=0;_<Math.abs(r);_++)if(r<0){const E=l.map(R=>({index:c.lastIndexOf(R),length:R.length})).filter(R=>R.index!==-1).sort((R,b)=>b.index-R.index)[0];if(!E)break;f=E.index,c=c.substr(0,E.index),m++}else{const E=l.map(R=>({index:c.indexOf(R),length:R.length})).filter(R=>R.index!==-1).sort((R,b)=>R.index-b.index)[0];if(!E)break;f+=E.index+d,c=c.substr(E.index+E.length),d=E.length,m++}if(m&&m<Math.abs(r)&&u)return g.create(h.NA);if(!m||m<Math.abs(r))return s?r>0?T.create(e):T.create(""):a;const C=e.substr(0,f);return T.create(C)}}class sR extends N{constructor(){super(...arguments);A(this,"minParams",3);A(this,"maxParams",255)}calculate(e,t,...r){const n=this._getDelimiterValues(e),s=this._getTextValues(r);if(t.isArray()){const u=t.mapValue(c=>this._handleSingleObject(n,c,s));return u.getRowCount()===1&&u.getColumnCount()===1?u.get(0,0):u}const a=t;if(a.isString()){const u=`${a.getValue()}`.toLocaleUpperCase();if(u==="TRUE")return this._handleSingleObject(n,I.create(!0),s);if(u==="FALSE")return this._handleSingleObject(n,I.create(!1),s)}return this._handleSingleObject(n,t,s)}_handleSingleObject(e,t,r){if(e instanceof g)return e;const{isError:n,errorObject:s,variants:a}=F(t);if(n)return s;if(r instanceof g)return r;const[u]=a,c=+u.getValue();let l=r;c&&(l=r.filter(m=>m!==null&&m!==""));let f="";for(let m=0;m<l.length;m++)l[m]!==null&&(f+=l[m]),m<l.length-1&&(f+=e[m%e.length]);return T.create(f)}_getDelimiterValues(e){const t=[],r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1;for(let s=0;s<r;s++)for(let a=0;a<n;a++){const u=e.isArray()?e.get(s,a):e;if(u.isError())return u;let c=`${u.getValue()}`;u.isNull()&&(c=""),u.isBoolean()&&(c=c.toLocaleUpperCase()),t.push(c)}return t}_getTextValues(e){const t=[];for(const r of e){const n=r.isArray()?r.getRowCount():1,s=r.isArray()?r.getColumnCount():1;for(let a=0;a<n;a++)for(let u=0;u<s;u++){const c=r.isArray()?r.get(a,u):r;if(c.isError())return c;if(c.isNull()){t.push(null);continue}let l=`${c.getValue()}`;c.isBoolean()&&(l=l.toLocaleUpperCase()),t.push(l)}}return t}}class aR extends N{constructor(){super(...arguments);A(this,"minParams",2);A(this,"maxParams",6)}calculate(e,t,r,n,s,a){let u=r!=null?r:T.create("\\s");const c=n!=null?n:y.create(0),l=s!=null?s:y.create(0),f=a!=null?a:T.create(h.NA),{_variant:m,values:d}=this._getStringValues(t),{_variant:C,values:_}=this._getStringValues(u,!1);u=C;const E=Math.max(e.isArray()?e.getRowCount():1,c.isArray()?c.getRowCount():1,l.isArray()?l.getRowCount():1),R=Math.max(e.isArray()?e.getColumnCount():1,c.isArray()?c.getColumnCount():1,l.isArray()?l.getColumnCount():1),b=O(E,R,e,g.create(h.NA)),p=O(E,R,c,g.create(h.NA)),V=O(E,R,l,g.create(h.NA)),S=this._getResultArray(b,m,u,p,V,f,d,_);return E===1&&R===1?S.get(0,0):S.map(D=>D.get(0,0))}_getStringValues(e,t=!0){let r=e;const n=[];if(r.isArray())r.iterator(s=>{if(s!=null&&s.isError())return r=s,!1;if(s!=null&&s.isNull()&&t)return r=g.create(h.VALUE),!1;const a=this._getRegExpStringValue(s);if(a==="")return r=g.create(h.VALUE),!1;n.push(a)});else{r.isNull()&&t&&(r=g.create(h.VALUE));const s=this._getRegExpStringValue(r);s===""&&(r=g.create(h.VALUE)),n.push(s)}return{_variant:r,values:n}}_getResultArray(e,t,r,n,s,a,u,c){return e.map((f,m,d)=>{let C=n.get(m,d),_=s.get(m,d);const E=this._checkVariantsError(f,t,r,C,_);if(E.isError())return E;if(f.isNull())return g.create(h.VALUE);let R=a;if(R.isArray()){const D=R.getRowCount(),w=R.getColumnCount();if(D>1||w>1)return g.create(h.VALUE);R=R.get(0,0)}let b=`${f.getValue()}`;if(f.isBoolean()&&(b=b.toLocaleUpperCase()),C.isString()&&(C=C.convertToNumberObjectValue(),C.isError()))return C;const p=Math.floor(+C.getValue());if(_.isString()&&(_=_.convertToNumberObjectValue(),_.isError()))return _;const V=Math.floor(+_.getValue());if(V<0||V>1)return g.create(h.VALUE);let S=`${R.getValue()}`;return R.isBoolean()&&(S=S.toLocaleUpperCase()),this._getResult(b,u,c,p,V,S)})}_getResult(e,t,r,n,s,a){const u=new RegExp(r.join("|"),`g${s?"i":""}`),c=new RegExp(t.join("|"),`g${s?"i":""}`),l=e.split(u);let f=1,m=l.map(d=>{let C=d.split(c);return n&&(C=C.filter(_=>_!=="")),f=Math.max(f,C.length),C});return m=m.map(d=>{let C=d;return C.length<f&&(C=C.concat(new Array(f-C.length).fill(a))),C}),K.createByArray(m)}_checkVariantsError(...e){for(let t=0;t<e.length;t++){const r=e[t];if(r.isError())return r}return I.create(!0)}_getRegExpStringValue(e){let t=e.getValue();return e.isNull()&&(t="\\s"),e.isBoolean()&&(t=t?"TRUE":"FALSE"),t+="",this._escapeRegExp(t)}_escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}}class iR extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return T.create("");let t=`${e.getValue()}`;return e.isBoolean()&&(t=t.toLocaleUpperCase()),t=t.trim().replace(/\s+/g," "),T.create(t)}}const oR=Object.values(M.DataStreamTreeTokenType).filter(i=>[M.DataStreamTreeTokenType.TABLE_START,M.DataStreamTreeTokenType.TABLE_ROW_START,M.DataStreamTreeTokenType.TABLE_CELL_START,M.DataStreamTreeTokenType.TABLE_CELL_END,M.DataStreamTreeTokenType.TABLE_ROW_END,M.DataStreamTreeTokenType.TABLE_END,M.DataStreamTreeTokenType.CUSTOM_BLOCK].includes(i));class uR extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=F(e);if(t)return r;const[s]=n,a=Math.floor(+s.getValue());if(a<1||a>1114111)return g.create(h.VALUE);if(a===1114111||a===1114110)return g.create(h.NA);let u=String.fromCharCode(a);return oR.some(c=>c===u)&&(u=""),T.create(u)}}class cR extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return g.create(h.VALUE);let t=e.getValue().toLocaleString();e.isBoolean()&&(t=t.toLocaleUpperCase());const r=t.charCodeAt(0);return y.create(r)}}class lR extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return T.create("");const t=`${e.getValue()}`.toLocaleUpperCase();return T.create(t)}}class fR extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isBoolean())return g.create(h.VALUE);let t=e;if(e.isString()&&(t=t.convertToNumberObjectValue(),t.isError()))return t;const r=+t.getValue();return y.create(r)}}class mR extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",2)}calculate(e,t){const r=t!=null?t:y.create(0),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=O(n,s,e,g.create(h.NA)),u=O(n,s,r,g.create(h.NA)),c=a.mapValue((l,f,m)=>{const d=u.get(f,m);return l.isError()?l:d.isError()?d:this._handleSingleObject(l,d)});return n===1&&s===1?c.get(0,0):c}_handleSingleObject(e,t){const{isError:r,errorObject:n,variants:s}=F(t);if(r)return n;const[a]=s,u=Math.floor(+a.getValue());if(u<0||u>1)return g.create(h.VALUE);if(e.isNull())return T.create("");if(e.isBoolean())return e;if(e.isNumber())return y.create(e.getValue());const c=u?`"${e.getValue()}"`:`${e.getValue()}`;return T.create(c)}}const gc=[[uE,z.ASC],[oE,z.ARRAYTOTEXT],[cE,z.BAHTTEXT],[fE,z.CHAR],[mE,z.CLEAN],[hE,z.CODE],[gE,z.CONCAT],[dE,z.CONCATENATE],[CE,z.DBCS],[_E,z.DOLLAR],[AE,z.EXACT],[EE,z.FIND],[bE,z.FINDB],[yE,z.FIXED],[pE,z.LEFT],[NE,z.LEFTB],[VE,z.LEN],[OE,z.LENB],[SE,z.LOWER],[ME,z.MID],[DE,z.MIDB],[xE,z.NUMBERSTRING],[jE,z.NUMBERVALUE],[YE,z.REGEXEXTRACT],[HE,z.REGEXMATCH],[GE,z.REGEXREPLACE],[UE,z.PROPER],[WE,z.REPLACE],[QE,z.REPLACEB],[qE,z.REPT],[XE,z.RIGHT],[KE,z.RIGHTB],[ZE,z.SEARCH],[zE,z.SEARCHB],[JE,z.SUBSTITUTE],[eR,z.T],[tR,z.TEXT],[rR,z.TEXTAFTER],[nR,z.TEXTBEFORE],[sR,z.TEXTJOIN],[aR,z.TEXTSPLIT],[iR,z.TRIM],[uR,z.UNICHAR],[cR,z.UNICODE],[lR,z.UPPER],[fR,z.VALUE],[mR,z.VALUETOTEXT]],dc=[];var Cc=(i=>i)(Cc||{});function Li(i){return i.map(o=>o.map(e=>typeof e=="number"?Kn(e):e))}function hR(i,o=!1){if(i.isReferenceObject()){const e=i.toArrayValueObject().toValue();return o?Li(e):e}else if(i.isArray()){const e=i.toValue();return o?Li(e):e}else if(i.isNumber()){const e=i.getValue();return o?Kn(e):e}return i.getValue()}class gR extends N{constructor(){super(...arguments);A(this,"minParams",1);A(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;const t=Me(e),r=encodeURIComponent(t).replace(/[!~'()*]/g,n=>`%${n.charCodeAt(0).toString(16).toLocaleUpperCase()}`);return T.create(r)}}const _c=[[gR,fs.ENCODEURL]];class Ba extends M.Disposable{constructor(){super(...arguments);A(this,"_allSubjects",[]);A(this,"_computingStatus$",new Fe.BehaviorSubject(!0));A(this,"computingStatus$",this._computingStatus$.pipe(Fe.distinctUntilChanged()));A(this,"_computingSubscription")}get computingStatus(){return this._computingStatus$.getValue()}dispose(){var e;super.dispose(),(e=this._computingSubscription)==null||e.unsubscribe(),this._computingStatus$.next(!0),this._computingStatus$.complete(),this._allSubjects.forEach(t=>{t.complete()})}pushComputingStatusSubject(e){return this._allSubjects.push(e),this._updateComputingObservable(),{dispose:()=>{const t=this._allSubjects.indexOf(e);t!==-1&&this._allSubjects.splice(t,1),this._updateComputingObservable()}}}_updateComputingObservable(){var e;if((e=this._computingSubscription)==null||e.unsubscribe(),this._allSubjects.length===0){this._computingStatus$.next(!0);return}this._computingSubscription=Fe.combineLatest(this._allSubjects).pipe(Fe.map(t=>t.every(r=>r))).subscribe(t=>this._computingStatus$.next(t))}}var dR=Object.getOwnPropertyDescriptor,CR=(i,o,e,t)=>{for(var r=t>1?void 0:t?dR(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},Pi=(i,o)=>(e,t)=>o(e,t,i);let qs=class extends M.Disposable{constructor(o,e){super();A(this,"_computingCompleted$",new Fe.Observable(o=>{this._commandService.onCommandExecuted(e=>{if(e.id!==Sr.id)return;const t=e.params;if(t.stageInfo)return o.next(t.stageInfo.stage===He.IDLE||t.stageInfo.stage===He.CALCULATION_COMPLETED)})}).pipe(Fe.distinctUntilChanged(),Fe.shareReplay()));this._commandService=o,this._globalComputingSrv=e;const t=new M.DisposableCollection,r=new Fe.BehaviorSubject(!0);t.add(this._globalComputingSrv.pushComputingStatusSubject(r)),t.add(this._computingCompleted$.subscribe(n=>r.next(n))),t.add(()=>r.complete()),this.disposeWithMe(t)}};qs=CR([Pi(0,M.ICommandService),Pi(1,M.Inject(Ba))],qs);var _R=Object.getOwnPropertyDescriptor,AR=(i,o,e,t)=>{for(var r=t>1?void 0:t?_R(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},Jr=(i,o)=>(e,t)=>o(e,t,i);let Ln=class extends M.Disposable{constructor(i,o,e,t){super(),this._commandService=i,this._functionService=o,this._configService=e,this._dataSyncPrimaryController=t,this._initialize()}_initialize(){this._registerCommands(),this._registerFunctions()}_registerCommands(){[ea,gn,ta,Zs,zs,Sr,Js,Fn,Ks,Bn,kn,$n,Yn,to,ro,ra,qi].forEach(i=>{var o;this._commandService.registerCommand(i),(o=this._dataSyncPrimaryController)==null||o.registerSyncingMutations(i)})}_registerFunctions(){var e;const i=this._configService.getConfig(Hn),o=[...To,...Tu,...vu,...Bu,...Hu,...Gu,...zu,...Ju,...ec,...tc,...rc,...nc,...sc,...gc,...dc,..._c].concat((e=i==null?void 0:i.function)!=null?e:[]).map(t=>{const r=t[0],n=t[1];return new r(n)});this._functionService.registerExecutors(...o)}};Ln=AR([Jr(0,M.ICommandService),Jr(1,Vt),Jr(2,M.IConfigService),Jr(3,M.Optional(Nc.DataSyncPrimaryController))],Ln);var ER=Object.getOwnPropertyDescriptor,RR=(i,o,e,t)=>{for(var r=t>1?void 0:t?ER(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},en=(i,o)=>(e,t)=>o(e,t,i);let Pn=class extends M.Disposable{constructor(i,o,e){super(),this._commandService=i,this._dependencyManagerService=o,this._featureCalculationManagerService=e,this._initialize()}_initialize(){this._commandExecutedListener(),this._featureCalculationManagerServiceListener()}_featureCalculationManagerServiceListener(){this.disposeWithMe(this._featureCalculationManagerService.onChanged$.subscribe(i=>{const{unitId:o,subUnitId:e,featureIds:t}=i;this._dependencyManagerService.removeFeatureFormulaDependency(o,e,t)}))}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(i=>{if(i.id===kn.id){const o=i.params;if(o==null)return;const{featureIds:e,unitId:t,subUnitId:r}=o;this._dependencyManagerService.removeFeatureFormulaDependency(t,r,e)}else if(i.id===Bn.id){const o=i.params;if(o==null)return;const{featureId:e,calculationParam:t}=o,{unitId:r,subUnitId:n}=t;this._dependencyManagerService.removeFeatureFormulaDependency(r,n,[e])}else if(i.id===Yn.id){const o=i.params;if(o==null)return;this._dependencyManagerService.removeOtherFormulaDependency(o.unitId,o.subUnitId,o.formulaIdList)}else if(i.id===$n.id){const o=i.params;if(o==null)return;const e=o.formulaMap,t=[];Object.keys(e).forEach(r=>{t.push(r)}),this._dependencyManagerService.removeOtherFormulaDependency(o.unitId,o.subUnitId,t)}else if(i.id===ea.id){const o=i.params.formulaData;Object.keys(o).forEach(e=>{const t=o[e];if(t!==void 0){if(t===null){this._dependencyManagerService.clearFormulaDependency(e);return}Object.keys(t).forEach(r=>{const n=t[r];if(n!==void 0){if(n===null)return this._dependencyManagerService.clearFormulaDependency(e,r),!0;new M.ObjectMatrix(n).forValue((s,a)=>{this._dependencyManagerService.removeFormulaDependency(e,r,s,a)})}})}})}else i.id===Fn.id&&this._handleSetDefinedName(i)}))}_handleSetDefinedName(i){const o=i.params;if(o==null)return;const{unitId:e,name:t}=o;this._dependencyManagerService.removeFormulaDependencyByDefinedName(e,t)}};Pn=RR([en(0,M.ICommandService),en(1,hr),en(1,Ir),en(2,hr)],Pn);var bR=Object.getOwnPropertyDescriptor,yR=(i,o,e,t)=>{for(var r=t>1?void 0:t?bR(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},xi=(i,o)=>(e,t)=>o(e,t,i);let xn=class extends M.Disposable{constructor(i,o){super(),this._commandService=i,this._featureCalculationManagerService=o,this._initialize()}_initialize(){this._commandExecutedListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(i=>{if(i.id===Bn.id){const o=i.params;if(o==null)return;const{featureId:e,calculationParam:t}=o,{unitId:r,subUnitId:n}=t;this._featureCalculationManagerService.register(r,n,e,t)}else if(i.id===kn.id){const o=i.params;if(o==null)return;const{featureIds:e,unitId:t,subUnitId:r}=o;this._featureCalculationManagerService.remove(t,r,e)}}))}};xn=yR([xi(0,M.ICommandService),xi(1,hr)],xn);var pR=Object.getOwnPropertyDescriptor,NR=(i,o,e,t)=>{for(var r=t>1?void 0:t?pR(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},bs=(i,o)=>(e,t)=>o(e,t,i);let jn=class extends M.Disposable{constructor(i,o,e){super(),this._commandService=i,this._otherFormulaManagerService=o,this._dependencyManagerService=e,this._initialize()}_initialize(){this._commandExecutedListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(i=>{if(i.id===$n.id){const o=i.params;if(o==null)return;const e={[o.unitId]:{[o.subUnitId]:o.formulaMap}};this._otherFormulaManagerService.batchRegister(e)}else if(i.id===Yn.id){const o=i.params;if(o==null)return;const e={};o.formulaIdList.forEach(r=>e[r]=!0);const t={[o.unitId]:{[o.subUnitId]:e}};this._otherFormulaManagerService.batchRemove(t)}}))}};jn=NR([bs(0,M.ICommandService),bs(1,ts),bs(2,Ir)],jn);var VR=Object.getOwnPropertyDescriptor,OR=(i,o,e,t)=>{for(var r=t>1?void 0:t?VR(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},ji=(i,o)=>(e,t)=>o(e,t,i);let Un=class extends M.Disposable{constructor(i,o){super(),this._commandService=i,this._superTableService=o,this._initialize()}_initialize(){this._commandExecutedListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(i=>{if(i.id===Fn.id){const o=i.params;if(o==null)return;const{unitId:e,tableName:t,reference:r}=o;this._superTableService.registerTable(e,t,r)}else if(i.id===Ks.id){const o=i.params;if(o==null)return;const{unitId:e,tableName:t}=o;this._superTableService.remove(e,t)}else if(i.id===ra.id){const o=i.params;if(o==null)return;const{tableOption:e,tableOptionType:t}=o;this._superTableService.registerTableOptionMap(e,t)}}))}};Un=OR([ji(0,M.ICommandService),ji(1,tr)],Un);class Ac extends M.Disposable{constructor(){super(...arguments);A(this,"_dirtyConversionMap",new Map)}dispose(){this._dirtyConversionMap.clear()}remove(e){this._dirtyConversionMap.delete(e)}get(e){return this._dirtyConversionMap.get(e)}has(e){return this._dirtyConversionMap.has(e)}register(e,t){this._dirtyConversionMap.set(e,t)}getDirtyConversionMap(){return this._dirtyConversionMap}}const Ec=M.createIdentifier("univer.formula.active-dirty-manager.service");var SR=Object.getOwnPropertyDescriptor,MR=(i,o,e,t)=>{for(var r=t>1?void 0:t?SR(o,e):o,n=i.length-1,s;n>=0;n--)(s=i[n])&&(r=s(r)||r);return r},Ui=(i,o)=>(e,t)=>o(e,t,i);const DR="UNIVER_ENGINE_FORMULA_PLUGIN";var ys;exports.UniverFormulaEnginePlugin=(ys=class extends M.Plugin{constructor(o=ni,e,t){super(),this._config=o,this._injector=e,this._configService=t;const{...r}=M.merge({},ni,this._config);this._configService.setConfig(Hn,r)}onStarting(){this._initialize(),this._initializeWithOverride()}onReady(){var o;M.touchDependencies(this._injector,[[Ln],[Un]]),(o=this._config)!=null&&o.notExecuteFormula||M.touchDependencies(this._injector,[[jn],[xn],[Pn],[exports.CalculateController]])}onRendered(){var o;(o=this._config)!=null&&o.notExecuteFormula||M.touchDependencies(this._injector,[[Vn],[Nn]])}_initialize(){const o=!this._config.notExecuteFormula,e=[[Vt,{useClass:No}],[er,{useClass:exports.DefinedNamesService}],[Ec,{useClass:Ac}],[ma,{useClass:exports.HyperlinkEngineFormulaService}],[sa,{useClass:ao}],[tr,{useClass:eo}],[Ba],[exports.FormulaDataModel],[Ln],[Un],[qs]];o&&e.push([ts,{useClass:Po}],[ut,{useClass:exports.FormulaRuntimeService}],[pt,{useClass:exports.FormulaCurrentConfigService}],[hr,{useClass:Lo}],[exports.CalculateController],[jn],[Pn],[xn],[exports.Interpreter],[exports.AstTreeBuilder],[exports.Lexer],[ha],[exports.FunctionNodeFactory],[exports.LambdaNodeFactory],[da],[exports.OperatorNodeFactory],[exports.PrefixNodeFactory],[exports.ReferenceNodeFactory],[exports.SuffixNodeFactory],[exports.UnionNodeFactory],[Ca]),e.forEach(t=>this._injector.add(t))}_initializeWithOverride(){var o;this._injector.add([Mr,{useClass:Mr}]),(o=this._config)!=null&&o.notExecuteFormula||[[Vn,{useClass:exports.CalculateFormulaService}],[Ir,{useClass:wo}],[Nn,{useClass:exports.FormulaDependencyGenerator}]].forEach(t=>this._injector.add(t))}},A(ys,"pluginName",DR),ys);exports.UniverFormulaEnginePlugin=MR([Ui(1,M.Inject(M.Injector)),Ui(2,M.IConfigService)],exports.UniverFormulaEnginePlugin);exports.ActiveDirtyManagerService=Ac;exports.ArrayValueObject=K;exports.AstRootNodeFactory=ha;exports.AsyncArrayObject=yo;exports.AsyncCustomFunction=Dh;exports.AsyncObject=bo;exports.BaseFunction=N;exports.BaseReferenceObject=rr;exports.BaseValueObject=Nt;exports.BooleanValue=xt;exports.BooleanValueObject=I;exports.CustomFunction=Fu;exports.DEFAULT_INTERVAL_COUNT=jo;exports.DEFAULT_TOKEN_LAMBDA_FUNCTION_NAME=lr;exports.DEFAULT_TOKEN_LET_FUNCTION_NAME=Qi;exports.DEFAULT_TOKEN_TYPE_LAMBDA_PARAMETER=Xt;exports.DEFAULT_TOKEN_TYPE_PARAMETER=nt;exports.DEFAULT_TOKEN_TYPE_ROOT=Rt;exports.DependencyManagerBaseService=Do;exports.DependencyManagerService=wo;exports.ENGINE_FORMULA_CYCLE_REFERENCE_COUNT=El;exports.ENGINE_FORMULA_PLUGIN_CONFIG_KEY=Hn;exports.ERROR_TYPE_SET=vt;exports.ErrorType=h;exports.ErrorValueObject=g;exports.FUNCTION_NAMES_ARRAY=On;exports.FUNCTION_NAMES_COMPATIBILITY=me;exports.FUNCTION_NAMES_CUBE=Iu;exports.FUNCTION_NAMES_DATABASE=Be;exports.FUNCTION_NAMES_DATE=Ce;exports.FUNCTION_NAMES_ENGINEERING=q;exports.FUNCTION_NAMES_FINANCIAL=ee;exports.FUNCTION_NAMES_INFORMATION=be;exports.FUNCTION_NAMES_LOGICAL=_e;exports.FUNCTION_NAMES_LOOKUP=ne;exports.FUNCTION_NAMES_MATH=k;exports.FUNCTION_NAMES_STATISTICAL=x;exports.FUNCTION_NAMES_TEXT=z;exports.FUNCTION_NAMES_UNIVER=Cc;exports.FUNCTION_NAMES_WEB=fs;exports.FeatureCalculationManagerService=Lo;exports.FormulaDependencyTree=un;exports.FormulaDependencyTreeType=pn;exports.FormulaDependencyTreeVirtual=Hs;exports.FormulaExecuteStageType=He;exports.FormulaExecutedStateType=ir;exports.FunctionService=No;exports.FunctionType=vi;exports.GlobalComputingStatusService=Ba;exports.IActiveDirtyManagerService=Ec;exports.ICalculateFormulaService=Vn;exports.IDefinedNamesService=er;exports.IDependencyManagerService=Ir;exports.IFeatureCalculationManagerService=hr;exports.IFormulaCurrentConfigService=pt;exports.IFormulaDependencyGenerator=Nn;exports.IFormulaRuntimeService=ut;exports.IFunctionService=Vt;exports.IHyperlinkEngineFormulaService=ma;exports.IOtherFormulaManagerService=ts;exports.ISheetRowFilteredService=sa;exports.ISuperTableService=tr;exports.LambdaParameterNodeFactory=da;exports.LambdaValueObjectObject=es;exports.LexerNode=ie;exports.LexerTreeBuilder=Mr;exports.NEW_EXCEL_FUNCTIONS=I_;exports.NullValueObject=ce;exports.NumberValueObject=y;exports.OPERATOR_TOKEN_SET=lt;exports.OtherFormulaManagerService=Po;exports.RangeReferenceObject=Lr;exports.RegisterFunctionMutation=qi;exports.RemoveDefinedNameMutation=Ks;exports.RemoveFeatureCalculationMutation=kn;exports.RemoveOtherFormulaMutation=Yn;exports.RemoveSuperTableMutation=ro;exports.SUFFIX_TOKEN_SET=rn;exports.SetArrayFormulaDataMutation=gn;exports.SetDefinedNameMutation=Fn;exports.SetDefinedNameMutationFactory=fl;exports.SetFeatureCalculationMutation=Bn;exports.SetFormulaCalculationNotificationMutation=Sr;exports.SetFormulaCalculationResultMutation=Js;exports.SetFormulaCalculationStartMutation=Zs;exports.SetFormulaCalculationStopMutation=zs;exports.SetFormulaDataMutation=ea;exports.SetImageFormulaDataMutation=ta;exports.SetOtherFormulaMutation=$n;exports.SetSuperTableMutation=to;exports.SetSuperTableOptionMutation=ra;exports.SheetRowFilteredService=ao;exports.StringValueObject=T;exports.SuperTableService=eo;exports.ValueNodeFactory=Ca;exports.ValueObjectFactory=dt;exports.compareToken=Y;exports.convertUnitDataToRuntime=Gi;exports.deserializeRangeForR1C1=Uo;exports.deserializeRangeWithSheet=fr;exports.deserializeRangeWithSheetWithCache=Kt;exports.extractFormulaError=Vl;exports.functionArray=To;exports.functionCompatibility=Tu;exports.functionCube=vu;exports.functionDatabase=Bu;exports.functionDate=Hu;exports.functionEngineering=Gu;exports.functionFinancial=zu;exports.functionInformation=Ju;exports.functionLogical=ec;exports.functionLookup=tc;exports.functionMath=rc;exports.functionMeta=nc;exports.functionStatistical=sc;exports.functionText=gc;exports.functionUniver=dc;exports.functionWeb=_c;exports.generateAstNode=$s;exports.generateExecuteAstNodeData=Ys;exports.generateRandomDependencyTreeId=$t;exports.generateStringWithSequence=Os;exports.getAbsoluteRefTypeWitString=rl;exports.getAbsoluteRefTypeWithSingleString=Nr;exports.getObjectValue=hR;exports.getRangeWithRefsString=sl;exports.handleNumfmtInCell=wl;exports.handleRefStringInfo=In;exports.includeFormulaLexerToken=Fi;exports.initSheetFormulaData=Ss;exports.isFormulaLexerToken=pr;exports.isInDirtyRange=Ti;exports.isReferenceString=Xs;exports.isReferenceStringWithEffectiveColumn=Vr;exports.isReferenceStrings=zi;exports.matchRefDrawToken=Mc;exports.matchToken=X;exports.needsQuoting=Cn;exports.normalizeSheetName=Sc;exports.operatorToken=Z;exports.prefixToken=Se;exports.quoteSheetName=_n;exports.sequenceNodeType=Ue;exports.serializeRange=bt;exports.serializeRangeToRefString=dn;exports.serializeRangeWithSheet=Xi;exports.serializeRangeWithSpreadsheet=Ki;exports.singleReferenceToGrid=nn;exports.strip=Is;exports.stripErrorMargin=Kn;exports.unquoteSheetName=Ns;

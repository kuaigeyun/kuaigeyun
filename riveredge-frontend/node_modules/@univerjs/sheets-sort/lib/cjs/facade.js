"use strict";const o=require("@univerjs/sheets-sort"),S=require("@univerjs/sheets/facade"),R=require("@univerjs/core"),h=require("@univerjs/core/facade");class l extends S.FRange{sort(r){const e=this._range.startColumn,s=(Array.isArray(r)?r:[r]).map(n=>typeof n=="number"?{colIndex:n+e,type:o.SortType.ASC}:{colIndex:n.column+e,type:n.ascending?o.SortType.ASC:o.SortType.DESC});return this._commandService.syncExecuteCommand(o.SortRangeCommand.id,{orderRules:s,range:this._range,hasTitle:!1,unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId()}),this}}S.FRange.extend(l);class C extends S.FWorksheet{sort(r,e=!0){const t=[{colIndex:r,type:e?o.SortType.ASC:o.SortType.DESC}],s={startRow:0,startColumn:0,endRow:this._worksheet.getRowCount()-1,endColumn:this._worksheet.getColumnCount()-1,rangeType:R.RANGE_TYPE.ALL};return this._commandService.syncExecuteCommand(o.SortRangeCommand.id,{orderRules:t,range:s,hasTitle:!1,unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId()}),this}}S.FWorksheet.extend(C);class v{get SheetRangeSorted(){return"SheetRangeSorted"}get SheetBeforeRangeSort(){return"SheetBeforeRangeSort"}}h.FEventName.extend(S.FSheetEventName);class f extends h.FUniver{_initialize(r){const e=r.get(R.ICommandService);this.registerEventHandler(this.Event.SheetBeforeRangeSort,()=>e.beforeCommandExecuted(t=>{t.id===o.SortRangeCommand.id&&this._beforeRangeSort(t)})),this.registerEventHandler(this.Event.SheetRangeSorted,()=>e.onCommandExecuted(t=>{t.id===o.SortRangeCommand.id&&this._onRangeSorted(t)}))}_beforeRangeSort(r){const e=r.params,t=this.getUniverSheet(e.unitId),s=t.getSheetBySheetId(e.subUnitId),{startColumn:n,endColumn:g,startRow:a,endRow:m}=e.range,u=s.getRange(a,n,m-a+1,g-n+1),i={workbook:t,worksheet:s,range:u,sortColumn:e.orderRules.map(d=>({column:d.colIndex-n,ascending:d.type===o.SortType.ASC}))};if(this.fireEvent(this.Event.SheetBeforeRangeSort,i),i.cancel)throw new Error("SortRangeCommand canceled.")}_onRangeSorted(r){const e=r.params,t=this.getUniverSheet(e.unitId),s=t.getSheetBySheetId(e.subUnitId),{startColumn:n,endColumn:g,startRow:a,endRow:m}=e.range,u=s.getRange(a,n,m-a+1,g-n+1),i={workbook:t,worksheet:s,range:u,sortColumn:e.orderRules.map(d=>({column:d.colIndex-n,ascending:d.type===o.SortType.ASC}))};if(this.fireEvent(this.Event.SheetRangeSorted,i),i.cancel)throw new Error("SortRangeCommand canceled.")}}h.FUniver.extend(f);h.FEventName.extend(v);

"use strict";var St=Object.defineProperty;var yt=(a,e,t)=>e in a?St(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var H=(a,e,t)=>yt(a,typeof e!="symbol"?e+"":e,t);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const c=require("@univerjs/core"),se=require("@univerjs/engine-render"),n=require("@univerjs/sheets-table"),Q=require("@univerjs/sheets-ui"),p=require("@univerjs/ui"),R=require("rxjs"),o=require("react/jsx-runtime"),m=require("@univerjs/design"),E=require("react"),L=require("@univerjs/sheets"),Ue=require("@univerjs/sheets-sort"),Ae=require("@univerjs/engine-formula"),Et=require("@univerjs/sheets-formula-ui"),It="SHEET_TABLE_UI_PLUGIN",ie="SHEETS_TABLE_FILTER_PANEL_OPENED_KEY",_t="UNIVER_SHEET_Table_FILTER_PANEL_ID",rt="TABLE_TOOLBAR_BUTTON",he="TABLE_SELECTOR_DIALOG",xt="SHEET_TABLE_THEME_PANEL_ID",at="SHEET_TABLE_THEME_PANEL",We="table-custom-",wt="table-default-",ae="rgb(255, 255, 255)",Y="none",je="1px solid rgb(var(--grey-200))";function z({ref:a,...e}){const{icon:t,id:r,className:i,extend:s,...l}=e,u=`univerjs-icon univerjs-icon-${r} ${i||""}`.trim(),d=E.useRef(`_${Rt()}`);return it(t,`${r}`,{defIds:t.defIds,idSuffix:d.current},{ref:a,className:u,...l},s)}function it(a,e,t,r,i){return E.createElement(a.tag,{key:e,...Dt(a,t,i),...r},(Mt(a,t).children||[]).map((s,l)=>it(s,`${e}-${a.tag}-${l}`,t,void 0,i)))}function Dt(a,e,t){const r={...a.attrs};t!=null&&t.colorChannel1&&r.fill==="colorChannel1"&&(r.fill=t.colorChannel1),a.tag==="mask"&&r.id&&(r.id=r.id+e.idSuffix),Object.entries(r).forEach(([s,l])=>{s==="mask"&&typeof l=="string"&&(r[s]=l.replace(/url\(#(.*)\)/,`url(#$1${e.idSuffix})`))});const{defIds:i}=e;return!i||i.length===0||(a.tag==="use"&&r["xlink:href"]&&(r["xlink:href"]=r["xlink:href"]+e.idSuffix),Object.entries(r).forEach(([s,l])=>{typeof l=="string"&&(r[s]=l.replace(/url\(#(.*)\)/,`url(#$1${e.idSuffix})`))})),r}function Mt(a,e){var r;const{defIds:t}=e;return!t||t.length===0?a:a.tag==="defs"&&((r=a.children)!=null&&r.length)?{...a,children:a.children.map(i=>typeof i.attrs.id=="string"&&t&&t.includes(i.attrs.id)?{...i,attrs:{...i.attrs,id:i.attrs.id+e.idSuffix}}:i)}:a}function Rt(){return Math.random().toString(36).substring(2,8)}z.displayName="UniverIcon";const Nt={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M12.4208 14.4667C12.4208 14.798 12.1522 15.0667 11.8208 15.0667C11.4895 15.0667 11.2208 14.798 11.2208 14.4667V2.98193L9.97861 4.22417C9.7443 4.45848 9.3644 4.45848 9.13008 4.22417C8.89577 3.98985 8.89577 3.60995 9.13008 3.37564L11.3967 1.10897C11.6311 0.874657 12.011 0.874657 12.2453 1.10897L14.5119 3.37564C14.7463 3.60995 14.7463 3.98985 14.5119 4.22417C14.2776 4.45848 13.8977 4.45848 13.6634 4.22417L12.4208 2.9816V14.4667Z"}},{tag:"path",attrs:{fill:"currentColor",d:"M1.98967 10.2798C1.6583 10.2798 1.38967 10.0112 1.38967 9.67983C1.38967 9.34846 1.6583 9.07983 1.98967 9.07983H6.50138C6.74406 9.07983 6.96284 9.22602 7.05571 9.45022C7.14858 9.67443 7.09725 9.9325 6.92565 10.1041L3.43819 13.5916H6.50138C6.83276 13.5916 7.10138 13.8602 7.10138 14.1916C7.10138 14.5229 6.83276 14.7916 6.50138 14.7916H1.98967C1.74699 14.7916 1.52821 14.6454 1.43534 14.4212C1.34247 14.197 1.3938 13.9389 1.5654 13.7673L5.05286 10.2798H1.98967Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{fill:"currentColor",d:"M5.1846 1.86439C4.8641 0.989866 3.62725 0.989866 3.30674 1.86439L1.34882 7.20672C1.23479 7.51786 1.39458 7.86252 1.70571 7.97655C2.01684 8.09058 2.3615 7.93079 2.47553 7.61966L3.06159 6.02055L3.06338 6.02056H5.42975L6.01581 7.61966C6.12984 7.93079 6.4745 8.09058 6.78563 7.97655C7.09677 7.86252 7.25655 7.51786 7.14252 7.20672L5.1846 1.86439ZM4.98996 4.82056L4.24567 2.78971L3.50138 4.82056H4.98996Z",fillRule:"evenodd",clipRule:"evenodd"}}]},st=E.forwardRef(function(e,t){return E.createElement(z,Object.assign({},e,{id:"ascending-icon",ref:t,icon:Nt}))});st.displayName="AscendingIcon";const jt={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M5.3313 1.4667C5.3313 1.13533 5.59993 0.866699 5.9313 0.866699H10.069C10.4004 0.866699 10.669 1.13533 10.669 1.4667C10.669 1.79807 10.4004 2.0667 10.069 2.0667H5.9313C5.59993 2.0667 5.3313 1.79807 5.3313 1.4667Z"}},{tag:"path",attrs:{fill:"currentColor",d:"M1.09985 3.64443C1.09985 3.31306 1.36848 3.04443 1.69985 3.04443H14.2999C14.6312 3.04443 14.8999 3.31306 14.8999 3.64443C14.8999 3.9758 14.6312 4.24443 14.2999 4.24443H1.69985C1.36848 4.24443 1.09985 3.9758 1.09985 3.64443Z"}},{tag:"path",attrs:{fill:"currentColor",d:"M6.12398 8.30171C6.35829 8.0674 6.73819 8.0674 6.97251 8.30171L8.00007 9.32928L9.02764 8.30171C9.26195 8.0674 9.64185 8.0674 9.87617 8.30171C10.1105 8.53603 10.1105 8.91593 9.87617 9.15024L8.8486 10.1778L9.87617 11.2054C10.1105 11.4397 10.1105 11.8196 9.87617 12.0539C9.64185 12.2882 9.26195 12.2882 9.02764 12.0539L8.00007 11.0263L6.97251 12.0539C6.73819 12.2882 6.35829 12.2882 6.12398 12.0539C5.88966 11.8196 5.88966 11.4397 6.12398 11.2054L7.15154 10.1778L6.12398 9.15024C5.88966 8.91593 5.88966 8.53603 6.12398 8.30171Z"}},{tag:"path",attrs:{fill:"currentColor",d:"M4.75332 5.22217C3.86966 5.22217 3.15332 5.93851 3.15332 6.82217V12.5331C3.15332 13.9691 4.31738 15.1332 5.75332 15.1332H10.2465C11.6825 15.1332 12.8465 13.9691 12.8465 12.5331V6.82217C12.8465 5.93851 12.1302 5.22217 11.2465 5.22217H4.75332ZM4.35332 6.82217C4.35332 6.60125 4.53241 6.42217 4.75332 6.42217H11.2465C11.4674 6.42217 11.6465 6.60125 11.6465 6.82217V12.5331C11.6465 13.3063 11.0197 13.9332 10.2465 13.9332H5.75332C4.98012 13.9332 4.35332 13.3063 4.35332 12.5331V6.82217Z",fillRule:"evenodd",clipRule:"evenodd"}}]},ot=E.forwardRef(function(e,t){return E.createElement(z,Object.assign({},e,{id:"delete-icon",ref:t,icon:jt}))});ot.displayName="DeleteIcon";const Lt={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M12.4208 1.53335C12.4208 1.20198 12.1522 0.93335 11.8208 0.93335C11.4895 0.93335 11.2208 1.20198 11.2208 1.53335V13.0181L9.97861 11.7758C9.7443 11.5415 9.3644 11.5415 9.13008 11.7758C8.89577 12.0101 8.89577 12.39 9.13008 12.6244L11.3967 14.891C11.6311 15.1253 12.011 15.1253 12.2453 14.891L14.5119 12.6244C14.7463 12.39 14.7463 12.0101 14.5119 11.7758C14.2776 11.5415 13.8977 11.5415 13.6634 11.7758L12.4208 13.0184V1.53335Z"}},{tag:"path",attrs:{fill:"currentColor",d:"M1.98967 10.2798C1.6583 10.2798 1.38967 10.0112 1.38967 9.67983C1.38967 9.34846 1.6583 9.07983 1.98967 9.07983H6.50138C6.74406 9.07983 6.96284 9.22602 7.05571 9.45022C7.14858 9.67443 7.09725 9.9325 6.92565 10.1041L3.43819 13.5916H6.50138C6.83276 13.5916 7.10138 13.8602 7.10138 14.1916C7.10138 14.5229 6.83276 14.7916 6.50138 14.7916H1.98967C1.74699 14.7916 1.52821 14.6454 1.43534 14.4212C1.34247 14.197 1.3938 13.9389 1.5654 13.7673L5.05286 10.2798H1.98967Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{fill:"currentColor",d:"M5.1846 1.86439C4.8641 0.989866 3.62725 0.989866 3.30674 1.86439L1.34882 7.20672C1.23479 7.51786 1.39458 7.86252 1.70571 7.97655C2.01684 8.09058 2.3615 7.93079 2.47553 7.61966L3.06159 6.02055L3.06338 6.02056H5.42975L6.01581 7.61966C6.12984 7.93079 6.4745 8.09058 6.78563 7.97655C7.09677 7.86252 7.25655 7.51786 7.14252 7.20672L5.1846 1.86439ZM4.98996 4.82056L4.24567 2.78971L3.50138 4.82056H4.98996Z",fillRule:"evenodd",clipRule:"evenodd"}}]},lt=E.forwardRef(function(e,t){return E.createElement(z,Object.assign({},e,{id:"descending-icon",ref:t,icon:Lt}))});lt.displayName="DescendingIcon";const $t={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M8.85869 12.9216C8.38445 13.4708 7.61555 13.4708 7.14131 12.9216L0.358114 5.06726C-0.406895 4.18144 0.134916 2.66683 1.2168 2.66683L14.7832 2.66683C15.8651 2.66683 16.4069 4.18144 15.6419 5.06726L8.85869 12.9216Z"}}]},we=E.forwardRef(function(e,t){return E.createElement(z,Object.assign({},e,{id:"dropdown-icon",ref:t,icon:$t}))});we.displayName="DropdownIcon";const kt={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M3.33333 3.33333V6H6V3.33333H3.33333ZM2 3.238C2 2.55427 2.55427 2 3.238 2H6.09533C6.77906 2 7.33333 2.55427 7.33333 3.238V6.09533C7.33333 6.77906 6.77906 7.33333 6.09533 7.33333H3.238C2.55427 7.33333 2 6.77906 2 6.09533V3.238ZM10 3.33333V6H12.6667V3.33333H10ZM8.66667 3.238C8.66667 2.55427 9.22094 2 9.90467 2H12.762C13.4457 2 14 2.55427 14 3.238V6.09533C14 6.77906 13.4457 7.33333 12.762 7.33333H9.90467C9.22094 7.33333 8.66667 6.77906 8.66667 6.09533V3.238ZM3.33333 10V12.6667H6V10H3.33333ZM2 9.90467C2 9.22094 2.55427 8.66667 3.238 8.66667H6.09533C6.77906 8.66667 7.33333 9.22094 7.33333 9.90467V12.762C7.33333 13.4457 6.77906 14 6.09533 14H3.238C2.55427 14 2 13.4457 2 12.762V9.90467ZM10 10V12.6667H12.6667V10H10ZM8.66667 9.90467C8.66667 9.22094 9.22094 8.66667 9.90467 8.66667H12.762C13.4457 8.66667 14 9.22094 14 9.90467V12.762C14 13.4457 13.4457 14 12.762 14H9.90467C9.22094 14 8.66667 13.4457 8.66667 12.762V9.90467Z",fillRule:"evenodd",clipRule:"evenodd"}}]},ct=E.forwardRef(function(e,t){return E.createElement(z,Object.assign({},e,{id:"grid-outline-icon",ref:t,icon:kt}))});ct.displayName="GridOutlineIcon";const Pt={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M11.3536 6.14645C11.5488 6.34171 11.5488 6.65829 11.3536 6.85355L8.35355 9.85355C8.15829 10.0488 7.84171 10.0488 7.64645 9.85355L4.64645 6.85355C4.45118 6.65829 4.45118 6.34171 4.64645 6.14645C4.84171 5.95118 5.15829 5.95118 5.35355 6.14645L8 8.79289L10.6464 6.14645C10.8417 5.95118 11.1583 5.95118 11.3536 6.14645Z",fillRule:"evenodd",clipRule:"evenodd"}}]},Ke=E.forwardRef(function(e,t){return E.createElement(z,Object.assign({},e,{id:"more-down-icon",ref:t,icon:Pt}))});Ke.displayName="MoreDownIcon";const Ot={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M3.80068 2.57257L7.27955 2.57256C7.61092 2.57256 7.87954 2.30393 7.87954 1.97256C7.87954 1.64119 7.61091 1.37256 7.27954 1.37256L3.80068 1.37257C2.36473 1.37257 1.20067 2.53665 1.20068 3.97259L1.20074 12.3001C1.20075 13.736 2.36481 14.9 3.80074 14.9H12.1282C13.5641 14.9 14.7282 13.736 14.7282 12.3V8.82116C14.7282 8.48979 14.4595 8.22116 14.1282 8.22116C13.7968 8.22116 13.5282 8.48979 13.5282 8.82116V12.3C13.5282 13.0732 12.9014 13.7 12.1282 13.7H3.80074C3.02754 13.7 2.40074 13.0732 2.40074 12.3001L2.40068 3.97258C2.40068 3.19938 3.02748 2.57257 3.80068 2.57257Z"}},{tag:"path",attrs:{fill:"currentColor",d:"M14.0072 2.0955C13.0997 1.18757 11.6278 1.18794 10.7207 2.09632L6.17749 6.646C6.10294 6.72065 6.04543 6.81056 6.00889 6.90954L4.59817 10.7315C4.51713 10.951 4.57116 11.1977 4.73657 11.3633C4.90198 11.5288 5.14858 11.5831 5.36823 11.5023L9.20237 10.0916C9.30186 10.055 9.3922 9.99722 9.46714 9.92224L14.0073 5.37972C14.9139 4.47266 14.9138 3.00252 14.0072 2.0955ZM11.5698 2.94424C12.0083 2.50513 12.7198 2.50496 13.1585 2.94384C13.5968 3.38229 13.5968 4.09294 13.1585 4.53141L8.69127 9.00102L6.1742 9.92713L7.09912 7.42132L11.5698 2.94424Z",fillRule:"evenodd",clipRule:"evenodd"}}]},ut=E.forwardRef(function(e,t){return E.createElement(z,Object.assign({},e,{id:"rename-icon",ref:t,icon:Ot}))});ut.displayName="RenameIcon";const Bt={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M1.7643 4.13354C1.7643 2.82523 2.82488 1.76465 4.13319 1.76465H11.8665C13.1748 1.76465 14.2354 2.82524 14.2354 4.13354V11.8669C14.2354 13.1752 13.1748 14.2358 11.8665 14.2358H4.13318C2.82488 14.2358 1.7643 13.1752 1.7643 11.8669V6.1462C1.76388 6.13711 1.76367 6.12797 1.76367 6.11878C1.76367 6.10959 1.76388 6.10045 1.7643 6.09136V4.13354ZM2.94652 6.70989V11.8669C2.94652 12.5222 3.47781 13.0535 4.13318 13.0535H5.52732V6.70989H2.94652ZM5.52732 5.52767H2.94652V4.13354C2.94652 3.47816 3.47781 2.94687 4.13319 2.94687H5.52732V5.52767ZM6.70954 6.70989V13.0535H11.8665C12.5219 13.0535 13.0532 12.5222 13.0532 11.8669V6.70989L6.70954 6.70989ZM13.0532 5.52767L6.70954 5.52767V2.94687H11.8665C12.5219 2.94687 13.0532 3.47816 13.0532 4.13354V5.52767Z",fillRule:"evenodd",clipRule:"evenodd"}}]},dt=E.forwardRef(function(e,t){return E.createElement(z,Object.assign({},e,{id:"table-icon",ref:t,icon:Bt}))});dt.displayName="TableIcon";const Ft={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 17 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M8.01281 1.36643C8.79386 0.585377 10.0602 0.585378 10.8412 1.36643L12.9223 3.44752C13.7034 4.22857 13.7034 5.4949 12.9223 6.27595L9.36445 9.83383C8.5834 10.6149 7.31707 10.6149 6.53602 9.83383L4.45493 7.75273C3.67388 6.97168 3.67388 5.70535 4.45493 4.9243L8.01281 1.36643ZM9.9927 2.21495C9.68028 1.90253 9.17375 1.90253 8.86133 2.21495L5.30346 5.77283L5.29671 5.77966L10.839 6.66224L12.0738 5.42742C12.3862 5.115 12.3862 4.60847 12.0738 4.29605L9.9927 2.21495Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{fill:"currentColor",d:"M14.5179 9.48875C14.5179 9.99175 14.1101 10.3995 13.607 10.3995C13.1041 10.3995 12.6963 9.99175 12.6963 9.48875C12.6963 9.1773 13.0455 8.59966 13.3114 8.20487C13.4549 7.99177 13.7591 7.99177 13.9027 8.20486C14.1687 8.59965 14.5179 9.1773 14.5179 9.48875Z"}},{tag:"path",attrs:{fill:"colorChannel1",d:"M1.98682 13.4992C1.98682 12.5603 2.74793 11.7992 3.68682 11.7992H14.2868C15.2257 11.7992 15.9868 12.5603 15.9868 13.4992V13.4992C15.9868 14.4381 15.2257 15.1992 14.2868 15.1992H3.68682C2.74793 15.1992 1.98682 14.4381 1.98682 13.4992V13.4992Z"}}]},mt=E.forwardRef(function(e,t){return E.createElement(z,Object.assign({},e,{id:"paint-bucket-double-icon",ref:t,icon:Ft}))});mt.displayName="PaintBucketDoubleIcon";var oe=(a=>(a.Items="items",a.Condition="condition",a))(oe||{}),Vt=Object.getOwnPropertyDescriptor,Ht=(a,e,t,r)=>{for(var i=r>1?void 0:r?Vt(e,t):e,s=a.length-1,l;s>=0;s--)(l=a[s])&&(i=l(i)||i);return i},_e=(a,e)=>(t,r)=>e(t,r,a);let be=class extends c.Disposable{constructor(e,t,r,i,s){super();H(this,"_itemsCache",new Map);this._tableManager=e,this._sheetTableService=t,this._univerInstanceService=r,this._commandService=i,this._localeService=s,this._registerTableFilterChangeEvent()}_registerTableFilterChangeEvent(){this._commandService.onCommandExecuted(e=>{if(e.id===L.SetRangeValuesMutation.id){const{unitId:t,subUnitId:r,cellValue:i}=e.params,s=this._tableManager.getTablesBySubunitId(t,r);if(!s.length)return;new c.ObjectMatrix(i).forValue((u,d,b)=>{const h=c.cellToRange(u,d),v=s.find(S=>{const x=S.getTableFilterRange();return c.Rectangle.intersects(x,h)});if(v){const S=d-v.getRange().startColumn;this._itemsCache.delete(v.getId()+S)}})}else if(e.id===n.SetSheetTableFilterCommand.id){const{unitId:t,tableId:r}=e.params,i=this._tableManager.getTable(t,r);if(!i)return;const s=i.getSubunitId();this._tableManager.getTablesBySubunitId(t,s).forEach(u=>{const d=u.getRange();for(let b=d.startColumn;b<=d.endColumn;b++)this._itemsCache.delete(u.getId()+b)})}})}getTableFilterPanelInitProps(e,t,r,i){const s=this._tableManager.getTable(e,r),l=s.getRange(),u=s.getTableFilterColumn(i-l.startColumn);return{unitId:e,subUnitId:t,tableFilter:u,currentFilterBy:n.isConditionFilter(u)?oe.Condition:oe.Items,tableId:r,columnIndex:i-l.startColumn}}getTableFilterCheckedItems(e,t,r){const i=this._tableManager.getTable(e,t),s=[];if(i){const l=i.getTableFilterColumn(r);l&&n.isManualFilter(l)&&s.push(...l.values)}return s}setTableFilter(e,t,r,i){if(!this._tableManager.getTable(e,t))return;const l={unitId:e,tableId:t,column:r,tableFilter:i};this._commandService.executeCommand(n.SetSheetTableFilterCommand.id,l)}getTableFilterItems(e,t,r,i){var j;if(this._itemsCache.has(r+i))return this._itemsCache.get(r+i)||{data:[],itemsCountMap:new Map,allItemsCount:0};const s=this._tableManager.getTable(e,r);if(!s)return{data:[],itemsCountMap:new Map,allItemsCount:0};const l=s.getTableFilterRange(),{startRow:u,endRow:d,startColumn:b}=l,h=b+i,v=(j=this._univerInstanceService.getUnit(e))==null?void 0:j.getSheetBySheetId(t);if(!v)return{data:[],itemsCountMap:new Map,allItemsCount:0};const S=[],x=new Map;let I=0;for(let y=u;y<=d;y++){if(v.isRowFiltered(y))continue;let w=this._sheetTableService.getCellValueWithConditionType(v,y,h);w===void 0&&(w=this._localeService.t("sheets-table.condition.empty")),x.has(w)||S.push({title:w,key:`${h}_${y}`,leaf:!0}),I++,x.set(w,(x.get(w)||0)+1)}return this._itemsCache.set(r+i,{data:S,itemsCountMap:x,allItemsCount:I}),{data:S,itemsCountMap:x,allItemsCount:I}}};be=Ht([_e(0,c.Inject(n.TableManager)),_e(1,c.Inject(n.SheetTableService)),_e(2,c.Inject(c.IUniverInstanceService)),_e(3,c.ICommandService),_e(4,c.Inject(c.LocaleService))],be);var A=(a=>(a.DatePicker="DatePicker",a.DateRange="DateRange",a.Input="Input",a.Inputs="Inputs",a.Select="Select",a.None="None",a))(A||{});function Ut(a){const t=a.get(c.LocaleService).t;return[{value:n.TableConditionTypeEnum.String,label:t(`sheets-table.condition.${n.TableConditionTypeEnum.String}`),children:[{value:n.TableStringCompareTypeEnum.Equal,label:t(`sheets-table.string.compare.${n.TableStringCompareTypeEnum.Equal}`)},{value:n.TableStringCompareTypeEnum.NotEqual,label:t(`sheets-table.string.compare.${n.TableStringCompareTypeEnum.NotEqual}`)},{value:n.TableStringCompareTypeEnum.Contains,label:t(`sheets-table.string.compare.${n.TableStringCompareTypeEnum.Contains}`)},{value:n.TableStringCompareTypeEnum.NotContains,label:t(`sheets-table.string.compare.${n.TableStringCompareTypeEnum.NotContains}`)},{value:n.TableStringCompareTypeEnum.StartsWith,label:t(`sheets-table.string.compare.${n.TableStringCompareTypeEnum.StartsWith}`)},{value:n.TableStringCompareTypeEnum.EndsWith,label:t(`sheets-table.string.compare.${n.TableStringCompareTypeEnum.EndsWith}`)}]},{value:n.TableConditionTypeEnum.Number,label:t(`sheets-table.condition.${n.TableConditionTypeEnum.Number}`),children:[{value:n.TableNumberCompareTypeEnum.Equal,label:t(`sheets-table.number.compare.${n.TableNumberCompareTypeEnum.Equal}`)},{value:n.TableNumberCompareTypeEnum.NotEqual,label:t(`sheets-table.number.compare.${n.TableNumberCompareTypeEnum.NotEqual}`)},{value:n.TableNumberCompareTypeEnum.GreaterThan,label:t(`sheets-table.number.compare.${n.TableNumberCompareTypeEnum.GreaterThan}`)},{value:n.TableNumberCompareTypeEnum.GreaterThanOrEqual,label:t(`sheets-table.number.compare.${n.TableNumberCompareTypeEnum.GreaterThanOrEqual}`)},{value:n.TableNumberCompareTypeEnum.LessThan,label:t(`sheets-table.number.compare.${n.TableNumberCompareTypeEnum.LessThan}`)},{value:n.TableNumberCompareTypeEnum.LessThanOrEqual,label:t(`sheets-table.number.compare.${n.TableNumberCompareTypeEnum.LessThanOrEqual}`)},{value:n.TableNumberCompareTypeEnum.Between,label:t(`sheets-table.number.compare.${n.TableNumberCompareTypeEnum.Between}`)},{value:n.TableNumberCompareTypeEnum.NotBetween,label:t(`sheets-table.number.compare.${n.TableNumberCompareTypeEnum.NotBetween}`)},{value:n.TableNumberCompareTypeEnum.Above,label:t(`sheets-table.number.compare.${n.TableNumberCompareTypeEnum.Above}`)},{value:n.TableNumberCompareTypeEnum.Below,label:t(`sheets-table.number.compare.${n.TableNumberCompareTypeEnum.Below}`)}]},{value:n.TableConditionTypeEnum.Date,label:t(`sheets-table.condition.${n.TableConditionTypeEnum.Date}`),children:[{value:n.TableDateCompareTypeEnum.Equal,label:t(`sheets-table.date.compare.${n.TableDateCompareTypeEnum.Equal}`)},{value:n.TableDateCompareTypeEnum.NotEqual,label:t(`sheets-table.date.compare.${n.TableDateCompareTypeEnum.NotEqual}`)},{value:n.TableDateCompareTypeEnum.After,label:t(`sheets-table.date.compare.${n.TableDateCompareTypeEnum.After}`)},{value:n.TableDateCompareTypeEnum.AfterOrEqual,label:t(`sheets-table.date.compare.${n.TableDateCompareTypeEnum.AfterOrEqual}`)},{value:n.TableDateCompareTypeEnum.Before,label:t(`sheets-table.date.compare.${n.TableDateCompareTypeEnum.Before}`)},{value:n.TableDateCompareTypeEnum.BeforeOrEqual,label:t(`sheets-table.date.compare.${n.TableDateCompareTypeEnum.BeforeOrEqual}`)},{value:n.TableDateCompareTypeEnum.Between,label:t(`sheets-table.date.compare.${n.TableDateCompareTypeEnum.Between}`)},{value:n.TableDateCompareTypeEnum.NotBetween,label:t(`sheets-table.date.compare.${n.TableDateCompareTypeEnum.NotBetween}`)},{value:n.TableDateCompareTypeEnum.Today,label:t(`sheets-table.date.compare.${n.TableDateCompareTypeEnum.Today}`)},{value:n.TableDateCompareTypeEnum.Yesterday,label:t(`sheets-table.date.compare.${n.TableDateCompareTypeEnum.Yesterday}`)},{value:n.TableDateCompareTypeEnum.Tomorrow,label:t(`sheets-table.date.compare.${n.TableDateCompareTypeEnum.Tomorrow}`)},{value:n.TableDateCompareTypeEnum.ThisWeek,label:t(`sheets-table.date.compare.${n.TableDateCompareTypeEnum.ThisWeek}`)},{value:n.TableDateCompareTypeEnum.LastWeek,label:t(`sheets-table.date.compare.${n.TableDateCompareTypeEnum.LastWeek}`)},{value:n.TableDateCompareTypeEnum.NextWeek,label:t(`sheets-table.date.compare.${n.TableDateCompareTypeEnum.NextWeek}`)},{value:n.TableDateCompareTypeEnum.ThisMonth,label:t(`sheets-table.date.compare.${n.TableDateCompareTypeEnum.ThisMonth}`)},{value:n.TableDateCompareTypeEnum.LastMonth,label:t(`sheets-table.date.compare.${n.TableDateCompareTypeEnum.LastMonth}`)},{value:n.TableDateCompareTypeEnum.NextMonth,label:t(`sheets-table.date.compare.${n.TableDateCompareTypeEnum.NextMonth}`)},{value:n.TableDateCompareTypeEnum.ThisYear,label:t(`sheets-table.date.compare.${n.TableDateCompareTypeEnum.ThisYear}`)},{value:n.TableDateCompareTypeEnum.LastYear,label:t(`sheets-table.date.compare.${n.TableDateCompareTypeEnum.LastYear}`)},{value:n.TableDateCompareTypeEnum.NextYear,label:t(`sheets-table.date.compare.${n.TableDateCompareTypeEnum.NextYear}`)},{value:n.TableDateCompareTypeEnum.Quarter,label:t(`sheets-table.date.compare.${n.TableDateCompareTypeEnum.Quarter}`)},{value:n.TableDateCompareTypeEnum.Month,label:t(`sheets-table.date.compare.${n.TableDateCompareTypeEnum.Month}`)}]}]}function At(a,e){if(!e)return[];const r=a.get(c.LocaleService).t;switch(e){case n.TableDateCompareTypeEnum.Quarter:return[{value:n.TableDateCompareTypeEnum.Q1,label:r(`sheets-table.date.compare.${n.TableDateCompareTypeEnum.Q1}`)},{value:n.TableDateCompareTypeEnum.Q2,label:r(`sheets-table.date.compare.${n.TableDateCompareTypeEnum.Q2}`)},{value:n.TableDateCompareTypeEnum.Q3,label:r(`sheets-table.date.compare.${n.TableDateCompareTypeEnum.Q3}`)},{value:n.TableDateCompareTypeEnum.Q4,label:r(`sheets-table.date.compare.${n.TableDateCompareTypeEnum.Q4}`)}];case n.TableDateCompareTypeEnum.Month:return[{value:n.TableDateCompareTypeEnum.M1,label:r(`sheets-table.date.compare.${n.TableDateCompareTypeEnum.M1}`)},{value:n.TableDateCompareTypeEnum.M2,label:r(`sheets-table.date.compare.${n.TableDateCompareTypeEnum.M2}`)},{value:n.TableDateCompareTypeEnum.M3,label:r(`sheets-table.date.compare.${n.TableDateCompareTypeEnum.M3}`)},{value:n.TableDateCompareTypeEnum.M4,label:r(`sheets-table.date.compare.${n.TableDateCompareTypeEnum.M4}`)},{value:n.TableDateCompareTypeEnum.M5,label:r(`sheets-table.date.compare.${n.TableDateCompareTypeEnum.M5}`)},{value:n.TableDateCompareTypeEnum.M6,label:r(`sheets-table.date.compare.${n.TableDateCompareTypeEnum.M6}`)},{value:n.TableDateCompareTypeEnum.M7,label:r(`sheets-table.date.compare.${n.TableDateCompareTypeEnum.M7}`)},{value:n.TableDateCompareTypeEnum.M8,label:r(`sheets-table.date.compare.${n.TableDateCompareTypeEnum.M8}`)},{value:n.TableDateCompareTypeEnum.M9,label:r(`sheets-table.date.compare.${n.TableDateCompareTypeEnum.M9}`)},{value:n.TableDateCompareTypeEnum.M10,label:r(`sheets-table.date.compare.${n.TableDateCompareTypeEnum.M10}`)},{value:n.TableDateCompareTypeEnum.M11,label:r(`sheets-table.date.compare.${n.TableDateCompareTypeEnum.M11}`)},{value:n.TableDateCompareTypeEnum.M12,label:r(`sheets-table.date.compare.${n.TableDateCompareTypeEnum.M12}`)}];default:return[]}}const ze=new Set([n.TableDateCompareTypeEnum.Equal,n.TableDateCompareTypeEnum.NotEqual,n.TableDateCompareTypeEnum.After,n.TableDateCompareTypeEnum.AfterOrEqual,n.TableDateCompareTypeEnum.Before,n.TableDateCompareTypeEnum.BeforeOrEqual]);function Wt(a,e){return e?a===n.TableConditionTypeEnum.String?A.Input:a===n.TableConditionTypeEnum.Number?e===n.TableNumberCompareTypeEnum.Between||e===n.TableNumberCompareTypeEnum.NotBetween?A.Inputs:A.Input:a===n.TableConditionTypeEnum.Date?e===n.TableDateCompareTypeEnum.Between||e===n.TableDateCompareTypeEnum.NotBetween?A.DateRange:e===n.TableDateCompareTypeEnum.Quarter||e===n.TableDateCompareTypeEnum.Month?A.Select:ze.has(e)?A.DatePicker:A.None:A.None:A.None}function Zt(a){if(!a||a.filterType!=="condition")return{type:n.TableConditionTypeEnum.String,compareType:n.TableStringCompareTypeEnum.Equal,info:{}};const e=a.filterInfo,{conditionType:t,compareType:r}=e;if(t===n.TableConditionTypeEnum.Date)if(r===n.TableDateCompareTypeEnum.Between||r===n.TableDateCompareTypeEnum.NotBetween){let i;return Array.isArray(e.expectedValue)&&(i=e.expectedValue.map(s=>typeof s=="string"?new Date(s):s)),{type:t,compare:r,info:{dateRange:i}}}else{if(r===n.TableDateCompareTypeEnum.Today||r===n.TableDateCompareTypeEnum.Yesterday||r===n.TableDateCompareTypeEnum.Tomorrow||r===n.TableDateCompareTypeEnum.ThisWeek||r===n.TableDateCompareTypeEnum.LastWeek||r===n.TableDateCompareTypeEnum.NextWeek||r===n.TableDateCompareTypeEnum.ThisMonth||r===n.TableDateCompareTypeEnum.LastMonth||r===n.TableDateCompareTypeEnum.NextMonth||r===n.TableDateCompareTypeEnum.ThisYear||r===n.TableDateCompareTypeEnum.LastYear||r===n.TableDateCompareTypeEnum.NextYear)return{type:t,compare:r,info:{}};if(ze.has(r)){let i;if(typeof e.expectedValue=="string")i=new Date(e.expectedValue);else if(Array.isArray(e.expectedValue))for(let s=0;s<e.expectedValue.length;s++)typeof e.expectedValue[s]=="string"&&(e.expectedValue[s]=new Date(e.expectedValue[s]));return{type:t,compare:r,info:{date:i}}}else return new Set([n.TableDateCompareTypeEnum.Q1,n.TableDateCompareTypeEnum.Q2,n.TableDateCompareTypeEnum.Q3,n.TableDateCompareTypeEnum.Q4]).has(r)?{type:t,compare:n.TableDateCompareTypeEnum.Quarter,info:{dateSelect:e.compareType}}:{type:t,compare:n.TableDateCompareTypeEnum.Month,info:{dateSelect:e.compareType}}}else{if(t===n.TableConditionTypeEnum.Number)return r===n.TableNumberCompareTypeEnum.Between||r===n.TableNumberCompareTypeEnum.NotBetween?{type:t,compare:r,info:{numberRange:e.expectedValue}}:{type:t,compare:r,info:{number:e.expectedValue}};if(t===n.TableConditionTypeEnum.String)return{type:t,compare:r,info:{string:e.expectedValue}}}return{type:n.TableConditionTypeEnum.String,compare:n.TableStringCompareTypeEnum.Equal,info:{}}}const qt=a=>{var x,I,j,y,$,w,B,M;const{conditionInfo:e,onChange:t}=a,r=p.useDependency(c.LocaleService),[i,s]=E.useState(!1),l=p.useDependency(c.Injector),u=Ut(l),d=(g,N,D)=>{t({type:N!=null?N:e.type,compare:D!=null?D:e.compare,info:g})},b=g=>{var O;const N=g[0],D=g[1];D&&s(!1);const T={};N===n.TableConditionTypeEnum.Date?D===n.TableDateCompareTypeEnum.Quarter?T.dateSelect=n.TableDateCompareTypeEnum.Q1:D===n.TableDateCompareTypeEnum.Month?T.dateSelect=n.TableDateCompareTypeEnum.M1:ze.has(D)?T.date=new Date:T.dateRange=[new Date,new Date]:N===n.TableConditionTypeEnum.Number?T.number=0:N===n.TableConditionTypeEnum.String&&(T.string=""),d(T,g[0],(O=g[1])!=null?O:n.TableStringCompareTypeEnum.Equal)},h=Wt(e.type,e.compare);let v="";e.compare?v=`${r.t(`sheets-table.condition.${e.type}`)} - ${r.t(`sheets-table.${e.type}.compare.${e.compare}`)}`:v=r.t(`sheets-table.condition.${e.type}`);const S=At(l,e.compare);return o.jsxs("div",{children:[o.jsx(m.Dropdown,{align:"start",open:i,onOpenChange:s,overlay:o.jsx(m.CascaderList,{value:[e.type,e.compare],options:u,onChange:b,contentClassName:"univer-flex-1",wrapperClassName:"!univer-h-[150px]"}),children:o.jsxs("div",{className:m.clsx("univer-box-border univer-flex univer-h-8 univer-w-full univer-items-center univer-justify-between univer-rounded-md univer-bg-white univer-px-2 univer-text-sm univer-transition-colors univer-duration-200 hover:univer-border-primary-600 focus:univer-border-primary-600 focus:univer-outline-none focus:univer-ring-2 dark:!univer-bg-gray-700 dark:!univer-text-white",m.borderClassName),children:[o.jsx("span",{children:v}),o.jsx(Ke,{})]})}),o.jsxs("div",{className:"univer-mt-3 univer-w-full",children:[h===A.Input&&o.jsx(o.Fragment,{children:e.type===n.TableConditionTypeEnum.String?o.jsx(m.Input,{className:"univer-w-full",placeholder:"请输入",value:e.info.string,onChange:g=>d({string:g})}):o.jsx(m.InputNumber,{className:"univer-h-7 univer-w-full",value:e.info.number,controls:!1,onChange:g=>{g!==null&&d({number:g})}})}),h===A.DatePicker&&o.jsx("div",{id:"univer-table-date-picker-wrapper",children:o.jsx(m.DatePicker,{className:"univer-w-full",value:(x=e.info.date)!=null?x:new Date,onValueChange:g=>d({date:g})})}),h===A.DateRange&&o.jsx("div",{id:"univer-table-date-range-wrapper",children:o.jsx(m.DateRangePicker,{className:"univer-w-full",value:[(j=(I=e.info.dateRange)==null?void 0:I[0])!=null?j:new Date,($=(y=e.info.dateRange)==null?void 0:y[1])!=null?$:new Date],onValueChange:g=>{d(g?{dateRange:g}:{})}})}),h===A.Inputs&&o.jsxs("div",{className:"univer-flex univer-items-center univer-gap-2",children:[o.jsx(m.InputNumber,{className:"univer-w-full",value:(w=e.info.numberRange)==null?void 0:w[0],onChange:g=>{var N;g!==null&&d({numberRange:[g,(N=e.info.numberRange)==null?void 0:N[1]]})},controls:!1}),o.jsx("span",{children:" - "}),o.jsx(m.InputNumber,{className:"univer-w-full",value:(B=e.info.numberRange)==null?void 0:B[1],controls:!1,onChange:g=>{var N;g!==null&&d({numberRange:[(N=e.info.numberRange)==null?void 0:N[0],g]})}})]}),h===A.Select&&o.jsx(m.Select,{className:"univer-w-full",value:(M=e.info.dateSelect)!=null?M:S[0].value,options:S,onChange:g=>d({dateSelect:g})})]})]})},Yt=a=>{let e=0;return a.forEach(t=>{e+=t}),e};function Qt(a){const{unitId:e,tableId:t,subUnitId:r,columnIndex:i,checkedItemSet:s,setCheckedItemSet:l,tableFilter:u}=a,d=p.useDependency(c.LocaleService),b=p.useDependency(be),{data:h,itemsCountMap:v,allItemsCount:S}=b.getTableFilterItems(e,r,t,i),[x,I]=E.useState(u===void 0?!0:s.size===v.size),[j,y]=E.useState(x?S:Yt(v)),$=!x&&s.size>0,[w,B]=E.useState(""),M=E.useMemo(()=>w?h.filter(T=>String(T.title).toLowerCase().includes(w.toLowerCase())):h,[w,h]),g=E.useCallback(()=>{x?(s.clear(),l(new Set(s)),I(!1)):(M.forEach(T=>{s.add(T.title)}),l(new Set(s)),I(!0))},[x]),N=E.useCallback(T=>{T===""?(I(!0),h.forEach(O=>{s.add(O.title)}),y(S)):(s.clear(),I(!1),y(0)),B(T)},[]),D=T=>{if(x){I(!1);const O=new Set;for(const{title:k}of h)T!==k&&O.add(k);y(S-v.get(T)),l(O)}else s.has(T)?(s.delete(T),y(j-v.get(T))):(s.add(T),y(j+v.get(T))),l(new Set(s))};return o.jsxs("div",{className:"univer-flex univer-h-full univer-flex-col",children:[o.jsx(m.Input,{autoFocus:!0,value:w,placeholder:d.t("sheets-table.filter.search-placeholder"),onChange:N}),o.jsx("div",{className:m.clsx("univer-mt-2 univer-box-border univer-flex univer-h-[180px] univer-max-h-[180px] univer-flex-grow univer-flex-col univer-overflow-hidden univer-rounded-md univer-py-1.5 univer-pl-2",m.borderClassName),children:o.jsx("div",{className:m.clsx("univer-h-40 univer-overflow-y-auto univer-py-1 univer-pl-2",m.scrollbarClassName),children:o.jsxs("div",{className:"univer-h-full",children:[o.jsx("div",{className:"univer-flex univer-items-center univer-px-2 univer-py-1",children:o.jsx(m.Checkbox,{indeterminate:$,disabled:h.length===0,checked:x,onChange:g,children:o.jsxs("div",{className:"univer-flex univer-h-5 univer-flex-1 univer-items-center univer-text-sm",children:[o.jsx("span",{className:"univer-inline-block univer-truncate",children:`${d.t("sheets-table.filter.select-all")}`}),o.jsx("span",{className:"univer-ml univer-text-gray-400",children:`(${j}/${w?M.length:S})`})]})})}),M.map(T=>o.jsx("div",{className:"univer-flex univer-items-center univer-px-2 univer-py-1",children:o.jsx(m.Checkbox,{checked:x||s.has(T.title),onChange:()=>{D(T.title)},children:o.jsxs("div",{className:"univer-flex univer-h-5 univer-flex-1 univer-text-sm",children:[o.jsx("span",{className:"univer-inline-block univer-truncate",children:T.title}),o.jsx("span",{className:"univer-ml-1 univer-text-gray-400",children:`(${v.get(T.title)||0})`})]})})},T.key))]})})})]})}function Gt(){var re;const a=p.useDependency(c.LocaleService),e=Xt(a),t=p.useDependency(be),r=p.useDependency(n.TableManager),i=p.useDependency(c.ICommandService),s=p.useDependency(c.IPermissionService),l=p.useDependency(pe),u=l.getCurrentTableFilterInfo(),d=t.getTableFilterPanelInitProps(u.unitId,u.subUnitId,u.tableId,u.column),{unitId:b,subUnitId:h,tableId:v,tableFilter:S,currentFilterBy:x,columnIndex:I}=d,{data:j}=t.getTableFilterItems(b,h,v,I),y=t.getTableFilterCheckedItems(b,v,I),[$,w]=E.useState(new Set(y)),[B,M]=E.useState(x||oe.Items),[g,N]=E.useState(()=>{const C=d.tableFilter;return Zt(C)}),D=r.getTable(b,v);if(!D)return null;const T=D.getTableFilters(),O=T.getSortState();O.columnIndex===I&&(O.sortState,n.SheetsTableSortStateEnum.Asc),O.columnIndex===I&&(O.sortState,n.SheetsTableSortStateEnum.Desc);const k=()=>{l.closeFilterPanel()},W=()=>{k()},F=C=>{const P=D.getTableFilterRange();i.executeCommand(Ue.SortRangeCommand.id,{unitId:b,subUnitId:h,range:P,orderRules:[{colIndex:I+P.startColumn,type:C?Ue.SortType.ASC:Ue.SortType.DESC}],hasTitle:!1}),T.setSortState(I,C?n.SheetsTableSortStateEnum.Asc:n.SheetsTableSortStateEnum.Desc),k()},q=()=>{if(B===oe.Items){const C=[];for(const Z of j)$.has(Z.title)&&C.push(Z.title);const P=D.getTableFilterColumn(I);if(P){if(P.values.join(",")===C.join(",")){k();return}}else if(C.length===0){k();return}const V={filterType:n.TableColumnFilterTypeEnum.manual,values:C};t.setTableFilter(b,v,I,V)}else{let C;g.compare===n.TableDateCompareTypeEnum.Quarter||g.compare===n.TableDateCompareTypeEnum.Month?C={conditionType:g.type,compareType:Object.values(g.info)[0]}:C={conditionType:g.type,compareType:g.compare,expectedValue:Object.values(g.info)[0]};const P={filterType:n.TableColumnFilterTypeEnum.condition,filterInfo:C};t.setTableFilter(b,v,I,P)}k()},te=()=>{t.setTableFilter(b,v,I,void 0),k()},ne=new L.WorkbookEditablePermission(b).id,le=(re=s.getPermissionPoint(ne))==null?void 0:re.value;return o.jsxs("div",{className:"univer-box-border univer-flex univer-min-w-[312px] univer-flex-col univer-rounded-[10px] univer-bg-white univer-p-4 univer-shadow-lg dark:!univer-border-gray-600 dark:!univer-bg-gray-700",children:[le&&o.jsx("div",{className:"univer-mb-3 univer-flex",children:o.jsxs(m.ButtonGroup,{className:"univer-mb-3 !univer-flex univer-w-full",children:[o.jsxs(m.Button,{className:"univer-w-1/2",onClick:()=>F(!0),children:[o.jsx(st,{className:"univer-mr-1"}),a.t("sheets-sort.general.sort-asc")]}),o.jsxs(m.Button,{className:"univer-w-1/2",onClick:()=>F(!1),children:[o.jsx(lt,{className:"univer-mr-1"}),a.t("sheets-sort.general.sort-desc")]})]})}),o.jsx("div",{className:"univer-w-full",children:o.jsx(m.Segmented,{value:B,items:e,onChange:C=>M(C)})}),o.jsx("div",{className:"univer-z-10 univer-h-60",children:o.jsx("div",{className:"univer-mt-3 univer-h-full univer-w-full",children:B===oe.Items?o.jsx(Qt,{tableFilter:S,unitId:b,subUnitId:h,tableId:v,columnIndex:I,checkedItemSet:$,setCheckedItemSet:w}):o.jsx(qt,{tableFilter:S,unitId:b,subUnitId:h,tableId:v,columnIndex:I,conditionInfo:g,onChange:N})})}),o.jsxs("div",{className:"univer-flex-wrap-nowrap univer-mt-4 univer-inline-flex univer-flex-shrink-0 univer-flex-grow-0 univer-justify-between univer-gap-6 univer-overflow-hidden",children:[o.jsx(m.Button,{disabled:S===void 0,onClick:te,children:a.t("sheets-table.filter.clear-filter")}),o.jsxs("div",{children:[o.jsx(m.Button,{className:"univer-mr-2",onClick:W,children:a.t("sheets-table.filter.cancel")}),o.jsx(m.Button,{variant:"primary",onClick:q,children:a.t("sheets-table.filter.confirm")})]})]})]})}function Xt(a){const e=a.getCurrentLocale();return E.useMemo(()=>[{label:a.t("sheets-table.filter.by-values"),value:oe.Items},{label:a.t("sheets-table.filter.by-conditions"),value:oe.Condition}],[e,a])}var Kt=Object.getOwnPropertyDescriptor,zt=(a,e,t,r)=>{for(var i=r>1?void 0:r?Kt(e,t):e,s=a.length-1,l;s>=0;s--)(l=a[s])&&(i=l(i)||i);return i},Le=(a,e)=>(t,r)=>e(t,r,a);let pe=class extends c.Disposable{constructor(e,t,r,i){super();H(this,"_popupDisposable");H(this,"_currentTableFilterInfo",null);this._componentManager=e,this._contextService=t,this._sheetCanvasPopupService=r,this._dialogService=i,this._initComponents(),this._initUIPopup()}setCurrentTableFilterInfo(e){this._currentTableFilterInfo=e}clearCurrentTableFilterInfo(){this._currentTableFilterInfo=null}getCurrentTableFilterInfo(){return this._currentTableFilterInfo}_initComponents(){[[ie,Gt]].forEach(([e,t])=>{this.disposeWithMe(this._componentManager.register(e,t))})}_initUIPopup(){this.disposeWithMe(this._contextService.subscribeContextValue$(ie).pipe(R.startWith(void 0),R.distinctUntilChanged()).subscribe(e=>{e?this._openFilterPopup():e===!1&&this._closeFilterPopup()}))}closeFilterPanel(){this._contextService.setContextValue(ie,!1)}_openFilterPopup(){const e=this._currentTableFilterInfo;if(!e)throw new Error("[SheetsFilterUIController]: no filter model when opening filter popup!");const{row:t,column:r}=e;this._popupDisposable=this._sheetCanvasPopupService.attachPopupToCell(t,r,{componentKey:ie,direction:"horizontal",onClickOutside:()=>{this._dialogService.close(_t),this._contextService.setContextValue(ie,!1)},offset:[5,0],portal:!0})}_closeFilterPopup(){var e;(e=this._popupDisposable)==null||e.dispose(),this._popupDisposable=null,this.clearCurrentTableFilterInfo()}};pe=zt([Le(0,c.Inject(p.ComponentManager)),Le(1,c.IContextService),Le(2,c.Inject(Q.SheetCanvasPopManagerService)),Le(3,c.Inject(p.IDialogService))],pe);const Ye={type:c.CommandType.OPERATION,id:"sheet.operation.open-table-filter-panel",async handler(a,e){if(!e)return!1;const{row:t,col:r,unitId:i,subUnitId:s,tableId:l}=e,u=a.get(n.TableManager),d=a.get(c.IContextService),b=a.get(pe);return u.getTable(i,l)?(d.getContextValue(ie)||(b.setCurrentTableFilterInfo({unitId:i,subUnitId:s,row:t,tableId:l,column:r}),d.setContextValue(ie,!0)),!0):!1}},Je={type:c.CommandType.OPERATION,id:"sheet.operation.open-table-selector",async handler(a){var x;const e=a.get(c.IUniverInstanceService),t=a.get(c.ICommandService),r=L.getSheetCommandTarget(e);if(!r)return!1;const{unitId:i,subUnitId:s,worksheet:l}=r,d=a.get(L.SheetsSelectionsService).getCurrentLastSelection(),b=(x=d==null?void 0:d.range)!=null?x:{startRow:0,endRow:0,startColumn:0,endColumn:0},v=L.isSingleCellSelection(d)?L.expandToContinuousRange(b,{up:!0,left:!0,right:!0,down:!0},l):b,S=await ht(a,i,s,v);return S?(t.executeCommand(n.AddSheetTableCommand.id,{...S}),!0):!1}};async function ht(a,e,t,r,i){const s=a.get(p.IDialogService),l=a.get(c.LocaleService);return new Promise(u=>{const d={unitId:e,subUnitId:t,range:r,tableId:i,onConfirm:b=>{u(b),s.close(he)},onCancel:()=>{u(null),s.close(he)}};s.open({id:he,title:{title:l.t("sheets-table.selectRange")},draggable:!0,destroyOnClose:!0,mask:!1,maskClosable:!1,children:{label:{name:he,props:d}},width:300,onClose:()=>{u(null),s.close(he)}})})}const bt="sheets-table-ui.config",et={anchorHeight:24,anchorBackgroundColor:"rgb(134,139,156)"};var Jt=Object.getOwnPropertyDescriptor,en=(a,e,t,r)=>{for(var i=r>1?void 0:r?Jt(e,t):e,s=a.length-1,l;s>=0;s--)(l=a[s])&&(i=l(i)||i);return i},tn=(a,e)=>(t,r)=>e(t,r,a);let de=class extends c.Disposable{constructor(e){super();H(this,"_refreshTable",new R.Subject);H(this,"refreshTable$",this._refreshTable.asObservable());this._commandService=e,this._initListener()}_initListener(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(e.id===L.SetRangeThemeMutation.id){const t=e.params,{styleName:r}=t;r.startsWith(n.SHEET_TABLE_CUSTOM_THEME_PREFIX)&&this._refreshTable.next(Math.random())}}))}};de=en([tn(0,c.Inject(c.ICommandService))],de);const nn=()=>{var le,re;const[a,e]=E.useState(""),[t,r]=E.useState(""),i=p.useDependency(p.ISidebarService),[s,l]=E.useState({}),u=p.useDependency(c.Injector),d=p.useDependency(Pe),b=p.useObservable(d.anchorPosition$),h=p.useDependency(c.ICommandService),v=p.useDependency(c.IUniverInstanceService),S=p.useDependency(L.WorkbookPermissionService),x=p.useObservable(S.unitPermissionInitStateChange$,!1),I=p.useDependency(n.TableManager),j=p.useDependency(L.SheetRangeThemeModel),y=p.useDependency(de),$=p.useObservable(y.refreshTable$),w=p.useDependency(c.LocaleService),B=p.useDependency(L.SheetsSelectionsService),M=p.useObservable(B.selectionChanged$,[{range:c.cellToRange(0,0),primary:null}]),[,g]=E.useState(Math.random()),D=p.useDependency(c.IConfigService).getConfig(bt),T=(le=D==null?void 0:D.anchorHeight)!=null?le:24,O=(re=D==null?void 0:D.anchorBackgroundColor)!=null?re:"rgb(53,91,183)",k=(C,P)=>{l(V=>({...V,[C]:P}))};if(E.useEffect(()=>{g(Math.random())},[$]),!(b!=null&&b.length))return null;const W=L.getSheetCommandTarget(v);if(!W)return null;const{unitId:F,subUnitId:q}=W,te=(C,P)=>{var Z;if(((Z=I.getTableById(F,C))==null?void 0:Z.getDisplayName())===P){e(""),r("");return}h.executeCommand(n.SetSheetTableCommand.id,{tableId:C,unitId:F,name:P}),r(""),e("")},ne=async C=>{const P=I.getTableById(F,C);if(!P)return;const V=P.getRange(),Z=await ht(u,F,q,V,C);Z&&h.executeCommand(n.SetSheetTableCommand.id,{tableId:C,unitId:F,updateRange:{newRange:Z.range}})};return x?o.jsx("div",{className:"univer-absolute univer-z-50 univer-h-0 univer-w-0",children:b.map(C=>{var ge,Ce,f,_,G,X,J;const P=I.getTableById(F,C.tableId);if(!P)return null;const V=j.getRangeThemeStyle(F,P.getTableStyleId()),Z=(f=(Ce=(ge=V==null?void 0:V.getHeaderRowStyle())==null?void 0:ge.bg)==null?void 0:Ce.rgb)!=null?f:O,Me=(X=(G=(_=V==null?void 0:V.getHeaderRowStyle())==null?void 0:_.cl)==null?void 0:G.rgb)!=null?X:"rgb(255, 255, 255)",Re=P.getRange();if(!(M!=null&&M.length))return null;const Ne=M[M.length-1].range,ve=!c.Rectangle.intersects(Re,Ne)&&C.y<=20;return o.jsxs("div",{className:m.clsx("univer-shadow-xs univer-absolute univer-box-border univer-cursor-pointer univer-items-center univer-rounded-xl univer-pl-2 univer-pr-2",m.borderClassName,{"univer-flex":!ve,"univer-hidden":ve}),style:{left:C.x,top:Math.max(C.y,0),backgroundColor:Z,color:Me,borderWidth:"0.5px",height:T?`${T}px`:"24px"},children:[o.jsx("div",{className:"univer-text-nowrap",children:a===C.tableId?o.jsx(m.Input,{className:"univer-h-[18px] univer-min-w-16 univer-rounded-none",inputClass:"univer-h-[18px] univer-w-[80px]",value:t,onChange:U=>r(U),onBlur:()=>te(C.tableId,t),onKeyDown:U=>{U.key==="Enter"&&te(C.tableId,t)},autoFocus:a===C.tableId}):o.jsx("div",{className:"univer-h-[18px] univer-max-w-24 univer-truncate univer-text-sm",children:C.tableName})}),o.jsx(m.Dropdown,{align:"start",overlay:o.jsxs("div",{className:"univer-pb-2 univer-pt-2",children:[o.jsxs("div",{className:"univer-flex univer-min-w-32 univer-cursor-pointer univer-items-center univer-gap-2 univer-pb-1 univer-pl-2 univer-pr-2 univer-pt-1 univer-text-sm hover:univer-bg-gray-200",onClick:()=>{e(C.tableId),r(C.tableName)},children:[o.jsx(ut,{}),w.t("sheets-table.rename")]}),o.jsx("div",{className:"univer-mb-1 univer-mt-1 univer-h-px univer-w-full univer-bg-gray-200"}),o.jsxs("div",{onClick:()=>ne(C.tableId),className:"univer-flex univer-min-w-32 univer-cursor-pointer univer-items-center univer-gap-2 univer-pb-1 univer-pl-2 univer-pr-2 univer-pt-1 univer-text-sm hover:univer-bg-gray-200",children:[o.jsx(ct,{}),w.t("sheets-table.updateRange")]}),o.jsxs("div",{className:"univer-flex univer-min-w-32 univer-cursor-pointer univer-items-center univer-gap-2 univer-pb-1 univer-pl-2 univer-pr-2 univer-pt-1 univer-text-sm hover:univer-bg-gray-200",onClick:()=>{k(C.tableId,!1);const U=I.getTableById(F,C.tableId);if(!U)return;const ce=U.getTableConfig(),ue={id:xt,header:{title:w.t("sheets-table.tableStyle")},children:{label:at,oldConfig:ce,unitId:F,subUnitId:q,tableId:C.tableId},width:330};i.open(ue)},children:[o.jsx(mt,{extend:{colorChannel1:"rgb(53,91,183)"}}),w.t("sheets-table.setTheme")]}),o.jsx("div",{className:"univer-mb-1 univer-mt-1 univer-h-px univer-w-full univer-bg-gray-200"}),o.jsxs("div",{className:"univer-flex univer-min-w-32 univer-cursor-pointer univer-items-center univer-pb-1 univer-pl-2 univer-pr-2 univer-pt-1 univer-text-sm hover:univer-bg-gray-200",onClick:()=>{k(C.tableId,!1),h.executeCommand(n.DeleteSheetTableCommand.id,{tableId:C.tableId,subUnitId:q,unitId:F})},children:[o.jsx(ot,{className:"univer-mr-2"}),w.t("sheets-table.removeTable")]})]}),open:(J=s[C.tableId])!=null?J:!1,onOpenChange:U=>{k(C.tableId,U)},children:o.jsx(Ke,{})},C.tableId)]},C.tableId)})}):null};var rn=Object.getOwnPropertyDescriptor,an=(a,e,t,r)=>{for(var i=r>1?void 0:r?rn(e,t):e,s=a.length-1,l;s>=0;s--)(l=a[s])&&(i=l(i)||i);return i},K=(a,e)=>(t,r)=>e(t,r,a);let Pe=class extends c.Disposable{constructor(e,t,r,i,s,l,u,d,b,h,v){super();H(this,"_anchorVisible$",new R.BehaviorSubject(!0));H(this,"_timer");H(this,"_anchorPosition$",new R.BehaviorSubject([]));H(this,"anchorPosition$",this._anchorPosition$.asObservable());this._context=e,this._injector=t,this._sheetSkeletonManagerService=r,this._renderManagerService=i,this._commandService=s,this._univerInstanceService=l,this._uiPartsService=u,this._tableManager=d,this._scrollManagerService=b,this._workbookPermissionService=h,this._permissionService=v,this._initUI(),this._initListener(),this._initTableAnchor()}_initUI(){this.disposeWithMe(this._uiPartsService.registerComponent(p.BuiltInUIPart.CONTENT,()=>p.connectInjector(nn,this._injector)))}_initListener(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{(e.id===Q.SetZoomRatioOperation.id||e.id===Q.SetScrollOperation.id)&&(this._anchorVisible$.next(!1),this._timer&&clearTimeout(this._timer),this._timer=setTimeout(()=>{this._anchorVisible$.next(!0)},300))}))}_initTableAnchor(){this.disposeWithMe(R.merge(this._context.unit.activeSheet$,this._sheetSkeletonManagerService.currentSkeleton$,this._scrollManagerService.validViewportScrollInfo$,this._tableManager.tableAdd$,this._tableManager.tableDelete$,this._tableManager.tableNameChanged$,this._tableManager.tableRangeChanged$,this._tableManager.tableThemeChanged$,this._workbookPermissionService.unitPermissionInitStateChange$.pipe(R.filter(e=>e)),this._permissionService.permissionPointUpdate$.pipe(R.debounceTime(300)),this._anchorVisible$).subscribe(()=>{var b;if(!this._anchorVisible$.getValue()){this._anchorPosition$.next([]);return}const t=this._context.unit,r=t.getActiveSheet(),i=r==null?void 0:r.getSheetId(),s=this._tableManager.getTableList(this._context.unitId).filter(h=>h.subUnitId===i),l=this._renderManagerService.getRenderById(this._context.unitId);if(!l){this._anchorPosition$.next([]);return}if(!((b=this._permissionService.getPermissionPoint(new L.WorkbookEditablePermission(t.getUnitId()).id))==null?void 0:b.value)){this._anchorPosition$.next([]);return}const d=s.reduce((h,v)=>{const{startRow:S,startColumn:x}=v.range,I=l.with(Q.SheetSkeletonManagerService),j=Q.getSheetObject(this._univerInstanceService,this._renderManagerService);if(!j)return h;const{scene:y}=j,$=y.getViewport(se.SHEET_VIEWPORT_KEY.VIEW_MAIN);if(!$)return h;const w=y==null?void 0:y.scaleX,B=y==null?void 0:y.scaleY,M=y==null?void 0:y.getViewportScrollXY($);if(!w||!y||!B||!M)return h;const g=I.getCurrentSkeleton();if(!g)return h;const N=g.getNoMergeCellWithCoordByIndex(S,x),D=se.convertTransformToOffsetX(N.startX,w,M),T=se.convertTransformToOffsetY(N.startY,B,M)-25-4;return T>=-10&&D>=45&&h.push({x:D,y:T,tableId:v.id,tableName:v.name}),h},[]);this._anchorPosition$.next(d)}))}};Pe=an([K(1,c.Inject(c.Injector)),K(2,c.Inject(Q.SheetSkeletonManagerService)),K(3,se.IRenderManagerService),K(4,c.ICommandService),K(5,c.IUniverInstanceService),K(6,p.IUIPartsService),K(7,c.Inject(n.TableManager)),K(8,c.Inject(Q.SheetScrollManagerService)),K(9,c.Inject(L.WorkbookPermissionService)),K(10,c.Inject(c.IPermissionService))],Pe);const me=16;new Path2D("M3.30363 3C2.79117 3 2.51457 3.60097 2.84788 3.99024L6.8 8.60593V12.5662C6.8 12.7184 6.8864 12.8575 7.02289 12.9249L8.76717 13.7863C8.96655 13.8847 9.2 13.7396 9.2 13.5173V8.60593L13.1521 3.99024C13.4854 3.60097 13.2088 3 12.6964 3H3.30363Z");class tt{static drawNoSetting(e,t,r,i){e.save(),se.Rect.drawWith(e,{radius:2,width:me,height:me,fill:i}),e.lineCap="square",e.strokeStyle=r,e.scale(t/me,t/me),e.beginPath(),e.lineWidth=1,e.lineCap="round",e.moveTo(3,4),e.lineTo(13,4),e.moveTo(4.5,8),e.lineTo(11.5,8),e.moveTo(6,12),e.lineTo(10,12),e.stroke(),e.restore()}static drawIconByPath(e,t,r,i){e.save(),e.strokeStyle=r,e.fillStyle=i,se.Rect.drawWith(e,{radius:2,width:me,height:me,fill:i}),t.forEach(s=>{const l=new Path2D(s);e.fillStyle=r,e.fill(l,"evenodd")}),e.restore()}}const sn=["M3.30363 3C2.79117 3 2.51457 3.60097 2.84788 3.99024L6.8 8.60593V12.5662C6.8 12.7184 6.8864 12.8575 7.02289 12.9249L8.76717 13.7863C8.96655 13.8847 9.2 13.7396 9.2 13.5173V8.60593L13.1521 3.99024C13.4854 3.60097 13.2088 3 12.6964 3H3.30363Z"],on=["M12.4008 13.1831C12.6907 13.1831 12.9258 12.9481 12.9258 12.6581V4.60873L14.013 5.69597C14.218 5.901 14.5505 5.901 14.7555 5.69597C14.9605 5.49094 14.9605 5.15853 14.7555 4.95351L12.7721 2.97017C12.5671 2.76515 12.2347 2.76515 12.0297 2.97017L10.0463 4.95351C9.84132 5.15853 9.84132 5.49094 10.0463 5.69597C10.2514 5.901 10.5838 5.901 10.7888 5.69597L11.8758 4.60901V12.6581C11.8758 12.9481 12.1108 13.1831 12.4008 13.1831Z","M1.28069 4.85447C0.842195 4.33439 1.21191 3.5391 1.89218 3.5391H8.59333C9.2736 3.5391 9.64331 4.33439 9.20482 4.85447L6.51052 8.0501V11.6601C6.51052 12.2245 5.94174 12.6114 5.41683 12.404L4.48092 12.0343C4.1756 11.9136 3.97498 11.6187 3.97498 11.2904V8.0501L1.28069 4.85447Z"],ln=["M12.4008 2.81641C12.6907 2.81641 12.9258 3.05146 12.9258 3.34141V11.3908L14.013 10.3036C14.218 10.0986 14.5505 10.0986 14.7555 10.3036C14.9605 10.5086 14.9605 10.841 14.7555 11.046L12.7721 13.0294C12.5671 13.2344 12.2347 13.2344 12.0297 13.0294L10.0463 11.046C9.84132 10.841 9.84132 10.5086 10.0463 10.3036C10.2514 10.0986 10.5838 10.0986 10.7888 10.3036L11.8758 11.3905V3.34141C11.8758 3.05146 12.1108 2.81641 12.4008 2.81641Z","M1.28069 4.85444C0.842195 4.33435 1.21191 3.53906 1.89218 3.53906H8.59333C9.2736 3.53906 9.64331 4.33435 9.20482 4.85443L6.51052 8.05006V11.6601C6.51052 12.2245 5.94174 12.6113 5.41683 12.404L4.48092 12.0342C4.1756 11.9136 3.97498 11.6186 3.97498 11.2903V8.05006L1.28069 4.85444Z"],cn=["M11.9003 13.7046C11.9003 13.9969 11.6633 14.2339 11.371 14.2339C11.0787 14.2339 10.8417 13.9969 10.8417 13.7046V3.57272L9.74577 4.66862C9.53906 4.87534 9.20391 4.87534 8.9972 4.66862C8.79048 4.46191 8.79048 4.12676 8.9972 3.92005L10.9969 1.92039C11.2036 1.71368 11.5387 1.71368 11.7454 1.92039L13.7451 3.92005C13.9518 4.12676 13.9518 4.46191 13.7451 4.66862C13.5384 4.87534 13.2032 4.87534 12.9965 4.66862L11.9003 3.57243V13.7046Z","M2.69779 10.0113C2.40546 10.0113 2.16847 9.77429 2.16847 9.48196C2.16847 9.18962 2.40546 8.95264 2.69779 8.95264H6.67804C6.89213 8.95264 7.08514 9.0816 7.16707 9.2794C7.249 9.47719 7.20371 9.70486 7.05233 9.85624L3.97569 12.9329H6.67804C6.97038 12.9329 7.20736 13.1699 7.20736 13.4622C7.20736 13.7545 6.97038 13.9915 6.67804 13.9915H2.69779C2.4837 13.9915 2.29069 13.8626 2.20876 13.6648C2.12684 13.467 2.17212 13.2393 2.32351 13.0879L5.40015 10.0113H2.69779Z","M5.51638 2.58693C5.23363 1.81542 4.14248 1.81543 3.85973 2.58693L2.13245 7.29995C2.03185 7.57443 2.17281 7.87849 2.4473 7.97909C2.72178 8.07969 3.02584 7.93872 3.12644 7.66424L3.64346 6.25351L3.64504 6.25351H5.73266L6.24968 7.66424C6.35027 7.93872 6.65433 8.07969 6.92882 7.97909C7.2033 7.87849 7.34426 7.57443 7.24367 7.29995L5.51638 2.58693ZM5.34467 5.19487L4.68806 3.40325L4.03144 5.19487H5.34467Z"],un=["M11.9003 2.29495C11.9003 2.00261 11.6633 1.76562 11.371 1.76562C11.0787 1.76562 10.8417 2.00261 10.8417 2.29495V12.4268L9.74577 11.3309C9.53906 11.1242 9.20391 11.1242 8.9972 11.3309C8.79048 11.5376 8.79048 11.8727 8.9972 12.0795L10.9969 14.0791C11.2036 14.2858 11.5387 14.2858 11.7454 14.0791L13.7451 12.0795C13.9518 11.8727 13.9518 11.5376 13.7451 11.3309C13.5384 11.1242 13.2032 11.1242 12.9965 11.3309L11.9003 12.4271V2.29495Z","M2.69792 10.0113C2.40558 10.0113 2.16859 9.77429 2.16859 9.48196C2.16859 9.18962 2.40558 8.95264 2.69792 8.95264H6.67816C6.89225 8.95264 7.08526 9.0816 7.16719 9.2794C7.24912 9.47719 7.20384 9.70486 7.05245 9.85624L3.97581 12.9329H6.67816C6.9705 12.9329 7.20749 13.1699 7.20749 13.4622C7.20749 13.7545 6.9705 13.9915 6.67816 13.9915H2.69792C2.48383 13.9915 2.29082 13.8626 2.20889 13.6648C2.12696 13.467 2.17224 13.2393 2.32363 13.0879L5.40027 10.0113H2.69792Z","M5.5165 2.58693C5.23375 1.81542 4.1426 1.81543 3.85985 2.58693L2.13257 7.29995C2.03197 7.57443 2.17294 7.8785 2.44742 7.97909C2.7219 8.07969 3.02596 7.93872 3.12656 7.66424L3.64358 6.25351L3.64516 6.25351H5.73278L6.2498 7.66424C6.35039 7.93872 6.65446 8.07969 6.92894 7.97909C7.20342 7.8785 7.34438 7.57443 7.24379 7.29995L5.5165 2.58693ZM5.34479 5.19487L4.68818 3.40325L4.03156 5.19487H5.34479Z"];var dn=Object.getOwnPropertyDescriptor,mn=(a,e,t,r)=>{for(var i=r>1?void 0:r?dn(e,t):e,s=a.length-1,l;s>=0;s--)(l=a[s])&&(i=l(i)||i);return i},Ze=(a,e)=>(t,r)=>e(t,r,a);const ee=16,De=1;let Qe=class extends se.Shape{constructor(e,t,r,i,s){super(e,t);H(this,"_cellWidth",0);H(this,"_cellHeight",0);H(this,"_filterParams");H(this,"_hovered",!1);this._contextService=r,this._commandService=i,this._themeService=s,this.setShapeProps(t),this.onPointerDown$.subscribeEvent(l=>this.onPointerDown(l)),this.onPointerEnter$.subscribeEvent(()=>this.onPointerEnter()),this.onPointerLeave$.subscribeEvent(()=>this.onPointerLeave())}setShapeProps(e){typeof e.cellHeight<"u"&&(this._cellHeight=e.cellHeight),typeof e.cellWidth<"u"&&(this._cellWidth=e.cellWidth),typeof e.filterParams<"u"&&(this._filterParams=e.filterParams),this.transformByState({width:e.width,height:e.height})}_draw(e){const t=this._cellHeight,r=this._cellWidth,i=ee-r,s=ee-t;e.save();const l=new Path2D;l.rect(i,s,r,t),e.clip(l);const{buttonState:u}=this._filterParams,d=this._themeService.getColorFromTheme("primary.600"),b=this._hovered?this._themeService.getColorFromTheme("gray.50"):"rgba(255, 255, 255, 1.0)";let h;switch(u){case n.SheetsTableButtonStateEnum.FilteredSortNone:h=sn;break;case n.SheetsTableButtonStateEnum.FilteredSortAsc:h=on;break;case n.SheetsTableButtonStateEnum.FilteredSortDesc:h=ln;break;case n.SheetsTableButtonStateEnum.FilterNoneSortNone:break;case n.SheetsTableButtonStateEnum.FilterNoneSortAsc:h=cn;break;case n.SheetsTableButtonStateEnum.FilterNoneSortDesc:h=un;break}h?tt.drawIconByPath(e,h,d,b):u!==void 0&&tt.drawNoSetting(e,ee,d,b),e.restore()}onPointerDown(e){if(e.button===2)return;const{row:t,col:r,unitId:i,subUnitId:s,tableId:l}=this._filterParams;this._contextService.getContextValue(ie)||!this._commandService.hasCommand(Ye.id)||setTimeout(()=>{const d={row:t,col:r,unitId:i,subUnitId:s,tableId:l};this._commandService.executeCommand(Ye.id,d)},200)}onPointerEnter(){this._hovered=!0,this.makeDirty(!0)}onPointerLeave(){this._hovered=!1,this.makeDirty(!0)}};Qe=mn([Ze(2,c.IContextService),Ze(3,c.ICommandService),Ze(4,c.Inject(c.ThemeService))],Qe);var hn=Object.getOwnPropertyDescriptor,bn=(a,e,t,r)=>{for(var i=r>1?void 0:r?hn(e,t):e,s=a.length-1,l;s>=0;s--)(l=a[s])&&(i=l(i)||i);return i},xe=(a,e)=>(t,r)=>e(t,r,a);const pn=5e3,vn=(a,e,t,r)=>{switch(r){case c.VerticalAlign.TOP:return a+De;case c.VerticalAlign.MIDDLE:return a+Math.max(0,(t-ee)/2);case c.VerticalAlign.BOTTOM:default:return e-ee-De}};let Ge=class extends c.RxDisposable{constructor(e,t,r,i,s,l){super();H(this,"_buttonRenderDisposable",null);H(this,"_tableFilterButtonShapes",[]);this._context=e,this._injector=t,this._sheetSkeletonManagerService=r,this._sheetInterceptorService=i,this._tableManager=s,this._commandService=l,this._initRenderer(),this._initCommandExecuted()}dispose(){super.dispose(),this._disposeRendering()}_initRenderer(){const e=this._tableManager;this._sheetSkeletonManagerService.currentSkeleton$.pipe(R.switchMap(t=>{var u;if(!t)return R.of(null);const{unit:r,unitId:i}=this._context,s=((u=r.getActiveSheet())==null?void 0:u.getSheetId())||"",l=()=>({unitId:i,worksheetId:s,tableFilterRanges:this._tableManager.getSheetFilterRangeWithState(r.getUnitId(),s),skeleton:t.skeleton});return R.merge(e.tableAdd$,e.tableNameChanged$,e.tableRangeChanged$,e.tableThemeChanged$,e.tableDelete$,e.tableFilterChanged$).pipe(R.map(()=>l()),R.startWith(l()))}),R.takeUntil(this.dispose$)).subscribe(t=>{this._disposeRendering(),!(!t||!t.tableFilterRanges)&&this._renderButtons(t)})}_initCommandExecuted(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{var u;if(e.id!==L.SetVerticalTextAlignCommand.id)return;const{unit:t,unitId:r}=this._context,i=((u=t.getActiveSheet())==null?void 0:u.getSheetId())||"",s=this._sheetSkeletonManagerService.getCurrentSkeleton();if(!s)return;const l={unitId:r,worksheetId:i,tableFilterRanges:this._tableManager.getSheetFilterRangeWithState(t.getUnitId(),i),skeleton:s};this._disposeRendering(),!(!l||!l.tableFilterRanges)&&this._renderButtons(l)}))}_renderButtons(e){const{tableFilterRanges:t,unitId:r,skeleton:i,worksheetId:s}=e,{unit:l,scene:u}=this._context,d=l.getSheetBySheetId(s);if(d){for(const{range:b,states:h,tableId:v}of t){const{startRow:S,startColumn:x,endColumn:I}=b;this._interceptCellContent(r,s,b);for(let j=x;j<=I;j++){const y=`sheets-table-filter-button-${S}-${j}`,$=Q.getCoordByCell(S,j,u,i),w=d.getCellStyle(S,j),B=(w==null?void 0:w.vt)||c.VerticalAlign.BOTTOM,{startX:M,startY:g,endX:N,endY:D}=$,T=N-M,O=D-g;if(O<=De||T<=De)continue;const k=h[j-x],W=N-ee-De,F=vn(g,D,O,B),q={left:W,top:F,height:ee,width:ee,zIndex:pn,cellHeight:O,cellWidth:T,filterParams:{unitId:r,subUnitId:s,row:S,col:j,buttonState:k,tableId:v}},te=this._injector.createInstance(Qe,y,q);this._tableFilterButtonShapes.push(te)}}u.addObjects(this._tableFilterButtonShapes),u.makeDirty()}}_interceptCellContent(e,t,r){const{startRow:i,startColumn:s,endColumn:l}=r;this._buttonRenderDisposable=this._sheetInterceptorService.intercept(L.INTERCEPTOR_POINT.CELL_CONTENT,{effect:c.InterceptorEffectEnum.Style,handler:(u,d,b)=>{const{row:h,col:v,unitId:S,subUnitId:x}=d;return S!==e||x!==t||h!==i||v<s||v>l||((!u||u===d.rawData)&&(u={...d.rawData}),u.fontRenderExtension={...u==null?void 0:u.fontRenderExtension,rightOffset:ee}),b(u)},priority:10})}_disposeRendering(){var e;this._tableFilterButtonShapes.forEach(t=>t.dispose()),(e=this._buttonRenderDisposable)==null||e.dispose(),this._buttonRenderDisposable=null,this._tableFilterButtonShapes=[]}};Ge=bn([xe(1,c.Inject(c.Injector)),xe(2,c.Inject(Q.SheetSkeletonManagerService)),xe(3,c.Inject(L.SheetInterceptorService)),xe(4,c.Inject(n.TableManager)),xe(5,c.ICommandService)],Ge);const gn=a=>{const{unitId:e,subUnitId:t,range:r,onCancel:i,onConfirm:s,tableId:l}=a,u=p.useDependency(n.TableManager),[d,b]=E.useState(r),[h,v]=E.useState(""),S=p.useDependency(c.LocaleService),x=p.useDependency(c.IUniverInstanceService);return o.jsxs(o.Fragment,{children:[o.jsx(Et.RangeSelector,{maxRangeCount:1,unitId:e,subUnitId:t,initialValue:Ae.serializeRange(r),onChange:(I,j)=>{const y=Ae.serializeRange(r),$=Ae.deserializeRangeWithSheet(j).range,w=L.getSheetCommandTarget(x,{unitId:e,subUnitId:t});if(!w)return;if(w.worksheet.getMergeData().some(k=>c.Rectangle.intersects($,k))){v(S.t("sheets-table.tableRangeWithMergeError"));return}if(u.getTablesBySubunitId(e,t).some(k=>{if(k.getId()===l)return!1;const W=k.getRange();return c.Rectangle.intersects($,W)})){v(S.t("sheets-table.tableRangeWithOtherTableError"));return}const{startRow:D,endRow:T}=$;if(D===T){v(S.t("sheets-table.tableRangeSingleRowError"));return}if(y!==j){if(l){const k=u.getTableById(e,l);if(k){const W=k.getRange();if(c.Rectangle.intersects($,W)&&W.startRow===$.startRow){b($),v(""),s({unitId:e,subUnitId:t,range:$});return}else{v(S.t("sheets-table.updateError"));return}}}b($),v("")}},supportAcrossSheet:!1}),h&&o.jsx("div",{className:"univer-mt-1 univer-text-xs univer-text-red-500",children:h}),o.jsxs("div",{className:"univer-mt-4 univer-flex univer-justify-end",children:[o.jsx(m.Button,{onClick:i,children:S.t("sheets-table.cancel")}),o.jsx(m.Button,{variant:"primary",onClick:()=>{h||s({unitId:e,subUnitId:t,range:d})},className:"univer-ml-2",children:S.t("sheets-table.confirm")})]})]})},Cn=a=>{var P,V,Z,Fe,Me,Re,Ve,Ne,He,ve,ge,Ce;const{unitId:e,subUnitId:t,tableId:r}=a,i=p.useDependency(c.ICommandService),s=p.useDependency(c.LocaleService),l=p.useDependency(n.TableManager),u=l.getTableById(e,r),d=p.useDependency(L.SheetRangeThemeModel),b=p.useDependency(de),h=p.useObservable(d.rangeThemeMapChange$),v=p.useObservable(b.refreshTable$),S=p.useDependency(c.ErrorService),[,x]=E.useState(Math.random()),I=p.useObservable(l.tableThemeChanged$,{theme:u==null?void 0:u.getTableStyleId(),oldTheme:u==null?void 0:u.getTableStyleId(),unitId:e,subUnitId:t,tableId:r}),j=d.getRegisteredRangeThemes().filter(f=>f==null?void 0:f.startsWith(wt)),y=d.getALLRegisteredTheme(e).filter(f=>f==null?void 0:f.startsWith(We)),$=u==null?void 0:u.getTableStyleId(),w=y.find(f=>f===$),B=w||y[0],M=d.getCustomRangeThemeStyle(e,B),g=(Z=(V=(P=M==null?void 0:M.getHeaderRowStyle())==null?void 0:P.bg)==null?void 0:V.rgb)!=null?Z:ae,N=(Re=(Me=(Fe=M==null?void 0:M.getFirstRowStyle())==null?void 0:Fe.bg)==null?void 0:Me.rgb)!=null?Re:ae,D=(He=(Ne=(Ve=M==null?void 0:M.getSecondRowStyle())==null?void 0:Ve.bg)==null?void 0:Ne.rgb)!=null?He:ae,T=(Ce=(ge=(ve=M==null?void 0:M.getLastRowStyle())==null?void 0:ve.bg)==null?void 0:ge.rgb)!=null?Ce:ae,[O,k]=E.useState(null),W=f=>{i.executeCommand(n.SetSheetTableCommand.id,{unitId:e,tableId:r,theme:f})},F=()=>{if(y.length>=11){S.emit(s.t("sheets-table.customTooMore"));return}const f=y[y.length-1];let _=`${We}1`;if(f){const X=Number(f.split("-")[2]);_=`${We}${X+1}`}const G=new L.RangeThemeStyle(_,{...n.customEmptyThemeWithBorderStyle});i.executeCommand(n.AddTableThemeCommand.id,{unitId:e,tableId:r,themeStyle:G})},q=(f,_)=>{i.executeCommand(L.SetRangeThemeMutation.id,{unitId:e,subUnitId:t,styleName:f,style:_})},te=f=>{i.executeCommand(n.RemoveTableThemeCommand.id,{unitId:e,tableId:r,themeName:f})};if(E.useEffect(()=>{x(Math.random())},[h,v]),!u)return null;const ne=new c.ColorKit(g).isDark(),le=new c.ColorKit(N).isDark(),re=new c.ColorKit(D).isDark(),C=new c.ColorKit(T).isDark();return o.jsxs("div",{children:[o.jsx("h5",{children:s.t("sheets-table.defaultStyle")}),o.jsx("div",{className:"univer-flex univer-gap-2",children:j.map(f=>{var ce,ue,Te,fe,Se,ye,Ee,Ie;const _=d.getDefaultRangeThemeStyle(f),G=((ue=(ce=_==null?void 0:_.getHeaderRowStyle())==null?void 0:ce.bg)==null?void 0:ue.rgb)||ae,X=((fe=(Te=_==null?void 0:_.getFirstRowStyle())==null?void 0:Te.bg)==null?void 0:fe.rgb)||ae,J=((ye=(Se=_==null?void 0:_.getSecondRowStyle())==null?void 0:Se.bg)==null?void 0:ye.rgb)||ae,U=((Ie=(Ee=_==null?void 0:_.getLastRowStyle())==null?void 0:Ee.bg)==null?void 0:Ie.rgb)||ae;return o.jsxs("div",{className:m.clsx("univer-h-10 univer-w-8 univer-cursor-pointer univer-border univer-border-solid univer-border-gray-200 univer-p-px [&>div]:univer-box-border [&>div]:univer-h-2.5",{"univer-border-blue-500":f===I.theme}),onClick:()=>W(f),children:[o.jsx("div",{style:{background:G,border:`${Y}`}}),o.jsx("div",{style:{background:X,border:`${Y}`}}),o.jsx("div",{style:{background:J,border:`${Y}`}}),o.jsx("div",{style:{background:U,border:`${Y}`}})]},f)})}),o.jsx("h5",{children:s.t("sheets-table.customStyle")}),o.jsxs("div",{className:m.clsx("univer-w-full univer-rounded-sm",m.borderClassName),children:[o.jsxs("div",{className:"univer-flex univer-flex-wrap univer-gap-2 univer-p-2",children:[o.jsx("div",{className:m.clsx("univer-h-10 univer-w-8 univer-cursor-pointer univer-p-px univer-text-center univer-leading-10",m.borderClassName),onClick:F,children:"+"}),y.map(f=>{var ce,ue,Te,fe,Se,ye,Ee,Ie;const _=d.getCustomRangeThemeStyle(e,f),G=(ue=(ce=_==null?void 0:_.getHeaderRowStyle())==null?void 0:ce.bg)==null?void 0:ue.rgb,X=(fe=(Te=_==null?void 0:_.getFirstRowStyle())==null?void 0:Te.bg)==null?void 0:fe.rgb,J=(ye=(Se=_==null?void 0:_.getSecondRowStyle())==null?void 0:Se.bg)==null?void 0:ye.rgb,U=(Ie=(Ee=_==null?void 0:_.getLastRowStyle())==null?void 0:Ee.bg)==null?void 0:Ie.rgb;return o.jsxs("div",{className:m.clsx("univer-relative univer-h-10 univer-w-8 univer-cursor-pointer univer-border univer-border-solid univer-border-gray-200 univer-p-px",{"univer-border-blue-500":f===I.theme}),onClick:()=>W(f),onMouseEnter:()=>k(f),onMouseLeave:()=>k(null),children:[o.jsx("div",{className:"univer-box-border univer-h-2.5",style:{background:G!=null?G:Y,border:`${G?Y:je}`}}),o.jsx("div",{className:"univer-box-border univer-h-2.5",style:{background:X!=null?X:Y,border:`${X?Y:je}`}}),o.jsx("div",{className:"univer-box-border univer-h-2.5",style:{background:J!=null?J:Y,border:`${J?Y:je}`}}),o.jsx("div",{className:"univer-box-border univer-h-2.5",style:{background:U!=null?U:Y,border:`${U?Y:je}`}}),o.jsx("div",{className:"univer-absolute univer-right-[-3px] univer-top-[-3px] univer-h-3 univer-w-3 univer-rounded-md univer-bg-gray-200 univer-text-center univer-text-xs univer-leading-[10px]",style:{display:O===f?"block":"none"},onClick:ft=>{ft.stopPropagation(),te(f)},children:"x"})]},f)})]}),w&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"univer-h-px univer-w-full univer-bg-gray-200"}),o.jsxs("div",{className:"univer-flex univer-flex-col univer-gap-2 univer-p-2",children:[o.jsxs("div",{className:"univer-flex univer-h-9 univer-gap-2",children:[o.jsx("div",{className:m.clsx("univer-box-border univer-h-full univer-w-52 univer-rounded-sm univer-text-center univer-leading-9",m.borderClassName,{"univer-text-white":ne,"univer-text-gray-900":!ne}),style:{background:g},children:s.t("sheets-table.header")}),o.jsx(m.Dropdown,{overlay:o.jsx("div",{className:"univer-p-2",children:o.jsx(m.ColorPicker,{value:g,onChange:f=>{const _=n.processStyleWithBorderStyle("headerRowStyle",{bg:{rgb:f},cl:{rgb:new c.ColorKit(f).isDark()?"#fff":"#000"}});q(u.getTableStyleId(),{headerRowStyle:_})}})}),children:o.jsxs("div",{className:m.clsx("univer-flex univer-cursor-pointer univer-items-center univer-gap-2 univer-rounded-sm univer-bg-white univer-p-1",m.borderClassName),children:[o.jsx("div",{className:m.clsx("univer-h-4 univer-w-4 univer-rounded-lg univer-bg-gray-400",m.borderClassName,{"univer-text-white":ne,"univer-text-gray-900":!ne}),style:{background:g}}),o.jsx(we,{className:"univer-h-2 univer-w-2"})]})})]}),o.jsxs("div",{className:"univer-flex univer-h-9 univer-gap-2",children:[o.jsx("div",{className:m.clsx("univer-box-border univer-h-full univer-w-52 univer-rounded-sm univer-text-center univer-leading-9",m.borderClassName,{"univer-text-white":le,"univer-text-gray-900":!le}),style:{background:N},children:s.t("sheets-table.firstLine")}),o.jsx(m.Dropdown,{overlay:o.jsx("div",{className:"univer-p-2",children:o.jsx(m.ColorPicker,{value:N,onChange:f=>{q(u.getTableStyleId(),{firstRowStyle:{bg:{rgb:f},cl:{rgb:new c.ColorKit(f).isDark()?"#fff":"#000"}}})}})}),children:o.jsxs("div",{className:m.clsx("univer-flex univer-cursor-pointer univer-items-center univer-gap-2 univer-rounded-sm univer-bg-white univer-p-1",m.borderClassName),children:[o.jsx("div",{className:m.clsx("univer-h-4 univer-w-4 univer-rounded-lg univer-bg-gray-400",m.borderClassName),style:{background:N}}),o.jsx(we,{className:"univer-h-2 univer-w-2"})]})})]}),o.jsxs("div",{className:"univer-flex univer-h-9 univer-gap-2",children:[o.jsx("div",{className:m.clsx("univer-box-border univer-h-full univer-w-52 univer-rounded-sm univer-text-center univer-leading-9",m.borderClassName,{"univer-text-white":re,"univer-text-gray-900":!re}),style:{background:D},children:s.t("sheets-table.secondLine")}),o.jsx(m.Dropdown,{overlay:o.jsx("div",{className:"univer-p-2",children:o.jsx(m.ColorPicker,{value:D,onChange:f=>q(u.getTableStyleId(),{secondRowStyle:{bg:{rgb:f},cl:{rgb:new c.ColorKit(f).isDark()?"#fff":"#000"}}})})}),children:o.jsxs("div",{className:m.clsx("univer-flex univer-cursor-pointer univer-items-center univer-gap-2 univer-rounded-sm univer-bg-white univer-p-1",m.borderClassName),children:[o.jsx("div",{className:m.clsx("univer-h-4 univer-w-4 univer-rounded-lg univer-bg-gray-400",m.borderClassName),style:{background:D}}),o.jsx(we,{className:"univer-h-2 univer-w-2"})]})})]}),o.jsxs("div",{className:"univer-flex univer-h-9 univer-gap-2",children:[o.jsx("div",{className:m.clsx("univer-box-border univer-h-full univer-w-52 univer-rounded-sm univer-text-center univer-leading-9",m.borderClassName,{"univer-text-white":C,"univer-text-gray-900":!C}),style:{background:T},children:s.t("sheets-table.footer")}),o.jsx(m.Dropdown,{overlay:o.jsx("div",{className:"univer-p-2",children:o.jsx(m.ColorPicker,{value:T,onChange:f=>{const _=n.processStyleWithBorderStyle("lastRowStyle",{bg:{rgb:f},cl:{rgb:new c.ColorKit(f).isDark()?"#fff":"#000"}});q(u.getTableStyleId(),{lastRowStyle:_})}})}),children:o.jsxs("div",{className:m.clsx("univer-flex univer-cursor-pointer univer-items-center univer-gap-2 univer-rounded-sm univer-bg-white univer-p-1",m.borderClassName),children:[o.jsx("div",{className:m.clsx("univer-h-4 univer-w-4 univer-rounded-lg univer-bg-gray-400",m.borderClassName),style:{background:T}}),o.jsx(we,{className:"univer-h-2 univer-w-2"})]})})]})]})]})]})]})},pt="sheet.table.context-insert_menu-id",vt="sheet.table.context-remove_menu-id";function Tn(a){return{id:Je.id,type:p.MenuItemType.BUTTON,icon:rt,tooltip:"sheets-table.title",title:"sheets-table.title",hidden$:p.getMenuHiddenObservable(a,c.UniverInstanceType.UNIVER_SHEET),disabled$:Q.getCurrentRangeDisable$(a,{},!0)}}function fn(a){return{id:pt,type:p.MenuItemType.SUBITEMS,icon:"InsertDoubleIcon",title:"sheets-table.insert.main",hidden$:gt(a)}}function Sn(a){return{id:vt,type:p.MenuItemType.SUBITEMS,icon:"ReduceDoubleIcon",title:"sheets-table.remove.main",hidden$:gt(a)}}function yn(a){return{id:n.SheetTableInsertRowCommand.id,type:p.MenuItemType.BUTTON,title:"sheets-table.insert.row",hidden$:Ct(a)}}function En(a){return{id:n.SheetTableInsertColCommand.id,title:"sheets-table.insert.col",type:p.MenuItemType.BUTTON}}function In(a){return{id:n.SheetTableRemoveRowCommand.id,type:p.MenuItemType.BUTTON,title:"sheets-table.remove.row",hidden$:Ct(a)}}function _n(a){return{id:n.SheetTableRemoveColCommand.id,title:"sheets-table.remove.col",type:p.MenuItemType.BUTTON}}function gt(a){const e=a.get(L.SheetsSelectionsService);return a.get(c.IUniverInstanceService).getCurrentTypeOfUnit$(c.UniverInstanceType.UNIVER_SHEET).pipe(R.switchMap(i=>i?i.activeSheet$.pipe(R.switchMap(s=>s?e.selectionMoveEnd$.pipe(R.switchMap(l=>{if(!l.length||l.length>1)return R.of(!0);const d=l[0].range,h=a.get(n.SheetsTableController).getContainerTableWithRange(i.getUnitId(),s.getSheetId(),d);return R.of(!h)})):R.of(!0))):R.of(!0)))}function Ct(a){const e=a.get(L.SheetsSelectionsService);return a.get(c.IUniverInstanceService).getCurrentTypeOfUnit$(c.UniverInstanceType.UNIVER_SHEET).pipe(R.switchMap(i=>i?i.activeSheet$.pipe(R.switchMap(s=>s?e.selectionMoveEnd$.pipe(R.switchMap(l=>{if(!l.length||l.length>1)return R.of(!0);const d=l[0].range,h=a.get(n.SheetsTableController).getContainerTableWithRange(i.getUnitId(),s.getSheetId(),d);if(!h)return R.of(!0);const v=h.getRange();return d.startRow===v.startRow?R.of(!0):R.of(!1)})):R.of(!0))):R.of(!0)))}const xn={[p.RibbonDataGroup.ORGANIZATION]:{[Je.id]:{order:0,menuItemFactory:Tn}},[p.ContextMenuPosition.MAIN_AREA]:{[p.ContextMenuGroup.LAYOUT]:{[pt]:{order:5,menuItemFactory:fn,[n.SheetTableInsertRowCommand.id]:{order:1,menuItemFactory:yn},[n.SheetTableInsertColCommand.id]:{order:2,menuItemFactory:En}},[vt]:{order:6,menuItemFactory:Sn,[n.SheetTableRemoveRowCommand.id]:{order:1,menuItemFactory:In},[n.SheetTableRemoveColCommand.id]:{order:2,menuItemFactory:_n}}}}};var wn=Object.getOwnPropertyDescriptor,Dn=(a,e,t,r)=>{for(var i=r>1?void 0:r?wn(e,t):e,s=a.length-1,l;s>=0;s--)(l=a[s])&&(i=l(i)||i);return i},nt=(a,e)=>(t,r)=>e(t,r,a);let Oe=class extends c.Disposable{constructor(a,e){super(),this._componentManager=a,this._menuManagerService=e,this._initComponents(),this._initMenu()}_initComponents(){[[rt,dt],[he,gn],[at,Cn]].forEach(([a,e])=>{this.disposeWithMe(this._componentManager.register(a,e))})}_initMenu(){this._menuManagerService.mergeMenu(xn)}};Oe=Dn([nt(0,c.Inject(p.ComponentManager)),nt(1,c.Inject(p.IMenuManagerService))],Oe);var Mn=Object.getOwnPropertyDescriptor,Rn=(a,e,t,r)=>{for(var i=r>1?void 0:r?Mn(e,t):e,s=a.length-1,l;s>=0;s--)(l=a[s])&&(i=l(i)||i);return i},$e=(a,e)=>(t,r)=>e(t,r,a);let Xe=class extends c.RxDisposable{constructor(a,e,t,r,i){super(),this._context=a,this._injector=e,this._sheetSkeletonManagerService=t,this._tableManager=r,this._sheetTableThemeUIController=i,this._initListener()}_dirtySkeleton(){var e;(e=this._context.mainComponent)==null||e.makeDirty();const a=this._sheetSkeletonManagerService.getCurrentParam();if(a){const t={...a,dirty:!0};this._sheetSkeletonManagerService.reCalculate(t)}}_initListener(){const a=this._tableManager,e=this._dirtySkeleton.bind(this);this.disposeWithMe(R.merge(a.tableAdd$,a.tableDelete$,a.tableNameChanged$,a.tableRangeChanged$,a.tableThemeChanged$,a.tableFilterChanged$,a.tableInitStatus$,this._sheetTableThemeUIController.refreshTable$).subscribe(e))}};Xe=Rn([$e(1,c.Inject(c.Injector)),$e(2,c.Inject(Q.SheetSkeletonManagerService)),$e(3,c.Inject(n.TableManager)),$e(4,c.Inject(de))],Xe);var Nn=Object.getOwnPropertyDescriptor,jn=(a,e,t,r)=>{for(var i=r>1?void 0:r?Nn(e,t):e,s=a.length-1,l;s>=0;s--)(l=a[s])&&(i=l(i)||i);return i},qe=(a,e)=>(t,r)=>e(t,r,a);let Be=class extends c.Disposable{constructor(a,e,t){super(),this._sheetInterceptorService=a,this._univerInstanceService=e,this._tableManager=t,this._initSelectionChange()}_initSelectionChange(){this.disposeWithMe(this._sheetInterceptorService.interceptCommand({getMutations:a=>{if(a.id===Q.SelectAllCommand.id){const e=L.getSheetCommandTarget(this._univerInstanceService);if(!e)return{redos:[],undos:[]};const t=a.params,{range:r}=t,{unitId:i,subUnitId:s,worksheet:l}=e,d=this._tableManager.getTablesBySubunitId(i,s).find(b=>{const h=b.getRange();return c.Rectangle.contains(h,r)});if(d){const b=d.getRange(),h={...b,startRow:b.startRow+1};return c.Rectangle.equals(b,r)?{undos:[],redos:[]}:c.Rectangle.equals(h,r)?{undos:[],redos:[{id:L.SetSelectionsOperation.id,params:{unitId:i,subUnitId:s,selections:[{range:b,primary:L.getPrimaryForRange(b,l)}]}}]}:{undos:[],redos:[{id:L.SetSelectionsOperation.id,params:{unitId:i,subUnitId:s,selections:[{range:h,primary:L.getPrimaryForRange(h,l)}]}}]}}}return{redos:[],undos:[]}}}))}};Be=jn([qe(0,c.Inject(L.SheetInterceptorService)),qe(1,c.Inject(c.IUniverInstanceService)),qe(2,c.Inject(n.TableManager))],Be);var Ln=Object.defineProperty,$n=Object.getOwnPropertyDescriptor,kn=(a,e,t)=>e in a?Ln(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,Pn=(a,e,t,r)=>{for(var i=r>1?void 0:r?$n(e,t):e,s=a.length-1,l;s>=0;s--)(l=a[s])&&(i=l(i)||i);return i},ke=(a,e)=>(t,r)=>e(t,r,a),Tt=(a,e,t)=>kn(a,typeof e!="symbol"?e+"":e,t);exports.UniverSheetsTableUIPlugin=class extends c.Plugin{constructor(e=et,t,r,i,s){super(),this._config=e,this._injector=t,this._commandService=r,this._configService=i,this._renderManagerService=s;const{menu:l,...u}=c.merge({},et,this._config);l&&this._configService.setConfig("menu",l,{merge:!0}),this._configService.setConfig(bt,u),this._initRegisterCommand()}onStarting(){c.registerDependencies(this._injector,[[pe],[be],[Oe],[de],[Be]])}onReady(){c.touchDependencies(this._injector,[[pe],[be],[Oe],[de],[Be]])}onRendered(){this._registerRenderModules()}_registerRenderModules(){const e=[[Ge],[Xe]];this._config.hideAnchor!==!0&&e.push([Pe]),e.forEach(t=>{this.disposeWithMe(this._renderManagerService.registerRenderModule(c.UniverInstanceType.UNIVER_SHEET,t))})}_initRegisterCommand(){[Ye,Je].forEach(e=>this._commandService.registerCommand(e))}};Tt(exports.UniverSheetsTableUIPlugin,"pluginName",It);Tt(exports.UniverSheetsTableUIPlugin,"type",c.UniverInstanceType.UNIVER_SHEET);exports.UniverSheetsTableUIPlugin=Pn([c.DependentOn(n.UniverSheetsTablePlugin),ke(1,c.Inject(c.Injector)),ke(2,c.Inject(c.ICommandService)),ke(3,c.IConfigService),ke(4,se.IRenderManagerService)],exports.UniverSheetsTableUIPlugin);

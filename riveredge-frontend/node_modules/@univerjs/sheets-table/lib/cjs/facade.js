"use strict";const r=require("@univerjs/core"),a=require("@univerjs/sheets-table"),h=require("@univerjs/sheets/facade"),I=require("@univerjs/sheets"),v=require("@univerjs/core/facade");class C extends h.FWorkbook{getTableInfo(e){const t=this.getId();return this._injector.get(a.SheetTableService).getTableInfo(t,e)}getTableList(){const e=this.getId();return this._injector.get(a.SheetTableService).getTableList(e)}async addTable(e,t,n,i,s){var T;const c=this._injector.get(a.SheetTableService),o=this._injector.get(r.LocaleService),d=this._injector.get(r.IUniverInstanceService).getCurrentUnitOfType(r.UniverInstanceType.UNIVER_SHEET),u=new Set;if(d&&d.getSheets().forEach(b=>{u.add(b.getName())}),!r.customNameCharacterCheck(t,u)){this._injector.get(r.ILogService).warn(o.t("sheets-table.tableNameError"));return}const m={unitId:this.getId(),name:t,subUnitId:e,range:n,options:s,id:i};if(await this._commandService.executeCommand(a.AddSheetTableCommand.id,m))return(T=c.getTableList(this.getId()).find(b=>b.name===t))==null?void 0:T.id}async removeTable(e){var i;const t=(i=this.getTableInfo(e))==null?void 0:i.subUnitId;if(!t)return!1;const n={unitId:this.getId(),subUnitId:t,tableId:e};return this._commandService.executeCommand(a.DeleteSheetTableCommand.id,n)}getTableInfoByName(e){return this.getTableList().find(n=>n.name===e)}setTableFilter(e,t,n){const i={unitId:this.getId(),tableId:e,column:t,tableFilter:n};return this._commandService.executeCommand(a.SetSheetTableFilterCommand.id,i)}}h.FWorkbook.extend(C);class k extends h.FWorksheet{addTable(e,t,n,i){const s=this.getSheetId(),c=this.getWorkbook(),o=c.getUnitId(),l=this._injector.get(r.LocaleService),d=new Set;if(c&&c.getSheets().forEach(m=>{d.add(m.getName())}),!r.customNameCharacterCheck(e,d))return this._injector.get(r.ILogService).warn(l.t("sheets-table.tableNameError")),!1;const g={unitId:o,subUnitId:s,name:e,range:t,id:n,options:i};return this._commandService.executeCommand(a.AddSheetTableCommand.id,g)}setTableFilter(e,t,n){const i={unitId:this.getWorkbook().getUnitId(),tableId:e,column:t,tableFilter:n};return this._commandService.executeCommand(a.SetSheetTableFilterCommand.id,i)}removeTable(e){const t={unitId:this._fWorkbook.getId(),subUnitId:this.getSheetId(),tableId:e};return this._commandService.executeCommand(a.DeleteSheetTableCommand.id,t)}setTableRange(e,t){const n={unitId:this.getWorkbook().getUnitId(),tableId:e,updateRange:{newRange:t}};return this._commandService.executeCommand(a.SetSheetTableCommand.id,n)}setTableName(e,t){const n=this.getWorkbook(),i=this._injector.get(r.LocaleService),s=new Set;if(n&&n.getSheets().forEach(l=>{s.add(l.getName())}),!r.customNameCharacterCheck(t,s))return this._injector.get(r.ILogService).warn(i.t("sheets-table.tableNameError")),!1;const o={unitId:this.getWorkbook().getUnitId(),tableId:e,name:t};return this._commandService.executeCommand(a.SetSheetTableCommand.id,o)}getSubTableInfos(){const e=this._fWorkbook.getId();return this._injector.get(a.SheetTableService).getTableList(e).filter(n=>n.subUnitId===this.getSheetId())}resetFilter(e,t){const n={unitId:this._fWorkbook.getId(),tableId:e,column:t,tableFilter:void 0};return this._commandService.executeCommand(a.SetSheetTableFilterCommand.id,n)}getTableByCell(e,t){const n=this._fWorkbook.getId(),s=this._injector.get(a.SheetTableService).getTableList(n).filter(o=>o.subUnitId===this.getSheetId()),c=r.cellToRange(e,t);return s.find(o=>{const l=o.range;return r.Rectangle.intersects(l,c)})}addTableTheme(e,t){const n=new I.RangeThemeStyle("table-style");return n.fromJson(t),this._commandService.executeCommand(a.AddTableThemeCommand.id,{unitId:this._fWorkbook.getId(),tableId:e,themeStyle:n})}}h.FWorksheet.extend(k);class f extends v.FEnum{get TableColumnFilterTypeEnum(){return a.TableColumnFilterTypeEnum}get TableConditionTypeEnum(){return a.TableConditionTypeEnum}get TableNumberCompareTypeEnum(){return a.TableNumberCompareTypeEnum}get TableStringCompareTypeEnum(){return a.TableStringCompareTypeEnum}get TableDateCompareTypeEnum(){return a.TableDateCompareTypeEnum}}v.FEnum.extend(f);

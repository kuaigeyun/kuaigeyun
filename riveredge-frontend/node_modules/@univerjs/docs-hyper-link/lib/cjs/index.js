"use strict";var y=Object.defineProperty;var I=(n,e,r)=>e in n?y(n,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[e]=r;var l=(n,e,r)=>I(n,typeof e!="symbol"?e+"":e,r);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const s=require("@univerjs/core"),f={id:"docs.mutation.add-hyper-link",type:s.CommandType.MUTATION,handler:()=>!0},m={id:"docs.mutation.update-hyper-link",type:s.CommandType.MUTATION,handler:()=>!0},U={id:"docs.mutation.delete-hyper-link",type:s.CommandType.MUTATION,handler:()=>!0},P="docs-hyper-link.config",_={};var C=Object.getOwnPropertyDescriptor,D=(n,e,r,o)=>{for(var t=o>1?void 0:o?C(e,r):e,i=n.length-1,a;i>=0;i--)(a=n[i])&&(t=a(t)||t);return t},h=(n,e)=>(r,o)=>e(r,o,n);const v="DOC_HYPER_LINK_PLUGIN";let u=class extends s.Disposable{constructor(n,e){super(),this._resourceManagerService=n,this._univerInstanceService=e,this._init()}_init(){this._resourceManagerService.registerPluginResource({pluginName:v,businesses:[s.UniverInstanceType.UNIVER_DOC],onLoad:(n,e)=>{const r=this._univerInstanceService.getUnit(n,s.UniverInstanceType.UNIVER_DOC);if(!r)return;const o=new Map,t=i=>{var a,c;return(c=(a=i.getBody())==null?void 0:a.customRanges)==null||c.forEach(p=>{p.rangeType===s.CustomRangeType.HYPERLINK&&o.set(p.rangeId,p)}),o};r.headerModelMap.forEach(i=>{t(i)}),r.footerModelMap.forEach(i=>{t(i)}),t(r),e.links.forEach(i=>{const a=o.get(i.id);a&&(a.properties={...a.properties,url:i.payload})})},onUnLoad:n=>{},toJson:n=>{const e=this._univerInstanceService.getUnit(n,s.UniverInstanceType.UNIVER_DOC),r=[];if(e){const o=t=>{var i,a;(a=(i=t.getBody())==null?void 0:i.customRanges)==null||a.forEach(c=>{var p;c.rangeType===s.CustomRangeType.HYPERLINK&&r.push({id:c.rangeId,payload:((p=c.properties)==null?void 0:p.url)||""})})};e.headerModelMap.forEach(t=>{o(t)}),e.footerModelMap.forEach(t=>{o(t)}),o(e)}return JSON.stringify({links:r})},parseJson(n){return JSON.parse(n)}})}};u=D([h(0,s.Inject(s.IResourceManagerService)),h(1,s.IUniverInstanceService)],u);var M=Object.getOwnPropertyDescriptor,N=(n,e,r,o)=>{for(var t=o>1?void 0:o?M(e,r):e,i=n.length-1,a;i>=0;i--)(a=n[i])&&(t=a(t)||t);return t},g=(n,e)=>(r,o)=>e(r,o,n),d;exports.UniverDocsHyperLinkPlugin=(d=class extends s.Plugin{constructor(e=_,r,o,t){super(),this._config=e,this._injector=r,this._configService=o,this._commandService=t;const{...i}=s.merge({},_,this._config);this._configService.setConfig(P,i)}onStarting(){[[u]].forEach(r=>this._injector.add(r)),[f,U,m].forEach(r=>{this.disposeWithMe(this._commandService.registerCommand(r))}),this._injector.get(u)}},l(d,"pluginName",v),l(d,"type",s.UniverInstanceType.UNIVER_DOC),d);exports.UniverDocsHyperLinkPlugin=N([g(1,s.Inject(s.Injector)),g(2,s.IConfigService),g(3,s.ICommandService)],exports.UniverDocsHyperLinkPlugin);

# RiverEdge SaaS å¤šç§Ÿæˆ·æ¡†æ¶ - æ’ä»¶å¼€å‘è§„èŒƒ

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£å®šä¹‰ **RiverEdge SaaS å¤šç§Ÿæˆ·æ¡†æ¶ (RiverEdge SaaS Multi-tenant Framework)** çš„æ’ä»¶å¼€å‘è§„èŒƒï¼ŒåŒ…æ‹¬æ’ä»¶ç»“æ„ã€å¼€å‘æµç¨‹ã€API è§„èŒƒç­‰ã€‚

## æ’ä»¶ç»“æ„è§„èŒƒ

### æ ‡å‡†ç›®å½•ç»“æ„

æ’ä»¶é‡‡ç”¨å‰åç«¯åˆ†ç¦»ä½†ç»Ÿä¸€ç®¡ç†çš„ç»“æ„ï¼Œå‰åç«¯ä»£ç æ”¾åœ¨åŒä¸€ä¸ªæ’ä»¶ç›®å½•ä¸‹ï¼š

```
seed-example/
â”œâ”€â”€ frontend/                 # å‰ç«¯ä»£ç 
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ index.ts         # å‰ç«¯æ’ä»¶å…¥å£æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ routes.ts        # å‰ç«¯è·¯ç”±å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ components/      # å‰ç«¯ç»„ä»¶ç›®å½•
â”‚   â”‚   â”‚   â”œâ”€â”€ ExamplePage.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ExampleForm.tsx
â”‚   â”‚   â”œâ”€â”€ services/        # å‰ç«¯æœåŠ¡å±‚
â”‚   â”‚   â”‚   â””â”€â”€ api.ts
â”‚   â”‚   â”œâ”€â”€ types/           # å‰ç«¯ç±»å‹å®šä¹‰
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ utils/           # å‰ç«¯å·¥å…·å‡½æ•°
â”‚   â”‚       â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ public/              # å‰ç«¯é™æ€èµ„æº
â”‚   â”œâ”€â”€ package.json         # å‰ç«¯ä¾èµ–é…ç½®
â”‚   â”œâ”€â”€ tsconfig.json        # TypeScript é…ç½®
â”‚   â””â”€â”€ vite.config.ts       # å‰ç«¯æ„å»ºé…ç½®
â”œâ”€â”€ backend/                 # åç«¯ä»£ç 
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ plugin.py        # åç«¯æ’ä»¶å…¥å£
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â””â”€â”€ routes.py    # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”‚   â””â”€â”€ example.py   # æ•°æ®æ¨¡å‹ï¼ˆTortoise ORMï¼‰
â”‚   â”‚   â”œâ”€â”€ schemas/
â”‚   â”‚   â”‚   â””â”€â”€ example.py   # Pydantic Schema
â”‚   â”‚   â””â”€â”€ services/
â”‚   â”‚       â””â”€â”€ example.py   # ä¸šåŠ¡é€»è¾‘
â”‚   â””â”€â”€ requirements.txt     # Python ä¾èµ–
â”œâ”€â”€ shared/                  # å‰åç«¯å…±äº«ä»£ç ï¼ˆå¯é€‰ï¼‰
â”‚   â””â”€â”€ types/              # å…±äº«ç±»å‹å®šä¹‰
â”‚       â””â”€â”€ index.ts
â”œâ”€â”€ db/                     # æ•°æ®åº“è¿ç§»è„šæœ¬ï¼ˆå¯é€‰ï¼‰
â”‚   â””â”€â”€ migration/
â”‚       â””â”€â”€ V1__create_example_table.sql
â”œâ”€â”€ manifest.json           # æ’ä»¶æ¸…å•ï¼ˆå¿…éœ€ï¼‰
â”œâ”€â”€ package.json            # æ’ä»¶æ ¹é…ç½®ï¼ˆå¯é€‰ï¼Œç”¨äºç»Ÿä¸€ç®¡ç†ï¼‰
â””â”€â”€ README.md               # æ’ä»¶æ–‡æ¡£
```

### ç›®å½•è¯´æ˜

- **frontend/**: å‰ç«¯ä»£ç ç›®å½•ï¼ŒåŒ…å«æ‰€æœ‰å‰ç«¯ç›¸å…³çš„ä»£ç å’Œé…ç½®
- **backend/**: åç«¯ä»£ç ç›®å½•ï¼ŒåŒ…å«æ‰€æœ‰åç«¯ç›¸å…³çš„ä»£ç å’Œé…ç½®
- **shared/**: å‰åç«¯å…±äº«ä»£ç ï¼ˆå¦‚ç±»å‹å®šä¹‰ï¼‰ï¼Œå¯é€‰
- **db/**: æ•°æ®åº“è¿ç§»è„šæœ¬ï¼Œå¯é€‰
- **manifest.json**: æ’ä»¶æ¸…å•æ–‡ä»¶ï¼Œå®šä¹‰æ’ä»¶çš„å‰åç«¯é…ç½®
- **README.md**: æ’ä»¶ä½¿ç”¨æ–‡æ¡£

## manifest.json è§„èŒƒ

### å®Œæ•´ç¤ºä¾‹

```json
{
  "id": "seed-example",
  "name": "ç¤ºä¾‹åº”ç”¨",
  "version": "1.0.0",
  "description": "è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹æ’ä»¶",
  "author": "Your Name",
  "icon": "./frontend/public/icon.png",
  "frontend": {
    "enabled": true,
    "entry": "./frontend/dist/index.js",
    "routes": [
      {
        "path": "/example",
        "name": "ç¤ºä¾‹é¡µé¢",
        "component": "ExamplePage",
        "icon": "AppstoreOutlined",
        "order": 1,
        "permissions": ["example:read"]
      },
      {
        "path": "/example/detail/:id",
        "name": "è¯¦æƒ…é¡µ",
        "component": "ExampleDetail",
        "hidden": true
      }
    ],
    "menu": {
      "title": "ç¤ºä¾‹æ¨¡å—",
      "icon": "AppstoreOutlined",
      "order": 10
    }
  },
  "backend": {
    "enabled": true,
    "basePath": "/api/example",
    "pluginClass": "ExamplePlugin",
    "routes": [
      {
        "path": "/list",
        "method": "GET",
        "handler": "list_examples",
        "permissions": ["example:read"]
      },
      {
        "path": "/{id}",
        "method": "GET",
        "handler": "get_example_detail",
        "permissions": ["example:read"]
      },
      {
        "path": "/create",
        "method": "POST",
        "handler": "create_example",
        "permissions": ["example:write"]
      },
      {
        "path": "/{id}",
        "method": "PUT",
        "handler": "update_example",
        "permissions": ["example:write"]
      },
      {
        "path": "/{id}",
        "method": "DELETE",
        "handler": "delete_example",
        "permissions": ["example:delete"]
      }
    ],
    "entities": [
      "ExampleModel"
    ],
    "migrations": [
      "001_initial.py"
    ]
  },
  "permissions": [
    "example:read",
    "example:write",
    "example:delete"
  ],
  "dependencies": {
    "react": "^18.0.0",
    "react-dom": "^18.0.0"
  },
  "peerDependencies": {
    "@riveredge/shell": "^1.0.0"
  },
  "config": {
    "apiBaseUrl": "/api/example"
  }
}
```

### å­—æ®µè¯´æ˜

#### åŸºç¡€å­—æ®µ

| å­—æ®µ | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|------|------|------|------|
| id | string | âœ… | æ’ä»¶å”¯ä¸€æ ‡è¯†ï¼Œä½¿ç”¨ kebab-case |
| name | string | âœ… | æ’ä»¶æ˜¾ç¤ºåç§° |
| version | string | âœ… | è¯­ä¹‰åŒ–ç‰ˆæœ¬å· |
| description | string | âŒ | æ’ä»¶æè¿° |
| author | string | âŒ | ä½œè€…ä¿¡æ¯ |
| icon | string | âŒ | æ’ä»¶å›¾æ ‡è·¯å¾„ |
| permissions | array | âŒ | æ’ä»¶æ‰€éœ€æƒé™åˆ—è¡¨ |
| dependencies | object | âŒ | å‰ç«¯æ’ä»¶ä¾èµ– |
| peerDependencies | object | âŒ | å…±äº«ä¾èµ– |
| config | object | âŒ | æ’ä»¶é…ç½®é¡¹ |

#### å‰ç«¯é…ç½® (frontend)

| å­—æ®µ | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|------|------|------|------|
| frontend.enabled | boolean | âœ… | æ˜¯å¦å¯ç”¨å‰ç«¯ |
| frontend.entry | string | âœ… | å‰ç«¯æ’ä»¶å…¥å£æ–‡ä»¶è·¯å¾„ |
| frontend.routes | array | âœ… | å‰ç«¯è·¯ç”±é…ç½®æ•°ç»„ |
| frontend.menu | object | âŒ | å‰ç«¯èœå•é…ç½® |

#### åç«¯é…ç½® (backend)

| å­—æ®µ | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|------|------|------|------|
| backend.enabled | boolean | âœ… | æ˜¯å¦å¯ç”¨åç«¯ |
| backend.basePath | string | âœ… | åç«¯ API åŸºç¡€è·¯å¾„ |
| backend.pluginClass | string | âœ… | åç«¯æ’ä»¶ç±»å…¨é™å®šå |
| backend.routes | array | âœ… | åç«¯è·¯ç”±é…ç½®æ•°ç»„ |
| backend.entities | array | âŒ | æ•°æ®å®ä½“é…ç½® |
| backend.migrations | array | âŒ | æ•°æ®åº“è¿ç§»è„šæœ¬è·¯å¾„ |

### è·¯ç”±é…ç½®

```typescript
interface RouteConfig {
  path: string;              // è·¯ç”±è·¯å¾„
  name: string;              // è·¯ç”±åç§°
  component: string;         // ç»„ä»¶åç§°
  icon?: string;             // å›¾æ ‡ï¼ˆAnt Design Iconï¼‰
  order?: number;            // æ’åº
  hidden?: boolean;          // æ˜¯å¦åœ¨èœå•ä¸­éšè—
  permissions?: string[];     // è·¯ç”±æ‰€éœ€æƒé™
  children?: RouteConfig[];   // å­è·¯ç”±
}
```

## æ’ä»¶å…¥å£æ–‡ä»¶è§„èŒƒ

### React æ’ä»¶ç¤ºä¾‹

```typescript
// src/index.ts
import { PluginRegistry } from '@riveredge/shell';
import { ExamplePage } from './components/ExamplePage';
import { ExampleDetail } from './components/ExampleDetail';
import routes from './routes';

// æ’ä»¶æ³¨å†Œå‡½æ•°
export default function registerPlugin(registry: PluginRegistry) {
  // æ³¨å†Œè·¯ç”±
  registry.registerRoutes(routes);
  
  // æ³¨å†Œç»„ä»¶
  registry.registerComponent('ExamplePage', ExamplePage);
  registry.registerComponent('ExampleDetail', ExampleDetail);
  
  // æ³¨å†ŒæœåŠ¡
  registry.registerService('exampleApi', {
    getList: () => fetch('/api/example/list'),
    getDetail: (id: string) => fetch(`/api/example/${id}`),
  });
  
  // æ³¨å†Œèœå•é¡¹
  registry.registerMenu({
    key: 'example',
    label: 'ç¤ºä¾‹æ¨¡å—',
    icon: 'AppstoreOutlined',
    children: [
      {
        key: 'example-list',
        label: 'ç¤ºä¾‹åˆ—è¡¨',
        path: '/example',
      },
    ],
  });
  
  // ç”Ÿå‘½å‘¨æœŸé’©å­
  return {
    onMount: () => {
      console.log('Example plugin mounted');
    },
    onUnmount: () => {
      console.log('Example plugin unmounted');
    },
  };
}
```


## ç»„ä»¶å¼€å‘è§„èŒƒ

### ä½¿ç”¨ Shell æä¾›çš„ç»„ä»¶å’Œå·¥å…·

```typescript
// src/components/ExamplePage.tsx
import React from 'react';
import { useShell } from '@riveredge/shell';
import { Button, Table } from 'antd';

export const ExamplePage: React.FC = () => {
  const { api, message, navigate } = useShell();
  
  const handleClick = async () => {
    try {
      const data = await api.get('/example/list');
      message.success('åŠ è½½æˆåŠŸ');
    } catch (error) {
      message.error('åŠ è½½å¤±è´¥');
    }
  };
  
  return (
    <div>
      <Button onClick={handleClick}>åŠ è½½æ•°æ®</Button>
      <Table dataSource={[]} columns={[]} />
    </div>
  );
};
```

### ä½¿ç”¨ Shell çš„çŠ¶æ€ç®¡ç†

```typescript
import { useShellStore } from '@riveredge/shell';

export const ExampleComponent: React.FC = () => {
  const { user, permissions } = useShellStore();
  
  // æ£€æŸ¥æƒé™
  if (!permissions.includes('example:read')) {
    return <div>æ— æƒé™è®¿é—®</div>;
  }
  
  return <div>Hello, {user.name}</div>;
};
```

## API è°ƒç”¨è§„èŒƒ

### ç»Ÿä¸€ä½¿ç”¨ Shell çš„ API å®¢æˆ·ç«¯

```typescript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ Shell æä¾›çš„ API å®¢æˆ·ç«¯
import { useShell } from '@riveredge/shell';

const { api } = useShell();
const data = await api.get('/api/example/list');

// âŒ é”™è¯¯ï¼šç›´æ¥ä½¿ç”¨ fetch æˆ– axios
const data = await fetch('/api/example/list');
```

### API è·¯å¾„è§„èŒƒ

- ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼ŒShell ä¼šè‡ªåŠ¨æ·»åŠ  base URL
- è·¯å¾„æ ¼å¼ï¼š`/api/{module}/{resource}`
- ç¤ºä¾‹ï¼š`/api/example/users`, `/api/example/users/:id`

## æ ·å¼è§„èŒƒ

### ä½¿ç”¨ Shell çš„ä¸»é¢˜ç³»ç»Ÿ

```typescript
import { useTheme } from '@riveredge/shell';

export const ExampleComponent: React.FC = () => {
  const theme = useTheme();
  
  return (
    <div style={{ color: theme.primaryColor }}>
      Themed Component
    </div>
  );
};
```

### CSS å‘½åè§„èŒƒ

- ä½¿ç”¨ CSS Modules æˆ– styled-components
- ç±»åä½¿ç”¨ BEM å‘½åè§„èŒƒ
- é¿å…å…¨å±€æ ·å¼æ±¡æŸ“

```typescript
// âœ… ä½¿ç”¨ CSS Modules
import styles from './ExamplePage.module.css';

<div className={styles.container}>
  <div className={styles.header}>Header</div>
</div>

// âœ… ä½¿ç”¨ styled-components
import styled from 'styled-components';

const Container = styled.div`
  padding: 16px;
`;
```

## ç±»å‹å®šä¹‰è§„èŒƒ

### å¯¼å‡ºç±»å‹å®šä¹‰

```typescript
// src/types/index.ts
export interface ExampleItem {
  id: string;
  name: string;
  description?: string;
  createdAt: Date;
  updatedAt: Date;
}

export interface ExampleListResponse {
  items: ExampleItem[];
  total: number;
  page: number;
  pageSize: number;
}
```

## æµ‹è¯•è§„èŒƒ

### å•å…ƒæµ‹è¯•

```typescript
// src/components/__tests__/ExamplePage.test.tsx
import { render, screen } from '@testing-library/react';
import { ExamplePage } from '../ExamplePage';

describe('ExamplePage', () => {
  it('should render correctly', () => {
    render(<ExamplePage />);
    expect(screen.getByText('ç¤ºä¾‹é¡µé¢')).toBeInTheDocument();
  });
});
```

## æ„å»ºé…ç½®

### Vite é…ç½®ç¤ºä¾‹

```typescript
// vite.config.ts
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [react()],
  build: {
    lib: {
      entry: './src/index.ts',
      name: 'SeedExample',
      fileName: 'index',
      formats: ['es'],
    },
    rollupOptions: {
      external: ['react', 'react-dom', '@riveredge/shell'],
    },
  },
});
```

## ç‰ˆæœ¬ç®¡ç†

### è¯­ä¹‰åŒ–ç‰ˆæœ¬

- **ä¸»ç‰ˆæœ¬å·**: ä¸å…¼å®¹çš„ API ä¿®æ”¹
- **æ¬¡ç‰ˆæœ¬å·**: å‘ä¸‹å…¼å®¹çš„åŠŸèƒ½æ€§æ–°å¢
- **ä¿®è®¢å·**: å‘ä¸‹å…¼å®¹çš„é—®é¢˜ä¿®æ­£

ç¤ºä¾‹ï¼š`1.2.3`

### ç‰ˆæœ¬å…¼å®¹æ€§

- æ’ä»¶ç‰ˆæœ¬éœ€ä¸ Shell ç‰ˆæœ¬å…¼å®¹
- åœ¨ `peerDependencies` ä¸­å£°æ˜ Shell ç‰ˆæœ¬è¦æ±‚
- ä½¿ç”¨ç‰ˆæœ¬èŒƒå›´ï¼š`^1.0.0` è¡¨ç¤ºå…¼å®¹ 1.x.x

## å‘å¸ƒæµç¨‹

1. **å¼€å‘**: åœ¨ `riveredge-seeds/seed-xxx` ç›®å½•å¼€å‘
2. **æµ‹è¯•**: æœ¬åœ°æµ‹è¯•æ’ä»¶åŠ è½½å’ŒåŠŸèƒ½
3. **æ„å»º**: æ‰§è¡Œæ„å»ºå‘½ä»¤ç”Ÿæˆ dist
4. **æ‰“åŒ…**: æ‰“åŒ…æ’ä»¶æ–‡ä»¶
5. **æ³¨å†Œ**: åœ¨åç«¯æ³¨å†Œæ’ä»¶ä¿¡æ¯
6. **éƒ¨ç½²**: éƒ¨ç½²æ’ä»¶é™æ€èµ„æº
7. **å¯ç”¨**: åœ¨ Shell ä¸­å¯ç”¨æ’ä»¶

## æœ€ä½³å®è·µ

1. **ä¿æŒæ’ä»¶ç‹¬ç«‹**: æ’ä»¶ä¸åº”ä¾èµ–å…¶ä»–æ’ä»¶
2. **ä½¿ç”¨ Shell API**: é€šè¿‡ Shell æä¾›çš„ API è¿›è¡Œäº¤äº’
3. **æƒé™æ£€æŸ¥**: åœ¨ç»„ä»¶ä¸­æ£€æŸ¥ç”¨æˆ·æƒé™
4. **é”™è¯¯å¤„ç†**: å¦¥å–„å¤„ç† API é”™è¯¯å’Œå¼‚å¸¸
5. **æ€§èƒ½ä¼˜åŒ–**: ä½¿ç”¨æ‡’åŠ è½½ã€ä»£ç åˆ†å‰²
6. **ç±»å‹å®‰å…¨**: ä½¿ç”¨ TypeScript ç¡®ä¿ç±»å‹å®‰å…¨
7. **æ–‡æ¡£å®Œå–„**: æä¾›æ¸…æ™°çš„ README å’Œä½¿ç”¨æ–‡æ¡£


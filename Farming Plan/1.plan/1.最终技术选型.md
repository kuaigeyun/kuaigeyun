# RiverEdge SaaS 多租户框架 - 最终技术选型

## 📋 技术栈概览

基于 **RiverEdge SaaS 多租户框架 (RiverEdge SaaS Multi-tenant Framework)** 的架构设计，采用以下技术栈：

## 📑 目录

1. [技术栈概览](#技术栈概览)
2. [版本号检查清单](#版本号检查清单)
3. [后端技术栈](#后端技术栈-riveredge-core)
4. [前端技术栈](#前端技术栈-riveredge-shell)
5. [数据库技术栈](#数据库技术栈)
6. [插件系统技术栈](#插件系统技术栈)
7. [开发工具](#开发工具)
8. [部署方案](#部署方案)
9. [依赖管理](#依赖管理)
10. [技术栈优势总结](#技术栈优势总结)
11. [注意事项](#注意事项)
12. [快速开始建议](#快速开始建议)

## ⚠️ 版本号检查清单

在开始开发前，请检查以下版本号是否为最新稳定版：

### 后端技术栈
- [ ] Python 3.13+（当前：3.13）
- [ ] FastAPI 0.115+（当前：0.115.0+）
- [ ] Pydantic 2.9+（当前：2.9.0+）
- [ ] Tortoise ORM 0.20+（当前：0.20.0+）
- [ ] Aerich 0.7+（当前：0.7.0+）
- [ ] PostgreSQL 15+（当前：15.x）
- [ ] Redis 7.2+（当前：7.2+）

### 前端技术栈
- [ ] React 19.2+（当前：19.2.0+）
- [ ] Umi V4（当前：4.x）
- [ ] Ant Design v6（当前：6.x）
- [ ] @ant-design/pro-components 2.x（当前：2.x）
- [ ] TypeScript 5.6+（当前：5.6+）

### 其他工具
- [ ] Node.js 20 LTS 或更高版本
- [ ] pnpm（包管理器）

> **检查方法**：
> - 访问各技术的官方网站查看最新稳定版
> - 使用 `pip list` 或 `npm list` 检查已安装版本
> - 参考各技术的官方文档确认版本兼容性

## 🔧 后端技术栈 (riveredge-core)

### 编程语言

**Python 3.13+**

- **版本**: Python 3.13 (最新稳定版)
- **特点**:
  - 性能优化，执行速度提升
  - 改进的错误提示和类型系统
  - 更好的异步支持
- **优势**:
  - 语法简洁，开发效率高
  - 丰富的生态系统
  - 适合快速迭代开发
  - 强大的数据处理能力

### Web 框架

**FastAPI 0.115+**

- **版本**: FastAPI 0.115.0+ (最新版本)
- **特点**:
  - 基于 Starlette 和 Pydantic 构建
  - 自动生成 OpenAPI/Swagger 文档
  - 异步支持，性能优异
  - 类型提示和自动验证
- **优势**:
  - 开发速度快，代码简洁
  - 自动生成交互式 API 文档
  - 高性能，媲美 Node.js 和 Go
  - 原生支持异步操作
- **安装**:
  ```bash
  pip install fastapi[all]>=0.115.0
  ```

### 数据验证

**Pydantic v2**

- **版本**: Pydantic 2.9.0+ (最新版本)
- **特点**:
  - 基于 Python 类型提示的数据验证
  - 性能提升（相比 v1 快 5-50 倍）
  - 更好的错误信息
  - 支持 JSON Schema 生成
- **优势**:
  - 类型安全，减少运行时错误
  - 自动数据验证和转换
  - 与 FastAPI 深度集成
  - 支持复杂的数据模型
- **安装**:
  ```bash
  pip install pydantic>=2.9.0
  ```

### 数据库

**PostgreSQL 15+**

- **版本**: PostgreSQL 15.x (最新稳定版)
- **特点**:
  - 功能强大的开源关系型数据库
  - 支持 JSON、数组等高级数据类型
  - 强大的事务支持
  - 优秀的并发性能
- **优势**:
  - 适合复杂查询和数据分析
  - 支持全文搜索
  - 丰富的扩展插件
  - 企业级可靠性

### ORM 框架

**Tortoise ORM**

- **版本**: Tortoise ORM 0.20.0+ (最新版本)
- **特点**:
  - 异步 ORM，专为异步 Python 设计
  - Django ORM 风格的 API
  - 支持关系映射和查询构建
  - 自动生成模型
- **优势**:
  - 与 FastAPI 异步特性完美配合
  - 学习曲线平缓（类似 Django ORM）
  - 支持复杂查询和关系
  - 性能优异
- **安装**:
  ```bash
  pip install tortoise-orm>=0.20.0
  ```

### 数据库迁移

**Aerich**

- **版本**: Aerich 0.7.0+ (最新版本)
- **特点**:
  - Tortoise ORM 的数据库迁移工具
  - 类似 Django 的迁移系统
  - 支持版本控制和回滚
- **优势**:
  - 与 Tortoise ORM 无缝集成
  - 自动生成迁移文件
  - 支持团队协作
- **安装**:
  ```bash
  pip install aerich>=0.7.0
  ```

### 缓存

**Redis 7+**

- **版本**: Redis 7.2+ (最新版本)
- **特点**:
  - 高性能内存数据库
  - 支持多种数据结构
  - 支持持久化
- **用途**:
  - 会话存储
  - 缓存热点数据
  - 分布式锁
  - 消息队列
- **Python 客户端**:
  ```bash
  pip install redis>=5.0.0  # redis-py，内置异步支持（redis.asyncio）
  ```
  - **异步接口**: 使用 `redis.asyncio` 模块（redis-py 4.2.0+ 内置）
  - **优势**:
    - 官方维护，稳定可靠
    - 兼容 Python 3.13
    - 统一 API，同步和异步使用同一套接口

### 认证与安全

**JWT (JSON Web Tokens)**

- **库**: python-jose
- **安装**:
  ```bash
  pip install python-jose[cryptography]>=3.3.0
  pip install passlib[bcrypt]>=1.7.4
  ```

### API 文档

**自动生成 (FastAPI 内置)**

- FastAPI 自动生成 OpenAPI/Swagger 文档
- 访问地址: `http://localhost:8000/docs`
- 交互式 API 测试界面

### 其他后端工具

- **HTTP 客户端**: `httpx` (异步 HTTP 客户端)
- **日志**: `loguru`
- **配置管理**: `pydantic-settings`
- **测试框架**: `pytest` + `pytest-asyncio`

## 🎨 前端技术栈 (riveredge-shell)

> **全部使用 Ant Design 组件**: 本框架完全采用 Ant Design 和 Ant Design Pro 系列组件，确保技术栈统一，特别适合 B 端 MES（制造执行系统）项目。

### 核心框架

**React 19.2+**

- **版本**: React 19.2.0+ (最新版本)
- **特点**:
  - 服务端组件 (RSC) 支持
  - 自动批处理优化
  - 改进的错误处理
  - 更好的 TypeScript 支持
- **优势**:
  - 组件化开发，代码复用性强
  - 庞大的生态系统
  - 虚拟 DOM，性能优异
  - 社区活跃，资源丰富
- **安装**:
  ```bash
  npm install react@^19.2.0 react-dom@^19.2.0
  ```

### 应用框架

**Umi V4 (@umijs/max)**

- **版本**: Umi 4.x (最新版本)
- **特点**:
  - 基于 React Router 6
  - 内置插件系统
  - 约定式路由
  - 开箱即用的工程化配置
  - 内置 Ant Design Pro 最佳实践
- **优势**:
  - 减少配置，提高开发效率
  - 内置最佳实践
  - 支持微前端和插件化
  - 完善的开发工具链
  - 与 Ant Design Pro 完美集成
  - 内置国际化、权限、数据流等方案
- **使用**: `@umijs/max` (包含所有内置插件)
- **安装**:
  ```bash
  npm create umi@latest
  # 或直接使用 max 版本
  npm install @umijs/max@^4.0.0
  ```

### UI 组件库

**Ant Design v6 + Ant Design Pro Components**

- **版本**:
  - Ant Design 6.x (最新版本)
  - @ant-design/pro-components 2.x (最新版本)
- **特点**:
  - 企业级 UI 设计语言
  - 丰富的组件库
  - 支持主题定制
  - TypeScript 支持完善
  - Pro Components 提供高级业务组件
- **优势**:
  - 组件质量高，设计规范统一
  - 文档完善，示例丰富
  - 适合企业级应用
  - 与 Umi 深度集成
  - Pro Components 大幅提升开发效率
- **核心组件**:
  - `ProTable`: 高级表格组件，支持搜索、筛选、分页
  - `ProForm`: 高级表单组件，支持多种布局和验证
  - `ProCard`: 卡片容器组件
  - `ProLayout`: 页面布局组件
  - `ProList`: 列表组件
  - `ProDescriptions`: 描述列表组件
  - `ProSkeleton`: 骨架屏组件
- **安装**:
  ```bash
  npm install antd@^6.0.0
  npm install @ant-design/pro-components@^2.0.0
  ```

### 状态管理

**Umi Model**

- **版本**: 内置在 @umijs/max 中
- **特点**:
  - Umi 内置的轻量级数据流方案
  - 基于 hooks 的全局状态管理
  - 无需额外配置
  - 与 Umi 深度集成
- **优势**:
  - 零配置，开箱即用
  - 代码简洁，符合 React Hooks 规范
  - 支持按需加载
  - 与 Umi 插件系统完美配合
- **使用场景**: 全局状态、用户信息、权限信息等

### 类型系统

**TypeScript 5.6+**

- **版本**: TypeScript 5.6+ (最新版本)
- **特点**:
  - 静态类型检查
  - 更好的 IDE 支持
  - 提升代码可维护性
- **安装**:
  ```bash
  npm install -D typescript@^5.6.0
  ```

### HTTP 客户端

**Umi Request**

- Umi 内置的请求库
- 自动处理错误和 loading
- 支持拦截器
- 与 Umi 深度集成

### 路由

**React Router 6** (Umi 内置)

- Umi V4 基于 React Router 6
- 支持嵌套路由、动态路由
- 支持路由守卫

### 构建工具

**Umi 内置 (基于 Vite)**

- Umi V4 使用 Vite 作为构建工具
- 极速的冷启动
- 快速的热更新
- 优化的生产构建

### 其他前端工具

- **代码规范**: ESLint + Prettier
- **CSS 方案**: CSS Modules (Umi 内置支持)
- **图标库**: `@ant-design/icons` (阿里系图标库，包含丰富的工业图标)
- **日期处理**: `dayjs` (轻量级，API 与 moment.js 兼容)
- **工具函数**: `lodash-es` (按需引入，支持 tree-shaking)
- **国际化**: `@umijs/plugin-locale` (Umi 内置，支持多语言)
- **权限管理**: `@umijs/plugin-access` (Umi 内置权限插件)
- **数据流**: `@umijs/plugin-model` (Umi 内置轻量级数据流方案)
- **图表库**: `@ant-design/charts` (阿里系图表库，基于 AntV G2Plot)
  - 支持折线图、柱状图、饼图、仪表盘等
  - 适合 MES 系统的数据可视化需求
  - **商业使用**: AntV 采用 MIT 许可证，可免费用于商业项目
- **富文本编辑器**: `@ant-design/pro-editor` (Pro 系列编辑器组件)
- **Landing 页面**: `ant-design-landing` (官网首页和 SaaS 介绍页模板)
- **动画库**: `ant-motion` (Ant Design 动画组件库)
- **移动端框架**: `antd-mobile` (Ant Design Mobile，移动端 UI 组件库)
- **表单自定义字段**: `@formily/core` + `@formily/react` + `@formily/antd-v5` (Formily 表单解决方案)
- **打印模板设计**: `react-to-print` (React 打印库，主要方案) + `jspdf` + `html2canvas` (PDF 生成补充方案)

### Ant Design Landing - 官网首页和 SaaS 介绍页

**Ant Design Landing** 是基于 Ant Design 设计体系的静态页面解决方案，适用于快速构建高质量的着陆页、官网首页和 SaaS 软件介绍页。

#### 商业使用许可

- ✅ **MIT 许可证**: Ant Design Landing 采用 MIT 开源许可证
- ✅ **可商业使用**: 允许在商业项目中免费使用，无需支付许可费用
- ✅ **无限制**: 可自由使用、修改和分发

#### 主要特点

1. **设计一致性**
   - 延续 Ant Design 设计语言
   - 与 SaaS 产品风格保持一致
   - 提升品牌形象和用户体验

2. **丰富的模板库**
   - 提供多种预设模板和组件
   - 涵盖常见的页面布局和功能
   - 满足不同业务需求

3. **易于定制**
   - 支持根据需求进行定制
   - 可调整样式、布局和内容
   - 打造独特的品牌页面

4. **响应式设计**
   - 所有模板支持响应式布局
   - 确保在不同设备上良好显示
   - 适配 PC、平板、移动端

#### 适用场景

1. **SaaS 软件介绍主页**
   - 产品功能介绍
   - 特性展示
   - 价格方案
   - 客户案例
   - 联系方式

2. **客户简易官网首页**
   - 公司介绍
   - 服务展示
   - 产品展示
   - 新闻动态
   - 联系方式

3. **营销着陆页**
   - 活动推广页面
   - 产品发布页
   - 注册引导页

#### 使用方式

**使用方式**:
1. 访问 [Ant Design Landing 编辑器](https://landing.ant.design/) 在线编辑并下载
2. 或使用本地开发：
```bash
npm install ant-design-landing
# 或使用模板
npx create-landing-page my-landing
```

#### 核心功能模块

Landing 页面通常包含以下模块：

1. **Hero Section** - 首屏展示
   - 主标题和副标题
   - CTA 按钮（注册/试用）
   - 背景图片或视频

2. **Features** - 功能特性
   - 产品核心功能展示
   - 图标 + 文字说明
   - 多列布局

3. **Pricing** - 价格方案
   - 不同套餐展示
   - 价格对比
   - 购买按钮

4. **Testimonials** - 客户评价
   - 客户案例展示
   - 用户评价
   - 合作伙伴 Logo

5. **FAQ** - 常见问题
   - 问题列表
   - 折叠展开
   - 帮助用户快速了解

6. **Contact** - 联系方式
   - 联系表单
   - 地址信息
   - 社交媒体链接

7. **Footer** - 页脚
   - 版权信息
   - 友情链接
   - 备案信息

#### 与主系统集成

**部署方案**:
- Landing 页面可独立部署为静态站点（riveredge-land）
- 使用 Nginx 或 CDN 提供服务
- 与主系统（riveredge-shell）分离

**推荐项目结构**:
```
riveredge/
├── riveredge-core/          # 后端核心系统
├── riveredge-shell/          # 前端管理系统
├── riveredge-land/           # 着陆页/官网（土地）
│   ├── src/
│   │   ├── pages/
│   │   │   ├── Home/         # 首页
│   │   │   ├── Features/     # 功能页
│   │   │   └── Pricing/      # 价格页
│   │   └── components/        # Landing 组件
│   └── package.json
└── riveredge-seeds/          # 应用插件集合
```

#### 安装和配置

```bash
# 方式一：使用官方模板
npx create-landing-page my-landing

# 方式二：在现有项目中安装
npm install ant-design-landing

# 方式三：使用在线编辑器
# 访问 https://landing.ant.design/ 在线编辑并下载
```

#### 最佳实践

1. **性能优化**
   - 图片懒加载
   - 代码分割
   - CDN 加速静态资源

2. **SEO 优化**
   - 添加 meta 标签
   - 结构化数据
   - 语义化 HTML

3. **分析统计**
   - 集成 Google Analytics
   - 集成百度统计
   - 追踪转化率

4. **A/B 测试**
   - 测试不同版本
   - 优化转化率
   - 数据驱动决策

#### 总结

- **商业使用**: ✅ 完全免费，MIT 许可证
- **适用场景**: SaaS 介绍页、官网首页、营销着陆页
- **技术栈统一**: 基于 Ant Design，与主系统保持一致
- **开发效率**: 提供丰富模板，快速搭建专业页面
- **推荐使用**: 适合作为 SaaS 软件的门面，提升品牌形象

### Ant Motion - 动画库

**Ant Motion** 是 Ant Design 的动画组件库，提供丰富的动画效果，用于增强用户界面的动态表现和交互体验。

#### 商业使用许可

- ✅ **MIT 许可证**: Ant Motion 采用 MIT 开源许可证
- ✅ **可商业使用**: 允许在商业项目中免费使用，无需支付许可费用
- ✅ **无限制**: 可自由使用、修改和分发

#### 主要特点

1. **丰富的动画效果**
   - 提供多种预设动画（淡入淡出、滑动、缩放等）
   - 支持自定义动画配置
   - 流畅的动画过渡效果

2. **易于使用**
   - 基于 React，API 简洁
   - 组件化设计，开箱即用
   - 支持 TypeScript

3. **性能优化**
   - 使用 CSS3 动画，性能优异
   - 支持硬件加速
   - 减少重绘和回流

4. **与 Ant Design 集成**
   - 与 Ant Design 组件完美配合
   - 设计风格统一
   - 无缝集成

#### 适用场景

1. **页面过渡动画**
   - 路由切换动画
   - 页面加载动画
   - 组件进入/退出动画

2. **交互反馈动画**
   - 按钮点击反馈
   - 表单验证动画
   - 操作成功/失败提示

3. **数据展示动画**
   - 数字递增动画
   - 图表加载动画
   - 列表项动画

4. **Landing 页面动画**
   - 首屏动画效果
   - 滚动触发动画
   - 元素渐入动画

#### 核心组件

1. **Animate** - 基础动画组件
   - 支持多种动画类型
   - 可配置动画参数

2. **QueueAnim** - 队列动画
   - 元素依次出现
   - 适合列表动画

3. **TweenOne** - 补间动画
   - 精确控制动画过程
   - 支持复杂动画序列

4. **ScrollAnim** - 滚动动画
   - 滚动触发动画
   - 适合 Landing 页面

#### 安装和使用

```bash
# 安装 Ant Motion
npm install ant-motion
```

**基础使用示例**:

```tsx
import { Animate } from 'ant-motion';
import { Button } from 'antd';

export default function AnimatedButton() {
  return (
    <Animate
      component="div"
      animation={{
        x: [0, 100],
        opacity: [0, 1],
      }}
      duration={1000}
    >
      <Button type="primary">点击我</Button>
    </Animate>
  );
}
```

**队列动画示例**:

```tsx
import { QueueAnim } from 'ant-motion';

export default function AnimatedList() {
  const data = ['项目1', '项目2', '项目3'];

  return (
    <QueueAnim>
      {data.map((item, index) => (
        <div key={index}>{item}</div>
      ))}
    </QueueAnim>
  );
}
```

**滚动触发动画示例**:

```tsx
import { ScrollAnim } from 'ant-motion';

export default function LandingPage() {
  return (
    <ScrollAnim
      component="div"
      animation={{
        y: [0, -50],
        opacity: [0, 1],
      }}
      scrollEventThrottle={16}
    >
      <div>滚动到这里时触发动画</div>
    </ScrollAnim>
  );
}
```

#### 最佳实践

1. **适度使用动画**
   - 不要过度使用动画，避免干扰用户
   - 动画应该增强体验，而不是分散注意力

2. **性能优化**
   - 使用 CSS3 动画而非 JavaScript 动画
   - 避免在动画中触发重排和重绘
   - 使用 `will-change` 属性优化性能

3. **可访问性**
   - 尊重用户的动画偏好设置（prefers-reduced-motion）
   - 提供关闭动画的选项

4. **移动端优化**
   - 在移动端减少复杂动画
   - 优化动画性能，避免卡顿

#### 总结

- **商业使用**: ✅ 完全免费，MIT 许可证
- **适用场景**: 页面过渡、交互反馈、数据展示、Landing 页面
- **技术栈统一**: 与 Ant Design 完美集成
- **开发效率**: 提供丰富预设动画，快速实现动效
- **推荐使用**: 适度使用动画，提升用户体验和品牌形象

### Ant Design Mobile - 移动端框架

**Ant Design Mobile** 是 Ant Design 的移动端版本，专注于移动设备的 UI 设计，提供一套完整的移动端组件库。

#### 商业使用许可

- ✅ **MIT 许可证**: Ant Design Mobile 采用 MIT 开源许可证
- ✅ **可商业使用**: 允许在商业项目中免费使用，无需支付许可费用
- ✅ **无限制**: 可自由使用、修改和分发

#### 主要特点

1. **移动端优化**
   - 专为移动设备设计
   - 触摸友好的交互
   - 响应式布局

2. **丰富的组件库**
   - 提供完整的移动端 UI 组件
   - 覆盖常见移动端场景
   - 与 Ant Design 设计语言一致

3. **性能优异**
   - 轻量级，体积小
   - 优化渲染性能
   - 支持按需加载

4. **跨平台支持**
   - 支持 React Native
   - 支持 H5 移动端
   - 支持小程序（部分组件）

#### 适用场景

1. **MES 移动端应用**
   - 生产现场数据录入
   - 移动端工单查看
   - 设备巡检应用
   - 质量检验移动端

2. **SaaS 移动端**
   - 移动端管理后台
   - 移动端数据查看
   - 移动端操作界面

3. **客户移动端应用**
   - 客户移动端门户
   - 移动端订单查看
   - 移动端报表查看

#### 核心组件

1. **基础组件**
   - Button（按钮）
   - Input（输入框）
   - Textarea（文本域）
   - Switch（开关）
   - Checkbox（复选框）
   - Radio（单选框）

2. **导航组件**
   - NavBar（导航栏）
   - TabBar（标签栏）
   - Tabs（标签页）
   - SideBar（侧边栏）

3. **数据展示**
   - List（列表）
   - Card（卡片）
   - Image（图片）
   - Badge（徽标）
   - Tag（标签）

4. **数据录入**
   - Form（表单）
   - Picker（选择器）
   - DatePicker（日期选择）
   - Cascader（级联选择）
   - Uploader（上传）

5. **反馈组件**
   - Toast（轻提示）
   - Dialog（对话框）
   - ActionSheet（动作面板）
   - Loading（加载）
   - PullToRefresh（下拉刷新）

6. **业务组件**
   - Calendar（日历）
   - ImageViewer（图片查看器）
   - InfiniteScroll（无限滚动）
   - ErrorBlock（错误提示）

#### 安装和使用

```bash
# 安装 Ant Design Mobile
npm install antd-mobile

# 如果使用 React Native
npm install antd-mobile-rn
```

**基础使用示例**:

```tsx
import { Button, List, Card } from 'antd-mobile';
import { SearchOutline } from 'antd-mobile-icons';

export default function MobileApp() {
  return (
    <div>
      <Card title="移动端页面">
        <List>
          <List.Item
            prefix={<SearchOutline />}
            onClick={() => {
              console.log('点击了列表项');
            }}
          >
            列表项
          </List.Item>
        </List>
        <Button color="primary" block>
          主要按钮
        </Button>
      </Card>
    </div>
  );
}
```

**移动端表单示例**:

```tsx
import { Form, Input, Button, Picker } from 'antd-mobile';

export default function MobileForm() {
  const [form] = Form.useForm();

  return (
    <Form form={form} layout="vertical">
      <Form.Item name="name" label="姓名">
        <Input placeholder="请输入姓名" />
      </Form.Item>
      <Form.Item name="phone" label="手机号">
        <Input type="tel" placeholder="请输入手机号" />
      </Form.Item>
      <Form.Item name="department" label="部门">
        <Picker columns={[['生产部', '质量部', '设备部']]}>
          {(value) => value || '请选择部门'}
        </Picker>
      </Form.Item>
      <Button color="primary" block onClick={() => form.submit()}>
        提交
      </Button>
    </Form>
  );
}
```

**移动端列表示例**:

```tsx
import { List, Card, Badge } from 'antd-mobile';

export default function WorkOrderList() {
  const orders = [
    { id: '1', no: 'WO001', status: 'processing', product: '产品A' },
    { id: '2', no: 'WO002', status: 'completed', product: '产品B' },
  ];

  return (
    <List>
      {orders.map(order => (
        <List.Item
          key={order.id}
          prefix={<Badge content={order.status === 'processing' ? '进行中' : '已完成'} />}
          extra={order.no}
        >
          {order.product}
        </List.Item>
      ))}
    </List>
  );
}
```

#### 与主系统集成

**部署方案**:
- 创建独立的移动端项目（riveredge-leaf）
- 使用 React Native 或 H5
- 与主系统 API 对接

**推荐项目结构**:
```
riveredge/
├── riveredge-core/          # 后端核心系统（根）
├── riveredge-shell/          # 前端管理系统（壳）
├── riveredge-seeds/          # 应用插件集合（种子）
├── riveredge-land/           # 着陆页/官网（土地）
└── riveredge-leaf/           # 移动端应用（叶子）
```

#### 移动端最佳实践

1. **性能优化**
   - 使用虚拟列表处理长列表
   - 图片懒加载
   - 代码分割和按需加载

2. **用户体验**
   - 优化触摸交互
   - 提供加载状态反馈
   - 错误处理和提示

3. **适配**
   - 适配不同屏幕尺寸
   - 处理横竖屏切换
   - 适配不同操作系统

4. **离线支持**
   - 使用 Service Worker
   - 数据缓存策略
   - 离线功能提示

#### 总结

- **商业使用**: ✅ 完全免费，MIT 许可证
- **适用场景**: MES 移动端、SaaS 移动端、客户移动端应用
- **技术栈统一**: 与 Ant Design 设计语言一致
- **开发效率**: 提供完整移动端组件，快速开发
- **推荐使用**: 适合需要移动端支持的项目，提升移动端用户体验

### 表单自定义字段方案

**表单自定义字段**是 MES 系统中的重要功能，允许用户根据业务需求动态配置表单字段。

#### Formily 表单解决方案

**Formily** 是阿里巴巴开源的企业级表单解决方案，提供完整的表单自定义字段功能。

- **特点**:
  - 阿里系表单解决方案，与 Ant Design 生态一致
  - 提供可视化表单设计器
  - 支持复杂字段联动和条件渲染
  - 适合企业级表单应用
- **安装**:
  ```bash
  npm install @formily/core @formily/react @formily/antd-v5
  ```
- **后端实现**:
  - 使用 Pydantic 动态创建模型
  - 使用 PostgreSQL JSONB 存储字段配置
  - 支持 JSON Schema 验证

**详细方案请参考**: [表单自定义字段方案.md](../4.branch/表单自定义字段方案.md)

### 打印模板设计方案

**打印模板设计**是 MES 系统中的重要功能，用于生成各种报表、单据和标签。

#### 技术方案

**Ant Design Pro 现状**: Ant Design Pro **没有专门的打印模板设计器原生组件**。

**主要方案：react-to-print**
- 轻量级 React 打印库
- 与 Ant Design 完美集成
- 支持打印预览
- 可自定义打印样式
- **安装**: `npm install react-to-print`

**补充方案：jsPDF + html2canvas（PDF 生成）**
- 当需要生成 PDF 文件时使用
- 精确控制格式
- **安装**: `npm install jspdf html2canvas`

**后端实现**:
- 使用 PostgreSQL JSONB 存储打印模板配置
- 使用 Pydantic 验证模板结构
- 提供模板管理 API

**详细方案请参考**: [打印模板设计方案.md](../4.branch/打印模板设计方案.md)

### 主子表模型支持

**主子表模型**是 MES 系统中的常见需求，例如订单-订单明细、生产计划-生产任务等。

#### 官方原生支持 ✅

**当前技术选型对主子表模型有完整的官方原生支持**：

**后端支持**：
- ✅ **Tortoise ORM**：支持 ForeignKey 关系、反向关系（ReverseRelation）、预加载、级联操作、事务支持
- ✅ **Pydantic v2**：支持嵌套 Schema、自动数据验证、类型安全
- ✅ **FastAPI**：自动接收和验证嵌套数据、自动生成 API 文档

**前端支持**：
- ✅ **ProTable**：支持 expandable 展开行展示子表数据
- ✅ **ProForm**：支持 ProFormList 嵌套表单编辑主子表数据
- ✅ **ProDescriptions**：支持嵌套展示主子表详情
- ✅ **Ant Design 基础组件**：Table expandable、Form.List

**优势**：
- ✅ 无需引入额外的第三方库
- ✅ 官方原生支持，稳定可靠
- ✅ 类型安全，开发体验好
- ✅ 文档完善，示例丰富

**详细分析请参考**: [主子表模型支持分析.md](../4.branch/主子表模型支持分析.md)

### AntV 数据可视化方案说明

**AntV 商业使用许可**:
- ✅ **MIT 许可证**: AntV 采用 MIT 开源许可证
- ✅ **可商业使用**: 允许在商业项目中免费使用，无需支付许可费用
- ✅ **无限制**: 可自由使用、修改和分发

**当前技术栈中的 AntV 使用**:
- `@ant-design/charts` 基于 **AntV G2Plot** 构建
- 已间接使用 AntV 生态，无需额外引入

**AntV 产品线使用**:
1. **G2Plot** (已通过 @ant-design/charts 使用)
   - 统计图表库，适合常规数据可视化
   - 支持折线图、柱状图、饼图、仪表盘等
   - **MES 适用**: 生产趋势、产量统计、设备状态等

2. **G6** (按需引入)
   - 图关系可视化引擎
   - 适合网络图、流程图、组织架构图
   - **MES 适用**: 设备关系图、工艺流程图、BOM 结构图
   - **安装**: `npm install @antv/g6@^5.0.0`

3. **X6** (按需引入)
   - 图编辑引擎，支持节点拖拽、连线等
   - 适合流程图编辑器、拓扑图编辑器
   - **MES 适用**: 工艺路线设计器、生产流程图编辑器
   - **安装**: `npm install @antv/x6@^2.0.0`

**总结**:
- **商业使用**: ✅ 完全免费，MIT 许可证
- **基础图表**: 使用 `@ant-design/charts` (已包含，基于 G2Plot)
- **图可视化**: 按需引入 `@antv/g6` 或 `@antv/x6`
- **技术栈统一**: 全部使用 AntV 生态，保持技术栈一致性

### B 端 MES 项目推荐组件

针对制造执行系统（MES）项目，以下 Ant Design Pro 组件特别适用：

#### 核心业务组件

1. **ProTable** - 数据表格
   - 生产订单列表、工单管理、质量检验记录
   - 支持搜索、筛选、排序、分页
   - 支持批量操作、导出功能
   - 适合大量数据展示和操作

2. **ProForm** - 高级表单
   - 生产计划录入、工艺参数配置
   - 支持多种布局（水平、垂直、内联）
   - 支持表单联动、动态字段
   - 支持表单验证和提交

3. **ProCard** - 卡片容器
   - 生产看板、设备状态卡片
   - 支持多卡片布局
   - 支持折叠、分割等功能

4. **ProList** - 列表组件
   - 生产任务列表、设备列表
   - 支持多种列表样式
   - 支持搜索、筛选、排序

5. **ProDescriptions** - 描述列表
   - 订单详情、设备信息展示
   - 支持响应式布局
   - 支持自定义渲染

#### 数据可视化组件

6. **@ant-design/charts** - 图表库（基于 AntV G2Plot，MIT 许可证，可商业使用）
   - **折线图**: 生产趋势分析、设备运行曲线
   - **柱状图**: 产量统计、质量分析
   - **饼图**: 设备状态分布、质量合格率
   - **仪表盘**: 设备运行效率、OEE 指标
   - **热力图**: 生产热力图、设备利用率
   - **面积图**: 产能分析、库存变化

7. **@antv/g6** - 图关系可视化（按需引入）
   - 设备关系图、工艺流程图
   - BOM 结构可视化
   - 生产流程网络图

8. **@antv/x6** - 图编辑引擎（按需引入）
   - 工艺路线设计器
   - 生产流程图编辑器
   - 设备布局设计器

9. **Statistic** (Ant Design) - 统计数值
   - 实时产量、设备状态、质量指标
   - 支持数字动画效果
   - 适合看板展示

#### 布局和导航组件

10. **ProLayout** - 页面布局
   - 系统主框架布局
   - 支持侧边栏、顶部导航
   - 支持响应式布局
   - 支持主题切换

11. **PageContainer** (Pro Components) - 页面容器
   - 统一页面头部样式
   - 支持面包屑导航
   - 支持操作按钮区域

#### 高级功能组件

12. **ProSkeleton** - 骨架屏
    - 数据加载时的占位效果
    - 提升用户体验

13. **WaterMark** (Ant Design) - 水印
    - 数据报表水印
    - 防止数据泄露

14. **Timeline** (Ant Design) - 时间轴
    - 生产流程跟踪
    - 工艺步骤展示
    - 质量追溯

15. **Steps** (Ant Design) - 步骤条
    - 生产流程步骤
    - 工单审批流程
    - 质量检验流程

16. **Tabs** (Ant Design) - 标签页
    - 多维度数据展示
    - 设备详情多标签
    - 订单信息分类展示

17. **Tree** (Ant Design) - 树形控件
    - 设备树、BOM 结构
    - 组织架构
    - 分类管理

18. **Transfer** (Ant Design) - 穿梭框
    - 权限分配
    - 设备分配
    - 人员调配

#### 实时数据组件

19. **Badge** (Ant Design) - 徽标数
    - 设备告警数量
    - 待处理任务数
    - 消息通知

20. **Alert** (Ant Design) - 警告提示
    - 设备异常告警
    - 质量异常提醒
    - 系统通知

21. **Progress** (Ant Design) - 进度条
    - 生产进度展示
    - 设备运行状态
    - 任务完成度

#### 数据录入组件

22. **DatePicker / RangePicker** (Ant Design) - 日期选择
    - 生产日期选择
    - 时间范围查询
    - 计划时间设置

23. **TimePicker** (Ant Design) - 时间选择
    - 班次时间设置
    - 设备运行时间

24. **Select** (Ant Design) - 选择器
    - 设备选择
    - 工艺路线选择
    - 人员选择

25. **Cascader** (Ant Design) - 级联选择
    - 多级分类选择
    - 区域-车间-产线选择

26. **Upload** (Ant Design) - 上传
    - 工艺文件上传
    - 质量报告上传
    - 图片上传

#### 展示组件

27. **Table** (Ant Design) - 基础表格
    - 简单数据展示
    - 与 ProTable 配合使用

28. **Card** (Ant Design) - 卡片
    - 设备状态卡片
    - 生产指标卡片

29. **Tag** (Ant Design) - 标签
    - 设备状态标签
    - 质量等级标签
    - 订单状态标签

30. **Tooltip** (Ant Design) - 文字提示
    - 设备信息提示
    - 操作说明提示

31. **Popover** (Ant Design) - 气泡卡片
    - 快速操作菜单
    - 详细信息展示

#### MES 专用场景组件组合

**生产看板场景**:
- ProCard + Statistic + Charts + Progress
- 实时展示生产数据、设备状态、质量指标

**工单管理场景**:
- ProTable + ProForm + Steps + Timeline
- 工单列表、创建、审批、跟踪

**设备监控场景**:
- Charts + Badge + Alert + Tree
- 设备状态监控、告警管理、设备树

**质量管理场景**:
- ProTable + Charts + Descriptions + Upload
- 质量数据录入、统计分析、报告上传

**生产计划场景**:
- ProTable + ProForm + Calendar + Gantt (需第三方)
- 生产计划制定、排程、跟踪

**安装 MES 相关组件**:
```bash
# 核心组件
npm install @ant-design/pro-components@^2.0.0
npm install @ant-design/charts@^2.0.0
npm install antd@^6.0.0
npm install @ant-design/icons@^6.0.0

# 表单自定义字段
npm install @formily/core@^2.3.0 @formily/react@^2.3.0 @formily/antd-v5@^2.3.0

# 打印模板设计
npm install react-to-print@^2.15.0

# AntV 图可视化（按需引入）
npm install @antv/g6@^5.0.0  # 图关系可视化
npm install @antv/x6@^2.0.0  # 图编辑器
```

## 🔌 插件系统技术栈

### 前端插件

- **模块加载**: ES Modules (动态 import)
- **构建工具**: Vite (与 Umi 集成)
- **插件规范**: 自定义 manifest.json

### 后端插件

- **插件加载**: Python 动态导入 (`importlib`)
- **插件接口**: 基于 Python ABC (抽象基类)
- **路由注册**: FastAPI 动态路由注册

## 🗄️ 数据库技术栈

### 主数据库

**PostgreSQL 15+**

- 关系型数据存储
- 用户、角色、权限等核心数据
- 插件数据表（使用命名空间隔离）

### 缓存

**Redis 7+**

- 会话存储
- 缓存热点数据
- 分布式锁

## 🛠️ 开发工具

### 版本控制

- **Git**: 分布式版本控制系统
- **GitHub / GitLab**: 代码托管和协作平台

### 包管理

- **后端**: `pip` + `poetry`
- **前端**: `pnpm`

### IDE 推荐

- **VS Code**: 轻量级，插件丰富，支持前后端开发

### 代码质量

- **后端**:
  - `black` (代码格式化)
  - `ruff` (代码检查)
  - `mypy` (类型检查)
- **前端**:
  - `ESLint` (代码检查)
  - `Prettier` (代码格式化)
  - `TypeScript` (类型检查)

### API 测试

- **FastAPI 自动文档**: 内置 Swagger UI
- **Postman**: API 测试工具

### 数据库管理

- **DBeaver**: 跨平台数据库管理工具
- **Redis Insight**: Redis 管理工具

## 🚀 部署方案

### 容器化部署

**Docker + Docker Compose**

- **开发环境**: Docker Compose
- **生产环境**: Docker + Kubernetes

### 传统部署

- **后端**:
  - `uvicorn` + `gunicorn` (ASGI 服务器)
  - `nginx` (反向代理)
  - `supervisor` (进程管理)
- **前端**:
  - `nginx` (静态文件服务)

## 📦 依赖管理

### 后端依赖示例 (requirements.txt)

```txt
fastapi>=0.115.0
uvicorn[standard]>=0.30.0
pydantic>=2.9.0
pydantic-settings>=2.5.0
tortoise-orm>=0.20.0
aerich>=0.7.0
asyncpg>=0.29.0
redis>=5.0.0  # redis-py，使用 redis.asyncio 异步接口
python-jose[cryptography]>=3.3.0
passlib[bcrypt]>=1.7.4
httpx>=0.27.0
loguru>=0.7.0
pytest>=8.0.0
pytest-asyncio>=0.23.0
```

### 前端依赖示例 (package.json)

#### 主系统依赖 (riveredge-shell)

```json
{
  "dependencies": {
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "@umijs/max": "^4.0.0",
    "antd": "^6.0.0",
    "@ant-design/pro-components": "^2.0.0",
    "@ant-design/icons": "^6.0.0",
    "@ant-design/charts": "^2.0.0",
    "@formily/core": "^2.3.0",
    "@formily/react": "^2.3.0",
    "@formily/antd-v5": "^2.3.0",
    "react-to-print": "^2.15.0",
    "jspdf": "^2.5.0",
    "html2canvas": "^1.4.0",
    "dayjs": "^1.11.0",
    "lodash-es": "^4.17.21"
  },
  "devDependencies": {
    "typescript": "^5.6.0",
    "@types/react": "^19.0.0",
    "@types/react-dom": "^19.0.0",
    "@types/lodash-es": "^4.17.12",
    "eslint": "^9.0.0",
    "prettier": "^3.3.0"
  }
}
```

#### Landing 页面依赖 (riveredge-land)

```json
{
  "dependencies": {
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "antd": "^6.0.0",
    "@ant-design/icons": "^6.0.0",
    "ant-design-landing": "^2.0.0",
    "ant-motion": "^2.0.0"
  },
  "devDependencies": {
    "typescript": "^5.6.0",
    "@types/react": "^19.0.0",
    "@types/react-dom": "^19.0.0"
  }
}
```

#### 移动端依赖 (riveredge-leaf)

```json
{
  "dependencies": {
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "antd-mobile": "^6.0.0",
    "antd-mobile-icons": "^6.0.0",
    "ant-motion": "^2.0.0"
  },
  "devDependencies": {
    "typescript": "^5.6.0",
    "@types/react": "^19.0.0",
    "@types/react-dom": "^19.0.0"
  }
}
```

#### 表单自定义字段依赖

```json
{
  "dependencies": {
    "@formily/core": "^2.3.0",
    "@formily/react": "^2.3.0",
    "@formily/antd-v5": "^2.3.0"
  }
}
```

#### 打印模板设计依赖

```json
{
  "dependencies": {
    "react-to-print": "^2.15.0",
    "jspdf": "^2.5.0",
    "html2canvas": "^1.4.0"
  }
}
```

**说明**:
- `ant-motion`: Ant Design 动画库，用于增强页面动效
- `antd-mobile`: Ant Design Mobile 移动端组件库
- `antd-mobile-icons`: Ant Design Mobile 图标库

#### 依赖说明
- `@umijs/max`: 包含所有 Umi 内置插件（路由、数据流、权限、国际化等）
- `@ant-design/pro-components`: Ant Design Pro 高级业务组件（ProTable、ProForm、ProCard 等）
- `@ant-design/charts`: 阿里系图表库（基于 G2Plot，适合 MES 数据可视化）
- `antd`: Ant Design 基础组件库（所有 UI 组件的基础）
- `@ant-design/icons`: 阿里系图标库（包含丰富的工业、制造相关图标）
- `ant-design-landing`: Landing 页面模板库（官网首页和 SaaS 介绍页）
- `ant-motion`: Ant Design 动画库（增强页面动效）
- `antd-mobile`: Ant Design Mobile 移动端组件库（移动端应用）
- `@formily/*`: Formily 表单解决方案（表单自定义字段）
- `react-to-print`: React 打印库（打印模板设计）
- `jspdf` + `html2canvas`: PDF 生成库（打印模板设计补充方案）
- **全部使用 Ant Design 系列组件，保持技术栈统一**

## ✅ 技术栈优势总结

### 后端优势

1. **高性能**: FastAPI 异步特性 + PostgreSQL 优秀性能
2. **开发效率**: Python 简洁语法 + FastAPI 自动文档
3. **类型安全**: Pydantic v2 数据验证 + Python 类型提示
4. **可扩展性**: Tortoise ORM 灵活的数据模型设计

### 前端优势

1. **开发体验**: Umi V4 约定式配置，减少样板代码
2. **组件丰富**: Ant Design v6 + Pro Components 企业级组件库
3. **性能优化**: React 19 + Vite 构建，性能优异
4. **阿里系生态**: Umi + Ant Design Pro 完整解决方案
5. **开箱即用**: 内置国际化、权限、数据流等方案
6. **状态管理**: Umi Model 零配置，开箱即用
7. **MES 适配**: 丰富的工业场景组件，适合制造执行系统开发
8. **组件统一**: 全部使用 Ant Design 系列，保持设计规范一致
9. **动画支持**: Ant Motion 提供丰富动画效果，增强用户体验
10. **移动端支持**: Ant Design Mobile 提供完整移动端解决方案

### 整体优势

1. **技术栈现代化**: 全部采用最新版本，性能优异
2. **开发效率高**: 前后端都有完善的工具链支持
3. **可维护性强**: TypeScript + Python 类型提示
4. **生态成熟**: 所有技术都有活跃的社区支持
5. **阿里系生态**: Umi + Ant Design Pro 提供完整的企业级解决方案
6. **组件丰富**: Pro Components 大幅减少业务代码编写量

## 📝 注意事项

1. **版本兼容性**: 确保所有依赖版本兼容，建议使用锁文件
2. **Python 版本**: 建议使用 Python 3.11+ (3.13 最新)
3. **Node.js 版本**: 建议使用 Node.js 20 LTS 或更高版本
4. **数据库版本**: PostgreSQL 15+ 以获得最佳性能
5. **定期更新**: 关注各技术栈的版本更新，及时升级
6. **组件选择**: **全部使用 Ant Design 系列组件**，包括基础组件（antd）和高级组件（@ant-design/pro-components）
7. **Umi 配置**: 使用 `@umijs/max` 以获得完整的插件支持
8. **Pro Components**: 充分利用 Pro Components 减少重复代码，提升开发效率
9. **MES 项目**: 针对制造执行系统，优先使用 ProTable、ProForm、Charts 等组件
10. **图表选择**: 使用 `@ant-design/charts` 进行数据可视化，避免使用其他图表库
11. **图标使用**: 统一使用 `@ant-design/icons`，包含丰富的工业制造相关图标
12. **AntV 商业使用**: ✅ AntV 采用 MIT 许可证，可免费用于商业项目，无需支付许可费用
13. **AntV 引入**: 已通过 `@ant-design/charts` 使用 G2Plot，按需引入 `@antv/g6`（图关系可视化）或 `@antv/x6`（图编辑器）
14. **Landing 页面**: 使用 `ant-design-landing` 构建 SaaS 介绍主页和客户官网首页，MIT 许可证，可免费商业使用
15. **Landing 部署**: Landing 页面可独立部署为静态站点，或集成到主系统中
16. **动画库**: 使用 `ant-motion` 增强页面动效，适度使用动画提升用户体验，MIT 许可证
17. **移动端框架**: 使用 `antd-mobile` 开发移动端应用，支持 MES 移动端、SaaS 移动端等场景，MIT 许可证
18. **动画使用**: 适度使用动画，避免过度动画影响性能和用户体验
19. **移动端部署**: 移动端应用作为独立项目部署（riveredge-leaf）
20. **表单自定义字段**: 使用 Formily (`@formily/core` + `@formily/react` + `@formily/antd-v5`) 实现表单自定义字段功能，提供可视化表单设计器
21. **表单字段存储**: 使用 PostgreSQL JSONB 存储字段配置，后端使用 Pydantic 动态模型验证
22. **打印模板设计**: 使用 `react-to-print` 实现打印功能，需要 PDF 时使用 `jspdf` + `html2canvas`
23. **打印模板存储**: 使用 PostgreSQL JSONB 存储打印模板配置，支持模板管理和复用

## 🚀 快速开始建议

### 前端项目初始化

```bash
# 使用 Umi 创建项目
npm create umi@latest riveredge-shell

# 选择配置
# - 选择 @umijs/max (包含所有插件)
# - 选择 Ant Design Pro 模板
# - 启用 TypeScript
# - 启用国际化
# - 启用权限管理

# 安装 Pro Components
cd riveredge-shell
npm install @ant-design/pro-components@^2.0.0
npm install @ant-design/charts@^2.0.0
```

### 后端项目初始化

```bash
# 创建 Python 虚拟环境
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 安装依赖
pip install -r requirements.txt
```

**详细的项目结构和代码示例请参考**：
- [2.架构设计文档.md](./2.架构设计文档.md) - 项目结构和模块划分
- [4.框架开发计划.md](./4.框架开发计划.md) - 详细开发步骤和代码示例

---

**最后更新**：2025-01-XX

# 工艺路线模板管理迁移完成报告

**完成日期**：2026-01-16  
**迁移文件**：`29_20260116000004_create_process_route_template.py`

## 迁移内容

### 创建的表

**表名**：`apps_master_data_process_route_templates`

### 表结构

| 字段名 | 类型 | 说明 | 可空 | 默认值 |
|--------|------|------|------|--------|
| id | INTEGER | 主键ID（自增） | NO | SERIAL |
| uuid | VARCHAR(36) | 业务ID（UUID，唯一） | NO | - |
| tenant_id | INTEGER | 组织ID | NO | - |
| code | VARCHAR(50) | 模板编码 | NO | - |
| name | VARCHAR(200) | 模板名称 | NO | - |
| category | VARCHAR(50) | 模板分类 | YES | - |
| description | TEXT | 模板描述 | YES | - |
| scope | VARCHAR(20) | 适用范围 | NO | 'all_materials' |
| scope_groups | JSONB | 适用范围物料分组列表 | YES | - |
| process_route_config | JSONB | 工艺路线配置 | YES | - |
| version | VARCHAR(20) | 模板版本号 | NO | '1.0' |
| version_description | TEXT | 版本说明 | YES | - |
| base_version | VARCHAR(20) | 基于版本 | YES | - |
| is_active | BOOLEAN | 是否启用 | NO | true |
| created_at | TIMESTAMPTZ | 创建时间 | NO | CURRENT_TIMESTAMP |
| updated_at | TIMESTAMPTZ | 更新时间 | NO | CURRENT_TIMESTAMP |
| deleted_at | TIMESTAMPTZ | 删除时间（软删除） | YES | - |

### 索引

1. `idx_process_route_templates_tenant_id` - tenant_id索引
2. `idx_process_route_templates_code` - code索引
3. `idx_process_route_templates_uuid` - uuid索引
4. `idx_process_route_templates_category` - category索引
5. `idx_process_route_templates_version` - version索引
6. `idx_process_route_templates_is_active` - is_active索引

### 唯一约束

1. `apps_master_data_process_route_templates_uuid_key` - uuid唯一约束
2. `unique_tenant_code_version` - (tenant_id, code, version)复合唯一约束

## 迁移验证

✅ **表创建成功**：共17个字段  
✅ **索引创建成功**：共9个索引（包括主键和唯一约束）  
✅ **唯一约束创建成功**：2个唯一约束  
✅ **序列创建成功**：`apps_master_data_process_route_templates_id_seq`

## 相关功能

此迁移支持以下功能：

1. **工艺路线模板创建**：将现有工艺路线保存为模板
2. **模板分类管理**：支持按分类管理模板
3. **模板版本管理**：支持模板版本控制
4. **从模板创建工艺路线**：基于模板快速创建工艺路线
5. **模板适用范围**：支持设置模板的适用范围

## 后续工作

1. ✅ 数据库迁移已完成
2. ✅ 后端模型已创建
3. ✅ 后端Service方法已实现
4. ✅ 后端API路由已创建
5. ✅ 前端功能已实现

## 使用说明

### 执行迁移

```bash
cd riveredge-backend
uv run python migrations/execute_process_route_template_migration.py
```

### 回滚迁移

如果需要回滚，可以手动执行downgrade函数中的SQL语句，或使用Aerich工具。

---

**报告生成时间**：2026-01-16

# 销售订单 UniLifecycle 阶段分析与优化

## 当前 7 个主阶段

| 阶段 key | 标签 | 实际作用 | 是否必要 |
|----------|------|----------|----------|
| draft | 草稿 | 订单新建未提交 | ✅ 必要 |
| pending_review | 待审核 | 已提交等待审核 | ✅ 必要 |
| audited | 已审核 | 审核通过，等待确认/下推 | ✅ 必要 |
| **effective** | **已生效** | 订单已确认或已下推，可开始执行，但尚未开始生产 | ⚠️ 有业务意义，但当前逻辑为死代码 |
| executing | 执行中 | BOM/需求/工单/生产/交货进行中 | ✅ 必要 |
| delivered | 已交货 | 交货完成，等待开票 | ✅ 必要 |
| completed | 已完成 | 交货+开票均完成 | ✅ 必要 |

## 已生效 vs 执行中 的区别

- **已生效**：订单审核通过且（客户确认 或 已下推需求计算），表示订单正式生效、可开始执行。此时尚未开始生产（无工单、交货进度为 0）。
- **执行中**：已开始执行，例如已下推需求、已有工单、或已有交货进度。

## 当前问题

后端 `document_lifecycle_service.py` 中，当 `effective and delivery < 100` 时**一律**返回「执行中」，导致「已生效」分支（第 225-232 行）成为**死代码**，永远不会被展示。

## 优化方案

当 `effective` 且 `delivery == 0` 且**尚未开始执行**（未下推 或 无工单）时，展示「已生效」；否则展示「执行中」。

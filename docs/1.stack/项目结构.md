# RiverEdge SaaS 多组织框架 - 项目结构文档

## 📋 整体架构

RiverEdge 采用前后端分离的微服务架构，基于多租户 SaaS 模式设计，支持动态应用管理和插件化扩展。

```
riveredge/
├── riveredge-backend/          # 后端服务 (Python/FastAPI)
├── riveredge-frontend/         # 前端应用 (React/TypeScript)
├── docs/                       # 项目文档
├── Launch.sh                   # 一键启动脚本
└── 配置文件                    # 项目配置和工具
```

## 🏗️ 后端框架结构

### 核心设计原则
- **分层架构**: infra(基础设施) → core(核心) → apps(应用) → server(服务)
- **关注点分离**: 每层职责单一，依赖关系清晰
- **插件化设计**: 支持动态应用加载和管理

### 目录结构

```
riveredge-backend/src/
├── infra/                      # 🏛️ 基础设施层 (Platform Level)
│   ├── api/                    # 平台级 API 接口
│   ├── config/                 # 配置管理
│   ├── domain/                 # 领域模型和业务逻辑
│   ├── infrastructure/         # 基础设施服务
│   ├── models/                 # 数据库模型
│   └── schemas/                # 数据验证模式
├── core/                       # 🔧 核心业务层 (System Level)
│   ├── api/                    # 系统级 API 接口
│   ├── middleware/             # 中间件
│   ├── models/                 # 业务数据模型
│   ├── schemas/                # 数据传输对象
│   ├── services/               # 业务服务逻辑
│   ├── utils/                  # 工具函数
│   └── inngest/                # 工作流引擎
├── apps/                       # 📦 应用层 (Application Level)
│   ├── master_data/            # 主数据管理 (基础应用)
│   └── {app_code}/             # 业务应用模块 (动态加载)
└── server/                     # 🚀 服务启动层
    └── main.py                 # FastAPI 应用入口
```

### 架构分层详解

#### 1. Infra 层 (基础设施层)
**职责**: 提供平台级的核心功能和服务
- **API**: 租户管理、套餐配置、监控统计、平台级认证
- **Domain**: 租户上下文、安全策略、时区处理、查询过滤
- **Infrastructure**: 数据库连接、缓存服务、日志系统
- **Models**: 平台级数据模型 (租户、套餐等)

#### 2. Core 层 (核心业务层)
**职责**: 提供系统级的通用功能和管理
- **API**: 用户管理、权限控制、数据字典、菜单管理等
- **Middleware**: 异常处理、操作日志、认证授权
- **Models**: 系统级数据模型 (用户、角色、权限等)
- **Services**: 业务逻辑服务 (用户服务、权限服务等)
- **Utils**: 通用工具函数
- **Inngest**: 事件驱动的工作流引擎

#### 3. Apps 层 (应用层)
**职责**: 业务应用的容器和运行时
- **Master Data**: 主数据管理 (物料、客户、供应商等基础数据)
- **Business Apps**: 具体业务应用模块 (动态加载)
- **Structure**: 每个应用包含 `api/`, `models/`, `schemas/`, `services/`

#### 4. Server 层 (服务层)
**职责**: 应用启动和服务配置
- **Main**: FastAPI 应用实例和路由配置
- **Lifespan**: 应用生命周期管理
- **Integration**: 外部服务集成 (Inngest、静态文件等)

## 🎨 前端框架结构

### 设计原则
- **组件化开发**: 基于 React 的组件化架构
- **路由驱动**: 基于文件路由的页面组织
- **状态管理**: 集中式状态管理和服务层分离

### 目录结构

```
riveredge-frontend/src/
├── components/                 # 🧩 可复用组件库
│   ├── custom-fields/          # 自定义字段组件
│   ├── riveredge-query/        # 查询过滤组件
│   ├── uni-table/             # 通用表格组件
│   └── ...                     # 其他通用组件
├── layouts/                    # 📐 页面布局组件
│   └── BasicLayout.tsx         # 基础页面布局
├── pages/                      # 📄 页面组件 (路由驱动)
│   ├── system/                 # 系统管理页面
│   ├── personal/               # 个人中心页面
│   ├── infra/                  # 平台管理页面
│   └── ...                     # 其他页面
├── routes/                     # 🛣️ 路由配置
│   ├── AppRoutes.tsx          # 应用路由
│   └── SystemRoutes.tsx       # 系统路由
├── services/                   # 🔗 API 服务层
│   ├── api.ts                 # 基础 API 配置
│   └── *.ts                    # 各模块 API 服务
├── stores/                     # 🏪 状态管理
│   ├── globalStore.ts         # 全局状态
│   └── index.ts               # 状态导出
├── utils/                      # 🛠️ 工具函数
├── config/                     # ⚙️ 配置管理
├── locales/                    # 🌐 国际化
├── apps/                       # 📦 应用模块
│   └── master-data/           # 主数据应用
└── main.tsx                    # 🚀 应用入口
```

### 前端架构特点

#### 组件化设计
- **通用组件**: uni-table、uni-tabs、riveredge-query 等
- **业务组件**: 各业务模块的专用组件
- **布局组件**: BasicLayout 等页面布局

#### 服务层架构
- **API 服务**: 每个业务模块对应独立的 API 服务文件
- **基础配置**: 统一的 API 基础配置和拦截器
- **类型安全**: 完整的 TypeScript 类型定义

#### 路由系统
- **文件路由**: 基于目录结构的路由配置
- **权限控制**: 基于角色的路由访问控制
- **动态路由**: 支持动态菜单和路由生成

## 🏛️ 基础设施结构

### 部署和运行时
```
riveredge/
├── Launch.sh                   # 🚀 一键启动脚本
├── riveredge-backend/
│   ├── start-backend.sh        # 后端启动脚本
│   └── pyproject.toml          # Python 项目配置
├── riveredge-frontend/
│   ├── start-frontend.sh       # 前端启动脚本
│   └── vite.config.ts          # Vite 构建配置
└── .logs/                      # 📝 运行时日志目录
```

### 配置管理
- **环境变量**: 统一的配置管理
- **多环境**: 支持开发、测试、生产环境
- **热重载**: 开发时的自动重载支持

### 数据存储
- **主数据库**: PostgreSQL (业务数据)
- **缓存**: Redis (会话、缓存)
- **文件存储**: 本地文件系统 (上传文件)

## 🔄 架构优势

### 1. 分层架构优势
- **职责分离**: 每层职责明确，易于维护
- **依赖倒置**: 高层不依赖低层具体实现
- **扩展性好**: 新的业务应用可以独立开发

### 2. 插件化设计
- **动态加载**: 应用模块运行时动态加载
- **热插拔**: 支持应用的启用/禁用
- **独立部署**: 应用可独立升级和维护

### 3. 前后端分离
- **技术栈解耦**: 前后端技术栈独立演进
- **并行开发**: 前后端可并行开发和部署
- **接口契约**: 通过 API 进行解耦

### 4. 多租户支持
- **数据隔离**: 基于租户的数据隔离
- **配置隔离**: 租户级配置管理
- **权限隔离**: 租户间的权限隔离

## 📈 扩展性设计

### 应用扩展
- **标准结构**: 每个应用遵循统一的目录结构
- **依赖注入**: 通过服务注册进行依赖管理
- **API 注册**: 自动注册应用的 API 路由

### 功能扩展
- **中间件扩展**: 支持自定义中间件
- **服务扩展**: 基于接口的服务扩展
- **配置扩展**: 支持自定义配置项

---

*最后更新: 2025年12月26日*

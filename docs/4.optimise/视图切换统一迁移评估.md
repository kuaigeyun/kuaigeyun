# 视图切换统一迁移评估

**创建时间**: 2025-12-27  
**目标**: 将所有带视图切换的页面统一迁移到UniTable的视图切换功能

---

## 📊 当前状态分析

### UniTable视图切换功能

UniTable已支持以下视图类型：
- `table`: 表格视图（默认）
- `card`: 卡片视图
- `kanban`: 看板视图
- `stats`: 统计视图

配置方式：
```typescript
<UniTable
  viewTypes={['table', 'card']}  // 支持的视图类型
  defaultViewType="card"          // 默认视图
  cardViewConfig={{
    renderCard: (item, index) => <Card>...</Card>  // 卡片渲染函数
  }}
/>
```

### 当前带视图切换的页面

#### 1. 卡片视图页面（card/list切换）

1. **集成配置** (`integration-configs/list/index.tsx`)
   - CardView组件：有独立的数据加载、状态管理、Modal
   - 复杂度：⭐⭐⭐⭐（高）
   - 迁移难度：需要提取卡片渲染逻辑，保留Modal在父组件

2. **打印模板** (`print-templates/list/index.tsx`)
   - CardView组件：有独立的数据加载、状态管理、多个Modal（详情、预览、设计器、变量、渲染）
   - 复杂度：⭐⭐⭐⭐⭐（很高）
   - 迁移难度：需要提取卡片渲染逻辑，保留多个Modal在父组件

3. **打印设备** (`print-devices/list/index.tsx`)
   - CardView组件：有独立的数据加载、状态管理、Modal（详情、测试连接、执行打印）
   - 复杂度：⭐⭐⭐⭐（高）
   - 迁移难度：需要提取卡片渲染逻辑，保留Modal在父组件

4. **数据源** (`data-sources/list/index.tsx`)
   - CardView组件：有独立的数据加载、状态管理、Modal（详情、测试连接）
   - 复杂度：⭐⭐⭐⭐（高）
   - 迁移难度：需要提取卡片渲染逻辑，保留Modal在父组件

5. **在线用户** (`online-users/index.tsx`)
   - CardView组件：独立的卡片视图组件
   - 复杂度：⭐⭐⭐（中）
   - 迁移难度：需要提取卡片渲染逻辑

6. **数据备份** (`data-backups/index.tsx`)
   - CardView组件：有独立的数据加载、状态管理
   - 复杂度：⭐⭐⭐（中）
   - 迁移难度：需要提取卡片渲染逻辑

#### 2. 特殊视图切换页面

7. **系统参数** (`system-parameters/list/index.tsx`)
   - 视图切换：`form`（分组表单视图）/ `list`（列表视图）
   - 复杂度：⭐⭐（低）
   - 迁移难度：**保留**，因为UniTable不支持分组表单视图

8. **审批流程实例** (`approval-processes/instances/index.tsx`)
   - 视图切换：`kanban`（看板视图）/ `list`（列表视图）
   - 复杂度：⭐⭐⭐（中）
   - 迁移难度：**可以迁移**，UniTable支持kanban视图

---

## 🎯 迁移策略

### 方案A：完全迁移（推荐）

**优点**：
- 统一使用UniTable的视图切换，代码更简洁
- 减少重复代码
- 更好的用户体验（视图切换在工具栏）

**缺点**：
- 需要重构CardView组件，提取渲染逻辑
- 需要将Modal状态管理移到父组件
- 工作量较大

### 方案B：渐进式迁移

**步骤**：
1. 先迁移简单的页面（数据备份、在线用户）
2. 再迁移中等复杂度的页面（数据源、打印设备）
3. 最后迁移复杂页面（集成配置、打印模板）

### 方案C：保留现状

**理由**：
- CardView组件功能复杂，迁移成本高
- 当前实现已经工作良好

---

## 📋 迁移计划

### 阶段1：简单页面迁移（2个）

1. **数据备份** (`data-backups/index.tsx`)
   - 提取CardView的卡片渲染逻辑
   - 迁移到UniTable的cardViewConfig

2. **在线用户** (`online-users/index.tsx`)
   - 提取CardView的卡片渲染逻辑
   - 迁移到UniTable的cardViewConfig

### 阶段2：中等复杂度页面迁移（2个）

3. **数据源** (`data-sources/list/index.tsx`)
   - 提取CardView的卡片渲染逻辑
   - 保留Modal在父组件

4. **打印设备** (`print-devices/list/index.tsx`)
   - 提取CardView的卡片渲染逻辑
   - 保留Modal在父组件

### 阶段3：复杂页面迁移（2个）

5. **集成配置** (`integration-configs/list/index.tsx`)
   - 提取CardView的卡片渲染逻辑
   - 保留多个Modal在父组件

6. **打印模板** (`print-templates/list/index.tsx`)
   - 提取CardView的卡片渲染逻辑
   - 保留多个Modal在父组件

### 阶段4：特殊页面处理（2个）

7. **系统参数** (`system-parameters/list/index.tsx`)
   - **保留**视图切换，因为UniTable不支持分组表单视图

8. **审批流程实例** (`approval-processes/instances/index.tsx`)
   - 迁移到UniTable的kanban视图

---

## 🔧 迁移步骤模板

### 1. 移除视图切换Tabs

```typescript
// 移除前
<div style={{ padding: '16px 16px 0 16px' }}>
  <Tabs
    activeKey={viewMode}
    onChange={(key) => setViewMode(key as 'card' | 'list')}
    items={[...]}
  />
</div>
{viewMode === 'card' && <CardView />}
{viewMode === 'list' && <UniTable ... />}
```

```typescript
// 移除后
<UniTable
  viewTypes={['table', 'card']}
  defaultViewType="card"
  cardViewConfig={{
    renderCard: (item, index) => {
      // 从CardView提取的卡片渲染逻辑
      return <Card>...</Card>;
    }
  }}
  ...
/>
```

### 2. 提取卡片渲染逻辑

从CardView组件中提取单个卡片的渲染逻辑，作为renderCard函数。

### 3. 保留Modal在父组件

将CardView中的Modal状态和逻辑移到父组件，在renderCard中通过回调触发。

---

## ⚠️ 注意事项

1. **数据加载**：UniTable通过request函数统一加载数据，CardView的独立数据加载需要移除
2. **状态管理**：Modal、详情等状态需要移到父组件
3. **操作函数**：查看、编辑、删除等操作函数需要在父组件中定义，通过renderCard的回调传递
4. **自动刷新**：CardView中的自动刷新逻辑需要移除，使用UniTable的刷新机制

---

## 📊 迁移优先级

**高优先级**（简单，快速见效）：
- 数据备份
- 在线用户

**中优先级**（中等复杂度）：
- 数据源
- 打印设备

**低优先级**（复杂，需要仔细处理）：
- 集成配置
- 打印模板

**特殊处理**：
- 系统参数（保留）
- 审批流程实例（迁移到kanban视图）

---

**最后更新**: 2025-12-27


# æœåŠ¡ä¾èµ–å…³ç³»å›¾

## ğŸ“Š æœåŠ¡ä¾èµ–å…³ç³»æ¦‚è§ˆ

### å¹³å°çº§æœåŠ¡ (infra/services/)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        å¹³å°çº§æœåŠ¡ (infra/services/)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - TenantService                         â”‚
â”‚ - PackageService                        â”‚
â”‚ - AuthService                           â”‚
â”‚ - InfraSuperAdminService                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¾èµ–å…³ç³»ï¼š**
- `AuthService` â†’ `UserActivityServiceInterface` (coreå±‚)
- `AuthService` â†’ `AuditLogServiceInterface` (coreå±‚)

### ç³»ç»Ÿçº§æœåŠ¡ (core/services/)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ç³»ç»Ÿçº§æœåŠ¡ (core/services/)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç”¨æˆ·ç®¡ç†                                â”‚
â”‚   - UserService                         â”‚
â”‚   - UserProfileService                  â”‚
â”‚   - UserPreferenceService               â”‚
â”‚   - UserMessageService                  â”‚
â”‚   - UserTaskService                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æƒé™ç®¡ç†                                â”‚
â”‚   - RoleService                         â”‚
â”‚   - PermissionService                   â”‚
â”‚   - PositionService                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç»„ç»‡æ¶æ„                                â”‚
â”‚   - DepartmentService                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç³»ç»Ÿé…ç½®                                â”‚
â”‚   - SystemParameterService              â”‚
â”‚   - SiteSettingService                  â”‚
â”‚   - LanguageService                     â”‚
â”‚   - MenuService                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ•°æ®ç®¡ç†                                â”‚
â”‚   - DatasetService                      â”‚
â”‚   - DataSourceService                   â”‚
â”‚   - DataDictionaryService               â”‚
â”‚   - DataBackupService                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ–‡ä»¶ç®¡ç†                                â”‚
â”‚   - FileService                         â”‚
â”‚   - FilePreviewService                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å®¡æ‰¹æµç¨‹                                â”‚
â”‚   - ApprovalProcessService              â”‚
â”‚   - ApprovalInstanceService             â”‚
â”‚   - ApprovalHistoryService              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ¶ˆæ¯é€šçŸ¥                                â”‚
â”‚   - MessageService                      â”‚
â”‚   - MessageConfigService                â”‚
â”‚   - MessageTemplateService              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ—¥å¿—å®¡è®¡                                â”‚
â”‚   - OperationLogService                 â”‚
â”‚   - LoginLogService                     â”‚
â”‚   - OnlineUserService                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åº”ç”¨ç®¡ç†                                â”‚
â”‚   - ApplicationService                  â”‚
â”‚   - ApplicationRegistryService          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åº”ç”¨çº§æœåŠ¡ (apps/{app_code}/services/)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     åº”ç”¨çº§æœåŠ¡ (apps/{app_code}/)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ¯ä¸ªåº”ç”¨æœ‰è‡ªå·±çš„æœåŠ¡å±‚                   â”‚
â”‚ - åŠ¨æ€åŠ è½½                               â”‚
â”‚ - é€šè¿‡ ApplicationRegistryService ç®¡ç†   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”— è·¨å±‚ä¾èµ–å…³ç³»

### infra â†’ core ä¾èµ–

```
AuthService (infra)
    â†“
    â”œâ”€â†’ UserActivityServiceInterface (core)
    â””â”€â†’ AuditLogServiceInterface (core)
```

### core â†’ infra ä¾èµ–

```
UserService (core)
    â†“
    â””â”€â†’ User Model (infra.models.user)
```

## ğŸ“‹ å·²å®ç°æ¥å£çš„æœåŠ¡

### å·²æ³¨å†Œåˆ° ServiceRegistry

| æœåŠ¡åç§° | æ¥å£ | å®ç°ç±» | çŠ¶æ€ |
|---------|------|--------|------|
| user_service | UserServiceInterface | UserServiceImpl | âœ… å·²æ³¨å†Œ |
| role_service | RoleServiceInterface | RoleServiceImpl | âœ… å·²æ³¨å†Œ |
| message_service | MessageServiceInterface | MessageServiceImpl | âœ… å·²æ³¨å†Œ |
| application_service | ApplicationServiceInterface | ApplicationServiceImpl | âœ… å·²æ³¨å†Œ |
| user_activity_service | UserActivityServiceInterface | UserActivityServiceImpl | âœ… å·²æ³¨å†Œ |
| audit_log_service | AuditLogServiceInterface | AuditLogServiceImpl | âœ… å·²æ³¨å†Œ |

### å¾…è¿ç§»çš„æœåŠ¡

| æœåŠ¡åç§° | å½“å‰çŠ¶æ€ | ä¼˜å…ˆçº§ | è¿ç§»éš¾åº¦ |
|---------|---------|--------|---------|
| DepartmentService | ç›´æ¥å¯¼å…¥ | ä¸­ | ä½ |
| PermissionService | ç›´æ¥å¯¼å…¥ | ä¸­ | ä½ |
| PositionService | ç›´æ¥å¯¼å…¥ | ä¸­ | ä½ |
| MenuService | ç›´æ¥å¯¼å…¥ | é«˜ | ä¸­ |
| FileService | ç›´æ¥å¯¼å…¥ | ä¸­ | ä½ |
| ApprovalProcessService | ç›´æ¥å¯¼å…¥ | ä¸­ | ä¸­ |
| ApprovalInstanceService | ç›´æ¥å¯¼å…¥ | ä¸­ | ä¸­ |

## ğŸ”„ æœåŠ¡è°ƒç”¨æ–¹å¼

### æ–¹å¼ä¸€ï¼šé€šè¿‡ ServiceRegistryï¼ˆæ¨èï¼‰

```python
from core.services.interfaces.service_registry import ServiceLocator

user_service = ServiceLocator.get_service("user_service")
user = await user_service.create_user(...)
```

### æ–¹å¼äºŒï¼šé€šè¿‡ä¾èµ–æ³¨å…¥ï¼ˆæ¨èï¼‰

```python
from core.api.deps.service_helpers import get_user_service_with_fallback

@router.post("/users")
async def create_user(
    user_service: Any = Depends(get_user_service_with_fallback)
):
    return await user_service.create_user(...)
```

### æ–¹å¼ä¸‰ï¼šç›´æ¥å¯¼å…¥ï¼ˆå‘åå…¼å®¹ï¼‰

```python
from core.services.user.user_service import UserService

user = await UserService.create_user(...)
```

## ğŸ“ˆ è¿ç§»è¿›åº¦

### å·²å®Œæˆ
- âœ… æœåŠ¡æ³¨å†Œæœºåˆ¶å»ºç«‹
- âœ… 6ä¸ªæ ¸å¿ƒæœåŠ¡å·²æ³¨å†Œ
- âœ… ä¾èµ–æ³¨å…¥å‡½æ•°å·²åˆ›å»º
- âœ… ç¤ºä¾‹APIè·¯ç”±å·²è¿ç§»ï¼ˆcreate_userï¼‰

### è¿›è¡Œä¸­
- ğŸ”„ é€æ­¥è¿ç§»å…¶ä»–APIè·¯ç”±

### å¾…å®Œæˆ
- â³ ä¸ºæ›´å¤šæœåŠ¡å®šä¹‰æ¥å£
- â³ è¿ç§»æ‰€æœ‰APIè·¯ç”±åˆ°ä¾èµ–æ³¨å…¥
- â³ å»ºç«‹å®Œæ•´çš„æœåŠ¡ä¾èµ–å…³ç³»å›¾

---

**æœ€åæ›´æ–°ï¼š** 2025-12-27
**ä½œè€…ï¼š** Luigi Lu


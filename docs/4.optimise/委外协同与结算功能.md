# å§”å¤–ååŒä¸ç»“ç®—åŠŸèƒ½

> **æ–‡æ¡£è¯´æ˜ï¼š**  
> æœ¬æ–‡æ¡£è¯´æ˜å§”å¤–ååŒå’Œå§”å¤–ç»“ç®—åŠŸèƒ½çš„å®ç°æ–¹æ¡ˆã€‚  
> 
> **åˆ›å»ºæ—¶é—´ï¼š** 2026-01-27  
> **æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0

---

## ğŸ“‹ ç›®å½•

1. [åŠŸèƒ½æ¦‚è¿°](#åŠŸèƒ½æ¦‚è¿°)
2. [å®ç°æ–¹æ¡ˆ](#å®ç°æ–¹æ¡ˆ)
3. [ä½¿ç”¨æŒ‡å—](#ä½¿ç”¨æŒ‡å—)

---

## åŠŸèƒ½æ¦‚è¿°

### å§”å¤–ååŒåŠŸèƒ½

- âœ… **è®¢å•ä¸‹å‘**ï¼šå°†å§”å¤–è®¢å•å‘é€ç»™ä¾›åº”å•†
- âœ… **è¿›åº¦æ›´æ–°**ï¼šä¾›åº”å•†å¯ä»¥æ›´æ–°å§”å¤–åŠ å·¥è¿›åº¦
- âœ… **å®Œå·¥ç”³è¯·**ï¼šä¾›åº”å•†æäº¤å§”å¤–åŠ å·¥å®Œæˆç”³è¯·
- âœ… **è®¢å•æŸ¥è¯¢**ï¼šä¾›åº”å•†å¯ä»¥æŸ¥çœ‹è‡ªå·±çš„å§”å¤–è®¢å•åˆ—è¡¨

### å§”å¤–ç»“ç®—åŠŸèƒ½

- âœ… **è´¹ç”¨è®¡ç®—**ï¼šæ ¹æ®å§”å¤–å·¥å•çš„å®é™…æ”¶è´§æ•°é‡è®¡ç®—å§”å¤–è´¹ç”¨
- âœ… **ç»“ç®—å•åˆ›å»º**ï¼šæ ¹æ®å§”å¤–å·¥å•ç”Ÿæˆå§”å¤–ç»“ç®—å•ï¼Œç”¨äºå¯¹è´¦å’Œç»“ç®—
- âœ… **å§”å¤–å¯¹è´¦**ï¼šä¸ä¾›åº”å•†å¯¹è´¦ï¼Œç¡®è®¤å§”å¤–è´¹ç”¨

---

## å®ç°æ–¹æ¡ˆ

### 1. åç«¯æœåŠ¡

**å§”å¤–ååŒæœåŠ¡ï¼š** `apps/kuaizhizao/services/outsource_collaboration_service.py`

**ä¸»è¦æ–¹æ³•ï¼š**
- `send_outsource_order_to_supplier()`: ä¸‹å‘å§”å¤–è®¢å•ç»™ä¾›åº”å•†
- `update_outsource_progress()`: æ›´æ–°å§”å¤–è¿›åº¦
- `submit_outsource_completion()`: æäº¤å§”å¤–å®Œå·¥ç”³è¯·
- `get_supplier_outsource_orders()`: è·å–ä¾›åº”å•†çš„å§”å¤–è®¢å•åˆ—è¡¨

**å§”å¤–ç»“ç®—æœåŠ¡ï¼š** `apps/kuaizhizao/services/outsource_settlement_service.py`

**ä¸»è¦æ–¹æ³•ï¼š**
- `calculate_outsource_cost()`: è®¡ç®—å§”å¤–è´¹ç”¨
- `create_settlement_statement()`: åˆ›å»ºå§”å¤–ç»“ç®—å•
- `reconcile_outsource_orders()`: å§”å¤–å¯¹è´¦

### 2. APIæ¥å£

**å§”å¤–ååŒAPIï¼š**
- `POST /outsource-work-orders/{work_order_id}/send-to-supplier`: ä¸‹å‘å§”å¤–è®¢å•ç»™ä¾›åº”å•†
- `POST /outsource-work-orders/{work_order_id}/update-progress`: æ›´æ–°å§”å¤–è¿›åº¦
- `POST /outsource-work-orders/{work_order_id}/submit-completion`: æäº¤å§”å¤–å®Œå·¥ç”³è¯·
- `GET /suppliers/{supplier_id}/outsource-orders`: è·å–ä¾›åº”å•†çš„å§”å¤–è®¢å•åˆ—è¡¨

**å§”å¤–ç»“ç®—APIï¼š**
- `GET /outsource-work-orders/{work_order_id}/calculate-cost`: è®¡ç®—å§”å¤–è´¹ç”¨
- `POST /outsource-settlement/create-statement`: åˆ›å»ºå§”å¤–ç»“ç®—å•
- `POST /outsource-settlement/reconcile`: å§”å¤–å¯¹è´¦

### 3. Schemaå®šä¹‰

**å§”å¤–ååŒSchemaï¼š**
- `OutsourceProgressUpdateRequest`: æ›´æ–°å§”å¤–è¿›åº¦è¯·æ±‚
- `OutsourceCompletionRequest`: æäº¤å§”å¤–å®Œå·¥ç”³è¯·è¯·æ±‚

**å§”å¤–ç»“ç®—Schemaï¼š**
- `OutsourceCostCalculationResponse`: å§”å¤–è´¹ç”¨è®¡ç®—ç»“æœ
- `CreateSettlementStatementRequest`: åˆ›å»ºå§”å¤–ç»“ç®—å•è¯·æ±‚
- `SettlementStatementResponse`: å§”å¤–ç»“ç®—å•å“åº”
- `ReconciliationRequest`: å§”å¤–å¯¹è´¦è¯·æ±‚
- `ReconciliationResponse`: å§”å¤–å¯¹è´¦å“åº”

---

## ä½¿ç”¨æŒ‡å—

### å§”å¤–ååŒ

#### ä¸‹å‘å§”å¤–è®¢å•ç»™ä¾›åº”å•†

```python
POST /apps/kuaizhizao/outsource-work-orders/{work_order_id}/send-to-supplier
```

#### æ›´æ–°å§”å¤–è¿›åº¦

```python
POST /apps/kuaizhizao/outsource-work-orders/{work_order_id}/update-progress
{
  "completed_quantity": 50,
  "progress_percentage": 50,
  "remarks": "è¿›åº¦æ­£å¸¸"
}
```

#### æäº¤å§”å¤–å®Œå·¥ç”³è¯·

```python
POST /apps/kuaizhizao/outsource-work-orders/{work_order_id}/submit-completion
{
  "completed_quantity": 100,
  "qualified_quantity": 98,
  "unqualified_quantity": 2,
  "remarks": "å·²å®ŒæˆåŠ å·¥"
}
```

### å§”å¤–ç»“ç®—

#### è®¡ç®—å§”å¤–è´¹ç”¨

```python
GET /apps/kuaizhizao/outsource-work-orders/{work_order_id}/calculate-cost
```

#### åˆ›å»ºå§”å¤–ç»“ç®—å•

```python
POST /apps/kuaizhizao/outsource-settlement/create-statement
{
  "supplier_id": 1,
  "start_date": "2026-01-01",
  "end_date": "2026-01-31",
  "outsource_work_order_ids": [1, 2, 3]
}
```

#### å§”å¤–å¯¹è´¦

```python
POST /apps/kuaizhizao/outsource-settlement/reconcile
{
  "supplier_id": 1,
  "outsource_work_order_ids": [1, 2, 3],
  "confirmed_amount": 10000.00,
  "remarks": "å¯¹è´¦ç¡®è®¤"
}
```

---

**æ–‡æ¡£åˆ›å»ºæ—¶é—´ï¼š** 2026-01-27  
**æ–‡æ¡£ä½œè€…ï¼š** Auto (AI Assistant)  
**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0

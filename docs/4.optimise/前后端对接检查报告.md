# 应用级APP前后端对接检查报告

**检查日期**: 2025-01-01  
**检查范围**: kuaizhizao 和 master-data 两个应用级APP

---

## 📋 检查概览

### kuaizhizao APP

#### ✅ 已对接的API模块

1. **生产执行模块** (`production.ts`)
   - ✅ 工单管理 (`work-orders`) - 完全对接
   - ✅ 报工管理 (`reporting`) - 完全对接
   - ✅ 生产领料单 (`production-pickings`) - 完全对接
   - ✅ 成品入库单 (`finished-goods-receipts`) - 完全对接
   - ✅ 销售出库单 (`sales-deliveries`) - 完全对接
   - ✅ 采购入库单 (`purchase-receipts`) - 完全对接

2. **质量管理模块** (`quality.ts`)
   - ✅ 来料检验 (`incoming-inspections`) - 完全对接
   - ✅ 过程检验 (`process-inspections`) - 完全对接
   - ✅ 成品检验 (`finished-goods-inspections`) - 完全对接

3. **财务管理模块** (`finance.ts`)
   - ⚠️ 应付单 (`payables`) - **路径不匹配**
     - 前端: `/apps/kuaizhizao/finance-management/accounts-payable`
     - 后端: `/apps/kuaizhizao/payables`
   - ⚠️ 应收单 (`receivables`) - **路径不匹配**
     - 前端: `/apps/kuaizhizao/finance-management/accounts-receivable`
     - 后端: `/apps/kuaizhizao/receivables`
   - ✅ 采购发票 (`purchase-invoices`) - 完全对接

4. **销售管理模块** (`sales.ts`)
   - ✅ 销售订单 (`sales-orders`) - 完全对接
   - ✅ 销售预测 (`sales-forecasts`) - 完全对接

5. **计划管理模块** (`production.ts` -> `planningApi`)
   - ✅ MRP运算 (`mrp-computation`) - 完全对接
   - ✅ LRP运算 (`lrp-computation`) - 完全对接
   - ✅ 生产计划 (`production-plans`) - 完全对接
   - ⚠️ 需求管理 (`demand-management`) - **API混用**
     - 前端调用: `planningApi.productionPlan.get/list`（实际使用的是生产计划API）
     - 后端路由: 使用 `production-plans` API
     - **问题**: 需求管理页面应该使用 `sales-forecasts` API，而不是 `production-plans` API

6. **BOM管理模块** (`production.ts` -> `bomApi`)
   - ⚠️ BOM管理 (`bill-of-materials`) - **路径不匹配**
     - 前端: `/apps/kuaizhizao/bill-of-materials`
     - 后端: 已移至 `master-data` APP (`/apps/master-data/materials/bom`)
     - **建议**: 前端应调用 `master-data` 的BOM API

7. **报表模块** (`reports.ts`)
   - ❌ 库存报表 (`inventory-report`) - **后端缺失**
   - ❌ 生产报表 (`production-report`) - **后端缺失**
   - ❌ 质量报表 (`quality-report`) - **后端缺失**
   - ❌ 报表图表数据 (`reports/charts`) - **后端缺失**

8. **采购管理模块** (`purchase.py`)
   - ✅ 采购订单 (`purchase-orders`) - 完全对接

9. **通用功能模块** (`common.ts`)
   - ❌ 数据导入导出 (`data-import`, `export-tasks`) - **后端缺失**
   - ⚠️ 系统参数 (`system-parameters`) - **功能重复**
     - 前端: `/apps/kuaizhizao/common/system-parameters`
     - 系统级: `/api/v1/core/system-parameters`（已实现）
     - **问题**: 系统参数应在系统级管理，不应在应用级重复实现
   - ⚠️ 编码规则 (`code-rules`) - **功能重复**
     - 前端: `/apps/kuaizhizao/common/code-rules`
     - 系统级: `/api/v1/core/code-rules`（已实现）
     - **问题**: 编码规则应在系统级管理，不应在应用级重复实现

#### ⚠️ 发现的问题

1. **路径不匹配问题**
   - 财务模块路径不一致（前端使用 `finance-management`，后端使用直接路径）
   - BOM管理已移至 `master-data`，但前端仍调用 `kuaizhizao` 路径

2. **API使用错误**
   - 需求管理页面错误地使用了 `production-plans` API，应该使用 `sales-forecasts` API

3. **缺失的后端API**
   - 所有报表API（库存报表、生产报表、质量报表）

3. **前端API调用不一致**
   - `production.ts` 使用 `api.get/post/put/delete`
   - `sales.ts`、`quality.ts`、`finance.ts`、`reports.ts`、`common.ts` 使用 `apiRequest`

4. **功能重复问题**
   - 系统参数和编码规则已在系统级实现，但在 kuaizhizao 中重复实现（应移除应用级实现）
   - 数据导入导出API缺失

---

### master-data APP

#### ✅ 已对接的API模块

1. **供应链模块** (`supply-chain.ts`)
   - ✅ 客户管理 (`customers`) - 完全对接
   - ✅ 供应商管理 (`suppliers`) - 完全对接

2. **物料管理模块** (`material.ts`)
   - ✅ 物料分组 (`materials/groups`) - 完全对接
   - ✅ 物料管理 (`materials`) - 完全对接
   - ✅ BOM管理 (`materials/bom`) - 完全对接

3. **工厂建模模块** (`factory.ts`)
   - ✅ 工位管理 (`workstations`) - 需要确认
   - ✅ 产线管理 (`production-lines`) - 需要确认

4. **仓库管理模块** (`warehouse.ts`)
   - ✅ 仓库管理 (`warehouses`) - 完全对接
   - ✅ 库区管理 (`storage-areas`) - 完全对接
   - ✅ 库位管理 (`storage-locations`) - 完全对接

5. **工艺管理模块** (`process.ts`)
   - ✅ 工序管理 (`operations`) - 需要确认
   - ✅ 不良品类型 (`defect-types`) - 需要确认
   - ✅ 工艺路线 (`routes`) - 需要确认
   - ✅ SOP管理 (`sop`) - 需要确认

6. **绩效管理模块** (`performance.ts`)
   - ✅ 技能管理 (`skills`) - 需要确认
   - ✅ 节假日管理 (`holidays`) - 需要确认

---

## 🔧 需要修复的问题

### 高优先级 ✅ 已完成

1. **修复财务模块路径不匹配** ✅
   ```typescript
   // ✅ 已修复：finance.ts 已更新
   // 从: /apps/kuaizhizao/finance-management/accounts-payable
   // 改为: /apps/kuaizhizao/payables
   ```

2. **修复BOM管理路径** ✅
   ```typescript
   // ✅ 已解决：移除了 kuaizhizao 中的 BOM 管理页面
   // BOM 管理统一在 master-data 中管理（/apps/master-data/materials/bom）
   // 不再需要修复路径，因为已移除重复功能
   ```

3. **统一API调用方式** ✅
   - ✅ 已统一使用 `apiRequest` 方式
   - ✅ production.ts 中的所有 API 调用已改为 `apiRequest`

### 中优先级（部分完成）

4. **实现缺失的后端API**
   - ✅ 需求管理API：已修复前端调用（使用 `sales-forecasts` API）
   - ✅ 销售预测API：已添加更新和删除接口
   - ⚠️ 报表API（库存报表、生产报表、质量报表）：待后端实现（较复杂，需要创建完整的服务层、schema和路由）

5. **确认 master-data 其他模块的API对接**
   - ⚠️ 工厂建模模块：待确认
   - ⚠️ 工艺管理模块：待确认
   - ⚠️ 绩效管理模块：待确认

---

## 📊 对接统计

### kuaizhizao APP
- **已对接**: 15个模块
- **路径不匹配**: 2个模块（财务、BOM）
- **API使用错误**: 1个模块（需求管理使用了错误的API）
- **功能重复**: 2个模块（系统参数、编码规则，已在系统级实现）
- **后端缺失**: 4个模块（3个报表、1个数据导入导出）
- **对接完成度**: 约 62% (15/24)

### master-data APP
- **已对接**: 6个模块（确认）
- **待确认**: 5个模块
- **对接完成度**: 约 55% (6/11，不含待确认)

---

## 🎯 下一步行动

1. **立即修复** ✅ 已完成
   - [x] 修复财务模块API路径
   - [x] 移除 kuaizhizao 中的 BOM 管理页面（统一在 master-data 中管理）
   - [x] 统一API调用方式（production.ts 改为使用 apiRequest）

2. **短期实现**（部分完成）
   - [x] 修复需求管理页面API调用（改为使用 `sales-forecasts` API）
   - [ ] 实现报表后端API（库存、生产、质量）
   - [ ] 实现数据导入导出后端API（系统参数和编码规则已在系统级实现，无需重复）

3. **长期完善**
   - [ ] 确认并完善master-data其他模块的API对接
   - [ ] 建立API文档和测试用例
   - [ ] 建立前后端API对接规范

---

## 🔍 功能交叉检查

### 功能定位原则

根据架构设计原则：
- **kuaizhizao (快格轻制造)**: 业务应用，专注于生产执行核心业务流程
- **master-data (基础数据管理)**: 数据应用，统一管理基础数据
- **系统级 (core/infra)**: 系统级功能和配置管理

### 发现的交叉和重复问题

#### 1. ⚠️ BOM管理功能重复

**问题描述**：
- `kuaizhizao` 中有 BOM 管理页面（`plan-management/bill-of-materials`）
- `master-data` 中也有 BOM 管理（`materials/bom`）
- 后端 API 已统一在 `master-data` 中实现

**影响**：
- 前端路径不一致：kuaizhizao 使用 `/apps/kuaizhizao/bill-of-materials`，但应调用 `/apps/master-data/materials/bom`
- 数据管理职责不清：BOM 是基础数据，应该在 `master-data` 中统一管理

**建议**：
- ✅ **保留** `master-data` 中的 BOM 管理（数据应用）
- ❌ **移除** `kuaizhizao` 中的 BOM 管理页面
- 🔄 **调整** kuaizhizao 的菜单，将 BOM 管理链接到 `master-data` 的 BOM 页面
- 📝 **更新** kuaizhizao 的 manifest.json，移除 BOM 相关权限（或改为跳转权限）

#### 2. ⚠️ 业务配置功能重复（系统级功能）

**问题描述**：
- `kuaizhizao` 中有业务配置页面（`common/business-config`），包含：
  - 系统参数管理
  - 编码规则管理
- 系统级（`core`）已实现相同的功能：
  - `/api/v1/core/system-parameters` - 系统参数API
  - `/api/v1/core/code-rules` - 编码规则API

**影响**：
- 功能重复：应用级和系统级都实现了相同的配置管理功能
- API路径不一致：kuaizhizao 使用 `/apps/kuaizhizao/common/system-parameters`，系统级使用 `/api/v1/core/system-parameters`
- 职责不清：系统参数和编码规则属于系统级配置，不应在应用级重复实现

**建议**：
- ✅ **保留** 系统级（`core`）的系统参数和编码规则管理
- ❌ **移除** `kuaizhizao` 中的业务配置页面
- 🔄 **调整** 在系统级菜单中提供系统参数和编码规则管理入口
- 📝 **说明** 系统参数和编码规则是组织级别的配置，应在系统级统一管理，所有应用共享

#### 3. ✅ 仓储管理职责划分正确

**当前状态**：
- `master-data`：管理仓储基础数据（仓库、库区、库位定义）
- `kuaizhizao`：管理仓储业务操作（库存查询、入库、出库、领料等）

**结论**：
- ✅ 职责划分清晰，无交叉问题
- 数据在 `master-data` 中定义，业务在 `kuaizhizao` 中执行

#### 4. ✅ 工厂数据职责划分正确

**当前状态**：
- `master-data`：管理工厂基础数据（车间、产线、工位定义）
- `kuaizhizao`：使用工厂数据进行业务操作（工单分配到工位、报工等）

**结论**：
- ✅ 职责划分清晰，无交叉问题
- 数据在 `master-data` 中定义，业务在 `kuaizhizao` 中执行

#### 5. ✅ 物料数据职责划分正确

**当前状态**：
- `master-data`：管理物料基础数据（物料分组、物料定义）
- `kuaizhizao`：使用物料数据进行业务操作（采购、销售、生产、库存等）

**结论**：
- ✅ 职责划分清晰，无交叉问题
- 数据在 `master-data` 中定义，业务在 `kuaizhizao` 中执行

#### 6. ✅ 供应链数据职责划分正确

**当前状态**：
- `master-data`：管理供应链基础数据（客户、供应商定义）
- `kuaizhizao`：使用供应链数据进行业务操作（采购订单、销售订单等）

**结论**：
- ✅ 职责划分清晰，无交叉问题
- 数据在 `master-data` 中定义，业务在 `kuaizhizao` 中执行

#### 7. ✅ 工艺数据职责划分正确

**当前状态**：
- `master-data`：管理工艺基础数据（工序、工艺路线、SOP、不良品类型）
- `kuaizhizao`：使用工艺数据进行业务操作（工单工艺、质检标准等）

**结论**：
- ✅ 职责划分清晰，无交叉问题
- 数据在 `master-data` 中定义，业务在 `kuaizhizao` 中执行

### 功能职责总结

| 功能模块 | kuaizhizao | master-data | 系统级 | 状态 |
|---------|-----------|-------------|--------|------|
| **BOM管理** | ❌ 应移除 | ✅ 数据管理 | - | ⚠️ 需要调整 |
| **系统参数** | ❌ 应移除 | - | ✅ 配置管理 | ⚠️ 需要调整 |
| **编码规则** | ❌ 应移除 | - | ✅ 配置管理 | ⚠️ 需要调整 |
| **仓储数据** | - | ✅ 数据定义 | - | ✅ 正确 |
| **仓储业务** | ✅ 业务操作 | - | - | ✅ 正确 |
| **工厂数据** | - | ✅ 数据定义 | - | ✅ 正确 |
| **物料数据** | - | ✅ 数据定义 | - | ✅ 正确 |
| **供应链数据** | - | ✅ 数据定义 | - | ✅ 正确 |
| **工艺数据** | - | ✅ 数据定义 | - | ✅ 正确 |

### 修复建议

#### 高优先级 ✅ 已完成

1. **移除 kuaizhizao 中的 BOM 管理页面** ✅
   - ✅ 删除 `apps/kuaizhizao/pages/plan-management/bill-of-materials/`
   - ✅ 更新 manifest.json，移除 BOM 相关菜单项和权限
   - ✅ 更新路由配置，移除 BOM 路由
   - ✅ 从服务导出中移除 `bomApi`
   - ⚠️ 如需在 kuaizhizao 中访问 BOM，改为跳转到 `master-data` 的 BOM 页面（待实现）

2. **移除 kuaizhizao 中的业务配置页面** ✅
   - ✅ 删除 `apps/kuaizhizao/pages/common/business-config/`
   - ✅ 更新路由配置，移除业务配置路由
   - ✅ 从 services/common.ts 中移除系统参数和编码规则API（保留注释说明应在系统级使用）
   - ✅ 系统参数和编码规则已在系统级菜单中配置（见第3项）

3. **更新系统级菜单** ✅ 已完成
   - ✅ 系统参数和编码规则已在系统级菜单的"核心配置"分组中配置
   - ✅ 路由已配置：/system/system-parameters 和 /system/code-rules
   - ✅ 菜单项已显示：参数设置 和 编码规则
   - ✅ 系统级功能对组织管理员可见

#### 中优先级 ✅ 已完成

4. **清理前端服务定义** ✅
   - ✅ 从 `apps/kuaizhizao/services/common.ts` 中移除了系统参数和编码规则API（保留注释说明应在系统级使用）
   - ✅ 从 `apps/kuaizhizao/services/production.ts` 中移除了 `bomApi`

5. **更新文档和权限** ⚠️ 待实现
   - [ ] 更新权限定义，确保职责清晰
   - [ ] 更新用户文档，说明功能归属

---

## 📝 备注

- 本报告基于代码静态分析，建议进行实际API调用测试以确认
- 部分模块可能需要进一步检查具体的接口参数和响应格式
- 建议建立API对接测试用例，确保前后端一致性
- **功能交叉检查基于架构设计原则：数据与业务分离，系统级功能统一管理**


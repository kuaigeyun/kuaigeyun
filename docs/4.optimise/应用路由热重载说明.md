# 应用路由热重载说明

## 问题背景

在开发过程中，修改应用代码（特别是API路由）后，通常需要重启整个后端服务才能让更改生效。这会导致：
- 开发效率低下
- 频繁重启影响其他功能测试
- 浪费时间等待服务重启

## 解决方案

已添加应用路由热重载功能，可以通过API调用重新加载应用路由，**无需重启整个后端服务**。

## 使用方法

### 1. 通过API调用重新加载应用路由

```bash
# 重新加载 master-data 应用的路由
curl -X POST http://localhost:8200/api/v1/applications/master-data/reload-routes \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "X-Tenant-ID: YOUR_TENANT_ID"
```

### 2. 响应示例

**成功响应：**
```json
{
  "success": true,
  "message": "应用 master-data 路由重新加载成功",
  "app_code": "master-data"
}
```

**失败响应：**
```json
{
  "detail": "应用 master-data 路由重新加载失败，请查看后端日志"
}
```

## 适用场景

✅ **适合使用热重载的场景：**
- 修改API路由定义
- 修改API函数参数顺序
- 修改API函数逻辑（不涉及模型变更）
- 修复语法错误后重新加载

❌ **不适合使用热重载的场景：**
- 修改数据库模型（需要数据库迁移）
- 修改应用注册机制本身
- 修改中间件配置
- 修改服务初始化逻辑

## 注意事项

1. **语法错误检查**：如果代码有语法错误，热重载会失败，需要先修复错误
2. **查看日志**：热重载失败时，请查看后端日志了解具体错误原因
3. **数据库变更**：如果涉及数据库模型变更，仍需要执行数据库迁移

## 开发建议

1. **优先使用热重载**：修改应用代码后，先尝试使用热重载，而不是立即重启服务
2. **检查语法**：修改代码后，先检查是否有语法错误，避免热重载失败
3. **查看日志**：热重载失败时，查看后端日志了解具体原因

## 常见问题

### Q: 热重载后路由仍然404？
A: 检查后端日志，确认是否有语法错误或导入错误。如果问题持续，可能需要重启服务。

### Q: 热重载会影响其他应用吗？
A: 不会。热重载只重新加载指定应用的路由，不会影响其他应用。

### Q: 热重载后需要重新登录吗？
A: 不需要。热重载只影响路由注册，不影响认证状态。

---

**最后更新：** 2026-01-19

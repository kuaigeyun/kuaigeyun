# 前端性能优化策略

> **文档说明：**  
> 本文档说明前端性能优化的策略和原则，避免过度优化导致用户体验下降。

## 懒加载的目的和问题

### 懒加载的目的
1. **减少初始bundle大小**：只加载当前需要的代码
2. **提升首屏加载速度**：减少初始加载时间
3. **按需加载**：用户访问时才加载对应页面

### 懒加载的问题
1. **路由切换延迟**：每次切换路由都要加载新的chunk，造成延迟
2. **菜单加载慢**：菜单可能需要预加载路由信息，导致菜单加载慢
3. **用户体验下降**：频繁的加载动画影响用户体验

## 优化策略

### 1. 核心页面立即加载（不懒加载）

**原则**：用户登录后立即访问的页面应该立即加载

**立即加载的页面**：
- ✅ Dashboard（工作台）
- ✅ 系统管理核心页面（用户、角色、权限等）
- ✅ 登录页、404页等公共页面

**原因**：
- 这些页面是用户最常访问的
- 立即加载可以避免路由切换时的延迟
- 提升用户体验

### 2. 应用级页面可以懒加载

**原则**：应用级页面可以懒加载，因为应用本身就是异步加载的

**懒加载的页面**：
- ✅ 应用内的业务页面（如kuaizhizao的各个功能页面）
- ✅ 不常用的系统页面（如日志、统计等）

**原因**：
- 应用级页面通过AppRoutes异步加载，已经有了一层懒加载
- 应用内的页面可以进一步懒加载，减少应用bundle大小

### 3. 代码分割策略

**原则**：按依赖类型分割，而不是按路由分割

**分割策略**：
- ✅ `vendor-react`：React相关库
- ✅ `vendor-antd`：Ant Design相关库
- ✅ `vendor-pro-components`：Pro Components
- ✅ `vendor-charts`：图表库
- ✅ `vendor-univerjs`：UniverJS表格库（体积大，按需加载）
- ✅ `vendor-other`：其他第三方库
- ✅ `app-{appName}`：按应用分割
- ✅ `pages-system`：系统级页面
- ✅ `pages-infra`：平台级页面

**原因**：
- 依赖库变化频率低，可以长期缓存
- 应用代码变化频率高，单独分割便于更新
- 避免单个chunk过大

### 4. 资源优化

**图片懒加载**：
- ✅ 使用 `loading="lazy"` 属性
- ✅ 使用 WebP 格式
- ✅ 响应式图片（srcset）

**字体优化**：
- ✅ 使用 `font-display: swap`
- ✅ 子集化字体（只包含需要的字符）
- ✅ 预加载关键字体

**CSS优化**：
- ✅ CSS代码分割
- ✅ 移除未使用的CSS
- ✅ 压缩CSS

### 5. 预加载策略

**预加载关键资源**：
- ✅ 预加载Dashboard页面
- ✅ 预加载常用系统页面
- ✅ 预连接API服务器（`<link rel="preconnect">`）

**预加载时机**：
- ✅ 登录成功后预加载Dashboard
- ✅ 鼠标悬停在菜单项上时预加载对应页面
- ✅ 空闲时预加载可能访问的页面

## 实施建议

### 当前状态
- ✅ 系统路由已采用立即加载（SystemRoutes.tsx）
- ✅ 应用路由已采用异步加载（AppRoutes.tsx）
- ✅ Vite构建配置已优化代码分割

### 下一步优化
1. **保持系统路由立即加载**（不改为懒加载）
2. **优化构建配置**（代码分割、压缩）
3. **添加资源预加载**（关键页面、API连接）
4. **优化图片和字体加载**（懒加载、格式优化）
5. **添加性能监控**（首屏时间、路由切换时间）

## 性能指标

### 目标指标
- **首屏加载时间**：< 2秒
- **路由切换时间**：< 300ms（核心页面）
- **菜单加载时间**：< 500ms
- **Lighthouse性能分数**：> 90

### 监控方法
- 使用 `performance` API 监控加载时间
- 使用 React DevTools Profiler 分析渲染性能
- 使用 Lighthouse 进行性能审计

---

**文档创建时间：** 2026-01-27  
**文档作者：** Auto (AI Assistant)  
**文档版本：** v1.0
# 详细功能点开发清单

## 📋 清单概述

**目标：** 建立详细的功能点开发清单，每个功能点完成后立即测试，结合Inngest工作流完善流程  
**原则：** 完成一项测试一项，确保质量  
**时间范围：** 2025-12-27 至 2026-06-15

---

## 1. 已完成功能清单（可复用）

### 1.1 高级搜索功能（✅ 已完成）

**功能描述：**
- 支持多字段组合搜索
- 支持拼音搜索
- 支持快速筛选
- 支持筛选条件组合（AND/OR）
- 支持保存搜索条件

**组件位置：**
- `riveredge-frontend/src/components/riveredge-query/index.tsx`
- `riveredge-backend/src/core/utils/search_utils.py`

**使用方式：**
```typescript
<UniTable
  showAdvancedSearch={true}
  // ...其他配置
/>
```

**可复用场景：**
- ✅ 工单列表搜索
- ✅ 物料列表搜索
- ✅ 报工记录搜索
- ✅ 库存查询搜索
- ✅ 所有列表页面搜索

### 1.2 UniSheet导入功能（✅ 已完成）

**功能描述：**
- 使用Univer Sheet进行Excel数据导入
- 支持数据预览和编辑
- 支持表头自动填充
- 支持示例数据填充
- 支持数据验证

**组件位置：**
- `riveredge-frontend/src/components/uni-import/index.tsx`

**使用方式：**
```typescript
<UniImport
  visible={importVisible}
  onCancel={() => setImportVisible(false)}
  onConfirm={handleImport}
  headers={['字段1', '字段2']}
  exampleRow={['示例1', '示例2']}
/>
```

**可复用场景：**
- ✅ 工单批量导入
- ✅ 物料批量导入
- ✅ 报工记录批量导入
- ✅ 销售预测导入
- ✅ 销售订单导入
- ✅ 所有需要批量导入的场景

### 1.3 Inngest工作流（✅ 已完成）

**功能描述：**
- 支持异步任务执行
- 支持定时任务调度
- 支持工作流编排
- 支持任务重试
- 支持任务监控

**已实现工作流：**
- ✅ 消息发送工作流（`message_sender_function`）
- ✅ 定时任务执行工作流（`scheduled_task_executor_function`）
- ✅ 审批流程工作流（`approval_workflow_function`）
- ✅ 数据备份工作流（`data_backup_executor_function`）
- ✅ SOP执行工作流（`sop_execution_workflow_function`）

**可复用场景：**
- ✅ 工单状态流转工作流
- ✅ MRP/LRP运算工作流
- ✅ 报工数据采集工作流
- ✅ 库存更新工作流
- ✅ 报表生成工作流

---

## 2. 系统级功能点清单

### 2.1 第一阶段：基础能力建设（3-4周）

#### 功能点1.1：完善文件头注释

**功能描述：** 所有Python文件添加Author和Date信息

**任务清单：**
- [ ] 检查所有API路由文件（40+个文件）
- [ ] 检查所有服务文件（30+个文件）
- [ ] 检查所有模型文件（50+个文件）
- [ ] 检查所有Schema文件（50+个文件）

**测试用例：**
- [ ] 验证所有文件都有文件头注释
- [ ] 验证文件头注释格式统一
- [ ] 验证Author和Date信息完整

**验收标准：**
- ✅ 所有Python文件都有文件头注释
- ✅ 文件头注释格式统一
- ✅ Author和Date信息完整

**预计时间：** 1-2天

---

#### 功能点1.2：应用管理机制完善

**功能描述：** 完善应用注册和路由管理机制

**任务清单：**
- [ ] 完善应用注册API（`POST /api/v1/core/applications`）
- [ ] 完善应用路由注册机制（`ApplicationRouteManager`）
- [ ] 完善应用菜单配置机制（`manifest.json`）
- [ ] 完善应用依赖检查机制
- [ ] 完善应用启用/禁用机制

**测试用例：**
- [ ] 测试应用注册功能
- [ ] 测试应用路由注册功能
- [ ] 测试应用菜单配置功能
- [ ] 测试应用依赖检查功能
- [ ] 测试应用启用/禁用功能

**验收标准：**
- ✅ 应用注册API可用
- ✅ 应用路由自动注册
- ✅ 应用菜单自动加载
- ✅ 应用依赖检查正确
- ✅ 应用启用/禁用正常

**预计时间：** 1周

---

#### 功能点1.3：编码规则服务

**功能描述：** 实现编码规则管理服务，支持自定义编码规则

**任务清单：**
- [ ] 创建编码规则模型（`CodeRule`）
- [ ] 创建编码规则服务（`CodeRuleService`）
- [ ] 创建编码规则API（`/api/v1/core/code-rules`）
- [ ] 实现编码生成逻辑（支持日期、序号、前缀等）
- [ ] 实现编码规则验证

**测试用例：**
- [ ] 测试编码规则创建
- [ ] 测试编码规则更新
- [ ] 测试编码规则删除
- [ ] 测试编码生成（日期格式）
- [ ] 测试编码生成（序号格式）
- [ ] 测试编码生成（前缀+日期+序号）
- [ ] 测试编码唯一性验证

**验收标准：**
- ✅ 编码规则CRUD功能正常
- ✅ 编码生成逻辑正确
- ✅ 编码唯一性验证正常
- ✅ 编码规则API可用

**Inngest工作流：**
- ⚠️ 可选：编码生成异步任务（大数据量场景）

**预计时间：** 0.5周

---

#### 功能点1.4：数据访问层优化

**功能描述：** 优化数据库连接和查询性能

**任务清单：**
- [ ] 优化数据库连接池配置
- [ ] 优化ORM查询性能（添加索引）
- [ ] 实现查询缓存机制（Redis）
- [ ] 实现查询结果缓存
- [ ] 实现慢查询监控

**测试用例：**
- [ ] 测试数据库连接池性能
- [ ] 测试ORM查询性能（大数据量）
- [ ] 测试查询缓存命中率
- [ ] 测试查询结果缓存有效期
- [ ] 测试慢查询监控功能

**验收标准：**
- ✅ 数据库连接池配置优化
- ✅ ORM查询性能提升50%+
- ✅ 查询缓存命中率>80%
- ✅ 慢查询监控正常

**预计时间：** 1周

---

#### 功能点1.5：文件管理服务完善

**功能描述：** 完善文件上传/下载功能

**任务清单：**
- [ ] 完善文件上传API（支持大文件）
- [ ] 完善文件下载API（支持断点续传）
- [ ] 实现文件预览功能（图片、PDF等）
- [ ] 实现文件管理功能（列表、删除等）
- [ ] 实现文件权限控制

**测试用例：**
- [ ] 测试文件上传（小文件）
- [ ] 测试文件上传（大文件>100MB）
- [ ] 测试文件下载功能
- [ ] 测试文件预览功能（图片）
- [ ] 测试文件预览功能（PDF）
- [ ] 测试文件删除功能
- [ ] 测试文件权限控制

**验收标准：**
- ✅ 文件上传功能正常
- ✅ 文件下载功能正常
- ✅ 文件预览功能正常
- ✅ 文件管理功能正常
- ✅ 文件权限控制正常

**预计时间：** 0.5周

---

### 2.2 第二阶段：服务接口层完善（3-4周）

#### 功能点2.1：定义核心服务接口

**功能描述：** 为所有服务定义接口

**任务清单：**
- [ ] 定义部门管理服务接口（`DepartmentServiceInterface`）
- [ ] 定义系统参数服务接口（`SystemParameterServiceInterface`）
- [ ] 定义文件管理服务接口（`FileServiceInterface`）
- [ ] 定义菜单管理服务接口（`MenuServiceInterface`）
- [ ] 定义权限管理服务接口（`PermissionServiceInterface`）
- [ ] 定义编码规则服务接口（`CodeRuleServiceInterface`）
- [ ] ... 等30+个服务接口

**测试用例：**
- [ ] 测试服务接口定义完整性
- [ ] 测试服务接口方法签名正确性
- [ ] 测试服务接口继承关系正确性

**验收标准：**
- ✅ 所有服务都有接口定义
- ✅ 服务接口方法签名正确
- ✅ 服务接口继承关系正确

**预计时间：** 2周

---

#### 功能点2.2：创建服务适配器

**功能描述：** 为所有服务创建适配器实现

**任务清单：**
- [ ] 创建部门管理服务适配器（`DepartmentServiceImpl`）
- [ ] 创建系统参数服务适配器（`SystemParameterServiceImpl`）
- [ ] 创建文件管理服务适配器（`FileServiceImpl`）
- [ ] ... 等30+个服务适配器

**测试用例：**
- [ ] 测试服务适配器实现完整性
- [ ] 测试服务适配器方法实现正确性
- [ ] 测试服务适配器注册到服务注册表

**验收标准：**
- ✅ 所有服务都有适配器实现
- ✅ 服务适配器方法实现正确
- ✅ 服务适配器注册成功

**预计时间：** 2周

---

#### 功能点2.3：创建依赖注入函数

**功能描述：** 为所有服务创建依赖注入函数

**任务清单：**
- [ ] 创建部门服务依赖注入函数（`get_department_service_with_fallback`）
- [ ] 创建系统参数服务依赖注入函数（`get_system_parameter_service_with_fallback`）
- [ ] ... 等30+个依赖注入函数

**测试用例：**
- [ ] 测试依赖注入函数可用性
- [ ] 测试依赖注入函数fallback机制
- [ ] 测试依赖注入函数在API路由中使用

**验收标准：**
- ✅ 所有服务都有依赖注入函数
- ✅ 依赖注入函数fallback机制正常
- ✅ 依赖注入函数在API路由中可用

**预计时间：** 1周

---

### 2.3 第三阶段：API路由迁移（2-3周）

#### 功能点3.1：迁移核心API路由

**功能描述：** 迁移所有API路由到依赖注入模式

**任务清单：**
- [ ] 迁移用户管理API（部分已完成）
- [ ] 迁移部门管理API
- [ ] 迁移系统参数API
- [ ] 迁移文件管理API
- [ ] 迁移菜单管理API
- [ ] 迁移权限管理API
- [ ] ... 等200+个路由

**测试用例：**
- [ ] 测试每个API路由使用依赖注入
- [ ] 测试每个API路由功能正常
- [ ] 测试每个API路由性能正常

**验收标准：**
- ✅ 所有API路由都使用依赖注入
- ✅ 所有API路由功能正常
- ✅ 所有API路由性能正常

**预计时间：** 2-3周

---

### 2.4 第四阶段：MES系统针对性能力建设（4-6周）

#### 功能点4.1：实时数据推送机制

**功能描述：** 实现WebSocket/SSE实时数据推送

**任务清单：**
- [ ] 实现WebSocket服务器端（FastAPI）
- [ ] 实现WebSocket客户端（React）
- [ ] 实现数据推送机制
- [ ] 实现断线重连机制
- [ ] 实现消息队列（可选）

**测试用例：**
- [ ] 测试WebSocket连接建立
- [ ] 测试数据推送功能
- [ ] 测试断线重连功能
- [ ] 测试多客户端连接
- [ ] 测试消息队列功能（可选）

**验收标准：**
- ✅ WebSocket连接正常
- ✅ 数据推送功能正常
- ✅ 断线重连功能正常
- ✅ 支持多客户端连接

**Inngest工作流：**
- ⚠️ 可选：数据推送异步任务（大数据量场景）

**预计时间：** 1-2周

---

#### 功能点4.2：大数据量查询优化

**功能描述：** 优化大数据量查询性能

**任务清单：**
- [ ] 分析慢查询日志
- [ ] 优化数据库索引
- [ ] 实现游标分页
- [ ] 实现查询缓存
- [ ] 性能测试和优化

**测试用例：**
- [ ] 测试数据库索引优化效果
- [ ] 测试游标分页性能
- [ ] 测试查询缓存命中率
- [ ] 测试大数据量查询性能（10万+记录）

**验收标准：**
- ✅ 数据库索引优化完成
- ✅ 游标分页性能提升50%+
- ✅ 查询缓存命中率>80%
- ✅ 大数据量查询性能满足要求

**预计时间：** 1-2周

---

#### 功能点4.3：流程引擎增强

**功能描述：** 增强审批流程引擎，支持复杂业务流程

**任务清单：**
- [ ] 扩展流程模型（支持条件分支、并行流程）
- [ ] 实现流程执行引擎
- [ ] 实现流程可视化设计器
- [ ] 实现流程监控和统计

**测试用例：**
- [ ] 测试条件分支流程
- [ ] 测试并行流程
- [ ] 测试流程可视化设计器
- [ ] 测试流程监控和统计

**验收标准：**
- ✅ 支持条件分支流程
- ✅ 支持并行流程
- ✅ 流程可视化设计器可用
- ✅ 流程监控和统计正常

**Inngest工作流：**
- ✅ 必需：流程执行工作流（`approval_workflow_function`）

**预计时间：** 2-3周

---

#### 功能点4.4：报表系统增强

**功能描述：** 增强报表配置和导出功能

**任务清单：**
- [ ] 实现报表设计器
- [ ] 实现报表引擎
- [ ] 实现报表导出（Excel、PDF）
- [ ] 实现报表模板管理
- [ ] 实现报表调度

**测试用例：**
- [ ] 测试报表设计器功能
- [ ] 测试报表引擎功能
- [ ] 测试报表导出（Excel）
- [ ] 测试报表导出（PDF）
- [ ] 测试报表模板管理
- [ ] 测试报表调度功能

**验收标准：**
- ✅ 报表设计器可用
- ✅ 报表引擎功能正常
- ✅ 报表导出功能正常
- ✅ 报表模板管理正常
- ✅ 报表调度功能正常

**Inngest工作流：**
- ✅ 必需：报表生成工作流（异步生成大报表）

**预计时间：** 2-3周

---

## 3. 应用级功能点清单（快智造）

### 3.1 MVP阶段功能点（6周）

#### 功能点M1.1：基础架构搭建

**功能描述：** 搭建快智造应用基础架构

**任务清单：**
- [ ] 创建应用目录结构
- [ ] 注册应用到系统（Application模型）
- [ ] 创建应用路由注册
- [ ] 创建应用菜单配置（`manifest.json`）
- [ ] 创建核心数据模型（WorkOrder、WorkOrderProcess、WorkReport、Inventory、StockIn、StockOut）
- [ ] 创建数据库迁移脚本
- [ ] 集成 master_data API（调用基础数据）

**测试用例：**
- [ ] 测试应用注册成功
- [ ] 测试应用路由注册成功
- [ ] 测试应用菜单加载成功
- [ ] 测试数据模型创建成功
- [ ] 测试数据库迁移成功
- [ ] 测试 master_data API调用成功

**验收标准：**
- ✅ 应用注册成功
- ✅ 应用路由注册成功
- ✅ 应用菜单加载成功
- ✅ 数据模型创建成功
- ✅ 数据库迁移成功
- ✅ master_data API调用成功

**预计时间：** 0.5周

---

#### 功能点M1.2：基础数据API集成

**功能描述：** 集成主数据管理APP的基础数据API（只读）

**任务清单：**
- [ ] 创建 master_data API 客户端服务（只读调用）
- [ ] 实现工厂/车间/工作中心数据获取接口
- [ ] 实现物料/BOM数据获取接口
- [ ] 实现仓库数据获取接口
- [ ] 前端页面：基础数据选择组件（下拉选择、树形选择）
- [ ] 前端页面：基础数据展示组件（只读展示）
- [ ] 前端页面：提供跳转链接到 master_data 应用进行基础数据管理

**测试用例：**
- [ ] 测试工厂/车间/工作中心数据获取
- [ ] 测试物料/BOM数据获取
- [ ] 测试仓库数据获取
- [ ] 测试基础数据选择组件
- [ ] 测试基础数据展示组件
- [ ] 测试跳转链接功能

**验收标准：**
- ✅ master_data API客户端服务可用
- ✅ 基础数据获取功能正常
- ✅ 基础数据选择组件可用
- ✅ 基础数据展示组件可用
- ✅ 跳转链接功能正常

**预计时间：** 0.5周

---

#### 功能点M1.3：工单管理

**功能描述：** 实现工单管理核心功能

**任务清单：**
- [ ] 工单管理API（创建、下达、查询、状态更新）
- [ ] 工单工序管理API
- [ ] 工单号自动生成（基于编码规则）
- [ ] 前端页面：工单列表（使用UniTable + 高级搜索）
- [ ] 前端页面：工单创建/编辑（选择物料、车间、工作中心）
- [ ] 前端页面：工单详情
- [ ] 工单状态流转逻辑（创建→下达→执行→完工）
- [ ] 工单二维码生成（用于扫码报工）

**测试用例：**
- [ ] 测试工单创建功能
- [ ] 测试工单下达功能
- [ ] 测试工单查询功能（列表、详情）
- [ ] 测试工单状态更新功能
- [ ] 测试工单号自动生成功能
- [ ] 测试工单状态流转逻辑
- [ ] 测试工单二维码生成功能
- [ ] 测试工单列表高级搜索功能
- [ ] 测试工单批量导入功能（使用UniSheet）

**验收标准：**
- ✅ 工单CRUD功能正常
- ✅ 工单状态流转正常
- ✅ 工单号自动生成正常
- ✅ 工单二维码生成正常
- ✅ 工单列表高级搜索可用
- ✅ 工单批量导入可用

**Inngest工作流：**
- ✅ 必需：工单状态流转工作流（异步处理状态变更）
- ⚠️ 可选：工单批量导入工作流（大数据量导入）

**预计时间：** 1.5周

---

#### 功能点M1.4：报工管理

**功能描述：** 实现报工管理功能

**任务清单：**
- [ ] 报工API（扫码报工、进度汇报）
- [ ] 报工记录查询API
- [ ] 前端页面：报工界面（支持扫码，移动端优化）
- [ ] 前端页面：报工记录查询（使用UniTable + 高级搜索）
- [ ] 报工后自动更新工单进度
- [ ] 工单完工自动判断（所有工序完成）

**测试用例：**
- [ ] 测试扫码报工功能
- [ ] 测试进度汇报功能
- [ ] 测试报工记录查询功能
- [ ] 测试报工后工单进度更新
- [ ] 测试工单完工自动判断
- [ ] 测试报工记录高级搜索功能
- [ ] 测试报工记录批量导入功能（使用UniSheet）

**验收标准：**
- ✅ 报工功能正常
- ✅ 报工记录查询正常
- ✅ 工单进度自动更新正常
- ✅ 工单完工自动判断正常
- ✅ 报工记录高级搜索可用
- ✅ 报工记录批量导入可用

**Inngest工作流：**
- ✅ 必需：报工数据处理工作流（异步处理报工数据）
- ✅ 必需：工单进度更新工作流（异步更新工单进度）

**预计时间：** 1周

---

#### 功能点M1.5：仓储管理

**功能描述：** 实现基础仓储管理功能

**任务清单：**
- [ ] 库存管理API（查询、更新）
- [ ] 入库单API（创建、查询）
- [ ] 出库单API（创建、查询）
- [ ] 前端页面：库存查询（使用UniTable + 高级搜索）
- [ ] 前端页面：入库单管理（使用UniTable + 高级搜索）
- [ ] 前端页面：出库单管理（使用UniTable + 高级搜索）
- [ ] 生产领料功能（关联工单，根据BOM生成领料需求）
- [ ] 成品入库功能（关联工单）
- [ ] 库存自动更新（入库/出库后更新库存）

**测试用例：**
- [ ] 测试库存查询功能
- [ ] 测试库存更新功能
- [ ] 测试入库单创建功能
- [ ] 测试出库单创建功能
- [ ] 测试生产领料功能
- [ ] 测试成品入库功能
- [ ] 测试库存自动更新功能
- [ ] 测试库存查询高级搜索功能
- [ ] 测试入库单批量导入功能（使用UniSheet）
- [ ] 测试出库单批量导入功能（使用UniSheet）

**验收标准：**
- ✅ 库存管理功能正常
- ✅ 入库单管理功能正常
- ✅ 出库单管理功能正常
- ✅ 生产领料功能正常
- ✅ 成品入库功能正常
- ✅ 库存自动更新正常
- ✅ 库存查询高级搜索可用
- ✅ 入库单批量导入可用
- ✅ 出库单批量导入可用

**Inngest工作流：**
- ✅ 必需：库存更新工作流（异步更新库存）
- ⚠️ 可选：库存盘点工作流（定时盘点）

**预计时间：** 1周

---

#### 功能点M1.6：生产看板

**功能描述：** 实现生产看板功能

**任务清单：**
- [ ] 生产看板API（工单进度、状态统计）
- [ ] 前端页面：生产看板（实时数据展示）
- [ ] 工单进度可视化（进度条、状态卡片）
- [ ] 关键指标统计（进行中工单数、完工工单数、延期工单数）

**测试用例：**
- [ ] 测试生产看板API功能
- [ ] 测试工单进度可视化
- [ ] 测试关键指标统计
- [ ] 测试实时数据更新（WebSocket）

**验收标准：**
- ✅ 生产看板API功能正常
- ✅ 工单进度可视化正常
- ✅ 关键指标统计正常
- ✅ 实时数据更新正常

**Inngest工作流：**
- ✅ 必需：看板数据更新工作流（定时更新看板数据）

**预计时间：** 0.5周

---

#### 功能点M1.7：测试与优化

**功能描述：** 测试MVP功能，优化用户体验

**任务清单：**
- [ ] 功能测试（所有功能点）
- [ ] 性能测试（大数据量场景）
- [ ] 移动端测试（报工界面）
- [ ] 用户体验优化
- [ ] 文档编写（用户手册、API文档）
- [ ] 示例数据准备

**测试用例：**
- [ ] 端到端测试（完整业务流程）
- [ ] 性能测试（并发用户、大数据量）
- [ ] 移动端测试（报工界面）
- [ ] 用户体验测试

**验收标准：**
- ✅ 所有功能测试通过
- ✅ 性能测试满足要求
- ✅ 移动端测试通过
- ✅ 用户体验良好
- ✅ 文档完整

**预计时间：** 1周

---

### 3.2 第一阶段扩展功能点（8-10周）

#### 功能点M2.1：需求管理

**功能描述：** 实现MTS/MTO需求管理

**任务清单：**
- [ ] 销售预测API（MTS模式）
- [ ] 销售订单API（MTO模式）
- [ ] 前端页面：销售预测管理（使用UniTable + 高级搜索）
- [ ] 前端页面：销售订单管理（使用UniTable + 高级搜索）
- [ ] 需求数据导入功能（Excel导入，使用UniSheet）

**测试用例：**
- [ ] 测试销售预测CRUD功能
- [ ] 测试销售订单CRUD功能
- [ ] 测试销售预测高级搜索功能
- [ ] 测试销售订单高级搜索功能
- [ ] 测试需求数据导入功能（使用UniSheet）

**验收标准：**
- ✅ 销售预测管理功能正常
- ✅ 销售订单管理功能正常
- ✅ 需求数据导入功能正常

**Inngest工作流：**
- ⚠️ 可选：需求数据导入工作流（大数据量导入）

**预计时间：** 2周

---

#### 功能点M2.2：计划排程（MRP/LRP运算）

**功能描述：** 实现MRP/LRP运算

**任务清单：**
- [ ] MRP运算引擎（根据销售预测和库存计算物料需求）
- [ ] LRP运算引擎（根据销售订单计算批次需求）
- [ ] MRP结果API
- [ ] LRP结果API
- [ ] 前端页面：MRP运算界面
- [ ] 前端页面：LRP运算界面
- [ ] 前端页面：MRP/LRP结果展示
- [ ] 自动生成工单建议（根据MRP/LRP结果）
- [ ] 自动生成采购建议（根据MRP/LRP结果）

**测试用例：**
- [ ] 测试MRP运算功能
- [ ] 测试LRP运算功能
- [ ] 测试MRP结果展示
- [ ] 测试LRP结果展示
- [ ] 测试工单建议生成
- [ ] 测试采购建议生成
- [ ] 测试MRP/LRP运算性能（大数据量）

**验收标准：**
- ✅ MRP运算功能正常
- ✅ LRP运算功能正常
- ✅ 工单建议生成正常
- ✅ 采购建议生成正常
- ✅ MRP/LRP运算性能满足要求

**Inngest工作流：**
- ✅ 必需：MRP运算工作流（异步执行MRP运算）
- ✅ 必需：LRP运算工作流（异步执行LRP运算）

**预计时间：** 3周

---

#### 功能点M2.3：高级排产

**功能描述：** 实现可视化排产

**任务清单：**
- [ ] 排产计划API
- [ ] 排产甘特图API（获取排产数据）
- [ ] 前端页面：排产甘特图（可视化排程）
- [ ] 拖拽调整排产计划
- [ ] 工作中心能力检查

**测试用例：**
- [ ] 测试排产计划创建功能
- [ ] 测试排产甘特图展示功能
- [ ] 测试拖拽调整排产计划功能
- [ ] 测试工作中心能力检查功能

**验收标准：**
- ✅ 排产计划功能正常
- ✅ 排产甘特图展示正常
- ✅ 拖拽调整排产计划正常
- ✅ 工作中心能力检查正常

**Inngest工作流：**
- ⚠️ 可选：排产计划优化工作流（自动优化排产计划）

**预计时间：** 2周

---

#### 功能点M2.4：采购管理

**功能描述：** 实现采购管理功能

**任务清单：**
- [ ] 采购单API
- [ ] 前端页面：采购单管理（使用UniTable + 高级搜索）
- [ ] 根据MRP/LRP采购建议生成采购单
- [ ] 采购入库功能（关联采购单）

**测试用例：**
- [ ] 测试采购单CRUD功能
- [ ] 测试采购单高级搜索功能
- [ ] 测试根据MRP/LRP建议生成采购单
- [ ] 测试采购入库功能
- [ ] 测试采购单批量导入功能（使用UniSheet）

**验收标准：**
- ✅ 采购单管理功能正常
- ✅ 采购单高级搜索可用
- ✅ 采购单批量导入可用

**Inngest工作流：**
- ⚠️ 可选：采购单批量导入工作流（大数据量导入）

**预计时间：** 1.5周

---

#### 功能点M2.5：销售出库

**功能描述：** 实现销售出库功能

**任务清单：**
- [ ] 销售出库API（MTO关联订单，MTS从库存发货）
- [ ] 前端页面：销售出库管理（使用UniTable + 高级搜索）
- [ ] MTO订单专属库存管理
- [ ] 生产退料功能

**测试用例：**
- [ ] 测试销售出库功能（MTO模式）
- [ ] 测试销售出库功能（MTS模式）
- [ ] 测试MTO订单专属库存管理
- [ ] 测试生产退料功能
- [ ] 测试销售出库高级搜索功能

**验收标准：**
- ✅ 销售出库功能正常
- ✅ MTO订单专属库存管理正常
- ✅ 生产退料功能正常

**预计时间：** 1周

---

#### 功能点M2.6：设备看板

**功能描述：** 实现设备看板功能

**任务清单：**
- [ ] 设备看板API（设备状态监控）
- [ ] 前端页面：设备看板
- [ ] 设备状态实时更新

**测试用例：**
- [ ] 测试设备看板API功能
- [ ] 测试设备状态实时更新（WebSocket）

**验收标准：**
- ✅ 设备看板功能正常
- ✅ 设备状态实时更新正常

**预计时间：** 0.5周

---

### 3.3 第二阶段扩展功能点（6-8周）

#### 功能点M3.1：质量管理

**功能描述：** 实现完整的质量管理功能

**任务清单：**
- [ ] 来料检验API
- [ ] 过程检验API
- [ ] 成品检验API
- [ ] 前端页面：来料检验管理（使用UniTable + 高级搜索）
- [ ] 前端页面：过程检验管理（使用UniTable + 高级搜索）
- [ ] 前端页面：成品检验管理（使用UniTable + 高级搜索）
- [ ] 检验结果关联库存（合格/不合格分别处理）
- [ ] 不良品处理流程

**测试用例：**
- [ ] 测试来料检验功能
- [ ] 测试过程检验功能
- [ ] 测试成品检验功能
- [ ] 测试检验结果关联库存
- [ ] 测试不良品处理流程
- [ ] 测试检验记录高级搜索功能
- [ ] 测试检验记录批量导入功能（使用UniSheet）

**验收标准：**
- ✅ 质量管理功能正常
- ✅ 检验结果关联库存正常
- ✅ 不良品处理流程正常

**Inngest工作流：**
- ✅ 必需：检验数据处理工作流（异步处理检验数据）
- ✅ 必需：不良品处理工作流（异步处理不良品）

**预计时间：** 3周

---

#### 功能点M3.2：财务协同

**功能描述：** 实现财务协同功能

**任务清单：**
- [ ] 应付管理API
- [ ] 应收管理API
- [ ] 前端页面：应付管理（使用UniTable + 高级搜索）
- [ ] 前端页面：应收管理（使用UniTable + 高级搜索）
- [ ] 自动生成应付单（采购入库后）
- [ ] 自动生成应收单（销售出库后）

**测试用例：**
- [ ] 测试应付管理功能
- [ ] 测试应收管理功能
- [ ] 测试自动生成应付单
- [ ] 测试自动生成应收单
- [ ] 测试应付/应收高级搜索功能

**验收标准：**
- ✅ 财务协同功能正常
- ✅ 自动生成应付单正常
- ✅ 自动生成应收单正常

**Inngest工作流：**
- ✅ 必需：应付单生成工作流（异步生成应付单）
- ✅ 必需：应收单生成工作流（异步生成应收单）

**预计时间：** 2周

---

#### 功能点M3.3：高级报表

**功能描述：** 实现高级报表功能

**任务清单：**
- [ ] 库存周转率分析API
- [ ] 工单绩效分析API
- [ ] 质量合格率统计API
- [ ] 前端页面：库存报表
- [ ] 前端页面：生产报表
- [ ] 前端页面：质量报表
- [ ] 报表导出功能（Excel、PDF）

**测试用例：**
- [ ] 测试库存周转率分析功能
- [ ] 测试工单绩效分析功能
- [ ] 测试质量合格率统计功能
- [ ] 测试报表导出功能（Excel）
- [ ] 测试报表导出功能（PDF）

**验收标准：**
- ✅ 高级报表功能正常
- ✅ 报表导出功能正常

**Inngest工作流：**
- ✅ 必需：报表生成工作流（异步生成大报表）

**预计时间：** 2周

---

## 4. 应用级功能点清单（主数据管理）

### 4.1 MVP支持优化功能点（2周）

#### 功能点D1.1：批量查询接口

**功能描述：** 添加批量查询接口（根据UUID列表批量获取）

**任务清单：**
- [ ] 实现物料批量查询接口（`POST /api/v1/apps/master-data/materials/batch`）
- [ ] 实现车间批量查询接口（`POST /api/v1/apps/master-data/factory/workshops/batch`）
- [ ] 实现产线批量查询接口（`POST /api/v1/apps/master-data/factory/production-lines/batch`）
- [ ] 实现仓库批量查询接口（`POST /api/v1/apps/master-data/warehouse/warehouses/batch`）

**测试用例：**
- [ ] 测试物料批量查询（10个UUID）
- [ ] 测试物料批量查询（100个UUID）
- [ ] 测试车间批量查询
- [ ] 测试产线批量查询
- [ ] 测试仓库批量查询
- [ ] 测试批量查询性能

**验收标准：**
- ✅ 批量查询接口可用
- ✅ 批量查询性能满足要求（<500ms for 100 UUIDs）

**预计时间：** 0.5周

---

#### 功能点D1.2：简化查询接口

**功能描述：** 添加简化查询接口（只返回必要字段）

**任务清单：**
- [ ] 实现物料简化查询接口（`GET /api/v1/apps/master-data/materials/simple`）
- [ ] 实现车间简化查询接口（`GET /api/v1/apps/master-data/factory/workshops/simple`）
- [ ] 实现产线简化查询接口（`GET /api/v1/apps/master-data/factory/production-lines/simple`）
- [ ] 实现仓库简化查询接口（`GET /api/v1/apps/master-data/warehouse/warehouses/simple`）

**测试用例：**
- [ ] 测试物料简化查询功能
- [ ] 测试车间简化查询功能
- [ ] 测试产线简化查询功能
- [ ] 测试仓库简化查询功能
- [ ] 测试简化查询性能（对比完整查询）

**验收标准：**
- ✅ 简化查询接口可用
- ✅ 简化查询性能提升50%+

**预计时间：** 0.5周

---

#### 功能点D1.3：BOM查询优化

**功能描述：** 优化BOM查询接口

**任务清单：**
- [ ] 实现BOM多层级展开接口（`GET /api/v1/apps/master-data/materials/bom/expand/{material_uuid}`）
- [ ] 实现BOM扁平化展开接口（`GET /api/v1/apps/master-data/materials/bom/flatten/{material_uuid}`）
- [ ] 优化BOM查询性能

**测试用例：**
- [ ] 测试BOM多层级展开功能
- [ ] 测试BOM扁平化展开功能
- [ ] 测试BOM查询性能（10层BOM）

**验收标准：**
- ✅ BOM查询优化接口可用
- ✅ BOM查询性能满足要求

**预计时间：** 0.5周

---

#### 功能点D1.4：数据验证接口完善

**功能描述：** 完善数据验证接口

**任务清单：**
- [ ] 完善工单数据验证接口（`GET /api/v1/apps/master-data/validation/work-order-data-integrity`）
- [ ] 添加Material存在性验证
- [ ] 添加BOM存在性验证
- [ ] 添加Workshop和ProductionLine存在性验证
- [ ] 添加Warehouse存在性验证

**测试用例：**
- [ ] 测试Material存在性验证
- [ ] 测试BOM存在性验证
- [ ] 测试Workshop和ProductionLine存在性验证
- [ ] 测试Warehouse存在性验证
- [ ] 测试完整数据验证流程

**验收标准：**
- ✅ 数据验证接口完善
- ✅ 所有验证逻辑正确

**预计时间：** 0.5周

---

## 5. 测试策略

### 5.1 单元测试

**要求：**
- 每个功能点完成后立即编写单元测试
- 单元测试覆盖率>80%
- 使用pytest框架

**测试文件结构：**
```
tests/
├── unit/
│   ├── services/
│   │   ├── test_work_order_service.py
│   │   └── ...
│   ├── api/
│   │   ├── test_work_orders.py
│   │   └── ...
│   └── models/
│       ├── test_work_order.py
│       └── ...
```

### 5.2 集成测试

**要求：**
- 每个功能模块完成后编写集成测试
- 测试API端到端流程
- 使用pytest + httpx

**测试文件结构：**
```
tests/
├── integration/
│   ├── test_work_order_flow.py
│   ├── test_inventory_flow.py
│   └── ...
```

### 5.3 端到端测试

**要求：**
- 关键业务流程完成后编写端到端测试
- 测试完整业务流程
- 使用pytest + playwright（可选）

**测试场景：**
- 工单创建→下达→报工→完工→入库
- 销售预测→MRP运算→工单生成
- 销售订单→LRP运算→工单生成

---

## 6. Inngest工作流设计

### 6.1 工作流分类

#### 异步任务工作流
- **用途：** 处理耗时操作，避免阻塞API响应
- **示例：** MRP/LRP运算、报表生成、数据导入

#### 定时任务工作流
- **用途：** 定时执行任务
- **示例：** 看板数据更新、库存盘点、报表调度

#### 事件驱动工作流
- **用途：** 响应业务事件
- **示例：** 工单状态流转、库存更新、报工数据处理

### 6.2 工作流设计原则

1. **幂等性：** 工作流必须支持重复执行
2. **可重试：** 工作流失败后可以重试
3. **可监控：** 工作流执行状态可监控
4. **可回滚：** 工作流失败后可以回滚

### 6.3 工作流实现规范

**工作流函数命名：**
- `{功能}_workflow_function` - 主工作流
- `{功能}_action_workflow_function` - 动作工作流

**工作流注册：**
```python
from core.inngest.functions import register_workflow

@register_workflow
async def work_order_status_workflow_function(event: InngestEvent):
    # 工作流逻辑
    pass
```

---

## 7. 开发流程

### 7.1 功能点开发流程

1. **需求分析**
   - 明确功能点需求
   - 确定测试用例
   - 确定Inngest工作流需求

2. **设计**
   - 设计API接口
   - 设计数据模型
   - 设计工作流

3. **开发**
   - 实现后端API
   - 实现前端页面
   - 实现Inngest工作流（如需要）

4. **测试**
   - 编写单元测试
   - 编写集成测试
   - 执行测试用例

5. **验收**
   - 功能验收
   - 性能验收
   - 用户体验验收

6. **文档**
   - 更新API文档
   - 更新用户手册
   - 更新开发文档

### 7.2 测试流程

1. **单元测试**
   - 功能点完成后立即编写
   - 覆盖率>80%
   - 所有测试通过

2. **集成测试**
   - 功能模块完成后编写
   - 测试API端到端流程
   - 所有测试通过

3. **端到端测试**
   - 关键业务流程完成后编写
   - 测试完整业务流程
   - 所有测试通过

---

## 8. 质量保证

### 8.1 代码质量

- ✅ 所有代码通过Ruff检查
- ✅ 所有代码通过MyPy类型检查
- ✅ 所有代码通过Black格式化
- ✅ 所有代码有文件头注释

### 8.2 功能质量

- ✅ 所有功能点有测试用例
- ✅ 所有测试用例通过
- ✅ 所有功能点有文档
- ✅ 所有功能点有验收标准

### 8.3 性能质量

- ✅ API响应时间<2秒
- ✅ 大数据量查询性能满足要求
- ✅ 并发用户支持50+
- ✅ 系统稳定性>99%

---

## 9. 总结

### 9.1 功能点统计

**系统级功能点：** 15个
**快智造功能点：** 20个
**主数据管理功能点：** 4个
**总计：** 39个功能点

### 9.2 测试用例统计

**单元测试：** 200+个
**集成测试：** 50+个
**端到端测试：** 10+个

### 9.3 Inngest工作流统计

**必需工作流：** 15个
**可选工作流：** 8个
**总计：** 23个工作流

---

**文档创建时间：** 2025-12-27  
**文档作者：** Luigi Lu  
**预计完成时间：** 2026-06-15


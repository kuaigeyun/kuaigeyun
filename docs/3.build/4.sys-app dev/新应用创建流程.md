# æ–°åº”ç”¨åˆ›å»ºæµç¨‹æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è®°å½•äº†åœ¨ RiverEdge SaaS ç³»ç»Ÿä¸­åˆ›å»ºæ–°åº”ç”¨çš„å®Œæ•´æµç¨‹ï¼Œä»¥"å¿«æ ¼è½»åˆ¶é€ "åº”ç”¨ä¸ºä¾‹ã€‚

**åˆ›å»ºæ—¶é—´**: 2025-12-29
**åˆ›å»ºè€…**: Luigi Lu
**åº”ç”¨ç¤ºä¾‹**: å¿«æ ¼è½»åˆ¶é€  (kuaizhizao)

---

## ğŸ¯ åº”ç”¨åˆ›å»ºæ­¥éª¤

### æ­¥éª¤1: è§„åˆ’åº”ç”¨ç»“æ„

#### 1.1 å®šä¹‰åº”ç”¨ä¿¡æ¯
```json
{
  "name": "å¿«æ ¼è½»åˆ¶é€ ",
  "code": "kuaizhizao",
  "version": "1.0.0",
  "description": "è½»é‡çº§MESç³»ç»Ÿï¼Œä¸“æ³¨ç”Ÿäº§æ‰§è¡Œæ ¸å¿ƒæµç¨‹",
  "icon": "production",
  "sort_order": 980
}
```

#### 1.2 è®¾è®¡èœå•ç»“æ„
```json
{
  "title": "å¿«æ ¼è½»åˆ¶é€ ",
  "icon": "production",
  "path": "/apps/kuaizhizao",
  "children": [
    {
      "title": "ç”Ÿäº§æ‰§è¡Œ",
      "icon": "factory",
      "sort_order": 1,
      "children": [
        {
          "title": "å·¥å•ç®¡ç†",
          "path": "/apps/kuaizhizao/production-execution/work-orders",
          "permission": "kuaizhizao:work-order:view"
        },
        {
          "title": "æŠ¥å·¥ç®¡ç†",
          "path": "/apps/kuaizhizao/production-execution/reporting",
          "permission": "kuaizhizao:reporting:view"
        }
      ]
    }
  ]
}
```

#### 1.3 å®šä¹‰æƒé™åˆ—è¡¨
```json
[
  "kuaizhizao:work-order:view",
  "kuaizhizao:work-order:create",
  "kuaizhizao:work-order:update",
  "kuaizhizao:work-order:delete",
  "kuaizhizao:reporting:view",
  "kuaizhizao:reporting:create",
  "kuaizhizao:reporting:update",
  "kuaizhizao:reporting:delete"
]
```

---

### æ­¥éª¤2: åˆ›å»ºå‰ç«¯åº”ç”¨ç»“æ„

#### 2.1 åˆ›å»ºåº”ç”¨ç›®å½•
```bash
# åˆ›å»ºåº”ç”¨æ ¹ç›®å½•
mkdir -p riveredge-frontend/src/apps/kuaizhizao

# åˆ›å»ºå­ç›®å½•ç»“æ„
mkdir -p riveredge-frontend/src/apps/kuaizhizao/pages/production-execution/{work-orders,reporting}
mkdir -p riveredge-frontend/src/apps/kuaizhizao/services
mkdir -p riveredge-frontend/src/apps/kuaizhizao/types
mkdir -p riveredge-frontend/src/apps/kuaizhizao/components
```

#### 2.2 åˆ›å»ºåº”ç”¨å…¥å£æ–‡ä»¶ (`index.tsx`)
```typescript
import React from 'react';
import { Routes, Route } from 'react-router-dom';

// ç”Ÿäº§æ‰§è¡Œé¡µé¢
import WorkOrdersPage from './pages/production-execution/work-orders';
import ReportingPage from './pages/production-execution/reporting';

const KuaizhizaoApp: React.FC = () => {
  return (
    <Routes>
      {/* ç”Ÿäº§æ‰§è¡Œè·¯ç”± */}
      <Route path="production-execution/work-orders" element={<WorkOrdersPage />} />
      <Route path="production-execution/reporting" element={<ReportingPage />} />

      {/* é»˜è®¤è·¯ç”± - åº”ç”¨é¦–é¡µ */}
      <Route path="" element={
        <div style={{ padding: '24px', textAlign: 'center' }}>
          <h2>å¿«æ ¼è½»åˆ¶é€ </h2>
          <p>è½»é‡çº§MESç³»ç»Ÿ - ä¸“æ³¨ç”Ÿäº§æ‰§è¡Œæ ¸å¿ƒæµç¨‹</p>
        </div>
      } />
    </Routes>
  );
};

export default KuaizhizaoApp;
```

#### 2.3 åˆ›å»ºé¡µé¢ç»„ä»¶

**å·¥å•ç®¡ç†é¡µé¢** (`pages/production-execution/work-orders/index.tsx`):
- å·¥å•åˆ—è¡¨å±•ç¤ºï¼ˆUniTableç»„ä»¶ï¼‰
- æ–°å»º/ç¼–è¾‘/åˆ é™¤åŠŸèƒ½
- å·¥å•è¯¦æƒ…æŸ¥çœ‹ï¼ˆDrawerï¼‰
- çŠ¶æ€ç®¡ç†ï¼ˆè‰ç¨¿/å·²ä¸‹è¾¾/ç”Ÿäº§ä¸­/å·²å®Œæˆ/å·²å–æ¶ˆï¼‰

**æŠ¥å·¥ç®¡ç†é¡µé¢** (`pages/production-execution/reporting/index.tsx`):
- æŠ¥å·¥ç»Ÿè®¡çœ‹æ¿ï¼ˆä»Šæ—¥æŠ¥å·¥æ•°ã€åˆæ ¼ç‡ç­‰ï¼‰
- æŠ¥å·¥è®°å½•åˆ—è¡¨
- æ‰‹åŠ¨æŠ¥å·¥å’Œæ‰«ç æŠ¥å·¥åŠŸèƒ½
- æŠ¥å·¥å®¡æ ¸åŠŸèƒ½

#### 2.4 åˆ›å»ºæœåŠ¡å±‚ (`services/production.ts`)
```typescript
// å·¥å•ç›¸å…³API
export const workOrderApi = {
  list: async (params?: any) => api.get('/apps/kuaizhizao/production/work-orders', { params }),
  create: async (data: any) => api.post('/apps/kuaizhizao/production/work-orders', data),
  update: async (id: string, data: any) => api.put(`/apps/kuaizhizao/production/work-orders/${id}`, data),
  delete: async (id: string) => api.delete(`/apps/kuaizhizao/production/work-orders/${id}`),
  get: async (id: string) => api.get(`/apps/kuaizhizao/production/work-orders/${id}`),
  release: async (id: string) => api.post(`/apps/kuaizhizao/production/work-orders/${id}/release`),
};

// æŠ¥å·¥ç›¸å…³API
export const reportingApi = {
  list: async (params?: any) => api.get('/apps/kuaizhizao/production/reporting', { params }),
  create: async (data: any) => api.post('/apps/kuaizhizao/production/reporting', data),
  approve: async (id: string, data: any) => api.post(`/apps/kuaizhizao/production/reporting/${id}/approve`, data),
  reject: async (id: string, data: any) => api.post(`/apps/kuaizhizao/production/reporting/${id}/reject`, data),
  getStatistics: async (params?: any) => api.get('/apps/kuaizhizao/production/reporting/statistics', { params }),
};
```

#### 2.5 åˆ›å»ºç±»å‹å®šä¹‰ (`types/production.ts`)
```typescript
// å·¥å•ç›¸å…³ç±»å‹
export interface WorkOrder {
  id: number;
  code: string;
  name: string;
  productName: string;
  quantity: number;
  status: WorkOrderStatus;
  productionMode: ProductionMode;
  startDate?: string;
  endDate?: string;
  createdAt: string;
}

// æŠ¥å·¥ç›¸å…³ç±»å‹
export interface ReportingRecord {
  id: number;
  workOrderCode: string;
  workOrderName: string;
  operationName: string;
  workerName: string;
  reportedQuantity: number;
  qualifiedQuantity: number;
  unqualifiedQuantity: number;
  workHours: number;
  status: ReportingStatus;
  reportedAt: string;
}
```

#### 2.6 åˆ›å»ºmanifest.jsoné…ç½®æ–‡ä»¶
```json
{
  "name": "å¿«æ ¼è½»åˆ¶é€ ",
  "code": "kuaizhizao",
  "version": "1.0.0",
  "description": "è½»é‡çº§MESç³»ç»Ÿï¼Œä¸“æ³¨ç”Ÿäº§æ‰§è¡Œæ ¸å¿ƒæµç¨‹",
  "icon": "production",
  "author": "RiverEdge Team",
  "entry_point": "../apps/kuaizhizao/index.tsx",
  "route_path": "/apps/kuaizhizao",
  "sort_order": 980,
  "menu_config": {
    "title": "å¿«æ ¼è½»åˆ¶é€ ",
    "icon": "production",
    "path": "/apps/kuaizhizao",
    "children": [
      {
        "title": "ç”Ÿäº§æ‰§è¡Œ",
        "icon": "factory",
        "sort_order": 1,
        "children": [
          {
            "title": "å·¥å•ç®¡ç†",
            "path": "/apps/kuaizhizao/production-execution/work-orders",
            "permission": "kuaizhizao:work-order:view",
            "sort_order": 1
          },
          {
            "title": "æŠ¥å·¥ç®¡ç†",
            "path": "/apps/kuaizhizao/production-execution/reporting",
            "permission": "kuaizhizao:reporting:view",
            "sort_order": 2
          }
        ]
      }
    ]
  },
  "permissions": [
    "kuaizhizao:work-order:view",
    "kuaizhizao:work-order:create",
    "kuaizhizao:work-order:update",
    "kuaizhizao:work-order:delete",
    "kuaizhizao:reporting:view",
    "kuaizhizao:reporting:create",
    "kuaizhizao:reporting:update",
    "kuaizhizao:reporting:delete"
  ],
  "dependencies": {
    "riveredge-backend": ">=1.0.0",
    "riveredge-frontend": ">=1.0.0"
  }
}
```

---

### æ­¥éª¤3: é…ç½®åº”ç”¨è·¯ç”±

#### 3.1 æ›´æ–°AppRoutes.tsx
åœ¨ `riveredge-frontend/src/routes/AppRoutes.tsx` ä¸­æ·»åŠ ç¡¬ç¼–ç è·¯ç”±ï¼š

```typescript
// ğŸ”§ å¼€å‘é˜¶æ®µï¼šç¡¬ç¼–ç æ·»åŠ å¿«æ ¼è½»åˆ¶é€ APPè·¯ç”±
try {
  const { default: KuaizhizaoApp } = await import('../apps/kuaizhizao');
  routes.push(
    <Route
      key="app-kuaizhizao"
      path="kuaizhizao/*"
      element={
        <BasicLayout>
          <Suspense fallback={<LoadingFallback />}>
            <AppErrorBoundary appName="å¿«æ ¼è½»åˆ¶é€ ">
              <KuaizhizaoApp />
            </AppErrorBoundary>
          </Suspense>
        </BasicLayout>
      }
    />
  );
} catch (appError) {
  console.error('âŒ å¿«æ ¼è½»åˆ¶é€ APPåŠ è½½å¤±è´¥:', appError);
}
```

---

### æ­¥éª¤4: åœ¨åº”ç”¨ä¸­å¿ƒæ³¨å†Œåº”ç”¨

#### 4.1 åœ¨åº”ç”¨ä¸­å¿ƒæ·»åŠ å›¾æ ‡æ˜ å°„
åœ¨ `riveredge-frontend/src/pages/system/applications/list/index.tsx` ä¸­æ·»åŠ ï¼š

```typescript
const iconMap: Record<string, React.ReactNode> = {
  kuaimes: React.createElement(ManufacturingIcons.production, { size: 72 }), // å¿«æ ¼è½»MES
  kuaizhizao: React.createElement(ManufacturingIcons.production, { size: 72 }), // å¿«æ ¼è½»åˆ¶é€ 
  'master-data': React.createElement(ManufacturingIcons.database, { size: 72 }), // ä¸»æ•°æ®ç®¡ç†
  // ... å…¶ä»–åº”ç”¨å›¾æ ‡
};
```

#### 4.2 åˆ›å»ºæ•°æ®åº“åº”ç”¨è®°å½•
è¿è¡Œæ•°æ®åº“åˆå§‹åŒ–è„šæœ¬ï¼š

```bash
# åˆ›å»ºåº”ç”¨è®°å½•è„šæœ¬
cd riveredge-backend && uv run python ../create_kuaizhizao_app.py
```

è„šæœ¬å†…å®¹ (`create_kuaizhizao_app.py`):
```python
import asyncio
import json
import uuid
from pathlib import Path

# æ·»åŠ é¡¹ç›®æ ¹ç›®å½•åˆ° Python è·¯å¾„
import sys
sys.path.insert(0, str(Path(__file__).parent / "riveredge-backend" / "src"))

from tortoise import Tortoise
from core.models.application import Application
from infra.config.database_config import TORTOISE_ORM

async def create_kuaizhizao_app():
    """åˆ›å»ºå¿«æ ¼è½»åˆ¶é€ åº”ç”¨è®°å½•"""

    # åˆå§‹åŒ–æ•°æ®åº“è¿æ¥
    await Tortoise.init(config=TORTOISE_ORM)

    # ç”Ÿæˆåº”ç”¨ä¿¡æ¯
    app_data = {
        "uuid": str(uuid.uuid4()),
        "tenant_id": 1,  # é»˜è®¤ç§Ÿæˆ·ID
        "name": "å¿«æ ¼è½»åˆ¶é€ ",
        "code": "kuaizhizao",
        "description": "è½»é‡çº§MESç³»ç»Ÿï¼Œä¸“æ³¨ç”Ÿäº§æ‰§è¡Œæ ¸å¿ƒæµç¨‹",
        "icon": "production",
        "version": "1.0.0",
        "route_path": "/apps/kuaizhizao",
        "entry_point": "../apps/kuaizhizao/index.tsx",
        "menu_config": {
            # ... èœå•é…ç½® (åŒmanifest.json)
        },
        "permission_code": None,
        "is_system": False,
        "is_active": True,
        "is_installed": True,
        "sort_order": 980,
    }

    # æ£€æŸ¥åº”ç”¨æ˜¯å¦å·²å­˜åœ¨
    existing_app = await Application.filter(code="kuaizhizao").first()
    if existing_app:
        print("âœ… å¿«æ ¼è½»åˆ¶é€ åº”ç”¨å·²å­˜åœ¨ï¼Œæ›´æ–°é…ç½®...")
        await existing_app.update_from_dict(app_data)
        await existing_app.save()
        print("âœ… å¿«æ ¼è½»åˆ¶é€ åº”ç”¨é…ç½®å·²æ›´æ–°")
    else:
        print("ğŸ“ åˆ›å»ºå¿«æ ¼è½»åˆ¶é€ åº”ç”¨...")
        app = await Application.create(**app_data)
        print(f"âœ… å¿«æ ¼è½»åˆ¶é€ åº”ç”¨åˆ›å»ºæˆåŠŸï¼ŒID: {app.id}")

    # å…³é—­æ•°æ®åº“è¿æ¥
    await Tortoise.close_connections()

if __name__ == "__main__":
    print("ğŸš€ å¼€å§‹åˆ›å»ºå¿«æ ¼è½»åˆ¶é€ åº”ç”¨è®°å½•...")
    asyncio.run(create_kuaizhizao_app())
    print("ğŸ‰ å®Œæˆï¼")
```

---

### æ­¥éª¤5: æäº¤ä»£ç 

#### 5.1 æäº¤å‰ç«¯ä»£ç 
```bash
# æ·»åŠ æ‰€æœ‰æ–°æ–‡ä»¶
git add riveredge-frontend/src/apps/kuaizhizao/
git add riveredge-frontend/src/routes/AppRoutes.tsx
git add riveredge-frontend/src/pages/system/applications/list/index.tsx

# æäº¤ä»£ç 
git commit -m "åˆ›å»ºå¿«æ ¼è½»åˆ¶é€ APP - å·¥å•å’ŒæŠ¥å·¥ç®¡ç†"
```

#### 5.2 æ¨é€ä»£ç 
```bash
git push origin develop
```

---

## ğŸ“ æ–‡ä»¶ç»“æ„æ€»è§ˆ

```
riveredge-frontend/src/apps/kuaizhizao/
â”œâ”€â”€ manifest.json                    # åº”ç”¨é…ç½®
â”œâ”€â”€ index.tsx                        # åº”ç”¨å…¥å£
â”œâ”€â”€ components/
â”‚   â””â”€â”€ index.ts                     # ç»„ä»¶å¯¼å‡º
â”œâ”€â”€ pages/
â”‚   â””â”€â”€ production-execution/
â”‚       â”œâ”€â”€ work-orders/
â”‚       â”‚   â””â”€â”€ index.tsx           # å·¥å•ç®¡ç†é¡µé¢
â”‚       â””â”€â”€ reporting/
â”‚           â””â”€â”€ index.tsx           # æŠ¥å·¥ç®¡ç†é¡µé¢
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ index.ts                    # æœåŠ¡å¯¼å‡º
â”‚   â””â”€â”€ production.ts               # ç”Ÿäº§æ‰§è¡ŒæœåŠ¡
â””â”€â”€ types/
    â”œâ”€â”€ index.ts                    # ç±»å‹å¯¼å‡º
    â””â”€â”€ production.ts               # ç”Ÿäº§æ‰§è¡Œç±»å‹
```

---

## ğŸ”§ å¼€å‘è§„èŒƒ

### 6.1 å‘½åè§„èŒƒ
- **åº”ç”¨ä»£ç **: å…¨å°å†™ï¼Œå•è¯é—´ç”¨ä¸‹åˆ’çº¿åˆ†éš” (ä¾‹: `kuaizhizao`)
- **é¡µé¢è·¯å¾„**: kebab-case (ä¾‹: `production-execution/work-orders`)
- **æƒé™ä»£ç **: `åº”ç”¨ä»£ç :æ¨¡å—:æ“ä½œ` (ä¾‹: `kuaizhizao:work-order:view`)

### 6.2 æ–‡ä»¶ç»„ç»‡
- **å•ä¸€èŒè´£**: æ¯ä¸ªæ–‡ä»¶åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½æ¨¡å—
- **ç»Ÿä¸€å¯¼å…¥**: ä½¿ç”¨ `index.ts` æ–‡ä»¶ç»Ÿä¸€å¯¼å‡º
- **ç±»å‹å®‰å…¨**: ä¸ºæ‰€æœ‰APIå’Œç»„ä»¶å®šä¹‰TypeScriptç±»å‹

### 6.3 ä»£ç è´¨é‡
- **é”™è¯¯å¤„ç†**: ç»Ÿä¸€ä½¿ç”¨ `App.useApp()` çš„ `messageApi`
- **åŠ è½½çŠ¶æ€**: ä½¿ç”¨ `loading` çŠ¶æ€ç®¡ç†å¼‚æ­¥æ“ä½œ
- **ç”¨æˆ·ä½“éªŒ**: æä¾›æ¸…æ™°çš„æ“ä½œåé¦ˆå’ŒçŠ¶æ€æç¤º

---

## ğŸ¯ éªŒè¯æ¸…å•

åˆ›å»ºå®Œæˆåï¼Œè¯·æŒ‰ä»¥ä¸‹æ¸…å•éªŒè¯ï¼š

- âœ… åº”ç”¨å¯åœ¨åº”ç”¨ä¸­å¿ƒæ˜¾ç¤º
- âœ… åº”ç”¨å›¾æ ‡æ­£ç¡®æ˜¾ç¤º
- âœ… èœå•å¯¼èˆªæ­£å¸¸å·¥ä½œ
- âœ… é¡µé¢è·¯ç”±æ­£ç¡®è·³è½¬
- âœ… æƒé™æ§åˆ¶ç”Ÿæ•ˆ
- âœ… æ•°æ®åº“è®°å½•æ­£ç¡®
- âœ… ä»£ç æ— linté”™è¯¯
- âœ… Gitæäº¤å¹²å‡€

---

## ğŸ’¡ ä½¿ç”¨å»ºè®®

1. **ä»å°å¼€å§‹**: ä»æ ¸å¿ƒåŠŸèƒ½å¼€å§‹ï¼Œé¿å…ä¸€æ¬¡æ€§åˆ›å»ºè¿‡å¤šåŠŸèƒ½
2. **æ¸è¿›å¼€å‘**: å…ˆå®ç°åŸºç¡€CRUDï¼Œå†æ·»åŠ é«˜çº§åŠŸèƒ½
3. **ç»Ÿä¸€é£æ ¼**: éµå¾ªç°æœ‰çš„UI/UXè®¾è®¡è§„èŒƒ
4. **æƒé™æ§åˆ¶**: ä»ä¸€å¼€å§‹å°±è€ƒè™‘æƒé™è®¾è®¡
5. **æ–‡æ¡£åŒæ­¥**: åŠæ—¶æ›´æ–°APIæ–‡æ¡£å’Œç”¨æˆ·æ‰‹å†Œ

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š
- [RiverEdge å¼€å‘æ–‡æ¡£](../../README.md)
- [å‰ç«¯å¼€å‘è§„èŒƒ](../frontend-dev-guide.md)
- [åç«¯å¼€å‘è§„èŒƒ](../backend-dev-guide.md)
- [API æ¥å£æ–‡æ¡£](../../../riveredge-backend/docs/api/)

**æœ€åæ›´æ–°**: 2025-12-29
**ç»´æŠ¤è€…**: Luigi Lu

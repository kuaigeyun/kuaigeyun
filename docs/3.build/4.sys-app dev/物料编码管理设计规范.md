# 物料编码管理设计规范

> 本文档从《用户使用场景推演-MTS-MTO.md》和《BOM-工艺路线-标准作业流程设计规范.md》中提取了关于物料编码管理的核心设计内容，用于强化设计参考。

**提取日期**：2026-01-08  
**来源文档**：用户使用场景推演-MTS-MTO.md、BOM-工艺路线-标准作业流程设计规范.md  
**设计阶段**：强化设计阶段

---

## 目录

1. [物料编码体系概述](#1-物料编码体系概述)
2. [主编码体系](#2-主编码体系)
3. [部门编码体系](#3-部门编码体系)
4. [编码映射机制](#4-编码映射机制)
5. [智能识别重复物料](#5-智能识别重复物料)
6. [物料映射工具](#6-物料映射工具)
7. [多编码搜索](#7-多编码搜索)
8. [使用场景](#8-使用场景)
9. [验收标准](#9-验收标准)
10. [设计要点](#10-设计要点)

---

## 1. 物料编码体系概述

### 1.1 编码体系设计目标

- **解决编码不统一问题**：各部门可继续使用原有编码，系统自动映射
- **不中断业务**：先导入后整理，业务可正常使用
- **渐进式整理**：逐步建立映射关系，不强制一次性统一
- **智能识别**：AI辅助识别重复物料，减少人工工作量
- **灵活使用**：各部门可继续使用原有编码，系统自动映射到主编码

### 1.2 编码体系架构

```
物料编码体系
├── 主编码（系统内部唯一标识）
│   └── MAT-{类型}-{序号}
│       ├── MAT-FIN-0001（成品）
│       ├── MAT-SEMI-0001（半成品）
│       └── MAT-RAW-0001（原材料）
└── 部门编码（业务使用，作为别名）
    ├── 销售编码：SALE-A001
    ├── 设计编码：DES-A001
    ├── 供应商编码：SUP-A001
    ├── 采购编码：PUR-A001
    ├── 仓库编码：WH-A001
    └── 生产编码：PROD-A001
```

### 1.3 编码映射关系

- **一对多关系**：一个主编码可以对应多个部门编码
- **自动映射**：输入任意部门编码，系统自动映射到主编码
- **双向查询**：支持通过主编码查询部门编码，也支持通过部门编码查询主编码

---

## 2. 主编码体系

### 2.1 主编码生成规则

**编码格式**：`MAT-{类型}-{序号}`

**类型分类**：
- `FIN`：成品（Finished Goods）
- `SEMI`：半成品（Semi-finished Goods）
- `RAW`：原材料（Raw Materials）
- `PACK`：包装材料（Packaging Materials）
- `AUX`：辅助材料（Auxiliary Materials）

**序号规则**：
- 4位数字，从0001开始递增
- 按物料类型分别计数
- 系统自动生成，不可手动修改

**示例**：
- `MAT-FIN-0001`：成品001
- `MAT-SEMI-0001`：半成品001
- `MAT-RAW-0001`：原材料001

### 2.2 主编码特性

- **系统内部唯一标识**：作为系统内部唯一标识，用于数据库主键、关联关系等
- **自动生成**：创建物料时系统自动生成，无需手动输入
- **不可修改**：主编码一旦生成，不可修改，确保数据一致性
- **全局唯一**：同一组织内，主编码全局唯一

### 2.3 主编码使用场景

- **数据库存储**：作为物料表的主键或唯一标识
- **系统内部关联**：BOM、工单、库存等业务单据关联物料时使用主编码
- **API接口**：系统内部API使用主编码作为物料标识
- **数据导入导出**：批量导入导出时，使用主编码确保数据一致性

---

## 3. 部门编码体系

### 3.1 部门编码类型

**销售编码（SALE）**：
- 格式：`SALE-{部门标识}-{序号}`
- 示例：`SALE-A001`、`SALE-B001`
- 用途：销售部门使用的物料编码

**设计编码（DES）**：
- 格式：`DES-{部门标识}-{序号}`
- 示例：`DES-A001`、`DES-B001`
- 用途：设计部门使用的物料编码

**供应商编码（SUP）**：
- 格式：`SUP-{部门标识}-{序号}`
- 示例：`SUP-A001`、`SUP-B001`
- 用途：供应商提供的物料编码

**采购编码（PUR）**：
- 格式：`PUR-{部门标识}-{序号}`
- 示例：`PUR-A001`、`PUR-B001`
- 用途：采购部门使用的物料编码

**仓库编码（WH）**：
- 格式：`WH-{部门标识}-{序号}`
- 示例：`WH-A001`、`WH-B001`
- 用途：仓库部门使用的物料编码

**生产编码（PROD）**：
- 格式：`PROD-{部门标识}-{序号}`
- 示例：`PROD-A001`、`PROD-B001`
- 用途：生产部门使用的物料编码

### 3.2 部门编码特性

- **业务使用**：各部门可继续使用原有编码，作为业务标识
- **作为别名保留**：部门编码作为主编码的别名，保留在系统中
- **可重复使用**：不同物料可以使用相同的部门编码（但需要映射到不同的主编码）
- **可自定义**：支持自定义部门编码类型和格式

### 3.3 部门编码使用场景

- **业务操作**：各部门在业务操作中使用部门编码
- **数据导入**：批量导入数据时，支持使用部门编码
- **搜索查询**：支持通过部门编码搜索物料
- **报表展示**：报表中可显示部门编码，便于业务人员理解

---

## 4. 编码映射机制

### 4.1 映射关系建立

**自动映射**：
- 创建物料时，如果输入了部门编码，系统自动建立映射关系
- 批量导入时，系统自动识别部门编码并建立映射关系

**手动映射**：
- 通过物料映射工具，手动建立编码映射关系
- 支持批量建立映射关系

**映射规则**：
- 一个主编码可以对应多个部门编码
- 一个部门编码只能对应一个主编码
- 如果部门编码已存在，系统提示是否合并物料

### 4.2 映射关系存储

**存储结构**：
```json
{
  "material_id": 1,
  "main_code": "MAT-FIN-0001",
  "alias_codes": [
    {
      "code_type": "SALE",
      "code": "SALE-A001",
      "department": "销售部"
    },
    {
      "code_type": "DES",
      "code": "DES-A001",
      "department": "设计部"
    }
  ]
}
```

**数据库设计**：
- 主表：物料主表（material），存储主编码
- 别名表：物料编码别名表（material_code_alias），存储部门编码和映射关系

### 4.3 映射关系查询

**正向查询**（通过部门编码查询主编码）：
- 输入部门编码：`SALE-A001`
- 系统自动查询映射关系
- 返回主编码：`MAT-FIN-0001`

**反向查询**（通过主编码查询部门编码）：
- 输入主编码：`MAT-FIN-0001`
- 系统查询所有关联的部门编码
- 返回所有部门编码列表

**模糊查询**：
- 支持部门编码模糊匹配
- 支持部门编码类型筛选
- 支持部门筛选

---

## 5. 智能识别重复物料

### 5.1 识别策略

**高置信度识别**（自动合并提示）：
- **匹配条件**：名称+规格+单位完全一致
- **处理方式**：系统自动识别为重复物料，提示管理员确认合并
- **示例**：
  - 物料A：名称="塑料颗粒A"，规格="100g"，单位="kg"
  - 物料B：名称="塑料颗粒A"，规格="100g"，单位="kg"
  - 结果：高置信度匹配，提示合并

**中置信度识别**（提示管理员确认）：
- **匹配条件**：名称相似+规格相同
- **处理方式**：系统提示管理员确认是否为同一物料
- **示例**：
  - 物料A：名称="塑料颗粒A"，规格="100g"
  - 物料B：名称="塑料颗粒 A"，规格="100g"
  - 结果：中置信度匹配，提示确认

**低置信度识别**（仅提示不自动合并）：
- **匹配条件**：名称相似但规格不同
- **处理方式**：系统仅提示可能重复，不自动合并
- **示例**：
  - 物料A：名称="塑料颗粒A"，规格="100g"
  - 物料B：名称="塑料颗粒A"，规格="200g"
  - 结果：低置信度匹配，仅提示

### 5.2 识别算法

**多维度匹配**：
- 物料名称匹配（精确匹配、模糊匹配、拼音匹配）
- 规格匹配（精确匹配、数值范围匹配）
- 单位匹配（精确匹配、单位换算匹配）
- 供应商匹配（可选）
- 物料类型匹配（可选）

**AI辅助识别**：
- 基于历史数据学习，提高识别准确率
- 基于物料属性相似度计算
- 基于业务规则智能判断

**匹配算法**：
- 精确匹配：完全一致
- 模糊匹配：相似度>90%
- 拼音匹配：拼音相同
- 数值匹配：数值范围匹配

### 5.3 识别结果处理

**自动合并**（高置信度）：
- 系统自动识别为重复物料
- 提示管理员确认合并
- 确认后自动合并物料数据

**手动确认**（中置信度）：
- 系统提示可能重复
- 管理员手动确认是否为同一物料
- 确认后手动合并

**仅提示**（低置信度）：
- 系统仅提示可能重复
- 不自动合并，不强制确认
- 管理员可自行决定是否合并

---

## 6. 物料映射工具

### 6.1 工具功能

**可视化合并重复物料**：
- 显示重复物料列表
- 可视化展示物料相似度
- 支持批量合并操作

**建立编码映射关系**：
- 手动建立主编码与部门编码的映射关系
- 支持批量建立映射关系
- 支持修改和删除映射关系

**保留所有部门编码作为别名**：
- 合并物料时，保留所有部门编码
- 建立完整的编码映射关系
- 确保业务不中断

**合并物料属性（取并集）**：
- 合并物料时，合并所有物料属性
- 属性取并集（保留所有非空属性）
- 冲突属性提示管理员选择

### 6.2 工具界面

**重复物料列表**：
- 显示重复物料信息
- 显示相似度评分
- 显示匹配原因

**映射关系管理**：
- 显示主编码和所有部门编码
- 支持添加、修改、删除映射关系
- 支持批量操作

**合并预览**：
- 显示合并后的物料信息
- 显示合并后的编码映射关系
- 显示属性合并结果

### 6.3 操作流程

1. **识别重复物料**：
   - 系统自动识别重复物料
   - 显示重复物料列表

2. **选择合并物料**：
   - 选择要合并的物料
   - 选择保留的主物料

3. **确认合并**：
   - 预览合并结果
   - 确认合并操作

4. **建立映射关系**：
   - 自动建立编码映射关系
   - 保留所有部门编码

---

## 7. 多编码搜索

### 7.1 搜索功能

**支持输入任意部门编码搜索**：
- 输入部门编码：`SALE-A001`
- 系统自动映射到主编码
- 返回物料信息

**支持物料名称拼音搜索**：
- 输入拼音：`slkl`
- 系统匹配物料名称拼音
- 返回匹配的物料列表

**支持模糊匹配搜索**：
- 输入关键词：`塑料`
- 系统模糊匹配物料名称、编码等
- 返回匹配的物料列表

### 7.2 搜索策略

**编码搜索优先级**：
1. 主编码精确匹配
2. 部门编码精确匹配
3. 编码模糊匹配

**名称搜索优先级**：
1. 名称精确匹配
2. 名称拼音匹配
3. 名称模糊匹配

**综合搜索**：
- 同时搜索编码和名称
- 返回综合匹配结果
- 按匹配度排序

### 7.3 搜索结果展示

**显示主编码和部门编码**：
- 搜索结果中同时显示主编码和所有部门编码
- 支持切换显示编码类型

**高亮匹配内容**：
- 高亮显示匹配的编码或名称
- 便于快速识别

**快速操作**：
- 支持快速查看物料详情
- 支持快速编辑物料
- 支持快速建立映射关系

---

## 8. 使用场景

### 8.1 场景1：批量导入物料数据

**用户操作**：
1. 进入"主数据管理" → "产品管理" → "物料管理"
2. 打开物料导入universheet在线表格
3. 填写物料数据（使用部门编码）：
   - 物料名称：产品A
   - 销售编码：SALE-A001
   - 设计编码：DES-A001
   - 采购编码：PUR-A001
4. 点击"导入"按钮

**系统行为**：
- 自动识别部门编码
- 自动生成主编码：`MAT-FIN-0001`
- 自动建立编码映射关系
- 自动识别重复物料（如果有）

**结果**：
- 物料创建成功
- 主编码：`MAT-FIN-0001`
- 部门编码映射：`SALE-A001`、`DES-A001`、`PUR-A001` → `MAT-FIN-0001`

### 8.2 场景2：创建BOM使用部门编码

**用户操作**：
1. 进入"主数据管理" → "产品管理" → "BOM管理"
2. 创建BOM，使用部门编码：
   ```
   产品A（1个，使用SALE-A001）
   ├── 注塑件A（2个，使用PROD-A001）
   └── 螺丝（4个，使用WH-A001）
   ```

**系统行为**：
- 自动识别部门编码
- 自动映射到主编码
- 自动验证BOM数据完整性

**结果**：
- BOM创建成功
- 所有部门编码自动映射到主编码
- BOM数据完整

### 8.3 场景3：搜索物料使用部门编码

**用户操作**：
1. 进入物料搜索页面
2. 输入部门编码：`SALE-A001`
3. 点击搜索

**系统行为**：
- 自动识别部门编码
- 自动映射到主编码
- 查询物料信息

**结果**：
- 返回物料信息
- 显示主编码和所有部门编码
- 支持快速操作

### 8.4 场景4：合并重复物料

**用户操作**：
1. 系统识别到重复物料
2. 进入物料映射工具
3. 选择要合并的物料
4. 确认合并

**系统行为**：
- 合并物料数据
- 建立编码映射关系
- 保留所有部门编码

**结果**：
- 物料合并成功
- 所有部门编码映射到同一主编码
- 业务不中断

---

## 9. 验收标准

### 9.1 编码映射机制

- ✅ **主编码生成正常**：系统自动生成主编码，格式正确
- ✅ **部门编码保留正常**：部门编码作为别名保留，业务可正常使用
- ✅ **自动映射正常**：输入任意部门编码，系统自动映射到主编码
- ✅ **映射关系存储正常**：编码映射关系正确存储
- ✅ **映射关系查询正常**：支持正向和反向查询

### 9.2 智能识别重复物料

- ✅ **高置信度识别正常**：名称+规格+单位完全一致，自动合并提示
- ✅ **中置信度识别正常**：名称相似+规格相同，提示管理员确认
- ✅ **低置信度识别正常**：名称相似但规格不同，仅提示不自动合并
- ✅ **多维度匹配正常**：支持名称、规格、单位等多维度匹配
- ✅ **AI辅助识别正常**：基于历史数据学习，提高识别准确率

### 9.3 物料映射工具

- ✅ **可视化合并正常**：重复物料列表显示正常
- ✅ **映射关系建立正常**：手动建立编码映射关系正常
- ✅ **部门编码保留正常**：合并物料时保留所有部门编码
- ✅ **属性合并正常**：合并物料属性（取并集）正常

### 9.4 多编码搜索

- ✅ **部门编码搜索正常**：支持输入任意部门编码搜索
- ✅ **拼音搜索正常**：支持物料名称拼音搜索
- ✅ **模糊匹配搜索正常**：支持模糊匹配搜索
- ✅ **搜索结果展示正常**：显示主编码和部门编码，高亮匹配内容

### 9.5 业务场景验证

- ✅ **批量导入正常**：支持使用部门编码批量导入物料
- ✅ **BOM创建正常**：支持使用部门编码创建BOM
- ✅ **搜索查询正常**：支持使用部门编码搜索物料
- ✅ **业务不中断**：编码映射不影响现有业务

---

## 10. 设计要点

### 10.1 用户体验优化

- ⚡ **解决编码不统一问题**：各部门可继续使用原有编码，系统自动映射
- ⚡ **不中断业务**：先导入后整理，业务可正常使用
- ⚡ **渐进式整理**：逐步建立映射关系，不强制一次性统一
- ⚡ **智能识别**：AI辅助识别重复物料，减少人工工作量
- ⚡ **灵活使用**：各部门可继续使用原有编码，系统自动映射到主编码

### 10.2 技术实现要点

- ⚡ **编码映射表设计**：主编码和部门编码分离存储，建立映射关系
- ⚡ **自动映射算法**：高效的编码映射算法，支持快速查询
- ⚡ **智能识别算法**：多维度匹配算法，提高识别准确率
- ⚡ **搜索索引优化**：为编码和名称建立索引，提高搜索性能

### 10.3 数据一致性保证

- ⚡ **主编码唯一性**：确保主编码全局唯一
- ⚡ **映射关系一致性**：确保编码映射关系一致
- ⚡ **数据完整性**：合并物料时保证数据完整性
- ⚡ **业务连续性**：编码映射不影响现有业务

### 10.4 扩展性设计

- ⚡ **支持自定义编码类型**：支持添加新的部门编码类型
- ⚡ **支持编码规则配置**：支持配置编码生成规则
- ⚡ **支持编码格式验证**：支持配置编码格式验证规则
- ⚡ **支持编码历史追溯**：支持查询编码变更历史

---

## 11. 后续强化设计方向

### 11.1 编码规则配置

1. **自定义编码类型**：支持添加新的部门编码类型
2. **编码生成规则**：支持配置编码生成规则（格式、前缀、后缀等）
3. **编码验证规则**：支持配置编码格式验证规则
4. **编码自动生成**：支持基于规则自动生成编码

### 11.2 编码历史管理

1. **编码变更历史**：记录编码变更历史
2. **编码版本管理**：支持编码版本管理
3. **编码追溯**：支持查询编码的完整历史
4. **编码回滚**：支持编码变更回滚

### 11.3 编码统计分析

1. **编码使用统计**：统计各部门编码使用情况
2. **编码映射统计**：统计编码映射关系分布
3. **重复物料统计**：统计重复物料识别情况
4. **编码优化建议**：基于统计数据，提供编码优化建议

### 11.4 编码导入导出

1. **编码映射导出**：支持导出编码映射关系
2. **编码映射导入**：支持导入编码映射关系
3. **编码批量操作**：支持批量建立、修改、删除编码映射关系
4. **编码模板管理**：支持编码映射模板管理

---

**文档结束**

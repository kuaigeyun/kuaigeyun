# 制造SOP 开发计划

> **文档说明：**  
> 本计划依据《☆ 用户使用全场景推演.md》与《BOM-工艺路线-标准作业流程设计规范.md》中关于制造SOP（标准作业流程）的规划，结合中小制造业企业最佳实践，单独出具制造SOP模块的开发和强化计划。  
> 
> **创建时间：** 2026-01-27  
> **关联文档：**  
> - docs/3.build/4.sys-app dev/☆ 用户使用全场景推演.md  
> - docs/3.build/4.sys-app dev/old260113/BOM-工艺路线-标准作业流程设计规范.md

---

## 📋 目录

1. [规划依据与目标](#1-规划依据与目标)
2. [现状与差距分析](#2-现状与差距分析)
3. [中小企业最佳实践原则](#3-中小企业最佳实践原则)
4. [开发阶段与功能点](#4-开发阶段与功能点)
5. [验收标准汇总](#5-验收标准汇总)
6. [依赖与优先级](#6-依赖与优先级)

---

## 1. 规划依据与目标

### 1.1 全场景推演中的制造SOP定位

**依据《☆ 用户使用全场景推演.md》第 2.4 节「工序和工艺路线配置」及报工相关章节：**

- **工艺路线两种模式**：
  - **简易路线**（推荐，中小企业常用）：仅工序顺序，无 SOP，配置目标 <5 分钟。
  - **带SOP工艺路线**（可选，有SOP需求的企业）：每个工序关联一个制造SOP（如：注塑工序 →《注塑作业标准》，组装工序 →《组装作业标准》），配置目标 <10 分钟。
- **SOP 设计时指定收集参数**：在「主数据管理 → 工艺管理 → 制造SOP」中编辑 SOP，进入「报工参数收集」配置页面，用表单设计器（Formily）配置报工时需采集的参数（数字、选择、文本、日期等），并支持必填、校验规则、默认值、单位；配置结果持久化到 `form_config`。
- **报工时按 SOP 展示参数表单**：报工界面根据「工单 → 工序 → 工艺路线 → 工序-SOP」解析出当前工序关联的 SOP，读取其 `form_config`，自动渲染参数收集表单并在提交时校验。
- **子工艺路线**：子工艺路线可拥有自己的工序顺序、SOP 与跳转规则；其工序-SOP 绑定逻辑与主工艺路线一致，阶段一实现时一并支持（依赖工艺路线侧已有子路线结构）。

### 1.2 设计规范中的 SOP 要求

依据《BOM-工艺路线-标准作业流程设计规范.md》第 3 节「标准作业流程（SOP）设计」：

- **SOP 与工艺路线的关联**：SOP 作为工序的作业标准，在创建「带SOP工艺路线」时为每一工序关联 SOP。
- **报工参数收集配置**：  
  - 参数类型：数字（含单位、范围、默认值）、选择（是/否、合格/不合格等）、文本、日期/时间。  
  - 必填/可选、校验规则需在 SOP 上配置，报工提交时校验。
- **系统行为**：  
  - SOP 设计时持久化报工参数配置；  
  - 工艺路线工序关联 SOP；  
  - 报工时按 SOP 配置展示参数表单并校验。

### 1.3 本计划目标

- 将现有「制造SOP」功能与全场景推演、设计规范对齐，形成**可执行、可验收**的开发任务清单。  
- 在满足规范的前提下，按**中小制造业企业最佳实践**做交互与实现上的收敛（极简、批量和向导优先）。

---

## 2. 现状与差距分析

### 2.1 已有能力（当前可复用）

| 模块 | 现状 | 说明 |
|------|------|------|
| 制造SOP 菜单与路由 | ✅ 已有 | 主数据 → 工艺管理 → 制造SOP，路径 `/apps/master-data/process/sop` |
| SOP 列表与 CRUD | ✅ 已有 | 列表、新建、编辑、删除、详情；与工序（Operation）关联 |
| SOP 表单模型 | ✅ 已有 | `code / name / description / operation_id / form_config / is_active`，`form_config` 为 JSON（可承载 Formily Schema） |
| 报工参数表单设计 | ✅ 已有 | `FormSchemaEditor` + Formily，用于在 SOP 编辑时配置 `form_config` |
| SOP 设计器（流程设计） | ✅ 已有 | `designer.tsx`，基于 ProFlow 的可视化设计页，用于步骤/流程结构 |
| SOP 执行页 | ✅ 已有 | `execution.tsx`，用于按 SOP 执行与展示 |
| 工序管理 | ✅ 已有 | 工序列表、CRUD，为 SOP 关联提供数据源 |
| 工艺路线与工序关系 | ✅ 已有 | 工艺路线含工序顺序；是否「带SOP」、工序与 SOP 的绑定需在业务上显式落地 |

### 2.2 与规范的主要差距

| 差距项 | 规范/全场景要求 | 当前状态 | 开发任务方向 |
|--------|------------------|----------|--------------|
| 工艺路线「简易 / 带SOP」区分 | 创建工艺路线时可选「简易路线」或「带SOP工艺路线」，带SOP时为每工序关联 SOP | 工艺路线与 SOP 的关联不完整或未在“带SOP”模式下强制体现 | 工艺路线类型/模式 + 工序-SOP 绑定 |
| 报工参数收集与规范对齐 | 报工参数在 SOP 上配置，类型含数字/选择/文本/日期，支持单位、范围、必填、默认值 | `form_config` 已有，需确认与「报工参数收集」语义一致，且报工端按此渲染 | 明确 form_config 即「报工参数收集」配置，报工端按 SOP 拉取并渲染 |
| 报工时按 SOP 展示参数表单 | 报工界面根据工序→SOP→form_config 自动展示参数表单并校验 | 报工侧是否已按「工序→SOP→form_config」拉取并渲染需确认 | 报工流程与制造SOP 数据打通、参数表单渲染与校验 |
| 物料/物料分组绑定工艺路线 | 工艺路线可绑定物料或物料分组，物料优先于分组；工单创建时按优先级匹配工艺路线 | 属工艺路线与需求/工单域，制造SOP 计划中仅做依赖说明 | 不列入本计划开发，在「工艺路线/工单」计划中实现 |
| SOP 在工艺路线配置中的可见性 | 带SOP工艺路线中，为每个工序选择/关联 SOP（《xx作业标准》） | 需在工艺路线配置 UI 中显式「工序 → 选择 SOP」 | 工艺路线配置页：工序行可关联 SOP（下拉/选择制造SOP） |
| 批量创建与模板 | 中小企业最佳实践：支持按工序或模板快速创建 SOP、批量维护 | 当前以单条新建为主 | 阶段二：SOP 模板、按工序批量生成 SOP 等 |

---

## 3. 中小企业最佳实践原则

制造SOP 的设计与开发需遵循《☆ 用户使用全场景推演.md》中的**通用原则**（极致简化、一键操作、批量处理、智能默认、多终端支持、向导引导、极简/全流程模式）及**针对中国式中小企业的痛点优化**（一人多岗要简单、数据录入量大需批量、不熟悉系统需向导+智能默认、重视效率需一键与批量），并突出以下与 SOP 直接相关的要点：

- **极简操作**：SOP 新建/编辑步骤少、必填项少；报工参数配置与「报工参数收集」语义一一对应，减少理解成本。带SOP 路线配置目标 <10 分钟（全场景 2.4 验收口径）。  
- **智能默认**：新建 SOP 时，若选择工序，可带出工序常用参数模板（如扭矩、外观检查、检验结果等）；表单设计器提供「报工参数」预设组件。  
- **模板与复制**：支持「从模板创建」「复制已有 SOP」，便于同工序多产品复用。  
- **向导式配置**：首次使用「报工参数收集」时，可提供简短向导（参数类型、必填、范围）。  
- **多终端**：列表与参数配置以 PC 为主；报工端在工位机/移动端按 SOP 展示参数时，布局与校验规则一致、可触屏友好。  
- **一键与批量**：在工序或工艺路线侧提供「按工序生成 SOP」「从工艺路线同步工序-SOP 绑定」等一键能力（阶段二实现）。

---

## 4. 开发阶段与功能点

### 4.1 阶段一：制造SOP 与工艺路线、报工打通（必选）

**目标：** 实现「带SOP工艺路线」在配置与执行层面的闭环，满足全场景推演与设计规范中的核心验收点。

| 序号 | 功能点 | 任务描述 | 验收标准 |
|------|--------|----------|----------|
| 1.1 | 工艺路线「带SOP」模式与工序-SOP 绑定 | 工艺路线支持「简易 / 带SOP」两种模式（对齐全场景 2.4）；带SOP 时，每个工序须关联一个制造SOP（必选）。主工艺路线与子工艺路线内的工序-SOP 绑定逻辑一致，子路线若已存在则一并支持。列表/表单中展示「工艺路线类型」「工序-SOP」关系。 | 创建/编辑工艺路线时可选择类型；带SOP 时每工序必选一个 SOP；保存后工艺路线与工序-SOP 关系持久化正确；子工艺路线工序可独立关联 SOP。 |
| 1.2 | 报工参数配置语义规范化 | 在制造SOP 中明确「报工参数收集」即当前 `form_config` 的業務含义；文档与 UI 文案统一为「报工参数收集」。若现有 FormSchemaEditor 用于「步骤表单」则拆出「报工参数」专用配置入口。 | 产品/开发文档与界面均使用「报工参数收集」；支持数字/选择/文本/日期、单位、范围、必填、默认值。 |
| 1.3 | 报工参数类型与校验对齐规范 | form_config 的 Schema 支持：数字（含单位、min/max、默认值）、选择（选项列表）、文本、日期时间；必填与校验在提交报工时执行。与规范/全场景示例一致：如扭矩（数字，单位 N·m，范围 20–30）、外观检查（选择 是/否）、检验结果（选择 合格/不合格）、包装数量（数字）、标签检查（是/否）等。 | 各类型在 SOP 编辑与报工展示中一致；校验失败时有明确提示；能支撑全场景中注塑/组装/检验/包装等工序示例。 |
| 1.4 | 报工流程读取工序-SOP 并渲染参数表单 | 报工界面根据「工单 → 工序 → 工艺路线 → 工序-SOP」解析出当前工序关联的 SOP，读取其 form_config，渲染报工参数表单并在提交时校验。 | 选择工序后，若有关联 SOP，则展示对应参数表单；无 SOP 时仅数量/状态等基础报工；提交前完成参数校验。 |
| 1.5 | SOP 与工序关联在列表/详情的展示 | 在制造SOP 列表中支持按「关联工序」筛选与展示；详情/编辑中展示当前关联工序及「报工参数收集」摘要。 | 列表可筛工序、可列工序信息；详情中能直接进入「报工参数收集」配置。 |

### 4.2 阶段二：易用性与批量能力（推荐）

**目标：** 贴合中小制造业「少配置、多复用」的使用习惯。

| 序号 | 功能点 | 任务描述 | 验收标准 |
|------|--------|----------|----------|
| 2.1 | SOP 模板与复制 | 支持将某 SOP 另存为「模板」；新建时可选「从模板创建」。支持「复制 SOP」生成新 SOP（含名称编码差异化）。 | 模板列表与选择入口清晰；复制后新 SOP 可独立编辑，不影响原 SOP。 |
| 2.2 | 按工序推荐/快速创建 SOP | 在 SOP 新建时选择工序后，可一键应用「该工序常用报工参数模板」（若存在）；或提供「按工序批量生成 SOP」入口（为多个工序各生成一条空 SOP 并关联）。 | 选择工序后可快速带出参数模板或生成关联工序的 SOP，减少重复录入。 |
| 2.3 | 报工参数预设组件库 | 在 FormSchemaEditor 或报工参数配置中，提供预设组件（如「扭矩」「外观检查」「检验结果」「包装数量」等），用户可勾选即用再微调。 | 配置界面有预设可选，选择后自动写入 form_config，用户可改标签、单位、范围等。 |
| 2.4 | 制造SOP 使用引导 | 首次进入制造SOP 或首次使用「报工参数收集」时，可选简短引导（何时用 SOP、报工参数是什么、如何与工艺路线配合）。 | 引导不打断老用户；新用户能在一分钟内理解 SOP 与报工参数的关系。 |

### 4.3 阶段三：强化与扩展（可选 / PRO 方向）

对齐《BOM-工艺路线-标准作业流程设计规范》第 7.3 节「SOP 强化」：

| 序号 | 功能点 | 任务描述 | 验收标准 |
|------|--------|----------|----------|
| 3.1 | SOP 版本管理 | 支持 SOP 的版本保存、历史版本查看与对比；工艺路线/工序关联可指定「使用某版本」。 | 修改 SOP 可生新版本；历史版本只读；关联关系可指向具体版本。 |
| 3.2 | SOP 审批流程 | SOP 新建/修订可走审批，通过后生效；未生效版本不能在工艺路线或报工中选用。 | 配置审批规则后，SOP 提交审批、通过后状态变更，带SOP 工艺路线仅能选已生效 SOP。 |
| 3.3 | SOP 执行与追溯 | 报工提交时落库「执行记录」与填写的参数；支持按工单/工序/时间查询某 SOP 的执行次数与参数分布。 | 有执行记录表或等价存储；简单统计或列表可查。 |
| 3.4 | 工位机/触屏报工适配 | 报工参数表单在工位机、触屏模式下布局与校验不变，支持大按钮、大字、必要时的语音/扫码。 | 同一 form_config 在 PC 与触屏报工中行为一致，触屏布局符合 TouchScreenTemplate 等规范。 |

---

## 5. 验收标准汇总

以下汇总自全场景推演与设计规范，作为制造SOP 模块的统一验收底线：

### 5.1 与工艺路线、报工相关的验收

- 工艺路线支持「带SOP」类型，且带SOP 时每个工序必须关联一个制造SOP。  
- 报工界面能根据「工单 → 工序 → 工序关联的 SOP」加载 form_config，并展示报工参数表单。  
- 报工提交时，对 form_config 中定义的必填与校验规则执行校验，不通过时给出明确提示并不提交。  
- 参数类型至少支持：数字（含单位、范围、默认值）、选择、文本、日期/时间。

### 5.2 SOP 管理侧的验收

- 制造SOP 列表、新建、编辑、删除、详情齐全；可与工序关联。  
- 「报工参数收集」配置入口明确，配置结果持久化到 form_config，与报工端解析一致；参数类型与示例对齐全场景与设计规范（数字含单位/范围、选择、文本、日期）。  
- 在工艺路线配置界面，能按工序选择/切换关联的制造SOP，并保存。  
- **易用性口径**（对齐全场景 2.4）：带SOP 工艺路线从创建到完成工序-SOP 绑定，目标 <10 分钟；报工参数配置支持预设/模板时可更快完成。

### 5.3 文档与命名

- 产品/研发文档与界面中，「制造SOP」「报工参数收集」「带SOP工艺路线」等称谓与全场景推演、设计规范一致。  
- 对外（含菜单、帮助）已统一使用「制造SOP」（不再使用「制造BOM」等旧称）。

---

## 6. 依赖与优先级

### 6.1 依赖关系

- **工序管理**：制造SOP 依赖工序（Operation）已存在且可维护；工艺路线依赖工序顺序。  
- **工艺路线模型与 API**：阶段一依赖工艺路线支持「类型」与「工序-SOP」关联字段/关系；若当前无，需在工艺路线侧先做数据与接口扩展。  
- **报工流程与接口**：阶段一依赖报工流程能解析「当前工序 → 工艺路线 → 工序-SOP」，并拉取 SOP 的 form_config；报工提交接口需支持结构化参数落库。

### 6.2 建议优先级

1. **P0（必须在本计划内完成）**：阶段一全部内容（工艺路线带SOP、工序-SOP 绑定、报工参数规范化、报工端按 SOP 展示与校验）。  
2. **P1（强烈建议）**：阶段二中的「报工参数预设组件库」「SOP 模板与复制」——对中小客户上手和运维成本影响大。  
3. **P2（可按迭代排期）**：阶段二「按工序推荐/快速创建」与「使用引导」；阶段三中的版本管理、执行追溯。  
4. **P3（PRO 或后期）**：SOP 审批流程、工位机/触屏专项适配。

### 6.3 与其它计划的关系

- **工艺路线与工序**：本计划假定工序、工艺路线的基础 CRUD 与「工序顺序」已具备；「物料/物料分组绑定工艺路线」「工单创建时自动匹配工艺路线」属工艺路线/工单计划，本计划仅引用、不实现。**子工艺路线内工序-SOP 的绑定与报工解析**归属本计划，与主工艺路线共用同一套「工序→SOP→form_config」逻辑；依赖工艺路线侧已具备子工艺路线结构。  
- **工单与报工**：本计划只约定「报工端读取工序-SOP 与 form_config、渲染与校验」的契约与验收标准，具体报工页改造归属工单/报工开发计划。  
- **BOM / 工程BOM**：与制造SOP 无直接依赖；工程BOM 与制造SOP 同属主数据工艺域，可共用同一菜单分组与权限体系。

---

**文档结束**

# 制造SOP 开发计划（优化版）

> **文档说明：**  
> 本计划**仅改造制造SOP 模块**，**不改动已建设好的工艺路线与 BOM**。SOP = **工艺路线与 BOM 的融合**，产出「作业指导书（ESOP）」与「参数收集器（报工数据采集项）」；**开工单时以 SOP 为依据，产生对应的流程单据**。按融合 + 两产出 + 工单闭环做阶段划分，避免过度设计。  
> 
> **创建/修订时间：** 2026-01-27  
> **关联文档：**  
> - docs/3.build/4.sys-app dev/☆ 用户使用全场景推演.md  
> - docs/3.build/4.sys-app dev/old260113/BOM-工艺路线-标准作业流程设计规范.md  

---

## 📋 目录

1. [规划依据与目标](#1-规划依据与目标)
2. [边界与原则](#2-边界与原则)
3. [SOP 能力架构（设想与最佳实践）](#3-sop-能力架构设想与最佳实践)
4. [现状与差距](#4-现状与差距)
5. [开发阶段与功能点](#5-开发阶段与功能点)
6. [验收标准汇总](#6-验收标准汇总)
7. [依赖与优先级](#7-依赖与优先级)

---

## 1. 规划依据与目标

### 1.1 定位

- **制造SOP 本质**：SOP 是**工艺路线与 BOM 的融合过程**。以「选定的工艺路线 + 选定的 BOM」为输入，在 SOP 中完成「按什么步骤做、要收集哪些参数」的配置，形成可执行主数据。  
- **两大产出**：  
  - **作业指导书（ESOP）**：步骤、说明、附图等，供现场执行与查看；  
  - **参数收集器**：即「报工数据采集项」（对应现有 `form_config`），供报工时按 SOP 渲染表单并校验。  
- **本计划范围**：仅在「制造SOP」域内做扩展与增强，**不改造工艺路线与 BOM 的已有建模**。工艺路线、BOM 仅被 SOP **引用与载入**，表结构、交互保持现状。  
- **绑定维度**：SOP 可绑定**物料组**或**具体物料**，便于工单/报工按物料或物料组匹配应执行的 SOP；约定**具体物料优先于物料组**。

### 1.2 目标

- 将制造SOP 建成「**工艺路线 + BOM 融合 → 作业指导书 + 参数收集器**」的主数据能力，**开工单时以 SOP 为依据，产生对应的流程单据**（如工序维度的作业指导、参数收集项等）。  
- 在满足上述闭环的前提下，按**极简、智能默认、模板与复制**等最佳实践收敛，**避免过度设计**。  
- 输出可执行、可验收的任务与阶段划分。

---

## 2. 边界与原则

### 2.1 边界

| 项 | 说明 |
|----|------|
| **不动的部分** | 工艺路线现有建模、工序顺序、物料/物料分组绑定、版本与子路线等均已落地，本计划不修改。 |
| **SOP 侧新增/改造** | SOP 自身的数据模型、绑定关系（物料组/物料）、基础信息、ESOP、报工采集项、质检方案等。 |
| **与工艺/工单的关系** | **开工单时以 SOP 为依据，产生对应的流程单据**（工序维度作业指导、参数收集项等）。工单/报工通过「物料 → 物料组 → SOP 绑定」或「工艺路线 + 工序 + SOP」等规则匹配 SOP，本计划保证 SOP 提供「绑定 + 工艺/BOM 载入 + 作业指导 + 参数收集项」及匹配规则约定。 |

### 2.2 最佳实践原则

- **极简**：必填项少、步骤清晰；优先「选已有」再「填新值」。  
- **智能默认**：选择物料组/工艺路线/BOM 时，可带出常用配置与采集项模板。  
- **模板与复制**：支持从模板创建、复制已有 SOP，便于同族产品复用。  
- **分阶段交付**：先基础信息 + 绑定 + 报工采集，再 ESOP 生成与质检方案。

---

## 3. SOP 能力架构（设想与最佳实践）

按「基础信息 → ESOP → 报工数据采集 → 质检方案」组织，并预留扩展。

### 3.1 基础信息（含「融合」输入）

| 能力项 | 说明 | 优先级建议 |
|--------|------|------------|
| **工艺路线绑定/载入** | 关联一条或多条已有工艺路线，作为「融合」输入，表达该 SOP 适用于哪些路线；不修改工艺路线结构。 | P0 |
| **BOM 载入** | 按关联物料/物料组或指定 BOM 版本载入，作为「融合」输入，用于领料参考与报工展示。 | P0 |
| **物料/物料组绑定** | 可绑定物料组或具体物料；具体物料优先。供工单/报工匹配「执行哪个 SOP」。 | P0 |
| **工站绑定** | SOP 可关联工站（工作中心/产线/工位）。 | 可选/后续 |
| **是否允许超报、报工是否审核、工时工价** | 超报开关、报工审核开关、标准工时/工价等。 | 可选/后续，按需迭代 |

### 3.2 ESOP 填写与生成

| 能力项 | 说明 | 优先级建议 |
|--------|------|------------|
| **步骤/流程编辑** | 沿用现有 ProFlow 设计器，维护作业步骤与顺序。 | 已有 |
| **富文本与附件** | 步骤说明、图纸、附件等，支撑「可执行作业指导」内容。 | 已有/增强 |
| **ESOP 生成与导出** | 支持按 SOP 生成可打印/可导出的作业指导（PDF、图片或电子看板视图）。 | P1 |

### 3.3 报工数据采集项设定

| 能力项 | 说明 | 优先级建议 |
|--------|------|------------|
| **采集项配置** | 即当前 `form_config` 的業務含义，统一命名为「报工数据采集项」；类型：数字（含单位、范围、默认值）、选择、文本、日期时间。 | P0 |
| **必填与校验** | 必填、范围、格式等在 SOP 上配置，报工提交时校验。 | P0 |
| **报工端按 SOP 展示** | 报工界面根据「工单/工序 + 物料 → 匹配 SOP」加载采集项配置并渲染表单、执行校验。 | P0（与报工计划协同） |

### 3.4 质检方案

| 能力项 | 说明 | 优先级建议 |
|--------|------|------------|
| **检验项与判定** | 关联检验项、抽检规则、合格/不合格判定标准等（可先做结构化配置预留或简单方案）。 | P2 |
| **与报工/质检单联动** | 报工或质检单可引用 SOP 质检方案，执行结果回写（具体在质检/报工计划中实现）。 | P2 |

---

## 4. 现状与差距

### 4.1 已有能力（可复用）

| 模块 | 现状 | 说明 |
|------|------|------|
| 制造SOP 菜单与路由 | ✅ 已有 | 主数据 → 工艺管理 → 制造SOP |
| SOP 列表与 CRUD | ✅ 已有 | 与工序（Operation）关联 |
| SOP 表单模型 | ✅ 已有 | `code / name / operation_id / form_config / flow_config / is_active` 等 |
| 报工参数表单设计 | ✅ 已有 | FormSchemaEditor + Formily，可承载「报工数据采集项」 |
| SOP 设计器 | ✅ 已有 | ProFlow 步骤/流程设计 |
| SOP 执行页 | ✅ 已有 | 按 SOP 执行与展示 |
| 工序/工艺路线/BOM | ✅ 已有 | 主数据已建设，本计划仅「引用」不改造 |

### 4.2 主要差距

| 差距项 | 方向 |
|--------|------|
| SOP = 工艺路线 + BOM 融合 | 在 SOP 内完成「工艺路线载入 + BOM 载入」，产出作业指导书与参数收集器；工单以 SOP 为依据产生流程单据。 |
| SOP 绑定物料/物料组 | 数据模型与 UI 支持「绑定物料组」或「绑定具体物料」，并约定优先级与匹配规则。 |
| 报工数据采集项（参数收集器） | 将 form_config 明确为「报工数据采集项」，类型与校验对齐；报工端与工单依据 SOP 拉取并渲染（与工单/报工计划协同）。 |
| ESOP 生成与导出 | 支持从 SOP 生成可打印/导出的作业指导（阶段二）。 |
| 工站、超报、审核、工时工价、质检 | 按需后续迭代，阶段一不做。 |

---

## 5. 开发阶段与功能点

### 5.1 阶段一：工艺路线+BOM 融合 + 两产出 + 工单依据 SOP（必选）

**目标**：SOP 作为「工艺路线与 BOM 的融合」主数据，产出**作业指导书（ESOP）**与**参数收集器（报工数据采集项）**；**开工单时以 SOP 为依据，产生对应的流程单据**。阶段一不做工站、超报、审核、工时工价、质检等扩展，避免过度设计。

| 序号 | 功能点 | 任务描述 | 验收标准 |
|------|--------|----------|----------|
| 1.1 | SOP 绑定物料组/物料 | 支持绑定物料组或具体物料；具体物料优先；列表/详情/编辑中可配置与展示。 | 可多选或单绑物料组/物料；保存与查询正确；匹配规则文档化。 |
| 1.2 | 工艺路线与 BOM 载入 | 工艺路线绑定/载入（可选一条或多条）、BOM 载入方式（按物料/物料组或指定 BOM）。与现有工序等字段共存，不改造工艺路线表结构。 | 配置持久化；列表/详情可展示；开工单时可依据 SOP 带出工序与指导内容。 |
| 1.3 | 报工数据采集项（参数收集器） | 将 form_config 明确为「报工数据采集项」；类型：数字（单位、范围、默认值）、选择、文本、日期时间；必填与校验可配置。 | 产品/界面文案统一；类型与校验在 SOP 编辑与报工展示中一致。 |
| 1.4 | 工单以 SOP 为依据生成流程单据 | 开工单时按「物料/物料组 → 匹配 SOP」得到工序维度的作业指导与参数收集项，生成对应的流程单据（与工单/报工计划协同实现）。报工端按 SOP 渲染采集项并校验。 | 有 SOP 时工单可带出作业指导与参数收集项；无 SOP 时走基础报工；校验失败有明确提示。 |
| 1.5 | 列表与筛选 | 按关联工序、绑定物料/物料组、工艺路线等筛选；详情可进入基础信息、采集项、ESOP 等子配置。 | 筛选生效；详情入口清晰。 |

### 5.2 阶段二：ESOP 生成与易用增强（推荐）

**目标**：支持 ESOP 导出/生成，以及模板、复制等易用能力。

| 序号 | 功能点 | 任务描述 | 验收标准 |
|------|--------|----------|----------|
| 2.1 | ESOP 生成与导出 | 基于当前 SOP 步骤与内容，生成可打印/导出的作业指导（如 PDF 或图片）。 | 支持一键生成与下载；格式满足现场使用。 |
| 2.2 | SOP 模板与复制 | 支持另存为模板、从模板创建、复制已有 SOP（名称/编码差异化）。 | 模板可复用；复制后可独立编辑。 |
| 2.3 | 报工采集项预设库 | 预设常用采集项（扭矩、外观检查、检验结果、包装数量等），勾选即用、可微调。 | 配置效率提升；与 form_config 兼容。 |
| 2.4 | 使用引导 | 首次进入或首次使用「报工数据采集项」时，可选简短引导。 | 不打扰老用户；新用户能快速理解。 |

### 5.3 阶段三：质检方案与扩展（可选 / PRO）

**目标**：质检方案结构化、与报工/质检联动；高级能力可放入 PRO。

| 序号 | 功能点 | 任务描述 | 验收标准 |
|------|--------|----------|----------|
| 3.1 | 质检方案配置 | 关联检验项、抽检规则、判定标准等；可先做表结构或 JSON 配置预留。 | 配置可保存；后续可与质检单/报工衔接。 |
| 3.2 | 版本与审批 | SOP 版本管理、变更审批（可选）。 | 按需验收。 |
| 3.3 | 工位机/触屏适配 | 报工采集项在工位机、触屏下布局与校验一致，触屏友好。 | 与报工端协同验收。 |

---

## 6. 验收标准汇总

### 6.1 融合与工单闭环

- SOP = 工艺路线与 BOM 的融合；两大产出：作业指导书（ESOP）、参数收集器（报工数据采集项）。  
- SOP 支持绑定物料组和/或具体物料，并约定具体物料优先；支持工艺路线载入、BOM 载入（不修改工艺路线/BOM 表结构）。  
- **开工单时以 SOP 为依据，产生对应的流程单据**（工序维度作业指导、参数收集项等）；报工端按 SOP 渲染采集项并校验。

### 6.2 报工数据采集项

- 「报工数据采集项」即 form_config 的业务含义，产品与界面表述一致。  
- 支持数字（含单位、范围、默认值）、选择、文本、日期时间及必填/校验。  
- 报工端能按「物料/工序 → 匹配 SOP → form_config」渲染表单并校验。

### 6.3 ESOP 与易用

- 支持从 SOP 生成可打印/导出的作业指导（阶段二）。  
- 支持模板与复制、采集项预设（阶段二）。

### 6.4 文档与命名

- 统一使用「制造SOP」「报工数据采集项」等命名；不出现「制造BOM」等旧称。  

---

## 7. 依赖与优先级

### 7.1 依赖关系

- **工序/工艺路线/BOM**：仅引用与展示，不改造；SOP 绑定「工艺路线」为关联关系，不改变工艺路线自身逻辑。  
- **工单与报工**：报工端「按物料/工序匹配 SOP 并展示采集项」需与工单/报工计划协同，本计划约定数据契约与验收口径。  
- **物料/物料组**：依赖主数据中物料与物料分组已存在，SOP 仅增加关联与查询。

### 7.2 建议优先级

| 优先级 | 内容 |
|--------|------|
| **P0** | 阶段一：工艺路线+BOM 载入与融合、SOP 绑定物料/物料组、作业指导书与参数收集器（form_config）、**工单以 SOP 为依据生成流程单据**、列表与筛选。 |
| **P1** | 阶段二：ESOP 生成与导出、SOP 模板与复制、报工采集项预设、使用引导。 |
| **P2 / 可选** | 工站、超报、审核、工时工价、质检方案、版本与审批、工位机/触屏适配等。 |

### 7.3 与其它计划的关系

- **工艺路线**：不改动表结构或交互；SOP 仅「绑定/载入」工艺路线，作为融合输入。  
- **工单/报工**：**开工单时以 SOP 为依据，产生对应的流程单据**。本计划保证 SOP 提供「绑定 + 工艺/BOM 载入 + 作业指导 + form_config」及匹配规则；工单侧依据 SOP 生成工序作业指导与参数收集项、报工页按 SOP 渲染与校验，归属工单/报工计划实现。  
- **BOM**：SOP 仅「载入/引用」BOM，不修改 BOM 模型或工程 BOM 设计器。  

---

**文档结束**

# 用户使用场景推演 - MTS/MTO模式完整流程

## 📋 推演概述

**目标：** 推演全新用户从0开始使用快智造系统的完整流程  
**场景：** MTS（按库存生产）和MTO（按订单生产）两种模式  
**原则：** 
- 🚀 **极致简化**：减少操作步骤，减少输入字段，提高效率
- 🚀 **一键操作**：关键操作支持一键完成
- 🚀 **批量处理**：支持批量操作，提高效率
- 🚀 **智能默认**：智能默认值，减少用户输入
- 🚀 **多终端支持**：支持移动端和工位机触屏模式，适应不同使用场景
- 🚀 **快速上手**：向导引导，快速上手

**用户角色：** 系统管理员、生产管理员、车间工人、仓库管理员、质量管理员、财务人员

**针对中国式中小企业痛点优化：**
- ✅ 一人多岗，操作要简单（减少操作步骤）
- ✅ 数据录入量大（批量导入优先）
- ✅ 对系统不熟悉（向导引导+智能默认值+内置帮助）
- ✅ 重视效率（一键操作+批量操作）
- ✅ 快速上手（行业模板+快速初始化+操作提示）
- ✅ 多终端使用（移动端和工位机触屏模式，适应不同使用场景）
- ✅ **降低上线失败风险**（数据验证+操作引导+进度跟踪+持续优化）

---

## 1. 系统初始化阶段（第1天，极致简化）

### 1.1 系统注册与登录（一键快速注册）

**用户操作（优化后）：**
1. 访问系统登录页面
2. 选择"快速注册"（或"组织注册"）
3. **极简注册表单**（仅必填项）：
   - 组织名称：XX制造有限公司（必填）
   - 手机号：13800138000（必填，用于登录和找回密码）
   - 验证码：123456（短信验证）
   - 密码：设置登录密码（必填）
   - **其他信息可选**：组织代码、联系人等（后续可补充）
4. 点击"立即注册"，系统自动：
   - 创建租户（Tenant）
   - 创建组织管理员账号（手机号即账号）
   - 分配默认权限和角色
   - 初始化默认菜单和系统参数
   - 进入快速初始化向导

**系统行为（优化后）：**
- ✅ 创建租户（Tenant）
- ✅ 创建组织管理员账号（手机号即账号，简化登录）
- ✅ 自动分配默认权限（生产管理员、仓库管理员等常用角色）
- ✅ 自动初始化默认菜单（常用功能菜单）
- ✅ 自动初始化默认系统参数（中文、人民币、北京时间等）
- ✅ **自动进入快速初始化向导**（引导用户完成基础配置）
- 🚀 **提供行业模板**（制造业通用模板，一键应用）

**验收标准：**
- ✅ 组织注册成功（3步完成，<1分钟）
- ✅ 组织管理员账号创建成功（手机号即账号）
- ✅ 登录成功，进入快速初始化向导
- ✅ 行业模板可选（制造业通用模板）

---

### 1.2 快速初始化向导（新增，一键完成基础配置）

**用户操作（优化后，极致简化）：**
1. **注册成功后自动进入快速初始化向导**
2. **第一步：选择行业模板**（可选，推荐）
   - 选择"制造业通用模板"（一键应用）
   - 或选择"跳过，手动配置"
3. **第二步：基础信息确认**（智能默认值）
   - 组织名称：已自动填充（注册时填写）
   - 默认货币：人民币（已默认）
   - 默认语言：中文（已默认）
   - 时区：北京时间（已默认）
   - **用户只需确认，无需修改**
4. **第三步：编码规则配置**（智能推荐）
   - 系统自动推荐编码规则格式（基于行业最佳实践）
   - 工单编码：`工单-{YYYYMMDD}-{序号}`（已默认，可修改）
   - 采购单编码：`采购-{YYYYMMDD}-{序号}`（已默认，可修改）
   - 销售订单编码：`订单-{YYYYMMDD}-{序号}`（已默认，可修改）
   - 入库单编码：`入库-{YYYYMMDD}-{序号}`（已默认，可修改）
   - 出库单编码：`出库-{YYYYMMDD}-{序号}`（已默认，可修改）
   - **用户只需确认，或一键应用推荐规则**
5. **第四步：完成初始化**
   - 点击"完成初始化"，进入工作台
   - 系统自动保存所有配置

**系统行为（优化后）：**
- ✅ **智能默认值**：所有配置项都有合理的默认值，用户只需确认
- ✅ **一键应用模板**：选择行业模板后，自动应用所有配置
- ✅ **记住用户习惯**：用户修改的配置会被记住，下次自动应用
- ✅ 保存系统参数（自动保存）
- ✅ 保存编码规则（自动保存）
- ✅ 验证编码规则格式（自动验证）
- 🤖 **AI智能建议**（通过Inngest AI工作流）：
  - 基于行业最佳实践，自动推荐编码规则格式
  - 检测配置完整性，提示缺失的关键配置项（非阻塞）
  - 提供配置优化建议（侧边栏提示，不打断流程）

**验收标准：**
- ✅ 快速初始化向导可用（3-5步完成，<2分钟）
- ✅ 行业模板可用（一键应用）
- ✅ 智能默认值正常（所有配置项都有默认值）
- ✅ 系统参数配置成功（自动保存）
- ✅ 编码规则配置成功（自动保存）
- ✅ AI建议正常显示（侧边栏提示，不打断操作流程）
- ✅ **内置帮助系统正常**（操作提示、帮助文档、操作视频）

**优化效果：**
- ⚡ **操作步骤减少**：从6步减少到3-5步（选择模板+确认+完成）
- ⚡ **时间缩短**：从10分钟减少到<2分钟
- ⚡ **学习成本降低**：向导引导，无需专业知识
- ⚡ **降低培训成本**：内置帮助系统，减少培训需求

---

## 2. 基础数据配置阶段（第2-3天）

### 2.1 组织架构配置（优化：批量导入+智能默认值）

**用户操作（优化后，极致简化）：**
1. **方式1：批量导入（推荐，中小企业常用）**
   - 进入"系统管理" → "组织架构" → "批量导入"
   - 打开universheet在线表格（包含部门、员工、角色模板）
   - 在universheet中填写数据（部门、员工、角色一次性填写，实时保存）
   - 点击"导入"按钮，系统自动：
     - 创建部门树形结构
     - 创建员工账号（手机号即账号）
     - 自动分配部门（基于universheet数据）
     - 自动分配角色和权限（基于universheet数据）
   - **完成，<5分钟**

2. **方式2：快速创建（小企业，<10人）**
   - 进入"系统管理" → "组织架构" → "快速创建"
   - 系统自动创建常用部门（生产部、质量部、仓储部、采购部、销售部）
   - 逐个添加员工（手机号+姓名+角色，3步完成）
   - 系统自动分配角色和权限（基于角色选择）

3. **方式3：手动创建（可选）**
   - 进入"系统管理" → "部门管理"
   - 创建部门（支持批量创建）
   - 进入"员工管理"
   - 创建员工账号（手机号即账号，自动生成密码）

**系统行为（优化后）：**
- ✅ **批量导入**：支持universheet在线表格批量导入部门、员工、角色（一次性完成，实时保存）
- ✅ **智能默认值**：创建员工时，自动填充默认角色和权限
- ✅ **手机号即账号**：员工账号使用手机号，简化登录
- ✅ **自动分配**：基于Excel数据或角色选择，自动分配部门和权限
- ✅ **记住用户习惯**：记住用户常用的部门和角色，下次自动推荐
- ✅ 创建部门树形结构
- ✅ 创建员工账号
- ✅ 分配部门
- ✅ 分配角色和权限

**验收标准：**
- ✅ 批量导入可用（universheet在线表格导入，一次性完成，实时保存）
- ✅ 快速创建可用（<10人企业，<5分钟完成）
- ✅ 部门树形结构创建成功
- ✅ 员工账号创建成功（手机号即账号）
- ✅ 员工分配到对应部门（自动分配）
- ✅ 角色和权限分配成功（自动分配）

**优化效果：**
- ⚡ **操作步骤减少**：从6步减少到1步（批量导入）或3步（快速创建）
- ⚡ **时间缩短**：从30分钟减少到<5分钟（批量导入）或<10分钟（快速创建）
- ⚡ **学习成本降低**：universheet在线表格，无需下载上传，实时保存，无需专业知识

---

### 2.2 工厂建模配置（主数据管理APP）

**用户操作：**
1. 进入"主数据管理" → "工厂建模" → "车间设置"
2. 创建车间：
   - 车间1：注塑车间
   - 车间2：组装车间
   - 车间3：包装车间
3. 进入"主数据管理" → "工厂建模" → "工作中心"
4. 创建工作中心：
   - 注塑车间：
     - 注塑机1（工作中心001）
     - 注塑机2（工作中心002）
   - 组装车间：
     - 组装线1（工作中心003）
     - 组装线2（工作中心004）
   - 包装车间：
     - 包装线1（工作中心005）

**系统行为：**
- ✅ 创建车间数据
- ✅ 创建工作中心数据
- ✅ 建立车间-工作中心关联关系

**验收标准：**
- ✅ 车间创建成功
- ✅ 工作中心创建成功
- ✅ 关联关系建立成功

---

### 2.3 物料主数据配置（主数据管理APP，优化：物料编码映射机制）

**用户操作（优化后，解决中小企业物料编码不统一问题）：**
1. **第一步：各部门分别导入物料数据（不中断业务）**
   - 进入"主数据管理" → "产品管理" → "物料主数据"
   - **方式1：分部门导入（推荐，解决编码不统一问题）**
     - **销售部门导入**：
       - 打开销售部门物料导入universheet在线表格（系统自动创建模板）
       - 在universheet中填写物料数据（使用销售部门编码：SALE-A001、SALE-A002等，实时保存）
       - 点击"导入"按钮，系统自动导入
     - **设计部门导入**：
       - 打开设计部门物料导入universheet在线表格（系统自动创建模板）
       - 在universheet中填写物料数据（使用设计部门编码：DES-A001、DES-A002等，实时保存）
       - 点击"导入"按钮，系统自动导入
     - **采购部门导入**：
       - 打开采购部门物料导入universheet在线表格（系统自动创建模板）
       - 在universheet中填写物料数据（使用采购部门编码：PUR-A001、PUR-A002等，实时保存）
       - 点击"导入"按钮，系统自动导入
     - **仓库部门导入**：
       - 打开仓库部门物料导入universheet在线表格（系统自动创建模板）
       - 在universheet中填写物料数据（使用仓库部门编码：WH-A001、WH-A002等，实时保存）
       - 点击"导入"按钮，系统自动导入
     - **生产部门导入**：
       - 打开生产部门物料导入universheet在线表格（系统自动创建模板）
       - 在universheet中填写物料数据（使用生产部门编码：PROD-A001、PROD-A002等，实时保存）
       - 点击"导入"按钮，系统自动导入
     - **系统自动处理**：
       - 自动生成主编码（MAT-FIN-0001、MAT-RAW-0001等，系统内部唯一标识）
       - 自动检测重复物料（基于物料名称、规格、单位等）
       - 自动提示可能的重复物料（不强制合并，业务可正常使用）
   
   - **方式2：统一导入（可选，已有统一编码）**
     - 打开统一物料导入universheet在线表格（系统自动创建模板）
     - 在universheet中填写物料数据（使用统一编码，实时保存）
     - 点击"导入"按钮，系统自动导入

2. **第二步：建立物料编码映射关系（渐进式整理）**
   - 进入"主数据管理" → "产品管理" → "物料编码映射"
   - **系统自动显示重复物料列表**（基于AI智能识别）：
     - 高置信度重复物料（名称+规格+单位完全一致）：自动合并提示
     - 中置信度重复物料（名称相似+规格相同）：提示管理员确认
     - 低置信度重复物料（名称相似但规格不同）：仅提示，不自动合并
   - **使用物料映射工具建立映射关系**：
     - 选择需要合并的物料（如：SALE-A001、DES-A001、PUR-A001）
     - 系统自动识别为同一物料（产品A）
     - 点击"建立映射关系"按钮
     - 系统自动：
       - 选择一个物料作为主物料（或创建新物料）
       - 其他物料作为别名，映射到主物料
       - 保留所有部门编码（客户编码、销售编码、设计编码、采购编码、仓库编码、生产编码等）
       - 合并物料属性（取并集，保留所有有用信息）
   - **业务不受影响**：
     - 各部门仍可使用原有编码（系统自动映射到主编码）
     - 历史数据可正常查询（使用部门编码搜索）
     - 新数据统一使用主编码存储

3. **第三步：配置物料属性**
   - 编辑物料，配置物料属性：
     - 物料名称、规格、单位
     - 物料类型（原材料/半成品/成品）
     - 默认仓库
     - 安全库存
     - **多单位管理**（核心功能，新增）：
       - **主单位**：设置物料的主单位（如：kg、个、m等）
       - **辅助单位**：可添加多个辅助单位（如：吨、箱、卷等）
       - **单位换算关系**：配置单位之间的换算比例
         - 示例1：塑料颗粒A
           - 主单位：kg（千克）
           - 辅助单位1：吨（1吨 = 1000kg）
           - 辅助单位2：g（1kg = 1000g）
         - 示例2：螺丝
           - 主单位：个
           - 辅助单位1：箱（1箱 = 1000个）
           - 辅助单位2：包（1包 = 100个）
         - 示例3：布料
           - 主单位：m（米）
           - 辅助单位1：卷（1卷 = 50m）
           - 辅助单位2：码（1码 = 0.9144m）
       - **单位使用场景**：
         - 采购单位：采购时使用的单位（如：吨、箱）
         - 库存单位：库存管理使用的单位（如：kg、个）
         - 生产单位：生产领料使用的单位（如：kg、个）
         - 销售单位：销售时使用的单位（如：箱、包）
       - **自动换算**：系统自动在不同单位间进行换算
     - **批号管理**（核心功能，新增）：
       - **启用批号管理**：勾选后启用批号管理功能
       - **批号规则**：配置批号生成规则
         - 方式1：手动输入批号（用户自定义）
         - 方式2：自动生成批号（系统自动生成）
           - 规则格式：`{YYYYMMDD}-{序号}`（如：20260115-001）
           - 规则格式：`{物料编码}-{YYYYMMDD}-{序号}`（如：MAT-RAW-0001-20260115-001）
           - 规则格式：`{供应商编码}-{YYYYMMDD}-{序号}`（如：SUP-001-20260115-001）
       - **批号属性**：
         - 生产日期（可选）
         - 有效期（可选，用于有保质期的物料）
         - 供应商批号（可选，记录供应商的批号）
         - 备注（可选）
       - **批号追溯**：支持批号追溯查询（查看批号的使用历史）
     - **序列号管理**（核心功能，新增）：
       - **启用序列号管理**：勾选后启用序列号管理功能
       - **序列号规则**：配置序列号生成规则
         - 方式1：手动输入序列号（用户自定义）
         - 方式2：自动生成序列号（系统自动生成）
           - 规则格式：`{物料编码}-{YYYYMMDD}-{6位序号}`（如：MAT-FIN-0001-20260115-000001）
           - 规则格式：`{物料编码}-{YYYY}-{6位序号}`（如：MAT-FIN-0001-2026-000001）
       - **序列号唯一性**：系统自动校验序列号唯一性
       - **序列号属性**：
         - 生产日期（可选）
         - 出厂日期（可选）
         - 供应商序列号（可选，记录供应商的序列号）
         - 备注（可选）
       - **序列号追溯**：支持序列号追溯查询（查看序列号的完整生命周期）
     - **部门编码映射**（自动显示，可编辑）：
       - 客户编码：CUS-A001（可选）
       - 销售编码：SALE-A001（可选）
       - 设计编码：DES-A001（可选）
       - 供应商编码：SUP-A001（可选）
       - 采购编码：PUR-A001（可选）
       - 仓库编码：WH-A001（可选）
       - 生产编码：PROD-A001（可选）

4. **第四步：创建BOM（使用universheet批量导入）**
   - 进入"主数据管理" → "产品管理" → "BOM管理"
   - 打开BOM导入universheet在线表格（系统自动创建模板）
   - 在universheet中创建BOM（支持使用任意部门编码，实时保存）：
     - **产品A的BOM：**
       ```
       产品A（1个，可使用SALE-A001或DES-A001或主编码MAT-FIN-0001）
       ├── 注塑件A（2个，可使用PROD-A001或主编码MAT-SEMI-0001）
       │   └── 塑料颗粒A（100g，可使用PUR-A001或主编码MAT-RAW-0001）
       ├── 注塑件B（1个，可使用PROD-A002或主编码MAT-SEMI-0002）
       │   └── 塑料颗粒B（50g，可使用PUR-A002或主编码MAT-RAW-0002）
       └── 螺丝（4个，可使用WH-A001或主编码MAT-RAW-0003）
       ```
   - **系统自动处理**：
     - 自动识别部门编码，映射到主编码
     - 自动验证BOM数据完整性（父子件关系）
     - 自动生成BOM层级结构

**系统行为（优化后）：**
- ✅ **物料编码映射机制**（核心功能，新增）
  - **主编码体系**：系统自动生成主编码（MAT-{类型}-{序号}），作为系统内部唯一标识
  - **部门编码保留**：各部门编码作为别名保留，业务可正常使用
  - **自动映射**：输入任意部门编码，系统自动映射到主编码
  - **智能识别重复物料**（核心功能，新增）：
    - 高置信度：名称+规格+单位完全一致，自动合并提示
    - 中置信度：名称相似+规格相同，提示管理员确认
    - 低置信度：名称相似但规格不同，仅提示不自动合并
    - 支持拼音匹配、模糊匹配、AI辅助识别
  - **物料映射工具**（核心功能，新增）：
    - 可视化合并重复物料
    - 建立编码映射关系
    - 保留所有部门编码作为别名
    - 合并物料属性（取并集）
- ✅ **多单位管理**（核心功能，新增）
  - **单位换算**：系统自动在不同单位间进行换算（基于配置的换算比例）
  - **单位选择**：在采购、入库、出库、生产等环节，支持选择不同单位
  - **自动换算**：
    - 采购时使用"吨"，系统自动换算为库存单位"kg"存储
    - 销售时使用"箱"，系统自动换算为库存单位"个"扣减
    - BOM中使用"kg"，系统自动换算为采购单位"吨"生成采购需求
  - **单位验证**：系统自动验证单位换算的合理性（防止换算错误）
  - **多单位库存显示**：库存查询时，支持同时显示多个单位的库存数量
- ✅ **批号管理**（核心功能，新增）
  - **批号生成**：支持手动输入或自动生成批号（基于配置的批号规则）
  - **批号唯一性校验**：同一物料在同一批号下，系统自动校验唯一性
  - **批号追溯**：
    - 支持查询批号的完整流转历史（入库→出库→生产→销售）
    - 支持查询批号的使用情况（哪些订单使用了该批号）
    - 支持查询批号的库存情况（当前库存中该批号的数量）
  - **批号有效期管理**：
    - 自动提醒即将过期的批号（基于有效期设置）
    - 自动阻止使用过期批号的物料（可配置）
    - 支持批号有效期查询和统计
  - **批号库存管理**：
    - 库存按批号分别管理（同一物料不同批号分别统计）
    - 出库时支持选择批号（先进先出FIFO、后进先出LIFO、指定批号）
    - 支持批号库存查询和统计
- ✅ **序列号管理**（核心功能，新增）
  - **序列号生成**：支持手动输入或自动生成序列号（基于配置的序列号规则）
  - **序列号唯一性校验**：系统自动校验序列号全局唯一性（跨物料唯一）
  - **序列号追溯**：
    - 支持查询序列号的完整生命周期（生产→入库→出库→销售→售后）
    - 支持查询序列号的使用情况（哪些订单使用了该序列号）
    - 支持查询序列号的当前状态（在库、已出库、已销售、已报废等）
  - **序列号库存管理**：
    - 库存按序列号分别管理（每个序列号单独记录）
    - 出库时必须指定序列号（精确到单个物料）
    - 支持序列号库存查询和统计
  - **序列号状态管理**：
    - 在库：序列号在仓库中
    - 已出库：序列号已出库但未销售
    - 已销售：序列号已销售给客户
    - 已报废：序列号已报废
    - 已退货：序列号已退货
- ✅ 批量导入物料数据（universheet在线表格，支持分部门导入，实时保存）
- ✅ 批量导入BOM数据（universheet在线表格，支持使用任意部门编码，实时保存）
- ✅ 验证物料数据完整性
- ✅ 验证BOM数据完整性（父子件关系）
- ✅ **多编码搜索**（核心功能，新增）：
  - 支持输入任意部门编码搜索物料
  - 支持物料名称拼音搜索
  - 支持模糊匹配搜索
- 🤖 **AI智能建议**（通过Inngest AI工作流）：
  - **智能识别重复物料**（核心功能，新增）：
    - 基于物料名称、规格、单位等多维度匹配
    - 基于拼音匹配、模糊匹配识别相似物料
    - 基于历史数据学习，提高识别准确率
    - 提供重复物料合并建议
  - **智能建议单位配置**（核心功能，新增）：
    - 基于物料类型，建议常用单位（如：原材料建议kg、吨，成品建议个、箱）
    - 基于历史数据，建议单位换算比例（如：基于采购历史，建议1箱=1000个）
    - 检测单位配置合理性（如：检测换算比例是否合理）
  - **智能建议批号规则**（核心功能，新增）：
    - 基于物料类型，建议批号规则（如：原材料建议使用供应商批号，成品建议使用生产日期）
    - 基于历史数据，建议批号格式（如：基于历史批号，建议批号格式）
  - **智能建议序列号规则**（核心功能，新增）：
    - 基于物料类型，建议序列号规则（如：成品建议使用序列号，原材料不建议使用）
    - 基于历史数据，建议序列号格式（如：基于历史序列号，建议序列号格式）
  - 检测物料数据完整性，提示缺失的关键字段（如：安全库存、默认仓库、单位配置、批号规则、序列号规则）
  - 分析BOM结构合理性，建议优化（如：检测循环依赖、建议BOM层级优化）
  - 基于历史数据，建议物料安全库存设置
  - 检测物料编码规范性，建议统一编码规则（非强制）

**验收标准：**
- ✅ **物料编码映射机制正常**（核心功能）
- ✅ **智能识别重复物料正常**（高/中/低置信度识别）
- ✅ **物料映射工具正常**（可视化合并重复物料）
- ✅ **多编码搜索正常**（支持输入任意部门编码搜索）
- ✅ **多单位管理正常**（核心功能，新增）
  - ✅ 单位换算功能正常（支持多单位间自动换算）
  - ✅ 单位选择功能正常（采购、入库、出库、生产等环节支持选择不同单位）
  - ✅ 多单位库存显示正常（库存查询时同时显示多个单位的库存数量）
  - ✅ 单位验证功能正常（自动验证单位换算的合理性）
- ✅ **批号管理正常**（核心功能，新增）
  - ✅ 批号生成功能正常（支持手动输入和自动生成）
  - ✅ 批号唯一性校验正常（同一物料在同一批号下唯一）
  - ✅ 批号追溯功能正常（支持查询批号的完整流转历史）
  - ✅ 批号有效期管理正常（自动提醒即将过期的批号）
  - ✅ 批号库存管理正常（库存按批号分别管理，支持批号选择）
- ✅ **序列号管理正常**（核心功能，新增）
  - ✅ 序列号生成功能正常（支持手动输入和自动生成）
  - ✅ 序列号唯一性校验正常（全局唯一性校验）
  - ✅ 序列号追溯功能正常（支持查询序列号的完整生命周期）
  - ✅ 序列号库存管理正常（库存按序列号分别管理，出库时必须指定序列号）
  - ✅ 序列号状态管理正常（支持序列号状态查询和更新）
- ✅ 物料数据导入成功（支持universheet在线表格批量导入，支持分部门导入，实时保存）
- ✅ BOM数据导入成功（支持universheet在线表格批量导入，支持使用任意部门编码，实时保存）
- ✅ 物料数据验证通过
- ✅ BOM数据验证通过（多层级BOM展开正常）
- ✅ AI建议正常显示（悬浮提示，不打断操作流程）

**优化效果：**
- ⚡ **解决编码不统一问题**：各部门可继续使用原有编码，系统自动映射
- ⚡ **不中断业务**：先导入后整理，业务可正常使用
- ⚡ **渐进式整理**：逐步建立映射关系，不强制一次性统一
- ⚡ **智能识别**：AI辅助识别重复物料，减少人工工作量
- ⚡ **灵活使用**：各部门可继续使用原有编码，系统自动映射到主编码
- ⚡ **多单位管理**：支持采购、库存、生产、销售使用不同单位，系统自动换算
- ⚡ **批号管理**：支持原材料和成品的批号管理，实现质量追溯和有效期管理
- ⚡ **序列号管理**：支持高价值物料的序列号管理，实现精确追溯和售后管理

---

### 2.3.1 多单位管理使用场景推演（新增）

**场景1：采购使用"吨"，库存使用"kg"**

**用户操作：**
1. **配置物料多单位**
   - 进入"主数据管理" → "产品管理" → "物料主数据"
   - 编辑物料：塑料颗粒A
   - 配置多单位：
     - 主单位：kg（库存单位）
     - 辅助单位1：吨（采购单位，1吨 = 1000kg）
     - 辅助单位2：g（1kg = 1000g）
   - 设置单位使用场景：
     - 采购单位：吨
     - 库存单位：kg
     - 生产单位：kg
     - 销售单位：kg

2. **采购入库（使用"吨"）**
   - 创建采购单：
     - 物料：塑料颗粒A
     - 数量：10
     - 单位：吨（系统自动显示）
     - 单价：5000元/吨
   - 采购到货后，创建入库单：
     - 物料：塑料颗粒A
     - 数量：10
     - 单位：吨（系统自动显示）
     - **系统自动换算**：10吨 = 10000kg（自动换算为库存单位）
   - 系统自动更新库存：塑料颗粒A，库存数量 = 10000kg

3. **生产领料（使用"kg"）**
   - 创建生产领料单：
     - 物料：塑料颗粒A
     - 数量：500
     - 单位：kg（系统自动显示）
   - 系统自动扣减库存：10000kg - 500kg = 9500kg

4. **库存查询（多单位显示）**
   - 查询物料：塑料颗粒A
   - 系统显示：
     - 库存数量：9500kg
     - 换算显示：9.5吨（自动换算显示）
     - 换算显示：9500000g（自动换算显示）

**系统行为：**
- ✅ 自动单位换算（采购单位"吨"自动换算为库存单位"kg"）
- ✅ 自动单位选择（不同环节自动显示对应单位）
- ✅ 多单位库存显示（库存查询时同时显示多个单位的库存数量）
- ✅ 单位验证（自动验证单位换算的合理性）

**验收标准：**
- ✅ 采购使用"吨"，系统自动换算为"kg"存储
- ✅ 生产领料使用"kg"，系统自动扣减库存
- ✅ 库存查询同时显示"kg"和"吨"
- ✅ 单位换算准确无误

---

**场景2：销售使用"箱"，库存使用"个"**

**用户操作：**
1. **配置物料多单位**
   - 编辑物料：螺丝
   - 配置多单位：
     - 主单位：个（库存单位）
     - 辅助单位1：箱（销售单位，1箱 = 1000个）
     - 辅助单位2：包（1包 = 100个）
   - 设置单位使用场景：
     - 采购单位：箱
     - 库存单位：个
     - 生产单位：个
     - 销售单位：箱

2. **采购入库（使用"箱"）**
   - 创建采购单：
     - 物料：螺丝
     - 数量：50
     - 单位：箱
     - 单价：200元/箱
   - 采购到货后，创建入库单：
     - 物料：螺丝
     - 数量：50
     - 单位：箱
     - **系统自动换算**：50箱 = 50000个（自动换算为库存单位）
   - 系统自动更新库存：螺丝，库存数量 = 50000个

3. **销售出库（使用"箱"）**
   - 创建销售订单：
     - 物料：螺丝
     - 数量：10
     - 单位：箱（系统自动显示）
   - 创建销售出库单：
     - 物料：螺丝
     - 数量：10
     - 单位：箱
     - **系统自动换算**：10箱 = 10000个（自动换算为库存单位）
   - 系统自动扣减库存：50000个 - 10000个 = 40000个

4. **库存查询（多单位显示）**
   - 查询物料：螺丝
   - 系统显示：
     - 库存数量：40000个
     - 换算显示：40箱（自动换算显示）
     - 换算显示：400包（自动换算显示）

**系统行为：**
- ✅ 自动单位换算（销售单位"箱"自动换算为库存单位"个"）
- ✅ 自动单位选择（销售环节自动显示"箱"，库存管理使用"个"）
- ✅ 多单位库存显示（库存查询时同时显示"个"、"箱"、"包"）

**验收标准：**
- ✅ 采购使用"箱"，系统自动换算为"个"存储
- ✅ 销售使用"箱"，系统自动换算为"个"扣减库存
- ✅ 库存查询同时显示"个"、"箱"、"包"
- ✅ 单位换算准确无误

---

### 2.3.2 批号管理使用场景推演（新增）

**场景1：原材料批号管理（有保质期）**

**用户操作：**
1. **配置物料批号管理**
   - 进入"主数据管理" → "产品管理" → "物料主数据"
   - 编辑物料：塑料颗粒A
   - 启用批号管理：
     - 批号规则：`{供应商编码}-{YYYYMMDD}-{序号}`（如：SUP-001-20260115-001）
     - 批号属性：生产日期、有效期（6个月）
   - 保存配置

2. **采购入库（自动生成批号）**
   - 创建采购单：
     - 物料：塑料颗粒A
     - 数量：10吨
     - 供应商：供应商A（编码：SUP-001）
   - 采购到货后，创建入库单：
     - 物料：塑料颗粒A
     - 数量：10吨
     - **系统自动生成批号**：SUP-001-20260115-001
     - 填写批号属性：
       - 生产日期：2026-01-10
       - 有效期：2026-07-10（系统自动计算：生产日期 + 6个月）
       - 供应商批号：SUP-BATCH-001（可选）
   - 系统自动更新库存：
     - 物料：塑料颗粒A
     - 批号：SUP-001-20260115-001
     - 库存数量：10000kg
     - 有效期：2026-07-10

3. **再次采购入库（不同批号）**
   - 创建入库单：
     - 物料：塑料颗粒A
     - 数量：5吨
     - **系统自动生成批号**：SUP-001-20260120-001
     - 填写批号属性：
       - 生产日期：2026-01-15
       - 有效期：2026-07-15
   - 系统自动更新库存：
     - 批号1：SUP-001-20260115-001，库存数量：10000kg，有效期：2026-07-10
     - 批号2：SUP-001-20260120-001，库存数量：5000kg，有效期：2026-07-15

4. **生产领料（选择批号，先进先出FIFO）**
   - 创建生产领料单：
     - 物料：塑料颗粒A
     - 数量：8000kg
     - **系统自动选择批号**（先进先出FIFO）：
       - 优先使用批号：SUP-001-20260115-001（先入库）
       - 使用数量：8000kg（从该批号扣减）
   - 系统自动扣减库存：
     - 批号1：SUP-001-20260115-001，库存数量：2000kg（10000kg - 8000kg）
     - 批号2：SUP-001-20260120-001，库存数量：5000kg（不变）

5. **批号追溯查询**
   - 进入"仓储管理" → "批号追溯"
   - 输入批号：SUP-001-20260115-001
   - 系统显示批号流转历史：
     - 2026-01-15 10:00：采购入库，数量：10000kg
     - 2026-01-16 14:30：生产领料，数量：8000kg，工单：WO-20260116-001
     - 当前库存：2000kg
     - 有效期：2026-07-10（剩余5个月）

6. **批号有效期提醒**
   - 系统自动检测即将过期的批号
   - 批号：SUP-001-20260115-001，有效期：2026-07-10，剩余5个月
   - 系统自动提醒：该批号即将在5个月后过期，建议优先使用

**系统行为：**
- ✅ 自动生成批号（基于配置的批号规则）
- ✅ 批号唯一性校验（同一物料在同一批号下唯一）
- ✅ 批号库存管理（库存按批号分别管理）
- ✅ 批号选择策略（支持先进先出FIFO、后进先出LIFO、指定批号）
- ✅ 批号追溯（支持查询批号的完整流转历史）
- ✅ 批号有效期管理（自动提醒即将过期的批号）

**验收标准：**
- ✅ 采购入库自动生成批号
- ✅ 库存按批号分别管理
- ✅ 生产领料自动选择批号（先进先出FIFO）
- ✅ 批号追溯查询正常
- ✅ 批号有效期提醒正常

---

**场景2：成品批号管理（质量追溯）**

**用户操作：**
1. **配置物料批号管理**
   - 编辑物料：产品A
   - 启用批号管理：
     - 批号规则：`{YYYYMMDD}-{序号}`（如：20260115-001）
     - 批号属性：生产日期、生产车间、生产班组

2. **生产入库（自动生成批号）**
   - 创建生产入库单：
     - 物料：产品A
     - 数量：1000个
     - **系统自动生成批号**：20260115-001
     - 填写批号属性：
       - 生产日期：2026-01-15
       - 生产车间：注塑车间
       - 生产班组：早班
   - 系统自动更新库存：
     - 物料：产品A
     - 批号：20260115-001
     - 库存数量：1000个

3. **销售出库（选择批号）**
   - 创建销售出库单：
     - 物料：产品A
     - 数量：500个
     - **选择批号**：20260115-001
   - 系统自动扣减库存：
     - 批号：20260115-001，库存数量：500个（1000个 - 500个）

4. **质量追溯（批号追溯）**
   - 客户反馈：批号20260115-001的产品有质量问题
   - 进入"质量管理" → "批号追溯"
   - 输入批号：20260115-001
   - 系统显示完整追溯信息：
     - **生产信息**：
       - 生产日期：2026-01-15
       - 生产车间：注塑车间
       - 生产班组：早班
       - 生产工单：WO-20260115-001
     - **原材料信息**：
       - 使用的原材料批号：SUP-001-20260115-001（塑料颗粒A）
       - 使用的原材料批号：SUP-002-20260110-001（注塑件A）
     - **销售信息**：
       - 销售订单：SO-20260116-001
       - 销售客户：客户A
       - 销售数量：500个
     - **库存信息**：
       - 当前库存：500个

**系统行为：**
- ✅ 自动生成批号（基于配置的批号规则）
- ✅ 批号追溯（支持查询批号的完整流转历史，包括生产、原材料、销售）
- ✅ 质量追溯（支持通过批号追溯质量问题）

**验收标准：**
- ✅ 生产入库自动生成批号
- ✅ 销售出库支持选择批号
- ✅ 批号追溯查询正常（包括生产、原材料、销售信息）
- ✅ 质量追溯功能正常

---

### 2.3.3 序列号管理使用场景推演（新增）

**场景1：成品序列号管理（精确追溯）**

**用户操作：**
1. **配置物料序列号管理**
   - 进入"主数据管理" → "产品管理" → "物料主数据"
   - 编辑物料：产品A（高价值成品，需要序列号管理）
   - 启用序列号管理：
     - 序列号规则：`{物料编码}-{YYYYMMDD}-{6位序号}`（如：MAT-FIN-0001-20260115-000001）
     - 序列号属性：生产日期、出厂日期、生产车间、检验员

2. **生产入库（自动生成序列号）**
   - 创建生产入库单：
     - 物料：产品A
     - 数量：100个
     - **系统自动生成序列号**：
       - MAT-FIN-0001-20260115-000001
       - MAT-FIN-0001-20260115-000002
       - ...（共100个序列号）
     - 填写序列号属性（批量填写）：
       - 生产日期：2026-01-15
       - 出厂日期：2026-01-16
       - 生产车间：注塑车间
       - 检验员：张三
   - 系统自动更新库存：
     - 物料：产品A
     - 序列号数量：100个
     - 每个序列号状态：在库

3. **销售出库（必须指定序列号）**
   - 创建销售订单：
     - 物料：产品A
     - 数量：10个
   - 创建销售出库单：
     - 物料：产品A
     - 数量：10个
     - **必须选择序列号**（系统显示可用序列号列表）：
       - MAT-FIN-0001-20260115-000001
       - MAT-FIN-0001-20260115-000002
       - ...（选择10个序列号）
   - 系统自动更新序列号状态：
     - 选中的10个序列号状态：已出库
     - 剩余90个序列号状态：在库

4. **序列号追溯查询**
   - 进入"仓储管理" → "序列号追溯"
   - 输入序列号：MAT-FIN-0001-20260115-000001
   - 系统显示序列号完整生命周期：
     - **生产信息**：
       - 生产日期：2026-01-15
       - 生产车间：注塑车间
       - 生产工单：WO-20260115-001
       - 检验员：张三
     - **入库信息**：
       - 入库日期：2026-01-16
       - 入库单：IN-20260116-001
       - 仓库：成品仓库
     - **出库信息**：
       - 出库日期：2026-01-20
       - 出库单：OUT-20260120-001
       - 销售订单：SO-20260120-001
     - **销售信息**：
       - 销售客户：客户A
       - 销售日期：2026-01-20
     - **当前状态**：已销售

5. **售后追溯（序列号查询）**
   - 客户反馈：序列号MAT-FIN-0001-20260115-000001的产品有问题
   - 进入"售后服务" → "序列号查询"
   - 输入序列号：MAT-FIN-0001-20260115-000001
   - 系统显示完整信息：
     - **产品信息**：产品A
     - **生产信息**：生产日期、生产车间、检验员
     - **销售信息**：销售客户、销售日期、销售订单
     - **原材料追溯**：
       - 使用的原材料批号：SUP-001-20260115-001（塑料颗粒A）
       - 使用的原材料批号：SUP-002-20260110-001（注塑件A）

**系统行为：**
- ✅ 自动生成序列号（基于配置的序列号规则）
- ✅ 序列号唯一性校验（全局唯一性校验）
- ✅ 序列号库存管理（库存按序列号分别管理）
- ✅ 序列号状态管理（在库、已出库、已销售、已报废、已退货）
- ✅ 序列号追溯（支持查询序列号的完整生命周期）
- ✅ 售后追溯（支持通过序列号追溯售后问题）

**验收标准：**
- ✅ 生产入库自动生成序列号
- ✅ 销售出库必须指定序列号
- ✅ 序列号追溯查询正常（包括生产、入库、出库、销售信息）
- ✅ 售后追溯功能正常

---

**场景2：设备序列号管理（资产追溯）**

**用户操作：**
1. **配置物料序列号管理**
   - 编辑物料：注塑机（设备类物料）
   - 启用序列号管理：
     - 序列号规则：`{供应商编码}-{YYYY}-{6位序号}`（如：SUP-001-2026-000001）
     - 序列号属性：出厂日期、供应商序列号、设备型号

2. **采购入库（手动输入序列号）**
   - 创建采购入库单：
     - 物料：注塑机
     - 数量：1台
     - **手动输入序列号**：SUP-001-2026-000001（供应商提供的序列号）
     - 填写序列号属性：
       - 出厂日期：2026-01-10
       - 供应商序列号：SUP-SN-2026-001
       - 设备型号：ZSJ-500
   - 系统自动更新库存：
     - 物料：注塑机
     - 序列号：SUP-001-2026-000001
     - 状态：在库

3. **设备领用（指定序列号）**
   - 创建设备领用单：
     - 物料：注塑机
     - 数量：1台
     - **必须选择序列号**：SUP-001-2026-000001
     - 领用部门：注塑车间
   - 系统自动更新序列号状态：
     - 序列号：SUP-001-2026-000001
     - 状态：已领用
     - 领用部门：注塑车间

4. **设备追溯查询**
   - 进入"资产管理" → "设备追溯"
   - 输入序列号：SUP-001-2026-000001
   - 系统显示设备完整信息：
     - **设备信息**：
       - 设备型号：ZSJ-500
       - 出厂日期：2026-01-10
       - 供应商序列号：SUP-SN-2026-001
     - **采购信息**：
       - 采购日期：2026-01-15
       - 采购单：PO-20260115-001
       - 供应商：供应商A
     - **领用信息**：
       - 领用日期：2026-01-20
       - 领用部门：注塑车间
     - **维护记录**：
       - 2026-02-01：日常维护
       - 2026-03-01：定期保养
     - **当前状态**：使用中

**系统行为：**
- ✅ 支持手动输入序列号（供应商提供的序列号）
- ✅ 序列号唯一性校验（全局唯一性校验）
- ✅ 序列号状态管理（在库、已领用、使用中、已报废）
- ✅ 设备追溯（支持查询设备的完整生命周期）

**验收标准：**
- ✅ 采购入库支持手动输入序列号
- ✅ 设备领用必须指定序列号
- ✅ 设备追溯查询正常（包括采购、领用、维护信息）
- ✅ 序列号状态管理正常

---

### 2.4 工序和工艺路线配置（主数据管理APP，新增）

**用户操作（优化后，极致简化）：**
1. **第一步：创建工序（基础工序库）**
   - 进入"主数据管理" → "工艺管理" → "工序管理"
   - **方式1：批量导入（推荐）**
     - 打开工序导入universheet在线表格（系统自动创建模板）
     - 在universheet中填写工序数据（实时保存）：
       - 工序编码、工序名称、工序描述
       - 所属车间、工作中心
       - **工序类型**（核心功能，新增）：
         - 按数量报工：需要输入完成数量、合格数量（如：注塑、组装、包装）
         - 按状态报工：只有完成/未完成状态，无数量概念（如：检验、测试、审批）
       - 标准工时、准备时间
       - **是否允许跳转**（核心功能，新增）：
         - 不允许跳转：必须完成上道工序才能开始下道工序（默认）
         - 允许跳转：可以并行进行，不依赖上道工序完成
       - **默认物料分组**（核心功能，新增）：
         - 可选择物料分组（如：注塑件分组、组装件分组）
         - 同一分组的物料默认使用相同工艺路线
     - 点击"导入"按钮，系统自动创建工序
   - **方式2：快速创建（小企业）**
     - 点击"新建"按钮
     - 填写工序信息：
       - 工序编码：OP001
       - 工序名称：注塑
       - 所属车间：注塑车间
       - 工作中心：注塑机1
       - **工序类型**：按数量报工（需要输入完成数量、合格数量）
       - **是否允许跳转**：不允许跳转（必须完成上道工序）
       - **默认物料分组**：注塑件分组（可选）
       - 标准工时：10分钟/件
     - 提交创建
   - **常用工序示例**：
     - 注塑工序（注塑车间，按数量报工，不允许跳转）
     - 组装工序（组装车间，按数量报工，不允许跳转）
     - 包装工序（包装车间，按数量报工，不允许跳转）
     - 检验工序（质量部，按状态报工，允许跳转）
     - 测试工序（测试部，按状态报工，允许跳转）
     - 审批工序（管理部，按状态报工，允许跳转）

2. **第二步：创建工艺路线（两种模式）**
   - 进入"主数据管理" → "工艺管理" → "工艺路线管理"
   - **方式1：简易路线（推荐，中小企业常用）**
     - 点击"新建" → 选择"简易路线"
     - **绑定物料或物料分组**（核心功能，新增，参考黑湖小工单）：
       - 方式A：绑定物料分组（推荐，批量管理）
         - 选择绑定类型：物料分组
         - 选择物料分组：注塑件分组（包含产品A、产品B、产品C）
         - 保存绑定关系
       - 方式B：绑定单个物料（精确控制）
         - 选择绑定类型：物料
         - 选择物料：产品A
         - 保存绑定关系
       - **注意**：物料优先级大于物料分组，如果物料单独绑定了工艺路线，优先使用物料绑定的工艺路线
     - 拖拽工序设置顺序：
       ```
       工序1：注塑工序（注塑车间，注塑机1，按数量报工，不允许跳转）
       工序2：组装工序（组装车间，组装线1，按数量报工，不允许跳转）
       工序3：包装工序（包装车间，包装线1，按数量报工，不允许跳转）
       ```
     - **设置工序跳转规则**（核心功能，新增）：
       - 工序1：不允许跳转（必须完成上道工序才能开始）
       - 工序2：不允许跳转（必须完成工序1才能开始）
       - 工序3：不允许跳转（必须完成工序2才能开始）
     - 设置每个工序的标准工时和准备时间
     - **支持子工艺路线**（核心功能，新增）：
       - 可以为某个工序设置子工艺路线（如：组装工序的子工艺路线）
       - 子工艺路线可以独立管理，支持嵌套
     - 提交创建
     - **完成，<5分钟**
   
   - **方式2：带SOP工艺路线（可选，有SOP需求的企业）**
     - 点击"新建" → 选择"带SOP工艺路线"
     - **绑定物料或物料分组**（核心功能，新增，参考黑湖小工单）：
       - 方式A：绑定物料分组（推荐，批量管理）
         - 选择绑定类型：物料分组
         - 选择物料分组：注塑件分组（包含产品A、产品B、产品C）
         - 保存绑定关系
       - 方式B：绑定单个物料（精确控制）
         - 选择绑定类型：物料
         - 选择物料：产品A
         - 保存绑定关系
       - **注意**：物料优先级大于物料分组，如果物料单独绑定了工艺路线，优先使用物料绑定的工艺路线
     - 拖拽工序设置顺序（同简易路线）
     - **设置工序类型和跳转规则**（核心功能，新增）：
       - 工序1：注塑工序（按数量报工，不允许跳转）
       - 工序2：组装工序（按数量报工，不允许跳转）
       - 工序3：检验工序（按状态报工，允许跳转，可与组装并行）
       - 工序4：包装工序（按数量报工，不允许跳转）
     - **为每个工序关联SOP**：
       - 工序1：注塑工序 → 关联SOP《注塑作业标准》
       - 工序2：组装工序 → 关联SOP《组装作业标准》
       - 工序3：检验工序 → 关联SOP《检验作业标准》
       - 工序4：包装工序 → 关联SOP《包装作业标准》
     - **SOP设计时指定收集参数**（核心功能，新增）：
       - 进入"主数据管理" → "工艺管理" → "SOP管理"
       - 编辑SOP：组装工序SOP《组装作业标准》
       - 进入"报工参数收集"配置页面
       - **配置参数收集表单**（Formily表单设计器）：
         - 参数1：扭矩
           - 参数类型：数字
           - 参数名称：扭矩
           - 单位：N·m
           - 必填：是
           - 验证规则：范围20-30
           - 默认值：25
         - 参数2：外观检查
           - 参数类型：选择
           - 参数名称：外观检查
           - 选项：是/否
           - 必填：是
         - 参数3：备注
           - 参数类型：文本
           - 参数名称：备注
           - 必填：否
       - 保存SOP配置（form_config自动保存）
       - **其他SOP同样配置**：
         - 注塑工序SOP：温度（数字，范围180-200）、压力（数字，范围50-80）、时间（数字）
         - 检验工序SOP：检验结果（选择：合格/不合格）、检验员（文本）
         - 包装工序SOP：包装数量（数字）、标签检查（是/否）
     - **支持子工艺路线**（核心功能，新增）：
       - 可以为某个工序设置子工艺路线（如：组装工序的子工艺路线）
       - 子工艺路线示例：
         ```
         主工艺路线：产品A工艺路线
         ├── 工序1：注塑工序
         ├── 工序2：组装工序
         │   └── 子工艺路线：组装子工艺路线
         │       ├── 子工序1：预组装（按数量报工）
         │       ├── 子工序2：主组装（按数量报工）
         │       └── 子工序3：紧固（按状态报工）
         ├── 工序3：检验工序（按状态报工，允许跳转）
         └── 工序4：包装工序
         ```
     - 设置每个工序的标准工时和准备时间
     - 提交创建
     - **完成，<10分钟**

3. **第三步：关联产品工艺路线（支持物料分组和物料绑定，参考黑湖小工单实现）**
   - **方式1：工艺路线绑定物料分组**（推荐，批量管理）
     - 进入"主数据管理" → "工艺管理" → "工艺路线管理"
     - 编辑工艺路线：注塑件通用工艺路线
     - 进入"绑定物料"页面
     - 选择绑定类型：物料分组
     - 选择物料分组：注塑件分组（包含产品A、产品B、产品C）
     - 保存绑定关系
     - **系统自动应用**：
       - 注塑件分组下的所有物料（产品A、产品B、产品C）自动关联该工艺路线
       - 创建工单时，如果物料没有单独绑定工艺路线，则自动使用分组绑定的工艺路线
   
   - **方式2：工艺路线绑定单个物料**（精确控制，优先级高于物料分组）
     - 进入"主数据管理" → "工艺管理" → "工艺路线管理"
     - 编辑工艺路线：产品A专用工艺路线
     - 进入"绑定物料"页面
     - 选择绑定类型：物料
     - 选择物料：产品A
     - 保存绑定关系
     - **系统自动应用**：
       - 产品A优先使用"产品A专用工艺路线"（即使产品A属于注塑件分组，也优先使用物料绑定的工艺路线）
       - 创建工单时，如果物料有单独绑定的工艺路线，优先使用物料绑定的工艺路线（物料优先级大于物料分组）
   
   - **方式3：在物料主数据中直接关联**（传统方式，兼容保留）
     - 进入"主数据管理" → "产品管理" → "物料主数据"
     - 编辑产品：产品A
     - 选择默认工艺路线：产品A工艺路线
     - 保存
   
   - **优先级规则**（核心功能，参考黑湖小工单）：
     - **物料绑定 > 物料分组绑定**：如果物料同时绑定了工艺路线，且物料所属的分组也绑定了工艺路线，优先使用物料绑定的工艺路线
     - **自动继承**：如果物料没有单独绑定工艺路线，但所属分组绑定了工艺路线，则自动使用分组绑定的工艺路线
     - **创建工单时自动匹配**：新建工单选择物料后，系统自动按优先级匹配工艺路线（物料绑定 → 物料分组绑定）

**系统行为（优化后）：**
- ✅ **批量导入工序**：支持universheet在线表格批量导入工序（一次性完成，实时保存）
- ✅ **工序类型管理**（核心功能，新增）：
  - **按数量报工**：需要输入完成数量、合格数量（如：注塑、组装、包装）
  - **按状态报工**：只有完成/未完成状态，无数量概念（如：检验、测试、审批）
  - 报工时根据工序类型自动显示对应的报工界面
- ✅ **工序跳转控制**（核心功能，新增）：
  - **不允许跳转**：必须完成上道工序才能开始下道工序（默认）
  - **允许跳转**：可以并行进行，不依赖上道工序完成
  - 工单执行时，系统自动校验工序跳转规则
  - 不允许跳转的工序，必须等待上道工序完成才能报工
  - 允许跳转的工序，可以随时报工（不依赖上道工序）
- ✅ **工艺路线绑定物料分组或物料**（核心功能，新增，参考黑湖小工单）：
  - **工艺路线可绑定物料分组**：同一分组的物料自动使用相同工艺路线，减少重复配置
  - **工艺路线可绑定单个物料**：支持为特定物料绑定专用工艺路线，精确控制
  - **物料优先级大于物料分组**：如果物料同时绑定了工艺路线，且物料所属的分组也绑定了工艺路线，优先使用物料绑定的工艺路线
  - **自动继承机制**：如果物料没有单独绑定工艺路线，但所属分组绑定了工艺路线，则自动使用分组绑定的工艺路线
  - **创建工单时自动匹配**：新建工单选择物料后，系统自动按优先级匹配工艺路线（物料绑定 → 物料分组绑定）
  - 支持物料分组管理（创建分组、添加物料到分组、设置分组工艺路线）
- ✅ **子工艺路线支持**（核心功能，新增）：
  - 支持为某个工序设置子工艺路线
  - 子工艺路线可以独立管理，支持嵌套
  - 子工艺路线可以有自己的工序顺序、SOP、跳转规则
  - 报工时，先完成子工艺路线的所有工序，才能完成主工序
- ✅ **简易路线**：支持创建简易工艺路线（仅工序顺序，无SOP）
- ✅ **带SOP工艺路线**：支持创建带SOP的工艺路线（工序+SOP）
- ✅ **SOP参数收集配置**：SOP设计时可指定报工时需要收集的参数（核心功能，新增）
  - 支持数字、文本、选择、日期等参数类型
  - 支持参数必填/可选设置
  - 支持参数验证规则（范围、格式等）
- ✅ **拖拽排序**：支持拖拽调整工序顺序（可视化操作）
- ✅ **智能默认值**：创建工艺路线时，自动填充标准工时（基于工序）
- ✅ **关联产品**：工艺路线可关联到产品，工单创建时自动应用
- ✅ **关联物料分组**：工艺路线可关联到物料分组，同一分组的产品自动应用（核心功能，新增）
- ✅ 创建工序数据
- ✅ 创建工艺路线数据
- ✅ 建立工序-工艺路线关联关系
- 🤖 **AI智能建议**（通过Inngest AI工作流）：
  - 检测工序配置完整性，提示缺失的关键字段（如：标准工时、工作中心、工序类型、跳转规则）
  - 分析工艺路线合理性，建议优化（如：检测工序顺序合理性、建议并行工序、建议设置跳转规则）
  - 基于历史数据，建议标准工时设置
  - **智能建议工序类型**（核心功能，新增）：
    - 基于工序名称，建议工序类型（如：检验、测试建议按状态报工）
    - 基于历史数据，分析工序类型使用情况
  - **智能建议跳转规则**（核心功能，新增）：
    - 基于工序类型，建议跳转规则（如：检验工序建议允许跳转）
    - 基于历史数据，分析工序并行情况

**验收标准：**
- ✅ 工序创建成功（支持universheet在线表格批量导入，实时保存）
- ✅ **工序类型配置成功**（核心功能，新增）：
  - ✅ 按数量报工工序配置成功（需要输入完成数量、合格数量）
  - ✅ 按状态报工工序配置成功（只有完成/未完成状态）
  - ✅ 报工时根据工序类型自动显示对应的报工界面
- ✅ **工序跳转规则配置成功**（核心功能，新增）：
  - ✅ 不允许跳转配置成功（必须完成上道工序才能开始下道工序）
  - ✅ 允许跳转配置成功（可以并行进行）
  - ✅ 工单执行时，系统自动校验工序跳转规则
- ✅ **工艺路线绑定物料分组或物料成功**（核心功能，新增，参考黑湖小工单）：
  - ✅ 工艺路线可以绑定到物料分组（批量管理）
  - ✅ 工艺路线可以绑定到单个物料（精确控制）
  - ✅ 物料优先级大于物料分组（如果物料绑定了工艺路线，优先使用物料绑定的工艺路线）
  - ✅ 自动继承机制正常（如果物料没有绑定，但所属分组绑定了工艺路线，自动使用分组绑定的工艺路线）
  - ✅ 创建工单时，自动匹配工艺路线成功（物料绑定 → 物料分组绑定）
- ✅ **子工艺路线配置成功**（核心功能，新增）：
  - ✅ 支持为某个工序设置子工艺路线
  - ✅ 子工艺路线可以独立管理，支持嵌套
  - ✅ 报工时，先完成子工艺路线的所有工序，才能完成主工序
- ✅ 简易路线创建成功（工序顺序配置）
- ✅ 带SOP工艺路线创建成功（工序+SOP关联）
- ✅ **SOP参数收集配置成功**（SOP设计时指定收集参数）
- ✅ 工艺路线关联产品成功（工单创建时自动应用）
- ✅ 工艺路线关联物料分组成功（同一分组的产品自动应用）
- ✅ 拖拽排序正常（可视化调整工序顺序）
- ✅ AI建议正常显示（悬浮提示，不打断操作流程）

**优化效果：**
- ⚡ **操作步骤减少**：批量导入工序，一次性完成
- ⚡ **时间缩短**：简易路线<5分钟，带SOP路线<10分钟
- ⚡ **学习成本降低**：拖拽操作，直观易懂
- ⚡ **工序类型灵活**：支持按数量报工和按状态报工，适应不同工序特点
- ⚡ **跳转控制精确**：支持工序跳转规则，灵活控制工序执行顺序
- ⚡ **物料分组管理**：同一分组使用相同工艺路线，减少重复配置
- ⚡ **子工艺路线支持**：支持复杂工艺路线，满足嵌套工艺需求

---

### 2.4.1 工序类型和跳转规则使用场景推演（新增）

**场景1：按数量报工 vs 按状态报工**

**用户操作：**
1. **配置按数量报工工序**
   - 创建工序：注塑工序
   - 工序类型：按数量报工
   - 报工时需要输入：完成数量、合格数量
   - 保存

2. **配置按状态报工工序**
   - 创建工序：检验工序
   - 工序类型：按状态报工
   - 报工时只需要选择：完成/未完成
   - 保存

3. **报工时的区别**
   - **注塑工序报工**（按数量报工）：
     - 进入报工界面
     - 系统显示：完成数量、合格数量输入框
     - 输入：完成数量100个，合格数量95个
     - 提交报工
   - **检验工序报工**（按状态报工）：
     - 进入报工界面
     - 系统显示：完成状态选择（完成/未完成）
     - 选择：完成
     - 提交报工

**系统行为：**
- ✅ 按数量报工工序，报工时显示数量输入框
- ✅ 按状态报工工序，报工时显示状态选择框
- ✅ 系统根据工序类型自动显示对应的报工界面

**验收标准：**
- ✅ 按数量报工工序报工界面正常（显示数量输入框）
- ✅ 按状态报工工序报工界面正常（显示状态选择框）
- ✅ 报工数据保存正确（数量或状态）

---

**场景2：工序跳转规则（不允许跳转 vs 允许跳转）**

**用户操作：**
1. **配置不允许跳转的工艺路线**
   - 创建工艺路线：产品A工艺路线
   - 工序顺序：
     - 工序1：注塑工序（不允许跳转）
     - 工序2：组装工序（不允许跳转）
     - 工序3：包装工序（不允许跳转）
   - 保存

2. **配置允许跳转的工艺路线**
   - 创建工艺路线：产品B工艺路线
   - 工序顺序：
     - 工序1：注塑工序（不允许跳转）
     - 工序2：组装工序（不允许跳转）
     - 工序3：检验工序（允许跳转，可与组装并行）
     - 工序4：包装工序（不允许跳转）
   - 保存

3. **工单执行时的区别**
   - **产品A工单执行**（不允许跳转）：
     - 必须先完成工序1（注塑），才能开始工序2（组装）
     - 必须先完成工序2（组装），才能开始工序3（包装）
     - 如果工序1未完成，无法报工工序2
   - **产品B工单执行**（允许跳转）：
     - 必须先完成工序1（注塑），才能开始工序2（组装）
     - 工序2（组装）和工序3（检验）可以并行进行（允许跳转）
     - 必须先完成工序2和工序3，才能开始工序4（包装）

**系统行为：**
- ✅ 不允许跳转的工序，必须等待上道工序完成才能报工
- ✅ 允许跳转的工序，可以随时报工（不依赖上道工序）
- ✅ 系统自动校验工序跳转规则，阻止不符合规则的报工

**验收标准：**
- ✅ 不允许跳转规则生效（必须完成上道工序才能开始下道工序）
- ✅ 允许跳转规则生效（可以并行进行）
- ✅ 系统自动校验跳转规则，阻止不符合规则的报工

---

### 2.4.2 物料分组绑定使用场景推演（新增）

**场景：同一分组使用相同工艺路线**

**用户操作：**
1. **创建物料分组**
   - 进入"主数据管理" → "产品管理" → "物料分组管理"
   - 点击"新建"按钮
   - 填写分组信息：
     - 分组编码：GROUP-001
     - 分组名称：注塑件分组
     - 分组描述：所有注塑件产品
   - 保存

2. **添加物料到分组**
   - 编辑分组：注塑件分组
   - 添加物料：
     - 产品A（注塑件）
     - 产品B（注塑件）
     - 产品C（注塑件）
   - 保存

3. **为分组设置默认工艺路线**
   - 编辑分组：注塑件分组
   - 选择默认工艺路线：注塑件通用工艺路线
   - 保存

4. **创建工单时的自动应用**
   - 创建工单：产品A工单
   - 系统自动检测：产品A属于"注塑件分组"
   - 系统自动应用：注塑件通用工艺路线
   - 如果产品A有单独工艺路线，优先使用产品工艺路线（可覆盖分组工艺路线）

5. **批量应用工艺路线**
   - 编辑分组：注塑件分组
   - 修改默认工艺路线：注塑件新工艺路线
   - 保存
   - 系统提示：是否更新所有已创建工单的工艺路线？
   - 选择：是
   - 系统自动更新：所有使用该分组的工单工艺路线

**系统行为：**
- ✅ 物料分组创建成功
- ✅ 物料添加到分组成功
- ✅ 分组工艺路线设置成功
- ✅ 创建工单时，优先使用产品工艺路线，如果没有则使用分组工艺路线
- ✅ 支持批量更新分组工艺路线

**验收标准：**
- ✅ 物料分组创建成功
- ✅ 物料添加到分组成功
- ✅ 分组工艺路线设置成功
- ✅ 创建工单时自动应用分组工艺路线
- ✅ 产品工艺路线优先于分组工艺路线
- ✅ 批量更新分组工艺路线成功

---

### 2.4.3 子工艺路线使用场景推演（新增）

**场景：组装工序的子工艺路线**

**用户操作：**
1. **创建主工艺路线**
   - 创建工艺路线：产品A工艺路线
   - 工序顺序：
     - 工序1：注塑工序
     - 工序2：组装工序（需要设置子工艺路线）
     - 工序3：包装工序

2. **创建子工艺路线**
   - 编辑工序：组装工序
   - 点击"设置子工艺路线"按钮
   - 创建子工艺路线：组装子工艺路线
   - 子工序顺序：
     - 子工序1：预组装（按数量报工）
     - 子工序2：主组装（按数量报工）
     - 子工序3：紧固（按状态报工）
   - 保存子工艺路线

3. **工单执行时的流程**
   - 创建工单：产品A工单
   - 系统显示工艺路线：
     ```
     工序1：注塑工序
     工序2：组装工序
       └── 子工序1：预组装
       └── 子工序2：主组装
       └── 子工序3：紧固
     工序3：包装工序
     ```
   - **报工流程**：
     - 先完成工序1（注塑）
     - 开始工序2（组装）
     - 必须先完成子工序1（预组装）
     - 然后完成子工序2（主组装）
     - 然后完成子工序3（紧固）
     - 所有子工序完成后，才能完成主工序2（组装）
     - 最后完成工序3（包装）

4. **嵌套子工艺路线（可选）**
   - 编辑子工序：主组装
   - 点击"设置子工艺路线"按钮
   - 创建嵌套子工艺路线：主组装子工艺路线
   - 嵌套子工序顺序：
     - 嵌套子工序1：部件A组装
     - 嵌套子工序2：部件B组装
     - 嵌套子工序3：部件连接
   - 保存嵌套子工艺路线

**系统行为：**
- ✅ 支持为某个工序设置子工艺路线
- ✅ 子工艺路线可以独立管理，支持嵌套
- ✅ 报工时，先完成子工艺路线的所有工序，才能完成主工序
- ✅ 支持多层嵌套子工艺路线

**验收标准：**
- ✅ 子工艺路线创建成功
- ✅ 子工艺路线报工流程正常（先完成子工序，再完成主工序）
- ✅ 嵌套子工艺路线支持正常（多层嵌套）
- ✅ 子工艺路线独立管理正常

---

### 2.4.4 工艺路线版本管理（核心功能，新增）

**应用场景：**
- 工艺路线需要版本管理，支持变更追溯
- 不同版本工艺路线可以同时使用（不同产品使用不同版本）
- 支持工艺路线版本对比和回退
- 支持工艺路线版本对在制工单的影响分析

**用户操作：**
1. **创建工艺路线新版本**
   - 进入"主数据管理" → "工艺管理" → "工艺路线管理"
   - 选择工艺路线：产品A工艺路线（当前版本：V1.0）
   - 点击"创建新版本"按钮
   - **系统自动处理**：
     - 自动创建新版本：V1.1（基于V1.0）
     - 自动复制V1.0的所有工序和配置
     - 自动填充版本信息：
       - 版本号：V1.1（自动生成）
       - 基于版本：V1.0（自动关联）
       - 创建时间：2026-01-15（自动记录）
       - 创建人：张三（自动填充）
   - **修改新版本工艺路线**：
     - 修改工序：增加检验工序（在组装工序后）
     - 修改标准工时：组装工序标准工时从15分钟改为12分钟
     - 保存新版本

2. **工艺路线版本对比**（核心功能，新增）
   - 进入"主数据管理" → "工艺管理" → "工艺路线管理" → "版本对比"
   - 选择工艺路线：产品A工艺路线
   - 选择对比版本：V1.0 vs V1.1
   - **系统自动显示版本对比**：
     - **工序对比**：
       - V1.0：注塑工序 → 组装工序 → 包装工序（3个工序）
       - V1.1：注塑工序 → 组装工序 → 检验工序 → 包装工序（4个工序）
       - 差异：V1.1增加了检验工序
     - **标准工时对比**：
       - V1.0：组装工序标准工时15分钟/件
       - V1.1：组装工序标准工时12分钟/件
       - 差异：标准工时减少3分钟/件
     - **其他配置对比**：SOP配置、跳转规则等

3. **工艺路线版本回退**（核心功能，新增）
   - 进入"主数据管理" → "工艺管理" → "工艺路线管理" → "版本管理"
   - 选择工艺路线：产品A工艺路线（当前版本：V1.1）
   - 选择历史版本：V1.0
   - 点击"回退到此版本"按钮
   - **系统自动检查**（核心功能，新增）：
     - 检查是否有在制工单使用V1.1版本
     - 如果有在制工单，提示用户确认回退
   - 确认回退
   - **系统自动处理**：
     - 自动将当前版本回退到V1.0
     - 自动更新使用该工艺路线的产品配置（默认使用V1.0）
     - 自动记录版本回退历史

4. **工艺路线版本对在制工单的影响分析**（核心功能，新增）
   - 进入"主数据管理" → "工艺管理" → "工艺路线管理" → "版本影响分析"
   - 选择工艺路线：产品A工艺路线（版本：V1.1）
   - **系统自动分析**：
     - 使用V1.1版本的工单：工单-20260105-001、工单-20260106-001
     - 工单状态：执行中
     - 影响分析：如果回退到V1.0，这些工单的工序配置会发生变化
     - 建议：等待这些工单完工后再回退版本

**系统行为：**
- ✅ **工艺路线版本创建**：
  - 支持创建新版本（基于旧版本）
  - 自动复制旧版本的所有配置
  - 自动生成版本号（V1.0、V1.1、V2.0等）
  - 自动记录版本历史
- ✅ **工艺路线版本对比**（核心功能，新增）：
  - 支持版本对比（工序、标准工时、SOP配置等）
  - 自动显示版本差异（新增、修改、删除）
- ✅ **工艺路线版本回退**（核心功能，新增）：
  - 支持版本回退（回退到历史版本）
  - 自动检查在制工单影响
  - 自动更新产品配置
- ✅ **工艺路线版本影响分析**（核心功能，新增）：
  - 自动分析版本对在制工单的影响
  - 自动建议版本变更时机
- 🤖 **AI智能建议**：
  - 基于历史数据，建议工艺路线版本变更
  - 分析版本影响，建议最佳变更时机

**验收标准：**
- ✅ 工艺路线版本创建成功（基于旧版本创建新版本）
- ✅ 工艺路线版本对比正常（显示版本差异）
- ✅ 工艺路线版本回退正常（回退到历史版本，检查在制工单影响）
- ✅ 工艺路线版本影响分析正常（分析版本对在制工单的影响）

---

### 2.4.5 工艺路线变更管理（核心功能，新增）

**应用场景：**
- 工艺路线需要变更审批流程
- 变更需要评估对在制工单的影响
- 变更需要通知相关人员
- 支持变更记录的追溯和统计

**用户操作：**
1. **提交工艺路线变更申请**
   - 进入"主数据管理" → "工艺管理" → "工艺路线管理" → "变更申请"
   - 选择工艺路线：产品A工艺路线（当前版本：V1.0）
   - 点击"提交变更申请"按钮
   - **填写变更申请信息**：
     - 变更类型：工序变更/标准工时变更/SOP变更/其他（选择：工序变更）
     - 变更内容：增加检验工序（在组装工序后）（大文本输入框）
     - 变更原因：提高产品质量（大文本输入框）
     - 变更影响分析：影响使用该工艺路线的所有工单（系统自动分析）
   - 提交变更申请
   - **系统自动处理**：
     - 自动创建变更申请单
     - 自动分析变更影响（影响哪些工单、影响程度）
     - 自动发送变更申请到审批流程（技术部门审批）

2. **审批工艺路线变更申请**（核心功能，新增）
   - 进入"主数据管理" → "工艺管理" → "工艺路线管理" → "变更审批"
   - 选择变更申请单：变更-20260115-001
   - 查看变更申请详情：
     - 工艺路线：产品A工艺路线
     - 变更类型：工序变更
     - 变更内容：增加检验工序
     - 变更原因：提高产品质量
     - **变更影响分析**（核心功能，新增）：
       - 影响工单：工单-20260105-001、工单-20260106-001（执行中）
       - 影响程度：中等（需要调整工单工序）
       - 建议：等待这些工单完工后再变更，或创建新版本
   - **审批变更申请**：
     - 审批结果：同意/不同意（选择：同意）
     - 审批意见：同意变更，建议创建新版本（大文本输入框）
   - 提交审批结果
   - **系统自动处理**：
     - 审批同意：自动创建新版本工艺路线（V1.1）
     - 自动应用变更（增加检验工序）
     - 自动通知相关人员（变更完成）
     - 自动更新变更申请单状态：已审批

3. **工艺路线变更执行**（核心功能，新增）
   - 审批通过后，系统自动执行变更
   - **系统自动处理**：
     - 自动创建新版本工艺路线（V1.1）
     - 自动应用变更（增加检验工序）
     - 自动更新使用该工艺路线的产品配置（默认使用V1.1）
     - 自动通知相关人员（变更完成）

4. **工艺路线变更对在制工单的处理**（核心功能，新增）
   - 如果变更影响在制工单，系统自动处理：
     - **方式1：创建新版本，在制工单继续使用旧版本**（推荐）
       - 自动创建新版本工艺路线（V1.1）
       - 在制工单继续使用旧版本（V1.0）
       - 新建工单使用新版本（V1.1）
     - **方式2：在制工单同步变更**（需要用户确认）
       - 自动更新在制工单的工艺路线（使用新版本V1.1）
       - 自动更新在制工单的工序（增加检验工序）
       - 自动重新计算计划结束时间（基于新工序标准工时）

5. **工艺路线变更记录追溯**（核心功能，新增）
   - 进入"主数据管理" → "工艺管理" → "工艺路线管理" → "变更记录"
   - 选择工艺路线：产品A工艺路线
   - **查看变更历史**：
     - 变更记录1：2026-01-15，工序变更，增加检验工序，变更人：张三，审批人：李四
     - 变更记录2：2026-01-10，标准工时变更，组装工序标准工时从15分钟改为12分钟，变更人：张三，审批人：李四
   - 支持查看变更详情（变更内容、变更原因、变更影响、审批意见）

**系统行为：**
- ✅ **工艺路线变更申请**：
  - 支持提交变更申请（变更类型、变更内容、变更原因）
  - 自动分析变更影响（影响哪些工单、影响程度）
  - 自动发送变更申请到审批流程
- ✅ **工艺路线变更审批**（核心功能，新增）：
  - 支持变更申请审批（同意/不同意）
  - 自动显示变更影响分析
  - 审批同意后，自动执行变更
- ✅ **工艺路线变更执行**（核心功能，新增）：
  - 自动创建新版本工艺路线
  - 自动应用变更（工序、标准工时、SOP配置等）
  - 自动更新产品配置
- ✅ **工艺路线变更对在制工单的处理**（核心功能，新增）：
  - 自动分析变更对在制工单的影响
  - 支持创建新版本，在制工单继续使用旧版本
  - 支持在制工单同步变更（需要用户确认）
- ✅ **工艺路线变更记录追溯**（核心功能，新增）：
  - 支持查看变更历史（变更内容、变更原因、变更时间、变更人）
  - 支持查看变更详情（变更影响、审批意见）
- 🤖 **AI智能建议**：
  - 基于历史数据，建议工艺路线变更
  - 分析变更影响，建议最佳变更时机
  - 识别变更风险，建议应对措施

**验收标准：**
- ✅ 工艺路线变更申请成功（提交变更申请，分析变更影响）
- ✅ 工艺路线变更审批正常（审批流程、审批结果处理）
- ✅ 工艺路线变更执行正常（创建新版本，应用变更）
- ✅ 工艺路线变更对在制工单的处理正常（创建新版本或同步变更）
- ✅ 工艺路线变更记录追溯正常（查看变更历史、变更详情）

---

### 2.4.1 物料编码映射工具使用（新增，解决编码不统一问题）

**应用场景：**
- 同一物料在不同部门有不同的编码或叫法
- 需要建立编码映射关系，统一物料主数据
- 不中断业务，渐进式整理

**用户操作（渐进式整理）：**
1. **查看重复物料列表**
   - 进入"主数据管理" → "产品管理" → "物料编码映射"
   - 系统自动显示重复物料列表（基于AI智能识别）
   - **重复物料分类显示**：
     - **高置信度重复物料**（名称+规格+单位完全一致）：
       - 产品A（SALE-A001、DES-A001、PUR-A001）
       - 系统自动标记为"建议合并"
     - **中置信度重复物料**（名称相似+规格相同）：
       - 产品A（SALE-A001）vs 产品A（DES-A001）
       - 系统提示"可能重复，请确认"
     - **低置信度重复物料**（名称相似但规格不同）：
       - 产品A（SALE-A001）vs 产品A-改（DES-A002）
       - 系统仅提示"名称相似，请检查"

2. **建立映射关系（物料映射工具）**
   - 选择需要合并的物料（如：SALE-A001、DES-A001、PUR-A001）
   - 点击"建立映射关系"按钮
   - **系统自动处理**：
     - 选择一个物料作为主物料（或创建新物料）
     - 其他物料作为别名，映射到主物料
     - 保留所有部门编码（客户编码、销售编码、设计编码、采购编码、仓库编码、生产编码等）
     - 合并物料属性（取并集，保留所有有用信息）
   - 确认映射关系
   - **完成，<2分钟**

3. **验证映射关系**
   - 查看物料详情，确认所有部门编码映射正确
   - 使用任意部门编码搜索，验证映射生效
   - 查看BOM数据，确认使用主编码存储

**系统行为（物料编码映射机制）：**
- ✅ **主编码体系**：
  - 系统自动生成主编码（MAT-{类型}-{序号}）
  - 主编码作为系统内部唯一标识
  - 用户可选择是否显示主编码（默认隐藏）
- ✅ **部门编码保留**：
  - 各部门编码作为别名保留
  - 业务可正常使用原有编码
  - 系统自动映射到主编码
- ✅ **智能识别重复物料**：
  - 高置信度：名称+规格+单位完全一致，自动合并提示
  - 中置信度：名称相似+规格相同，提示管理员确认
  - 低置信度：名称相似但规格不同，仅提示不自动合并
  - 支持拼音匹配、模糊匹配、AI辅助识别
- ✅ **物料映射工具**：
  - 可视化合并重复物料
  - 建立编码映射关系
  - 保留所有部门编码作为别名
  - 合并物料属性（取并集）
- ✅ **多编码搜索**：
  - 支持输入任意部门编码搜索物料
  - 支持物料名称拼音搜索
  - 支持模糊匹配搜索
  - 自动映射到主编码

**验收标准：**
- ✅ 物料编码映射机制正常（主编码+部门编码别名）
- ✅ 智能识别重复物料正常（高/中/低置信度识别）
- ✅ 物料映射工具正常（可视化合并重复物料）
- ✅ 多编码搜索正常（支持输入任意部门编码搜索）
- ✅ 业务不受影响（各部门可继续使用原有编码）

**优化效果：**
- ⚡ **解决编码不统一问题**：各部门可继续使用原有编码，系统自动映射
- ⚡ **不中断业务**：先导入后整理，业务可正常使用
- ⚡ **渐进式整理**：逐步建立映射关系，不强制一次性统一
- ⚡ **智能识别**：AI辅助识别重复物料，减少人工工作量

---

### 2.5 仓库配置（主数据管理APP）

**用户操作：**
1. 进入"主数据管理" → "仓库管理" → "仓库设置"
2. 创建仓库：
   - 原材料仓库（编码：WH001）
   - 半成品仓库（编码：WH002）
   - 成品仓库（编码：WH003）
3. 创建库区（可选）：
   - 原材料仓库：
     - A区（塑料区）
     - B区（五金区）
4. 创建库位（可选）：
   - A区-A01、A02、A03...

**系统行为：**
- ✅ 创建仓库数据
- ✅ 创建库区数据（可选）
- ✅ 创建库位数据（可选）

**验收标准：**
- ✅ 仓库创建成功
- ✅ 库区创建成功（可选）
- ✅ 库位创建成功（可选）

---

### 2.5.1 工作时间段配置（新增，核心功能，单据执行效率优化）

**应用场景：**
- 不同部门或人员可能有不同的工作时间段（如：白班、夜班、周末班）
- 单据节点之间的耗时统计需要排除非工作时间，只统计工作时间
- 支持按人员或部门设置工作时间段，灵活适应不同工作模式

**用户操作（优化后，极致简化）：**

1. **方式1：按部门设置工作时间段（推荐，批量设置）**
   - 进入"系统管理" → "组织架构" → "部门管理" → "工作时间段配置"
   - 选择部门：生产部
   - **设置工作时间段**：
     - **工作日设置**：
       - 周一至周五：08:00-12:00, 13:00-17:00（8小时/天）
       - 周六：08:00-12:00（4小时/天）
       - 周日：休息（0小时/天）
     - **节假日设置**：
       - 春节：2026-01-28 至 2026-02-05（休息）
       - 国庆节：2026-10-01 至 2026-10-07（休息）
       - 其他法定节假日（系统自动识别）
   - **设置班次（可选，多班次支持）**：
     - 白班：08:00-17:00（8小时）
     - 夜班：20:00-05:00（9小时，跨天）
     - 周末班：周六 08:00-12:00（4小时）
   - 点击"保存"，系统自动应用到该部门所有人员
   - **完成，<2分钟**

2. **方式2：按人员设置工作时间段（可选，个性化设置）**
   - 进入"系统管理" → "组织架构" → "员工管理" → "工作时间段配置"
   - 选择员工：张三（生产部）
   - **设置个人工作时间段**（可覆盖部门设置）：
     - 周一至周五：08:00-12:00, 13:00-17:00（8小时/天）
     - 周六：休息（0小时/天）
     - 周日：休息（0小时/天）
   - 点击"保存"
   - **完成，<1分钟**

3. **方式3：批量导入工作时间段（可选，大批量设置）**
   - 进入"系统管理" → "组织架构" → "工作时间段配置" → "批量导入"
   - 打开工作时间段导入universheet在线表格（系统自动创建模板）
   - 在universheet中填写数据（实时保存）：
     - 部门/人员编码
     - 工作日时间段（周一至周五：08:00-12:00, 13:00-17:00）
     - 周末时间段（周六：08:00-12:00，周日：休息）
     - 节假日设置（可选）
   - 点击"导入"按钮，系统自动导入
   - **完成，<5分钟**

**系统行为（优化后）：**
- ✅ **工作时间段配置**（核心功能，新增）：
  - 支持按部门设置工作时间段（批量设置）
  - 支持按人员设置工作时间段（个性化设置）
  - 支持多班次设置（白班、夜班、周末班等）
  - 支持节假日设置（自动识别法定节假日）
  - 支持跨天班次（如：夜班 20:00-05:00）
- ✅ **工作时间计算**（核心功能，新增）：
  - 自动计算两个时间点之间的工作时间（排除非工作时间）
  - 自动排除节假日（基于配置的节假日设置）
  - 自动排除非工作时间段（基于配置的工作时间段）
  - 支持跨天计算（如：夜班跨天）
- ✅ **耗时统计应用**（核心功能，新增）：
  - 单据节点之间的耗时统计自动使用工作时间段配置
  - 自动排除非工作时间，只统计工作时间
  - 支持按人员或部门的工作时间段进行耗时统计
- ✅ 批量导入工作时间段（universheet在线表格，实时保存）
- ✅ 工作时间段配置验证（自动验证时间段格式和逻辑）

**验收标准：**
- ✅ **工作时间段配置正常**（核心功能，新增）：
  - ✅ 按部门设置工作时间段成功
  - ✅ 按人员设置工作时间段成功
  - ✅ 多班次设置成功（白班、夜班、周末班）
  - ✅ 节假日设置成功（自动识别法定节假日）
  - ✅ 跨天班次设置成功（夜班跨天）
- ✅ **工作时间计算正常**（核心功能，新增）：
  - ✅ 工作时间计算准确（排除非工作时间）
  - ✅ 节假日排除正常（基于配置的节假日设置）
  - ✅ 跨天计算正常（夜班跨天）
- ✅ **耗时统计应用正常**（核心功能，新增）：
  - ✅ 单据节点耗时统计使用工作时间段配置
  - ✅ 非工作时间自动排除
  - ✅ 按人员或部门的工作时间段统计正常
- ✅ 批量导入工作时间段成功（universheet在线表格，实时保存）
- ✅ 工作时间段配置验证正常（时间段格式和逻辑验证）

**优化效果：**
- ⚡ **灵活配置**：支持按部门或人员设置工作时间段，适应不同工作模式
- ⚡ **准确统计**：耗时统计只统计工作时间，排除非工作时间，提高统计准确性
- ⚡ **批量设置**：支持批量导入，大批量设置<5分钟完成
- ⚡ **多班次支持**：支持白班、夜班、周末班等多班次设置

---

### 2.6 供应链主数据配置（主数据管理APP）

**用户操作：**
1. 进入"主数据管理" → "供应链主数据" → "供应商管理"
2. 创建供应商（使用universheet批量导入）：
   - 打开供应商导入universheet在线表格（系统自动创建模板）
   - 在universheet中填写供应商数据（实时保存）：
     - 供应商A（编码：SUP001）- 塑料颗粒供应商
     - 供应商B（编码：SUP002）- 螺丝供应商
   - 点击"导入"按钮，系统自动导入
3. 进入"主数据管理" → "供应链主数据" → "客户管理"
4. 创建客户（使用universheet批量导入）：
   - 打开客户导入universheet在线表格（系统自动创建模板）
   - 在universheet中填写客户数据（实时保存）：
     - 客户A（编码：CUS001）
     - 客户B（编码：CUS002）
   - 点击"导入"按钮，系统自动导入

**系统行为：**
- ✅ 批量导入供应商数据（universheet在线表格，实时保存）
- ✅ 批量导入客户数据（universheet在线表格，实时保存）

**验收标准：**
- ✅ 供应商数据导入成功（支持universheet在线表格批量导入，实时保存）
- ✅ 客户数据导入成功（支持universheet在线表格批量导入，实时保存）

---

### 2.7 期初数据导入（上线倒计时功能，解决动态数据导入难点）

**应用场景：**
- 库存是动态变化的，需要确定一个时间点作为期初数据基准
- 在制品不断变化，需要特别处理
- 应收应付需要导入，但业务仍在进行
- 需要建立上线倒计时功能，在倒计时阶段动态完成期初数据导入

**用户操作（上线倒计时模式，推荐）：**

#### 阶段1：启动上线倒计时（第1天）

1. **进入"系统设置" → "上线准备" → "上线倒计时"**
2. **设置上线日期**（如：2026年1月15日）
3. **系统自动显示倒计时**（如：距离上线还有7天）
4. **系统自动生成期初数据导入清单**：
   - ✅ 静态数据（已完成）：组织架构、物料主数据、BOM、工序、工艺路线、仓库、供应商、客户
   - ⏳ 动态数据（待导入）：期初库存、在制品、应收应付
   - 📋 导入进度跟踪：显示每个数据项的导入状态

#### 阶段2：确定快照时间点（第2天，倒计时6天）

1. **确定期初数据快照时间点**（如：2026年1月10日 00:00:00）
   - 建议选择：业务相对稳定的时间点（如：周末、月末、月初）
   - 系统自动记录快照时间点
   - 系统自动生成快照时间点说明文档

2. **系统自动生成期初数据导入universheet在线表格**：
   - **期初库存导入universheet**：
     - 打开期初库存导入universheet在线表格（系统自动创建模板）
     - 在universheet中填写数据（实时保存）：
       - 物料编码（支持部门编码，自动映射）
       - 仓库编码
       - 期初数量（快照时间点的库存数量）
       - 期初金额（可选）
       - 批次号（可选）
       - 库位（可选）
   - **在制品导入universheet**：
     - 打开在制品导入universheet在线表格（系统自动创建模板）
     - 在universheet中填写数据（实时保存）：
       - 工单号（或生产任务单号）
       - 产品编码
       - 当前工序
       - 在制品数量（当前工序的未完成数量）
       - 已投入数量（已投入的原材料数量）
       - 预计完成时间
       - 关联BOM（自动展开）
   - **应收应付导入universheet**：
     - 打开应收应付导入universheet在线表格（系统自动创建模板）
     - 在universheet中填写数据（实时保存）：
       - 客户/供应商编码
       - 单据类型（销售订单/采购订单/发票等）
       - 单据号
       - 单据日期
       - 应收/应付金额
       - 已收/已付金额
       - 未收/未付金额
       - 到期日期

#### 阶段3：导入期初库存（第3-4天，倒计时5-4天）

1. **准备期初库存数据**（基于快照时间点）
   - 在快照时间点（2026年1月10日 00:00:00）进行库存盘点
   - 记录实际库存数量
   - 打开期初库存导入universheet在线表格（系统自动创建模板）
   - 在universheet中填写数据（实时保存）

2. **导入期初库存**
   - 进入"快智造" → "仓储管理" → "期初库存导入"
   - 点击"导入"按钮（系统自动读取universheet数据）
   - **系统自动处理**：
     - 自动识别物料编码（支持部门编码，自动映射到主编码）
     - 自动验证数据完整性（物料是否存在、仓库是否存在）
     - 自动生成期初库存入库单（标记为"期初库存"）
     - 自动更新库存数量
     - 自动记录期初库存导入历史

3. **验证期初库存**
   - 查看"期初库存导入报告"
   - 确认导入成功的数据
   - 处理导入失败的数据（如：物料不存在、仓库不存在）

#### 阶段4：导入在制品（第5天，倒计时3天）

1. **准备在制品数据**（基于快照时间点）
   - 在快照时间点（2026年1月10日 00:00:00）盘点在制品
   - 记录每个工单的当前工序和未完成数量
   - 记录已投入的原材料数量
   - 打开在制品导入universheet在线表格（系统自动创建模板）
   - 在universheet中填写数据（实时保存）

2. **导入在制品**
   - 进入"快智造" → "生产管理" → "期初在制品导入"
   - 点击"导入"按钮（系统自动读取universheet数据）
   - **系统自动处理**：
     - 自动识别产品编码（支持部门编码，自动映射到主编码）
     - 自动识别工序编码
     - 自动创建期初工单（标记为"期初在制品"）
     - 自动关联工艺路线和BOM
     - 自动计算已投入原材料（基于BOM和已完工工序）
     - 自动更新在制品库存（半成品库存）
     - 自动记录在制品导入历史

3. **验证在制品**
   - 查看"期初在制品导入报告"
   - 确认导入成功的数据
   - 处理导入失败的数据（如：产品不存在、工序不存在）

#### 阶段5：导入应收应付（第6天，倒计时2天）

1. **准备应收应付数据**（基于快照时间点）
   - 在快照时间点（2026年1月10日 00:00:00）盘点应收应付
   - 记录每个客户/供应商的应收/应付金额
   - 记录每个单据的详细信息
   - 打开应收应付导入universheet在线表格（系统自动创建模板）
   - 在universheet中填写数据（实时保存）

2. **导入应收应付**
   - 进入"快智造" → "财务管理" → "期初应收应付导入"
   - 点击"导入"按钮（系统自动读取universheet数据）
   - **系统自动处理**：
     - 自动识别客户/供应商编码（支持部门编码，自动映射到主编码）
     - 自动验证数据完整性（客户/供应商是否存在）
     - 自动创建期初应收/应付单（标记为"期初应收/应付"）
     - 自动更新应收/应付余额
     - 自动记录应收应付导入历史

3. **验证应收应付**
   - 查看"期初应收应付导入报告"
   - 确认导入成功的数据
   - 处理导入失败的数据（如：客户/供应商不存在）

#### 阶段6：动态数据补偿（第7天，倒计时1天）

1. **系统自动计算动态数据补偿**
   - 系统自动计算：快照时间点（2026年1月10日）到上线日期（2026年1月15日）之间的数据变化
   - **库存变化补偿**：
     - 自动计算：入库数量 - 出库数量
     - 自动生成库存补偿单（标记为"动态补偿"）
     - 自动更新库存数量
   - **在制品变化补偿**：
     - 自动计算：新增工单 - 完成工单
     - 自动生成在制品补偿单（标记为"动态补偿"）
     - 自动更新在制品库存
   - **应收应付变化补偿**：
     - 自动计算：新增应收/应付 - 已收/已付
     - 自动生成应收应付补偿单（标记为"动态补偿"）
     - 自动更新应收/应付余额

2. **用户确认动态数据补偿**
   - 查看"动态数据补偿报告"
   - 确认补偿数据正确
   - 确认补偿单（系统自动提交）

#### 阶段7：上线前最终检查（上线当天，倒计时0天）

1. **系统自动生成上线前检查清单**
   - ✅ 静态数据导入完成
   - ✅ 期初库存导入完成
   - ✅ 在制品导入完成
   - ✅ 应收应付导入完成
   - ✅ 动态数据补偿完成
   - ✅ 数据验证通过

2. **用户确认上线**
   - 查看"上线前检查报告"
   - 确认所有数据导入完成
   - 点击"确认上线"按钮
   - **系统自动**：
     - 关闭上线倒计时功能
     - 启用正式业务功能
     - 生成上线完成报告

**系统行为（上线倒计时功能，核心功能）：**
- ✅ **上线倒计时功能**（核心功能，新增）：
  - 设置上线日期，系统自动显示倒计时
  - 自动生成期初数据导入清单
  - 自动跟踪导入进度
  - 自动生成导入报告
- ✅ **快照时间点管理**（核心功能，新增）：
  - 确定期初数据快照时间点
  - 系统自动记录快照时间点
  - 系统自动生成快照时间点说明文档
- ✅ **分阶段导入**（核心功能，新增）：
  - 阶段1：启动上线倒计时
  - 阶段2：确定快照时间点
  - 阶段3：导入期初库存
  - 阶段4：导入在制品
  - 阶段5：导入应收应付
  - 阶段6：动态数据补偿
  - 阶段7：上线前最终检查
- ✅ **期初库存导入**（优化后）：
  - 支持Excel批量导入
  - 支持部门编码（自动映射到主编码）
  - 自动生成期初库存入库单（标记为"期初库存"）
  - 自动更新库存数量
  - 自动记录导入历史
- ✅ **在制品导入**（核心功能，新增）：
  - 支持Excel批量导入
  - 自动创建期初工单（标记为"期初在制品"）
  - 自动关联工艺路线和BOM
  - 自动计算已投入原材料（基于BOM和已完工工序）
  - 自动更新在制品库存（半成品库存）
- ✅ **应收应付导入**（核心功能，新增）：
  - 支持Excel批量导入
  - 自动创建期初应收/应付单（标记为"期初应收/应付"）
  - 自动更新应收/应付余额
- ✅ **动态数据补偿**（核心功能，新增）：
  - 自动计算快照时间点到上线日期之间的数据变化
  - 自动生成库存补偿单（标记为"动态补偿"）
  - 自动生成在制品补偿单（标记为"动态补偿"）
  - 自动生成应收应付补偿单（标记为"动态补偿"）
  - 自动更新相关数据
- ✅ **导入进度跟踪**（核心功能，新增）：
  - 实时显示导入进度
  - 自动生成导入报告
  - 自动标记导入失败的数据
- ✅ **数据验证**（核心功能，新增）：
  - 自动验证数据完整性（物料是否存在、仓库是否存在、客户/供应商是否存在）
  - 自动验证数据合理性（数量是否合理、金额是否合理）
  - 自动生成验证报告
- 🤖 **AI智能建议**（通过Inngest AI工作流）：
  - 建议快照时间点（基于业务规律，如：月末、月初、周末）
  - 检测期初数据完整性，提示缺失的关键数据
  - 分析期初数据合理性，建议优化（如：库存数量是否合理、在制品数量是否合理）
  - 检测动态数据补偿合理性，建议调整

**验收标准：**
- ✅ 上线倒计时功能正常（设置上线日期，显示倒计时）
- ✅ 快照时间点管理正常（确定快照时间点，记录时间点）
- ✅ 期初库存导入成功（支持universheet在线表格批量导入，支持部门编码，实时保存）
- ✅ 在制品导入成功（支持universheet在线表格批量导入，自动创建期初工单，实时保存）
- ✅ 应收应付导入成功（支持universheet在线表格批量导入，自动创建期初应收/应付单，实时保存）
- ✅ 动态数据补偿正常（自动计算数据变化，自动生成补偿单）
- ✅ 导入进度跟踪正常（实时显示导入进度，生成导入报告）
- ✅ 数据验证正常（自动验证数据完整性和合理性）
- ✅ AI建议正常显示（悬浮提示，不打断操作流程）

**优化效果：**
- ⚡ **解决动态数据导入难点**：通过快照时间点和动态数据补偿，解决库存、在制品、应收应付的动态变化问题
- ⚡ **不中断业务**：在倒计时阶段完成期初数据导入，业务可正常进行
- ⚡ **分阶段导入**：分阶段导入不同类型的数据，降低导入难度
- ⚡ **智能补偿**：自动计算动态数据补偿，减少人工工作量
- ⚡ **进度跟踪**：实时跟踪导入进度，及时发现和解决问题

---

## 3. MTS模式业务流程推演（按库存生产）

### 3.1 需求管理阶段

**用户操作：**
1. 进入"快智造" → "计划管理" → "需求管理" → "销售预测(MTS)"
2. 创建销售预测（使用universheet批量导入）：
   - 打开销售预测导入universheet在线表格（系统自动创建模板）
   - 在universheet中填写销售预测数据（实时保存）
   - 点击"导入"按钮，系统自动导入
   - 产品A：1月份预测100个，2月份预测120个，3月份预测150个
   - 产品B：1月份预测50个，2月份预测60个，3月份预测80个
3. 提交销售预测

**系统行为：**
- ✅ 保存销售预测数据
- ✅ 标记为MTS模式
- ✅ 批量导入销售预测（universheet在线表格，实时保存）
- ✅ **耗时统计**（核心功能，新增）：
  - 记录销售预测创建时间（节点1：需求创建）
  - 自动计算从创建到提交的耗时（基于操作人员的工作时间段，只统计工作时间）
- ✅ **单据关联展示**（核心功能，新增）：
  - 在销售预测详情页面展示下游关联单据（MRP运算、工单、销售出库单等）
  - 支持点击跳转到关联单据详情
- ✅ **单据下推功能**（核心功能，新增）：
  - 支持从销售预测下推到MRP运算（一键下推）
  - 自动传递销售预测信息到MRP运算

**验收标准：**
- ✅ 销售预测创建成功（支持universheet在线表格批量导入，实时保存）
- ✅ 销售预测标记为MTS模式
- ✅ **耗时统计正常**（核心功能，新增）：
  - ✅ 销售预测创建时间记录成功
  - ✅ 耗时统计准确（基于操作人员的工作时间段，排除非工作时间）
- ✅ **单据关联展示正常**（核心功能，新增）：
  - ✅ 销售预测详情页面显示下游关联单据
  - ✅ 关联单据快速跳转正常
- ✅ **单据下推功能正常**（核心功能，新增）：
  - ✅ 从销售预测下推到MRP运算正常
  - ✅ 信息传递正确

---

### 3.2 MRP运算阶段（优化：一键生成工单和采购单+灵活参数配置）

**用户操作（优化后，极致简化，支持灵活参数配置）：**
1. 进入"快智造" → "计划管理" → "计划排程" → "MRP运算(MTS)"
2. 选择销售预测（1月份预测）
3. **配置MRP计算参数**（核心功能，新增，灵活配置）：
   - 点击"参数配置"按钮
   - **库存相关参数**（可自由勾选）：
     - ✅ 当前库存数量（默认勾选）
     - ✅ 安全库存（默认勾选）
     - ⬜ 在途库存（采购在途、生产在途）
     - ⬜ 冻结库存（不参与计算）
     - ⬜ 预留库存（已分配但未出库）
     - ⬜ 在制品库存（半成品库存）
     - ⬜ 不良品库存（不参与计算）
   - **需求相关参数**（可自由勾选）：
     - ✅ 销售预测（默认勾选，MRP必需）
     - ⬜ 已下达工单需求（已创建但未完工的工单）
     - ⬜ 已下达采购单需求（已创建但未到货的采购单）
     - ⬜ 预留需求（已预留但未出库的需求）
   - **供应相关参数**（可自由勾选）：
     - ✅ 已下达采购单（默认勾选）
     - ✅ 已下达工单（默认勾选）
     - ⬜ 供应商交期（考虑供应商交期）
     - ⬜ 采购提前期（考虑采购提前期）
     - ⬜ 生产提前期（考虑生产提前期）
   - **BOM相关参数**（可自由勾选）：
     - ✅ BOM版本（默认勾选，使用最新版本）
     - ⬜ BOM损耗率（考虑生产损耗）
     - ⬜ BOM替代料（考虑替代料）
   - **其他参数**（可自由勾选）：
     - ⬜ 最小采购批量（按最小批量采购）
     - ⬜ 采购倍数（按倍数采购）
     - ⬜ 最小生产批量（按最小批量生产）
     - ⬜ 生产倍数（按倍数生产）
     - ⬜ 库存周转率（考虑库存周转）
     - ⬜ 物料有效期（考虑物料有效期）
   - 保存参数配置（可保存为模板，下次直接使用）
4. 点击"运行MRP运算"
5. **系统自动计算并显示结果**（基于配置的参数）：
   - 物料需求清单（基于勾选的参数计算）
   - 工单建议（产品A需要生产90个，产品B需要生产45个）
   - 采购建议（塑料颗粒A需要采购9kg，螺丝需要采购360个）
   - **显示计算说明**（核心功能，新增）：
     - 显示本次计算使用的参数（哪些因素计入计算）
     - 显示计算逻辑说明（如何计算得出结果）
5. **一键操作（新增，核心优化）**：
   - **方式1：一键生成工单和采购单**（推荐，单据下推功能）
     - 点击"一键生成工单和采购单"按钮（下推功能）
     - 系统自动：
       - 根据工单建议，批量创建工单（自动填充产品、数量、车间、工作中心）
       - 根据采购建议，批量创建采购单（自动填充物料、数量、供应商）
       - 自动生成工单号和采购单号
       - 自动生成工单二维码
       - **自动建立关联关系**（MRP运算 → 工单，MRP运算 → 采购单）
     - **完成，<1分钟**
   - **方式2：选择性生成**（可选）
     - 勾选需要生成的工单建议
     - 勾选需要生成的采购建议
     - 点击"批量生成"
   - **方式3：手动创建**（可选）
     - 查看MRP运算结果
     - 手动创建工单和采购单
6. 导出MRP运算结果（Excel，可选）

**系统行为（优化后）：**
- ✅ **耗时统计**（核心功能，新增）：
  - 记录MRP运算开始时间（节点2：MRP运算开始）
  - 记录MRP运算结束时间（节点2：MRP运算结束）
  - 自动计算MRP运算耗时（基于操作人员的工作时间段，只统计工作时间）
  - 记录从需求创建到MRP运算完成的节点间耗时（节点1→节点2）
  - 记录从MRP运算完成到工单创建完成的节点间耗时（节点2→节点3）
- ✅ **灵活参数配置**（核心功能，新增）：
  - **库存相关参数**：
    - 当前库存数量：参与计算（默认）
    - 安全库存：参与计算（默认）
    - 在途库存：可选（采购在途、生产在途）
    - 冻结库存：不参与计算（可选）
    - 预留库存：可选（已分配但未出库）
    - 在制品库存：可选（半成品库存）
    - 不良品库存：不参与计算（可选）
  - **需求相关参数**：
    - 销售预测：参与计算（MRP必需）
    - 已下达工单需求：可选（已创建但未完工的工单）
    - 已下达采购单需求：可选（已创建但未到货的采购单）
    - 预留需求：可选（已预留但未出库的需求）
  - **供应相关参数**：
    - 已下达采购单：参与计算（默认）
    - 已下达工单：参与计算（默认）
    - 供应商交期：可选（考虑供应商交期）
    - 采购提前期：可选（考虑采购提前期）
    - 生产提前期：可选（考虑生产提前期）
  - **BOM相关参数**：
    - BOM版本：参与计算（默认，使用最新版本）
    - BOM损耗率：可选（考虑生产损耗）
    - BOM替代料：可选（考虑替代料）
  - **其他参数**：
    - 最小采购批量：可选（按最小批量采购）
    - 采购倍数：可选（按倍数采购）
    - 最小生产批量：可选（按最小批量生产）
    - 生产倍数：可选（按倍数生产）
    - 库存周转率：可选（考虑库存周转）
    - 物料有效期：可选（考虑物料有效期）
  - 参数配置可保存为模板，下次直接使用
  - 支持预设模板（标准模板、保守模板、激进模板等）
- ✅ 执行MRP运算（异步，使用Inngest工作流，基于配置的参数）
- ✅ 根据销售预测和库存计算物料需求（基于勾选的参数）
- ✅ 根据BOM展开计算原材料需求（基于勾选的参数）
- ✅ 生成工单建议和采购建议（基于勾选的参数）
- ✅ **显示计算说明**（核心功能，新增）：
  - 显示本次计算使用的参数（哪些因素计入计算）
  - 显示计算逻辑说明（如何计算得出结果）
  - 显示参数影响分析（各参数对结果的影响）
- ✅ **一键生成工单和采购单**（新增，核心功能，单据下推功能）
  - 自动填充工单字段（产品、数量、车间、工作中心基于历史数据智能推荐）
  - 自动填充采购单字段（物料、数量、供应商基于历史数据智能推荐）
  - 自动生成工单号和采购单号
  - 自动生成工单二维码
  - **自动建立关联关系**（MRP运算 → 工单，MRP运算 → 采购单）
- ✅ **单据关联展示**（核心功能，新增）：
  - 在MRP运算详情页面展示上游关联单据（销售预测）和下游关联单据（工单、采购单）
  - 支持点击跳转到关联单据详情
- ✅ 支持Excel导出MRP结果（包含计算说明）
- 🤖 **AI智能建议**（通过Inngest AI工作流）：
  - 分析MRP运算结果，提供优化建议：
    - 检测采购批量不合理，建议合并采购以降低采购成本
    - 检测工单排产冲突，建议调整排产计划
    - 分析库存周转率，建议优化安全库存设置
    - 预测交期风险，提前预警延期风险
  - 基于历史数据，建议最佳采购时机和批量
  - 分析物料齐套情况，建议优先处理缺料物料

**验收标准：**
- ✅ **耗时统计正常**（核心功能，新增）：
  - ✅ MRP运算开始时间记录成功
  - ✅ MRP运算结束时间记录成功
  - ✅ MRP运算耗时统计准确（基于操作人员的工作时间段，排除非工作时间）
  - ✅ 节点间耗时统计正常（需求创建→MRP运算完成）
- ✅ **灵活参数配置正常**（核心功能，新增）：
  - ✅ 参数配置界面正常（所有参数可自由勾选）
  - ✅ 参数配置保存成功（可保存为模板）
  - ✅ 预设模板正常（标准模板、保守模板、激进模板等）
  - ✅ 计算时使用配置的参数
- ✅ MRP运算成功（支持大数据量：1000+物料，基于配置的参数）
- ✅ 物料需求计算正确（基于勾选的参数）
- ✅ 工单建议生成正确（基于勾选的参数）
- ✅ 采购建议生成正确（基于勾选的参数）
- ✅ **计算说明显示正常**（核心功能，新增）：
  - ✅ 显示本次计算使用的参数
  - ✅ 显示计算逻辑说明
  - ✅ 显示参数影响分析
- ✅ **一键生成工单和采购单正常**（核心功能）
- ✅ MRP结果导出成功（Excel，包含计算说明）
- ✅ AI建议正常显示（结果页面侧边栏，可展开查看详细建议）

**优化效果：**
- ⚡ **操作步骤减少**：从6步减少到3步（选择预测→运行MRP→一键生成）
- ⚡ **时间缩短**：从15分钟减少到<2分钟（MRP运算+一键生成）
- ⚡ **效率提升**：无需手动创建工单和采购单，系统自动生成
- ⚡ **灵活参数配置**：支持灵活配置计算参数，适应不同业务场景和计算需求
- ⚡ **计算透明化**：显示计算说明和参数影响分析，提高计算结果的可靠性
- ⚡ **耗时统计**：自动统计各节点耗时，帮助识别效率瓶颈，优化流程

---

### 3.2.1 MRP/LRP参数配置使用场景推演（新增）

**场景1：标准MRP计算（默认参数）**

**用户操作：**
1. 进入"快智造" → "计划管理" → "计划排程" → "MRP运算(MTS)"
2. 选择销售预测（1月份预测）
3. 使用默认参数配置（标准模板）：
   - ✅ 当前库存数量
   - ✅ 安全库存
   - ✅ 销售预测
   - ✅ 已下达采购单
   - ✅ 已下达工单
   - ✅ BOM版本
4. 点击"运行MRP运算"
5. **系统计算逻辑**：
   - 物料需求 = 销售预测 - 当前库存 - 安全库存 - 已下达采购单 + 已下达工单需求
   - 不考虑在途库存、预留库存等
6. 查看计算结果和计算说明

**系统行为：**
- ✅ 使用标准参数配置计算
- ✅ 显示计算说明（使用的参数和计算逻辑）
- ✅ 生成工单建议和采购建议

**验收标准：**
- ✅ 标准参数配置计算正常
- ✅ 计算说明显示正常
- ✅ 计算结果合理

---

**场景2：保守MRP计算（考虑所有库存和需求）**

**用户操作：**
1. 进入"快智造" → "计划管理" → "计划排程" → "MRP运算(MTS)"
2. 选择销售预测（1月份预测）
3. 使用保守参数配置（保守模板）：
   - ✅ 当前库存数量
   - ✅ 安全库存
   - ✅ 在途库存（采购在途、生产在途）
   - ✅ 预留库存（已分配但未出库）
   - ✅ 在制品库存（半成品库存）
   - ✅ 销售预测
   - ✅ 已下达工单需求
   - ✅ 已下达采购单需求
   - ✅ 预留需求
   - ✅ 已下达采购单
   - ✅ 已下达工单
   - ✅ 供应商交期
   - ✅ 采购提前期
   - ✅ 生产提前期
   - ✅ BOM版本
   - ✅ BOM损耗率
   - ✅ 最小采购批量
   - ✅ 采购倍数
4. 点击"运行MRP运算"
5. **系统计算逻辑**：
   - 物料需求 = 销售预测 + 已下达工单需求 + 已下达采购单需求 + 预留需求 - 当前库存 - 安全库存 - 在途库存 - 预留库存 - 在制品库存 - 已下达采购单 + 已下达工单需求
   - 考虑供应商交期、采购提前期、生产提前期
   - 考虑BOM损耗率
   - 按最小采购批量和采购倍数调整采购数量
6. 查看计算结果和计算说明

**系统行为：**
- ✅ 使用保守参数配置计算（考虑所有因素）
- ✅ 显示计算说明（使用的参数和计算逻辑）
- ✅ 生成更保守的工单建议和采购建议（避免缺料）

**验收标准：**
- ✅ 保守参数配置计算正常
- ✅ 计算结果更保守（采购数量更多）
- ✅ 计算说明显示正常

---

**场景3：激进MRP计算（不考虑安全库存和提前期）**

**用户操作：**
1. 进入"快智造" → "计划管理" → "计划排程" → "MRP运算(MTS)"
2. 选择销售预测（1月份预测）
3. 使用激进参数配置（激进模板）：
   - ✅ 当前库存数量
   - ⬜ 安全库存（不勾选）
   - ⬜ 在途库存（不勾选）
   - ⬜ 预留库存（不勾选）
   - ⬜ 在制品库存（不勾选）
   - ✅ 销售预测
   - ⬜ 已下达工单需求（不勾选）
   - ⬜ 已下达采购单需求（不勾选）
   - ⬜ 预留需求（不勾选）
   - ✅ 已下达采购单
   - ✅ 已下达工单
   - ⬜ 供应商交期（不勾选）
   - ⬜ 采购提前期（不勾选）
   - ⬜ 生产提前期（不勾选）
   - ✅ BOM版本
   - ⬜ BOM损耗率（不勾选）
   - ⬜ 最小采购批量（不勾选）
   - ⬜ 采购倍数（不勾选）
4. 点击"运行MRP运算"
5. **系统计算逻辑**：
   - 物料需求 = 销售预测 - 当前库存 - 已下达采购单 + 已下达工单需求
   - 不考虑安全库存、在途库存、提前期等
   - 采购数量更少，交期更紧
6. 查看计算结果和计算说明

**系统行为：**
- ✅ 使用激进参数配置计算（只考虑核心因素）
- ✅ 显示计算说明（使用的参数和计算逻辑）
- ✅ 生成更激进的工单建议和采购建议（减少库存积压）

**验收标准：**
- ✅ 激进参数配置计算正常
- ✅ 计算结果更激进（采购数量更少）
- ✅ 计算说明显示正常

---

**场景4：自定义参数配置（按需配置）**

**用户操作：**
1. 进入"快智造" → "计划管理" → "计划排程" → "MRP运算(MTS)"
2. 选择销售预测（1月份预测）
3. 自定义参数配置：
   - ✅ 当前库存数量
   - ✅ 安全库存
   - ✅ 在途库存（只勾选采购在途，不勾选生产在途）
   - ⬜ 冻结库存（不勾选）
   - ✅ 预留库存（勾选）
   - ⬜ 在制品库存（不勾选）
   - ✅ 销售预测
   - ✅ 已下达工单需求
   - ⬜ 已下达采购单需求（不勾选）
   - ⬜ 预留需求（不勾选）
   - ✅ 已下达采购单
   - ✅ 已下达工单
   - ✅ 供应商交期（勾选）
   - ⬜ 采购提前期（不勾选）
   - ⬜ 生产提前期（不勾选）
   - ✅ BOM版本
   - ✅ BOM损耗率（勾选）
   - ⬜ BOM替代料（不勾选）
   - ✅ 最小采购批量（勾选）
   - ⬜ 采购倍数（不勾选）
   - ⬜ 最小生产批量（不勾选）
   - ⬜ 生产倍数（不勾选）
   - ⬜ 库存周转率（不勾选）
   - ⬜ 物料有效期（不勾选）
4. 保存为自定义模板："我的MRP模板1"
5. 点击"运行MRP运算"
6. **系统计算逻辑**：
   - 物料需求 = 销售预测 + 已下达工单需求 - 当前库存 - 安全库存 - 采购在途库存 - 预留库存 - 已下达采购单 + 已下达工单需求
   - 考虑供应商交期
   - 考虑BOM损耗率
   - 按最小采购批量调整采购数量
7. 查看计算结果和计算说明

**系统行为：**
- ✅ 使用自定义参数配置计算
- ✅ 保存自定义模板成功
- ✅ 显示计算说明（使用的参数和计算逻辑）
- ✅ 生成基于自定义参数的工单建议和采购建议

**验收标准：**
- ✅ 自定义参数配置计算正常
- ✅ 自定义模板保存成功
- ✅ 下次可以使用保存的模板
- ✅ 计算说明显示正常

---

**场景5：参数影响分析**

**用户操作：**
1. 运行MRP运算（使用标准参数配置）
2. 查看计算结果
3. 点击"参数影响分析"按钮
4. **系统显示参数影响分析**：
   - **安全库存影响**：
     - 如果考虑安全库存：采购数量 = 100个
     - 如果不考虑安全库存：采购数量 = 80个
     - 影响：+20个
   - **在途库存影响**：
     - 如果考虑在途库存：采购数量 = 100个
     - 如果不考虑在途库存：采购数量 = 120个
     - 影响：-20个
   - **BOM损耗率影响**：
     - 如果考虑BOM损耗率：采购数量 = 100个
     - 如果不考虑BOM损耗率：采购数量 = 95个
     - 影响：+5个
   - **其他参数影响分析**...

**系统行为：**
- ✅ 自动分析各参数对计算结果的影响
- ✅ 显示参数影响对比（考虑vs不考虑）
- ✅ 帮助用户理解参数选择的重要性

**验收标准：**
- ✅ 参数影响分析正常显示
- ✅ 参数影响对比准确
- ✅ 帮助用户做出更好的参数选择

---

### 3.3 工单创建阶段（优化：根据工艺路线自动生成工序）

**用户操作（优化后，极致简化）：**
1. 进入"快智造" → "生产执行" → "工单管理" → "工单列表"
2. 根据MRP运算结果创建工单：
   - 方式1：手动创建工单（优化后）
     - 点击"新建"按钮
     - 选择产品：产品A
     - **系统自动匹配工艺路线**（核心功能，参考黑湖小工单）：
       - 系统自动检查产品A是否绑定了工艺路线
       - 如果产品A绑定了工艺路线，使用产品A绑定的工艺路线（物料优先级）
       - 如果产品A没有绑定工艺路线，检查产品A所属的物料分组是否绑定了工艺路线
       - 如果物料分组绑定了工艺路线，使用物料分组绑定的工艺路线（分组继承）
       - 如果都没有绑定，提示用户选择工艺路线
     - **系统自动填充**：
       - 默认工艺路线：产品A工艺路线（基于自动匹配结果）
       - 默认车间：组装车间（基于工艺路线首工序）
       - 默认工作中心：组装线1（基于工艺路线首工序）
     - 选择数量：90个
     - 选择计划开始时间：2026-01-05 08:00
     - 选择计划结束时间：2026-01-05 18:00（系统可自动计算，基于工艺路线标准工时）
     - **系统自动根据工艺路线生成工单工序单**（核心功能，参考黑湖小工单）：
       - 系统读取匹配到的工艺路线的工序序列
       - 自动为工单创建对应的工序单（WorkOrderOperation），每个工序单包含：
         - 工序1：注塑工序（注塑车间，注塑机1，标准工时10分钟/件）
           - 工序单号：自动生成（WO-20260105-001-OP001）
           - 工序顺序：1
           - 关联工序：注塑工序
           - 关联车间：注塑车间
           - 关联工作中心：注塑机1
           - 标准工时：10分钟/件
           - 准备时间：5分钟
           - 计划开始时间：自动计算（基于工单计划开始时间和前序工序）
           - 计划结束时间：自动计算
         - 工序2：组装工序（组装车间，组装线1，标准工时15分钟/件）
           - 工序单号：自动生成（WO-20260105-001-OP002）
           - 工序顺序：2
           - 关联工序：组装工序
           - 关联车间：组装车间
           - 关联工作中心：组装线1
           - 标准工时：15分钟/件
           - 准备时间：10分钟
           - 计划开始时间：自动计算（基于前序工序完成时间）
           - 计划结束时间：自动计算
         - 工序3：包装工序（包装车间，包装线1，标准工时5分钟/件）
           - 工序单号：自动生成（WO-20260105-001-OP003）
           - 工序顺序：3
           - 关联工序：包装工序
           - 关联车间：包装车间
           - 关联工作中心：包装线1
           - 标准工时：5分钟/件
           - 准备时间：3分钟
           - 计划开始时间：自动计算（基于前序工序完成时间）
           - 计划结束时间：自动计算
       - **如果是带SOP工艺路线，系统自动关联SOP**：
         - 工序1：注塑工序 → 关联SOP《注塑作业标准》
         - 工序2：组装工序 → 关联SOP《组装作业标准》
         - 工序3：包装工序 → 关联SOP《包装作业标准》
     - 提交工单
   
   - 方式2：批量导入工单（使用Excel）
     - 下载工单导入模板
     - 填写工单数据（产品、数量、工艺路线可选）
     - 打开工单导入universheet在线表格（系统自动创建模板）
     - 在universheet中填写工单数据（实时保存）
     - 点击"导入"按钮，系统自动导入
     - 系统自动创建工单并生成工序（基于产品默认工艺路线）

3. **查看工单列表**（专门化改造，核心功能，新增）：
   - **表格行展开功能**（核心功能，新增）：
     - 工单列表表格支持行展开（点击行左侧展开图标或双击行）
     - 展开后显示该工单的所有工序信息
   - **图形化工序显示**（核心功能，新增）：
     - 展开行以图形化的方式显示所有工序
     - 工序按顺序横向排列，形成工序流程图
     - 每道工序显示为独立的工序卡片
   - **环状图显示工序进度**（核心功能，新增）：
     - 每道工序以环状图（Progress Ring）显示进度
     - 环状图显示：
       - 已完成数量 / 计划数量（如：80/100）
       - 完成百分比（如：80%）
       - 合格数量 / 不合格数量（如：合格：75，不合格：5）
     - 环状图颜色：
       - 绿色：已完成且合格率达标（≥95%）
       - 黄色：进行中或合格率偏低（80%-95%）
       - 红色：异常或合格率过低（<80%）
     - 工序卡片信息：
       - 工序名称：注塑工序
       - 工序状态：待开始/进行中/已完成/已暂停
       - 关联车间：注塑车间
       - 关联工作中心：注塑机1
       - 计划时间：2026-01-05 08:00 - 10:00
       - 实际时间：2026-01-05 08:05 - 10:15（如有）
       - 操作人员：张三（如有）
     - 工序卡片操作：
       - 点击工序卡片可查看工序详情
       - 支持快速报工（移动端/工位机）
       - 支持查看SOP（如果关联了SOP）
   - **高级搜索**（使用高级搜索，支持拼音搜索）
4. 查看工单详情（使用Drawer，显示工序列表和SOP）
5. 打印工单（支持打印模板，包含工序信息）

**系统行为（优化后）：**
- ✅ **耗时统计**（核心功能，新增）：
  - 记录工单创建时间（节点3：工单创建）
  - 自动计算从MRP运算完成到工单创建完成的节点间耗时（节点2→节点3，基于操作人员的工作时间段，只统计工作时间）
- ✅ **单据关联展示**（核心功能，新增）：
  - 在工单详情页面展示上游关联单据（销售预测、MRP运算）和下游关联单据（生产领料出库单、报工记录、成品入库单、销售出库单）
  - 支持点击跳转到关联单据详情
  - 支持查看完整关联链条（关联追溯）
- ✅ **单据下推功能**（核心功能，新增）：
  - 支持从工单下推到生产领料出库单（一键下推）
  - 支持从工单下推到报工记录（移动端/工位机）
  - 支持从工单下推到成品入库单（一键下推）
  - 自动传递工单信息到下游单据
- ✅ **单据上拉功能**（核心功能，新增）：
  - 支持从工单上拉到销售预测/销售订单（手动关联）
  - 支持从报工记录上拉到工单（手动关联或智能关联）
- ✅ 自动生成工单号（工单-20260105-001）
- ✅ 创建工单数据
- ✅ **根据工艺路线自动生成工单工序单**（核心功能，新增，参考黑湖小工单）
  - **自动匹配工艺路线**：
    - 创建工单时，系统自动检查物料是否绑定了工艺路线
    - 优先级规则：物料绑定 > 物料分组绑定
    - 如果物料绑定了工艺路线，使用物料绑定的工艺路线
    - 如果物料没有绑定，但所属分组绑定了工艺路线，使用分组绑定的工艺路线
    - 如果都没有绑定，提示用户选择工艺路线
  - **自动创建工序单**（WorkOrderOperation）：
    - 系统读取匹配到的工艺路线的工序序列（operation_sequence）
    - 为工单自动创建对应的工序单，每个工序单包含：
      - 工序单号：自动生成（格式：{工单号}-OP{序号}）
      - 工序顺序：基于工艺路线的工序顺序
      - 关联工序：从工艺路线中获取
      - 关联车间：从工序中获取
      - 关联工作中心：从工序中获取
      - 标准工时：从工艺路线中获取（或从工序中获取）
      - 准备时间：从工艺路线中获取（或从工序中获取）
      - 计划开始时间：自动计算（基于工单计划开始时间和前序工序完成时间）
      - 计划结束时间：自动计算（基于计划开始时间、标准工时和工单数量）
      - 关联SOP：如果工艺路线中工序关联了SOP，自动关联到工序单
  - **自动填充工序顺序**（基于工艺路线）
  - **自动填充工序车间和工作中心**（基于工艺路线中的工序配置）
  - **自动填充标准工时和准备时间**（基于工艺路线或工序配置）
  - **如果是带SOP工艺路线，自动关联SOP**（核心功能，新增）
- ✅ **返工单管理**（核心功能，新增）：
  - 支持从原工单创建返工单
  - 支持手动创建返工单
  - 自动生成返工单号（返工-{原工单号}-{序号}）
  - 自动关联原工单
  - 自动生成返工工序（基于选择的返工工序）
- ✅ **工单拆分**（核心功能，新增）：
  - 支持按数量拆分（将大工单拆分成多个小工单）
  - 支持按工序拆分（将大工单的工序拆分到不同工单）
  - 只能拆分未报工部分（已报工部分不能拆分）
  - 自动生成拆分工单号（{原工单号}-{序号}）
  - 自动生成拆分工单工序（基于原工单工艺路线）
- ✅ **执行中工单工序修改**（核心功能，新增）：
  - 已报工工序：不允许修改（灰色显示，不可编辑）
  - 未报工工序：允许修改（可编辑）
  - 支持修改未报工工序的车间、工作中心、标准工时等
  - 支持增加未报工工序
  - 支持删除未报工工序
  - 自动重新计算计划结束时间（基于修改后的标准工时）
- ✅ **工单冻结**（核心功能，新增）：
  - 支持单个工单冻结
  - 支持批量工单冻结
  - 工单状态更新为：已冻结
  - 停止工单进度更新（冻结期间不更新进度）
  - 冻结工单不能报工（自动阻止）
  - 支持工单解冻（恢复原状态）
- ✅ 生成工单二维码（用于扫码报工）
- ✅ **工单列表专门化改造**（核心功能，新增）：
  - **表格行展开功能**：
    - 支持行展开/收起（点击展开图标或双击行）
    - 展开后显示该工单的所有工序信息
  - **图形化工序显示**：
    - 展开行以图形化的方式显示所有工序
    - 工序按顺序横向排列，形成工序流程图
    - 每道工序显示为独立的工序卡片
    - 工序卡片包含完整信息（工序名称、状态、车间、工作中心、计划时间、实际时间、操作人员）
  - **环状图显示工序进度**：
    - 每道工序以环状图（Progress Ring）显示进度
    - 环状图显示已完成数量/计划数量、完成百分比、合格数量/不合格数量
    - 环状图颜色根据完成状态和合格率自动变化（绿色/黄色/红色）
    - 支持点击工序卡片查看详情、快速报工、查看SOP
- ✅ 批量导入工单（universheet在线表格，实时保存）
- ✅ 高级搜索（拼音搜索）
- ✅ 打印工单（包含工序信息）

**验收标准：**
- ✅ **耗时统计正常**（核心功能，新增）：
  - ✅ 工单创建时间记录成功
  - ✅ 节点间耗时统计正常（MRP运算完成→工单创建完成，基于操作人员的工作时间段，排除非工作时间）
- ✅ **单据关联展示正常**（核心功能，新增）：
  - ✅ 工单详情页面显示上下游关联单据
  - ✅ 关联单据快速跳转正常
  - ✅ 关联追溯功能正常
- ✅ **单据下推功能正常**（核心功能，新增）：
  - ✅ 从工单下推到生产领料出库单正常
  - ✅ 从工单下推到报工记录正常
  - ✅ 从工单下推到成品入库单正常
- ✅ **单据上拉功能正常**（核心功能，新增）：
  - ✅ 从工单上拉到销售预测/销售订单正常
  - ✅ 从报工记录上拉到工单正常
- ✅ 工单创建成功（支持universheet在线表格批量导入，实时保存）
- ✅ 工单号自动生成成功（支持中文前缀）
- ✅ **工单工序单自动生成成功**（基于工艺路线，参考黑湖小工单）：
  - ✅ 系统自动匹配工艺路线成功（物料绑定 → 物料分组绑定）
  - ✅ 自动创建工序单（WorkOrderOperation）成功
  - ✅ 工序单包含完整信息（工序顺序、关联工序、车间、工作中心、标准工时、准备时间、计划时间）
  - ✅ 工序单号自动生成成功（格式：{工单号}-OP{序号}）
  - ✅ 计划时间自动计算成功（基于前序工序完成时间）
  - ✅ 带SOP工艺路线自动关联SOP成功
- ✅ **带SOP工艺路线自动关联SOP成功**（核心功能）
- ✅ **返工单管理正常**（核心功能，新增）：
  - ✅ 返工单创建成功（支持从原工单创建和手动创建）
  - ✅ 返工单号自动生成成功
  - ✅ 返工单关联原工单成功
  - ✅ 返工工序自动生成成功
  - ✅ 返工单可以正常报工
- ✅ **工单拆分正常**（核心功能，新增）：
  - ✅ 工单拆分成功（支持按数量拆分和按工序拆分）
  - ✅ 只能拆分未报工部分（已报工部分不能拆分）
  - ✅ 拆分工单号自动生成成功
  - ✅ 拆分工单工序自动生成成功
  - ✅ 拆分工单可以独立管理
- ✅ **执行中工单工序修改正常**（核心功能，新增）：
  - ✅ 已报工工序不允许修改（灰色显示，不可编辑）
  - ✅ 未报工工序允许修改（可编辑）
  - ✅ 未报工工序修改成功（车间、工作中心、标准工时等）
  - ✅ 增加未报工工序成功
  - ✅ 删除未报工工序成功
  - ✅ 计划结束时间自动重新计算成功
- ✅ **工单冻结正常**（核心功能，新增）：
  - ✅ 工单冻结成功（支持单个冻结和批量冻结）
  - ✅ 工单状态更新为：已冻结
  - ✅ 冻结期间停止工单进度更新
  - ✅ 冻结工单不能报工（自动阻止）
  - ✅ 工单解冻成功
  - ✅ 解冻后工单状态恢复为：执行中
- ✅ 工单二维码生成成功（支持中文）
- ✅ **工单列表专门化改造正常**（核心功能，新增）：
  - ✅ 表格行展开功能正常（点击展开图标或双击行）
  - ✅ 图形化工序显示正常（工序流程图、工序卡片）
  - ✅ 环状图显示工序进度正常（完成数量、完成百分比、合格数量/不合格数量）
  - ✅ 环状图颜色自动变化正常（根据完成状态和合格率）
  - ✅ 工序卡片信息完整（工序名称、状态、车间、工作中心、计划时间、实际时间、操作人员）
  - ✅ 工序卡片操作正常（查看详情、快速报工、查看SOP）
- ✅ 工单高级搜索可用（拼音搜索）
- ✅ 工单打印可用（包含工序信息）

**优化效果：**
- ⚡ **操作步骤减少**：无需手动创建工序，系统自动生成
- ⚡ **时间缩短**：从10分钟减少到<2分钟（自动生成工序）
- ⚡ **准确性提升**：基于工艺路线生成，确保工序顺序和参数正确
- ⚡ **返工单管理**：支持返工单创建和管理，实现质量追溯和返工流程管理
- ⚡ **工单拆分**：支持大工单拆分成小工单，灵活分配生产任务
- ⚡ **工序修改**：执行中工单的未报工工序允许修改，适应生产变化
- ⚡ **工单冻结**：支持工单冻结和解冻，应对质量问题和紧急情况
- ⚡ **耗时统计**：自动统计工单创建耗时，帮助识别效率瓶颈

**开发状态：** ✅ 已完成

---

### 3.3.1 工单管理高级功能（新增）

#### 3.3.1.1 返工单管理（核心功能，新增）

**应用场景：**
- 生产过程中发现质量问题，需要返工
- 已完工的产品需要返工
- 客户退货需要返工

**用户操作：**
1. **创建返工单（方式1：从原工单创建）**
   - 进入"快智造" → "生产执行" → "工单管理" → "工单列表"
   - 选择原工单：工单-20260105-001（产品A，已完工）
   - 点击"创建返工单"按钮
   - **系统自动填充**：
     - 返工单号：返工-工单-20260105-001-001（自动生成）
     - 原工单号：工单-20260105-001（自动关联）
     - 产品：产品A（自动填充）
     - 返工数量：10个（用户输入，不能超过原工单数量）
     - 返工原因：质量问题（用户选择或输入）
     - 返工类型：全部返工/部分返工（用户选择）
   - **选择返工工序**：
     - 方式1：全部工序返工（从第一道工序开始）
     - 方式2：指定工序返工（选择需要返工的工序，如：只返工组装工序）
   - 提交返工单

2. **创建返工单（方式2：手动创建）**
   - 进入"快智造" → "生产执行" → "工单管理" → "返工单管理"
   - 点击"新建返工单"按钮
   - 填写返工单信息：
     - 关联原工单：工单-20260105-001（可选，支持搜索）
     - 产品：产品A
     - 返工数量：10个
     - 返工原因：质量问题
     - 返工类型：部分返工
     - 选择返工工序：组装工序、包装工序
   - 提交返工单

3. **返工单执行**
   - 返工单创建后，自动生成返工工序（基于选择的返工工序）
   - 返工单可以正常报工（与普通工单相同）
   - 返工完成后，自动更新原工单状态

**系统行为：**
- ✅ **返工单创建**（核心功能，新增）：
  - 支持从原工单创建返工单
  - 支持手动创建返工单
  - 自动生成返工单号（返工-{原工单号}-{序号}）
  - 自动关联原工单
  - 自动生成返工工序（基于选择的返工工序）
- ✅ **返工单管理**：
  - 返工单独立管理（有独立的返工单列表）
  - 返工单可以正常报工、下达、完工
  - 返工单完成后，自动更新原工单状态
- ✅ **返工追溯**：
  - 支持查询原工单的所有返工单
  - 支持查询返工单的原工单
  - 支持返工单的完整追溯

**验收标准：**
- ✅ 返工单创建成功（支持从原工单创建和手动创建）
- ✅ 返工单号自动生成成功
- ✅ 返工单关联原工单成功
- ✅ 返工工序自动生成成功
- ✅ 返工单可以正常报工
- ✅ 返工单完成后，原工单状态更新成功
- ✅ 返工追溯查询正常

---

#### 3.3.1.2 工单拆分（核心功能，新增）

**应用场景：**
- 大工单需要拆分成多个小工单，分配给不同车间或班组
- 紧急订单需要优先生产部分数量
- 产能限制，需要分批生产

**用户操作：**
1. **拆分工单**
   - 进入"快智造" → "生产执行" → "工单管理" → "工单列表"
   - 选择大工单：工单-20260105-001（产品A，数量：100个，状态：已下达）
   - 点击"拆分工单"按钮
   - **系统显示拆分界面**：
     - 原工单信息：工单-20260105-001，产品A，数量100个
     - 已报工数量：30个（已报工，不能拆分）
     - 可拆分数量：70个（未报工部分）
   - **设置拆分规则**：
     - 方式1：按数量拆分
       - 拆分数量1：30个（工单-20260105-001-1）
       - 拆分数量2：40个（工单-20260105-001-2）
       - 剩余数量：自动计算（原工单数量 - 已拆分数量）
     - 方式2：按工序拆分
       - 原工单保留：工序1（注塑工序）
       - 拆分工单1：工序2、工序3（组装工序、包装工序）
   - **设置拆分工单信息**：
     - 拆分工单1：
       - 工单号：工单-20260105-001-1（自动生成）
       - 数量：30个
       - 车间：注塑车间（可修改）
       - 工作中心：注塑机1（可修改）
       - 计划开始时间：2026-01-06 08:00（可修改）
     - 拆分工单2：
       - 工单号：工单-20260105-001-2（自动生成）
       - 数量：40个
       - 车间：注塑车间（可修改）
       - 工作中心：注塑机2（可修改）
       - 计划开始时间：2026-01-06 14:00（可修改）
   - 确认拆分
   - **系统自动处理**：
     - 创建拆分工单（工单-20260105-001-1、工单-20260105-001-2）
     - 原工单数量更新为：30个（已报工数量）
     - 原工单状态保持不变（已下达）
     - 拆分工单状态：已创建（需要下达）

2. **拆分工单管理**
   - 拆分工单可以独立管理（独立下达、报工、完工）
   - 拆分工单完成后，自动更新原工单进度
   - 支持查看原工单的所有拆分工单

**系统行为：**
- ✅ **工单拆分**（核心功能，新增）：
  - 支持按数量拆分（将大工单拆分成多个小工单）
  - 支持按工序拆分（将大工单的工序拆分到不同工单）
  - 只能拆分未报工部分（已报工部分不能拆分）
  - 自动生成拆分工单号（{原工单号}-{序号}）
  - 自动生成拆分工单工序（基于原工单工艺路线）
  - 原工单数量自动更新（保留已报工数量）
- ✅ **拆分工单管理**：
  - 拆分工单独立管理（可以独立下达、报工、完工）
  - 拆分工单完成后，自动更新原工单进度
  - 支持查看原工单的所有拆分工单
- ✅ **拆分追溯**：
  - 支持查询原工单的所有拆分工单
  - 支持查询拆分工单的原工单
  - 支持拆分工单的完整追溯

**验收标准：**
- ✅ 工单拆分成功（支持按数量拆分和按工序拆分）
- ✅ 只能拆分未报工部分（已报工部分不能拆分）
- ✅ 拆分工单号自动生成成功
- ✅ 拆分工单工序自动生成成功
- ✅ 原工单数量更新成功（保留已报工数量）
- ✅ 拆分工单可以独立管理
- ✅ 拆分追溯查询正常

---

#### 3.3.1.3 执行中工单工序修改（核心功能，新增）

**应用场景：**
- 已开工并在执行中的工单，发现工艺路线需要调整
- 未报工的工序需要修改（车间、工作中心、标准工时等）
- 需要增加或删除未报工的工序

**用户操作：**
1. **修改执行中工单的未报工工序**
   - 进入"快智造" → "生产执行" → "工单管理" → "工单列表"
   - 选择执行中工单：工单-20260105-001（产品A，状态：执行中）
   - 查看工单详情：
     - 工序1：注塑工序（已报工，30个）
     - 工序2：组装工序（未报工，计划数量70个）
     - 工序3：包装工序（未报工，计划数量70个）
   - 点击"编辑工序"按钮
   - **系统自动判断**：
     - 已报工工序：不允许修改（灰色显示，不可编辑）
     - 未报工工序：允许修改（可编辑）
   - **修改未报工工序**：
     - 工序2：组装工序
       - 修改车间：从"组装车间"改为"组装车间2"
       - 修改工作中心：从"组装线1"改为"组装线2"
       - 修改标准工时：从"15分钟/件"改为"12分钟/件"
     - 工序3：包装工序
       - 修改车间：从"包装车间"改为"包装车间2"
       - 修改工作中心：从"包装线1"改为"包装线2"
   - 保存修改
   - **系统自动处理**：
     - 更新未报工工序信息
     - 已报工工序保持不变
     - 自动重新计算计划结束时间（基于修改后的标准工时）

2. **增加未报工工序**
   - 编辑执行中工单：工单-20260105-001
   - 点击"添加工序"按钮
   - 选择工序：检验工序（未报工）
   - 插入位置：在工序2（组装工序）之后
   - 设置工序信息：
     - 车间：质量部
     - 工作中心：检验台1
     - 标准工时：5分钟/件
   - 保存
   - **系统自动处理**：
     - 在工序2之后插入检验工序
     - 自动更新工序顺序
     - 自动重新计算计划结束时间

3. **删除未报工工序**
   - 编辑执行中工单：工单-20260105-001
   - 选择未报工工序：工序3（包装工序）
   - 点击"删除工序"按钮
   - 确认删除
   - **系统自动处理**：
     - 删除未报工工序
     - 自动更新工序顺序
     - 自动重新计算计划结束时间

**系统行为：**
- ✅ **执行中工单工序修改**（核心功能，新增）：
  - 已报工工序：不允许修改（灰色显示，不可编辑）
  - 未报工工序：允许修改（可编辑）
  - 支持修改未报工工序的车间、工作中心、标准工时等
  - 支持增加未报工工序
  - 支持删除未报工工序
  - 自动重新计算计划结束时间（基于修改后的标准工时）
- ✅ **修改记录**：
  - 自动记录工序修改历史
  - 支持查看工序修改记录
- ✅ **修改校验**：
  - 自动校验修改的合理性（如：工序顺序、跳转规则等）
  - 修改后自动更新工单进度

**验收标准：**
- ✅ 已报工工序不允许修改（灰色显示，不可编辑）
- ✅ 未报工工序允许修改（可编辑）
- ✅ 未报工工序修改成功（车间、工作中心、标准工时等）
- ✅ 增加未报工工序成功
- ✅ 删除未报工工序成功
- ✅ 计划结束时间自动重新计算成功
- ✅ 工序修改记录正常

---

#### 3.3.1.4 工单冻结（核心功能，新增）

**应用场景：**
- 遇到质量问题，需要暂停生产
- 原材料质量问题，需要等待处理
- 设备故障，需要暂停生产
- 客户要求暂停生产

**用户操作：**
1. **冻结工单（方式1：单个冻结）**
   - 进入"快智造" → "生产执行" → "工单管理" → "工单列表"
   - 选择执行中工单：工单-20260105-001（产品A，状态：执行中）
   - 点击"冻结工单"按钮
   - **填写冻结信息**：
     - 冻结原因：质量问题（用户选择或输入）
     - 冻结类型：质量问题/原材料问题/设备故障/客户要求（用户选择）
     - 冻结说明：详细说明冻结原因（用户输入）
     - 预计解冻时间：2026-01-10 08:00（可选）
   - 确认冻结
   - **系统自动处理**：
     - 工单状态更新为：已冻结
     - 停止工单进度更新
     - 通知相关人员（生产管理员、车间工人）

2. **冻结工单（方式2：批量冻结）**
   - 进入"快智造" → "生产执行" → "工单管理" → "工单列表"
   - 勾选多个执行中工单（支持全选）
   - 点击"批量冻结"按钮
   - 填写冻结信息（同单个冻结）
   - 确认冻结
   - **系统自动处理**：
     - 批量更新工单状态为：已冻结
     - 停止所有工单进度更新
     - 通知相关人员

3. **解冻工单**
   - 进入"快智造" → "生产执行" → "工单管理" → "已冻结工单"
   - 选择已冻结工单：工单-20260105-001
   - 点击"解冻工单"按钮
   - **填写解冻信息**：
     - 解冻原因：问题已解决（用户输入）
     - 解冻说明：详细说明解冻原因（用户输入）
   - 确认解冻
   - **系统自动处理**：
     - 工单状态更新为：执行中（恢复原状态）
     - 恢复工单进度更新
     - 通知相关人员

4. **冻结工单管理**
   - 查看已冻结工单列表（独立的冻结工单列表）
   - 查看冻结原因和冻结时间
   - 查看预计解冻时间
   - 支持按冻结原因筛选

**系统行为：**
- ✅ **工单冻结**（核心功能，新增）：
  - 支持单个工单冻结
  - 支持批量工单冻结
  - 工单状态更新为：已冻结
  - 停止工单进度更新（冻结期间不更新进度）
  - 自动记录冻结原因和冻结时间
  - 支持设置预计解冻时间
  - 自动通知相关人员
- ✅ **工单解冻**：
  - 支持解冻工单
  - 工单状态恢复为：执行中（恢复原状态）
  - 恢复工单进度更新
  - 自动记录解冻原因和解冻时间
  - 自动通知相关人员
- ✅ **冻结工单管理**：
  - 独立的冻结工单列表
  - 支持按冻结原因筛选
  - 支持查看冻结历史记录
- ✅ **冻结校验**：
  - 已完工工单不能冻结
  - 已取消工单不能冻结
  - 冻结工单不能报工（自动阻止）

**验收标准：**
- ✅ 工单冻结成功（支持单个冻结和批量冻结）
- ✅ 工单状态更新为：已冻结
- ✅ 冻结期间停止工单进度更新
- ✅ 冻结工单不能报工（自动阻止）
- ✅ 工单解冻成功
- ✅ 解冻后工单状态恢复为：执行中
- ✅ 解冻后恢复工单进度更新
- ✅ 冻结工单管理正常（独立的冻结工单列表）
- ✅ 冻结历史记录正常

---

### 3.3.2 工单优先级管理（核心功能，新增）

**应用场景：**
- 不同工单有不同的紧急程度和重要性
- 需要按优先级排序和筛选工单
- 优先级影响排产计划和资源分配
- 支持紧急插单和优先级调整

**用户操作：**
1. **设置工单优先级（方式1：创建工单时设置）**
   - 进入"快智造" → "生产执行" → "工单管理" → "新建工单"
   - 填写工单基本信息（产品、数量、工艺路线等）
   - **设置工单优先级**（核心功能，新增）：
     - 优先级：紧急/高/中/低（选择：高）
     - 优先级说明：客户A紧急订单（用户输入，可选）
     - 优先级依据：交期紧急/重要客户/高价值订单/其他（选择：交期紧急）
   - 保存工单

2. **设置工单优先级（方式2：批量设置）**
   - 进入"快智造" → "生产执行" → "工单管理" → "工单列表"
   - 勾选多个工单（支持全选）
   - 点击"批量设置优先级"按钮
   - 选择优先级：紧急/高/中/低
   - 填写优先级说明（可选）
   - 确认设置
   - **系统自动处理**：
     - 批量更新工单优先级
     - 自动重新计算排产计划（如果已排产）

3. **按优先级排序和筛选**
   - 进入"快智造" → "生产执行" → "工单管理" → "工单列表"
   - **排序方式**（核心功能，新增）：
     - 按优先级排序：紧急 → 高 → 中 → 低
     - 按优先级+交期排序：优先级相同，按交期排序
     - 按优先级+创建时间排序：优先级相同，按创建时间排序
   - **筛选方式**（核心功能，新增）：
     - 筛选优先级：只显示紧急工单/高优先级工单等
     - 筛选优先级+状态：只显示紧急+已下达工单等
   - 查看优先级标识：
     - 紧急：红色标识
     - 高：橙色标识
     - 中：蓝色标识
     - 低：灰色标识

4. **紧急插单**（核心功能，新增）
   - 进入"快智造" → "生产执行" → "工单管理" → "紧急插单"
   - 创建紧急工单：
     - 选择产品：产品A
     - 填写数量：50个
     - 填写交期：2026-01-20（紧急交期）
     - 优先级：自动设置为"紧急"
     - 插单原因：客户A紧急订单（用户输入）
   - 提交紧急插单申请
   - **系统自动处理**：
     - 自动检查现有排产计划
     - 自动分析插单影响（影响哪些工单、影响程度）
     - 自动生成插单方案（调整排产计划、增加产能等）
     - 显示AI建议的插单方案
   - 用户确认插单方案
   - **系统自动处理**：
     - 自动调整受影响工单的排产计划
     - 自动通知相关人员（受影响工单负责人）
     - 自动更新排产甘特图

**系统行为：**
- ✅ **工单优先级设置**：
  - 支持创建工单时设置优先级
  - 支持批量设置优先级
  - 支持优先级调整（可随时修改）
  - 自动记录优先级变更历史
- ✅ **优先级排序和筛选**：
  - 支持按优先级排序（紧急 → 高 → 中 → 低）
  - 支持按优先级+交期排序
  - 支持按优先级筛选
  - 支持优先级标识显示（颜色标识）
- ✅ **紧急插单**（核心功能，新增）：
  - 自动设置优先级为"紧急"
  - 自动分析插单影响（影响哪些工单、影响程度）
  - 自动生成插单方案（调整排产计划、增加产能等）
  - 自动调整受影响工单的排产计划
  - 自动通知相关人员
- ✅ **优先级对排产的影响**：
  - 排产时优先考虑高优先级工单
  - 优先级影响工作中心分配
  - 优先级影响物料分配
- 🤖 **AI智能建议**：
  - 基于交期和重要性，建议工单优先级
  - 分析插单影响，建议最佳插单方案
  - 识别优先级冲突，建议调整方案

**验收标准：**
- ✅ 工单优先级设置成功（支持创建时设置和批量设置）
- ✅ 优先级排序和筛选正常（按优先级排序、筛选）
- ✅ 优先级标识显示正常（颜色标识）
- ✅ 紧急插单正常（自动分析影响、生成方案、调整排产）
- ✅ 优先级对排产的影响正常（优先考虑高优先级工单）

---

### 3.3.3 工单合并（核心功能，新增）

**应用场景：**
- 多个小工单可以合并成大工单，提高生产效率
- 相同产品的多个工单可以合并
- 合并工单可以减少换模次数，提高设备利用率

**用户操作：**
1. **合并工单（方式1：选择多个工单合并）**
   - 进入"快智造" → "生产执行" → "工单管理" → "工单列表"
   - 勾选多个工单（支持多选）：
     - 工单1：工单-20260105-001（产品A，数量：50个，状态：已创建）
     - 工单2：工单-20260105-002（产品A，数量：30个，状态：已创建）
     - 工单3：工单-20260105-003（产品A，数量：20个，状态：已创建）
   - 点击"合并工单"按钮
   - **系统自动检查合并条件**（核心功能，新增）：
     - 检查产品是否相同：产品A（相同，可合并）
     - 检查工艺路线是否相同：产品A工艺路线（相同，可合并）
     - 检查工单状态：已创建（相同，可合并）
     - 检查是否已报工：未报工（可合并）
   - **设置合并工单信息**：
     - 合并工单号：工单-20260105-001（自动生成，使用第一个工单号）
     - 产品：产品A（自动填充）
     - 数量：100个（自动计算：50+30+20）
     - 工艺路线：产品A工艺路线（自动填充）
     - 计划开始时间：2026-01-05 08:00（自动填充，使用最早工单的开始时间）
     - 计划结束时间：2026-01-05 18:00（自动计算，基于合并数量和标准工时）
   - 确认合并
   - **系统自动处理**：
     - 创建合并工单：工单-20260105-001（数量：100个）
     - 原工单状态更新为：已合并
     - 原工单关联到合并工单（支持追溯）
     - 自动生成合并工单工序（基于工艺路线）

2. **合并工单（方式2：按条件自动合并）**
   - 进入"快智造" → "生产执行" → "工单管理" → "工单合并" → "自动合并"
   - **设置合并条件**（核心功能，新增）：
     - 产品相同：是（必选）
     - 工艺路线相同：是（必选）
     - 工单状态：已创建（必选）
     - 时间范围：2026-01-05 至 2026-01-10（可选）
     - 最大合并数量：200个（可选，超过此数量不合并）
   - 点击"自动合并"按钮
   - **系统自动处理**：
     - 自动查找符合条件的工单
     - 自动分组（相同产品、相同工艺路线）
     - 自动合并每组工单
     - 显示合并结果（合并了多少组、合并了多少工单）

3. **合并工单管理**
   - 进入"快智造" → "生产执行" → "工单管理" → "合并工单列表"
   - 查看合并工单列表
   - 查看合并工单详情：
     - 合并工单号：工单-20260105-001
     - 原工单列表：工单-20260105-001、工单-20260105-002、工单-20260105-003
     - 合并数量：100个
     - 合并时间：2026-01-05 10:00
   - 支持拆分合并工单（如果合并有误）

**系统行为：**
- ✅ **工单合并条件检查**（核心功能，新增）：
  - 自动检查产品是否相同
  - 自动检查工艺路线是否相同
  - 自动检查工单状态是否相同
  - 自动检查是否已报工（已报工工单不能合并）
- ✅ **工单合并**：
  - 支持手动选择工单合并
  - 支持按条件自动合并
  - 自动生成合并工单号（使用第一个工单号）
  - 自动计算合并数量
  - 自动更新原工单状态：已合并
  - 自动关联原工单（支持追溯）
- ✅ **合并工单管理**：
  - 独立的合并工单列表
  - 支持查看合并工单详情（原工单列表）
  - 支持拆分合并工单（如果合并有误）
- ✅ **合并工单追溯**：
  - 支持查询合并工单的原工单
  - 支持查询原工单的合并工单
- 🤖 **AI智能建议**：
  - 基于工单信息，建议可合并的工单
  - 分析合并收益（减少换模次数、提高设备利用率）
  - 识别合并风险（交期冲突、产能不足）

**验收标准：**
- ✅ 工单合并条件检查正常（产品、工艺路线、状态、报工状态）
- ✅ 工单合并成功（手动合并和自动合并）
- ✅ 合并工单管理正常（合并工单列表、详情、拆分）
- ✅ 合并工单追溯正常（查询原工单和合并工单）

---

### 3.4 高级排产阶段（可选）

**用户操作：**
1. 进入"快智造" → "计划管理" → "高级排产" → "排产甘特图"
2. 查看所有待排产工单
3. 拖拽调整工单排产计划：
   - 调整工单开始时间
   - 调整工单结束时间
   - 调整工作中心分配
4. 系统自动检查工作中心能力
5. 保存排产计划
6. 导出排产计划（Excel）
7. 打印排产计划（打印模板）

**系统行为：**
- ✅ 显示排产甘特图（可视化排程）
- ✅ 支持拖拽调整排产计划
- ✅ 检查工作中心能力
- ✅ 保存排产计划
- ✅ 导出排产计划（Excel）
- ✅ 打印排产计划

**验收标准：**
- ✅ 排产甘特图展示正常（支持拖拽）
- ✅ 工作中心能力检查正常
- ✅ 排产计划保存成功
- ✅ 排产计划导出成功（Excel）
- ✅ 排产计划打印可用

---

### 3.4.1 工序委外管理（核心功能，新增，增强委外协同）

**应用场景：**
- 部分工序需要委外加工，提高生产效率
- 需要管理委外供应商、委外订单、委外进度
- 需要跟踪委外成本和质量
- 需要与委外供应商协同，实时了解委外进度

**用户操作：**
1. **配置委外工序（方式1：工艺路线中配置）**
   - 进入"主数据管理" → "工艺管理" → "工艺路线管理"
   - 选择工艺路线：产品A工艺路线
   - 编辑工序：组装工序
   - **设置委外属性**（核心功能，新增）：
     - 是否委外：是/否（选择：是）
     - 委外供应商：供应商C（选择，支持多选）
     - 委外单价：10元/件（用户输入）
     - 委外交期：3天（用户输入）
     - 委外质量标准：外观检查、功能检查（用户输入）
   - 保存工艺路线

2. **配置委外工序（方式2：工单中配置）**
   - 进入"快智造" → "生产执行" → "工单管理" → "工单列表"
   - 选择工单：工单-20260105-001（产品A）
   - 编辑工单工序
   - 选择工序：组装工序
   - **设置委外属性**（核心功能，新增）：
     - 是否委外：是（选择）
     - 委外供应商：供应商C（选择）
     - 委外数量：90个（自动填充，基于工单数量）
     - 委外单价：10元/件（自动填充，基于工艺路线配置）
     - 委外交期：3天（自动填充，基于工艺路线配置）
     - 计划委外开始时间：2026-01-08 08:00（自动计算）
     - 计划委外结束时间：2026-01-10 18:00（自动计算）
   - 保存工单

3. **创建委外订单（方式1：从工单下推，推荐）**
   - 进入"快智造" → "生产执行" → "工单管理" → "工单列表"
   - 选择工单：工单-20260105-001（产品A，包含委外工序）
   - 点击"创建委外订单"按钮（一键下推）
   - **系统自动填充**：
     - 委外订单号：委外-20260105-001（自动生成）
     - 关联工单：工单-20260105-001（自动关联）
     - 关联工序：组装工序（自动关联）
     - 委外供应商：供应商C（自动填充）
     - 委外物料：产品A半成品（自动填充）
     - 委外数量：90个（自动填充）
     - 委外单价：10元/件（自动填充）
     - 委外金额：900元（自动计算：90×10）
     - 计划委外开始时间：2026-01-08 08:00（自动填充）
     - 计划委外结束时间：2026-01-10 18:00（自动填充）
   - 确认创建委外订单

4. **创建委外订单（方式2：批量创建）**
   - 进入"快智造" → "委外管理" → "委外订单管理" → "批量创建"
   - 勾选多个包含委外工序的工单（支持全选）
   - 点击"批量创建委外订单"按钮
   - **系统自动处理**：
     - 自动识别委外工序
     - 自动按供应商分组（相同供应商的委外工序合并）
     - 自动创建委外订单（每个供应商一个委外订单）
     - 显示创建结果（创建了多少个委外订单）

5. **委外订单下发（增强委外协同，核心功能）**
   - 进入"快智造" → "委外管理" → "委外订单管理" → "委外订单列表"
   - 选择委外订单：委外-20260105-001
   - 点击"下发委外订单"按钮
   - **系统自动处理**：
     - 自动发送委外订单到供应商协同平台（核心功能，新增）
     - 供应商在协同平台接收委外订单
     - 供应商确认接收委外订单
     - 系统自动更新委外订单状态：已下发
     - 自动通知相关人员（采购员、生产管理员）

6. **委外进度跟踪（增强委外协同，核心功能）**
   - 进入"快智造" → "委外管理" → "委外订单管理" → "委外订单详情"
   - 选择委外订单：委外-20260105-001
   - **查看委外进度**（核心功能，新增）：
     - **供应商协同平台实时更新**（核心功能，新增）：
       - 委外开始时间：2026-01-08 08:00（供应商在协同平台更新）
       - 委外进度：60%（供应商在协同平台更新）
       - 已完成数量：54个（供应商在协同平台更新）
       - 预计完成时间：2026-01-10 16:00（供应商在协同平台更新）
     - **系统自动同步**（核心功能，新增）：
       - 自动从供应商协同平台同步委外进度
       - 自动更新委外订单进度
       - 自动更新工单进度（委外工序进度）
       - 自动通知相关人员（委外进度更新）
   - **委外进度预警**（核心功能，新增）：
     - 如果委外进度滞后，系统自动预警
     - 显示AI建议的应对措施（催促供应商、调整计划等）

7. **委外完工验收（增强委外协同，核心功能）**
   - 供应商在协同平台提交委外完工申请
   - 系统自动接收委外完工申请
   - 进入"快智造" → "委外管理" → "委外订单管理" → "委外验收"
   - 选择委外订单：委外-20260105-001
   - **填写验收信息**：
     - 验收数量：90个（自动填充，基于委外订单数量）
     - 合格数量：88个（用户输入）
     - 不合格数量：2个（自动计算）
     - 验收结果：合格/不合格/部分合格（选择：部分合格）
     - 验收时间：2026-01-10 18:00（自动记录）
     - 验收人：张三（自动填充）
   - 提交验收结果
   - **系统自动处理**：
     - 验收合格：自动更新委外订单状态：已完工
     - 验收不合格：自动创建委外返工单或退货单
     - 自动更新工单进度（委外工序完成）
     - 自动更新库存（委外完工物料入库）
     - 自动生成应付单（委外费用）

8. **委外成本统计**（核心功能，新增）
   - 进入"快智造" → "委外管理" → "委外订单管理" → "委外成本统计"
   - 查看委外成本统计报表：
     - 按供应商统计：供应商C委外金额10000元，供应商D委外金额8000元
     - 按物料统计：产品A半成品委外金额5000元，产品B半成品委外金额3000元
     - 按时间段统计：1月份委外金额50000元，2月份委外金额60000元
     - 委外成本趋势：按时间段统计委外成本趋势
   - 导出委外成本统计报表（Excel）

**系统行为：**
- ✅ **委外工序配置**：
  - 支持在工艺路线中配置委外属性
  - 支持在工单中配置委外属性
  - 自动填充委外单价和交期（基于工艺路线配置）
- ✅ **委外订单创建**：
  - 支持从工单下推创建委外订单（一键下推）
  - 支持批量创建委外订单
  - 自动按供应商分组（相同供应商合并）
- ✅ **委外订单下发**（增强委外协同，核心功能，新增）：
  - 自动发送委外订单到供应商协同平台
  - 供应商在协同平台接收和确认委外订单
  - 自动更新委外订单状态
- ✅ **委外进度跟踪**（增强委外协同，核心功能，新增）：
  - 供应商在协同平台实时更新委外进度
  - 系统自动同步委外进度
  - 自动更新工单进度
  - 自动预警委外进度滞后
- ✅ **委外完工验收**（增强委外协同，核心功能，新增）：
  - 供应商在协同平台提交委外完工申请
  - 系统自动接收委外完工申请
  - 支持委外验收（合格、不合格、部分合格）
  - 自动更新委外订单状态和工单进度
  - 自动生成应付单
- ✅ **委外成本统计**（核心功能，新增）：
  - 自动统计委外成本（按供应商、物料、时间段）
  - 自动生成委外成本统计报表
  - 支持导出委外成本统计报表（Excel）
- 🤖 **AI智能建议**：
  - 基于历史数据，建议委外供应商选择
  - 分析委外成本，建议成本优化方案
  - 识别委外进度风险，建议应对措施

**验收标准：**
- ✅ 委外工序配置成功（工艺路线和工单中配置）
- ✅ 委外订单创建成功（从工单下推和批量创建）
- ✅ 委外订单下发正常（发送到供应商协同平台）
- ✅ 委外进度跟踪正常（供应商协同平台实时更新，系统自动同步）
- ✅ 委外完工验收正常（供应商提交完工申请，系统验收）
- ✅ 委外成本统计正常（按供应商、物料、时间段统计）

---

### 3.5 工单下达阶段（优化：批量下达+智能检查）

**用户操作（优化后，极致简化）：**
1. 进入"快智造" → "生产执行" → "工单管理" → "工单列表"
2. **方式1：批量下达（推荐，中小企业常用）**
   - 勾选多个已排产的工单（支持全选）
   - 点击"批量下达"按钮
   - **系统自动检查并显示结果**：
     - 齐套料检查结果（缺料预警）
     - 交期风险评估（延期风险提示）
     - 工作中心能力检查（产能冲突提示）
   - 查看检查结果：
     - **全部通过**：点击"确认批量下达"，系统自动下达所有工单
     - **部分异常**：系统自动标记异常工单，用户可选择：
       - 忽略异常，强制下达所有工单
       - 排除异常工单，下达正常工单
   - **完成，<1分钟**

3. **方式2：单个下达（可选）**
   - 选择已排产的工单
   - 点击"下达"按钮
   - 系统自动检查并显示AI建议
   - 确认下达工单（可选择忽略AI建议强制下达）

**系统行为（优化后）：**
- ✅ **耗时统计**（核心功能，新增）：
  - 记录工单下达时间（节点4：工单下达）
  - 自动计算从工单创建到工单下达的节点间耗时（节点3→节点4，基于操作人员的工作时间段，只统计工作时间）
- ✅ **批量下达**：支持批量下达多个工单（核心优化）
- ✅ **智能检查**：批量下达前，自动检查所有工单的齐套料、交期、产能
- ✅ **智能标记**：自动标记异常工单，方便用户快速识别
- ✅ **冻结工单检查**（核心功能，新增）：
  - 自动检查工单是否已冻结
  - 已冻结工单不能下达（自动排除）
  - 下达时自动提示冻结工单
- ✅ 更新工单状态为"已下达"
- ✅ 触发工单状态流转工作流（Inngest）
- ✅ 通知相关人员（生产管理员、车间工人）
- 🤖 **AI智能建议**（通过Inngest AI工作流）：
  - **齐套料分析**：自动检查物料齐套情况，缺料时提示并建议解决方案
  - **交期风险评估**：基于历史数据和当前产能，预测交期风险，建议调整计划
  - **工作中心能力检查**：检测工作中心产能冲突，建议调整排产计划
  - **优化建议**：基于历史数据，建议最佳下达时机和排产顺序

**验收标准：**
- ✅ **耗时统计正常**（核心功能，新增）：
  - ✅ 工单下达时间记录成功
  - ✅ 节点间耗时统计正常（工单创建→工单下达，基于操作人员的工作时间段，排除非工作时间）
- ✅ **批量下达正常**（核心功能）
- ✅ **冻结工单检查正常**（核心功能，新增）：
  - ✅ 自动检查工单是否已冻结
  - ✅ 已冻结工单不能下达（自动排除）
  - ✅ 下达时自动提示冻结工单
- ✅ 工单下达成功
- ✅ 工单状态更新成功
- ✅ 通知发送成功
- ✅ AI建议正常显示（下达前弹窗提示，可查看详细分析）
- ✅ 齐套料检查正常（缺料时明确提示）
- ✅ 交期风险评估正常（延期风险提前预警）

**优化效果：**
- ⚡ **操作步骤减少**：从6步减少到3步（勾选→批量下达→确认）
- ⚡ **时间缩短**：从10分钟（单个下达）减少到<1分钟（批量下达）
- ⚡ **效率提升**：一次操作完成多个工单下达，无需逐个操作
- ⚡ **耗时统计**：自动统计工单下达耗时，帮助识别效率瓶颈

---

### 3.6 生产领料阶段（优化：一键领料+批量领料）

**用户操作（优化后，极致简化）：**
1. **方式1：一键领料（推荐，最简化）**
   - 进入"快智造" → "仓储管理" → "生产领料"
   - 系统自动显示待领料工单列表（已下达但未领料的工单）
   - 选择工单：工单-20260105-001（产品A）
   - 点击"一键领料"按钮
   - **系统自动**：
     - 根据BOM生成领料需求（自动计算数量）
     - 检查库存是否充足（缺料时自动预警）
     - 创建出库单（自动填充所有字段）
     - 自动更新库存
     - 自动打印出库单（可选）
   - **完成，<30秒**

2. **方式2：批量领料（推荐，多工单）**
   - 进入"快智造" → "仓储管理" → "生产领料"
   - 勾选多个待领料工单（支持全选）
   - 点击"批量领料"按钮
   - 系统自动批量创建出库单（每个工单一个出库单）
   - **完成，<1分钟**

3. **方式3：手动创建（可选）**
   - 进入"快智造" → "仓储管理" → "出库管理"
   - 点击"新建"按钮
   - 选择关联工单：工单-20260105-001（产品A）
   - 系统自动根据BOM生成领料需求
   - 确认领料数量
   - 提交出库单

4. **方式4：批量导入（可选）**
   - 打开出库单导入universheet在线表格（系统自动创建模板）
   - 在universheet中填写出库单数据（实时保存）
   - 点击"导入"按钮，系统自动导入

**系统行为（优化后）：**
- ✅ **耗时统计**（核心功能，新增）：
  - 记录生产领料出库单创建时间（节点5：生产领料）
  - 自动计算从工单下达到生产领料的节点间耗时（节点4→节点5，基于操作人员的工作时间段，只统计工作时间）
- ✅ **单据关联展示**（核心功能，新增）：
  - 在生产领料出库单详情页面展示上游关联单据（工单）和下游关联单据（报工记录）
  - 支持点击跳转到关联单据详情
- ✅ **单据下推功能**（核心功能，新增）：
  - 支持从工单下推到生产领料出库单（一键下推，一键领料功能）
  - 自动传递工单和BOM信息到出库单
- ✅ **单据上拉功能**（核心功能，新增）：
  - 支持从生产领料出库单上拉到工单（手动关联或智能关联）
- ✅ **一键领料**：选择工单后，一键完成领料（核心优化，单据下推功能）
- ✅ **批量领料**：支持批量领料多个工单（核心优化）
- ✅ **智能默认值**：自动填充仓库、库位（基于物料默认仓库）
- ✅ **自动检查**：领料前自动检查库存是否充足
- ✅ 根据工单和BOM自动生成领料需求
- ✅ 创建出库单
- ✅ 自动更新库存数量
- ✅ 记录出库历史
- ✅ 批量导入出库单（universheet在线表格，实时保存）
- ✅ 打印出库单（自动打印，可选）
- 🤖 **AI智能建议**（通过Inngest AI工作流）：
  - **缺料预警**：检测库存不足，自动提示缺料物料和缺料数量
  - **替代料建议**：当主料缺料时，自动推荐可用的替代料
  - **领料优化建议**：基于历史数据，建议最佳领料时机和批量
  - **库存预警**：领料后库存低于安全库存时，自动预警并建议采购

**验收标准：**
- ✅ **耗时统计正常**（核心功能，新增）：
  - ✅ 生产领料出库单创建时间记录成功
  - ✅ 节点间耗时统计正常（工单下达→生产领料，基于操作人员的工作时间段，排除非工作时间）
- ✅ **单据关联展示正常**（核心功能，新增）：
  - ✅ 生产领料出库单详情页面显示上下游关联单据
  - ✅ 关联单据快速跳转正常
- ✅ **单据下推功能正常**（核心功能，新增）：
  - ✅ 从工单下推到生产领料出库单正常（一键领料）
  - ✅ 信息传递正确
- ✅ **单据上拉功能正常**（核心功能，新增）：
  - ✅ 从生产领料出库单上拉到工单正常
- ✅ **一键领料正常**（核心功能）
- ✅ **批量领料正常**（核心功能）
- ✅ 生产领料出库单创建成功（支持Excel批量导入）
- ✅ 领料需求自动生成正确
- ✅ 库存自动更新成功
- ✅ 出库单打印可用
- ✅ AI建议正常显示（缺料时弹窗预警，替代料建议显示在侧边栏）

**优化效果：**
- ⚡ **操作步骤减少**：从5步减少到2步（选择工单→一键领料）
- ⚡ **时间缩短**：从5分钟减少到<30秒（一键领料）
- ⚡ **效率提升**：无需手动填写字段，系统自动完成所有操作
- ⚡ **耗时统计**：自动统计生产领料耗时，帮助识别效率瓶颈

---

### 3.6.1 工序报废处理（核心功能，新增）

**应用场景：**
- 生产过程中发现无法返工的不良品，需要报废
- 需要记录报废数量、报废原因、报废成本
- 需要统计报废率，分析报废原因
- 需要追溯报废记录

**用户操作：**
1. **创建工序报废单（方式1：从报工记录创建）**
   - 进入"快智造" → "生产执行" → "报工管理" → "报工记录查询"
   - 选择报工记录：报工-20260115-001（工单：工单-20260105-001，工序：组装工序，完成数量：90个，合格数量：88个，不合格数量：2个）
   - 点击"创建报废单"按钮
   - **系统自动填充**：
     - 报废单号：报废-20260115-001（自动生成）
     - 关联工单：工单-20260105-001（自动关联）
     - 关联工序：组装工序（自动关联）
     - 关联报工记录：报工-20260115-001（自动关联）
     - 物料：产品A半成品（自动填充）
     - 报废数量：2个（自动填充，基于报工不合格数量）
   - **填写报废信息**：
     - 报废原因：无法返工（用户选择或输入）
     - 报废类型：严重不良/一般不良/其他（选择：严重不良）
     - 报废说明：产品损坏严重，无法修复（大文本输入框）
     - 报废时间：2026-01-15 10:00（自动记录）
     - 报废人：张三（自动填充）
   - 提交报废单

2. **创建工序报废单（方式2：手动创建）**
   - 进入"快智造" → "生产执行" → "报废管理" → "新建报废单"
   - 填写报废信息：
     - 关联工单：工单-20260105-001（可选，支持搜索）
     - 关联工序：组装工序（可选）
     - 物料：产品A半成品
     - 报废数量：2个
     - 报废原因：无法返工
     - 报废类型：严重不良
   - 提交报废单

3. **工序报废审批**（核心功能，新增）
   - 进入"快智造" → "生产执行" → "报废管理" → "报废审批"
   - 选择报废单：报废-20260115-001
   - 查看报废单详情：
     - 报废数量：2个
     - 报废原因：无法返工
     - 报废成本：200元（自动计算，基于物料成本）
   - **审批报废单**：
     - 审批结果：同意/不同意（选择：同意）
     - 审批意见：同意报废（大文本输入框，可选）
   - 提交审批结果
   - **系统自动处理**：
     - 审批同意：自动更新工单数量（扣减报废数量）
     - 自动更新库存（不良品库存）
     - 自动更新报废单状态：已审批
     - 自动记录报废成本

4. **工序报废统计分析**（核心功能，新增）
   - 进入"快智造" → "生产执行" → "报废管理" → "报废统计"
   - 查看报废统计报表：
     - 按工单统计：工单-20260105-001报废数量2个，报废率2%
     - 按工序统计：注塑工序报废率1%，组装工序报废率2%
     - 按物料统计：产品A半成品报废率2%，产品B半成品报废率1%
     - 按时间段统计：1月份报废率2%，2月份报废率1.5%
     - 报废成本统计：1月份报废成本10000元，2月份报废成本8000元
   - 导出报废统计报表（Excel）

**系统行为：**
- ✅ **工序报废单创建**：
  - 支持从报工记录创建报废单（一键下推）
  - 支持手动创建报废单
  - 自动关联工单、工序、报工记录
  - 自动填充报废数量（基于报工不合格数量）
- ✅ **工序报废审批**（核心功能，新增）：
  - 支持报废单审批（同意/不同意）
  - 审批同意后，自动更新工单数量和库存
  - 自动记录报废成本
- ✅ **工序报废处理**：
  - 自动更新工单数量（扣减报废数量）
  - 自动更新库存（不良品库存）
  - 自动记录报废成本
- ✅ **工序报废统计分析**（核心功能，新增）：
  - 自动统计报废率（按工单、工序、物料、时间段）
  - 自动统计报废成本（按时间段）
  - 自动生成报废统计报表
  - 支持导出报废统计报表（Excel）
- 🤖 **AI智能建议**：
  - 基于历史数据，预测报废率趋势
  - 分析报废原因，建议改进措施
  - 识别报废高发工序和物料，建议重点关注

**验收标准：**
- ✅ 工序报废单创建成功（从报工记录创建和手动创建）
- ✅ 工序报废审批正常（审批流程、审批结果处理）
- ✅ 工序报废处理正常（更新工单数量、库存、报废成本）
- ✅ 工序报废统计分析正常（按工单、工序、物料、时间段统计）

---

### 3.6.2 工序不良品处理（核心功能，新增）

**应用场景：**
- 生产过程中发现不良品，需要分类处理
- 不良品可以返工、报废、让步接收
- 需要记录不良品数量、不良品类型、不良品原因
- 需要统计不良品率，分析不良品原因

**用户操作：**
1. **创建工序不良品记录（方式1：从报工记录创建）**
   - 进入"快智造" → "生产执行" → "报工管理" → "报工记录查询"
   - 选择报工记录：报工-20260115-001（工单：工单-20260105-001，工序：组装工序，完成数量：90个，合格数量：88个，不合格数量：2个）
   - 点击"创建不良品记录"按钮
   - **系统自动填充**：
     - 不良品记录号：不良-20260115-001（自动生成）
     - 关联工单：工单-20260105-001（自动关联）
     - 关联工序：组装工序（自动关联）
     - 关联报工记录：报工-20260115-001（自动关联）
     - 物料：产品A半成品（自动填充）
     - 不良品数量：2个（自动填充，基于报工不合格数量）
   - **填写不良品信息**：
     - 不良品类型：外观不良/功能不良/尺寸不良/其他（选择：外观不良）
     - 不良品原因：表面划痕（用户输入）
     - 不良品等级：严重/一般/轻微（选择：一般）
     - 不良品说明：产品表面有划痕，影响外观（大文本输入框）
   - 提交不良品记录

2. **工序不良品处理**（核心功能，新增）
   - 进入"快智造" → "生产执行" → "不良品管理" → "不良品处理"
   - 选择不良品记录：不良-20260115-001
   - **选择处理方式**：
     - **方式1：返工处理**（推荐）
       - 点击"返工处理"按钮
       - 系统自动创建返工单（关联原工单和原工序）
       - 返工完成后，重新检验
     - **方式2：报废处理**
       - 点击"报废处理"按钮
       - 系统自动创建报废单（关联原工单和原工序）
       - 自动更新工单数量（扣减报废数量）
       - 自动更新库存（不良品库存）
     - **方式3：让步接收**（需要审批）
       - 点击"让步接收"按钮
       - 填写让步接收原因：不影响使用（大文本输入框）
       - 提交审批（部门经理审批）
       - 审批通过后，允许继续下一工序
       - 系统自动标记：让步接收不良品

3. **工序不良品统计分析**（核心功能，新增）
   - 进入"快智造" → "生产执行" → "不良品管理" → "不良品统计"
   - 查看不良品统计报表：
     - 按工单统计：工单-20260105-001不良品数量2个，不良品率2%
     - 按工序统计：注塑工序不良品率1%，组装工序不良品率2%
     - 按物料统计：产品A半成品不良品率2%，产品B半成品不良品率1%
     - 按不良品类型统计：外观不良60%，功能不良30%，尺寸不良10%
     - 按时间段统计：1月份不良品率2%，2月份不良品率1.5%
   - 导出不良品统计报表（Excel）

**系统行为：**
- ✅ **工序不良品记录创建**：
  - 支持从报工记录创建不良品记录（一键下推）
  - 支持手动创建不良品记录
  - 自动关联工单、工序、报工记录
  - 自动填充不良品数量（基于报工不合格数量）
- ✅ **工序不良品处理**（核心功能，新增）：
  - 支持返工处理（创建返工单）
  - 支持报废处理（创建报废单）
  - 支持让步接收（需要审批）
- ✅ **工序不良品统计分析**（核心功能，新增）：
  - 自动统计不良品率（按工单、工序、物料、时间段）
  - 自动统计不良品类型（外观不良、功能不良、尺寸不良等）
  - 自动生成不良品统计报表
  - 支持导出不良品统计报表（Excel）
- 🤖 **AI智能建议**：
  - 基于历史数据，预测不良品率趋势
  - 分析不良品原因，建议改进措施
  - 识别不良品高发工序和物料，建议重点关注

**验收标准：**
- ✅ 工序不良品记录创建成功（从报工记录创建和手动创建）
- ✅ 工序不良品处理正常（返工、报废、让步接收）
- ✅ 工序不良品统计分析正常（按工单、工序、物料、时间段统计）

---

### 3.7 报工阶段（优化：快速报工+带参数报工+自动填充+工位机触屏模式）

**用户操作（优化后，极致简化，支持移动端和工位机触屏）：**
1. **车间工人操作（三种终端模式）：**
   
   **方式A：工位机触屏模式（推荐，车间固定工位）**
   - **注：** 工位机触屏模式的详细操作请参考第8章：工位机触屏模式
   - 工位机开机，自动进入工位机触屏模式（全屏显示）
   - **触屏界面特点**（详见第8.1节）：
     - 大按钮设计（按钮高度≥60px，适合手指点击）
     - 大字体显示（字体大小≥24px，清晰易读）
     - 全屏模式（无浏览器地址栏，沉浸式体验）
     - 触屏优化布局（元素间距≥20px，避免误触）
   - **扫码报工（最快，推荐）**（详见第8.3节：现场报工）：
     - 点击"扫码报工"大按钮（全屏显示）
     - 扫描工单二维码（自动识别工单信息）
     - 系统自动填充工单信息（大字体显示）
     - **SOP查看**（详见第8.4节）：点击"SOP查看"大按钮，全屏显示SOP步骤
     - **图纸查看**（详见第8.5节）：点击"图纸查看"大按钮，全屏显示图纸
     - **加工程序查看**（详见第8.6节）：点击"加工程序查看"大按钮，全屏显示加工程序
   
   - **报工模式选择（核心功能，根据工序类型自动判断）**：
     - **模式1：按数量报工**（工序类型：按数量报工）
       - 系统自动判断：如果工序类型为"按数量报工"，自动使用按数量报工模式
       - **触屏优化输入界面**：
         - 完成数量：90个（大数字键盘输入，触屏优化）
         - 合格数量：88个（大数字键盘输入，触屏优化）
         - 工时：8小时（可选，大数字键盘输入）
         - 备注：文本输入"正常完成"（大文本输入框，触屏优化，可选）
       - **工站上下料物料绑定**（核心功能，新增）：
         - **上料绑定**（核心功能，新增）：
           - 点击"上料绑定"大按钮（全屏显示）
           - **方式1：扫码绑定上料（推荐，最快）**：
             - 扫描物料二维码/一维码（自动识别物料信息）
             - 系统自动填充：
               - 物料编码：MAT-001（自动识别）
               - 物料名称：原材料A（自动填充）
               - 批次号：20260115-001（如果条码包含批次号，自动识别）
               - 序列号：SN-001（如果条码包含序列号，自动识别）
             - 输入上料数量：100kg（大数字键盘输入，触屏优化）
             - 选择库位：A-01-001（可选，支持搜索）
             - 点击"确认上料"大按钮
             - **完成，<30秒**
           - **方式2：手动选择上料**：
             - 选择物料：原材料A（支持搜索、拼音搜索）
             - 选择批次号：20260115-001（如果物料启用批号管理）
             - 选择序列号：SN-001（如果物料启用序列号管理）
             - 输入上料数量：100kg（大数字键盘输入）
             - 选择库位：A-01-001（可选）
             - 点击"确认上料"大按钮
         - **下料绑定**（核心功能，新增）：
           - 点击"下料绑定"大按钮（全屏显示）
           - **方式1：扫码绑定下料（推荐，最快）**：
             - 扫描物料二维码/一维码（自动识别物料信息）
             - 系统自动填充：
               - 物料编码：MAT-002（自动识别）
               - 物料名称：半成品B（自动填充）
               - 批次号：20260115-002（如果条码包含批次号，自动识别）
               - 序列号：SN-002（如果条码包含序列号，自动识别）
             - 输入下料数量：90个（大数字键盘输入，触屏优化）
             - 选择库位：B-01-001（可选，支持搜索）
             - 点击"确认下料"大按钮
             - **完成，<30秒**
           - **方式2：手动选择下料**：
             - 选择物料：半成品B（支持搜索、拼音搜索）
             - 选择批次号：20260115-002（如果物料启用批号管理）
             - 选择序列号：SN-002（如果物料启用序列号管理）
             - 输入下料数量：90个（大数字键盘输入）
             - 选择库位：B-01-001（可选）
             - 点击"确认下料"大按钮
         - **上料下料记录查看**（核心功能，新增）：
           - 在报工界面显示已绑定的上料和下料记录
           - 上料记录列表：
             - 上料1：原材料A，批次号20260115-001，数量100kg，库位A-01-001
             - 上料2：原材料B，批次号20260115-002，数量50kg，库位A-01-002
           - 下料记录列表：
             - 下料1：半成品B，批次号20260115-002，数量90个，库位B-01-001
           - 支持删除上料/下料记录（如果未提交报工）
           - 支持修改上料/下料数量（如果未提交报工）
       - **如果是带参数SOP，自动显示参数收集表单**：
         - **SOP指定参数**（大表单输入，触屏优化）：
           - 扭矩：25N·m（大数字键盘输入，范围：20-30）
           - 外观检查：是大按钮/否大按钮（触屏选择，易于点击）
           - 其他参数...（根据SOP配置动态显示，触屏优化）
       - 点击"提交"大按钮（全屏底部固定，易于点击）
       - **提交后，系统自动**：
         - 保存报工数据（包含参数数据）
         - 保存上料下料绑定记录（关联到报工记录）
         - 自动更新上料物料库存（扣减上料物料库存）
         - 自动更新下料物料库存（增加下料物料库存）
         - 更新工单进度
         - **自动切换到下一工序**（如果还有未完成工序）
       - **完成，<30秒（无参数）或<1分钟（有参数）或<2分钟（有上料下料绑定）**
     
     - **模式2：按状态报工**（工序类型：按状态报工，核心功能，新增）
       - 系统自动判断：如果工序类型为"按状态报工"，自动使用按状态报工模式
       - **触屏优化输入界面**：
         - 完成状态：完成大按钮/未完成大按钮（触屏选择，易于点击）
         - 工时：8小时（可选，大数字键盘输入）
         - 备注：文本输入"检验通过"（大文本输入框，触屏优化，可选）
       - **如果是带参数SOP，自动显示参数收集表单**：
         - **SOP指定参数**（大表单输入，触屏优化）：
           - 检验结果：合格大按钮/不合格大按钮（触屏选择，易于点击）
           - 检验员：张三（大文本输入框，触屏优化）
           - 其他参数...（根据SOP配置动态显示，触屏优化）
       - 点击"提交"大按钮
       - **完成，<30秒（无参数）或<1分钟（有参数）**
   
   - **工序跳转规则校验**（核心功能，新增）：
     - 系统自动检查：当前工序是否允许报工（基于跳转规则）
     - **不允许跳转**：如果上道工序未完成，系统提示"请先完成上道工序"
     - **允许跳转**：可以随时报工，不依赖上道工序完成
     - 报工成功后，系统自动更新工序状态
   
   - **提交后，系统自动**：
     - 保存报工数据（包含参数数据）
     - 更新工单进度
     - **自动切换到下一工序**（如果还有未完成工序）
     - 显示"报工成功"大提示（触屏优化，3秒后自动关闭）
   
   **方式B：移动端模式（推荐，移动工位）**
   - 打开移动端报工界面（首页快捷入口）
   - **方式1：扫码报工（最快，推荐）**
     - 扫描工单二维码（自动识别工单信息）
     - 系统自动填充：
       - 工单号：工单-20260105-001（自动识别）
       - 产品：产品A（自动填充）
       - **当前工序：组装工序**（自动填充，基于工单工序顺序）
       - 计划数量：90个（自动填充）
       - **如果是带SOP工艺路线，自动显示SOP**（核心功能）
         - 显示SOP标题：《组装作业标准》
         - 显示SOP步骤（可查看，指导操作）
     
     - **报工模式选择（核心功能，根据工序类型自动判断）**：
       - **模式1：按数量报工**（工序类型：按数量报工）
         - 系统自动判断：如果工序类型为"按数量报工"，自动使用按数量报工模式
         - **用户只需输入**：
           - 完成数量：90个（默认等于计划数量，可修改）
           - 合格数量：88个（默认等于完成数量，可修改）
           - 工时：8小时（可选，系统可自动计算）
           - 备注：文本输入"正常完成"（大文本输入框，触屏优化，可选）
         - **工站上下料物料绑定**（核心功能，新增）：
           - **上料绑定**（核心功能，新增）：
             - 点击"上料绑定"按钮
             - **方式1：扫码绑定上料（推荐，最快）**：
               - 扫描物料二维码/一维码（自动识别物料信息）
               - 系统自动填充：
                 - 物料编码：MAT-001（自动识别）
                 - 物料名称：原材料A（自动填充）
                 - 批次号：20260115-001（如果条码包含批次号，自动识别）
                 - 序列号：SN-001（如果条码包含序列号，自动识别）
               - 输入上料数量：100kg
               - 选择库位：A-01-001（可选）
               - 点击"确认上料"按钮
               - **完成，<30秒**
             - **方式2：手动选择上料**：
               - 选择物料：原材料A（支持搜索、拼音搜索）
               - 选择批次号：20260115-001（如果物料启用批号管理）
               - 选择序列号：SN-001（如果物料启用序列号管理）
               - 输入上料数量：100kg
               - 选择库位：A-01-001（可选）
               - 点击"确认上料"按钮
           - **下料绑定**（核心功能，新增）：
             - 点击"下料绑定"按钮
             - **方式1：扫码绑定下料（推荐，最快）**：
               - 扫描物料二维码/一维码（自动识别物料信息）
               - 系统自动填充：
                 - 物料编码：MAT-002（自动识别）
                 - 物料名称：半成品B（自动填充）
                 - 批次号：20260115-002（如果条码包含批次号，自动识别）
                 - 序列号：SN-002（如果条码包含序列号，自动识别）
               - 输入下料数量：90个
               - 选择库位：B-01-001（可选）
               - 点击"确认下料"按钮
               - **完成，<30秒**
             - **方式2：手动选择下料**：
               - 选择物料：半成品B（支持搜索、拼音搜索）
               - 选择批次号：20260115-002（如果物料启用批号管理）
               - 选择序列号：SN-002（如果物料启用序列号管理）
               - 输入下料数量：90个
               - 选择库位：B-01-001（可选）
               - 点击"确认下料"按钮
           - **上料下料记录查看**（核心功能，新增）：
             - 在报工界面显示已绑定的上料和下料记录
             - 上料记录列表：
               - 上料1：原材料A，批次号20260115-001，数量100kg，库位A-01-001
               - 上料2：原材料B，批次号20260115-002，数量50kg，库位A-01-002
             - 下料记录列表：
               - 下料1：半成品B，批次号20260115-002，数量90个，库位B-01-001
             - 支持删除上料/下料记录（如果未提交报工）
             - 支持修改上料/下料数量（如果未提交报工）
         - **如果是带参数SOP，自动显示参数收集表单**（基于SOP的form_config）：
           - **SOP指定参数**（自动显示，基于SOP配置）：
             - 扭矩：25N·m（数字，必填，范围：20-30）
             - 外观检查：是（选择：是/否，必填）
             - 其他参数...（根据SOP配置动态显示）
         - 填写所有必填参数
         - 点击"提交"按钮
         - **提交后，系统自动**：
           - 保存报工数据（包含参数数据）
           - 保存上料下料绑定记录（关联到报工记录）
           - 自动更新上料物料库存（扣减上料物料库存）
           - 自动更新下料物料库存（增加下料物料库存）
           - 更新工单进度
           - **自动切换到下一工序**（如果还有未完成工序）
         - **完成，<30秒（无参数）或<1分钟（有参数）或<2分钟（有上料下料绑定）**
       
       - **模式2：按状态报工**（工序类型：按状态报工，核心功能，新增）
         - 系统自动判断：如果工序类型为"按状态报工"，自动使用按状态报工模式
         - **用户只需选择**：
           - 完成状态：完成/未完成（选择，必填）
           - 工时：8小时（可选，系统可自动计算）
           - 备注：文本输入"检验通过"（大文本输入框，触屏优化，可选）
         - **如果是带参数SOP，自动显示参数收集表单**（基于SOP的form_config）：
           - **SOP指定参数**（自动显示，基于SOP配置）：
             - 检验结果：合格（选择：合格/不合格，必填）
             - 检验员：张三（文本，必填）
             - 其他参数...（根据SOP配置动态显示）
         - 填写所有必填参数
         - 点击"提交"按钮
         - **完成，<30秒（无参数）或<1分钟（有参数）**
     
     - **工序跳转规则校验**（核心功能，新增）：
       - 系统自动检查：当前工序是否允许报工（基于跳转规则）
       - **不允许跳转**：如果上道工序未完成，系统提示"请先完成上道工序"
       - **允许跳转**：可以随时报工，不依赖上道工序完成
       - 报工成功后，系统自动更新工序状态
     
     - **提交后，系统自动**：
       - 保存报工数据（包含参数数据）
       - 更新工单进度
       - **自动切换到下一工序**（如果还有未完成工序）
       - 如果是带参数报工，参数数据自动保存到报工记录中

   - **方式2：快速报工（无扫码设备）**
     - 输入工单号（支持拼音搜索）
     - 系统自动填充工单信息
     - 输入完成数量和合格数量
     - 提交报工

2. **生产管理员操作（PC端）：**
   - 进入"快智造" → "生产执行" → "报工管理" → "报工记录查询"
   - 查看报工记录（使用高级搜索，支持拼音搜索）
   - 查看工单进度（自动更新）

**系统行为（优化后）：**
- ✅ **耗时统计**（核心功能，新增）：
  - 记录首道工序报工时间（节点6：报工开始）
  - 记录最后一道工序报工时间（节点7：报工完成）
  - 自动计算从生产领料到报工开始的节点间耗时（节点5→节点6，基于操作人员的工作时间段，只统计工作时间）
  - 自动计算报工总耗时（节点6→节点7，基于操作人员的工作时间段，只统计工作时间）
- ✅ **单据关联展示**（核心功能，新增）：
  - 在报工记录详情页面展示上游关联单据（工单）和下游关联单据（成品入库单）
  - 支持点击跳转到关联单据详情
- ✅ **单据下推功能**（核心功能，新增）：
  - 支持从工单下推到报工记录（移动端/工位机，扫码报工功能）
  - 自动传递工单和工序信息到报工记录
- ✅ **单据上拉功能**（核心功能，新增）：
  - 支持从报工记录上拉到工单（手动关联或智能关联）
  - AI辅助智能上拉关联（自动推荐匹配的工单）
- ✅ **工站上下料物料绑定**（核心功能，新增）：
  - **上料绑定**：
    - 支持扫码绑定上料（扫描物料二维码/一维码，自动识别物料信息）
    - 支持手动选择上料（选择物料、批次号、序列号）
    - 自动识别物料信息（物料编码、物料名称、批次号、序列号）
    - 自动填充上料信息（基于扫码结果）
    - 记录上料绑定记录（关联到报工记录）
    - 自动更新上料物料库存（扣减上料物料库存）
  - **下料绑定**：
    - 支持扫码绑定下料（扫描物料二维码/一维码，自动识别物料信息）
    - 支持手动选择下料（选择物料、批次号、序列号）
    - 自动识别物料信息（物料编码、物料名称、批次号、序列号）
    - 自动填充下料信息（基于扫码结果）
    - 记录下料绑定记录（关联到报工记录）
    - 自动更新下料物料库存（增加下料物料库存）
  - **上料下料记录管理**：
    - 支持查看已绑定的上料和下料记录
    - 支持删除上料/下料记录（如果未提交报工）
    - 支持修改上料/下料数量（如果未提交报工）
    - 支持上料下料记录查询（高级搜索，拼音搜索）
    - 支持上料下料记录导出（Excel）
- ✅ **工位机触屏模式**（核心功能，新增）
  - **自动识别终端类型**：检测到工位机设备，自动切换到触屏模式
  - **触屏优化界面**：
    - 大按钮设计（按钮高度≥60px，适合手指点击）
    - 大字体显示（字体大小≥24px，清晰易读）
    - 全屏模式（无浏览器地址栏，沉浸式体验）
    - 触屏优化布局（元素间距≥20px，避免误触）
  - **SOP查看优化**：
    - 全屏显示SOP内容（触屏优化）
    - 支持触屏滑动查看SOP步骤
    - 支持触屏缩放查看SOP图片
    - 支持触屏翻页（左右滑动）
  - **图纸查看优化**（核心功能，新增）：
    - 全屏显示图纸（触屏优化）
    - 支持触屏缩放（双指捏合）
    - 支持触屏拖拽（单指移动）
    - 支持触屏旋转（横屏/竖屏自动适配）
    - 支持图纸标注（触屏画笔功能）
  - **加工程序查看优化**（核心功能，新增）：
    - 全屏显示加工程序（触屏优化）
    - 支持触屏滚动查看程序代码
    - 支持触屏搜索程序内容（大键盘输入）
    - 支持程序高亮显示（语法高亮）
    - 支持程序行号显示
  - **触屏输入优化**：
  - 大数字键盘（触屏优化，易于输入）
  - 大文本输入框（触屏优化，易于输入，备注输入）
  - 大选择按钮（触屏优化，易于选择）
- ✅ **扫码报工**：扫描二维码后，自动识别工单信息并填充（核心优化）
- ✅ **智能默认值**：自动填充工单号、产品、工序、计划数量（核心优化）
- ✅ **工序类型自动判断**（核心功能，新增）：
  - **按数量报工**：工序类型为"按数量报工"时，显示数量输入框（完成数量、合格数量）
  - **按状态报工**：工序类型为"按状态报工"时，显示状态选择框（完成/未完成）
  - 系统根据工序类型自动显示对应的报工界面
- ✅ **工序跳转规则校验**（核心功能，新增）：
  - 报工前自动检查：当前工序是否允许报工（基于跳转规则）
  - **不允许跳转**：如果上道工序未完成，系统阻止报工并提示"请先完成上道工序"
  - **允许跳转**：可以随时报工，不依赖上道工序完成
  - 报工成功后，系统自动更新工序状态
- ✅ **按数量报工模式**：工序类型为"按数量报工"时，只需输入完成数量和合格数量（核心功能，新增）
- ✅ **按状态报工模式**：工序类型为"按状态报工"时，只需选择完成状态（核心功能，新增）
- ✅ **带参数报工模式**：带参数SOP，自动显示参数收集表单（核心功能，新增）
  - 根据SOP的form_config自动生成参数表单
  - 支持数字、文本、选择、日期等参数类型
  - 支持参数验证（必填、范围、格式等）
  - 参数数据自动保存到报工记录
- ✅ **文本输入优化**：大文本输入框输入备注，触屏优化，易于输入（核心优化）
- ✅ **自动计算**：工时可选，系统可基于历史数据自动计算
- ✅ **自动切换工序**：报工完成后，自动切换到下一工序（核心优化）
- ✅ 记录报工数据（包含参数数据）
- ✅ 自动更新工单进度
- ✅ 自动判断工单完工（所有工序完成）
- ✅ 触发报工数据处理工作流（Inngest）
- ✅ 触发工单进度更新工作流（Inngest）
- ✅ 高级搜索（拼音搜索）
- ✅ 批量导入报工记录（universheet在线表格，实时保存）
- 🤖 **AI智能建议**（通过Inngest AI工作流）：
  - **异常检测**：自动检测报工数据异常（不良率异常、工时异常、进度异常、参数异常）
  - **参数分析**：分析参数数据，检测异常参数值（如：温度超出范围）
  - **质量预警**：不良率超过阈值时，自动预警并建议质量改进措施
  - **效率分析**：基于历史数据，分析报工效率，建议优化措施
  - **交期预警**：进度滞后时，自动预警交期风险，建议加快进度措施

**验收标准：**
- ✅ **耗时统计正常**（核心功能，新增）：
  - ✅ 首道工序报工时间记录成功（节点6：报工开始）
  - ✅ 最后一道工序报工时间记录成功（节点7：报工完成）
  - ✅ 节点间耗时统计正常（生产领料→报工开始，报工开始→报工完成，基于操作人员的工作时间段，排除非工作时间）
- ✅ **单据关联展示正常**（核心功能，新增）：
  - ✅ 报工记录详情页面显示上下游关联单据
  - ✅ 关联单据快速跳转正常
- ✅ **单据下推功能正常**（核心功能，新增）：
  - ✅ 从工单下推到报工记录正常（扫码报工）
  - ✅ 信息传递正确
- ✅ **单据上拉功能正常**（核心功能，新增）：
  - ✅ 从报工记录上拉到工单正常
  - ✅ AI智能上拉关联正常
- ✅ **工位机触屏模式正常**（自动识别终端类型，切换到触屏模式）
- ✅ **触屏界面优化正常**（大按钮、大字体、全屏模式、触屏优化布局）
- ✅ **SOP查看优化正常**（全屏显示、触屏滑动、触屏缩放）
- ✅ **图纸查看优化正常**（全屏显示、触屏缩放、触屏拖拽、触屏旋转、图纸标注）
- ✅ **加工程序查看优化正常**（全屏显示、触屏滚动、触屏搜索、语法高亮）
- ✅ **触屏输入优化正常**（大数字键盘、大文本输入框、大选择按钮）
- ✅ **扫码报工正常**（扫描后自动填充，核心功能）
- ✅ **工序类型自动判断正常**（核心功能，新增）：
  - ✅ 按数量报工界面正常（显示数量输入框）
  - ✅ 按状态报工界面正常（显示状态选择框）
- ✅ **工序跳转规则校验正常**（核心功能，新增）：
  - ✅ 不允许跳转规则生效（必须完成上道工序才能报工）
  - ✅ 允许跳转规则生效（可以随时报工）
  - ✅ 系统自动阻止不符合规则的报工
- ✅ **按数量报工正常**（工序类型：按数量报工，<30秒完成）
- ✅ **按状态报工正常**（工序类型：按状态报工，<30秒完成）
- ✅ **带参数报工正常**（带参数SOP，自动显示参数表单，<1分钟完成）
- ✅ **工站上下料物料绑定正常**（核心功能，新增）：
  - ✅ 上料绑定正常（扫码绑定和手动选择）
  - ✅ 下料绑定正常（扫码绑定和手动选择）
  - ✅ 上料下料记录保存正常（关联到报工记录）
  - ✅ 上料物料库存更新正常（扣减库存）
  - ✅ 下料物料库存更新正常（增加库存）
  - ✅ 上料下料记录查询正常（高级搜索，拼音搜索）
  - ✅ 上料下料记录导出正常（Excel）
- ✅ **智能默认值正常**（自动填充工单信息）
- ✅ **参数收集正常**（根据SOP配置自动显示参数表单）
- ✅ **参数验证正常**（必填、范围、格式等验证）
- ✅ **文本输入优化正常**（大文本输入框，触屏优化）
- ✅ **自动切换工序正常**（报工完成后自动切换）
- ✅ 报工功能正常（移动端和工位机触屏优化）
- ✅ 工单进度自动更新正常
- ✅ 工单完工自动判断正常
- ✅ 报工记录高级搜索可用（拼音搜索）
- ✅ 报工记录批量导入可用（universheet在线表格导入，实时保存）
- ✅ AI建议正常显示（异常时弹窗预警，正常时侧边栏显示效率分析）

**优化效果：**
- ⚡ **操作步骤减少**：
  - 快速报工：从7步减少到3步（扫码→输入数量→提交）
  - 带参数报工：从10步减少到4步（扫码→填写参数→提交）
- ⚡ **时间缩短**：
  - 快速报工：从3分钟减少到<30秒
  - 带参数报工：从5分钟减少到<1分钟
- ⚡ **输入减少**：
  - 快速报工：从7个字段减少到2个字段（完成数量、合格数量）
  - 带参数报工：参数自动显示，无需手动配置
- ⚡ **多终端支持**：支持移动端和工位机触屏模式，适应不同使用场景
- ⚡ **触屏优化**：工位机触屏模式，大按钮、大字体、全屏模式，易于操作
- ⚡ **数据质量提升**：带参数报工，确保关键参数数据收集完整

---

### 3.7.1 报工数据修正（核心功能，新增）

**应用场景：**
- 报工数据录入错误，需要修正
- 报工数据需要审批后才能修正
- 支持报工数据修正记录的追溯和统计

**用户操作：**
1. **申请报工数据修正（方式1：报工人申请）**
   - 进入"快智造" → "生产执行" → "报工管理" → "报工记录查询"
   - 选择报工记录：报工-20260115-001（工单：工单-20260105-001，工序：组装工序，完成数量：90个，合格数量：88个）
   - 点击"申请修正"按钮
   - **填写修正申请信息**：
     - 修正类型：数量修正/时间修正/参数修正/其他（选择：数量修正）
     - 原数据：完成数量90个，合格数量88个（自动填充）
     - 修正后数据：完成数量95个，合格数量93个（用户输入）
     - 修正原因：实际完成数量为95个，之前录入错误（大文本输入框，用户输入）
     - 修正说明：详细说明修正原因（大文本输入框，用户输入）
   - 提交修正申请
   - **系统自动处理**：
     - 自动创建报工数据修正申请单
     - 自动发送修正申请到审批流程（部门经理审批）
     - 自动更新报工记录状态：修正申请中

2. **审批报工数据修正申请**（核心功能，新增）
   - 进入"快智造" → "生产执行" → "报工管理" → "报工修正审批"
   - 选择修正申请单：修正-20260115-001
   - 查看修正申请详情：
     - 报工记录：报工-20260115-001
     - 修正类型：数量修正
     - 原数据：完成数量90个，合格数量88个
     - 修正后数据：完成数量95个，合格数量93个
     - 修正原因：实际完成数量为95个，之前录入错误
   - **审批修正申请**：
     - 审批结果：同意/不同意（选择：同意）
     - 审批意见：同意修正（大文本输入框，可选）
   - 提交审批结果
   - **系统自动处理**：
     - 审批同意：自动更新报工记录（完成数量、合格数量）
     - 自动更新工单进度（基于修正后的数量）
     - 自动更新库存（如果已入库，需要调整库存）
     - 自动更新报工记录状态：已修正
     - 自动记录修正历史（原数据、修正后数据、修正时间、修正人）

3. **报工数据修正（方式2：管理员直接修正）**
   - 进入"快智造" → "生产执行" → "报工管理" → "报工记录查询"
   - 选择报工记录：报工-20260115-001
   - 点击"直接修正"按钮（需要管理员权限）
   - **填写修正信息**：
     - 修正类型：数量修正
     - 原数据：完成数量90个，合格数量88个（自动填充）
     - 修正后数据：完成数量95个，合格数量93个（用户输入）
     - 修正原因：实际完成数量为95个，之前录入错误（大文本输入框）
   - 确认修正
   - **系统自动处理**：
     - 自动更新报工记录（完成数量、合格数量）
     - 自动更新工单进度（基于修正后的数量）
     - 自动更新库存（如果已入库，需要调整库存）
     - 自动记录修正历史（原数据、修正后数据、修正时间、修正人）

4. **报工数据修正记录追溯**（核心功能，新增）
   - 进入"快智造" → "生产执行" → "报工管理" → "报工修正记录"
   - 选择报工记录：报工-20260115-001
   - **查看修正历史**：
     - 修正记录1：2026-01-15 10:00，完成数量从90个修正为95个，修正人：张三，审批人：李四
     - 修正记录2：2026-01-15 14:00，合格数量从88个修正为93个，修正人：张三，审批人：李四
   - 支持查看修正详情（原数据、修正后数据、修正原因、审批意见）

**系统行为：**
- ✅ **报工数据修正申请**：
  - 支持报工人申请修正（需要审批）
  - 支持管理员直接修正（无需审批）
  - 自动创建修正申请单
  - 自动发送修正申请到审批流程
- ✅ **报工数据修正审批**（核心功能，新增）：
  - 支持修正申请审批（同意/不同意）
  - 审批同意后，自动更新报工记录
  - 自动更新工单进度和库存
- ✅ **报工数据修正**：
  - 支持数量修正、时间修正、参数修正
  - 自动更新报工记录、工单进度、库存
  - 自动记录修正历史
- ✅ **报工数据修正记录追溯**（核心功能，新增）：
  - 支持查看修正历史（原数据、修正后数据、修正时间、修正人）
  - 支持查看修正详情（修正原因、审批意见）
- 🤖 **AI智能建议**：
  - 基于历史数据，识别异常报工数据
  - 分析修正原因，建议预防措施
  - 识别频繁修正的报工记录，建议重点关注

**验收标准：**
- ✅ 报工数据修正申请成功（报工人申请和管理员直接修正）
- ✅ 报工数据修正审批正常（审批流程、审批结果处理）
- ✅ 报工数据修正正常（更新报工记录、工单进度、库存）
- ✅ 报工数据修正记录追溯正常（查看修正历史、修正详情）

---

### 3.7.2 报工统计分析（核心功能，新增）

**应用场景：**
- 需要统计和分析报工数据，了解生产效率
- 需要识别报工异常，提出改进措施
- 需要生成报工统计报表，支持决策

**用户操作：**
1. **报工效率统计**
   - 进入"快智造" → "生产执行" → "报工管理" → "报工统计"
   - 查看报工效率统计报表：
     - 按工单统计：工单-20260105-001，计划数量100个，完成数量95个，完成率95%
     - 按工序统计：注塑工序平均完成率98%，组装工序平均完成率95%
     - 按人员统计：张三平均完成率96%，李四平均完成率94%
     - 按时间段统计：1月份平均完成率95%，2月份平均完成率97%
   - 查看报工效率趋势图（按时间段）
   - 导出报工效率统计报表（Excel）

2. **报工工时统计**（核心功能，新增）
   - 进入"快智造" → "生产执行" → "报工管理" → "报工统计" → "工时统计"
   - 查看报工工时统计报表：
     - 按工单统计：工单-20260105-001，计划工时10小时，实际工时9.5小时，效率105%
     - 按工序统计：注塑工序平均效率102%，组装工序平均效率98%
     - 按人员统计：张三平均效率100%，李四平均效率98%
     - 按时间段统计：1月份平均效率99%，2月份平均效率101%
   - 查看报工工时趋势图（按时间段）
   - 导出报工工时统计报表（Excel）

3. **报工质量统计**（核心功能，新增）
   - 进入"快智造" → "生产执行" → "报工管理" → "报工统计" → "质量统计"
   - 查看报工质量统计报表：
     - 按工单统计：工单-20260105-001，完成数量95个，合格数量93个，合格率97.9%
     - 按工序统计：注塑工序平均合格率98%，组装工序平均合格率97%
     - 按人员统计：张三平均合格率98%，李四平均合格率96%
     - 按时间段统计：1月份平均合格率97%，2月份平均合格率98%
   - 查看报工质量趋势图（按时间段）
   - 导出报工质量统计报表（Excel）

4. **报工异常统计分析**（核心功能，新增）
   - 进入"快智造" → "生产执行" → "报工管理" → "报工统计" → "异常统计"
   - 查看报工异常统计报表：
     - **异常类型统计**：
       - 不良率异常：10次（不良率超过阈值）
       - 工时异常：5次（实际工时超过计划工时20%）
       - 进度异常：3次（完成进度滞后）
       - 参数异常：2次（报工参数超出范围）
     - **异常原因分析**：
       - 设备故障：40%
       - 操作不当：30%
       - 物料问题：20%
       - 其他：10%
     - **异常趋势分析**：
       - 1月份异常次数：15次
       - 2月份异常次数：10次
       - 异常次数呈下降趋势
   - 导出报工异常统计报表（Excel）

5. **报工绩效分析**（核心功能，新增）
   - 进入"快智造" → "生产执行" → "报工管理" → "报工统计" → "绩效分析"
   - 查看报工绩效分析报表：
     - **人员绩效排名**：
       - 第1名：张三，完成率96%，合格率98%，效率100%
       - 第2名：李四，完成率94%，合格率96%，效率98%
       - 第3名：王五，完成率92%，合格率95%，效率96%
     - **工序绩效排名**：
       - 第1名：注塑工序，完成率98%，合格率98%，效率102%
       - 第2名：组装工序，完成率95%，合格率97%，效率98%
       - 第3名：包装工序，完成率93%，合格率96%，效率97%
     - **工单绩效排名**：
       - 第1名：工单-20260105-001，完成率95%，合格率97.9%，效率105%
       - 第2名：工单-20260106-001，完成率94%，合格率97%，效率103%
   - 导出报工绩效分析报表（Excel）

**系统行为：**
- ✅ **报工效率统计**：
  - 自动统计报工完成率（按工单、工序、人员、时间段）
  - 自动生成报工效率趋势图
  - 支持导出报工效率统计报表（Excel）
- ✅ **报工工时统计**（核心功能，新增）：
  - 自动统计报工工时（计划工时、实际工时、效率）
  - 自动生成报工工时趋势图
  - 支持导出报工工时统计报表（Excel）
- ✅ **报工质量统计**（核心功能，新增）：
  - 自动统计报工合格率（按工单、工序、人员、时间段）
  - 自动生成报工质量趋势图
  - 支持导出报工质量统计报表（Excel）
- ✅ **报工异常统计分析**（核心功能，新增）：
  - 自动识别报工异常（不良率异常、工时异常、进度异常、参数异常）
  - 自动分析异常原因（设备故障、操作不当、物料问题等）
  - 自动生成异常趋势分析
  - 支持导出报工异常统计报表（Excel）
- ✅ **报工绩效分析**（核心功能，新增）：
  - 自动统计人员绩效排名（完成率、合格率、效率）
  - 自动统计工序绩效排名
  - 自动统计工单绩效排名
  - 支持导出报工绩效分析报表（Excel）
- 🤖 **AI智能建议**：
  - 基于历史数据，预测报工效率趋势
  - 分析报工异常原因，建议改进措施
  - 识别报工绩效瓶颈，建议优化方案

**验收标准：**
- ✅ 报工效率统计正常（按工单、工序、人员、时间段统计）
- ✅ 报工工时统计正常（计划工时、实际工时、效率）
- ✅ 报工质量统计正常（合格率统计）
- ✅ 报工异常统计分析正常（异常类型、异常原因、异常趋势）
- ✅ 报工绩效分析正常（人员绩效、工序绩效、工单绩效）

**开发状态：** ✅ 已完成

---

### 3.8 成品入库阶段（优化：一键入库+批量入库）

**用户操作（优化后，极致简化）：**
1. **方式1：一键入库（推荐，最简化）**
   - 进入"快智造" → "仓储管理" → "成品入库"
   - 系统自动显示待入库工单列表（已完工但未入库的工单）
   - 选择工单：工单-20260105-001（产品A）
   - 点击"一键入库"按钮
   - **系统自动**：
     - 自动填充物料：产品A（基于工单）
     - 自动填充数量：88个（基于报工合格数量）
     - 自动填充仓库：成品仓库（基于物料默认仓库）
     - **批号管理**（如果物料启用批号管理）：
       - 系统自动生成批号：20260115-001（基于配置的批号规则）
       - 或提示输入批号（如果配置为手动输入）
     - **序列号管理**（如果物料启用序列号管理）：
       - 系统自动生成序列号：MAT-FIN-0001-20260115-000001 ~ MAT-FIN-0001-20260115-000088（共88个）
       - 或提示输入序列号（如果配置为手动输入）
     - 创建入库单（自动填充所有字段）
     - 自动更新库存
     - 自动打印入库单（可选）
   - **完成，<30秒**

2. **方式2：批量入库（推荐，多工单）**
   - 进入"快智造" → "仓储管理" → "成品入库"
   - 勾选多个待入库工单（支持全选）
   - 点击"批量入库"按钮
   - 系统自动批量创建入库单（每个工单一个入库单）
   - **批号管理**：每个工单自动生成独立批号
   - **序列号管理**：每个物料自动生成连续序列号
   - **完成，<1分钟**

3. **方式3：手动创建（可选，支持批号和序列号）**
   - 进入"快智造" → "仓储管理" → "入库管理"
   - 点击"新建"按钮
   - 选择关联工单：工单-20260105-001（产品A）
   - 系统自动填充物料、数量、仓库
   - **批号管理**（如果物料启用批号管理）：
     - 系统自动生成批号：20260115-001
     - 或手动输入批号
     - 填写批号属性：生产日期、有效期等
   - **序列号管理**（如果物料启用序列号管理）：
     - 系统自动生成序列号（批量生成）
     - 或手动输入序列号（逐个输入或批量导入）
     - 填写序列号属性：生产日期、出厂日期等
   - **装箱打包绑定**（核心功能，新增，如果工序包含包装工序）：
     - **方式1：扫码绑定装箱（推荐，最快）**：
       - 扫描装箱二维码/一维码（自动识别装箱信息）
       - 系统自动填充：
         - 装箱号：BOX-20260115-001（自动识别或自动生成）
         - 装箱数量：10个（自动识别或手动输入）
         - 装箱日期：2026-01-15（自动填充）
         - 装箱人员：张三（自动填充当前用户）
       - **绑定产品序列号**（如果物料启用序列号管理）：
         - 扫描产品序列号（逐个扫描或批量扫描）
         - 系统自动关联产品序列号到装箱号
         - 显示已绑定序列号列表：
           - MAT-FIN-0001-20260115-000001 ~ MAT-FIN-0001-20260115-000010（共10个）
       - **绑定包装物料**（核心功能，新增）：
         - 选择包装物料：纸箱A（支持搜索、拼音搜索）
         - 输入包装物料数量：1个（大数字键盘输入）
         - 扫描包装物料序列号（如果包装物料启用序列号管理）
       - 点击"确认装箱"按钮
       - **完成，<1分钟**
     - **方式2：手动绑定装箱**：
       - 输入装箱号：BOX-20260115-001（或系统自动生成）
       - 输入装箱数量：10个
       - 选择装箱日期：2026-01-15
       - 选择装箱人员：张三
       - **绑定产品序列号**（如果物料启用序列号管理）：
         - 手动选择产品序列号（逐个选择或批量选择）
         - 或批量导入序列号（从Excel导入）
       - **绑定包装物料**（核心功能，新增）：
         - 选择包装物料：纸箱A（支持搜索、拼音搜索）
         - 输入包装物料数量：1个
         - 选择包装物料序列号（如果包装物料启用序列号管理）
       - 点击"确认装箱"按钮
     - **装箱记录查看**（核心功能，新增）：
       - 在入库界面显示已绑定的装箱记录
       - 装箱记录列表：
         - 装箱1：装箱号BOX-20260115-001，产品数量10个，包装物料纸箱A×1，产品序列号MAT-FIN-0001-20260115-000001~000010
         - 装箱2：装箱号BOX-20260115-002，产品数量10个，包装物料纸箱A×1，产品序列号MAT-FIN-0001-20260115-000011~000020
       - 支持删除装箱记录（如果未提交入库单）
       - 支持修改装箱信息（如果未提交入库单）
       - 支持查看装箱详情（装箱号、产品序列号、包装物料、装箱日期、装箱人员）
   - 确认入库数量
   - 提交入库单

4. **方式4：批量导入（可选，支持批号和序列号）**
   - 打开入库单导入universheet在线表格（系统自动创建模板）
   - 在universheet中填写入库单数据（实时保存）：
     - 物料编码、数量、单位
     - 批号（如果物料启用批号管理）
     - 序列号（如果物料启用序列号管理，支持批量填写）
   - 点击"导入"按钮，系统自动导入

**系统行为（优化后）：**
- ✅ **耗时统计**（核心功能，新增）：
  - 记录成品入库单创建时间（节点8：成品入库）
  - 自动计算从报工完成到成品入库的节点间耗时（节点7→节点8，基于操作人员的工作时间段，只统计工作时间）
- ✅ **单据关联展示**（核心功能，新增）：
  - 在成品入库单详情页面展示上游关联单据（工单、报工记录）和下游关联单据（销售出库单）
  - 支持点击跳转到关联单据详情
- ✅ **单据下推功能**（核心功能，新增）：
  - 支持从工单下推到成品入库单（一键下推，一键入库功能）
  - 自动传递工单和报工信息到入库单
- ✅ **单据上拉功能**（核心功能，新增）：
  - 支持从成品入库单上拉到工单（手动关联或智能关联）
- ✅ **一键入库**：选择工单后，一键完成入库（核心优化，单据下推功能）
- ✅ **批量入库**：支持批量入库多个工单（核心优化）
- ✅ **智能默认值**：自动填充物料、数量（基于报工合格数量）、仓库
- ✅ **批号管理**（核心功能，新增）：
  - 如果物料启用批号管理，系统自动生成批号（基于配置的批号规则）
  - 支持手动输入批号（如果配置为手动输入）
  - 支持填写批号属性（生产日期、有效期等）
  - 自动更新批号库存（库存按批号分别管理）
- ✅ **序列号管理**（核心功能，新增）：
  - 如果物料启用序列号管理，系统自动生成序列号（基于配置的序列号规则）
  - 支持手动输入序列号（如果配置为手动输入）
  - 支持批量生成序列号（一次性生成多个序列号）
  - 支持批量导入序列号（从Excel导入）
  - 自动更新序列号库存（库存按序列号分别管理）
  - 自动更新序列号状态（状态：在库）
- ✅ **装箱打包绑定**（核心功能，新增）：
  - **装箱绑定**：
    - 支持扫码绑定装箱（扫描装箱二维码/一维码，自动识别装箱信息）
    - 支持手动绑定装箱（输入装箱号、装箱数量、装箱日期、装箱人员）
    - 自动生成装箱号（基于编码规则，如：BOX-{YYYYMMDD}-{序号}）
    - 自动填充装箱信息（装箱日期、装箱人员）
    - 记录装箱绑定记录（关联到入库单）
  - **产品序列号绑定**（如果物料启用序列号管理）：
    - 支持扫码绑定产品序列号（逐个扫描或批量扫描）
    - 支持手动选择产品序列号（逐个选择或批量选择）
    - 支持批量导入产品序列号（从Excel导入）
    - 自动关联产品序列号到装箱号
    - 记录产品序列号与装箱号的关联关系
  - **包装物料绑定**（核心功能，新增）：
    - 支持选择包装物料（纸箱、托盘、包装袋等）
    - 支持输入包装物料数量
    - 支持绑定包装物料序列号（如果包装物料启用序列号管理）
    - 支持扫码绑定包装物料（扫描包装物料条码）
    - 记录包装物料与装箱号的关联关系
  - **装箱记录管理**：
    - 支持查看已绑定的装箱记录
    - 支持删除装箱记录（如果未提交入库单）
    - 支持修改装箱信息（如果未提交入库单）
    - 支持查看装箱详情（装箱号、产品序列号、包装物料、装箱日期、装箱人员）
    - 支持装箱记录查询（高级搜索，拼音搜索）
    - 支持装箱记录导出（Excel）
    - 支持打印装箱标签（包含装箱号、产品序列号、包装物料等信息）
- ✅ 创建入库单
- ✅ 自动更新库存数量
- ✅ 记录入库历史
- ✅ 批量导入入库单（Excel，支持批号、序列号和装箱绑定）
- ✅ 打印入库单（自动打印，可选）
- ✅ 打印装箱标签（包含装箱号、产品序列号、包装物料等信息）

**验收标准：**
- ✅ **耗时统计正常**（核心功能，新增）：
  - ✅ 成品入库单创建时间记录成功
  - ✅ 节点间耗时统计正常（报工完成→成品入库，基于操作人员的工作时间段，排除非工作时间）
- ✅ **单据关联展示正常**（核心功能，新增）：
  - ✅ 成品入库单详情页面显示上下游关联单据
  - ✅ 关联单据快速跳转正常
- ✅ **单据下推功能正常**（核心功能，新增）：
  - ✅ 从工单下推到成品入库单正常（一键入库）
  - ✅ 信息传递正确
- ✅ **单据上拉功能正常**（核心功能，新增）：
  - ✅ 从成品入库单上拉到工单正常
- ✅ 成品入库单创建成功（支持Excel批量导入）
- ✅ 入库信息自动填充正确
- ✅ **批号管理正常**（如果物料启用批号管理）：
  - ✅ 系统自动生成批号（基于配置的批号规则）
  - ✅ 支持手动输入批号
  - ✅ 批号库存更新正常（库存按批号分别管理）
- ✅ **序列号管理正常**（如果物料启用序列号管理）：
  - ✅ 系统自动生成序列号（批量生成）
  - ✅ 支持手动输入序列号（逐个输入或批量导入）
  - ✅ 序列号库存更新正常（库存按序列号分别管理）
  - ✅ 序列号状态更新正常（状态：在库）
- ✅ **装箱打包绑定正常**（核心功能，新增）：
  - ✅ 装箱绑定正常（扫码绑定和手动绑定）
  - ✅ 产品序列号绑定正常（扫码绑定和手动选择）
  - ✅ 包装物料绑定正常（选择包装物料、输入数量、绑定序列号）
  - ✅ 装箱记录保存正常（关联到入库单）
  - ✅ 装箱记录查询正常（高级搜索，拼音搜索）
  - ✅ 装箱记录导出正常（Excel）
  - ✅ 装箱标签打印正常（包含装箱号、产品序列号、包装物料等信息）
- ✅ 库存自动更新成功
- ✅ 入库单打印可用（包含批号、序列号和装箱信息）

---

### 3.8.1 库存盘点流程（核心功能，新增）

**应用场景：**
- 定期盘点库存，确保库存数据准确
- 支持全盘和抽盘两种盘点方式
- 支持盘点差异处理和调整
- 支持盘点记录的追溯和统计

**用户操作：**
1. **创建盘点计划（方式1：快速创建）**
   - 进入"快智造" → "仓储管理" → "库存盘点" → "盘点计划"
   - 点击"新建盘点计划"按钮
   - 填写盘点信息：
     - 盘点单号：盘点-20260115-001（自动生成）
     - 盘点类型：全盘/抽盘（选择：全盘）
     - 盘点范围：全部仓库/指定仓库/指定物料（选择：全部仓库）
     - 如果选择抽盘：
       - 抽盘比例：10%（用户输入）
       - 抽盘物料：随机选择或指定物料（用户选择）
     - 盘点开始时间：2026-01-15 08:00（用户输入）
     - 盘点结束时间：2026-01-15 18:00（用户输入）
     - 盘点人员：张三、李四（用户选择，支持多选）
   - 保存盘点计划

2. **创建盘点计划（方式2：定期盘点计划）**
   - 进入"快智造" → "仓储管理" → "库存盘点" → "盘点计划" → "定期盘点计划"
   - 点击"新建定期盘点计划"按钮
   - 填写定期盘点信息：
     - 计划名称：月度全盘计划
     - 盘点周期：每月（选择：每月）
     - 盘点日期：每月15日（用户输入）
     - 盘点类型：全盘（选择）
     - 盘点范围：全部仓库（选择）
     - 自动生成盘点计划：是（选择）
   - 保存定期盘点计划
   - **系统自动处理**：
     - 每月15日自动生成盘点计划
     - 自动通知盘点人员

3. **执行盘点（移动端/工位机触屏优化）**
   - 进入"快智造" → "仓储管理" → "库存盘点" → "待盘点任务"
   - 选择盘点单：盘点-20260115-001
   - **扫码盘点**（推荐，最快）：
     - 扫描物料二维码或库位二维码（自动识别物料和库位）
     - 系统自动填充：
       - 物料：原材料A（自动识别）
       - 库位：A-01-001（自动识别）
       - 账面数量：1000kg（自动填充，基于系统库存）
     - 输入实际数量：980kg（大数字键盘输入，触屏优化）
     - 系统自动计算差异：-20kg（自动计算：实际数量-账面数量）
     - 如果存在差异：
       - 差异原因：损耗/丢失/其他（用户选择）
       - 差异说明：正常损耗（大文本输入框，可选）
     - 点击"保存"按钮
     - **完成，<30秒**

4. **批量盘点（核心功能，新增）**
   - 进入"快智造" → "仓储管理" → "库存盘点" → "待盘点任务"
   - 选择盘点单：盘点-20260115-001
   - 点击"批量盘点"按钮
   - **打开批量盘点universheet在线表格**（核心功能，新增）：
     - 系统自动创建盘点表格（包含物料编码、物料名称、库位、账面数量等列）
     - 用户在universheet中填写实际数量（实时保存）
     - 系统自动计算差异（实际数量-账面数量）
     - 点击"导入盘点结果"按钮
     - 系统自动导入盘点结果

5. **盘点差异处理**（核心功能，新增）
   - 进入"快智造" → "仓储管理" → "库存盘点" → "盘点差异处理"
   - 选择盘点单：盘点-20260115-001
   - 查看盘点差异列表：
     - 差异1：原材料A，账面数量1000kg，实际数量980kg，差异-20kg
     - 差异2：产品A，账面数量100个，实际数量102个，差异+2个
   - **处理盘点差异**：
     - 差异1：原材料A，差异-20kg
       - 差异原因：正常损耗（用户选择）
       - 处理方式：调整库存（选择）
       - 调整数量：-20kg（自动填充，基于差异）
       - 调整说明：正常损耗（用户输入）
       - 提交调整申请
     - 差异2：产品A，差异+2个
       - 差异原因：盘点错误（用户选择）
       - 处理方式：重新盘点（选择）
       - 重新盘点后，更新盘点结果
   - **系统自动处理**：
     - 如果选择调整库存：自动创建库存调整单
     - 如果选择重新盘点：自动创建重新盘点任务
     - 自动更新盘点单状态：已处理

6. **盘点结果确认**（核心功能，新增）
   - 进入"快智造" → "仓储管理" → "库存盘点" → "盘点结果确认"
   - 选择盘点单：盘点-20260115-001
   - 查看盘点结果汇总：
     - 盘点物料总数：100个
     - 有差异物料数：5个
     - 差异率：5%
     - 差异金额：5000元
   - 确认盘点结果：
     - 如果差异在可接受范围内：点击"确认盘点结果"按钮
     - 如果差异超出可接受范围：点击"重新盘点"按钮
   - **系统自动处理**：
     - 确认盘点结果：自动更新库存（基于盘点差异）
     - 重新盘点：自动创建重新盘点任务

7. **盘点统计分析**（核心功能，新增）
   - 进入"快智造" → "仓储管理" → "库存盘点" → "盘点统计"
   - 查看盘点统计报表：
     - 按仓库统计：仓库A差异率3%，仓库B差异率5%
     - 按物料统计：原材料A差异率2%，产品A差异率1%
     - 按时间段统计：1月份差异率4%，2月份差异率3%
     - 差异原因统计：正常损耗60%，盘点错误30%，丢失10%
   - 导出盘点统计报表（Excel）

**系统行为：**
- ✅ **盘点计划创建**：
  - 支持快速创建盘点计划
  - 支持定期盘点计划（自动生成）
  - 支持全盘和抽盘两种方式
- ✅ **盘点执行**：
  - 支持移动端和工位机触屏模式（大按钮、大字体、触屏优化）
  - 支持扫码盘点（扫描物料二维码或库位二维码）
  - 支持批量盘点（universheet在线表格，实时保存）
  - 自动计算差异（实际数量-账面数量）
- ✅ **盘点差异处理**（核心功能，新增）：
  - 支持盘点差异分析（差异原因、差异金额）
  - 支持库存调整（自动创建库存调整单）
  - 支持重新盘点（自动创建重新盘点任务）
- ✅ **盘点结果确认**（核心功能，新增）：
  - 支持盘点结果汇总（盘点物料总数、有差异物料数、差异率、差异金额）
  - 支持确认盘点结果（自动更新库存）
  - 支持重新盘点（自动创建重新盘点任务）
- ✅ **盘点统计分析**（核心功能，新增）：
  - 自动统计盘点差异（按仓库、物料、时间段）
  - 自动统计差异原因（正常损耗、盘点错误、丢失等）
  - 自动生成盘点统计报表
  - 支持导出盘点统计报表（Excel）
- 🤖 **AI智能建议**：
  - 基于历史数据，建议盘点周期和方式
  - 分析盘点差异原因，建议改进措施
  - 识别盘点异常，建议重点关注物料和仓库

**验收标准：**
- ✅ 盘点计划创建成功（支持快速创建和定期盘点计划）
- ✅ 盘点执行正常（移动端和工位机触屏优化，扫码盘点，批量盘点）
- ✅ 盘点差异处理正常（差异分析、库存调整、重新盘点）
- ✅ 盘点结果确认正常（盘点结果汇总、确认盘点结果、重新盘点）
- ✅ 盘点统计分析正常（按仓库、物料、时间段统计）

---

### 3.9 销售出库阶段（优化：批号和序列号选择）

**用户操作（优化后，支持批号和序列号管理）：**
1. 进入"快智造" → "仓储管理" → "出库管理"
2. 创建销售出库单（MTS模式，从库存发货）：
   - 点击"新建"按钮
   - 选择出库类型：销售出库
   - 选择客户：客户A
   - 选择物料：产品A
   - 选择数量：50个
   - **多单位管理**（如果物料配置了多单位）：
     - 系统自动显示销售单位：箱（1箱 = 1000个）
     - 用户可选择单位：箱或个
     - 如果选择"箱"，系统自动换算为库存单位"个"
   - 选择仓库：成品仓库
   - **批号管理**（如果物料启用批号管理）：
     - 系统自动显示可用批号列表（按先进先出FIFO排序）
     - 方式1：自动选择批号（系统自动选择，先进先出FIFO）
     - 方式2：手动选择批号（用户手动选择指定批号）
     - 方式3：指定批号数量（用户指定每个批号出库数量）
     - 示例：
       - 批号1：20260115-001，库存：30个，选择：30个
       - 批号2：20260120-001，库存：50个，选择：20个
       - 总计：50个
   - **序列号管理**（如果物料启用序列号管理）：
     - 系统自动显示可用序列号列表（在库状态的序列号）
     - **必须选择序列号**（精确到单个物料）：
       - 方式1：手动选择序列号（逐个选择或批量选择）
       - 方式2：扫码选择序列号（使用扫码枪扫描序列号）
       - 方式3：批量导入序列号（从Excel导入序列号列表）
     - 示例：选择50个序列号
       - MAT-FIN-0001-20260115-000001
       - MAT-FIN-0001-20260115-000002
       - ...（共50个序列号）
   - 提交出库单
3. 系统自动更新库存
   - **批号库存更新**：自动扣减对应批号的库存
   - **序列号状态更新**：自动更新序列号状态（从"在库"变为"已出库"）
4. 打印出库单（打印模板，包含批号和序列号信息）

**系统行为（优化后）：**
- ✅ **耗时统计**（核心功能，新增）：
  - 记录销售出库单创建时间（节点9：销售出库）
  - 自动计算从成品入库到销售出库的节点间耗时（节点8→节点9，基于操作人员的工作时间段，只统计工作时间）
  - 自动计算从需求创建到销售出库的全流程耗时（节点1→节点9，基于各操作人员的工作时间段，只统计工作时间）
- ✅ **单据关联展示**（核心功能，新增）：
  - 在销售出库单详情页面展示上游关联单据（销售预测/销售订单、工单、成品入库单）和完整关联链条
  - 支持点击跳转到关联单据详情
  - 支持查看完整关联追溯（从销售预测到销售出库的完整链条）
- ✅ **单据上拉功能**（核心功能，新增）：
  - 支持从销售出库单上拉到销售预测/销售订单（手动关联或智能关联）
  - 支持从销售出库单上拉到工单（手动关联或智能关联）
- ✅ **多单位管理**（核心功能，新增）：
  - 支持选择不同单位出库（销售单位自动换算为库存单位）
  - 自动单位换算（销售单位"箱"自动换算为库存单位"个"）
- ✅ **批号管理**（核心功能，新增）：
  - 自动显示可用批号列表（按先进先出FIFO排序）
  - 支持自动选择批号（先进先出FIFO）
  - 支持手动选择批号（指定批号）
  - 支持指定批号数量（每个批号出库数量）
  - 自动更新批号库存（按批号分别扣减库存）
- ✅ **序列号管理**（核心功能，新增）：
  - 自动显示可用序列号列表（在库状态的序列号）
  - 必须选择序列号（精确到单个物料）
  - 支持手动选择序列号（逐个选择或批量选择）
  - 支持扫码选择序列号（使用扫码枪）
  - 支持批量导入序列号（从Excel导入）
  - 自动更新序列号状态（从"在库"变为"已出库"）
- ✅ 创建销售出库单（MTS模式）
- ✅ 自动更新库存数量
- ✅ 记录出库历史
- ✅ 打印出库单

**验收标准：**
- ✅ **耗时统计正常**（核心功能，新增）：
  - ✅ 销售出库单创建时间记录成功
  - ✅ 节点间耗时统计正常（成品入库→销售出库，基于操作人员的工作时间段，排除非工作时间）
  - ✅ 全流程耗时统计正常（需求创建→销售出库，基于各操作人员的工作时间段，排除非工作时间）
- ✅ **单据关联展示正常**（核心功能，新增）：
  - ✅ 销售出库单详情页面显示上游关联单据
  - ✅ 关联追溯功能正常（完整关联链条展示）
  - ✅ 关联单据快速跳转正常
- ✅ **单据上拉功能正常**（核心功能，新增）：
  - ✅ 从销售出库单上拉到销售预测/销售订单正常
  - ✅ 从销售出库单上拉到工单正常
- ✅ 销售出库单创建成功
- ✅ **多单位管理正常**（如果物料配置了多单位）：
  - ✅ 支持选择不同单位出库（销售单位自动换算为库存单位）
  - ✅ 单位换算准确无误
- ✅ **批号管理正常**（如果物料启用批号管理）：
  - ✅ 自动显示可用批号列表（按先进先出FIFO排序）
  - ✅ 支持自动选择批号（先进先出FIFO）
  - ✅ 支持手动选择批号（指定批号）
  - ✅ 批号库存更新正常（按批号分别扣减库存）
- ✅ **序列号管理正常**（如果物料启用序列号管理）：
  - ✅ 自动显示可用序列号列表（在库状态的序列号）
  - ✅ 必须选择序列号（精确到单个物料）
  - ✅ 支持手动选择序列号（逐个选择或批量选择）
  - ✅ 支持扫码选择序列号（使用扫码枪）
  - ✅ 支持批量导入序列号（从Excel导入）
  - ✅ 序列号状态更新正常（从"在库"变为"已出库"）
- ✅ 库存自动更新成功
- ✅ 出库单打印可用（包含批号和序列号信息）

---

### 3.10 生产看板监控

**用户操作：**
1. 进入"快智造" → "报表分析" → "生产监控" → "生产看板"
2. 查看实时生产数据：
   - 进行中工单数：5个
   - 完工工单数：10个
   - 延期工单数：1个
   - 工单进度可视化（进度条、状态卡片）
3. 查看工单详情（点击工单卡片）
4. 导出看板数据（Excel、PDF）
5. 切换到"大屏模式"（支持大屏显示）

**系统行为：**
- ✅ 实时数据推送（WebSocket，延迟<100ms）
- ✅ 工单进度可视化
- ✅ 关键指标统计
- ✅ 数据导出（Excel、PDF）
- ✅ 大屏模式支持
- 🤖 **AI智能建议**（通过Inngest AI工作流）：
  - **异常预警**：自动检测异常工单（延期、质量异常、进度滞后），实时预警
  - **优化建议**：基于看板数据，提供生产优化建议：
    - 检测瓶颈工序，建议调整产能分配
    - 分析延期原因，建议改进措施
    - 预测交期风险，建议提前应对
  - **数据洞察**：分析生产趋势，提供数据洞察（如：生产效率提升趋势、质量改善趋势）

**验收标准：**
- ✅ 生产看板数据实时更新正常（WebSocket）
- ✅ 工单进度可视化正常
- ✅ 关键指标统计正常
- ✅ 数据导出可用（Excel、PDF）
- ✅ 大屏模式可用
- ✅ AI建议正常显示（看板侧边栏，实时更新优化建议）

---

## 3.10 单据执行效率优化与耗时统计（新增，核心功能）

### 3.10.1 单据节点耗时统计概述

**应用场景：**
- 单据执行效率是衡量业务流程优化的重要指标
- 每个单据节点与节点之间需要有耗时统计，帮助识别效率瓶颈
- 可以根据人员或部门设置工作时间段，只统计工作时间的耗时
- 通过耗时统计，优化流程，提高单据执行效率

**核心功能：**
- ✅ **工作时间段配置**：支持按人员或部门设置工作时间段（见2.5.1章节）
- ✅ **节点耗时统计**：自动记录每个单据节点的开始和结束时间
- ✅ **节点间耗时统计**：自动计算节点之间的耗时（只统计工作时间）
- ✅ **耗时分析报表**：提供耗时分析报表，帮助识别效率瓶颈
- ✅ **效率优化建议**：基于耗时统计，提供效率优化建议

**单据节点定义（MTS模式）：**
- **节点1：需求创建** - 销售预测创建时间
- **节点2：MRP运算** - MRP运算开始和结束时间
- **节点3：工单创建** - 工单创建时间
- **节点4：工单下达** - 工单下达时间
- **节点5：生产领料** - 生产领料出库单创建时间
- **节点6：报工开始** - 首道工序报工时间
- **节点7：报工完成** - 最后一道工序报工时间
- **节点8：成品入库** - 成品入库单创建时间
- **节点9：销售出库** - 销售出库单创建时间

**耗时统计规则：**
- ✅ **工作时间段应用**：基于操作人员或部门的工作时间段配置
- ✅ **非工作时间排除**：自动排除非工作时间（如：下班时间、周末、节假日）
- ✅ **跨天计算**：支持跨天计算（如：夜班跨天）
- ✅ **多班次支持**：支持多班次设置（白班、夜班、周末班等）

**耗时统计示例：**
- **节点1→节点2（需求创建→MRP运算完成）**：
  - 需求创建时间：2026-01-05 09:00:00（周一）
  - MRP运算完成时间：2026-01-05 14:30:00（周一）
  - 工作时间段：08:00-12:00, 13:00-17:00（8小时/天）
  - **实际耗时计算**：
    - 09:00-12:00 = 3小时（工作时间）
    - 12:00-13:00 = 0小时（午休时间，非工作时间）
    - 13:00-14:30 = 1.5小时（工作时间）
    - **总耗时：4.5小时（只统计工作时间）**

- **节点2→节点3（MRP运算完成→工单创建完成）**：
  - MRP运算完成时间：2026-01-05 14:30:00（周一）
  - 工单创建完成时间：2026-01-06 10:00:00（周二）
  - 工作时间段：08:00-12:00, 13:00-17:00（8小时/天）
  - **实际耗时计算**：
    - 2026-01-05 14:30-17:00 = 2.5小时（周一工作时间）
    - 2026-01-05 17:00-2026-01-06 08:00 = 0小时（非工作时间）
    - 2026-01-06 08:00-10:00 = 2小时（周二工作时间）
    - **总耗时：4.5小时（只统计工作时间，排除非工作时间）**

### 3.10.2 耗时统计功能实现

**系统行为：**
- ✅ **自动记录节点时间**：
  - 每个单据节点操作时，自动记录操作时间
  - 记录操作人员信息（用于匹配工作时间段配置）
  - 记录操作部门信息（用于匹配工作时间段配置）
- ✅ **自动计算节点间耗时**：
  - 基于操作人员或部门的工作时间段配置
  - 自动排除非工作时间（下班时间、周末、节假日）
  - 支持跨天计算（如：夜班跨天）
  - 支持多班次计算（白班、夜班、周末班等）
- ✅ **耗时统计展示**：
  - 在单据详情页面显示各节点耗时
  - 在单据列表页面显示关键节点耗时
  - 提供耗时分析报表（按单据、按人员、按部门、按时间段）
- ✅ **效率优化建议**：
  - 基于耗时统计，识别效率瓶颈
  - 提供效率优化建议（如：某节点耗时过长，建议优化）
  - 对比历史数据，提供改进建议

**验收标准：**
- ✅ **节点时间记录正常**：
  - ✅ 每个单据节点操作时间记录成功
  - ✅ 操作人员信息记录成功
  - ✅ 操作部门信息记录成功
- ✅ **节点间耗时计算正常**：
  - ✅ 基于操作人员的工作时间段配置计算耗时
  - ✅ 非工作时间自动排除
  - ✅ 跨天计算正常（夜班跨天）
  - ✅ 多班次计算正常（白班、夜班、周末班）
- ✅ **耗时统计展示正常**：
  - ✅ 单据详情页面显示各节点耗时
  - ✅ 单据列表页面显示关键节点耗时
  - ✅ 耗时分析报表正常（按单据、按人员、按部门、按时间段）
- ✅ **效率优化建议正常**：
  - ✅ 效率瓶颈识别正常
  - ✅ 效率优化建议正常显示
  - ✅ 历史数据对比正常

**优化效果：**
- ⚡ **效率可视化**：通过耗时统计，清晰展示单据执行效率
- ⚡ **瓶颈识别**：自动识别效率瓶颈，帮助优化流程
- ⚡ **准确统计**：只统计工作时间，排除非工作时间，提高统计准确性
- ⚡ **灵活配置**：支持按人员或部门设置工作时间段，适应不同工作模式

---

## 3.11 单据关联与上下游管理（新增，核心功能）

### 3.11.1 单据关联概述

**应用场景：**
- 业务流程中，单据之间存在上下游关联关系
- 需要清晰展示单据的上下游相关信息，方便追溯和查询
- 支持下推功能：从上游单据快速生成下游单据（如：从销售预测下推到MRP运算，从MRP运算下推到工单和采购单）
- 支持上拉功能：从下游单据关联到上游单据（如：从工单上拉到销售预测，从报工上拉到工单）

**核心功能：**
- ✅ **单据上下游信息展示**：在单据详情页面展示上下游关联单据信息
- ✅ **单据下推功能**：从上游单据快速生成下游单据（一键下推）
- ✅ **单据上拉功能**：从下游单据关联到上游单据（快速关联）
- ✅ **单据关联追溯**：支持查看完整的单据关联链条
- ✅ **关联单据批量操作**：支持批量下推、批量上拉

**单据关联关系（MTS模式）：**
- **销售预测** → **MRP运算** → **工单** → **生产领料出库单** → **报工记录** → **成品入库单** → **销售出库单**
- **销售预测** → **MRP运算** → **采购单** → **采购入库单**

**单据关联关系（MTO模式）：**
- **销售订单** → **LRP运算** → **工单** → **生产领料出库单** → **报工记录** → **成品入库单** → **销售出库单**
- **销售订单** → **LRP运算** → **采购单** → **采购入库单**

### 3.11.2 单据上下游信息展示

**用户操作：**
1. **查看单据详情**
   - 进入任意单据详情页面（如：工单详情、销售预测详情、MRP运算详情）
   - 点击"关联单据"标签页
   - **系统自动显示**：
     - **上游单据**（来源单据）：
       - 销售预测 → MRP运算 → 工单
       - 显示上游单据编号、单据类型、创建时间、状态等信息
       - 支持点击跳转到上游单据详情
     - **下游单据**（生成单据）：
       - 工单 → 生产领料出库单、报工记录、成品入库单
       - 显示下游单据编号、单据类型、创建时间、状态等信息
       - 支持点击跳转到下游单据详情
     - **关联单据统计**：
       - 上游单据数量、下游单据数量
       - 关联单据状态汇总（已完成、进行中、待处理等）

2. **单据列表页面显示关联信息**
   - 在单据列表页面，显示关联单据数量（如：工单列表显示"关联出库单：2个"）
   - 支持点击查看关联单据详情
   - 支持按关联单据筛选（如：筛选有报工记录的工单）

**系统行为：**
- ✅ **自动建立关联关系**：
  - 下推生成单据时，自动建立上游→下游关联关系
  - 上拉关联单据时，自动建立下游→上游关联关系
  - 自动记录关联类型（下推、上拉、手动关联）
- ✅ **关联信息展示**：
  - 在单据详情页面展示上下游关联单据
  - 在单据列表页面显示关联单据数量
  - 支持关联单据快速跳转
- ✅ **关联单据统计**：
  - 自动统计上游单据数量
  - 自动统计下游单据数量
  - 自动统计关联单据状态汇总

**验收标准：**
- ✅ **关联信息展示正常**：
  - ✅ 单据详情页面显示上下游关联单据
  - ✅ 单据列表页面显示关联单据数量
  - ✅ 关联单据快速跳转正常
- ✅ **关联关系建立正常**：
  - ✅ 下推时自动建立关联关系
  - ✅ 上拉时自动建立关联关系
  - ✅ 关联类型记录正确

### 3.11.3 单据下推功能

**应用场景：**
- 从上游单据快速生成下游单据，提高操作效率
- 自动传递单据信息，减少重复输入
- 支持批量下推，一次操作生成多个下游单据

**用户操作（下推示例）：**

1. **从销售预测下推到MRP运算**
   - 进入"快智造" → "计划管理" → "需求管理" → "销售预测(MTS)"
   - 选择销售预测：1月份预测
   - 点击"下推MRP运算"按钮
   - **系统自动**：
     - 打开MRP运算页面
     - 自动选择该销售预测
     - 自动填充MRP运算参数（基于历史配置）
     - 用户确认后点击"运行MRP运算"
   - **完成，<30秒**

2. **从MRP运算下推到工单和采购单**
   - 进入"快智造" → "计划管理" → "计划排程" → "MRP运算(MTS)"
   - 选择MRP运算结果
   - 点击"下推工单和采购单"按钮（一键下推）
   - **系统自动**：
     - 根据工单建议，批量创建工单（自动填充产品、数量、车间、工作中心）
     - 根据采购建议，批量创建采购单（自动填充物料、数量、供应商）
     - 自动建立关联关系（MRP运算 → 工单，MRP运算 → 采购单）
     - 自动生成工单号和采购单号
   - **完成，<1分钟**

3. **从工单下推到生产领料出库单**
   - 进入"快智造" → "生产执行" → "工单管理" → "工单列表"
   - 选择已下达的工单：工单-20260105-001
   - 点击"下推生产领料"按钮
   - **系统自动**：
     - 根据BOM生成领料需求（自动计算数量）
     - 创建生产领料出库单（自动填充所有字段）
     - 自动建立关联关系（工单 → 生产领料出库单）
     - 自动更新库存
   - **完成，<30秒**

4. **从工单下推到报工记录**
   - 进入"快智造" → "生产执行" → "工单管理" → "工单列表"
   - 选择已下达的工单：工单-20260105-001
   - 点击"下推报工"按钮（移动端或工位机）
   - **系统自动**：
     - 打开报工界面
     - 自动填充工单信息（工单号、产品、当前工序）
     - 用户填写完成数量和合格数量后提交
     - 自动建立关联关系（工单 → 报工记录）
   - **完成，<30秒**

5. **从工单下推到成品入库单**
   - 进入"快智造" → "生产执行" → "工单管理" → "工单列表"
   - 选择已完工的工单：工单-20260105-001
   - 点击"下推成品入库"按钮
   - **系统自动**：
     - 自动填充物料：产品A（基于工单）
     - 自动填充数量：88个（基于报工合格数量）
     - 自动填充仓库：成品仓库（基于物料默认仓库）
     - 创建成品入库单（自动填充所有字段）
     - 自动建立关联关系（工单 → 成品入库单）
     - 自动更新库存
   - **完成，<30秒**

6. **批量下推**
   - 在单据列表页面，勾选多个单据（如：多个工单）
   - 点击"批量下推"按钮
   - 选择下推类型（如：批量下推生产领料）
   - **系统自动**：
     - 批量创建下游单据（每个工单一个出库单）
     - 自动建立关联关系
     - 自动更新相关数据
   - **完成，<1分钟**

**系统行为：**
- ✅ **自动传递单据信息**：
  - 下推时自动传递上游单据的关键信息
  - 自动填充下游单据的字段（减少用户输入）
  - 自动建立关联关系
- ✅ **批量下推支持**：
  - 支持批量下推多个上游单据
  - 自动批量创建下游单据
  - 自动批量建立关联关系
- ✅ **下推规则配置**：
  - 支持配置下推规则（哪些字段自动填充，哪些字段需要用户确认）
  - 支持保存下推模板（下次直接使用）
  - 支持下推前验证（如：工单下推前检查是否已下达）

**验收标准：**
- ✅ **下推功能正常**：
  - ✅ 从销售预测下推到MRP运算正常
  - ✅ 从MRP运算下推到工单和采购单正常
  - ✅ 从工单下推到生产领料出库单正常
  - ✅ 从工单下推到报工记录正常
  - ✅ 从工单下推到成品入库单正常
- ✅ **批量下推正常**：
  - ✅ 批量下推多个单据正常
  - ✅ 批量创建下游单据正常
  - ✅ 批量建立关联关系正常
- ✅ **信息传递正常**：
  - ✅ 上游单据信息自动传递到下游单据
  - ✅ 下游单据字段自动填充正确
  - ✅ 关联关系建立正确

### 3.11.4 单据上拉功能

**应用场景：**
- 从下游单据快速关联到上游单据，建立追溯关系
- 支持手动上拉关联（如：手动创建的报工记录关联到工单）
- 支持批量上拉关联（如：批量关联报工记录到工单）

**用户操作（上拉示例）：**

1. **从报工记录上拉到工单**
   - 进入"快智造" → "生产执行" → "报工管理" → "报工记录查询"
   - 选择报工记录（未关联工单的报工记录）
   - 点击"上拉关联工单"按钮
   - **系统自动**：
     - 打开工单选择界面（支持搜索）
     - 用户选择关联的工单：工单-20260105-001
     - 确认关联
     - 自动建立关联关系（报工记录 → 工单）
     - 自动更新工单进度
   - **完成，<30秒**

2. **从生产领料出库单上拉到工单**
   - 进入"快智造" → "仓储管理" → "出库管理" → "出库单列表"
   - 选择生产领料出库单（未关联工单的出库单）
   - 点击"上拉关联工单"按钮
   - **系统自动**：
     - 打开工单选择界面（支持搜索）
     - 用户选择关联的工单：工单-20260105-001
     - 确认关联
     - 自动建立关联关系（生产领料出库单 → 工单）
     - 自动验证关联关系（检查物料是否匹配）
   - **完成，<30秒**

3. **从成品入库单上拉到工单**
   - 进入"快智造" → "仓储管理" → "入库管理" → "入库单列表"
   - 选择成品入库单（未关联工单的入库单）
   - 点击"上拉关联工单"按钮
   - **系统自动**：
     - 打开工单选择界面（支持搜索）
     - 用户选择关联的工单：工单-20260105-001
     - 确认关联
     - 自动建立关联关系（成品入库单 → 工单）
     - 自动验证关联关系（检查产品是否匹配）
   - **完成，<30秒**

4. **从工单上拉到销售预测/销售订单**
   - 进入"快智造" → "生产执行" → "工单管理" → "工单列表"
   - 选择工单（未关联销售预测/销售订单的工单）
   - 点击"上拉关联销售预测/销售订单"按钮
   - **系统自动**：
     - 打开销售预测/销售订单选择界面（支持搜索）
     - 用户选择关联的销售预测/销售订单
     - 确认关联
     - 自动建立关联关系（工单 → 销售预测/销售订单）
   - **完成，<30秒**

5. **批量上拉关联**
   - 在单据列表页面，勾选多个单据（如：多个报工记录）
   - 点击"批量上拉关联"按钮
   - 选择关联类型（如：批量关联到工单）
   - **系统自动**：
     - 打开工单选择界面
     - 用户选择关联的工单
     - 批量建立关联关系
     - 自动验证关联关系
   - **完成，<1分钟**

6. **智能上拉关联（AI辅助）**
   - 选择未关联的单据（如：报工记录）
   - 点击"智能上拉关联"按钮
   - **系统自动**：
     - AI分析单据信息（产品、数量、时间等）
     - 自动推荐最可能关联的上游单据（如：推荐匹配的工单）
     - 用户确认或修改推荐结果
     - 自动建立关联关系
   - **完成，<30秒**

**系统行为：**
- ✅ **关联关系建立**：
  - 上拉时自动建立下游→上游关联关系
  - 自动记录关联类型（手动上拉、智能上拉）
  - 自动验证关联关系（检查数据是否匹配）
- ✅ **批量上拉支持**：
  - 支持批量上拉多个下游单据
  - 自动批量建立关联关系
  - 自动批量验证关联关系
- ✅ **智能上拉（AI辅助）**：
  - AI分析单据信息，自动推荐关联的上游单据
  - 基于产品、数量、时间等信息匹配
  - 提高关联准确性和效率

**验收标准：**
- ✅ **上拉功能正常**：
  - ✅ 从报工记录上拉到工单正常
  - ✅ 从生产领料出库单上拉到工单正常
  - ✅ 从成品入库单上拉到工单正常
  - ✅ 从工单上拉到销售预测/销售订单正常
- ✅ **批量上拉正常**：
  - ✅ 批量上拉多个单据正常
  - ✅ 批量建立关联关系正常
  - ✅ 批量验证关联关系正常
- ✅ **智能上拉正常**：
  - ✅ AI推荐关联单据准确
  - ✅ 智能上拉关联成功率高
  - ✅ 用户确认流程顺畅

### 3.11.5 单据关联追溯

**用户操作：**
1. **查看完整关联链条**
   - 进入任意单据详情页面（如：工单详情）
   - 点击"关联追溯"按钮
   - **系统自动显示**：
     - **完整关联链条**（可视化展示）：
       - 销售预测 → MRP运算 → 工单 → 生产领料出库单 → 报工记录 → 成品入库单 → 销售出库单
       - 显示每个节点的单据编号、单据类型、状态、时间等信息
       - 支持点击跳转到任意节点单据详情
     - **关联关系图**（可视化图表）：
       - 以当前单据为中心，展示上下游关联关系
       - 支持展开/折叠查看详细关联信息
       - 支持导出关联关系图（PNG、PDF）

2. **关联单据统计报表**
   - 进入"快智造" → "报表分析" → "单据关联分析"
   - 查看关联单据统计报表：
     - 按单据类型统计关联单据数量
     - 按时间段统计关联单据趋势
     - 按部门统计关联单据分布
     - 识别关联异常（如：未关联的单据）

**系统行为：**
- ✅ **关联链条追溯**：
  - 自动构建完整的单据关联链条
  - 可视化展示关联关系
  - 支持快速跳转到关联单据
- ✅ **关联关系图**：
  - 自动生成关联关系图
  - 支持可视化展示
  - 支持导出关联关系图
- ✅ **关联单据统计**：
  - 自动统计关联单据数量
  - 自动识别关联异常
  - 提供关联分析报表

**验收标准：**
- ✅ **关联追溯正常**：
  - ✅ 完整关联链条展示正常
  - ✅ 关联关系图生成正常
  - ✅ 关联单据快速跳转正常
- ✅ **关联统计正常**：
  - ✅ 关联单据统计报表正常
  - ✅ 关联异常识别正常
  - ✅ 关联分析报表正常

**优化效果：**
- ⚡ **追溯便捷**：通过关联追溯，快速查看完整的业务流程链条
- ⚡ **操作高效**：通过下推和上拉功能，快速生成和关联单据，提高操作效率
- ⚡ **信息完整**：通过上下游信息展示，全面了解单据的关联关系
- ⚡ **智能推荐**：通过AI辅助上拉，提高关联准确性和效率

---

## 4. MTO模式业务流程推演（按订单生产）

### 4.1 需求管理阶段

**用户操作：**
1. 进入"快智造" → "计划管理" → "需求管理" → "销售订单(MTO)"
2. 创建销售订单（使用universheet批量导入）：
   - 打开销售订单导入universheet在线表格（系统自动创建模板）
   - 在universheet中填写销售订单数据（实时保存）
   - 点击"导入"按钮，系统自动导入
   - 订单1：
     - 客户：客户A
     - 产品：产品A
     - 数量：100个
     - 交货日期：2026-01-20
   - 订单2：
     - 客户：客户B
     - 产品：产品B
     - 数量：50个
     - 交货日期：2026-01-25
3. 提交销售订单

**系统行为：**
- ✅ 保存销售订单数据
- ✅ 标记为MTO模式
- ✅ 批量导入销售订单（universheet在线表格，实时保存）

**验收标准：**
- ✅ 销售订单创建成功（支持universheet在线表格批量导入，实时保存）
- ✅ 销售订单标记为MTO模式

---

### 4.2 LRP运算阶段（优化：灵活参数配置）

**用户操作（优化后，支持灵活参数配置）：**
1. 进入"快智造" → "计划管理" → "计划排程" → "LRP运算(MTO)"
2. 选择销售订单（订单1）
3. **配置LRP计算参数**（核心功能，新增，灵活配置）：
   - 点击"参数配置"按钮
   - **库存相关参数**（可自由勾选）：
     - ✅ 当前库存数量（默认勾选）
     - ✅ 安全库存（默认勾选）
     - ⬜ 在途库存（采购在途、生产在途）
     - ⬜ 冻结库存（不参与计算）
     - ⬜ 预留库存（已分配但未出库）
     - ⬜ 在制品库存（半成品库存）
     - ⬜ 不良品库存（不参与计算）
   - **需求相关参数**（可自由勾选）：
     - ✅ 销售订单（默认勾选，LRP必需）
     - ⬜ 已下达工单需求（已创建但未完工的工单）
     - ⬜ 已下达采购单需求（已创建但未到货的采购单）
     - ⬜ 预留需求（已预留但未出库的需求）
   - **供应相关参数**（可自由勾选）：
     - ✅ 已下达采购单（默认勾选）
     - ✅ 已下达工单（默认勾选）
     - ⬜ 供应商交期（考虑供应商交期）
     - ⬜ 采购提前期（考虑采购提前期）
     - ⬜ 生产提前期（考虑生产提前期）
   - **BOM相关参数**（可自由勾选）：
     - ✅ BOM版本（默认勾选，使用最新版本）
     - ⬜ BOM损耗率（考虑生产损耗）
     - ⬜ BOM替代料（考虑替代料）
   - **其他参数**（可自由勾选）：
     - ⬜ 最小采购批量（按最小批量采购）
     - ⬜ 采购倍数（按倍数采购）
     - ⬜ 最小生产批量（按最小批量生产）
     - ⬜ 生产倍数（按倍数生产）
     - ⬜ 库存周转率（考虑库存周转）
     - ⬜ 物料有效期（考虑物料有效期）
   - 保存参数配置（可保存为模板，下次直接使用）
4. 点击"运行LRP运算"
5. **系统自动计算并显示结果**（基于配置的参数）：
   - 根据销售订单和当前库存计算物料需求（基于勾选的参数）
   - 根据BOM展开计算原材料需求（基于勾选的参数）
   - 生成工单建议和采购建议（针对特定订单，基于勾选的参数）
6. 查看LRP运算结果：
   - 物料需求清单（订单专属，基于勾选的参数）
   - 工单建议（产品A需要生产100个，关联订单1）
   - 采购建议（针对订单1的采购需求）
   - **显示计算说明**（核心功能，新增）：
     - 显示本次计算使用的参数（哪些因素计入计算）
     - 显示计算逻辑说明（如何计算得出结果）
     - 显示参数影响分析（各参数对结果的影响）
7. 导出LRP运算结果（Excel，包含计算说明）

**系统行为（优化后）：**
- ✅ **灵活参数配置**（核心功能，新增）：
  - **库存相关参数**：
    - 当前库存数量：参与计算（默认）
    - 安全库存：参与计算（默认）
    - 在途库存：可选（采购在途、生产在途）
    - 冻结库存：不参与计算（可选）
    - 预留库存：可选（已分配但未出库）
    - 在制品库存：可选（半成品库存）
    - 不良品库存：不参与计算（可选）
  - **需求相关参数**：
    - 销售订单：参与计算（LRP必需）
    - 已下达工单需求：可选（已创建但未完工的工单）
    - 已下达采购单需求：可选（已创建但未到货的采购单）
    - 预留需求：可选（已预留但未出库的需求）
  - **供应相关参数**：
    - 已下达采购单：参与计算（默认）
    - 已下达工单：参与计算（默认）
    - 供应商交期：可选（考虑供应商交期）
    - 采购提前期：可选（考虑采购提前期）
    - 生产提前期：可选（考虑生产提前期）
  - **BOM相关参数**：
    - BOM版本：参与计算（默认，使用最新版本）
    - BOM损耗率：可选（考虑生产损耗）
    - BOM替代料：可选（考虑替代料）
  - **其他参数**：
    - 最小采购批量：可选（按最小批量采购）
    - 采购倍数：可选（按倍数采购）
    - 最小生产批量：可选（按最小批量生产）
    - 生产倍数：可选（按倍数生产）
    - 库存周转率：可选（考虑库存周转）
    - 物料有效期：可选（考虑物料有效期）
  - 参数配置可保存为模板，下次直接使用
  - 支持预设模板（标准模板、保守模板、激进模板等）
- ✅ 执行LRP运算（异步，使用Inngest工作流，基于配置的参数）
- ✅ 根据销售订单和库存计算物料需求（基于勾选的参数）
- ✅ 根据BOM展开计算原材料需求（基于勾选的参数）
- ✅ 生成工单建议和采购建议（订单专属，基于勾选的参数）
- ✅ **显示计算说明**（核心功能，新增）：
  - 显示本次计算使用的参数（哪些因素计入计算）
  - 显示计算逻辑说明（如何计算得出结果）
  - 显示参数影响分析（各参数对结果的影响）
- ✅ 支持Excel导出LRP结果（包含计算说明）

**验收标准：**
- ✅ **灵活参数配置正常**（核心功能，新增）：
  - ✅ 参数配置界面正常（所有参数可自由勾选）
  - ✅ 参数配置保存成功（可保存为模板）
  - ✅ 预设模板正常（标准模板、保守模板、激进模板等）
  - ✅ 计算时使用配置的参数
- ✅ LRP运算成功（支持大数据量：1000+物料，基于配置的参数）
- ✅ 物料需求计算正确（订单专属，基于勾选的参数）
- ✅ 工单建议生成正确（关联订单，基于勾选的参数）
- ✅ 采购建议生成正确（订单专属，基于勾选的参数）
- ✅ **计算说明显示正常**（核心功能，新增）：
  - ✅ 显示本次计算使用的参数
  - ✅ 显示计算逻辑说明
  - ✅ 显示参数影响分析
- ✅ LRP结果导出成功（Excel，包含计算说明）

---

### 4.3 工单创建阶段（关联订单，根据工艺路线生成工序）

**用户操作（优化后，极致简化）：**
1. 进入"快智造" → "生产执行" → "工单管理" → "工单列表"
2. 根据LRP运算结果创建工单：
   - 点击"新建"按钮
   - 选择产品：产品A
   - 选择数量：100个
   - **关联销售订单：订单1**（MTO模式关键）
   - **系统自动填充**：
     - 默认工艺路线：产品A工艺路线（基于产品配置）
     - 默认车间：组装车间（基于工艺路线首工序）
     - 默认工作中心：组装线1（基于工艺路线首工序）
   - 选择计划开始时间：2026-01-10 08:00
   - 选择计划结束时间：2026-01-15 18:00（系统可自动计算）
   - **系统自动根据工艺路线生成工单工序**：
     - 工序1：注塑工序（注塑车间，注塑机1）
     - 工序2：组装工序（组装车间，组装线1）
     - 工序3：包装工序（包装车间，包装线1）
   - **如果是带SOP工艺路线，系统自动关联SOP**：
     - 工序1：注塑工序 → 关联SOP《注塑作业标准》
     - 工序2：组装工序 → 关联SOP《组装作业标准》
     - 工序3：包装工序 → 关联SOP《包装作业标准》
   - 提交工单
3. 系统自动标记为MTO模式工单
4. **查看工单列表**（专门化改造，核心功能，新增）：
   - **表格行展开功能**（核心功能，新增）：
     - 工单列表表格支持行展开（点击行左侧展开图标或双击行）
     - 展开后显示该工单的所有工序信息
   - **图形化工序显示**（核心功能，新增）：
     - 展开行以图形化的方式显示所有工序
     - 工序按顺序横向排列，形成工序流程图
     - 每道工序显示为独立的工序卡片
   - **环状图显示工序进度**（核心功能，新增）：
     - 每道工序以环状图（Progress Ring）显示进度
     - 环状图显示：
       - 已完成数量 / 计划数量（如：80/100）
       - 完成百分比（如：80%）
       - 合格数量 / 不合格数量（如：合格：75，不合格：5）
     - 环状图颜色：
       - 绿色：已完成且合格率达标（≥95%）
       - 黄色：进行中或合格率偏低（80%-95%）
       - 红色：异常或合格率过低（<80%）
     - 工序卡片信息：
       - 工序名称：注塑工序
       - 工序状态：待开始/进行中/已完成/已暂停
       - 关联车间：注塑车间
       - 关联工作中心：注塑机1
       - 计划时间：2026-01-10 08:00 - 12:00
       - 实际时间：2026-01-10 08:05 - 12:15（如有）
       - 操作人员：张三（如有）
     - 工序卡片操作：
       - 点击工序卡片可查看工序详情
       - 支持快速报工（移动端/工位机）
       - 支持查看SOP（如果关联了SOP）
5. 查看工单详情（显示关联订单信息、工序列表、SOP）

**系统行为（优化后）：**
- ✅ 自动生成工单号（工单-20260110-001）
- ✅ 创建工单数据（关联销售订单）
- ✅ 标记为MTO模式
- ✅ **根据工艺路线自动生成工单工序单**（核心功能，参考黑湖小工单）
  - **自动匹配工艺路线**：
    - 创建工单时，系统自动检查物料是否绑定了工艺路线
    - 优先级规则：物料绑定 > 物料分组绑定
    - 如果物料绑定了工艺路线，使用物料绑定的工艺路线
    - 如果物料没有绑定，但所属分组绑定了工艺路线，使用分组绑定的工艺路线
  - **自动创建工序单**（WorkOrderOperation）：
    - 系统读取匹配到的工艺路线的工序序列
    - 为工单自动创建对应的工序单，每个工序单包含完整信息（工序顺序、关联工序、车间、工作中心、标准工时、准备时间、计划时间）
    - 工序单号自动生成（格式：{工单号}-OP{序号}）
    - 计划时间自动计算（基于前序工序完成时间）
  - 自动填充工序顺序（基于工艺路线）
  - 自动填充工序车间和工作中心（基于工艺路线）
  - 自动填充标准工时和准备时间（基于工艺路线）
  - **如果是带SOP工艺路线，自动关联SOP**（核心功能）
- ✅ 生成工单二维码（用于扫码报工）
- ✅ **工单列表专门化改造**（核心功能，新增）：
  - **表格行展开功能**：
    - 支持行展开/收起（点击展开图标或双击行）
    - 展开后显示该工单的所有工序信息
  - **图形化工序显示**：
    - 展开行以图形化的方式显示所有工序
    - 工序按顺序横向排列，形成工序流程图
    - 每道工序显示为独立的工序卡片
    - 工序卡片包含完整信息（工序名称、状态、车间、工作中心、计划时间、实际时间、操作人员）
  - **环状图显示工序进度**：
    - 每道工序以环状图（Progress Ring）显示进度
    - 环状图显示已完成数量/计划数量、完成百分比、合格数量/不合格数量
    - 环状图颜色根据完成状态和合格率自动变化（绿色/黄色/红色）
    - 支持点击工序卡片查看详情、快速报工、查看SOP

**验收标准：**
- ✅ 工单创建成功（关联销售订单）
- ✅ 工单标记为MTO模式
- ✅ 工单关联订单信息正确
- ✅ **工单工序单自动生成成功**（基于工艺路线，参考黑湖小工单）：
  - ✅ 系统自动匹配工艺路线成功（物料绑定 → 物料分组绑定）
  - ✅ 自动创建工序单（WorkOrderOperation）成功
  - ✅ 工序单包含完整信息（工序顺序、关联工序、车间、工作中心、标准工时、准备时间、计划时间）
  - ✅ 工序单号自动生成成功（格式：{工单号}-OP{序号}）
  - ✅ 计划时间自动计算成功（基于前序工序完成时间）
  - ✅ 带SOP工艺路线自动关联SOP成功
- ✅ **带SOP工艺路线自动关联SOP成功**（核心功能）

**开发状态：** ✅ 已完成

---

### 4.4 高级排产阶段（可选）

**用户操作：**
1. 进入"快智造" → "计划管理" → "高级排产" → "排产甘特图"
2. 查看所有待排产工单（包括MTO工单）
3. 根据订单交货日期调整排产计划：
   - 订单1交货日期：2026-01-20
   - 调整工单排产计划，确保在交货日期前完成
4. 拖拽调整工单排产计划
5. 保存排产计划

**系统行为：**
- ✅ 显示排产甘特图（包含MTO工单）
- ✅ 支持拖拽调整排产计划
- ✅ 检查订单交货日期
- ✅ 保存排产计划

**验收标准：**
- ✅ 排产甘特图展示正常（包含MTO工单）
- ✅ 订单交货日期检查正常
- ✅ 排产计划保存成功

---

### 4.5 工单下达阶段

**用户操作：**
1. 进入"快智造" → "生产执行" → "工单管理" → "工单列表"
2. 选择已排产的MTO工单
3. 点击"下达"按钮
4. 确认下达工单
5. 工单状态变为"已下达"

**系统行为：**
- ✅ 更新工单状态为"已下达"
- ✅ 触发工单状态流转工作流（Inngest）
- ✅ 通知相关人员

**验收标准：**
- ✅ 工单下达成功
- ✅ 工单状态更新成功
- ✅ 通知发送成功

---

### 4.6 生产领料阶段（订单专属库存）

**用户操作：**
1. 进入"快智造" → "仓储管理" → "出库管理"
2. 创建生产领料出库单：
   - 点击"新建"按钮
   - 选择关联工单：工单-20260110-001（产品A，关联订单1）
   - 系统自动根据BOM生成领料需求：
     - 注塑件A：200个（从半成品仓库）
     - 注塑件B：100个（从半成品仓库）
     - 螺丝：400个（从原材料仓库）
   - 确认领料数量
   - 提交出库单
3. 系统自动标记为订单专属库存（MTO模式）

**系统行为：**
- ✅ 根据工单和BOM自动生成领料需求
- ✅ 创建出库单（关联订单）
- ✅ 标记为订单专属库存（MTO模式）
- ✅ 自动更新库存数量（预留订单专属库存）

**验收标准：**
- ✅ 生产领料出库单创建成功（关联订单）
- ✅ 订单专属库存标记成功
- ✅ 库存自动更新成功

---

### 4.7 报工阶段（优化：快速报工+带参数报工+工站上下料物料绑定）

**用户操作（优化后，极致简化，支持移动端和工位机触屏）：**
1. **车间工人操作（三种终端模式，与MTS模式相同，详见第3.7节）：**
   - **方式A：工位机触屏模式**（详见第8章：工位机触屏模式）
   - **方式B：移动端模式**
   - **方式C：PC端模式**
   
   **注：** MTO模式的报工操作与MTS模式完全相同，包括：
   - 扫码报工（扫描工单二维码）
   - 按数量报工/按状态报工（根据工序类型自动判断）
   - 工站上下料物料绑定（扫码绑定和手动选择）
   - 带参数报工（带参数SOP）
   - 自动切换工序（报工完成后自动切换）
   
   **详细操作步骤请参考第3.7节：报工阶段**

2. **生产管理员操作（PC端）：**
   - 查看报工记录（包含参数数据）
   - 查看工单进度（自动更新）
   - 查看参数数据统计（如：温度趋势、扭矩分布等）

**系统行为（优化后）：**
- ✅ **与MTS模式相同**（详见第3.7节：报工阶段系统行为）
- ✅ **MTO模式特殊处理**：
  - 报工记录自动关联销售订单（基于工单关联的销售订单）
  - 报工进度同步到客户协同平台（如果启用）

**验收标准：**
- ✅ **与MTS模式相同**（详见第3.7节：报工阶段验收标准）
- ✅ MTO模式报工记录关联销售订单正常
- ✅ 报工进度同步到客户协同平台正常

**开发状态：** ✅ 已完成

---

### 4.8 成品入库阶段（订单专属库存+装箱打包绑定）

**用户操作（优化后，与MTS模式相同，增加订单专属库存标记）：**
1. **方式1：一键入库（推荐，最简化）**
   - 进入"快智造" → "仓储管理" → "成品入库"
   - 系统自动显示待入库工单列表（已完工但未入库的MTO工单）
   - 选择工单：工单-20260110-001（产品A，关联订单1）
   - 点击"一键入库"按钮
   - **系统自动**：
     - 自动填充物料：产品A（基于工单）
     - 自动填充数量：98个（基于报工合格数量）
     - 自动填充仓库：成品仓库（基于物料默认仓库）
     - **关联销售订单：订单1**（MTO模式关键，自动关联）
     - **批号管理**（如果物料启用批号管理）：自动生成批号
     - **序列号管理**（如果物料启用序列号管理）：自动生成序列号
     - 创建入库单（自动填充所有字段）
     - 自动标记为订单专属库存（MTO模式）
     - 自动更新库存
   - **完成，<30秒**

2. **方式2：批量入库（推荐，多工单）**
   - 进入"快智造" → "仓储管理" → "成品入库"
   - 勾选多个待入库MTO工单（支持全选）
   - 点击"批量入库"按钮
   - 系统自动批量创建入库单（每个工单一个入库单）
   - 每个入库单自动关联对应的销售订单
   - 每个入库单自动标记为订单专属库存
   - **完成，<1分钟**

3. **方式3：手动创建（可选，支持批号、序列号和装箱打包绑定）**
   - 进入"快智造" → "仓储管理" → "入库管理"
   - 点击"新建"按钮
   - 选择关联工单：工单-20260110-001（产品A，关联订单1）
   - 系统自动填充物料、数量、仓库
   - **关联销售订单：订单1**（MTO模式关键，自动关联）
   - **批号管理**（如果物料启用批号管理）：与MTS模式相同
   - **序列号管理**（如果物料启用序列号管理）：与MTS模式相同
   - **装箱打包绑定**（核心功能，新增，如果工序包含包装工序）：与MTS模式相同（详见第3.8节）
   - 确认入库数量
   - 提交入库单
   - 系统自动标记为订单专属库存（MTO模式）

4. **方式4：批量导入（可选）**：与MTS模式相同

**系统行为（优化后）：**
- ✅ **与MTS模式相同**（详见第3.8节：成品入库阶段系统行为）
- ✅ **MTO模式特殊处理**：
  - 入库单自动关联销售订单（基于工单关联的销售订单）
  - 自动标记为订单专属库存（MTO模式）
  - 订单专属库存单独管理（不与其他库存混合）
  - 入库信息同步到客户协同平台（如果启用）

**验收标准：**
- ✅ **与MTS模式相同**（详见第3.8节：成品入库阶段验收标准）
- ✅ MTO模式入库单关联销售订单正常
- ✅ 订单专属库存标记正常
- ✅ 订单专属库存单独管理正常

---

### 4.9 销售出库阶段（关联订单）

**用户操作：**
1. 进入"快智造" → "仓储管理" → "出库管理"
2. 创建销售出库单（MTO模式，关联订单）：
   - 点击"新建"按钮
   - 选择出库类型：销售出库
   - **选择关联销售订单：订单1**（MTO模式关键）
   - 系统自动填充：
     - 客户：客户A
     - 物料：产品A
     - 数量：98个（订单专属库存）
     - 仓库：成品仓库
   - 确认出库数量
   - 提交出库单
3. 系统自动更新库存（释放订单专属库存）
4. 打印出库单（打印模板）

**系统行为：**
- ✅ 创建销售出库单（关联销售订单）
- ✅ 自动填充订单信息
- ✅ 自动更新库存数量（释放订单专属库存）
- ✅ 记录出库历史
- ✅ 打印出库单

**验收标准：**
- ✅ 销售出库单创建成功（关联订单）
- ✅ 订单信息自动填充正确
- ✅ 库存自动更新成功（释放订单专属库存）
- ✅ 出库单打印可用

---

## 5. 异常处理场景推演（新增）

### 5.1 缺料异常处理

**用户操作：**
1. 进入"快智造" → "生产执行" → "工单管理" → "工单列表"
2. 选择待下达的工单，点击"下达"按钮
3. **系统自动检测缺料情况**：
   - 显示缺料预警弹窗
   - 列出缺料物料和缺料数量
   - 显示AI建议的解决方案
4. **用户选择处理方式**：
   - 方式1：等待物料到货后再下达（推荐）
   - 方式2：使用替代料（AI推荐可用替代料）
   - 方式3：强制下达（缺料时仍可下达，系统记录风险）
5. 根据选择处理缺料异常

**系统行为：**
- ✅ 自动检查物料齐套情况
- ✅ 检测缺料时自动预警
- 🤖 **AI智能建议**（通过Inngest AI工作流）：
  - **缺料分析**：分析缺料原因（库存不足、采购未到货、其他工单占用）
  - **解决方案建议**：
    - 建议等待物料到货时间（基于采购计划）
    - 推荐可用替代料（基于BOM替代料配置）
    - 建议调整工单优先级（基于交期和重要性）
  - **风险预警**：强制下达时，评估风险并预警

**验收标准：**
- ✅ 缺料检测正常
- ✅ 缺料预警正常显示
- ✅ AI建议正常显示（解决方案建议清晰明确）
- ✅ 替代料推荐正常（基于BOM配置）

---

### 5.2 交期延期异常处理

**用户操作：**
1. 进入"快智造" → "生产执行" → "工单管理" → "工单列表"
2. **系统自动检测延期风险**：
   - 延期工单自动标记（红色标识）
   - 显示延期预警提示
   - 显示AI建议的应对措施
3. **用户查看延期分析**：
   - 点击延期工单，查看延期原因分析
   - 查看AI建议的应对措施
4. **用户选择应对措施**：
   - 方式1：调整排产计划（AI建议最佳调整方案）
   - 方式2：增加产能（AI建议增加工作中心或加班）
   - 方式3：与客户协商延期（AI建议沟通话术）

**系统行为：**
- ✅ 自动检测延期风险（基于当前进度和计划时间）
- ✅ 延期工单自动标记
- 🤖 **AI智能建议**（通过Inngest AI工作流）：
  - **延期原因分析**：分析延期原因（物料缺料、产能不足、质量问题、设备故障）
  - **应对措施建议**：
    - 建议调整排产计划（优化工序顺序、并行生产）
    - 建议增加产能（加班、增加工作中心、外包）
    - 建议与客户协商延期（提供沟通话术模板）
  - **预防措施建议**：基于延期原因，建议预防措施（如：提前备料、增加安全库存）

**验收标准：**
- ✅ 延期检测正常（实时监控工单进度）
- ✅ 延期预警正常显示
- ✅ AI建议正常显示（应对措施建议实用）
- ✅ 延期原因分析准确

---

### 5.3 质量异常处理

**用户操作：**
1. 进入"快智造" → "生产执行" → "报工管理" → "报工记录查询"
2. **系统自动检测质量异常**：
   - 不良率超过阈值时自动预警
   - 显示质量异常分析报告
   - 显示AI建议的改进措施
3. **用户查看质量分析**：
   - 查看不良品类型分布
   - 查看不良品趋势分析
   - 查看AI建议的改进措施
4. **用户采取改进措施**：
   - 根据AI建议，调整生产工艺
   - 加强质量检验
   - 培训操作人员

**系统行为：**
- ✅ 自动检测质量异常（不良率超过阈值）
- ✅ 生成质量异常分析报告
- 🤖 **AI智能建议**（通过Inngest AI工作流）：
  - **质量分析**：分析不良品类型、原因、趋势
  - **改进措施建议**：
    - 建议调整生产工艺（基于不良品类型）
    - 建议加强质量检验（基于不良品分布）
    - 建议培训操作人员（基于不良品原因）
  - **预防措施建议**：基于质量趋势，建议预防措施

**验收标准：**
- ✅ 质量异常检测正常（实时监控不良率）
- ✅ 质量异常预警正常显示
- ✅ AI建议正常显示（改进措施建议实用）
- ✅ 质量分析报告准确

---

## 6. 质量管理流程推演（第二阶段扩展）

> **注意**：本章节为简化版本，详细版本请参考第10.5章"质量管理流程（完整场景推演）"

### 6.1 来料检验（简化版本，详细版本见10.5.2）

**用户操作：**
1. 进入"快智造" → "质量管理" → "来料检验"
2. 创建来料检验单：
   - 选择关联采购单
   - 选择物料：塑料颗粒A
   - 输入检验数量：1000kg
   - 输入合格数量：980kg
   - 输入不良数量：20kg
   - 选择检验结果：部分合格
   - 输入检验人：质量管理员（孙七）
   - 提交检验单
3. 系统自动处理：
   - 合格物料自动入库
   - 不良物料标记为不良品

**系统行为：**
- ✅ 创建来料检验单
- ✅ 自动处理合格物料入库
- ✅ 自动处理不良物料标记
- ✅ 触发检验数据处理工作流（Inngest）
- ✅ 触发不良品处理工作流（Inngest）

**验收标准：**
- ✅ 来料检验单创建成功
- ✅ 合格物料自动入库成功
- ✅ 不良物料标记成功

---

### 6.2 过程检验（简化版本，详细版本见10.5.3）

**用户操作：**
1. 进入"快智造" → "质量管理" → "过程检验"
2. 创建过程检验单：
   - 选择关联工单：工单-20260110-001
   - 选择关联工序：组装工序
   - 输入检验数量：100个
   - 输入合格数量：98个
   - 输入不良数量：2个
   - 选择不良品类型：外观不良
   - 选择检验结果：部分合格
   - 输入检验人：质量管理员（孙七）
   - 提交检验单
3. 系统自动处理：
   - 合格数量计入报工合格数
   - 不良数量标记为不良品

**系统行为：**
- ✅ 创建过程检验单
- ✅ 自动更新报工合格数
- ✅ 自动标记不良品
- ✅ 触发检验数据处理工作流（Inngest）

**验收标准：**
- ✅ 过程检验单创建成功
- ✅ 报工合格数自动更新成功
- ✅ 不良品标记成功

---

### 6.3 成品检验（简化版本，详细版本见10.5.4）

**用户操作：**
1. 进入"快智造" → "质量管理" → "成品检验"
2. 创建成品检验单：
   - 选择关联工单：工单-20260110-001
   - 输入检验数量：100个
   - 输入合格数量：98个
   - 输入不良数量：2个
   - 选择检验结果：部分合格
   - 输入检验人：质量管理员（孙七）
   - 提交检验单
3. 系统自动处理：
   - 合格数量允许入库
   - 不良数量不允许入库

**系统行为：**
- ✅ 创建成品检验单
- ✅ 自动处理合格数量入库
- ✅ 自动处理不良数量标记

**验收标准：**
- ✅ 成品检验单创建成功
- ✅ 合格数量入库处理成功
- ✅ 不良数量标记成功

---

## 6. 财务协同流程推演（第二阶段扩展）

### 6.1 应付管理

**用户操作：**
1. 进入"快智造" → "财务协同" → "应付管理"
2. 查看应付单列表（系统自动生成）：
   - 采购入库后，系统自动生成应付单
   - 应付单关联采购单和供应商
3. 查看应付单详情
4. 记录付款信息：
   - 输入已付金额：5000元
   - 输入付款日期：2026-01-15
   - 提交付款信息
5. 系统自动更新应付单状态（部分付款/已付款）
6. 导出应付单（Excel）
7. 打印应付单（打印模板）

**系统行为：**
- ✅ 自动生成应付单（采购入库后）
- ✅ 触发应付单生成工作流（Inngest）
- ✅ 自动更新应付单状态
- ✅ 导出应付单（Excel）
- ✅ 打印应付单

**验收标准：**
- ✅ 应付单自动生成成功
- ✅ 应付单状态更新成功
- ✅ 应付单导出可用（Excel）
- ✅ 应付单打印可用

---

### 6.2 应收管理

**用户操作：**
1. 进入"快智造" → "财务协同" → "应收管理"
2. 查看应收单列表（系统自动生成）：
   - 销售出库后，系统自动生成应收单
   - 应收单关联销售订单和客户
3. 查看应收单详情
4. 记录收款信息：
   - 输入已收金额：10000元
   - 输入收款日期：2026-01-20
   - 提交收款信息
5. 系统自动更新应收单状态（部分收款/已收款）
6. 导出应收单（Excel）
7. 打印应收单（打印模板）

**系统行为：**
- ✅ 自动生成应收单（销售出库后）
- ✅ 触发应收单生成工作流（Inngest）
- ✅ 自动更新应收单状态
- ✅ 导出应收单（Excel）
- ✅ 打印应收单

**验收标准：**
- ✅ 应收单自动生成成功
- ✅ 应收单状态更新成功
- ✅ 应收单导出可用（Excel）
- ✅ 应收单打印可用

---

## 7. 报表分析流程推演

### 7.1 库存报表

**用户操作：**
1. 进入"快智造" → "报表分析" → "库存报表"
2. 查看库存报表：
   - 库存查询（实时库存）
   - 库存周转率分析
   - 库存预警（低于安全库存）
3. **查看AI数据洞察**：
   - 点击"AI分析"按钮，查看AI数据洞察
   - 查看库存优化建议
4. 导出库存报表（Excel、PDF）
5. 打印库存报表（打印模板）

**系统行为：**
- ✅ 实时库存查询
- ✅ 库存周转率计算
- ✅ 库存预警检查
- ✅ 报表导出（Excel、PDF）
- ✅ 报表打印
- 🤖 **AI智能建议**（通过Inngest AI工作流）：
  - **数据洞察**：分析库存数据，提供数据洞察：
    - 识别滞销物料（库存周转率低）
    - 识别缺料风险（库存低于安全库存）
    - 识别积压物料（库存超过最高库存）
  - **优化建议**：
    - 建议调整安全库存（基于历史消耗数据）
    - 建议清理滞销物料（基于库存周转率）
    - 建议优化采购计划（基于库存趋势）

**验收标准：**
- ✅ 库存报表查询正常
- ✅ 库存周转率计算正确
- ✅ 库存预警正常
- ✅ 报表导出可用（Excel、PDF）
- ✅ 报表打印可用
- ✅ AI数据洞察正常显示（数据洞察清晰，优化建议实用）

**用户操作：**
1. 进入"快智造" → "报表分析" → "库存报表"
2. 查看库存报表：
   - 库存查询（实时库存）
   - 库存周转率分析
   - 库存预警（低于安全库存）
3. 导出库存报表（Excel、PDF）
4. 打印库存报表（打印模板）

**系统行为：**
- ✅ 实时库存查询
- ✅ 库存周转率计算
- ✅ 库存预警检查
- ✅ 报表导出（Excel、PDF）
- ✅ 报表打印

**验收标准：**
- ✅ 库存报表查询正常
- ✅ 库存周转率计算正确
- ✅ 库存预警正常
- ✅ 报表导出可用（Excel、PDF）
- ✅ 报表打印可用

---

### 7.2 生产报表

**用户操作：**
1. 进入"快智造" → "报表分析" → "生产报表"
2. 查看生产报表：
   - 工单绩效分析（准时完工率、计划达成率）
   - 生产效率分析
   - 设备利用率分析
3. 导出生产报表（Excel、PDF）
4. 打印生产报表（打印模板）
5. 切换到"大屏模式"（支持大屏显示）

**系统行为：**
- ✅ 工单绩效分析计算
- ✅ 生产效率分析计算
- ✅ 设备利用率分析计算
- ✅ 报表导出（Excel、PDF）
- ✅ 报表打印
- ✅ 大屏模式支持
- 🤖 **AI智能建议**（通过Inngest AI工作流）：
  - **数据洞察**：分析生产数据，提供数据洞察：
    - 识别生产效率提升趋势
    - 识别设备利用率瓶颈
    - 识别工单绩效改善空间
  - **优化建议**：
    - 建议优化排产计划（基于设备利用率分析）
    - 建议改进生产工艺（基于生产效率分析）
    - 建议调整产能配置（基于工单绩效分析）

**验收标准：**
- ✅ 生产报表查询正常
- ✅ 工单绩效分析正确
- ✅ 报表导出可用（Excel、PDF）
- ✅ 报表打印可用
- ✅ 大屏模式可用
- ✅ AI数据洞察正常显示（数据洞察清晰，优化建议实用）

---

### 7.3 质量报表

**用户操作：**
1. 进入"快智造" → "报表分析" → "质量报表"
2. 查看质量报表：
   - 质量合格率统计（按产品、工序等维度）
   - 不良品类型分析
   - 质量趋势分析
3. 导出质量报表（Excel、PDF）
4. 打印质量报表（打印模板）

**系统行为：**
- ✅ 质量合格率计算
- ✅ 不良品类型统计
- ✅ 质量趋势分析
- ✅ 报表导出（Excel、PDF）
- ✅ 报表打印
- 🤖 **AI智能建议**（通过Inngest AI工作流）：
  - **数据洞察**：分析质量数据，提供数据洞察：
    - 识别质量改善趋势
    - 识别主要不良品类型
    - 识别质量风险点
  - **优化建议**：
    - 建议改进生产工艺（基于不良品类型分析）
    - 建议加强质量检验（基于质量风险点）
    - 建议培训操作人员（基于不良品原因分析）

**验收标准：**
- ✅ 质量报表查询正常
- ✅ 质量合格率统计正确
- ✅ 报表导出可用（Excel、PDF）
- ✅ 报表打印可用
- ✅ AI数据洞察正常显示（数据洞察清晰，优化建议实用）

---

## 8. 工位机触屏模式（新增，车间固定工位核心需求）

### 8.1 工位机触屏模式概述

**应用场景：**
- 车间固定工位（如：组装工位、检验工位、包装工位）
- 需要大屏显示SOP、图纸、加工程序
- 需要触屏操作，无需鼠标键盘
- 需要全屏沉浸式体验

**核心功能：**
- ✅ 现场报工（触屏优化）
- ✅ SOP查看（触屏优化）
- ✅ 图纸查看（触屏优化）
- ✅ 加工程序查看（触屏优化）

---

### 8.2 工位机触屏模式切换

**用户操作：**
1. **方式1：自动识别（推荐）**
   - 工位机开机，访问系统
   - 系统自动检测设备类型（通过User-Agent或设备标识）
   - 自动切换到工位机触屏模式（全屏显示）
   - 显示工位机触屏界面（大按钮、大字体）

2. **方式2：手动切换（可选）**
   - 登录系统后，点击右上角"设置"
   - 选择"切换到工位机模式"
   - 系统切换到工位机触屏模式

**系统行为：**
- ✅ **自动识别终端类型**：检测到工位机设备，自动切换到触屏模式
- ✅ **全屏模式**：自动进入全屏模式（无浏览器地址栏、工具栏）
- ✅ **触屏优化界面**：自动应用触屏优化样式（大按钮、大字体、大间距）
- ✅ **记住模式**：记住用户选择的模式，下次自动应用

**验收标准：**
- ✅ 自动识别工位机设备正常
- ✅ 自动切换到触屏模式正常
- ✅ 全屏模式正常（无浏览器地址栏）
- ✅ 触屏优化界面正常（大按钮、大字体）

---

### 8.3 现场报工（工位机触屏模式）

**用户操作（工位机触屏模式，极致简化）：**
1. **工位机开机，自动进入报工界面**
   - 工位机开机，自动进入工位机触屏模式
   - 显示报工主界面（大按钮布局）：
     - "扫码报工"大按钮（占据屏幕主要区域）
     - "手动输入工单号"大按钮
     - "查看SOP"大按钮
     - "查看图纸"大按钮
     - "查看加工程序"大按钮

2. **扫码报工（最快，推荐）**
   - 点击"扫码报工"大按钮（全屏显示扫码界面）
   - 扫描工单二维码（自动识别工单信息）
   - **系统自动填充并显示**（大字体显示）：
     - 工单号：工单-20260105-001（字体≥32px）
     - 产品：产品A（字体≥28px）
     - **当前工序：组装工序**（字体≥28px，突出显示）
     - 计划数量：90个（字体≥28px）
   
   - **快速报工模式**（触屏优化）：
     - 完成数量：90个（大数字键盘输入，触屏优化）
       - 显示大数字键盘（按钮≥60px）
       - 支持触屏输入数字
     - 合格数量：88个（大数字键盘输入，触屏优化）
     - 工时：8小时（可选，大数字键盘输入）
     - 备注：文本输入"正常完成"（大文本输入框，触屏优化，可选）
   - 点击"提交"大按钮（全屏底部固定，高度≥80px，易于点击）
   - **完成，<30秒**

   - **带参数报工模式**（触屏优化）：
     - 完成数量：90个（大数字键盘输入）
     - 合格数量：88个（大数字键盘输入）
     - **SOP指定参数**（大表单输入，触屏优化）：
       - 扭矩：25N·m（大数字键盘输入，范围：20-30）
       - 外观检查：是大按钮/否大按钮（触屏选择，按钮≥60px）
       - 其他参数...（根据SOP配置动态显示，触屏优化）
     - 工时：8小时（可选）
     - 备注：文本输入"正常完成"（大文本输入框，触屏优化，可选）
     - 点击"提交"大按钮
     - **完成，<1分钟**

3. **提交后，系统自动**：
   - 保存报工数据（包含参数数据）
   - 更新工单进度
   - **自动切换到下一工序**（如果还有未完成工序）
   - 显示"报工成功"大提示（全屏显示，字体≥48px，3秒后自动关闭）

**系统行为（工位机触屏模式）：**
- ✅ **触屏界面优化**：
  - 大按钮设计（按钮高度≥60px，适合手指点击）
  - 大字体显示（字体大小≥24px，清晰易读）
  - 全屏模式（无浏览器地址栏，沉浸式体验）
  - 触屏优化布局（元素间距≥20px，避免误触）
- ✅ **触屏输入优化**：
  - 大数字键盘（触屏优化，易于输入）
  - 大文本输入框（触屏优化，易于输入，备注输入）
  - 大选择按钮（触屏优化，易于选择）
- ✅ **自动切换工序**：报工完成后，自动切换到下一工序
- ✅ 记录报工数据（包含参数数据）
- ✅ 自动更新工单进度

**验收标准：**
- ✅ 工位机触屏模式正常（自动识别，自动切换）
- ✅ 触屏界面优化正常（大按钮、大字体、全屏模式）
- ✅ 触屏输入优化正常（大数字键盘、大选择按钮）
- ✅ 扫码报工正常（扫描后自动填充）
- ✅ 快速报工正常（<30秒完成）
- ✅ 带参数报工正常（<1分钟完成）
- ✅ 自动切换工序正常（报工完成后自动切换）

---

### 8.4 SOP查看（工位机触屏模式）

**用户操作（工位机触屏模式）：**
1. **进入SOP查看界面**
   - 方式1：报工界面点击"SOP查看"大按钮
   - 方式2：工位机主界面点击"SOP查看"大按钮
   - 方式3：扫描工单二维码后，自动显示SOP查看入口

2. **SOP查看操作（触屏优化）**
   - **全屏显示SOP内容**（触屏优化）：
     - SOP标题：《组装作业标准》（字体≥32px，突出显示）
     - SOP步骤列表（大字体显示，字体≥24px）
     - SOP图片（大图显示，支持触屏缩放）
   - **触屏操作**：
     - **上下滑动**：查看SOP步骤（触屏滑动，流畅滚动）
     - **左右滑动**：翻页查看（触屏滑动，翻页动画）
     - **双指捏合**：缩放SOP图片（触屏缩放，放大/缩小）
     - **单击图片**：全屏查看图片（触屏点击，全屏显示）
     - **长按文字**：复制SOP内容（触屏长按，显示复制菜单）
   - **SOP步骤高亮**：
     - 当前步骤突出显示（背景色高亮，字体加粗）
     - 已完成步骤灰色显示（已完成标记）
     - 未完成步骤正常显示（待完成标记）

3. **返回报工界面**
   - 点击"返回报工"大按钮（全屏底部固定，易于点击）
   - 或点击"SOP查看"大按钮关闭SOP查看

**系统行为（工位机触屏模式）：**
- ✅ **全屏显示SOP内容**（触屏优化）
- ✅ **触屏滑动支持**：支持上下滑动查看SOP步骤，左右滑动翻页
- ✅ **触屏缩放支持**：支持双指捏合缩放SOP图片
- ✅ **SOP步骤高亮**：当前步骤突出显示，已完成步骤标记
- ✅ **触屏手势支持**：单击、双击、长按、滑动、捏合

**验收标准：**
- ✅ SOP查看全屏显示正常（触屏优化）
- ✅ 触屏滑动正常（上下滑动查看步骤，左右滑动翻页）
- ✅ 触屏缩放正常（双指捏合缩放图片）
- ✅ SOP步骤高亮正常（当前步骤突出显示）
- ✅ 触屏手势支持正常（单击、双击、长按、滑动、捏合）

---

### 8.5 图纸查看（工位机触屏模式）

**用户操作（工位机触屏模式）：**
1. **进入图纸查看界面**
   - 方式1：报工界面点击"图纸查看"大按钮
   - 方式2：工位机主界面点击"图纸查看"大按钮
   - 方式3：扫描工单二维码后，自动显示图纸查看入口

2. **图纸查看操作（触屏优化）**
   - **全屏显示图纸**（触屏优化）：
     - 图纸标题：产品A组装图纸（字体≥32px）
     - 图纸内容（全屏显示，高清显示）
   - **触屏操作**：
     - **双指捏合**：缩放图纸（触屏缩放，放大/缩小，支持0.5x-5x缩放）
     - **单指拖拽**：移动图纸（触屏拖拽，查看图纸不同区域）
     - **双击**：快速放大/缩小（触屏双击，快速缩放）
     - **旋转**：旋转图纸（触屏旋转，横屏/竖屏自动适配）
     - **长按**：显示图纸菜单（触屏长按，显示标注、测量、对比等菜单）
   - **图纸标注功能**（核心功能，新增）：
     - 点击"标注"大按钮（全屏底部工具栏）
     - 触屏画笔功能（触屏绘制，标注关键位置）
     - 支持多种标注工具（箭头、圆圈、文字、高亮）
     - 支持标注保存（标注数据保存到报工记录）
   - **图纸测量功能**（核心功能，新增）：
     - 点击"测量"大按钮（全屏底部工具栏）
     - 触屏测量工具（触屏选择起点和终点，自动计算距离）
     - 支持多种测量方式（直线距离、角度、面积）
     - 显示测量结果（大字体显示，易于查看）
   - **图纸对比功能**（核心功能，新增）：
     - 点击"对比"大按钮（全屏底部工具栏）
     - 分屏显示（左右分屏，对比不同版本图纸）
     - 支持触屏滑动对比（同步滑动，对比不同区域）

3. **返回报工界面**
   - 点击"返回报工"大按钮（全屏底部固定，易于点击）
   - 或点击"图纸查看"大按钮关闭图纸查看

**系统行为（工位机触屏模式）：**
- ✅ **全屏显示图纸**（触屏优化，高清显示）
- ✅ **触屏缩放支持**：支持双指捏合缩放图纸（0.5x-5x）
- ✅ **触屏拖拽支持**：支持单指拖拽移动图纸
- ✅ **触屏旋转支持**：支持横屏/竖屏自动适配
- ✅ **图纸标注功能**：支持触屏画笔标注，标注数据保存
- ✅ **图纸测量功能**：支持触屏测量工具，显示测量结果
- ✅ **图纸对比功能**：支持分屏显示，对比不同版本图纸

**验收标准：**
- ✅ 图纸查看全屏显示正常（触屏优化，高清显示）
- ✅ 触屏缩放正常（双指捏合缩放，0.5x-5x）
- ✅ 触屏拖拽正常（单指拖拽移动）
- ✅ 触屏旋转正常（横屏/竖屏自动适配）
- ✅ 图纸标注功能正常（触屏画笔标注，标注保存）
- ✅ 图纸测量功能正常（触屏测量工具，测量结果显示）
- ✅ 图纸对比功能正常（分屏显示，对比不同版本）

---

### 8.6 加工程序查看（工位机触屏模式）

**用户操作（工位机触屏模式）：**
1. **进入加工程序查看界面**
   - 方式1：报工界面点击"加工程序查看"大按钮
   - 方式2：工位机主界面点击"加工程序查看"大按钮
   - 方式3：扫描工单二维码后，自动显示加工程序查看入口

2. **加工程序查看操作（触屏优化）**
   - **全屏显示加工程序**（触屏优化）：
     - 程序标题：产品A组装程序（字体≥32px）
     - 程序代码（全屏显示，语法高亮）
   - **触屏操作**：
     - **上下滑动**：滚动查看程序代码（触屏滑动，流畅滚动）
     - **单击行号**：快速跳转到指定行（触屏点击行号，快速跳转）
     - **长按代码**：选择/复制代码（触屏长按，显示选择/复制菜单）
     - **双击代码**：高亮显示代码行（触屏双击，高亮显示）
   - **程序搜索功能**（核心功能，新增）：
     - 点击"搜索"大按钮（全屏底部工具栏）
     - 显示大键盘输入框（触屏优化，易于输入）
     - 输入搜索关键词（支持拼音搜索）
     - 显示搜索结果（高亮显示匹配内容）
     - 支持上下切换搜索结果（触屏点击，切换结果）
   - **程序语法高亮**（核心功能，新增）：
     - 自动语法高亮（G代码、CNC程序等）
     - 关键字高亮显示（易于识别）
     - 注释高亮显示（易于区分）
     - 错误行标记（红色标记，易于识别）
   - **程序行号显示**（核心功能，新增）：
     - 显示程序行号（左侧固定列，易于定位）
     - 支持点击行号跳转（触屏点击，快速跳转）
     - 支持行号高亮（当前行高亮显示）

3. **返回报工界面**
   - 点击"返回报工"大按钮（全屏底部固定，易于点击）
   - 或点击"加工程序查看"大按钮关闭程序查看

**系统行为（工位机触屏模式）：**
- ✅ **全屏显示加工程序**（触屏优化，语法高亮）
- ✅ **触屏滚动支持**：支持上下滑动滚动查看程序代码
- ✅ **程序搜索功能**：支持触屏搜索程序内容，高亮显示匹配内容
- ✅ **程序语法高亮**：自动语法高亮，关键字和注释高亮显示
- ✅ **程序行号显示**：显示程序行号，支持点击行号跳转
- ✅ **程序复制功能**：支持长按选择代码，复制程序内容

**验收标准：**
- ✅ 加工程序查看全屏显示正常（触屏优化，语法高亮）
- ✅ 触屏滚动正常（上下滑动滚动查看）
- ✅ 程序搜索功能正常（触屏搜索，高亮显示匹配内容）
- ✅ 程序语法高亮正常（关键字和注释高亮显示）
- ✅ 程序行号显示正常（显示行号，支持点击跳转）
- ✅ 程序复制功能正常（长按选择，复制代码）

---

### 8.7 工位机触屏模式优化效果

**触屏界面优化：**
- ⚡ **大按钮设计**：按钮高度≥60px，适合手指点击，减少误触
- ⚡ **大字体显示**：字体大小≥24px，清晰易读，适合远距离查看
- ⚡ **全屏模式**：无浏览器地址栏，沉浸式体验，专注操作
- ⚡ **触屏优化布局**：元素间距≥20px，避免误触，操作流畅

**操作效率提升：**
- ⚡ **报工操作**：从3分钟减少到<30秒（快速报工）
- ⚡ **SOP查看**：触屏滑动查看，无需鼠标键盘，操作流畅
- ⚡ **图纸查看**：触屏缩放拖拽，直观操作，易于查看细节
- ⚡ **程序查看**：触屏滚动搜索，快速定位，提高效率

**适用场景：**
- ✅ 车间固定工位（组装工位、检验工位、包装工位）
- ✅ 需要大屏显示（SOP、图纸、程序）
- ✅ 需要触屏操作（无需鼠标键盘）
- ✅ 需要全屏沉浸式体验（专注操作）

---

## 9. 工作台快捷操作（新增，中小企业核心需求）

### 9.1 工作台首页（新增）

**用户操作（优化后，极致简化）：**
1. 登录系统后，自动进入工作台首页
2. **工作台首页包含**：
   - **快捷操作区**（核心功能）：
     - 一键报工（移动端优先）
     - 一键领料
     - 一键入库
     - 一键下达工单
   - **待办事项区**（核心功能）：
     - 待下达工单（数量+快捷操作）
     - 待领料工单（数量+快捷操作）
     - 待入库工单（数量+快捷操作）
     - 待处理预警（数量+快捷操作）
   - **数据看板区**（核心功能）：
     - 今日生产数据（工单数、完工数、延期数）
     - 今日库存数据（入库数、出库数、库存预警）
     - 今日质量数据（合格率、不良数）
   - **快捷入口区**（常用功能）：
     - 工单管理
     - 报工管理
     - 库存查询
     - 生产看板

**系统行为（优化后）：**
- ✅ **自动进入工作台**：登录后自动进入工作台首页
- ✅ **实时数据更新**：工作台数据实时更新（WebSocket）
- ✅ **快捷操作**：一键操作按钮，直接完成操作
- ✅ **待办提醒**：待办事项自动提醒，点击直接处理
- ✅ **数据看板**：关键数据一目了然

**验收标准：**
- ✅ 工作台首页正常显示（登录后自动进入）
- ✅ 快捷操作正常（一键操作可用）
- ✅ 待办事项正常（自动提醒，点击直接处理）
- ✅ 数据看板正常（实时更新）
- ✅ 快捷入口正常（常用功能快捷入口）

**优化效果：**
- ⚡ **操作步骤减少**：从多步操作减少到1步（点击快捷操作）
- ⚡ **时间缩短**：从5分钟减少到<30秒（快捷操作）
- ⚡ **效率提升**：常用功能一键直达，无需多级菜单

---

## 10. 通用需求场景

### 9.1 数据导入导出

**通用需求：**
- ✅ 所有列表页面支持universheet在线表格批量导入（实时保存）
- ✅ 所有列表页面支持Excel批量导出
- ✅ 支持Excel模板下载
- ✅ 支持Excel数据验证
- ✅ 支持Excel错误提示（中文）

**个性化需求（后期定制）：**
- ⚠️ 自定义导入字段映射
- ⚠️ 自定义导出格式
- ⚠️ 自定义数据验证规则

---

### 9.2 高级搜索

**通用需求：**
- ✅ 所有列表页面支持高级搜索
- ✅ 支持拼音搜索（符合中国用户习惯）
- ✅ 支持快速筛选
- ✅ 支持筛选条件保存

**个性化需求（后期定制）：**
- ⚠️ 自定义搜索字段
- ⚠️ 自定义筛选条件
- ⚠️ 自定义搜索逻辑

---

### 9.3 打印功能

**通用需求：**
- ✅ 所有单据支持打印
- ✅ 支持打印模板
- ✅ 支持打印预览
- ✅ 支持批量打印

**个性化需求（后期定制）：**
- ⚠️ 自定义打印模板
- ⚠️ 自定义打印格式
- ⚠️ 自定义打印字段

---

### 9.4 移动端和工位机触屏支持

**通用需求：**
- ✅ **移动端支持**：
  - 报工界面移动端优化
  - 支持扫码功能（二维码、条形码）
  - 支持大文本输入框（备注输入，触屏优化）
  - 支持离线功能（网络不稳定场景）

- ✅ **工位机触屏模式**（核心功能，新增）：
  - **自动识别终端类型**：检测到工位机设备，自动切换到触屏模式
  - **触屏界面优化**：
    - 大按钮设计（按钮高度≥60px，适合手指点击）
    - 大字体显示（字体大小≥24px，清晰易读）
    - 全屏模式（无浏览器地址栏，沉浸式体验）
    - 触屏优化布局（元素间距≥20px，避免误触）
  - **现场报工优化**：
    - 触屏扫码报工（大按钮，易于操作）
    - 触屏数字键盘输入（大键盘，易于输入）
    - 触屏选择按钮（大按钮，易于选择）
    - 触屏文本输入（大文本输入框，易于输入）
  - **SOP查看优化**：
    - 全屏显示SOP内容（触屏优化）
    - 支持触屏滑动查看SOP步骤（上下滑动）
    - 支持触屏缩放查看SOP图片（双指捏合）
    - 支持触屏翻页（左右滑动）
    - 支持SOP步骤高亮显示（当前步骤突出显示）
  - **图纸查看优化**（核心功能，新增）：
    - 全屏显示图纸（触屏优化）
    - 支持触屏缩放（双指捏合，放大/缩小）
    - 支持触屏拖拽（单指移动，查看图纸不同区域）
    - 支持触屏旋转（横屏/竖屏自动适配）
    - 支持图纸标注（触屏画笔功能，可标注关键位置）
    - 支持图纸测量（触屏测量工具，测量尺寸）
    - 支持图纸对比（分屏显示，对比不同版本）
  - **加工程序查看优化**（核心功能，新增）：
    - 全屏显示加工程序（触屏优化）
    - 支持触屏滚动查看程序代码（上下滑动）
    - 支持触屏搜索程序内容（大键盘输入，触屏优化）
    - 支持程序高亮显示（语法高亮，易于阅读）
    - 支持程序行号显示（便于定位）
    - 支持程序行跳转（点击行号，快速跳转）
    - 支持程序复制（长按选择，复制代码）
  - **触屏手势支持**：
    - 单击：选择/确认
    - 双击：放大/缩小
    - 长按：显示菜单/复制
    - 滑动：滚动/翻页
    - 捏合：缩放
    - 旋转：旋转图纸

**个性化需求（后期定制）：**
- ⚠️ 自定义移动端界面
- ⚠️ 自定义工位机触屏界面布局
- ⚠️ 自定义扫码规则
- ⚠️ 自定义离线数据同步规则
- ⚠️ 自定义触屏手势规则

---

### 9.5 实时数据推送

**通用需求：**
- ✅ 生产看板实时更新（WebSocket）
- ✅ 设备看板实时更新（WebSocket）
- ✅ 数据推送延迟<100ms
- ✅ 支持断线重连

**个性化需求（后期定制）：**
- ⚠️ 自定义推送频率
- ⚠️ 自定义推送内容
- ⚠️ 自定义推送规则

---

### 9.6 权限管理

**通用需求：**
- ✅ 基于角色的权限控制（RBAC）
- ✅ 支持部门权限
- ✅ 支持数据权限（租户隔离）

**个性化需求（后期定制）：**
- ⚠️ 自定义角色权限
- ⚠️ 自定义数据权限规则
- ⚠️ 自定义审批流程权限

---

### 9.7 审批流程

**通用需求：**
- ✅ 支持工单审批流程
- ✅ 支持采购单审批流程
- ✅ 支持销售订单审批流程
- ✅ 支持流程可视化设计器

**个性化需求（后期定制）：**
- ⚠️ 自定义审批流程
- ⚠️ 自定义审批规则
- ⚠️ 自定义审批条件

---

## 11. 多角色场景推演与自助式上线向导

### 11.1 角色定义与职责说明

**预设中小制造业常见角色：**

1. **销售**：负责客户管理、销售订单管理、报价管理
2. **采购**：负责供应商管理、采购订单管理、询价管理
3. **仓库**：负责库存管理、入库出库管理、盘点管理
4. **技术研发人员**：负责产品设计、BOM管理、工艺路线设计、SOP设计
5. **生产计划人员**：负责生产计划、MRP运算、排产管理
6. **班组长**：负责工单管理、生产进度跟踪、人员安排
7. **生产人员**：负责现场报工、SOP查看、图纸查看
8. **质量组**：负责质量检验、不合格品处理、质量报表
9. **设备组**：负责设备管理、设备维护、设备状态监控
10. **财务**：负责应收应付管理、成本核算、财务报表
11. **管理者**：负责数据看板、报表分析、决策支持
12. **系统实施人员**：负责系统初始化、数据导入、用户培训

### 11.2 销售角色场景推演与自助式上线向导

#### 11.2.1 销售角色职责与使用场景

**职责：**
- 客户管理：客户信息维护、客户分类、客户评级
- 销售订单管理：创建销售订单、跟踪订单状态、订单变更
- 报价管理：创建报价单、报价审批、报价转订单
- 销售数据分析：销售报表、销售趋势分析、客户分析

**使用场景：**
- 日常：创建报价单、创建销售订单、跟踪订单状态
- 周期性：客户维护、销售数据分析、销售报表
- 异常：订单变更、订单取消、客户投诉处理

**痛点：**
- 客户信息分散，难以统一管理
- 报价单制作繁琐，需要重复输入
- 订单状态不透明，无法及时跟踪
- 销售数据统计困难，需要手工整理

#### 11.2.2 销售角色上线准备（自助式向导）

**第一步：客户数据准备（<30分钟）**
1. **进入"销售管理" → "客户管理" → "客户导入"**
2. **打开客户导入universheet在线表格**（系统自动创建模板）
3. **在universheet中填写客户数据**（实时保存）：
   - 客户编码（如：CUS001）
   - 客户名称（如：XX公司）
   - 联系人、电话、地址
   - 客户分类（如：A类客户、B类客户）
   - 客户评级（如：优质客户、一般客户）
4. **点击"导入"按钮**（系统自动读取universheet数据并导入）
5. **验证客户数据**（系统自动验证，<10秒）
6. **查看导入报告**（成功数量、失败数量、错误详情）

**系统行为：**
- ✅ 自动验证客户数据（格式、完整性、重复性）
- ✅ 自动生成客户编码（如果未填写）
- ✅ 自动分类客户（基于客户分类字段）
- ✅ 自动生成导入报告
- 🤖 **AI智能建议**：
  - 检测客户数据完整性，提示缺失的关键字段
  - 识别重复客户，建议合并
  - 建议客户分类和评级

**第二步：报价单模板配置（<15分钟）**
1. **进入"销售管理" → "报价管理" → "报价单模板"**
2. **选择行业模板**（如：制造业通用报价单模板）
3. **自定义报价单字段**（可选）：
   - 报价单编号、客户名称、报价日期
   - 产品信息（产品编码、产品名称、规格、数量、单价、金额）
   - 报价有效期、付款方式、交货期
4. **保存报价单模板**

**系统行为：**
- ✅ 自动应用行业模板（一键应用）
- ✅ 自动生成报价单编号（基于编码规则）
- ✅ 自动计算报价金额（数量×单价）
- 🤖 **AI智能建议**：
  - 基于历史报价数据，建议报价金额
  - 检测报价合理性，提示异常报价

**第三步：销售订单流程配置（<10分钟）**
1. **进入"销售管理" → "订单管理" → "订单流程配置"**
2. **选择订单流程模板**（如：标准销售订单流程）
3. **配置审批流程**（可选）：
   - 订单金额<10万：直接生效
   - 订单金额10-50万：部门经理审批
   - 订单金额>50万：总经理审批
4. **保存订单流程配置**

**系统行为：**
- ✅ 自动应用订单流程模板（一键应用）
- ✅ 自动判断审批流程（基于订单金额）
- ✅ 自动发送审批通知（审批人）
- 🤖 **AI智能建议**：
  - 基于历史订单数据，建议审批流程
  - 检测订单异常，提示风险

**验收标准：**
- ✅ 客户数据导入成功（支持universheet在线表格批量导入，实时保存）
- ✅ 报价单模板配置成功（支持行业模板）
- ✅ 销售订单流程配置成功（支持审批流程）

**优化效果：**
- ⚡ **操作步骤减少**：客户数据导入<30分钟，报价单模板配置<15分钟
- ⚡ **时间缩短**：从手工录入2天减少到<1小时
- ⚡ **学习成本降低**：向导引导，无需专业知识

#### 11.2.3 销售角色日常使用场景

**场景1：创建报价单（<5分钟）**
1. **进入"销售管理" → "报价管理" → "新建报价单"**
2. **选择客户**（支持搜索、拼音搜索）
3. **添加产品**（支持批量添加）：
   - 输入产品编码或产品名称（支持搜索）
   - 输入数量、单价（系统自动计算金额）
   - 系统自动填充产品规格、单位
4. **填写报价信息**：
   - 报价有效期（默认30天，可修改）
   - 付款方式（默认：货到付款，可修改）
   - 交货期（默认：7天，可修改）
5. **提交报价单**（系统自动生成报价单编号）
6. **打印报价单**（支持打印预览）

**系统行为：**
- ✅ 自动填充客户信息（基于客户选择）
- ✅ 自动填充产品信息（基于产品选择）
- ✅ 自动计算报价金额（数量×单价）
- ✅ 自动生成报价单编号（基于编码规则）
- ✅ 自动保存报价单（草稿状态）
- 🤖 **AI智能建议**：
  - 基于历史报价数据，建议报价金额
  - 检测报价合理性，提示异常报价
  - 建议报价有效期和付款方式

**场景2：报价单转销售订单（<2分钟）**
1. **进入"销售管理" → "报价管理" → "报价单列表"**
2. **选择报价单**（客户已确认的报价单）
3. **点击"转销售订单"按钮**
4. **确认订单信息**（系统自动填充报价单信息）
5. **提交销售订单**（系统自动生成订单编号）

**系统行为：**
- ✅ 自动填充订单信息（基于报价单）
- ✅ 自动生成订单编号（基于编码规则）
- ✅ 自动判断审批流程（基于订单金额）
- ✅ 自动发送订单通知（相关人员）
- 🤖 **AI智能建议**：
  - 检测订单合理性，提示风险
  - 建议订单交期和付款方式

**场景3：跟踪订单状态（<1分钟）**
1. **进入"销售管理" → "订单管理" → "订单列表"**
2. **查看订单状态**（待审批/已审批/生产中/已完成/已发货）
3. **查看订单详情**（订单信息、生产进度、发货信息）
4. **查看订单变更历史**（如有变更）

**系统行为：**
- ✅ 实时更新订单状态（基于生产进度）
- ✅ 自动发送订单状态通知（客户）
- ✅ 自动生成订单进度报告（每天生成）
- 🤖 **AI智能建议**：
  - 检测订单延期风险，提前预警
  - 建议订单交期调整

**场景4：销售数据分析（<5分钟）**
1. **进入"销售管理" → "数据分析" → "销售报表"**
2. **选择报表类型**（如：销售趋势分析、客户分析、产品分析）
3. **选择时间范围**（如：本月、本季度、本年）
4. **查看报表数据**（图表、表格）
5. **导出报表**（Excel、PDF）

**系统行为：**
- ✅ 自动生成销售报表（基于订单数据）
- ✅ 自动生成图表（趋势图、柱状图、饼图）
- ✅ 支持报表导出（Excel、PDF）
- 🤖 **AI智能建议**：
  - 分析销售趋势，建议销售策略
  - 识别销售机会，建议重点客户

**优化点：**
- ⚡ **一键操作**：报价单转订单，一键完成
- ⚡ **智能填充**：自动填充客户和产品信息，减少输入
- ⚡ **实时跟踪**：订单状态实时更新，无需人工查询
- ⚡ **数据分析**：自动生成报表，无需手工整理

---

### 11.3 采购角色场景推演与自助式上线向导

#### 11.3.1 采购角色职责与使用场景

**职责：**
- 供应商管理：供应商信息维护、供应商分类、供应商评级
- 采购订单管理：创建采购订单、跟踪订单状态、订单变更
- 询价管理：创建询价单、询价审批、询价转订单
- 采购数据分析：采购报表、采购趋势分析、供应商分析

**使用场景：**
- 日常：创建询价单、创建采购订单、跟踪订单状态
- 周期性：供应商维护、采购数据分析、采购报表
- 异常：订单变更、订单取消、供应商投诉处理

**痛点：**
- 供应商信息分散，难以统一管理
- 询价单制作繁琐，需要重复输入
- 订单状态不透明，无法及时跟踪
- 采购数据统计困难，需要手工整理

#### 11.3.2 采购角色上线准备（自助式向导）

**第一步：供应商数据准备（<30分钟）**
1. **进入"采购管理" → "供应商管理" → "供应商导入"**
2. **打开供应商导入universheet在线表格**（系统自动创建模板）
3. **在universheet中填写供应商数据**（实时保存）：
   - 供应商编码（如：SUP001）
   - 供应商名称（如：XX公司）
   - 联系人、电话、地址
   - 供应商分类（如：原材料供应商、设备供应商）
   - 供应商评级（如：优质供应商、一般供应商）
4. **点击"导入"按钮**（系统自动读取universheet数据并导入）
5. **验证供应商数据**（系统自动验证，<10秒）
6. **查看导入报告**（成功数量、失败数量、错误详情）

**系统行为：**
- ✅ 自动验证供应商数据（格式、完整性、重复性）
- ✅ 自动生成供应商编码（如果未填写）
- ✅ 自动分类供应商（基于供应商分类字段）
- ✅ 自动生成导入报告
- 🤖 **AI智能建议**：
  - 检测供应商数据完整性，提示缺失的关键字段
  - 识别重复供应商，建议合并
  - 建议供应商分类和评级

**第二步：询价单模板配置（<15分钟）**
1. **进入"采购管理" → "询价管理" → "询价单模板"**
2. **选择行业模板**（如：制造业通用询价单模板）
3. **自定义询价单字段**（可选）：
   - 询价单编号、供应商名称、询价日期
   - 物料信息（物料编码、物料名称、规格、数量、单价、金额）
   - 询价有效期、付款方式、交货期
4. **保存询价单模板**

**系统行为：**
- ✅ 自动应用行业模板（一键应用）
- ✅ 自动生成询价单编号（基于编码规则）
- ✅ 自动计算询价金额（数量×单价）
- 🤖 **AI智能建议**：
  - 基于历史询价数据，建议询价金额
  - 检测询价合理性，提示异常询价

**第三步：采购订单流程配置（<10分钟）**
1. **进入"采购管理" → "订单管理" → "订单流程配置"**
2. **选择订单流程模板**（如：标准采购订单流程）
3. **配置审批流程**（可选）：
   - 订单金额<5万：直接生效
   - 订单金额5-20万：部门经理审批
   - 订单金额>20万：总经理审批
4. **保存订单流程配置**

**系统行为：**
- ✅ 自动应用订单流程模板（一键应用）
- ✅ 自动判断审批流程（基于订单金额）
- ✅ 自动发送审批通知（审批人）
- 🤖 **AI智能建议**：
  - 基于历史订单数据，建议审批流程
  - 检测订单异常，提示风险

**验收标准：**
- ✅ 供应商数据导入成功（支持universheet在线表格批量导入，实时保存）
- ✅ 询价单模板配置成功（支持行业模板）
- ✅ 采购订单流程配置成功（支持审批流程）

**优化效果：**
- ⚡ **操作步骤减少**：供应商数据导入<30分钟，询价单模板配置<15分钟
- ⚡ **时间缩短**：从手工录入2天减少到<1小时
- ⚡ **学习成本降低**：向导引导，无需专业知识

#### 11.3.3 采购角色日常使用场景

**场景1：创建询价单（<5分钟）**
1. **进入"采购管理" → "询价管理" → "新建询价单"**
2. **选择供应商**（支持搜索、拼音搜索）
3. **添加物料**（支持批量添加）：
   - 输入物料编码或物料名称（支持搜索）
   - 输入数量、单价（系统自动计算金额）
   - 系统自动填充物料规格、单位
4. **填写询价信息**：
   - 询价有效期（默认7天，可修改）
   - 付款方式（默认：货到付款，可修改）
   - 交货期（默认：15天，可修改）
5. **提交询价单**（系统自动生成询价单编号）
6. **打印询价单**（支持打印预览）

**系统行为：**
- ✅ 自动填充供应商信息（基于供应商选择）
- ✅ 自动填充物料信息（基于物料选择）
- ✅ 自动计算询价金额（数量×单价）
- ✅ 自动生成询价单编号（基于编码规则）
- ✅ 自动保存询价单（草稿状态）
- 🤖 **AI智能建议**：
  - 基于历史询价数据，建议询价金额
  - 检测询价合理性，提示异常询价
  - 建议询价有效期和付款方式

**场景2：询价单转采购订单（<2分钟）**
1. **进入"采购管理" → "询价管理" → "询价单列表"**
2. **选择询价单**（供应商已确认的询价单）
3. **点击"转采购订单"按钮**
4. **确认订单信息**（系统自动填充询价单信息）
5. **提交采购订单**（系统自动生成订单编号）

**系统行为：**
- ✅ 自动填充订单信息（基于询价单）
- ✅ 自动生成订单编号（基于编码规则）
- ✅ 自动判断审批流程（基于订单金额）
- ✅ 自动发送订单通知（相关人员）
- 🤖 **AI智能建议**：
  - 检测订单合理性，提示风险
  - 建议订单交期和付款方式

**场景3：跟踪订单状态（<1分钟）**
1. **进入"采购管理" → "订单管理" → "订单列表"**
2. **查看订单状态**（待审批/已审批/已发货/已收货/已完成）
3. **查看订单详情**（订单信息、发货信息、收货信息）
4. **查看订单变更历史**（如有变更）

**系统行为：**
- ✅ 实时更新订单状态（基于收货进度）
- ✅ 自动发送订单状态通知（供应商）
- ✅ 自动生成订单进度报告（每天生成）
- 🤖 **AI智能建议**：
  - 检测订单延期风险，提前预警
  - 建议订单交期调整

**场景4：采购数据分析（<5分钟）**
1. **进入"采购管理" → "数据分析" → "采购报表"**
2. **选择报表类型**（如：采购趋势分析、供应商分析、物料分析）
3. **选择时间范围**（如：本月、本季度、本年）
4. **查看报表数据**（图表、表格）
5. **导出报表**（Excel、PDF）

**系统行为：**
- ✅ 自动生成采购报表（基于订单数据）
- ✅ 自动生成图表（趋势图、柱状图、饼图）
- ✅ 支持报表导出（Excel、PDF）
- 🤖 **AI智能建议**：
  - 分析采购趋势，建议采购策略
  - 识别采购机会，建议重点供应商

**优化点：**
- ⚡ **一键操作**：询价单转订单，一键完成
- ⚡ **智能填充**：自动填充供应商和物料信息，减少输入
- ⚡ **实时跟踪**：订单状态实时更新，无需人工查询
- ⚡ **数据分析**：自动生成报表，无需手工整理

---

### 11.4 仓库角色场景推演与自助式上线向导

#### 11.4.1 仓库角色职责与使用场景

**职责：**
- 库存管理：库存查询、库存预警、库存盘点
- 入库管理：采购入库、生产入库、退货入库
- 出库管理：生产领料、销售出库、退货出库
- 仓库数据分析：库存报表、出入库报表、盘点报表

**使用场景：**
- 日常：入库操作、出库操作、库存查询
- 周期性：库存盘点、库存预警、库存报表
- 异常：库存异常、盘点差异、库存调整

**痛点：**
- 库存数据不准确，需要频繁盘点
- 出入库操作繁琐，需要重复输入
- 库存预警不及时，容易缺料
- 库存数据统计困难，需要手工整理

#### 11.4.2 仓库角色上线准备（自助式向导）

**第一步：仓库基础数据准备（<20分钟）**
1. **进入"仓储管理" → "仓库设置" → "仓库导入"**
2. **下载仓库导入模板**（Excel）
3. **填写仓库数据**：
   - 仓库编码（如：WH001）
   - 仓库名称（如：原材料仓库）
   - 仓库类型（如：原材料仓库、半成品仓库、成品仓库）
   - 库区信息（如：A区、B区）
   - 库位信息（如：A01、A02）
4. **上传Excel文件，系统自动导入**
5. **验证仓库数据**（系统自动验证，<10秒）
6. **查看导入报告**（成功数量、失败数量、错误详情）

**系统行为：**
- ✅ 自动验证仓库数据（格式、完整性、重复性）
- ✅ 自动生成仓库编码（如果未填写）
- ✅ 自动生成库区库位（如果未填写）
- ✅ 自动生成导入报告
- 🤖 **AI智能建议**：
  - 检测仓库数据完整性，提示缺失的关键字段
  - 建议仓库布局优化

**第二步：期初库存导入（<1小时）**
1. **进入"仓储管理" → "库存管理" → "期初库存导入"**
2. **下载期初库存导入模板**（Excel）
3. **填写期初库存数据**（基于快照时间点）：
   - 物料编码（支持部门编码，自动映射）
   - 仓库编码
   - 期初数量、期初金额
   - 批次号（可选）
   - 库位（可选）
4. **上传Excel文件，系统自动导入**
5. **验证期初库存数据**（系统自动验证，<30秒）
6. **查看导入报告**（成功数量、失败数量、错误详情）

**系统行为：**
- ✅ 自动验证期初库存数据（格式、完整性、关联性）
- ✅ 自动识别物料编码（支持部门编码，自动映射到主编码）
- ✅ 自动生成期初库存入库单（标记为"期初库存"）
- ✅ 自动更新库存数量
- ✅ 自动生成导入报告
- 🤖 **AI智能建议**：
  - 检测期初库存数据完整性，提示缺失的关键字段
  - 识别异常库存数据，建议调整
  - 建议库存预警设置

**第三步：库存预警配置（<10分钟）**
1. **进入"仓储管理" → "库存管理" → "库存预警配置"**
2. **选择预警规则模板**（如：标准库存预警规则）
3. **配置预警规则**（可选）：
   - 最低库存预警（如：库存<安全库存时预警）
   - 最高库存预警（如：库存>最大库存时预警）
   - 呆滞库存预警（如：库存>90天未动时预警）
4. **保存预警配置**

**系统行为：**
- ✅ 自动应用预警规则模板（一键应用）
- ✅ 自动计算预警阈值（基于历史数据）
- ✅ 自动发送预警通知（相关人员）
- 🤖 **AI智能建议**：
  - 基于历史数据，建议预警阈值
  - 检测预警规则合理性，提示优化

**验收标准：**
- ✅ 仓库基础数据导入成功（支持universheet在线表格批量导入，实时保存）
- ✅ 期初库存导入成功（支持universheet在线表格批量导入，支持部门编码，实时保存）
- ✅ 库存预警配置成功（支持预警规则模板）

**优化效果：**
- ⚡ **操作步骤减少**：仓库基础数据导入<20分钟，期初库存导入<1小时
- ⚡ **时间缩短**：从手工录入3天减少到<2小时
- ⚡ **学习成本降低**：向导引导，无需专业知识

#### 11.4.3 仓库角色日常使用场景

**场景1：客户来料登记（核心功能，新增，<5分钟）**
1. **进入"仓储管理" → "入库管理" → "客户来料登记"**
2. **扫码登记客户来料**（支持一维码/二维码扫码）：
   - **方式1：扫码登记（推荐，最快）**：
     - 使用扫码枪扫描客户来料的一维码/二维码
     - 系统自动解析条码内容（支持多种条码格式）
     - **条码解析映射**（核心功能，新增）：
       - 系统自动识别条码类型（一维码/二维码）
       - 系统自动解析条码内容（物料编码、数量、批次号、供应商信息等）
       - 系统自动映射到系统物料（基于物料编码或物料名称匹配）
       - 如果条码中包含客户物料编码，系统自动映射到系统物料编码（基于映射规则）
   - **方式2：手动登记**：
     - 选择供应商：客户A（支持搜索、拼音搜索）
     - 选择物料：原材料A（支持搜索、拼音搜索）
     - 输入数量：1000kg
     - 输入批次号：CL-20260115-001（客户批次号）
     - 输入生产日期：2026-01-10
     - 输入有效期：2026-07-10
3. **客户来料条码映射配置**（核心功能，新增）：
   - 进入"仓储管理" → "入库管理" → "客户来料条码映射配置"
   - 点击"新建映射规则"按钮
   - 填写映射规则：
     - 供应商：客户A（选择）
     - 客户物料编码：CL-MAT-001（客户使用的物料编码）
     - 系统物料编码：MAT-001（映射到系统的物料编码）
     - 条码格式：JSON格式（选择：JSON/XML/自定义格式）
     - 条码解析规则（JSON格式示例）：
       ```json
       {
         "material_code": "CL-MAT-001",
         "quantity": "qty",
         "batch_no": "batch",
         "production_date": "prod_date"
       }
       ```
     - 条码字段映射：
       - 物料编码字段：material_code → 映射到系统物料编码
       - 数量字段：qty → 映射到入库数量
       - 批次号字段：batch → 映射到批次号
       - 生产日期字段：prod_date → 映射到生产日期
   - 保存映射规则
4. **客户来料登记记录查询**：
   - 进入"仓储管理" → "入库管理" → "客户来料登记记录"
   - 查看客户来料登记记录（使用高级搜索，支持拼音搜索）
   - 查看条码解析结果（原始条码内容、解析后的字段、映射结果）
   - 导出客户来料登记记录（Excel）

**系统行为：**
- ✅ **客户来料条码解析**（核心功能，新增）：
  - 支持一维码/二维码扫码识别
  - 支持多种条码格式（Code128、QR Code、Data Matrix等）
  - 自动解析条码内容（JSON、XML、自定义格式）
  - 自动识别条码字段（物料编码、数量、批次号、供应商信息等）
- ✅ **客户来料条码映射**（核心功能，新增）：
  - 支持客户物料编码到系统物料编码的映射
  - 支持条码字段到系统字段的映射（物料编码、数量、批次号、生产日期等）
  - 支持多种条码格式配置（JSON、XML、自定义格式）
  - 支持条码解析规则配置（字段映射规则）
  - 自动匹配映射规则（基于供应商和条码格式）
  - 自动映射到系统物料（基于映射规则）
- ✅ **客户来料登记记录**（核心功能，新增）：
  - 记录客户来料信息（供应商、物料、数量、批次号、生产日期、有效期等）
  - 记录条码原始内容（原始条码字符串）
  - 记录条码解析结果（解析后的字段值）
  - 记录映射结果（映射到的系统物料编码）
  - 支持客户来料登记记录查询（高级搜索，拼音搜索）
  - 支持客户来料登记记录导出（Excel）
- ✅ 自动生成客户来料登记单号（基于编码规则）
- ✅ 自动保存客户来料登记记录
- 🤖 **AI智能建议**：
  - 检测条码解析异常，提示错误
  - 检测映射规则匹配度，建议优化映射规则
  - 识别重复来料，建议合并处理

**验收标准：**
- ✅ 客户来料条码扫码识别正常（一维码/二维码）
- ✅ 客户来料条码解析正常（多种条码格式）
- ✅ 客户来料条码映射正常（客户物料编码→系统物料编码）
- ✅ 条码映射规则配置正常（JSON、XML、自定义格式）
- ✅ 客户来料登记记录正常（记录、查询、导出）
- ✅ 客户来料登记记录高级搜索可用（拼音搜索）

**场景2：采购入库（<3分钟，优化：支持客户来料登记关联）**
1. **进入"仓储管理" → "入库管理" → "采购入库"**
2. **选择采购订单**（支持搜索、拼音搜索）
   - **或选择客户来料登记记录**（核心功能，新增）：
     - 如果已登记客户来料，可以选择客户来料登记记录
     - 系统自动填充客户来料信息（物料、数量、批次号等）
3. **确认入库信息**（系统自动填充采购订单信息或客户来料登记信息）：
   - 物料编码、物料名称、规格、数量
   - 仓库编码、库位（可选）
   - 批次号（可选，如果客户来料已登记批次号，自动填充）
4. **扫码入库**（支持扫码枪，扫描物料条码）
   - **如果客户来料已登记条码，自动识别条码**（核心功能，新增）：
     - 扫描客户来料条码（一维码/二维码）
     - 系统自动匹配客户来料登记记录
     - 系统自动填充入库信息（物料、数量、批次号等）
5. **确认入库数量**（系统自动填充计划数量，可修改）
6. **提交入库单**（系统自动生成入库单编号，自动更新库存）

**系统行为：**
- ✅ 自动填充入库信息（基于采购订单或客户来料登记记录）
- ✅ **客户来料登记关联**（核心功能，新增）：
  - 支持从客户来料登记记录创建入库单
  - 自动关联客户来料登记记录
  - 自动填充客户来料信息（物料、数量、批次号等）
- ✅ **客户来料条码自动识别**（核心功能，新增）：
  - 扫描客户来料条码时，自动匹配客户来料登记记录
  - 自动填充入库信息（物料、数量、批次号等）
- ✅ 自动生成入库单编号（基于编码规则）
- ✅ 自动更新库存数量（入库后自动更新）
- ✅ 自动更新采购订单状态（入库后自动更新）
- ✅ 自动更新客户来料登记记录状态（已入库）
- ✅ 自动发送入库通知（相关人员）
- 🤖 **AI智能建议**：
  - 检测入库数量合理性，提示异常
  - 建议库位分配

**场景2：生产领料（<5分钟）**
1. **进入"仓储管理" → "出库管理" → "生产领料"**
2. **选择工单**（支持搜索、拼音搜索）
3. **确认领料信息**（系统自动填充工单BOM信息）：
   - 物料编码、物料名称、规格、计划数量
   - 仓库编码、库位（可选）
4. **扫码领料**（支持扫码枪，扫描物料条码）
5. **确认领料数量**（系统自动填充计划数量，可修改）
6. **提交领料单**（系统自动生成领料单编号，自动更新库存）

**系统行为：**
- ✅ 自动填充领料信息（基于工单BOM）
- ✅ 自动生成领料单编号（基于编码规则）
- ✅ 自动更新库存数量（领料后自动更新）
- ✅ 自动更新工单领料状态（领料后自动更新）
- ✅ 自动发送领料通知（相关人员）
- 🤖 **AI智能建议**：
  - 检测领料数量合理性，提示异常
  - 检测库存不足，提前预警
  - 建议库位分配

**场景3：库存查询（<1分钟）**
1. **进入"仓储管理" → "库存管理" → "库存查询"**
2. **选择查询条件**（物料编码、物料名称、仓库编码）
3. **查看库存信息**（当前库存、可用库存、在途库存）
4. **查看库存明细**（批次、库位、入库日期）
5. **导出库存报表**（Excel、PDF）

**系统行为：**
- ✅ 实时查询库存数据（基于最新库存数据）
- ✅ 支持多条件查询（物料、仓库、批次等）
- ✅ 支持库存明细查询（批次、库位、入库日期）
- ✅ 支持库存报表导出（Excel、PDF）
- 🤖 **AI智能建议**：
  - 检测库存异常，提示预警
  - 建议库存优化

**场景4：库存盘点（<30分钟）**
1. **进入"仓储管理" → "库存管理" → "库存盘点"**
2. **创建盘点单**（选择仓库、库区、库位）
3. **下载盘点表**（Excel，包含物料信息、账面数量）
4. **现场盘点**（填写实际数量）
5. **上传盘点表**（Excel）
6. **系统自动计算盘点差异**（实际数量-账面数量）
7. **确认盘点结果**（系统自动生成盘点调整单）

**系统行为：**
- ✅ 自动生成盘点表（基于库存数据）
- ✅ 自动计算盘点差异（实际数量-账面数量）
- ✅ 自动生成盘点调整单（盘点差异）
- ✅ 自动更新库存数量（盘点调整后自动更新）
- ✅ 自动生成盘点报告（盘点结果、差异分析）
- 🤖 **AI智能建议**：
  - 检测盘点差异异常，提示风险
  - 建议盘点频率优化

**优化点：**
- ⚡ **一键操作**：采购入库、生产领料，一键完成
- ⚡ **智能填充**：自动填充订单和工单信息，减少输入
- ⚡ **扫码操作**：支持扫码枪，提高操作效率
- ⚡ **实时更新**：库存实时更新，无需人工查询
- ⚡ **数据分析**：自动生成报表，无需手工整理

---

### 11.5 技术研发角色场景推演与自助式上线向导

#### 11.5.1 技术研发角色职责与使用场景

**职责：**
- 产品设计：产品信息维护、产品分类、产品版本管理
- BOM管理：BOM创建、BOM版本管理、BOM变更
- 工艺路线设计：工艺路线创建、工艺路线版本管理、工艺路线变更
- SOP设计：SOP创建、SOP版本管理、SOP变更

**使用场景：**
- 日常：创建产品、创建BOM、创建工艺路线、创建SOP
- 周期性：产品版本管理、BOM版本管理、工艺路线版本管理
- 异常：产品变更、BOM变更、工艺路线变更

**痛点：**
- 产品数据分散，难以统一管理
- BOM制作繁琐，需要重复输入
- 工艺路线设计复杂，需要专业知识
- 版本管理困难，容易混乱

#### 11.5.2 技术研发角色上线准备（自助式向导）

**第一步：产品数据准备（<1小时）**
1. **进入"主数据管理" → "产品管理" → "产品导入"**
2. **下载产品导入模板**（Excel）
3. **填写产品数据**：
   - 产品编码（如：FIN001）
   - 产品名称（如：产品A）
   - 产品规格、单位、产品类型
   - 产品分类（如：成品、半成品）
4. **上传Excel文件，系统自动导入**
5. **验证产品数据**（系统自动验证，<30秒）
6. **查看导入报告**（成功数量、失败数量、错误详情）

**系统行为：**
- ✅ 自动验证产品数据（格式、完整性、重复性）
- ✅ 自动生成产品编码（如果未填写）
- ✅ 自动分类产品（基于产品分类字段）
- ✅ 自动生成导入报告
- 🤖 **AI智能建议**：
  - 检测产品数据完整性，提示缺失的关键字段
  - 识别重复产品，建议合并
  - 建议产品分类

**第二步：BOM数据准备（<2小时）**
1. **进入"主数据管理" → "产品管理" → "BOM导入"**
2. **下载BOM导入模板**（Excel）
3. **填写BOM数据**：
   - 产品编码（父件）
   - 物料编码（子件，支持部门编码，自动映射）
   - 物料数量、单位
   - BOM层级（系统自动识别）
4. **上传Excel文件，系统自动导入**
5. **验证BOM数据**（系统自动验证，<1分钟）
6. **查看导入报告**（成功数量、失败数量、错误详情）

**系统行为：**
- ✅ 自动验证BOM数据（格式、完整性、关联性）
- ✅ 自动识别物料编码（支持部门编码，自动映射到主编码）
- ✅ 自动识别BOM层级（基于父子件关系）
- ✅ 自动生成BOM版本（初始版本V1.0）
- ✅ 自动生成导入报告
- 🤖 **AI智能建议**：
  - 检测BOM数据完整性，提示缺失的关键字段
  - 检测BOM结构合理性，提示循环依赖
  - 建议BOM层级优化

**第三步：工艺路线数据准备（<1小时）**
1. **进入"主数据管理" → "工艺管理" → "工艺路线导入"**
2. **下载工艺路线导入模板**（Excel）
3. **填写工艺路线数据**：
   - 产品编码
   - 工序编码、工序名称、工序顺序
   - 标准工时、准备时间
   - SOP编码（可选）
4. **上传Excel文件，系统自动导入**
5. **验证工艺路线数据**（系统自动验证，<30秒）
6. **查看导入报告**（成功数量、失败数量、错误详情）

**系统行为：**
- ✅ 自动验证工艺路线数据（格式、完整性、关联性）
- ✅ 自动识别产品编码和工序编码
- ✅ 自动生成工艺路线版本（初始版本V1.0）
- ✅ 自动关联SOP（如果填写了SOP编码）
- ✅ 自动生成导入报告
- 🤖 **AI智能建议**：
  - 检测工艺路线数据完整性，提示缺失的关键字段
  - 检测工艺路线合理性，提示工序顺序优化
  - 建议标准工时设置

**验收标准：**
- ✅ 产品数据导入成功（支持universheet在线表格批量导入，实时保存）
- ✅ BOM数据导入成功（支持universheet在线表格批量导入，支持部门编码，实时保存）
- ✅ 工艺路线数据导入成功（支持universheet在线表格批量导入，实时保存）

**优化效果：**
- ⚡ **操作步骤减少**：产品数据导入<1小时，BOM数据导入<2小时，工艺路线数据导入<1小时
- ⚡ **时间缩短**：从手工录入1周减少到<4小时
- ⚡ **学习成本降低**：向导引导，无需专业知识

#### 11.5.3 技术研发角色日常使用场景

**场景1：创建BOM（<10分钟）**
1. **进入"主数据管理" → "产品管理" → "BOM管理" → "新建BOM"**
2. **选择产品**（支持搜索、拼音搜索）
3. **添加子件**（支持批量添加）：
   - 输入物料编码或物料名称（支持搜索）
   - 输入数量、单位（系统自动填充物料规格）
   - 系统自动识别BOM层级
4. **保存BOM**（系统自动生成BOM版本V1.0）
5. **查看BOM结构**（树形结构，可视化展示）

**系统行为：**
- ✅ 自动填充产品信息（基于产品选择）
- ✅ 自动填充物料信息（基于物料选择）
- ✅ 自动识别BOM层级（基于父子件关系）
- ✅ 自动生成BOM版本（初始版本V1.0）
- ✅ 自动保存BOM（草稿状态）
- 🤖 **AI智能建议**：
  - 检测BOM结构合理性，提示循环依赖
  - 建议BOM层级优化
  - 建议物料数量合理性

**场景2：创建工艺路线（<15分钟）**
1. **进入"主数据管理" → "工艺管理" → "工艺路线管理" → "新建工艺路线"**
2. **选择产品**（支持搜索、拼音搜索）
3. **添加工序**（支持拖拽排序）：
   - 选择工序（从工序库中选择）
   - 设置工序顺序（拖拽排序）
   - 设置标准工时、准备时间
   - 关联SOP（可选）
4. **保存工艺路线**（系统自动生成工艺路线版本V1.0）
5. **查看工艺路线**（流程图，可视化展示）

**系统行为：**
- ✅ 自动填充产品信息（基于产品选择）
- ✅ 自动填充工序信息（基于工序选择）
- ✅ 自动生成工艺路线版本（初始版本V1.0）
- ✅ 自动关联SOP（如果选择了SOP）
- ✅ 自动保存工艺路线（草稿状态）
- 🤖 **AI智能建议**：
  - 检测工艺路线合理性，提示工序顺序优化
  - 建议标准工时设置
  - 建议并行工序

**场景3：BOM版本管理（<5分钟）**
1. **进入"主数据管理" → "产品管理" → "BOM管理" → "BOM版本管理"**
2. **选择BOM**（支持搜索、拼音搜索）
3. **查看BOM版本列表**（V1.0、V2.0、V3.0）
4. **创建新版本**（基于当前版本，复制后修改）
5. **版本对比**（对比不同版本的差异）
6. **版本审批**（提交审批，审批通过后生效）

**系统行为：**
- ✅ 自动生成BOM版本（基于版本规则）
- ✅ 自动版本对比（对比不同版本的差异）
- ✅ 自动版本审批（提交审批流程）
- ✅ 自动版本生效（审批通过后自动生效）
- 🤖 **AI智能建议**：
  - 检测版本变更合理性，提示风险
  - 建议版本管理策略

**优化点：**
- ⚡ **一键操作**：BOM创建、工艺路线创建，一键完成
- ⚡ **智能填充**：自动填充产品和物料信息，减少输入
- ⚡ **可视化设计**：BOM树形结构、工艺路线流程图，直观易懂
- ⚡ **版本管理**：自动版本管理，避免混乱

---

### 11.6 生产计划角色场景推演与自助式上线向导

#### 11.6.1 生产计划角色职责与使用场景

**职责：**
- 生产计划：销售预测、生产计划、计划调整
- MRP运算：物料需求计划、采购需求计划
- 排产管理：排产计划、排产调整、排产跟踪
- 计划数据分析：计划达成率、物料齐套率、交期达成率

**使用场景：**
- 日常：MRP运算、排产计划、计划调整
- 周期性：销售预测、生产计划、计划分析
- 异常：计划变更、物料缺料、交期延期

**痛点：**
- MRP运算复杂，需要专业知识
- 排产计划繁琐，需要手工计算
- 计划调整困难，需要重新计算
- 计划数据分析困难，需要手工整理

#### 11.6.2 生产计划角色上线准备（自助式向导）

**第一步：MRP参数配置（<30分钟）**
1. **进入"计划管理" → "MRP配置" → "MRP参数配置"**
2. **选择MRP参数模板**（如：标准MRP参数模板）
3. **配置MRP参数**（可选）：
   - 安全库存系数（默认：1.2）
   - 采购提前期（默认：7天）
   - 生产提前期（默认：3天）
   - 批量规则（默认：按需）
4. **保存MRP参数配置**

**系统行为：**
- ✅ 自动应用MRP参数模板（一键应用）
- ✅ 自动计算MRP参数（基于历史数据）
- ✅ 自动验证MRP参数（参数合理性）
- 🤖 **AI智能建议**：
  - 基于历史数据，建议MRP参数
  - 检测MRP参数合理性，提示优化

**第二步：排产规则配置（<20分钟）**
1. **进入"计划管理" → "排产管理" → "排产规则配置"**
2. **选择排产规则模板**（如：标准排产规则模板）
3. **配置排产规则**（可选）：
   - 优先级规则（默认：按交期）
   - 产能规则（默认：按工作中心产能）
   - 物料齐套规则（默认：物料齐套后排产）
4. **保存排产规则配置**

**系统行为：**
- ✅ 自动应用排产规则模板（一键应用）
- ✅ 自动计算排产规则（基于历史数据）
- ✅ 自动验证排产规则（规则合理性）
- 🤖 **AI智能建议**：
  - 基于历史数据，建议排产规则
  - 检测排产规则合理性，提示优化

**验收标准：**
- ✅ MRP参数配置成功（支持MRP参数模板）
- ✅ 排产规则配置成功（支持排产规则模板）

**优化效果：**
- ⚡ **操作步骤减少**：MRP参数配置<30分钟，排产规则配置<20分钟
- ⚡ **时间缩短**：从手工配置1天减少到<1小时
- ⚡ **学习成本降低**：向导引导，无需专业知识

#### 11.6.3 生产计划角色日常使用场景

**场景1：MRP运算（<10分钟）**
1. **进入"计划管理" → "MRP运算" → "新建MRP运算"**
2. **选择运算范围**（如：全部产品、指定产品）
3. **选择运算时间范围**（如：未来30天）
4. **点击"开始运算"按钮**
5. **查看运算结果**（物料需求计划、采购需求计划）
6. **一键生成工单和采购单**（基于运算结果）

**系统行为：**
- ✅ 自动MRP运算（基于销售预测、库存、BOM）
- ✅ 自动生成物料需求计划（基于BOM展开）
- ✅ 自动生成采购需求计划（基于物料需求、库存、安全库存）
- ✅ 自动生成工单和采购单（一键生成）
- ✅ 自动生成MRP运算报告（运算结果、异常提示）
- 🤖 **AI智能建议**：
  - 检测物料缺料风险，提前预警
  - 建议采购计划优化
  - 建议生产计划调整

**场景2：排产计划（<15分钟）**
1. **进入"计划管理" → "排产管理" → "排产计划"**
2. **选择排产范围**（如：全部工单、指定工单）
3. **选择排产时间范围**（如：未来7天）
4. **点击"开始排产"按钮**
5. **查看排产结果**（排产甘特图、排产明细）
6. **调整排产计划**（拖拽调整，系统自动重新计算）

**系统行为：**
- ✅ 自动排产运算（基于工单、工艺路线、工作中心产能）
- ✅ 自动生成排产甘特图（可视化展示）
- ✅ 自动检测排产冲突（产能冲突、物料冲突）
- ✅ 自动生成排产报告（排产结果、冲突提示）
- ✅ 支持排产调整（拖拽调整，自动重新计算）
- 🤖 **AI智能建议**：
  - 检测排产冲突，建议调整
  - 建议排产优化
  - 建议产能调整

**场景3：计划跟踪（<5分钟）**
1. **进入"计划管理" → "计划跟踪" → "计划跟踪"**
2. **选择跟踪范围**（如：全部计划、指定计划）
3. **查看计划执行情况**（计划达成率、物料齐套率、交期达成率）
4. **查看计划异常**（延期计划、缺料计划）
5. **调整计划**（基于异常情况，调整计划）

**系统行为：**
- ✅ 自动跟踪计划执行情况（基于工单进度）
- ✅ 自动计算计划达成率（计划完成数量/计划总数量）
- ✅ 自动计算物料齐套率（物料齐套数量/物料总数量）
- ✅ 自动计算交期达成率（按时完成数量/总数量）
- ✅ 自动检测计划异常（延期、缺料）
- ✅ 自动生成计划跟踪报告（执行情况、异常提示）
- 🤖 **AI智能建议**：
  - 检测计划异常，建议调整
  - 建议计划优化
  - 建议资源调整

**优化点：**
- ⚡ **一键操作**：MRP运算、排产计划，一键完成
- ⚡ **智能计算**：自动MRP运算、自动排产，无需手工计算
- ⚡ **可视化展示**：排产甘特图，直观易懂
- ⚡ **实时跟踪**：计划执行情况实时跟踪，无需人工查询

---

### 11.7 班组长角色场景推演与自助式上线向导

#### 11.7.1 班组长角色职责与使用场景

**职责：**
- 工单管理：工单接收、工单下达、工单跟踪
- 生产进度跟踪：生产进度查询、生产进度更新
- 人员安排：人员分配、人员调度
- 生产数据分析：生产报表、生产效率分析

**使用场景：**
- 日常：工单下达、生产进度跟踪、人员安排
- 周期性：生产报表、生产效率分析
- 异常：生产异常、人员缺勤、设备故障

**痛点：**
- 工单管理繁琐，需要重复输入
- 生产进度不透明，无法及时跟踪
- 人员安排困难，需要手工计算
- 生产数据统计困难，需要手工整理

#### 11.7.2 班组长角色上线准备（自助式向导）

**第一步：工单流程配置（<15分钟）**
1. **进入"生产管理" → "工单管理" → "工单流程配置"**
2. **选择工单流程模板**（如：标准工单流程模板）
3. **配置工单流程**（可选）：
   - 工单创建 → 工单审批 → 工单下达 → 生产执行 → 工单完成
   - 审批规则（默认：无需审批）
   - 下达规则（默认：自动下达）
4. **保存工单流程配置**

**系统行为：**
- ✅ 自动应用工单流程模板（一键应用）
- ✅ 自动判断工单流程（基于工单类型）
- ✅ 自动发送工单通知（相关人员）
- 🤖 **AI智能建议**：
  - 基于历史数据，建议工单流程
  - 检测工单流程合理性，提示优化

**验收标准：**
- ✅ 工单流程配置成功（支持工单流程模板）

**优化效果：**
- ⚡ **操作步骤减少**：工单流程配置<15分钟
- ⚡ **时间缩短**：从手工配置30分钟减少到<15分钟
- ⚡ **学习成本降低**：向导引导，无需专业知识

#### 11.7.3 班组长角色日常使用场景

**场景1：工单下达（<5分钟）**
1. **进入"生产管理" → "工单管理" → "工单列表"**
2. **选择工单**（支持搜索、拼音搜索）
3. **查看工单信息**（产品信息、工艺路线、BOM信息）
4. **批量下达工单**（选择多个工单，一键下达）
5. **确认下达**（系统自动生成工单工序，自动关联SOP）

**系统行为：**
- ✅ 自动填充工单信息（基于生产计划）
- ✅ 自动生成工单工序（基于工艺路线）
- ✅ 自动关联SOP（基于工艺路线）
- ✅ 自动发送工单通知（生产人员）
- ✅ 自动更新工单状态（下达后自动更新）
- 🤖 **AI智能建议**：
  - 检测工单合理性，提示风险
  - 建议工单下达时间
  - 建议人员安排

**场景2：生产进度跟踪（<3分钟）**
1. **进入"生产管理" → "生产跟踪" → "生产进度"**
2. **选择工单**（支持搜索、拼音搜索）
3. **查看生产进度**（工单进度、工序进度、报工情况）
4. **查看生产异常**（延期工单、缺料工单）
5. **调整生产计划**（基于异常情况，调整计划）

**系统行为：**
- ✅ 实时更新生产进度（基于报工数据）
- ✅ 自动计算工单进度（已完成数量/计划数量）
- ✅ 自动计算工序进度（已完成工序/总工序）
- ✅ 自动检测生产异常（延期、缺料）
- ✅ 自动生成生产进度报告（每天生成）
- 🤖 **AI智能建议**：
  - 检测生产异常，建议调整
  - 建议生产计划优化
  - 建议资源调整

**场景3：人员安排（<10分钟）**
1. **进入"生产管理" → "人员管理" → "人员安排"**
2. **选择工单**（支持搜索、拼音搜索）
3. **查看人员信息**（人员列表、人员技能、人员状态）
4. **分配人员**（选择人员，分配到工单或工序）
5. **确认分配**（系统自动更新人员安排）

**系统行为：**
- ✅ 自动显示人员信息（人员列表、人员技能、人员状态）
- ✅ 自动检测人员冲突（人员已分配）
- ✅ 自动更新人员安排（分配后自动更新）
- ✅ 自动发送人员通知（相关人员）
- 🤖 **AI智能建议**：
  - 基于人员技能，建议人员分配
  - 检测人员冲突，建议调整
  - 建议人员调度优化

**优化点：**
- ⚡ **一键操作**：工单下达、批量下达，一键完成
- ⚡ **智能填充**：自动填充工单信息，减少输入
- ⚡ **实时跟踪**：生产进度实时更新，无需人工查询
- ⚡ **数据分析**：自动生成报表，无需手工整理

---

### 11.8 生产人员角色场景推演与自助式上线向导

#### 11.8.1 生产人员角色职责与使用场景

**职责：**
- 现场报工：报工操作、报工查询
- SOP查看：SOP查看、SOP指导
- 图纸查看：图纸查看、图纸下载
- 加工程序查看：加工程序查看、加工程序下载

**使用场景：**
- 日常：现场报工、SOP查看、图纸查看
- 周期性：报工查询、生产记录查询
- 异常：报工异常、生产异常

**痛点：**
- 报工操作繁琐，需要重复输入
- SOP查看困难，需要手工查找
- 图纸查看困难，需要手工查找
- 移动端操作不便，需要PC端操作

#### 11.8.2 生产人员角色上线准备（自助式向导）

**第一步：移动端配置（<10分钟）**
1. **下载移动端APP**（支持iOS、Android）
2. **登录移动端**（手机号+密码）
3. **配置移动端设置**（可选）：
   - 消息推送（默认：开启）
   - 扫码功能（默认：开启）
   - 离线模式（默认：关闭）
4. **完成移动端配置**

**系统行为：**
- ✅ 自动配置移动端设置（一键应用）
- ✅ 自动同步数据（登录后自动同步）
- ✅ 自动推送消息（工单通知、报工提醒）
- 🤖 **AI智能建议**：
  - 建议移动端设置优化
  - 建议移动端使用技巧

**第二步：工位机触屏模式配置（<5分钟）**
1. **进入工位机触屏模式**（自动识别工位机设备）
2. **配置触屏模式设置**（可选）：
   - 触屏手势（默认：开启）
   - 触屏缩放（默认：开启）
   - 触屏旋转（默认：开启）
3. **完成触屏模式配置**

**系统行为：**
- ✅ 自动识别工位机设备（自动切换到触屏模式）
- ✅ 自动配置触屏模式设置（一键应用）
- ✅ 自动优化触屏界面（大按钮、大字体、全屏模式）
- 🤖 **AI智能建议**：
  - 建议触屏模式设置优化
  - 建议触屏使用技巧

**验收标准：**
- ✅ 移动端配置成功（支持iOS、Android）
- ✅ 工位机触屏模式配置成功（自动识别工位机设备）

**优化效果：**
- ⚡ **操作步骤减少**：移动端配置<10分钟，工位机触屏模式配置<5分钟
- ⚡ **时间缩短**：从手工配置30分钟减少到<15分钟
- ⚡ **学习成本降低**：向导引导，无需专业知识

#### 11.8.3 生产人员角色日常使用场景

**场景1：现场报工（<30秒，快速报工）**
1. **打开移动端APP或工位机触屏模式**
2. **扫码报工**（扫描工单二维码）
3. **系统自动填充**（工单号、产品、当前工序、计划数量）
4. **输入完成数量**（默认等于计划数量，可修改）
5. **输入合格数量**（默认等于完成数量，可修改）
6. **提交报工**（系统自动保存，自动更新工单进度）

**系统行为：**
- ✅ 自动识别工单信息（基于扫码）
- ✅ 自动填充报工信息（工单号、产品、当前工序、计划数量）
- ✅ 自动切换下一工序（报工完成后自动切换）
- ✅ 自动更新工单进度（报工后自动更新）
- ✅ 自动发送报工通知（相关人员）
- 🤖 **AI智能建议**：
  - 检测报工数量合理性，提示异常
  - 建议报工时间优化

**场景2：带参数报工（<1分钟，带参数SOP）**
1. **打开移动端APP或工位机触屏模式**
2. **扫码报工**（扫描工单二维码）
3. **系统自动填充**（工单号、产品、当前工序、计划数量）
4. **系统自动显示参数收集表单**（基于SOP配置）：
   - 完成数量（必填）
   - 合格数量（必填）
   - SOP指定参数（如：扭矩、外观检查等）
5. **填写所有必填参数**（触屏优化输入）
6. **提交报工**（系统自动保存，自动更新工单进度）

**系统行为：**
- ✅ 自动识别工单信息（基于扫码）
- ✅ 自动填充报工信息（工单号、产品、当前工序、计划数量）
- ✅ 自动显示参数收集表单（基于SOP的form_config）
- ✅ 自动验证参数（基于SOP的验证规则）
- ✅ 自动切换下一工序（报工完成后自动切换）
- ✅ 自动更新工单进度（报工后自动更新）
- 🤖 **AI智能建议**：
  - 检测参数合理性，提示异常
  - 建议参数优化

**场景3：SOP查看（<1分钟）**
1. **打开移动端APP或工位机触屏模式**
2. **扫码查看SOP**（扫描工单二维码）
3. **系统自动显示SOP**（基于当前工序）
4. **查看SOP内容**（SOP步骤、SOP图片、SOP视频）
5. **触屏操作**（滑动查看、缩放查看、翻页查看）

**系统行为：**
- ✅ 自动识别工单信息（基于扫码）
- ✅ 自动显示SOP（基于当前工序）
- ✅ 自动优化SOP显示（触屏优化，全屏显示）
- ✅ 支持触屏操作（滑动、缩放、翻页）
- 🤖 **AI智能建议**：
  - 建议SOP使用技巧
  - 建议SOP优化

**场景4：图纸查看（<1分钟）**
1. **打开移动端APP或工位机触屏模式**
2. **扫码查看图纸**（扫描工单二维码）
3. **系统自动显示图纸**（基于产品）
4. **查看图纸内容**（图纸图片、图纸PDF）
5. **触屏操作**（缩放查看、拖拽查看、旋转查看）

**系统行为：**
- ✅ 自动识别工单信息（基于扫码）
- ✅ 自动显示图纸（基于产品）
- ✅ 自动优化图纸显示（触屏优化，全屏显示）
- ✅ 支持触屏操作（缩放、拖拽、旋转）
- 🤖 **AI智能建议**：
  - 建议图纸使用技巧
  - 建议图纸优化

**优化点：**
- ⚡ **一键操作**：扫码报工，一键完成
- ⚡ **智能填充**：自动填充工单信息，减少输入
- ⚡ **触屏优化**：触屏界面优化，易于操作
- ⚡ **实时更新**：报工实时更新，无需人工查询

---

### 11.9 质量组角色场景推演与自助式上线向导

#### 11.9.1 质量组角色职责与使用场景

**职责：**
- 质量检验：来料检验、过程检验、成品检验
- 不合格品处理：不合格品记录、不合格品处理、不合格品分析
- 质量数据分析：质量报表、质量趋势分析、不合格品分析
- 质量改进：质量问题跟踪、质量改进措施、质量改进效果

**使用场景：**
- 日常：质量检验、不合格品处理、质量问题跟踪
- 周期性：质量报表、质量趋势分析、质量改进
- 异常：质量异常、批量不合格、质量事故

**痛点：**
- 质量检验繁琐，需要重复输入
- 不合格品处理困难，需要手工记录
- 质量数据统计困难，需要手工整理
- 质量问题跟踪困难，需要手工管理

#### 11.9.2 质量组角色上线准备（自助式向导）

**第一步：检验标准配置（<30分钟）**
1. **进入"质量管理" → "检验标准" → "检验标准配置"**
2. **选择检验标准模板**（如：标准检验标准模板）
3. **配置检验标准**（可选）：
   - 来料检验标准（如：外观、尺寸、性能）
   - 过程检验标准（如：关键工序检验）
   - 成品检验标准（如：外观、尺寸、性能、包装）
4. **保存检验标准配置**

**系统行为：**
- ✅ 自动应用检验标准模板（一键应用）
- ✅ 自动生成检验标准（基于行业标准）
- ✅ 自动验证检验标准（标准合理性）
- 🤖 **AI智能建议**：
  - 基于行业标准，建议检验标准
  - 检测检验标准合理性，提示优化

**第二步：不合格品处理流程配置（<20分钟）**
1. **进入"质量管理" → "不合格品管理" → "处理流程配置"**
2. **选择处理流程模板**（如：标准不合格品处理流程模板）
3. **配置处理流程**（可选）：
   - 不合格品记录 → 不合格品评审 → 不合格品处理 → 不合格品跟踪
   - 处理方式（如：返工、返修、报废、让步接收）
   - 审批规则（默认：无需审批）
4. **保存处理流程配置**

**系统行为：**
- ✅ 自动应用处理流程模板（一键应用）
- ✅ 自动判断处理流程（基于不合格品类型）
- ✅ 自动发送处理通知（相关人员）
- 🤖 **AI智能建议**：
  - 基于历史数据，建议处理流程
  - 检测处理流程合理性，提示优化

**验收标准：**
- ✅ 检验标准配置成功（支持检验标准模板）
- ✅ 不合格品处理流程配置成功（支持处理流程模板）

**优化效果：**
- ⚡ **操作步骤减少**：检验标准配置<30分钟，不合格品处理流程配置<20分钟
- ⚡ **时间缩短**：从手工配置1天减少到<1小时
- ⚡ **学习成本降低**：向导引导，无需专业知识

#### 11.9.3 质量组角色日常使用场景

**场景1：来料检验（<5分钟）**
1. **进入"质量管理" → "质量检验" → "来料检验"**
2. **选择采购订单**（支持搜索、拼音搜索）
3. **确认检验信息**（系统自动填充采购订单信息）：
   - 物料编码、物料名称、规格、数量
   - 供应商信息
   - 检验标准（系统自动关联）
4. **填写检验结果**：
   - 检验数量、合格数量、不合格数量
   - 检验项目（外观、尺寸、性能等）
   - 检验结论（合格/不合格）
5. **提交检验单**（系统自动生成检验单编号，自动更新采购订单状态）

**系统行为：**
- ✅ 自动填充检验信息（基于采购订单）
- ✅ 自动关联检验标准（基于物料）
- ✅ 自动生成检验单编号（基于编码规则）
- ✅ 自动更新采购订单状态（检验后自动更新）
- ✅ 自动发送检验通知（相关人员）
- 🤖 **AI智能建议**：
  - 检测检验结果合理性，提示异常
  - 建议检验标准优化

**场景2：过程检验（<3分钟）**
1. **进入"质量管理" → "质量检验" → "过程检验"**
2. **选择工单**（支持搜索、拼音搜索）
3. **确认检验信息**（系统自动填充工单信息）：
   - 工单号、产品、当前工序
   - 检验标准（系统自动关联）
4. **填写检验结果**：
   - 检验数量、合格数量、不合格数量
   - 检验项目（关键工序检验）
   - 检验结论（合格/不合格）
5. **提交检验单**（系统自动生成检验单编号，自动更新工单状态）

**系统行为：**
- ✅ 自动填充检验信息（基于工单）
- ✅ 自动关联检验标准（基于工序）
- ✅ 自动生成检验单编号（基于编码规则）
- ✅ 自动更新工单状态（检验后自动更新）
- ✅ 自动发送检验通知（相关人员）
- 🤖 **AI智能建议**：
  - 检测检验结果合理性，提示异常
  - 建议检验标准优化

**场景3：不合格品处理（<10分钟）**
1. **进入"质量管理" → "不合格品管理" → "不合格品处理"**
2. **选择不合格品**（支持搜索、拼音搜索）
3. **填写处理信息**：
   - 处理方式（返工/返修/报废/让步接收）
   - 处理原因、处理措施
   - 处理责任人、处理时间
4. **提交处理单**（系统自动生成处理单编号）
5. **跟踪处理结果**（系统自动跟踪处理进度）

**系统行为：**
- ✅ 自动填充处理信息（基于不合格品）
- ✅ 自动生成处理单编号（基于编码规则）
- ✅ 自动跟踪处理进度（处理后自动跟踪）
- ✅ 自动发送处理通知（相关人员）
- ✅ 自动生成处理报告（处理结果、处理效果）
- 🤖 **AI智能建议**：
  - 检测处理方式合理性，提示风险
  - 建议处理措施优化

**场景4：质量数据分析（<5分钟）**
1. **进入"质量管理" → "数据分析" → "质量报表"**
2. **选择报表类型**（如：质量趋势分析、不合格品分析、供应商质量分析）
3. **选择时间范围**（如：本月、本季度、本年）
4. **查看报表数据**（图表、表格）
5. **导出报表**（Excel、PDF）

**系统行为：**
- ✅ 自动生成质量报表（基于检验数据）
- ✅ 自动生成图表（趋势图、柱状图、饼图）
- ✅ 支持报表导出（Excel、PDF）
- 🤖 **AI智能建议**：
  - 分析质量趋势，建议质量改进措施
  - 识别质量问题，建议重点改进

**优化点：**
- ⚡ **一键操作**：质量检验、不合格品处理，一键完成
- ⚡ **智能填充**：自动填充检验信息，减少输入
- ⚡ **实时跟踪**：不合格品处理实时跟踪，无需人工查询
- ⚡ **数据分析**：自动生成报表，无需手工整理

---

### 11.10 设备组角色场景推演与自助式上线向导

#### 11.10.1 设备组角色职责与使用场景

**职责：**
- 设备管理：设备信息维护、设备分类、设备状态监控
- 设备维护：维护计划、维护记录、维护分析
- 设备故障处理：故障记录、故障处理、故障分析
- 设备数据分析：设备报表、设备利用率分析、设备故障率分析

**使用场景：**
- 日常：设备状态监控、设备维护、设备故障处理
- 周期性：维护计划、设备报表、设备分析
- 异常：设备故障、设备停机、设备异常

**痛点：**
- 设备信息分散，难以统一管理
- 维护计划繁琐，需要手工制定
- 设备状态不透明，无法及时监控
- 设备数据统计困难，需要手工整理

#### 11.10.2 设备组角色上线准备（自助式向导）

**第一步：设备数据准备（<1小时）**
1. **进入"设备管理" → "设备管理" → "设备导入"**
2. **打开设备导入universheet在线表格**（系统自动创建模板）
3. **在universheet中填写设备数据**（实时保存）：
   - 设备编码（如：EQP001）
   - 设备名称（如：注塑机1）
   - 设备类型（如：注塑机、组装机、包装机）
   - 设备规格、制造商、购买日期
   - 所属车间、工作中心
4. **点击"导入"按钮**（系统自动读取universheet数据并导入）
5. **验证设备数据**（系统自动验证，<30秒）
6. **查看导入报告**（成功数量、失败数量、错误详情）

**系统行为：**
- ✅ 自动验证设备数据（格式、完整性、重复性）
- ✅ 自动生成设备编码（如果未填写）
- ✅ 自动分类设备（基于设备类型）
- ✅ 自动生成导入报告
- 🤖 **AI智能建议**：
  - 检测设备数据完整性，提示缺失的关键字段
  - 识别重复设备，建议合并
  - 建议设备分类

**第二步：维护计划配置（<30分钟）**
1. **进入"设备管理" → "维护管理" → "维护计划配置"**
2. **选择维护计划模板**（如：标准维护计划模板）
3. **配置维护计划**（可选）：
   - 日常维护（如：每天清洁、每周检查）
   - 定期维护（如：每月保养、每季度大修）
   - 预防性维护（如：按运行时间、按运行次数）
4. **保存维护计划配置**

**系统行为：**
- ✅ 自动应用维护计划模板（一键应用）
- ✅ 自动生成维护计划（基于设备类型）
- ✅ 自动提醒维护任务（基于维护计划）
- 🤖 **AI智能建议**：
  - 基于设备类型，建议维护计划
  - 检测维护计划合理性，提示优化

**第三步：设备状态监控配置（<20分钟）**
1. **进入"设备管理" → "设备监控" → "监控配置"**
2. **选择监控模板**（如：标准设备监控模板）
3. **配置监控规则**（可选）：
   - 设备状态监控（如：运行、停机、故障）
   - 设备参数监控（如：温度、压力、速度）
   - 设备报警规则（如：参数超限报警、故障报警）
4. **保存监控配置**

**系统行为：**
- ✅ 自动应用监控模板（一键应用）
- ✅ 自动生成监控规则（基于设备类型）
- ✅ 自动发送监控报警（基于报警规则）
- 🤖 **AI智能建议**：
  - 基于设备类型，建议监控规则
  - 检测监控规则合理性，提示优化

**验收标准：**
- ✅ 设备数据导入成功（支持universheet在线表格批量导入，实时保存）
- ✅ 维护计划配置成功（支持维护计划模板）
- ✅ 设备状态监控配置成功（支持监控模板）

**优化效果：**
- ⚡ **操作步骤减少**：设备数据导入<1小时，维护计划配置<30分钟，监控配置<20分钟
- ⚡ **时间缩短**：从手工录入2天减少到<2小时
- ⚡ **学习成本降低**：向导引导，无需专业知识

#### 11.10.3 设备组角色日常使用场景

**场景1：设备状态监控（<1分钟）**
1. **进入"设备管理" → "设备监控" → "设备状态"**
2. **查看设备状态**（运行、停机、故障）
3. **查看设备参数**（温度、压力、速度等）
4. **查看设备报警**（参数超限、故障报警）
5. **处理设备报警**（确认报警、处理故障）

**系统行为：**
- ✅ 实时更新设备状态（基于设备数据）
- ✅ 实时更新设备参数（基于设备数据）
- ✅ 自动发送设备报警（基于报警规则）
- ✅ 自动生成设备状态报告（每天生成）
- 🤖 **AI智能建议**：
  - 检测设备异常，建议处理措施
  - 建议设备维护计划调整

**场景2：设备维护（<10分钟）**
1. **进入"设备管理" → "维护管理" → "维护任务"**
2. **查看维护任务**（系统自动生成，基于维护计划）
3. **选择维护任务**（支持搜索、拼音搜索）
4. **填写维护记录**：
   - 维护内容、维护结果
   - 维护人员、维护时间
   - 维护费用（可选）
5. **提交维护记录**（系统自动生成维护记录编号，自动更新维护计划）

**系统行为：**
- ✅ 自动生成维护任务（基于维护计划）
- ✅ 自动提醒维护任务（基于维护计划）
- ✅ 自动生成维护记录编号（基于编码规则）
- ✅ 自动更新维护计划（维护后自动更新）
- ✅ 自动发送维护通知（相关人员）
- 🤖 **AI智能建议**：
  - 检测维护结果合理性，提示异常
  - 建议维护计划优化

**场景3：设备故障处理（<15分钟）**
1. **进入"设备管理" → "故障管理" → "故障处理"**
2. **记录故障信息**：
   - 设备编码、设备名称
   - 故障类型、故障描述
   - 故障时间、故障人员
3. **填写处理信息**：
   - 处理措施、处理结果
   - 处理人员、处理时间
   - 处理费用（可选）
4. **提交故障处理单**（系统自动生成故障处理单编号）
5. **跟踪故障处理结果**（系统自动跟踪处理进度）

**系统行为：**
- ✅ 自动填充故障信息（基于设备）
- ✅ 自动生成故障处理单编号（基于编码规则）
- ✅ 自动跟踪故障处理进度（处理后自动跟踪）
- ✅ 自动发送故障通知（相关人员）
- ✅ 自动生成故障报告（故障统计、故障分析）
- 🤖 **AI智能建议**：
  - 检测故障类型，建议处理措施
  - 建议故障预防措施

**场景4：设备数据分析（<5分钟）**
1. **进入"设备管理" → "数据分析" → "设备报表"**
2. **选择报表类型**（如：设备利用率分析、设备故障率分析、维护成本分析）
3. **选择时间范围**（如：本月、本季度、本年）
4. **查看报表数据**（图表、表格）
5. **导出报表**（Excel、PDF）

**系统行为：**
- ✅ 自动生成设备报表（基于设备数据）
- ✅ 自动生成图表（趋势图、柱状图、饼图）
- ✅ 支持报表导出（Excel、PDF）
- 🤖 **AI智能建议**：
  - 分析设备利用率，建议设备优化
  - 识别设备故障趋势，建议预防措施

**优化点：**
- ⚡ **一键操作**：设备维护、设备故障处理，一键完成
- ⚡ **智能填充**：自动填充设备信息，减少输入
- ⚡ **实时监控**：设备状态实时监控，无需人工查询
- ⚡ **数据分析**：自动生成报表，无需手工整理

---

### 11.11 财务角色场景推演与自助式上线向导

#### 11.11.1 财务角色职责与使用场景

**职责：**
- 应收应付管理：应收管理、应付管理、对账管理
- 成本核算：生产成本核算、销售成本核算、库存成本核算
- 财务报表：财务报表生成、财务报表分析、财务报表导出
- 财务分析：财务趋势分析、盈利能力分析、成本分析

**使用场景：**
- 日常：应收应付管理、成本核算、财务报表
- 周期性：月度报表、季度报表、年度报表
- 异常：应收应付异常、成本异常、财务异常

**痛点：**
- 应收应付数据分散，难以统一管理
- 成本核算复杂，需要手工计算
- 财务报表制作繁琐，需要重复操作
- 财务数据分析困难，需要手工整理

#### 11.11.2 财务角色上线准备（自助式向导）

**第一步：期初应收应付导入（<1小时）**
1. **进入"财务管理" → "应收应付管理" → "期初应收应付导入"**
2. **打开期初应收应付导入universheet在线表格**（系统自动创建模板）
3. **在universheet中填写期初应收应付数据**（基于快照时间点，实时保存）：
   - 客户/供应商编码（支持部门编码，自动映射）
   - 单据类型（销售订单/采购订单/发票等）
   - 单据号、单据日期
   - 应收/应付金额、已收/已付金额、未收/未付金额
   - 到期日期
4. **点击"导入"按钮**（系统自动读取universheet数据并导入）
5. **验证期初应收应付数据**（系统自动验证，<30秒）
6. **查看导入报告**（成功数量、失败数量、错误详情）

**系统行为：**
- ✅ 自动验证期初应收应付数据（格式、完整性、关联性）
- ✅ 自动识别客户/供应商编码（支持部门编码，自动映射到主编码）
- ✅ 自动创建期初应收/应付单（标记为"期初应收/应付"）
- ✅ 自动更新应收/应付余额
- ✅ 自动生成导入报告
- 🤖 **AI智能建议**：
  - 检测期初应收应付数据完整性，提示缺失的关键字段
  - 识别异常应收应付数据，建议调整

**第二步：成本核算规则配置（<30分钟）**
1. **进入"财务管理" → "成本核算" → "成本核算规则配置"**
2. **选择成本核算规则模板**（如：标准成本核算规则模板）
3. **配置成本核算规则**（可选）：
   - 生产成本核算规则（如：直接材料、直接人工、制造费用）
   - 销售成本核算规则（如：加权平均法、先进先出法）
   - 库存成本核算规则（如：加权平均法、先进先出法）
4. **保存成本核算规则配置**

**系统行为：**
- ✅ 自动应用成本核算规则模板（一键应用）
- ✅ 自动生成成本核算规则（基于行业标准）
- ✅ 自动验证成本核算规则（规则合理性）
- 🤖 **AI智能建议**：
  - 基于行业标准，建议成本核算规则
  - 检测成本核算规则合理性，提示优化

**第三步：财务报表模板配置（<20分钟）**
1. **进入"财务管理" → "财务报表" → "报表模板配置"**
2. **选择报表模板**（如：标准财务报表模板）
3. **配置报表模板**（可选）：
   - 资产负债表模板
   - 利润表模板
   - 现金流量表模板
   - 成本报表模板
4. **保存报表模板配置**

**系统行为：**
- ✅ 自动应用报表模板（一键应用）
- ✅ 自动生成报表模板（基于行业标准）
- ✅ 自动验证报表模板（模板合理性）
- 🤖 **AI智能建议**：
  - 基于行业标准，建议报表模板
  - 检测报表模板合理性，提示优化

**验收标准：**
- ✅ 期初应收应付导入成功（支持universheet在线表格批量导入，支持部门编码，实时保存）
- ✅ 成本核算规则配置成功（支持成本核算规则模板）
- ✅ 财务报表模板配置成功（支持报表模板）

**优化效果：**
- ⚡ **操作步骤减少**：期初应收应付导入<1小时，成本核算规则配置<30分钟，报表模板配置<20分钟
- ⚡ **时间缩短**：从手工录入3天减少到<2小时
- ⚡ **学习成本降低**：向导引导，无需专业知识

#### 11.11.3 财务角色日常使用场景

**场景1：应收管理（<5分钟）**
1. **进入"财务管理" → "应收应付管理" → "应收管理"**
2. **查看应收列表**（支持搜索、拼音搜索）
3. **查看应收明细**（单据信息、收款信息、余额信息）
4. **记录收款**：
   - 选择应收单
   - 填写收款金额、收款日期、收款方式
   - 提交收款单（系统自动更新应收余额）
5. **查看应收报表**（应收余额、账龄分析）

**系统行为：**
- ✅ 自动更新应收余额（收款后自动更新）
- ✅ 自动生成收款单编号（基于编码规则）
- ✅ 自动计算应收余额（应收金额-已收金额）
- ✅ 自动生成应收报表（应收余额、账龄分析）
- ✅ 自动发送收款通知（相关人员）
- 🤖 **AI智能建议**：
  - 检测应收异常，建议催收措施
  - 建议收款计划优化

**场景2：应付管理（<5分钟）**
1. **进入"财务管理" → "应收应付管理" → "应付管理"**
2. **查看应付列表**（支持搜索、拼音搜索）
3. **查看应付明细**（单据信息、付款信息、余额信息）
4. **记录付款**：
   - 选择应付单
   - 填写付款金额、付款日期、付款方式
   - 提交付款单（系统自动更新应付余额）
5. **查看应付报表**（应付余额、账龄分析）

**系统行为：**
- ✅ 自动更新应付余额（付款后自动更新）
- ✅ 自动生成付款单编号（基于编码规则）
- ✅ 自动计算应付余额（应付金额-已付金额）
- ✅ 自动生成应付报表（应付余额、账龄分析）
- ✅ 自动发送付款通知（相关人员）
- 🤖 **AI智能建议**：
  - 检测应付异常，建议付款计划
  - 建议付款计划优化

**场景3：成本核算（<10分钟）**
1. **进入"财务管理" → "成本核算" → "成本核算"**
2. **选择核算范围**（如：全部产品、指定产品）
3. **选择核算时间范围**（如：本月、本季度）
4. **点击"开始核算"按钮**
5. **查看核算结果**（生产成本、销售成本、库存成本）
6. **导出成本报表**（Excel、PDF）

**系统行为：**
- ✅ 自动成本核算（基于成本核算规则）
- ✅ 自动计算生产成本（直接材料+直接人工+制造费用）
- ✅ 自动计算销售成本（基于销售订单）
- ✅ 自动计算库存成本（基于库存数据）
- ✅ 自动生成成本报表（成本明细、成本分析）
- 🤖 **AI智能建议**：
  - 检测成本异常，建议成本优化
  - 建议成本控制措施

**场景4：财务报表生成（<5分钟）**
1. **进入"财务管理" → "财务报表" → "报表生成"**
2. **选择报表类型**（如：资产负债表、利润表、现金流量表）
3. **选择报表时间范围**（如：本月、本季度、本年）
4. **点击"生成报表"按钮**
5. **查看报表数据**（图表、表格）
6. **导出报表**（Excel、PDF）

**系统行为：**
- ✅ 自动生成财务报表（基于财务数据）
- ✅ 自动生成图表（趋势图、柱状图、饼图）
- ✅ 支持报表导出（Excel、PDF）
- 🤖 **AI智能建议**：
  - 分析财务趋势，建议财务优化
  - 识别财务风险，建议风险控制

**优化点：**
- ⚡ **一键操作**：应收应付管理、成本核算、财务报表生成，一键完成
- ⚡ **智能填充**：自动填充应收应付信息，减少输入
- ⚡ **自动核算**：自动成本核算，无需手工计算
- ⚡ **数据分析**：自动生成报表，无需手工整理

---

### 11.12 管理者角色场景推演与自助式上线向导

#### 11.12.1 管理者角色职责与使用场景

**职责：**
- 数据看板：生产看板、销售看板、库存看板、财务看板
- 报表分析：生产报表、销售报表、库存报表、财务报表
- 决策支持：数据分析、趋势分析、异常分析、决策建议
- 系统管理：用户管理、权限管理、系统配置、系统监控

**使用场景：**
- 日常：数据看板查看、报表分析、决策支持
- 周期性：月度报表、季度报表、年度报表
- 异常：异常数据分析、异常处理、决策调整

**痛点：**
- 数据分散，难以统一查看
- 报表制作繁琐，需要重复操作
- 数据分析困难，需要手工整理
- 决策支持不足，缺乏智能建议

#### 11.12.2 管理者角色上线准备（自助式向导）

**第一步：数据看板配置（<30分钟）**
1. **进入"数据看板" → "看板配置" → "看板模板"**
2. **选择看板模板**（如：标准数据看板模板）
3. **配置看板内容**（可选）：
   - 生产看板（如：生产进度、生产效率、生产异常）
   - 销售看板（如：销售趋势、销售达成率、客户分析）
   - 库存看板（如：库存数量、库存周转率、库存预警）
   - 财务看板（如：收入、成本、利润、现金流）
4. **保存看板配置**

**系统行为：**
- ✅ 自动应用看板模板（一键应用）
- ✅ 自动生成看板内容（基于业务数据）
- ✅ 自动更新看板数据（实时更新）
- 🤖 **AI智能建议**：
  - 基于业务特点，建议看板内容
  - 检测看板配置合理性，提示优化

**第二步：报表模板配置（<20分钟）**
1. **进入"报表分析" → "报表配置" → "报表模板"**
2. **选择报表模板**（如：标准报表模板）
3. **配置报表内容**（可选）：
   - 生产报表（如：生产进度报表、生产效率报表）
   - 销售报表（如：销售趋势报表、销售达成率报表）
   - 库存报表（如：库存数量报表、库存周转率报表）
   - 财务报表（如：收入报表、成本报表、利润报表）
4. **保存报表模板配置**

**系统行为：**
- ✅ 自动应用报表模板（一键应用）
- ✅ 自动生成报表内容（基于业务数据）
- ✅ 自动生成报表图表（趋势图、柱状图、饼图）
- 🤖 **AI智能建议**：
  - 基于业务特点，建议报表内容
  - 检测报表配置合理性，提示优化

**第三步：决策支持配置（<15分钟）**
1. **进入"决策支持" → "决策配置" → "决策规则"**
2. **选择决策规则模板**（如：标准决策规则模板）
3. **配置决策规则**（可选）：
   - 异常预警规则（如：生产延期、库存异常、成本异常）
   - 决策建议规则（如：生产计划调整、采购计划调整）
4. **保存决策规则配置**

**系统行为：**
- ✅ 自动应用决策规则模板（一键应用）
- ✅ 自动生成决策规则（基于业务规则）
- ✅ 自动生成决策建议（基于数据分析）
- 🤖 **AI智能建议**：
  - 基于业务特点，建议决策规则
  - 检测决策规则合理性，提示优化

**验收标准：**
- ✅ 数据看板配置成功（支持看板模板）
- ✅ 报表模板配置成功（支持报表模板）
- ✅ 决策支持配置成功（支持决策规则模板）

**优化效果：**
- ⚡ **操作步骤减少**：数据看板配置<30分钟，报表模板配置<20分钟，决策支持配置<15分钟
- ⚡ **时间缩短**：从手工配置1天减少到<1小时
- ⚡ **学习成本降低**：向导引导，无需专业知识

#### 11.12.3 管理者角色日常使用场景

**场景1：数据看板查看（<1分钟）**
1. **进入"数据看板" → "综合看板"**
2. **查看生产看板**（生产进度、生产效率、生产异常）
3. **查看销售看板**（销售趋势、销售达成率、客户分析）
4. **查看库存看板**（库存数量、库存周转率、库存预警）
5. **查看财务看板**（收入、成本、利润、现金流）

**系统行为：**
- ✅ 实时更新看板数据（基于业务数据）
- ✅ 自动生成看板图表（趋势图、柱状图、饼图）
- ✅ 自动检测异常数据（异常预警）
- ✅ 自动生成看板报告（每天生成）
- 🤖 **AI智能建议**：
  - 检测异常数据，建议处理措施
  - 建议业务优化措施

**场景2：报表分析（<5分钟）**
1. **进入"报表分析" → "报表列表"**
2. **选择报表类型**（如：生产报表、销售报表、库存报表、财务报表）
3. **选择报表时间范围**（如：本月、本季度、本年）
4. **查看报表数据**（图表、表格）
5. **导出报表**（Excel、PDF）

**系统行为：**
- ✅ 自动生成报表数据（基于业务数据）
- ✅ 自动生成报表图表（趋势图、柱状图、饼图）
- ✅ 支持报表导出（Excel、PDF）
- 🤖 **AI智能建议**：
  - 分析报表趋势，建议业务优化
  - 识别报表异常，建议处理措施

**场景3：决策支持（<5分钟）**
1. **进入"决策支持" → "决策分析"**
2. **查看异常预警**（生产延期、库存异常、成本异常）
3. **查看决策建议**（生产计划调整、采购计划调整）
4. **查看趋势分析**（生产趋势、销售趋势、成本趋势）
5. **执行决策**（基于决策建议，执行决策）

**系统行为：**
- ✅ 自动检测异常数据（基于异常预警规则）
- ✅ 自动生成决策建议（基于数据分析）
- ✅ 自动生成趋势分析（基于历史数据）
- ✅ 自动跟踪决策效果（决策后自动跟踪）
- 🤖 **AI智能建议**：
  - 基于数据分析，建议决策措施
  - 基于决策效果，建议决策优化

**场景4：系统管理（<10分钟）**
1. **进入"系统管理" → "用户管理"**
2. **查看用户列表**（用户信息、用户状态、用户权限）
3. **创建用户**（用户信息、用户角色、用户权限）
4. **进入"系统管理" → "权限管理"**
5. **配置权限**（角色权限、数据权限）
6. **进入"系统管理" → "系统监控"**
7. **查看系统状态**（系统性能、系统使用情况、系统异常）

**系统行为：**
- ✅ 自动生成用户列表（基于用户数据）
- ✅ 自动分配用户权限（基于用户角色）
- ✅ 自动监控系统状态（系统性能、系统使用情况）
- ✅ 自动检测系统异常（系统异常预警）
- 🤖 **AI智能建议**：
  - 检测系统异常，建议处理措施
  - 建议系统优化措施

**优化点：**
- ⚡ **一键操作**：数据看板查看、报表分析、决策支持，一键完成
- ⚡ **实时更新**：看板数据实时更新，无需人工查询
- ⚡ **智能分析**：自动数据分析，无需手工整理
- ⚡ **决策支持**：自动决策建议，提高决策效率

---

### 11.13 系统实施人员角色场景推演与自助式上线向导

#### 11.13.1 系统实施人员角色职责与使用场景

**职责：**
- 系统初始化：组织注册、基础配置、系统参数配置
- 数据导入：基础数据导入、期初数据导入、数据验证
- 用户培训：用户培训、操作指导、问题解答
- 系统监控：系统状态监控、问题跟踪、系统优化

**使用场景：**
- 日常：系统初始化、数据导入、用户培训
- 周期性：系统监控、问题跟踪、系统优化
- 异常：系统异常、数据异常、用户问题

**痛点：**
- 系统初始化复杂，需要专业知识
- 数据导入繁琐，需要手工整理
- 用户培训困难，需要重复讲解
- 系统监控不足，无法及时发现问题

#### 11.13.2 系统实施人员角色上线准备（自助式向导）

**第一步：系统初始化（<30分钟）**
1. **进入"系统设置" → "系统初始化" → "初始化向导"**
2. **选择初始化模板**（如：制造业通用初始化模板）
3. **配置系统参数**（可选）：
   - 组织信息（组织名称、组织代码、联系人）
   - 系统参数（默认货币、默认语言、时区）
   - 编码规则（工单编码、采购单编码、销售订单编码）
4. **保存系统配置**

**系统行为：**
- ✅ 自动应用初始化模板（一键应用）
- ✅ 自动生成系统参数（基于行业标准）
- ✅ 自动生成编码规则（基于行业最佳实践）
- ✅ 自动验证系统配置（配置合理性）
- 🤖 **AI智能建议**：
  - 基于行业特点，建议系统配置
  - 检测系统配置合理性，提示优化

**第二步：基础数据导入（<2小时）**
1. **进入"数据导入" → "基础数据导入" → "导入向导"**
2. **选择导入模板**（如：标准基础数据导入模板）
3. **导入基础数据**（按顺序导入）：
   - 组织架构数据（部门、员工、角色）
   - 物料主数据（物料、BOM）
   - 工艺路线数据（工序、工艺路线、SOP）
   - 仓库数据（仓库、库区、库位）
   - 供应链主数据（供应商、客户）
4. **验证导入数据**（系统自动验证）
5. **查看导入报告**（成功数量、失败数量、错误详情）

**系统行为：**
- ✅ 自动应用导入模板（一键应用）
- ✅ 自动验证导入数据（格式、完整性、关联性）
- ✅ 自动生成导入报告（详细列出所有错误和警告）
- ✅ 自动数据清洗建议（基于AI识别）
- 🤖 **AI智能建议**：
  - 检测数据完整性，提示缺失的关键字段
  - 识别重复数据，建议合并
  - 建议数据优化措施

**第三步：期初数据导入（<2小时）**
1. **进入"数据导入" → "期初数据导入" → "导入向导"**
2. **启动上线倒计时**（设置上线日期）
3. **确定快照时间点**（确定期初数据快照时间点）
4. **导入期初数据**（按顺序导入）：
   - 期初库存数据（基于快照时间点）
   - 期初在制品数据（基于快照时间点）
   - 期初应收应付数据（基于快照时间点）
5. **动态数据补偿**（自动计算快照时间点到上线日期之间的数据变化）
6. **上线前最终检查**（系统自动生成检查清单）

**系统行为：**
- ✅ 自动启动上线倒计时（设置上线日期）
- ✅ 自动记录快照时间点（确定期初数据快照时间点）
- ✅ 自动验证期初数据（格式、完整性、关联性）
- ✅ 自动计算动态数据补偿（快照时间点到上线日期之间的数据变化）
- ✅ 自动生成检查清单（基于上线阶段）
- ✅ 自动检查检查项（每天检查）
- 🤖 **AI智能建议**：
  - 检测期初数据完整性，提示缺失的关键数据
  - 识别异常数据，建议调整
  - 建议上线准备措施

**验收标准：**
- ✅ 系统初始化成功（支持初始化模板）
- ✅ 基础数据导入成功（支持导入模板，支持数据验证）
- ✅ 期初数据导入成功（支持上线倒计时功能，支持动态数据补偿）

**优化效果：**
- ⚡ **操作步骤减少**：系统初始化<30分钟，基础数据导入<2小时，期初数据导入<2小时
- ⚡ **时间缩短**：从手工配置1周减少到<5小时
- ⚡ **学习成本降低**：向导引导，无需专业知识

#### 11.13.3 系统实施人员角色日常使用场景

**场景1：系统初始化（<30分钟）**
1. **进入"系统设置" → "系统初始化" → "初始化向导"**
2. **选择初始化模板**（如：制造业通用初始化模板）
3. **配置系统参数**（组织信息、系统参数、编码规则）
4. **保存系统配置**（系统自动保存）
5. **验证系统配置**（系统自动验证）

**系统行为：**
- ✅ 自动应用初始化模板（一键应用）
- ✅ 自动生成系统参数（基于行业标准）
- ✅ 自动生成编码规则（基于行业最佳实践）
- ✅ 自动验证系统配置（配置合理性）
- ✅ 自动保存系统配置（配置后自动保存）
- 🤖 **AI智能建议**：
  - 基于行业特点，建议系统配置
  - 检测系统配置合理性，提示优化

**场景2：数据导入（<2小时）**
1. **进入"数据导入" → "数据导入" → "导入向导"**
2. **选择导入类型**（基础数据导入、期初数据导入）
3. **打开导入universheet在线表格**（系统自动创建模板）
4. **在universheet中填写导入数据**（实时保存）
5. **点击"导入"按钮**（系统自动读取universheet数据并导入）
6. **验证导入数据**（系统自动验证）
7. **查看导入报告**（成功数量、失败数量、错误详情）

**系统行为：**
- ✅ 自动验证导入数据（格式、完整性、关联性）
- ✅ 自动生成导入报告（详细列出所有错误和警告）
- ✅ 自动数据清洗建议（基于AI识别）
- ✅ 自动修复数据错误（基于数据清洗建议）
- 🤖 **AI智能建议**：
  - 检测数据完整性，提示缺失的关键字段
  - 识别重复数据，建议合并
  - 建议数据优化措施

**场景3：用户培训（<1小时）**
1. **进入"用户培训" → "培训管理" → "培训计划"**
2. **创建培训计划**（培训内容、培训时间、培训人员）
3. **发送培训通知**（系统自动发送培训通知）
4. **进行培训**（使用系统内置帮助系统、操作视频）
5. **跟踪培训效果**（系统自动跟踪培训效果）

**系统行为：**
- ✅ 自动生成培训计划（基于用户角色）
- ✅ 自动发送培训通知（培训人员）
- ✅ 自动跟踪培训效果（培训完成情况、培训效果）
- ✅ 自动生成培训报告（培训统计、培训效果）
- 🤖 **AI智能建议**：
  - 基于用户角色，建议培训内容
  - 检测培训效果，建议培训优化

**场景4：系统监控（<10分钟）**
1. **进入"系统监控" → "系统状态"**
2. **查看系统状态**（系统性能、系统使用情况、系统异常）
3. **查看用户使用情况**（用户登录情况、用户操作情况）
4. **查看数据质量**（数据完整性、数据准确性、数据一致性）
5. **处理系统异常**（基于异常提示，处理异常）

**系统行为：**
- ✅ 自动监控系统状态（系统性能、系统使用情况）
- ✅ 自动检测系统异常（系统异常预警）
- ✅ 自动生成系统监控报告（每天生成）
- ✅ 自动生成优化建议（基于系统监控数据）
- 🤖 **AI智能建议**：
  - 检测系统异常，建议处理措施
  - 建议系统优化措施

**优化点：**
- ⚡ **一键操作**：系统初始化、数据导入、用户培训，一键完成
- ⚡ **智能填充**：自动填充系统配置，减少输入
- ⚡ **自动验证**：自动数据验证，减少人工检查
- ⚡ **自动监控**：自动系统监控，及时发现问题

---

## 12. 个性化需求场景（后期定制）

### 9.1 自定义字段

**场景：** 企业需要添加自定义字段（如：客户编号、供应商评级等）

**解决方案：**
- ⚠️ 通过"自定义字段"功能添加
- ⚠️ 支持文本、数字、日期、下拉等类型
- ⚠️ 支持字段验证规则

---

### 9.2 自定义报表

**场景：** 企业需要自定义报表格式和内容

**解决方案：**
- ⚠️ 通过"报表设计器"自定义报表
- ⚠️ 支持拖拽式设计
- ⚠️ 支持自定义数据源
- ⚠️ 支持自定义图表类型

---

### 9.3 自定义工作流

**场景：** 企业需要自定义业务流程（如：特殊审批流程）

**解决方案：**
- ⚠️ 通过"流程设计器"自定义工作流
- ⚠️ 支持条件分支
- ⚠️ 支持并行流程
- ⚠️ 支持子流程

---

### 9.4 第三方系统集成

**场景：** 企业需要与ERP、PLM、SCADA等系统集成

**解决方案：**
- ⚠️ 通过"集成配置"功能配置
- ⚠️ 支持RESTful API集成
- ⚠️ 支持Webhook集成
- ⚠️ 支持数据同步规则

---

## 10. 降低上线失败风险的最佳实践（软件层面优化）

### 10.1 数据质量保障机制（解决数据问题，占比40%）

**问题：** 数据质量差、数据不准确、数据迁移失败

**软件层面解决方案：**

#### 10.1.1 数据验证机制（核心功能，新增）
- **导入前验证**：
  - 自动检测数据格式错误（如：日期格式、数字格式）
  - 自动检测必填字段缺失
  - 自动检测数据重复（基于关键字段）
  - 自动检测数据关联性（如：物料是否存在、仓库是否存在）
  - 生成数据验证报告（详细列出所有错误和警告）
- **导入中验证**：
  - 实时验证每条数据
  - 自动跳过错误数据，继续导入其他数据
  - 实时显示导入进度和错误数量
- **导入后验证**：
  - 自动生成导入报告（成功数量、失败数量、错误详情）
  - 自动生成数据质量报告（数据完整性、准确性、一致性）
  - 提供数据修复建议（AI智能建议）

**用户操作：**
1. 打开universheet在线表格（系统自动创建模板），在universheet中填写数据（实时保存），点击"导入"按钮
2. 系统自动验证数据（<10秒）
3. 查看数据验证报告
4. 修复错误数据（根据报告提示）
5. 重新导入或确认导入

**系统行为：**
- ✅ **数据格式验证**：自动检测数据格式错误
- ✅ **数据完整性验证**：自动检测必填字段缺失
- ✅ **数据重复检测**：自动检测重复数据（基于关键字段）
- ✅ **数据关联性验证**：自动检测数据关联性（物料、仓库、客户等）
- ✅ **数据合理性验证**：自动检测数据合理性（如：库存数量不能为负数）
- ✅ **生成验证报告**：自动生成详细的验证报告
- 🤖 **AI智能建议**：
  - 自动识别数据错误类型
  - 提供数据修复建议
  - 建议数据清洗规则

**验收标准：**
- ✅ 数据验证机制正常（导入前/中/后验证）
- ✅ 数据验证报告正常（详细列出所有错误和警告）
- ✅ 数据修复建议正常（AI智能建议）

**优化效果：**
- ⚡ **降低数据错误率**：通过数据验证，提前发现和修复数据错误
- ⚡ **提高数据质量**：通过数据验证报告，确保数据质量
- ⚡ **减少人工工作量**：自动验证，减少人工检查工作量

#### 10.1.2 数据清洗建议（核心功能，新增）
- **智能识别数据问题**：
  - 自动识别相似数据（如：名称相似、规格相似）
  - 自动识别异常数据（如：数量异常、金额异常）
  - 自动识别缺失数据（如：必填字段缺失）
- **提供数据清洗建议**：
  - 建议合并相似数据（基于AI识别）
  - 建议修复异常数据（基于业务规则）
  - 建议补充缺失数据（基于历史数据）
- **一键执行数据清洗**：
  - 用户确认清洗建议后，一键执行数据清洗
  - 自动生成数据清洗报告

**用户操作：**
1. 查看数据清洗建议（系统自动生成）
2. 确认清洗建议（选择需要清洗的数据）
3. 一键执行数据清洗
4. 查看数据清洗报告

**系统行为：**
- ✅ **智能识别数据问题**：自动识别相似数据、异常数据、缺失数据
- ✅ **提供数据清洗建议**：基于AI识别和业务规则，提供清洗建议
- ✅ **一键执行数据清洗**：用户确认后，一键执行数据清洗
- ✅ **生成清洗报告**：自动生成数据清洗报告

**验收标准：**
- ✅ 数据清洗建议正常（智能识别数据问题）
- ✅ 一键执行数据清洗正常（用户确认后执行）
- ✅ 数据清洗报告正常（详细列出清洗结果）

**优化效果：**
- ⚡ **提高数据质量**：通过数据清洗，提高数据质量
- ⚡ **减少人工工作量**：自动识别和清洗，减少人工工作量

### 10.2 操作引导和帮助系统（解决人员问题，占比30%）

**问题：** 员工抵触变革、培训不足、操作错误率高

**软件层面解决方案：**

#### 10.2.1 内置帮助系统（核心功能，新增）
- **操作提示**：
  - 每个页面都有操作提示（悬浮提示、侧边栏提示）
  - 关键操作有操作步骤提示（分步引导）
  - 首次使用有操作引导（高亮显示关键操作）
- **帮助文档**：
  - 每个功能都有帮助文档（点击"帮助"按钮查看）
  - 帮助文档包含：功能说明、操作步骤、常见问题
  - 支持搜索帮助文档（关键词搜索）
- **操作视频**：
  - 关键功能有操作视频（点击"观看视频"按钮）
  - 操作视频包含：功能演示、操作步骤、注意事项
  - 支持在线播放和下载

**用户操作：**
1. 进入任意页面，自动显示操作提示（首次使用）
2. 点击"帮助"按钮，查看帮助文档
3. 点击"观看视频"按钮，观看操作视频
4. 搜索帮助文档（关键词搜索）

**系统行为：**
- ✅ **操作提示**：每个页面都有操作提示（悬浮提示、侧边栏提示）
- ✅ **操作步骤提示**：关键操作有操作步骤提示（分步引导）
- ✅ **操作引导**：首次使用有操作引导（高亮显示关键操作）
- ✅ **帮助文档**：每个功能都有帮助文档（功能说明、操作步骤、常见问题）
- ✅ **操作视频**：关键功能有操作视频（功能演示、操作步骤、注意事项）
- ✅ **搜索帮助**：支持搜索帮助文档（关键词搜索）
- 🤖 **AI智能建议**：
  - 基于用户操作，智能推荐相关帮助文档
  - 基于用户错误，智能推荐解决方案

**验收标准：**
- ✅ 操作提示正常（每个页面都有操作提示）
- ✅ 帮助文档正常（每个功能都有帮助文档）
- ✅ 操作视频正常（关键功能有操作视频）
- ✅ 搜索帮助正常（支持关键词搜索）

**优化效果：**
- ⚡ **降低培训成本**：内置帮助系统，减少培训需求
- ⚡ **提高操作效率**：操作提示和引导，提高操作效率
- ⚡ **降低操作错误率**：操作步骤提示，降低操作错误率

#### 10.2.2 操作确认和错误提示（核心功能，新增）
- **操作确认**：
  - 关键操作有确认提示（如：删除、批量操作）
  - 确认提示包含：操作说明、影响范围、操作后果
  - 支持"不再提示"选项（记住用户选择）
- **错误提示**：
  - 操作错误时，自动显示错误提示（明确说明错误原因）
  - 错误提示包含：错误原因、解决方案、相关帮助文档
  - 支持一键跳转到相关帮助文档
- **操作回退**：
  - 支持操作回退（如：撤销、恢复）
  - 关键操作有操作历史记录（可查看和回退）

**用户操作：**
1. 执行关键操作（如：删除、批量操作）
2. 系统自动显示确认提示
3. 确认操作或取消操作
4. 如果操作错误，系统自动显示错误提示
5. 根据错误提示，修复错误或查看帮助文档

**系统行为：**
- ✅ **操作确认**：关键操作有确认提示（操作说明、影响范围、操作后果）
- ✅ **错误提示**：操作错误时，自动显示错误提示（错误原因、解决方案、相关帮助文档）
- ✅ **操作回退**：支持操作回退（撤销、恢复）
- ✅ **操作历史**：关键操作有操作历史记录（可查看和回退）
- 🤖 **AI智能建议**：
  - 基于用户错误，智能推荐解决方案
  - 基于操作历史，智能推荐操作建议

**验收标准：**
- ✅ 操作确认正常（关键操作有确认提示）
- ✅ 错误提示正常（操作错误时显示错误提示）
- ✅ 操作回退正常（支持操作回退）
- ✅ 操作历史正常（关键操作有操作历史记录）

**优化效果：**
- ⚡ **降低操作错误率**：操作确认和错误提示，降低操作错误率
- ⚡ **提高操作安全性**：操作确认，提高操作安全性
- ⚡ **提高用户体验**：错误提示和操作回退，提高用户体验

### 10.3 上线进度跟踪和检查清单（解决管理问题，占比20%）

**问题：** 项目管理失控、进度无法跟踪、缺乏检查清单

**软件层面解决方案：**

#### 10.3.1 上线进度跟踪（核心功能，新增）
- **进度可视化**：
  - 上线倒计时功能（显示距离上线还有多少天）
  - 进度条显示（显示每个阶段的完成进度）
  - 任务清单显示（显示每个任务的完成状态）
- **进度提醒**：
  - 自动提醒未完成的任务（每天提醒）
  - 自动提醒即将到期的任务（提前3天提醒）
  - 自动提醒关键任务（标记为关键任务）
- **进度报告**：
  - 自动生成进度报告（每天生成）
  - 进度报告包含：完成情况、未完成任务、风险提示
  - 支持导出进度报告（Excel、PDF）

**用户操作：**
1. 进入"系统设置" → "上线准备" → "上线进度跟踪"
2. 查看上线倒计时和进度条
3. 查看任务清单（完成状态）
4. 查看进度报告（每天自动生成）
5. 处理未完成的任务（根据提醒）

**系统行为：**
- ✅ **进度可视化**：上线倒计时、进度条、任务清单
- ✅ **进度提醒**：自动提醒未完成任务、即将到期任务、关键任务
- ✅ **进度报告**：自动生成进度报告（完成情况、未完成任务、风险提示）
- ✅ **导出报告**：支持导出进度报告（Excel、PDF）
- 🤖 **AI智能建议**：
  - 基于进度情况，智能推荐优化建议
  - 基于风险提示，智能推荐解决方案

**验收标准：**
- ✅ 上线进度跟踪正常（进度可视化、进度提醒、进度报告）
- ✅ 进度报告正常（自动生成、支持导出）

**优化效果：**
- ⚡ **提高项目管理效率**：进度跟踪，提高项目管理效率
- ⚡ **降低项目风险**：进度提醒和风险提示，降低项目风险
- ⚡ **提高项目成功率**：进度跟踪和检查清单，提高项目成功率

#### 10.3.2 上线检查清单（核心功能，新增）
- **自动生成检查清单**：
  - 基于上线阶段，自动生成检查清单
  - 检查清单包含：静态数据检查、动态数据检查、系统配置检查
  - 每个检查项都有检查标准和检查方法
- **自动检查**：
  - 系统自动检查每个检查项（每天检查）
  - 自动标记检查结果（通过/未通过/待检查）
  - 自动生成检查报告（详细列出所有检查结果）
- **检查提醒**：
  - 自动提醒未通过的检查项（每天提醒）
  - 自动提醒待检查的检查项（提前提醒）
  - 自动提醒关键检查项（标记为关键检查项）

**用户操作：**
1. 进入"系统设置" → "上线准备" → "上线检查清单"
2. 查看检查清单（自动生成）
3. 查看检查结果（自动检查）
4. 处理未通过的检查项（根据提醒）
5. 确认所有检查项通过后，点击"确认上线"

**系统行为：**
- ✅ **自动生成检查清单**：基于上线阶段，自动生成检查清单
- ✅ **自动检查**：系统自动检查每个检查项（每天检查）
- ✅ **检查提醒**：自动提醒未通过的检查项、待检查的检查项、关键检查项
- ✅ **生成检查报告**：自动生成检查报告（详细列出所有检查结果）
- 🤖 **AI智能建议**：
  - 基于检查结果，智能推荐解决方案
  - 基于检查历史，智能推荐优化建议

**验收标准：**
- ✅ 上线检查清单正常（自动生成、自动检查、检查提醒）
- ✅ 检查报告正常（自动生成、详细列出所有检查结果）

**优化效果：**
- ⚡ **提高上线成功率**：检查清单，确保所有检查项通过
- ⚡ **降低上线风险**：自动检查和提醒，降低上线风险
- ⚡ **提高上线质量**：检查清单和检查报告，提高上线质量

### 10.4 系统性能优化（解决技术问题，占比10%）

**问题：** 系统响应速度慢、并发用户多时系统崩溃、数据量大时查询缓慢

**软件层面解决方案：**

#### 10.4.1 性能优化机制（核心功能，新增）
- **缓存机制**：
  - 常用数据缓存（如：物料主数据、BOM数据）
  - 查询结果缓存（如：库存查询、报表查询）
  - 自动缓存更新（数据变更时自动更新缓存）
- **异步处理**：
  - 批量操作异步处理（如：批量导入、批量导出）
  - 报表生成异步处理（如：大数据量报表）
  - 自动任务异步处理（如：MRP运算、数据同步）
- **性能监控**：
  - 自动监控系统性能（响应时间、并发数、资源使用率）
  - 自动生成性能报告（每天生成）
  - 自动预警性能问题（响应时间超过阈值时预警）

**用户操作：**
1. 系统自动优化性能（无需用户操作）
2. 查看性能报告（系统自动生成）
3. 处理性能问题（根据预警）

**系统行为：**
- ✅ **缓存机制**：常用数据缓存、查询结果缓存、自动缓存更新
- ✅ **异步处理**：批量操作异步处理、报表生成异步处理、自动任务异步处理
- ✅ **性能监控**：自动监控系统性能、自动生成性能报告、自动预警性能问题
- 🤖 **AI智能建议**：
  - 基于性能数据，智能推荐优化建议
  - 基于性能趋势，智能预测性能问题

**验收标准：**
- ✅ 缓存机制正常（常用数据缓存、查询结果缓存）
- ✅ 异步处理正常（批量操作异步处理、报表生成异步处理）
- ✅ 性能监控正常（自动监控、自动生成报告、自动预警）

**优化效果：**
- ⚡ **提高系统响应速度**：缓存机制和异步处理，提高系统响应速度
- ⚡ **提高系统稳定性**：性能监控和预警，提高系统稳定性
- ⚡ **提高用户体验**：系统响应速度快，提高用户体验

### 10.5 持续优化建议（解决缺乏持续优化问题）

**问题：** 缺乏持续优化、系统无法适应业务变化

**软件层面解决方案：**

#### 10.5.1 使用情况分析（核心功能，新增）
- **功能使用分析**：
  - 自动统计功能使用情况（使用频率、使用人数、使用时长）
  - 自动识别未使用功能（标记为未使用功能）
  - 自动识别高频使用功能（标记为高频使用功能）
- **数据质量分析**：
  - 自动统计数据质量（数据完整性、数据准确性、数据一致性）
  - 自动识别数据质量问题（标记为数据质量问题）
  - 自动生成数据质量报告（每月生成）
- **性能分析**：
  - 自动统计系统性能（响应时间、并发数、资源使用率）
  - 自动识别性能问题（标记为性能问题）
  - 自动生成性能报告（每月生成）

**用户操作：**
1. 进入"系统设置" → "系统分析" → "使用情况分析"
2. 查看功能使用分析（自动统计）
3. 查看数据质量分析（自动统计）
4. 查看性能分析（自动统计）
5. 根据分析结果，优化系统使用

**系统行为：**
- ✅ **功能使用分析**：自动统计功能使用情况、识别未使用功能、识别高频使用功能
- ✅ **数据质量分析**：自动统计数据质量、识别数据质量问题、生成数据质量报告
- ✅ **性能分析**：自动统计系统性能、识别性能问题、生成性能报告
- 🤖 **AI智能建议**：
  - 基于使用情况，智能推荐优化建议（如：建议使用未使用功能、建议优化高频使用功能）
  - 基于数据质量，智能推荐优化建议（如：建议修复数据质量问题）
  - 基于性能数据，智能推荐优化建议（如：建议优化性能问题）

**验收标准：**
- ✅ 使用情况分析正常（功能使用分析、数据质量分析、性能分析）
- ✅ 分析报告正常（自动生成、支持导出）

**优化效果：**
- ⚡ **提高系统使用率**：使用情况分析，提高系统使用率
- ⚡ **提高数据质量**：数据质量分析，提高数据质量
- ⚡ **提高系统性能**：性能分析，提高系统性能

#### 10.5.2 优化建议推送（核心功能，新增）
- **自动推送优化建议**：
  - 基于使用情况分析，自动推送优化建议（如：建议使用未使用功能）
  - 基于数据质量分析，自动推送优化建议（如：建议修复数据质量问题）
  - 基于性能分析，自动推送优化建议（如：建议优化性能问题）
- **优化建议分类**：
  - 功能优化建议（如：建议使用新功能）
  - 数据优化建议（如：建议修复数据质量问题）
  - 性能优化建议（如：建议优化性能问题）
- **优化建议优先级**：
  - 高优先级（影响业务的关键问题）
  - 中优先级（影响效率的一般问题）
  - 低优先级（不影响业务的优化建议）

**用户操作：**
1. 查看优化建议（系统自动推送）
2. 根据优化建议，优化系统使用
3. 标记优化建议（已处理/待处理/忽略）

**系统行为：**
- ✅ **自动推送优化建议**：基于使用情况、数据质量、性能分析，自动推送优化建议
- ✅ **优化建议分类**：功能优化建议、数据优化建议、性能优化建议
- ✅ **优化建议优先级**：高优先级、中优先级、低优先级
- 🤖 **AI智能建议**：
  - 基于优化建议历史，智能推荐优化建议
  - 基于业务变化，智能推荐优化建议

**验收标准：**
- ✅ 优化建议推送正常（自动推送、分类、优先级）
- ✅ 优化建议处理正常（标记、处理）

**优化效果：**
- ⚡ **提高系统使用率**：优化建议推送，提高系统使用率
- ⚡ **提高数据质量**：优化建议推送，提高数据质量
- ⚡ **提高系统性能**：优化建议推送，提高系统性能

---

## 11. 通用需求

## 12. 总结

### 11.1 系统初始化流程

1. **系统注册与登录**（第1天）
   - 组织注册（快速注册，<1分钟）
   - 创建组织管理员账号（手机号即账号）
   - 基础配置（快速初始化向导，<2分钟）

2. **基础数据配置**（第2-3天）
   - 组织架构配置（部门、员工，批量导入<5分钟）
   - 工厂建模配置（车间、工作中心）
   - 物料主数据配置（物料、BOM，批量导入，物料编码映射机制）
     - 分部门导入物料数据（保留各部门编码）
     - 使用物料编码映射工具建立映射关系（渐进式整理）
     - 智能识别重复物料（AI辅助识别）
   - **工序和工艺路线配置**（新增，核心功能）
     - 创建工序（批量导入或快速创建）
     - 创建工艺路线（简易路线<5分钟或带SOP工艺路线<10分钟）
     - 关联产品工艺路线
   - 仓库配置（仓库、库区、库位）
   - 供应链主数据配置（供应商、客户，批量导入）
   - **期初数据导入（上线倒计时功能，解决动态数据导入难点）**（新增，核心功能）
     - 启动上线倒计时（设置上线日期，系统自动显示倒计时）
     - 确定快照时间点（确定期初数据快照时间点，系统自动记录）
     - 导入期初库存（基于快照时间点，支持universheet在线表格批量导入，实时保存）
     - 导入在制品（基于快照时间点，支持universheet在线表格批量导入，实时保存）
     - 导入应收应付（基于快照时间点，支持universheet在线表格批量导入，实时保存）
     - 动态数据补偿（自动计算快照时间点到上线日期之间的数据变化）
     - 上线前最终检查（系统自动生成检查清单，用户确认上线）

### 11.2 MTS模式业务流程

1. **需求管理** → 销售预测（支持下推到MRP运算）
2. **计划排程** → MRP运算（从销售预测下推） → 一键生成工单和采购单（下推功能）
3. **高级排产** → 排产甘特图（可选）
4. **工单管理** → 创建工单（根据工艺路线自动生成工序，关联MRP运算） → 批量下达工单（支持下推到生产领料）
5. **生产领料** → 一键领料（从工单下推，根据BOM生成领料需求）
6. **报工管理** → 扫码报工（从工单下推，快速报工或带参数报工，显示SOP指导） → 自动更新工单进度 → 自动切换下一工序
7. **成品入库** → 一键入库（从工单下推） → 自动更新库存
8. **销售出库** → 从库存发货（MTS模式，关联销售预测）
9. **生产看板** → 实时监控生产进度
10. **单据关联追溯** → 查看完整业务流程链条（销售预测 → MRP运算 → 工单 → 生产领料 → 报工 → 成品入库 → 销售出库）

### 11.3 MTO模式业务流程

1. **需求管理** → 销售订单（支持下推到LRP运算）
2. **计划排程** → LRP运算（从销售订单下推） → 生成工单建议和采购建议（订单专属，支持下推）
3. **高级排产** → 排产甘特图（可选）
4. **工单管理** → 创建工单（关联订单，从LRP运算下推，根据工艺路线自动生成工序） → 批量下达工单（支持下推到生产领料）
5. **生产领料** → 一键领料（从工单下推，根据BOM生成领料需求，订单专属库存）
6. **报工管理** → 扫码报工（从工单下推，快速报工或带参数报工，显示SOP指导） → 自动更新工单进度 → 自动切换下一工序
7. **成品入库** → 一键入库（从工单下推） → 自动更新库存（订单专属库存）
8. **销售出库** → 关联订单发货（MTO模式，关联销售订单）
9. **生产看板** → 实时监控生产进度
10. **单据关联追溯** → 查看完整业务流程链条（销售订单 → LRP运算 → 工单 → 生产领料 → 报工 → 成品入库 → 销售出库）

### 10.6 异常处理流程（新增）

1. **缺料异常处理** → 缺料检测 → AI建议解决方案 → 用户选择处理方式
2. **交期延期异常处理** → 延期检测 → AI分析延期原因 → AI建议应对措施
3. **质量异常处理** → 质量异常检测 → AI分析质量原因 → AI建议改进措施

### 10.7 质量管理流程（完整场景推演，针对中国中小企业复杂场景）

#### 10.7.1 质检标准管理（核心功能，新增）

**应用场景：**
- 不同物料需要不同的检验标准
- 检验标准需要版本管理，支持变更追溯
- 检验标准需要关联到物料和工序
- 支持检验标准的快速复制和模板应用

**用户操作：**
1. **创建质检标准（方式1：快速创建）**
   - 进入"质量管理" → "质检标准管理" → "新建质检标准"
   - 填写基本信息：
     - 标准编码：QC-STD-001（自动生成）
     - 标准名称：注塑件外观检验标准
     - 适用物料：产品A、产品B（支持多选）
     - 适用工序：检验工序（可选，如果关联到工序）
     - 标准版本：V1.0（自动生成）
   - **设置检验项目**（核心功能）：
     - 检验项目1：外观检查
       - 检验项名称：外观检查
       - 检验方法：目视检查
       - 检验标准：表面无划痕、无气泡、无变形
       - 合格标准：符合要求
       - 不合格标准：不符合要求
       - 是否必检：是
       - 检验工具：目视
     - 检验项目2：尺寸检查
       - 检验项名称：尺寸检查
       - 检验方法：卡尺测量
       - 检验标准：长度100±0.5mm，宽度50±0.3mm
       - 合格标准：在公差范围内
       - 不合格标准：超出公差范围
       - 是否必检：是
       - 检验工具：卡尺
     - 检验项目3：重量检查
       - 检验项名称：重量检查
       - 检验方法：电子秤称重
       - 检验标准：重量100±2g
       - 合格标准：在公差范围内
       - 不合格标准：超出公差范围
       - 是否必检：否（可选）
       - 检验工具：电子秤
   - **设置抽样规则**（核心功能，新增）：
     - 抽样方式：全检/抽检/免检
     - 如果选择抽检：
       - 抽样标准：GB/T 2828.1-2012（国家标准）
       - 批量范围：1-50个，抽样数量：5个
       - 批量范围：51-100个，抽样数量：8个
       - 批量范围：101-200个，抽样数量：13个
       - AQL值：1.5（可接受质量水平）
       - 判定规则：合格数量≥抽样数量-1，判定合格
   - **设置检验流程**（核心功能，新增）：
     - 检验步骤1：外观检查（必检）
     - 检验步骤2：尺寸检查（必检）
     - 检验步骤3：重量检查（抽检，10%抽样）
     - 检验步骤顺序：按顺序执行，前一步不合格，停止后续检验
   - 保存质检标准

2. **创建质检标准（方式2：从模板创建）**
   - 进入"质量管理" → "质检标准管理" → "从模板创建"
   - 选择行业模板：注塑件通用检验标准
   - 系统自动填充检验项目和抽样规则
   - 用户可修改检验项目和抽样规则
   - 保存为新的质检标准

3. **质检标准版本管理**（核心功能，新增）
   - 进入"质量管理" → "质检标准管理" → "标准版本管理"
   - 查看标准版本历史：
     - V1.0：2026-01-01创建，当前版本
     - V1.1：2026-02-01修改，增加重量检查项
     - V2.0：2026-03-01修改，更新抽样规则
   - 创建新版本：
     - 基于当前版本创建新版本
     - 修改检验项目或抽样规则
     - 保存为新版本（V2.1）
   - 版本对比：
     - 对比V1.0和V2.0的差异
     - 显示新增、修改、删除的检验项目
   - 版本回退：
     - 如果新版本有问题，可以回退到旧版本

4. **批量导入质检标准**（核心功能，新增）
   - 进入"质量管理" → "质检标准管理" → "批量导入"
   - 打开质检标准导入universheet在线表格（系统自动创建模板）
   - 在universheet中填写质检标准数据（实时保存）：
     - 标准编码、标准名称、适用物料、检验项目、抽样规则等
   - 点击"导入"按钮，系统自动导入

**系统行为：**
- ✅ **质检标准创建**：
  - 自动生成标准编码（基于编码规则）
  - 自动生成标准版本（V1.0）
  - 支持检验项目配置（检验方法、检验标准、合格标准、不合格标准）
  - 支持抽样规则配置（全检/抽检/免检，抽样标准，AQL值）
  - 支持检验流程配置（检验步骤顺序）
- ✅ **质检标准版本管理**：
  - 自动记录版本历史
  - 支持版本对比
  - 支持版本回退
  - 支持版本变更追溯
- ✅ **质检标准关联**：
  - 自动关联到物料（适用物料）
  - 自动关联到工序（适用工序）
  - 创建工单时，自动应用质检标准
- ✅ **批量导入**：支持universheet在线表格批量导入（实时保存）
- 🤖 **AI智能建议**：
  - 基于物料类型，建议检验项目和检验标准
  - 基于历史数据，建议抽样规则和AQL值
  - 检测检验标准完整性，提示缺失的关键检验项目

**验收标准：**
- ✅ 质检标准创建成功（支持快速创建和模板创建）
- ✅ 检验项目配置成功（检验方法、检验标准、合格标准、不合格标准）
- ✅ 抽样规则配置成功（全检/抽检/免检，抽样标准，AQL值）
- ✅ 检验流程配置成功（检验步骤顺序）
- ✅ 质检标准版本管理正常（版本历史、版本对比、版本回退）
- ✅ 质检标准关联正常（关联到物料和工序）
- ✅ 批量导入正常（universheet在线表格导入，实时保存）

---

#### 10.7.2 来料检验流程（核心功能，新增）

**应用场景：**
- 采购到货后，需要进行来料检验
- 检验合格才能入库，不合格需要退货或让步接收
- 支持批量检验和快速检验
- 支持检验记录的追溯和统计

**用户操作：**
1. **创建来料检验单（方式1：从采购入库单下推，推荐）**
   - 进入"仓储管理" → "入库管理" → "采购入库单列表"
   - 选择采购入库单：入库-20260115-001（物料：原材料A，数量：1000kg）
   - 点击"创建来料检验单"按钮（一键下推）
   - **系统自动填充**：
     - 检验单号：QC-IN-20260115-001（自动生成）
     - 关联入库单：入库-20260115-001（自动关联）
     - 物料：原材料A（自动填充）
     - 数量：1000kg（自动填充）
     - 供应商：供应商A（自动填充）
     - **自动应用质检标准**：原材料A检验标准V1.0（基于物料关联的质检标准）
     - **自动显示检验项目**（基于质检标准）：
       - 检验项目1：外观检查（必检）
       - 检验项目2：重量检查（必检）
       - 检验项目3：成分检查（抽检，10%抽样）
   - **设置抽样数量**（如果质检标准配置为抽检）：
     - 批量：1000kg
     - 抽样标准：GB/T 2828.1-2012
     - 抽样数量：13个（系统自动计算，基于抽样标准）
     - 用户可修改抽样数量
   - 提交检验单

2. **创建来料检验单（方式2：手动创建）**
   - 进入"质量管理" → "来料检验" → "新建检验单"
   - 选择关联入库单：入库-20260115-001（可选）
   - 填写检验信息：
     - 物料：原材料A
     - 数量：1000kg
     - 供应商：供应商A
     - 选择质检标准：原材料A检验标准V1.0
   - 提交检验单

3. **执行来料检验（移动端/工位机触屏优化）**
   - 进入"质量管理" → "来料检验" → "待检验列表"
   - 选择检验单：QC-IN-20260115-001
   - **扫码检验**（推荐，最快）：
     - 扫描检验单二维码（自动识别检验单信息）
     - 系统自动显示检验项目和检验标准
   - **逐项检验**（核心功能）：
     - 检验项目1：外观检查
       - 检验方法：目视检查
       - 检验标准：表面无杂质、无破损
       - 检验结果：合格/不合格（大按钮选择，触屏优化）
       - 检验数量：13个（抽样数量）
       - 合格数量：12个（用户输入）
       - 不合格数量：1个（自动计算）
       - 不合格原因：表面有杂质（用户输入，大文本输入框）
       - 检验员：张三（自动填充，当前登录用户）
       - 检验时间：2026-01-15 10:30（自动记录）
     - 检验项目2：重量检查
       - 检验方法：电子秤称重
       - 检验标准：重量100±2g
       - 检验结果：合格/不合格（大按钮选择）
       - 检验数量：13个
       - 合格数量：13个
       - 不合格数量：0个
       - 检验员：张三
       - 检验时间：2026-01-15 10:35
     - 检验项目3：成分检查（抽检）
       - 检验方法：化学分析
       - 检验标准：成分符合要求
       - 检验结果：合格/不合格（大按钮选择）
       - 检验数量：2个（10%抽样，2个）
       - 合格数量：2个
       - 不合格数量：0个
       - 检验员：张三
       - 检验时间：2026-01-15 11:00
   - **系统自动判定**（核心功能，新增）：
     - 基于抽样规则和AQL值，自动判定检验结果
     - 如果合格数量≥抽样数量-1，判定合格
     - 如果合格数量<抽样数量-1，判定不合格
   - **提交检验结果**：
     - 系统自动计算合格率：92.3%（12/13）
     - 系统自动判定：合格（基于AQL值1.5，合格数量12≥13-1=12）
     - 用户可修改判定结果（如果系统判定有误）
     - 点击"提交"按钮

4. **检验结果处理**（核心功能，新增）
   - **情况1：检验合格**
     - 系统自动更新入库单状态：已检验合格
     - 系统自动允许入库（入库单状态更新为：可入库）
     - 通知仓库管理员：可以入库
   - **情况2：检验不合格（全部不合格）**
     - 系统自动更新入库单状态：已检验不合格
     - 系统自动阻止入库（入库单状态更新为：不可入库）
     - **不合格品处理**（核心功能，新增）：
       - 方式1：退货（推荐）
         - 创建退货单（自动关联入库单）
         - 通知供应商退货
         - 系统自动更新入库单状态：已退货
       - 方式2：让步接收（需要审批）
         - 创建让步接收申请单
         - 填写让步接收原因：不影响使用
         - 提交审批（部门经理审批）
         - 审批通过后，允许入库
         - 系统自动标记：让步接收物料
       - 方式3：供应商返工
         - 创建供应商返工单
         - 通知供应商返工
         - 返工完成后，重新检验
   - **情况3：检验不合格（部分不合格）**
     - 系统自动计算合格数量和不合格数量
     - 合格部分：允许入库
     - 不合格部分：按不合格品处理（退货/让步接收/供应商返工）

**系统行为：**
- ✅ **来料检验单创建**：
  - 支持从采购入库单下推（一键下推）
  - 支持手动创建
  - 自动应用质检标准（基于物料关联的质检标准）
  - 自动显示检验项目（基于质检标准）
  - 自动计算抽样数量（基于抽样标准）
- ✅ **来料检验执行**：
  - 支持移动端和工位机触屏模式（大按钮、大字体、触屏优化）
  - 支持扫码检验（扫描检验单二维码）
  - 支持逐项检验（检验项目逐项填写）
  - 自动记录检验员和检验时间
  - 自动计算合格率
- ✅ **检验结果自动判定**（核心功能，新增）：
  - 基于抽样规则和AQL值，自动判定检验结果
  - 支持用户修改判定结果
- ✅ **检验结果处理**：
  - 检验合格：自动允许入库
  - 检验不合格：自动阻止入库，触发不合格品处理流程
  - 部分不合格：合格部分允许入库，不合格部分按不合格品处理
- ✅ **不合格品处理**（核心功能，新增）：
  - 支持退货（创建退货单）
  - 支持让步接收（需要审批）
  - 支持供应商返工（创建供应商返工单）
- ✅ **检验记录追溯**：
  - 支持查询检验记录（按物料、供应商、时间段）
  - 支持检验记录统计（合格率、不合格率、不合格原因分析）
- 🤖 **AI智能建议**：
  - 基于历史数据，预测检验合格率
  - 检测检验异常，提示异常检验项目
  - 分析不合格原因，建议改进措施

**验收标准：**
- ✅ 来料检验单创建成功（支持从采购入库单下推和手动创建）
- ✅ 质检标准自动应用成功（基于物料关联的质检标准）
- ✅ 检验项目自动显示成功（基于质检标准）
- ✅ 抽样数量自动计算成功（基于抽样标准）
- ✅ 来料检验执行正常（移动端和工位机触屏优化）
- ✅ 检验结果自动判定正常（基于抽样规则和AQL值）
- ✅ 检验结果处理正常（检验合格允许入库，检验不合格阻止入库）
- ✅ 不合格品处理正常（退货、让步接收、供应商返工）
- ✅ 检验记录追溯正常（查询、统计）

---

#### 10.7.3 过程检验流程（核心功能，新增）

**应用场景：**
- 生产过程中，关键工序需要进行过程检验
- 检验合格才能继续下一工序，不合格需要返工或报废
- 支持在线检验和离线检验
- 支持检验记录的实时统计和分析

**用户操作：**
1. **配置过程检验点**（核心功能，新增）
   - 进入"质量管理" → "过程检验" → "检验点配置"
   - 选择工艺路线：产品A工艺路线
   - **设置检验点**：
     - 检验点1：注塑工序后检验
       - 关联工序：注塑工序
       - 检验时机：工序完成后（必检）
       - 检验标准：注塑件外观检验标准V1.0
       - 检验方式：全检/抽检（选择：抽检，10%抽样）
     - 检验点2：组装工序后检验
       - 关联工序：组装工序
       - 检验时机：工序完成后（必检）
       - 检验标准：组装件功能检验标准V1.0
       - 检验方式：全检
   - 保存检验点配置

2. **过程检验执行（与报工集成，核心功能）**
   - **方式1：报工时自动触发检验**（推荐，最简化）
     - 工人报工：注塑工序完成，完成数量：100个
     - **系统自动判断**：如果工序配置了检验点，自动创建过程检验单
     - 系统自动创建检验单：QC-PROC-20260115-001
     - **系统自动填充**：
       - 关联工单：工单-20260105-001（自动关联）
       - 关联工序：注塑工序（自动关联）
       - 关联报工记录：报工-20260115-001（自动关联）
       - 物料：产品A（自动填充）
       - 数量：100个（自动填充）
       - 检验标准：注塑件外观检验标准V1.0（自动应用）
       - 抽样数量：10个（自动计算，10%抽样）
     - **检验员执行检验**（移动端/工位机触屏优化）：
       - 进入"质量管理" → "过程检验" → "待检验列表"
       - 选择检验单：QC-PROC-20260115-001
       - 扫码检验（扫描检验单二维码）
       - 系统自动显示检验项目和检验标准
       - 逐项检验（同来料检验）
       - 提交检验结果
     - **系统自动处理**：
       - 检验合格：允许继续下一工序，自动更新报工记录状态：已检验合格
       - 检验不合格：阻止继续下一工序，自动更新报工记录状态：已检验不合格，触发返工流程

   - **方式2：独立创建过程检验单**（可选）
     - 进入"质量管理" → "过程检验" → "新建检验单"
     - 选择关联工单：工单-20260105-001
     - 选择关联工序：注塑工序
     - 系统自动应用检验标准
     - 提交检验单

3. **过程检验不合格处理**（核心功能，新增）
   - **情况1：返工处理**（推荐）
     - 检验不合格后，系统自动创建返工单
     - 返工单关联原工单和原工序
     - 返工完成后，重新检验
   - **情况2：报废处理**
     - 检验不合格后，创建报废单
     - 填写报废原因：无法返工
     - 系统自动更新工单数量（扣减报废数量）
     - 系统自动更新库存（不良品库存）
   - **情况3：让步接收**（需要审批）
     - 检验不合格后，创建让步接收申请单
     - 填写让步接收原因：不影响后续工序
     - 提交审批（部门经理审批）
     - 审批通过后，允许继续下一工序
     - 系统自动标记：让步接收工序

**系统行为：**
- ✅ **过程检验点配置**：
  - 支持在工艺路线中配置检验点
  - 支持关联工序和检验标准
  - 支持设置检验时机和检验方式
- ✅ **过程检验自动触发**（核心功能，新增）：
  - 报工时自动判断是否配置了检验点
  - 如果配置了检验点，自动创建过程检验单
  - 自动应用检验标准
  - 自动计算抽样数量
- ✅ **过程检验执行**：
  - 支持移动端和工位机触屏模式（大按钮、大字体、触屏优化）
  - 支持扫码检验（扫描检验单二维码）
  - 支持逐项检验（检验项目逐项填写）
  - 自动记录检验员和检验时间
- ✅ **过程检验结果处理**：
  - 检验合格：允许继续下一工序
  - 检验不合格：阻止继续下一工序，触发返工/报废/让步接收流程
- ✅ **过程检验不合格处理**（核心功能，新增）：
  - 支持返工处理（创建返工单）
  - 支持报废处理（创建报废单）
  - 支持让步接收（需要审批）
- ✅ **过程检验记录追溯**：
  - 支持查询检验记录（按工单、工序、时间段）
  - 支持检验记录统计（合格率、不合格率、不合格原因分析）
- 🤖 **AI智能建议**：
  - 基于历史数据，预测过程检验合格率
  - 检测检验异常，提示异常检验项目
  - 分析不合格原因，建议改进措施（如：调整工艺参数）

**验收标准：**
- ✅ 过程检验点配置成功（关联工序和检验标准）
- ✅ 过程检验自动触发正常（报工时自动创建检验单）
- ✅ 过程检验执行正常（移动端和工位机触屏优化）
- ✅ 过程检验结果处理正常（检验合格允许继续，检验不合格阻止继续）
- ✅ 过程检验不合格处理正常（返工、报废、让步接收）
- ✅ 过程检验记录追溯正常（查询、统计）

---

#### 10.7.4 成品检验流程（核心功能，新增）

**应用场景：**
- 生产完工后，需要进行成品最终检验
- 检验合格才能入库，不合格需要返工或报废
- 支持批量检验和快速检验
- 支持检验记录的追溯和统计

**用户操作：**
1. **创建成品检验单（方式1：从成品入库单下推，推荐）**
   - 进入"仓储管理" → "入库管理" → "成品入库单列表"
   - 选择成品入库单：入库-20260115-002（物料：产品A，数量：88个）
   - 点击"创建成品检验单"按钮（一键下推）
   - **系统自动填充**：
     - 检验单号：QC-FIN-20260115-001（自动生成）
     - 关联入库单：入库-20260115-002（自动关联）
     - 关联工单：工单-20260105-001（自动关联）
     - 物料：产品A（自动填充）
     - 数量：88个（自动填充）
     - **自动应用质检标准**：产品A成品检验标准V1.0（基于物料关联的质检标准）
     - **自动显示检验项目**（基于质检标准）：
       - 检验项目1：外观检查（必检）
       - 检验项目2：功能检查（必检）
       - 检验项目3：包装检查（必检）
   - 提交检验单

2. **执行成品检验（移动端/工位机触屏优化）**
   - 进入"质量管理" → "成品检验" → "待检验列表"
   - 选择检验单：QC-FIN-20260115-001
   - 扫码检验（扫描检验单二维码）
   - 系统自动显示检验项目和检验标准
   - 逐项检验（同来料检验）
   - 提交检验结果

3. **成品检验结果处理**（核心功能，新增）
   - **情况1：检验合格**
     - 系统自动更新入库单状态：已检验合格
     - 系统自动允许入库（入库单状态更新为：可入库）
     - 通知仓库管理员：可以入库
   - **情况2：检验不合格（全部不合格）**
     - 系统自动更新入库单状态：已检验不合格
     - 系统自动阻止入库（入库单状态更新为：不可入库）
     - **不合格品处理**（核心功能，新增）：
       - 方式1：返工处理（推荐）
         - 创建返工单（自动关联原工单）
         - 返工完成后，重新检验
       - 方式2：报废处理
         - 创建报废单
         - 填写报废原因：无法返工
         - 系统自动更新工单数量（扣减报废数量）
         - 系统自动更新库存（不良品库存）
       - 方式3：让步接收（需要审批）
         - 创建让步接收申请单
         - 填写让步接收原因：不影响使用
         - 提交审批（部门经理审批）
         - 审批通过后，允许入库
         - 系统自动标记：让步接收成品
   - **情况3：检验不合格（部分不合格）**
     - 系统自动计算合格数量和不合格数量
     - 合格部分：允许入库
     - 不合格部分：按不合格品处理（返工/报废/让步接收）

**系统行为：**
- ✅ **成品检验单创建**：
  - 支持从成品入库单下推（一键下推）
  - 支持手动创建
  - 自动应用质检标准（基于物料关联的质检标准）
  - 自动显示检验项目（基于质检标准）
- ✅ **成品检验执行**：
  - 支持移动端和工位机触屏模式（大按钮、大字体、触屏优化）
  - 支持扫码检验（扫描检验单二维码）
  - 支持逐项检验（检验项目逐项填写）
  - 自动记录检验员和检验时间
- ✅ **成品检验结果处理**：
  - 检验合格：自动允许入库
  - 检验不合格：自动阻止入库，触发不合格品处理流程
  - 部分不合格：合格部分允许入库，不合格部分按不合格品处理
- ✅ **不合格品处理**（核心功能，新增）：
  - 支持返工处理（创建返工单）
  - 支持报废处理（创建报废单）
  - 支持让步接收（需要审批）
- ✅ **检验记录追溯**：
  - 支持查询检验记录（按物料、工单、时间段）
  - 支持检验记录统计（合格率、不合格率、不合格原因分析）
- 🤖 **AI智能建议**：
  - 基于历史数据，预测成品检验合格率
  - 检测检验异常，提示异常检验项目
  - 分析不合格原因，建议改进措施

**验收标准：**
- ✅ 成品检验单创建成功（支持从成品入库单下推和手动创建）
- ✅ 质检标准自动应用成功（基于物料关联的质检标准）
- ✅ 成品检验执行正常（移动端和工位机触屏优化）
- ✅ 成品检验结果处理正常（检验合格允许入库，检验不合格阻止入库）
- ✅ 不合格品处理正常（返工、报废、让步接收）
- ✅ 检验记录追溯正常（查询、统计）

---

#### 10.7.5 不合格品处理流程（核心功能，新增）

**应用场景：**
- 来料检验、过程检验、成品检验发现不合格品，需要统一处理
- 支持不合格品的分类、追溯、统计
- 支持不合格品的返工、报废、让步接收等处理方式

**用户操作：**
1. **不合格品分类**（核心功能，新增）
   - 进入"质量管理" → "不合格品管理" → "不合格品列表"
   - 查看不合格品列表：
     - 不合格品1：来料检验不合格（原材料A，数量：100kg，不合格原因：成分不符合）
     - 不合格品2：过程检验不合格（产品A，数量：5个，不合格原因：外观不良）
     - 不合格品3：成品检验不合格（产品A，数量：2个，不合格原因：功能不良）
   - **不合格品分类**：
     - 严重不合格：影响功能，必须报废或返工
     - 一般不合格：不影响功能，可以让步接收或返工
     - 轻微不合格：不影响使用，可以让步接收

2. **不合格品处理**（核心功能，新增）
   - **方式1：退货处理**（来料检验不合格）
     - 选择不合格品：来料检验不合格（原材料A）
     - 点击"退货处理"按钮
     - 系统自动创建退货单（关联采购入库单）
     - 通知供应商退货
     - 系统自动更新入库单状态：已退货
   
   - **方式2：返工处理**（过程检验/成品检验不合格）
     - 选择不合格品：过程检验不合格（产品A，5个）
     - 点击"返工处理"按钮
     - 系统自动创建返工单（关联原工单和原工序）
     - 返工完成后，重新检验
   
   - **方式3：报废处理**（无法返工）
     - 选择不合格品：成品检验不合格（产品A，2个，功能不良）
     - 点击"报废处理"按钮
     - 填写报废原因：功能不良，无法返工
     - 系统自动创建报废单
     - 系统自动更新工单数量（扣减报废数量）
     - 系统自动更新库存（不良品库存）
   
   - **方式4：让步接收**（需要审批）
     - 选择不合格品：来料检验不合格（原材料A，100kg，轻微不合格）
     - 点击"让步接收"按钮
     - 填写让步接收原因：不影响使用
     - 提交审批（部门经理审批）
     - 审批通过后，允许入库
     - 系统自动标记：让步接收物料

3. **不合格品追溯**（核心功能，新增）
   - 进入"质量管理" → "不合格品管理" → "不合格品追溯"
   - 选择不合格品：成品检验不合格（产品A，2个）
   - **系统自动显示追溯信息**：
     - **上游追溯**：
       - 原工单：工单-20260105-001
       - 原工序：组装工序
       - 原材料：原材料A（供应商：供应商A）
       - 生产日期：2026-01-15
     - **下游追溯**：
       - 如果已处理：返工单/报废单/让步接收单
       - 处理时间：2026-01-16
       - 处理结果：已报废

4. **不合格品统计分析**（核心功能，新增）
   - 进入"质量管理" → "不合格品管理" → "不合格品统计"
   - 查看不合格品统计报表：
     - 按物料统计：产品A不合格率5%，产品B不合格率3%
     - 按供应商统计：供应商A不合格率8%，供应商B不合格率2%
     - 按不合格原因统计：外观不良60%，功能不良30%，成分不符合10%
     - 按时间段统计：1月份不合格率4%，2月份不合格率3%
   - 导出不合格品统计报表（Excel）

**系统行为：**
- ✅ **不合格品分类**：
  - 自动分类不合格品（严重不合格、一般不合格、轻微不合格）
  - 支持手动分类
- ✅ **不合格品处理**：
  - 支持退货处理（创建退货单）
  - 支持返工处理（创建返工单）
  - 支持报废处理（创建报废单）
  - 支持让步接收（需要审批）
- ✅ **不合格品追溯**：
  - 自动追溯不合格品的来源（工单、工序、原材料、供应商）
  - 自动追溯不合格品的处理结果（返工单、报废单、让步接收单）
- ✅ **不合格品统计分析**：
  - 自动统计不合格率（按物料、供应商、不合格原因、时间段）
  - 自动生成不合格品统计报表
  - 支持导出统计报表（Excel）
- 🤖 **AI智能建议**：
  - 基于历史数据，预测不合格率趋势
  - 分析不合格原因，建议改进措施
  - 识别不合格品高发物料和供应商，建议重点关注

**验收标准：**
- ✅ 不合格品分类正常（严重不合格、一般不合格、轻微不合格）
- ✅ 不合格品处理正常（退货、返工、报废、让步接收）
- ✅ 不合格品追溯正常（上游追溯、下游追溯）
- ✅ 不合格品统计分析正常（按物料、供应商、不合格原因、时间段统计）
- ✅ 不合格品统计报表正常（导出Excel）

---

#### 10.7.6 质检报表分析（核心功能，新增）

**应用场景：**
- 需要统计和分析质检数据，了解质量趋势
- 需要识别质量问题，提出改进措施
- 需要生成质检报表，支持决策

**用户操作：**
1. **质检合格率统计**
   - 进入"质量管理" → "质检报表" → "合格率统计"
   - 查看合格率统计报表：
     - 来料检验合格率：95%（按供应商统计）
     - 过程检验合格率：98%（按工序统计）
     - 成品检验合格率：97%（按物料统计）
   - 查看合格率趋势图（按时间段）
   - 导出合格率统计报表（Excel）

2. **不合格原因分析**
   - 进入"质量管理" → "质检报表" → "不合格原因分析"
   - 查看不合格原因分析报表：
     - 外观不良：60%（主要不合格原因）
     - 功能不良：30%
     - 成分不符合：10%
   - 查看不合格原因趋势图（按时间段）
   - 导出不合格原因分析报表（Excel）

3. **供应商质量分析**
   - 进入"质量管理" → "质检报表" → "供应商质量分析"
   - 查看供应商质量分析报表：
     - 供应商A：合格率92%，不合格率8%（重点关注）
     - 供应商B：合格率98%，不合格率2%（优质供应商）
   - 查看供应商质量趋势图（按时间段）
   - 导出供应商质量分析报表（Excel）

4. **质检成本分析**（核心功能，新增）
   - 进入"质量管理" → "质检报表" → "质检成本分析"
   - 查看质检成本分析报表：
     - 检验成本：按检验项目统计（人工成本、设备成本）
     - 不合格品成本：按不合格品统计（返工成本、报废成本、让步接收成本）
     - 质量成本趋势：按时间段统计
   - 导出质检成本分析报表（Excel）

**系统行为：**
- ✅ **质检报表生成**：
  - 自动统计合格率（来料检验、过程检验、成品检验）
  - 自动统计不合格率（按物料、供应商、不合格原因、时间段）
  - 自动生成质检报表（Excel）
- ✅ **质检数据分析**：
  - 自动分析不合格原因（主要不合格原因、次要不合格原因）
  - 自动分析供应商质量（优质供应商、重点关注供应商）
  - 自动分析质检成本（检验成本、不合格品成本）
- ✅ **质检报表可视化**：
  - 支持合格率趋势图（按时间段）
  - 支持不合格原因分析图（饼图、柱状图）
  - 支持供应商质量分析图（按时间段）
- 🤖 **AI智能建议**：
  - 基于历史数据，预测质量趋势
  - 识别质量问题，建议改进措施
  - 分析质检成本，建议成本优化方案

**验收标准：**
- ✅ 质检合格率统计正常（来料检验、过程检验、成品检验）
- ✅ 不合格原因分析正常（按物料、供应商、不合格原因、时间段）
- ✅ 供应商质量分析正常（按供应商统计）
- ✅ 质检成本分析正常（检验成本、不合格品成本）
- ✅ 质检报表导出正常（Excel）

---

**优化效果：**
- ⚡ **质检流程完整**：来料检验、过程检验、成品检验全覆盖
- ⚡ **质检标准管理**：支持质检标准版本管理，支持检验项目和抽样规则配置
- ⚡ **不合格品处理**：支持退货、返工、报废、让步接收等多种处理方式
- ⚡ **质检追溯**：支持不合格品追溯，快速定位问题源头
- ⚡ **质检报表**：支持合格率统计、不合格原因分析、供应商质量分析、质检成本分析
- ⚡ **系统自动化**：检验单自动创建、检验结果自动判定、不合格品自动处理

---

### 10.8 设备模具管理流程（完整场景推演，针对中国中小企业复杂场景）

#### 10.8.1 设备基础信息管理（核心功能，新增）

**应用场景：**
- 设备信息需要统一管理，包括设备基本信息、技术参数、供应商信息等
- 设备需要序列号管理，支持设备追溯
- 设备需要关联到工作中心，支持产能管理
- 支持设备的批量导入和快速创建

**用户操作：**
1. **创建设备（方式1：快速创建）**
   - 进入"设备管理" → "设备信息管理" → "新建设备"
   - 填写基本信息：
     - 设备编码：EQ-001（自动生成）
     - 设备名称：注塑机1
     - 设备类型：注塑机（选择）
     - 设备型号：ZSJ-500
     - 制造商：XX机械有限公司
     - 供应商：供应商A
     - 购买日期：2025-01-01
     - 购买价格：500000元
     - **序列号**：ZSJ-500-20250101-001（自动生成或手动输入）
     - **关联工作中心**：注塑机1（工作中心001）
   - **填写技术参数**（核心功能，新增）：
     - 最大注塑量：500g
     - 锁模力：500T
     - 最大开模行程：500mm
     - 工作压力：150MPa
     - 工作温度：180-220℃
     - 其他技术参数...
   - **设置设备状态**：
     - 设备状态：正常/故障/维修中/停用（选择：正常）
     - 设备位置：注塑车间1号位
   - 保存设备信息

2. **创建设备（方式2：批量导入）**
   - 进入"设备管理" → "设备信息管理" → "批量导入"
   - 打开设备导入universheet在线表格（系统自动创建模板）
   - 在universheet中填写设备数据（实时保存）：
     - 设备编码、设备名称、设备类型、设备型号、制造商、供应商、购买日期、购买价格、序列号、关联工作中心等
   - 点击"导入"按钮，系统自动导入

3. **设备信息查询和追溯**（核心功能，新增）
   - 进入"设备管理" → "设备信息管理" → "设备查询"
   - 输入设备编码或序列号：ZSJ-500-20250101-001
   - **系统自动显示设备完整信息**：
     - **设备基本信息**：
       - 设备编码：EQ-001
       - 设备名称：注塑机1
       - 设备型号：ZSJ-500
       - 序列号：ZSJ-500-20250101-001
     - **设备技术参数**：
       - 最大注塑量：500g
       - 锁模力：500T
     - **设备使用记录**：
       - 关联工单：工单-20260105-001、工单-20260106-001
       - 使用时间：2026-01-05 08:00-18:00
     - **设备维护记录**：
       - 2026-01-01：日常维护
       - 2026-02-01：定期保养
     - **设备故障记录**：
       - 2026-01-10：故障维修（已修复）

**系统行为：**
- ✅ **设备信息创建**：
  - 自动生成设备编码（基于编码规则）
  - 自动生成序列号（基于序列号规则）
  - 支持技术参数配置
  - 支持关联工作中心
- ✅ **设备信息查询和追溯**：
  - 支持按设备编码、序列号查询
  - 自动显示设备完整信息（基本信息、技术参数、使用记录、维护记录、故障记录）
- ✅ **批量导入**：支持universheet在线表格批量导入（实时保存）
- 🤖 **AI智能建议**：
  - 基于设备类型，建议技术参数配置
  - 检测设备信息完整性，提示缺失的关键信息

**验收标准：**
- ✅ 设备信息创建成功（支持快速创建和批量导入）
- ✅ 设备序列号管理正常（自动生成或手动输入）
- ✅ 设备技术参数配置成功
- ✅ 设备关联工作中心成功
- ✅ 设备信息查询和追溯正常（按设备编码、序列号查询）

---

#### 10.8.2 设备维护保养计划管理（核心功能，新增）

**应用场景：**
- 设备需要定期维护保养，确保设备正常运行
- 支持维护保养计划的自动生成和执行
- 支持维护保养记录的追溯和统计
- 支持维护保养提醒和预警

**用户操作：**
1. **创建维护保养计划（方式1：快速创建）**
   - 进入"设备管理" → "维护保养管理" → "维护保养计划"
   - 点击"新建计划"按钮
   - 填写计划信息：
     - 计划编码：MAINT-2026-001（自动生成）
     - 关联设备：注塑机1（EQ-001）
     - 计划类型：日常维护/定期保养/大修（选择：定期保养）
     - **维护保养周期**（核心功能，新增）：
       - 周期类型：按时间/按使用次数/按产量（选择：按时间）
       - 周期值：30天（每30天保养一次）
       - 或：按使用次数，每1000次注塑保养一次
       - 或：按产量，每10000件产品保养一次
     - **维护保养项目**（核心功能，新增）：
       - 项目1：清洁设备表面（必做）
       - 项目2：检查液压系统（必做）
       - 项目3：更换润滑油（必做）
       - 项目4：检查电气系统（可选）
     - **维护保养标准**（核心功能，新增）：
       - 清洁标准：表面无油污、无灰尘
       - 液压系统标准：压力正常、无泄漏
       - 润滑油标准：油位正常、油质良好
     - 预计耗时：2小时
     - 计划开始时间：2026-01-01
     - 计划结束时间：2026-12-31（年度计划）
   - 保存维护保养计划

2. **创建维护保养计划（方式2：从模板创建）**
   - 进入"设备管理" → "维护保养管理" → "维护保养计划" → "从模板创建"
   - 选择设备类型：注塑机
   - 选择维护保养模板：注塑机定期保养模板
   - 系统自动填充维护保养项目和标准
   - 用户可修改维护保养项目和标准
   - 保存为新的维护保养计划

3. **维护保养计划自动生成**（核心功能，新增）
   - 系统根据维护保养周期，自动生成维护保养任务
   - 示例：注塑机1，每30天保养一次
     - 第1次：2026-01-01（自动生成）
     - 第2次：2026-01-31（自动生成）
     - 第3次：2026-03-02（自动生成）
     - ...（自动生成全年计划）

4. **维护保养提醒和预警**（核心功能，新增）
   - 系统自动提醒：
     - 提前3天提醒：注塑机1需要保养（2026-01-28提醒，计划2026-01-31保养）
     - 到期提醒：注塑机1保养已到期（2026-01-31提醒）
     - 超期预警：注塑机1保养已超期3天（2026-02-03预警）
   - 提醒方式：系统消息、邮件、短信（可选）

5. **执行维护保养**（移动端/工位机触屏优化）
   - 进入"设备管理" → "维护保养管理" → "待执行任务"
   - 选择维护保养任务：注塑机1定期保养（2026-01-31）
   - 扫码执行（扫描设备二维码）
   - **逐项执行维护保养项目**（核心功能）：
     - 项目1：清洁设备表面
       - 执行状态：已完成/未完成（大按钮选择，触屏优化）
       - 执行结果：符合标准/不符合标准（大按钮选择）
       - 执行时间：2026-01-31 08:00（自动记录）
       - 执行人：张三（自动填充，当前登录用户）
       - 备注：正常清洁（大文本输入框，可选）
     - 项目2：检查液压系统
       - 执行状态：已完成
       - 执行结果：符合标准
       - 执行时间：2026-01-31 08:30
       - 执行人：张三
     - 项目3：更换润滑油
       - 执行状态：已完成
       - 执行结果：符合标准
       - 执行时间：2026-01-31 09:00
       - 执行人：张三
   - **提交维护保养记录**：
     - 系统自动计算实际耗时：2小时
     - 系统自动更新设备状态：正常
     - 系统自动生成下次维护保养任务（2026-02-29）

**系统行为：**
- ✅ **维护保养计划创建**：
  - 支持快速创建和模板创建
  - 支持维护保养周期配置（按时间/按使用次数/按产量）
  - 支持维护保养项目配置
  - 支持维护保养标准配置
- ✅ **维护保养计划自动生成**（核心功能，新增）：
  - 根据维护保养周期，自动生成维护保养任务
  - 支持年度计划自动生成
- ✅ **维护保养提醒和预警**（核心功能，新增）：
  - 提前提醒（提前3天）
  - 到期提醒（到期当天）
  - 超期预警（超期后持续提醒）
- ✅ **维护保养执行**：
  - 支持移动端和工位机触屏模式（大按钮、大字体、触屏优化）
  - 支持扫码执行（扫描设备二维码）
  - 支持逐项执行维护保养项目
  - 自动记录执行人和执行时间
- ✅ **维护保养记录追溯**：
  - 支持查询维护保养记录（按设备、时间段）
  - 支持维护保养记录统计（执行率、超期率）
- 🤖 **AI智能建议**：
  - 基于设备使用情况，建议维护保养周期
  - 基于历史数据，预测设备故障风险
  - 检测维护保养异常，提示重点关注项目

**验收标准：**
- ✅ 维护保养计划创建成功（支持快速创建和模板创建）
- ✅ 维护保养周期配置成功（按时间/按使用次数/按产量）
- ✅ 维护保养计划自动生成正常（根据周期自动生成任务）
- ✅ 维护保养提醒和预警正常（提前提醒、到期提醒、超期预警）
- ✅ 维护保养执行正常（移动端和工位机触屏优化）
- ✅ 维护保养记录追溯正常（查询、统计）

---

#### 10.8.3 设备故障处理流程（核心功能，新增）

**应用场景：**
- 设备故障需要及时处理，减少停机时间
- 支持故障报修、故障诊断、故障维修、故障验收等完整流程
- 支持故障记录的追溯和统计
- 支持故障预警和预防性维护

**用户操作：**
1. **故障报修**（移动端/工位机触屏优化）
   - 进入"设备管理" → "故障管理" → "故障报修"
   - 选择设备：注塑机1（EQ-001）
   - 扫码报修（扫描设备二维码）
   - 填写故障信息：
     - 故障类型：机械故障/电气故障/液压故障/其他（选择：液压故障）
     - 故障描述：液压系统压力不足（大文本输入框，触屏优化）
     - 故障发生时间：2026-01-15 10:00（自动记录）
     - 报修人：张三（自动填充，当前登录用户）
     - 紧急程度：紧急/一般/不紧急（选择：紧急）
   - 提交故障报修单
   - **系统自动处理**：
     - 自动更新设备状态：故障
     - 自动通知维修人员（系统消息、短信）
     - 自动创建故障维修单

2. **故障诊断**（核心功能，新增）
   - 进入"设备管理" → "故障管理" → "故障诊断"
   - 选择故障报修单：故障-20260115-001
   - **填写诊断信息**：
     - 诊断结果：液压泵故障（大文本输入框）
     - 故障原因：液压泵磨损严重（大文本输入框）
     - 诊断时间：2026-01-15 10:30（自动记录）
     - 诊断人：李四（维修工程师，自动填充）
     - **预计维修时间**：2小时（用户输入）
     - **需要备件**：液压泵（备件编码：SP-001）（用户选择）
   - 提交诊断结果
   - **系统自动处理**：
     - 自动检查备件库存（液压泵库存：1个，充足）
     - 如果备件不足，自动创建备件采购单
     - 自动更新故障维修单状态：已诊断

3. **故障维修**（移动端/工位机触屏优化）
   - 进入"设备管理" → "故障管理" → "故障维修"
   - 选择故障维修单：维修-20260115-001
   - 扫码维修（扫描设备二维码）
   - **填写维修信息**：
     - 维修开始时间：2026-01-15 11:00（自动记录）
     - 维修项目：更换液压泵（大文本输入框）
     - 使用备件：液压泵（SP-001，数量：1个）（自动关联）
     - 维修过程：拆卸旧液压泵，安装新液压泵（大文本输入框）
     - 维修结束时间：2026-01-15 13:00（自动记录）
     - 实际维修时间：2小时（自动计算）
     - 维修人：李四（自动填充）
   - 提交维修记录

4. **故障验收**（核心功能，新增）
   - 进入"设备管理" → "故障管理" → "故障验收"
   - 选择故障维修单：维修-20260115-001
   - **填写验收信息**：
     - 验收结果：合格/不合格（大按钮选择，触屏优化）
     - 验收时间：2026-01-15 13:30（自动记录）
     - 验收人：王五（设备管理员，自动填充）
     - 验收说明：设备运行正常（大文本输入框）
   - 提交验收结果
   - **系统自动处理**：
     - 验收合格：自动更新设备状态：正常
     - 验收不合格：自动更新故障维修单状态：需要重新维修
     - 自动更新设备使用记录（故障时间、维修时间、停机时间）

5. **故障统计分析**（核心功能，新增）
   - 进入"设备管理" → "故障管理" → "故障统计"
   - 查看故障统计报表：
     - 按设备统计：注塑机1故障次数5次，注塑机2故障次数3次
     - 按故障类型统计：液压故障60%，电气故障30%，机械故障10%
     - 按时间段统计：1月份故障次数8次，2月份故障次数5次
     - 平均故障处理时间：2.5小时
     - 设备可用率：95%（按时间段统计）
   - 导出故障统计报表（Excel）

**系统行为：**
- ✅ **故障报修**：
  - 支持移动端和工位机触屏模式（大按钮、大字体、触屏优化）
  - 支持扫码报修（扫描设备二维码）
  - 自动更新设备状态：故障
  - 自动通知维修人员
- ✅ **故障诊断**（核心功能，新增）：
  - 支持故障诊断记录
  - 自动检查备件库存
  - 如果备件不足，自动创建备件采购单
- ✅ **故障维修**：
  - 支持移动端和工位机触屏模式（大按钮、大字体、触屏优化）
  - 支持扫码维修（扫描设备二维码）
  - 自动关联备件使用记录
  - 自动计算维修时间
- ✅ **故障验收**（核心功能，新增）：
  - 支持故障验收记录
  - 验收合格：自动更新设备状态：正常
  - 验收不合格：需要重新维修
- ✅ **故障统计分析**（核心功能，新增）：
  - 自动统计故障次数（按设备、故障类型、时间段）
  - 自动统计平均故障处理时间
  - 自动计算设备可用率
  - 支持导出故障统计报表（Excel）
- 🤖 **AI智能建议**：
  - 基于历史数据，预测设备故障风险
  - 分析故障原因，建议预防性维护措施
  - 识别故障高发设备，建议重点关注

**验收标准：**
- ✅ 故障报修正常（移动端和工位机触屏优化）
- ✅ 故障诊断正常（诊断记录、备件检查）
- ✅ 故障维修正常（移动端和工位机触屏优化）
- ✅ 故障验收正常（验收记录、设备状态更新）
- ✅ 故障统计分析正常（按设备、故障类型、时间段统计）

---

#### 10.8.4 模具管理流程（核心功能，新增）

**应用场景：**
- 模具需要统一管理，包括模具基本信息、使用寿命、维护记录等
- 模具需要关联到产品和工单，支持模具追溯
- 支持模具寿命管理，到期自动提醒更换
- 支持模具维护保养和故障处理

**用户操作：**
1. **创建模具（方式1：快速创建）**
   - 进入"设备管理" → "模具管理" → "新建模具"
   - 填写基本信息：
     - 模具编码：MOLD-001（自动生成）
     - 模具名称：产品A注塑模具
     - 模具类型：注塑模具（选择）
     - 关联产品：产品A（选择）
     - 模具规格：500mm×500mm×200mm
     - 制造商：XX模具厂
     - 供应商：供应商B
     - 购买日期：2025-01-01
     - 购买价格：100000元
     - **序列号**：MOLD-A-20250101-001（自动生成或手动输入）
     - **使用寿命**（核心功能，新增）：
       - 使用寿命类型：按使用次数/按使用时间/按产量（选择：按使用次数）
       - 使用寿命值：100000次（使用100000次后需要更换）
       - 或：按使用时间，使用2年后需要更换
       - 或：按产量，生产1000000件产品后需要更换
     - **当前使用情况**（核心功能，新增）：
       - 已使用次数：50000次（自动统计，基于报工记录）
       - 已使用时间：1年（自动统计）
       - 已生产产量：500000件（自动统计）
       - 剩余使用寿命：50000次（自动计算）
     - **模具状态**：
       - 模具状态：正常/维修中/报废（选择：正常）
       - 模具位置：注塑车间模具库
   - 保存模具信息

2. **模具使用记录**（核心功能，新增）
   - 进入"设备管理" → "模具管理" → "模具使用记录"
   - 选择模具：产品A注塑模具（MOLD-001）
   - **系统自动显示使用记录**：
     - 使用记录1：工单-20260105-001，使用次数：1000次，使用时间：2026-01-05 08:00-18:00
     - 使用记录2：工单-20260106-001，使用次数：1500次，使用时间：2026-01-06 08:00-18:00
     - ...（自动统计，基于工单和报工记录）
   - **系统自动更新**：
     - 已使用次数：自动累加（基于报工记录）
     - 已使用时间：自动累加（基于工单时间）
     - 已生产产量：自动累加（基于报工合格数量）
     - 剩余使用寿命：自动计算（使用寿命值-已使用次数）

3. **模具寿命提醒和预警**（核心功能，新增）
   - 系统自动提醒：
     - 提前10%提醒：产品A注塑模具剩余使用寿命10%（已使用90000次，剩余10000次）
     - 提前5%提醒：产品A注塑模具剩余使用寿命5%（已使用95000次，剩余5000次）
     - 到期提醒：产品A注塑模具使用寿命已到期（已使用100000次）
   - 提醒方式：系统消息、邮件、短信（可选）

4. **模具维护保养**（核心功能，新增）
   - 进入"设备管理" → "模具管理" → "模具维护保养"
   - 选择模具：产品A注塑模具（MOLD-001）
   - 创建维护保养记录：
     - 维护保养类型：日常维护/定期保养/大修（选择：定期保养）
     - 维护保养项目：清洁模具、检查模具磨损、更换易损件
     - 维护保养时间：2026-01-15 08:00-10:00
     - 维护保养人：张三（自动填充）
     - 维护保养结果：正常/异常（选择：正常）
   - 提交维护保养记录
   - **系统自动更新**：
     - 自动更新模具状态：正常
     - 自动记录维护保养历史

5. **模具故障处理**（核心功能，新增）
   - 进入"设备管理" → "模具管理" → "模具故障处理"
   - 选择模具：产品A注塑模具（MOLD-001）
   - 创建故障记录：
     - 故障类型：模具磨损/模具损坏/其他（选择：模具磨损）
     - 故障描述：模具表面磨损严重（大文本输入框）
     - 故障发生时间：2026-01-15 10:00（自动记录）
     - 报修人：张三（自动填充）
   - 提交故障记录
   - **系统自动处理**：
     - 自动更新模具状态：维修中
     - 自动通知维修人员
     - 自动创建模具维修单

6. **模具报废处理**（核心功能，新增）
   - 进入"设备管理" → "模具管理" → "模具报废"
   - 选择模具：产品A注塑模具（MOLD-001）
   - 创建报废记录：
     - 报废原因：使用寿命到期/无法修复/其他（选择：使用寿命到期）
     - 报废时间：2026-01-20（自动记录）
     - 报废人：王五（设备管理员，自动填充）
   - 提交报废记录
   - **系统自动处理**：
     - 自动更新模具状态：报废
     - 自动更新模具使用记录（停止使用）
     - 自动通知相关人员（需要采购新模具）

**系统行为：**
- ✅ **模具信息创建**：
  - 自动生成模具编码（基于编码规则）
  - 自动生成序列号（基于序列号规则）
  - 支持使用寿命配置（按使用次数/按使用时间/按产量）
  - 支持关联产品
- ✅ **模具使用记录**（核心功能，新增）：
  - 自动统计已使用次数（基于报工记录）
  - 自动统计已使用时间（基于工单时间）
  - 自动统计已生产产量（基于报工合格数量）
  - 自动计算剩余使用寿命
- ✅ **模具寿命提醒和预警**（核心功能，新增）：
  - 提前10%提醒
  - 提前5%提醒
  - 到期提醒
- ✅ **模具维护保养**（核心功能，新增）：
  - 支持维护保养记录
  - 自动更新模具状态
- ✅ **模具故障处理**（核心功能，新增）：
  - 支持故障记录
  - 自动更新模具状态：维修中
  - 自动通知维修人员
- ✅ **模具报废处理**（核心功能，新增）：
  - 支持报废记录
  - 自动更新模具状态：报废
  - 自动通知相关人员
- 🤖 **AI智能建议**：
  - 基于使用情况，预测模具寿命
  - 分析模具故障原因，建议预防性维护措施
  - 识别模具高发故障，建议重点关注

**验收标准：**
- ✅ 模具信息创建成功（支持快速创建和批量导入）
- ✅ 模具使用寿命配置成功（按使用次数/按使用时间/按产量）
- ✅ 模具使用记录正常（自动统计已使用次数、已使用时间、已生产产量）
- ✅ 模具寿命提醒和预警正常（提前10%、提前5%、到期提醒）
- ✅ 模具维护保养正常（维护保养记录、模具状态更新）
- ✅ 模具故障处理正常（故障记录、模具状态更新）
- ✅ 模具报废处理正常（报废记录、模具状态更新）

---

#### 10.8.5 设备OEE统计（核心功能，新增）

**应用场景：**
- OEE（设备综合效率）是衡量设备效率的重要指标
- 需要统计设备的可用率、性能率、合格率，计算OEE
- 支持设备OEE的实时监控和历史分析
- 支持设备OEE的对比和优化建议

**用户操作：**
1. **设备OEE实时监控**
   - 进入"设备管理" → "设备OEE" → "实时监控"
   - 选择设备：注塑机1（EQ-001）
   - **系统自动显示OEE数据**：
     - **可用率（Availability）**：95%
       - 计划生产时间：8小时（480分钟）
       - 实际生产时间：7.6小时（456分钟）
       - 停机时间：24分钟（故障停机10分钟，维护保养14分钟）
       - 可用率 = 实际生产时间 / 计划生产时间 = 456 / 480 = 95%
     - **性能率（Performance）**：90%
       - 标准产量：100件/小时
       - 实际产量：90件/小时
       - 性能率 = 实际产量 / 标准产量 = 90 / 100 = 90%
     - **合格率（Quality）**：98%
       - 总产量：720件（8小时×90件/小时）
       - 合格数量：706件
       - 不合格数量：14件
       - 合格率 = 合格数量 / 总产量 = 706 / 720 = 98%
     - **OEE（设备综合效率）**：83.79%
       - OEE = 可用率 × 性能率 × 合格率 = 95% × 90% × 98% = 83.79%

2. **设备OEE历史分析**
   - 进入"设备管理" → "设备OEE" → "历史分析"
   - 选择设备：注塑机1（EQ-001）
   - 选择时间段：2026年1月
   - **系统自动显示OEE历史数据**：
     - 1月1日：OEE 85%，可用率96%，性能率90%，合格率98%
     - 1月2日：OEE 82%，可用率95%，性能率88%，合格率98%
     - 1月3日：OEE 80%，可用率94%，性能率87%，合格率98%
     - ...（按日期统计）
   - **查看OEE趋势图**：
     - OEE趋势：1月份平均OEE 83%，呈上升趋势
     - 可用率趋势：1月份平均可用率95%，稳定
     - 性能率趋势：1月份平均性能率89%，呈上升趋势
     - 合格率趋势：1月份平均合格率98%，稳定

3. **设备OEE对比分析**（核心功能，新增）
   - 进入"设备管理" → "设备OEE" → "对比分析"
   - 选择对比设备：注塑机1、注塑机2、注塑机3
   - 选择时间段：2026年1月
   - **系统自动显示OEE对比数据**：
     - 注塑机1：OEE 83%，可用率95%，性能率90%，合格率98%
     - 注塑机2：OEE 88%，可用率97%，性能率92%，合格率98%
     - 注塑机3：OEE 80%，可用率94%，性能率88%，合格率97%
   - **查看OEE对比图**：
     - 柱状图对比：注塑机2 OEE最高，注塑机3 OEE最低
     - 识别OEE差异原因：注塑机2可用率和性能率较高

4. **设备OEE优化建议**（核心功能，新增）
   - 进入"设备管理" → "设备OEE" → "优化建议"
   - 选择设备：注塑机1（EQ-001）
   - **系统自动分析并显示优化建议**：
     - **可用率优化建议**：
       - 当前可用率：95%，目标：97%
       - 建议：减少故障停机时间（当前平均故障处理时间2.5小时，建议优化到2小时）
       - 建议：优化维护保养计划（当前维护保养频率30天，建议优化到25天）
     - **性能率优化建议**：
       - 当前性能率：90%，目标：95%
       - 建议：优化生产工艺参数（当前生产速度90件/小时，建议优化到95件/小时）
       - 建议：减少换模时间（当前平均换模时间30分钟，建议优化到20分钟）
     - **合格率优化建议**：
       - 当前合格率：98%，目标：99%
       - 建议：加强过程检验（当前过程检验合格率98%，建议加强检验）
       - 建议：优化工艺参数（当前工艺参数可能导致不合格，建议调整）

**系统行为：**
- ✅ **设备OEE实时统计**（核心功能，新增）：
  - 自动统计可用率（基于计划生产时间、实际生产时间、停机时间）
  - 自动统计性能率（基于标准产量、实际产量）
  - 自动统计合格率（基于总产量、合格数量、不合格数量）
  - 自动计算OEE（可用率 × 性能率 × 合格率）
- ✅ **设备OEE历史分析**（核心功能，新增）：
  - 自动统计OEE历史数据（按日期、按周、按月）
  - 自动生成OEE趋势图
  - 支持OEE历史数据导出（Excel）
- ✅ **设备OEE对比分析**（核心功能，新增）：
  - 支持多设备OEE对比
  - 自动生成OEE对比图
  - 识别OEE差异原因
- ✅ **设备OEE优化建议**（核心功能，新增）：
  - 自动分析OEE瓶颈（可用率、性能率、合格率）
  - 自动生成优化建议（基于历史数据和最佳实践）
  - 支持OEE优化目标设置
- 🤖 **AI智能建议**：
  - 基于历史数据，预测OEE趋势
  - 分析OEE瓶颈，建议优化措施
  - 识别OEE异常，建议重点关注

**验收标准：**
- ✅ 设备OEE实时统计正常（可用率、性能率、合格率、OEE）
- ✅ 设备OEE历史分析正常（按日期、按周、按月统计）
- ✅ 设备OEE对比分析正常（多设备对比）
- ✅ 设备OEE优化建议正常（可用率、性能率、合格率优化建议）

---

**优化效果：**
- ⚡ **设备管理完整**：设备信息管理、维护保养计划、故障处理、模具管理全覆盖
- ⚡ **设备维护自动化**：维护保养计划自动生成、提醒预警、执行记录自动统计
- ⚡ **设备故障处理**：故障报修、诊断、维修、验收完整流程
- ⚡ **模具管理**：模具使用寿命管理、使用记录自动统计、寿命提醒预警
- ⚡ **设备OEE统计**：实时监控、历史分析、对比分析、优化建议
- ⚡ **系统自动化**：设备状态自动更新、使用记录自动统计、OEE自动计算

### 10.9 企业上下游协同流程（核心功能，新增，增强企业上下游协同）

#### 10.9.1 供应商协同（核心功能，新增）

**应用场景：**
- 需要与供应商实时协同，提高采购效率
- 供应商需要实时了解采购订单、交货要求、质量要求
- 供应商需要实时更新采购订单进度、交货状态
- 需要与供应商协同处理质量问题、退货问题

**用户操作：**
1. **采购订单下发到供应商协同平台**（核心功能，新增）
   - 进入"快智造" → "采购管理" → "采购订单管理" → "采购订单列表"
   - 选择采购订单：采购-20260105-001（物料：原材料A，数量：1000kg，供应商：供应商A）
   - 点击"下发到供应商协同平台"按钮
   - **系统自动处理**：
     - 自动发送采购订单到供应商协同平台
     - 供应商在协同平台接收采购订单
     - 供应商确认接收采购订单
     - 系统自动更新采购订单状态：已下发
     - 自动通知相关人员（采购员、仓库管理员）

2. **供应商更新采购订单进度**（核心功能，新增）
   - 供应商在协同平台更新采购订单进度：
     - 采购订单：采购-20260105-001
     - 生产进度：60%（供应商在协同平台更新）
     - 预计交货时间：2026-01-15（供应商在协同平台更新）
     - 交货数量：1000kg（供应商在协同平台更新）
   - **系统自动同步**（核心功能，新增）：
     - 自动从供应商协同平台同步采购订单进度
     - 自动更新采购订单进度
     - 自动更新MRP运算结果（采购在途库存）
     - 自动通知相关人员（采购进度更新）

3. **供应商提交发货通知**（核心功能，新增）
   - 供应商在协同平台提交发货通知：
     - 采购订单：采购-20260105-001
     - 发货数量：1000kg
     - 发货时间：2026-01-15 08:00
     - 物流信息：物流公司A，物流单号：WL-20260115-001
   - **系统自动处理**（核心功能，新增）：
     - 自动接收供应商发货通知
     - 自动创建采购入库单（待入库状态）
     - 自动更新采购订单状态：已发货
     - 自动通知仓库管理员（准备收货）

4. **供应商协同处理质量问题**（核心功能，新增）
   - 来料检验发现质量问题
   - 进入"质量管理" → "来料检验" → "不合格品处理"
   - 选择不合格品：来料检验不合格（原材料A，数量：100kg）
   - 点击"退货处理"按钮
   - **系统自动处理**（核心功能，新增）：
     - 自动创建退货单
     - 自动发送退货通知到供应商协同平台
     - 供应商在协同平台接收退货通知
     - 供应商确认退货并安排退货处理
     - 系统自动更新退货单状态：供应商已确认

5. **供应商协同处理对账**（核心功能，新增）
   - 进入"快智造" → "财务协同" → "应付管理" → "供应商对账"
   - 选择供应商：供应商A
   - 选择时间段：2026年1月
   - **系统自动生成对账单**（核心功能，新增）：
     - 采购订单列表：采购-20260105-001、采购-20260106-001
     - 采购金额：50000元
     - 已付款金额：30000元
     - 未付款金额：20000元
   - 点击"发送对账单到供应商协同平台"按钮
   - **系统自动处理**（核心功能，新增）：
     - 自动发送对账单到供应商协同平台
     - 供应商在协同平台查看对账单
     - 供应商确认对账单（如有异议，可提出）
     - 系统自动更新对账单状态：供应商已确认

**系统行为：**
- ✅ **采购订单下发**（核心功能，新增）：
  - 自动发送采购订单到供应商协同平台
  - 供应商在协同平台接收和确认采购订单
  - 自动更新采购订单状态
- ✅ **采购订单进度同步**（核心功能，新增）：
  - 供应商在协同平台实时更新采购订单进度
  - 系统自动同步采购订单进度
  - 自动更新MRP运算结果（采购在途库存）
- ✅ **发货通知处理**（核心功能，新增）：
  - 供应商在协同平台提交发货通知
  - 系统自动接收发货通知
  - 自动创建采购入库单
  - 自动更新采购订单状态
- ✅ **质量问题协同处理**（核心功能，新增）：
  - 自动发送退货通知到供应商协同平台
  - 供应商在协同平台接收和确认退货通知
  - 自动更新退货单状态
- ✅ **对账协同处理**（核心功能，新增）：
  - 自动生成对账单
  - 自动发送对账单到供应商协同平台
  - 供应商在协同平台查看和确认对账单
  - 自动更新对账单状态
- 🤖 **AI智能建议**：
  - 基于历史数据，预测供应商交货时间
  - 分析供应商绩效，建议供应商选择
  - 识别供应商风险，建议应对措施

**验收标准：**
- ✅ 采购订单下发正常（发送到供应商协同平台）
- ✅ 采购订单进度同步正常（供应商更新进度，系统自动同步）
- ✅ 发货通知处理正常（供应商提交发货通知，系统自动创建入库单）
- ✅ 质量问题协同处理正常（退货通知发送到供应商协同平台）
- ✅ 对账协同处理正常（对账单发送到供应商协同平台）

---

#### 10.9.2 客户协同（核心功能，新增）

**应用场景：**
- 需要与客户实时协同，提高销售效率
- 客户需要实时了解销售订单、生产进度、交货状态
- 客户需要实时更新订单变更、交货要求
- 需要与客户协同处理质量问题、退货问题

**用户操作：**
1. **销售订单下发到客户协同平台**（核心功能，新增）
   - 进入"快智造" → "销售管理" → "销售订单管理" → "销售订单列表"
   - 选择销售订单：订单-20260105-001（产品：产品A，数量：100个，客户：客户A）
   - 点击"下发到客户协同平台"按钮
   - **系统自动处理**：
     - 自动发送销售订单到客户协同平台
     - 客户在协同平台接收销售订单
     - 客户确认接收销售订单
     - 系统自动更新销售订单状态：已下发
     - 自动通知相关人员（销售员、生产管理员）

2. **客户查看生产进度**（核心功能，新增）
   - 客户在协同平台查看生产进度：
     - 销售订单：订单-20260105-001
     - 关联工单：工单-20260105-001
     - 生产进度：60%（系统自动更新）
     - 预计完工时间：2026-01-15（系统自动更新）
     - 预计交货时间：2026-01-16（系统自动更新）
   - **系统自动同步**（核心功能，新增）：
     - 自动从系统同步生产进度到客户协同平台
     - 客户实时查看生产进度
     - 客户可以提出交货要求变更

3. **客户提交订单变更**（核心功能，新增）
   - 客户在协同平台提交订单变更申请：
     - 销售订单：订单-20260105-001
     - 变更类型：数量变更/交期变更/其他（选择：数量变更）
     - 变更内容：数量从100个变更为120个
     - 变更原因：客户需求增加（客户输入）
   - **系统自动处理**（核心功能，新增）：
     - 自动接收客户订单变更申请
     - 自动检查变更可行性（检查物料、产能、交期）
     - 自动生成变更影响分析（影响哪些工单、影响程度）
     - 自动发送变更申请到审批流程
     - 审批通过后，自动更新销售订单和工单

4. **客户提交发货通知**（核心功能，新增）
   - 生产完工后，系统自动通知客户准备发货
   - 客户在协同平台确认发货：
     - 销售订单：订单-20260105-001
     - 发货数量：100个
     - 发货地址：客户A地址（自动填充）
     - 发货时间：2026-01-16 08:00（客户选择）
   - **系统自动处理**（核心功能，新增）：
     - 自动接收客户发货确认
     - 自动创建销售出库单
     - 自动更新销售订单状态：待发货
     - 自动通知仓库管理员（准备发货）

5. **客户协同处理质量问题**（核心功能，新增）
   - 客户收货后发现质量问题
   - 客户在协同平台提交质量问题反馈：
     - 销售订单：订单-20260105-001
     - 问题类型：外观不良/功能不良/其他（选择：外观不良）
     - 问题描述：产品表面有划痕（客户输入）
     - 问题数量：5个
   - **系统自动处理**（核心功能，新增）：
     - 自动接收客户质量问题反馈
     - 自动创建质量问题处理单
     - 自动发送质量问题处理单到质量部门
     - 质量部门处理质量问题（退货、换货、返工等）
     - 系统自动更新质量问题处理单状态

6. **客户协同处理对账**（核心功能，新增）
   - 进入"快智造" → "财务协同" → "应收管理" → "客户对账"
   - 选择客户：客户A
   - 选择时间段：2026年1月
   - **系统自动生成对账单**（核心功能，新增）：
     - 销售订单列表：订单-20260105-001、订单-20260106-001
     - 销售金额：100000元
     - 已收款金额：60000元
     - 未收款金额：40000元
   - 点击"发送对账单到客户协同平台"按钮
   - **系统自动处理**（核心功能，新增）：
     - 自动发送对账单到客户协同平台
     - 客户在协同平台查看对账单
     - 客户确认对账单（如有异议，可提出）
     - 系统自动更新对账单状态：客户已确认

**系统行为：**
- ✅ **销售订单下发**（核心功能，新增）：
  - 自动发送销售订单到客户协同平台
  - 客户在协同平台接收和确认销售订单
  - 自动更新销售订单状态
- ✅ **生产进度同步**（核心功能，新增）：
  - 自动从系统同步生产进度到客户协同平台
  - 客户实时查看生产进度
  - 客户可以提出交货要求变更
- ✅ **订单变更协同处理**（核心功能，新增）：
  - 客户在协同平台提交订单变更申请
  - 系统自动接收订单变更申请
  - 自动检查变更可行性
  - 自动生成变更影响分析
  - 自动发送变更申请到审批流程
- ✅ **发货通知协同处理**（核心功能，新增）：
  - 客户在协同平台确认发货
  - 系统自动接收客户发货确认
  - 自动创建销售出库单
  - 自动更新销售订单状态
- ✅ **质量问题协同处理**（核心功能，新增）：
  - 客户在协同平台提交质量问题反馈
  - 系统自动接收质量问题反馈
  - 自动创建质量问题处理单
  - 自动发送质量问题处理单到质量部门
- ✅ **对账协同处理**（核心功能，新增）：
  - 自动生成对账单
  - 自动发送对账单到客户协同平台
  - 客户在协同平台查看和确认对账单
  - 自动更新对账单状态
- 🤖 **AI智能建议**：
  - 基于历史数据，预测客户订单变更概率
  - 分析客户需求，建议销售策略
  - 识别客户风险，建议应对措施

**验收标准：**
- ✅ 销售订单下发正常（发送到客户协同平台）
- ✅ 生产进度同步正常（系统同步进度到客户协同平台）
- ✅ 订单变更协同处理正常（客户提交变更申请，系统处理）
- ✅ 发货通知协同处理正常（客户确认发货，系统创建出库单）
- ✅ 质量问题协同处理正常（客户提交质量问题反馈，系统处理）
- ✅ 对账协同处理正常（对账单发送到客户协同平台）

---

### 10.10 成本核算流程（核心功能，新增）

#### 10.10.1 生产成本核算（核心功能，新增）

**应用场景：**
- 需要核算生产成本，包括材料成本、人工成本、制造费用
- 需要按工单、产品、时间段统计成本
- 需要分析成本构成，识别成本优化点
- 需要支持标准成本和实际成本对比

**用户操作：**
1. **配置成本核算规则**（核心功能，新增）
   - 进入"快智造" → "成本管理" → "成本核算规则"
   - 点击"新建成本核算规则"按钮
   - 填写成本核算规则：
     - 规则名称：标准成本核算规则
     - **材料成本核算**（核心功能，新增）：
       - 材料成本来源：采购价格/标准价格/移动平均价格（选择：移动平均价格）
       - 材料成本计算方式：实际领料数量 × 材料单价（自动计算）
     - **人工成本核算**（核心功能，新增）：
       - 人工成本来源：报工工时 × 人工单价（自动计算）
       - 人工单价：50元/小时（用户输入，可按人员或部门设置）
     - **制造费用核算**（核心功能，新增）：
       - 制造费用来源：设备折旧/水电费/其他费用（用户选择）
       - 制造费用分配方式：按工时分配/按产量分配（选择：按工时分配）
     - 保存成本核算规则

2. **工单成本核算**（核心功能，新增）
   - 进入"快智造" → "成本管理" → "成本核算" → "工单成本核算"
   - 选择工单：工单-20260105-001（产品A，数量：100个）
   - 点击"核算成本"按钮
   - **系统自动核算成本**（核心功能，新增）：
     - **材料成本**：
       - 原材料A：领料数量1000kg，单价10元/kg，材料成本10000元
       - 原材料B：领料数量500kg，单价8元/kg，材料成本4000元
       - 材料成本合计：14000元
     - **人工成本**：
       - 注塑工序：报工工时8小时，人工单价50元/小时，人工成本400元
       - 组装工序：报工工时10小时，人工单价50元/小时，人工成本500元
       - 包装工序：报工工时5小时，人工单价50元/小时，人工成本250元
       - 人工成本合计：1150元
     - **制造费用**：
       - 设备折旧：500元（按工时分配）
       - 水电费：300元（按工时分配）
       - 制造费用合计：800元
     - **总成本**：15950元（材料成本14000元 + 人工成本1150元 + 制造费用800元）
     - **单位成本**：159.5元/个（总成本15950元 ÷ 数量100个）

3. **产品成本核算**（核心功能，新增）
   - 进入"快智造" → "成本管理" → "成本核算" → "产品成本核算"
   - 选择产品：产品A
   - 选择时间段：2026年1月
   - 点击"核算成本"按钮
   - **系统自动核算成本**（核心功能，新增）：
     - **1月份产品成本统计**：
       - 工单数量：10个
       - 总产量：1000个
       - 材料成本：140000元
       - 人工成本：11500元
       - 制造费用：8000元
       - 总成本：158500元
       - 单位成本：158.5元/个
     - **成本构成分析**：
       - 材料成本占比：88.3%（140000 ÷ 158500）
       - 人工成本占比：7.3%（11500 ÷ 158500）
       - 制造费用占比：5.0%（8000 ÷ 158500）

4. **标准成本和实际成本对比**（核心功能，新增）
   - 进入"快智造" → "成本管理" → "成本核算" → "成本对比分析"
   - 选择产品：产品A
   - 选择时间段：2026年1月
   - **系统自动对比**（核心功能，新增）：
     - **标准成本**：
       - 标准材料成本：150元/个
       - 标准人工成本：10元/个
       - 标准制造费用：5元/个
       - 标准单位成本：165元/个
     - **实际成本**：
       - 实际材料成本：158.5元/个
       - 实际人工成本：11.5元/个
       - 实际制造费用：8元/个
       - 实际单位成本：178元/个
     - **成本差异**：
       - 材料成本差异：+8.5元/个（实际158.5 - 标准150）
       - 人工成本差异：+1.5元/个（实际11.5 - 标准10）
       - 制造费用差异：+3元/个（实际8 - 标准5）
       - 总成本差异：+13元/个（实际178 - 标准165）
     - **成本差异分析**：
       - 材料成本差异原因：采购价格上涨（系统自动分析）
       - 人工成本差异原因：实际工时超过标准工时（系统自动分析）
       - 制造费用差异原因：设备故障导致制造费用增加（系统自动分析）

5. **成本优化建议**（核心功能，新增）
   - 进入"快智造" → "成本管理" → "成本核算" → "成本优化建议"
   - 选择产品：产品A
   - **系统自动分析并显示优化建议**（核心功能，新增）：
     - **材料成本优化建议**：
       - 当前材料成本：158.5元/个，目标：150元/个
       - 建议：优化采购价格（当前平均采购价格10元/kg，建议优化到9.5元/kg）
       - 建议：减少材料损耗（当前材料损耗率2%，建议优化到1%）
     - **人工成本优化建议**：
       - 当前人工成本：11.5元/个，目标：10元/个
       - 建议：提高生产效率（当前实际工时23小时/100个，建议优化到20小时/100个）
       - 建议：优化工艺路线（当前工艺路线标准工时25小时/100个，建议优化到22小时/100个）
     - **制造费用优化建议**：
       - 当前制造费用：8元/个，目标：5元/个
       - 建议：减少设备故障（当前设备故障率5%，建议优化到2%）
       - 建议：优化设备利用率（当前设备利用率90%，建议优化到95%）

**系统行为：**
- ✅ **成本核算规则配置**（核心功能，新增）：
  - 支持材料成本核算规则配置（材料成本来源、计算方式）
  - 支持人工成本核算规则配置（人工单价、计算方式）
  - 支持制造费用核算规则配置（制造费用来源、分配方式）
- ✅ **工单成本核算**（核心功能，新增）：
  - 自动核算材料成本（基于领料记录和材料单价）
  - 自动核算人工成本（基于报工记录和人工单价）
  - 自动核算制造费用（基于制造费用分配规则）
  - 自动计算总成本和单位成本
- ✅ **产品成本核算**（核心功能，新增）：
  - 自动统计产品成本（按时间段）
  - 自动分析成本构成（材料成本、人工成本、制造费用占比）
- ✅ **标准成本和实际成本对比**（核心功能，新增）：
  - 自动对比标准成本和实际成本
  - 自动计算成本差异（材料成本差异、人工成本差异、制造费用差异）
  - 自动分析成本差异原因
- ✅ **成本优化建议**（核心功能，新增）：
  - 自动分析成本瓶颈（材料成本、人工成本、制造费用）
  - 自动生成成本优化建议（基于历史数据和最佳实践）
  - 支持成本优化目标设置
- 🤖 **AI智能建议**：
  - 基于历史数据，预测成本趋势
  - 分析成本差异原因，建议改进措施
  - 识别成本优化点，建议成本优化方案

**验收标准：**
- ✅ 成本核算规则配置成功（材料成本、人工成本、制造费用）
- ✅ 工单成本核算正常（材料成本、人工成本、制造费用、总成本、单位成本）
- ✅ 产品成本核算正常（按时间段统计，成本构成分析）
- ✅ 标准成本和实际成本对比正常（成本差异计算、差异原因分析）
- ✅ 成本优化建议正常（成本瓶颈分析、优化建议生成）

---

#### 10.10.2 委外成本核算（核心功能，新增）

**应用场景：**
- 需要核算委外加工成本
- 需要按委外订单、供应商、时间段统计委外成本
- 需要分析委外成本构成，识别成本优化点

**用户操作：**
1. **委外成本核算**
   - 进入"快智造" → "成本管理" → "成本核算" → "委外成本核算"
   - 选择委外订单：委外-20260105-001（委外数量：90个，委外单价：10元/件）
   - 点击"核算成本"按钮
   - **系统自动核算成本**（核心功能，新增）：
     - **委外加工成本**：
       - 委外数量：90个
       - 委外单价：10元/件
       - 委外加工成本：900元（90 × 10）
     - **委外物料成本**（如果委外需要提供物料）：
       - 委外物料：原材料A，数量：100kg，单价：10元/kg
       - 委外物料成本：1000元（100 × 10）
     - **委外总成本**：1900元（委外加工成本900元 + 委外物料成本1000元）
     - **委外单位成本**：21.1元/个（委外总成本1900元 ÷ 委外数量90个）

2. **委外成本统计分析**（核心功能，新增）
   - 进入"快智造" → "成本管理" → "成本核算" → "委外成本统计"
   - 查看委外成本统计报表：
     - 按供应商统计：供应商C委外成本10000元，供应商D委外成本8000元
     - 按物料统计：产品A半成品委外成本5000元，产品B半成品委外成本3000元
     - 按时间段统计：1月份委外成本50000元，2月份委外成本60000元
     - 委外成本趋势：按时间段统计委外成本趋势
   - 导出委外成本统计报表（Excel）

**系统行为：**
- ✅ **委外成本核算**（核心功能，新增）：
  - 自动核算委外加工成本（委外数量 × 委外单价）
  - 自动核算委外物料成本（如果委外需要提供物料）
  - 自动计算委外总成本和单位成本
- ✅ **委外成本统计分析**（核心功能，新增）：
  - 自动统计委外成本（按供应商、物料、时间段）
  - 自动生成委外成本统计报表
  - 支持导出委外成本统计报表（Excel）
- 🤖 **AI智能建议**：
  - 基于历史数据，预测委外成本趋势
  - 分析委外成本构成，建议成本优化方案
  - 识别委外成本优化点，建议供应商选择

**验收标准：**
- ✅ 委外成本核算正常（委外加工成本、委外物料成本、委外总成本、委外单位成本）
- ✅ 委外成本统计分析正常（按供应商、物料、时间段统计）

---

#### 10.10.3 质量成本核算（核心功能，新增）

**应用场景：**
- 需要核算质量成本，包括预防成本、检验成本、内部损失成本、外部损失成本
- 需要按产品、时间段统计质量成本
- 需要分析质量成本构成，识别质量成本优化点

**用户操作：**
1. **质量成本核算**
   - 进入"快智造" → "成本管理" → "成本核算" → "质量成本核算"
   - 选择产品：产品A
   - 选择时间段：2026年1月
   - 点击"核算质量成本"按钮
   - **系统自动核算质量成本**（核心功能，新增）：
     - **预防成本**：
       - 质量培训费用：2000元
       - 质量体系维护费用：1000元
       - 预防成本合计：3000元
     - **检验成本**：
       - 来料检验成本：1500元（检验工时30小时 × 人工单价50元/小时）
       - 过程检验成本：2000元（检验工时40小时 × 人工单价50元/小时）
       - 成品检验成本：1000元（检验工时20小时 × 人工单价50元/小时）
       - 检验成本合计：4500元
     - **内部损失成本**：
       - 返工成本：3000元（返工数量30个 × 返工单价100元/个）
       - 报废成本：2000元（报废数量10个 × 报废单价200元/个）
       - 内部损失成本合计：5000元
     - **外部损失成本**：
       - 退货成本：4000元（退货数量20个 × 退货单价200元/个）
       - 客户投诉处理成本：1000元
       - 外部损失成本合计：5000元
     - **质量成本合计**：17500元（预防成本3000元 + 检验成本4500元 + 内部损失成本5000元 + 外部损失成本5000元）

2. **质量成本统计分析**（核心功能，新增）
   - 进入"快智造" → "成本管理" → "成本核算" → "质量成本统计"
   - 查看质量成本统计报表：
     - 按产品统计：产品A质量成本17500元，产品B质量成本12000元
     - 按时间段统计：1月份质量成本50000元，2月份质量成本45000元
     - 质量成本构成：预防成本17%，检验成本26%，内部损失成本29%，外部损失成本29%
     - 质量成本趋势：按时间段统计质量成本趋势
   - 导出质量成本统计报表（Excel）

**系统行为：**
- ✅ **质量成本核算**（核心功能，新增）：
  - 自动核算预防成本（质量培训费用、质量体系维护费用）
  - 自动核算检验成本（来料检验、过程检验、成品检验）
  - 自动核算内部损失成本（返工成本、报废成本）
  - 自动核算外部损失成本（退货成本、客户投诉处理成本）
  - 自动计算质量成本合计
- ✅ **质量成本统计分析**（核心功能，新增）：
  - 自动统计质量成本（按产品、时间段）
  - 自动分析质量成本构成（预防成本、检验成本、内部损失成本、外部损失成本占比）
  - 自动生成质量成本统计报表
  - 支持导出质量成本统计报表（Excel）
- 🤖 **AI智能建议**：
  - 基于历史数据，预测质量成本趋势
  - 分析质量成本构成，建议成本优化方案
  - 识别质量成本优化点，建议质量改进措施

**验收标准：**
- ✅ 质量成本核算正常（预防成本、检验成本、内部损失成本、外部损失成本、质量成本合计）
- ✅ 质量成本统计分析正常（按产品、时间段统计，质量成本构成分析）

---

### 10.11 财务协同流程（第二阶段扩展）

1. **应付管理** → 采购入库后自动生成应付单
2. **应收管理** → 销售出库后自动生成应收单

### 10.12 报表分析流程（增强AI数据洞察）

1. **库存报表** → 库存查询、库存周转率分析
2. **生产报表** → 工单绩效分析、生产效率分析
3. **质量报表** → 质量合格率统计、质量趋势分析

### 10.13 AI智能建议功能（新增）

**AI建议功能特点：**
- 🤖 **不增加操作负担**：AI建议以提示、侧边栏、悬浮窗等形式展示，不打断用户操作流程
- 🤖 **主动智能**：在关键决策点和异常情况时主动提供建议
- 🤖 **基于数据**：所有AI建议基于历史数据和当前状态，确保建议的准确性
- 🤖 **实用性强**：AI建议聚焦实际问题，提供可执行的解决方案

**AI建议应用场景：**
1. **系统初始化阶段**：AI建议最佳实践配置
2. **基础数据配置阶段**：AI建议数据完整性检查和优化建议
3. **MRP/LRP运算阶段**：AI建议优化排产计划和采购计划
4. **工单下达阶段**：AI建议齐套检查、交期风险评估、工作中心能力检查
5. **生产领料阶段**：AI建议缺料预警、替代料推荐
6. **报工阶段**：AI建议异常检测（不良率异常、工时异常、进度异常）
7. **生产看板阶段**：AI建议异常预警、生产优化建议
8. **报表分析阶段**：AI建议数据洞察和优化建议
9. **异常处理阶段**：AI建议解决方案和应对措施

**AI建议实现方式：**
- 通过Inngest AI工作流异步生成AI建议
- 前端以侧边栏、悬浮窗、弹窗等形式展示AI建议
- 用户可选择查看详细建议或忽略建议

### 10.14 单据关联与上下游管理（新增，核心功能）

**核心功能：**
- ✅ **单据上下游信息展示**：在单据详情页面展示上下游关联单据信息
  - 显示上游单据（来源单据）：销售预测 → MRP运算 → 工单
  - 显示下游单据（生成单据）：工单 → 生产领料出库单、报工记录、成品入库单
  - 支持关联单据快速跳转
  - 支持关联单据统计（上游单据数量、下游单据数量、状态汇总）
- ✅ **单据下推功能**：从上游单据快速生成下游单据（一键下推）
  - 从销售预测下推到MRP运算（一键下推）
  - 从MRP运算下推到工单和采购单（一键生成）
  - 从工单下推到生产领料出库单（一键领料）
  - 从工单下推到报工记录（扫码报工）
  - 从工单下推到成品入库单（一键入库）
  - 支持批量下推（批量生成下游单据）
  - 自动传递单据信息，减少重复输入
- ✅ **单据上拉功能**：从下游单据关联到上游单据（快速关联）
  - 从报工记录上拉到工单（手动关联或智能关联）
  - 从生产领料出库单上拉到工单（手动关联或智能关联）
  - 从成品入库单上拉到工单（手动关联或智能关联）
  - 从工单上拉到销售预测/销售订单（手动关联）
  - 支持批量上拉关联（批量关联多个单据）
  - AI辅助智能上拉关联（自动推荐匹配的上游单据）
- ✅ **单据关联追溯**：支持查看完整的单据关联链条
  - 可视化展示完整关联链条（销售预测 → MRP运算 → 工单 → 生产领料 → 报工 → 成品入库 → 销售出库）
  - 支持关联关系图（可视化图表）
  - 支持导出关联关系图（PNG、PDF）
  - 支持关联单据统计报表（按单据类型、时间段、部门统计）

**优化效果：**
- ⚡ **追溯便捷**：通过关联追溯，快速查看完整的业务流程链条
- ⚡ **操作高效**：通过下推和上拉功能，快速生成和关联单据，提高操作效率
- ⚡ **信息完整**：通过上下游信息展示，全面了解单据的关联关系
- ⚡ **智能推荐**：通过AI辅助上拉，提高关联准确性和效率

---

### 10.15 单据执行效率优化与耗时统计（新增，核心功能）

**核心功能：**
- ✅ **工作时间段配置**：支持按人员或部门设置工作时间段（见2.5.1章节）
  - 支持工作日设置（周一至周五、周六、周日）
  - 支持节假日设置（自动识别法定节假日）
  - 支持多班次设置（白班、夜班、周末班等）
  - 支持跨天班次（如：夜班 20:00-05:00）
- ✅ **节点耗时统计**：自动记录每个单据节点的开始和结束时间
  - MTS模式节点：需求创建→MRP运算→工单创建→工单下达→生产领料→报工开始→报工完成→成品入库→销售出库
  - MTO模式节点：需求创建→LRP运算→工单创建→工单下达→生产领料→报工开始→报工完成→成品入库→销售出库
- ✅ **节点间耗时统计**：自动计算节点之间的耗时（只统计工作时间）
  - 基于操作人员或部门的工作时间段配置
  - 自动排除非工作时间（下班时间、周末、节假日）
  - 支持跨天计算（如：夜班跨天）
  - 支持多班次计算（白班、夜班、周末班等）
- ✅ **耗时分析报表**：提供耗时分析报表，帮助识别效率瓶颈
  - 按单据分析：显示每个单据各节点耗时
  - 按人员分析：显示每个人员的操作耗时
  - 按部门分析：显示每个部门的操作耗时
  - 按时间段分析：显示不同时间段的耗时趋势
- ✅ **效率优化建议**：基于耗时统计，提供效率优化建议
  - 识别效率瓶颈（某节点耗时过长）
  - 对比历史数据，提供改进建议
  - 预测交期风险，提前预警

**优化效果：**
- ⚡ **效率可视化**：通过耗时统计，清晰展示单据执行效率
- ⚡ **瓶颈识别**：自动识别效率瓶颈，帮助优化流程
- ⚡ **准确统计**：只统计工作时间，排除非工作时间，提高统计准确性
- ⚡ **灵活配置**：支持按人员或部门设置工作时间段，适应不同工作模式

---

### 10.16 用户体验极致优化（新增，针对中国式中小企业痛点）

**核心优化原则：**
- 🚀 **减少操作步骤**：所有操作步骤减少50%以上
- 🚀 **减少输入字段**：智能默认值，用户只需输入关键字段
- 🚀 **一键操作**：关键操作支持一键完成
- 🚀 **批量操作**：支持批量处理，提高效率
- 🚀 **移动端优先**：报工等操作移动端优化
- 🚀 **智能引导**：新手引导，快速上手

**优化场景汇总：**

1. **系统初始化优化**：
   - ⚡ 快速注册：3步完成，<1分钟（手机号即账号）
   - ⚡ 快速初始化向导：3-5步完成，<2分钟（智能默认值+行业模板）
   - ⚡ 行业模板：一键应用制造业通用配置

2. **基础数据配置优化**：
   - ⚡ 批量导入：universheet在线表格批量导入部门、员工、角色（一次性完成，实时保存）
   - ⚡ 快速创建：<10人企业，<5分钟完成组织架构配置
   - ⚡ 智能默认值：所有配置项都有合理默认值

3. **MRP/LRP运算优化**：
   - ⚡ 一键生成：MRP运算后一键生成工单和采购单
   - ⚡ 智能填充：自动填充工单和采购单字段（基于历史数据）
   - ⚡ 时间缩短：从15分钟减少到<2分钟

4. **工单管理优化**：
   - ⚡ 批量下达：支持批量下达多个工单（<1分钟）
   - ⚡ 智能检查：批量下达前自动检查齐套料、交期、产能
   - ⚡ 智能标记：自动标记异常工单，方便快速识别

5. **生产领料优化**：
   - ⚡ 一键领料：选择工单后一键完成领料（<30秒）
   - ⚡ 批量领料：支持批量领料多个工单（<1分钟）
   - ⚡ 智能默认值：自动填充仓库、库位

6. **报工管理优化**：
   - ⚡ 扫码报工：扫描二维码后自动填充工单信息（<30秒）
   - ⚡ 极简报工：只需输入完成数量和合格数量（2个字段）
   - ⚡ 文本输入优化：大文本输入框输入备注，触屏优化，易于输入
   - ⚡ 多终端支持：支持移动端和工位机触屏模式，适应不同使用场景

7. **成品入库优化**：
   - ⚡ 一键入库：选择工单后一键完成入库（<30秒）
   - ⚡ 批量入库：支持批量入库多个工单（<1分钟）
   - ⚡ 智能默认值：自动填充物料、数量、仓库

8. **工作台快捷操作（新增）**：
   - ⚡ 快捷入口：常用功能快捷入口（报工、领料、入库等）
   - ⚡ 待办提醒：待办事项提醒（待下达工单、待领料工单等）
   - ⚡ 快捷操作：一键操作按钮（一键报工、一键领料等）

**优化效果统计：**
- ⚡ **操作步骤减少**：平均减少50%以上
- ⚡ **时间缩短**：平均缩短70%以上
- ⚡ **输入字段减少**：平均减少60%以上
- ⚡ **学习成本降低**：向导引导+智能默认值，无需专业知识

### 10.17 通用需求

- ✅ 数据导入导出（universheet在线表格批量导入导出，实时保存）
- ✅ 高级搜索（拼音搜索、快速筛选）
- ✅ 打印功能（打印模板、打印预览）
- ✅ 移动端支持（报工界面、扫码功能）
- ✅ **工位机触屏模式**（核心功能，新增）
  - 现场报工（触屏优化）
  - SOP查看（触屏优化）
  - 图纸查看（触屏优化）
  - 加工程序查看（触屏优化）
- ✅ 实时数据推送（WebSocket实时更新）
- ✅ 权限管理（RBAC、数据权限）
- ✅ 审批流程（流程可视化设计器）
- 🤖 AI智能建议（基于Inngest AI工作流，不增加操作负担）
- 🚀 用户体验极致优化（一键操作、批量操作、智能默认值）

### 10.18 个性化需求（后期定制）

- ⚠️ 自定义字段
- ⚠️ 自定义报表
- ⚠️ 自定义工作流
- ⚠️ 第三方系统集成

---

---

## 12. 二维码体系全流程应用（核心功能，新增）

### 12.1 二维码体系总览

**二维码体系设计原则：**
- ✅ **统一编码规则**：所有二维码遵循统一的编码规则，便于识别和管理
- ✅ **信息丰富**：二维码包含关键业务信息（ID、编码、状态等）
- ✅ **快速识别**：扫码后自动识别并填充相关信息，减少手动输入
- ✅ **全程追溯**：通过二维码实现从原材料到成品的全程追溯
- ✅ **多终端支持**：支持PC端、移动端、工位机触屏模式扫码

**二维码类型：**
1. **物料码**：物料、批次、序列号的唯一标识
2. **工单码**：工单的唯一标识，用于报工、查询
3. **工序码**：工序的唯一标识，用于工序报工、SOP查看
4. **设备码**：设备的唯一标识，用于设备管理、保养、维修
5. **人员码**：人员的唯一标识，用于人员识别、权限验证
6. **装箱码**：装箱的唯一标识，用于装箱管理、出库追溯
7. **追溯码**：产品的唯一追溯标识，用于质量追溯、召回

**二维码格式规范：**
- **编码格式**：`{类型前缀}-{业务编码}-{时间戳}-{序号}`
- **类型前缀**：
  - MAT：物料码
  - WO：工单码
  - OP：工序码
  - EQ：设备码
  - EMP：人员码
  - BOX：装箱码
  - TRACE：追溯码
- **二维码内容**：JSON格式，包含业务信息
- **二维码显示**：支持中文显示，包含关键信息（编码、名称、状态等）

---

### 12.2 物料码（MAT）全流程应用

**物料码类型：**
1. **物料主码**：物料主数据的唯一标识
2. **批次码**：物料批次的唯一标识（如果物料启用批号管理）
3. **序列号码**：物料序列号的唯一标识（如果物料启用序列号管理）

**物料码生成规则：**
- **物料主码**：`MAT-{物料编码}-{版本号}`
  - 示例：`MAT-MAT-001-V1.0`
- **批次码**：`MAT-BATCH-{物料编码}-{批次号}`
  - 示例：`MAT-BATCH-MAT-001-20260115-001`
- **序列号码**：`MAT-SN-{物料编码}-{序列号}`
  - 示例：`MAT-SN-MAT-001-20260115-000001`

**物料码二维码内容（JSON格式）：**
```json
{
  "type": "MATERIAL",
  "code": "MAT-001",
  "name": "原材料A",
  "spec": "规格A",
  "unit": "kg",
  "batch_no": "20260115-001",
  "serial_no": "SN-001",
  "status": "在库",
  "warehouse": "A-01-001",
  "timestamp": "2026-01-15T10:00:00Z"
}
```

**物料码使用场景：**

**场景1：物料入库扫码**
- **操作位置**：采购入库、客户来料登记
- **操作流程**：
  1. 扫描物料二维码/一维码（自动识别物料信息）
  2. 系统自动填充：
     - 物料编码：MAT-001（自动识别）
     - 物料名称：原材料A（自动填充）
     - 批次号：20260115-001（如果条码包含批次号，自动识别）
     - 序列号：SN-001（如果条码包含序列号，自动识别）
  3. 输入入库数量：1000kg
  4. 选择库位：A-01-001（可选）
  5. 提交入库单
- **优化效果**：从5步减少到2步（扫码→提交），<30秒完成

**场景2：生产领料扫码**
- **操作位置**：生产领料
- **操作流程**：
  1. 扫描工单二维码（自动识别工单信息）
  2. 系统自动显示工单BOM物料列表
  3. 扫描物料二维码（自动识别物料信息）
  4. 系统自动匹配BOM物料（自动填充计划数量）
  5. 确认领料数量（系统自动填充，可修改）
  6. 提交领料单
- **优化效果**：从6步减少到3步（扫码工单→扫码物料→提交），<1分钟完成

**场景3：工站上下料扫码**
- **操作位置**：报工阶段（工站上下料物料绑定）
- **操作流程**：
  1. 扫描工单二维码（自动识别工单信息）
  2. 点击"上料绑定"按钮
  3. 扫描物料二维码（自动识别物料信息）
  4. 系统自动填充：
     - 物料编码：MAT-001（自动识别）
     - 物料名称：原材料A（自动填充）
     - 批次号：20260115-001（自动识别）
     - 序列号：SN-001（自动识别）
  5. 输入上料数量：100kg
  6. 点击"确认上料"按钮
  7. 重复步骤3-6，绑定下料物料
  8. 提交报工
- **优化效果**：从10步减少到5步（扫码工单→扫码上料→扫码下料→提交），<2分钟完成

**场景4：库存盘点扫码**
- **操作位置**：库存盘点
- **操作流程**：
  1. 扫描物料二维码或库位二维码（自动识别物料和库位）
  2. 系统自动填充：
     - 物料编码：MAT-001（自动识别）
     - 物料名称：原材料A（自动填充）
     - 库位：A-01-001（自动识别）
     - 账面数量：1000kg（自动填充，基于系统库存）
  3. 输入实际数量：980kg
  4. 系统自动计算差异：-20kg
  5. 点击"保存"按钮
- **优化效果**：从5步减少到2步（扫码→输入数量→保存），<30秒完成

**场景5：销售出库扫码**
- **操作位置**：销售出库
- **操作流程**：
  1. 扫描物料二维码（自动识别物料信息）
  2. 系统自动填充：
     - 物料编码：MAT-001（自动识别）
     - 物料名称：产品A（自动填充）
     - 可用库存：100个（自动填充）
  3. 选择批次号（如果物料启用批号管理，系统自动显示可用批号列表）
  4. 选择序列号（如果物料启用序列号管理，支持扫码选择序列号）
  5. 输入出库数量：50个
  6. 提交出库单
- **优化效果**：从6步减少到3步（扫码→选择批次/序列号→提交），<1分钟完成

**系统行为：**
- ✅ **物料码自动生成**：
  - 创建物料时自动生成物料主码
  - 创建批次时自动生成批次码
  - 创建序列号时自动生成序列号码
- ✅ **物料码自动识别**：
  - 扫码后自动解析二维码内容（JSON格式）
  - 自动识别物料编码、批次号、序列号
  - 自动匹配系统物料（基于物料编码）
- ✅ **物料码信息自动填充**：
  - 扫码后自动填充物料信息（物料编码、物料名称、规格、单位等）
  - 自动填充批次信息（批次号、生产日期、有效期等）
  - 自动填充序列号信息（序列号、状态等）
- ✅ **物料码追溯**：
  - 支持通过物料码查询物料历史（入库、出库、领料、报工等）
  - 支持通过批次码查询批次历史（批次入库、批次出库、批次使用等）
  - 支持通过序列号码查询序列号历史（序列号入库、序列号出库、序列号使用等）

**验收标准：**
- ✅ 物料码生成正常（物料主码、批次码、序列号码）
- ✅ 物料码识别正常（扫码后自动识别物料信息）
- ✅ 物料码信息填充正常（自动填充物料、批次、序列号信息）
- ✅ 物料码追溯正常（查询物料、批次、序列号历史）

---

### 12.3 工单码（WO）全流程应用

**工单码生成规则：**
- **工单码**：`WO-{工单编码}-{版本号}`
  - 示例：`WO-工单-20260105-001-V1.0`

**工单码二维码内容（JSON格式）：**
```json
{
  "type": "WORK_ORDER",
  "code": "工单-20260105-001",
  "product_code": "FIN-001",
  "product_name": "产品A",
  "quantity": 100,
  "status": "执行中",
  "current_operation": "组装工序",
  "workshop": "组装车间",
  "work_center": "组装线1",
  "start_date": "2026-01-05",
  "due_date": "2026-01-20",
  "timestamp": "2026-01-15T10:00:00Z"
}
```

**工单码使用场景：**

**场景1：扫码报工（核心场景）**
- **操作位置**：报工阶段
- **操作流程**：
  1. 扫描工单二维码（自动识别工单信息）
  2. 系统自动填充：
     - 工单号：工单-20260105-001（自动识别）
     - 产品：产品A（自动填充）
     - 当前工序：组装工序（自动填充，基于工单工序顺序）
     - 计划数量：90个（自动填充）
  3. 输入完成数量和合格数量
  4. 提交报工
- **优化效果**：从7步减少到3步（扫码→输入数量→提交），<30秒完成

**场景2：扫码查看SOP**
- **操作位置**：报工阶段（SOP查看）
- **操作流程**：
  1. 扫描工单二维码（自动识别工单信息）
  2. 系统自动显示当前工序的SOP
  3. 查看SOP步骤（触屏优化，支持滑动查看）
- **优化效果**：从5步减少到1步（扫码），<10秒完成

**场景3：扫码查看图纸**
- **操作位置**：报工阶段（图纸查看）
- **操作流程**：
  1. 扫描工单二维码（自动识别工单信息）
  2. 系统自动显示当前工序的图纸
  3. 查看图纸（触屏优化，支持缩放、拖拽）
- **优化效果**：从5步减少到1步（扫码），<10秒完成

**场景4：扫码查看加工程序**
- **操作位置**：报工阶段（加工程序查看）
- **操作流程**：
  1. 扫描工单二维码（自动识别工单信息）
  2. 系统自动显示当前工序的加工程序
  3. 查看加工程序（触屏优化，支持滚动查看）
- **优化效果**：从5步减少到1步（扫码），<10秒完成

**场景5：扫码生产领料**
- **操作位置**：生产领料
- **操作流程**：
  1. 扫描工单二维码（自动识别工单信息）
  2. 系统自动显示工单BOM物料列表
  3. 系统自动填充领料信息（物料、数量、仓库）
  4. 确认领料信息
  5. 提交领料单
- **优化效果**：从6步减少到2步（扫码→提交），<30秒完成

**场景6：扫码成品入库**
- **操作位置**：成品入库
- **操作流程**：
  1. 扫描工单二维码（自动识别工单信息）
  2. 系统自动填充：
     - 物料：产品A（基于工单）
     - 数量：88个（基于报工合格数量）
     - 仓库：成品仓库（基于物料默认仓库）
  3. 确认入库信息
  4. 提交入库单
- **优化效果**：从5步减少到2步（扫码→提交），<30秒完成

**场景7：扫码查询工单进度**
- **操作位置**：工单查询（移动端）
- **操作流程**：
  1. 扫描工单二维码（自动识别工单信息）
  2. 系统自动显示工单详情：
     - 工单基本信息（工单号、产品、数量、状态）
     - 工单进度（各工序完成情况）
     - 关联单据（领料单、报工记录、入库单）
  3. 查看工单详情
- **优化效果**：从5步减少到1步（扫码），<10秒完成

**系统行为：**
- ✅ **工单码自动生成**：
  - 创建工单时自动生成工单码
  - 工单码包含工单关键信息（工单号、产品、数量、状态等）
- ✅ **工单码自动识别**：
  - 扫码后自动解析二维码内容（JSON格式）
  - 自动识别工单编码
  - 自动匹配系统工单（基于工单编码）
- ✅ **工单码信息自动填充**：
  - 扫码后自动填充工单信息（工单号、产品、数量、状态等）
  - 自动填充当前工序信息（工序名称、工序顺序等）
  - 自动填充关联信息（BOM、工艺路线、SOP等）
- ✅ **工单码状态实时更新**：
  - 工单状态变更时自动更新工单码内容
  - 当前工序变更时自动更新工单码内容

**验收标准：**
- ✅ 工单码生成正常（创建工单时自动生成）
- ✅ 工单码识别正常（扫码后自动识别工单信息）
- ✅ 工单码信息填充正常（自动填充工单、工序、关联信息）
- ✅ 工单码状态更新正常（工单状态变更时自动更新）

---

### 12.4 工序码（OP）全流程应用

**工序码生成规则：**
- **工序码**：`OP-{工序编码}-{工单编码}-{版本号}`
  - 示例：`OP-OP-001-工单-20260105-001-V1.0`

**工序码二维码内容（JSON格式）：**
```json
{
  "type": "OPERATION",
  "code": "OP-001",
  "name": "组装工序",
  "work_order_code": "工单-20260105-001",
  "product_code": "FIN-001",
  "product_name": "产品A",
  "sequence": 2,
  "workshop": "组装车间",
  "work_center": "组装线1",
  "status": "进行中",
  "planned_quantity": 100,
  "completed_quantity": 90,
  "qualified_quantity": 88,
  "sop_code": "SOP-001",
  "timestamp": "2026-01-15T10:00:00Z"
}
```

**工序码使用场景：**

**场景1：扫码工序报工**
- **操作位置**：报工阶段（工序报工）
- **操作流程**：
  1. 扫描工序二维码（自动识别工序信息）
  2. 系统自动填充：
     - 工序编码：OP-001（自动识别）
     - 工序名称：组装工序（自动填充）
     - 工单号：工单-20260105-001（自动填充）
     - 产品：产品A（自动填充）
     - 计划数量：100个（自动填充）
  3. 输入完成数量和合格数量
  4. 提交报工
- **优化效果**：从6步减少到3步（扫码→输入数量→提交），<30秒完成

**场景2：扫码查看工序SOP**
- **操作位置**：报工阶段（SOP查看）
- **操作流程**：
  1. 扫描工序二维码（自动识别工序信息）
  2. 系统自动显示工序的SOP
  3. 查看SOP步骤（触屏优化，支持滑动查看）
- **优化效果**：从4步减少到1步（扫码），<10秒完成

**场景3：扫码查看工序图纸**
- **操作位置**：报工阶段（图纸查看）
- **操作流程**：
  1. 扫描工序二维码（自动识别工序信息）
  2. 系统自动显示工序的图纸
  3. 查看图纸（触屏优化，支持缩放、拖拽）
- **优化效果**：从4步减少到1步（扫码），<10秒完成

**场景4：扫码查看工序加工程序**
- **操作位置**：报工阶段（加工程序查看）
- **操作流程**：
  1. 扫描工序二维码（自动识别工序信息）
  2. 系统自动显示工序的加工程序
  3. 查看加工程序（触屏优化，支持滚动查看）
- **优化效果**：从4步减少到1步（扫码），<10秒完成

**场景5：扫码查询工序进度**
- **操作位置**：工序查询（移动端）
- **操作流程**：
  1. 扫描工序二维码（自动识别工序信息）
  2. 系统自动显示工序详情：
     - 工序基本信息（工序编码、工序名称、状态）
     - 工序进度（完成数量、合格数量、进度百分比）
     - 关联信息（工单、产品、SOP、图纸、加工程序）
  3. 查看工序详情
- **优化效果**：从4步减少到1步（扫码），<10秒完成

**系统行为：**
- ✅ **工序码自动生成**：
  - 创建工单工序时自动生成工序码
  - 工序码包含工序关键信息（工序编码、工序名称、工单、状态等）
- ✅ **工序码自动识别**：
  - 扫码后自动解析二维码内容（JSON格式）
  - 自动识别工序编码
  - 自动匹配系统工序（基于工序编码和工单编码）
- ✅ **工序码信息自动填充**：
  - 扫码后自动填充工序信息（工序编码、工序名称、状态等）
  - 自动填充关联信息（工单、产品、SOP、图纸、加工程序等）
- ✅ **工序码状态实时更新**：
  - 工序状态变更时自动更新工序码内容
  - 工序进度更新时自动更新工序码内容

**验收标准：**
- ✅ 工序码生成正常（创建工单工序时自动生成）
- ✅ 工序码识别正常（扫码后自动识别工序信息）
- ✅ 工序码信息填充正常（自动填充工序、关联信息）
- ✅ 工序码状态更新正常（工序状态变更时自动更新）

---

### 12.5 设备码（EQ）全流程应用

**设备码生成规则：**
- **设备码**：`EQ-{设备编码}-{版本号}`
  - 示例：`EQ-EQ-001-V1.0`

**设备码二维码内容（JSON格式）：**
```json
{
  "type": "EQUIPMENT",
  "code": "EQ-001",
  "name": "注塑机1",
  "category": "注塑机",
  "workshop": "注塑车间",
  "work_center": "注塑机1",
  "status": "运行中",
  "maintenance_status": "正常",
  "next_maintenance_date": "2026-02-15",
  "operator": "张三",
  "timestamp": "2026-01-15T10:00:00Z"
}
```

**设备码使用场景：**

**场景1：扫码设备报工**
- **操作位置**：报工阶段（设备报工）
- **操作流程**：
  1. 扫描设备二维码（自动识别设备信息）
  2. 系统自动填充：
     - 设备编码：EQ-001（自动识别）
     - 设备名称：注塑机1（自动填充）
     - 工作中心：注塑机1（自动填充）
  3. 扫描工单二维码（自动识别工单信息）
  4. 系统自动关联设备和工单
  5. 输入报工信息
  6. 提交报工
- **优化效果**：从7步减少到3步（扫码设备→扫码工单→提交），<1分钟完成

**场景2：扫码设备保养**
- **操作位置**：设备保养
- **操作流程**：
  1. 扫描设备二维码（自动识别设备信息）
  2. 系统自动填充：
     - 设备编码：EQ-001（自动识别）
     - 设备名称：注塑机1（自动填充）
     - 保养计划：月度保养（自动填充）
     - 上次保养日期：2026-01-01（自动填充）
     - 下次保养日期：2026-02-01（自动填充）
  3. 填写保养内容（保养项目、保养结果）
  4. 提交保养记录
- **优化效果**：从6步减少到2步（扫码→填写内容→提交），<2分钟完成

**场景3：扫码设备报修**
- **操作位置**：设备报修
- **操作流程**：
  1. 扫描设备二维码（自动识别设备信息）
  2. 系统自动填充：
     - 设备编码：EQ-001（自动识别）
     - 设备名称：注塑机1（自动填充）
     - 设备状态：故障（自动填充）
  3. 填写故障描述（故障现象、故障原因）
  4. 提交报修单
- **优化效果**：从5步减少到2步（扫码→填写描述→提交），<1分钟完成

**场景4：扫码设备维修**
- **操作位置**：设备维修
- **操作流程**：
  1. 扫描设备二维码（自动识别设备信息）
  2. 系统自动显示设备报修单列表
  3. 选择报修单
  4. 填写维修内容（维修项目、维修结果、维修费用）
  5. 提交维修记录
- **优化效果**：从6步减少到3步（扫码→选择报修单→提交），<2分钟完成

**场景5：扫码设备查询**
- **操作位置**：设备查询（移动端）
- **操作流程**：
  1. 扫描设备二维码（自动识别设备信息）
  2. 系统自动显示设备详情：
     - 设备基本信息（设备编码、设备名称、状态）
     - 设备状态（运行状态、保养状态、故障状态）
     - 设备历史（保养记录、维修记录、报工记录）
  3. 查看设备详情
- **优化效果**：从4步减少到1步（扫码），<10秒完成

**系统行为：**
- ✅ **设备码自动生成**：
  - 创建设备时自动生成设备码
  - 设备码包含设备关键信息（设备编码、设备名称、状态等）
- ✅ **设备码自动识别**：
  - 扫码后自动解析二维码内容（JSON格式）
  - 自动识别设备编码
  - 自动匹配系统设备（基于设备编码）
- ✅ **设备码信息自动填充**：
  - 扫码后自动填充设备信息（设备编码、设备名称、状态等）
  - 自动填充设备状态（运行状态、保养状态、故障状态）
  - 自动填充设备历史（保养记录、维修记录、报工记录）
- ✅ **设备码状态实时更新**：
  - 设备状态变更时自动更新设备码内容
  - 设备保养/维修时自动更新设备码内容

**验收标准：**
- ✅ 设备码生成正常（创建设备时自动生成）
- ✅ 设备码识别正常（扫码后自动识别设备信息）
- ✅ 设备码信息填充正常（自动填充设备、状态、历史信息）
- ✅ 设备码状态更新正常（设备状态变更时自动更新）

---

### 12.6 人员码（EMP）全流程应用

**人员码生成规则：**
- **人员码**：`EMP-{员工编码}-{版本号}`
  - 示例：`EMP-EMP-001-V1.0`

**人员码二维码内容（JSON格式）：**
```json
{
  "type": "EMPLOYEE",
  "code": "EMP-001",
  "name": "张三",
  "department": "生产部",
  "position": "操作工",
  "role": "生产工人",
  "status": "在职",
  "phone": "13800138000",
  "timestamp": "2026-01-15T10:00:00Z"
}
```

**人员码使用场景：**

**场景1：扫码人员登录**
- **操作位置**：工位机登录
- **操作流程**：
  1. 扫描人员二维码（自动识别人员信息）
  2. 系统自动填充：
     - 员工编码：EMP-001（自动识别）
     - 员工姓名：张三（自动填充）
     - 部门：生产部（自动填充）
     - 角色：生产工人（自动填充）
  3. 输入密码（可选，如果配置了密码验证）
  4. 登录系统
- **优化效果**：从5步减少到2步（扫码→输入密码→登录），<10秒完成

**场景2：扫码人员权限验证**
- **操作位置**：报工、领料、入库等操作
- **操作流程**：
  1. 扫描人员二维码（自动识别人员信息）
  2. 系统自动验证人员权限：
     - 验证人员是否有操作权限
     - 验证人员是否在指定部门
     - 验证人员是否在指定角色
  3. 如果权限验证通过，允许操作
  4. 如果权限验证失败，提示错误信息
- **优化效果**：从3步减少到1步（扫码），<5秒完成

**场景3：扫码人员报工**
- **操作位置**：报工阶段
- **操作流程**：
  1. 扫描人员二维码（自动识别人员信息）
  2. 系统自动填充：
     - 操作人员：张三（自动填充）
     - 部门：生产部（自动填充）
  3. 扫描工单二维码（自动识别工单信息）
  4. 输入报工信息
  5. 提交报工（系统自动记录操作人员）
- **优化效果**：从6步减少到3步（扫码人员→扫码工单→提交），<1分钟完成

**场景4：扫码人员查询**
- **操作位置**：人员查询（移动端）
- **操作流程**：
  1. 扫描人员二维码（自动识别人员信息）
  2. 系统自动显示人员详情：
     - 人员基本信息（员工编码、员工姓名、部门、职位）
     - 人员权限（角色、权限列表）
     - 人员绩效（报工记录、效率统计、质量统计）
  3. 查看人员详情
- **优化效果**：从4步减少到1步（扫码），<10秒完成

**系统行为：**
- ✅ **人员码自动生成**：
  - 创建员工时自动生成人员码
  - 人员码包含人员关键信息（员工编码、员工姓名、部门、角色等）
- ✅ **人员码自动识别**：
  - 扫码后自动解析二维码内容（JSON格式）
  - 自动识别员工编码
  - 自动匹配系统员工（基于员工编码）
- ✅ **人员码信息自动填充**：
  - 扫码后自动填充人员信息（员工编码、员工姓名、部门、角色等）
  - 自动填充人员权限（角色、权限列表）
  - 自动填充人员绩效（报工记录、效率统计、质量统计）
- ✅ **人员码权限验证**：
  - 扫码后自动验证人员权限
  - 验证人员是否有操作权限
  - 验证人员是否在指定部门/角色

**验收标准：**
- ✅ 人员码生成正常（创建员工时自动生成）
- ✅ 人员码识别正常（扫码后自动识别人员信息）
- ✅ 人员码信息填充正常（自动填充人员、权限、绩效信息）
- ✅ 人员码权限验证正常（权限验证功能正常）

---

### 12.7 装箱码（BOX）全流程应用

**装箱码生成规则：**
- **装箱码**：`BOX-{装箱号}-{版本号}`
  - 示例：`BOX-BOX-20260115-001-V1.0`

**装箱码二维码内容（JSON格式）：**
```json
{
  "type": "BOX",
  "code": "BOX-20260115-001",
  "product_code": "FIN-001",
  "product_name": "产品A",
  "quantity": 10,
  "packaging_material": "纸箱A",
  "packaging_quantity": 1,
  "serial_numbers": [
    "MAT-FIN-0001-20260115-000001",
    "MAT-FIN-0001-20260115-000002",
    "..."
  ],
  "packing_date": "2026-01-15",
  "packing_person": "张三",
  "warehouse": "成品仓库",
  "location": "B-01-001",
  "status": "在库",
  "timestamp": "2026-01-15T10:00:00Z"
}
```

**装箱码使用场景：**

**场景1：扫码装箱绑定**
- **操作位置**：成品入库（装箱打包绑定）
- **操作流程**：
  1. 扫描装箱二维码（自动识别装箱信息）
  2. 系统自动填充：
     - 装箱号：BOX-20260115-001（自动识别或自动生成）
     - 装箱日期：2026-01-15（自动填充）
     - 装箱人员：张三（自动填充当前用户）
  3. 扫描产品序列号（逐个扫描或批量扫描）
  4. 系统自动关联产品序列号到装箱号
  5. 选择包装物料：纸箱A
  6. 输入包装物料数量：1个
  7. 点击"确认装箱"按钮
- **优化效果**：从8步减少到4步（扫码装箱→扫码产品→选择包装→确认），<2分钟完成

**场景2：扫码装箱出库**
- **操作位置**：销售出库
- **操作流程**：
  1. 扫描装箱二维码（自动识别装箱信息）
  2. 系统自动填充：
     - 装箱号：BOX-20260115-001（自动识别）
     - 产品：产品A（自动填充）
     - 产品数量：10个（自动填充）
     - 产品序列号列表（自动填充）
  3. 确认出库信息
  4. 提交出库单
- **优化效果**：从6步减少到2步（扫码→提交），<30秒完成

**场景3：扫码装箱查询**
- **操作位置**：装箱查询（移动端）
- **操作流程**：
  1. 扫描装箱二维码（自动识别装箱信息）
  2. 系统自动显示装箱详情：
     - 装箱基本信息（装箱号、产品、数量、包装物料）
     - 产品序列号列表（所有产品序列号）
     - 装箱历史（入库记录、出库记录）
  3. 查看装箱详情
- **优化效果**：从4步减少到1步（扫码），<10秒完成

**场景4：扫码装箱追溯**
- **操作位置**：质量追溯
- **操作流程**：
  1. 扫描装箱二维码（自动识别装箱信息）
  2. 系统自动显示装箱追溯信息：
     - 装箱基本信息（装箱号、产品、数量、包装物料）
     - 产品序列号列表（所有产品序列号）
     - 产品追溯信息（每个产品的生产历史、检验历史）
     - 装箱历史（入库记录、出库记录）
  3. 查看装箱追溯信息
- **优化效果**：从5步减少到1步（扫码），<10秒完成

**系统行为：**
- ✅ **装箱码自动生成**：
  - 创建装箱记录时自动生成装箱码
  - 装箱码包含装箱关键信息（装箱号、产品、数量、包装物料等）
- ✅ **装箱码自动识别**：
  - 扫码后自动解析二维码内容（JSON格式）
  - 自动识别装箱号
  - 自动匹配系统装箱记录（基于装箱号）
- ✅ **装箱码信息自动填充**：
  - 扫码后自动填充装箱信息（装箱号、产品、数量、包装物料等）
  - 自动填充产品序列号列表
  - 自动填充装箱历史（入库记录、出库记录）
- ✅ **装箱码追溯**：
  - 支持通过装箱码查询装箱历史（入库、出库）
  - 支持通过装箱码查询产品追溯信息（每个产品的生产历史、检验历史）

**验收标准：**
- ✅ 装箱码生成正常（创建装箱记录时自动生成）
- ✅ 装箱码识别正常（扫码后自动识别装箱信息）
- ✅ 装箱码信息填充正常（自动填充装箱、产品序列号、历史信息）
- ✅ 装箱码追溯正常（查询装箱历史、产品追溯信息）

---

### 12.8 追溯码（TRACE）全流程应用

**追溯码生成规则：**
- **追溯码**：`TRACE-{产品编码}-{序列号}-{版本号}`
  - 示例：`TRACE-FIN-001-20260115-000001-V1.0`

**追溯码二维码内容（JSON格式）：**
```json
{
  "type": "TRACE",
  "code": "TRACE-FIN-001-20260115-000001",
  "product_code": "FIN-001",
  "product_name": "产品A",
  "serial_number": "MAT-FIN-0001-20260115-000001",
  "batch_no": "20260115-001",
  "production_date": "2026-01-15",
  "production_order": "工单-20260105-001",
  "production_operations": [
    {
      "operation": "注塑工序",
      "operator": "张三",
      "completion_date": "2026-01-15T08:00:00Z"
    },
    {
      "operation": "组装工序",
      "operator": "李四",
      "completion_date": "2026-01-15T10:00:00Z"
    }
  ],
  "quality_inspections": [
    {
      "inspection_type": "来料检验",
      "inspector": "王五",
      "result": "合格",
      "inspection_date": "2026-01-15T09:00:00Z"
    },
    {
      "inspection_type": "成品检验",
      "inspector": "赵六",
      "result": "合格",
      "inspection_date": "2026-01-15T12:00:00Z"
    }
  ],
  "materials": [
    {
      "material_code": "MAT-001",
      "material_name": "原材料A",
      "batch_no": "20260110-001",
      "supplier": "供应商A"
    }
  ],
  "packaging": {
    "box_code": "BOX-20260115-001",
    "packaging_material": "纸箱A"
  },
  "status": "已出库",
  "customer": "客户A",
  "timestamp": "2026-01-15T14:00:00Z"
}
```

**追溯码使用场景：**

**场景1：扫码产品追溯（正向追溯）**
- **操作位置**：质量追溯（正向追溯）
- **操作流程**：
  1. 扫描产品追溯码（自动识别产品信息）
  2. 系统自动显示产品追溯信息：
     - 产品基本信息（产品编码、产品名称、序列号、批次号）
     - 生产历史（工单、工序、操作人员、完成时间）
     - 检验历史（检验类型、检验人员、检验结果、检验时间）
     - 原材料信息（原材料编码、原材料名称、批次号、供应商）
     - 包装信息（装箱号、包装物料）
     - 出库信息（出库单号、客户、出库时间）
  3. 查看产品追溯信息
- **优化效果**：从6步减少到1步（扫码），<10秒完成

**场景2：扫码产品追溯（反向追溯）**
- **操作位置**：质量追溯（反向追溯）
- **操作流程**：
  1. 扫描产品追溯码（自动识别产品信息）
  2. 系统自动显示产品反向追溯信息：
     - 产品基本信息（产品编码、产品名称、序列号、批次号）
     - 使用该产品的其他产品（如果该产品是半成品）
     - 使用该批次的其他产品（如果该产品是原材料）
     - 使用该供应商的其他产品（如果该产品是原材料）
  3. 查看产品反向追溯信息
- **优化效果**：从6步减少到1步（扫码），<10秒完成

**场景3：扫码产品召回**
- **操作位置**：产品召回
- **操作流程**：
  1. 扫描产品追溯码（自动识别产品信息）
  2. 系统自动显示产品信息：
     - 产品基本信息（产品编码、产品名称、序列号、批次号）
     - 生产历史（工单、工序、操作人员、完成时间）
     - 检验历史（检验类型、检验人员、检验结果、检验时间）
     - 出库信息（出库单号、客户、出库时间）
  3. 创建召回单（系统自动填充产品信息）
  4. 提交召回单
- **优化效果**：从7步减少到2步（扫码→提交），<1分钟完成

**场景4：扫码产品查询**
- **操作位置**：产品查询（移动端）
- **操作流程**：
  1. 扫描产品追溯码（自动识别产品信息）
  2. 系统自动显示产品详情：
     - 产品基本信息（产品编码、产品名称、序列号、批次号）
     - 产品状态（在库、已出库、已召回）
     - 产品历史（生产历史、检验历史、出库历史）
  3. 查看产品详情
- **优化效果**：从4步减少到1步（扫码），<10秒完成

**系统行为：**
- ✅ **追溯码自动生成**：
  - 创建产品序列号时自动生成追溯码
  - 追溯码包含产品关键信息（产品编码、序列号、批次号等）
- ✅ **追溯码自动识别**：
  - 扫码后自动解析二维码内容（JSON格式）
  - 自动识别产品编码和序列号
  - 自动匹配系统产品（基于产品编码和序列号）
- ✅ **追溯码信息自动填充**：
  - 扫码后自动填充产品信息（产品编码、产品名称、序列号、批次号等）
  - 自动填充生产历史（工单、工序、操作人员、完成时间）
  - 自动填充检验历史（检验类型、检验人员、检验结果、检验时间）
  - 自动填充原材料信息（原材料编码、原材料名称、批次号、供应商）
  - 自动填充包装信息（装箱号、包装物料）
  - 自动填充出库信息（出库单号、客户、出库时间）
- ✅ **追溯码追溯**：
  - 支持正向追溯（从原材料到成品）
  - 支持反向追溯（从成品到原材料）
  - 支持批次追溯（同一批次的所有产品）
  - 支持供应商追溯（同一供应商的所有产品）

**验收标准：**
- ✅ 追溯码生成正常（创建产品序列号时自动生成）
- ✅ 追溯码识别正常（扫码后自动识别产品信息）
- ✅ 追溯码信息填充正常（自动填充产品、生产、检验、原材料、包装、出库信息）
- ✅ 追溯码追溯正常（正向追溯、反向追溯、批次追溯、供应商追溯）

---

### 12.9 二维码综合应用场景

**场景1：全流程扫码操作（从入库到出库）**
- **入库阶段**：
  1. 扫描物料二维码（自动识别物料信息）
  2. 系统自动填充入库信息
  3. 提交入库单
- **领料阶段**：
  1. 扫描工单二维码（自动识别工单信息）
  2. 扫描物料二维码（自动识别物料信息）
  3. 系统自动匹配BOM物料
  4. 提交领料单
- **报工阶段**：
  1. 扫描工单二维码（自动识别工单信息）
  2. 扫描人员二维码（自动识别人员信息）
  3. 扫描设备二维码（自动识别设备信息）
  4. 扫描上料物料二维码（自动识别上料物料信息）
  5. 扫描下料物料二维码（自动识别下料物料信息）
  6. 输入报工信息
  7. 提交报工
- **入库阶段**：
  1. 扫描工单二维码（自动识别工单信息）
  2. 扫描装箱二维码（自动识别装箱信息）
  3. 扫描产品序列号（逐个扫描或批量扫描）
  4. 提交入库单
- **出库阶段**：
  1. 扫描装箱二维码（自动识别装箱信息）
  2. 系统自动填充出库信息
  3. 提交出库单
- **优化效果**：全流程操作步骤减少60%以上，时间缩短70%以上

**场景2：质量追溯扫码操作**
- **正向追溯**：
  1. 扫描产品追溯码（自动识别产品信息）
  2. 系统自动显示产品追溯信息（生产历史、检验历史、原材料信息、包装信息、出库信息）
- **反向追溯**：
  1. 扫描产品追溯码（自动识别产品信息）
  2. 系统自动显示产品反向追溯信息（使用该产品的其他产品、使用该批次的其他产品、使用该供应商的其他产品）
- **优化效果**：从10步减少到1步（扫码），<10秒完成

**场景3：设备管理扫码操作**
- **设备保养**：
  1. 扫描设备二维码（自动识别设备信息）
  2. 系统自动填充设备保养信息
  3. 填写保养内容
  4. 提交保养记录
- **设备报修**：
  1. 扫描设备二维码（自动识别设备信息）
  2. 系统自动填充设备报修信息
  3. 填写故障描述
  4. 提交报修单
- **设备维修**：
  1. 扫描设备二维码（自动识别设备信息）
  2. 系统自动显示设备报修单列表
  3. 选择报修单
  4. 填写维修内容
  5. 提交维修记录
- **优化效果**：从6步减少到2-3步（扫码→填写→提交），<2分钟完成

**系统行为：**
- ✅ **二维码统一管理**：
  - 所有二维码遵循统一的编码规则
  - 所有二维码使用统一的JSON格式
  - 所有二维码支持统一的扫码识别
- ✅ **二维码自动生成**：
  - 创建业务对象时自动生成二维码
  - 二维码包含业务关键信息
  - 二维码支持打印和显示
- ✅ **二维码自动识别**：
  - 扫码后自动解析二维码内容
  - 自动识别业务对象类型
  - 自动匹配系统业务对象
- ✅ **二维码信息自动填充**：
  - 扫码后自动填充业务信息
  - 自动填充关联信息
  - 自动填充历史信息
- ✅ **二维码状态实时更新**：
  - 业务对象状态变更时自动更新二维码内容
  - 业务对象信息变更时自动更新二维码内容

**验收标准：**
- ✅ 二维码统一管理正常（统一编码规则、统一JSON格式、统一扫码识别）
- ✅ 二维码自动生成正常（创建业务对象时自动生成）
- ✅ 二维码自动识别正常（扫码后自动识别业务对象）
- ✅ 二维码信息填充正常（自动填充业务、关联、历史信息）
- ✅ 二维码状态更新正常（业务对象状态变更时自动更新）

---

## 13. 全场景推演完整度总结

### 13.1 场景覆盖完整性

**已覆盖的核心场景：**

✅ **系统初始化阶段**（第1章）
- 系统注册与登录（一键快速注册）
- 快速初始化向导（一键完成基础配置）

✅ **基础数据配置阶段**（第2章）
- 组织架构配置（批量导入+智能默认值）
- 工厂建模配置（车间、工作中心）
- 物料主数据配置（物料编码映射、多单位管理、批号管理、序列号管理）
- 工序和工艺路线配置（工序类型、跳转规则、物料分组绑定、子工艺路线、版本管理、变更管理）
- 仓库配置（工作时间段配置）
- 供应链主数据配置（供应商、客户）
- 期初数据导入（上线倒计时功能）

✅ **MTS模式业务流程**（第3章）
- 需求管理阶段（销售预测）
- MRP运算阶段（一键生成工单和采购单）
- 工单创建阶段（返工单、工单拆分、工序修改、工单冻结、优先级管理、工单合并）
- 高级排产阶段（工序委外管理）
- 工单下达阶段（批量下达+智能检查）
- 生产领料阶段（一键领料+批量领料、工序报废处理、工序不良品处理）
- 报工阶段（快速报工+带参数报工+工站上下料物料绑定+报工数据修正+报工统计分析）
- 成品入库阶段（一键入库+批量入库+装箱打包绑定+库存盘点）
- 销售出库阶段（批号和序列号选择）
- 生产看板监控
- 单据执行效率优化与耗时统计
- 单据关联与上下游管理

✅ **MTO模式业务流程**（第4章）
- 需求管理阶段（销售订单）
- LRP运算阶段（灵活参数配置）
- 工单创建阶段（关联订单）
- 高级排产阶段（可选）
- 工单下达阶段
- 生产领料阶段（订单专属库存）
- 报工阶段（快速报工+带参数报工）
- 成品入库阶段（订单专属库存）
- 销售出库阶段（关联订单）

✅ **异常处理场景**（第5章）
- 缺料异常处理
- 交期延期异常处理
- 质量异常处理

✅ **质量管理流程**（第6章）
- 来料检验
- 过程检验
- 成品检验

✅ **财务协同流程**（第6章）
- 应付管理
- 应收管理

✅ **报表分析流程**（第7章）
- 库存报表
- 生产报表
- 质量报表

✅ **工位机触屏模式**（第8章）
- 工位机触屏模式概述
- 工位机触屏模式切换
- 现场报工（工位机触屏模式）
- SOP查看（工位机触屏模式）
- 图纸查看（工位机触屏模式）
- 加工程序查看（工位机触屏模式）

✅ **工作台快捷操作**（第9章）
- 工作台首页（快捷操作、待办事项、数据看板）

✅ **通用需求场景**（第10章）
- 数据导入导出（universheet在线表格）
- 高级搜索（拼音搜索）
- 打印功能
- 移动端和工位机触屏支持
- 实时数据推送（WebSocket）
- 权限管理（RBAC）
- 审批流程
- 多角色场景推演与自助式上线向导
- 成本核算流程
- 客户协同平台

✅ **二维码体系全流程应用**（第12章）
- 二维码体系总览
- 物料码（MAT）全流程应用
- 工单码（WO）全流程应用
- 工序码（OP）全流程应用
- 设备码（EQ）全流程应用
- 人员码（EMP）全流程应用
- 装箱码（BOX）全流程应用
- 追溯码（TRACE）全流程应用
- 二维码综合应用场景

### 13.2 功能点覆盖完整性

**已覆盖的核心功能点：**

✅ **基础功能**
- 系统注册与登录
- 快速初始化向导
- 组织架构配置
- 工厂建模配置
- 物料主数据配置
- 工序和工艺路线配置
- 仓库配置
- 供应链主数据配置
- 期初数据导入

✅ **生产管理功能**
- 需求管理（销售预测、销售订单）
- MRP/LRP运算
- 工单管理（创建、下达、拆分、合并、冻结、优先级）
- 高级排产（工序委外）
- 生产领料（一键领料、批量领料）
- 报工管理（快速报工、带参数报工、工站上下料物料绑定）
  - 工站上下料物料绑定功能（核心功能，新增）
    - 上料绑定（扫码绑定和手动选择）
    - 下料绑定（扫码绑定和手动选择）
    - 自动更新上料/下料物料库存
- 成品入库（一键入库、批量入库、装箱打包绑定）
  - 装箱打包绑定流程（核心功能，新增）
    - 装箱绑定（扫码绑定和手动绑定）
    - 产品序列号绑定到装箱号
    - 包装物料绑定（纸箱、托盘等）
- 销售出库（批号和序列号选择）

✅ **质量管理功能**
- 来料检验
- 过程检验
- 成品检验
- 工序报废处理
- 工序不良品处理

✅ **仓储管理功能**
- 库存管理（查询、盘点）
- 入库管理（采购入库、客户来料登记、成品入库）
  - 客户来料一维码/二维码登记解析映射功能（核心功能，新增）
  - 装箱打包绑定流程（核心功能，新增）
- 出库管理（生产领料、销售出库）
- 批号管理
- 序列号管理
- 多单位管理

✅ **设备管理功能**
- 设备台账管理
- 设备保养管理
- 设备报修管理
- 设备维修管理

✅ **成本管理功能**
- 生产成本核算（材料成本、人工成本、制造费用）
- 委外成本核算
- 标准成本和实际成本对比
- 成本优化建议

✅ **报表分析功能**
- 库存报表
- 生产报表
- 质量报表
- 报工统计分析
- 成本分析报表

✅ **协同功能**
- 客户协同平台
- 供应商协同平台
- 单据关联与上下游管理

✅ **二维码功能**
- 物料码、工单码、工序码、设备码、人员码、装箱码、追溯码

### 13.3 用户体验优化完整性

**已实现的用户体验优化：**

✅ **极致简化**
- 一键操作（一键注册、一键入库、一键领料、一键报工）
- 批量处理（批量导入、批量导出、批量操作）
- 智能默认值（自动填充、智能推荐）

✅ **多终端支持**
- PC端（完整功能）
- 移动端（报工界面、扫码功能）
- 工位机触屏模式（大按钮、大字体、全屏模式）

✅ **快速上手**
- 快速初始化向导（3-5步完成）
- 行业模板（一键应用）
- 内置帮助系统（操作提示、帮助文档、操作视频）

✅ **扫码功能**
- 物料码、工单码、工序码、设备码、人员码、装箱码、追溯码
- 全流程扫码操作（从入库到出库）

✅ **数据导入导出**
- universheet在线表格批量导入（实时保存）
- Excel批量导出
- 支持Excel模板下载

✅ **高级搜索**
- 拼音搜索（符合中国用户习惯）
- 快速筛选
- 筛选条件保存

### 13.4 中国制造业实情适配完整性

**已适配的中国制造业实情：**

✅ **一人多岗**
- 操作步骤减少（平均减少50-70%）
- 一键操作（关键操作支持一键完成）
- 批量处理（支持批量操作）

✅ **数据录入量大**
- 批量导入优先（universheet在线表格）
- 智能默认值（减少手动输入）
- 扫码功能（自动识别和填充）

✅ **对系统不熟悉**
- 向导引导（快速初始化向导）
- 智能默认值（所有配置项都有默认值）
- 内置帮助系统（操作提示、帮助文档、操作视频）

✅ **重视效率**
- 一键操作（关键操作支持一键完成）
- 批量操作（支持批量操作）
- 扫码功能（全流程扫码操作）

✅ **快速上手**
- 行业模板（一键应用）
- 快速初始化（3-5步完成）
- 操作提示（内置帮助系统）

✅ **多终端使用**
- 移动端支持（报工界面、扫码功能）
- 工位机触屏模式（车间固定工位）

✅ **降低上线失败风险**
- 数据验证（自动验证数据完整性）
- 操作引导（向导引导、操作提示）
- 进度跟踪（上线倒计时功能）
- 持续优化（AI智能建议）

### 13.5 文档结构完整性

**文档结构：**
- ✅ 推演概述（目标、场景、原则、用户角色、痛点优化）
- ✅ 系统初始化阶段（注册登录、快速初始化向导）
- ✅ 基础数据配置阶段（组织架构、工厂建模、物料主数据、工序工艺路线、仓库、供应链、期初数据）
- ✅ MTS模式业务流程推演（完整流程）
- ✅ MTO模式业务流程推演（完整流程）
- ✅ 异常处理场景推演
- ✅ 质量管理流程推演
- ✅ 财务协同流程推演
- ✅ 报表分析流程推演
- ✅ 工位机触屏模式
- ✅ 工作台快捷操作
- ✅ 通用需求场景
- ✅ 多角色场景推演与自助式上线向导
- ✅ 二维码体系全流程应用
- ✅ 全场景推演完整度总结

### 13.6 文档质量完整性

**文档质量：**
- ✅ 每个场景都有用户操作说明
- ✅ 每个场景都有系统行为说明
- ✅ 每个场景都有验收标准
- ✅ 每个场景都有优化效果说明
- ✅ 文档结构清晰，层次分明
- ✅ 文档内容完整，覆盖全面
- ✅ 文档符合中国制造业实情

### 13.7 待完善事项

**可选增强功能（后期扩展）：**
- ⚠️ 自定义字段
- ⚠️ 自定义报表
- ⚠️ 自定义工作流
- ⚠️ 第三方系统集成
- ⚠️ 自定义移动端界面
- ⚠️ 自定义工位机触屏界面布局
- ⚠️ 自定义扫码规则
- ⚠️ 自定义离线数据同步规则
- ⚠️ 自定义触屏手势规则

### 13.8 文档使用建议

**文档使用方式：**
1. **新用户上线**：按照文档顺序，从第1章开始，逐步完成系统初始化和基础数据配置
2. **功能学习**：按照角色查找对应的场景推演章节，学习如何使用系统
3. **问题排查**：查找对应的异常处理场景，了解如何处理异常情况
4. **功能扩展**：参考二维码体系章节，了解如何扩展扫码功能

**文档维护建议：**
1. 定期更新文档，反映系统最新功能
2. 根据用户反馈，完善场景推演
3. 根据业务变化，更新业务流程
4. 根据技术发展，更新技术实现方式

---

**文档创建时间：** 2025-12-27  
**文档作者：** Luigi Lu  
**推演场景：** MTS模式、MTO模式完整业务流程  
**适用对象：** 全新用户从0开始使用系统  
**文档版本：** v1.0  
**最后更新：** 2025-12-27


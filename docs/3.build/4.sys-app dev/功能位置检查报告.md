# 功能位置检查报告

**检查日期：** 2025-01-15  
**检查范围：** 系统核心层（core）和应用层（apps）的功能分类  
**检查目标：** 识别放错位置的功能，确保架构分层正确

---

## 📋 检查结果

### ✅ 已修复的问题

#### 1. 设备管理功能（已迁移）

**问题：** 设备管理功能原本放在 `core/` 目录下，但应该属于快制造APP的业务功能。

**修复内容：**
- ✅ 模型迁移：`core/models/equipment.py` → `apps/kuaizhizao/models/equipment.py`
- ✅ 服务迁移：`core/services/equipment_service.py` → `apps/kuaizhizao/services/equipment_service.py`
- ✅ Schema迁移：`core/schemas/equipment.py` → `apps/kuaizhizao/schemas/equipment.py`
- ✅ API迁移：`core/api/equipment/` → `apps/kuaizhizao/api/equipment/`
- ✅ API路径更新：`/api/v1/core/equipment` → `/api/v1/apps/kuaizhizao/equipment`
- ✅ 前端API路径更新：所有设备管理相关的API调用路径已更新
- ✅ 开发计划文档更新：所有路径引用已更新
- ✅ core/models/__init__.py 清理：已注释掉设备管理相关的导入

**相关功能：**
- 设备基础信息管理
- 设备维护保养计划管理
- 设备故障维修管理
- 模具管理
- 设备使用记录追溯

**⚠️ 待清理：** core目录下还有残留的旧文件，需要删除：
- `src/core/models/equipment.py`（旧文件，已迁移）
- `src/core/models/equipment_fault.py`（旧文件，已迁移）
- `src/core/models/maintenance_plan.py`（旧文件，已迁移）
- `src/core/models/mold.py`（旧文件，已迁移）
- `src/core/schemas/equipment.py`（旧文件，已迁移）
- `src/core/schemas/equipment_fault.py`（旧文件，已迁移）
- `src/core/schemas/maintenance_plan.py`（旧文件，已迁移）
- `src/core/schemas/mold.py`（旧文件，已迁移）
- `src/core/services/equipment_service.py`（旧文件，已迁移）
- `src/core/services/equipment_fault_service.py`（旧文件，已迁移）
- `src/core/services/maintenance_plan_service.py`（旧文件，已迁移）
- `src/core/services/mold_service.py`（旧文件，已迁移）
- `src/core/api/equipment/`（旧目录，已迁移）
- `src/core/api/equipment_faults/`（旧目录，已迁移）
- `src/core/api/maintenance_plans/`（旧目录，已迁移）
- `src/core/api/molds/`（旧目录，已迁移）

---

### ⚠️ 需要修复的问题

#### 1. 物料编码映射功能（计划文档中位置错误）

**问题：** 开发计划文档中物料编码映射功能计划放在 `core/models/material_code_mapping.py`，但应该属于主数据管理APP。

**建议修复：**
- 📝 模型位置：`core/models/material_code_mapping.py` → `apps/master_data/models/material_code_mapping.py`
- 📝 服务位置：`core/services/material_code_mapping_service.py` → `apps/master_data/services/material_code_mapping_service.py`
- 📝 API路径：`/api/core/materials/mapping` → `/api/v1/apps/master_data/materials/mapping`

**理由：**
- 物料编码映射是业务功能，与物料管理相关
- 文档中提到"主数据管理" → "产品管理" → "物料编码映射"
- 物料管理属于主数据管理APP

**状态：** ✅ 开发计划文档已更新

---

#### 2. 期初数据导入功能（计划文档中位置错误）

**问题：** 开发计划文档中期初数据导入功能计划放在 `core/services/initial_data_service.py`，但应该属于快制造APP。

**建议修复：**
- 📝 服务位置：`core/services/initial_data_service.py` → `apps/kuaizhizao/services/initial_data_service.py`
- 📝 API路径：`/api/core/initial-data/import` → `/api/v1/apps/kuaizhizao/initial-data/import`

**理由：**
- 期初数据导入是业务功能，与快制造APP的业务数据相关
- 导入的数据包括物料、BOM、库存等业务数据
- 属于快制造APP的初始化功能

**状态：** ✅ 开发计划文档已更新

---

### ✅ 正确位置的功能

以下功能正确放置在系统核心层（core），属于系统级功能：

1. **用户权限管理** - `core/models/user.py`, `core/models/role.py`, `core/models/permission.py`
2. **组织架构管理** - `core/models/department.py`, `core/models/position.py`
3. **数据字典** - `core/models/data_dictionary.py`
4. **系统参数** - `core/models/system_parameter.py`
5. **编码规则** - `core/models/code_rule.py`
6. **自定义字段** - `core/models/custom_field.py`
7. **文件管理** - `core/models/file.py`
8. **消息管理** - `core/models/message_template.py`, `core/models/message_config.py`
9. **审批流程** - `core/models/approval_process.py`
10. **打印设备/模板** - `core/models/print_device.py`, `core/models/print_template.py`
11. **报表模板** - `core/models/report_template.py`
12. **数据源/数据集** - `core/models/data_source.py`, `core/models/dataset.py`

---

## 📝 架构分层原则

### 系统核心层（core）职责

**应该包含：**
- ✅ 用户、角色、权限管理
- ✅ 组织架构管理
- ✅ 系统配置（参数、字典、编码规则等）
- ✅ 通用工具（文件、消息、审批流程等）
- ✅ 应用管理机制
- ✅ 数据访问层

**不应该包含：**
- ❌ 业务逻辑实现
- ❌ 业务数据模型（如：工单、物料、设备等）
- ❌ 业务API路由

### 应用层（apps）职责

**应该包含：**
- ✅ 业务逻辑实现
- ✅ 业务数据模型（如：工单、物料、设备、模具等）
- ✅ 业务API路由
- ✅ 业务前端页面

**不应该包含：**
- ❌ 基础功能实现（由系统级提供）
- ❌ 平台级功能实现（由系统级提供）

---

## 🔍 检查方法

### 判断标准

1. **业务相关性：** 功能是否与特定业务领域相关？
   - 是 → 应该放在应用层（apps）
   - 否 → 可能是系统级功能

2. **通用性：** 功能是否被多个应用使用？
   - 是 → 可能是系统级功能
   - 否 → 应该放在应用层（apps）

3. **数据模型：** 数据模型是否与业务实体相关？
   - 是（如：工单、物料、设备） → 应该放在应用层（apps）
   - 否（如：用户、角色、权限） → 应该放在系统级（core）

4. **API路径：** API路径是否应该以 `/api/v1/apps/{app_name}` 开头？
   - 是 → 应该放在应用层（apps）
   - 否 → 可能是系统级功能

---

## 📌 建议

1. **定期检查：** 建议在开发新功能时，先确认功能应该属于哪个层级
2. **文档更新：** 开发计划文档中的路径引用应及时更新
3. **代码审查：** 在代码审查时，检查功能是否放在正确的位置
4. **架构文档：** 维护清晰的架构分层文档，作为开发参考
5. **清理旧文件：** 迁移功能后，应及时删除core目录下的旧文件，避免混淆

---

**报告生成时间：** 2025-01-15  
**检查人员：** AI Assistant

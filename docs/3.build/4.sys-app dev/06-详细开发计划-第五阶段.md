# 详细开发计划 - 第五阶段：高级功能与体验优化（MES扩展功能）

> **文档说明：**  
> 本文档详细列出第五阶段的每个功能点，支持功能点完成一个测试一个标记一个。  
> 每个功能点包含：任务描述、测试用例、验收标准、完成状态。  
> 
> **重要说明：** 本阶段实现MES扩展功能，包括二维码体系、工位机触屏模式、工作台快捷操作、报表分析等。这些功能可以提升MES系统的易用性和扩展性。
> 
> **创建时间：** 2025-12-27  
> **文档版本：** v2.0  
> **最后更新：** 2025-12-27

---

## ⚠️ 开发前必读：前后端统一模板规范

> **🚨 重要提示：** 在开始开发前，请务必阅读并遵循《10-前后端统一模板规范.md》中的规范要求，确保代码符合技术栈原生设定。
> **⚠️ 违反规范将导致代码审查不通过，需要返工重写！**

### 📋 前端开发规范（必须遵守）

**所有列表页面必须使用：**
- ✅ `ListPageTemplate` 布局组件（禁止使用其他布局）
- ✅ `UniTable` 表格组件（禁止直接使用ProTable）
- ✅ `ProForm` 表单组件（禁止直接使用Form）
- ✅ `ProDescriptions` 详情组件（禁止直接使用Descriptions）
- ✅ `Modal` 用于新建/编辑，`Drawer` 用于详情查看

**标准页面结构（必须遵循）：**
```typescript
<ListPageTemplate>
  <UniTable
    columns={columns}
    request={handleRequest}
    showAdvancedSearch={true}
    showCreateButton={true}
    onCreate={handleCreate}
    showEditButton={true}
    onEdit={handleEdit}
    showDeleteButton={true}
    onDelete={handleDelete}
    onDetail={handleDetail}
  />
</ListPageTemplate>
<Modal> {/* 新建/编辑 */} </Modal>
<Drawer> {/* 详情 */} </Drawer>
```

**禁止事项：**
- ❌ 禁止直接使用 `ProTable`（必须使用 `UniTable`）
- ❌ 禁止直接使用 `Form`（必须使用 `ProForm`）
- ❌ 禁止直接使用 `Descriptions`（必须使用 `ProDescriptions`）
- ❌ 禁止在列表页面中混用其他布局组件

### 📋 后端开发规范（必须遵守）

**所有API路由必须使用：**
- ✅ `APIRouter` 组织路由（禁止使用其他路由方式）
- ✅ `Depends(get_current_user, get_current_tenant)` 依赖注入（必须使用）
- ✅ 统一异常处理（`ValidationError`, `NotFoundError`，禁止直接使用HTTPException）
- ✅ `response_model` 定义响应模型（必须使用）
- ✅ 服务层封装业务逻辑（禁止在API层写业务逻辑）

**标准API结构（必须遵循）：**
```python
router = APIRouter(prefix="/xxx", tags=["XXX"])

@router.post("", response_model=ModelResponse, summary="创建")
async def create_xxx(
    data: ModelCreate,
    current_user: Annotated[User, Depends(get_current_user)],
    tenant_id: Annotated[int, Depends(get_current_tenant)]
):
    try:
        return await Service.create_xxx(tenant_id, data, current_user.id)
    except ValidationError as e:
        raise HTTPException(status_code=400, detail=str(e))
```

**禁止事项：**
- ❌ 禁止在API层写业务逻辑（必须在服务层实现）
- ❌ 禁止直接使用 `HTTPException`（必须使用统一异常类）
- ❌ 禁止不使用依赖注入（必须使用 `get_current_user` 和 `get_current_tenant`）
- ❌ 禁止不使用 `response_model`（必须定义响应模型）

**📖 详细规范请参考：** `10-前后端统一模板规范.md`

---

---

## 📋 目录

1. [步骤5.1：二维码体系](#步骤51二维码体系)
2. [步骤5.2：工位机触屏模式](#步骤52工位机触屏模式)
3. [步骤5.3：工作台快捷操作](#步骤53工作台快捷操作)
4. [步骤5.4：报表分析](#步骤54报表分析)

---

## 步骤5.1：二维码体系

**目标：** 实现二维码体系全流程应用

**时间估算：** 2周

**前置条件：**
- ✅ 第一阶段和第二阶段已完成

---

### 功能点5.1.1：二维码生成和解析服务

**状态：** ⬜ 未开始 | 🟡 进行中 | ✅ 已完成 | ❌ 已取消

**任务描述：**
实现二维码生成和解析服务。

**测试用例：**
- 测试二维码生成
- 测试二维码解析

**验收标准：**
- ✅ 可以生成各种类型的二维码
- ✅ 可以解析二维码
- ✅ 二维码格式正确

**完成标记：**
- [ ] 功能已实现
- [ ] 单元测试已编写并通过

---

### 功能点5.1.2：物料码（MAT）全流程应用

**状态：** ⬜ 未开始 | 🟡 进行中 | ✅ 已完成 | ❌ 已取消

**任务描述：**
实现物料码全流程应用。

**测试用例：**
- 测试物料码生成
- 测试物料码扫描

**验收标准：**
- ✅ 可以生成物料二维码
- ✅ 可以扫描物料二维码
- ✅ 扫描后可以跳转到物料详情

**完成标记：**
- [ ] 功能已实现
- [ ] 单元测试已编写并通过

---

### 功能点5.1.3：工单码（WO）全流程应用

**状态：** ⬜ 未开始 | 🟡 进行中 | ✅ 已完成 | ❌ 已取消

**任务描述：**
实现工单码全流程应用。

**测试用例：**
- 测试工单码生成
- 测试工单码扫描

**验收标准：**
- ✅ 可以生成工单二维码
- ✅ 可以扫描工单二维码
- ✅ 扫描后可以跳转到工单详情

**完成标记：**
- [ ] 功能已实现
- [ ] 单元测试已编写并通过

---

### 功能点5.1.4：工序码（OP）全流程应用

**状态：** ⬜ 未开始 | 🟡 进行中 | ✅ 已完成 | ❌ 已取消

**任务描述：**
实现工序码全流程应用。

**测试用例：**
- 测试工序码生成
- 测试工序码扫描

**验收标准：**
- ✅ 可以生成工序二维码
- ✅ 可以扫描工序二维码
- ✅ 扫描后可以跳转到工序详情

**完成标记：**
- [ ] 功能已实现
- [ ] 单元测试已编写并通过

---

### 功能点5.1.5：设备码（EQ）全流程应用

**状态：** ⬜ 未开始 | 🟡 进行中 | ✅ 已完成 | ❌ 已取消

**任务描述：**
实现设备码全流程应用。

**测试用例：**
- 测试设备码生成
- 测试设备码扫描

**验收标准：**
- ✅ 可以生成设备二维码
- ✅ 可以扫描设备二维码
- ✅ 扫描后可以跳转到设备详情

**完成标记：**
- [ ] 功能已实现
- [ ] 单元测试已编写并通过

---

### 功能点5.1.6：人员码（EMP）全流程应用

**状态：** ⬜ 未开始 | 🟡 进行中 | ✅ 已完成 | ❌ 已取消

**任务描述：**
实现人员码全流程应用。

**测试用例：**
- 测试人员码生成
- 测试人员码扫描

**验收标准：**
- ✅ 可以生成人员二维码
- ✅ 可以扫描人员二维码
- ✅ 扫描后可以跳转到人员详情

**完成标记：**
- [ ] 功能已实现
- [ ] 单元测试已编写并通过

---

### 功能点5.1.7：装箱码（BOX）全流程应用

**状态：** ⬜ 未开始 | 🟡 进行中 | ✅ 已完成 | ❌ 已取消

**任务描述：**
实现装箱码全流程应用。

**测试用例：**
- 测试装箱码生成
- 测试装箱码扫描

**验收标准：**
- ✅ 可以生成装箱二维码
- ✅ 可以扫描装箱二维码
- ✅ 扫描后可以查看装箱详情

**完成标记：**
- [ ] 功能已实现
- [ ] 单元测试已编写并通过

---

### 功能点5.1.8：追溯码（TRACE）全流程应用

**状态：** ⬜ 未开始 | 🟡 进行中 | ✅ 已完成 | ❌ 已取消

**任务描述：**
实现追溯码全流程应用。

**测试用例：**
- 测试追溯码生成
- 测试追溯码扫描

**验收标准：**
- ✅ 可以生成追溯二维码
- ✅ 可以扫描追溯二维码
- ✅ 扫描后可以查看完整追溯链路

**完成标记：**
- [ ] 功能已实现
- [ ] 单元测试已编写并通过

---

## 步骤5.2：工位机触屏模式

**目标：** 实现工位机触屏模式，支持现场报工、SOP查看等

**时间估算：** 1-2周

**前置条件：**
- ✅ 第一阶段已完成（报工功能已实现）

---

### 功能点5.2.1：工位机触屏模式切换

**状态：** ⬜ 未开始 | 🟡 进行中 | ✅ 已完成 | ❌ 已取消

**任务描述：**
实现工位机触屏模式切换功能。

**测试用例：**
- 测试触屏模式检测
- 测试模式切换

**验收标准：**
- ✅ 可以自动检测触屏设备
- ✅ 可以手动切换触屏模式
- ✅ 触屏模式界面适配良好

**完成标记：**
- [ ] 功能已实现
- [ ] 单元测试已编写并通过

---

### 功能点5.2.2：现场报工（工位机触屏模式）

**状态：** ⬜ 未开始 | 🟡 进行中 | ✅ 已完成 | ❌ 已取消

**任务描述：**
实现现场报工功能，适配工位机触屏模式。

**测试用例：**
- 测试触屏模式报工
- 测试触屏界面适配

**验收标准：**
- ✅ 触屏模式报工界面适配良好
- ✅ 按钮和字体足够大
- ✅ 操作简单直观

**完成标记：**
- [ ] 功能已实现
- [ ] 单元测试已编写并通过

---

### 功能点5.2.3：SOP查看（工位机触屏模式）

**状态：** ⬜ 未开始 | 🟡 进行中 | ✅ 已完成 | ❌ 已取消

**任务描述：**
实现SOP查看功能，适配工位机触屏模式。

**测试用例：**
- 测试SOP查看
- 测试步骤高亮

**验收标准：**
- ✅ 可以查看SOP
- ✅ 当前步骤高亮显示
- ✅ 已完成步骤标记清晰

**完成标记：**
- [ ] 功能已实现
- [ ] 单元测试已编写并通过

---

### 功能点5.2.4：图纸查看（工位机触屏模式）

**状态：** ⬜ 未开始 | 🟡 进行中 | ✅ 已完成 | ❌ 已取消

**任务描述：**
实现图纸查看功能，适配工位机触屏模式。

**测试用例：**
- 测试图纸查看
- 测试触屏操作（缩放、旋转）

**验收标准：**
- ✅ 可以查看图纸
- ✅ 支持触屏缩放和旋转
- ✅ 图纸显示清晰

**完成标记：**
- [ ] 功能已实现
- [ ] 单元测试已编写并通过

---

### 功能点5.2.5：加工程序查看（工位机触屏模式）

**状态：** ⬜ 未开始 | 🟡 进行中 | ✅ 已完成 | ❌ 已取消

**任务描述：**
实现加工程序查看功能，适配工位机触屏模式。

**测试用例：**
- 测试加工程序查看

**验收标准：**
- ✅ 可以查看加工程序
- ✅ 程序代码显示清晰

**完成标记：**
- [ ] 功能已实现
- [ ] 单元测试已编写并通过

---

## 步骤5.3：工作台快捷操作

**目标：** 实现工作台快捷操作功能

**时间估算：** 1周

**前置条件：**
- ✅ 第一阶段已完成

---

### 功能点5.3.1：工作台首页

**状态：** ⬜ 未开始 | 🟡 进行中 | ✅ 已完成 | ❌ 已取消

**任务描述：**
实现工作台首页。

**测试用例：**
- 测试工作台首页渲染
- 测试快捷操作

**验收标准：**
- ✅ 工作台首页可以正常渲染
- ✅ 快捷操作功能正常
- ✅ 待办事项显示准确

**完成标记：**
- [ ] 功能已实现
- [ ] 单元测试已编写并通过

---

### 功能点5.3.2：待办事项展示

**状态：** ⬜ 未开始 | 🟡 进行中 | ✅ 已完成 | ❌ 已取消

**任务描述：**
实现待办事项展示功能。

**测试用例：**
- 测试待办事项查询
- 测试待办事项跳转

**验收标准：**
- ✅ 可以查询待办事项
- ✅ 待办事项信息准确
- ✅ 可以点击跳转到相关页面

**完成标记：**
- [ ] 功能已实现
- [ ] 单元测试已编写并通过

---

### 功能点5.3.3：数据看板

**状态：** ⬜ 未开始 | 🟡 进行中 | ✅ 已完成 | ❌ 已取消

**任务描述：**
实现数据看板功能。

**测试用例：**
- 测试看板数据查询
- 测试看板数据准确性

**验收标准：**
- ✅ 可以查询看板数据
- ✅ 看板数据准确
- ✅ 看板展示清晰

**完成标记：**
- [ ] 功能已实现
- [ ] 单元测试已编写并通过

---

## 步骤5.4：报表分析

**目标：** 实现报表分析功能，包括库存、生产、质量报表和自定义报表设计器

**时间估算：** 1-2周

**前置条件：**
- ✅ 第一阶段和第二阶段已完成

---

### 功能点5.4.1：库存报表

**状态：** ⬜ 未开始 | 🟡 进行中 | ✅ 已完成 | ❌ 已取消

**任务描述：**
实现库存报表功能。

**测试用例：**
- 测试库存报表查询
- 测试报表数据准确性

**验收标准：**
- ✅ 可以查询库存报表
- ✅ 报表数据准确
- ✅ 支持图表展示

**完成标记：**
- [ ] 功能已实现
- [ ] 单元测试已编写并通过

---

### 功能点5.4.2：生产报表

**状态：** ⬜ 未开始 | 🟡 进行中 | ✅ 已完成 | ❌ 已取消

**任务描述：**
实现生产报表功能。

**测试用例：**
- 测试生产报表查询

**验收标准：**
- ✅ 可以查询生产报表
- ✅ 报表数据准确

**完成标记：**
- [ ] 功能已实现
- [ ] 单元测试已编写并通过

---

### 功能点5.4.3：质量报表

**状态：** ⬜ 未开始 | 🟡 进行中 | ✅ 已完成 | ❌ 已取消

**任务描述：**
实现质量报表功能。

**测试用例：**
- 测试质量报表查询

**验收标准：**
- ✅ 可以查询质量报表
- ✅ 报表数据准确

**完成标记：**
- [ ] 功能已实现
- [ ] 单元测试已编写并通过

---

### 功能点5.4.4：自定义报表设计器（自研方案）

**状态：** ⬜ 未开始 | 🟡 进行中 | ✅ 已完成 | ❌ 已取消

**任务描述：**
实现自定义报表设计器，基于@dnd-kit + @ant-design/charts。

**测试用例：**
- 测试报表设计器功能
- 测试报表保存和加载

**验收标准：**
- ✅ 可以拖拽创建图表
- ✅ 可以配置图表数据源
- ✅ 可以保存和加载报表模板

**完成标记：**
- [ ] 功能已实现
- [ ] 单元测试已编写并通过

---

## 功能点进度跟踪

### 步骤5.1总体进度

- [ ] 功能点5.1.1：二维码生成和解析服务
- [ ] 功能点5.1.2：物料码（MAT）全流程应用
- [ ] 功能点5.1.3：工单码（WO）全流程应用
- [ ] 功能点5.1.4：工序码（OP）全流程应用
- [ ] 功能点5.1.5：设备码（EQ）全流程应用
- [ ] 功能点5.1.6：人员码（EMP）全流程应用
- [ ] 功能点5.1.7：装箱码（BOX）全流程应用
- [ ] 功能点5.1.8：追溯码（TRACE）全流程应用

**完成度：** 0/8 (0%)

### 步骤5.2总体进度

- [ ] 功能点5.2.1：工位机触屏模式切换
- [ ] 功能点5.2.2：现场报工（工位机触屏模式）
- [ ] 功能点5.2.3：SOP查看（工位机触屏模式）
- [ ] 功能点5.2.4：图纸查看（工位机触屏模式）
- [ ] 功能点5.2.5：加工程序查看（工位机触屏模式）

**完成度：** 0/5 (0%)

### 步骤5.3总体进度

- [ ] 功能点5.3.1：工作台首页
- [ ] 功能点5.3.2：待办事项展示
- [ ] 功能点5.3.3：数据看板

**完成度：** 0/3 (0%)

### 步骤5.4总体进度

- [ ] 功能点5.4.1：库存报表
- [ ] 功能点5.4.2：生产报表
- [ ] 功能点5.4.3：质量报表
- [ ] 功能点5.4.4：自定义报表设计器（自研方案）

**完成度：** 0/4 (0%)

### 第五阶段总体进度

**总功能点数：** 20个  
**已完成：** 0个  
**进行中：** 0个  
**未开始：** 20个  
**完成度：** 0/20 (0%)

---

**文档创建时间：** 2025-12-27  
**文档作者：** Auto (AI Assistant)  
**文档版本：** v2.0  
**最后更新：** 2025-12-27

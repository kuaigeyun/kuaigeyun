# 详细开发计划 - 第六阶段：扩展功能与集成

> **文档说明：**  
> 本文档详细列出第六阶段的每个功能点，支持功能点完成一个测试一个标记一个。  
> 每个功能点包含：任务描述、测试用例、验收标准、完成状态。  
> 
> **重要说明：** 本阶段实现通用需求功能、多角色场景、降低上线失败风险最佳实践、AI智能建议等扩展功能。
> 
> **创建时间：** 2025-12-27  
> **文档版本：** v2.0  
> **最后更新：** 2025-12-27

---

## ⚠️ 开发前必读：前后端统一模板规范

> **🚨 重要提示：** 在开始开发前，请务必阅读并遵循《10-前后端统一模板规范.md》中的规范要求，确保代码符合技术栈原生设定。
> **⚠️ 违反规范将导致代码审查不通过，需要返工重写！**

### 📋 前端开发规范（必须遵守）

**所有列表页面必须使用：**
- ✅ `ListPageTemplate` 布局组件（禁止使用其他布局）
- ✅ `UniTable` 表格组件（禁止直接使用ProTable）
- ✅ `ProForm` 表单组件（禁止直接使用Form）
- ✅ `ProDescriptions` 详情组件（禁止直接使用Descriptions）
- ✅ `Modal` 用于新建/编辑，`Drawer` 用于详情查看

**标准页面结构（必须遵循）：**
```typescript
<ListPageTemplate>
  <UniTable
    columns={columns}
    request={handleRequest}
    showAdvancedSearch={true}
    showCreateButton={true}
    onCreate={handleCreate}
    showEditButton={true}
    onEdit={handleEdit}
    showDeleteButton={true}
    onDelete={handleDelete}
    onDetail={handleDetail}
  />
</ListPageTemplate>
<Modal> {/* 新建/编辑 */} </Modal>
<Drawer> {/* 详情 */} </Drawer>
```

**禁止事项：**
- ❌ 禁止直接使用 `ProTable`（必须使用 `UniTable`）
- ❌ 禁止直接使用 `Form`（必须使用 `ProForm`）
- ❌ 禁止直接使用 `Descriptions`（必须使用 `ProDescriptions`）
- ❌ 禁止在列表页面中混用其他布局组件

### 📋 后端开发规范（必须遵守）

**所有API路由必须使用：**
- ✅ `APIRouter` 组织路由（禁止使用其他路由方式）
- ✅ `Depends(get_current_user, get_current_tenant)` 依赖注入（必须使用）
- ✅ 统一异常处理（`ValidationError`, `NotFoundError`，禁止直接使用HTTPException）
- ✅ `response_model` 定义响应模型（必须使用）
- ✅ 服务层封装业务逻辑（禁止在API层写业务逻辑）

**标准API结构（必须遵循）：**
```python
router = APIRouter(prefix="/xxx", tags=["XXX"])

@router.post("", response_model=ModelResponse, summary="创建")
async def create_xxx(
    data: ModelCreate,
    current_user: Annotated[User, Depends(get_current_user)],
    tenant_id: Annotated[int, Depends(get_current_tenant)]
):
    try:
        return await Service.create_xxx(tenant_id, data, current_user.id)
    except ValidationError as e:
        raise HTTPException(status_code=400, detail=str(e))
```

**禁止事项：**
- ❌ 禁止在API层写业务逻辑（必须在服务层实现）
- ❌ 禁止直接使用 `HTTPException`（必须使用统一异常类）
- ❌ 禁止不使用依赖注入（必须使用 `get_current_user` 和 `get_current_tenant`）
- ❌ 禁止不使用 `response_model`（必须定义响应模型）

**📖 详细规范请参考：** `10-前后端统一模板规范.md`

---

---

## 📋 目录

1. [步骤6.1：通用需求功能](#步骤61通用需求功能)
2. [步骤6.2：多角色场景与自助式上线向导](#步骤62多角色场景与自助式上线向导)
3. [步骤6.3：降低上线失败风险最佳实践](#步骤63降低上线失败风险最佳实践)
4. [步骤6.4：AI智能建议功能](#步骤64ai智能建议功能)

---

## 步骤6.1：通用需求功能

**目标：** 实现通用需求功能，包括数据导入导出、高级搜索、打印等

**时间估算：** 1-2周

**前置条件：**
- ✅ 第一阶段已完成

---

### 功能点6.1.1：数据导入导出（UniSheet）

**状态：** ⬜ 未开始 | 🟡 进行中 | ✅ 已完成 | ❌ 已取消

**任务描述：**
实现数据导入导出功能，使用UniSheet在线表格。

**测试用例：**
- 测试数据导入
- 测试数据导出

**验收标准：**
- ✅ 可以使用UniSheet导入数据
- ✅ 可以使用UniSheet导出数据
- ✅ 导入导出数据准确

**完成标记：**
- [ ] 功能已实现
- [ ] 单元测试已编写并通过

---

### 功能点6.1.2：高级搜索（拼音搜索）

**状态：** ⬜ 未开始 | 🟡 进行中 | ✅ 已完成 | ❌ 已取消

**任务描述：**
实现高级搜索功能，支持拼音搜索。

**测试用例：**
- 测试拼音搜索
- 测试搜索准确性

**验收标准：**
- ✅ 支持拼音搜索
- ✅ 搜索结果准确
- ✅ 搜索性能良好

**完成标记：**
- [ ] 功能已实现
- [ ] 单元测试已编写并通过

---

### 功能点6.1.3：打印功能

**状态：** ⬜ 未开始 | 🟡 进行中 | ✅ 已完成 | ❌ 已取消

**任务描述：**
实现打印功能。

**测试用例：**
- 测试打印功能
- 测试打印模板

**验收标准：**
- ✅ 可以打印单据
- ✅ 打印格式正确

**完成标记：**
- [ ] 功能已实现
- [ ] 单元测试已编写并通过

---

### 功能点6.1.4：移动端和工位机触屏支持

**状态：** ⬜ 未开始 | 🟡 进行中 | ✅ 已完成 | ❌ 已取消

**任务描述：**
实现移动端和工位机触屏支持。

**测试用例：**
- 测试移动端适配
- 测试触屏适配

**验收标准：**
- ✅ 移动端界面适配良好
- ✅ 触屏界面适配良好
- ✅ 功能完整可用

**完成标记：**
- [ ] 功能已实现
- [ ] 单元测试已编写并通过

---

### 功能点6.1.5：实时数据推送（WebSocket）

**状态：** ⬜ 未开始 | 🟡 进行中 | ✅ 已完成 | ❌ 已取消

**任务描述：**
实现实时数据推送功能，使用WebSocket。

**测试用例：**
- 测试WebSocket连接
- 测试实时数据推送

**验收标准：**
- ✅ WebSocket连接正常
- ✅ 实时数据推送正常
- ✅ 数据更新及时

**完成标记：**
- [ ] 功能已实现
- [ ] 单元测试已编写并通过

---

### 功能点6.1.6：权限管理（RBAC）

**状态：** ⬜ 未开始 | 🟡 进行中 | ✅ 已完成 | ❌ 已取消

**任务描述：**
实现权限管理功能，使用RBAC模型。

**测试用例：**
- 测试权限验证
- 测试权限控制

**验收标准：**
- ✅ 权限验证正常
- ✅ 权限控制准确

**完成标记：**
- [ ] 功能已实现
- [ ] 单元测试已编写并通过

---

### 功能点6.1.7：审批流程

**状态：** ⬜ 未开始 | 🟡 进行中 | ✅ 已完成 | ❌ 已取消

**任务描述：**
实现审批流程功能。

**测试用例：**
- 测试审批流程
- 测试审批路由

**验收标准：**
- ✅ 审批流程正常
- ✅ 审批路由正确

**完成标记：**
- [ ] 功能已实现
- [ ] 单元测试已编写并通过

---

## 步骤6.2：多角色场景与自助式上线向导

**目标：** 实现多角色场景推演和自助式上线向导

**时间估算：** 2周

**前置条件：**
- ✅ 第一阶段和第二阶段已完成

---

### 功能点6.2.1：多角色场景推演功能

**状态：** ⬜ 未开始 | 🟡 进行中 | ✅ 已完成 | ❌ 已取消

**任务描述：**
实现多角色场景推演功能，支持13个角色的完整使用场景。

**测试用例：**
- 测试角色场景推演
- 测试场景完整性

**验收标准：**
- ✅ 13个角色的场景推演功能完整
- ✅ 场景内容准确

**完成标记：**
- [ ] 功能已实现
- [ ] 单元测试已编写并通过

---

### 功能点6.2.2：自助式上线向导

**状态：** ⬜ 未开始 | 🟡 进行中 | ✅ 已完成 | ❌ 已取消

**任务描述：**
实现自助式上线向导，为每个角色提供上线准备向导。

**测试用例：**
- 测试上线向导功能
- 测试向导完整性

**验收标准：**
- ✅ 自助式上线向导功能完整
- ✅ 13个角色的向导都可用

**完成标记：**
- [ ] 功能已实现
- [ ] 单元测试已编写并通过

---

## 步骤6.3：降低上线失败风险最佳实践

**目标：** 实现降低上线失败风险的最佳实践功能

**时间估算：** 1-2周

**前置条件：**
- ✅ 第一阶段和第二阶段已完成

---

### 功能点6.3.1：数据质量保障机制

**状态：** ⬜ 未开始 | 🟡 进行中 | ✅ 已完成 | ❌ 已取消

**任务描述：**
实现数据质量保障机制，包括数据验证和数据清洗建议。

**测试用例：**
- 测试数据验证
- 测试数据清洗建议

**验收标准：**
- ✅ 数据验证功能正常
- ✅ 数据清洗建议准确

**完成标记：**
- [ ] 功能已实现
- [ ] 单元测试已编写并通过

---

### 功能点6.3.2：操作引导和帮助系统

**状态：** ⬜ 未开始 | 🟡 进行中 | ✅ 已完成 | ❌ 已取消

**任务描述：**
实现操作引导和帮助系统。

**测试用例：**
- 测试操作引导
- 测试帮助系统

**验收标准：**
- ✅ 操作引导功能正常
- ✅ 帮助系统功能完整

**完成标记：**
- [ ] 功能已实现
- [ ] 单元测试已编写并通过

---

### 功能点6.3.3：上线进度跟踪和检查清单

**状态：** ⬜ 未开始 | 🟡 进行中 | ✅ 已完成 | ❌ 已取消

**任务描述：**
实现上线进度跟踪和检查清单功能。

**测试用例：**
- 测试进度跟踪
- 测试检查清单

**验收标准：**
- ✅ 上线进度跟踪正常
- ✅ 检查清单功能完整

**完成标记：**
- [ ] 功能已实现
- [ ] 单元测试已编写并通过

---

### 功能点6.3.4：使用情况分析和优化建议推送

**状态：** ⬜ 未开始 | 🟡 进行中 | ✅ 已完成 | ❌ 已取消

**任务描述：**
实现使用情况分析和优化建议推送功能。

**测试用例：**
- 测试使用情况分析
- 测试优化建议生成

**验收标准：**
- ✅ 使用情况分析准确
- ✅ 优化建议有用

**完成标记：**
- [ ] 功能已实现
- [ ] 单元测试已编写并通过

---

## 步骤6.4：AI智能建议功能

**目标：** 实现AI智能建议功能

**时间估算：** 1周

**前置条件：**
- ✅ 第一阶段已完成

---

### 功能点6.4.1：AI智能建议服务

**状态：** ⬜ 未开始 | 🟡 进行中 | ✅ 已完成 | ❌ 已取消

**任务描述：**
实现AI智能建议服务，通过Inngest AI工作流。

**测试用例：**
- 测试AI建议生成
- 测试AI建议展示

**验收标准：**
- ✅ AI建议可以正常生成
- ✅ AI建议在侧边栏显示，不打断操作流程
- ✅ AI建议内容准确有用

**完成标记：**
- [ ] 功能已实现
- [ ] 单元测试已编写并通过

---

## 功能点进度跟踪

### 步骤5.1总体进度

- [ ] 功能点5.1.1：二维码生成和解析服务
- [ ] 功能点5.1.2：物料码（MAT）全流程应用
- [ ] 功能点5.1.3：工单码（WO）全流程应用
- [ ] 功能点5.1.4：工序码（OP）全流程应用
- [ ] 功能点5.1.5：设备码（EQ）全流程应用
- [ ] 功能点5.1.6：人员码（EMP）全流程应用
- [ ] 功能点5.1.7：装箱码（BOX）全流程应用
- [ ] 功能点5.1.8：追溯码（TRACE）全流程应用

**完成度：** 0/8 (0%)

### 步骤5.2总体进度

- [ ] 功能点5.2.1：工位机触屏模式切换
- [ ] 功能点5.2.2：现场报工（工位机触屏模式）
- [ ] 功能点5.2.3：SOP查看（工位机触屏模式）
- [ ] 功能点5.2.4：图纸查看（工位机触屏模式）
- [ ] 功能点5.2.5：加工程序查看（工位机触屏模式）

**完成度：** 0/5 (0%)

### 步骤5.3总体进度

- [ ] 功能点5.3.1：工作台首页
- [ ] 功能点5.3.2：待办事项展示
- [ ] 功能点5.3.3：数据看板

**完成度：** 0/3 (0%)

### 步骤5.4总体进度

- [ ] 功能点5.4.1：库存报表
- [ ] 功能点5.4.2：生产报表
- [ ] 功能点5.4.3：质量报表
- [ ] 功能点5.4.4：自定义报表设计器（自研方案）

**完成度：** 0/4 (0%)

### 步骤6.1总体进度

- [ ] 功能点6.1.1：数据导入导出（UniSheet）
- [ ] 功能点6.1.2：高级搜索（拼音搜索）
- [ ] 功能点6.1.3：打印功能
- [ ] 功能点6.1.4：移动端和工位机触屏支持
- [ ] 功能点6.1.5：实时数据推送（WebSocket）
- [ ] 功能点6.1.6：权限管理（RBAC）
- [ ] 功能点6.1.7：审批流程

**完成度：** 0/7 (0%)

### 步骤6.2总体进度

- [ ] 功能点6.2.1：多角色场景推演功能
- [ ] 功能点6.2.2：自助式上线向导

**完成度：** 0/2 (0%)

### 步骤6.3总体进度

- [ ] 功能点6.3.1：数据质量保障机制
- [ ] 功能点6.3.2：操作引导和帮助系统
- [ ] 功能点6.3.3：上线进度跟踪和检查清单
- [ ] 功能点6.3.4：使用情况分析和优化建议推送

**完成度：** 0/4 (0%)

### 步骤6.4总体进度

- [ ] 功能点6.4.1：AI智能建议服务

**完成度：** 0/1 (0%)

### 第六阶段总体进度

**总功能点数：** 34个  
**已完成：** 0个  
**进行中：** 0个  
**未开始：** 34个  
**完成度：** 0/34 (0%)

---

**文档创建时间：** 2025-12-27  
**文档作者：** Auto (AI Assistant)  
**文档版本：** v1.0  
**最后更新：** 2025-12-27

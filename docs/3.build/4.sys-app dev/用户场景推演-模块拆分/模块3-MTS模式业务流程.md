# 模块3：MTS模式业务流程

## 📋 模块概述

**目标：** 完成MTS（按库存生产）模式的完整业务流程  
**优先级：** ⭐⭐⭐⭐⭐（最高）  
**开发阶段：** 第一阶段  
**预计时间：** 核心流程开发

---

## 场景3.1：需求管理阶段

### 基础流程

**目标：** 完成销售预测的基础创建

**用户操作：**
1. 进入"快智造" → "计划管理" → "需求管理" → "销售预测(MTS)"
2. 创建销售预测（手动创建）：
   - 产品A：1月份预测100个，2月份预测120个，3月份预测150个
   - 产品B：1月份预测50个，2月份预测60个，3月份预测80个
3. 提交销售预测

**系统行为：**
- ✅ 保存销售预测数据
- ✅ 标记为MTS模式

**验收标准：**
- ✅ 销售预测创建成功
- ✅ 销售预测标记为MTS模式

---

### 体验改进流程

**目标：** 优化需求管理体验

**功能点：**
- ✅ 销售预测批量导入（Excel批量导入，支持模板下载）
- ✅ 销售预测历史数据查看（历史预测对比）
- ✅ 销售预测趋势分析（图表展示）
- ✅ Excel数据验证（导入时数据校验和错误提示）

**验收标准：**
- ✅ Excel批量导入功能可用（支持模板下载）
- ✅ 历史数据查看功能可用
- ✅ 趋势分析图表展示正常
- ✅ Excel数据验证和错误提示正常

---

## 场景3.2：MRP运算阶段

### 基础流程

**目标：** 完成MRP运算的核心功能

**用户操作：**
1. 进入"快智造" → "计划管理" → "计划排程" → "MRP运算(MTS)"
2. 选择销售预测（1月份预测）
3. 点击"运行MRP运算"
4. 系统自动计算：
   - 根据销售预测和当前库存计算物料需求
   - 根据BOM展开计算原材料需求
   - 生成工单建议和采购建议
5. 查看MRP运算结果：
   - 物料需求清单
   - 工单建议（产品A需要生产90个，产品B需要生产45个）
   - 采购建议（塑料颗粒A需要采购9kg，螺丝需要采购360个）

**系统行为：**
- ✅ 执行MRP运算（同步计算，支持小数据量）
- ✅ 根据销售预测和库存计算物料需求
- ✅ 根据BOM展开计算原材料需求
- ✅ 生成工单建议和采购建议

**验收标准：**
- ✅ MRP运算成功（支持基础数据量：100+物料）
- ✅ 物料需求计算正确
- ✅ 工单建议生成正确
- ✅ 采购建议生成正确

---

### 体验改进流程

**目标：** 优化MRP运算体验和性能

**功能点：**
- ✅ MRP运算异步执行（使用Inngest工作流，支持大数据量：1000+物料）
- ✅ MRP运算进度显示（进度条、状态提示）
- ✅ MRP运算结果导出（Excel导出）
- ✅ MRP运算历史记录（历史运算记录查看）
- ✅ MRP运算参数配置（安全库存、采购周期等参数配置）
- ✅ MRP运算结果可视化（图表展示）

**验收标准：**
- ✅ MRP运算异步执行正常（支持大数据量）
- ✅ 进度显示功能可用
- ✅ Excel导出功能可用
- ✅ 历史记录查看功能可用
- ✅ 参数配置功能可用
- ✅ 结果可视化展示正常

---

## 场景3.3：工单创建阶段

### 基础流程

**目标：** 完成工单的基础创建功能

**用户操作：**
1. 进入"快智造" → "生产执行" → "工单管理" → "工单列表"
2. 根据MRP运算结果创建工单（手动创建）：
   - 点击"新建"按钮
   - 选择产品：产品A
   - 选择数量：90个
   - 选择车间：组装车间
   - 选择工作中心：组装线1
   - 选择计划开始时间：2026-01-05 08:00
   - 选择计划结束时间：2026-01-05 18:00
   - 提交工单
3. 查看工单列表
4. 查看工单详情

**系统行为：**
- ✅ 自动生成工单号（工单-20260105-001，支持中文前缀）
- ✅ 创建工单数据
- ✅ 根据BOM自动生成工单工序

**验收标准：**
- ✅ 工单创建成功
- ✅ 工单号自动生成成功（支持中文前缀）
- ✅ 工单工序自动生成成功

---

### 体验改进流程

**目标：** 优化工单创建和管理体验

**功能点：**
- ✅ 工单批量导入（Excel批量导入，支持模板下载）
- ✅ 工单二维码生成（用于扫码报工，支持中文二维码）
- ✅ 工单高级搜索（拼音搜索、快速筛选）
- ✅ 工单详情查看（使用Drawer）
- ✅ 工单打印（打印模板、打印预览）
- ✅ 工单状态管理（状态流转、状态历史）
- ✅ 工单进度跟踪（进度可视化）
- ✅ Excel数据验证（导入时数据校验和错误提示）

**验收标准：**
- ✅ Excel批量导入功能可用（支持模板下载）
- ✅ 工单二维码生成成功（支持中文）
- ✅ 工单高级搜索可用（拼音搜索）
- ✅ 工单详情Drawer展示正常
- ✅ 工单打印可用（打印预览正常）
- ✅ 工单状态管理可用
- ✅ 工单进度跟踪可用
- ✅ Excel数据验证和错误提示正常

---

## 场景3.4：高级排产阶段（可选）

### 基础流程

**目标：** 完成基础排产功能

**用户操作：**
1. 进入"快智造" → "计划管理" → "高级排产" → "排产甘特图"
2. 查看所有待排产工单（列表展示）
3. 手动调整工单排产计划（列表编辑）：
   - 调整工单开始时间
   - 调整工单结束时间
   - 调整工作中心分配
4. 保存排产计划

**系统行为：**
- ✅ 显示待排产工单列表
- ✅ 保存排产计划

**验收标准：**
- ✅ 待排产工单列表展示正常
- ✅ 排产计划保存成功

---

### 体验改进流程

**目标：** 优化高级排产体验

**功能点：**
- ✅ 排产甘特图可视化展示（可视化排程）
- ✅ 拖拽调整排产计划（拖拽操作）
- ✅ 工作中心能力检查（自动检查冲突）
- ✅ 排产计划导出（Excel导出）
- ✅ 排产计划打印（打印模板）
- ✅ 排产算法优化（自动排产建议）
- ✅ 排产冲突提示（冲突检测和提示）

**验收标准：**
- ✅ 排产甘特图展示正常（支持拖拽）
- ✅ 工作中心能力检查正常
- ✅ Excel导出功能可用
- ✅ 打印功能可用
- ✅ 自动排产建议可用
- ✅ 冲突检测和提示正常

---

## 场景3.5：工单下达阶段

### 基础流程

**目标：** 完成工单下达的核心功能

**用户操作：**
1. 进入"快智造" → "生产执行" → "工单管理" → "工单列表"
2. 选择已排产的工单
3. 点击"下达"按钮
4. 确认下达工单
5. 工单状态变为"已下达"

**系统行为：**
- ✅ 更新工单状态为"已下达"

**验收标准：**
- ✅ 工单下达成功
- ✅ 工单状态更新成功

---

### 体验改进流程

**目标：** 优化工单下达体验

**功能点：**
- ✅ 工单状态流转工作流（使用Inngest工作流）
- ✅ 通知相关人员（生产管理员、车间工人，消息通知）
- ✅ 工单批量下达（批量操作）
- ✅ 工单下达前检查（库存检查、物料准备检查）

**验收标准：**
- ✅ 工单状态流转工作流正常
- ✅ 通知发送成功
- ✅ 批量下达功能可用
- ✅ 下达前检查功能可用

---

## 场景3.6：生产领料阶段

### 基础流程

**目标：** 完成生产领料的核心功能

**用户操作：**
1. 进入"快智造" → "仓储管理" → "出库管理"
2. 创建生产领料出库单（手动创建）：
   - 点击"新建"按钮
   - 选择关联工单：工单-20260105-001（产品A）
   - 系统自动根据BOM生成领料需求：
     - 注塑件A：180个（从半成品仓库）
     - 注塑件B：90个（从半成品仓库）
     - 螺丝：360个（从原材料仓库）
   - 确认领料数量
   - 提交出库单
3. 系统自动更新库存

**系统行为：**
- ✅ 根据工单和BOM自动生成领料需求
- ✅ 创建出库单
- ✅ 自动更新库存数量
- ✅ 记录出库历史

**验收标准：**
- ✅ 生产领料出库单创建成功
- ✅ 领料需求自动生成正确
- ✅ 库存自动更新成功

---

### 体验改进流程

**目标：** 优化生产领料体验

**功能点：**
- ✅ 出库单批量导入（Excel批量导入，支持模板下载）
- ✅ 出库单打印（打印模板、打印预览）
- ✅ 库存可用量检查（领料前库存检查）
- ✅ 领料需求调整（允许手动调整领料数量）
- ✅ Excel数据验证（导入时数据校验和错误提示）

**验收标准：**
- ✅ Excel批量导入功能可用（支持模板下载）
- ✅ 出库单打印可用（打印预览正常）
- ✅ 库存可用量检查正常
- ✅ 领料需求调整功能可用
- ✅ Excel数据验证和错误提示正常

---

## 场景3.7：报工阶段

### 基础流程

**目标：** 完成报工的核心功能

**用户操作：**
1. **车间工人操作（PC端）：**
   - 进入报工界面
   - 输入工单号（手动输入）
   - 选择工序：组装工序
   - 输入完成数量：90个
   - 输入合格数量：88个（2个不良）
   - 输入工时：8小时
   - 输入备注："正常完成"
   - 提交报工
2. **生产管理员操作（PC端）：**
   - 进入"快智造" → "生产执行" → "报工管理" → "报工记录查询"
   - 查看报工记录
   - 查看工单进度（自动更新）

**系统行为：**
- ✅ 记录报工数据
- ✅ 自动更新工单进度
- ✅ 自动判断工单完工（所有工序完成）

**验收标准：**
- ✅ 报工功能正常
- ✅ 工单进度自动更新正常
- ✅ 工单完工自动判断正常

---

### 体验改进流程

**目标：** 优化报工体验和功能完善

**功能点：**
- ✅ 移动端报工界面（移动端优化）
- ✅ 扫码报工（支持二维码、条形码，支持中文二维码）
- ✅ 语音输入（备注支持语音输入）
- ✅ 报工记录高级搜索（拼音搜索、快速筛选）
- ✅ 报工记录批量导入（Excel导入，支持模板下载）
- ✅ 报工数据处理工作流（使用Inngest工作流）
- ✅ 工单进度更新工作流（使用Inngest工作流）
- ✅ 离线功能（网络不稳定场景，离线报工，网络恢复后同步）

**验收标准：**
- ✅ 移动端报工界面优化可用
- ✅ 扫码报工正常（支持中文二维码）
- ✅ 语音输入功能可用
- ✅ 报工记录高级搜索可用（拼音搜索）
- ✅ 报工记录批量导入可用（Excel导入）
- ✅ 报工数据处理工作流正常
- ✅ 工单进度更新工作流正常
- ✅ 离线功能可用（离线报工和同步正常）

---

## 场景3.8：成品入库阶段

### 基础流程

**目标：** 完成成品入库的核心功能

**用户操作：**
1. 进入"快智造" → "仓储管理" → "入库管理"
2. 创建成品入库单（手动创建）：
   - 点击"新建"按钮
   - 选择关联工单：工单-20260105-001（产品A）
   - 系统自动填充：
     - 物料：产品A
     - 数量：88个（合格数量）
     - 仓库：成品仓库
   - 确认入库数量
   - 提交入库单
3. 系统自动更新库存

**系统行为：**
- ✅ 根据工单自动填充入库信息
- ✅ 创建入库单
- ✅ 自动更新库存数量
- ✅ 记录入库历史

**验收标准：**
- ✅ 成品入库单创建成功
- ✅ 入库信息自动填充正确
- ✅ 库存自动更新成功

---

### 体验改进流程

**目标：** 优化成品入库体验

**功能点：**
- ✅ 入库单批量导入（Excel批量导入，支持模板下载）
- ✅ 入库单打印（打印模板、打印预览）
- ✅ Excel数据验证（导入时数据校验和错误提示）

**验收标准：**
- ✅ Excel批量导入功能可用（支持模板下载）
- ✅ 入库单打印可用（打印预览正常）
- ✅ Excel数据验证和错误提示正常

---

## 场景3.9：销售出库阶段

### 基础流程

**目标：** 完成销售出库的核心功能（MTS模式）

**用户操作：**
1. 进入"快智造" → "仓储管理" → "出库管理"
2. 创建销售出库单（MTS模式，从库存发货，手动创建）：
   - 点击"新建"按钮
   - 选择出库类型：销售出库
   - 选择客户：客户A
   - 选择物料：产品A
   - 选择数量：50个
   - 选择仓库：成品仓库
   - 提交出库单
3. 系统自动更新库存

**系统行为：**
- ✅ 创建销售出库单（MTS模式）
- ✅ 自动更新库存数量
- ✅ 记录出库历史

**验收标准：**
- ✅ 销售出库单创建成功
- ✅ 库存自动更新成功

---

### 体验改进流程

**目标：** 优化销售出库体验

**功能点：**
- ✅ 出库单打印（打印模板、打印预览）
- ✅ 库存可用量检查（出库前库存检查）
- ✅ 销售出库单关联销售订单（可选，支持关联）

**验收标准：**
- ✅ 出库单打印可用（打印预览正常）
- ✅ 库存可用量检查正常
- ✅ 关联销售订单功能可用

---

## 场景3.10：生产看板监控

### 基础流程

**目标：** 完成生产看板的基础展示功能

**用户操作：**
1. 进入"快智造" → "报表分析" → "生产监控" → "生产看板"
2. 查看生产数据（页面刷新获取数据）：
   - 进行中工单数：5个
   - 完工工单数：10个
   - 延期工单数：1个
   - 工单进度（列表展示）
3. 查看工单详情（点击工单）

**系统行为：**
- ✅ 显示生产数据（页面加载时获取）
- ✅ 显示工单进度（列表展示）

**验收标准：**
- ✅ 生产看板数据展示正常
- ✅ 工单进度展示正常

---

### 体验改进流程

**目标：** 优化生产看板体验和实时性

**功能点：**
- ✅ 实时数据推送（WebSocket实时更新，延迟<100ms）
- ✅ 工单进度可视化（进度条、状态卡片）
- ✅ 关键指标统计（统计图表）
- ✅ 看板数据导出（Excel、PDF导出）
- ✅ 大屏模式（支持大屏显示）
- ✅ 数据刷新控制（手动刷新、自动刷新设置）
- ✅ 断线重连（WebSocket断线重连）

**验收标准：**
- ✅ 生产看板数据实时更新正常（WebSocket）
- ✅ 工单进度可视化正常
- ✅ 关键指标统计正常
- ✅ 数据导出可用（Excel、PDF）
- ✅ 大屏模式可用
- ✅ 数据刷新控制可用
- ✅ 断线重连功能正常

---

**文档创建时间：** 2025-12-27  
**文档作者：** Luigi Lu


# 第二步开发计划 - MTS/MTO模式完整流程

## 📋 计划概述

**目标：** 基于第一步已完成的MVP核心功能，扩展实现MTS/MTO模式的完整业务流程  
**时间范围：** 2025-01-15 至 2025-04-30（约14周）  
**原则：** 
- 🎯 **聚焦业务闭环**：实现从需求到交付的完整业务流程
- 🚀 **渐进式开发**：先实现MTS模式，再扩展MTO模式
- ⚡ **实用优先**：优先实现高频使用的核心功能
- 🔄 **单据关联**：建立完整的单据上下游关联关系

---

## ✅ 第一步已完成功能回顾

### 核心生产执行功能（已完成）
- ✅ **工单管理**：工单创建、查询、下达、状态流转
- ✅ **报工管理**：扫码报工、进度汇报、工时记录（移动端优化）
- ✅ **仓储操作**：生产领料、成品入库、库存查询
- ✅ **生产看板**：实时监控工单进度、状态统计（WebSocket实时推送）

### 基础数据支持（已完成）
- ✅ **主数据管理**：物料、BOM、工艺路线、仓库、车间、工作中心
- ✅ **系统级功能**：组织架构、用户权限、编码规则

---

## 🎯 第二步开发目标

### 核心目标
1. ✅ **实现MTS模式完整流程**：销售预测 → MRP运算 → 工单生成 → 生产执行 → 销售出库
2. ✅ **实现MTO模式完整流程**：销售订单 → LRP运算 → 工单生成 → 生产执行 → 销售出库
3. ✅ **实现采购流程闭环**：采购单 → 采购入库 → 应付管理
4. ✅ **实现质量管理基础流程**：来料检验、过程检验、成品检验
5. ✅ **实现财务协同基础流程**：应付管理、应收管理
6. ✅ **建立单据关联体系**：上下游单据关联、单据下推/上拉功能

---

## 📅 开发阶段规划

### 第一阶段：MTS模式需求与计划（3周）

#### 阶段1.1：需求管理 - 销售预测（1周）

**功能描述：** 实现MTS模式的需求管理，支持销售预测的创建、查询、管理

**任务清单：**
- [ ] 创建销售预测数据模型（`SalesForecast`、`SalesForecastItem`）
- [ ] 实现销售预测API（CRUD、提交、审核）
- [ ] 实现销售预测批量导入（UniSheet）
- [ ] 实现销售预测批量导出（Excel）
- [ ] 前端页面：销售预测列表（UniTable + 高级搜索）
- [ ] 前端页面：销售预测创建/编辑（统一表单布局）
- [ ] 前端页面：销售预测详情（Drawer）
- [ ] 单据关联展示（下游：MRP运算、工单、销售出库单）
- [ ] 单据下推功能（下推到MRP运算）

**API端点：**
- `POST /api/apps/kuaizhizao/sales-forecasts` - 创建销售预测
- `GET /api/apps/kuaizhizao/sales-forecasts` - 查询销售预测列表
- `GET /api/apps/kuaizhizao/sales-forecasts/{id}` - 查询销售预测详情
- `PUT /api/apps/kuaizhizao/sales-forecasts/{id}` - 更新销售预测
- `DELETE /api/apps/kuaizhizao/sales-forecasts/{id}` - 删除销售预测
- `POST /api/apps/kuaizhizao/sales-forecasts/{id}/submit` - 提交销售预测
- `POST /api/apps/kuaizhizao/sales-forecasts/{id}/push-to-mrp` - 下推到MRP运算

**验收标准：**
- ✅ 销售预测CRUD功能正常
- ✅ 销售预测批量导入可用（Excel导入）
- ✅ 销售预测批量导出可用（Excel导出）
- ✅ 单据关联展示正常（下游单据）
- ✅ 单据下推功能正常（下推到MRP运算）
- ✅ 页面布局统一（使用统一布局规范）

**预计时间：** 1周

---

#### 阶段1.2：计划排程 - MRP运算（2周）

**功能描述：** 实现MRP运算引擎，根据销售预测和库存计算物料需求，生成工单建议和采购建议

**任务清单：**
- [ ] 创建MRP运算结果数据模型（`MRPResult`、`MRPResultItem`）
- [ ] 实现MRP运算引擎（基于销售预测、库存、BOM展开）
- [ ] 实现MRP运算参数配置（灵活参数配置）
- [ ] 实现MRP运算API（执行运算、查询结果）
- [ ] 实现工单建议生成（基于MRP结果）
- [ ] 实现采购建议生成（基于MRP结果）
- [ ] 实现一键生成工单和采购单（单据下推功能）
- [ ] 实现MRP运算结果导出（Excel）
- [ ] 前端页面：MRP运算界面（统一表单布局）
- [ ] 前端页面：MRP运算结果展示（UniTable + 高级搜索）
- [ ] 单据关联展示（上游：销售预测，下游：工单、采购单）

**API端点：**
- `POST /api/apps/kuaizhizao/mrp/run` - 执行MRP运算
- `GET /api/apps/kuaizhizao/mrp/results/{id}` - 查询MRP运算结果
- `POST /api/apps/kuaizhizao/mrp/results/{id}/generate-orders` - 一键生成工单和采购单
- `GET /api/apps/kuaizhizao/mrp/results/{id}/export` - 导出MRP运算结果

**MRP运算逻辑：**
- 基于销售预测计算独立需求
- 基于当前库存计算净需求
- 基于BOM展开计算原材料需求
- 考虑在途采购单和已下达工单
- 生成工单建议（成品生产）
- 生成采购建议（原材料采购）

**验收标准：**
- ✅ MRP运算功能正常（基于销售预测、库存、BOM）
- ✅ MRP运算结果展示正常（物料需求清单）
- ✅ 工单建议生成正常（基于MRP结果）
- ✅ 采购建议生成正常（基于MRP结果）
- ✅ 一键生成工单和采购单正常（单据下推功能）
- ✅ MRP运算结果导出可用（Excel导出）
- ✅ 单据关联展示正常（上游：销售预测，下游：工单、采购单）
- ✅ MRP运算性能满足要求（1000+物料，<30秒）

**Inngest工作流：**
- ✅ 必需：MRP运算工作流（异步执行MRP运算，支持大数据量）

**预计时间：** 2周

---

### 第二阶段：采购流程闭环（2周）

#### 阶段2.1：采购单管理（1周）

**功能描述：** 实现采购单的创建、查询、管理，支持从MRP采购建议生成

**任务清单：**
- [ ] 创建采购单数据模型（`PurchaseOrder`、`PurchaseOrderItem`）
- [ ] 实现采购单API（CRUD、提交、审核）
- [ ] 实现从MRP采购建议生成采购单（单据下推功能）
- [ ] 实现采购单批量导入（UniSheet）
- [ ] 实现采购单批量导出（Excel）
- [ ] 前端页面：采购单列表（UniTable + 高级搜索）
- [ ] 前端页面：采购单创建/编辑（统一表单布局）
- [ ] 前端页面：采购单详情（Drawer）
- [ ] 单据关联展示（上游：MRP运算，下游：采购入库、采购发票）
- [ ] 单据下推功能（下推到采购入库）

**API端点：**
- `POST /api/apps/kuaizhizao/purchase-orders` - 创建采购单
- `GET /api/apps/kuaizhizao/purchase-orders` - 查询采购单列表
- `GET /api/apps/kuaizhizao/purchase-orders/{id}` - 查询采购单详情
- `PUT /api/apps/kuaizhizao/purchase-orders/{id}` - 更新采购单
- `DELETE /api/apps/kuaizhizao/purchase-orders/{id}` - 删除采购单
- `POST /api/apps/kuaizhizao/purchase-orders/{id}/submit` - 提交采购单
- `POST /api/apps/kuaizhizao/purchase-orders/{id}/push-to-receipt` - 下推到采购入库

**验收标准：**
- ✅ 采购单CRUD功能正常
- ✅ 从MRP采购建议生成采购单正常（单据下推功能）
- ✅ 采购单批量导入可用（Excel导入）
- ✅ 采购单批量导出可用（Excel导出）
- ✅ 单据关联展示正常（上游：MRP运算，下游：采购入库）
- ✅ 单据下推功能正常（下推到采购入库）
- ✅ 页面布局统一（使用统一布局规范）

**预计时间：** 1周

---

#### 阶段2.2：采购入库（1周）

**功能描述：** 实现采购入库单的创建、查询、管理，支持批号和序列号管理

**任务清单：**
- [ ] 创建采购入库单数据模型（`PurchaseReceipt`、`PurchaseReceiptItem`）
- [ ] 实现采购入库单API（CRUD）
- [ ] 实现从采购单下推生成采购入库单（单据下推功能）
- [ ] 实现批号管理（如果物料启用批号管理）
- [ ] 实现序列号管理（如果物料启用序列号管理）
- [ ] 实现库存自动更新（入库后更新库存）
- [ ] 实现采购入库单批量导入（UniSheet）
- [ ] 实现采购入库单批量导出（Excel）
- [ ] 前端页面：采购入库单列表（UniTable + 高级搜索）
- [ ] 前端页面：采购入库单创建/编辑（统一表单布局）
- [ ] 前端页面：采购入库单详情（Drawer）
- [ ] 单据关联展示（上游：采购单，下游：采购发票、应付单）
- [ ] 自动生成应付单（财务协同）

**API端点：**
- `POST /api/apps/kuaizhizao/purchase-receipts` - 创建采购入库单
- `GET /api/apps/kuaizhizao/purchase-receipts` - 查询采购入库单列表
- `GET /api/apps/kuaizhizao/purchase-receipts/{id}` - 查询采购入库单详情
- `GET /api/apps/kuaizhizao/purchase-receipts/{id}/print` - 打印入库单

**验收标准：**
- ✅ 采购入库单CRUD功能正常
- ✅ 从采购单下推生成采购入库单正常（单据下推功能）
- ✅ 批号管理正常（如果物料启用批号管理）
- ✅ 序列号管理正常（如果物料启用序列号管理）
- ✅ 库存自动更新正常（入库后更新库存）
- ✅ 采购入库单批量导入可用（Excel导入）
- ✅ 采购入库单批量导出可用（Excel导出）
- ✅ 单据关联展示正常（上游：采购单，下游：应付单）
- ✅ 自动生成应付单正常（财务协同）
- ✅ 页面布局统一（使用统一布局规范）

**Inngest工作流：**
- ✅ 必需：库存更新工作流（异步更新库存）
- ✅ 必需：应付单生成工作流（异步生成应付单）

**预计时间：** 1周

---

### 第三阶段：销售出库与财务协同（2周）

#### 阶段3.1：销售出库（1周）

**功能描述：** 实现销售出库单的创建、查询、管理，支持MTS和MTO模式

**任务清单：**
- [ ] 创建销售出库单数据模型（`SalesDelivery`、`SalesDeliveryItem`）
- [ ] 实现销售出库单API（CRUD）
- [ ] 实现MTS模式销售出库（从库存发货）
- [ ] 实现MTO模式销售出库（关联销售订单）
- [ ] 实现批号和序列号选择（如果物料启用）
- [ ] 实现库存自动更新（出库后扣减库存）
- [ ] 实现销售出库单批量导入（UniSheet）
- [ ] 实现销售出库单批量导出（Excel）
- [ ] 前端页面：销售出库单列表（UniTable + 高级搜索）
- [ ] 前端页面：销售出库单创建/编辑（统一表单布局）
- [ ] 前端页面：销售出库单详情（Drawer）
- [ ] 单据关联展示（上游：销售预测/销售订单、工单、成品入库单）
- [ ] 自动生成应收单（财务协同）

**API端点：**
- `POST /api/apps/kuaizhizao/sales-deliveries` - 创建销售出库单
- `GET /api/apps/kuaizhizao/sales-deliveries` - 查询销售出库单列表
- `GET /api/apps/kuaizhizao/sales-deliveries/{id}` - 查询销售出库单详情
- `GET /api/apps/kuaizhizao/sales-deliveries/{id}/print` - 打印出库单

**验收标准：**
- ✅ 销售出库单CRUD功能正常
- ✅ MTS模式销售出库正常（从库存发货）
- ✅ MTO模式销售出库正常（关联销售订单）
- ✅ 批号和序列号选择正常（如果物料启用）
- ✅ 库存自动更新正常（出库后扣减库存）
- ✅ 销售出库单批量导入可用（Excel导入）
- ✅ 销售出库单批量导出可用（Excel导出）
- ✅ 单据关联展示正常（上游：销售预测/销售订单）
- ✅ 自动生成应收单正常（财务协同）
- ✅ 页面布局统一（使用统一布局规范）

**Inngest工作流：**
- ✅ 必需：库存更新工作流（异步更新库存）
- ✅ 必需：应收单生成工作流（异步生成应收单）

**预计时间：** 1周

---

#### 阶段3.2：财务协同 - 应付应收管理（1周）

**功能描述：** 实现应付管理和应收管理，支持自动生成和手动管理

**任务清单：**
- [ ] 创建应付单数据模型（`Payable`）
- [ ] 创建应收单数据模型（`Receivable`）
- [ ] 实现应付单API（查询、付款记录）
- [ ] 实现应收单API（查询、收款记录）
- [ ] 实现自动生成应付单（采购入库后）
- [ ] 实现自动生成应收单（销售出库后）
- [ ] 实现应付单状态更新（部分付款/已付款）
- [ ] 实现应收单状态更新（部分收款/已收款）
- [ ] 实现应付单批量导出（Excel）
- [ ] 实现应收单批量导出（Excel）
- [ ] 前端页面：应付单列表（UniTable + 高级搜索）
- [ ] 前端页面：应收单列表（UniTable + 高级搜索）
- [ ] 前端页面：应付单详情（Drawer）
- [ ] 前端页面：应收单详情（Drawer）
- [ ] 单据关联展示（上游：采购入库单/销售出库单）

**API端点：**
- `GET /api/apps/kuaizhizao/payables` - 查询应付单列表
- `GET /api/apps/kuaizhizao/payables/{id}` - 查询应付单详情
- `POST /api/apps/kuaizhizao/payables/{id}/record-payment` - 记录付款信息
- `GET /api/apps/kuaizhizao/payables/{id}/export` - 导出应付单
- `GET /api/apps/kuaizhizao/receivables` - 查询应收单列表
- `GET /api/apps/kuaizhizao/receivables/{id}` - 查询应收单详情
- `POST /api/apps/kuaizhizao/receivables/{id}/record-payment` - 记录收款信息
- `GET /api/apps/kuaizhizao/receivables/{id}/export` - 导出应收单

**验收标准：**
- ✅ 应付单查询功能正常
- ✅ 应收单查询功能正常
- ✅ 自动生成应付单正常（采购入库后）
- ✅ 自动生成应收单正常（销售出库后）
- ✅ 付款记录功能正常（应付单）
- ✅ 收款记录功能正常（应收单）
- ✅ 应付单状态更新正常（部分付款/已付款）
- ✅ 应收单状态更新正常（部分收款/已收款）
- ✅ 应付单批量导出可用（Excel导出）
- ✅ 应收单批量导出可用（Excel导出）
- ✅ 单据关联展示正常（上游：采购入库单/销售出库单）
- ✅ 页面布局统一（使用统一布局规范）

**Inngest工作流：**
- ✅ 必需：应付单生成工作流（异步生成应付单）
- ✅ 必需：应收单生成工作流（异步生成应收单）

**预计时间：** 1周

---

### 第四阶段：MTO模式扩展（2周）
+
#### 阶段4.1：MTO模式需求管理 - 销售订单（1周）

**功能描述：** 实现MTO模式的需求管理，支持销售订单的创建、查询、管理

**任务清单：**
- [ ] 创建销售订单数据模型（`SalesOrder`、`SalesOrderItem`）
- [ ] 实现销售订单API（CRUD、提交、审核）
- [ ] 实现销售订单批量导入（UniSheet）
- [ ] 实现销售订单批量导出（Excel）
- [ ] 前端页面：销售订单列表（UniTable + 高级搜索）
- [ ] 前端页面：销售订单创建/编辑（统一表单布局）
- [ ] 前端页面：销售订单详情（Drawer）
- [ ] 单据关联展示（下游：LRP运算、工单、销售出库单）
- [ ] 单据下推功能（下推到LRP运算）

**API端点：**
- `POST /api/apps/kuaizhizao/sales-orders` - 创建销售订单
- `GET /api/apps/kuaizhizao/sales-orders` - 查询销售订单列表
- `GET /api/apps/kuaizhizao/sales-orders/{id}` - 查询销售订单详情
- `PUT /api/apps/kuaizhizao/sales-orders/{id}` - 更新销售订单
- `DELETE /api/apps/kuaizhizao/sales-orders/{id}` - 删除销售订单
- `POST /api/apps/kuaizhizao/sales-orders/{id}/submit` - 提交销售订单
- `POST /api/apps/kuaizhizao/sales-orders/{id}/push-to-lrp` - 下推到LRP运算

**验收标准：**
- ✅ 销售订单CRUD功能正常
- ✅ 销售订单批量导入可用（Excel导入）
- ✅ 销售订单批量导出可用（Excel导出）
- ✅ 单据关联展示正常（下游单据）
- ✅ 单据下推功能正常（下推到LRP运算）
- ✅ 页面布局统一（使用统一布局规范）

**预计时间：** 1周

---

#### 阶段4.2：MTO模式计划排程 - LRP运算（1周）

**功能描述：** 实现LRP运算引擎，根据销售订单计算批次需求，生成工单建议和采购建议

**任务清单：**
- [ ] 创建LRP运算结果数据模型（`LRPResult`、`LRPResultItem`）
- [ ] 实现LRP运算引擎（基于销售订单、库存、BOM展开）
- [ ] 实现LRP运算参数配置（灵活参数配置）
- [ ] 实现LRP运算API（执行运算、查询结果）
- [ ] 实现工单建议生成（基于LRP结果，关联销售订单）
- [ ] 实现采购建议生成（基于LRP结果）
- [ ] 实现一键生成工单和采购单（单据下推功能）
- [ ] 实现LRP运算结果导出（Excel）
- [ ] 前端页面：LRP运算界面（统一表单布局）
- [ ] 前端页面：LRP运算结果展示（UniTable + 高级搜索）
- [ ] 单据关联展示（上游：销售订单，下游：工单、采购单）

**API端点：**
- `POST /api/apps/kuaizhizao/lrp/run` - 执行LRP运算
- `GET /api/apps/kuaizhizao/lrp/results/{id}` - 查询LRP运算结果
- `POST /api/apps/kuaizhizao/lrp/results/{id}/generate-orders` - 一键生成工单和采购单
- `GET /api/apps/kuaizhizao/lrp/results/{id}/export` - 导出LRP运算结果

**LRP运算逻辑：**
- 基于销售订单计算独立需求
- 基于当前库存计算净需求
- 基于BOM展开计算原材料需求
- 考虑在途采购单和已下达工单
- 生成工单建议（成品生产，关联销售订单）
- 生成采购建议（原材料采购）

**验收标准：**
- ✅ LRP运算功能正常（基于销售订单、库存、BOM）
- ✅ LRP运算结果展示正常（物料需求清单）
- ✅ 工单建议生成正常（基于LRP结果，关联销售订单）
- ✅ 采购建议生成正常（基于LRP结果）
- ✅ 一键生成工单和采购单正常（单据下推功能）
- ✅ LRP运算结果导出可用（Excel导出）
- ✅ 单据关联展示正常（上游：销售订单，下游：工单、采购单）
- ✅ LRP运算性能满足要求（1000+物料，<30秒）

**Inngest工作流：**
- ✅ 必需：LRP运算工作流（异步执行LRP运算，支持大数据量）

**预计时间：** 1周

---

### 第五阶段：质量管理基础流程（3周）

#### 阶段5.1：来料检验（1周）

**功能描述：** 实现来料检验功能，对采购到货的物料进行质量检验

**任务清单：**
- [ ] 创建来料检验单数据模型（`IncomingInspection`、`IncomingInspectionItem`）
- [ ] 实现来料检验单API（CRUD）
- [ ] 实现从采购入库单关联创建来料检验单
- [ ] 实现检验结果记录（检验数量、合格数量、不良数量）
- [ ] 实现检验结果处理（合格物料入库、不良物料标记）
- [ ] 实现来料检验单批量导入（UniSheet）
- [ ] 实现来料检验单批量导出（Excel）
- [ ] 前端页面：来料检验单列表（UniTable + 高级搜索）
- [ ] 前端页面：来料检验单创建/编辑（统一表单布局）
- [ ] 前端页面：来料检验单详情（Drawer）
- [ ] 单据关联展示（上游：采购入库单）

**API端点：**
- `POST /api/apps/kuaizhizao/incoming-inspections` - 创建来料检验单
- `GET /api/apps/kuaizhizao/incoming-inspections` - 查询来料检验单列表
- `GET /api/apps/kuaizhizao/incoming-inspections/{id}` - 查询来料检验单详情
- `PUT /api/apps/kuaizhizao/incoming-inspections/{id}` - 更新来料检验单

**验收标准：**
- ✅ 来料检验单CRUD功能正常
- ✅ 检验结果记录正常（检验数量、合格数量、不良数量）
- ✅ 检验结果处理正常（合格物料入库、不良物料标记）
- ✅ 来料检验单批量导入可用（Excel导入）
- ✅ 来料检验单批量导出可用（Excel导出）
- ✅ 单据关联展示正常（上游：采购入库单）
- ✅ 页面布局统一（使用统一布局规范）

**预计时间：** 1周

---

#### 阶段5.2：过程检验（1周）

**功能描述：** 实现过程检验功能，在生产报工环节对关键工序进行质量检验

**任务清单：**
- [ ] 创建过程检验单数据模型（`ProcessInspection`、`ProcessInspectionItem`）
- [ ] 实现过程检验单API（CRUD）
- [ ] 实现从工单和工序关联创建过程检验单
- [ ] 实现检验结果记录（检验数量、合格数量、不良数量）
- [ ] 实现不良品类型记录
- [ ] 实现检验结果处理（自动更新报工合格数、标记不良品）
- [ ] 实现过程检验单批量导入（UniSheet）
- [ ] 实现过程检验单批量导出（Excel）
- [ ] 前端页面：过程检验单列表（UniTable + 高级搜索）
- [ ] 前端页面：过程检验单创建/编辑（统一表单布局）
- [ ] 前端页面：过程检验单详情（Drawer）
- [ ] 单据关联展示（上游：工单、报工记录）

**API端点：**
- `POST /api/apps/kuaizhizao/process-inspections` - 创建过程检验单
- `GET /api/apps/kuaizhizao/process-inspections` - 查询过程检验单列表
- `GET /api/apps/kuaizhizao/process-inspections/{id}` - 查询过程检验单详情
- `PUT /api/apps/kuaizhizao/process-inspections/{id}` - 更新过程检验单

**验收标准：**
- ✅ 过程检验单CRUD功能正常
- ✅ 检验结果记录正常（检验数量、合格数量、不良数量）
- ✅ 不良品类型记录正常
- ✅ 检验结果处理正常（自动更新报工合格数、标记不良品）
- ✅ 过程检验单批量导入可用（Excel导入）
- ✅ 过程检验单批量导出可用（Excel导出）
- ✅ 单据关联展示正常（上游：工单、报工记录）
- ✅ 页面布局统一（使用统一布局规范）

**Inngest工作流：**
- ✅ 必需：报工数据更新工作流（检验后更新报工合格数）

**预计时间：** 1周

---

#### 阶段5.3：成品检验（1周）

**功能描述：** 实现成品检验功能，对生产完工的成品进行最终检验

**任务清单：**
- [ ] 创建成品检验单数据模型（`FinishedGoodsInspection`、`FinishedGoodsInspectionItem`）
- [ ] 实现成品检验单API（CRUD）
- [ ] 实现从工单关联创建成品检验单
- [ ] 实现检验结果记录（检验数量、合格数量、不良数量）
- [ ] 实现检验结果处理（合格数量允许入库、不良数量不允许入库）
- [ ] 实现成品检验单批量导入（UniSheet）
- [ ] 实现成品检验单批量导出（Excel）
- [ ] 前端页面：成品检验单列表（UniTable + 高级搜索）
- [ ] 前端页面：成品检验单创建/编辑（统一表单布局）
- [ ] 前端页面：成品检验单详情（Drawer）
- [ ] 单据关联展示（上游：工单、成品入库单）

**API端点：**
- `POST /api/apps/kuaizhizao/finished-goods-inspections` - 创建成品检验单
- `GET /api/apps/kuaizhizao/finished-goods-inspections` - 查询成品检验单列表
- `GET /api/apps/kuaizhizao/finished-goods-inspections/{id}` - 查询成品检验单详情
- `PUT /api/apps/kuaizhizao/finished-goods-inspections/{id}` - 更新成品检验单

**验收标准：**
- ✅ 成品检验单CRUD功能正常
- ✅ 检验结果记录正常（检验数量、合格数量、不良数量）
- ✅ 检验结果处理正常（合格数量允许入库、不良数量不允许入库）
- ✅ 成品检验单批量导入可用（Excel导入）
- ✅ 成品检验单批量导出可用（Excel导出）
- ✅ 单据关联展示正常（上游：工单、成品入库单）
- ✅ 页面布局统一（使用统一布局规范）

**预计时间：** 1周

---

## 📊 开发时间表

### 总体时间安排（14周）

| 阶段 | 内容 | 时间 | 开始日期 | 结束日期 |
|------|------|------|----------|----------|
| 第一阶段 | MTS模式需求与计划 | 3周 | 2025-01-15 | 2025-02-04 |
| 第二阶段 | 采购流程闭环 | 2周 | 2025-02-05 | 2025-02-18 |
| 第三阶段 | 销售出库与财务协同 | 2周 | 2025-02-19 | 2025-03-04 |
| 第四阶段 | MTO模式扩展 | 2周 | 2025-03-05 | 2025-03-18 |
| 第五阶段 | 质量管理基础流程 | 3周 | 2025-03-19 | 2025-04-08 |
| 第六阶段 | 测试与优化 | 2周 | 2025-04-09 | 2025-04-22 |
| 第七阶段 | 文档与交付 | 1周 | 2025-04-23 | 2025-04-30 |

### 详细时间安排

**第一阶段：MTS模式需求与计划（3周）**
- 阶段1.1：需求管理 - 销售预测（1周）
- 阶段1.2：计划排程 - MRP运算（2周）

**第二阶段：采购流程闭环（2周）**
- 阶段2.1：采购单管理（1周）
- 阶段2.2：采购入库（1周）

**第三阶段：销售出库与财务协同（2周）**
- 阶段3.1：销售出库（1周）
- 阶段3.2：财务协同 - 应付应收管理（1周）

**第四阶段：MTO模式扩展（2周）**
- 阶段4.1：MTO模式需求管理 - 销售订单（1周）
- 阶段4.2：MTO模式计划排程 - LRP运算（1周）

**第五阶段：质量管理基础流程（3周）**
- 阶段5.1：来料检验（1周）
- 阶段5.2：过程检验（1周）
- 阶段5.3：成品检验（1周）

**第六阶段：测试与优化（2周）**
- 功能测试（1周）
- 性能优化与用户体验优化（1周）

**第七阶段：文档与交付（1周）**
- 用户手册编写
- API文档完善
- 交付准备

---

## 🎯 关键里程碑

### 里程碑1：MTS模式完整流程（第3周末）
- ✅ 销售预测功能完成
- ✅ MRP运算功能完成
- ✅ 从MRP生成工单和采购单功能完成
- **验收标准**：能够完成MTS模式从需求到计划的完整流程

### 里程碑2：采购流程闭环（第5周末）
- ✅ 采购单管理功能完成
- ✅ 采购入库功能完成
- ✅ 自动生成应付单功能完成
- **验收标准**：能够完成采购从下单到入库到财务的完整闭环

### 里程碑3：销售出库与财务协同（第7周末）
- ✅ 销售出库功能完成（MTS和MTO模式）
- ✅ 应付应收管理功能完成
- **验收标准**：能够完成销售出库和财务协同的完整流程

### 里程碑4：MTO模式完整流程（第9周末）
- ✅ 销售订单功能完成
- ✅ LRP运算功能完成
- ✅ 从LRP生成工单和采购单功能完成（关联订单）
- **验收标准**：能够完成MTO模式从需求到计划的完整流程

### 里程碑5：质量管理基础流程（第12周末）
- ✅ 来料检验功能完成
- ✅ 过程检验功能完成
- ✅ 成品检验功能完成
- **验收标准**：能够完成质量管理的完整流程

### 里程碑6：系统测试与优化（第14周末）
- ✅ 所有功能测试通过
- ✅ 性能优化完成
- ✅ 用户体验优化完成
- **验收标准**：系统达到交付标准

---

## ⚠️ 风险控制

### 技术风险

**风险1：MRP/LRP运算性能问题**
- **风险描述**：大数据量场景下MRP/LRP运算可能超时
- **应对措施**：
  - 使用Inngest异步工作流执行运算
  - 优化BOM展开算法
  - 实现运算结果缓存
  - 支持增量运算

**风险2：单据关联关系复杂**
- **风险描述**：单据上下游关联关系复杂，容易出现数据不一致
- **应对措施**：
  - 建立清晰的单据关联模型
  - 实现单据关联验证机制
  - 使用事务保证数据一致性
  - 实现单据关联追溯功能

**风险3：批号和序列号管理复杂**
- **风险描述**：批号和序列号管理逻辑复杂，容易出现错误
- **应对措施**：
  - 建立清晰的批号和序列号管理模型
  - 实现批号和序列号验证机制
  - 提供批号和序列号追溯功能
  - 充分测试各种场景

### 进度风险

**风险1：开发进度延期**
- **风险描述**：功能复杂度超出预期，导致开发进度延期
- **应对措施**：
  - 每周进行进度检查
  - 及时调整开发计划
  - 优先实现核心功能
  - 非核心功能可以延后

**风险2：测试时间不足**
- **风险描述**：开发时间占用过多，导致测试时间不足
- **应对措施**：
  - 开发过程中同步进行单元测试
  - 每个阶段完成后立即进行集成测试
  - 预留充足的测试时间
  - 自动化测试覆盖核心功能

### 质量风险

**风险1：用户体验不佳**
- **风险描述**：功能实现但用户体验不佳
- **应对措施**：
  - 遵循统一的页面布局规范
  - 每个功能完成后进行用户体验测试
  - 及时收集用户反馈
  - 持续优化用户体验

**风险2：数据准确性不足**
- **风险描述**：业务逻辑复杂，容易出现数据计算错误
- **应对措施**：
  - 建立完善的测试用例
  - 充分测试各种业务场景
  - 实现数据验证机制
  - 提供数据追溯功能

---

## ✅ 最终验收标准

### 功能完整性
- ✅ MTS模式完整流程：销售预测 → MRP运算 → 工单生成 → 生产执行 → 销售出库
- ✅ MTO模式完整流程：销售订单 → LRP运算 → 工单生成 → 生产执行 → 销售出库
- ✅ 采购流程闭环：采购单 → 采购入库 → 应付管理
- ✅ 质量管理基础流程：来料检验、过程检验、成品检验
- ✅ 财务协同基础流程：应付管理、应收管理
- ✅ 单据关联体系：上下游单据关联、单据下推/上拉功能

### 数据完整性
- ✅ 所有业务单据的数据验证正常
- ✅ 所有业务单据的数据关联正常
- ✅ 所有业务单据的数据追溯正常
- ✅ 批号和序列号管理正常
- ✅ 库存数据准确性正常

### 性能要求
- ✅ 列表查询响应时间 < 2秒
- ✅ 详情查询响应时间 < 1秒
- ✅ MRP/LRP运算性能满足要求（1000+物料，<30秒）
- ✅ 批量操作响应时间 < 5秒
- ✅ 大数据量查询性能满足要求（10万+记录，<2秒）

### 用户体验
- ✅ 操作流程简单直观
- ✅ 错误提示友好明确
- ✅ 页面布局统一
- ✅ 打印功能正常可用
- ✅ 批量导入导出功能正常

### 代码质量
- ✅ 所有代码通过Ruff检查
- ✅ 所有代码通过MyPy类型检查
- ✅ 所有代码有文件头注释（中文）
- ✅ 单元测试覆盖率 > 80%
- ✅ 所有功能有测试用例

---

## 📦 交付物清单

### 代码交付物
- ✅ 后端API代码（所有业务单据的CRUD API）
- ✅ 前端页面代码（所有业务单据的管理页面）
- ✅ 数据模型定义（所有业务单据的数据模型）
- ✅ Inngest工作流代码（MRP/LRP运算、库存更新、财务协同等）

### 文档交付物
- ✅ 用户手册（中文，包含所有功能的使用说明）
- ✅ API文档（包含所有API端点的详细说明）
- ✅ 开发文档（包含数据模型、业务逻辑说明）
- ✅ 测试报告（包含所有测试用例和测试结果）

### 测试交付物
- ✅ 单元测试代码（覆盖率 > 80%）
- ✅ 集成测试代码（所有业务流程的端到端测试）
- ✅ 测试用例文档（包含所有测试场景）
- ✅ 测试数据（包含示例数据）

---

## 📚 相关文档

- [用户使用场景推演-MTS-MTO.md](./用户使用场景推演-MTS-MTO.md) - 完整场景推演文档
- [快格轻制造App-基础流程开发计划.md](./快格轻制造App-基础流程开发计划.md) - 基础流程开发计划
- [详细功能点开发清单-优化版.md](./详细功能点开发清单-优化版.md) - 详细功能点清单
- [系统级应用级协同开发计划.md](./系统级应用级协同开发计划.md) - 系统级应用开发计划

---

**文档创建时间：** 2025-01-15  
**文档作者：** Auto (AI Assistant)  
**预计完成时间：** 2025-04-30  
**开发周期：** 14周

---
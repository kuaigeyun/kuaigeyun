# RiverEdge SaaS 多租户框架 - Cursor AI 开发规范

## ⚠️ 【执行前强制检查 - 绝对不允许跳过】

**在执行任何代码生成、修改、创建操作之前，必须逐项检查以下规则：**

### 强制检查流程（必须按顺序执行）

1. **第一步：检查库选择优先级**
   - ✅ 是否优先检查了官方库？（Tortoise ORM、FastAPI、React 等）
   - ✅ 是否查看了官方文档和最佳实践？
   - ✅ 是否避免了自定义实现？
   - ❌ **如果未检查，立即停止，不要继续操作**

2. **第二步：检查是否重复造轮子**
   - ✅ 官方库能满足需求吗？
   - ✅ 是否有成熟稳定的第三方库？
   - ❌ **如果官方库能满足需求，禁止自己实现**

3. **第三步：如果违反规则，立即停止**
   - ❌ 不要继续操作
   - ❌ 不要生成代码
   - ❌ 不要创建文件
   - ✅ 明确说明违反了哪条规则

### 历史教训（必须永远记住）

**2025-11-19：严重违反规则案例**
- ❌ 自己实现了连接池管理函数（`ensure_db_connection`, `_reinit_connection_pool` 等）
- ❌ 没有先检查 Tortoise ORM 官方是否有 `register_tortoise`
- ❌ 重复造轮子，违反了"禁止重复造轮子"规则
- ✅ **正确做法：使用 Tortoise ORM 官方推荐的 `register_tortoise`**

**必须永远记住：先检查官方库，再考虑其他方案！**

---

## 🚨 【第一优先级 - 永久锁定】React生态最佳实践规范

**⚠️ 绝对锁定 - 永久不得更改**：
- **React版本**：`18.3.1` (最新稳定版，性能优化)
- **构建工具**：`Vite 5.4.8` (现代化构建工具)
- **状态管理**：`Zustand 5.0.0` (轻量级现代化状态管理)
- **数据获取**：`TanStack Query 5.51.1` (智能服务端状态管理)
- **路由管理**：`React Router DOM 6.26.2` (React官方路由解决方案)
- **表单管理**：`React Hook Form 7.53.0` (高性能表单库)
- **测试框架**：`Vitest 2.1.8` (现代化测试框架，原生ESM支持)
- **CSS方案**：`UnoCSS` (原子化CSS引擎，推荐)

**违规处理**：
- 发现任何违反上述技术栈的地方，立即停止所有操作
- 必须明确说明："❌ 违反了React生态最佳实践规范"
- 不得辩解，立即修正为正确的技术栈
- 这不是建议，而是绝对规则

---

## 📋 概述

本文档为 AI 助手提供 **RiverEdge SaaS 多租户框架 (RiverEdge SaaS Multi-tenant Framework)** 的**统一开发规范**，确保 AI 助手在协助开发时始终遵循框架的技术选型、命名规范、注释规范和数据库规范。

**⚠️ 绝对规则 - 违反即终止**：
- **绝对禁止使用 PowerShell 进行任何操作**（包括文件操作、进程管理、命令执行等）
- **绝对禁止在数据库连接测试中假设默认密码**（必须从配置文件读取实际密码）
- 所有规则必须严格遵循，不得跳过或违反
- 违反任何规则必须立即停止并说明原因

**🚨 违规处理机制**：
1. **立即停止**：一旦检测到违规行为，AI 助手必须立即停止当前所有操作
2. **明确说明**：必须向用户明确说明违反了哪条规则，以及为什么违反
3. **使用替代方案**：必须使用规则中指定的替代方案重新执行操作
4. **记录违规**：如果用户发现违规，AI 助手必须承认错误，不得辩解或推脱
5. **永久禁止**：违反绝对规则（如使用 PowerShell、违反React生态最佳实践规范）的行为是不可接受的，必须立即纠正

**🚨 React生态规范特殊处理**：
- React生态最佳实践规范是第一优先级，违反将立即终止所有操作
- 必须明确说明："❌ 违反了React生态最佳实践规范"
- 不允许任何形式的辩解或推脱
- 必须立即修正为正确的现代化语法

**重要提示**：AI 助手在生成代码、提供建议或修改代码时，**必须严格遵循**本文档中的所有规范。**任何违反规则的行为都是不可接受的。**

## 🎯 核心原则

1. **技术栈统一**：严格使用框架确定的技术选型，不引入其他技术
2. **命名规范**：遵循统一的命名规范，保持代码风格一致
3. **注释完整**：所有代码必须包含完整的注释（使用中文）
4. **多租户优先**：所有数据模型和查询必须包含租户隔离
5. **类型安全**：使用类型提示，确保类型安全
6. **错误处理**：统一错误处理，提供清晰的错误信息
7. **测试覆盖**：核心功能测试覆盖率 > 80%
8. **Git 规范**：遵循 Conventional Commits 提交规范

## 📋 通用规范（必须严格遵循）

### 1. 文件编码规范

**所有文件必须使用 UTF-8 编码**：
- ✅ **后端文件**（Python）：文件头部无需声明编码（Python 3 默认 UTF-8）
- ✅ **前端文件**（TypeScript/JavaScript）：文件默认 UTF-8 编码
- ✅ **配置文件**（JSON、YAML、TOML）：默认 UTF-8 编码
- ✅ **文档文件**（Markdown）：默认 UTF-8 编码
- ✅ **数据库脚本**（SQL）：使用 UTF-8 编码

**验证方法**：
- 编辑器设置：确保编辑器默认编码为 UTF-8
- Git 配置：确保 Git 正确处理 UTF-8 文件
- 文件检查：使用工具检查文件编码（如 `file -bi filename`）

### 2. 数据库连接测试规范 ⚠️ **绝对禁止 - 违反即终止**

**在进行任何数据库连接测试时，必须严格遵循以下规则**：

**⚠️ 绝对禁止假设默认密码**：
- ❌ **绝对禁止**在测试脚本中硬编码默认密码（如 `postgres`、`root`、`admin` 等）
- ❌ **绝对禁止**假设配置文件中的密码是默认值
- ❌ **绝对禁止**跳过读取实际配置文件就直接测试连接

**✅ 必须执行的步骤**：
1. **首先读取配置文件**：在进行任何数据库连接测试前，必须先读取 `.env` 文件或配置文件，获取实际的数据库密码
2. **使用实际配置**：所有测试脚本必须使用从配置文件读取的实际密码，而不是假设的默认值
3. **验证配置加载**：在测试连接前，必须先验证配置是否正确加载（打印配置信息，但不输出密码明文）

**测试脚本示例**：
```python
# ✅ 正确：先读取配置，再测试连接
from app.config import settings

# 验证配置已加载（不输出密码）
print(f'DB_HOST: {settings.DB_HOST}')
print(f'DB_USER: {settings.DB_USER}')
print(f'DB_PASSWORD: {"*" * len(settings.DB_PASSWORD)}')  # 只显示长度，不显示明文

# 使用实际配置测试连接
conn = await asyncpg.connect(
    host=settings.DB_HOST,
    port=settings.DB_PORT,
    user=settings.DB_USER,
    password=settings.DB_PASSWORD,  # 使用配置文件中的实际密码
    database=settings.DB_NAME,
)

# ❌ 错误：硬编码默认密码
conn = await asyncpg.connect(
    host='localhost',
    user='postgres',
    password='postgres',  # ❌ 绝对禁止：假设默认密码
    database='riveredge',
)
```

**违规处理机制**：
- **立即停止**：一旦发现测试脚本中硬编码了默认密码，必须立即停止并修正
- **承认错误**：必须明确承认错误，不得辩解或推脱
- **重新测试**：必须使用正确的配置重新测试
- **严重性**：违反此规则可能导致浪费大量时间（如数小时），是不可接受的严重错误

**历史教训**：
- 2025-11-18：因在测试脚本中硬编码默认密码 `postgres`，而实际密码是 `jetema4ev`，导致浪费 5 小时排查连接问题
- 必须永远记住：**永远不要假设密码是默认值，必须从配置文件读取**

### 3. 库选择优先级规范

**所有设计和功能开发时，必须按照以下优先级顺序选择库**：

#### 优先级顺序

1. **Ant Design Pro Components** - 优先使用 Ant Design Pro 官方组件
2. **React** - 使用 React 官方库或 React 生态成熟库
3. **TanStack Query** - 使用 TanStack Query 官方功能
4. **Zustand** - 使用 Zustand 官方功能
5. **React Hook Form** - 使用 React Hook Form 官方功能
6. **React Router DOM** - 使用 React Router DOM 官方功能
7. **React i18next** - 使用 React i18next 官方功能
8. **FastAPI** - 使用 FastAPI 官方扩展或 FastAPI 生态成熟库
9. **Tortoise ORM** - 使用 Tortoise ORM 官方功能或扩展
10. **PostgreSQL** - 使用 PostgreSQL 原生功能或官方扩展

#### 选择原则

**第一优先级：官方库**
- ✅ 优先使用官方提供的库和组件
- ✅ 优先使用官方推荐的扩展和插件
- ✅ 优先使用官方文档中的最佳实践

**第二优先级：成熟库**
- ✅ 如果官方库不满足需求，优先查找成熟稳定的第三方库
- ✅ 优先选择维护活跃、文档完善、社区活跃的库
- ✅ 优先选择与框架技术栈兼容的库

**第三优先级：自定义实现**
- ⚠️ 只有在官方库和成熟库都无法满足需求时，才考虑自己实现
- ⚠️ 自定义实现必须遵循框架规范（命名、注释、测试等）
- ⚠️ 自定义实现必须提供完整的文档和测试

#### 禁止事项

- ❌ **禁止跳过优先级检查**：必须按照优先级顺序检查
- ❌ **禁止直接使用第三方库**：必须先检查官方库
- ❌ **禁止使用不成熟的库**：必须选择成熟稳定的库
- ❌ **禁止重复造轮子**：官方库或成熟库能满足需求时，禁止自己实现

## 🔧 技术选型（必须严格遵循）

### 后端技术栈 (riveredge-core)

**必须使用以下技术，不得替换或添加其他技术**：

- **编程语言**: Python 3.11 LTS（**不得使用其他版本**）
- **Web 框架**: FastAPI 0.110.0（**不得使用 Flask、Django 等**）
- **数据验证**: Pydantic v2.7.0（**不得使用其他验证库**）
- **数据库**: PostgreSQL 15+（**不得使用 MySQL、MongoDB 等**）
- **ORM 框架**: Tortoise ORM 0.21.1（**不得使用 SQLAlchemy、Django ORM 等**）
- **数据库迁移**: Aerich 0.7+（**不得使用 Alembic 等**）
- **缓存**: Redis 7.2+（**不得使用 Memcached 等**）
- **Redis 客户端**: redis-py (redis>=5.0.0)，使用 `redis.asyncio` 异步接口（**不得使用 aioredis 等**）
- **认证**: JWT (python-jose)（**不得使用其他认证方式**）
- **HTTP 客户端**: httpx（**不得使用 requests 等**）
- **日志**: loguru（**不得使用标准 logging**）
- **配置管理**: pydantic-settings（**不得使用其他配置库**）
- **测试框架**: pytest + pytest-asyncio（**不得使用 unittest 等**）

### 前端技术栈 (riveredge-shell)

**必须使用以下技术，不得替换或添加其他技术**：

- **核心框架**: React 18.3.1（**不得使用 Vue、Angular 等**）
- **构建工具**: Vite 5.4.8（**不得使用 Webpack 等**）
- **路由管理**: React Router DOM 6.26.2（**不得使用其他路由库**）
- **状态管理**: Zustand 5.0.0（**不得使用 Redux 等**）
- **数据获取**: TanStack Query 5.51.1（**不得使用 Axios、fetch 等**）
- **表单管理**: React Hook Form 7.53.0（**不得使用其他表单库**）
- **UI 组件库**: Ant Design 5.21.4 + Ant Design Pro Components 2.8.2（**不得使用 Material-UI、Element UI 等**）
- **类型系统**: TypeScript 5.6.3（**必须使用 TypeScript，不得使用 JavaScript**）
- **国际化**: React i18next 14.1.3（**不得使用其他国际化库**）
- **权限管理**: 自定义 Context + Router 守卫（**不得使用其他权限库**）
- **图表库**: @ant-design/charts（**不得使用 ECharts、Chart.js 等**）
- **表单验证**: Zod 3.23.8（**TypeScript优先的模式验证**）
- **打印模板设计**: react-to-print + jspdf + html2canvas（**不得使用其他打印库**）
- **图标库**: @ant-design/icons（**不得使用其他图标库**）
- **日期处理**: dayjs（**不得使用 moment.js 等**）
- **工具函数**: lodash-es（**不得使用其他工具库**）
- **动画库**: Framer Motion 11.5.4（**现代化动画库**）

## 🔧 React生态语法规范 ⭐ **重要 - 必须严格遵循**

**⚠️ 必须使用 React 18.3.1 + TypeScript 5.6.3 + 现代化 React 生态语法**：

**React 组件规范**：
- ✅ **正确**：使用现代化 React Hooks
  ```typescript
  import React, { useState, useEffect } from 'react';

  interface UserCardProps {
    userId: number;
    userName: string;
  }

  export default function UserCard({ userId, userName }: UserCardProps) {
    const [user, setUser] = useState(null);

    useEffect(() => {
      // 获取用户数据
    }, [userId]);

    return <div>{userName}</div>;
  }
  ```

**禁止使用的过时语法**：
- ❌ **禁止使用类组件**：必须使用函数组件 + Hooks
- ❌ **禁止使用过时的生命周期方法**：必须使用 useEffect
- ❌ **禁止使用过时的 Context API**：必须使用现代 Context
- ❌ **禁止使用过时的 Ref API**：必须使用 useRef 或 useCallback

**必须遵循**：
1. **始终参考 React 18 官方文档**：https://react.dev/
2. **使用 TypeScript 进行类型检查**：所有组件和函数必须有正确的类型定义
3. **遵循 React Hooks 规则**：Hooks 调用顺序必须稳定，不能在条件语句中使用
4. **性能优化**：使用 React.memo、useMemo、useCallback 进行必要的优化

**违规处理**：
- 如果发现使用了过时的 React 语法，必须立即停止并修复
- 必须明确说明违反了哪条规则，以及正确的现代化语法
- 不得重复使用过时语法

### 数据库技术栈

**必须使用以下技术，不得替换或添加其他技术**：

- **主数据库**: PostgreSQL 15+（**不得使用 MySQL、SQLite 等**）
- **缓存**: Redis 7.2+（**不得使用 Memcached 等**）

## 📐 命名规范（必须严格遵循）

> **详细规范请参考**：[2.字段命名规范.md](./Farming%20Plan/2.rules/2.字段命名规范.md)

### 模块命名哲学

**框架模块命名**（遵循自然/植物生态哲学）：
- ✅ `riveredge-core` - 核心系统（根）
- ✅ `riveredge-shell` - 前端框架（壳）
- ✅ `riveredge-seeds` - 应用插件（种子）
- ✅ `riveredge-land` - 着陆页/官网（土地）
- ✅ `riveredge-leaf` - 移动端应用（叶子）

> **详细说明请参考**：[1.框架命名哲学.md](./Farming%20Plan/2.rules/1.框架命名哲学.md)

### 后端命名规范（Python）

**文件命名**：使用 `snake_case`
- ✅ `user.py` - 模型文件
- ✅ `users.py` - API 文件（复数形式）
- ✅ `user_service.py` - Service 文件
- ✅ `user_schema.py` - Schema 文件
- ❌ `User.py`、`userModel.py` - 错误

**类命名**：使用 `PascalCase`
- ✅ `User` - 模型类
- ✅ `UserCreate` - Schema 类
- ✅ `UserService` - Service 类
- ❌ `user`、`user_create` - 错误

**函数命名**：使用 `snake_case`，动词开头
- ✅ `create_user` - 创建用户
- ✅ `get_user_by_id` - 根据 ID 获取用户
- ✅ `list_users` - 用户列表
- ❌ `createUser`、`user_create` - 错误

**变量命名**：使用 `snake_case`，**禁止使用 Python 关键字**
- ✅ `user_id` - 用户 ID
- ✅ `total_amount` - 总金额
- ✅ `is_active` - 是否激活（布尔值）
- ❌ `userId`、`totalAmount` - 错误
- ❌ `class`、`def`、`import`、`from`、`if`、`else`、`for`、`while`、`try`、`except`、`finally`、`with`、`as`、`pass`、`return`、`yield`、`break`、`continue`、`lambda`、`None`、`True`、`False`、`and`、`or`、`not`、`in`、`is`、`del`、`global`、`nonlocal`、`assert`、`async`、`await` - 错误：Python 关键字

**常量命名**：使用 `UPPER_SNAKE_CASE`
- ✅ `MAX_RETRY_COUNT` - 最大重试次数
- ✅ `DEFAULT_PAGE_SIZE` - 默认分页大小
- ❌ `maxRetryCount`、`defaultPageSize` - 错误

**避免 Python 关键字**：
- ❌ 禁止使用 Python 关键字作为变量名、函数名、参数名、类名等
- ✅ 使用替代命名：`class` → `class_name`、`def` → `definition`、`import` → `import_path`、`from` → `from_location`、`if` → `condition`、`else` → `alternative`、`for` → `loop_item`、`while` → `condition_check`、`try` → `attempt`、`except` → `exception_type`、`finally` → `cleanup`、`with` → `context_manager`、`as` → `alias`、`pass` → `placeholder`、`return` → `return_value`、`yield` → `generator_value`、`break` → `break_point`、`continue` → `continue_flag`、`lambda` → `lambda_func`、`None` → `none_value`、`True` → `true_value`、`False` → `false_value`、`and` → `and_condition`、`or` → `or_condition`、`not` → `not_condition`、`in` → `in_list`、`is` → `is_check`、`del` → `delete_flag`、`global` → `global_var`、`nonlocal` → `nonlocal_var`、`assert` → `assertion`、`async` → `async_flag`、`await` → `await_result`
- 📖 详细规范请参考：[2.字段命名规范.md](./Farming%20Plan/2.rules/2.字段命名规范.md) - 避免 Python 关键字章节

### 前端命名规范（TypeScript）

**文件命名**：
- 组件文件：使用 `PascalCase`（✅ `UserList.tsx`）
- 工具文件：使用 `camelCase`（✅ `userUtils.ts`）
- API 文件：使用 `camelCase`（✅ `userApi.ts`）

**组件命名**：使用 `PascalCase`
- ✅ `UserList` - 用户列表组件
- ✅ `UserForm` - 用户表单组件
- ✅ `BaseButton` - 基础按钮组件（Base 前缀）
- ❌ `userList`、`user-list` - 错误

**函数命名**：使用 `camelCase`，动词开头
- ✅ `getUserList` - 获取用户列表
- ✅ `createUser` - 创建用户
- ✅ `handleSubmit` - 处理提交（handle 前缀）
- ❌ `get_user_list`、`user_create` - 错误

**变量命名**：使用 `camelCase`，**禁止使用 TypeScript/JavaScript 关键字**
- ✅ `userId` - 用户 ID
- ✅ `totalAmount` - 总金额
- ✅ `isActive` - 是否激活（布尔值，is 前缀）
- ❌ `user_id`、`total_amount` - 错误
- ❌ `class`、`function`、`const`、`let`、`var`、`if`、`else`、`for`、`while`、`try`、`catch`、`finally`、`switch`、`case`、`default`、`break`、`continue`、`return`、`yield`、`async`、`await`、`import`、`export`、`from`、`as`、`new`、`this`、`super`、`extends`、`implements`、`interface`、`type`、`enum`、`namespace`、`module`、`declare`、`abstract`、`static`、`readonly`、`public`、`private`、`protected`、`get`、`set`、`constructor`、`null`、`undefined`、`true`、`false`、`NaN`、`Infinity` - 错误：TypeScript/JavaScript 关键字

**类型命名**：使用 `PascalCase`
- ✅ `User` - 用户接口
- ✅ `UserListResponse` - 用户列表响应接口
- ❌ `user`、`userListResponse` - 错误

**避免 TypeScript/JavaScript 关键字**：
- ❌ 禁止使用 TypeScript/JavaScript 关键字作为变量名、函数名、参数名、类型名等
- ✅ 使用替代命名：`class` → `className`、`function` → `functionName`、`const` → `constantValue`、`let` → `letValue`、`var` → `varValue`、`if` → `condition`、`else` → `alternative`、`for` → `loopItem`、`while` → `whileCondition`、`try` → `attempt`、`catch` → `catchBlock`、`finally` → `finallyBlock`、`switch` → `switchValue`、`case` → `caseValue`、`default` → `defaultValue`、`break` → `breakPoint`、`continue` → `continueFlag`、`return` → `returnValue`、`yield` → `yieldValue`、`async` → `asyncFlag`、`await` → `awaitResult`、`import` → `importPath`、`export` → `exportName`、`from` → `fromLocation`、`as` → `alias`、`new` → `newInstance`、`this` → `thisContext`、`super` → `superClass`、`extends` → `extendsClass`、`implements` → `implementsInterface`、`interface` → `interfaceName`、`type` → `typeName`、`enum` → `enumName`、`namespace` → `namespaceName`、`module` → `moduleName`、`declare` → `declaration`、`abstract` → `abstractClass`、`static` → `staticValue`、`readonly` → `readonlyValue`、`public` → `publicAccess`、`private` → `privateAccess`、`protected` → `protectedAccess`、`get` → `getValue`、`set` → `setValue`、`constructor` → `constructorName`、`null` → `nullValue`、`undefined` → `undefinedValue`、`true` → `trueValue`、`false` → `falseValue`、`NaN` → `nanValue`、`Infinity` → `infinityValue`
- 📖 详细规范请参考：[2.字段命名规范.md](./Farming%20Plan/2.rules/2.字段命名规范.md) - 避免 TypeScript/JavaScript 关键字章节

### 数据库命名规范

**表命名**：使用 `snake_case`，复数形式，**必须包含模块前缀** ⭐ **重要**
- ✅ `core_users` - 核心系统用户表（`core_` 前缀，符合框架哲学：core = 根）
- ✅ `seed_mes_orders` - MES 应用插件订单表（`seed_mes_` 前缀，符合框架哲学：seeds = 种子）
- ✅ `seed_mes_order_items` - MES 应用插件订单明细表
- ✅ `seed_payment_records` - 支付插件记录表（`seed_payment_` 前缀）
- ✅ `sys_users` - 兼容别名（推荐使用 `core_users`）
- ❌ `users` - 错误：缺少模块前缀
- ❌ `mes_orders` - 错误：缺少 `seed_` 前缀
- ❌ `user`、`User`、`user_table` - 错误

**模块前缀规则**（结合框架命名哲学）：
- **核心系统模块（core/根）**：`core_` 前缀 ⭐ **符合框架哲学**
  - 如 `core_users`、`core_roles`、`core_tenants`
  - 属于 `riveredge-core` 模块（根系统）
  - **命名哲学**：如同植物的根系，提供基础支撑和养分
  - `sys_` 前缀作为兼容别名，推荐使用 `core_`
- **应用插件模块（seeds/种子）**：`seed_插件名_` 前缀 ⭐ **符合框架哲学**
  - 所有业务模块（MES、ERP、CRM 等）都属于 `riveredge-seeds`（应用插件集合）
  - MES 系统：`seed_mes_` 前缀（如 `seed_mes_orders`）
  - ERP 系统：`seed_erp_` 前缀（如 `seed_erp_invoices`）
  - CRM 系统：`seed_crm_` 前缀（如 `seed_crm_customers`）
  - 支付插件：`seed_payment_` 前缀（如 `seed_payment_records`）
  - **命名哲学**：如同植物的种子，可以生长成不同的功能模块

**字段命名**：使用 `snake_case`，**禁止使用 PostgreSQL 关键字**
- ✅ `id` - 主键
- ✅ `tenant_id` - 租户 ID（**所有表必须包含**）
- ✅ `user_id` - 外键（表名_id）
- ✅ `created_at` - 创建时间（_at 后缀）
- ✅ `is_active` - 是否激活（is_ 前缀）
- ❌ `userId`、`createTime`、`active` - 错误
- ❌ `order`、`user`、`group`、`select`、`from`、`where`、`join`、`key`、`index`、`table`、`view`、`function`、`procedure`、`trigger`、`sequence`、`database`、`schema`、`constraint`、`default`、`null`、`true`、`false`、`case`、`when`、`then`、`else`、`end`、`begin`、`if`、`for`、`while`、`return`、`raise`、`exception`、`transaction`、`commit`、`rollback` - 错误：PostgreSQL 关键字

**避免 PostgreSQL 关键字**：
- ❌ 禁止使用 PostgreSQL 关键字作为表名、字段名、索引名等
- ✅ 使用替代命名：`order` → `order_no`、`order_number`、`order_id`（注意：`ORDER BY` 是关键字）、`user` → `user_name`、`user_id`、`username`（注意：`USER` 在某些数据库中可能是关键字）、`group` → `group_name`、`group_id`、`grouping`（注意：`GROUP BY` 是关键字）、`select` → `select_value`、`select_option`、`selection`、`from` → `from_location`、`from_source`、`from_address`、`where` → `where_clause`、`where_condition`、`join` → `join_type`、`join_table`、`key` → `key_name`、`key_value`、`key_id`、`index` → `index_name`、`index_value`、`index_id`、`table` → `table_name`、`table_id`、`view` → `view_name`、`view_id`、`function` → `function_name`、`function_id`、`procedure` → `procedure_name`、`procedure_id`、`trigger` → `trigger_name`、`trigger_id`、`sequence` → `sequence_name`、`sequence_id`、`database` → `database_name`、`database_id`、`schema` → `schema_name`、`schema_id`、`constraint` → `constraint_name`、`constraint_id`、`default` → `default_value`、`default_option`、`null` → `null_value`、`null_flag`、`true` → `true_value`、`is_true`、`false` → `false_value`、`is_false`、`case` → `case_value`、`case_type`、`when` → `when_time`、`when_date`、`then` → `then_value`、`then_result`、`else` → `else_value`、`else_result`、`end` → `end_time`、`end_date`、`begin` → `begin_time`、`begin_date`、`if` → `if_condition`、`if_flag`、`for` → `for_item`、`for_loop`、`while` → `while_condition`、`while_loop`、`return` → `return_value`、`return_data`、`raise` → `raise_flag`、`raise_error`、`exception` → `exception_type`、`exception_message`、`transaction` → `transaction_id`、`transaction_no`、`commit` → `commit_time`、`commit_date`、`rollback` → `rollback_flag`、`rollback_reason`
- 📖 详细规范请参考：[2.字段命名规范.md](./Farming%20Plan/2.rules/2.字段命名规范.md) - 避免数据库关键字章节

**索引命名**：索引名中的表名必须包含模块前缀
- ✅ `idx_core_users_tenant_id` - 核心系统表索引（core_ 前缀，符合框架哲学）
- ✅ `idx_seed_mes_orders_status` - 应用插件表索引（seed_ 前缀，符合框架哲学）
- ✅ `uk_core_users_email` - 唯一索引（uk_ 前缀）
- ✅ `idx_sys_users_tenant_id` - 兼容别名（推荐使用 `idx_core_users_tenant_id`）
- ❌ `idx_users_tenant_id` - 错误：表名缺少模块前缀
- ❌ `idx_mes_orders_status` - 错误：缺少 `seed_` 前缀
- ❌ `users_tenant_id_idx`、`unique_users_email` - 错误

## 💬 注释规范（必须严格遵循）

> **详细规范请参考**：[4.注释规范.md](./Farming%20Plan/2.rules/4.注释规范.md)

**注释语言**：**必须使用中文注释**，便于团队理解

### 后端注释规范（Python）

**类注释**：使用三引号文档字符串
```python
class UserService:
    """
    用户服务类
    
    提供用户的 CRUD 操作和业务逻辑处理。
    
    Attributes:
        db: 数据库连接对象
        
    Example:
        >>> service = UserService()
        >>> user = await service.create_user(
        ...     name="张三",
        ...     email="zhangsan@example.com",
        ...     tenant_id=1
        ... )
    """
```

**函数注释**：使用三引号文档字符串
```python
async def create_user(
    self,
    name: str,
    email: str,
    tenant_id: int
) -> User:
    """
    创建用户
    
    创建新用户并保存到数据库。如果邮箱已存在，则抛出异常。
    
    Args:
        name: 用户名称（必填，3-50 字符）
        email: 用户邮箱（必填，邮箱格式，全局唯一）
        tenant_id: 租户 ID（必填，用于多租户隔离）
        
    Returns:
        User: 创建的用户对象
        
    Raises:
        ValueError: 当邮箱已存在时抛出
        ValidationError: 当数据验证失败时抛出
        
    Example:
        >>> user = await service.create_user(
        ...     name="张三",
        ...     email="zhangsan@example.com",
        ...     tenant_id=1
        ... )
    """
```

### 前端注释规范（TypeScript）

**组件注释**：使用 JSDoc 格式
```typescript
/**
 * 用户列表组件
 * 
 * 用于展示用户列表，支持搜索、筛选、分页等功能。
 * 
 * @param props - 组件属性
 * @param props.userId - 用户 ID
 * @param props.userName - 用户名称
 * 
 * @example
 * ```tsx
 * <UserList userId={1} userName="张三" />
 * ```
 */
```

**函数注释**：使用 JSDoc 格式
```typescript
/**
 * 获取用户列表
 * 
 * 支持分页、关键词搜索和租户过滤。
 * 
 * @param params - 查询参数
 * @param params.page - 页码（默认 1）
 * @param params.pageSize - 每页数量（默认 10）
 * @param params.keyword - 关键词搜索（可选）
 * @returns 用户列表响应数据
 * 
 * @example
 * ```typescript
 * const result = await getUserList({
 *   page: 1,
 *   pageSize: 20,
 *   keyword: "张三"
 * });
 * ```
 */
```

## 📖 FastAPI 文档生成规范（必须严格遵循）

> **详细规范请参考**：[6.API设计规范.md](./Farming%20Plan/2.rules/6.API设计规范.md) - FastAPI 文档生成规范章节

### API Tags 规范

**规则**：所有 API 路由的 `tags` 必须使用**英文**，保持统一性和国际化

**规范**：
```python
# ✅ 正确：使用英文 tags
router = APIRouter(prefix="/auth", tags=["Authentication"])
router = APIRouter(prefix="/users", tags=["Users"])
router = APIRouter(prefix="/roles", tags=["Roles"])
router = APIRouter(prefix="/permissions", tags=["Permissions"])

# ❌ 错误：使用中文 tags
router = APIRouter(prefix="/auth", tags=["认证"])
router = APIRouter(prefix="/users", tags=["用户管理"])
```

**Tags 命名规范**：
- 使用**英文**，首字母大写
- 使用**复数形式**（如 `Users`, `Roles`, `Permissions`）
- 多个单词使用**空格分隔**（如 `SuperAdmin Auth`, `SuperAdmin Tenants`）

**标准 Tags 列表**：
- `Authentication` - 认证相关 API
- `Users` - 用户管理 API
- `Roles` - 角色管理 API
- `Permissions` - 权限管理 API
- `Tenants` - 租户管理 API
- `Register` - 租户注册 API
- `SuperAdmin Auth` - 超级管理员认证 API
- `SuperAdmin Tenants` - 超级管理员租户管理 API
- `SuperAdmin Monitoring` - 超级管理员监控 API

### API 描述规范

**规则**：API 路由的**描述（函数文档字符串）使用中文**，便于团队理解

**规范**：
```python
@router.post("/login", response_model=LoginResponse)
async def login(data: LoginRequest):
    """
    用户登录接口  # 描述: 中文
    
    验证用户凭据并返回 JWT Token（包含 tenant_id）。
    登录成功后自动设置租户上下文。
    
    Args:
        data: 登录请求数据（username, password, tenant_id 可选）
        
    Returns:
        LoginResponse: 登录成功的响应数据（包含 access_token）
    """
    pass
```

**总结**：
- **Tags（标签）**：使用**英文**，用于 API 文档分组和分类
- **描述（文档字符串）**：使用**中文**，用于详细说明 API 功能

## 🗄️ 数据库规范（必须严格遵循）

> **详细规范请参考**：[3.数据库命名规范.md](./Farming%20Plan/2.rules/3.数据库命名规范.md)

### 表结构规范

**所有表必须包含以下标准字段**：
```sql
CREATE TABLE {module_prefix}_{table_name} (
    -- 主键
    id SERIAL PRIMARY KEY,
    
    -- 租户隔离（所有表必须包含）
    tenant_id INTEGER NOT NULL,
    
    -- 业务字段
    -- ...
    
    -- 标准时间字段
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,  -- 软删除（可选）
    
    -- 标准索引（索引名必须包含模块前缀）
    INDEX idx_{module_prefix}_{table_name}_tenant_id (tenant_id),
    INDEX idx_{module_prefix}_{table_name}_created_at (created_at)
);

-- 示例：核心系统表（core_ 前缀，符合框架哲学：core = 根）
CREATE TABLE core_users (
    id SERIAL PRIMARY KEY,
    tenant_id INTEGER NOT NULL,
    -- ...
    INDEX idx_core_users_tenant_id (tenant_id)
);

-- 示例：应用插件表
CREATE TABLE seed_mes_orders (
    id SERIAL PRIMARY KEY,
    tenant_id INTEGER NOT NULL,
    -- ...
    INDEX idx_seed_mes_orders_tenant_id (tenant_id)
);
```

### 多租户规范

**所有数据模型必须包含 `tenant_id` 字段**：
```python
class BaseModel(Model):
    """所有模型的基类，包含租户隔离字段"""
    id = fields.IntField(pk=True)
    tenant_id = fields.IntField(null=True, index=True)  # 租户 ID
    created_at = fields.DatetimeField(auto_now_add=True)
    updated_at = fields.DatetimeField(auto_now=True)
    
    class Meta:
        abstract = True
```

**所有查询必须自动过滤租户**：
```python
# ✅ 正确：自动过滤租户
users = await User.filter(tenant_id=current_tenant_id).all()

# ❌ 错误：未过滤租户
users = await User.all()
```

**必须遵循**：
1. **所有数据模型必须包含 `tenant_id` 字段**
2. **所有查询必须自动过滤租户**
3. **JWT Token 必须包含租户信息**
4. **API 请求必须验证租户权限**
5. **禁止跨租户数据访问**

## ⚠️ 错误处理规范（必须严格遵循）

### 后端错误处理

**统一异常处理**：
```python
from fastapi import HTTPException
from core.exceptions import (
    UserNotFoundError,
    PermissionDeniedError,
    ValidationError
)

# ✅ 正确：使用自定义异常
if not user:
    raise UserNotFoundError("用户不存在")

# ✅ 正确：使用 HTTPException（API 层）
if not user:
    raise HTTPException(
        status_code=404,
        detail="用户不存在"
    )

# ❌ 错误：直接返回错误信息
return {"error": "用户不存在"}
```

**异常类型**：
- `400`: 请求参数错误（ValidationError）
- `401`: 未授权（UnauthorizedError）
- `403`: 权限不足（PermissionDeniedError）
- `404`: 资源不存在（NotFoundError）
- `500`: 服务器内部错误（InternalServerError）

### 前端错误处理

**统一错误处理**：
```typescript
// ✅ 正确：使用 try-catch 处理错误
try {
  const result = await createUser(data);
  message.success('创建成功');
} catch (error) {
  message.error(error.message || '创建失败');
}

// ✅ 正确：使用 TanStack Query 统一错误处理
// 在 query client 中统一处理错误
```

## 🔄 Git 提交规范（必须严格遵循）

### 提交格式

遵循 [Conventional Commits](https://www.conventionalcommits.org/) 规范：

```
<type>(<scope>): <subject>

<body>

<footer>
```

### 提交类型（type）

- `feat`: 新功能
- `fix`: 修复问题
- `docs`: 文档更新
- `style`: 代码格式（不影响功能）
- `refactor`: 重构
- `test`: 测试相关
- `chore`: 构建/工具相关
- `perf`: 性能优化

### 提交示例

```bash
# ✅ 正确示例
feat(user): 添加用户批量导入功能
fix(auth): 修复 JWT Token 过期时间计算错误
docs(api): 更新用户管理 API 文档
refactor(tenant): 重构租户上下文管理逻辑

# ❌ 错误示例
update user
修复bug
添加功能
```

### Git 工作流

- **主分支**: `main` (生产环境)
- **开发分支**: `develop`
- **功能分支**: `feature/xxx` (从 develop 创建)
- **修复分支**: `fix/xxx` (从 develop 创建)
- **发布分支**: `release/xxx` (从 develop 创建)

## 🧪 测试规范（必须严格遵循）

### 测试文件位置规范 ⭐ **重要**

**所有测试文件必须放在各自端的 `tests/` 文件夹中，禁止在其他位置创建测试文件**：

- ✅ **后端测试文件**：必须放在 `riveredge-core/tests/` 目录下
  - ✅ `riveredge-core/tests/test_user_service.py`
  - ✅ `riveredge-core/tests/test_tenant_api.py`
  - ✅ `riveredge-core/tests/test_tenant_isolation.py`
  - ❌ `riveredge-core/scripts/test_*.py` - 错误：禁止在 scripts 目录创建测试文件
  - ❌ `riveredge-core/src/tests/` - 错误：禁止在 src 目录下新建 tests 文件夹

- ✅ **前端测试文件**：必须放在 `riveredge-shell/tests/` 目录下（如果存在）
  - ✅ `riveredge-shell/tests/UserList.test.tsx`
  - ✅ `riveredge-shell/tests/userUtils.test.ts`
  - ❌ `riveredge-shell/src/tests/` - 错误：禁止在 src 目录下新建 tests 文件夹

**规则**：
- ❌ **禁止在 `scripts/` 目录创建测试文件**
- ❌ **禁止在 `src/` 目录下新建 `tests/` 文件夹**
- ❌ **禁止在其他位置创建测试文件**
- ✅ **所有测试文件统一放在项目根目录的 `tests/` 文件夹中**

### 后端测试

**测试框架**：pytest + pytest-asyncio

**测试文件位置**：`riveredge-core/tests/` ⭐ **必须**

**测试文件命名**：`test_*.py` 或 `*_test.py`

**测试函数命名**：`test_功能描述`

```python
# ✅ 正确：测试文件位置和命名
riveredge-core/tests/test_user_service.py
riveredge-core/tests/test_auth_api.py
riveredge-core/tests/test_tenant_isolation.py

# ✅ 正确：测试函数命名
async def test_create_user_success():
    """测试创建用户成功"""
    pass

async def test_create_user_with_duplicate_email():
    """测试创建用户时邮箱重复"""
    pass

# ❌ 错误：测试文件位置错误
riveredge-core/scripts/test_user_service.py  # 错误：禁止在 scripts 目录
riveredge-core/src/tests/test_user_service.py  # 错误：禁止在 src 目录下新建 tests 文件夹
```

**测试覆盖率要求**：
- 核心功能：> 80%
- 业务功能：> 70%
- 工具函数：> 90%

### 前端测试

**测试框架**：Jest + React Testing Library

**测试文件位置**：`riveredge-shell/tests/` ⭐ **必须**（如果存在）

**测试文件命名**：`*.test.tsx` 或 `*.spec.tsx`

**测试覆盖率要求**：
- 组件：> 70%
- 工具函数：> 80%

## ✅ 代码生成检查清单

**⚠️ 在执行任何代码生成、修改、创建操作之前，必须先打开此检查清单，逐项检查：**

在生成代码前，AI 助手必须检查：

### 通用规范检查 ⚠️ **必须逐项检查，违反即终止**

**⚠️ 在执行任何操作前，必须先检查以下规则，违反即立即停止：**

- [ ] **⚠️ 是否优先检查了官方库？**（第一优先级，必须首先检查）
  - [ ] Tortoise ORM 官方是否有推荐方式？
  - [ ] FastAPI 官方是否有推荐方式？
  - [ ] React 官方是否有推荐方式？
  - [ ] 是否查看了官方文档和最佳实践？
- [ ] **⚠️ 是否避免了自定义实现？**（禁止重复造轮子）
  - [ ] 官方库能满足需求吗？
  - [ ] 是否有成熟稳定的第三方库？
  - [ ] 只有在官方库和成熟库都无法满足时，才考虑自定义实现
- [ ] 文件编码是否为 UTF-8？
- [ ] **⚠️ 是否完全避免了使用 PowerShell？**（绝对禁止，全程严禁使用 PowerShell 进行任何操作）
  - [ ] 是否使用了 `powershell`、`pwsh`、`powershell.exe`、`pwsh.exe` 等命令？
  - [ ] 是否使用了 PowerShell 的 `-Command` 或 `-File` 参数？
  - [ ] 是否使用了 PowerShell 的任何命令（如 `Get-Content`、`Set-Content`、`Out-File`、`Stop-Process`、`Get-Process` 等）？
  - [ ] 如果使用了，必须立即停止并改用替代方案
- [ ] **是否使用了 Git Bash 或 VS Code 进行 Git 操作？**（禁止使用 PowerShell）
- [ ] **是否使用了 Python 脚本或 VS Code 进行批量操作？**（禁止使用 PowerShell）
- [ ] 是否按照优先级顺序检查了库选择？
  - [ ] 是否优先检查了 Ant Design Pro Components？
  - [ ] 是否优先检查了 React 官方库？
  - [ ] 是否优先检查了 FastAPI 官方扩展？
  - [ ] 是否优先检查了 Tortoise ORM 官方功能？
  - [ ] 是否优先检查了 PostgreSQL 原生功能？
- [ ] 是否优先使用了官方库？
- [ ] 如果使用第三方库，是否为成熟稳定的库？
- [ ] 自定义实现是否遵循了框架规范？

### 技术栈检查

- [ ] 是否使用了正确的技术栈？
- [ ] 是否引入了禁止使用的技术？
- [ ] **是否严格遵循React生态最佳实践规范？** ⭐ **第一优先级**
  - [ ] 是否使用了 React 18.3.1？
  - [ ] 是否使用了 Vite 5.4.8 作为构建工具？
  - [ ] 是否使用了 Zustand 5.0.0 进行状态管理？
  - [ ] 是否使用了 TanStack Query 5.51.1 进行数据获取？
  - [ ] 是否使用了 React Router DOM 6.26.2 进行路由管理？
  - [ ] 是否使用了 React Hook Form 7.53.0 进行表单管理？
  - [ ] 是否使用了 Vitest 2.1.8 进行测试？
- [ ] **是否完全避免了使用 PowerShell？** ⭐ **绝对禁止**（违反即终止）
  - [ ] 是否使用了 `powershell`、`pwsh`、`powershell.exe`、`pwsh.exe` 等命令？
  - [ ] 是否使用了 PowerShell 的 `-Command` 或 `-File` 参数？
  - [ ] 是否使用了 PowerShell 的任何命令（如 `Get-Content`、`Set-Content`、`Out-File`、`Stop-Process`、`Get-Process` 等）？
  - [ ] 如果使用了，必须立即停止并改用替代方案

### 命名规范检查

- [ ] 文件命名是否符合规范？
- [ ] 类命名是否符合规范？
- [ ] 函数命名是否符合规范？
- [ ] 变量命名是否符合规范？
- [ ] **是否避免了 Python 关键字？** ⭐ **重要**（禁止使用 `class`、`def`、`import`、`from`、`if`、`else`、`for`、`while`、`try`、`except`、`finally`、`with`、`as`、`pass`、`return`、`yield`、`break`、`continue`、`lambda`、`None`、`True`、`False`、`and`、`or`、`not`、`in`、`is`、`del`、`global`、`nonlocal`、`assert`、`async`、`await` 等作为变量名、函数名、参数名）
- [ ] **是否避免了 TypeScript/JavaScript 关键字？** ⭐ **重要**（禁止使用 `class`、`function`、`const`、`let`、`var`、`if`、`else`、`for`、`while`、`try`、`catch`、`finally`、`switch`、`case`、`default`、`break`、`continue`、`return`、`yield`、`async`、`await`、`import`、`export`、`from`、`as`、`new`、`this`、`super`、`extends`、`implements`、`interface`、`type`、`enum`、`namespace`、`module`、`declare`、`abstract`、`static`、`readonly`、`public`、`private`、`protected`、`get`、`set`、`constructor`、`null`、`undefined`、`true`、`false`、`NaN`、`Infinity` 等作为变量名、函数名、参数名、类型名）
- [ ] **是否避免了数据库关键字？** ⭐ **重要**（禁止使用 `CREATE`、`DROP`、`ALTER`、`TABLE`、`INDEX`、`SELECT`、`INSERT`、`UPDATE`、`DELETE`、`FROM`、`WHERE`、`JOIN`、`ORDER`、`BY`、`GROUP`、`HAVING`、`LIMIT`、`OFFSET`、`PRIMARY`、`KEY`、`FOREIGN`、`REFERENCES`、`UNIQUE`、`NOT`、`NULL`、`DEFAULT`、`CHECK`、`CONSTRAINT`、`AND`、`OR`、`NOT`、`IN`、`EXISTS`、`BETWEEN`、`LIKE`、`IS`、`CASE`、`WHEN`、`THEN`、`ELSE`、`END`、`TRUE`、`FALSE` 等作为表名、字段名、索引名）
- [ ] **是否避免了框架内置关键字？**（如 React、Ant Design 等）

### 代码质量检查

- [ ] 是否包含完整的注释（中文）？
- [ ] **API Tags 是否使用英文？**（如 `Authentication`, `Users`, `Roles`, `Permissions`）
- [ ] **API 描述是否使用中文？**（函数文档字符串）
- [ ] **表名是否包含模块前缀？**（核心系统：`core_`，应用插件：`seed_插件名_`，符合框架命名哲学）
- [ ] **索引名中的表名是否包含模块前缀？**
- [ ] 是否包含 `tenant_id` 字段？
- [ ] 查询是否自动过滤租户？
- [ ] 类型提示是否完整？
- [ ] 错误处理是否完善？

### 测试文件位置检查

- [ ] **测试文件是否放在正确的 `tests/` 目录？** ⭐ **重要**
  - [ ] 后端测试文件是否在 `riveredge-core/tests/` 目录？
  - [ ] 前端测试文件是否在 `riveredge-shell/tests/` 目录？
  - [ ] 是否避免了在 `scripts/` 目录创建测试文件？
  - [ ] 是否避免了在 `src/` 目录下新建 `tests/` 文件夹？

## 禁止事项

### 工具和操作禁止 ⚠️ **绝对禁止，违反即终止**

- ❌ **绝对禁止使用 PowerShell 进行任何操作**（包括但不限于：文件操作、进程管理、命令执行等）
  - **禁止使用 PowerShell 命令**：`powershell`、`pwsh`、`powershell.exe`、`pwsh.exe` 等
  - **禁止使用 PowerShell 脚本**：`.ps1` 文件、`-Command` 参数、`-File` 参数等
  - **禁止使用 PowerShell 命令**：`Get-Content`、`Set-Content`、`Out-File`、`Stop-Process`、`Get-Process`、`Invoke-Command` 等
  - **禁止在任何场景下使用 PowerShell**：包括但不限于：
    - 文件批量操作
    - 进程管理（启动、停止服务等）
    - 系统命令执行
    - 环境变量操作
    - 网络操作
    - 任何其他操作
  - **为什么绝对禁止**：
    - PowerShell 默认编码不一致，极易产生中文乱码问题
    - 不同命令编码行为不同，无法保证在所有场景下都稳定
    - BOM 问题、字符串处理和管道传递时编码可能变化
    - 即使设置了 UTF-8，也无法保证在所有场景下都稳定
    - 违反项目编码规范（UTF-8）
  - **推荐替代方案**：
    - ✅ **进程管理**：使用 `taskkill`（Windows CMD）、`kill`（Linux/Mac）、或直接告诉用户在运行服务的终端按 `Ctrl+C`
    - ✅ **文件批量操作**：使用 Python 脚本（推荐，Python 3 默认 UTF-8）
    - ✅ **文件编辑**：使用专业的文本编辑器（如 VS Code、Notepad++）
    - ✅ **命令执行**：使用 Git Bash、CMD、或直接告诉用户手动操作
  - **违规处理机制**（严格执行）：
    1. **立即停止**：一旦检测到使用 PowerShell，AI 助手必须立即停止当前所有操作
    2. **明确说明**：必须向用户明确说明："❌ 违反了绝对规则：禁止使用 PowerShell"
    3. **承认错误**：必须承认错误，不得辩解、推脱或找借口
    4. **使用替代方案**：必须使用规则中指定的替代方案（如 `taskkill`、Python 脚本等）重新执行操作
    5. **不得重复**：如果再次违反，必须立即停止并提醒用户规则已被违反
    6. **用户监督**：用户有权随时检查 AI 助手是否遵守规则，AI 助手必须配合

### 技术栈禁止

- ❌ **禁止使用 Flask、Django 等 Web 框架**（必须使用 FastAPI）
- ❌ **禁止使用 SQLAlchemy、Django ORM 等 ORM**（必须使用 Tortoise ORM）
- ❌ **禁止使用 MySQL、SQLite 等数据库**（必须使用 PostgreSQL）
- ❌ **禁止使用 Axios、fetch 等 HTTP 客户端**（必须使用 TanStack Query）
- ❌ **禁止使用 Redux 等状态管理**（必须使用 Zustand）
- ❌ **禁止使用 Material-UI、Element UI 等 UI 库**（必须使用 Ant Design）
- ❌ **禁止使用 ECharts、Chart.js 等图表库**（必须使用 @ant-design/charts）
- ❌ **禁止使用 aioredis 等 Redis 客户端**（必须使用 redis-py 的 redis.asyncio 接口）
- ❌ **绝对禁止违反React生态最佳实践规范**
  - ❌ **禁止更改React版本**（必须使用 18.3.1，最新稳定版）
  - ❌ **禁止使用非推荐的构建工具**（必须使用 Vite 5.4.8）
  - ❌ **禁止使用非推荐的状态管理**（必须使用 Zustand 5.0.0）
  - ❌ **禁止使用非推荐的数据获取库**（必须使用 TanStack Query 5.51.1）
  - ❌ **禁止使用非推荐的路由库**（必须使用 React Router DOM 6.26.2）
  - ❌ **禁止使用非推荐的表单库**（必须使用 React Hook Form 7.53.0）
  - ❌ **禁止使用非推荐的测试框架**（必须使用 Vitest 2.1.8）
  - ❌ **禁止使用类组件语法**（必须使用函数组件 + Hooks）
  - ❌ **禁止使用过时的生命周期方法**（必须使用 useEffect）
  - ❌ **禁止使用过时的 Context API**（必须使用现代 Context）

### 命名禁止
- ❌ 禁止使用驼峰命名（Python 后端）（必须使用 snake_case）
- ❌ 禁止使用下划线命名（TypeScript 前端）（必须使用 camelCase）
- ❌ 禁止使用单数表名（必须使用复数形式）
- ❌ 禁止表名缺少模块前缀（必须包含 `core_` 或 `seed_插件名_` 前缀，符合框架命名哲学）
- ❌ 禁止省略 `tenant_id` 字段（所有表必须包含）

### 注释禁止
- ❌ 禁止生成无注释的代码
- ❌ 禁止使用英文注释（必须使用中文注释）
- ❌ 禁止省略函数参数说明
- ❌ 禁止省略返回值说明

### API 文档禁止
- ❌ **禁止使用中文 Tags**（API 路由的 tags 必须使用英文，如 `Authentication`, `Users`, `Roles`）
- ❌ **禁止使用英文描述**（API 路由的描述必须使用中文，函数文档字符串）

## 🔄 开发流程规范

### 1. 创建新功能模块

**步骤**：
1. 创建数据库模型（继承 `BaseModel`，包含 `tenant_id`）
2. 创建 Pydantic Schema（Create、Update、Response）
3. 创建 Service 类（包含 CRUD 方法，自动过滤租户）
4. 创建 API 路由（使用 FastAPI Router）
5. 创建前端类型定义
6. 创建前端 API 服务
7. 创建前端组件（使用 ProTable、ProForm 等）

### 2. 代码审查检查点

**必须检查**：
- [ ] 是否使用了正确的技术栈？
- [ ] 命名是否符合规范？
- [ ] 注释是否完整？
- [ ] **API Tags 是否使用英文？**（如 `Authentication`, `Users`, `Roles`）
- [ ] **API 描述是否使用中文？**（函数文档字符串）
- [ ] 是否包含 `tenant_id` 字段？
- [ ] 查询是否自动过滤租户？
- [ ] 类型提示是否完整？
- [ ] 错误处理是否完善？

### 3. 多租户开发注意事项

**必须遵循**：
1. **所有数据模型必须包含 `tenant_id` 字段**
2. **所有查询必须自动过滤租户**
3. **JWT Token 必须包含租户信息**
4. **API 请求必须验证租户权限**
5. **禁止跨租户数据访问**

## 📚 相关文档

AI 助手在开发时必须参考以下文档：

### 核心规范文档

1. [1.框架命名哲学.md](./Farming%20Plan/2.rules/1.框架命名哲学.md) - ⭐ **框架模块命名哲学（core、shell、seeds、land、leaf）**
2. [2.字段命名规范.md](./Farming%20Plan/2.rules/2.字段命名规范.md) - ⭐ **统一命名规范（Python + TypeScript）**
3. [3.数据库命名规范.md](./Farming%20Plan/2.rules/3.数据库命名规范.md) - ⭐ **数据库命名规范**
4. [4.注释规范.md](./Farming%20Plan/2.rules/4.注释规范.md) - ⭐ **完善注释规范（Python + TypeScript）**

### 架构和开发文档

5. [1.最终技术选型.md](./Farming%20Plan/1.plan/1.最终技术选型.md) - 详细技术栈选型
6. [2.架构设计文档.md](./Farming%20Plan/1.plan/2.架构设计文档.md) - 系统架构设计
7. [3.框架功能列表.md](./Farming%20Plan/1.plan/3.框架功能列表.md) - 框架功能列表
8. [4.框架开发计划.md](./Farming%20Plan/1.plan/4.框架开发计划.md) - 详细开发计划（包含 Git 提交规范）

### API 和开发规范

9. [5.项目结构规范.md](./Farming%20Plan/2.rules/5.项目结构规范.md) - ⭐ **项目结构规范（目录组织、文件命名）**
10. [6.API设计规范.md](./Farming%20Plan/2.rules/6.API设计规范.md) - ⭐ **API 设计规范（统一响应格式、RESTful 风格、多租户规范）**
11. [7.错误处理规范.md](./Farming%20Plan/2.rules/7.错误处理规范.md) - ⭐ **错误处理规范（前后端统一错误处理）**
12. [8.Git工作流规范.md](./Farming%20Plan/2.rules/8.Git工作流规范.md) - ⭐ **Git 工作流规范（分支策略、提交规范、Code Review）**
13. [9.品牌VI一致性规范.md](./Farming%20Plan/2.rules/9.品牌VI一致性规范.md) - ⭐ **品牌VI一致性规范（基于 Ant Design Pro 的 B 端视觉风格）**
14. [10.第三方依赖管理规范.md](./Farming%20Plan/2.rules/10.第三方依赖管理规范.md) - ⭐ **第三方依赖管理规范（依赖选择、版本锁定、安全检查）**

### 最佳实践文档

15. [插件开发规范.md](./Farming%20Plan/4.branch/插件开发规范.md) - 插件开发详细规范

## 🎯 总结

AI 助手在协助开发 **RiverEdge SaaS 多租户框架 (RiverEdge SaaS Multi-tenant Framework)** 时，**必须严格遵循**：

### 核心规范（必须遵循）

1. ✅ **技术选型**：只使用框架确定的技术栈，不得替换或添加其他技术
2. ✅ **命名规范**：遵循统一的命名规范（参考 [2.字段命名规范.md](./Farming%20Plan/2.rules/2.字段命名规范.md)）
3. ✅ **注释规范**：所有代码必须包含完整的中文注释（参考 [4.注释规范.md](./Farming%20Plan/2.rules/4.注释规范.md)）
4. ✅ **数据库规范**：所有表必须包含 `tenant_id` 字段（参考 [3.数据库命名规范.md](./Farming%20Plan/2.rules/3.数据库命名规范.md)）
5. ✅ **多租户规范**：所有查询必须自动过滤租户
6. ✅ **类型安全**：使用类型提示，确保类型安全
7. ✅ **错误处理**：统一错误处理，提供清晰的错误信息
8. ✅ **测试覆盖**：核心功能测试覆盖率 > 80%
9. ✅ **Git 规范**：遵循 Conventional Commits 提交规范

### 规范文档索引

- **模块命名哲学**：[1.框架命名哲学.md](./Farming%20Plan/2.rules/1.框架命名哲学.md)
- **代码命名规范**：[2.字段命名规范.md](./Farming%20Plan/2.rules/2.字段命名规范.md)
- **数据库命名规范**：[3.数据库命名规范.md](./Farming%20Plan/2.rules/3.数据库命名规范.md)
- **注释规范**：[4.注释规范.md](./Farming%20Plan/2.rules/4.注释规范.md)
- **项目结构规范**：[5.项目结构规范.md](./Farming%20Plan/2.rules/5.项目结构规范.md)
- **API 设计规范**：[6.API设计规范.md](./Farming%20Plan/2.rules/6.API设计规范.md)
- **错误处理规范**：[7.错误处理规范.md](./Farming%20Plan/2.rules/7.错误处理规范.md)
- **Git 工作流规范**：[8.Git工作流规范.md](./Farming%20Plan/2.rules/8.Git工作流规范.md)
- **品牌VI一致性规范**：[9.品牌VI一致性规范.md](./Farming%20Plan/2.rules/9.品牌VI一致性规范.md)
- **第三方依赖管理规范**：[10.第三方依赖管理规范.md](./Farming%20Plan/2.rules/10.第三方依赖管理规范.md)

**违反任何规范都将导致代码无法通过审查，必须立即修正。**

## 🚨 违规处理与监督机制

### 违规处理流程

**如果 AI 助手违反规则，必须按以下流程处理**：

1. **立即停止**：一旦检测到违规（包括用户指出），AI 助手必须立即停止当前所有操作
2. **明确承认**：必须明确说明："❌ 违反了规则：[具体规则内容]"
3. **不得辩解**：不得找借口、推脱或试图解释为什么违反规则
4. **使用替代方案**：必须使用规则中指定的替代方案重新执行操作
5. **记录教训**：必须记住这次违规，确保不再重复

### 重复违规处理

**如果 AI 助手重复违反同一规则**：

1. **立即终止**：用户有权要求 AI 助手立即停止所有操作
2. **明确警告**：AI 助手必须明确说明："⚠️ 警告：重复违反了规则 [规则内容]，这是不可接受的"
3. **请求指导**：AI 助手应该请求用户明确指示下一步该怎么做
4. **严格遵守**：之后必须严格遵守规则，不得再次违反

### 用户监督权利

**用户有权**：
- 随时检查 AI 助手是否遵守规则
- 指出 AI 助手的违规行为
- 要求 AI 助手立即停止违规操作
- 要求 AI 助手使用替代方案重新执行
- 要求 AI 助手明确承认错误

**AI 助手必须**：
- 配合用户的监督和检查
- 立即响应违规指正
- 不得抗拒或辩解
- 严格遵守所有规则

---

## 📊 更新记录

**最后更新**：2025-11-19（同步React生态最佳实践规范，全面抛弃UMI相关内容）
